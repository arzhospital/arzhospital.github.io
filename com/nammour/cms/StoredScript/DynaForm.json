{
	"Id": "99e1f34ec771a62d567c5409f63acb819fdef125",
	"name": "DynaForm",
	"script": "d2luZG93LkR5bmFGb3JtID0gY2xhc3MgewoJY29uc3RydWN0b3IoKSB7CgkJdGhpcy50aXRsZSA9ICJGb3JtIFRpdGxlIjsKCQl0aGlzLm5hbWUgPSAiZnJtRm9ybSI7CgkJdGhpcy5lbGVtZW50cyA9IFtdOwoJCXRoaXMuc2VsZWN0cyA9IFtdOwoJCXRoaXMuZ3JpZHMgPSBbXTsKCQl0aGlzLmJ1dHRvbnMgPSBbXTsKCQl0aGlzLnpvbmVzID0gWydub3J0aCcsICdzb3V0aCcsICdlYXN0JywgJ3dlc3QnLCAnY2VudGVyJ107CgkJdGhpcy5zVGFibGUgPSBudWxsOwoJCXRoaXMuYkRlYnVnID0gZmFsc2U7CgkJdGhpcy51aVR5cGVzID0gewoJCQlpbnQ6ICJudW1iZXJzcGlubmVyIiwKCQkJbWVudTogInNwbGl0YnV0dG9uIiwKCQkJZGF0ZXRpbWU6ICJkYXRldGltZWJveCIsCgkJCWJvb2w6ICJzd2l0Y2hidXR0b24iLAoJCQlmaWxlOiAiZmlsZWJveCIsCgkJCXRleHQ6ICJ0ZXh0Ym94IiwKCQkJcGFzc3dvcmQ6ICJwYXNzd29yZGJveCIsCgkJCXN0cmluZzogInRleHRib3giLAoJCQlpbWFnZTogImRpYWxvZyIsCgkJCXByb2dyZXNzOiAicHJvZ3Jlc3NiYXIiLAoJCQlsaW5rOiAibGlua2J1dHRvbiIsCgkJCXRyZWU6ICJjb21ib3RyZWUiLAoJCQluYXZpZ2F0aW9uOiAidHJlZSIsCgkJCXNlYXJjaDogJ3NlYXJjaGJveCcsCgkJfTsKCQl0aGlzLmV2ZW50cyA9IFt7CgkJCW5hbWU6ICdvbkNsaWNrJywKCQkJaGFuZGxlcjogJ29uVG9nZ2xlJywKCQkJcGFyYW1zOiAnbj1ldmVudCcsCgkJCXR5cGU6ICd0b2dnbGUnLAoJCX0sIHsKCQkJbmFtZTogJ29uQ2xvc2UnLAoJCQloYW5kbGVyOiAnUGFuT25DbG9zZScsCgkJCXBhcmFtczogJ249ZXZlbnQnLAoJCQl0eXBlOiAnd2luZG93JywKCQl9LCB7CgkJCW5hbWU6ICdvblNlbGVjdCcsCgkJCWhhbmRsZXI6ICdTZWxlY3RDaGFuZ2UnLAoJCQlwYXJhbXM6ICduJywKCQkJdHlwZTogJ3RhYnMnLAoJCX0sIHsKCQkJbmFtZTogJ3NlYXJjaGVyJywKCQkJaGFuZGxlcjogJ0ZpZWxkQ2hhbmdlJywKCQkJcGFyYW1zOiAnbiwgbycsCgkJCXR5cGU6ICdzZWFyY2hib3gnLAoJCX0sIHsKCQkJbmFtZTogJ29uQmVmb3JlRXhwYW5kJywKCQkJaGFuZGxlcjogJ0V4cGFuZCcsCgkJCXBhcmFtczogJ24nLAoJCQl0eXBlOiAndHJlZScsCgkJfSwgewoJCQluYW1lOiAnb25DaGFuZ2UnLAoJCQloYW5kbGVyOiAnRmllbGRDaGFuZ2UnLAoJCQlwYXJhbXM6ICduLCBvJwoJCX0sIHsKCQkJbmFtZTogJ29uQmVmb3JlT3BlbicsCgkJCWhhbmRsZXI6ICdQYW5lbE9wZW4nLAoJCQlwYXJhbXM6ICcnLAoJCQl0eXBlOiAnd2luZG93JywKCQl9LCB7CgkJCW5hbWU6ICdvbk9wZW4nLAoJCQloYW5kbGVyOiAnUGVuZEFmdGVyT3BlbicsCgkJCXBhcmFtczogJycsCgkJCXR5cGU6ICd3aW5kb3cnLAoJCX0sIHsKCQkJbmFtZTogJ29uQ2xpY2snLAoJCQloYW5kbGVyOiAnZG9MaW5rJywKCQkJcGFyYW1zOiAnbj1ldmVudCwgbycsCgkJCXR5cGU6ICdsaW5rJywKCQl9LCB7CgkJCW5hbWU6ICdvbkNsaWNrUm93JywKCQkJaGFuZGxlcjogJ0ZpZWxkQ2hhbmdlJywKCQkJcGFyYW1zOiAnbiwgbycsCgkJCXR5cGU6ICdncmlkJywKCQl9XTsKCgkJaWYgKHR5cGVvZigkKSAhPT0gJ3VuZGVmaW5lZCcpICQod2luZG93KS5yZXNpemUodGhpcy53aW5kb3dSZXNpemVkKTsKCQl0aGlzLndpbmRvd1Jlc2l6ZWQoKTsKCX0KCglzcigpIHsKCQlyZXR1cm4gdHlwZW9mKF9GckVNRCkgIT09ICd1bmRlZmluZWQnID8gX0ZyRU1ELnNyKCkgOiB3aW5kb3cuc3I7Cgl9CgoJcGFyc2UoKSB7CgkJJC5wYXJzZXIucGFyc2UoKTsKCX0KCgl3aW5kb3dSZXNpemVkKCkgewoJCXRoaXMud2lkdGggPSB3aW5kb3cuaW5uZXJXaWR0aDsKCQl0aGlzLmhlaWdodCA9IHdpbmRvdy5pbm5lckhlaWdodCAqIDAuODsKCX0KCglpbml0KCkgewoJCXZhciBzZWxlY3QgPSB7CgkJCWluaXQ6IGZ1bmN0aW9uKGNvbnRhaW5lciwgb3B0aW9ucykgewoJCQkJdmFyIG9wID0gbnVsbDsKCQkJCXZhciBmb3AgPSBudWxsOwoJCQkJZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmdyaWRzLmxlbmd0aDsgaSsrKQoJCQkJCWlmICh0aGlzLmdyaWRzW2ldLmlkID09IG9wdGlvbnMuc291cmNlKSBvcCA9IHRoaXMuZ3JpZHNbaV0ub3B0aW9uczsKCQkJCWZvciAoaSA9IDA7IGkgPCBvcC5jb2x1bW5zLmxlbmd0aDsgaSsrKQoJCQkJCWlmIChvcC5jb2x1bW5zW2ldLm5hbWUgPT0gb3B0aW9ucy5maWVsZCkgZm9wID0gb3AuY29sdW1uc1tpXTsKCQkJCWZvcC53aWR0aCA9ICh0aGlzLndpZHRoIC8gMyk7CgkJCQl2YXIgZSA9ICQodGhpcy5zZWxlY3QoZm9wKSk7CgkJCQl2YXIgaW5wdXQgPSBlLmFwcGVuZFRvKGNvbnRhaW5lcik7CgkJCQlpbnB1dC5jb21ib2dyaWQoKTsKCQkJCXRoaXMuYmluZChpbnB1dCk7CgkJCQlyZXR1cm4gaW5wdXQ7CgkJCX0sCgkJCWRlc3Ryb3k6IGZ1bmN0aW9uKHRhcmdldCkgewoJCQkJJCh0YXJnZXQpLnJlbW92ZSgpOwoJCQl9LAoJCQlnZXRWYWx1ZTogZnVuY3Rpb24odGFyZ2V0KSB7CgkJCQlyZXR1cm4gJCh0YXJnZXQpLnZhbCgpOwoJCQl9LAoJCQlzZXRWYWx1ZTogZnVuY3Rpb24odGFyZ2V0LCB2YWx1ZSkgewoJCQkJJCh0YXJnZXQpLnZhbCh2YWx1ZSk7CgkJCX0sCgkJCXJlc2l6ZTogZnVuY3Rpb24odGFyZ2V0LCB3aWR0aCkgewoJCQkJJCh0YXJnZXQpLl9vdXRlcldpZHRoKHdpZHRoKTsKCQkJfQoJCX07CgkJJC5leHRlbmQoJC5mbi5kYXRhZ3JpZC5kZWZhdWx0cy5lZGl0b3JzLCB7CgkJCWRhdGV0aW1lOiB7CgkJCQlpbml0OiBmdW5jdGlvbihjb250YWluZXIsIG9wdGlvbnMpIHsKCQkJCQlvcHRpb25zLndpZHRoID0gdGhpcy5jV2lkdGgob3B0aW9ucyk7CgkJCQkJdmFyIGlucHV0ID0gJCh0aGlzLmRhdGV0aW1lKG9wdGlvbnMpKS5hcHBlbmRUbyhjb250YWluZXIpOwoJCQkJCWlucHV0LmRhdGV0aW1lYm94KCk7CgkJCQkJcmV0dXJuIGlucHV0OwoJCQkJfSwKCQkJCWRlc3Ryb3k6IGZ1bmN0aW9uKHRhcmdldCkgewoJCQkJCSQodGFyZ2V0KS5yZW1vdmUoKTsKCQkJCX0sCgkJCQlnZXRWYWx1ZTogZnVuY3Rpb24odGFyZ2V0KSB7CgkJCQkJcmV0dXJuICQodGFyZ2V0KS52YWwoKTsKCQkJCX0sCgkJCQlzZXRWYWx1ZTogZnVuY3Rpb24odGFyZ2V0LCB2YWx1ZSkgewoJCQkJCSQodGFyZ2V0KS52YWwodmFsdWUpOwoJCQkJfSwKCQkJCXJlc2l6ZTogZnVuY3Rpb24odGFyZ2V0LCB3aWR0aCkgewoJCQkJCSQodGFyZ2V0KS5fb3V0ZXJXaWR0aCh3aWR0aCk7CgkJCQl9CgkJCX0sCgkJCWNoZWNrYm94OiB7CgkJCQlpbml0OiBmdW5jdGlvbihjb250YWluZXIsIG9wdGlvbnMpIHsKCQkJCQl2YXIgaW5wdXQgPSAkKHRoaXMuYm9vbChvcHRpb25zKSkuYXBwZW5kVG8oY29udGFpbmVyKTsKCQkJCQlpbnB1dC5zd2l0Y2hidXR0b24oKTsKCQkJCQlyZXR1cm4gaW5wdXQ7CgkJCQl9LAoJCQkJZGVzdHJveTogZnVuY3Rpb24odGFyZ2V0KSB7CgkJCQkJJCh0YXJnZXQpLnJlbW92ZSgpOwoJCQkJfSwKCQkJCWdldFZhbHVlOiBmdW5jdGlvbih0YXJnZXQpIHsKCQkJCQlyZXR1cm4gJCh0YXJnZXQpLnZhbCgpOwoJCQkJfSwKCQkJCXNldFZhbHVlOiBmdW5jdGlvbih0YXJnZXQsIHZhbHVlKSB7CgkJCQkJJCh0YXJnZXQpLnZhbCh2YWx1ZSk7CgkJCQl9LAoJCQkJcmVzaXplOiBmdW5jdGlvbih0YXJnZXQsIHdpZHRoKSB7CgkJCQkJJCh0YXJnZXQpLl9vdXRlcldpZHRoKHdpZHRoKTsKCQkJCX0KCQkJfSwKCQkJY29tYm90cmVlZ3JpZDogc2VsZWN0LAoJCQlzZWxlY3Q6IHNlbGVjdCwKCQl9KTsKCX0KCglhc2socXVlc3Rpb24sIGZBbnN3ZXIgPSB2ID0+IHYsIG9wdGlvbnMpIHsKCQkkLm1lc3NhZ2VyLmNvbmZpcm0odGhpcy50aXRsZSwgcXVlc3Rpb24sIGZ1bmN0aW9uKHIpIHsKCQkJaWYgKG9wdGlvbnMpIHsKCQkJCWZvciAodmFyIGkgPSAwOyBpIDwgb3B0aW9ucy5sZW5ndGg7IGkrKykgewoJCQkJCWlmIChvcHRpb25zW2ldLmFuc3dlciA9PSByKSB7CgkJCQkJCXJldHVybiBmQW5zd2VyKG9wdGlvbnNbaV0udmFsdWUpOwoJCQkJCX0KCQkJCX0KCQkJfSBlbHNlIHsKCQkJCXJldHVybiBmQW5zd2VyKHIpOwoJCQl9CgkJfSk7Cgl9CgoJdG9wRGF0YShhciwgZ0ZpZWxkLCB2RmllbGQsIHRvcCkgewoJCWlmICghdG9wKSB7CgkJCXJldHVybiBhcjsKCQl9CgkJcmV0ID0gW107CgkJJC5lYWNoKHRoaXMuc3IoKS5ncm91cEJ5KGFyLCBnRmllbGQpLCBmdW5jdGlvbihrZXksIHZhbHVlcykgewoJCQl2YWx1ZXMudmFsdWVzLnNvcnQoKGEsIGIpID0+IHsKCQkJCWlmIChwYXJzZUZsb2F0KGFbdkZpZWxkXSkgPCBwYXJzZUZsb2F0KGJbdkZpZWxkXSkpIHsKCQkJCQlyZXR1cm4gMTsKCQkJCX0gZWxzZSBpZiAocGFyc2VGbG9hdChhW3ZGaWVsZF0pID4gcGFyc2VGbG9hdChiW3ZGaWVsZF0pKSB7CgkJCQkJcmV0dXJuIC0xOwoJCQkJfSBlbHNlIHsKCQkJCQlyZXR1cm4gMDsKCQkJCX0KCQkJfSk7CgkJCSQuZWFjaCh2YWx1ZXMudmFsdWVzLCBmdW5jdGlvbihpLCB2KSB7CgkJCQlpZiAoaSA8IHRvcCkgewoJCQkJCXJldC5wdXNoKHYpOwoJCQkJfQoJCQl9KTsKCQl9KTsKCQlyZXR1cm4gcmV0OwoJfQoKCWFzeW5jIENSVUQoc1RhYmxlLCBiRml4ZWQpIHsKCQl2YXIgZmllbGRzID0gW107CgkJdGhpcy5zVGFibGUgPSBzVGFibGU7CgkJaWYgKHdpbmRvdy5iTG9jYWwgJiYgY29tcGFueS5saWJyYXJ5KSB7CgkJCXZhciByZXQgPSBhd2FpdCB0aGlzLnNyKCkuXygiQ29udGVudE1hbmFnZXIuY21zR2VuZXJhdGVMYXllckNsYXNzIiwgbnVsbCwgY29tcGFueS5saWJyYXJ5ICsgIi4iICsgc1RhYmxlKTsKCQkJZmllbGRzLnB1c2goewoJCQkJZ3JvdXA6ICJNYWluIiwKCQkJCWF0dHJpYnV0ZTogewoJCQkJCVJlbGF0aW9uQ2xhc3M6IHsKCQkJCQkJTmFtZTogc1RhYmxlCgkJCQkJfQoJCQkJfSwKCQkJCW5hbWU6IHRoaXMuc1RhYmxlLAoJCQkJdHlwZTogJ3NlbGVjdCcsCgkJCQlzZWxlY3Q6IGZ1bmN0aW9uKG8pIHsKCQkJCQl0aGlzLnNldChvKTsKCQkJCX0KCQkJfSk7CgkJCWZvciAodmFyIGkgPSAwOyBpIDwgcmV0LkxheWVyQXR0cmlidXRlcy5sZW5ndGg7IGkrKykgewoJCQkJaWYgKHJldC5MYXllckF0dHJpYnV0ZXNbaV0uTmFtZSA9PSAiSWQiKSBjb250aW51ZTsKCQkJCWZpZWxkcy5wdXNoKHsKCQkJCQlncm91cDogIk1haW4iLAoJCQkJCW5hbWU6IHJldC5MYXllckF0dHJpYnV0ZXNbaV0uTmFtZSwKCQkJCQl0eXBlOiByZXQuTGF5ZXJBdHRyaWJ1dGVzW2ldLk5hdGl2ZVR5cGUKCQkJCX0pOwoJCQl9CgkJCWZvciAoaSA9IDA7IGkgPCByZXQuUmVsYXRpb25BdHRyaWJ1dGVzLmxlbmd0aDsgaSsrKSB7CgkJCQl2YXIgbSA9IHJldC5SZWxhdGlvbkF0dHJpYnV0ZXNbaV0uSXNBcnJheTsKCQkJCXZhciByQ29scyA9IFtdOwoJCQkJZm9yICh2YXIgcCBpbiByZXQuUmVsYXRpb25BdHRyaWJ1dGVzW2ldLlJlbGF0aW9uQ2xhc3MpIHsKCQkJCQlpZiAoJC5pbkFycmF5KHAsIFsiVG9TdHJpbmciLCAiX1RvU3RyaW5nIiwgIl9fUk9XSUQiLCAiX19MT0FERUQiLCAiSWQiXSkgPiAtMSkgY29udGludWU7CgkJCQkJckNvbHMucHVzaCh7CgkJCQkJCWZpZWxkOiBwLAoJCQkJCQl0aXRsZTogcAoJCQkJCX0pOwoJCQkJfQoJCQkJZmllbGRzLnB1c2goewoJCQkJCWdyb3VwOiAobSA/ICJPdGhlciIgOiAiUmVsYXRpb25zIiksCgkJCQkJQ2xhc3M6IHJldC5SZWxhdGlvbkF0dHJpYnV0ZXNbaV0uUmVsYXRpb25DbGFzcywKCQkJCQluYW1lOiByZXQuUmVsYXRpb25BdHRyaWJ1dGVzW2ldLk5hbWUsCgkJCQkJdHlwZTogJ3NlbGVjdCcsCgkJCQkJbXVsdGlwbGU6IG0sCgkJCQkJc291cmNlOiBmdW5jdGlvbihvLCBmRGF0YSkgewoJCQkJCQlyZXR1cm4gbzsKCQkJCQl9LAoJCQkJCWNvbHVtbnM6IHJDb2xzCgkJCQl9KTsKCQkJfQoJCX0gZWxzZSB7CgkJCS8vIGVtcwoJCQl2YXIgZWMgPSBfRnJFTUQuX19zY29wZSgpLkVudGl0eUNsYXNzZXMuZmluZChjID0+IGMuTmFtZS5yZXBsYWNlKC9cIC9nLCAnXycpID09IHNUYWJsZSk7CgkJCWZpZWxkcy5wdXNoKHsKCQkJCW5hbWU6IHNUYWJsZSwKCQkJCXRpdGxlOiBlYy5OYW1lLAoJCQkJbGFiZWw6IF9GckVNRC5fdGl0bGVDYXNlKGVjLk5hbWUpLAoJCQkJQ2xhc3M6IHsKCQkJCQlOYW1lOiBlYy5OYW1lLAoJCQkJCUlkOiBlYy5JZAoJCQkJfSwKCQkJCS8vem9uZTogJ3RvcCcsCgkJCQl0eXBlOiAnc2VsZWN0JywKCQkJCXNlbGVjdDogbyA9PiB7CgkJCQkJdGhpcy5kRm9ybS5jbGVhcigpOwoJCQkJCXRoaXMuZEZvcm0uc2V0KG8pOwoJCQkJfQoJCQl9KTsKCQkJZmllbGRzLnB1c2goLi4uZWMuRW50aXR5QXR0cmlidXRlcy5maWx0ZXIoZWEgPT4gIWVhLkVudGl0eU1ldGhvZCAmJiAhZWEuSXNUZXh0KS5tYXAoZWEgPT4gZWEuRW50aXR5VHlwZSA/ICh7CgkJCQlncm91cDogZWEuR3JvdXAuTmFtZSwKCQkJCW5hbWU6IGVhLk5hbWUsCgkJCQlsYWJlbDogX0ZyRU1ELl90aXRsZUNhc2UoZWEuTmFtZSksCgkJCQl0eXBlOiAnc2VsZWN0JywKCQkJCUNsYXNzOiB7CgkJCQkJTmFtZTogZWEuRW50aXR5VHlwZS5OYW1lLAoJCQkJCUlkOiBlYS5FbnRpdHlUeXBlLklkCgkJCQl9LAoJCQkJc291cmNlOiAobywgZkRhdGEpID0+IG8sCgkJCX0pIDogKHsKCQkJCWdyb3VwOiBlYS5Hcm91cC5OYW1lLAoJCQkJbmFtZTogZWEuTmFtZSwKCQkJCWxhYmVsOiBfRnJFTUQuX3RpdGxlQ2FzZShlYS5OYW1lKSwKCQkJCXR5cGU6IGVhLklzQm9vbCA/ICdib29sJyA6IChlYS5Jc0RhdGUgPyAnZGF0ZXRpbWUnIDogJ3N0cmluZycpLAoJCQl9KSkpOwoJCQlmaWVsZHMucHVzaCguLi5lYy5FbnRpdHlBdHRyaWJ1dGVzLmZpbHRlcihlYSA9PiAhZWEuRW50aXR5TWV0aG9kICYmIGVhLklzVGV4dCkubWFwKGVhID0+ICh7CgkJCQlncm91cDogZWEuR3JvdXAuTmFtZSwKCQkJCW5hbWU6IGVhLk5hbWUsCgkJCQl0eXBlOiAnd2luZG93JywKCQkJCWxhYmVsOiBfRnJFTUQuX3RpdGxlQ2FzZShlYS5OYW1lKSwKCQkJCWVkaXRvcjogdHJ1ZSwKCQkJCWxhbmd1YWdlOiBvID0+ICJ0ZXh0IiwKCQkJCWxvYWRlcjogYXN5bmMgKGZEYXRhLCBvRWxlbWVudCwgZWRpdG9yKSA9PiBjb25zb2xlLmxvZyhmRGF0YSwgb0VsZW1lbnQsIGVkaXRvciwgdGhpcyksCgkJCQlzYXZlcjogYXN5bmMgKHYsIGZEYXRhKSA9PiB2LAoJCQl9KSkpOwoJCX0KCQlyZXR1cm4gewoJCQlmb3JtOiB0aGlzLnJlbmRlcihzVGFibGUsIHRoaXMuZW5nbGlzaChzVGFibGUpLCBmaWVsZHMsIFt7CgkJCQluYW1lOiAnUmVzZXQnLAoJCQkJb25jbGljazogbyA9PiB7CgkJCQkJdGhpcy5kRm9ybS5idXN5KGZhbHNlKTsKCQkJCQl0aGlzLmRGb3JtLmNsZWFyKCk7CgkJCQl9LAoJCQkJaWNvbjogImNhbmNlbCIKCQkJfSwgewoJCQkJbmFtZTogJ1NhdmUnLAoJCQkJb25jbGljazogbyA9PiB7CgkJCQkJaWYgKG9bdGhpcy5zVGFibGVdICYmIG9bdGhpcy5zVGFibGVdLklkKSBvLklkID0gb1t0aGlzLnNUYWJsZV0uSWQ7CgkJCQkJZGVsZXRlIG9bdGhpcy5zVGFibGVdOwoJCQkJCWlmIChjb21wYW55LmxpYnJhcnkpIHsKCQkJCQkJX0ZyRU1ELnNyKCkuXyhjb21wYW55LkNvZGUudG9Mb3dlckNhc2UoKSArICIiICsgdGhpcy5zVGFibGUgKyAoby5JZCA/ICJVcGRhdGUiIDogIkluc2VydCIpLCBmdW5jdGlvbihyZXQpIHsKCQkJCQkJCWlmIChyZXQpIHsKCQkJCQkJCQl0aGlzLmRGb3JtLmluZm8odGhpcy5zVGFibGUgKyAiIFNhdmVkIik7CgkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCXRoaXMuZEZvcm0uZXJyb3IoIlVuYWJsZSB0byBzYXZlICIgKyB0aGlzLnNUYWJsZSk7CgkJCQkJCQl9CgkJCQkJCQl0aGlzLmJ1c3koZmFsc2UpOwoJCQkJCQl9LCBvKTsKCQkJCQl9IGVsc2UgewoJCQkJCQlfRnJFTUQuc3IoKS5fKCJlbXNFbnRpdHlPYmplY3QiICsgKG8uSWQgPyAiVXBkYXRlIiA6ICJJbnNlcnQiKSwgZnVuY3Rpb24ocmV0KSB7CgkJCQkJCQlpZiAocmV0KSB7CgkJCQkJCQkJdGhpcy5kRm9ybS5pbmZvKHRoaXMuc1RhYmxlICsgIiBTYXZlZCIpOwoJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQl0aGlzLmRGb3JtLmVycm9yKCJVbmFibGUgdG8gc2F2ZSAiICsgdGhpcy5zVGFibGUpOwoJCQkJCQkJfQoJCQkJCQkJdGhpcy5kRm9ybS5idXN5KGZhbHNlKTsKCQkJCQkJfSwgby50b0VudGl0eU9iamVjdCgpKTsKCQkJCQl9CgkJCQl9CgkJCX1dLCBiRml4ZWQpCgkJfTsKCX0KCglhc3luYyBkb0NsaWNrKGJ1dHRvbikgewoJCWxldCBfdGhpcyA9IHR5cGVvZih0aGlzLmRvQ2xpY2spID09PSAnZnVuY3Rpb24nID8gdGhpcyA6IHdpbmRvdy5ERm9ybTsKCQlidXR0b24gPSBfdGhpcy5idXR0b25zLmZpbmQoYiA9PiBiLm5hbWUgPT0gYnV0dG9uLm5hbWUgJiYgYi5ncm91cCA9PSBidXR0b24uZ3JvdXApOwoJCV90aGlzLmJ1c3kodHJ1ZSk7CgkJdmFyIG8gPSBfdGhpcy5nZXQoKTsKCQl2YXIgc01pc3NpbmcgPSBfdGhpcy5lbGVtZW50cy5maWx0ZXIoZSA9PiAoYnV0dG9uLndpbmRvdyA/IGJ1dHRvbi5ncm91cCA9PSBlLmdyb3VwIDogdHJ1ZSkpLmZpbHRlcihlID0+IGUucmVxdWlyZWQgJiYgIW9bZS5uYW1lXSkubWFwKGUgPT4gIjxsaT4iICsgKGUubGFiZWwgfHwgZS5uYW1lKSArICI8L2xpPiIpLmpvaW4oIiIpOwoJCWlmIChzTWlzc2luZykgewoJCQl3aW5kb3cuX0ZyRU1ELl9lcnJvcigiTWlzc2luZyBtYW5kYXRvcnkgZmllbGRzOjxici8+PHVsPiIgKyBzTWlzc2luZyArICI8L3VsPiIsIDUwMDApOwoJCQlfdGhpcy5idXN5KGZhbHNlKTsKCQkJcmV0dXJuOwoJCX0KCQlpZiAoYnV0dG9uLm9uY2xpY2spIGF3YWl0IGJ1dHRvbi5vbmNsaWNrKG8pOwoJCWlmIChidXR0b24ub25DbGljaykgYXdhaXQgYnV0dG9uLm9uQ2xpY2sobyk7CgkJX3RoaXMuYnVzeShmYWxzZSk7Cgl9CgoJYnVzeShiQnVzeSkgewoJCWlmICghYkJ1c3kpIHsKCQkJdmFyIHRvdGFsID0gMDsKCQkJaWYgKHR5cGVvZiBtb21lbnQgIT09ICd1bmRlZmluZWQnKSB7CgkJCQl0b3RhbCA9IG1vbWVudCgpLmRpZmYobW9tZW50KHRoaXMuYnVzeVN0YW1wKSwgJ3NlY29uZHMnKTsKCQkJfSBlbHNlIHsKCQkJCS8vIG5vIG1vbWVudCwgdXNlIHN0YW5kYXJkIERhdGUKCQkJCXRvdGFsID0gKG5ldyBEYXRlKCkuZ2V0VGltZSgpIC0gdGhpcy5idXN5U3RhbXAgPyB0aGlzLmJ1c3lTdGFtcC5nZXRUaW1lKCkgOiAwKSAvIDEwMDAgLyAzNjAwOwoJCQl9CgkJCWlmICh0aGlzLmJEZWJ1ZykgewoJCQkJd2luZG93Ll9GckVNRC5fYWxlcnQoIkV4ZWN1dGlvbiBUaW1lOiAiICsgdG90YWwgKyAiIHNlY29uZHMuIik7CgkJCX0KCQkJZGVsZXRlIHRoaXMuYnVzeVN0YW1wOwoJCX0gZWxzZSB7CgkJCXRoaXMuYnVzeVN0YW1wID0gbmV3IERhdGUoKTsKCQl9CgoJCSQuZWFjaCgkLm1lcmdlKCQubWFwKHRoaXMuYnV0dG9ucywgYiA9PiBiLm5hbWUpLCAkLm1hcCh0aGlzLmVsZW1lbnRzLmZpbHRlcihlID0+IGUudHlwZSA9PSAnbGluaycpLCBlID0+IGUubmFtZSkpLCAoXywgZSkgPT4gJCgnIycgKyBlKS5saW5rYnV0dG9uKGJCdXN5ID8gJ2Rpc2FibGUnIDogJ2VuYWJsZScpKTsKCX0KCglwcmVmaXgoZSkgewoJCXN3aXRjaCAoZS50eXBlKSB7CgkJCWNhc2UgJ2xhYmVsJzoKCQkJCXJldHVybiAnbGJsJzsKCQkJY2FzZSAndGV4dCc6CgkJCWNhc2UgJ3N0cmluZyc6CgkJCWNhc2UgJ3NlYXJjaCc6CgkJCWNhc2UgJ3Bhc3N3b3JkJzoKCQkJCXJldHVybiAndHh0JzsKCQkJY2FzZSAiRGF0ZVRpbWUiOgoJCQljYXNlICJkYXRldGltZSI6CgkJCQlyZXR1cm4gJ2R0cCc7CgkJCWNhc2UgImludCI6CgkJCWNhc2UgImludGVnZXIiOgoJCQljYXNlICJudW1iZXIiOgoJCQljYXNlICJsb25nIjoKCQkJY2FzZSAiTG9uZyI6CgkJCQlyZXR1cm4gJ251ZCc7CgkJCWNhc2UgJ2ZpbGUnOgoJCQkJcmV0dXJuICdmaWwnOwoJCQljYXNlICdpbWFnZSc6CgkJCQlyZXR1cm4gJ2ltZyc7CgkJCWNhc2UgImJvb2wiOgoJCQkJcmV0dXJuICdjaGsnOwoJCQljYXNlICJ3aW5kb3ciOgoJCQkJcmV0dXJuICdwbmwnOwoJCQljYXNlICJwcm9ncmVzcyI6CgkJCQlyZXR1cm4gJ3ByZyc7CgkJCWNhc2UgImdyaWQiOgoJCQljYXNlICJ0cmVlIjoKCQkJY2FzZSAic2VsZWN0IjoKCQkJCXJldHVybiAnY21iJzsKCQkJZGVmYXVsdDoKCQkJCXJldHVybiAnJzsKCQl9Cgl9CgoJY2xlYXIoZ3JvdXApIHsKCQl2YXIgbyA9IHt9OwoJCSQuZWFjaCh0aGlzLmVsZW1lbnRzLmZpbHRlcihlID0+IGdyb3VwID8gZS5ncm91cCA9PSBncm91cCA6IHRydWUpLCAoXywgZSkgPT4gewoJCQl2YXIgbmFtZSA9IChlLmVtc1NvdXJjZSA/ICJfIiA6ICIiKSArIGUubmFtZTsKCQkJc3dpdGNoIChlLnR5cGUpIHsKCQkJCWNhc2UgJ3RleHQnOgoJCQkJY2FzZSAnc3RyaW5nJzoKCQkJCWNhc2UgJ3NlYXJjaCc6CgkJCQljYXNlICdwYXNzd29yZCc6CgkJCQljYXNlICJEYXRlVGltZSI6CgkJCQljYXNlICJkYXRldGltZSI6CgkJCQkJb1tuYW1lXSA9ICIiOwoJCQkJCWJyZWFrOwoJCQkJY2FzZSAiaW50IjoKCQkJCWNhc2UgIm51bWJlciI6CgkJCQljYXNlICJpbnRlZ2VyIjoKCQkJCWNhc2UgImxvbmciOgoJCQkJY2FzZSAiTG9uZyI6CgkJCQljYXNlICJwcm9ncmVzcyI6CgkJCQkJb1tuYW1lXSA9IDA7CgkJCQkJYnJlYWs7CgkJCQljYXNlICJ0cmVlIjoKCQkJCWNhc2UgInNlbGVjdCI6CgkJCQkJb1tuYW1lXSA9IG51bGw7CgkJCQkJYnJlYWs7CgkJCQljYXNlICJncmlkIjoKCQkJCQlvW25hbWVdID8gb1tuYW1lXS5kYXRhID0gW10gOiBudWxsOwoJCQkJCWJyZWFrOwoJCQkJY2FzZSAiYm9vbCI6CgkJCQkJb1tuYW1lXSA9IGZhbHNlOwoJCQkJCWJyZWFrOwoJCQkJZGVmYXVsdDoKCQkJCQlicmVhazsKCQkJfQoJCX0pOwoJCS8vY29uc29sZS5sb2coImNsZWFyIiwgbyk7CgkJdGhpcy5zZXQobyk7CgkJdGhpcy5idXN5KGZhbHNlKTsKCX0KCglzZXQobywgZU5hbWUpIHsKCQlpZiAoZU5hbWUpIHsKCQkJdmFyIG9FbGVtZW50ID0gdGhpcy5ieU5hbWUoZU5hbWUpOwoJCQlpZiAoIW9FbGVtZW50KSByZXR1cm47CgkJCXZhciBhdHQgPSBudWxsOwoJCQlpZiAobyAmJiBvLklkICYmIG8uRW50aXR5QXR0cmlidXRlKSB7CgkJCQkvLyBhbiBFbnRpdHlWYWx1ZQoJCQkJZm9yICh2YXIgcCBpbiBvKQoJCQkJCWlmIChwLmVuZHNXaXRoKCJWYWx1ZSIpKSBhdHQgPSBwOwoJCQkJb0VsZW1lbnQuZW1zU291cmNlID0gbzsKCQkJfQoJCQl0cnkgewoJCQkJc3dpdGNoIChvRWxlbWVudC50eXBlKSB7CgkJCQkJY2FzZSAnbGFiZWwnOgoJCQkJCQlpZiAoYXR0KSB7CgkJCQkJCQkkKCIjIiArIHRoaXMucHJlZml4KG9FbGVtZW50KSArIG9FbGVtZW50Lm5hbWUpLmh0bWwob1thdHRdKTsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCSQoIiMiICsgdGhpcy5wcmVmaXgob0VsZW1lbnQpICsgb0VsZW1lbnQubmFtZSkuaHRtbCgobyAmJiBvLkVudGl0eUF0dHJpYnV0ZSkgPyAiIiA6IG8pOwoJCQkJCQl9CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgJ3RleHQnOgoJCQkJCWNhc2UgJ3N0cmluZyc6CgkJCQkJY2FzZSAncGFzc3dvcmQnOgoJCQkJCWNhc2UgImludCI6CgkJCQkJY2FzZSAic2VhcmNoIjoKCQkJCQljYXNlICJpbnRlZ2VyIjoKCQkJCQljYXNlICJudW1iZXIiOgoJCQkJCWNhc2UgImxvbmciOgoJCQkJCWNhc2UgIkxvbmciOgoJCQkJCQlpZiAoYXR0KSB7CgkJCQkJCQkkKCIjIiArIHRoaXMucHJlZml4KG9FbGVtZW50KSArIG9FbGVtZW50Lm5hbWUpW3RoaXMudWlUeXBlc1tvRWxlbWVudC50eXBlXV0oInNldFZhbHVlIiwgb1thdHRdKTsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCSQoIiMiICsgdGhpcy5wcmVmaXgob0VsZW1lbnQpICsgb0VsZW1lbnQubmFtZSlbdGhpcy51aVR5cGVzW29FbGVtZW50LnR5cGVdXSgic2V0VmFsdWUiLCAobyAmJiBvLkVudGl0eUF0dHJpYnV0ZSkgPyAiIiA6IG8pOwoJCQkJCQl9CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgIkRhdGVUaW1lIjoKCQkJCQljYXNlICJkYXRldGltZSI6CgkJCQkJCWlmIChhdHQpIHsKCQkJCQkJCSQoIiMiICsgdGhpcy5wcmVmaXgob0VsZW1lbnQpICsgb0VsZW1lbnQubmFtZSlbdGhpcy51aVR5cGVzW29FbGVtZW50LnR5cGVdXSgnc2V0VmFsdWUnLCAob1thdHRdID8gdGhpcy5zcigpLnRvRGF0ZVRpbWUob1thdHRdKSA6ICIiKSk7CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQkkKCIjIiArIHRoaXMucHJlZml4KG9FbGVtZW50KSArIG9FbGVtZW50Lm5hbWUpW3RoaXMudWlUeXBlc1tvRWxlbWVudC50eXBlXV0oJ3NldFZhbHVlJywgKG8gJiYgby5FbnRpdHlBdHRyaWJ1dGUpID8gIiIgOiAobyA/IHRoaXMuc3IoKS50b0RhdGVUaW1lKG8pIDogIiIpKTsKCQkJCQkJfQoJCQkJCQlicmVhazsKCQkJCQljYXNlICJib29sIjoKCQkJCQkJaWYgKGF0dCkgewoJCQkJCQkJJCgiIyIgKyB0aGlzLnByZWZpeChvRWxlbWVudCkgKyBvRWxlbWVudC5uYW1lKVt0aGlzLnVpVHlwZXNbb0VsZW1lbnQudHlwZV1dKChvW2F0dF0gPyAnJyA6ICd1bicpICsgJ2NoZWNrJyk7CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQkkKCIjIiArIHRoaXMucHJlZml4KG9FbGVtZW50KSArIG9FbGVtZW50Lm5hbWUpW3RoaXMudWlUeXBlc1tvRWxlbWVudC50eXBlXV0oKCgobyAmJiBvLkVudGl0eUF0dHJpYnV0ZSkgPyAiIiA6IG8pID8gJycgOiAndW4nKSArICdjaGVjaycpOwoJCQkJCQl9CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgIndpbmRvdyI6CgkJCQkJCWlmIChhdHQpIHsKCQkJCQkJCW9FbGVtZW50LnZhbHVlID0gb1thdHRdOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJb0VsZW1lbnQudmFsdWUgPSAobyAmJiBvLkVudGl0eUF0dHJpYnV0ZSkgPyAiIiA6IG87CgkJCQkJCX0KCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAicHJvZ3Jlc3MiOgoJCQkJCQl2YXIgdiA9IDA7CgkJCQkJCWlmIChhdHQpIHsKCQkJCQkJCXYgPSBvW2F0dF07CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQl2ID0gKG8gJiYgby5FbnRpdHlBdHRyaWJ1dGUpID8gIiIgOiBvOwoJCQkJCQl9CgkJCQkJCSQoIiMiICsgdGhpcy5wcmVmaXgob0VsZW1lbnQpICsgb0VsZW1lbnQubmFtZSlbdGhpcy51aVR5cGVzW29FbGVtZW50LnR5cGVdXSgnc2V0VmFsdWUnLCBNYXRoLnJvdW5kKHYgKiAxMCkgLyAxMCk7CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgImdyaWQiOgoJCQkJCQlsZXQgY29scyA9IEpTT04ucGFyc2UoInsiICsgdGhpcy5tYXBDb2x1bW5zKG9FbGVtZW50LCB0cnVlKSArICJ9Iik7CgkJCQkJCSQuZWFjaChjb2xzLmNvbHVtbnNbMF0sIChfLCBjKSA9PiBjLmZvcm1hdHRlciA9IHRoaXMuc3IoKS5ydW5TY3JpcHQodGhpcy5mb3JtYXR0ZXIob0VsZW1lbnQubmFtZSwgYykpKTsKCQkJCQkJJCgiIyIgKyB0aGlzLnByZWZpeChvRWxlbWVudCkgKyBvRWxlbWVudC5uYW1lKS5kYXRhZ3JpZChjb2xzKTsKCQkJCQkJaWYgKGF0dCkgewoJCQkJCQkJJCgiIyIgKyB0aGlzLnByZWZpeChvRWxlbWVudCkgKyBvRWxlbWVudC5uYW1lKS5kYXRhZ3JpZCh7CgkJCQkJCQkJZGF0YTogb1thdHRdCgkJCQkJCQl9KTsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCSQoIiMiICsgdGhpcy5wcmVmaXgob0VsZW1lbnQpICsgb0VsZW1lbnQubmFtZSkuZGF0YWdyaWQoewoJCQkJCQkJCWRhdGE6IChvICYmIG8uRW50aXR5QXR0cmlidXRlKSA/ICIiIDogbwoJCQkJCQkJfSk7CgkJCQkJCX0KCQkJCQkJJCgiIyIgKyB0aGlzLnByZWZpeChvRWxlbWVudCkgKyBvRWxlbWVudC5uYW1lKS5kYXRhZ3JpZCgidW5zZWxlY3RBbGwiKTsKCQkJCQkJJCgiIyIgKyB0aGlzLnByZWZpeChvRWxlbWVudCkgKyBvRWxlbWVudC5uYW1lKS5kYXRhZ3JpZCgpOwoJCQkJCQlicmVhazsKCQkJCQljYXNlICJ0cmVlIjoKCQkJCQkJdmFyIHYgPSBhdHQgPyBvW2F0dF0gOiAoKG8gJiYgby5FbnRpdHlBdHRyaWJ1dGUpID8gIiIgOiBvKTsKCQkJCQkJaWYgKEFycmF5LmlzQXJyYXkodikpIHsKCQkJCQkJCSQoIiMiICsgdGhpcy5wcmVmaXgob0VsZW1lbnQpICsgb0VsZW1lbnQubmFtZSlbdGhpcy51aVR5cGVzW29FbGVtZW50LnR5cGVdXSgidHJlZSIpLnRyZWUoImxvYWREYXRhIiwgdik7CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQkkKCIjIiArIHRoaXMucHJlZml4KG9FbGVtZW50KSArIG9FbGVtZW50Lm5hbWUpW3RoaXMudWlUeXBlc1tvRWxlbWVudC50eXBlXV0oJ3NldFZhbHVlJywgdik7CgkJCQkJCX0KCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAic2VsZWN0IjoKCQkJCQkJaWYgKGF0dCkgewoJCQkJCQkJaWYgKG9FbGVtZW50Lm9wdGlvbnMpIHsKCQkJCQkJCQkkKCIjIiArIHRoaXMucHJlZml4KG9FbGVtZW50KSArIG9FbGVtZW50Lm5hbWUpLmNvbWJvKCdzZXRWYWx1ZScgKyAob0VsZW1lbnQubXVsdGlwbGUgPyAncycgOiAnJyksIChvW2F0dF0gPyBvW2F0dF0gOiAiIikpOwoJCQkJCQkJCSQoIiMiICsgdGhpcy5wcmVmaXgob0VsZW1lbnQpICsgb0VsZW1lbnQubmFtZSkuY29tYm8oJ3NldFZhbHVlJyArIChvRWxlbWVudC5tdWx0aXBsZSA/ICdzJyA6ICcnKSwgKG9bYXR0XSA/IG9bYXR0XSA6ICIiKSk7CgkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCSQoIiMiICsgdGhpcy5wcmVmaXgob0VsZW1lbnQpICsgb0VsZW1lbnQubmFtZSkuY29tYm9ncmlkKCdzZXRWYWx1ZScgKyAob0VsZW1lbnQubXVsdGlwbGUgPyAncycgOiAnJyksIChvW2F0dF0gPyBvW2F0dF0gOiAiIikpOwoJCQkJCQkJfQoJCQkJCQl9IGVsc2UgewoJCQkJCQkJdiA9IG51bGw7CgkJCQkJCQlpZiAobyA9PT0gbnVsbCkgewoKCQkJCQkJCX0gZWxzZSBpZiAoby5jb25zdHJ1Y3RvciA9PT0gQXJyYXkpIHsKCgkJCQkJCQl9IGVsc2UgaWYgKCFvLkVudGl0eUF0dHJpYnV0ZSkgewoJCQkJCQkJCXYgPSBvIHx8IHsKCQkJCQkJCQkJSWQ6IG8uSWQsCgkJCQkJCQkJCV9Ub1N0cmluZzogby5fVG9TdHJpbmcsCgkJCQkJCQkJCXRvU3RyaW5nOiBmdW5jdGlvbigpIHsKCQkJCQkJCQkJCXJldHVybiB0aGlzLl9Ub1N0cmluZzsKCQkJCQkJCQkJfQoJCQkJCQkJCX07CgkJCQkJCQl9CgkJCQkJCQlpZiAob0VsZW1lbnQub3B0aW9ucykgewoJCQkJCQkJCSQoIiMiICsgdGhpcy5wcmVmaXgob0VsZW1lbnQpICsgb0VsZW1lbnQubmFtZSkuY29tYm8oJ3NldFZhbHVlJyArIChvRWxlbWVudC5tdWx0aXBsZSA/ICdzJyA6ICcnKSwgdik7CgkJCQkJCQkJJCgiIyIgKyB0aGlzLnByZWZpeChvRWxlbWVudCkgKyBvRWxlbWVudC5uYW1lKS5jb21ibygnc2V0VGV4dCcgKyAob0VsZW1lbnQubXVsdGlwbGUgPyAncycgOiAnJyksIHYpOwoJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQkkKCIjIiArIHRoaXMucHJlZml4KG9FbGVtZW50KSArIG9FbGVtZW50Lm5hbWUpLmNvbWJvZ3JpZCgnc2V0VmFsdWUnICsgKG9FbGVtZW50Lm11bHRpcGxlID8gJ3MnIDogJycpLCB2KTsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCQlicmVhazsKCQkJCQlkZWZhdWx0OgoJCQkJCQlicmVhazsKCQkJCX0KCQkJfSBjYXRjaCAoZXgpIHsKCQkJCWNvbnNvbGUubG9nKGV4KTsKCQkJfQoJCX0gZWxzZSB7CgkJCWZvciAodmFyIHAgaW4gbykgewoJCQkJaWYgKHAuaW5kZXhPZignXycpID09PSAwKSBwID0gcC5zdWJzdHJpbmcoMSk7CgkJCQl2YXIgZSA9IHRoaXMuYnlOYW1lKHApOwoJCQkJaWYgKCFlIHx8ICFlLm5hbWUpIGNvbnRpbnVlOwoJCQkJdmFyIHZhbHVlID0gb1twXTsKCQkJCWlmIChlLm5hbWUgPT0gdGhpcy5zVGFibGUpIHsKCQkJCQl2YWx1ZSA9IG87CgkJCQkJdmFsdWUuRGF0ZSA9IG5ldyBEYXRlKCk7CgkJCQl9CgkJCQlpZiAocCA9PSAiRW50aXR5VmFsdWVzIikgewoJCQkJCS8vIGFuIGVtc0Zvcm1WYWx1ZXMgc291cmNlCgkJCQkJLy8gZmluZCB0aGUgRW50aXR5VmFsdWUgZm9yIHRoaXMgZWxlbWVudCBhbmQgc2V0IGl0CgkJCQkJZm9yICh2YXIgaiA9IDA7IGogPCBvLkVudGl0eVZhbHVlcy5sZW5ndGg7IGorKykgewoJCQkJCQlpZiAoby5FbnRpdHlWYWx1ZXNbal0uRW50aXR5QXR0cmlidXRlLk5hbWUgPT0gZS5uYW1lKSB7CgkJCQkJCQkvLyBmb3VuZCB0aGUgRW50aXR5VmFsdWUgZm9yIHRoaXMgZWxlbWVudAoJCQkJCQkJX3YgPSBvLkVudGl0eVZhbHVlc1tqXTsKCQkJCQkJCWZvciAodmFyIHEgaW4gX3YpIHsKCQkJCQkJCQlpZiAocS5lbmRzV2l0aCgiVmFsdWUiKSkgewoJCQkJCQkJCQlfdltxXSA9IHZhbHVlOwoJCQkJCQkJCX0KCQkJCQkJCX0KCQkJCQkJCWJyZWFrOwoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQkJdGhpcy5zZXQodmFsdWUsIGUubmFtZSk7CgkJCX0KCQl9Cgl9CgoJZ2V0KCkgewoJCXZhciBvID0ge307CgkJaWYgKHRoaXMuc1RhYmxlICYmIHdpbmRvd1t0aGlzLnNUYWJsZV0pIG8gPSBuZXcgd2luZG93W3RoaXMuc1RhYmxlXSgpOwoJCWZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5lbGVtZW50cy5sZW5ndGg7IGkrKykgewoJCQl2YXIgY24gPSBudWxsOwoJCQl2YXIgdiA9IG51bGw7CgkJCXRyeSB7CgkJCQlzd2l0Y2ggKHRoaXMuZWxlbWVudHNbaV0udHlwZSkgewoJCQkJCWNhc2UgJ2xhYmVsJzoKCQkJCQkJY24gPSAkKCIjbGJsIiArIHRoaXMuZWxlbWVudHNbaV0ubmFtZSk7CgkJCQkJCXYgPSBjbi5odG1sKCk7CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgJ3RleHQnOgoJCQkJCWNhc2UgJ3N0cmluZyc6CgkJCQkJY2FzZSAnc2VhcmNoJzoKCQkJCQljYXNlICdwYXNzd29yZCc6CgkJCQkJCWNuID0gJCgiIyIgKyB0aGlzLnByZWZpeCh0aGlzLmVsZW1lbnRzW2ldKSArIHRoaXMuZWxlbWVudHNbaV0ubmFtZSk7CgkJCQkJCXYgPSBjbi52YWwoKTsKCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAiZmlsZSI6CgkJCQkJY2FzZSAiaW1hZ2UiOgoJCQkJCQljbiA9ICQoIiMiICsgdGhpcy5wcmVmaXgodGhpcy5lbGVtZW50c1tpXSkgKyB0aGlzLmVsZW1lbnRzW2ldLm5hbWUpOwoJCQkJCQl2ID0gdGhpcy5lbGVtZW50c1tpXS5kYXRhOwoJCQkJCQlicmVhazsKCQkJCQljYXNlICJEYXRlVGltZSI6CgkJCQkJY2FzZSAiZGF0ZXRpbWUiOgoJCQkJCQl2ID0gbmV3IERhdGUoJCgiIyIgKyB0aGlzLnByZWZpeCh0aGlzLmVsZW1lbnRzW2ldKSArIHRoaXMuZWxlbWVudHNbaV0ubmFtZSkuZGF0ZXRpbWVib3goJ2dldFZhbHVlJykpOwoJCQkJCQljbiA9ICQoIiMiICsgdGhpcy5wcmVmaXgodGhpcy5lbGVtZW50c1tpXSkgKyB0aGlzLmVsZW1lbnRzW2ldLm5hbWUpOwoJCQkJCQlicmVhazsKCQkJCQljYXNlICJwcm9ncmVzcyI6CgkJCQkJCWNuID0gJCgiIyIgKyB0aGlzLnByZWZpeCh0aGlzLmVsZW1lbnRzW2ldKSArIHRoaXMuZWxlbWVudHNbaV0ubmFtZSk7CgkJCQkJCXYgPSBjbi5wcm9ncmVzc2JhcignZ2V0VmFsdWUnKTsKCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAiaW50IjoKCQkJCQljYXNlICJpbnRlZ2VyIjoKCQkJCQljYXNlICJudW1iZXIiOgoJCQkJCWNhc2UgImxvbmciOgoJCQkJCWNhc2UgIkxvbmciOgoJCQkJCQljbiA9ICQoIiMiICsgdGhpcy5wcmVmaXgodGhpcy5lbGVtZW50c1tpXSkgKyB0aGlzLmVsZW1lbnRzW2ldLm5hbWUpOwoJCQkJCQl2ID0gcGFyc2VGbG9hdChjbi52YWwoKSk7CgkJCQkJCWlmIChpc05hTih2KSkgdiA9IDA7CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgImdyaWQiOgoJCQkJCQljbiA9ICQoIiMiICsgdGhpcy5wcmVmaXgodGhpcy5lbGVtZW50c1tpXSkgKyB0aGlzLmVsZW1lbnRzW2ldLm5hbWUpOwoJCQkJCQl2ID0gY24uZGF0YWdyaWQoJ2dldERhdGEnKTsKCQkJCQkJdi5zZWxlY3RlZCA9IGNuLmRhdGFncmlkKCJnZXRTZWxlY3RlZCIpOwoJCQkJCQlicmVhazsKCQkJCQljYXNlICJ0cmVlIjoKCQkJCQkJY24gPSAkKCIjIiArIHRoaXMucHJlZml4KHRoaXMuZWxlbWVudHNbaV0pICsgdGhpcy5lbGVtZW50c1tpXS5uYW1lKTsKCQkJCQkJdiA9IGNuLmNvbWJvdHJlZSgidHJlZSIpLnRyZWUoImdldFNlbGVjdGVkIik7CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgIndpbmRvdyI6CgkJCQkJCXYgPSB0aGlzLmVsZW1lbnRzW2ldLnZhbHVlOwoJCQkJCQlicmVhazsKCQkJCQljYXNlICJzZWxlY3QiOgoJCQkJCQlpZiAodGhpcy5lbGVtZW50c1tpXS5vcHRpb25zKSB7CgkJCQkJCQl2ID0gJCgiIyIgKyB0aGlzLnByZWZpeCh0aGlzLmVsZW1lbnRzW2ldKSArIHRoaXMuZWxlbWVudHNbaV0ubmFtZSkuY29tYm9ncmlkKCdnZXRWYWx1ZScgKyAodGhpcy5lbGVtZW50c1tpXS5tdWx0aXBsZSA/ICdzJyA6ICcnKSk7CgkJCQkJCQl2ID0gdGhpcy5zcigpLnJ1blNjcmlwdCh2KTsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCXYgPSAkKCIjIiArIHRoaXMucHJlZml4KHRoaXMuZWxlbWVudHNbaV0pICsgdGhpcy5lbGVtZW50c1tpXS5uYW1lKS5jb21ib2dyaWQoJ2dyaWQnKS5kYXRhZ3JpZCgnZ2V0U2VsZWN0aW9ucycpOwoJCQkJCQkJaWYgKCF2IHx8ICF2Lmxlbmd0aCkgewoJCQkJCQkJCXYgPSAkKCIjIiArIHRoaXMucHJlZml4KHRoaXMuZWxlbWVudHNbaV0pICsgdGhpcy5lbGVtZW50c1tpXS5uYW1lKS5jb21ib2dyaWQoJ2dldFZhbHVlJyArICh0aGlzLmVsZW1lbnRzW2ldLm11bHRpcGxlID8gJ3MnIDogJycpKTsKCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJaWYgKCF0aGlzLmVsZW1lbnRzW2ldLm11bHRpcGxlKSB2ID0gdlswXTsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCQljbiA9ICQoIiMiICsgdGhpcy5wcmVmaXgodGhpcy5lbGVtZW50c1tpXSkgKyB0aGlzLmVsZW1lbnRzW2ldLm5hbWUpOwoJCQkJCQlicmVhazsKCQkJCQljYXNlICJib29sIjoKCQkJCQkJY24gPSAkKCIjIiArIHRoaXMucHJlZml4KHRoaXMuZWxlbWVudHNbaV0pICsgdGhpcy5lbGVtZW50c1tpXS5uYW1lKTsKCQkJCQkJdiA9IGNuLnN3aXRjaGJ1dHRvbignb3B0aW9ucycpLmNoZWNrZWQ7CgkJCQkJCWJyZWFrOwoJCQkJCWRlZmF1bHQ6CgkJCQkJCWJyZWFrOwoJCQkJfQoJCQkJb1t0aGlzLmVsZW1lbnRzW2ldLm5hbWVdKHYpOwoJCQl9IGNhdGNoIChlKSB7CgkJCQkvL2NvbnNvbGUubG9nKHRoaXMuZWxlbWVudHNbaV0ubmFtZSwgZSk7CgkJCQlvW3RoaXMuZWxlbWVudHNbaV0ubmFtZV0gPSB2OwoJCQl9CgkJCWlmIChjbikgewoJCQkJaWYgKG8uRW50aXR5VmFsdWVzKSB7CgkJCQkJZm9yICh2YXIgaiA9IDA7IGogPCBvLkVudGl0eVZhbHVlcy5sZW5ndGg7IGorKykgewoJCQkJCQlpZiAodGhpcy5lbGVtZW50c1tpXS5uYW1lID09IHRoaXMuc1RhYmxlICYmIHRoaXMuZWxlbWVudHNbaV0uZW1zU291cmNlKSBvLklkID0gdGhpcy5lbGVtZW50c1tpXS5lbXNTb3VyY2UuSWQ7CgkJCQkJCWlmIChvLkVudGl0eVZhbHVlc1tqXS5FbnRpdHlBdHRyaWJ1dGUuTmFtZSA9PSB0aGlzLmVsZW1lbnRzW2ldLm5hbWUgJiYgdGhpcy5lbGVtZW50c1tpXS5lbXNTb3VyY2UpIHsKCQkJCQkJCW8uRW50aXR5VmFsdWVzW2pdLklkID0gdGhpcy5lbGVtZW50c1tpXS5lbXNTb3VyY2UuSWQ7CgkJCQkJCX0KCQkJCQl9CgkJCQl9CgkJCX0KCQl9CgkJcmV0dXJuIG87Cgl9CgoJY0hlaWdodChvcHRpb25zKSB7CgkJaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5lZGl0b3IpIHJldHVybiB3aW5kb3cuaW5uZXJIZWlnaHQ7CgkJaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5oZWlnaHQgJiYgdHlwZW9mKG9wdGlvbnMuaGVpZ2h0KSA9PT0gJ3N0cmluZycpIHJldHVybiB0aGlzLmhlaWdodDsKCQlpZiAob3B0aW9ucyAmJiBvcHRpb25zLnR5cGUgPT0gJ3dpbmRvdycgJiYgIW9wdGlvbnMuaGVpZ2h0KSByZXR1cm4gdGhpcy5oZWlnaHQgKiAwLjk7CgkJcmV0dXJuIE1hdGguZmxvb3IoKChvcHRpb25zID8gb3B0aW9ucy5oZWlnaHQgOiBudWxsKSB8fCAodGhpcy5oZWlnaHQgLyAzKSkpOwoJfQoKCXNlYXJjaChvcHRpb25zKSB7CgkJcmV0dXJuIHRoaXMuc3RyaW5nKG9wdGlvbnMpOwoJfQoKCXN0cmluZyhvcHRpb25zKSB7CgkJb3B0aW9ucy5oZWlnaHQgPSAyMDsKCQlvcHRpb25zLnNpbXBsZSA9IHRydWU7CgkJcmV0dXJuIHRoaXMudGV4dChvcHRpb25zKTsKCX0KCglkYXRldGltZShvcHRpb25zKSB7CgkJcmV0dXJuIGA8aW5wdXQgaWQ9ImR0cCR7b3B0aW9ucy5uYW1lfSIgY2xhc3M9ImVhc3l1aS0ke3RoaXMudWlUeXBlc1tvcHRpb25zLnR5cGVdfSIgcmVxdWlyZWQ9IiR7b3B0aW9ucy5yZXF1aXJlZCA/ICd0cnVlJyA6ICdmYWxzZSd9IiB2YWx1ZT0iJHt0aGlzLnZhbHVlKG9wdGlvbnMpfSIgc3R5bGU9IndpZHRoOiR7dGhpcy5jV2lkdGgob3B0aW9ucyl9cHgiPmA7Cgl9CgoJcXVlcnkob3B0aW9ucykgewoJCXJldHVybiAiPGRpdiBpZD0ndnMiICsgb3B0aW9ucy5uYW1lICsgIic+PC9kaXY+IjsKCX0KCglEYXRlVGltZShvcHRpb25zKSB7CgkJcmV0dXJuIHRoaXMuZGF0ZXRpbWUob3B0aW9ucyk7Cgl9CgoJbG9uZyhvcHRpb25zKSB7CgkJcmV0dXJuIHRoaXMuaW50KG9wdGlvbnMpOwoJfQoKCUxvbmcob3B0aW9ucykgewoJCXJldHVybiB0aGlzLmxvbmcob3B0aW9ucyk7Cgl9CgoJdmFsdWUob3B0aW9ucykgewoJCWlmICh0eXBlb2Ygb3B0aW9ucy52YWx1ZSA9PT0gJ2Z1bmN0aW9uJykgewoJCQl0cnkgewoJCQkJcmV0dXJuIG9wdGlvbnMudmFsdWUodGhpcy5nZXQoKSk7CgkJCX0gY2F0Y2ggKGV4KSB7CgkJCQljb25zb2xlLmxvZyhgREZvcm0udmFsdWUoJHtvcHRpb25zLm5hbWV9KTogJHtleH1gKTsKCQkJCXJldHVybiAnJzsKCQkJfQoJCX0gZWxzZSB7CgkJCXN3aXRjaCAob3B0aW9ucy50eXBlKSB7CgkJCQljYXNlICdpbnQnOgoJCQkJY2FzZSAncHJvZ3Jlc3MnOgoJCQkJCXJldHVybiBvcHRpb25zLnZhbHVlIHx8IG9wdGlvbnMubWluIHx8IDA7CgkJCQljYXNlICdzdHJpbmcnOgoJCQkJY2FzZSAndGV4dCc6CgkJCQljYXNlICdkYXRldGltZSc6CgkJCQljYXNlICdsYWJlbCc6CgkJCQkJcmV0dXJuIG9wdGlvbnMudmFsdWUgfHwgIiI7CgkJCQlkZWZhdWx0OgoJCQkJCXJldHVybiBvcHRpb25zLnZhbHVlOwoJCQl9CgkJfQoJfQoKCWludChvcHRpb25zKSB7CgkJbGV0IHJldCA9IGA8aW5wdXQgaWQ9Im51ZCR7b3B0aW9ucy5uYW1lfSIgY2xhc3M9ImVhc3l1aS0ke3RoaXMudWlUeXBlc1tvcHRpb25zLnR5cGVdfSIgcmVxdWlyZWQ9IiR7b3B0aW9ucy5yZXF1aXJlZCA/ICd0cnVlJyA6ICdmYWxzZSd9IiB2YWx1ZT0iJHt0aGlzLnZhbHVlKG9wdGlvbnMpfSIgZGF0YS1vcHRpb25zPSJtaW46JHtvcHRpb25zLm1pbiB8fCAwfSxtYXg6JHtvcHRpb25zLm1heCB8fCAxMDB9LGluY3JlbWVudDoke29wdGlvbnMuaW5jcmVtZW50IHx8IDF9IiBzdHlsZT0id2lkdGg6JHt0aGlzLmNXaWR0aChvcHRpb25zKX1weDsiPjwvaW5wdXQ+YDsKCQkvL2NvbnNvbGUubG9nKHJldCk7CgkJcmV0dXJuIHJldDsKCX0KCgltZW51KG9wdGlvbnMpIHsKCQl2YXIgcmV0ID0gIiI7CgkJcmV0ICs9ICc8ZGl2IGNsYXNzPSJlYXN5dWktcGFuZWwiIGlkPSJtbnUnICsgb3B0aW9ucy5uYW1lICsgJyIgc3R5bGU9InBhZGRpbmc6NXB4OyI+XG4nOwoJCSQuZWFjaChvcHRpb25zLm1lbnUsIChfLCBtKSA9PiByZXQgKz0gYDxhIGhyZWY9IiMiIGNsYXNzPSJlYXN5dWktJHt0aGlzLnVpVHlwZXNbb3B0aW9ucy50eXBlIHx8ICdtZW51J119IiBkYXRhLW9wdGlvbnM9Im1lbnU6JyNtbSR7bS5sYWJlbC5yZXBsYWNlKC8gL2csICcnKX0nLGljb25DbHM6J2ljb24tJHttLmljb24gfHwgJ25vbmUnfSciPiR7bS5sYWJlbH08L2E+XG5gKTsKCQlyZXQgKz0gIjwvZGl2PlxuIjsKCQlsZXQgZHYgPSBtID0+IHsKCQkJbGV0IHJldCA9ICc8ZGl2JyArIChtLnN1Yk1lbnVzID8gJycgOiBgIGRhdGEtb3B0aW9ucz0iaWNvbkNsczonaWNvbi0ke20uaWNvbiB8fCAnbm9uZSd9JyJgKSArICc+XG4nOwoJCQlyZXQgKz0gbS5zdWJNZW51cyA/ICc8c3Bhbj4nICsgKG0ubGFiZWwgfHwgdGhpcy5lbmdsaXNoKG0uY29kZSkpICsgJzwvc3Bhbj5cbjxkaXY+JyA6IChgPHNwYW4gd2lkdGg9JzEwMCUnIG9uY2xpY2s9Jyhhc3luYyAoKSA9PiB7bGV0IG0gPSAke19GckVNRC5fdG9KUyhtKX07IGlmKG0uYWN0aW9uKXtyZXR1cm4gYXdhaXQgbS5hY3Rpb24oREZvcm0uZ2V0KCksIG0pO30gaWYgKG0uc3ViTWVudXMpIHJldHVybjsgYXdhaXQgX0ZyRU1ELlJlbmRlclBhZ2Uoe19jb2RlOiBtLmNvZGUgfHwgbS5sYWJlbC5yZXBsYWNlKC8gL2csICIiKS50b0xvd2VyQ2FzZSgpfSwgbS5kYXRhKTt9KSgpJz4ke20ubGFiZWwgfHwgdGhpcy5lbmdsaXNoKG0uY29kZSl9PC9zcGFuPmApOwoJCQkkLmVhY2gobS5zdWJNZW51cywgKF8sIHMpID0+IHJldCArPSBkdihzKSk7CgkJCXJldCArPSAobS5zdWJNZW51cyA/ICI8L2Rpdj5cbiIgOiAiIikgKyBgPC9kaXY+XG5gOwoJCQlyZXR1cm4gcmV0OwoJCX07CgkJZm9yICh2YXIgaSA9IDA7IGkgPCBvcHRpb25zLm1lbnUubGVuZ3RoOyBpKyspIHsKCQkJdmFyIG0gPSBvcHRpb25zLm1lbnVbaV07CgkJCXJldCArPSAnPGRpdiBpZD0ibW0nICsgbS5sYWJlbC5yZXBsYWNlKC8gL2csICcnKSArICciIHN0eWxlPSJ3aWR0aDoxNTBweDsiPic7CgkJCWZvciAodmFyIGogPSAwOyBqIDwgbS5zdWJNZW51cy5sZW5ndGg7IGorKykgewoJCQkJdmFyIHNtID0gbS5zdWJNZW51c1tqXTsKCQkJCXJldCArPSBkdihzbSk7CgkJCX0KCQkJcmV0ICs9ICc8L2Rpdj5cbic7CgkJfQoJCXJldHVybiByZXQ7Cgl9CgoJaW50ZWdlcihvcHRpb25zKSB7CgkJcmV0dXJuIHRoaXMuaW50KG9wdGlvbnMpOwoJfQoKCW51bWJlcihvcHRpb25zKSB7CgkJcmV0dXJuIHRoaXMuaW50KG9wdGlvbnMpOwoJfQoKCUludGVnZXIob3B0aW9ucykgewoJCXJldHVybiB0aGlzLmludChvcHRpb25zKTsKCX0KCglib29sKG9wdGlvbnMpIHsKCQlyZXR1cm4gYDxpbnB1dCBpZD0iJHt0aGlzLnByZWZpeChvcHRpb25zKX0ke29wdGlvbnMubmFtZX0iIGRhdGEtZGZvcm09ImVsZW1lbnQ6JHtvcHRpb25zLm5hbWV9IiByZXF1aXJlZD0iJHtvcHRpb25zLnJlcXVpcmVkPyd0cnVlJzonZmFsc2UnfSIgZGF0YS1vcHRpb25zPSdkaXNhYmxlZDoke29wdGlvbnMuZGlzYWJsZWQ/J3RydWUnOidmYWxzZSd9LCR7dGhpcy5ldmVudEhhbmRsZXJzKG9wdGlvbnMpfScgY2xhc3M9ImVhc3l1aS0ke3RoaXMudWlUeXBlc1tvcHRpb25zLnR5cGVdfSIgJHtvcHRpb25zLmNoZWNrZWQ/J2NoZWNrZWQnOicnfSAvPmA7Cgl9CgoJbGFiZWwob3B0aW9ucykgewoJCXJldHVybiBgPHNwYW4gaWQ9IiR7dGhpcy5wcmVmaXgob3B0aW9ucyl9JHtvcHRpb25zLm5hbWV9IiBzdHlsZT0id2lkdGg6JHt0aGlzLmNXaWR0aChvcHRpb25zKX1weCIgZGF0YS1vcHRpb25zPSJkaXNhYmxlZDoke29wdGlvbnMuZGlzYWJsZWQ/J3RydWUnOidmYWxzZSd9Ij4ke3RoaXMudmFsdWUob3B0aW9ucyl9PC9zcGFuPmA7Cgl9CgoJdXJsKG9wdGlvbnMpIHsKCQlyZXR1cm4gdGhpcy5zdHJpbmcob3B0aW9ucykucmVwbGFjZSgiRmllbGRDaGFuZ2UiLCAiVVJMQ2hhbmdlIik7Cgl9CgoJdGV4dChvcHRpb25zKSB7CgkJcmV0dXJuIGA8aW5wdXQgaWQ9IiR7dGhpcy5wcmVmaXgob3B0aW9ucyl9JHtvcHRpb25zLm5hbWV9IiBjbGFzcz0iZWFzeXVpLSR7b3B0aW9ucy5lZGl0b3IgfHwgdGhpcy51aVR5cGVzW29wdGlvbnMudHlwZV19IiBkYXRhLW9wdGlvbnM9J2Rpc2FibGVkOiR7b3B0aW9ucy5kaXNhYmxlZD8ndHJ1ZSc6J2ZhbHNlJ30sJHt0aGlzLmV2ZW50SGFuZGxlcnMob3B0aW9ucyl9JyBtdWx0aWxpbmU9IiR7b3B0aW9ucy5zaW1wbGUgPyAnZmFsc2UnIDogJ3RydWUnfSIgc3R5bGU9IndoaXRlLXNwYWNlOnByZS13cmFwO3dpZHRoOiR7dGhpcy5jV2lkdGgob3B0aW9ucyl9cHg7aGVpZ2h0OiR7dGhpcy5jSGVpZ2h0KG9wdGlvbnMpfXB4IiByZXF1aXJlZD0iJHtvcHRpb25zLnJlcXVpcmVkID8gJ3RydWUnIDogJ2ZhbHNlJ30iIHZhbHVlPSIke3RoaXMudmFsdWUob3B0aW9ucyl9IiAvPmA7Cgl9CgoJcGFzc3dvcmQob3B0aW9ucykgewoJCXZhciByZXQgPSB0aGlzLnN0cmluZyhvcHRpb25zKTsKCQlyZXQgPSByZXQucmVwbGFjZSgnPGlucHV0ICcsICc8aW5wdXQgdHlwZT0icGFzc3dvcmQiICcpOwoJCXJldHVybiByZXQ7Cgl9CgoJZmlsZShvcHRpb25zKSB7CgkJcmV0dXJuIGA8aW5wdXQgaWQ9IiR7dGhpcy5wcmVmaXgob3B0aW9ucyl9JHtvcHRpb25zLm5hbWV9IiBjbGFzcz0iZWFzeXVpLSR7dGhpcy51aVR5cGVzW29wdGlvbnMudHlwZV19IiBkYXRhLW9wdGlvbnM9Im9uQ2hhbmdlOmZ1bmN0aW9uKG4sbyl7dmFyIHMgPSAkKCcjJyArIHRoaXMuaWQpLmZpbGVib3goJ29wdGlvbnMnKTsgdGhpcy5VcGxvYWRGaWxlKHMsIHRoaXMuYnlOYW1lKCcke29wdGlvbnMubmFtZX0nKSk7fSIgc3R5bGU9IndpZHRoOiR7dGhpcy5jV2lkdGgob3B0aW9ucyl9cHgiPmA7Cgl9CgoJaW1hZ2Uob3B0aW9ucykgewoJCXJldHVybiB0aGlzLmZpbGUob3B0aW9ucykgKyBgPGRpdiBpZD0iZGxnJHtvcHRpb25zLm5hbWV9IiBjbGFzcz0iZWFzeXVpLSR7dGhpcy51aVR5cGVzW29wdGlvbnMudHlwZV19IiB0aXRsZT0iSW1hZ2UgUHJldmlldyIgZGF0YS1vcHRpb25zPSJjbG9zZWQ6dHJ1ZSxpY29uQ2xzOidpY29uLXNhdmUnLHJlc2l6YWJsZTpmYWxzZSxtb2RhbDp0cnVlIiBzdHlsZT0id2lkdGg6NDAwcHg7aGVpZ2h0OjIwMHB4O3BhZGRpbmc6MTBweCI+PGltZyBpZD0iJHt0aGlzLnByZWZpeChvcHRpb25zKX0ke29wdGlvbnMubmFtZX0iIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiLz48L2Rpdj5gOwoJfQoKCXByb2dyZXNzKG9wdGlvbnMpIHsKCQlpZiAoIW9wdGlvbnMuaGVpZ2h0KSBvcHRpb25zLmhlaWdodCA9IDIwOyAvLyBmaXggYmlnIHByb2dyZXNzCgkJcmV0dXJuIGA8ZGl2IGlkPSIke3RoaXMucHJlZml4KG9wdGlvbnMpfSR7b3B0aW9ucy5uYW1lfSIgY2xhc3M9ImVhc3l1aS0ke3RoaXMudWlUeXBlc1tvcHRpb25zLnR5cGVdfSIgZGF0YS1vcHRpb25zPSJ2YWx1ZToke3RoaXMudmFsdWUob3B0aW9ucyl9IiBzdHlsZT0id2lkdGg6JHt0aGlzLmNXaWR0aChvcHRpb25zKX1weDtoZWlnaHQ6JHt0aGlzLmNIZWlnaHQob3B0aW9ucyl9cHgiPjwvZGl2PmA7Cgl9CgoJZmxvd2NoYXJ0KG9wdGlvbnMpIHsKCQlyZXR1cm4gYDxkaXYgaWQ9ImZsdyR7b3B0aW9ucy5uYW1lfSIgd2lkdGg9IiR7dGhpcy5jV2lkdGgob3B0aW9ucyl9IiBoZWlnaHQ9IiR7dGhpcy5jSGVpZ2h0KG9wdGlvbnMpfSI+PC9kaXY+YDsKCX0KCgljaGFydChvcHRpb25zKSB7CgkJcmV0dXJuIGA8ZGl2IGlkPSJjaHQke29wdGlvbnMubmFtZX0iIHdpZHRoPSIke3RoaXMuY1dpZHRoKG9wdGlvbnMpfSIgaGVpZ2h0PSIke3RoaXMuY0hlaWdodChvcHRpb25zKX0iPjwvZGl2PmA7Cgl9CgoJZm9ybWF0dGVyKG5hbWUsIGMsIGpzb24pIHsKCQlqc29uID0ganNvbiA/ICciJyA6ICcnOwoJCXJldHVybiBgJHtqc29ufSh2YWx1ZSwgcm93LCBpbmRleCkgPT4ge3RyeXt2YXIgYyA9IChERm9ybS5ieU5hbWUoXGAke25hbWV9XGApLmNvbHVtbnMgfHwgW10pLmZpbmQoYyA9PiBjLmZpZWxkPT1cYCR7Yy5maWVsZH1cYCk7IHJldHVybiBjJiZjLmZvcm1hdD9jLmZvcm1hdCh2YWx1ZSxyb3csaW5kZXgpOnZhbHVlO31jYXRjaChleCl7cmV0dXJuIHZhbHVlO30gfSR7anNvbn1gOwoJfQoKCW1hcENvbHVtbnMob3B0aW9ucywganNvbikgewoJCWxldCBjVGl0bGUgPSBjID0+IGMudGl0bGUgfHwgdGhpcy5lbmdsaXNoKGMuZmllbGQpOwoKCQl2YXIgY29scyA9ICQuZ3JlcChvcHRpb25zLmNvbHVtbnMgfHwgW10sIGMgPT4gIWMuaWdub3JlKTsKCQlsZXQgcmV0ID0gIiI7CgkJaWYgKG9wdGlvbnMubXVsdGlwbGUpIHJldCArPSBgeyJmaWVsZCI6J2NrJywiY2hlY2tib3giOnRydWV9LGA7CgkJcmV0ID0gYCJmcm96ZW5Db2x1bW5zIjogW1tgOwoJCWlmICghb3B0aW9ucy5mcm96ZW4pIHsKCQkJcmV0ICs9IGB7ImZpZWxkIjoiJHtvcHRpb25zLmlkRmllbGQuZmllbGR9IiwidGl0bGUiOiAiJHtvcHRpb25zLmlkRmllbGQudGl0bGV9Iiwic29ydGFibGUiOiAidHJ1ZSIsICJmb3JtYXR0ZXIiOiAke3RoaXMuZm9ybWF0dGVyKG9wdGlvbnMubmFtZSwgb3B0aW9ucy5pZEZpZWxkLCBqc29uKX19LGA7CgkJCWlmIChvcHRpb25zLnRleHRGaWVsZC5maWVsZCAhPSBvcHRpb25zLmlkRmllbGQuZmllbGQpIHJldCArPSBgeyJmaWVsZCI6IiR7b3B0aW9ucy50ZXh0RmllbGQuZmllbGQgfHwgb3B0aW9ucy50ZXh0RmllbGQudGl0bGV9IiwidGl0bGUiOiIke29wdGlvbnMudGV4dEZpZWxkLnRpdGxlIHx8IG9wdGlvbnMudGV4dEZpZWxkLmZpZWxkfSIsIndpZHRoIjoiJHtvcHRpb25zLnRleHRGaWVsZC53aWR0aHx8MTIwfSIsICJzb3J0YWJsZSI6ICJ0cnVlIiwgImZvcm1hdHRlciI6ICR7dGhpcy5mb3JtYXR0ZXIob3B0aW9ucy5uYW1lLCBvcHRpb25zLnRleHRGaWVsZCwganNvbil9fWA7CgkJfSBlbHNlIHsKCQkJJC5tYXAoJC5ncmVwKGNvbHMsIGMgPT4gYy5mcm96ZW4pLCBjID0+IGB7ImZpZWxkIjoiJHtjLmZpZWxkIHx8IGNUaXRsZShjKX0iLCJ0aXRsZSI6IiR7Y1RpdGxlKGMpIHx8IGMuZmllbGR9Iiwid2lkdGgiOiIke2Mud2lkdGh8fDEyMH0iLCJhbGlnbiI6J2xlZnQnLCJzb3J0YWJsZSI6InRydWUiLCAiZm9ybWF0dGVyIjogJHt0aGlzLmZvcm1hdHRlcihvcHRpb25zLm5hbWUsIGMsIGpzb24pfX1gKS5qb2luKCIsIik7CgkJfQoJCXJldCArPSBgXV0sICJjb2x1bW5zIjogW1tgOwoJCXJldCArPSAkLm1hcCgkLmdyZXAoY29scywgYyA9PiAhYy5mcm96ZW4pLCBjID0+IGB7ImZpZWxkIjoiJHtjLmZpZWxkIHx8IGNUaXRsZShjKX0iLCJ0aXRsZSI6IiR7Y1RpdGxlKGMpIHx8IGMuZmllbGR9IiwiYWxpZ24iOiJsZWZ0Iiwic29ydGFibGUiOiJ0cnVlIiwgImZvcm1hdHRlciI6ICR7dGhpcy5mb3JtYXR0ZXIob3B0aW9ucy5uYW1lLCBjLCBqc29uKX19YCkuam9pbigiLCIpOwoJCXJldCArPSAnXV0nOwoJCXJldHVybiByZXQ7Cgl9CgoJc2VsZWN0KG9wdGlvbnMsIHRhZyA9IG9wdGlvbnMudGFnLCB0eXBlKSB7CgkJcmV0dXJuIHRoaXMuY29tYm8ob3B0aW9ucywgdGFnLCB0eXBlKTsKCX0KCgl0cmVlKG9wdGlvbnMpIHsKCQlyZXR1cm4gdGhpcy5zZWxlY3Qob3B0aW9ucywgInNlbGVjdCIpOwoJfQoKCW5hdmlnYXRpb24ob3B0aW9ucykgewoJCXJldHVybiB0aGlzLmNvbWJvKG9wdGlvbnMsICd1bCcsICd0cmVlJyk7Cgl9CgoJY29tYm8ob3B0aW9ucywgdGFnLCB0eXBlKSB7CgkJdmFyIGNvbHMgPSAkLmdyZXAob3B0aW9ucy5jb2x1bW5zIHx8IFtdLCBjID0+ICFjLmlnbm9yZSk7CgkJdGFnID0gdGFnIHx8ICJzZWxlY3QiOwoJCW9wdGlvbnMuaWRGaWVsZCA9ICQudW5pcXVlU29ydChbewoJCQlmaWVsZDogb3B0aW9ucy5pZEZpZWxkLAoJCQl0aXRsZTogb3B0aW9ucy5pZEZpZWxkCgkJfV0uY29uY2F0KCQuZ3JlcChjb2xzLCBjID0+IGMucHJpbWFyeSksIFt7CgkJCWZpZWxkOiAnSWQnLAoJCQl0aXRsZTogJ0lEJwoJCX1dKSkuZmluZCh4ID0+IHR5cGVvZih4LmZpZWxkKSAhPT0gInVuZGVmaW5lZCIpOwoJCW9wdGlvbnMudGV4dEZpZWxkID0gJC51bmlxdWVTb3J0KFt7CgkJCWZpZWxkOiBvcHRpb25zLnRleHRGaWVsZCwKCQkJdGl0bGU6IG9wdGlvbnMudGV4dEZpZWxkCgkJfV0uY29uY2F0KCQuZ3JlcChjb2xzLCBjID0+IGMuZGlzcGxheSksIFt7CgkJCWZpZWxkOiAnX1RvU3RyaW5nJywKCQkJdGl0bGU6IG9wdGlvbnMubmFtZSwKCQl9XSkpLmZpbmQoeCA9PiB0eXBlb2YoeC5maWVsZCkgIT09ICJ1bmRlZmluZWQiKTsKCQl2YXIgZnVuID0gdHlwZSB8fCB0aGlzLmVGdW4ob3B0aW9ucyk7CgkJdmFyIGRyb3Bkb3duID0gWydjb21ib3RyZWVncmlkJywgJ2NvbWJvdHJlZScsICdjb21ib2dyaWQnLCAnc2VsZWN0J10uaW5kZXhPZihmdW4pID4gLTE7CgkJaWYgKGRyb3Bkb3duKSB0aGlzLnNlbGVjdHMucHVzaCh7CgkJCWlkOiAiY21iIiArIG9wdGlvbnMubmFtZSwKCQkJb3B0aW9uczogdGhpcy5ieU5hbWUob3B0aW9ucy5uYW1lKQoJCX0pOwoJCXRoaXMuc2VsZWN0cyA9ICQudW5pcXVlU29ydCh0aGlzLnNlbGVjdHMpOwoJCXZhciByZXQgPSBgPCR7dGFnfSBpZD0iY21iJHtvcHRpb25zLm5hbWV9IiBjbGFzcz0iZWFzeXVpLSR7ZnVufSIgc3R5bGU9Im1heC13aWR0aDoke2Ryb3Bkb3duPyc0MDBweCc6dGhpcy5jV2lkdGgob3B0aW9ucyl9OyB3aWR0aDoke3RoaXMuY1dpZHRoKG9wdGlvbnMpfXB4IiByZXF1aXJlZD0iJHsob3B0aW9ucy5yZXF1aXJlZCA/ICd0cnVlJyA6ICdmYWxzZScpfSIgZGF0YS1vcHRpb25zPSdkaXNhYmxlZDoke29wdGlvbnMuZGlzYWJsZWQ/J3RydWUnOidmYWxzZSd9LCR7dGhpcy5ldmVudEhhbmRsZXJzKG9wdGlvbnMpfSwgdmFsdWU6IiR7dGhpcy52YWx1ZShvcHRpb25zKX0iLCByb3dudW1iZXJzOiR7dHlwZW9mKG9wdGlvbnMucm93TnVtYmVycykhPT0ndW5kZWZpbmVkJz9vcHRpb25zLnJvd051bWJlcnM6KGZ1bi5pbmRleE9mKCd0cmVlJyk8LTE/J2ZhbHNlJzondHJ1ZScpfSwgcGFnaW5hdGlvbjoke3R5cGVvZihvcHRpb25zLnBhZ2luYXRpb24pIT09J3VuZGVmaW5lZCc/b3B0aW9ucy5wYWdpbmF0aW9uOihmdW4uaW5kZXhPZigndHJlZScpPC0xPydmYWxzZSc6J3RydWUnKX0sIHBhbmVsV2lkdGg6JHsyKnRoaXMuY1dpZHRoKG9wdGlvbnMpfSwgZml0Q29sdW1uczogdHJ1ZSwgc2luZ2xlU2VsZWN0OiB0cnVlLCBtdWx0aXBsZTokeyhvcHRpb25zLm11bHRpcGxlIHx8ICdmYWxzZScpfSwgaWRGaWVsZDogIiR7b3B0aW9ucy5pZEZpZWxkLmZpZWxkfSIsIGVuYWJsZUZpbHRlcjogJHtvcHRpb25zLmZpbHRlcj8ndHJ1ZSc6J2ZhbHNlJ30sIG5vd3JhcDogZmFsc2UsIHRleHRGaWVsZDogIiR7b3B0aW9ucy50ZXh0RmllbGQuZmllbGR9IiwgdHJlZUZpZWxkOiAiJHtvcHRpb25zLnRleHRGaWVsZC5maWVsZH0iLGA7CgkJaWYgKGZ1bi5pbmRleE9mKCd0cmVlJykgPT0gLTEpIHsKCQkJcmV0ICs9ICdmaXRDb2x1bW5zOiBmYWxzZSwnICsgdGhpcy5tYXBDb2x1bW5zKG9wdGlvbnMpOwoJCX0KCQlpZiAob3B0aW9ucy5kYXRhKSB7CgkJCXJldCArPSBgLGRhdGE6ICR7SlNPTi5zdHJpbmdpZnkob3B0aW9ucy5kYXRhKX1gOwoJCX0KCQlyZXQgKz0gYCc+YDsKCQlpZiAob3B0aW9ucy5vcHRpb25zKSB7CgkJCXJldCArPSAkLm1hcChvcHRpb25zLm9wdGlvbnMsIG8gPT4gYDxvcHRpb24gdmFsdWU9JyR7X0ZyRU1ELl90b0pTKG8pfSc+JHtvLm5hbWUgfHwgb308L29wdGlvbj5gKS5qb2luKCdcbicpOwoJCX0KCQlyZXQgKz0gYDwvJHt0YWd9PmA7CgkJLy8gY29uc29sZS5sb2cocmV0KTsKCQlyZXR1cm4gcmV0OwoJfQoKCWdyaWQob3B0aW9ucywgdGFnLCB0eXBlKSB7CgkJcmV0dXJuIHRoaXMuY29tYm8ob3B0aW9ucywgInRhYmxlIiwgImRhdGFncmlkIik7Cgl9CgoJdHJlZWdyaWQob3B0aW9ucykgewoJCXJldHVybiB0aGlzLmNvbWJvKG9wdGlvbnMsICd0YWJsZScsICd0cmVlJyk7Cgl9CgoJYXN5bmMgZG9MaW5rKGUsIGV2ZW50KSB7CgkJdGhpcy5idXN5KHRydWUpOwoJCXRyeSB7CgkJCWF3YWl0IGUubGlua3MuZmluZChsID0+IGwubGFiZWwgPT0gZXZlbnQudGFyZ2V0LmlubmVyVGV4dCkub25DbGljayh0aGlzLmdldCgpKTsKCQl9IGNhdGNoIChleCkgewoJCQljb25zb2xlLmxvZygiZG9MaW5rIiwgZXgpOwoJCX0KCQl0aGlzLmJ1c3koZmFsc2UpOwoJfQoKCUVkaXRlZFZhbHVlKGUpIHsKCQlyZXR1cm4gKHR5cGVvZihhY2UpICE9PSAidW5kZWZpbmVkIikgPyBhY2UuZWRpdCgncG5sJyArIGUubmFtZSkuc2Vzc2lvbi5nZXRWYWx1ZSgpIDogJyc7Cgl9CgoJYXN5bmMgUGFuT25DbG9zZShlKSB7CgkJaWYgKGUuZWRpdG9yKSB7CgkJCWUudmFsdWUgPSB0aGlzLkVkaXRlZFZhbHVlKGUpOwoJCX0KCQlpZiAoZS5jbG9zZSkgewoJCQlhd2FpdCBlLmNsb3NlKHRoaXMuZ2V0KCkpOwoJCX0KCX0KCglhc3luYyBQZW5kQWZ0ZXJPcGVuKGUpIHsKCQlpZiAoZS5lZGl0b3IgJiYgdHlwZW9mKGFjZSkgIT09ICJ1bmRlZmluZWQiKSB7CgkJCWF3YWl0IF9GckVNRC5PcGVuRWRpdG9yKCdwbmwnICsgZS5uYW1lIC8qKyAnLWNlbnRlcicqLyAsIGUubGFuZ3VhZ2UsIGUubG9hZGVyIHx8IChvID0+IGUudmFsdWUpLCBlLnNhdmVyLCB0aGlzLmdldCgpLCBlKTsKCQl9CgkJaWYgKGUub3BlbikgewoJCQlhd2FpdCBlLm9wZW4odGhpcy5nZXQoKSk7CgkJfQoJfQoKCWxpbmsob3B0aW9ucykgewoJCXJldHVybiAob3B0aW9ucy5saW5rcyB8fCBbXSkuZmlsdGVyKGwgPT4gIWwuaWdub3JlKS5tYXAobCA9PiBgPGEgaHJlZj0iIyIgY2xhc3M9ImVhc3l1aS0ke3RoaXMudWlUeXBlc1tvcHRpb25zLnR5cGVdfSIgZGF0YS1vcHRpb25zPScke3RoaXMuZXZlbnRIYW5kbGVycyhvcHRpb25zKX0sIGljb25DbHM6Imljb24tJHtsLmljb24gfHwgJ29rJ30iJz4ke2wubGFiZWx9PC9hPmApLmpvaW4oJ1xuJyk7Cgl9CgoJYXN5bmMgU2V0VHJlZURhdGEoZSwgbiwgZGF0YSkgewoJCSQuZWFjaCgkKCIjY21iIiArIGUubmFtZSlbdGhpcy5lRnVuKGUpXSgndHJlZScpLnRyZWUoImdldENoaWxkcmVuIiwgbi50YXJnZXQpLCAoXywgYykgPT4gJCgiI2NtYiIgKyBlLm5hbWUpW3RoaXMuZUZ1bihlKV0oJ3RyZWUnKS50cmVlKCJyZW1vdmUiLCBjLnRhcmdldCkpOwoJCSQoIiNjbWIiICsgZS5uYW1lKVt0aGlzLmVGdW4oZSldKCd0cmVlJykudHJlZSgiYXBwZW5kIiwgewoJCQlwYXJlbnQ6IG4udGFyZ2V0LAoJCQlkYXRhOiBkYXRhCgkJfSk7CgkJcmV0dXJuIHRydWU7Cgl9CgoJYXN5bmMgRXhwYW5kKGUsIG4pIHsKCQl0aGlzLlNldFRyZWVEYXRhKGUsIG4sIFt7CgkJCWlkOiBudWxsLAoJCQl0ZXh0OiAibG9hZGluZy4uLiIKCQl9XSk7CgkJdmFyIG9iaiA9IHt9OwoJCXZhciBwRmllbGQgPSBlLnBhcmVudEZpZWxkIHx8ICQubWFwKCQuZ3JlcChlLmNvbHVtbnMgfHwgW10sIGMgPT4gYy5wYXJlbnQpLCBjID0+IGMuZmllbGQpLmNvbmNhdChbbnVsbF0pWzBdOwoJCXZhciBpZEZpZWxkID0gJC5ncmVwKGUuY29sdW1ucyB8fCBbXSwgYyA9PiBjLnByaW1hcnkpLmNvbmNhdChlLmlkRmllbGQpWzBdLmZpZWxkOwoJCWlmIChwRmllbGQpIHsKCQkJb2JqW3BGaWVsZF0gPSB7CgkJCQlfc291cmNlOiBuLl9zb3VyY2UKCQkJfTsKCQkJaWYgKGlkRmllbGQpIHsKCQkJCW9ialtwRmllbGRdW2lkRmllbGRdID0gbi5pZDsKCQkJfSBlbHNlIHsKCQkJCW9ialtwRmllbGRdID0gbi5pZDsKCQkJfQoJCX0KCQlsZXQgZGF0YSA9IGF3YWl0IHRoaXMuX2xvYWREYXRhKHsKCQkJaWQ6ICJjbWIiICsgZS5uYW1lLAoJCQlvcHRpb25zOiBlCgkJfSwgb2JqKTsKCQl0aGlzLlNldFRyZWVEYXRhKGUsIG4sIGRhdGEpOwoJfQoKCWFzeW5jIF9sb2FkRGF0YShzLCBvLCBzdGFydCwgZW5kKSB7CgkJdmFyIG5hbWUgPSAocyAmJiBzLm9wdGlvbnMgPyAocy5vcHRpb25zLkNsYXNzID8gcy5vcHRpb25zLkNsYXNzLk5hbWUucmVwbGFjZSgnICcsICdfJykgOiAocy5vcHRpb25zLnRhYmxlIHx8IHMub3B0aW9ucy5uYW1lKSkgOiBzLm5hbWUpOwoJCW5hbWUgPSBuYW1lLnRyaW0oKTsgLy8uc3BsaXQoJy4nKS5zbGljZSgtMSlbMF07CgoJCWxldCBvU2NvcGUgPSAodHlwZW9mKGNvbXBhbnkpICE9PSAndW5kZWZpbmVkJyAmJiBjb21wYW55LlNjb3BlKSA/IHdpbmRvd1tjb21wYW55LlNjb3BlXSA6IHdpbmRvdzsKCQlvID0gbyB8fCAoKG9TY29wZSAmJiBvU2NvcGVbbmFtZV0pID8gbmV3IG9TY29wZVtuYW1lXSgpIDogewoJCQlBY3RpdmU6IHRydWUsCgkJfSk7CgoJCW8gPSAodHlwZW9mIGZpbHRlcnMgIT09ICJ1bmRlZmluZWQiICYmIGZpbHRlcnMgJiYgZmlsdGVyc1tuYW1lXSkgPyBmaWx0ZXJzW25hbWVdKG8pIDogbzsKCQlvID0gKHMgJiYgcy5vcHRpb25zICYmIHMub3B0aW9ucy5zb3VyY2UgPyBzLm9wdGlvbnMuc291cmNlKG8sIHRoaXMuZ2V0KCkpIDogbyk7CgkJbGV0IG5hbWVzID0gJC51bmlxdWVTb3J0KFtzLm9wdGlvbnMuc2VhcmNoRmllbGRdLmNvbmNhdCgkLm1hcCgkLmdyZXAocy5vcHRpb25zLmNvbHVtbnMgfHwgW10sIGMgPT4gYy5zZWFyY2gpLCBjID0+IGMuZmllbGQpLCBbIk5hbWUiXSkpOwoJCXZhciBmdW4gPSB0aGlzLmVGdW4ocy5vcHRpb25zKTsKCQlpZiAoIW9bbmFtZXNbMF1dKSBvW25hbWVzWzBdXSA9ICQoIiMiICsgcy5pZClbZnVuXSgnZ2V0VGV4dCcpOwoJCXZhciBkYXRhID0gbnVsbDsKCgkJbGV0IGxpYiA9ICcnOwoJCWlmIChuYW1lLmluZGV4T2YoJy4nKSA+IDApIHsKCQkJbGliID0gbmFtZS5zcGxpdCgnLicpWzBdICsgJy4nOwoJCQluYW1lID0gbmFtZS5zcGxpdCgnLicpWzFdOwoJCX0KCgkJaWYgKHMub3B0aW9ucy5sb2FkZXIpIHsKCQkJZGF0YSA9IGF3YWl0IHMub3B0aW9ucy5sb2FkZXIodGhpcy5nZXQoKSwgcy5vcHRpb25zLCBvKTsKCQl9IGVsc2UgaWYgKHR5cGVvZihjb21wYW55KSAhPT0gJ3VuZGVmaW5lZCcgJiYgY29tcGFueS5saWJyYXJ5ICYmIGNvbXBhbnkuQ29kZSAmJiB3aW5kb3cuYkxvY2FsKSB7CgkJCS8vY29uc29sZS5sb2coIkRGb3JtOjpfbG9hZERhdGEoKTogc3IoKS5fKCIgKyBsaWIgKyBjb21wYW55LkNvZGUudG9Mb3dlckNhc2UoKSArIG5hbWUgKyAiRmluZGFsbCIgKyAiKSIsIG8pOwoJCQlkYXRhID0gYXdhaXQgdGhpcy5zcigpLl8obGliICsgY29tcGFueS5Db2RlLnRvTG93ZXJDYXNlKCkgKyBuYW1lICsgIkZpbmRhbGwiLCBudWxsLCBvLCBudWxsLCBzdGFydCwgZW5kKTsKCQl9IGVsc2UgaWYgKF9GckVNRC5hcGlTZXJ2ZXIpIHsKCQkJZGF0YSA9IGF3YWl0IF9GckVNRC5hcGlTZXJ2ZXIuX25ldyhuYW1lKS5fZnJvbURvY3VtZW50KE9iamVjdC5hc3NpZ24oLi4uT2JqZWN0LmtleXMobykubWFwKGsgPT4gKHsKCQkJCVtTdHJpbmcoaykuY2hhckF0KDApLnRvTG93ZXJDYXNlKCkgKyBTdHJpbmcoaykuc2xpY2UoMSldOiBvW2tdCgkJCX0pKSkpLmZpbmRBbGwoKTsKCQl9IGVsc2UgewoJCQkvLyBlbXMKCQkJZGF0YSA9IGF3YWl0IG8uZmluZEFsbCgpOwoJCQkvL2RhdGEgPSBhd2FpdCB3aW5kb3cuX0ZyRU1ELl9vKG51bGwsIG8pOwoJCX0KCQlpZiAocy5vcHRpb25zLnBvc3Rsb2FkKSB7CgkJCWF3YWl0IHMub3B0aW9ucy5wb3N0bG9hZChkYXRhKTsKCQl9CgkJJC5lYWNoKGRhdGEsIChpLCBkKSA9PiB7CgkJCWQuX19PV05FUiA9IHM7CgkJCSQuZWFjaChzLm9wdGlvbnMuY29sdW1ucywgKF8sIGMpID0+IHsKCQkJCWlmIChjLnZhbHVlKSB7CgkJCQkJZFtjLmZpZWxkXSA9IGMudmFsdWUoZCwgZGF0YSwgaSk7CgkJCQl9CgkJCX0pOwoJCX0pOwoJCWlmICghcy5vcHRpb25zLmNvbHVtbnMgJiYgZnVuLmluZGV4T2YoJ3RyZWUnKSA+IC0xKSB7CgkJCWRhdGEgPSAkLm1hcChkYXRhLCBkID0+IHsKCQkJCWxldCByZXQgPSB7CgkJCQkJaWQ6IGRbcy5vcHRpb25zLmlkRmllbGQuZmllbGRdLAoJCQkJCXRleHQ6IGRbcy5vcHRpb25zLnRleHRGaWVsZC5maWVsZF0sCgkJCQkJc3RhdGU6IGQuc3RhdGUgfHwgKHMub3B0aW9ucy5sb2FkZXIgPyAiZmlsZSIgOiAiY2xvc2VkIiksCgkJCQkJX3NvdXJjZTogZCwKCQkJCX07CgkJCQlyZXQuY2hpbGRyZW4gPSAocmV0LnN0YXRlID09ICJjbG9zZWQiKSA/IFt7CgkJCQkJdGV4dDogJ2xvYWRpbmcuLi4nCgkJCQl9XSA6IG51bGw7CgkJCQlyZXR1cm4gcmV0OwoJCQl9KTsKCQl9CgkJcmV0dXJuIGRhdGEgfHwgW107Cgl9CgoJYXN5bmMgZmlsbERhdGEoZywgbywgc3RhcnQsIGVuZCkgewoJCXZhciBzID0gbnVsbDsKCQlmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuc2VsZWN0cy5sZW5ndGg7IGkrKykgewoJCQlpZiAodGhpcy5zZWxlY3RzW2ldLmlkID09IGdbMF0uaWQpIHMgPSB0aGlzLnNlbGVjdHNbaV07CgkJfQoJCWlmICghcykgcmV0dXJuOwoJCXRoaXMuYnVzeSh0cnVlKTsKCQl0cnkgewoJCQl2YXIgZnVuID0gZ1swXS5jbGFzc0xpc3RbIjAiXS5yZXBsYWNlKCdlYXN5dWktJywgJycpOwoJCQl0cnkgewoJCQkJJCgiIyIgKyBzLmlkKVtmdW5dKCdncmlkJykuZGF0YWdyaWQoJ2dldFBhZ2VyJykucGFnaW5hdGlvbignbG9hZGluZycpOwoJCQl9IGNhdGNoIChleCkge30KCQkJaWYgKHMub3B0aW9ucy5ub2xvYWQpIHsKCQkJCWxldCBfZGF0YSA9IG51bGw7CgkJCQl0cnkgewoJCQkJCV9kYXRhID0gJCgiIyIgKyBzLmlkKVtmdW5dKCdncmlkJykuZGF0YWdyaWQoImdldERhdGEiKTsKCQkJCX0gY2F0Y2ggKGV4KSB7CgkJCQkJX2RhdGEgPSAkKCIjIiArIHMuaWQpW2Z1bl0oJ3RyZWUnKS50cmVlKCdnZXRSb290Jyk7CgkJCQl9CgkJCQlpZiAoX2RhdGEpIHsKCQkJCQlyZXR1cm4gdGhpcy5idXN5KGZhbHNlKTsKCQkJCX0KCQkJfQoJCQl2YXIgZGF0YSA9IGF3YWl0IHRoaXMuX2xvYWREYXRhKHMsIG8sIHN0YXJ0LCBlbmQpOwoJCQl0cnkgewoJCQkJaWYgKCQoIiMiICsgcy5pZClbZnVuXSgnZ3JpZCcpKSAkKCIjIiArIHMuaWQpW2Z1bl0oJ2dyaWQnKS5kYXRhZ3JpZCgnZ2V0UGFnZXInKS5wYWdpbmF0aW9uKCdsb2FkZWQnKTsKCQkJfSBjYXRjaCAoZXgpIHt9CgkJCXRyeSB7CgkJCQkkKCIjIiArIHMuaWQpW2Z1bl0oJ2dyaWQnKS5kYXRhZ3JpZCgnbG9hZERhdGEnLCB7CgkJCQkJdG90YWw6IGRhdGEuQ291bnQgfHwgZGF0YS5sZW5ndGgsCgkJCQkJcm93czogZGF0YSwKCQkJCX0pOwoJCQl9IGNhdGNoIChleCkgewoJCQkJJCgiIyIgKyBzLmlkKVtmdW5dKCd0cmVlJykudHJlZSgnbG9hZERhdGEnLCBkYXRhKTsKCQkJfQoJCX0gY2F0Y2ggKGV4KSB7CgkJCWNvbnNvbGUubG9nKGV4KTsKCQl9CgkJdGhpcy5idXN5KGZhbHNlKTsKCX0KCglldmVudEhhbmRsZXJzKG9wdGlvbnMpIHsKCQlpZiAoIXRoaXMuYnlOYW1lKG9wdGlvbnMubmFtZSkpIHJldHVybjsgLy8gaWYgbm90IGFuIGVsZW1lbnQsIGRvIG5vdCBydW4gdGhlIGhhbmRsZXJzCgoJCXJldHVybiB0aGlzLmV2ZW50cy5maWx0ZXIoZSA9PiBlLnR5cGUgPT0gb3B0aW9ucy50eXBlIHx8IHR5cGVvZihlLnR5cGUpID09PSAndW5kZWZpbmVkJykubWFwKGUgPT4gYCR7ZS5uYW1lfTogKCR7ZS5wYXJhbXMgfHwgJyd9KSA9PiB7dHJ5e0RGb3JtLiR7ZS5oYW5kbGVyfShERm9ybS5ieU5hbWUoIiR7b3B0aW9ucy5uYW1lfSIpIHx8ICR7X0ZyRU1ELl90b0pTKG9wdGlvbnMpfSB8fCB7bmFtZTogIiR7b3B0aW9ucy5uYW1lfSIsdHlwZTogIiR7b3B0aW9ucy50eXBlfSJ9LCAke2UucGFyYW1zfSl9Y2F0Y2goZXgpe2NvbnNvbGUubG9nKCJFdmVudCBFcnJvcjogJHtvcHRpb25zLm5hbWV9LyR7b3B0aW9ucy50eXBlfS8ke2UubmFtZX0iLCBleCk7fX1gKS5qb2luKCcsJyk7Cgl9CgoJYXN5bmMgUGFuZWxPcGVuKGUpIHsKCQlpZiAoZS5lZGl0b3IpIHJldHVybiB0cnVlOwoJCWxldCBjb250ZW50ID0gZS52YWx1ZTsKCQlpZiAoZS5sb2FkZXIpIHsKCQkJY29udGVudCA9IGF3YWl0IGUubG9hZGVyKHRoaXMuZ2V0KCkpOwoJCX0KCQlpZiAoY29udGVudCkgewoJCQl0cnkgewoJCQkJJCgiI3BubCIgKyBlLm5hbWUpLnBhbmVsKCdib2R5JykuaHRtbChjb250ZW50KTsKCQkJCWNvbnNvbGUubG9nKCJwbmwiICsgZS5uYW1lICsgIjogQ29udGVudCBWYWxpZCIpOwoJCQl9IGNhdGNoIChleCkgewoJCQkJLy9jb25zb2xlLmxvZyhleCk7CgkJCX0KCQl9CgkJcmV0dXJuIGNvbnRlbnQ7Cgl9CgoJYXN5bmMgU2VsZWN0Q2hhbmdlKG9wdGlvbnMsIHRhYikgewoJCXRoaXMuYnVzeSh0cnVlKTsKCQkkLmdyZXAodGhpcy5lbGVtZW50cywgZSA9PiBlLnR5cGUgPT0gImdyaWQiICYmIGUuZ3JvdXAgPT0gdGFiKS5mb3JFYWNoKGUgPT4gJCgiI2NtYiIgKyBlLm5hbWUpLmRhdGFncmlkKCkpOwoJCXRoaXMuYnVzeShmYWxzZSk7Cgl9CgoJYXN5bmMgRmllbGRDaGFuZ2Uob3B0aW9ucywgdmFsdWUpIHsKCQl0aGlzLmJ1c3kodHJ1ZSk7CgkJaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5jaGFuZ2UpIHsKCQkJYXdhaXQgb3B0aW9ucy5jaGFuZ2UodGhpcy5nZXQoKSwgdmFsdWUpOwoJCX0KCQl0aGlzLmJ1c3koZmFsc2UpOwoJfQoKCWFzeW5jIFVSTENoYW5nZShzLCBvcHRpb25zKSB7CgkJdGhpcy5idXN5KHRydWUpOwoJCW9wdGlvbnMuZGF0YSA9IGF3YWl0ICQuZ2V0KHMudmFsdWUpOwoJCXJldHVybiBhd2FpdCB0aGlzLkZpZWxkQ2hhbmdlKHMsIG9wdGlvbnMpOwoJfQoKCVVwbG9hZEZpbGUoZiwgb3B0aW9ucykgewoJCXRoaXMuYnVzeSh0cnVlKTsKCQl2YXIgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEoKTsKCQl2YXIgZmlsZWlkID0gTWF0aC5yYW5kb20oKTsKCQl2YXIgbWV0aG9kID0gb3B0aW9ucy5tZXRob2QgfHwgIkNvbnRlbnRNYW5hZ2VyLmNtc1VwbG9hZEZpbGUiOwoJCWZvcm1EYXRhLmFwcGVuZCgnZmlsZWlkJywgZmlsZWlkKTsKCQl2YXIgZmlsZSA9ICQoIiMiICsgZi5maWxlYm94SWQpWzBdLmZpbGVzWzBdOwoJCWZvcm1EYXRhLmFwcGVuZCgnX19VRklMRScsIGZpbGUpOwoJCWlmIChvcHRpb25zLmxvY2FsKSB7CgkJCS8vIGhhbmRsaW5nIHRoZSBmaWxlIGxvY2FsbHkKCQkJdmFyIHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7CgkJCXJlYWRlci5vbmxvYWQgPSAoZSkgPT4gewoJCQkJdmFyIGRhdGEgPSBlLnRhcmdldC5yZXN1bHQ7CgkJCQlyZXQgPSBkYXRhOwoJCQkJdGhpcy5ieU5hbWUob3B0aW9ucy5uYW1lKS5kYXRhID0gcmV0OwoJCQkJaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy51cGxvYWQpIG9wdGlvbnMudXBsb2FkKHRoaXMuZ2V0KCksIHJldCk7CgkJCX07CgkJCWlmIChvcHRpb25zLmJpbmFyeSkgewoJCQkJcmVhZGVyLnJlYWRBc0JpbmFyeVN0cmluZyhmaWxlKTsKCQkJfSBlbHNlIGlmIChvcHRpb25zLmRhdGF1cmwpIHsKCQkJCXJlYWRlci5yZWFkQXNEYXRhVVJMKGZpbGUpOwoJCQl9IGVsc2UgewoJCQkJcmVhZGVyLnJlYWRBc1RleHQoZmlsZSk7CgkJCX0KCQkJdGhpcy5idXN5KGZhbHNlKTsKCQl9IGVsc2UgaWYgKG1ldGhvZCkgewoJCQkkLmFqYXgoewoJCQkJdXJsOiB0aGlzLnNyKCkuc3JVUkwgKyAiJm1ldGhvZD0iICsgbWV0aG9kICsgIiZzSW5wdXQ9IiArIGZpbGVpZCArICImcHJlVGFnPSZwb3N0VGFnPSIsCgkJCQlkYXRhOiBmb3JtRGF0YSwKCQkJCS8vIFRISVMgTVVTVCBCRSBET05FIEZPUiBGSUxFIFVQTE9BRElORwoJCQkJY2FjaGU6IGZhbHNlLAoJCQkJY29udGVudFR5cGU6IGZhbHNlLAoJCQkJdHlwZTogJ1BPU1QnLAoJCQkJcHJvY2Vzc0RhdGE6IGZhbHNlLAoJCQkJc3VjY2VzczogZGF0YSA9PiB7CgkJCQkJdGhpcy5zcigpLnJ1blNjcmlwdChkYXRhKTsKCQkJCQl0aGlzLmJ5TmFtZShvcHRpb25zLm5hbWUpLmRhdGEgPSByZXQ7CgkJCQkJaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy51cGxvYWQpIG9wdGlvbnMudXBsb2FkKHRoaXMuZ2V0KCksIHJldCk7CgkJCQkJdGhpcy5idXN5KGZhbHNlKTsKCQkJCX0KCQkJfSk7CgkJfQoJfQoKCWVGdW4oZSkgewoJCXRyeSB7CgkJCWlmIChlLnR5cGUgPT0gInRyZWUiKSB7CgkJCQlpZiAoZS5jb2x1bW5zKSB7CgkJCQkJcmV0dXJuICJjb21ib3RyZWVncmlkIjsKCQkJCX0gZWxzZSBpZiAodHlwZW9mKGUuY29tYm8pICE9PSAndW5kZWZpbmVkJyAmJiAhZS5jb21ibykgewoJCQkJCXJldHVybiAndHJlZSc7CgkJCQl9IGVsc2UgewoJCQkJCXJldHVybiAiY29tYm90cmVlIjsKCQkJCX0KCQkJfSBlbHNlIGlmIChlLnR5cGUgPT0gJ25hdmlnYXRpb24nKSB7CgkJCQlyZXR1cm4gJ3RyZWUnOwoJCQl9IGVsc2UgaWYgKGUudHlwZSA9PSAiY29tYm90cmVlIikgewoJCQkJcmV0dXJuICJjb21ib3RyZWVncmlkIjsKCQkJfSBlbHNlIGlmIChlLnR5cGUgPT0gInNlbGVjdCIgJiYgZS5vcHRpb25zKSB7CgkJCQlyZXR1cm4gImNvbWJvYm94IjsKCQkJfQoJCQlyZXR1cm4gImNvbWJvZ3JpZCI7CgkJfSBjYXRjaCAoZXgpIHsKCQkJcmV0dXJuICJjb21ib2dyaWQiOwoJCX0KCX0KCglfZmlsbFdpbmRvdyh3aW5OYW1lLCB2LCBtYXApIHsKCQl2ID0gdiB8fCB7fTsKCQltYXAgPSBtYXAgfHwge307CgkJaWYgKEFycmF5LmlzQXJyYXkobWFwKSkgewoJCQltYXAgPSBPYmplY3QuZnJvbUVudHJpZXMobmV3IE1hcChtYXApKTsKCQl9CgoJCW1hcCA9ICQuZXh0ZW5kKHt9LCBtYXAsIE9iamVjdC5mcm9tRW50cmllcyhPYmplY3Qua2V5cyh2KS5tYXAoayA9PiBbd2luTmFtZSArIGssIGtdKSkpOwoKCQlsZXQgcyA9IHt9OwoJCWZvciAodmFyIG0gaW4gbWFwKSB7CgkJCWlmICh0eXBlb2YodlttYXBbbV1dKSA9PT0gInVuZGVmaW5lZCIpIHsKCQkJCS8vY29uc29sZS5sb2coJ2lzX3VuZGVmaW5lZCcsIG0sIG1hcFttXSwgdlttYXBbbV1dKTsKCQkJCXNbbV0gPSBtYXBbbV07CgkJCX0gZWxzZSB7CgkJCQkvL2NvbnNvbGUubG9nKCdpc19ub3RfdW5kZWZpbmVkJywgbSwgbWFwW21dLCB2W21hcFttXV0pOwoJCQkJc1ttXSA9IHZbbWFwW21dXTsKCQkJfQoJCX0KCQl0aGlzLmNsZWFyKHdpbk5hbWUpOwoJCS8vY29uc29sZS5sb2coInMiLCBzKTsKCQl0aGlzLnNldChzKTsKCQkkKCIjcG5sXyIgKyB3aW5OYW1lKS53aW5kb3coIm9wZW4iKTsKCX0KCgl3aW5kb3dUb0VudGl0eShvLCBiRW1wdHksIGdyaWQsIHByZWZpeCwgZmlsdGVyKSB7CgkJbyA9IG8gfHwgdGhpcy5nZXQoKTsKCQlmaWx0ZXIgPSBmaWx0ZXIgfHwgKHYgPT4gdik7CgkJbGV0IHJldCA9IGdyaWQgPyAoZ3JpZC5zZWxlY3RlZCB8fCBncmlkKSA6IG51bGw7CgkJaWYgKGJFbXB0eSkgewoJCQlyZXQgPSB7fTsKCQkJbyA9IHt9OwoJCX0gZWxzZSB7CgkJCXJldCA9IChyZXQgJiYgcmV0LklkKSA/IHsKCQkJCUlkOiByZXQuSWQKCQkJfSA6IHt9OwoJCX0KCgkJdGhpcy5lbGVtZW50cy5maWx0ZXIoZSA9PiAocHJlZml4ID8gZS5ncm91cCA9PSBwcmVmaXggOiB0cnVlKSAmJiBlLnR5cGUgIT0gJ2xpbmsnICYmIFsnXyddLmluZGV4T2YoZS5uYW1lLnJlcGxhY2UocHJlZml4LCAiIikpIDwgMCkuZm9yRWFjaChlID0+IHsKCQkJcmV0W2UubmFtZS5yZXBsYWNlKHByZWZpeCwgIiIpXSA9IG9bZS5uYW1lXTsKCQkJcmV0dXJuIHRydWU7CgkJfSk7CgoJCWZpbHRlcihyZXQpOwoKCQlyZXR1cm4gcmV0OwoJfQoKCWJpbmQob2JqKSB7CgkJdmFyIG9iakJpbmQgPSAobywgZSkgPT4gewoJCQlvW3RoaXMuZUZ1bihlKV0oewoJCQkJb25TaG93UGFuZWw6ICgpID0+IHsKCQkJCQl0aGlzLmZpbGxEYXRhKCQoIiMiICsgZS5pZCksIG51bGwsIDAsIDEwKTsKCQkJCX0sCgkJCQlvbkNsaWNrUm93OiAoaW5kZXgsIHJvdykgPT4gewoJCQkJCXZhciBzID0gcm93ID8gcm93Ll9fT1dORVIgOiBudWxsOwoJCQkJCWlmIChzICYmIHMub3B0aW9ucy5zZWxlY3QpIHsKCQkJCQkJcy5vcHRpb25zLnNlbGVjdChyb3cpOwoJCQkJCX0KCQkJCX0KCQkJfSk7CgkJCXRyeSB7CgkJCQl2YXIgZGcgPSBvW3RoaXMuZUZ1bihlKV0oJ2dyaWQnKTsKCQkJCS8vIGRnLmRhdGFncmlkKCdlbmFibGVGaWx0ZXInKQoJCQkJdmFyIHN0YXRlID0gZGcuZGF0YSgnZGF0YWdyaWQnKTsKCQkJCXZhciBvcHRzID0gc3RhdGUub3B0aW9uczsKCQkJCXZhciBvbkJlZm9yZUxvYWQgPSBvcHRzLm9uQmVmb3JlTG9hZDsKCQkJCW9wdHMub25CZWZvcmVMb2FkID0gKHBhcmFtKSA9PiB7CgkJCQkJc3RhdGUuYWxsUm93cyA9IG51bGw7CgkJCQkJcmV0dXJuIG9uQmVmb3JlTG9hZC5jYWxsKHRoaXMsIHBhcmFtKTsKCQkJCX07CgkJCQl2YXIgcGFnZXIgPSBkZy5kYXRhZ3JpZCgnZ2V0UGFnZXInKTsKCQkJCWRnLmRhdGFncmlkKCdnZXRQYW5lbCcpLnBhbmVsKHsKCQkJCQlJRDogaQoJCQkJfSk7CgkJCQlwYWdlci5wYWdpbmF0aW9uKHsKCQkJCQlvblNlbGVjdFBhZ2U6IGZ1bmN0aW9uKHBhZ2VOdW0sIHBhZ2VTaXplKSB7CgkJCQkJCXRyeSB7CgkJCQkJCQlERm9ybS5maWxsRGF0YSgkKCIjIiArIERGb3JtLnNlbGVjdHNbJCh0aGlzLnBhcmVudE5vZGUpLnBhbmVsKCdvcHRpb25zJykuSURdLmlkKSwgbnVsbCwgcGFnZVNpemUgKiAocGFnZU51bSAtIDEpLCBwYWdlU2l6ZSAqIHBhZ2VOdW0pOwoJCQkJCQl9IGNhdGNoIChfZXgpIHsKCQkJCQkJCWNvbnNvbGUubG9nKCJEeW5hRm9ybTo6b25TZWxlY3RQYWdlKCkgIiwgX2V4KQoJCQkJCQl9CgkJCQkJfQoJCQkJfSk7CgkJCQlkZy5kYXRhZ3JpZCgnbG9hZERhdGEnLCBzdGF0ZS5kYXRhKTsKCQkJfSBjYXRjaCAoZXgpIHt9CgkJfTsKCQlpZiAob2JqKSB7CgkJCW9iakJpbmQob2JqKTsKCQl9IGVsc2UgewoJCQlmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuc2VsZWN0cy5sZW5ndGg7IGkrKykgewoJCQkJaWYgKHRoaXMuc2VsZWN0c1tpXS5vcHRpb25zLm9wdGlvbnMpIHsKCQkJCQkvLyQoIiMiICsgdGhpcy5zZWxlY3RzW2ldLmlkKS5jb21ibygpOwoJCQkJfSBlbHNlIHsKCQkJCQlvYmpCaW5kKCQoIiMiICsgdGhpcy5zZWxlY3RzW2ldLmlkKSwgdGhpcy5zZWxlY3RzW2ldKTsKCQkJCX0KCQkJfQoKCQkJdGhpcy5lbGVtZW50cy5maWx0ZXIoZSA9PiBlLndpbmRvdykuZm9yRWFjaChlID0+IHsKCQkJCWxldCB0ID0gJCgiI3RiY1dpbmRvdyIpLnRhYnMoImdldFRhYiIsIGUuZ3JvdXApOwoJCQkJaWYgKHQpIHsKCQkJCQl0LnBhbmVsKCdvcHRpb25zJykudGFiLmhpZGUoKTsKCQkJCX0KCQkJfSk7CgkJfQoJfQoKCWVuZ2xpc2gocykgewoJCWlmICghcykgcmV0dXJuICIiOwoJCXZhciByZXN1bHQgPSBzLnJlcGxhY2UoLyhbQS1aXSkvZywgIiAkMSIpOwoJCXJlc3VsdCA9IHJlc3VsdC5yZXBsYWNlKC9fL2csICcnKTsKCQlyZXR1cm4gcmVzdWx0LmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgcmVzdWx0LnNsaWNlKDEpOwoJfQoKCW9uVG9nZ2xlKGUsIGJWYWx1ZSkgewoJCWxldCBzVGFnID0gYCNmRWxlbWVudF8ke2UuZm9yLm5hbWV9ID4gLmVhc3l1aS0ke3RoaXMudWlUeXBlc1tlLmZvci50eXBlXX1gOwoJCWxldCBvVGFnID0gJChzVGFnKTsKCQllLmZvci5lbmFibGVkID0gdHlwZW9mKGJWYWx1ZSkgPT09ICJ1bmRlZmluZWQiID8gIWUuZm9yLmVuYWJsZWQgOiBiVmFsdWU7CgoJCW9UYWcucHJvcCgiZGlzYWJsZWQiLCAhZS5mb3IuZW5hYmxlZCk7CgkJLy9vVGFnW3RoaXMudWlUeXBlc1tlLmZvci50eXBlXV0oZS5mb3IuZW5hYmxlZCA/ICJlbmFibGUiIDogImRpc2FibGUiKTsKCQljb25zb2xlLmxvZyhzVGFnLCBvVGFnLCB0aGlzLnVpVHlwZXNbZS5mb3IudHlwZV0sIGUuZm9yLmVuYWJsZWQpOwoJfQoKCXJlbmRlcihuYW1lLCB0aXRsZSwgZWxlbWVudHMsIGJ1dHRvbnMsIGJGaXhlZCkgewoJCXRoaXMuZWxlbWVudHMgPSAoZWxlbWVudHMgfHwgW10pLmZpbHRlcihlID0+ICFlLmlnbm9yZSk7CgoJCXRoaXMuYnV0dG9ucyA9IGJ1dHRvbnMgfHwgW107CgkJdGhpcy5zZWxlY3RzID0gW107CgkJdGhpcy5ncmlkcyA9IFtdOwoKCQl0aGlzLmVsZW1lbnRzLmZpbHRlcihlID0+IGUudHlwZSA9PSAid2luZG93IikuZm9yRWFjaCh3ID0+IHRoaXMuZWxlbWVudHMuc3BsaWNlKHRoaXMuZWxlbWVudHMuZmluZEluZGV4KGUgPT4gZS5uYW1lID09IHcubmFtZSksIDAsIHsKCQkJbmFtZTogIl8iICsgdy5uYW1lLAoJCQl0eXBlOiAibGluayIsCgkJCXRpdGxlOiB3LnRpdGxlIHx8IHcubmFtZSwKCQkJZ3JvdXA6IHcuZ3JvdXAsCgkJCXdpbmRvdzogdy53aW5kb3csCgkJCXNlY3Rpb246IHcuc2VjdGlvbiwKCQkJbGlua3M6IFt7CgkJCQlsYWJlbDogJ09wZW4nLAoJCQkJaWNvbjogJ2VkaXQnLAoJCQkJb25DbGljazogbyA9PiAkKCIjcG5sIiArIHcubmFtZSkud2luZG93KCdvcGVuJykKCQkJfV0sCgkJfSkpOwoKCQl0aGlzLnNyKCkuZ3JvdXBCeSh0aGlzLmVsZW1lbnRzLmZpbHRlcihlID0+IGUud2luZG93KSwgImdyb3VwIikuZm9yRWFjaChrdiA9PiB7CgkJCWlmICgha3Yua2V5KSByZXR1cm47CgoJCQlsZXQgZSA9IHsKCQkJCW5hbWU6ICJfIiArIGt2LmtleSwKCQkJCXRpdGxlOiBrdi5rZXksCgkJCQl0eXBlOiAid2luZG93IiwKCQkJCWdyb3VwOiBrdi5rZXksCgkJCQl3aWR0aDogdGhpcy53aWR0aCAqIDAuOSwKCQkJCWhlaWdodDogdGhpcy5oZWlnaHQgKiAwLjksCgkJCQlsb2FkZXI6IG8gPT4gewoJCQkJCWt2LnZhbHVlcy5maWx0ZXIodiA9PiB2LnR5cGUgIT09ICdsaW5rJyB8fCAodi50eXBlID09ICdsaW5rJyAmJiB2Lm5hbWUuc3RhcnRzV2l0aCgnXycpKSkuZm9yRWFjaCh2ID0+ICQoIiNwbmxfIiArIHYuZ3JvdXAgKyAnLWNlbnRlcicpLmFwcGVuZCgkKCIjZkVsZW1lbnRfIiArIHYubmFtZSkpKTsKCQkJCQlyZXR1cm4gbnVsbDsKCQkJCX0sCgkJCQlidXR0b25zOiBbXS5jb25jYXQuYXBwbHkoW10sIGt2LnZhbHVlcy5maWx0ZXIodiA9PiB2LnR5cGUgPT0gJ2xpbmsnICYmICF2Lm5hbWUuc3RhcnRzV2l0aCgnXycpKS5tYXAodiA9PiBbLi4udi5saW5rcy5tYXAobCA9PiAoewoJCQkJCW5hbWU6IGwubmFtZSB8fCBsLmxhYmVsLAoJCQkJCXRpdGxlOiBsLnRpdGxlIHx8IGwubGFiZWwsCgkJCQkJb25DbGljazogbC5vbkNsaWNrLAoJCQkJCWljb246IGwuaWNvbiwKCQkJCQl3aW5kb3c6IHRydWUsCgkJCQkJZ3JvdXA6IGt2LmtleSwKCQkJCX0pKV0pKSwKCQkJfTsKCQkJdGhpcy5idXR0b25zLnB1c2goLi4uZS5idXR0b25zKTsKCgkJCXRoaXMuZWxlbWVudHMucHVzaChlKTsKCQl9KTsKCgkJdmFyIHJldCA9ICIiOwoJCS8vIGNoZWNrIHRoZSBvcHRpb24gb2YgdXNpbmcgd2luZG93KCkgYXMgYSByZW5kZXJlciBvZiB0aGUgbWFpbiB3aW5kb3cuLi4KCQlpZiAodHJ1ZSkgewoJCQl0aGlzLmVsZW1lbnRzLmZpbHRlcihlID0+ICFlLnpvbmUpLmZvckVhY2goZSA9PiBlLnpvbmUgPSAnY2VudGVyJyk7CgkJCWxldCB3T3B0aW9ucyA9IHsKCQkJCW5hbWU6IG5hbWUgfHwgdGhpcy5uYW1lLAoJCQkJdGl0bGU6IHRpdGxlIHx8IHRoaXMudGl0bGUsCgkJCQl0eXBlOiAnd2luZG93JywKCQkJCXZpc2libGU6IHRydWUsCgkJCQl3aWR0aDogdGhpcy53aWR0aCwKCQkJCWhlaWdodDogdGhpcy5oZWlnaHQsCgkJCQlmaXhlZDogYkZpeGVkLAoJCQkJbGlua3M6IFt7CgkJCQkJaWNvbjogImhlbHAiLAoJCQkJCWFjdGlvbjogbyA9PiAkKCIjcG5sX19Db25zb2xlIikud2luZG93KCdvcGVuJykKCQkJCX1dLAoJCQkJYnV0dG9uczogdGhpcy5idXR0b25zLmZpbHRlcihiID0+ICFiLndpbmRvdyksCgkJCX07CgkJCXRoaXMuc3IoKS5ncm91cEJ5KHRoaXMuZWxlbWVudHMsICd6b25lJykuZmlsdGVyKHpnID0+IHpnLmtleSkuZm9yRWFjaCh6ZyA9PiB7CgkJCQl3T3B0aW9uc1t6Zy5rZXldID0gdGhpcy5yZW5kZXJFbGVtZW50cyh6Zy52YWx1ZXMpOwoJCQl9KTsKCgkJCXJldCA9IHRoaXMud2luZG93KHdPcHRpb25zKTsKCQl9IGVsc2UgewoJCQlyZXQgPSB0aGlzLmhlYWRlcihuYW1lLCB0aXRsZSwgYkZpeGVkLCBbewoJCQkJaWNvbjogImhlbHAiLAoJCQkJYWN0aW9uOiBvID0+ICQoIiNwbmxfX0NvbnNvbGUiKS53aW5kb3coJ29wZW4nKQoJCQl9XSk7CgoJCQlyZXQgKz0gdGhpcy5yZW5kZXJFbGVtZW50cygpOwoKCQkJcmV0ICs9IHRoaXMuZm9vdGVyKGJGaXhlZCk7CgoJCX0KCQkvLyBjb25zb2xlLmxvZyhyZXQpOwoKCQlyZXR1cm4gcmV0OwoJfQoKCWNXaWR0aChvcHRpb25zKSB7CgkJbGV0IHJldCA9IE1hdGguZmxvb3IoKChvcHRpb25zID8gb3B0aW9ucy53aWR0aCA6IG51bGwpIHx8ICh0aGlzLndpZHRoIC8gMykpKTsKCQlpZiAob3B0aW9ucy56b25lID09ICdlYXN0JyB8fCBvcHRpb25zLnpvbmUgPT0gJ3dlc3QnKSB7CgkJCXJldCA9IDAuMjUgKiByZXQ7IC8vIDkwJSBvZiAzLzEwLCB0aGUgd2lkdGggb2YgdGhlIG5vcm1hbCBlbGVtZW50CgkJfSBlbHNlIGlmIChvcHRpb25zICYmIG9wdGlvbnMuZWRpdG9yKSB7CgkJCXJldCA9IHdpbmRvdy5pbm5lcldpZHRoOwoJCX0gZWxzZSBpZiAob3B0aW9ucyAmJiBvcHRpb25zLndpZHRoICYmIHR5cGVvZihvcHRpb25zLndpZHRoKSA9PT0gJ3N0cmluZycpIHsKCQkJcmV0ID0gdGhpcy53aWR0aDsKCQl9IGVsc2UgaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy50eXBlID09ICd3aW5kb3cnICYmICFvcHRpb25zLndpZHRoKSB7CgkJCXJldCA9IHRoaXMud2lkdGggKiAwLjk7CgkJfQoKCQkvLyBjb25zb2xlLmxvZyhvcHRpb25zLm5hbWUgKyAiOiBjV2lkdGggPSAiICsgcmV0LCBvcHRpb25zLnpvbmUpOwoJCXJldHVybiByZXQ7Cgl9CgoJd2luZG93KG9wdGlvbnMpIHsKCQlvcHRpb25zLnRpdGxlID0gb3B0aW9ucy50aXRsZSB8fCBvcHRpb25zLm5hbWU7CgkJdmFyIHJldCA9IGAKCQk8ZGl2IGlkID0gInBubCR7b3B0aW9ucy5uYW1lfSIgY2xhc3M9ImVhc3l1aS13aW5kb3ciIHRpdGxlPSIke29wdGlvbnMudGl0bGV9IiBkYXRhLW9wdGlvbnM9JyR7dGhpcy5ldmVudEhhbmRsZXJzKG9wdGlvbnMpfSwgY2xvc2VkOiR7IW9wdGlvbnMudmlzaWJsZX0sbWluaW1pemFibGU6JHshb3B0aW9ucy5maXhlZH0sbWF4aW1pemFibGU6JHshb3B0aW9ucy5maXhlZH0sY2xvc2FibGU6JHshb3B0aW9ucy5maXhlZH0sY29sbGFwc2libGU6JHshb3B0aW9ucy5maXhlZH0sZHJhZ2dhYmxlOiR7IW9wdGlvbnMuZml4ZWR9LHJlc2l6YWJsZTokeyFvcHRpb25zLmZpeGVkfSxpY29uQ2xzOiJpY29uLSR7b3B0aW9ucy5pY29ufSIsIHRvb2xzOiIjJHtvcHRpb25zLm5hbWV9X3Rvb2xzIicgc3R5bGU9IndpZHRoOiR7dGhpcy5jV2lkdGgob3B0aW9ucyl9cHg7aGVpZ2h0OiR7dGhpcy5jSGVpZ2h0KG9wdGlvbnMpfXB4O3BhZGRpbmc6MTBweDsiPgoJCSAgICA8ZGl2IGNsYXNzPSJlYXN5dWktbGF5b3V0IiBkYXRhLW9wdGlvbnM9ImZpdDp0cnVlIj4KCQlgOwoKCQlsZXQgYlpvbmUgPSBvcHRpb25zLnNvdXRoID8gJ3NvdXRoJyA6ICh0aGlzLnpvbmVzLmZpbmQoeiA9PiB6ID09ICdzb3V0aCcpIHx8IHRoaXMuem9uZXNbMF0pOwoJCW9wdGlvbnNbYlpvbmVdID0gb3B0aW9uc1tiWm9uZV0gfHwgW107CgkJbGV0IHpXaWR0aCA9IE1hdGgubWluKDEyMCwgdGhpcy53aWR0aCAqIDAuOTUgLyAob3B0aW9ucy5idXR0b25zID8gb3B0aW9ucy5idXR0b25zLmxlbmd0aCA6IDEpLCB0aGlzLmNXaWR0aChvcHRpb25zKSk7CgkJb3B0aW9uc1tiWm9uZV0ucHVzaChgPGRpdiBpZD0icG5sJHtvcHRpb25zLm5hbWV9LWJ1dHRvbnMiIGRhdGEtb3B0aW9ucz0icmVnaW9uOicke2Jab25lfScsYm9yZGVyOmZhbHNlIiBzdHlsZT0idGV4dC1hbGlnbjpyaWdodDtwYWRkaW5nOjVweCAwIDA7Ij5gICsgJC5tYXAoJC5ncmVwKG9wdGlvbnMuYnV0dG9ucyB8fCBbXSwgYiA9PiAhYi5pZ25vcmUpLCBiID0+IGA8YSBpZD0nJHtiLm5hbWV9JyBocmVmPSJqYXZhc2NyaXB0OnZvaWQoMCkiIGNsYXNzPSJlYXN5dWktbGlua2J1dHRvbiBjNiIgaWNvbkNscz0iaWNvbi0ke2IuaWNvbiB8fCAnc2F2ZSd9IiBzdHlsZT0id2lkdGg6JHt6V2lkdGh9cHgiIG9uY2xpY2s9J3RoaXMuZG9DbGljaygke19GckVNRC5fdG9KUyhiKX0pJz4ke2IudGl0bGUgfHwgYi5uYW1lfTwvYT4mbmJzcDsmbmJzcDtgKS5qb2luKCcnKSArIGA8L2Rpdj5gKTsKCgkJdGhpcy56b25lcy5maWx0ZXIoeiA9PiBvcHRpb25zW3pdKS5mb3JFYWNoKHogPT4gewoJCQlyZXQgKz0gYAoJCSAgICAgICAgPGRpdiBkYXRhLW9wdGlvbnM9InJlZ2lvbjonJHt6fSciIHRpdGxlPSIkeyh6PT0nd2VzdCcgfHwgej09J2Vhc3QnKT8nJm5ic3A7JzonJ30iIHN0eWxlPSdoZWlnaHQ6JHsoej09J25vcnRoJ3x8ej09J3NvdXRoJyk/MTA6MTAwfSU7d2lkdGg6JHsoKHo9PSdlYXN0J3x8ej09J3dlc3QnKT8wLjE6MSkqdGhpcy5jV2lkdGgob3B0aW9ucyl9cHgnPgogICAgICAgIAkJICAgICR7KEFycmF5LmlzQXJyYXkob3B0aW9uc1t6XSk/b3B0aW9uc1t6XTpbb3B0aW9uc1t6XV0pLmpvaW4oJycpfQogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIGA7CgkJfSk7CgoJCXJldCArPSBgPC9kaXY+PC9kaXY+YDsKCgkJLy8gbGlua3MgKHRvb2xzKQoJCWxldCBsaW5rcyA9ICQuZ3JlcChbXS5jb25jYXQob3B0aW9ucy5saW5rcyB8fCBbXSksIGwgPT4gIWwuaWdub3JlKTsKCQlyZXQgKz0gYDxkaXYgaWQ9IiR7b3B0aW9ucy5uYW1lfV90b29scyI+YCArICQubWFwKGxpbmtzLnJldmVyc2UoKSwgbCA9PiBgPGEgaHJlZj0iamF2YXNjcmlwdDp2b2lkKDApIiBzdHlsZT0iY29sb3I6YmxhY2siIGNsYXNzPSJmYXMgZmEtJHtsLmljb24gfHwgJ2FkZCd9IiBvbmNsaWNrPScoYXN5bmMgKCkgPT4ge3ZhciBhID0gJHtfRnJFTUQuX3RvSlMobCl9OyAkKCIjcG5sJHtvcHRpb25zLm5hbWV9Iikud2luZG93KCJzZXRUaXRsZSIsICIke29wdGlvbnMudGl0bGV9OiAiICsgYS5uYW1lKTsgYXdhaXQgYS5hY3Rpb24oREZvcm0uZ2V0KCksIGEsICR7X0ZyRU1ELl90b0pTKG9wdGlvbnMpfSk7ICQoIiNwbmwke29wdGlvbnMubmFtZX0iKS53aW5kb3coInNldFRpdGxlIiwgIiR7b3B0aW9ucy50aXRsZX0iKTt9KSgpJz48L2E+YCkuam9pbignXG4nKSArIGA8L2Rpdj5gOwoKCQlyZXR1cm4gcmV0OwoJfQoKCWFzeW5jIF9lbmQoKSB7CgkJbGV0IG8gPSB0aGlzLmdldCgpOwoKCQkvLyBkbyBub3QgdXNlIHRoZSBmaXJzdCBidXR0b24sIGJlY2F1c2UgbWFueSBmb3JtcyBoYXZlIGEgQ2FuY2VsIGJ1dHRvbiBvbmx5CgkJbGV0IGJ1dHRvbiA9IHRoaXMuYnV0dG9ucy5maW5kKGIgPT4gYi5hdXRvU3VibWl0KSAvKiB8fCB0aGlzLmJ1dHRvbnNbMF0qLyA7CgkJaWYgKGJ1dHRvbiAmJiBvICYmIE9iamVjdC52YWx1ZXMobykubGVuZ3RoICYmICh0eXBlb2YoYnV0dG9uLmF1dG9TdWJtaXQpID09PSAidW5kZWZpbmVkIiB8fCBidXR0b24uYXV0b1N1Ym1pdCkpIHsKCQkJbGV0IHYgPSBPYmplY3QudmFsdWVzKG8pLnJlZHVjZSgodCwgdikgPT4gewoJCQkJcmV0dXJuICgodHlwZW9mKHYpICE9PSAib2JqZWN0IikgPyAxIDogMCkgKiAodiA/IDEgOiAwKTsKCQkJfSk7CgkJCS8vY29uc29sZS5sb2cobywgT2JqZWN0LnZhbHVlcyhvKSwgdik7CgkJCWlmICh2KSB7CgkJCQkvLyBhbGwgZmllbGRzIGhhdmUgdmFsdWVzCgkJCQlhd2FpdCB0aGlzLmRvQ2xpY2soYnV0dG9uKTsKCgkJCX0KCQl9Cgl9CgoJZm9vdGVyKGJGaXhlZCkgewoJCXJldHVybiBgPC9mb3JtPmAgKyBgPGRpdiBpZD0iZGxnLWJ1dHRvbnMiPmAgKyB0aGlzLmJ1dHRvbnMuZmlsdGVyKGIgPT4gIWIud2luZG93KS5tYXAoYiA9PiBgPGEgaWQ9JyR7Yi5uYW1lfScgaHJlZj0iamF2YXNjcmlwdDp2b2lkKDApIiBjbGFzcz0iZWFzeXVpLWxpbmtidXR0b24gYzYiIGljb25DbHM9Imljb24tJHtiLmljb24gfHwgJ3NhdmUnfSIgc3R5bGU9IndpZHRoOiR7TWF0aC5taW4oMTIwLCB0aGlzLndpZHRoICogMC45NSAvIHRoaXMuYnV0dG9ucy5sZW5ndGgsIHRoaXMuY1dpZHRoKCkpfXB4IiBvbmNsaWNrPSd0aGlzLmRvQ2xpY2soJHtfRnJFTUQuX3RvSlMoYil9KSc+JHtiLnRpdGxlIHx8IGIubmFtZX08L2E+Jm5ic3A7Jm5ic3A7YCkuam9pbignJykgKyAiPC9kaXY+IiArIChiRml4ZWQgPyAiIiA6ICc8L2Rpdj4nKTsKCX0KCgloZWFkZXIobmFtZSwgdGl0bGUsIGJGaXhlZCwgbGlua3MpIHsKCQl0aGlzLnRpdGxlID0gdGl0bGUgfHwgdGhpcy50aXRsZTsKCQluYW1lID0gbmFtZSB8fCB0aGlzLm5hbWU7CgkJdmFyIHJldCA9ICcnOwoKCQlyZXQgKz0gdGhpcy53aW5kb3coewoJCQluYW1lOiAiX19Db25zb2xlIiwKCQkJdHlwZTogIndpbmRvdyIsCgkJCWVkaXRvcjogdHJ1ZSwKCQkJbG9hZGVyOiBvID0+IHdpbmRvdy5sb2dzLnNsaWNlKCkucmV2ZXJzZSgpLm1hcChsID0+IGwuZGF0ZS50b0lTT1N0cmluZygpICsgIjogIiArIGwuYXJncy5tYXAocyA9PiB0eXBlb2YocykgPT09ICdvYmplY3QnID8gKChvYmosIGluZGVudCA9IDIpID0+IHsKCQkJCWxldCBjYWNoZSA9IFtdOwoJCQkJY29uc3QgcmV0VmFsID0gSlNPTi5zdHJpbmdpZnkoCgkJCQkJb2JqLAoJCQkJCShrZXksIHZhbHVlKSA9PgoJCQkJCXR5cGVvZiB2YWx1ZSA9PT0gIm9iamVjdCIgJiYgdmFsdWUgIT09IG51bGwgPwoJCQkJCWNhY2hlLmluY2x1ZGVzKHZhbHVlKSA/CgkJCQkJdW5kZWZpbmVkIC8vIER1cGxpY2F0ZSByZWZlcmVuY2UgZm91bmQsIGRpc2NhcmQga2V5CgkJCQkJOgoJCQkJCWNhY2hlLnB1c2godmFsdWUpICYmIHZhbHVlIC8vIFN0b3JlIHZhbHVlIGluIG91ciBjb2xsZWN0aW9uCgkJCQkJOgoJCQkJCXZhbHVlLAoJCQkJCWluZGVudAoJCQkJKTsKCQkJCWNhY2hlID0gbnVsbDsKCQkJCXJldHVybiByZXRWYWw7CgkJCX0pKHMpIDogcykuam9pbignLCAnKSkuam9pbignXG4nKSwKCQl9KTsKCgkJaWYgKCFiRml4ZWQpIHsKCQkJbGlua3MgPSAobGlua3MgfHwgW10pLmZpbHRlcihsID0+ICFsLmlnbm9yZSk7CgkJCWxldCB0RGF0YSA9ICIiOwoJCQlpZiAobGlua3MubGVuZ3RoKSB7CgkJCQlyZXQgKz0gYDxkaXYgaWQ9IiR7dGhpcy5uYW1lfV90b29scyI+YCArIGxpbmtzLm1hcChsID0+IGA8YSBocmVmPSJqYXZhc2NyaXB0OnZvaWQoMCkiIGNsYXNzPSJpY29uLSR7bC5pY29ufSIgb25jbGljaz0nKGFzeW5jICgpID0+IHt2YXIgYSA9ICR7X0ZyRU1ELl90b0pTKGwpfTsgJCgiI3dpbiR7dGhpcy5uYW1lfSIpLndpbmRvdygic2V0VGl0bGUiLCAiJHt0aGlzLnRpdGxlfTogIiArIGEubmFtZSk7IGF3YWl0IGEuYWN0aW9uKERGb3JtLmdldCgpKTsgJCgiI3dpbiR7dGhpcy5uYW1lfSIpLndpbmRvdygic2V0VGl0bGUiLCAiJHt0aGlzLnRpdGxlfSIpO30pKCknPjwvYT5gKS5qb2luKCdcbicpICsgIjwvZGl2PiI7CgkJCQl0RGF0YSA9IGAsdG9vbHM6IiMke3RoaXMubmFtZX1fdG9vbHMiYDsKCQkJfQoJCQlyZXQgKz0gYDxkaXYgaWQ9J3dpbiR7dGhpcy5uYW1lfScgY2xhc3M9J2Vhc3l1aS13aW5kb3cnIHRpdGxlPScke3RoaXMudGl0bGV9JyBkYXRhLW9wdGlvbnM9J2ljb25DbHM6Imljb24tc2F2ZSIgJHt0RGF0YX0nIHN0eWxlPSd3aWR0aDoke3RoaXMud2lkdGh9cHg7aGVpZ2h0OiR7dGhpcy5oZWlnaHR9cHg7cGFkZGluZzoxMHB4Oyc+YDsKCQl9CgkJcmV0dXJuIHJldCArIGA8Zm9ybSBpZD0iZnJtJHt0aGlzLm5hbWV9IiBtZXRob2Q9InBvc3QiIG5vdmFsaWRhdGU+YDsKCX0KCglyZW5kZXJFbGVtZW50cyhlbGVtZW50cykgewoJCWVsZW1lbnRzID0gZWxlbWVudHMgfHwgdGhpcy5lbGVtZW50czsKCgkJdmFyIHRXaWR0aCA9IE1hdGguZmxvb3IodGhpcy53aWR0aCAqIDAuOTUpOwoJCXZhciB0SGVpZ2h0ID0gTWF0aC5mbG9vcih0aGlzLmhlaWdodCAqIDAuODUpOwoKCQlsZXQgcmV0ID0gJyc7CgkJdmFyIGdFbGVtZW50cyA9IHRoaXMuc3IoKS5ncm91cEJ5KGVsZW1lbnRzLCAiZ3JvdXAiKTsKCQlpZiAoZ0VsZW1lbnRzLmxlbmd0aCA+IDEpIHJldCArPSBgPGRpdiBpZD0idGJjV2luZG93IiBjbGFzcz0iZWFzeXVpLXRhYnMiIGRhdGEtb3B0aW9ucz0nJHt0aGlzLmV2ZW50SGFuZGxlcnMoe3R5cGU6ICd0YWJzJ30pfScgc3R5bGU9IndpZHRoOiR7dFdpZHRofXB4O2hlaWdodDoke3RIZWlnaHR9cHg7Ij5gOwoJCWZvciAodmFyIGcgPSAwOyBnIDwgZ0VsZW1lbnRzLmxlbmd0aDsgZysrKSB7CgkJCWlmIChnRWxlbWVudHMubGVuZ3RoID4gMSkgcmV0ICs9ICc8ZGl2IHRpdGxlPSInICsgKGdFbGVtZW50c1tnXS5rZXkgfHwgIk1haW4iKSArICciIHN0eWxlPSJwYWRkaW5nOjIwcHg7ZGlzcGxheTpub25lOyI+JzsKCQkJdmFyIHNFbGVtZW50cyA9IHRoaXMuc3IoKS5ncm91cEJ5KGdFbGVtZW50c1tnXS52YWx1ZXMsICJzZWN0aW9uIik7CgkJCWlmIChzRWxlbWVudHMubGVuZ3RoID4gMSkgcmV0ICs9ICc8ZGl2IGNsYXNzPSJlYXN5dWktYWNjb3JkaW9uIiBzdHlsZT0id2lkdGg6JyArIHRXaWR0aCArICdweDtoZWlnaHQ6JyArIC8qdEhlaWdodCovICIxMDAlIiArICdweDsiPic7CgkJCWZvciAodmFyIHMgPSAwOyBzIDwgc0VsZW1lbnRzLmxlbmd0aDsgcysrKSB7CgkJCQlyZXQgKz0gYDxkaXYgdGl0bGU9IiR7c0VsZW1lbnRzW3NdLmtleSB8fCAiIn0iIGRhdGEtb3B0aW9ucz0iaWNvbkNsczonaWNvbi1tb3JlJyIgc3R5bGU9InBhZGRpbmc6MTBweDsiPmA7CgkJCQlmb3IgKHZhciBpID0gMDsgaSA8IHNFbGVtZW50c1tzXS52YWx1ZXMubGVuZ3RoOyBpKyspIHsKCQkJCQl2YXIgZSA9IHNFbGVtZW50c1tzXS52YWx1ZXNbaV07CgkJCQkJaWYgKGUuaWdub3JlKSBjb250aW51ZTsKCQkJCQllLnZhbHVlID0gZS52YWx1ZSB8fCBfRnJFTUQuaGFzaFtlLm5hbWVdIHx8IChfRnJFTUQuYXBpU2VydmVyID8gX0ZyRU1ELmFwaVNlcnZlci5fX2NvbmZpZygndGVzdF8nICsgZS5uYW1lLCAnJykgOiAnJyk7CgkJCQkJcmV0ICs9IGA8ZGl2IGlkPSJmRWxlbWVudF8ke2UubmFtZX0iIGNsYXNzPSJmaXRlbSIgc3R5bGU9ImRpc3BsYXk6ICR7KGUudHlwZT09J3dpbmRvdycgfHwgZS5oaWRkZW4pPydub25lJzonJ30iPmA7CgkJCQkJaWYgKGUudG9nZ2xlKSB7CgkJCQkJCXJldCArPSBgPGEgaHJlZj0iIyIgY2xhc3M9ImVhc3l1aS1saW5rYnV0dG9uIiBkYXRhLW9wdGlvbnM9JyR7dGhpcy5ldmVudEhhbmRsZXJzKHt0eXBlOiAndG9nZ2xlJywgZm9yOiBlfSl9LHBsYWluOnRydWUsaWNvbkNsczoiaWNvbi0ke2UuaWNvbiB8fCAnc2VhcmNoJ30iJyBzdHlsZT0id2lkdGg6MTAwcHg7aGVpZ2h0OjMwcHgiPiR7ZS50aXRsZSB8fCB0aGlzLmVuZ2xpc2goZS5uYW1lKX08L2E+YDsKCQkJCQl9IGVsc2UgewoJCQkJCQlyZXQgKz0gYDxsYWJlbD4ke2UudGl0bGUgfHwgdGhpcy5lbmdsaXNoKGUubmFtZSl9OjwvbGFiZWw+YDsKCQkJCQl9CgkJCQkJaWYgKGUudHlwZSAmJiB0aGlzW2UudHlwZV0pIHsKCQkJCQkJcmV0ICs9IHRoaXNbZS50eXBlXShlKTsKCQkJCQl9IGVsc2UgaWYgKGUucmVuZGVyKSB7CgkJCQkJCXJldCArPSBlLnJlbmRlcigpOwoJCQkJCX0KCQkJCQlyZXQgKz0gJzwvZGl2Pic7CgkJCQl9CgkJCQlyZXQgKz0gJzwvZGl2Pic7CgkJCX0KCQkJaWYgKHNFbGVtZW50cy5sZW5ndGggPiAxKSByZXQgKz0gJzwvZGl2Pic7CgkJCWlmIChnRWxlbWVudHMubGVuZ3RoID4gMSkgcmV0ICs9ICI8L2Rpdj4iOwoJCX0KCQlpZiAoZ0VsZW1lbnRzLmxlbmd0aCA+IDEpIHJldCArPSAiPC9kaXY+IjsKCQlyZXR1cm4gcmV0OwoJfQoKCWluZm8obXNnKSB7CgkJaWYgKCQubWVzc2FnZXIpIHsKCQkJJC5tZXNzYWdlci5hbGVydCh0aGlzLnRpdGxlLCBtc2csICdpbmZvJyk7CgkJfSBlbHNlIHsKCQkJdGhpcy5zcigpLlNob3dNZXNzYWdlKG1zZywgdGhpcy50aXRsZSk7CgkJfQoJfQoKCWVycm9yKG1zZykgewoJCWlmICgkLm1lc3NhZ2VyKSB7CgkJCSQubWVzc2FnZXIuYWxlcnQodGhpcy50aXRsZSwgbXNnLCAnZXJyb3InKTsKCQl9IGVsc2UgewoJCQl0aGlzLnNyKCkuU2hvd01lc3NhZ2UobXNnLCB0aGlzLnRpdGxlKTsKCQl9Cgl9CgoJYnlOYW1lKG5hbWUpIHsKCQlyZXR1cm4gdGhpcy5lbGVtZW50cy5maW5kKGUgPT4gZS5uYW1lID09PSBuYW1lKTsKCX0KCgkvKiogQ29tcG9uZW50czo6U3RhcnQgKiovCglDb3JlQ29tcG9uZW50ID0gY2xhc3MgewoJCWNvbnN0cnVjdG9yKHBhZ2UsIGRGb3JtKSB7CgkJCXRoaXMucGFnZSA9IHBhZ2U7CgkJCXRoaXMuZEZvcm0gPSBkRm9ybTsKCQl9CgoJCWJ1c3koYkJ1c3kpIHsKCQkJcmV0dXJuIHRoaXMuZEZvcm0uYnVzeShiQnVzeSk7CgkJfQoKCQlfbWUodikgewoJCQlsZXQgbWVOYW1lID0gKHR5cGVvZihjb21wYW55KSAhPT0gJ3VuZGVmaW5lZCcpID8gKGNvbXBhbnkubG9nZ2VkSW5JZGVudGl0eSB8fCAibWUiKSA6ICJtZSI7CgkJCWlmICh2KSB7CgkJCQl3aW5kb3dbbWVOYW1lXSA9IHY7CgkJCX0KCgkJCXJldHVybiB3aW5kb3dbbWVOYW1lXTsKCQl9CgoJCV9jYW5WaWV3KCkgewoJCQlpZiAoIXRoaXMuX21lKCkpIHsKCQkJCXdpbmRvdy5fRnJFTUQuc2V0VVJMKHsKCQkJCQlwYWdlOiAnbG9naW4nLAoJCQkJCV9yZWRpcmVjdDogdGhpcy5wYWdlLl9jb2RlLAoJCQkJfSk7CgkJCQl0aHJvdyBgX2NhblZpZXc6ICR7dGhpcy5wYWdlLl9jb2RlfSBub3QgYWxsb3dlZCB3aXRob3V0IGxvZ2luIWA7CgkJCX0KCQl9CgoJCV9uYW1lKCkgewoJCQlpZiAoIXRoaXMuX21lKCkpIHJldHVybiAiIjsKCQkJcmV0dXJuIHRoaXMuX21lKCkubmFtZSA/IHRoaXMuX21lKCkubmFtZSgpIDogdGhpcy5fbWUoKS5Ub1N0cmluZzsKCQl9Cgl9CgoJSW5kZXhDb21wb25lbnQgPSBjbGFzcyBleHRlbmRzIHRoaXMuQ29yZUNvbXBvbmVudCB7CgkJYXN5bmMgbWFpbigpIHsKCQkJdGhpcy5fY2FuVmlldygpOwoKCQkJdGhpcy5wYWdlLmRhdGEgPSB7CgkJCQlmb3JtOiB0aGlzLmRGb3JtLnJlbmRlcignZnJtSW5kZXgnLCAiTWFpbiBQYWdlIiwgW3sKCQkJCQluYW1lOiAnV2VsY29tZScsCgkJCQkJcmVxdWlyZWQ6IHRydWUsCgkJCQkJdHlwZTogImxhYmVsIiwKCQkJCQl2YWx1ZTogdGhpcy5fbmFtZSgpLAoJCQkJfV0sIFtdKQoJCQl9OwoJCX0KCX0KCglMb2dpbkNvbXBvbmVudCA9IGNsYXNzIGV4dGVuZHMgdGhpcy5Db3JlQ29tcG9uZW50IHsKCQlhc3luYyBfYXV0aGVudGljYXRlKG8pIHsKCQkJcmV0dXJuIG51bGw7CgkJfQoKCQlhc3luYyBfbG9nZ2VkSW4oKSB7fQoKCQlhc3luYyBfbm90TG9nZ2VkSW4oKSB7fQoKCQlhc3luYyBtYWluKCkgewoJCQl0aGlzLnBhZ2UuZGF0YSA9IHsKCQkJCWZvcm06IHRoaXMuZEZvcm0ucmVuZGVyKCdmcm1Mb2dpbicsICJVc2VyIEF1dGhlbnRpY2F0aW9uIiwgW3sKCQkJCQkJbmFtZTogJ1VzZXJuYW1lJywKCQkJCQkJcmVxdWlyZWQ6IHRydWUsCgkJCQkJCXR5cGU6ICJzdHJpbmciCgkJCQkJfSwKCQkJCQl7CgkJCQkJCW5hbWU6ICdQYXNzd29yZCcsCgkJCQkJCXJlcXVpcmVkOiB0cnVlLAoJCQkJCQl0eXBlOiAicGFzc3dvcmQiCgkJCQkJfQoJCQkJXSwgW3sKCQkJCQluYW1lOiAnTG9naW4nLAoJCQkJCWF1dG9TdWJtaXQ6IHRydWUsCgkJCQkJb25jbGljazogYXN5bmMgbyA9PiB7CgkJCQkJCWxldCByZXQgPSBhd2FpdCB0aGlzLl9hdXRoZW50aWNhdGUobyk7CgoJCQkJCQlpZiAocmV0KSB7CgkJCQkJCQl0aGlzLl9tZShyZXQpOwoKCQkJCQkJCXRyeSB7CgkJCQkJCQkJYXdhaXQgdGhpcy5fbG9nZ2VkSW4oKTsKCQkJCQkJCX0gY2F0Y2ggKGV4KSB7fQoKCQkJCQkJCV9GckVNRC5zZXRVUkwoewoJCQkJCQkJCXBhZ2U6IF9GckVNRC5oYXNoLl9yZWRpcmVjdCB8fCAiaW5kZXgiCgkJCQkJCQl9KTsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCXRyeSB7CgkJCQkJCQkJYXdhaXQgdGhpcy5fbm90TG9nZ2VkSW4oKTsKCQkJCQkJCX0gY2F0Y2ggKGV4KSB7fQoKCQkJCQkJCXRoaXMuZEZvcm0uZXJyb3IoIkludmFsaWQgdXNlcm5hbWUgb3IgcGFzc3dvcmQiKTsKCQkJCQkJfQoKCQkJCQkJdGhpcy5kRm9ybS5idXN5KGZhbHNlKTsKCQkJCQl9CgkJCQl9XSkKCQkJfTsKCQl9Cgl9CgoJU3RvcmVDb21wb25lbnQgPSBjbGFzcyBleHRlbmRzIHRoaXMuQ29yZUNvbXBvbmVudCB7CgkJYXN5bmMgbWFpbigpIHsKCQkJdGhpcy5fY2FuVmlldygpOwoKCQkJY29uc29sZS5sb2coIkdlbmVyYXRpbmcgQ1JVRCBwYWdlIGZvcjogIiwgdGhpcy5wYWdlKTsKCgkJCXRoaXMucGFnZS5kYXRhID0gYXdhaXQgdGhpcy5kRm9ybS5DUlVEKHRoaXMucGFnZS5kYXRhKTsKCQl9Cgl9CgkvKiogQ29tcG9uZW50czo6RW5kICoqLwp9Ow==",
	"Name": "DynaForm",
	"Script": "d2luZG93LkR5bmFGb3JtID0gY2xhc3MgewoJY29uc3RydWN0b3IoKSB7CgkJdGhpcy50aXRsZSA9ICJGb3JtIFRpdGxlIjsKCQl0aGlzLm5hbWUgPSAiZnJtRm9ybSI7CgkJdGhpcy5lbGVtZW50cyA9IFtdOwoJCXRoaXMuc2VsZWN0cyA9IFtdOwoJCXRoaXMuZ3JpZHMgPSBbXTsKCQl0aGlzLmJ1dHRvbnMgPSBbXTsKCQl0aGlzLnpvbmVzID0gWydub3J0aCcsICdzb3V0aCcsICdlYXN0JywgJ3dlc3QnLCAnY2VudGVyJ107CgkJdGhpcy5zVGFibGUgPSBudWxsOwoJCXRoaXMuYkRlYnVnID0gZmFsc2U7CgkJdGhpcy51aVR5cGVzID0gewoJCQlpbnQ6ICJudW1iZXJzcGlubmVyIiwKCQkJbWVudTogInNwbGl0YnV0dG9uIiwKCQkJZGF0ZXRpbWU6ICJkYXRldGltZWJveCIsCgkJCWJvb2w6ICJzd2l0Y2hidXR0b24iLAoJCQlmaWxlOiAiZmlsZWJveCIsCgkJCXRleHQ6ICJ0ZXh0Ym94IiwKCQkJcGFzc3dvcmQ6ICJwYXNzd29yZGJveCIsCgkJCXN0cmluZzogInRleHRib3giLAoJCQlpbWFnZTogImRpYWxvZyIsCgkJCXByb2dyZXNzOiAicHJvZ3Jlc3NiYXIiLAoJCQlsaW5rOiAibGlua2J1dHRvbiIsCgkJCXRyZWU6ICJjb21ib3RyZWUiLAoJCQluYXZpZ2F0aW9uOiAidHJlZSIsCgkJCXNlYXJjaDogJ3NlYXJjaGJveCcsCgkJfTsKCQl0aGlzLmV2ZW50cyA9IFt7CgkJCW5hbWU6ICdvbkNsaWNrJywKCQkJaGFuZGxlcjogJ29uVG9nZ2xlJywKCQkJcGFyYW1zOiAnbj1ldmVudCcsCgkJCXR5cGU6ICd0b2dnbGUnLAoJCX0sIHsKCQkJbmFtZTogJ29uQ2xvc2UnLAoJCQloYW5kbGVyOiAnUGFuT25DbG9zZScsCgkJCXBhcmFtczogJ249ZXZlbnQnLAoJCQl0eXBlOiAnd2luZG93JywKCQl9LCB7CgkJCW5hbWU6ICdvblNlbGVjdCcsCgkJCWhhbmRsZXI6ICdTZWxlY3RDaGFuZ2UnLAoJCQlwYXJhbXM6ICduJywKCQkJdHlwZTogJ3RhYnMnLAoJCX0sIHsKCQkJbmFtZTogJ3NlYXJjaGVyJywKCQkJaGFuZGxlcjogJ0ZpZWxkQ2hhbmdlJywKCQkJcGFyYW1zOiAnbiwgbycsCgkJCXR5cGU6ICdzZWFyY2hib3gnLAoJCX0sIHsKCQkJbmFtZTogJ29uQmVmb3JlRXhwYW5kJywKCQkJaGFuZGxlcjogJ0V4cGFuZCcsCgkJCXBhcmFtczogJ24nLAoJCQl0eXBlOiAndHJlZScsCgkJfSwgewoJCQluYW1lOiAnb25DaGFuZ2UnLAoJCQloYW5kbGVyOiAnRmllbGRDaGFuZ2UnLAoJCQlwYXJhbXM6ICduLCBvJwoJCX0sIHsKCQkJbmFtZTogJ29uQmVmb3JlT3BlbicsCgkJCWhhbmRsZXI6ICdQYW5lbE9wZW4nLAoJCQlwYXJhbXM6ICcnLAoJCQl0eXBlOiAnd2luZG93JywKCQl9LCB7CgkJCW5hbWU6ICdvbk9wZW4nLAoJCQloYW5kbGVyOiAnUGVuZEFmdGVyT3BlbicsCgkJCXBhcmFtczogJycsCgkJCXR5cGU6ICd3aW5kb3cnLAoJCX0sIHsKCQkJbmFtZTogJ29uQ2xpY2snLAoJCQloYW5kbGVyOiAnZG9MaW5rJywKCQkJcGFyYW1zOiAnbj1ldmVudCwgbycsCgkJCXR5cGU6ICdsaW5rJywKCQl9LCB7CgkJCW5hbWU6ICdvbkNsaWNrUm93JywKCQkJaGFuZGxlcjogJ0ZpZWxkQ2hhbmdlJywKCQkJcGFyYW1zOiAnbiwgbycsCgkJCXR5cGU6ICdncmlkJywKCQl9XTsKCgkJaWYgKHR5cGVvZigkKSAhPT0gJ3VuZGVmaW5lZCcpICQod2luZG93KS5yZXNpemUodGhpcy53aW5kb3dSZXNpemVkKTsKCQl0aGlzLndpbmRvd1Jlc2l6ZWQoKTsKCX0KCglzcigpIHsKCQlyZXR1cm4gdHlwZW9mKF9GckVNRCkgIT09ICd1bmRlZmluZWQnID8gX0ZyRU1ELnNyKCkgOiB3aW5kb3cuc3I7Cgl9CgoJcGFyc2UoKSB7CgkJJC5wYXJzZXIucGFyc2UoKTsKCX0KCgl3aW5kb3dSZXNpemVkKCkgewoJCXRoaXMud2lkdGggPSB3aW5kb3cuaW5uZXJXaWR0aDsKCQl0aGlzLmhlaWdodCA9IHdpbmRvdy5pbm5lckhlaWdodCAqIDAuODsKCX0KCglpbml0KCkgewoJCXZhciBzZWxlY3QgPSB7CgkJCWluaXQ6IGZ1bmN0aW9uKGNvbnRhaW5lciwgb3B0aW9ucykgewoJCQkJdmFyIG9wID0gbnVsbDsKCQkJCXZhciBmb3AgPSBudWxsOwoJCQkJZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmdyaWRzLmxlbmd0aDsgaSsrKQoJCQkJCWlmICh0aGlzLmdyaWRzW2ldLmlkID09IG9wdGlvbnMuc291cmNlKSBvcCA9IHRoaXMuZ3JpZHNbaV0ub3B0aW9uczsKCQkJCWZvciAoaSA9IDA7IGkgPCBvcC5jb2x1bW5zLmxlbmd0aDsgaSsrKQoJCQkJCWlmIChvcC5jb2x1bW5zW2ldLm5hbWUgPT0gb3B0aW9ucy5maWVsZCkgZm9wID0gb3AuY29sdW1uc1tpXTsKCQkJCWZvcC53aWR0aCA9ICh0aGlzLndpZHRoIC8gMyk7CgkJCQl2YXIgZSA9ICQodGhpcy5zZWxlY3QoZm9wKSk7CgkJCQl2YXIgaW5wdXQgPSBlLmFwcGVuZFRvKGNvbnRhaW5lcik7CgkJCQlpbnB1dC5jb21ib2dyaWQoKTsKCQkJCXRoaXMuYmluZChpbnB1dCk7CgkJCQlyZXR1cm4gaW5wdXQ7CgkJCX0sCgkJCWRlc3Ryb3k6IGZ1bmN0aW9uKHRhcmdldCkgewoJCQkJJCh0YXJnZXQpLnJlbW92ZSgpOwoJCQl9LAoJCQlnZXRWYWx1ZTogZnVuY3Rpb24odGFyZ2V0KSB7CgkJCQlyZXR1cm4gJCh0YXJnZXQpLnZhbCgpOwoJCQl9LAoJCQlzZXRWYWx1ZTogZnVuY3Rpb24odGFyZ2V0LCB2YWx1ZSkgewoJCQkJJCh0YXJnZXQpLnZhbCh2YWx1ZSk7CgkJCX0sCgkJCXJlc2l6ZTogZnVuY3Rpb24odGFyZ2V0LCB3aWR0aCkgewoJCQkJJCh0YXJnZXQpLl9vdXRlcldpZHRoKHdpZHRoKTsKCQkJfQoJCX07CgkJJC5leHRlbmQoJC5mbi5kYXRhZ3JpZC5kZWZhdWx0cy5lZGl0b3JzLCB7CgkJCWRhdGV0aW1lOiB7CgkJCQlpbml0OiBmdW5jdGlvbihjb250YWluZXIsIG9wdGlvbnMpIHsKCQkJCQlvcHRpb25zLndpZHRoID0gdGhpcy5jV2lkdGgob3B0aW9ucyk7CgkJCQkJdmFyIGlucHV0ID0gJCh0aGlzLmRhdGV0aW1lKG9wdGlvbnMpKS5hcHBlbmRUbyhjb250YWluZXIpOwoJCQkJCWlucHV0LmRhdGV0aW1lYm94KCk7CgkJCQkJcmV0dXJuIGlucHV0OwoJCQkJfSwKCQkJCWRlc3Ryb3k6IGZ1bmN0aW9uKHRhcmdldCkgewoJCQkJCSQodGFyZ2V0KS5yZW1vdmUoKTsKCQkJCX0sCgkJCQlnZXRWYWx1ZTogZnVuY3Rpb24odGFyZ2V0KSB7CgkJCQkJcmV0dXJuICQodGFyZ2V0KS52YWwoKTsKCQkJCX0sCgkJCQlzZXRWYWx1ZTogZnVuY3Rpb24odGFyZ2V0LCB2YWx1ZSkgewoJCQkJCSQodGFyZ2V0KS52YWwodmFsdWUpOwoJCQkJfSwKCQkJCXJlc2l6ZTogZnVuY3Rpb24odGFyZ2V0LCB3aWR0aCkgewoJCQkJCSQodGFyZ2V0KS5fb3V0ZXJXaWR0aCh3aWR0aCk7CgkJCQl9CgkJCX0sCgkJCWNoZWNrYm94OiB7CgkJCQlpbml0OiBmdW5jdGlvbihjb250YWluZXIsIG9wdGlvbnMpIHsKCQkJCQl2YXIgaW5wdXQgPSAkKHRoaXMuYm9vbChvcHRpb25zKSkuYXBwZW5kVG8oY29udGFpbmVyKTsKCQkJCQlpbnB1dC5zd2l0Y2hidXR0b24oKTsKCQkJCQlyZXR1cm4gaW5wdXQ7CgkJCQl9LAoJCQkJZGVzdHJveTogZnVuY3Rpb24odGFyZ2V0KSB7CgkJCQkJJCh0YXJnZXQpLnJlbW92ZSgpOwoJCQkJfSwKCQkJCWdldFZhbHVlOiBmdW5jdGlvbih0YXJnZXQpIHsKCQkJCQlyZXR1cm4gJCh0YXJnZXQpLnZhbCgpOwoJCQkJfSwKCQkJCXNldFZhbHVlOiBmdW5jdGlvbih0YXJnZXQsIHZhbHVlKSB7CgkJCQkJJCh0YXJnZXQpLnZhbCh2YWx1ZSk7CgkJCQl9LAoJCQkJcmVzaXplOiBmdW5jdGlvbih0YXJnZXQsIHdpZHRoKSB7CgkJCQkJJCh0YXJnZXQpLl9vdXRlcldpZHRoKHdpZHRoKTsKCQkJCX0KCQkJfSwKCQkJY29tYm90cmVlZ3JpZDogc2VsZWN0LAoJCQlzZWxlY3Q6IHNlbGVjdCwKCQl9KTsKCX0KCglhc2socXVlc3Rpb24sIGZBbnN3ZXIgPSB2ID0+IHYsIG9wdGlvbnMpIHsKCQkkLm1lc3NhZ2VyLmNvbmZpcm0odGhpcy50aXRsZSwgcXVlc3Rpb24sIGZ1bmN0aW9uKHIpIHsKCQkJaWYgKG9wdGlvbnMpIHsKCQkJCWZvciAodmFyIGkgPSAwOyBpIDwgb3B0aW9ucy5sZW5ndGg7IGkrKykgewoJCQkJCWlmIChvcHRpb25zW2ldLmFuc3dlciA9PSByKSB7CgkJCQkJCXJldHVybiBmQW5zd2VyKG9wdGlvbnNbaV0udmFsdWUpOwoJCQkJCX0KCQkJCX0KCQkJfSBlbHNlIHsKCQkJCXJldHVybiBmQW5zd2VyKHIpOwoJCQl9CgkJfSk7Cgl9CgoJdG9wRGF0YShhciwgZ0ZpZWxkLCB2RmllbGQsIHRvcCkgewoJCWlmICghdG9wKSB7CgkJCXJldHVybiBhcjsKCQl9CgkJcmV0ID0gW107CgkJJC5lYWNoKHRoaXMuc3IoKS5ncm91cEJ5KGFyLCBnRmllbGQpLCBmdW5jdGlvbihrZXksIHZhbHVlcykgewoJCQl2YWx1ZXMudmFsdWVzLnNvcnQoKGEsIGIpID0+IHsKCQkJCWlmIChwYXJzZUZsb2F0KGFbdkZpZWxkXSkgPCBwYXJzZUZsb2F0KGJbdkZpZWxkXSkpIHsKCQkJCQlyZXR1cm4gMTsKCQkJCX0gZWxzZSBpZiAocGFyc2VGbG9hdChhW3ZGaWVsZF0pID4gcGFyc2VGbG9hdChiW3ZGaWVsZF0pKSB7CgkJCQkJcmV0dXJuIC0xOwoJCQkJfSBlbHNlIHsKCQkJCQlyZXR1cm4gMDsKCQkJCX0KCQkJfSk7CgkJCSQuZWFjaCh2YWx1ZXMudmFsdWVzLCBmdW5jdGlvbihpLCB2KSB7CgkJCQlpZiAoaSA8IHRvcCkgewoJCQkJCXJldC5wdXNoKHYpOwoJCQkJfQoJCQl9KTsKCQl9KTsKCQlyZXR1cm4gcmV0OwoJfQoKCWFzeW5jIENSVUQoc1RhYmxlLCBiRml4ZWQpIHsKCQl2YXIgZmllbGRzID0gW107CgkJdGhpcy5zVGFibGUgPSBzVGFibGU7CgkJaWYgKHdpbmRvdy5iTG9jYWwgJiYgY29tcGFueS5saWJyYXJ5KSB7CgkJCXZhciByZXQgPSBhd2FpdCB0aGlzLnNyKCkuXygiQ29udGVudE1hbmFnZXIuY21zR2VuZXJhdGVMYXllckNsYXNzIiwgbnVsbCwgY29tcGFueS5saWJyYXJ5ICsgIi4iICsgc1RhYmxlKTsKCQkJZmllbGRzLnB1c2goewoJCQkJZ3JvdXA6ICJNYWluIiwKCQkJCWF0dHJpYnV0ZTogewoJCQkJCVJlbGF0aW9uQ2xhc3M6IHsKCQkJCQkJTmFtZTogc1RhYmxlCgkJCQkJfQoJCQkJfSwKCQkJCW5hbWU6IHRoaXMuc1RhYmxlLAoJCQkJdHlwZTogJ3NlbGVjdCcsCgkJCQlzZWxlY3Q6IGZ1bmN0aW9uKG8pIHsKCQkJCQl0aGlzLnNldChvKTsKCQkJCX0KCQkJfSk7CgkJCWZvciAodmFyIGkgPSAwOyBpIDwgcmV0LkxheWVyQXR0cmlidXRlcy5sZW5ndGg7IGkrKykgewoJCQkJaWYgKHJldC5MYXllckF0dHJpYnV0ZXNbaV0uTmFtZSA9PSAiSWQiKSBjb250aW51ZTsKCQkJCWZpZWxkcy5wdXNoKHsKCQkJCQlncm91cDogIk1haW4iLAoJCQkJCW5hbWU6IHJldC5MYXllckF0dHJpYnV0ZXNbaV0uTmFtZSwKCQkJCQl0eXBlOiByZXQuTGF5ZXJBdHRyaWJ1dGVzW2ldLk5hdGl2ZVR5cGUKCQkJCX0pOwoJCQl9CgkJCWZvciAoaSA9IDA7IGkgPCByZXQuUmVsYXRpb25BdHRyaWJ1dGVzLmxlbmd0aDsgaSsrKSB7CgkJCQl2YXIgbSA9IHJldC5SZWxhdGlvbkF0dHJpYnV0ZXNbaV0uSXNBcnJheTsKCQkJCXZhciByQ29scyA9IFtdOwoJCQkJZm9yICh2YXIgcCBpbiByZXQuUmVsYXRpb25BdHRyaWJ1dGVzW2ldLlJlbGF0aW9uQ2xhc3MpIHsKCQkJCQlpZiAoJC5pbkFycmF5KHAsIFsiVG9TdHJpbmciLCAiX1RvU3RyaW5nIiwgIl9fUk9XSUQiLCAiX19MT0FERUQiLCAiSWQiXSkgPiAtMSkgY29udGludWU7CgkJCQkJckNvbHMucHVzaCh7CgkJCQkJCWZpZWxkOiBwLAoJCQkJCQl0aXRsZTogcAoJCQkJCX0pOwoJCQkJfQoJCQkJZmllbGRzLnB1c2goewoJCQkJCWdyb3VwOiAobSA/ICJPdGhlciIgOiAiUmVsYXRpb25zIiksCgkJCQkJQ2xhc3M6IHJldC5SZWxhdGlvbkF0dHJpYnV0ZXNbaV0uUmVsYXRpb25DbGFzcywKCQkJCQluYW1lOiByZXQuUmVsYXRpb25BdHRyaWJ1dGVzW2ldLk5hbWUsCgkJCQkJdHlwZTogJ3NlbGVjdCcsCgkJCQkJbXVsdGlwbGU6IG0sCgkJCQkJc291cmNlOiBmdW5jdGlvbihvLCBmRGF0YSkgewoJCQkJCQlyZXR1cm4gbzsKCQkJCQl9LAoJCQkJCWNvbHVtbnM6IHJDb2xzCgkJCQl9KTsKCQkJfQoJCX0gZWxzZSB7CgkJCS8vIGVtcwoJCQl2YXIgZWMgPSBfRnJFTUQuX19zY29wZSgpLkVudGl0eUNsYXNzZXMuZmluZChjID0+IGMuTmFtZS5yZXBsYWNlKC9cIC9nLCAnXycpID09IHNUYWJsZSk7CgkJCWZpZWxkcy5wdXNoKHsKCQkJCW5hbWU6IHNUYWJsZSwKCQkJCXRpdGxlOiBlYy5OYW1lLAoJCQkJbGFiZWw6IF9GckVNRC5fdGl0bGVDYXNlKGVjLk5hbWUpLAoJCQkJQ2xhc3M6IHsKCQkJCQlOYW1lOiBlYy5OYW1lLAoJCQkJCUlkOiBlYy5JZAoJCQkJfSwKCQkJCS8vem9uZTogJ3RvcCcsCgkJCQl0eXBlOiAnc2VsZWN0JywKCQkJCXNlbGVjdDogbyA9PiB7CgkJCQkJdGhpcy5kRm9ybS5jbGVhcigpOwoJCQkJCXRoaXMuZEZvcm0uc2V0KG8pOwoJCQkJfQoJCQl9KTsKCQkJZmllbGRzLnB1c2goLi4uZWMuRW50aXR5QXR0cmlidXRlcy5maWx0ZXIoZWEgPT4gIWVhLkVudGl0eU1ldGhvZCAmJiAhZWEuSXNUZXh0KS5tYXAoZWEgPT4gZWEuRW50aXR5VHlwZSA/ICh7CgkJCQlncm91cDogZWEuR3JvdXAuTmFtZSwKCQkJCW5hbWU6IGVhLk5hbWUsCgkJCQlsYWJlbDogX0ZyRU1ELl90aXRsZUNhc2UoZWEuTmFtZSksCgkJCQl0eXBlOiAnc2VsZWN0JywKCQkJCUNsYXNzOiB7CgkJCQkJTmFtZTogZWEuRW50aXR5VHlwZS5OYW1lLAoJCQkJCUlkOiBlYS5FbnRpdHlUeXBlLklkCgkJCQl9LAoJCQkJc291cmNlOiAobywgZkRhdGEpID0+IG8sCgkJCX0pIDogKHsKCQkJCWdyb3VwOiBlYS5Hcm91cC5OYW1lLAoJCQkJbmFtZTogZWEuTmFtZSwKCQkJCWxhYmVsOiBfRnJFTUQuX3RpdGxlQ2FzZShlYS5OYW1lKSwKCQkJCXR5cGU6IGVhLklzQm9vbCA/ICdib29sJyA6IChlYS5Jc0RhdGUgPyAnZGF0ZXRpbWUnIDogJ3N0cmluZycpLAoJCQl9KSkpOwoJCQlmaWVsZHMucHVzaCguLi5lYy5FbnRpdHlBdHRyaWJ1dGVzLmZpbHRlcihlYSA9PiAhZWEuRW50aXR5TWV0aG9kICYmIGVhLklzVGV4dCkubWFwKGVhID0+ICh7CgkJCQlncm91cDogZWEuR3JvdXAuTmFtZSwKCQkJCW5hbWU6IGVhLk5hbWUsCgkJCQl0eXBlOiAnd2luZG93JywKCQkJCWxhYmVsOiBfRnJFTUQuX3RpdGxlQ2FzZShlYS5OYW1lKSwKCQkJCWVkaXRvcjogdHJ1ZSwKCQkJCWxhbmd1YWdlOiBvID0+ICJ0ZXh0IiwKCQkJCWxvYWRlcjogYXN5bmMgKGZEYXRhLCBvRWxlbWVudCwgZWRpdG9yKSA9PiBjb25zb2xlLmxvZyhmRGF0YSwgb0VsZW1lbnQsIGVkaXRvciwgdGhpcyksCgkJCQlzYXZlcjogYXN5bmMgKHYsIGZEYXRhKSA9PiB2LAoJCQl9KSkpOwoJCX0KCQlyZXR1cm4gewoJCQlmb3JtOiB0aGlzLnJlbmRlcihzVGFibGUsIHRoaXMuZW5nbGlzaChzVGFibGUpLCBmaWVsZHMsIFt7CgkJCQluYW1lOiAnUmVzZXQnLAoJCQkJb25jbGljazogbyA9PiB7CgkJCQkJdGhpcy5kRm9ybS5idXN5KGZhbHNlKTsKCQkJCQl0aGlzLmRGb3JtLmNsZWFyKCk7CgkJCQl9LAoJCQkJaWNvbjogImNhbmNlbCIKCQkJfSwgewoJCQkJbmFtZTogJ1NhdmUnLAoJCQkJb25jbGljazogbyA9PiB7CgkJCQkJaWYgKG9bdGhpcy5zVGFibGVdICYmIG9bdGhpcy5zVGFibGVdLklkKSBvLklkID0gb1t0aGlzLnNUYWJsZV0uSWQ7CgkJCQkJZGVsZXRlIG9bdGhpcy5zVGFibGVdOwoJCQkJCWlmIChjb21wYW55LmxpYnJhcnkpIHsKCQkJCQkJX0ZyRU1ELnNyKCkuXyhjb21wYW55LkNvZGUudG9Mb3dlckNhc2UoKSArICIiICsgdGhpcy5zVGFibGUgKyAoby5JZCA/ICJVcGRhdGUiIDogIkluc2VydCIpLCBmdW5jdGlvbihyZXQpIHsKCQkJCQkJCWlmIChyZXQpIHsKCQkJCQkJCQl0aGlzLmRGb3JtLmluZm8odGhpcy5zVGFibGUgKyAiIFNhdmVkIik7CgkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCXRoaXMuZEZvcm0uZXJyb3IoIlVuYWJsZSB0byBzYXZlICIgKyB0aGlzLnNUYWJsZSk7CgkJCQkJCQl9CgkJCQkJCQl0aGlzLmJ1c3koZmFsc2UpOwoJCQkJCQl9LCBvKTsKCQkJCQl9IGVsc2UgewoJCQkJCQlfRnJFTUQuc3IoKS5fKCJlbXNFbnRpdHlPYmplY3QiICsgKG8uSWQgPyAiVXBkYXRlIiA6ICJJbnNlcnQiKSwgZnVuY3Rpb24ocmV0KSB7CgkJCQkJCQlpZiAocmV0KSB7CgkJCQkJCQkJdGhpcy5kRm9ybS5pbmZvKHRoaXMuc1RhYmxlICsgIiBTYXZlZCIpOwoJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQl0aGlzLmRGb3JtLmVycm9yKCJVbmFibGUgdG8gc2F2ZSAiICsgdGhpcy5zVGFibGUpOwoJCQkJCQkJfQoJCQkJCQkJdGhpcy5kRm9ybS5idXN5KGZhbHNlKTsKCQkJCQkJfSwgby50b0VudGl0eU9iamVjdCgpKTsKCQkJCQl9CgkJCQl9CgkJCX1dLCBiRml4ZWQpCgkJfTsKCX0KCglhc3luYyBkb0NsaWNrKGJ1dHRvbikgewoJCWxldCBfdGhpcyA9IHR5cGVvZih0aGlzLmRvQ2xpY2spID09PSAnZnVuY3Rpb24nID8gdGhpcyA6IHdpbmRvdy5ERm9ybTsKCQlidXR0b24gPSBfdGhpcy5idXR0b25zLmZpbmQoYiA9PiBiLm5hbWUgPT0gYnV0dG9uLm5hbWUgJiYgYi5ncm91cCA9PSBidXR0b24uZ3JvdXApOwoJCV90aGlzLmJ1c3kodHJ1ZSk7CgkJdmFyIG8gPSBfdGhpcy5nZXQoKTsKCQl2YXIgc01pc3NpbmcgPSBfdGhpcy5lbGVtZW50cy5maWx0ZXIoZSA9PiAoYnV0dG9uLndpbmRvdyA/IGJ1dHRvbi5ncm91cCA9PSBlLmdyb3VwIDogdHJ1ZSkpLmZpbHRlcihlID0+IGUucmVxdWlyZWQgJiYgIW9bZS5uYW1lXSkubWFwKGUgPT4gIjxsaT4iICsgKGUubGFiZWwgfHwgZS5uYW1lKSArICI8L2xpPiIpLmpvaW4oIiIpOwoJCWlmIChzTWlzc2luZykgewoJCQl3aW5kb3cuX0ZyRU1ELl9lcnJvcigiTWlzc2luZyBtYW5kYXRvcnkgZmllbGRzOjxici8+PHVsPiIgKyBzTWlzc2luZyArICI8L3VsPiIsIDUwMDApOwoJCQlfdGhpcy5idXN5KGZhbHNlKTsKCQkJcmV0dXJuOwoJCX0KCQlpZiAoYnV0dG9uLm9uY2xpY2spIGF3YWl0IGJ1dHRvbi5vbmNsaWNrKG8pOwoJCWlmIChidXR0b24ub25DbGljaykgYXdhaXQgYnV0dG9uLm9uQ2xpY2sobyk7CgkJX3RoaXMuYnVzeShmYWxzZSk7Cgl9CgoJYnVzeShiQnVzeSkgewoJCWlmICghYkJ1c3kpIHsKCQkJdmFyIHRvdGFsID0gMDsKCQkJaWYgKHR5cGVvZiBtb21lbnQgIT09ICd1bmRlZmluZWQnKSB7CgkJCQl0b3RhbCA9IG1vbWVudCgpLmRpZmYobW9tZW50KHRoaXMuYnVzeVN0YW1wKSwgJ3NlY29uZHMnKTsKCQkJfSBlbHNlIHsKCQkJCS8vIG5vIG1vbWVudCwgdXNlIHN0YW5kYXJkIERhdGUKCQkJCXRvdGFsID0gKG5ldyBEYXRlKCkuZ2V0VGltZSgpIC0gdGhpcy5idXN5U3RhbXAgPyB0aGlzLmJ1c3lTdGFtcC5nZXRUaW1lKCkgOiAwKSAvIDEwMDAgLyAzNjAwOwoJCQl9CgkJCWlmICh0aGlzLmJEZWJ1ZykgewoJCQkJd2luZG93Ll9GckVNRC5fYWxlcnQoIkV4ZWN1dGlvbiBUaW1lOiAiICsgdG90YWwgKyAiIHNlY29uZHMuIik7CgkJCX0KCQkJZGVsZXRlIHRoaXMuYnVzeVN0YW1wOwoJCX0gZWxzZSB7CgkJCXRoaXMuYnVzeVN0YW1wID0gbmV3IERhdGUoKTsKCQl9CgoJCSQuZWFjaCgkLm1lcmdlKCQubWFwKHRoaXMuYnV0dG9ucywgYiA9PiBiLm5hbWUpLCAkLm1hcCh0aGlzLmVsZW1lbnRzLmZpbHRlcihlID0+IGUudHlwZSA9PSAnbGluaycpLCBlID0+IGUubmFtZSkpLCAoXywgZSkgPT4gJCgnIycgKyBlKS5saW5rYnV0dG9uKGJCdXN5ID8gJ2Rpc2FibGUnIDogJ2VuYWJsZScpKTsKCX0KCglwcmVmaXgoZSkgewoJCXN3aXRjaCAoZS50eXBlKSB7CgkJCWNhc2UgJ2xhYmVsJzoKCQkJCXJldHVybiAnbGJsJzsKCQkJY2FzZSAndGV4dCc6CgkJCWNhc2UgJ3N0cmluZyc6CgkJCWNhc2UgJ3NlYXJjaCc6CgkJCWNhc2UgJ3Bhc3N3b3JkJzoKCQkJCXJldHVybiAndHh0JzsKCQkJY2FzZSAiRGF0ZVRpbWUiOgoJCQljYXNlICJkYXRldGltZSI6CgkJCQlyZXR1cm4gJ2R0cCc7CgkJCWNhc2UgImludCI6CgkJCWNhc2UgImludGVnZXIiOgoJCQljYXNlICJudW1iZXIiOgoJCQljYXNlICJsb25nIjoKCQkJY2FzZSAiTG9uZyI6CgkJCQlyZXR1cm4gJ251ZCc7CgkJCWNhc2UgJ2ZpbGUnOgoJCQkJcmV0dXJuICdmaWwnOwoJCQljYXNlICdpbWFnZSc6CgkJCQlyZXR1cm4gJ2ltZyc7CgkJCWNhc2UgImJvb2wiOgoJCQkJcmV0dXJuICdjaGsnOwoJCQljYXNlICJ3aW5kb3ciOgoJCQkJcmV0dXJuICdwbmwnOwoJCQljYXNlICJwcm9ncmVzcyI6CgkJCQlyZXR1cm4gJ3ByZyc7CgkJCWNhc2UgImdyaWQiOgoJCQljYXNlICJ0cmVlIjoKCQkJY2FzZSAic2VsZWN0IjoKCQkJCXJldHVybiAnY21iJzsKCQkJZGVmYXVsdDoKCQkJCXJldHVybiAnJzsKCQl9Cgl9CgoJY2xlYXIoZ3JvdXApIHsKCQl2YXIgbyA9IHt9OwoJCSQuZWFjaCh0aGlzLmVsZW1lbnRzLmZpbHRlcihlID0+IGdyb3VwID8gZS5ncm91cCA9PSBncm91cCA6IHRydWUpLCAoXywgZSkgPT4gewoJCQl2YXIgbmFtZSA9IChlLmVtc1NvdXJjZSA/ICJfIiA6ICIiKSArIGUubmFtZTsKCQkJc3dpdGNoIChlLnR5cGUpIHsKCQkJCWNhc2UgJ3RleHQnOgoJCQkJY2FzZSAnc3RyaW5nJzoKCQkJCWNhc2UgJ3NlYXJjaCc6CgkJCQljYXNlICdwYXNzd29yZCc6CgkJCQljYXNlICJEYXRlVGltZSI6CgkJCQljYXNlICJkYXRldGltZSI6CgkJCQkJb1tuYW1lXSA9ICIiOwoJCQkJCWJyZWFrOwoJCQkJY2FzZSAiaW50IjoKCQkJCWNhc2UgIm51bWJlciI6CgkJCQljYXNlICJpbnRlZ2VyIjoKCQkJCWNhc2UgImxvbmciOgoJCQkJY2FzZSAiTG9uZyI6CgkJCQljYXNlICJwcm9ncmVzcyI6CgkJCQkJb1tuYW1lXSA9IDA7CgkJCQkJYnJlYWs7CgkJCQljYXNlICJ0cmVlIjoKCQkJCWNhc2UgInNlbGVjdCI6CgkJCQkJb1tuYW1lXSA9IG51bGw7CgkJCQkJYnJlYWs7CgkJCQljYXNlICJncmlkIjoKCQkJCQlvW25hbWVdID8gb1tuYW1lXS5kYXRhID0gW10gOiBudWxsOwoJCQkJCWJyZWFrOwoJCQkJY2FzZSAiYm9vbCI6CgkJCQkJb1tuYW1lXSA9IGZhbHNlOwoJCQkJCWJyZWFrOwoJCQkJZGVmYXVsdDoKCQkJCQlicmVhazsKCQkJfQoJCX0pOwoJCS8vY29uc29sZS5sb2coImNsZWFyIiwgbyk7CgkJdGhpcy5zZXQobyk7CgkJdGhpcy5idXN5KGZhbHNlKTsKCX0KCglzZXQobywgZU5hbWUpIHsKCQlpZiAoZU5hbWUpIHsKCQkJdmFyIG9FbGVtZW50ID0gdGhpcy5ieU5hbWUoZU5hbWUpOwoJCQlpZiAoIW9FbGVtZW50KSByZXR1cm47CgkJCXZhciBhdHQgPSBudWxsOwoJCQlpZiAobyAmJiBvLklkICYmIG8uRW50aXR5QXR0cmlidXRlKSB7CgkJCQkvLyBhbiBFbnRpdHlWYWx1ZQoJCQkJZm9yICh2YXIgcCBpbiBvKQoJCQkJCWlmIChwLmVuZHNXaXRoKCJWYWx1ZSIpKSBhdHQgPSBwOwoJCQkJb0VsZW1lbnQuZW1zU291cmNlID0gbzsKCQkJfQoJCQl0cnkgewoJCQkJc3dpdGNoIChvRWxlbWVudC50eXBlKSB7CgkJCQkJY2FzZSAnbGFiZWwnOgoJCQkJCQlpZiAoYXR0KSB7CgkJCQkJCQkkKCIjIiArIHRoaXMucHJlZml4KG9FbGVtZW50KSArIG9FbGVtZW50Lm5hbWUpLmh0bWwob1thdHRdKTsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCSQoIiMiICsgdGhpcy5wcmVmaXgob0VsZW1lbnQpICsgb0VsZW1lbnQubmFtZSkuaHRtbCgobyAmJiBvLkVudGl0eUF0dHJpYnV0ZSkgPyAiIiA6IG8pOwoJCQkJCQl9CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgJ3RleHQnOgoJCQkJCWNhc2UgJ3N0cmluZyc6CgkJCQkJY2FzZSAncGFzc3dvcmQnOgoJCQkJCWNhc2UgImludCI6CgkJCQkJY2FzZSAic2VhcmNoIjoKCQkJCQljYXNlICJpbnRlZ2VyIjoKCQkJCQljYXNlICJudW1iZXIiOgoJCQkJCWNhc2UgImxvbmciOgoJCQkJCWNhc2UgIkxvbmciOgoJCQkJCQlpZiAoYXR0KSB7CgkJCQkJCQkkKCIjIiArIHRoaXMucHJlZml4KG9FbGVtZW50KSArIG9FbGVtZW50Lm5hbWUpW3RoaXMudWlUeXBlc1tvRWxlbWVudC50eXBlXV0oInNldFZhbHVlIiwgb1thdHRdKTsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCSQoIiMiICsgdGhpcy5wcmVmaXgob0VsZW1lbnQpICsgb0VsZW1lbnQubmFtZSlbdGhpcy51aVR5cGVzW29FbGVtZW50LnR5cGVdXSgic2V0VmFsdWUiLCAobyAmJiBvLkVudGl0eUF0dHJpYnV0ZSkgPyAiIiA6IG8pOwoJCQkJCQl9CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgIkRhdGVUaW1lIjoKCQkJCQljYXNlICJkYXRldGltZSI6CgkJCQkJCWlmIChhdHQpIHsKCQkJCQkJCSQoIiMiICsgdGhpcy5wcmVmaXgob0VsZW1lbnQpICsgb0VsZW1lbnQubmFtZSlbdGhpcy51aVR5cGVzW29FbGVtZW50LnR5cGVdXSgnc2V0VmFsdWUnLCAob1thdHRdID8gdGhpcy5zcigpLnRvRGF0ZVRpbWUob1thdHRdKSA6ICIiKSk7CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQkkKCIjIiArIHRoaXMucHJlZml4KG9FbGVtZW50KSArIG9FbGVtZW50Lm5hbWUpW3RoaXMudWlUeXBlc1tvRWxlbWVudC50eXBlXV0oJ3NldFZhbHVlJywgKG8gJiYgby5FbnRpdHlBdHRyaWJ1dGUpID8gIiIgOiAobyA/IHRoaXMuc3IoKS50b0RhdGVUaW1lKG8pIDogIiIpKTsKCQkJCQkJfQoJCQkJCQlicmVhazsKCQkJCQljYXNlICJib29sIjoKCQkJCQkJaWYgKGF0dCkgewoJCQkJCQkJJCgiIyIgKyB0aGlzLnByZWZpeChvRWxlbWVudCkgKyBvRWxlbWVudC5uYW1lKVt0aGlzLnVpVHlwZXNbb0VsZW1lbnQudHlwZV1dKChvW2F0dF0gPyAnJyA6ICd1bicpICsgJ2NoZWNrJyk7CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQkkKCIjIiArIHRoaXMucHJlZml4KG9FbGVtZW50KSArIG9FbGVtZW50Lm5hbWUpW3RoaXMudWlUeXBlc1tvRWxlbWVudC50eXBlXV0oKCgobyAmJiBvLkVudGl0eUF0dHJpYnV0ZSkgPyAiIiA6IG8pID8gJycgOiAndW4nKSArICdjaGVjaycpOwoJCQkJCQl9CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgIndpbmRvdyI6CgkJCQkJCWlmIChhdHQpIHsKCQkJCQkJCW9FbGVtZW50LnZhbHVlID0gb1thdHRdOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJb0VsZW1lbnQudmFsdWUgPSAobyAmJiBvLkVudGl0eUF0dHJpYnV0ZSkgPyAiIiA6IG87CgkJCQkJCX0KCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAicHJvZ3Jlc3MiOgoJCQkJCQl2YXIgdiA9IDA7CgkJCQkJCWlmIChhdHQpIHsKCQkJCQkJCXYgPSBvW2F0dF07CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQl2ID0gKG8gJiYgby5FbnRpdHlBdHRyaWJ1dGUpID8gIiIgOiBvOwoJCQkJCQl9CgkJCQkJCSQoIiMiICsgdGhpcy5wcmVmaXgob0VsZW1lbnQpICsgb0VsZW1lbnQubmFtZSlbdGhpcy51aVR5cGVzW29FbGVtZW50LnR5cGVdXSgnc2V0VmFsdWUnLCBNYXRoLnJvdW5kKHYgKiAxMCkgLyAxMCk7CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgImdyaWQiOgoJCQkJCQlsZXQgY29scyA9IEpTT04ucGFyc2UoInsiICsgdGhpcy5tYXBDb2x1bW5zKG9FbGVtZW50LCB0cnVlKSArICJ9Iik7CgkJCQkJCSQuZWFjaChjb2xzLmNvbHVtbnNbMF0sIChfLCBjKSA9PiBjLmZvcm1hdHRlciA9IHRoaXMuc3IoKS5ydW5TY3JpcHQodGhpcy5mb3JtYXR0ZXIob0VsZW1lbnQubmFtZSwgYykpKTsKCQkJCQkJJCgiIyIgKyB0aGlzLnByZWZpeChvRWxlbWVudCkgKyBvRWxlbWVudC5uYW1lKS5kYXRhZ3JpZChjb2xzKTsKCQkJCQkJaWYgKGF0dCkgewoJCQkJCQkJJCgiIyIgKyB0aGlzLnByZWZpeChvRWxlbWVudCkgKyBvRWxlbWVudC5uYW1lKS5kYXRhZ3JpZCh7CgkJCQkJCQkJZGF0YTogb1thdHRdCgkJCQkJCQl9KTsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCSQoIiMiICsgdGhpcy5wcmVmaXgob0VsZW1lbnQpICsgb0VsZW1lbnQubmFtZSkuZGF0YWdyaWQoewoJCQkJCQkJCWRhdGE6IChvICYmIG8uRW50aXR5QXR0cmlidXRlKSA/ICIiIDogbwoJCQkJCQkJfSk7CgkJCQkJCX0KCQkJCQkJJCgiIyIgKyB0aGlzLnByZWZpeChvRWxlbWVudCkgKyBvRWxlbWVudC5uYW1lKS5kYXRhZ3JpZCgidW5zZWxlY3RBbGwiKTsKCQkJCQkJJCgiIyIgKyB0aGlzLnByZWZpeChvRWxlbWVudCkgKyBvRWxlbWVudC5uYW1lKS5kYXRhZ3JpZCgpOwoJCQkJCQlicmVhazsKCQkJCQljYXNlICJ0cmVlIjoKCQkJCQkJdmFyIHYgPSBhdHQgPyBvW2F0dF0gOiAoKG8gJiYgby5FbnRpdHlBdHRyaWJ1dGUpID8gIiIgOiBvKTsKCQkJCQkJaWYgKEFycmF5LmlzQXJyYXkodikpIHsKCQkJCQkJCSQoIiMiICsgdGhpcy5wcmVmaXgob0VsZW1lbnQpICsgb0VsZW1lbnQubmFtZSlbdGhpcy51aVR5cGVzW29FbGVtZW50LnR5cGVdXSgidHJlZSIpLnRyZWUoImxvYWREYXRhIiwgdik7CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQkkKCIjIiArIHRoaXMucHJlZml4KG9FbGVtZW50KSArIG9FbGVtZW50Lm5hbWUpW3RoaXMudWlUeXBlc1tvRWxlbWVudC50eXBlXV0oJ3NldFZhbHVlJywgdik7CgkJCQkJCX0KCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAic2VsZWN0IjoKCQkJCQkJaWYgKGF0dCkgewoJCQkJCQkJaWYgKG9FbGVtZW50Lm9wdGlvbnMpIHsKCQkJCQkJCQkkKCIjIiArIHRoaXMucHJlZml4KG9FbGVtZW50KSArIG9FbGVtZW50Lm5hbWUpLmNvbWJvKCdzZXRWYWx1ZScgKyAob0VsZW1lbnQubXVsdGlwbGUgPyAncycgOiAnJyksIChvW2F0dF0gPyBvW2F0dF0gOiAiIikpOwoJCQkJCQkJCSQoIiMiICsgdGhpcy5wcmVmaXgob0VsZW1lbnQpICsgb0VsZW1lbnQubmFtZSkuY29tYm8oJ3NldFZhbHVlJyArIChvRWxlbWVudC5tdWx0aXBsZSA/ICdzJyA6ICcnKSwgKG9bYXR0XSA/IG9bYXR0XSA6ICIiKSk7CgkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCSQoIiMiICsgdGhpcy5wcmVmaXgob0VsZW1lbnQpICsgb0VsZW1lbnQubmFtZSkuY29tYm9ncmlkKCdzZXRWYWx1ZScgKyAob0VsZW1lbnQubXVsdGlwbGUgPyAncycgOiAnJyksIChvW2F0dF0gPyBvW2F0dF0gOiAiIikpOwoJCQkJCQkJfQoJCQkJCQl9IGVsc2UgewoJCQkJCQkJdiA9IG51bGw7CgkJCQkJCQlpZiAobyA9PT0gbnVsbCkgewoKCQkJCQkJCX0gZWxzZSBpZiAoby5jb25zdHJ1Y3RvciA9PT0gQXJyYXkpIHsKCgkJCQkJCQl9IGVsc2UgaWYgKCFvLkVudGl0eUF0dHJpYnV0ZSkgewoJCQkJCQkJCXYgPSBvIHx8IHsKCQkJCQkJCQkJSWQ6IG8uSWQsCgkJCQkJCQkJCV9Ub1N0cmluZzogby5fVG9TdHJpbmcsCgkJCQkJCQkJCXRvU3RyaW5nOiBmdW5jdGlvbigpIHsKCQkJCQkJCQkJCXJldHVybiB0aGlzLl9Ub1N0cmluZzsKCQkJCQkJCQkJfQoJCQkJCQkJCX07CgkJCQkJCQl9CgkJCQkJCQlpZiAob0VsZW1lbnQub3B0aW9ucykgewoJCQkJCQkJCSQoIiMiICsgdGhpcy5wcmVmaXgob0VsZW1lbnQpICsgb0VsZW1lbnQubmFtZSkuY29tYm8oJ3NldFZhbHVlJyArIChvRWxlbWVudC5tdWx0aXBsZSA/ICdzJyA6ICcnKSwgdik7CgkJCQkJCQkJJCgiIyIgKyB0aGlzLnByZWZpeChvRWxlbWVudCkgKyBvRWxlbWVudC5uYW1lKS5jb21ibygnc2V0VGV4dCcgKyAob0VsZW1lbnQubXVsdGlwbGUgPyAncycgOiAnJyksIHYpOwoJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQkkKCIjIiArIHRoaXMucHJlZml4KG9FbGVtZW50KSArIG9FbGVtZW50Lm5hbWUpLmNvbWJvZ3JpZCgnc2V0VmFsdWUnICsgKG9FbGVtZW50Lm11bHRpcGxlID8gJ3MnIDogJycpLCB2KTsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCQlicmVhazsKCQkJCQlkZWZhdWx0OgoJCQkJCQlicmVhazsKCQkJCX0KCQkJfSBjYXRjaCAoZXgpIHsKCQkJCWNvbnNvbGUubG9nKGV4KTsKCQkJfQoJCX0gZWxzZSB7CgkJCWZvciAodmFyIHAgaW4gbykgewoJCQkJaWYgKHAuaW5kZXhPZignXycpID09PSAwKSBwID0gcC5zdWJzdHJpbmcoMSk7CgkJCQl2YXIgZSA9IHRoaXMuYnlOYW1lKHApOwoJCQkJaWYgKCFlIHx8ICFlLm5hbWUpIGNvbnRpbnVlOwoJCQkJdmFyIHZhbHVlID0gb1twXTsKCQkJCWlmIChlLm5hbWUgPT0gdGhpcy5zVGFibGUpIHsKCQkJCQl2YWx1ZSA9IG87CgkJCQkJdmFsdWUuRGF0ZSA9IG5ldyBEYXRlKCk7CgkJCQl9CgkJCQlpZiAocCA9PSAiRW50aXR5VmFsdWVzIikgewoJCQkJCS8vIGFuIGVtc0Zvcm1WYWx1ZXMgc291cmNlCgkJCQkJLy8gZmluZCB0aGUgRW50aXR5VmFsdWUgZm9yIHRoaXMgZWxlbWVudCBhbmQgc2V0IGl0CgkJCQkJZm9yICh2YXIgaiA9IDA7IGogPCBvLkVudGl0eVZhbHVlcy5sZW5ndGg7IGorKykgewoJCQkJCQlpZiAoby5FbnRpdHlWYWx1ZXNbal0uRW50aXR5QXR0cmlidXRlLk5hbWUgPT0gZS5uYW1lKSB7CgkJCQkJCQkvLyBmb3VuZCB0aGUgRW50aXR5VmFsdWUgZm9yIHRoaXMgZWxlbWVudAoJCQkJCQkJX3YgPSBvLkVudGl0eVZhbHVlc1tqXTsKCQkJCQkJCWZvciAodmFyIHEgaW4gX3YpIHsKCQkJCQkJCQlpZiAocS5lbmRzV2l0aCgiVmFsdWUiKSkgewoJCQkJCQkJCQlfdltxXSA9IHZhbHVlOwoJCQkJCQkJCX0KCQkJCQkJCX0KCQkJCQkJCWJyZWFrOwoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQkJdGhpcy5zZXQodmFsdWUsIGUubmFtZSk7CgkJCX0KCQl9Cgl9CgoJZ2V0KCkgewoJCXZhciBvID0ge307CgkJaWYgKHRoaXMuc1RhYmxlICYmIHdpbmRvd1t0aGlzLnNUYWJsZV0pIG8gPSBuZXcgd2luZG93W3RoaXMuc1RhYmxlXSgpOwoJCWZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5lbGVtZW50cy5sZW5ndGg7IGkrKykgewoJCQl2YXIgY24gPSBudWxsOwoJCQl2YXIgdiA9IG51bGw7CgkJCXRyeSB7CgkJCQlzd2l0Y2ggKHRoaXMuZWxlbWVudHNbaV0udHlwZSkgewoJCQkJCWNhc2UgJ2xhYmVsJzoKCQkJCQkJY24gPSAkKCIjbGJsIiArIHRoaXMuZWxlbWVudHNbaV0ubmFtZSk7CgkJCQkJCXYgPSBjbi5odG1sKCk7CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgJ3RleHQnOgoJCQkJCWNhc2UgJ3N0cmluZyc6CgkJCQkJY2FzZSAnc2VhcmNoJzoKCQkJCQljYXNlICdwYXNzd29yZCc6CgkJCQkJCWNuID0gJCgiIyIgKyB0aGlzLnByZWZpeCh0aGlzLmVsZW1lbnRzW2ldKSArIHRoaXMuZWxlbWVudHNbaV0ubmFtZSk7CgkJCQkJCXYgPSBjbi52YWwoKTsKCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAiZmlsZSI6CgkJCQkJY2FzZSAiaW1hZ2UiOgoJCQkJCQljbiA9ICQoIiMiICsgdGhpcy5wcmVmaXgodGhpcy5lbGVtZW50c1tpXSkgKyB0aGlzLmVsZW1lbnRzW2ldLm5hbWUpOwoJCQkJCQl2ID0gdGhpcy5lbGVtZW50c1tpXS5kYXRhOwoJCQkJCQlicmVhazsKCQkJCQljYXNlICJEYXRlVGltZSI6CgkJCQkJY2FzZSAiZGF0ZXRpbWUiOgoJCQkJCQl2ID0gbmV3IERhdGUoJCgiIyIgKyB0aGlzLnByZWZpeCh0aGlzLmVsZW1lbnRzW2ldKSArIHRoaXMuZWxlbWVudHNbaV0ubmFtZSkuZGF0ZXRpbWVib3goJ2dldFZhbHVlJykpOwoJCQkJCQljbiA9ICQoIiMiICsgdGhpcy5wcmVmaXgodGhpcy5lbGVtZW50c1tpXSkgKyB0aGlzLmVsZW1lbnRzW2ldLm5hbWUpOwoJCQkJCQlicmVhazsKCQkJCQljYXNlICJwcm9ncmVzcyI6CgkJCQkJCWNuID0gJCgiIyIgKyB0aGlzLnByZWZpeCh0aGlzLmVsZW1lbnRzW2ldKSArIHRoaXMuZWxlbWVudHNbaV0ubmFtZSk7CgkJCQkJCXYgPSBjbi5wcm9ncmVzc2JhcignZ2V0VmFsdWUnKTsKCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAiaW50IjoKCQkJCQljYXNlICJpbnRlZ2VyIjoKCQkJCQljYXNlICJudW1iZXIiOgoJCQkJCWNhc2UgImxvbmciOgoJCQkJCWNhc2UgIkxvbmciOgoJCQkJCQljbiA9ICQoIiMiICsgdGhpcy5wcmVmaXgodGhpcy5lbGVtZW50c1tpXSkgKyB0aGlzLmVsZW1lbnRzW2ldLm5hbWUpOwoJCQkJCQl2ID0gcGFyc2VGbG9hdChjbi52YWwoKSk7CgkJCQkJCWlmIChpc05hTih2KSkgdiA9IDA7CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgImdyaWQiOgoJCQkJCQljbiA9ICQoIiMiICsgdGhpcy5wcmVmaXgodGhpcy5lbGVtZW50c1tpXSkgKyB0aGlzLmVsZW1lbnRzW2ldLm5hbWUpOwoJCQkJCQl2ID0gY24uZGF0YWdyaWQoJ2dldERhdGEnKTsKCQkJCQkJdi5zZWxlY3RlZCA9IGNuLmRhdGFncmlkKCJnZXRTZWxlY3RlZCIpOwoJCQkJCQlicmVhazsKCQkJCQljYXNlICJ0cmVlIjoKCQkJCQkJY24gPSAkKCIjIiArIHRoaXMucHJlZml4KHRoaXMuZWxlbWVudHNbaV0pICsgdGhpcy5lbGVtZW50c1tpXS5uYW1lKTsKCQkJCQkJdiA9IGNuLmNvbWJvdHJlZSgidHJlZSIpLnRyZWUoImdldFNlbGVjdGVkIik7CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgIndpbmRvdyI6CgkJCQkJCXYgPSB0aGlzLmVsZW1lbnRzW2ldLnZhbHVlOwoJCQkJCQlicmVhazsKCQkJCQljYXNlICJzZWxlY3QiOgoJCQkJCQlpZiAodGhpcy5lbGVtZW50c1tpXS5vcHRpb25zKSB7CgkJCQkJCQl2ID0gJCgiIyIgKyB0aGlzLnByZWZpeCh0aGlzLmVsZW1lbnRzW2ldKSArIHRoaXMuZWxlbWVudHNbaV0ubmFtZSkuY29tYm9ncmlkKCdnZXRWYWx1ZScgKyAodGhpcy5lbGVtZW50c1tpXS5tdWx0aXBsZSA/ICdzJyA6ICcnKSk7CgkJCQkJCQl2ID0gdGhpcy5zcigpLnJ1blNjcmlwdCh2KTsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCXYgPSAkKCIjIiArIHRoaXMucHJlZml4KHRoaXMuZWxlbWVudHNbaV0pICsgdGhpcy5lbGVtZW50c1tpXS5uYW1lKS5jb21ib2dyaWQoJ2dyaWQnKS5kYXRhZ3JpZCgnZ2V0U2VsZWN0aW9ucycpOwoJCQkJCQkJaWYgKCF2IHx8ICF2Lmxlbmd0aCkgewoJCQkJCQkJCXYgPSAkKCIjIiArIHRoaXMucHJlZml4KHRoaXMuZWxlbWVudHNbaV0pICsgdGhpcy5lbGVtZW50c1tpXS5uYW1lKS5jb21ib2dyaWQoJ2dldFZhbHVlJyArICh0aGlzLmVsZW1lbnRzW2ldLm11bHRpcGxlID8gJ3MnIDogJycpKTsKCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJaWYgKCF0aGlzLmVsZW1lbnRzW2ldLm11bHRpcGxlKSB2ID0gdlswXTsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCQljbiA9ICQoIiMiICsgdGhpcy5wcmVmaXgodGhpcy5lbGVtZW50c1tpXSkgKyB0aGlzLmVsZW1lbnRzW2ldLm5hbWUpOwoJCQkJCQlicmVhazsKCQkJCQljYXNlICJib29sIjoKCQkJCQkJY24gPSAkKCIjIiArIHRoaXMucHJlZml4KHRoaXMuZWxlbWVudHNbaV0pICsgdGhpcy5lbGVtZW50c1tpXS5uYW1lKTsKCQkJCQkJdiA9IGNuLnN3aXRjaGJ1dHRvbignb3B0aW9ucycpLmNoZWNrZWQ7CgkJCQkJCWJyZWFrOwoJCQkJCWRlZmF1bHQ6CgkJCQkJCWJyZWFrOwoJCQkJfQoJCQkJb1t0aGlzLmVsZW1lbnRzW2ldLm5hbWVdKHYpOwoJCQl9IGNhdGNoIChlKSB7CgkJCQkvL2NvbnNvbGUubG9nKHRoaXMuZWxlbWVudHNbaV0ubmFtZSwgZSk7CgkJCQlvW3RoaXMuZWxlbWVudHNbaV0ubmFtZV0gPSB2OwoJCQl9CgkJCWlmIChjbikgewoJCQkJaWYgKG8uRW50aXR5VmFsdWVzKSB7CgkJCQkJZm9yICh2YXIgaiA9IDA7IGogPCBvLkVudGl0eVZhbHVlcy5sZW5ndGg7IGorKykgewoJCQkJCQlpZiAodGhpcy5lbGVtZW50c1tpXS5uYW1lID09IHRoaXMuc1RhYmxlICYmIHRoaXMuZWxlbWVudHNbaV0uZW1zU291cmNlKSBvLklkID0gdGhpcy5lbGVtZW50c1tpXS5lbXNTb3VyY2UuSWQ7CgkJCQkJCWlmIChvLkVudGl0eVZhbHVlc1tqXS5FbnRpdHlBdHRyaWJ1dGUuTmFtZSA9PSB0aGlzLmVsZW1lbnRzW2ldLm5hbWUgJiYgdGhpcy5lbGVtZW50c1tpXS5lbXNTb3VyY2UpIHsKCQkJCQkJCW8uRW50aXR5VmFsdWVzW2pdLklkID0gdGhpcy5lbGVtZW50c1tpXS5lbXNTb3VyY2UuSWQ7CgkJCQkJCX0KCQkJCQl9CgkJCQl9CgkJCX0KCQl9CgkJcmV0dXJuIG87Cgl9CgoJY0hlaWdodChvcHRpb25zKSB7CgkJaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5lZGl0b3IpIHJldHVybiB3aW5kb3cuaW5uZXJIZWlnaHQ7CgkJaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5oZWlnaHQgJiYgdHlwZW9mKG9wdGlvbnMuaGVpZ2h0KSA9PT0gJ3N0cmluZycpIHJldHVybiB0aGlzLmhlaWdodDsKCQlpZiAob3B0aW9ucyAmJiBvcHRpb25zLnR5cGUgPT0gJ3dpbmRvdycgJiYgIW9wdGlvbnMuaGVpZ2h0KSByZXR1cm4gdGhpcy5oZWlnaHQgKiAwLjk7CgkJcmV0dXJuIE1hdGguZmxvb3IoKChvcHRpb25zID8gb3B0aW9ucy5oZWlnaHQgOiBudWxsKSB8fCAodGhpcy5oZWlnaHQgLyAzKSkpOwoJfQoKCXNlYXJjaChvcHRpb25zKSB7CgkJcmV0dXJuIHRoaXMuc3RyaW5nKG9wdGlvbnMpOwoJfQoKCXN0cmluZyhvcHRpb25zKSB7CgkJb3B0aW9ucy5oZWlnaHQgPSAyMDsKCQlvcHRpb25zLnNpbXBsZSA9IHRydWU7CgkJcmV0dXJuIHRoaXMudGV4dChvcHRpb25zKTsKCX0KCglkYXRldGltZShvcHRpb25zKSB7CgkJcmV0dXJuIGA8aW5wdXQgaWQ9ImR0cCR7b3B0aW9ucy5uYW1lfSIgY2xhc3M9ImVhc3l1aS0ke3RoaXMudWlUeXBlc1tvcHRpb25zLnR5cGVdfSIgcmVxdWlyZWQ9IiR7b3B0aW9ucy5yZXF1aXJlZCA/ICd0cnVlJyA6ICdmYWxzZSd9IiB2YWx1ZT0iJHt0aGlzLnZhbHVlKG9wdGlvbnMpfSIgc3R5bGU9IndpZHRoOiR7dGhpcy5jV2lkdGgob3B0aW9ucyl9cHgiPmA7Cgl9CgoJcXVlcnkob3B0aW9ucykgewoJCXJldHVybiAiPGRpdiBpZD0ndnMiICsgb3B0aW9ucy5uYW1lICsgIic+PC9kaXY+IjsKCX0KCglEYXRlVGltZShvcHRpb25zKSB7CgkJcmV0dXJuIHRoaXMuZGF0ZXRpbWUob3B0aW9ucyk7Cgl9CgoJbG9uZyhvcHRpb25zKSB7CgkJcmV0dXJuIHRoaXMuaW50KG9wdGlvbnMpOwoJfQoKCUxvbmcob3B0aW9ucykgewoJCXJldHVybiB0aGlzLmxvbmcob3B0aW9ucyk7Cgl9CgoJdmFsdWUob3B0aW9ucykgewoJCWlmICh0eXBlb2Ygb3B0aW9ucy52YWx1ZSA9PT0gJ2Z1bmN0aW9uJykgewoJCQl0cnkgewoJCQkJcmV0dXJuIG9wdGlvbnMudmFsdWUodGhpcy5nZXQoKSk7CgkJCX0gY2F0Y2ggKGV4KSB7CgkJCQljb25zb2xlLmxvZyhgREZvcm0udmFsdWUoJHtvcHRpb25zLm5hbWV9KTogJHtleH1gKTsKCQkJCXJldHVybiAnJzsKCQkJfQoJCX0gZWxzZSB7CgkJCXN3aXRjaCAob3B0aW9ucy50eXBlKSB7CgkJCQljYXNlICdpbnQnOgoJCQkJY2FzZSAncHJvZ3Jlc3MnOgoJCQkJCXJldHVybiBvcHRpb25zLnZhbHVlIHx8IG9wdGlvbnMubWluIHx8IDA7CgkJCQljYXNlICdzdHJpbmcnOgoJCQkJY2FzZSAndGV4dCc6CgkJCQljYXNlICdkYXRldGltZSc6CgkJCQljYXNlICdsYWJlbCc6CgkJCQkJcmV0dXJuIG9wdGlvbnMudmFsdWUgfHwgIiI7CgkJCQlkZWZhdWx0OgoJCQkJCXJldHVybiBvcHRpb25zLnZhbHVlOwoJCQl9CgkJfQoJfQoKCWludChvcHRpb25zKSB7CgkJbGV0IHJldCA9IGA8aW5wdXQgaWQ9Im51ZCR7b3B0aW9ucy5uYW1lfSIgY2xhc3M9ImVhc3l1aS0ke3RoaXMudWlUeXBlc1tvcHRpb25zLnR5cGVdfSIgcmVxdWlyZWQ9IiR7b3B0aW9ucy5yZXF1aXJlZCA/ICd0cnVlJyA6ICdmYWxzZSd9IiB2YWx1ZT0iJHt0aGlzLnZhbHVlKG9wdGlvbnMpfSIgZGF0YS1vcHRpb25zPSJtaW46JHtvcHRpb25zLm1pbiB8fCAwfSxtYXg6JHtvcHRpb25zLm1heCB8fCAxMDB9LGluY3JlbWVudDoke29wdGlvbnMuaW5jcmVtZW50IHx8IDF9IiBzdHlsZT0id2lkdGg6JHt0aGlzLmNXaWR0aChvcHRpb25zKX1weDsiPjwvaW5wdXQ+YDsKCQkvL2NvbnNvbGUubG9nKHJldCk7CgkJcmV0dXJuIHJldDsKCX0KCgltZW51KG9wdGlvbnMpIHsKCQl2YXIgcmV0ID0gIiI7CgkJcmV0ICs9ICc8ZGl2IGNsYXNzPSJlYXN5dWktcGFuZWwiIGlkPSJtbnUnICsgb3B0aW9ucy5uYW1lICsgJyIgc3R5bGU9InBhZGRpbmc6NXB4OyI+XG4nOwoJCSQuZWFjaChvcHRpb25zLm1lbnUsIChfLCBtKSA9PiByZXQgKz0gYDxhIGhyZWY9IiMiIGNsYXNzPSJlYXN5dWktJHt0aGlzLnVpVHlwZXNbb3B0aW9ucy50eXBlIHx8ICdtZW51J119IiBkYXRhLW9wdGlvbnM9Im1lbnU6JyNtbSR7bS5sYWJlbC5yZXBsYWNlKC8gL2csICcnKX0nLGljb25DbHM6J2ljb24tJHttLmljb24gfHwgJ25vbmUnfSciPiR7bS5sYWJlbH08L2E+XG5gKTsKCQlyZXQgKz0gIjwvZGl2PlxuIjsKCQlsZXQgZHYgPSBtID0+IHsKCQkJbGV0IHJldCA9ICc8ZGl2JyArIChtLnN1Yk1lbnVzID8gJycgOiBgIGRhdGEtb3B0aW9ucz0iaWNvbkNsczonaWNvbi0ke20uaWNvbiB8fCAnbm9uZSd9JyJgKSArICc+XG4nOwoJCQlyZXQgKz0gbS5zdWJNZW51cyA/ICc8c3Bhbj4nICsgKG0ubGFiZWwgfHwgdGhpcy5lbmdsaXNoKG0uY29kZSkpICsgJzwvc3Bhbj5cbjxkaXY+JyA6IChgPHNwYW4gd2lkdGg9JzEwMCUnIG9uY2xpY2s9Jyhhc3luYyAoKSA9PiB7bGV0IG0gPSAke19GckVNRC5fdG9KUyhtKX07IGlmKG0uYWN0aW9uKXtyZXR1cm4gYXdhaXQgbS5hY3Rpb24oREZvcm0uZ2V0KCksIG0pO30gaWYgKG0uc3ViTWVudXMpIHJldHVybjsgYXdhaXQgX0ZyRU1ELlJlbmRlclBhZ2Uoe19jb2RlOiBtLmNvZGUgfHwgbS5sYWJlbC5yZXBsYWNlKC8gL2csICIiKS50b0xvd2VyQ2FzZSgpfSwgbS5kYXRhKTt9KSgpJz4ke20ubGFiZWwgfHwgdGhpcy5lbmdsaXNoKG0uY29kZSl9PC9zcGFuPmApOwoJCQkkLmVhY2gobS5zdWJNZW51cywgKF8sIHMpID0+IHJldCArPSBkdihzKSk7CgkJCXJldCArPSAobS5zdWJNZW51cyA/ICI8L2Rpdj5cbiIgOiAiIikgKyBgPC9kaXY+XG5gOwoJCQlyZXR1cm4gcmV0OwoJCX07CgkJZm9yICh2YXIgaSA9IDA7IGkgPCBvcHRpb25zLm1lbnUubGVuZ3RoOyBpKyspIHsKCQkJdmFyIG0gPSBvcHRpb25zLm1lbnVbaV07CgkJCXJldCArPSAnPGRpdiBpZD0ibW0nICsgbS5sYWJlbC5yZXBsYWNlKC8gL2csICcnKSArICciIHN0eWxlPSJ3aWR0aDoxNTBweDsiPic7CgkJCWZvciAodmFyIGogPSAwOyBqIDwgbS5zdWJNZW51cy5sZW5ndGg7IGorKykgewoJCQkJdmFyIHNtID0gbS5zdWJNZW51c1tqXTsKCQkJCXJldCArPSBkdihzbSk7CgkJCX0KCQkJcmV0ICs9ICc8L2Rpdj5cbic7CgkJfQoJCXJldHVybiByZXQ7Cgl9CgoJaW50ZWdlcihvcHRpb25zKSB7CgkJcmV0dXJuIHRoaXMuaW50KG9wdGlvbnMpOwoJfQoKCW51bWJlcihvcHRpb25zKSB7CgkJcmV0dXJuIHRoaXMuaW50KG9wdGlvbnMpOwoJfQoKCUludGVnZXIob3B0aW9ucykgewoJCXJldHVybiB0aGlzLmludChvcHRpb25zKTsKCX0KCglib29sKG9wdGlvbnMpIHsKCQlyZXR1cm4gYDxpbnB1dCBpZD0iJHt0aGlzLnByZWZpeChvcHRpb25zKX0ke29wdGlvbnMubmFtZX0iIGRhdGEtZGZvcm09ImVsZW1lbnQ6JHtvcHRpb25zLm5hbWV9IiByZXF1aXJlZD0iJHtvcHRpb25zLnJlcXVpcmVkPyd0cnVlJzonZmFsc2UnfSIgZGF0YS1vcHRpb25zPSdkaXNhYmxlZDoke29wdGlvbnMuZGlzYWJsZWQ/J3RydWUnOidmYWxzZSd9LCR7dGhpcy5ldmVudEhhbmRsZXJzKG9wdGlvbnMpfScgY2xhc3M9ImVhc3l1aS0ke3RoaXMudWlUeXBlc1tvcHRpb25zLnR5cGVdfSIgJHtvcHRpb25zLmNoZWNrZWQ/J2NoZWNrZWQnOicnfSAvPmA7Cgl9CgoJbGFiZWwob3B0aW9ucykgewoJCXJldHVybiBgPHNwYW4gaWQ9IiR7dGhpcy5wcmVmaXgob3B0aW9ucyl9JHtvcHRpb25zLm5hbWV9IiBzdHlsZT0id2lkdGg6JHt0aGlzLmNXaWR0aChvcHRpb25zKX1weCIgZGF0YS1vcHRpb25zPSJkaXNhYmxlZDoke29wdGlvbnMuZGlzYWJsZWQ/J3RydWUnOidmYWxzZSd9Ij4ke3RoaXMudmFsdWUob3B0aW9ucyl9PC9zcGFuPmA7Cgl9CgoJdXJsKG9wdGlvbnMpIHsKCQlyZXR1cm4gdGhpcy5zdHJpbmcob3B0aW9ucykucmVwbGFjZSgiRmllbGRDaGFuZ2UiLCAiVVJMQ2hhbmdlIik7Cgl9CgoJdGV4dChvcHRpb25zKSB7CgkJcmV0dXJuIGA8aW5wdXQgaWQ9IiR7dGhpcy5wcmVmaXgob3B0aW9ucyl9JHtvcHRpb25zLm5hbWV9IiBjbGFzcz0iZWFzeXVpLSR7b3B0aW9ucy5lZGl0b3IgfHwgdGhpcy51aVR5cGVzW29wdGlvbnMudHlwZV19IiBkYXRhLW9wdGlvbnM9J2Rpc2FibGVkOiR7b3B0aW9ucy5kaXNhYmxlZD8ndHJ1ZSc6J2ZhbHNlJ30sJHt0aGlzLmV2ZW50SGFuZGxlcnMob3B0aW9ucyl9JyBtdWx0aWxpbmU9IiR7b3B0aW9ucy5zaW1wbGUgPyAnZmFsc2UnIDogJ3RydWUnfSIgc3R5bGU9IndoaXRlLXNwYWNlOnByZS13cmFwO3dpZHRoOiR7dGhpcy5jV2lkdGgob3B0aW9ucyl9cHg7aGVpZ2h0OiR7dGhpcy5jSGVpZ2h0KG9wdGlvbnMpfXB4IiByZXF1aXJlZD0iJHtvcHRpb25zLnJlcXVpcmVkID8gJ3RydWUnIDogJ2ZhbHNlJ30iIHZhbHVlPSIke3RoaXMudmFsdWUob3B0aW9ucyl9IiAvPmA7Cgl9CgoJcGFzc3dvcmQob3B0aW9ucykgewoJCXZhciByZXQgPSB0aGlzLnN0cmluZyhvcHRpb25zKTsKCQlyZXQgPSByZXQucmVwbGFjZSgnPGlucHV0ICcsICc8aW5wdXQgdHlwZT0icGFzc3dvcmQiICcpOwoJCXJldHVybiByZXQ7Cgl9CgoJZmlsZShvcHRpb25zKSB7CgkJcmV0dXJuIGA8aW5wdXQgaWQ9IiR7dGhpcy5wcmVmaXgob3B0aW9ucyl9JHtvcHRpb25zLm5hbWV9IiBjbGFzcz0iZWFzeXVpLSR7dGhpcy51aVR5cGVzW29wdGlvbnMudHlwZV19IiBkYXRhLW9wdGlvbnM9Im9uQ2hhbmdlOmZ1bmN0aW9uKG4sbyl7dmFyIHMgPSAkKCcjJyArIHRoaXMuaWQpLmZpbGVib3goJ29wdGlvbnMnKTsgdGhpcy5VcGxvYWRGaWxlKHMsIHRoaXMuYnlOYW1lKCcke29wdGlvbnMubmFtZX0nKSk7fSIgc3R5bGU9IndpZHRoOiR7dGhpcy5jV2lkdGgob3B0aW9ucyl9cHgiPmA7Cgl9CgoJaW1hZ2Uob3B0aW9ucykgewoJCXJldHVybiB0aGlzLmZpbGUob3B0aW9ucykgKyBgPGRpdiBpZD0iZGxnJHtvcHRpb25zLm5hbWV9IiBjbGFzcz0iZWFzeXVpLSR7dGhpcy51aVR5cGVzW29wdGlvbnMudHlwZV19IiB0aXRsZT0iSW1hZ2UgUHJldmlldyIgZGF0YS1vcHRpb25zPSJjbG9zZWQ6dHJ1ZSxpY29uQ2xzOidpY29uLXNhdmUnLHJlc2l6YWJsZTpmYWxzZSxtb2RhbDp0cnVlIiBzdHlsZT0id2lkdGg6NDAwcHg7aGVpZ2h0OjIwMHB4O3BhZGRpbmc6MTBweCI+PGltZyBpZD0iJHt0aGlzLnByZWZpeChvcHRpb25zKX0ke29wdGlvbnMubmFtZX0iIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiLz48L2Rpdj5gOwoJfQoKCXByb2dyZXNzKG9wdGlvbnMpIHsKCQlpZiAoIW9wdGlvbnMuaGVpZ2h0KSBvcHRpb25zLmhlaWdodCA9IDIwOyAvLyBmaXggYmlnIHByb2dyZXNzCgkJcmV0dXJuIGA8ZGl2IGlkPSIke3RoaXMucHJlZml4KG9wdGlvbnMpfSR7b3B0aW9ucy5uYW1lfSIgY2xhc3M9ImVhc3l1aS0ke3RoaXMudWlUeXBlc1tvcHRpb25zLnR5cGVdfSIgZGF0YS1vcHRpb25zPSJ2YWx1ZToke3RoaXMudmFsdWUob3B0aW9ucyl9IiBzdHlsZT0id2lkdGg6JHt0aGlzLmNXaWR0aChvcHRpb25zKX1weDtoZWlnaHQ6JHt0aGlzLmNIZWlnaHQob3B0aW9ucyl9cHgiPjwvZGl2PmA7Cgl9CgoJZmxvd2NoYXJ0KG9wdGlvbnMpIHsKCQlyZXR1cm4gYDxkaXYgaWQ9ImZsdyR7b3B0aW9ucy5uYW1lfSIgd2lkdGg9IiR7dGhpcy5jV2lkdGgob3B0aW9ucyl9IiBoZWlnaHQ9IiR7dGhpcy5jSGVpZ2h0KG9wdGlvbnMpfSI+PC9kaXY+YDsKCX0KCgljaGFydChvcHRpb25zKSB7CgkJcmV0dXJuIGA8ZGl2IGlkPSJjaHQke29wdGlvbnMubmFtZX0iIHdpZHRoPSIke3RoaXMuY1dpZHRoKG9wdGlvbnMpfSIgaGVpZ2h0PSIke3RoaXMuY0hlaWdodChvcHRpb25zKX0iPjwvZGl2PmA7Cgl9CgoJZm9ybWF0dGVyKG5hbWUsIGMsIGpzb24pIHsKCQlqc29uID0ganNvbiA/ICciJyA6ICcnOwoJCXJldHVybiBgJHtqc29ufSh2YWx1ZSwgcm93LCBpbmRleCkgPT4ge3RyeXt2YXIgYyA9IChERm9ybS5ieU5hbWUoXGAke25hbWV9XGApLmNvbHVtbnMgfHwgW10pLmZpbmQoYyA9PiBjLmZpZWxkPT1cYCR7Yy5maWVsZH1cYCk7IHJldHVybiBjJiZjLmZvcm1hdD9jLmZvcm1hdCh2YWx1ZSxyb3csaW5kZXgpOnZhbHVlO31jYXRjaChleCl7cmV0dXJuIHZhbHVlO30gfSR7anNvbn1gOwoJfQoKCW1hcENvbHVtbnMob3B0aW9ucywganNvbikgewoJCWxldCBjVGl0bGUgPSBjID0+IGMudGl0bGUgfHwgdGhpcy5lbmdsaXNoKGMuZmllbGQpOwoKCQl2YXIgY29scyA9ICQuZ3JlcChvcHRpb25zLmNvbHVtbnMgfHwgW10sIGMgPT4gIWMuaWdub3JlKTsKCQlsZXQgcmV0ID0gIiI7CgkJaWYgKG9wdGlvbnMubXVsdGlwbGUpIHJldCArPSBgeyJmaWVsZCI6J2NrJywiY2hlY2tib3giOnRydWV9LGA7CgkJcmV0ID0gYCJmcm96ZW5Db2x1bW5zIjogW1tgOwoJCWlmICghb3B0aW9ucy5mcm96ZW4pIHsKCQkJcmV0ICs9IGB7ImZpZWxkIjoiJHtvcHRpb25zLmlkRmllbGQuZmllbGR9IiwidGl0bGUiOiAiJHtvcHRpb25zLmlkRmllbGQudGl0bGV9Iiwic29ydGFibGUiOiAidHJ1ZSIsICJmb3JtYXR0ZXIiOiAke3RoaXMuZm9ybWF0dGVyKG9wdGlvbnMubmFtZSwgb3B0aW9ucy5pZEZpZWxkLCBqc29uKX19LGA7CgkJCWlmIChvcHRpb25zLnRleHRGaWVsZC5maWVsZCAhPSBvcHRpb25zLmlkRmllbGQuZmllbGQpIHJldCArPSBgeyJmaWVsZCI6IiR7b3B0aW9ucy50ZXh0RmllbGQuZmllbGQgfHwgb3B0aW9ucy50ZXh0RmllbGQudGl0bGV9IiwidGl0bGUiOiIke29wdGlvbnMudGV4dEZpZWxkLnRpdGxlIHx8IG9wdGlvbnMudGV4dEZpZWxkLmZpZWxkfSIsIndpZHRoIjoiJHtvcHRpb25zLnRleHRGaWVsZC53aWR0aHx8MTIwfSIsICJzb3J0YWJsZSI6ICJ0cnVlIiwgImZvcm1hdHRlciI6ICR7dGhpcy5mb3JtYXR0ZXIob3B0aW9ucy5uYW1lLCBvcHRpb25zLnRleHRGaWVsZCwganNvbil9fWA7CgkJfSBlbHNlIHsKCQkJJC5tYXAoJC5ncmVwKGNvbHMsIGMgPT4gYy5mcm96ZW4pLCBjID0+IGB7ImZpZWxkIjoiJHtjLmZpZWxkIHx8IGNUaXRsZShjKX0iLCJ0aXRsZSI6IiR7Y1RpdGxlKGMpIHx8IGMuZmllbGR9Iiwid2lkdGgiOiIke2Mud2lkdGh8fDEyMH0iLCJhbGlnbiI6J2xlZnQnLCJzb3J0YWJsZSI6InRydWUiLCAiZm9ybWF0dGVyIjogJHt0aGlzLmZvcm1hdHRlcihvcHRpb25zLm5hbWUsIGMsIGpzb24pfX1gKS5qb2luKCIsIik7CgkJfQoJCXJldCArPSBgXV0sICJjb2x1bW5zIjogW1tgOwoJCXJldCArPSAkLm1hcCgkLmdyZXAoY29scywgYyA9PiAhYy5mcm96ZW4pLCBjID0+IGB7ImZpZWxkIjoiJHtjLmZpZWxkIHx8IGNUaXRsZShjKX0iLCJ0aXRsZSI6IiR7Y1RpdGxlKGMpIHx8IGMuZmllbGR9IiwiYWxpZ24iOiJsZWZ0Iiwic29ydGFibGUiOiJ0cnVlIiwgImZvcm1hdHRlciI6ICR7dGhpcy5mb3JtYXR0ZXIob3B0aW9ucy5uYW1lLCBjLCBqc29uKX19YCkuam9pbigiLCIpOwoJCXJldCArPSAnXV0nOwoJCXJldHVybiByZXQ7Cgl9CgoJc2VsZWN0KG9wdGlvbnMsIHRhZyA9IG9wdGlvbnMudGFnLCB0eXBlKSB7CgkJcmV0dXJuIHRoaXMuY29tYm8ob3B0aW9ucywgdGFnLCB0eXBlKTsKCX0KCgl0cmVlKG9wdGlvbnMpIHsKCQlyZXR1cm4gdGhpcy5zZWxlY3Qob3B0aW9ucywgInNlbGVjdCIpOwoJfQoKCW5hdmlnYXRpb24ob3B0aW9ucykgewoJCXJldHVybiB0aGlzLmNvbWJvKG9wdGlvbnMsICd1bCcsICd0cmVlJyk7Cgl9CgoJY29tYm8ob3B0aW9ucywgdGFnLCB0eXBlKSB7CgkJdmFyIGNvbHMgPSAkLmdyZXAob3B0aW9ucy5jb2x1bW5zIHx8IFtdLCBjID0+ICFjLmlnbm9yZSk7CgkJdGFnID0gdGFnIHx8ICJzZWxlY3QiOwoJCW9wdGlvbnMuaWRGaWVsZCA9ICQudW5pcXVlU29ydChbewoJCQlmaWVsZDogb3B0aW9ucy5pZEZpZWxkLAoJCQl0aXRsZTogb3B0aW9ucy5pZEZpZWxkCgkJfV0uY29uY2F0KCQuZ3JlcChjb2xzLCBjID0+IGMucHJpbWFyeSksIFt7CgkJCWZpZWxkOiAnSWQnLAoJCQl0aXRsZTogJ0lEJwoJCX1dKSkuZmluZCh4ID0+IHR5cGVvZih4LmZpZWxkKSAhPT0gInVuZGVmaW5lZCIpOwoJCW9wdGlvbnMudGV4dEZpZWxkID0gJC51bmlxdWVTb3J0KFt7CgkJCWZpZWxkOiBvcHRpb25zLnRleHRGaWVsZCwKCQkJdGl0bGU6IG9wdGlvbnMudGV4dEZpZWxkCgkJfV0uY29uY2F0KCQuZ3JlcChjb2xzLCBjID0+IGMuZGlzcGxheSksIFt7CgkJCWZpZWxkOiAnX1RvU3RyaW5nJywKCQkJdGl0bGU6IG9wdGlvbnMubmFtZSwKCQl9XSkpLmZpbmQoeCA9PiB0eXBlb2YoeC5maWVsZCkgIT09ICJ1bmRlZmluZWQiKTsKCQl2YXIgZnVuID0gdHlwZSB8fCB0aGlzLmVGdW4ob3B0aW9ucyk7CgkJdmFyIGRyb3Bkb3duID0gWydjb21ib3RyZWVncmlkJywgJ2NvbWJvdHJlZScsICdjb21ib2dyaWQnLCAnc2VsZWN0J10uaW5kZXhPZihmdW4pID4gLTE7CgkJaWYgKGRyb3Bkb3duKSB0aGlzLnNlbGVjdHMucHVzaCh7CgkJCWlkOiAiY21iIiArIG9wdGlvbnMubmFtZSwKCQkJb3B0aW9uczogdGhpcy5ieU5hbWUob3B0aW9ucy5uYW1lKQoJCX0pOwoJCXRoaXMuc2VsZWN0cyA9ICQudW5pcXVlU29ydCh0aGlzLnNlbGVjdHMpOwoJCXZhciByZXQgPSBgPCR7dGFnfSBpZD0iY21iJHtvcHRpb25zLm5hbWV9IiBjbGFzcz0iZWFzeXVpLSR7ZnVufSIgc3R5bGU9Im1heC13aWR0aDoke2Ryb3Bkb3duPyc0MDBweCc6dGhpcy5jV2lkdGgob3B0aW9ucyl9OyB3aWR0aDoke3RoaXMuY1dpZHRoKG9wdGlvbnMpfXB4IiByZXF1aXJlZD0iJHsob3B0aW9ucy5yZXF1aXJlZCA/ICd0cnVlJyA6ICdmYWxzZScpfSIgZGF0YS1vcHRpb25zPSdkaXNhYmxlZDoke29wdGlvbnMuZGlzYWJsZWQ/J3RydWUnOidmYWxzZSd9LCR7dGhpcy5ldmVudEhhbmRsZXJzKG9wdGlvbnMpfSwgdmFsdWU6IiR7dGhpcy52YWx1ZShvcHRpb25zKX0iLCByb3dudW1iZXJzOiR7dHlwZW9mKG9wdGlvbnMucm93TnVtYmVycykhPT0ndW5kZWZpbmVkJz9vcHRpb25zLnJvd051bWJlcnM6KGZ1bi5pbmRleE9mKCd0cmVlJyk8LTE/J2ZhbHNlJzondHJ1ZScpfSwgcGFnaW5hdGlvbjoke3R5cGVvZihvcHRpb25zLnBhZ2luYXRpb24pIT09J3VuZGVmaW5lZCc/b3B0aW9ucy5wYWdpbmF0aW9uOihmdW4uaW5kZXhPZigndHJlZScpPC0xPydmYWxzZSc6J3RydWUnKX0sIHBhbmVsV2lkdGg6JHsyKnRoaXMuY1dpZHRoKG9wdGlvbnMpfSwgZml0Q29sdW1uczogdHJ1ZSwgc2luZ2xlU2VsZWN0OiB0cnVlLCBtdWx0aXBsZTokeyhvcHRpb25zLm11bHRpcGxlIHx8ICdmYWxzZScpfSwgaWRGaWVsZDogIiR7b3B0aW9ucy5pZEZpZWxkLmZpZWxkfSIsIGVuYWJsZUZpbHRlcjogJHtvcHRpb25zLmZpbHRlcj8ndHJ1ZSc6J2ZhbHNlJ30sIG5vd3JhcDogZmFsc2UsIHRleHRGaWVsZDogIiR7b3B0aW9ucy50ZXh0RmllbGQuZmllbGR9IiwgdHJlZUZpZWxkOiAiJHtvcHRpb25zLnRleHRGaWVsZC5maWVsZH0iLGA7CgkJaWYgKGZ1bi5pbmRleE9mKCd0cmVlJykgPT0gLTEpIHsKCQkJcmV0ICs9ICdmaXRDb2x1bW5zOiBmYWxzZSwnICsgdGhpcy5tYXBDb2x1bW5zKG9wdGlvbnMpOwoJCX0KCQlpZiAob3B0aW9ucy5kYXRhKSB7CgkJCXJldCArPSBgLGRhdGE6ICR7SlNPTi5zdHJpbmdpZnkob3B0aW9ucy5kYXRhKX1gOwoJCX0KCQlyZXQgKz0gYCc+YDsKCQlpZiAob3B0aW9ucy5vcHRpb25zKSB7CgkJCXJldCArPSAkLm1hcChvcHRpb25zLm9wdGlvbnMsIG8gPT4gYDxvcHRpb24gdmFsdWU9JyR7X0ZyRU1ELl90b0pTKG8pfSc+JHtvLm5hbWUgfHwgb308L29wdGlvbj5gKS5qb2luKCdcbicpOwoJCX0KCQlyZXQgKz0gYDwvJHt0YWd9PmA7CgkJLy8gY29uc29sZS5sb2cocmV0KTsKCQlyZXR1cm4gcmV0OwoJfQoKCWdyaWQob3B0aW9ucywgdGFnLCB0eXBlKSB7CgkJcmV0dXJuIHRoaXMuY29tYm8ob3B0aW9ucywgInRhYmxlIiwgImRhdGFncmlkIik7Cgl9CgoJdHJlZWdyaWQob3B0aW9ucykgewoJCXJldHVybiB0aGlzLmNvbWJvKG9wdGlvbnMsICd0YWJsZScsICd0cmVlJyk7Cgl9CgoJYXN5bmMgZG9MaW5rKGUsIGV2ZW50KSB7CgkJdGhpcy5idXN5KHRydWUpOwoJCXRyeSB7CgkJCWF3YWl0IGUubGlua3MuZmluZChsID0+IGwubGFiZWwgPT0gZXZlbnQudGFyZ2V0LmlubmVyVGV4dCkub25DbGljayh0aGlzLmdldCgpKTsKCQl9IGNhdGNoIChleCkgewoJCQljb25zb2xlLmxvZygiZG9MaW5rIiwgZXgpOwoJCX0KCQl0aGlzLmJ1c3koZmFsc2UpOwoJfQoKCUVkaXRlZFZhbHVlKGUpIHsKCQlyZXR1cm4gKHR5cGVvZihhY2UpICE9PSAidW5kZWZpbmVkIikgPyBhY2UuZWRpdCgncG5sJyArIGUubmFtZSkuc2Vzc2lvbi5nZXRWYWx1ZSgpIDogJyc7Cgl9CgoJYXN5bmMgUGFuT25DbG9zZShlKSB7CgkJaWYgKGUuZWRpdG9yKSB7CgkJCWUudmFsdWUgPSB0aGlzLkVkaXRlZFZhbHVlKGUpOwoJCX0KCQlpZiAoZS5jbG9zZSkgewoJCQlhd2FpdCBlLmNsb3NlKHRoaXMuZ2V0KCkpOwoJCX0KCX0KCglhc3luYyBQZW5kQWZ0ZXJPcGVuKGUpIHsKCQlpZiAoZS5lZGl0b3IgJiYgdHlwZW9mKGFjZSkgIT09ICJ1bmRlZmluZWQiKSB7CgkJCWF3YWl0IF9GckVNRC5PcGVuRWRpdG9yKCdwbmwnICsgZS5uYW1lIC8qKyAnLWNlbnRlcicqLyAsIGUubGFuZ3VhZ2UsIGUubG9hZGVyIHx8IChvID0+IGUudmFsdWUpLCBlLnNhdmVyLCB0aGlzLmdldCgpLCBlKTsKCQl9CgkJaWYgKGUub3BlbikgewoJCQlhd2FpdCBlLm9wZW4odGhpcy5nZXQoKSk7CgkJfQoJfQoKCWxpbmsob3B0aW9ucykgewoJCXJldHVybiAob3B0aW9ucy5saW5rcyB8fCBbXSkuZmlsdGVyKGwgPT4gIWwuaWdub3JlKS5tYXAobCA9PiBgPGEgaHJlZj0iIyIgY2xhc3M9ImVhc3l1aS0ke3RoaXMudWlUeXBlc1tvcHRpb25zLnR5cGVdfSIgZGF0YS1vcHRpb25zPScke3RoaXMuZXZlbnRIYW5kbGVycyhvcHRpb25zKX0sIGljb25DbHM6Imljb24tJHtsLmljb24gfHwgJ29rJ30iJz4ke2wubGFiZWx9PC9hPmApLmpvaW4oJ1xuJyk7Cgl9CgoJYXN5bmMgU2V0VHJlZURhdGEoZSwgbiwgZGF0YSkgewoJCSQuZWFjaCgkKCIjY21iIiArIGUubmFtZSlbdGhpcy5lRnVuKGUpXSgndHJlZScpLnRyZWUoImdldENoaWxkcmVuIiwgbi50YXJnZXQpLCAoXywgYykgPT4gJCgiI2NtYiIgKyBlLm5hbWUpW3RoaXMuZUZ1bihlKV0oJ3RyZWUnKS50cmVlKCJyZW1vdmUiLCBjLnRhcmdldCkpOwoJCSQoIiNjbWIiICsgZS5uYW1lKVt0aGlzLmVGdW4oZSldKCd0cmVlJykudHJlZSgiYXBwZW5kIiwgewoJCQlwYXJlbnQ6IG4udGFyZ2V0LAoJCQlkYXRhOiBkYXRhCgkJfSk7CgkJcmV0dXJuIHRydWU7Cgl9CgoJYXN5bmMgRXhwYW5kKGUsIG4pIHsKCQl0aGlzLlNldFRyZWVEYXRhKGUsIG4sIFt7CgkJCWlkOiBudWxsLAoJCQl0ZXh0OiAibG9hZGluZy4uLiIKCQl9XSk7CgkJdmFyIG9iaiA9IHt9OwoJCXZhciBwRmllbGQgPSBlLnBhcmVudEZpZWxkIHx8ICQubWFwKCQuZ3JlcChlLmNvbHVtbnMgfHwgW10sIGMgPT4gYy5wYXJlbnQpLCBjID0+IGMuZmllbGQpLmNvbmNhdChbbnVsbF0pWzBdOwoJCXZhciBpZEZpZWxkID0gJC5ncmVwKGUuY29sdW1ucyB8fCBbXSwgYyA9PiBjLnByaW1hcnkpLmNvbmNhdChlLmlkRmllbGQpWzBdLmZpZWxkOwoJCWlmIChwRmllbGQpIHsKCQkJb2JqW3BGaWVsZF0gPSB7CgkJCQlfc291cmNlOiBuLl9zb3VyY2UKCQkJfTsKCQkJaWYgKGlkRmllbGQpIHsKCQkJCW9ialtwRmllbGRdW2lkRmllbGRdID0gbi5pZDsKCQkJfSBlbHNlIHsKCQkJCW9ialtwRmllbGRdID0gbi5pZDsKCQkJfQoJCX0KCQlsZXQgZGF0YSA9IGF3YWl0IHRoaXMuX2xvYWREYXRhKHsKCQkJaWQ6ICJjbWIiICsgZS5uYW1lLAoJCQlvcHRpb25zOiBlCgkJfSwgb2JqKTsKCQl0aGlzLlNldFRyZWVEYXRhKGUsIG4sIGRhdGEpOwoJfQoKCWFzeW5jIF9sb2FkRGF0YShzLCBvLCBzdGFydCwgZW5kKSB7CgkJdmFyIG5hbWUgPSAocyAmJiBzLm9wdGlvbnMgPyAocy5vcHRpb25zLkNsYXNzID8gcy5vcHRpb25zLkNsYXNzLk5hbWUucmVwbGFjZSgnICcsICdfJykgOiAocy5vcHRpb25zLnRhYmxlIHx8IHMub3B0aW9ucy5uYW1lKSkgOiBzLm5hbWUpOwoJCW5hbWUgPSBuYW1lLnRyaW0oKTsgLy8uc3BsaXQoJy4nKS5zbGljZSgtMSlbMF07CgoJCWxldCBvU2NvcGUgPSAodHlwZW9mKGNvbXBhbnkpICE9PSAndW5kZWZpbmVkJyAmJiBjb21wYW55LlNjb3BlKSA/IHdpbmRvd1tjb21wYW55LlNjb3BlXSA6IHdpbmRvdzsKCQlvID0gbyB8fCAoKG9TY29wZSAmJiBvU2NvcGVbbmFtZV0pID8gbmV3IG9TY29wZVtuYW1lXSgpIDogewoJCQlBY3RpdmU6IHRydWUsCgkJfSk7CgoJCW8gPSAodHlwZW9mIGZpbHRlcnMgIT09ICJ1bmRlZmluZWQiICYmIGZpbHRlcnMgJiYgZmlsdGVyc1tuYW1lXSkgPyBmaWx0ZXJzW25hbWVdKG8pIDogbzsKCQlvID0gKHMgJiYgcy5vcHRpb25zICYmIHMub3B0aW9ucy5zb3VyY2UgPyBzLm9wdGlvbnMuc291cmNlKG8sIHRoaXMuZ2V0KCkpIDogbyk7CgkJbGV0IG5hbWVzID0gJC51bmlxdWVTb3J0KFtzLm9wdGlvbnMuc2VhcmNoRmllbGRdLmNvbmNhdCgkLm1hcCgkLmdyZXAocy5vcHRpb25zLmNvbHVtbnMgfHwgW10sIGMgPT4gYy5zZWFyY2gpLCBjID0+IGMuZmllbGQpLCBbIk5hbWUiXSkpOwoJCXZhciBmdW4gPSB0aGlzLmVGdW4ocy5vcHRpb25zKTsKCQlpZiAoIW9bbmFtZXNbMF1dKSBvW25hbWVzWzBdXSA9ICQoIiMiICsgcy5pZClbZnVuXSgnZ2V0VGV4dCcpOwoJCXZhciBkYXRhID0gbnVsbDsKCgkJbGV0IGxpYiA9ICcnOwoJCWlmIChuYW1lLmluZGV4T2YoJy4nKSA+IDApIHsKCQkJbGliID0gbmFtZS5zcGxpdCgnLicpWzBdICsgJy4nOwoJCQluYW1lID0gbmFtZS5zcGxpdCgnLicpWzFdOwoJCX0KCgkJaWYgKHMub3B0aW9ucy5sb2FkZXIpIHsKCQkJZGF0YSA9IGF3YWl0IHMub3B0aW9ucy5sb2FkZXIodGhpcy5nZXQoKSwgcy5vcHRpb25zLCBvKTsKCQl9IGVsc2UgaWYgKHR5cGVvZihjb21wYW55KSAhPT0gJ3VuZGVmaW5lZCcgJiYgY29tcGFueS5saWJyYXJ5ICYmIGNvbXBhbnkuQ29kZSAmJiB3aW5kb3cuYkxvY2FsKSB7CgkJCS8vY29uc29sZS5sb2coIkRGb3JtOjpfbG9hZERhdGEoKTogc3IoKS5fKCIgKyBsaWIgKyBjb21wYW55LkNvZGUudG9Mb3dlckNhc2UoKSArIG5hbWUgKyAiRmluZGFsbCIgKyAiKSIsIG8pOwoJCQlkYXRhID0gYXdhaXQgdGhpcy5zcigpLl8obGliICsgY29tcGFueS5Db2RlLnRvTG93ZXJDYXNlKCkgKyBuYW1lICsgIkZpbmRhbGwiLCBudWxsLCBvLCBudWxsLCBzdGFydCwgZW5kKTsKCQl9IGVsc2UgaWYgKF9GckVNRC5hcGlTZXJ2ZXIpIHsKCQkJZGF0YSA9IGF3YWl0IF9GckVNRC5hcGlTZXJ2ZXIuX25ldyhuYW1lKS5fZnJvbURvY3VtZW50KE9iamVjdC5hc3NpZ24oLi4uT2JqZWN0LmtleXMobykubWFwKGsgPT4gKHsKCQkJCVtTdHJpbmcoaykuY2hhckF0KDApLnRvTG93ZXJDYXNlKCkgKyBTdHJpbmcoaykuc2xpY2UoMSldOiBvW2tdCgkJCX0pKSkpLmZpbmRBbGwoKTsKCQl9IGVsc2UgewoJCQkvLyBlbXMKCQkJZGF0YSA9IGF3YWl0IG8uZmluZEFsbCgpOwoJCQkvL2RhdGEgPSBhd2FpdCB3aW5kb3cuX0ZyRU1ELl9vKG51bGwsIG8pOwoJCX0KCQlpZiAocy5vcHRpb25zLnBvc3Rsb2FkKSB7CgkJCWF3YWl0IHMub3B0aW9ucy5wb3N0bG9hZChkYXRhKTsKCQl9CgkJJC5lYWNoKGRhdGEsIChpLCBkKSA9PiB7CgkJCWQuX19PV05FUiA9IHM7CgkJCSQuZWFjaChzLm9wdGlvbnMuY29sdW1ucywgKF8sIGMpID0+IHsKCQkJCWlmIChjLnZhbHVlKSB7CgkJCQkJZFtjLmZpZWxkXSA9IGMudmFsdWUoZCwgZGF0YSwgaSk7CgkJCQl9CgkJCX0pOwoJCX0pOwoJCWlmICghcy5vcHRpb25zLmNvbHVtbnMgJiYgZnVuLmluZGV4T2YoJ3RyZWUnKSA+IC0xKSB7CgkJCWRhdGEgPSAkLm1hcChkYXRhLCBkID0+IHsKCQkJCWxldCByZXQgPSB7CgkJCQkJaWQ6IGRbcy5vcHRpb25zLmlkRmllbGQuZmllbGRdLAoJCQkJCXRleHQ6IGRbcy5vcHRpb25zLnRleHRGaWVsZC5maWVsZF0sCgkJCQkJc3RhdGU6IGQuc3RhdGUgfHwgKHMub3B0aW9ucy5sb2FkZXIgPyAiZmlsZSIgOiAiY2xvc2VkIiksCgkJCQkJX3NvdXJjZTogZCwKCQkJCX07CgkJCQlyZXQuY2hpbGRyZW4gPSAocmV0LnN0YXRlID09ICJjbG9zZWQiKSA/IFt7CgkJCQkJdGV4dDogJ2xvYWRpbmcuLi4nCgkJCQl9XSA6IG51bGw7CgkJCQlyZXR1cm4gcmV0OwoJCQl9KTsKCQl9CgkJcmV0dXJuIGRhdGEgfHwgW107Cgl9CgoJYXN5bmMgZmlsbERhdGEoZywgbywgc3RhcnQsIGVuZCkgewoJCXZhciBzID0gbnVsbDsKCQlmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuc2VsZWN0cy5sZW5ndGg7IGkrKykgewoJCQlpZiAodGhpcy5zZWxlY3RzW2ldLmlkID09IGdbMF0uaWQpIHMgPSB0aGlzLnNlbGVjdHNbaV07CgkJfQoJCWlmICghcykgcmV0dXJuOwoJCXRoaXMuYnVzeSh0cnVlKTsKCQl0cnkgewoJCQl2YXIgZnVuID0gZ1swXS5jbGFzc0xpc3RbIjAiXS5yZXBsYWNlKCdlYXN5dWktJywgJycpOwoJCQl0cnkgewoJCQkJJCgiIyIgKyBzLmlkKVtmdW5dKCdncmlkJykuZGF0YWdyaWQoJ2dldFBhZ2VyJykucGFnaW5hdGlvbignbG9hZGluZycpOwoJCQl9IGNhdGNoIChleCkge30KCQkJaWYgKHMub3B0aW9ucy5ub2xvYWQpIHsKCQkJCWxldCBfZGF0YSA9IG51bGw7CgkJCQl0cnkgewoJCQkJCV9kYXRhID0gJCgiIyIgKyBzLmlkKVtmdW5dKCdncmlkJykuZGF0YWdyaWQoImdldERhdGEiKTsKCQkJCX0gY2F0Y2ggKGV4KSB7CgkJCQkJX2RhdGEgPSAkKCIjIiArIHMuaWQpW2Z1bl0oJ3RyZWUnKS50cmVlKCdnZXRSb290Jyk7CgkJCQl9CgkJCQlpZiAoX2RhdGEpIHsKCQkJCQlyZXR1cm4gdGhpcy5idXN5KGZhbHNlKTsKCQkJCX0KCQkJfQoJCQl2YXIgZGF0YSA9IGF3YWl0IHRoaXMuX2xvYWREYXRhKHMsIG8sIHN0YXJ0LCBlbmQpOwoJCQl0cnkgewoJCQkJaWYgKCQoIiMiICsgcy5pZClbZnVuXSgnZ3JpZCcpKSAkKCIjIiArIHMuaWQpW2Z1bl0oJ2dyaWQnKS5kYXRhZ3JpZCgnZ2V0UGFnZXInKS5wYWdpbmF0aW9uKCdsb2FkZWQnKTsKCQkJfSBjYXRjaCAoZXgpIHt9CgkJCXRyeSB7CgkJCQkkKCIjIiArIHMuaWQpW2Z1bl0oJ2dyaWQnKS5kYXRhZ3JpZCgnbG9hZERhdGEnLCB7CgkJCQkJdG90YWw6IGRhdGEuQ291bnQgfHwgZGF0YS5sZW5ndGgsCgkJCQkJcm93czogZGF0YSwKCQkJCX0pOwoJCQl9IGNhdGNoIChleCkgewoJCQkJJCgiIyIgKyBzLmlkKVtmdW5dKCd0cmVlJykudHJlZSgnbG9hZERhdGEnLCBkYXRhKTsKCQkJfQoJCX0gY2F0Y2ggKGV4KSB7CgkJCWNvbnNvbGUubG9nKGV4KTsKCQl9CgkJdGhpcy5idXN5KGZhbHNlKTsKCX0KCglldmVudEhhbmRsZXJzKG9wdGlvbnMpIHsKCQlpZiAoIXRoaXMuYnlOYW1lKG9wdGlvbnMubmFtZSkpIHJldHVybjsgLy8gaWYgbm90IGFuIGVsZW1lbnQsIGRvIG5vdCBydW4gdGhlIGhhbmRsZXJzCgoJCXJldHVybiB0aGlzLmV2ZW50cy5maWx0ZXIoZSA9PiBlLnR5cGUgPT0gb3B0aW9ucy50eXBlIHx8IHR5cGVvZihlLnR5cGUpID09PSAndW5kZWZpbmVkJykubWFwKGUgPT4gYCR7ZS5uYW1lfTogKCR7ZS5wYXJhbXMgfHwgJyd9KSA9PiB7dHJ5e0RGb3JtLiR7ZS5oYW5kbGVyfShERm9ybS5ieU5hbWUoIiR7b3B0aW9ucy5uYW1lfSIpIHx8ICR7X0ZyRU1ELl90b0pTKG9wdGlvbnMpfSB8fCB7bmFtZTogIiR7b3B0aW9ucy5uYW1lfSIsdHlwZTogIiR7b3B0aW9ucy50eXBlfSJ9LCAke2UucGFyYW1zfSl9Y2F0Y2goZXgpe2NvbnNvbGUubG9nKCJFdmVudCBFcnJvcjogJHtvcHRpb25zLm5hbWV9LyR7b3B0aW9ucy50eXBlfS8ke2UubmFtZX0iLCBleCk7fX1gKS5qb2luKCcsJyk7Cgl9CgoJYXN5bmMgUGFuZWxPcGVuKGUpIHsKCQlpZiAoZS5lZGl0b3IpIHJldHVybiB0cnVlOwoJCWxldCBjb250ZW50ID0gZS52YWx1ZTsKCQlpZiAoZS5sb2FkZXIpIHsKCQkJY29udGVudCA9IGF3YWl0IGUubG9hZGVyKHRoaXMuZ2V0KCkpOwoJCX0KCQlpZiAoY29udGVudCkgewoJCQl0cnkgewoJCQkJJCgiI3BubCIgKyBlLm5hbWUpLnBhbmVsKCdib2R5JykuaHRtbChjb250ZW50KTsKCQkJCWNvbnNvbGUubG9nKCJwbmwiICsgZS5uYW1lICsgIjogQ29udGVudCBWYWxpZCIpOwoJCQl9IGNhdGNoIChleCkgewoJCQkJLy9jb25zb2xlLmxvZyhleCk7CgkJCX0KCQl9CgkJcmV0dXJuIGNvbnRlbnQ7Cgl9CgoJYXN5bmMgU2VsZWN0Q2hhbmdlKG9wdGlvbnMsIHRhYikgewoJCXRoaXMuYnVzeSh0cnVlKTsKCQkkLmdyZXAodGhpcy5lbGVtZW50cywgZSA9PiBlLnR5cGUgPT0gImdyaWQiICYmIGUuZ3JvdXAgPT0gdGFiKS5mb3JFYWNoKGUgPT4gJCgiI2NtYiIgKyBlLm5hbWUpLmRhdGFncmlkKCkpOwoJCXRoaXMuYnVzeShmYWxzZSk7Cgl9CgoJYXN5bmMgRmllbGRDaGFuZ2Uob3B0aW9ucywgdmFsdWUpIHsKCQl0aGlzLmJ1c3kodHJ1ZSk7CgkJaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5jaGFuZ2UpIHsKCQkJYXdhaXQgb3B0aW9ucy5jaGFuZ2UodGhpcy5nZXQoKSwgdmFsdWUpOwoJCX0KCQl0aGlzLmJ1c3koZmFsc2UpOwoJfQoKCWFzeW5jIFVSTENoYW5nZShzLCBvcHRpb25zKSB7CgkJdGhpcy5idXN5KHRydWUpOwoJCW9wdGlvbnMuZGF0YSA9IGF3YWl0ICQuZ2V0KHMudmFsdWUpOwoJCXJldHVybiBhd2FpdCB0aGlzLkZpZWxkQ2hhbmdlKHMsIG9wdGlvbnMpOwoJfQoKCVVwbG9hZEZpbGUoZiwgb3B0aW9ucykgewoJCXRoaXMuYnVzeSh0cnVlKTsKCQl2YXIgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEoKTsKCQl2YXIgZmlsZWlkID0gTWF0aC5yYW5kb20oKTsKCQl2YXIgbWV0aG9kID0gb3B0aW9ucy5tZXRob2QgfHwgIkNvbnRlbnRNYW5hZ2VyLmNtc1VwbG9hZEZpbGUiOwoJCWZvcm1EYXRhLmFwcGVuZCgnZmlsZWlkJywgZmlsZWlkKTsKCQl2YXIgZmlsZSA9ICQoIiMiICsgZi5maWxlYm94SWQpWzBdLmZpbGVzWzBdOwoJCWZvcm1EYXRhLmFwcGVuZCgnX19VRklMRScsIGZpbGUpOwoJCWlmIChvcHRpb25zLmxvY2FsKSB7CgkJCS8vIGhhbmRsaW5nIHRoZSBmaWxlIGxvY2FsbHkKCQkJdmFyIHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7CgkJCXJlYWRlci5vbmxvYWQgPSAoZSkgPT4gewoJCQkJdmFyIGRhdGEgPSBlLnRhcmdldC5yZXN1bHQ7CgkJCQlyZXQgPSBkYXRhOwoJCQkJdGhpcy5ieU5hbWUob3B0aW9ucy5uYW1lKS5kYXRhID0gcmV0OwoJCQkJaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy51cGxvYWQpIG9wdGlvbnMudXBsb2FkKHRoaXMuZ2V0KCksIHJldCk7CgkJCX07CgkJCWlmIChvcHRpb25zLmJpbmFyeSkgewoJCQkJcmVhZGVyLnJlYWRBc0JpbmFyeVN0cmluZyhmaWxlKTsKCQkJfSBlbHNlIGlmIChvcHRpb25zLmRhdGF1cmwpIHsKCQkJCXJlYWRlci5yZWFkQXNEYXRhVVJMKGZpbGUpOwoJCQl9IGVsc2UgewoJCQkJcmVhZGVyLnJlYWRBc1RleHQoZmlsZSk7CgkJCX0KCQkJdGhpcy5idXN5KGZhbHNlKTsKCQl9IGVsc2UgaWYgKG1ldGhvZCkgewoJCQkkLmFqYXgoewoJCQkJdXJsOiB0aGlzLnNyKCkuc3JVUkwgKyAiJm1ldGhvZD0iICsgbWV0aG9kICsgIiZzSW5wdXQ9IiArIGZpbGVpZCArICImcHJlVGFnPSZwb3N0VGFnPSIsCgkJCQlkYXRhOiBmb3JtRGF0YSwKCQkJCS8vIFRISVMgTVVTVCBCRSBET05FIEZPUiBGSUxFIFVQTE9BRElORwoJCQkJY2FjaGU6IGZhbHNlLAoJCQkJY29udGVudFR5cGU6IGZhbHNlLAoJCQkJdHlwZTogJ1BPU1QnLAoJCQkJcHJvY2Vzc0RhdGE6IGZhbHNlLAoJCQkJc3VjY2VzczogZGF0YSA9PiB7CgkJCQkJdGhpcy5zcigpLnJ1blNjcmlwdChkYXRhKTsKCQkJCQl0aGlzLmJ5TmFtZShvcHRpb25zLm5hbWUpLmRhdGEgPSByZXQ7CgkJCQkJaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy51cGxvYWQpIG9wdGlvbnMudXBsb2FkKHRoaXMuZ2V0KCksIHJldCk7CgkJCQkJdGhpcy5idXN5KGZhbHNlKTsKCQkJCX0KCQkJfSk7CgkJfQoJfQoKCWVGdW4oZSkgewoJCXRyeSB7CgkJCWlmIChlLnR5cGUgPT0gInRyZWUiKSB7CgkJCQlpZiAoZS5jb2x1bW5zKSB7CgkJCQkJcmV0dXJuICJjb21ib3RyZWVncmlkIjsKCQkJCX0gZWxzZSBpZiAodHlwZW9mKGUuY29tYm8pICE9PSAndW5kZWZpbmVkJyAmJiAhZS5jb21ibykgewoJCQkJCXJldHVybiAndHJlZSc7CgkJCQl9IGVsc2UgewoJCQkJCXJldHVybiAiY29tYm90cmVlIjsKCQkJCX0KCQkJfSBlbHNlIGlmIChlLnR5cGUgPT0gJ25hdmlnYXRpb24nKSB7CgkJCQlyZXR1cm4gJ3RyZWUnOwoJCQl9IGVsc2UgaWYgKGUudHlwZSA9PSAiY29tYm90cmVlIikgewoJCQkJcmV0dXJuICJjb21ib3RyZWVncmlkIjsKCQkJfSBlbHNlIGlmIChlLnR5cGUgPT0gInNlbGVjdCIgJiYgZS5vcHRpb25zKSB7CgkJCQlyZXR1cm4gImNvbWJvYm94IjsKCQkJfQoJCQlyZXR1cm4gImNvbWJvZ3JpZCI7CgkJfSBjYXRjaCAoZXgpIHsKCQkJcmV0dXJuICJjb21ib2dyaWQiOwoJCX0KCX0KCglfZmlsbFdpbmRvdyh3aW5OYW1lLCB2LCBtYXApIHsKCQl2ID0gdiB8fCB7fTsKCQltYXAgPSBtYXAgfHwge307CgkJaWYgKEFycmF5LmlzQXJyYXkobWFwKSkgewoJCQltYXAgPSBPYmplY3QuZnJvbUVudHJpZXMobmV3IE1hcChtYXApKTsKCQl9CgoJCW1hcCA9ICQuZXh0ZW5kKHt9LCBtYXAsIE9iamVjdC5mcm9tRW50cmllcyhPYmplY3Qua2V5cyh2KS5tYXAoayA9PiBbd2luTmFtZSArIGssIGtdKSkpOwoKCQlsZXQgcyA9IHt9OwoJCWZvciAodmFyIG0gaW4gbWFwKSB7CgkJCWlmICh0eXBlb2YodlttYXBbbV1dKSA9PT0gInVuZGVmaW5lZCIpIHsKCQkJCS8vY29uc29sZS5sb2coJ2lzX3VuZGVmaW5lZCcsIG0sIG1hcFttXSwgdlttYXBbbV1dKTsKCQkJCXNbbV0gPSBtYXBbbV07CgkJCX0gZWxzZSB7CgkJCQkvL2NvbnNvbGUubG9nKCdpc19ub3RfdW5kZWZpbmVkJywgbSwgbWFwW21dLCB2W21hcFttXV0pOwoJCQkJc1ttXSA9IHZbbWFwW21dXTsKCQkJfQoJCX0KCQl0aGlzLmNsZWFyKHdpbk5hbWUpOwoJCS8vY29uc29sZS5sb2coInMiLCBzKTsKCQl0aGlzLnNldChzKTsKCQkkKCIjcG5sXyIgKyB3aW5OYW1lKS53aW5kb3coIm9wZW4iKTsKCX0KCgl3aW5kb3dUb0VudGl0eShvLCBiRW1wdHksIGdyaWQsIHByZWZpeCwgZmlsdGVyKSB7CgkJbyA9IG8gfHwgdGhpcy5nZXQoKTsKCQlmaWx0ZXIgPSBmaWx0ZXIgfHwgKHYgPT4gdik7CgkJbGV0IHJldCA9IGdyaWQgPyAoZ3JpZC5zZWxlY3RlZCB8fCBncmlkKSA6IG51bGw7CgkJaWYgKGJFbXB0eSkgewoJCQlyZXQgPSB7fTsKCQkJbyA9IHt9OwoJCX0gZWxzZSB7CgkJCXJldCA9IChyZXQgJiYgcmV0LklkKSA/IHsKCQkJCUlkOiByZXQuSWQKCQkJfSA6IHt9OwoJCX0KCgkJdGhpcy5lbGVtZW50cy5maWx0ZXIoZSA9PiAocHJlZml4ID8gZS5ncm91cCA9PSBwcmVmaXggOiB0cnVlKSAmJiBlLnR5cGUgIT0gJ2xpbmsnICYmIFsnXyddLmluZGV4T2YoZS5uYW1lLnJlcGxhY2UocHJlZml4LCAiIikpIDwgMCkuZm9yRWFjaChlID0+IHsKCQkJcmV0W2UubmFtZS5yZXBsYWNlKHByZWZpeCwgIiIpXSA9IG9bZS5uYW1lXTsKCQkJcmV0dXJuIHRydWU7CgkJfSk7CgoJCWZpbHRlcihyZXQpOwoKCQlyZXR1cm4gcmV0OwoJfQoKCWJpbmQob2JqKSB7CgkJdmFyIG9iakJpbmQgPSAobywgZSkgPT4gewoJCQlvW3RoaXMuZUZ1bihlKV0oewoJCQkJb25TaG93UGFuZWw6ICgpID0+IHsKCQkJCQl0aGlzLmZpbGxEYXRhKCQoIiMiICsgZS5pZCksIG51bGwsIDAsIDEwKTsKCQkJCX0sCgkJCQlvbkNsaWNrUm93OiAoaW5kZXgsIHJvdykgPT4gewoJCQkJCXZhciBzID0gcm93ID8gcm93Ll9fT1dORVIgOiBudWxsOwoJCQkJCWlmIChzICYmIHMub3B0aW9ucy5zZWxlY3QpIHsKCQkJCQkJcy5vcHRpb25zLnNlbGVjdChyb3cpOwoJCQkJCX0KCQkJCX0KCQkJfSk7CgkJCXRyeSB7CgkJCQl2YXIgZGcgPSBvW3RoaXMuZUZ1bihlKV0oJ2dyaWQnKTsKCQkJCS8vIGRnLmRhdGFncmlkKCdlbmFibGVGaWx0ZXInKQoJCQkJdmFyIHN0YXRlID0gZGcuZGF0YSgnZGF0YWdyaWQnKTsKCQkJCXZhciBvcHRzID0gc3RhdGUub3B0aW9uczsKCQkJCXZhciBvbkJlZm9yZUxvYWQgPSBvcHRzLm9uQmVmb3JlTG9hZDsKCQkJCW9wdHMub25CZWZvcmVMb2FkID0gKHBhcmFtKSA9PiB7CgkJCQkJc3RhdGUuYWxsUm93cyA9IG51bGw7CgkJCQkJcmV0dXJuIG9uQmVmb3JlTG9hZC5jYWxsKHRoaXMsIHBhcmFtKTsKCQkJCX07CgkJCQl2YXIgcGFnZXIgPSBkZy5kYXRhZ3JpZCgnZ2V0UGFnZXInKTsKCQkJCWRnLmRhdGFncmlkKCdnZXRQYW5lbCcpLnBhbmVsKHsKCQkJCQlJRDogaQoJCQkJfSk7CgkJCQlwYWdlci5wYWdpbmF0aW9uKHsKCQkJCQlvblNlbGVjdFBhZ2U6IGZ1bmN0aW9uKHBhZ2VOdW0sIHBhZ2VTaXplKSB7CgkJCQkJCXRyeSB7CgkJCQkJCQlERm9ybS5maWxsRGF0YSgkKCIjIiArIERGb3JtLnNlbGVjdHNbJCh0aGlzLnBhcmVudE5vZGUpLnBhbmVsKCdvcHRpb25zJykuSURdLmlkKSwgbnVsbCwgcGFnZVNpemUgKiAocGFnZU51bSAtIDEpLCBwYWdlU2l6ZSAqIHBhZ2VOdW0pOwoJCQkJCQl9IGNhdGNoIChfZXgpIHsKCQkJCQkJCWNvbnNvbGUubG9nKCJEeW5hRm9ybTo6b25TZWxlY3RQYWdlKCkgIiwgX2V4KQoJCQkJCQl9CgkJCQkJfQoJCQkJfSk7CgkJCQlkZy5kYXRhZ3JpZCgnbG9hZERhdGEnLCBzdGF0ZS5kYXRhKTsKCQkJfSBjYXRjaCAoZXgpIHt9CgkJfTsKCQlpZiAob2JqKSB7CgkJCW9iakJpbmQob2JqKTsKCQl9IGVsc2UgewoJCQlmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuc2VsZWN0cy5sZW5ndGg7IGkrKykgewoJCQkJaWYgKHRoaXMuc2VsZWN0c1tpXS5vcHRpb25zLm9wdGlvbnMpIHsKCQkJCQkvLyQoIiMiICsgdGhpcy5zZWxlY3RzW2ldLmlkKS5jb21ibygpOwoJCQkJfSBlbHNlIHsKCQkJCQlvYmpCaW5kKCQoIiMiICsgdGhpcy5zZWxlY3RzW2ldLmlkKSwgdGhpcy5zZWxlY3RzW2ldKTsKCQkJCX0KCQkJfQoKCQkJdGhpcy5lbGVtZW50cy5maWx0ZXIoZSA9PiBlLndpbmRvdykuZm9yRWFjaChlID0+IHsKCQkJCWxldCB0ID0gJCgiI3RiY1dpbmRvdyIpLnRhYnMoImdldFRhYiIsIGUuZ3JvdXApOwoJCQkJaWYgKHQpIHsKCQkJCQl0LnBhbmVsKCdvcHRpb25zJykudGFiLmhpZGUoKTsKCQkJCX0KCQkJfSk7CgkJfQoJfQoKCWVuZ2xpc2gocykgewoJCWlmICghcykgcmV0dXJuICIiOwoJCXZhciByZXN1bHQgPSBzLnJlcGxhY2UoLyhbQS1aXSkvZywgIiAkMSIpOwoJCXJlc3VsdCA9IHJlc3VsdC5yZXBsYWNlKC9fL2csICcnKTsKCQlyZXR1cm4gcmVzdWx0LmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgcmVzdWx0LnNsaWNlKDEpOwoJfQoKCW9uVG9nZ2xlKGUsIGJWYWx1ZSkgewoJCWxldCBzVGFnID0gYCNmRWxlbWVudF8ke2UuZm9yLm5hbWV9ID4gLmVhc3l1aS0ke3RoaXMudWlUeXBlc1tlLmZvci50eXBlXX1gOwoJCWxldCBvVGFnID0gJChzVGFnKTsKCQllLmZvci5lbmFibGVkID0gdHlwZW9mKGJWYWx1ZSkgPT09ICJ1bmRlZmluZWQiID8gIWUuZm9yLmVuYWJsZWQgOiBiVmFsdWU7CgoJCW9UYWcucHJvcCgiZGlzYWJsZWQiLCAhZS5mb3IuZW5hYmxlZCk7CgkJLy9vVGFnW3RoaXMudWlUeXBlc1tlLmZvci50eXBlXV0oZS5mb3IuZW5hYmxlZCA/ICJlbmFibGUiIDogImRpc2FibGUiKTsKCQljb25zb2xlLmxvZyhzVGFnLCBvVGFnLCB0aGlzLnVpVHlwZXNbZS5mb3IudHlwZV0sIGUuZm9yLmVuYWJsZWQpOwoJfQoKCXJlbmRlcihuYW1lLCB0aXRsZSwgZWxlbWVudHMsIGJ1dHRvbnMsIGJGaXhlZCkgewoJCXRoaXMuZWxlbWVudHMgPSAoZWxlbWVudHMgfHwgW10pLmZpbHRlcihlID0+ICFlLmlnbm9yZSk7CgoJCXRoaXMuYnV0dG9ucyA9IGJ1dHRvbnMgfHwgW107CgkJdGhpcy5zZWxlY3RzID0gW107CgkJdGhpcy5ncmlkcyA9IFtdOwoKCQl0aGlzLmVsZW1lbnRzLmZpbHRlcihlID0+IGUudHlwZSA9PSAid2luZG93IikuZm9yRWFjaCh3ID0+IHRoaXMuZWxlbWVudHMuc3BsaWNlKHRoaXMuZWxlbWVudHMuZmluZEluZGV4KGUgPT4gZS5uYW1lID09IHcubmFtZSksIDAsIHsKCQkJbmFtZTogIl8iICsgdy5uYW1lLAoJCQl0eXBlOiAibGluayIsCgkJCXRpdGxlOiB3LnRpdGxlIHx8IHcubmFtZSwKCQkJZ3JvdXA6IHcuZ3JvdXAsCgkJCXdpbmRvdzogdy53aW5kb3csCgkJCXNlY3Rpb246IHcuc2VjdGlvbiwKCQkJbGlua3M6IFt7CgkJCQlsYWJlbDogJ09wZW4nLAoJCQkJaWNvbjogJ2VkaXQnLAoJCQkJb25DbGljazogbyA9PiAkKCIjcG5sIiArIHcubmFtZSkud2luZG93KCdvcGVuJykKCQkJfV0sCgkJfSkpOwoKCQl0aGlzLnNyKCkuZ3JvdXBCeSh0aGlzLmVsZW1lbnRzLmZpbHRlcihlID0+IGUud2luZG93KSwgImdyb3VwIikuZm9yRWFjaChrdiA9PiB7CgkJCWlmICgha3Yua2V5KSByZXR1cm47CgoJCQlsZXQgZSA9IHsKCQkJCW5hbWU6ICJfIiArIGt2LmtleSwKCQkJCXRpdGxlOiBrdi5rZXksCgkJCQl0eXBlOiAid2luZG93IiwKCQkJCWdyb3VwOiBrdi5rZXksCgkJCQl3aWR0aDogdGhpcy53aWR0aCAqIDAuOSwKCQkJCWhlaWdodDogdGhpcy5oZWlnaHQgKiAwLjksCgkJCQlsb2FkZXI6IG8gPT4gewoJCQkJCWt2LnZhbHVlcy5maWx0ZXIodiA9PiB2LnR5cGUgIT09ICdsaW5rJyB8fCAodi50eXBlID09ICdsaW5rJyAmJiB2Lm5hbWUuc3RhcnRzV2l0aCgnXycpKSkuZm9yRWFjaCh2ID0+ICQoIiNwbmxfIiArIHYuZ3JvdXAgKyAnLWNlbnRlcicpLmFwcGVuZCgkKCIjZkVsZW1lbnRfIiArIHYubmFtZSkpKTsKCQkJCQlyZXR1cm4gbnVsbDsKCQkJCX0sCgkJCQlidXR0b25zOiBbXS5jb25jYXQuYXBwbHkoW10sIGt2LnZhbHVlcy5maWx0ZXIodiA9PiB2LnR5cGUgPT0gJ2xpbmsnICYmICF2Lm5hbWUuc3RhcnRzV2l0aCgnXycpKS5tYXAodiA9PiBbLi4udi5saW5rcy5tYXAobCA9PiAoewoJCQkJCW5hbWU6IGwubmFtZSB8fCBsLmxhYmVsLAoJCQkJCXRpdGxlOiBsLnRpdGxlIHx8IGwubGFiZWwsCgkJCQkJb25DbGljazogbC5vbkNsaWNrLAoJCQkJCWljb246IGwuaWNvbiwKCQkJCQl3aW5kb3c6IHRydWUsCgkJCQkJZ3JvdXA6IGt2LmtleSwKCQkJCX0pKV0pKSwKCQkJfTsKCQkJdGhpcy5idXR0b25zLnB1c2goLi4uZS5idXR0b25zKTsKCgkJCXRoaXMuZWxlbWVudHMucHVzaChlKTsKCQl9KTsKCgkJdmFyIHJldCA9ICIiOwoJCS8vIGNoZWNrIHRoZSBvcHRpb24gb2YgdXNpbmcgd2luZG93KCkgYXMgYSByZW5kZXJlciBvZiB0aGUgbWFpbiB3aW5kb3cuLi4KCQlpZiAodHJ1ZSkgewoJCQl0aGlzLmVsZW1lbnRzLmZpbHRlcihlID0+ICFlLnpvbmUpLmZvckVhY2goZSA9PiBlLnpvbmUgPSAnY2VudGVyJyk7CgkJCWxldCB3T3B0aW9ucyA9IHsKCQkJCW5hbWU6IG5hbWUgfHwgdGhpcy5uYW1lLAoJCQkJdGl0bGU6IHRpdGxlIHx8IHRoaXMudGl0bGUsCgkJCQl0eXBlOiAnd2luZG93JywKCQkJCXZpc2libGU6IHRydWUsCgkJCQl3aWR0aDogdGhpcy53aWR0aCwKCQkJCWhlaWdodDogdGhpcy5oZWlnaHQsCgkJCQlmaXhlZDogYkZpeGVkLAoJCQkJbGlua3M6IFt7CgkJCQkJaWNvbjogImhlbHAiLAoJCQkJCWFjdGlvbjogbyA9PiAkKCIjcG5sX19Db25zb2xlIikud2luZG93KCdvcGVuJykKCQkJCX1dLAoJCQkJYnV0dG9uczogdGhpcy5idXR0b25zLmZpbHRlcihiID0+ICFiLndpbmRvdyksCgkJCX07CgkJCXRoaXMuc3IoKS5ncm91cEJ5KHRoaXMuZWxlbWVudHMsICd6b25lJykuZmlsdGVyKHpnID0+IHpnLmtleSkuZm9yRWFjaCh6ZyA9PiB7CgkJCQl3T3B0aW9uc1t6Zy5rZXldID0gdGhpcy5yZW5kZXJFbGVtZW50cyh6Zy52YWx1ZXMpOwoJCQl9KTsKCgkJCXJldCA9IHRoaXMud2luZG93KHdPcHRpb25zKTsKCQl9IGVsc2UgewoJCQlyZXQgPSB0aGlzLmhlYWRlcihuYW1lLCB0aXRsZSwgYkZpeGVkLCBbewoJCQkJaWNvbjogImhlbHAiLAoJCQkJYWN0aW9uOiBvID0+ICQoIiNwbmxfX0NvbnNvbGUiKS53aW5kb3coJ29wZW4nKQoJCQl9XSk7CgoJCQlyZXQgKz0gdGhpcy5yZW5kZXJFbGVtZW50cygpOwoKCQkJcmV0ICs9IHRoaXMuZm9vdGVyKGJGaXhlZCk7CgoJCX0KCQkvLyBjb25zb2xlLmxvZyhyZXQpOwoKCQlyZXR1cm4gcmV0OwoJfQoKCWNXaWR0aChvcHRpb25zKSB7CgkJbGV0IHJldCA9IE1hdGguZmxvb3IoKChvcHRpb25zID8gb3B0aW9ucy53aWR0aCA6IG51bGwpIHx8ICh0aGlzLndpZHRoIC8gMykpKTsKCQlpZiAob3B0aW9ucy56b25lID09ICdlYXN0JyB8fCBvcHRpb25zLnpvbmUgPT0gJ3dlc3QnKSB7CgkJCXJldCA9IDAuMjUgKiByZXQ7IC8vIDkwJSBvZiAzLzEwLCB0aGUgd2lkdGggb2YgdGhlIG5vcm1hbCBlbGVtZW50CgkJfSBlbHNlIGlmIChvcHRpb25zICYmIG9wdGlvbnMuZWRpdG9yKSB7CgkJCXJldCA9IHdpbmRvdy5pbm5lcldpZHRoOwoJCX0gZWxzZSBpZiAob3B0aW9ucyAmJiBvcHRpb25zLndpZHRoICYmIHR5cGVvZihvcHRpb25zLndpZHRoKSA9PT0gJ3N0cmluZycpIHsKCQkJcmV0ID0gdGhpcy53aWR0aDsKCQl9IGVsc2UgaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy50eXBlID09ICd3aW5kb3cnICYmICFvcHRpb25zLndpZHRoKSB7CgkJCXJldCA9IHRoaXMud2lkdGggKiAwLjk7CgkJfQoKCQkvLyBjb25zb2xlLmxvZyhvcHRpb25zLm5hbWUgKyAiOiBjV2lkdGggPSAiICsgcmV0LCBvcHRpb25zLnpvbmUpOwoJCXJldHVybiByZXQ7Cgl9CgoJd2luZG93KG9wdGlvbnMpIHsKCQlvcHRpb25zLnRpdGxlID0gb3B0aW9ucy50aXRsZSB8fCBvcHRpb25zLm5hbWU7CgkJdmFyIHJldCA9IGAKCQk8ZGl2IGlkID0gInBubCR7b3B0aW9ucy5uYW1lfSIgY2xhc3M9ImVhc3l1aS13aW5kb3ciIHRpdGxlPSIke29wdGlvbnMudGl0bGV9IiBkYXRhLW9wdGlvbnM9JyR7dGhpcy5ldmVudEhhbmRsZXJzKG9wdGlvbnMpfSwgY2xvc2VkOiR7IW9wdGlvbnMudmlzaWJsZX0sbWluaW1pemFibGU6JHshb3B0aW9ucy5maXhlZH0sbWF4aW1pemFibGU6JHshb3B0aW9ucy5maXhlZH0sY2xvc2FibGU6JHshb3B0aW9ucy5maXhlZH0sY29sbGFwc2libGU6JHshb3B0aW9ucy5maXhlZH0sZHJhZ2dhYmxlOiR7IW9wdGlvbnMuZml4ZWR9LHJlc2l6YWJsZTokeyFvcHRpb25zLmZpeGVkfSxpY29uQ2xzOiJpY29uLSR7b3B0aW9ucy5pY29ufSIsIHRvb2xzOiIjJHtvcHRpb25zLm5hbWV9X3Rvb2xzIicgc3R5bGU9IndpZHRoOiR7dGhpcy5jV2lkdGgob3B0aW9ucyl9cHg7aGVpZ2h0OiR7dGhpcy5jSGVpZ2h0KG9wdGlvbnMpfXB4O3BhZGRpbmc6MTBweDsiPgoJCSAgICA8ZGl2IGNsYXNzPSJlYXN5dWktbGF5b3V0IiBkYXRhLW9wdGlvbnM9ImZpdDp0cnVlIj4KCQlgOwoKCQlsZXQgYlpvbmUgPSBvcHRpb25zLnNvdXRoID8gJ3NvdXRoJyA6ICh0aGlzLnpvbmVzLmZpbmQoeiA9PiB6ID09ICdzb3V0aCcpIHx8IHRoaXMuem9uZXNbMF0pOwoJCW9wdGlvbnNbYlpvbmVdID0gb3B0aW9uc1tiWm9uZV0gfHwgW107CgkJbGV0IHpXaWR0aCA9IE1hdGgubWluKDEyMCwgdGhpcy53aWR0aCAqIDAuOTUgLyAob3B0aW9ucy5idXR0b25zID8gb3B0aW9ucy5idXR0b25zLmxlbmd0aCA6IDEpLCB0aGlzLmNXaWR0aChvcHRpb25zKSk7CgkJb3B0aW9uc1tiWm9uZV0ucHVzaChgPGRpdiBpZD0icG5sJHtvcHRpb25zLm5hbWV9LWJ1dHRvbnMiIGRhdGEtb3B0aW9ucz0icmVnaW9uOicke2Jab25lfScsYm9yZGVyOmZhbHNlIiBzdHlsZT0idGV4dC1hbGlnbjpyaWdodDtwYWRkaW5nOjVweCAwIDA7Ij5gICsgJC5tYXAoJC5ncmVwKG9wdGlvbnMuYnV0dG9ucyB8fCBbXSwgYiA9PiAhYi5pZ25vcmUpLCBiID0+IGA8YSBpZD0nJHtiLm5hbWV9JyBocmVmPSJqYXZhc2NyaXB0OnZvaWQoMCkiIGNsYXNzPSJlYXN5dWktbGlua2J1dHRvbiBjNiIgaWNvbkNscz0iaWNvbi0ke2IuaWNvbiB8fCAnc2F2ZSd9IiBzdHlsZT0id2lkdGg6JHt6V2lkdGh9cHgiIG9uY2xpY2s9J3RoaXMuZG9DbGljaygke19GckVNRC5fdG9KUyhiKX0pJz4ke2IudGl0bGUgfHwgYi5uYW1lfTwvYT4mbmJzcDsmbmJzcDtgKS5qb2luKCcnKSArIGA8L2Rpdj5gKTsKCgkJdGhpcy56b25lcy5maWx0ZXIoeiA9PiBvcHRpb25zW3pdKS5mb3JFYWNoKHogPT4gewoJCQlyZXQgKz0gYAoJCSAgICAgICAgPGRpdiBkYXRhLW9wdGlvbnM9InJlZ2lvbjonJHt6fSciIHRpdGxlPSIkeyh6PT0nd2VzdCcgfHwgej09J2Vhc3QnKT8nJm5ic3A7JzonJ30iIHN0eWxlPSdoZWlnaHQ6JHsoej09J25vcnRoJ3x8ej09J3NvdXRoJyk/MTA6MTAwfSU7d2lkdGg6JHsoKHo9PSdlYXN0J3x8ej09J3dlc3QnKT8wLjE6MSkqdGhpcy5jV2lkdGgob3B0aW9ucyl9cHgnPgogICAgICAgIAkJICAgICR7KEFycmF5LmlzQXJyYXkob3B0aW9uc1t6XSk/b3B0aW9uc1t6XTpbb3B0aW9uc1t6XV0pLmpvaW4oJycpfQogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIGA7CgkJfSk7CgoJCXJldCArPSBgPC9kaXY+PC9kaXY+YDsKCgkJLy8gbGlua3MgKHRvb2xzKQoJCWxldCBsaW5rcyA9ICQuZ3JlcChbXS5jb25jYXQob3B0aW9ucy5saW5rcyB8fCBbXSksIGwgPT4gIWwuaWdub3JlKTsKCQlyZXQgKz0gYDxkaXYgaWQ9IiR7b3B0aW9ucy5uYW1lfV90b29scyI+YCArICQubWFwKGxpbmtzLnJldmVyc2UoKSwgbCA9PiBgPGEgaHJlZj0iamF2YXNjcmlwdDp2b2lkKDApIiBzdHlsZT0iY29sb3I6YmxhY2siIGNsYXNzPSJmYXMgZmEtJHtsLmljb24gfHwgJ2FkZCd9IiBvbmNsaWNrPScoYXN5bmMgKCkgPT4ge3ZhciBhID0gJHtfRnJFTUQuX3RvSlMobCl9OyAkKCIjcG5sJHtvcHRpb25zLm5hbWV9Iikud2luZG93KCJzZXRUaXRsZSIsICIke29wdGlvbnMudGl0bGV9OiAiICsgYS5uYW1lKTsgYXdhaXQgYS5hY3Rpb24oREZvcm0uZ2V0KCksIGEsICR7X0ZyRU1ELl90b0pTKG9wdGlvbnMpfSk7ICQoIiNwbmwke29wdGlvbnMubmFtZX0iKS53aW5kb3coInNldFRpdGxlIiwgIiR7b3B0aW9ucy50aXRsZX0iKTt9KSgpJz48L2E+YCkuam9pbignXG4nKSArIGA8L2Rpdj5gOwoKCQlyZXR1cm4gcmV0OwoJfQoKCWFzeW5jIF9lbmQoKSB7CgkJbGV0IG8gPSB0aGlzLmdldCgpOwoKCQkvLyBkbyBub3QgdXNlIHRoZSBmaXJzdCBidXR0b24sIGJlY2F1c2UgbWFueSBmb3JtcyBoYXZlIGEgQ2FuY2VsIGJ1dHRvbiBvbmx5CgkJbGV0IGJ1dHRvbiA9IHRoaXMuYnV0dG9ucy5maW5kKGIgPT4gYi5hdXRvU3VibWl0KSAvKiB8fCB0aGlzLmJ1dHRvbnNbMF0qLyA7CgkJaWYgKGJ1dHRvbiAmJiBvICYmIE9iamVjdC52YWx1ZXMobykubGVuZ3RoICYmICh0eXBlb2YoYnV0dG9uLmF1dG9TdWJtaXQpID09PSAidW5kZWZpbmVkIiB8fCBidXR0b24uYXV0b1N1Ym1pdCkpIHsKCQkJbGV0IHYgPSBPYmplY3QudmFsdWVzKG8pLnJlZHVjZSgodCwgdikgPT4gewoJCQkJcmV0dXJuICgodHlwZW9mKHYpICE9PSAib2JqZWN0IikgPyAxIDogMCkgKiAodiA/IDEgOiAwKTsKCQkJfSk7CgkJCS8vY29uc29sZS5sb2cobywgT2JqZWN0LnZhbHVlcyhvKSwgdik7CgkJCWlmICh2KSB7CgkJCQkvLyBhbGwgZmllbGRzIGhhdmUgdmFsdWVzCgkJCQlhd2FpdCB0aGlzLmRvQ2xpY2soYnV0dG9uKTsKCgkJCX0KCQl9Cgl9CgoJZm9vdGVyKGJGaXhlZCkgewoJCXJldHVybiBgPC9mb3JtPmAgKyBgPGRpdiBpZD0iZGxnLWJ1dHRvbnMiPmAgKyB0aGlzLmJ1dHRvbnMuZmlsdGVyKGIgPT4gIWIud2luZG93KS5tYXAoYiA9PiBgPGEgaWQ9JyR7Yi5uYW1lfScgaHJlZj0iamF2YXNjcmlwdDp2b2lkKDApIiBjbGFzcz0iZWFzeXVpLWxpbmtidXR0b24gYzYiIGljb25DbHM9Imljb24tJHtiLmljb24gfHwgJ3NhdmUnfSIgc3R5bGU9IndpZHRoOiR7TWF0aC5taW4oMTIwLCB0aGlzLndpZHRoICogMC45NSAvIHRoaXMuYnV0dG9ucy5sZW5ndGgsIHRoaXMuY1dpZHRoKCkpfXB4IiBvbmNsaWNrPSd0aGlzLmRvQ2xpY2soJHtfRnJFTUQuX3RvSlMoYil9KSc+JHtiLnRpdGxlIHx8IGIubmFtZX08L2E+Jm5ic3A7Jm5ic3A7YCkuam9pbignJykgKyAiPC9kaXY+IiArIChiRml4ZWQgPyAiIiA6ICc8L2Rpdj4nKTsKCX0KCgloZWFkZXIobmFtZSwgdGl0bGUsIGJGaXhlZCwgbGlua3MpIHsKCQl0aGlzLnRpdGxlID0gdGl0bGUgfHwgdGhpcy50aXRsZTsKCQluYW1lID0gbmFtZSB8fCB0aGlzLm5hbWU7CgkJdmFyIHJldCA9ICcnOwoKCQlyZXQgKz0gdGhpcy53aW5kb3coewoJCQluYW1lOiAiX19Db25zb2xlIiwKCQkJdHlwZTogIndpbmRvdyIsCgkJCWVkaXRvcjogdHJ1ZSwKCQkJbG9hZGVyOiBvID0+IHdpbmRvdy5sb2dzLnNsaWNlKCkucmV2ZXJzZSgpLm1hcChsID0+IGwuZGF0ZS50b0lTT1N0cmluZygpICsgIjogIiArIGwuYXJncy5tYXAocyA9PiB0eXBlb2YocykgPT09ICdvYmplY3QnID8gKChvYmosIGluZGVudCA9IDIpID0+IHsKCQkJCWxldCBjYWNoZSA9IFtdOwoJCQkJY29uc3QgcmV0VmFsID0gSlNPTi5zdHJpbmdpZnkoCgkJCQkJb2JqLAoJCQkJCShrZXksIHZhbHVlKSA9PgoJCQkJCXR5cGVvZiB2YWx1ZSA9PT0gIm9iamVjdCIgJiYgdmFsdWUgIT09IG51bGwgPwoJCQkJCWNhY2hlLmluY2x1ZGVzKHZhbHVlKSA/CgkJCQkJdW5kZWZpbmVkIC8vIER1cGxpY2F0ZSByZWZlcmVuY2UgZm91bmQsIGRpc2NhcmQga2V5CgkJCQkJOgoJCQkJCWNhY2hlLnB1c2godmFsdWUpICYmIHZhbHVlIC8vIFN0b3JlIHZhbHVlIGluIG91ciBjb2xsZWN0aW9uCgkJCQkJOgoJCQkJCXZhbHVlLAoJCQkJCWluZGVudAoJCQkJKTsKCQkJCWNhY2hlID0gbnVsbDsKCQkJCXJldHVybiByZXRWYWw7CgkJCX0pKHMpIDogcykuam9pbignLCAnKSkuam9pbignXG4nKSwKCQl9KTsKCgkJaWYgKCFiRml4ZWQpIHsKCQkJbGlua3MgPSAobGlua3MgfHwgW10pLmZpbHRlcihsID0+ICFsLmlnbm9yZSk7CgkJCWxldCB0RGF0YSA9ICIiOwoJCQlpZiAobGlua3MubGVuZ3RoKSB7CgkJCQlyZXQgKz0gYDxkaXYgaWQ9IiR7dGhpcy5uYW1lfV90b29scyI+YCArIGxpbmtzLm1hcChsID0+IGA8YSBocmVmPSJqYXZhc2NyaXB0OnZvaWQoMCkiIGNsYXNzPSJpY29uLSR7bC5pY29ufSIgb25jbGljaz0nKGFzeW5jICgpID0+IHt2YXIgYSA9ICR7X0ZyRU1ELl90b0pTKGwpfTsgJCgiI3dpbiR7dGhpcy5uYW1lfSIpLndpbmRvdygic2V0VGl0bGUiLCAiJHt0aGlzLnRpdGxlfTogIiArIGEubmFtZSk7IGF3YWl0IGEuYWN0aW9uKERGb3JtLmdldCgpKTsgJCgiI3dpbiR7dGhpcy5uYW1lfSIpLndpbmRvdygic2V0VGl0bGUiLCAiJHt0aGlzLnRpdGxlfSIpO30pKCknPjwvYT5gKS5qb2luKCdcbicpICsgIjwvZGl2PiI7CgkJCQl0RGF0YSA9IGAsdG9vbHM6IiMke3RoaXMubmFtZX1fdG9vbHMiYDsKCQkJfQoJCQlyZXQgKz0gYDxkaXYgaWQ9J3dpbiR7dGhpcy5uYW1lfScgY2xhc3M9J2Vhc3l1aS13aW5kb3cnIHRpdGxlPScke3RoaXMudGl0bGV9JyBkYXRhLW9wdGlvbnM9J2ljb25DbHM6Imljb24tc2F2ZSIgJHt0RGF0YX0nIHN0eWxlPSd3aWR0aDoke3RoaXMud2lkdGh9cHg7aGVpZ2h0OiR7dGhpcy5oZWlnaHR9cHg7cGFkZGluZzoxMHB4Oyc+YDsKCQl9CgkJcmV0dXJuIHJldCArIGA8Zm9ybSBpZD0iZnJtJHt0aGlzLm5hbWV9IiBtZXRob2Q9InBvc3QiIG5vdmFsaWRhdGU+YDsKCX0KCglyZW5kZXJFbGVtZW50cyhlbGVtZW50cykgewoJCWVsZW1lbnRzID0gZWxlbWVudHMgfHwgdGhpcy5lbGVtZW50czsKCgkJdmFyIHRXaWR0aCA9IE1hdGguZmxvb3IodGhpcy53aWR0aCAqIDAuOTUpOwoJCXZhciB0SGVpZ2h0ID0gTWF0aC5mbG9vcih0aGlzLmhlaWdodCAqIDAuODUpOwoKCQlsZXQgcmV0ID0gJyc7CgkJdmFyIGdFbGVtZW50cyA9IHRoaXMuc3IoKS5ncm91cEJ5KGVsZW1lbnRzLCAiZ3JvdXAiKTsKCQlpZiAoZ0VsZW1lbnRzLmxlbmd0aCA+IDEpIHJldCArPSBgPGRpdiBpZD0idGJjV2luZG93IiBjbGFzcz0iZWFzeXVpLXRhYnMiIGRhdGEtb3B0aW9ucz0nJHt0aGlzLmV2ZW50SGFuZGxlcnMoe3R5cGU6ICd0YWJzJ30pfScgc3R5bGU9IndpZHRoOiR7dFdpZHRofXB4O2hlaWdodDoke3RIZWlnaHR9cHg7Ij5gOwoJCWZvciAodmFyIGcgPSAwOyBnIDwgZ0VsZW1lbnRzLmxlbmd0aDsgZysrKSB7CgkJCWlmIChnRWxlbWVudHMubGVuZ3RoID4gMSkgcmV0ICs9ICc8ZGl2IHRpdGxlPSInICsgKGdFbGVtZW50c1tnXS5rZXkgfHwgIk1haW4iKSArICciIHN0eWxlPSJwYWRkaW5nOjIwcHg7ZGlzcGxheTpub25lOyI+JzsKCQkJdmFyIHNFbGVtZW50cyA9IHRoaXMuc3IoKS5ncm91cEJ5KGdFbGVtZW50c1tnXS52YWx1ZXMsICJzZWN0aW9uIik7CgkJCWlmIChzRWxlbWVudHMubGVuZ3RoID4gMSkgcmV0ICs9ICc8ZGl2IGNsYXNzPSJlYXN5dWktYWNjb3JkaW9uIiBzdHlsZT0id2lkdGg6JyArIHRXaWR0aCArICdweDtoZWlnaHQ6JyArIC8qdEhlaWdodCovICIxMDAlIiArICdweDsiPic7CgkJCWZvciAodmFyIHMgPSAwOyBzIDwgc0VsZW1lbnRzLmxlbmd0aDsgcysrKSB7CgkJCQlyZXQgKz0gYDxkaXYgdGl0bGU9IiR7c0VsZW1lbnRzW3NdLmtleSB8fCAiIn0iIGRhdGEtb3B0aW9ucz0iaWNvbkNsczonaWNvbi1tb3JlJyIgc3R5bGU9InBhZGRpbmc6MTBweDsiPmA7CgkJCQlmb3IgKHZhciBpID0gMDsgaSA8IHNFbGVtZW50c1tzXS52YWx1ZXMubGVuZ3RoOyBpKyspIHsKCQkJCQl2YXIgZSA9IHNFbGVtZW50c1tzXS52YWx1ZXNbaV07CgkJCQkJaWYgKGUuaWdub3JlKSBjb250aW51ZTsKCQkJCQllLnZhbHVlID0gZS52YWx1ZSB8fCBfRnJFTUQuaGFzaFtlLm5hbWVdIHx8IChfRnJFTUQuYXBpU2VydmVyID8gX0ZyRU1ELmFwaVNlcnZlci5fX2NvbmZpZygndGVzdF8nICsgZS5uYW1lLCAnJykgOiAnJyk7CgkJCQkJcmV0ICs9IGA8ZGl2IGlkPSJmRWxlbWVudF8ke2UubmFtZX0iIGNsYXNzPSJmaXRlbSIgc3R5bGU9ImRpc3BsYXk6ICR7KGUudHlwZT09J3dpbmRvdycgfHwgZS5oaWRkZW4pPydub25lJzonJ30iPmA7CgkJCQkJaWYgKGUudG9nZ2xlKSB7CgkJCQkJCXJldCArPSBgPGEgaHJlZj0iIyIgY2xhc3M9ImVhc3l1aS1saW5rYnV0dG9uIiBkYXRhLW9wdGlvbnM9JyR7dGhpcy5ldmVudEhhbmRsZXJzKHt0eXBlOiAndG9nZ2xlJywgZm9yOiBlfSl9LHBsYWluOnRydWUsaWNvbkNsczoiaWNvbi0ke2UuaWNvbiB8fCAnc2VhcmNoJ30iJyBzdHlsZT0id2lkdGg6MTAwcHg7aGVpZ2h0OjMwcHgiPiR7ZS50aXRsZSB8fCB0aGlzLmVuZ2xpc2goZS5uYW1lKX08L2E+YDsKCQkJCQl9IGVsc2UgewoJCQkJCQlyZXQgKz0gYDxsYWJlbD4ke2UudGl0bGUgfHwgdGhpcy5lbmdsaXNoKGUubmFtZSl9OjwvbGFiZWw+YDsKCQkJCQl9CgkJCQkJaWYgKGUudHlwZSAmJiB0aGlzW2UudHlwZV0pIHsKCQkJCQkJcmV0ICs9IHRoaXNbZS50eXBlXShlKTsKCQkJCQl9IGVsc2UgaWYgKGUucmVuZGVyKSB7CgkJCQkJCXJldCArPSBlLnJlbmRlcigpOwoJCQkJCX0KCQkJCQlyZXQgKz0gJzwvZGl2Pic7CgkJCQl9CgkJCQlyZXQgKz0gJzwvZGl2Pic7CgkJCX0KCQkJaWYgKHNFbGVtZW50cy5sZW5ndGggPiAxKSByZXQgKz0gJzwvZGl2Pic7CgkJCWlmIChnRWxlbWVudHMubGVuZ3RoID4gMSkgcmV0ICs9ICI8L2Rpdj4iOwoJCX0KCQlpZiAoZ0VsZW1lbnRzLmxlbmd0aCA+IDEpIHJldCArPSAiPC9kaXY+IjsKCQlyZXR1cm4gcmV0OwoJfQoKCWluZm8obXNnKSB7CgkJaWYgKCQubWVzc2FnZXIpIHsKCQkJJC5tZXNzYWdlci5hbGVydCh0aGlzLnRpdGxlLCBtc2csICdpbmZvJyk7CgkJfSBlbHNlIHsKCQkJdGhpcy5zcigpLlNob3dNZXNzYWdlKG1zZywgdGhpcy50aXRsZSk7CgkJfQoJfQoKCWVycm9yKG1zZykgewoJCWlmICgkLm1lc3NhZ2VyKSB7CgkJCSQubWVzc2FnZXIuYWxlcnQodGhpcy50aXRsZSwgbXNnLCAnZXJyb3InKTsKCQl9IGVsc2UgewoJCQl0aGlzLnNyKCkuU2hvd01lc3NhZ2UobXNnLCB0aGlzLnRpdGxlKTsKCQl9Cgl9CgoJYnlOYW1lKG5hbWUpIHsKCQlyZXR1cm4gdGhpcy5lbGVtZW50cy5maW5kKGUgPT4gZS5uYW1lID09PSBuYW1lKTsKCX0KCgkvKiogQ29tcG9uZW50czo6U3RhcnQgKiovCglDb3JlQ29tcG9uZW50ID0gY2xhc3MgewoJCWNvbnN0cnVjdG9yKHBhZ2UsIGRGb3JtKSB7CgkJCXRoaXMucGFnZSA9IHBhZ2U7CgkJCXRoaXMuZEZvcm0gPSBkRm9ybTsKCQl9CgoJCWJ1c3koYkJ1c3kpIHsKCQkJcmV0dXJuIHRoaXMuZEZvcm0uYnVzeShiQnVzeSk7CgkJfQoKCQlfbWUodikgewoJCQlsZXQgbWVOYW1lID0gKHR5cGVvZihjb21wYW55KSAhPT0gJ3VuZGVmaW5lZCcpID8gKGNvbXBhbnkubG9nZ2VkSW5JZGVudGl0eSB8fCAibWUiKSA6ICJtZSI7CgkJCWlmICh2KSB7CgkJCQl3aW5kb3dbbWVOYW1lXSA9IHY7CgkJCX0KCgkJCXJldHVybiB3aW5kb3dbbWVOYW1lXTsKCQl9CgoJCV9jYW5WaWV3KCkgewoJCQlpZiAoIXRoaXMuX21lKCkpIHsKCQkJCXdpbmRvdy5fRnJFTUQuc2V0VVJMKHsKCQkJCQlwYWdlOiAnbG9naW4nLAoJCQkJCV9yZWRpcmVjdDogdGhpcy5wYWdlLl9jb2RlLAoJCQkJfSk7CgkJCQl0aHJvdyBgX2NhblZpZXc6ICR7dGhpcy5wYWdlLl9jb2RlfSBub3QgYWxsb3dlZCB3aXRob3V0IGxvZ2luIWA7CgkJCX0KCQl9CgoJCV9uYW1lKCkgewoJCQlpZiAoIXRoaXMuX21lKCkpIHJldHVybiAiIjsKCQkJcmV0dXJuIHRoaXMuX21lKCkubmFtZSA/IHRoaXMuX21lKCkubmFtZSgpIDogdGhpcy5fbWUoKS5Ub1N0cmluZzsKCQl9Cgl9CgoJSW5kZXhDb21wb25lbnQgPSBjbGFzcyBleHRlbmRzIHRoaXMuQ29yZUNvbXBvbmVudCB7CgkJYXN5bmMgbWFpbigpIHsKCQkJdGhpcy5fY2FuVmlldygpOwoKCQkJdGhpcy5wYWdlLmRhdGEgPSB7CgkJCQlmb3JtOiB0aGlzLmRGb3JtLnJlbmRlcignZnJtSW5kZXgnLCAiTWFpbiBQYWdlIiwgW3sKCQkJCQluYW1lOiAnV2VsY29tZScsCgkJCQkJcmVxdWlyZWQ6IHRydWUsCgkJCQkJdHlwZTogImxhYmVsIiwKCQkJCQl2YWx1ZTogdGhpcy5fbmFtZSgpLAoJCQkJfV0sIFtdKQoJCQl9OwoJCX0KCX0KCglMb2dpbkNvbXBvbmVudCA9IGNsYXNzIGV4dGVuZHMgdGhpcy5Db3JlQ29tcG9uZW50IHsKCQlhc3luYyBfYXV0aGVudGljYXRlKG8pIHsKCQkJcmV0dXJuIG51bGw7CgkJfQoKCQlhc3luYyBfbG9nZ2VkSW4oKSB7fQoKCQlhc3luYyBfbm90TG9nZ2VkSW4oKSB7fQoKCQlhc3luYyBtYWluKCkgewoJCQl0aGlzLnBhZ2UuZGF0YSA9IHsKCQkJCWZvcm06IHRoaXMuZEZvcm0ucmVuZGVyKCdmcm1Mb2dpbicsICJVc2VyIEF1dGhlbnRpY2F0aW9uIiwgW3sKCQkJCQkJbmFtZTogJ1VzZXJuYW1lJywKCQkJCQkJcmVxdWlyZWQ6IHRydWUsCgkJCQkJCXR5cGU6ICJzdHJpbmciCgkJCQkJfSwKCQkJCQl7CgkJCQkJCW5hbWU6ICdQYXNzd29yZCcsCgkJCQkJCXJlcXVpcmVkOiB0cnVlLAoJCQkJCQl0eXBlOiAicGFzc3dvcmQiCgkJCQkJfQoJCQkJXSwgW3sKCQkJCQluYW1lOiAnTG9naW4nLAoJCQkJCWF1dG9TdWJtaXQ6IHRydWUsCgkJCQkJb25jbGljazogYXN5bmMgbyA9PiB7CgkJCQkJCWxldCByZXQgPSBhd2FpdCB0aGlzLl9hdXRoZW50aWNhdGUobyk7CgoJCQkJCQlpZiAocmV0KSB7CgkJCQkJCQl0aGlzLl9tZShyZXQpOwoKCQkJCQkJCXRyeSB7CgkJCQkJCQkJYXdhaXQgdGhpcy5fbG9nZ2VkSW4oKTsKCQkJCQkJCX0gY2F0Y2ggKGV4KSB7fQoKCQkJCQkJCV9GckVNRC5zZXRVUkwoewoJCQkJCQkJCXBhZ2U6IF9GckVNRC5oYXNoLl9yZWRpcmVjdCB8fCAiaW5kZXgiCgkJCQkJCQl9KTsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCXRyeSB7CgkJCQkJCQkJYXdhaXQgdGhpcy5fbm90TG9nZ2VkSW4oKTsKCQkJCQkJCX0gY2F0Y2ggKGV4KSB7fQoKCQkJCQkJCXRoaXMuZEZvcm0uZXJyb3IoIkludmFsaWQgdXNlcm5hbWUgb3IgcGFzc3dvcmQiKTsKCQkJCQkJfQoKCQkJCQkJdGhpcy5kRm9ybS5idXN5KGZhbHNlKTsKCQkJCQl9CgkJCQl9XSkKCQkJfTsKCQl9Cgl9CgoJU3RvcmVDb21wb25lbnQgPSBjbGFzcyBleHRlbmRzIHRoaXMuQ29yZUNvbXBvbmVudCB7CgkJYXN5bmMgbWFpbigpIHsKCQkJdGhpcy5fY2FuVmlldygpOwoKCQkJY29uc29sZS5sb2coIkdlbmVyYXRpbmcgQ1JVRCBwYWdlIGZvcjogIiwgdGhpcy5wYWdlKTsKCgkJCXRoaXMucGFnZS5kYXRhID0gYXdhaXQgdGhpcy5kRm9ybS5DUlVEKHRoaXMucGFnZS5kYXRhKTsKCQl9Cgl9CgkvKiogQ29tcG9uZW50czo6RW5kICoqLwp9Ow==",
	"__keys": ["name"],
	"active": true,
	"enabled": true,
	"__trMap": []
}