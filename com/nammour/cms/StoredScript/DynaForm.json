{
	"Id": "1276dc973d492c67a892998545f996ce97643f1a",
	"name": "DynaForm",
	"script": "d2luZG93LkR5bmFGb3JtID0gY2xhc3MgewoJY29uc3RydWN0b3IoKSB7CgkJdGhpcy50aXRsZSA9ICJGb3JtIFRpdGxlIjsKCQl0aGlzLm5hbWUgPSAiZnJtRm9ybSI7CgkJdGhpcy5lbGVtZW50cyA9IFtdOwoJCXRoaXMuc2VsZWN0cyA9IFtdOwoJCXRoaXMuZ3JpZHMgPSBbXTsKCQl0aGlzLmJ1dHRvbnMgPSBbXTsKCQl0aGlzLnpvbmVzID0gWydub3J0aCcsICdzb3V0aCcsICdlYXN0JywgJ3dlc3QnLCAnY2VudGVyJ107CgkJdGhpcy5zVGFibGUgPSBudWxsOwoJCXRoaXMuYkRlYnVnID0gZmFsc2U7CgkJdGhpcy51aVR5cGVzID0gewoJCQlpbnQ6ICJudW1iZXJzcGlubmVyIiwKCQkJbWVudTogInNwbGl0YnV0dG9uIiwKCQkJZGF0ZXRpbWU6ICJkYXRldGltZWJveCIsCgkJCWJvb2w6ICJzd2l0Y2hidXR0b24iLAoJCQlmaWxlOiAiZmlsZWJveCIsCgkJCXRleHQ6ICJ0ZXh0Ym94IiwKCQkJcGFzc3dvcmQ6ICJwYXNzd29yZGJveCIsCgkJCXN0cmluZzogInRleHRib3giLAoJCQlpbWFnZTogImRpYWxvZyIsCgkJCXByb2dyZXNzOiAicHJvZ3Jlc3NiYXIiLAoJCQlsaW5rOiAibGlua2J1dHRvbiIsCgkJCXRyZWU6ICJjb21ib3RyZWUiLAoJCQluYXZpZ2F0aW9uOiAidHJlZSIsCgkJCXNlYXJjaDogJ3NlYXJjaGJveCcsCgkJfTsKCQl0aGlzLmV2ZW50cyA9IFt7CgkJCW5hbWU6ICdvbkNsaWNrJywKCQkJaGFuZGxlcjogJ29uVG9nZ2xlJywKCQkJcGFyYW1zOiAnbj1ldmVudCcsCgkJCXR5cGU6ICd0b2dnbGUnLAoJCX0sIHsKCQkJbmFtZTogJ29uQ2xvc2UnLAoJCQloYW5kbGVyOiAnUGFuT25DbG9zZScsCgkJCXBhcmFtczogJ249ZXZlbnQnLAoJCQl0eXBlOiAnd2luZG93JywKCQl9LCB7CgkJCW5hbWU6ICdvblNlbGVjdCcsCgkJCWhhbmRsZXI6ICdTZWxlY3RDaGFuZ2UnLAoJCQlwYXJhbXM6ICduJywKCQkJdHlwZTogJ3RhYnMnLAoJCX0sIHsKCQkJbmFtZTogJ3NlYXJjaGVyJywKCQkJaGFuZGxlcjogJ0ZpZWxkQ2hhbmdlJywKCQkJcGFyYW1zOiAnbiwgbycsCgkJCXR5cGU6ICdzZWFyY2hib3gnLAoJCX0sIHsKCQkJbmFtZTogJ29uQmVmb3JlRXhwYW5kJywKCQkJaGFuZGxlcjogJ0V4cGFuZCcsCgkJCXBhcmFtczogJ24nLAoJCQl0eXBlOiAndHJlZScsCgkJfSwgewoJCQluYW1lOiAnb25DaGFuZ2UnLAoJCQloYW5kbGVyOiAnRmllbGRDaGFuZ2UnLAoJCQlwYXJhbXM6ICduLCBvJwoJCX0sIHsKCQkJbmFtZTogJ29uQmVmb3JlT3BlbicsCgkJCWhhbmRsZXI6ICdQYW5lbE9wZW4nLAoJCQlwYXJhbXM6ICcnLAoJCQl0eXBlOiAnd2luZG93JywKCQl9LCB7CgkJCW5hbWU6ICdvbk9wZW4nLAoJCQloYW5kbGVyOiAnUGVuZEFmdGVyT3BlbicsCgkJCXBhcmFtczogJycsCgkJCXR5cGU6ICd3aW5kb3cnLAoJCX0sIHsKCQkJbmFtZTogJ29uQ2xpY2snLAoJCQloYW5kbGVyOiAnZG9MaW5rJywKCQkJcGFyYW1zOiAnbj1ldmVudCwgbycsCgkJCXR5cGU6ICdsaW5rJywKCQl9LCB7CgkJCW5hbWU6ICdvbkNsaWNrUm93JywKCQkJaGFuZGxlcjogJ0ZpZWxkQ2hhbmdlJywKCQkJcGFyYW1zOiAnbiwgbycsCgkJCXR5cGU6ICdncmlkJywKCQl9XTsKCgkJaWYgKHR5cGVvZigkKSAhPT0gJ3VuZGVmaW5lZCcpICQod2luZG93KS5yZXNpemUodGhpcy53aW5kb3dSZXNpemVkKTsKCQl0aGlzLndpbmRvd1Jlc2l6ZWQoKTsKCX0KCglzcigpIHsKCQlyZXR1cm4gdHlwZW9mKF9GckVNRCkgIT09ICd1bmRlZmluZWQnID8gX0ZyRU1ELnNyKCkgOiB3aW5kb3cuc3I7Cgl9CgoJcGFyc2UoKSB7CgkJJC5wYXJzZXIucGFyc2UoKTsKCX0KCgl3aW5kb3dSZXNpemVkKCkgewoJCXRoaXMud2lkdGggPSB3aW5kb3cuaW5uZXJXaWR0aDsKCQl0aGlzLmhlaWdodCA9IHdpbmRvdy5pbm5lckhlaWdodCAqIDAuODsKCX0KCgkvKiogQ29tcG9uZW50czo6U3RhcnQgKiovCglDb3JlQ29tcG9uZW50ID0gY2xhc3MgewoJCWNvbnN0cnVjdG9yKHBhZ2UpIHsKCQkJdGhpcy5wYWdlID0gcGFnZTsKCQl9CgoJCV9tZSh2KSB7CgkJCWlmICh0eXBlb2YoY29tcGFueSkgIT09ICd1bmRlZmluZWQnKSB7CgkJCQlpZiAodikgewoJCQkJCXdpbmRvd1tjb21wYW55LmxvZ2dlZEluSWRlbnRpdHkgfHwgIm1lIl0gPSB2OwoJCQkJfQoKCQkJCXJldHVybiB3aW5kb3dbY29tcGFueS5sb2dnZWRJbklkZW50aXR5IHx8ICJtZSJdOwoJCQl9IGVsc2UgewoJCQkJcmV0dXJuIG51bGw7CgkJCX0KCQl9CgoJCV9jYW5WaWV3KCkgewoJCQlpZiAoIXRoaXMuX21lKCkpIHsKCQkJCXdpbmRvdy5fRnJFTUQuc2V0VVJMKHsKCQkJCQlwYWdlOiAnbG9naW4nLAoJCQkJCV9yZWRpcmVjdDogdGhpcy5wYWdlLl9jb2RlLAoJCQkJfSk7CgkJCQl0aHJvdyBgX2NhblZpZXc6ICR7dGhpcy5wYWdlLl9jb2RlfSBub3QgYWxsb3dlZCB3aXRob3V0IGxvZ2luIWA7CgkJCX0KCQl9CgoJCV9uYW1lKCkgewoJCQlpZiAoIXRoaXMuX21lKCkpIHJldHVybiAiIjsKCQkJcmV0dXJuIHRoaXMuX21lKCkubmFtZSA/IHRoaXMuX21lKCkubmFtZSgpIDogdGhpcy5fbWUoKS5Ub1N0cmluZzsKCQl9Cgl9CgoJSW5kZXhDb21wb25lbnQgPSBjbGFzcyBleHRlbmRzIHRoaXMuQ29yZUNvbXBvbmVudCB7CgkJYXN5bmMgbWFpbigpIHsKCQkJdGhpcy5fY2FuVmlldygpOwoKCQkJdGhpcy5wYWdlLmRhdGEgPSB7CgkJCQlmb3JtOiB3aW5kb3cuREZvcm0ucmVuZGVyKCdmcm1JbmRleCcsICJNYWluIFBhZ2UiLCBbewoJCQkJCW5hbWU6ICdXZWxjb21lJywKCQkJCQlyZXF1aXJlZDogdHJ1ZSwKCQkJCQl0eXBlOiAibGFiZWwiLAoJCQkJCXZhbHVlOiB0aGlzLl9uYW1lKCksCgkJCQl9XSwgW10pCgkJCX07CgkJfQoJfQoKCUxvZ2luQ29tcG9uZW50ID0gY2xhc3MgZXh0ZW5kcyB0aGlzLkNvcmVDb21wb25lbnQgewoJCWFzeW5jIF9hdXRoZW50aWNhdGUobykgewoJCQlyZXR1cm4gbnVsbDsKCQl9CgoJCWFzeW5jIF9sb2dnZWRJbigpIHt9CgoJCWFzeW5jIF9ub3RMb2dnZWRJbigpIHt9CgoJCWFzeW5jIG1haW4oKSB7CgkJCXRoaXMucGFnZS5kYXRhID0gewoJCQkJZm9ybTogd2luZG93LkRGb3JtLnJlbmRlcignZnJtTG9naW4nLCAiVXNlciBBdXRoZW50aWNhdGlvbiIsIFt7CgkJCQkJCW5hbWU6ICdVc2VybmFtZScsCgkJCQkJCXJlcXVpcmVkOiB0cnVlLAoJCQkJCQl0eXBlOiAic3RyaW5nIgoJCQkJCX0sCgkJCQkJewoJCQkJCQluYW1lOiAnUGFzc3dvcmQnLAoJCQkJCQlyZXF1aXJlZDogdHJ1ZSwKCQkJCQkJdHlwZTogInBhc3N3b3JkIgoJCQkJCX0KCQkJCV0sIFt7CgkJCQkJbmFtZTogJ0xvZ2luJywKCQkJCQlhdXRvU3VibWl0OiB0cnVlLAoJCQkJCW9uY2xpY2s6IGFzeW5jIG8gPT4gewoJCQkJCQlsZXQgcmV0ID0gYXdhaXQgdGhpcy5fYXV0aGVudGljYXRlKG8pOwoKCQkJCQkJaWYgKHJldCkgewoJCQkJCQkJdGhpcy5fbWUocmV0KTsKCgkJCQkJCQl0cnkgewoJCQkJCQkJCWF3YWl0IHRoaXMuX2xvZ2dlZEluKCk7CgkJCQkJCQl9IGNhdGNoIChleCkge30KCgkJCQkJCQlfRnJFTUQuc2V0VVJMKHsKCQkJCQkJCQlwYWdlOiBfRnJFTUQuaGFzaC5fcmVkaXJlY3QgfHwgImluZGV4IgoJCQkJCQkJfSk7CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQl0cnkgewoJCQkJCQkJCWF3YWl0IHRoaXMuX25vdExvZ2dlZEluKCk7CgkJCQkJCQl9IGNhdGNoIChleCkge30KCgkJCQkJCQl3aW5kb3cuREZvcm0uZXJyb3IoIkludmFsaWQgdXNlcm5hbWUgb3IgcGFzc3dvcmQiKTsKCQkJCQkJfQoKCQkJCQkJd2luZG93LkRGb3JtLmJ1c3koZmFsc2UpOwoJCQkJCX0KCQkJCX1dKQoJCQl9CgkJfQoJfQoKCVN0b3JlQ29tcG9uZW50ID0gY2xhc3MgZXh0ZW5kcyB0aGlzLkNvcmVDb21wb25lbnQgewoJCWFzeW5jIG1haW4oKSB7CgkJCXRoaXMuX2NhblZpZXcoKTsKCgkJCWNvbnNvbGUubG9nKCJHZW5lcmF0aW5nIENSVUQgcGFnZSBmb3I6ICIsIHRoaXMucGFnZSk7CgoJCQl0aGlzLnBhZ2UuZGF0YSA9IGF3YWl0IHdpbmRvdy5ERm9ybS5DUlVEKHRoaXMucGFnZS5kYXRhKTsKCQl9Cgl9CgkvKiogQ29tcG9uZW50czo6RW5kICoqLwoKCWluaXQoKSB7CgkJdmFyIHNlbGVjdCA9IHsKCQkJaW5pdDogZnVuY3Rpb24oY29udGFpbmVyLCBvcHRpb25zKSB7CgkJCQl2YXIgb3AgPSBudWxsOwoJCQkJdmFyIGZvcCA9IG51bGw7CgkJCQlmb3IgKHZhciBpID0gMDsgaSA8IHdpbmRvdy5ERm9ybS5ncmlkcy5sZW5ndGg7IGkrKykKCQkJCQlpZiAod2luZG93LkRGb3JtLmdyaWRzW2ldLmlkID09IG9wdGlvbnMuc291cmNlKSBvcCA9IHdpbmRvdy5ERm9ybS5ncmlkc1tpXS5vcHRpb25zOwoJCQkJZm9yIChpID0gMDsgaSA8IG9wLmNvbHVtbnMubGVuZ3RoOyBpKyspCgkJCQkJaWYgKG9wLmNvbHVtbnNbaV0ubmFtZSA9PSBvcHRpb25zLmZpZWxkKSBmb3AgPSBvcC5jb2x1bW5zW2ldOwoJCQkJZm9wLndpZHRoID0gKHdpbmRvdy5ERm9ybS53aWR0aCAvIDMpOwoJCQkJdmFyIGUgPSAkKHdpbmRvdy5ERm9ybS5zZWxlY3QoZm9wKSk7CgkJCQl2YXIgaW5wdXQgPSBlLmFwcGVuZFRvKGNvbnRhaW5lcik7CgkJCQlpbnB1dC5jb21ib2dyaWQoKTsKCQkJCXdpbmRvdy5ERm9ybS5iaW5kKGlucHV0KTsKCQkJCXJldHVybiBpbnB1dDsKCQkJfSwKCQkJZGVzdHJveTogZnVuY3Rpb24odGFyZ2V0KSB7CgkJCQkkKHRhcmdldCkucmVtb3ZlKCk7CgkJCX0sCgkJCWdldFZhbHVlOiBmdW5jdGlvbih0YXJnZXQpIHsKCQkJCXJldHVybiAkKHRhcmdldCkudmFsKCk7CgkJCX0sCgkJCXNldFZhbHVlOiBmdW5jdGlvbih0YXJnZXQsIHZhbHVlKSB7CgkJCQkkKHRhcmdldCkudmFsKHZhbHVlKTsKCQkJfSwKCQkJcmVzaXplOiBmdW5jdGlvbih0YXJnZXQsIHdpZHRoKSB7CgkJCQkkKHRhcmdldCkuX291dGVyV2lkdGgod2lkdGgpOwoJCQl9CgkJfTsKCQkkLmV4dGVuZCgkLmZuLmRhdGFncmlkLmRlZmF1bHRzLmVkaXRvcnMsIHsKCQkJZGF0ZXRpbWU6IHsKCQkJCWluaXQ6IGZ1bmN0aW9uKGNvbnRhaW5lciwgb3B0aW9ucykgewoJCQkJCW9wdGlvbnMud2lkdGggPSB3aW5kb3cuREZvcm0uY1dpZHRoKG9wdGlvbnMpOwoJCQkJCXZhciBpbnB1dCA9ICQod2luZG93LkRGb3JtLmRhdGV0aW1lKG9wdGlvbnMpKS5hcHBlbmRUbyhjb250YWluZXIpOwoJCQkJCWlucHV0LmRhdGV0aW1lYm94KCk7CgkJCQkJcmV0dXJuIGlucHV0OwoJCQkJfSwKCQkJCWRlc3Ryb3k6IGZ1bmN0aW9uKHRhcmdldCkgewoJCQkJCSQodGFyZ2V0KS5yZW1vdmUoKTsKCQkJCX0sCgkJCQlnZXRWYWx1ZTogZnVuY3Rpb24odGFyZ2V0KSB7CgkJCQkJcmV0dXJuICQodGFyZ2V0KS52YWwoKTsKCQkJCX0sCgkJCQlzZXRWYWx1ZTogZnVuY3Rpb24odGFyZ2V0LCB2YWx1ZSkgewoJCQkJCSQodGFyZ2V0KS52YWwodmFsdWUpOwoJCQkJfSwKCQkJCXJlc2l6ZTogZnVuY3Rpb24odGFyZ2V0LCB3aWR0aCkgewoJCQkJCSQodGFyZ2V0KS5fb3V0ZXJXaWR0aCh3aWR0aCk7CgkJCQl9CgkJCX0sCgkJCWNoZWNrYm94OiB7CgkJCQlpbml0OiBmdW5jdGlvbihjb250YWluZXIsIG9wdGlvbnMpIHsKCQkJCQl2YXIgaW5wdXQgPSAkKHdpbmRvdy5ERm9ybS5ib29sKG9wdGlvbnMpKS5hcHBlbmRUbyhjb250YWluZXIpOwoJCQkJCWlucHV0LnN3aXRjaGJ1dHRvbigpOwoJCQkJCXJldHVybiBpbnB1dDsKCQkJCX0sCgkJCQlkZXN0cm95OiBmdW5jdGlvbih0YXJnZXQpIHsKCQkJCQkkKHRhcmdldCkucmVtb3ZlKCk7CgkJCQl9LAoJCQkJZ2V0VmFsdWU6IGZ1bmN0aW9uKHRhcmdldCkgewoJCQkJCXJldHVybiAkKHRhcmdldCkudmFsKCk7CgkJCQl9LAoJCQkJc2V0VmFsdWU6IGZ1bmN0aW9uKHRhcmdldCwgdmFsdWUpIHsKCQkJCQkkKHRhcmdldCkudmFsKHZhbHVlKTsKCQkJCX0sCgkJCQlyZXNpemU6IGZ1bmN0aW9uKHRhcmdldCwgd2lkdGgpIHsKCQkJCQkkKHRhcmdldCkuX291dGVyV2lkdGgod2lkdGgpOwoJCQkJfQoJCQl9LAoJCQljb21ib3RyZWVncmlkOiBzZWxlY3QsCgkJCXNlbGVjdDogc2VsZWN0LAoJCX0pOwoJfQoKCWFzayhxdWVzdGlvbiwgZkFuc3dlciA9IHYgPT4gdiwgb3B0aW9ucykgewoJCSQubWVzc2FnZXIuY29uZmlybSh0aGlzLnRpdGxlLCBxdWVzdGlvbiwgZnVuY3Rpb24ocikgewoJCQlpZiAob3B0aW9ucykgewoJCQkJZm9yICh2YXIgaSA9IDA7IGkgPCBvcHRpb25zLmxlbmd0aDsgaSsrKSB7CgkJCQkJaWYgKG9wdGlvbnNbaV0uYW5zd2VyID09IHIpIHsKCQkJCQkJcmV0dXJuIGZBbnN3ZXIob3B0aW9uc1tpXS52YWx1ZSk7CgkJCQkJfQoJCQkJfQoJCQl9IGVsc2UgewoJCQkJcmV0dXJuIGZBbnN3ZXIocik7CgkJCX0KCQl9KTsKCX0KCgl0b3BEYXRhKGFyLCBnRmllbGQsIHZGaWVsZCwgdG9wKSB7CgkJaWYgKCF0b3ApIHsKCQkJcmV0dXJuIGFyOwoJCX0KCQlyZXQgPSBbXTsKCQkkLmVhY2godGhpcy5zcigpLmdyb3VwQnkoYXIsIGdGaWVsZCksIGZ1bmN0aW9uKGtleSwgdmFsdWVzKSB7CgkJCXZhbHVlcy52YWx1ZXMuc29ydCgoYSwgYikgPT4gewoJCQkJaWYgKHBhcnNlRmxvYXQoYVt2RmllbGRdKSA8IHBhcnNlRmxvYXQoYlt2RmllbGRdKSkgewoJCQkJCXJldHVybiAxOwoJCQkJfSBlbHNlIGlmIChwYXJzZUZsb2F0KGFbdkZpZWxkXSkgPiBwYXJzZUZsb2F0KGJbdkZpZWxkXSkpIHsKCQkJCQlyZXR1cm4gLTE7CgkJCQl9IGVsc2UgewoJCQkJCXJldHVybiAwOwoJCQkJfQoJCQl9KTsKCQkJJC5lYWNoKHZhbHVlcy52YWx1ZXMsIGZ1bmN0aW9uKGksIHYpIHsKCQkJCWlmIChpIDwgdG9wKSB7CgkJCQkJcmV0LnB1c2godik7CgkJCQl9CgkJCX0pOwoJCX0pOwoJCXJldHVybiByZXQ7Cgl9CgoJYXN5bmMgQ1JVRChzVGFibGUsIGJGaXhlZCkgewoJCXZhciBmaWVsZHMgPSBbXTsKCQl3aW5kb3cuREZvcm0uc1RhYmxlID0gc1RhYmxlOwoJCWlmIChjb21wYW55LmxpYnJhcnkpIHsKCQkJdmFyIHJldCA9IGF3YWl0IHRoaXMuc3IoKS5fKCJDb250ZW50TWFuYWdlci5jbXNHZW5lcmF0ZUxheWVyQ2xhc3MiLCBudWxsLCBjb21wYW55LmxpYnJhcnkgKyAiLiIgKyBzVGFibGUpOwoJCQlmaWVsZHMucHVzaCh7CgkJCQlncm91cDogIk1haW4iLAoJCQkJYXR0cmlidXRlOiB7CgkJCQkJUmVsYXRpb25DbGFzczogewoJCQkJCQlOYW1lOiBzVGFibGUKCQkJCQl9CgkJCQl9LAoJCQkJbmFtZTogd2luZG93LkRGb3JtLnNUYWJsZSwKCQkJCXR5cGU6ICdzZWxlY3QnLAoJCQkJc2VsZWN0OiBmdW5jdGlvbihvKSB7CgkJCQkJd2luZG93LkRGb3JtLnNldChvKTsKCQkJCX0KCQkJfSk7CgkJCWZvciAodmFyIGkgPSAwOyBpIDwgcmV0LkxheWVyQXR0cmlidXRlcy5sZW5ndGg7IGkrKykgewoJCQkJaWYgKHJldC5MYXllckF0dHJpYnV0ZXNbaV0uTmFtZSA9PSAiSWQiKSBjb250aW51ZTsKCQkJCWZpZWxkcy5wdXNoKHsKCQkJCQlncm91cDogIk1haW4iLAoJCQkJCW5hbWU6IHJldC5MYXllckF0dHJpYnV0ZXNbaV0uTmFtZSwKCQkJCQl0eXBlOiByZXQuTGF5ZXJBdHRyaWJ1dGVzW2ldLk5hdGl2ZVR5cGUKCQkJCX0pOwoJCQl9CgkJCWZvciAoaSA9IDA7IGkgPCByZXQuUmVsYXRpb25BdHRyaWJ1dGVzLmxlbmd0aDsgaSsrKSB7CgkJCQl2YXIgbSA9IHJldC5SZWxhdGlvbkF0dHJpYnV0ZXNbaV0uSXNBcnJheTsKCQkJCXZhciByQ29scyA9IFtdOwoJCQkJZm9yICh2YXIgcCBpbiByZXQuUmVsYXRpb25BdHRyaWJ1dGVzW2ldLlJlbGF0aW9uQ2xhc3MpIHsKCQkJCQlpZiAoJC5pbkFycmF5KHAsIFsiVG9TdHJpbmciLCAiX1RvU3RyaW5nIiwgIl9fUk9XSUQiLCAiX19MT0FERUQiLCAiSWQiXSkgPiAtMSkgY29udGludWU7CgkJCQkJckNvbHMucHVzaCh7CgkJCQkJCWZpZWxkOiBwLAoJCQkJCQl0aXRsZTogcAoJCQkJCX0pOwoJCQkJfQoJCQkJZmllbGRzLnB1c2goewoJCQkJCWdyb3VwOiAobSA/ICJPdGhlciIgOiAiUmVsYXRpb25zIiksCgkJCQkJQ2xhc3M6IHJldC5SZWxhdGlvbkF0dHJpYnV0ZXNbaV0uUmVsYXRpb25DbGFzcywKCQkJCQluYW1lOiByZXQuUmVsYXRpb25BdHRyaWJ1dGVzW2ldLk5hbWUsCgkJCQkJdHlwZTogJ3NlbGVjdCcsCgkJCQkJbXVsdGlwbGU6IG0sCgkJCQkJc291cmNlOiBmdW5jdGlvbihvLCBmRGF0YSkgewoJCQkJCQlyZXR1cm4gbzsKCQkJCQl9LAoJCQkJCWNvbHVtbnM6IHJDb2xzCgkJCQl9KTsKCQkJfQoJCX0gZWxzZSB7CgkJCS8vIGVtcwoJCQl2YXIgZWMgPSAoY29tcGFueS5TY29wZSA/IHdpbmRvd1tjb21wYW55LlNjb3BlXSA6IHdpbmRvdykuRW50aXR5Q2xhc3Nlcy5maW5kKGMgPT4gYy5OYW1lLnJlcGxhY2UoJyAnLCAnXycpID09IHNUYWJsZSk7CgkJCWZpZWxkcy5wdXNoKHsKCQkJCW5hbWU6IHNUYWJsZSwKCQkJCXRpdGxlOiBlYy5OYW1lLAoJCQkJQ2xhc3M6IHsKCQkJCQlOYW1lOiBlYy5OYW1lLAoJCQkJCUlkOiBlYy5JZAoJCQkJfSwKCQkJCXR5cGU6ICdzZWxlY3QnLAoJCQkJc2VsZWN0OiBmdW5jdGlvbihvKSB7CgkJCQkJd2luZG93LkRGb3JtLmNsZWFyKCk7CgkJCQkJd2luZG93LkRGb3JtLnNldChvKTsKCQkJCX0KCQkJfSk7CgkJCSQuZWFjaChlYy5FbnRpdHlBdHRyaWJ1dGVzLCAoXywgZWEpID0+IHsKCQkJCWlmICghZWEuRW50aXR5VHlwZSkgewoJCQkJCXZhciB0eXBlID0gInN0cmluZyI7CgkJCQkJaWYgKGVhLklzQm9vbCkgdHlwZSA9ICJib29sIjsKCQkJCQlpZiAoZWEuSXNEYXRlKSB0eXBlID0gImRhdGV0aW1lIjsKCQkJCQlpZiAoZWEuSXMpIHR5cGUgPSAiZGF0ZXRpbWUiOwoJCQkJCWlmIChlYS5Jc1RleHQpIHR5cGUgPSAidGV4dCI7CgkJCQkJZmllbGRzLnB1c2goewoJCQkJCQlncm91cDogZWEuR3JvdXAuTmFtZSwKCQkJCQkJbmFtZTogZWEuTmFtZSwKCQkJCQkJdHlwZTogdHlwZQoJCQkJCX0pOwoJCQkJfSBlbHNlIHsKCQkJCQlmaWVsZHMucHVzaCh7CgkJCQkJCWdyb3VwOiBlYS5Hcm91cC5OYW1lLAoJCQkJCQluYW1lOiBlYS5OYW1lLAoJCQkJCQlDbGFzczogewoJCQkJCQkJTmFtZTogZWEuRW50aXR5VHlwZS5OYW1lLAoJCQkJCQkJSWQ6IGVhLkVudGl0eVR5cGUuSWQKCQkJCQkJfSwKCQkJCQkJc291cmNlOiBmdW5jdGlvbihvLCBmRGF0YSkgewoJCQkJCQkJcmV0dXJuIG87CgkJCQkJCX0sCgkJCQkJCXR5cGU6ICJzZWxlY3QiCgkJCQkJfSk7CgkJCQl9CgkJCX0pOwoJCX0KCQlyZXR1cm4gewoJCQlmb3JtOiB3aW5kb3cuREZvcm0ucmVuZGVyKHNUYWJsZSwgdGhpcy5lbmdsaXNoKHNUYWJsZSksIGZpZWxkcywgW3sKCQkJCW5hbWU6ICdSZXNldCcsCgkJCQlvbmNsaWNrOiBmdW5jdGlvbihvKSB7CgkJCQkJd2luZG93LkRGb3JtLmJ1c3koZmFsc2UpOwoJCQkJCXdpbmRvdy5ERm9ybS5jbGVhcigpOwoJCQkJfSwKCQkJCWljb246ICJjYW5jZWwiCgkJCX0sIHsKCQkJCW5hbWU6ICdTYXZlJywKCQkJCW9uY2xpY2s6IGZ1bmN0aW9uKG8pIHsKCQkJCQlpZiAob1t3aW5kb3cuREZvcm0uc1RhYmxlXSAmJiBvW3dpbmRvdy5ERm9ybS5zVGFibGVdLklkKSBvLklkID0gb1t3aW5kb3cuREZvcm0uc1RhYmxlXS5JZDsKCQkJCQlkZWxldGUgb1t3aW5kb3cuREZvcm0uc1RhYmxlXTsKCQkJCQlpZiAoY29tcGFueS5saWJyYXJ5KSB7CgkJCQkJCXRoaXMuc3IoKS5fKGNvbXBhbnkuQ29kZS50b0xvd2VyQ2FzZSgpICsgIiIgKyB3aW5kb3cuREZvcm0uc1RhYmxlICsgKG8uSWQgPyAiVXBkYXRlIiA6ICJJbnNlcnQiKSwgZnVuY3Rpb24ocmV0KSB7CgkJCQkJCQlpZiAocmV0KSB7CgkJCQkJCQkJd2luZG93LkRGb3JtLmluZm8od2luZG93LkRGb3JtLnNUYWJsZSArICIgU2F2ZWQiKTsKCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJd2luZG93LkRGb3JtLmVycm9yKCJVbmFibGUgdG8gc2F2ZSAiICsgd2luZG93LkRGb3JtLnNUYWJsZSk7CgkJCQkJCQl9CgkJCQkJCQl3aW5kb3cuREZvcm0uYnVzeShmYWxzZSk7CgkJCQkJCX0sIG8pOwoJCQkJCX0gZWxzZSB7CgkJCQkJCXRoaXMuc3IoKS5fKCJlbXNFbnRpdHlPYmplY3QiICsgKG8uSWQgPyAiVXBkYXRlIiA6ICJJbnNlcnQiKSwgZnVuY3Rpb24ocmV0KSB7CgkJCQkJCQlpZiAocmV0KSB7CgkJCQkJCQkJd2luZG93LkRGb3JtLmluZm8od2luZG93LkRGb3JtLnNUYWJsZSArICIgU2F2ZWQiKTsKCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJd2luZG93LkRGb3JtLmVycm9yKCJVbmFibGUgdG8gc2F2ZSAiICsgd2luZG93LkRGb3JtLnNUYWJsZSk7CgkJCQkJCQl9CgkJCQkJCQl3aW5kb3cuREZvcm0uYnVzeShmYWxzZSk7CgkJCQkJCX0sIG8udG9FbnRpdHlPYmplY3QoKSk7CgkJCQkJfQoJCQkJfQoJCQl9XSwgYkZpeGVkKQoJCX07Cgl9CgoJYXN5bmMgZG9DbGljayhidXR0b24pIHsKCQlidXR0b24gPSB0aGlzLmJ1dHRvbnMuZmluZChiID0+IGIubmFtZSA9PSBidXR0b24ubmFtZSAmJiBiLmdyb3VwID09IGJ1dHRvbi5ncm91cCk7CgkJdGhpcy5idXN5KHRydWUpOwoJCXZhciBvID0gdGhpcy5nZXQoKTsKCQl2YXIgc01pc3NpbmcgPSB0aGlzLmVsZW1lbnRzLmZpbHRlcihlID0+IChidXR0b24ud2luZG93ID8gYnV0dG9uLmdyb3VwID09IGUuZ3JvdXAgOiB0cnVlKSkuZmlsdGVyKGUgPT4gZS5yZXF1aXJlZCAmJiAhb1tlLm5hbWVdKS5tYXAoZSA9PiAiPGxpPiIgKyAoZS5sYWJlbCB8fCBlLm5hbWUpICsgIjwvbGk+Iikuam9pbigiIik7CgkJaWYgKHNNaXNzaW5nKSB7CgkJCXdpbmRvdy5fRnJFTUQuX2Vycm9yKCJNaXNzaW5nIG1hbmRhdG9yeSBmaWVsZHM6PGJyLz48dWw+IiArIHNNaXNzaW5nICsgIjwvdWw+IiwgNTAwMCk7CgkJCXRoaXMuYnVzeShmYWxzZSk7CgkJCXJldHVybjsKCQl9CgkJaWYgKGJ1dHRvbi5vbmNsaWNrKSBhd2FpdCBidXR0b24ub25jbGljayhvKTsKCQlpZiAoYnV0dG9uLm9uQ2xpY2spIGF3YWl0IGJ1dHRvbi5vbkNsaWNrKG8pOwoJCXRoaXMuYnVzeShmYWxzZSk7Cgl9CgoJYnVzeShiQnVzeSkgewoJCWlmICghYkJ1c3kpIHsKCQkJdmFyIHRvdGFsID0gMDsKCQkJaWYgKHR5cGVvZiBtb21lbnQgIT09ICd1bmRlZmluZWQnKSB7CgkJCQl0b3RhbCA9IG1vbWVudCgpLmRpZmYobW9tZW50KHRoaXMuYnVzeVN0YW1wKSwgJ3NlY29uZHMnKTsKCQkJfSBlbHNlIHsKCQkJCS8vIG5vIG1vbWVudCwgdXNlIHN0YW5kYXJkIERhdGUKCQkJCXRvdGFsID0gKG5ldyBEYXRlKCkuZ2V0VGltZSgpIC0gdGhpcy5idXN5U3RhbXAgPyB0aGlzLmJ1c3lTdGFtcC5nZXRUaW1lKCkgOiAwKSAvIDEwMDAgLyAzNjAwOwoJCQl9CgkJCWlmICh0aGlzLmJEZWJ1ZykgewoJCQkJd2luZG93Ll9GckVNRC5fYWxlcnQoIkV4ZWN1dGlvbiBUaW1lOiAiICsgdG90YWwgKyAiIHNlY29uZHMuIik7CgkJCX0KCQkJZGVsZXRlIHRoaXMuYnVzeVN0YW1wOwoJCX0gZWxzZSB7CgkJCXRoaXMuYnVzeVN0YW1wID0gbmV3IERhdGUoKTsKCQl9CgoJCSQuZWFjaCgkLm1lcmdlKCQubWFwKHRoaXMuYnV0dG9ucywgYiA9PiBiLm5hbWUpLCAkLm1hcCh0aGlzLmVsZW1lbnRzLmZpbHRlcihlID0+IGUudHlwZSA9PSAnbGluaycpLCBlID0+IGUubmFtZSkpLCAoXywgZSkgPT4gJCgnIycgKyBlKS5saW5rYnV0dG9uKGJCdXN5ID8gJ2Rpc2FibGUnIDogJ2VuYWJsZScpKTsKCX0KCglwcmVmaXgoZSkgewoJCXN3aXRjaCAoZS50eXBlKSB7CgkJCWNhc2UgJ2xhYmVsJzoKCQkJCXJldHVybiAnbGJsJzsKCQkJY2FzZSAndGV4dCc6CgkJCWNhc2UgJ3N0cmluZyc6CgkJCWNhc2UgJ3NlYXJjaCc6CgkJCWNhc2UgJ3Bhc3N3b3JkJzoKCQkJCXJldHVybiAndHh0JzsKCQkJY2FzZSAiRGF0ZVRpbWUiOgoJCQljYXNlICJkYXRldGltZSI6CgkJCQlyZXR1cm4gJ2R0cCc7CgkJCWNhc2UgImludCI6CgkJCWNhc2UgImludGVnZXIiOgoJCQljYXNlICJudW1iZXIiOgoJCQljYXNlICJsb25nIjoKCQkJY2FzZSAiTG9uZyI6CgkJCQlyZXR1cm4gJ251ZCc7CgkJCWNhc2UgJ2ZpbGUnOgoJCQkJcmV0dXJuICdmaWwnOwoJCQljYXNlICdpbWFnZSc6CgkJCQlyZXR1cm4gJ2ltZyc7CgkJCWNhc2UgImJvb2wiOgoJCQkJcmV0dXJuICdjaGsnOwoJCQljYXNlICJ3aW5kb3ciOgoJCQkJcmV0dXJuICdwbmwnOwoJCQljYXNlICJwcm9ncmVzcyI6CgkJCQlyZXR1cm4gJ3ByZyc7CgkJCWNhc2UgImdyaWQiOgoJCQljYXNlICJ0cmVlIjoKCQkJY2FzZSAic2VsZWN0IjoKCQkJCXJldHVybiAnY21iJzsKCQkJZGVmYXVsdDoKCQkJCXJldHVybiAnJzsKCQl9Cgl9CgoJY2xlYXIoZ3JvdXApIHsKCQl2YXIgbyA9IHt9OwoJCSQuZWFjaCh0aGlzLmVsZW1lbnRzLmZpbHRlcihlID0+IGdyb3VwID8gZS5ncm91cCA9PSBncm91cCA6IHRydWUpLCAoXywgZSkgPT4gewoJCQl2YXIgbmFtZSA9IChlLmVtc1NvdXJjZSA/ICJfIiA6ICIiKSArIGUubmFtZTsKCQkJc3dpdGNoIChlLnR5cGUpIHsKCQkJCWNhc2UgJ3RleHQnOgoJCQkJY2FzZSAnc3RyaW5nJzoKCQkJCWNhc2UgJ3NlYXJjaCc6CgkJCQljYXNlICdwYXNzd29yZCc6CgkJCQljYXNlICJEYXRlVGltZSI6CgkJCQljYXNlICJkYXRldGltZSI6CgkJCQkJb1tuYW1lXSA9ICIiOwoJCQkJCWJyZWFrOwoJCQkJY2FzZSAiaW50IjoKCQkJCWNhc2UgIm51bWJlciI6CgkJCQljYXNlICJpbnRlZ2VyIjoKCQkJCWNhc2UgImxvbmciOgoJCQkJY2FzZSAiTG9uZyI6CgkJCQljYXNlICJwcm9ncmVzcyI6CgkJCQkJb1tuYW1lXSA9IDA7CgkJCQkJYnJlYWs7CgkJCQljYXNlICJ0cmVlIjoKCQkJCWNhc2UgInNlbGVjdCI6CgkJCQkJb1tuYW1lXSA9IG51bGw7CgkJCQkJYnJlYWs7CgkJCQljYXNlICJncmlkIjoKCQkJCQlvW25hbWVdID8gb1tuYW1lXS5kYXRhID0gW10gOiBudWxsOwoJCQkJCWJyZWFrOwoJCQkJY2FzZSAiYm9vbCI6CgkJCQkJb1tuYW1lXSA9IGZhbHNlOwoJCQkJCWJyZWFrOwoJCQkJZGVmYXVsdDoKCQkJCQlicmVhazsKCQkJfQoJCX0pOwoJCS8vY29uc29sZS5sb2coImNsZWFyIiwgbyk7CgkJdGhpcy5zZXQobyk7CgkJdGhpcy5idXN5KGZhbHNlKTsKCX0KCglzZXQobywgZU5hbWUpIHsKCQlpZiAoZU5hbWUpIHsKCQkJdmFyIG9FbGVtZW50ID0gdGhpcy5ieU5hbWUoZU5hbWUpOwoJCQlpZiAoIW9FbGVtZW50KSByZXR1cm47CgkJCXZhciBhdHQgPSBudWxsOwoJCQlpZiAobyAmJiBvLklkICYmIG8uRW50aXR5QXR0cmlidXRlKSB7CgkJCQkvLyBhbiBFbnRpdHlWYWx1ZQoJCQkJZm9yICh2YXIgcCBpbiBvKQoJCQkJCWlmIChwLmVuZHNXaXRoKCJWYWx1ZSIpKSBhdHQgPSBwOwoJCQkJb0VsZW1lbnQuZW1zU291cmNlID0gbzsKCQkJfQoJCQl0cnkgewoJCQkJc3dpdGNoIChvRWxlbWVudC50eXBlKSB7CgkJCQkJY2FzZSAnbGFiZWwnOgoJCQkJCQlpZiAoYXR0KSB7CgkJCQkJCQkkKCIjIiArIHRoaXMucHJlZml4KG9FbGVtZW50KSArIG9FbGVtZW50Lm5hbWUpLmh0bWwob1thdHRdKTsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCSQoIiMiICsgdGhpcy5wcmVmaXgob0VsZW1lbnQpICsgb0VsZW1lbnQubmFtZSkuaHRtbCgobyAmJiBvLkVudGl0eUF0dHJpYnV0ZSkgPyAiIiA6IG8pOwoJCQkJCQl9CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgJ3RleHQnOgoJCQkJCWNhc2UgJ3N0cmluZyc6CgkJCQkJY2FzZSAncGFzc3dvcmQnOgoJCQkJCWNhc2UgImludCI6CgkJCQkJY2FzZSAic2VhcmNoIjoKCQkJCQljYXNlICJpbnRlZ2VyIjoKCQkJCQljYXNlICJudW1iZXIiOgoJCQkJCWNhc2UgImxvbmciOgoJCQkJCWNhc2UgIkxvbmciOgoJCQkJCQlpZiAoYXR0KSB7CgkJCQkJCQkkKCIjIiArIHRoaXMucHJlZml4KG9FbGVtZW50KSArIG9FbGVtZW50Lm5hbWUpW3RoaXMudWlUeXBlc1tvRWxlbWVudC50eXBlXV0oInNldFZhbHVlIiwgb1thdHRdKTsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCSQoIiMiICsgdGhpcy5wcmVmaXgob0VsZW1lbnQpICsgb0VsZW1lbnQubmFtZSlbdGhpcy51aVR5cGVzW29FbGVtZW50LnR5cGVdXSgic2V0VmFsdWUiLCAobyAmJiBvLkVudGl0eUF0dHJpYnV0ZSkgPyAiIiA6IG8pOwoJCQkJCQl9CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgIkRhdGVUaW1lIjoKCQkJCQljYXNlICJkYXRldGltZSI6CgkJCQkJCWlmIChhdHQpIHsKCQkJCQkJCSQoIiMiICsgdGhpcy5wcmVmaXgob0VsZW1lbnQpICsgb0VsZW1lbnQubmFtZSlbdGhpcy51aVR5cGVzW29FbGVtZW50LnR5cGVdXSgnc2V0VmFsdWUnLCAob1thdHRdID8gdGhpcy5zcigpLnRvRGF0ZVRpbWUob1thdHRdKSA6ICIiKSk7CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQkkKCIjIiArIHRoaXMucHJlZml4KG9FbGVtZW50KSArIG9FbGVtZW50Lm5hbWUpW3RoaXMudWlUeXBlc1tvRWxlbWVudC50eXBlXV0oJ3NldFZhbHVlJywgKG8gJiYgby5FbnRpdHlBdHRyaWJ1dGUpID8gIiIgOiAobyA/IHRoaXMuc3IoKS50b0RhdGVUaW1lKG8pIDogIiIpKTsKCQkJCQkJfQoJCQkJCQlicmVhazsKCQkJCQljYXNlICJib29sIjoKCQkJCQkJaWYgKGF0dCkgewoJCQkJCQkJJCgiIyIgKyB0aGlzLnByZWZpeChvRWxlbWVudCkgKyBvRWxlbWVudC5uYW1lKVt0aGlzLnVpVHlwZXNbb0VsZW1lbnQudHlwZV1dKChvW2F0dF0gPyAnJyA6ICd1bicpICsgJ2NoZWNrJyk7CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQkkKCIjIiArIHRoaXMucHJlZml4KG9FbGVtZW50KSArIG9FbGVtZW50Lm5hbWUpW3RoaXMudWlUeXBlc1tvRWxlbWVudC50eXBlXV0oKCgobyAmJiBvLkVudGl0eUF0dHJpYnV0ZSkgPyAiIiA6IG8pID8gJycgOiAndW4nKSArICdjaGVjaycpOwoJCQkJCQl9CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgIndpbmRvdyI6CgkJCQkJCWlmIChhdHQpIHsKCQkJCQkJCW9FbGVtZW50LnZhbHVlID0gb1thdHRdOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJb0VsZW1lbnQudmFsdWUgPSAobyAmJiBvLkVudGl0eUF0dHJpYnV0ZSkgPyAiIiA6IG87CgkJCQkJCX0KCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAicHJvZ3Jlc3MiOgoJCQkJCQl2YXIgdiA9IDA7CgkJCQkJCWlmIChhdHQpIHsKCQkJCQkJCXYgPSBvW2F0dF07CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQl2ID0gKG8gJiYgby5FbnRpdHlBdHRyaWJ1dGUpID8gIiIgOiBvOwoJCQkJCQl9CgkJCQkJCSQoIiMiICsgdGhpcy5wcmVmaXgob0VsZW1lbnQpICsgb0VsZW1lbnQubmFtZSlbdGhpcy51aVR5cGVzW29FbGVtZW50LnR5cGVdXSgnc2V0VmFsdWUnLCBNYXRoLnJvdW5kKHYgKiAxMCkgLyAxMCk7CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgImdyaWQiOgoJCQkJCQlsZXQgY29scyA9IEpTT04ucGFyc2UoInsiICsgdGhpcy5tYXBDb2x1bW5zKG9FbGVtZW50LCB0cnVlKSArICJ9Iik7CgkJCQkJCSQuZWFjaChjb2xzLmNvbHVtbnNbMF0sIChfLCBjKSA9PiBjLmZvcm1hdHRlciA9IHRoaXMuc3IoKS5ydW5TY3JpcHQodGhpcy5mb3JtYXR0ZXIob0VsZW1lbnQubmFtZSwgYykpKTsKCQkJCQkJJCgiIyIgKyB0aGlzLnByZWZpeChvRWxlbWVudCkgKyBvRWxlbWVudC5uYW1lKS5kYXRhZ3JpZChjb2xzKTsKCQkJCQkJaWYgKGF0dCkgewoJCQkJCQkJJCgiIyIgKyB0aGlzLnByZWZpeChvRWxlbWVudCkgKyBvRWxlbWVudC5uYW1lKS5kYXRhZ3JpZCh7CgkJCQkJCQkJZGF0YTogb1thdHRdCgkJCQkJCQl9KTsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCSQoIiMiICsgdGhpcy5wcmVmaXgob0VsZW1lbnQpICsgb0VsZW1lbnQubmFtZSkuZGF0YWdyaWQoewoJCQkJCQkJCWRhdGE6IChvICYmIG8uRW50aXR5QXR0cmlidXRlKSA/ICIiIDogbwoJCQkJCQkJfSk7CgkJCQkJCX0KCQkJCQkJJCgiIyIgKyB0aGlzLnByZWZpeChvRWxlbWVudCkgKyBvRWxlbWVudC5uYW1lKS5kYXRhZ3JpZCgidW5zZWxlY3RBbGwiKTsKCQkJCQkJJCgiIyIgKyB0aGlzLnByZWZpeChvRWxlbWVudCkgKyBvRWxlbWVudC5uYW1lKS5kYXRhZ3JpZCgpOwoJCQkJCQlicmVhazsKCQkJCQljYXNlICJ0cmVlIjoKCQkJCQkJdmFyIHYgPSBhdHQgPyBvW2F0dF0gOiAoKG8gJiYgby5FbnRpdHlBdHRyaWJ1dGUpID8gIiIgOiBvKTsKCQkJCQkJaWYgKEFycmF5LmlzQXJyYXkodikpIHsKCQkJCQkJCSQoIiMiICsgdGhpcy5wcmVmaXgob0VsZW1lbnQpICsgb0VsZW1lbnQubmFtZSlbdGhpcy51aVR5cGVzW29FbGVtZW50LnR5cGVdXSgidHJlZSIpLnRyZWUoImxvYWREYXRhIiwgdik7CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQkkKCIjIiArIHRoaXMucHJlZml4KG9FbGVtZW50KSArIG9FbGVtZW50Lm5hbWUpW3RoaXMudWlUeXBlc1tvRWxlbWVudC50eXBlXV0oJ3NldFZhbHVlJywgdik7CgkJCQkJCX0KCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAic2VsZWN0IjoKCQkJCQkJaWYgKGF0dCkgewoJCQkJCQkJaWYgKG9FbGVtZW50Lm9wdGlvbnMpIHsKCQkJCQkJCQkkKCIjIiArIHRoaXMucHJlZml4KG9FbGVtZW50KSArIG9FbGVtZW50Lm5hbWUpLmNvbWJvKCdzZXRWYWx1ZScgKyAob0VsZW1lbnQubXVsdGlwbGUgPyAncycgOiAnJyksIChvW2F0dF0gPyBvW2F0dF0gOiAiIikpOwoJCQkJCQkJCSQoIiMiICsgdGhpcy5wcmVmaXgob0VsZW1lbnQpICsgb0VsZW1lbnQubmFtZSkuY29tYm8oJ3NldFZhbHVlJyArIChvRWxlbWVudC5tdWx0aXBsZSA/ICdzJyA6ICcnKSwgKG9bYXR0XSA/IG9bYXR0XSA6ICIiKSk7CgkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCSQoIiMiICsgdGhpcy5wcmVmaXgob0VsZW1lbnQpICsgb0VsZW1lbnQubmFtZSkuY29tYm9ncmlkKCdzZXRWYWx1ZScgKyAob0VsZW1lbnQubXVsdGlwbGUgPyAncycgOiAnJyksIChvW2F0dF0gPyBvW2F0dF0gOiAiIikpOwoJCQkJCQkJfQoJCQkJCQl9IGVsc2UgewoJCQkJCQkJdiA9IG51bGw7CgkJCQkJCQlpZiAobyA9PT0gbnVsbCkgewoKCQkJCQkJCX0gZWxzZSBpZiAoby5jb25zdHJ1Y3RvciA9PT0gQXJyYXkpIHsKCgkJCQkJCQl9IGVsc2UgaWYgKCFvLkVudGl0eUF0dHJpYnV0ZSkgewoJCQkJCQkJCXYgPSBvIHx8IHsKCQkJCQkJCQkJSWQ6IG8uSWQsCgkJCQkJCQkJCV9Ub1N0cmluZzogby5fVG9TdHJpbmcsCgkJCQkJCQkJCXRvU3RyaW5nOiBmdW5jdGlvbigpIHsKCQkJCQkJCQkJCXJldHVybiB0aGlzLl9Ub1N0cmluZzsKCQkJCQkJCQkJfQoJCQkJCQkJCX07CgkJCQkJCQl9CgkJCQkJCQlpZiAob0VsZW1lbnQub3B0aW9ucykgewoJCQkJCQkJCSQoIiMiICsgdGhpcy5wcmVmaXgob0VsZW1lbnQpICsgb0VsZW1lbnQubmFtZSkuY29tYm8oJ3NldFZhbHVlJyArIChvRWxlbWVudC5tdWx0aXBsZSA/ICdzJyA6ICcnKSwgdik7CgkJCQkJCQkJJCgiIyIgKyB0aGlzLnByZWZpeChvRWxlbWVudCkgKyBvRWxlbWVudC5uYW1lKS5jb21ibygnc2V0VGV4dCcgKyAob0VsZW1lbnQubXVsdGlwbGUgPyAncycgOiAnJyksIHYpOwoJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQkkKCIjIiArIHRoaXMucHJlZml4KG9FbGVtZW50KSArIG9FbGVtZW50Lm5hbWUpLmNvbWJvZ3JpZCgnc2V0VmFsdWUnICsgKG9FbGVtZW50Lm11bHRpcGxlID8gJ3MnIDogJycpLCB2KTsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCQlicmVhazsKCQkJCQlkZWZhdWx0OgoJCQkJCQlicmVhazsKCQkJCX0KCQkJfSBjYXRjaCAoZXgpIHsKCQkJCWNvbnNvbGUubG9nKGV4KTsKCQkJfQoJCX0gZWxzZSB7CgkJCWZvciAodmFyIHAgaW4gbykgewoJCQkJaWYgKHAuaW5kZXhPZignXycpID09PSAwKSBwID0gcC5zdWJzdHJpbmcoMSk7CgkJCQl2YXIgZSA9IHRoaXMuYnlOYW1lKHApOwoJCQkJaWYgKCFlIHx8ICFlLm5hbWUpIGNvbnRpbnVlOwoJCQkJdmFyIHZhbHVlID0gb1twXTsKCQkJCWlmIChlLm5hbWUgPT0gdGhpcy5zVGFibGUpIHsKCQkJCQl2YWx1ZSA9IG87CgkJCQkJdmFsdWUuRGF0ZSA9IG5ldyBEYXRlKCk7CgkJCQl9CgkJCQlpZiAocCA9PSAiRW50aXR5VmFsdWVzIikgewoJCQkJCS8vIGFuIGVtc0Zvcm1WYWx1ZXMgc291cmNlCgkJCQkJLy8gZmluZCB0aGUgRW50aXR5VmFsdWUgZm9yIHRoaXMgZWxlbWVudCBhbmQgc2V0IGl0CgkJCQkJZm9yICh2YXIgaiA9IDA7IGogPCBvLkVudGl0eVZhbHVlcy5sZW5ndGg7IGorKykgewoJCQkJCQlpZiAoby5FbnRpdHlWYWx1ZXNbal0uRW50aXR5QXR0cmlidXRlLk5hbWUgPT0gZS5uYW1lKSB7CgkJCQkJCQkvLyBmb3VuZCB0aGUgRW50aXR5VmFsdWUgZm9yIHRoaXMgZWxlbWVudAoJCQkJCQkJX3YgPSBvLkVudGl0eVZhbHVlc1tqXTsKCQkJCQkJCWZvciAodmFyIHEgaW4gX3YpIHsKCQkJCQkJCQlpZiAocS5lbmRzV2l0aCgiVmFsdWUiKSkgewoJCQkJCQkJCQlfdltxXSA9IHZhbHVlOwoJCQkJCQkJCX0KCQkJCQkJCX0KCQkJCQkJCWJyZWFrOwoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQkJdGhpcy5zZXQodmFsdWUsIGUubmFtZSk7CgkJCX0KCQl9Cgl9CgoJZ2V0KCkgewoJCXZhciBvID0ge307CgkJaWYgKHRoaXMuc1RhYmxlICYmIHdpbmRvd1t0aGlzLnNUYWJsZV0pIG8gPSBuZXcgd2luZG93W3RoaXMuc1RhYmxlXSgpOwoJCWZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5lbGVtZW50cy5sZW5ndGg7IGkrKykgewoJCQl2YXIgY24gPSBudWxsOwoJCQl2YXIgdiA9IG51bGw7CgkJCXRyeSB7CgkJCQlzd2l0Y2ggKHRoaXMuZWxlbWVudHNbaV0udHlwZSkgewoJCQkJCWNhc2UgJ2xhYmVsJzoKCQkJCQkJY24gPSAkKCIjbGJsIiArIHRoaXMuZWxlbWVudHNbaV0ubmFtZSk7CgkJCQkJCXYgPSBjbi5odG1sKCk7CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgJ3RleHQnOgoJCQkJCWNhc2UgJ3N0cmluZyc6CgkJCQkJY2FzZSAnc2VhcmNoJzoKCQkJCQljYXNlICdwYXNzd29yZCc6CgkJCQkJCWNuID0gJCgiIyIgKyB0aGlzLnByZWZpeCh0aGlzLmVsZW1lbnRzW2ldKSArIHRoaXMuZWxlbWVudHNbaV0ubmFtZSk7CgkJCQkJCXYgPSBjbi52YWwoKTsKCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAiZmlsZSI6CgkJCQkJY2FzZSAiaW1hZ2UiOgoJCQkJCQljbiA9ICQoIiMiICsgdGhpcy5wcmVmaXgodGhpcy5lbGVtZW50c1tpXSkgKyB0aGlzLmVsZW1lbnRzW2ldLm5hbWUpOwoJCQkJCQl2ID0gdGhpcy5lbGVtZW50c1tpXS5kYXRhOwoJCQkJCQlicmVhazsKCQkJCQljYXNlICJEYXRlVGltZSI6CgkJCQkJY2FzZSAiZGF0ZXRpbWUiOgoJCQkJCQl2ID0gbmV3IERhdGUoJCgiIyIgKyB0aGlzLnByZWZpeCh0aGlzLmVsZW1lbnRzW2ldKSArIHRoaXMuZWxlbWVudHNbaV0ubmFtZSkuZGF0ZXRpbWVib3goJ2dldFZhbHVlJykpOwoJCQkJCQljbiA9ICQoIiMiICsgdGhpcy5wcmVmaXgodGhpcy5lbGVtZW50c1tpXSkgKyB0aGlzLmVsZW1lbnRzW2ldLm5hbWUpOwoJCQkJCQlicmVhazsKCQkJCQljYXNlICJwcm9ncmVzcyI6CgkJCQkJCWNuID0gJCgiIyIgKyB0aGlzLnByZWZpeCh0aGlzLmVsZW1lbnRzW2ldKSArIHRoaXMuZWxlbWVudHNbaV0ubmFtZSk7CgkJCQkJCXYgPSBjbi5wcm9ncmVzc2JhcignZ2V0VmFsdWUnKTsKCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAiaW50IjoKCQkJCQljYXNlICJpbnRlZ2VyIjoKCQkJCQljYXNlICJudW1iZXIiOgoJCQkJCWNhc2UgImxvbmciOgoJCQkJCWNhc2UgIkxvbmciOgoJCQkJCQljbiA9ICQoIiMiICsgdGhpcy5wcmVmaXgodGhpcy5lbGVtZW50c1tpXSkgKyB0aGlzLmVsZW1lbnRzW2ldLm5hbWUpOwoJCQkJCQl2ID0gcGFyc2VGbG9hdChjbi52YWwoKSk7CgkJCQkJCWlmIChpc05hTih2KSkgdiA9IDA7CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgImdyaWQiOgoJCQkJCQljbiA9ICQoIiMiICsgdGhpcy5wcmVmaXgodGhpcy5lbGVtZW50c1tpXSkgKyB0aGlzLmVsZW1lbnRzW2ldLm5hbWUpOwoJCQkJCQl2ID0gY24uZGF0YWdyaWQoJ2dldERhdGEnKTsKCQkJCQkJdi5zZWxlY3RlZCA9IGNuLmRhdGFncmlkKCJnZXRTZWxlY3RlZCIpOwoJCQkJCQlicmVhazsKCQkJCQljYXNlICJ0cmVlIjoKCQkJCQkJY24gPSAkKCIjIiArIHRoaXMucHJlZml4KHRoaXMuZWxlbWVudHNbaV0pICsgdGhpcy5lbGVtZW50c1tpXS5uYW1lKTsKCQkJCQkJdiA9IGNuLmNvbWJvdHJlZSgidHJlZSIpLnRyZWUoImdldFNlbGVjdGVkIik7CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgIndpbmRvdyI6CgkJCQkJCXYgPSB0aGlzLmVsZW1lbnRzW2ldLnZhbHVlOwoJCQkJCQlicmVhazsKCQkJCQljYXNlICJzZWxlY3QiOgoJCQkJCQlpZiAodGhpcy5lbGVtZW50c1tpXS5vcHRpb25zKSB7CgkJCQkJCQl2ID0gJCgiIyIgKyB0aGlzLnByZWZpeCh0aGlzLmVsZW1lbnRzW2ldKSArIHRoaXMuZWxlbWVudHNbaV0ubmFtZSkuY29tYm9ncmlkKCdnZXRWYWx1ZScgKyAodGhpcy5lbGVtZW50c1tpXS5tdWx0aXBsZSA/ICdzJyA6ICcnKSk7CgkJCQkJCQl2ID0gdGhpcy5zcigpLnJ1blNjcmlwdCh2KTsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCXYgPSAkKCIjIiArIHRoaXMucHJlZml4KHRoaXMuZWxlbWVudHNbaV0pICsgdGhpcy5lbGVtZW50c1tpXS5uYW1lKS5jb21ib2dyaWQoJ2dyaWQnKS5kYXRhZ3JpZCgnZ2V0U2VsZWN0aW9ucycpOwoJCQkJCQkJaWYgKCF2IHx8ICF2Lmxlbmd0aCkgewoJCQkJCQkJCXYgPSAkKCIjIiArIHRoaXMucHJlZml4KHRoaXMuZWxlbWVudHNbaV0pICsgdGhpcy5lbGVtZW50c1tpXS5uYW1lKS5jb21ib2dyaWQoJ2dldFZhbHVlJyArICh0aGlzLmVsZW1lbnRzW2ldLm11bHRpcGxlID8gJ3MnIDogJycpKTsKCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJaWYgKCF0aGlzLmVsZW1lbnRzW2ldLm11bHRpcGxlKSB2ID0gdlswXTsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCQljbiA9ICQoIiMiICsgdGhpcy5wcmVmaXgodGhpcy5lbGVtZW50c1tpXSkgKyB0aGlzLmVsZW1lbnRzW2ldLm5hbWUpOwoJCQkJCQlicmVhazsKCQkJCQljYXNlICJib29sIjoKCQkJCQkJY24gPSAkKCIjIiArIHRoaXMucHJlZml4KHRoaXMuZWxlbWVudHNbaV0pICsgdGhpcy5lbGVtZW50c1tpXS5uYW1lKTsKCQkJCQkJdiA9IGNuLnN3aXRjaGJ1dHRvbignb3B0aW9ucycpLmNoZWNrZWQ7CgkJCQkJCWJyZWFrOwoJCQkJCWRlZmF1bHQ6CgkJCQkJCWJyZWFrOwoJCQkJfQoJCQkJb1t0aGlzLmVsZW1lbnRzW2ldLm5hbWVdKHYpOwoJCQl9IGNhdGNoIChlKSB7CgkJCQkvL2NvbnNvbGUubG9nKHRoaXMuZWxlbWVudHNbaV0ubmFtZSwgZSk7CgkJCQlvW3RoaXMuZWxlbWVudHNbaV0ubmFtZV0gPSB2OwoJCQl9CgkJCWlmIChjbikgewoJCQkJaWYgKG8uRW50aXR5VmFsdWVzKSB7CgkJCQkJZm9yICh2YXIgaiA9IDA7IGogPCBvLkVudGl0eVZhbHVlcy5sZW5ndGg7IGorKykgewoJCQkJCQlpZiAodGhpcy5lbGVtZW50c1tpXS5uYW1lID09IHRoaXMuc1RhYmxlICYmIHRoaXMuZWxlbWVudHNbaV0uZW1zU291cmNlKSBvLklkID0gdGhpcy5lbGVtZW50c1tpXS5lbXNTb3VyY2UuSWQ7CgkJCQkJCWlmIChvLkVudGl0eVZhbHVlc1tqXS5FbnRpdHlBdHRyaWJ1dGUuTmFtZSA9PSB0aGlzLmVsZW1lbnRzW2ldLm5hbWUgJiYgdGhpcy5lbGVtZW50c1tpXS5lbXNTb3VyY2UpIHsKCQkJCQkJCW8uRW50aXR5VmFsdWVzW2pdLklkID0gdGhpcy5lbGVtZW50c1tpXS5lbXNTb3VyY2UuSWQ7CgkJCQkJCX0KCQkJCQl9CgkJCQl9CgkJCX0KCQl9CgkJcmV0dXJuIG87Cgl9CgoJY0hlaWdodChvcHRpb25zKSB7CgkJaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5lZGl0b3IpIHJldHVybiB3aW5kb3cuaW5uZXJIZWlnaHQ7CgkJaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5oZWlnaHQgJiYgdHlwZW9mKG9wdGlvbnMuaGVpZ2h0KSA9PT0gJ3N0cmluZycpIHJldHVybiB0aGlzLmhlaWdodDsKCQlpZiAob3B0aW9ucyAmJiBvcHRpb25zLnR5cGUgPT0gJ3dpbmRvdycgJiYgIW9wdGlvbnMuaGVpZ2h0KSByZXR1cm4gdGhpcy5oZWlnaHQgKiAwLjk7CgkJcmV0dXJuIE1hdGguZmxvb3IoKChvcHRpb25zID8gb3B0aW9ucy5oZWlnaHQgOiBudWxsKSB8fCAodGhpcy5oZWlnaHQgLyAzKSkpOwoJfQoKCXNlYXJjaChvcHRpb25zKSB7CgkJcmV0dXJuIHRoaXMuc3RyaW5nKG9wdGlvbnMpOwoJfQoKCXN0cmluZyhvcHRpb25zKSB7CgkJb3B0aW9ucy5oZWlnaHQgPSAyMDsKCQlvcHRpb25zLnNpbXBsZSA9IHRydWU7CgkJcmV0dXJuIHRoaXMudGV4dChvcHRpb25zKTsKCX0KCglkYXRldGltZShvcHRpb25zKSB7CgkJcmV0dXJuIGA8aW5wdXQgaWQ9ImR0cCR7b3B0aW9ucy5uYW1lfSIgY2xhc3M9ImVhc3l1aS0ke3RoaXMudWlUeXBlc1tvcHRpb25zLnR5cGVdfSIgcmVxdWlyZWQ9IiR7b3B0aW9ucy5yZXF1aXJlZCA/ICd0cnVlJyA6ICdmYWxzZSd9IiB2YWx1ZT0iJHt0aGlzLnZhbHVlKG9wdGlvbnMpfSIgc3R5bGU9IndpZHRoOiR7dGhpcy5jV2lkdGgob3B0aW9ucyl9cHgiPmA7Cgl9CgoJcXVlcnkob3B0aW9ucykgewoJCXJldHVybiAiPGRpdiBpZD0ndnMiICsgb3B0aW9ucy5uYW1lICsgIic+PC9kaXY+IjsKCX0KCglEYXRlVGltZShvcHRpb25zKSB7CgkJcmV0dXJuIHRoaXMuZGF0ZXRpbWUob3B0aW9ucyk7Cgl9CgoJbG9uZyhvcHRpb25zKSB7CgkJcmV0dXJuIHRoaXMuaW50KG9wdGlvbnMpOwoJfQoKCUxvbmcob3B0aW9ucykgewoJCXJldHVybiB0aGlzLmxvbmcob3B0aW9ucyk7Cgl9CgoJdmFsdWUob3B0aW9ucykgewoJCWlmICh0eXBlb2Ygb3B0aW9ucy52YWx1ZSA9PT0gJ2Z1bmN0aW9uJykgewoJCQl0cnkgewoJCQkJcmV0dXJuIG9wdGlvbnMudmFsdWUodGhpcy5nZXQoKSk7CgkJCX0gY2F0Y2ggKGV4KSB7CgkJCQljb25zb2xlLmxvZyhgREZvcm0udmFsdWUoJHtvcHRpb25zLm5hbWV9KTogJHtleH1gKTsKCQkJCXJldHVybiAnJzsKCQkJfQoJCX0gZWxzZSB7CgkJCXN3aXRjaCAob3B0aW9ucy50eXBlKSB7CgkJCQljYXNlICdpbnQnOgoJCQkJY2FzZSAncHJvZ3Jlc3MnOgoJCQkJCXJldHVybiBvcHRpb25zLnZhbHVlIHx8IG9wdGlvbnMubWluIHx8IDA7CgkJCQljYXNlICdzdHJpbmcnOgoJCQkJY2FzZSAndGV4dCc6CgkJCQljYXNlICdkYXRldGltZSc6CgkJCQljYXNlICdsYWJlbCc6CgkJCQkJcmV0dXJuIG9wdGlvbnMudmFsdWUgfHwgIiI7CgkJCQlkZWZhdWx0OgoJCQkJCXJldHVybiBvcHRpb25zLnZhbHVlOwoJCQl9CgkJfQoJfQoKCWludChvcHRpb25zKSB7CgkJbGV0IHJldCA9IGA8aW5wdXQgaWQ9Im51ZCR7b3B0aW9ucy5uYW1lfSIgY2xhc3M9ImVhc3l1aS0ke3RoaXMudWlUeXBlc1tvcHRpb25zLnR5cGVdfSIgcmVxdWlyZWQ9IiR7b3B0aW9ucy5yZXF1aXJlZCA/ICd0cnVlJyA6ICdmYWxzZSd9IiB2YWx1ZT0iJHt0aGlzLnZhbHVlKG9wdGlvbnMpfSIgZGF0YS1vcHRpb25zPSJtaW46JHtvcHRpb25zLm1pbiB8fCAwfSxtYXg6JHtvcHRpb25zLm1heCB8fCAxMDB9LGluY3JlbWVudDoke29wdGlvbnMuaW5jcmVtZW50IHx8IDF9IiBzdHlsZT0id2lkdGg6JHt0aGlzLmNXaWR0aChvcHRpb25zKX1weDsiPjwvaW5wdXQ+YDsKCQkvL2NvbnNvbGUubG9nKHJldCk7CgkJcmV0dXJuIHJldDsKCX0KCgltZW51KG9wdGlvbnMpIHsKCQl2YXIgcmV0ID0gIiI7CgkJcmV0ICs9ICc8ZGl2IGNsYXNzPSJlYXN5dWktcGFuZWwiIGlkPSJtbnUnICsgb3B0aW9ucy5uYW1lICsgJyIgc3R5bGU9InBhZGRpbmc6NXB4OyI+XG4nOwoJCSQuZWFjaChvcHRpb25zLm1lbnUsIChfLCBtKSA9PiByZXQgKz0gYDxhIGhyZWY9IiMiIGNsYXNzPSJlYXN5dWktJHt0aGlzLnVpVHlwZXNbb3B0aW9ucy50eXBlIHx8ICdtZW51J119IiBkYXRhLW9wdGlvbnM9Im1lbnU6JyNtbSR7bS5sYWJlbC5yZXBsYWNlKC8gL2csICcnKX0nLGljb25DbHM6J2ljb24tJHttLmljb24gfHwgJ25vbmUnfSciPiR7bS5sYWJlbH08L2E+XG5gKTsKCQlyZXQgKz0gIjwvZGl2PlxuIjsKCQlsZXQgZHYgPSBtID0+IHsKCQkJbGV0IHJldCA9ICc8ZGl2JyArIChtLnN1Yk1lbnVzID8gJycgOiBgIGRhdGEtb3B0aW9ucz0iaWNvbkNsczonaWNvbi0ke20uaWNvbiB8fCAnbm9uZSd9JyJgKSArICc+XG4nOwoJCQlyZXQgKz0gbS5zdWJNZW51cyA/ICc8c3Bhbj4nICsgKG0ubGFiZWwgfHwgdGhpcy5lbmdsaXNoKG0uY29kZSkpICsgJzwvc3Bhbj5cbjxkaXY+JyA6IChgPHNwYW4gd2lkdGg9JzEwMCUnIG9uY2xpY2s9Jyhhc3luYyAoKSA9PiB7bGV0IG0gPSAke19GckVNRC5fdG9KUyhtKX07IGlmKG0uYWN0aW9uKXtyZXR1cm4gYXdhaXQgbS5hY3Rpb24oREZvcm0uZ2V0KCksIG0pO30gaWYgKG0uc3ViTWVudXMpIHJldHVybjsgYXdhaXQgX0ZyRU1ELlJlbmRlclBhZ2Uoe19jb2RlOiBtLmNvZGUgfHwgbS5sYWJlbC5yZXBsYWNlKC8gL2csICIiKS50b0xvd2VyQ2FzZSgpfSwgbS5kYXRhKTt9KSgpJz4ke20ubGFiZWwgfHwgdGhpcy5lbmdsaXNoKG0uY29kZSl9PC9zcGFuPmApOwoJCQkkLmVhY2gobS5zdWJNZW51cywgKF8sIHMpID0+IHJldCArPSBkdihzKSk7CgkJCXJldCArPSAobS5zdWJNZW51cyA/ICI8L2Rpdj5cbiIgOiAiIikgKyBgPC9kaXY+XG5gOwoJCQlyZXR1cm4gcmV0OwoJCX07CgkJZm9yICh2YXIgaSA9IDA7IGkgPCBvcHRpb25zLm1lbnUubGVuZ3RoOyBpKyspIHsKCQkJdmFyIG0gPSBvcHRpb25zLm1lbnVbaV07CgkJCXJldCArPSAnPGRpdiBpZD0ibW0nICsgbS5sYWJlbC5yZXBsYWNlKC8gL2csICcnKSArICciIHN0eWxlPSJ3aWR0aDoxNTBweDsiPic7CgkJCWZvciAodmFyIGogPSAwOyBqIDwgbS5zdWJNZW51cy5sZW5ndGg7IGorKykgewoJCQkJdmFyIHNtID0gbS5zdWJNZW51c1tqXTsKCQkJCXJldCArPSBkdihzbSk7CgkJCX0KCQkJcmV0ICs9ICc8L2Rpdj5cbic7CgkJfQoJCXJldHVybiByZXQ7Cgl9CgoJaW50ZWdlcihvcHRpb25zKSB7CgkJcmV0dXJuIHRoaXMuaW50KG9wdGlvbnMpOwoJfQoKCW51bWJlcihvcHRpb25zKSB7CgkJcmV0dXJuIHRoaXMuaW50KG9wdGlvbnMpOwoJfQoKCUludGVnZXIob3B0aW9ucykgewoJCXJldHVybiB0aGlzLmludChvcHRpb25zKTsKCX0KCglib29sKG9wdGlvbnMpIHsKCQlyZXR1cm4gYDxpbnB1dCBpZD0iJHt0aGlzLnByZWZpeChvcHRpb25zKX0ke29wdGlvbnMubmFtZX0iIGRhdGEtZGZvcm09ImVsZW1lbnQ6JHtvcHRpb25zLm5hbWV9IiByZXF1aXJlZD0iJHtvcHRpb25zLnJlcXVpcmVkPyd0cnVlJzonZmFsc2UnfSIgZGF0YS1vcHRpb25zPSdkaXNhYmxlZDoke29wdGlvbnMuZGlzYWJsZWQ/J3RydWUnOidmYWxzZSd9LCR7dGhpcy5ldmVudEhhbmRsZXJzKG9wdGlvbnMpfScgY2xhc3M9ImVhc3l1aS0ke3RoaXMudWlUeXBlc1tvcHRpb25zLnR5cGVdfSIgJHtvcHRpb25zLmNoZWNrZWQ/J2NoZWNrZWQnOicnfSAvPmA7Cgl9CgoJbGFiZWwob3B0aW9ucykgewoJCXJldHVybiBgPHNwYW4gaWQ9IiR7dGhpcy5wcmVmaXgob3B0aW9ucyl9JHtvcHRpb25zLm5hbWV9IiBzdHlsZT0id2lkdGg6JHt0aGlzLmNXaWR0aChvcHRpb25zKX1weCIgZGF0YS1vcHRpb25zPSJkaXNhYmxlZDoke29wdGlvbnMuZGlzYWJsZWQ/J3RydWUnOidmYWxzZSd9Ij4ke3RoaXMudmFsdWUob3B0aW9ucyl9PC9zcGFuPmA7Cgl9CgoJdXJsKG9wdGlvbnMpIHsKCQlyZXR1cm4gdGhpcy5zdHJpbmcob3B0aW9ucykucmVwbGFjZSgiRmllbGRDaGFuZ2UiLCAiVVJMQ2hhbmdlIik7Cgl9CgoJdGV4dChvcHRpb25zKSB7CgkJcmV0dXJuIGA8aW5wdXQgaWQ9IiR7dGhpcy5wcmVmaXgob3B0aW9ucyl9JHtvcHRpb25zLm5hbWV9IiBjbGFzcz0iZWFzeXVpLSR7b3B0aW9ucy5lZGl0b3IgfHwgdGhpcy51aVR5cGVzW29wdGlvbnMudHlwZV19IiBkYXRhLW9wdGlvbnM9J2Rpc2FibGVkOiR7b3B0aW9ucy5kaXNhYmxlZD8ndHJ1ZSc6J2ZhbHNlJ30sJHt0aGlzLmV2ZW50SGFuZGxlcnMob3B0aW9ucyl9JyBtdWx0aWxpbmU9IiR7b3B0aW9ucy5zaW1wbGUgPyAnZmFsc2UnIDogJ3RydWUnfSIgc3R5bGU9IndoaXRlLXNwYWNlOnByZS13cmFwO3dpZHRoOiR7dGhpcy5jV2lkdGgob3B0aW9ucyl9cHg7aGVpZ2h0OiR7dGhpcy5jSGVpZ2h0KG9wdGlvbnMpfXB4IiByZXF1aXJlZD0iJHtvcHRpb25zLnJlcXVpcmVkID8gJ3RydWUnIDogJ2ZhbHNlJ30iIHZhbHVlPSIke3RoaXMudmFsdWUob3B0aW9ucyl9IiAvPmA7Cgl9CgoJcGFzc3dvcmQob3B0aW9ucykgewoJCXZhciByZXQgPSB0aGlzLnN0cmluZyhvcHRpb25zKTsKCQlyZXQgPSByZXQucmVwbGFjZSgnPGlucHV0ICcsICc8aW5wdXQgdHlwZT0icGFzc3dvcmQiICcpOwoJCXJldHVybiByZXQ7Cgl9CgoJZmlsZShvcHRpb25zKSB7CgkJcmV0dXJuIGA8aW5wdXQgaWQ9IiR7dGhpcy5wcmVmaXgob3B0aW9ucyl9JHtvcHRpb25zLm5hbWV9IiBjbGFzcz0iZWFzeXVpLSR7dGhpcy51aVR5cGVzW29wdGlvbnMudHlwZV19IiBkYXRhLW9wdGlvbnM9Im9uQ2hhbmdlOmZ1bmN0aW9uKG4sbyl7dmFyIHMgPSAkKCcjJyArIHRoaXMuaWQpLmZpbGVib3goJ29wdGlvbnMnKTsgd2luZG93LkRGb3JtLlVwbG9hZEZpbGUocywgd2luZG93LkRGb3JtLmJ5TmFtZSgnJHtvcHRpb25zLm5hbWV9JykpO30iIHN0eWxlPSJ3aWR0aDoke3RoaXMuY1dpZHRoKG9wdGlvbnMpfXB4Ij5gOwoJfQoKCWltYWdlKG9wdGlvbnMpIHsKCQlyZXR1cm4gdGhpcy5maWxlKG9wdGlvbnMpICsgYDxkaXYgaWQ9ImRsZyR7b3B0aW9ucy5uYW1lfSIgY2xhc3M9ImVhc3l1aS0ke3RoaXMudWlUeXBlc1tvcHRpb25zLnR5cGVdfSIgdGl0bGU9IkltYWdlIFByZXZpZXciIGRhdGEtb3B0aW9ucz0iY2xvc2VkOnRydWUsaWNvbkNsczonaWNvbi1zYXZlJyxyZXNpemFibGU6ZmFsc2UsbW9kYWw6dHJ1ZSIgc3R5bGU9IndpZHRoOjQwMHB4O2hlaWdodDoyMDBweDtwYWRkaW5nOjEwcHgiPjxpbWcgaWQ9IiR7dGhpcy5wcmVmaXgob3B0aW9ucyl9JHtvcHRpb25zLm5hbWV9IiB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIi8+PC9kaXY+YDsKCX0KCglwcm9ncmVzcyhvcHRpb25zKSB7CgkJaWYgKCFvcHRpb25zLmhlaWdodCkgb3B0aW9ucy5oZWlnaHQgPSAyMDsgLy8gZml4IGJpZyBwcm9ncmVzcwoJCXJldHVybiBgPGRpdiBpZD0iJHt0aGlzLnByZWZpeChvcHRpb25zKX0ke29wdGlvbnMubmFtZX0iIGNsYXNzPSJlYXN5dWktJHt0aGlzLnVpVHlwZXNbb3B0aW9ucy50eXBlXX0iIGRhdGEtb3B0aW9ucz0idmFsdWU6JHt0aGlzLnZhbHVlKG9wdGlvbnMpfSIgc3R5bGU9IndpZHRoOiR7dGhpcy5jV2lkdGgob3B0aW9ucyl9cHg7aGVpZ2h0OiR7dGhpcy5jSGVpZ2h0KG9wdGlvbnMpfXB4Ij48L2Rpdj5gOwoJfQoKCWZsb3djaGFydChvcHRpb25zKSB7CgkJcmV0dXJuIGA8ZGl2IGlkPSJmbHcke29wdGlvbnMubmFtZX0iIHdpZHRoPSIke3RoaXMuY1dpZHRoKG9wdGlvbnMpfSIgaGVpZ2h0PSIke3RoaXMuY0hlaWdodChvcHRpb25zKX0iPjwvZGl2PmA7Cgl9CgoJY2hhcnQob3B0aW9ucykgewoJCXJldHVybiBgPGRpdiBpZD0iY2h0JHtvcHRpb25zLm5hbWV9IiB3aWR0aD0iJHt0aGlzLmNXaWR0aChvcHRpb25zKX0iIGhlaWdodD0iJHt0aGlzLmNIZWlnaHQob3B0aW9ucyl9Ij48L2Rpdj5gOwoJfQoKCWZvcm1hdHRlcihuYW1lLCBjLCBqc29uKSB7CgkJanNvbiA9IGpzb24gPyAnIicgOiAnJzsKCQlyZXR1cm4gYCR7anNvbn0odmFsdWUsIHJvdywgaW5kZXgpID0+IHt0cnl7dmFyIGMgPSAoREZvcm0uYnlOYW1lKFxgJHtuYW1lfVxgKS5jb2x1bW5zIHx8IFtdKS5maW5kKGMgPT4gYy5maWVsZD09XGAke2MuZmllbGR9XGApOyByZXR1cm4gYyYmYy5mb3JtYXQ/Yy5mb3JtYXQodmFsdWUscm93LGluZGV4KTp2YWx1ZTt9Y2F0Y2goZXgpe3JldHVybiB2YWx1ZTt9IH0ke2pzb259YDsKCX0KCgltYXBDb2x1bW5zKG9wdGlvbnMsIGpzb24pIHsKCQlsZXQgY1RpdGxlID0gYyA9PiBjLnRpdGxlIHx8IHRoaXMuZW5nbGlzaChjLmZpZWxkKTsKCgkJdmFyIGNvbHMgPSAkLmdyZXAob3B0aW9ucy5jb2x1bW5zIHx8IFtdLCBjID0+ICFjLmlnbm9yZSk7CgkJbGV0IHJldCA9ICIiOwoJCWlmIChvcHRpb25zLm11bHRpcGxlKSByZXQgKz0gYHsiZmllbGQiOidjaycsImNoZWNrYm94Ijp0cnVlfSxgOwoJCXJldCA9IGAiZnJvemVuQ29sdW1ucyI6IFtbYDsKCQlpZiAoIW9wdGlvbnMuZnJvemVuKSB7CgkJCXJldCArPSBgeyJmaWVsZCI6IiR7b3B0aW9ucy5pZEZpZWxkLmZpZWxkfSIsInRpdGxlIjogIiR7b3B0aW9ucy5pZEZpZWxkLnRpdGxlfSIsInNvcnRhYmxlIjogInRydWUiLCAiZm9ybWF0dGVyIjogJHt0aGlzLmZvcm1hdHRlcihvcHRpb25zLm5hbWUsIG9wdGlvbnMuaWRGaWVsZCwganNvbil9fSxgOwoJCQlpZiAob3B0aW9ucy50ZXh0RmllbGQuZmllbGQgIT0gb3B0aW9ucy5pZEZpZWxkLmZpZWxkKSByZXQgKz0gYHsiZmllbGQiOiIke29wdGlvbnMudGV4dEZpZWxkLmZpZWxkIHx8IG9wdGlvbnMudGV4dEZpZWxkLnRpdGxlfSIsInRpdGxlIjoiJHtvcHRpb25zLnRleHRGaWVsZC50aXRsZSB8fCBvcHRpb25zLnRleHRGaWVsZC5maWVsZH0iLCJ3aWR0aCI6IiR7b3B0aW9ucy50ZXh0RmllbGQud2lkdGh8fDEyMH0iLCAic29ydGFibGUiOiAidHJ1ZSIsICJmb3JtYXR0ZXIiOiAke3RoaXMuZm9ybWF0dGVyKG9wdGlvbnMubmFtZSwgb3B0aW9ucy50ZXh0RmllbGQsIGpzb24pfX1gOwoJCX0gZWxzZSB7CgkJCSQubWFwKCQuZ3JlcChjb2xzLCBjID0+IGMuZnJvemVuKSwgYyA9PiBgeyJmaWVsZCI6IiR7Yy5maWVsZCB8fCBjVGl0bGUoYyl9IiwidGl0bGUiOiIke2NUaXRsZShjKSB8fCBjLmZpZWxkfSIsIndpZHRoIjoiJHtjLndpZHRofHwxMjB9IiwiYWxpZ24iOidsZWZ0Jywic29ydGFibGUiOiJ0cnVlIiwgImZvcm1hdHRlciI6ICR7dGhpcy5mb3JtYXR0ZXIob3B0aW9ucy5uYW1lLCBjLCBqc29uKX19YCkuam9pbigiLCIpOwoJCX0KCQlyZXQgKz0gYF1dLCAiY29sdW1ucyI6IFtbYDsKCQlyZXQgKz0gJC5tYXAoJC5ncmVwKGNvbHMsIGMgPT4gIWMuZnJvemVuKSwgYyA9PiBgeyJmaWVsZCI6IiR7Yy5maWVsZCB8fCBjVGl0bGUoYyl9IiwidGl0bGUiOiIke2NUaXRsZShjKSB8fCBjLmZpZWxkfSIsImFsaWduIjoibGVmdCIsInNvcnRhYmxlIjoidHJ1ZSIsICJmb3JtYXR0ZXIiOiAke3RoaXMuZm9ybWF0dGVyKG9wdGlvbnMubmFtZSwgYywganNvbil9fWApLmpvaW4oIiwiKTsKCQlyZXQgKz0gJ11dJzsKCQlyZXR1cm4gcmV0OwoJfQoKCXNlbGVjdChvcHRpb25zLCB0YWcgPSBvcHRpb25zLnRhZywgdHlwZSkgewoJCXJldHVybiB0aGlzLmNvbWJvKG9wdGlvbnMsIHRhZywgdHlwZSk7Cgl9CgoJdHJlZShvcHRpb25zKSB7CgkJcmV0dXJuIHRoaXMuc2VsZWN0KG9wdGlvbnMsICJzZWxlY3QiKTsKCX0KCgluYXZpZ2F0aW9uKG9wdGlvbnMpIHsKCQlyZXR1cm4gdGhpcy5jb21ibyhvcHRpb25zLCAndWwnLCAndHJlZScpOwoJfQoKCWNvbWJvKG9wdGlvbnMsIHRhZywgdHlwZSkgewoJCXZhciBjb2xzID0gJC5ncmVwKG9wdGlvbnMuY29sdW1ucyB8fCBbXSwgYyA9PiAhYy5pZ25vcmUpOwoJCXRhZyA9IHRhZyB8fCAic2VsZWN0IjsKCQlvcHRpb25zLmlkRmllbGQgPSAkLnVuaXF1ZVNvcnQoW3sKCQkJZmllbGQ6IG9wdGlvbnMuaWRGaWVsZCwKCQkJdGl0bGU6IG9wdGlvbnMuaWRGaWVsZAoJCX1dLmNvbmNhdCgkLmdyZXAoY29scywgYyA9PiBjLnByaW1hcnkpLCBbewoJCQlmaWVsZDogJ0lkJywKCQkJdGl0bGU6ICdJRCcKCQl9XSkpLmZpbmQoeCA9PiB0eXBlb2YoeC5maWVsZCkgIT09ICJ1bmRlZmluZWQiKTsKCQlvcHRpb25zLnRleHRGaWVsZCA9ICQudW5pcXVlU29ydChbewoJCQlmaWVsZDogb3B0aW9ucy50ZXh0RmllbGQsCgkJCXRpdGxlOiBvcHRpb25zLnRleHRGaWVsZAoJCX1dLmNvbmNhdCgkLmdyZXAoY29scywgYyA9PiBjLmRpc3BsYXkpLCBbewoJCQlmaWVsZDogY29tcGFueS5saWJyYXJ5ID8gJ19Ub1N0cmluZycgOiAnX25hbWUnLAoJCQl0aXRsZTogb3B0aW9ucy5uYW1lLAoJCX1dKSkuZmluZCh4ID0+IHR5cGVvZih4LmZpZWxkKSAhPT0gInVuZGVmaW5lZCIpOwoJCXZhciBmdW4gPSB0eXBlIHx8IHRoaXMuZUZ1bihvcHRpb25zKTsKCQl2YXIgZHJvcGRvd24gPSBbJ2NvbWJvdHJlZWdyaWQnLCAnY29tYm90cmVlJywgJ2NvbWJvZ3JpZCcsICdzZWxlY3QnXS5pbmRleE9mKGZ1bikgPiAtMTsKCQlpZiAoZHJvcGRvd24pIHRoaXMuc2VsZWN0cy5wdXNoKHsKCQkJaWQ6ICJjbWIiICsgb3B0aW9ucy5uYW1lLAoJCQlvcHRpb25zOiB0aGlzLmJ5TmFtZShvcHRpb25zLm5hbWUpCgkJfSk7CgkJdGhpcy5zZWxlY3RzID0gJC51bmlxdWVTb3J0KHRoaXMuc2VsZWN0cyk7CgkJdmFyIHJldCA9IGA8JHt0YWd9IGlkPSJjbWIke29wdGlvbnMubmFtZX0iIGNsYXNzPSJlYXN5dWktJHtmdW59IiBzdHlsZT0ibWF4LXdpZHRoOiR7ZHJvcGRvd24/JzQwMHB4Jzp0aGlzLmNXaWR0aChvcHRpb25zKX07IHdpZHRoOiR7dGhpcy5jV2lkdGgob3B0aW9ucyl9cHgiIHJlcXVpcmVkPSIkeyhvcHRpb25zLnJlcXVpcmVkID8gJ3RydWUnIDogJ2ZhbHNlJyl9IiBkYXRhLW9wdGlvbnM9J2Rpc2FibGVkOiR7b3B0aW9ucy5kaXNhYmxlZD8ndHJ1ZSc6J2ZhbHNlJ30sJHt0aGlzLmV2ZW50SGFuZGxlcnMob3B0aW9ucyl9LCB2YWx1ZToiJHt0aGlzLnZhbHVlKG9wdGlvbnMpfSIsIHJvd251bWJlcnM6JHt0eXBlb2Yob3B0aW9ucy5yb3dOdW1iZXJzKSE9PSd1bmRlZmluZWQnP29wdGlvbnMucm93TnVtYmVyczooZnVuLmluZGV4T2YoJ3RyZWUnKTwtMT8nZmFsc2UnOid0cnVlJyl9LCBwYWdpbmF0aW9uOiR7dHlwZW9mKG9wdGlvbnMucGFnaW5hdGlvbikhPT0ndW5kZWZpbmVkJz9vcHRpb25zLnBhZ2luYXRpb246KGZ1bi5pbmRleE9mKCd0cmVlJyk8LTE/J2ZhbHNlJzondHJ1ZScpfSwgcGFuZWxXaWR0aDokezIqdGhpcy5jV2lkdGgob3B0aW9ucyl9LCBmaXRDb2x1bW5zOiB0cnVlLCBzaW5nbGVTZWxlY3Q6IHRydWUsIG11bHRpcGxlOiR7KG9wdGlvbnMubXVsdGlwbGUgfHwgJ2ZhbHNlJyl9LCBpZEZpZWxkOiAiJHtvcHRpb25zLmlkRmllbGQuZmllbGR9IiwgZW5hYmxlRmlsdGVyOiAke29wdGlvbnMuZmlsdGVyPyd0cnVlJzonZmFsc2UnfSwgbm93cmFwOiBmYWxzZSwgdGV4dEZpZWxkOiAiJHtvcHRpb25zLnRleHRGaWVsZC5maWVsZH0iLCB0cmVlRmllbGQ6ICIke29wdGlvbnMudGV4dEZpZWxkLmZpZWxkfSIsYDsKCQlpZiAoZnVuLmluZGV4T2YoJ3RyZWUnKSA9PSAtMSkgewoJCQlyZXQgKz0gJ2ZpdENvbHVtbnM6IGZhbHNlLCcgKyB0aGlzLm1hcENvbHVtbnMob3B0aW9ucyk7CgkJfQoJCWlmIChvcHRpb25zLmRhdGEpIHsKCQkJcmV0ICs9IGAsZGF0YTogJHtKU09OLnN0cmluZ2lmeShvcHRpb25zLmRhdGEpfWA7CgkJfQoJCXJldCArPSBgJz5gOwoJCWlmIChvcHRpb25zLm9wdGlvbnMpIHsKCQkJcmV0ICs9ICQubWFwKG9wdGlvbnMub3B0aW9ucywgbyA9PiBgPG9wdGlvbiB2YWx1ZT0nJHtfRnJFTUQuX3RvSlMobyl9Jz4ke28ubmFtZSB8fCBvfTwvb3B0aW9uPmApLmpvaW4oJ1xuJyk7CgkJfQoJCXJldCArPSBgPC8ke3RhZ30+YDsKCQkvLyBjb25zb2xlLmxvZyhyZXQpOwoJCXJldHVybiByZXQ7Cgl9CgoJZ3JpZChvcHRpb25zLCB0YWcsIHR5cGUpIHsKCQlyZXR1cm4gdGhpcy5jb21ibyhvcHRpb25zLCAidGFibGUiLCAiZGF0YWdyaWQiKTsKCX0KCgl0cmVlZ3JpZChvcHRpb25zKSB7CgkJcmV0dXJuIHRoaXMuY29tYm8ob3B0aW9ucywgJ3RhYmxlJywgJ3RyZWUnKTsKCX0KCglhc3luYyBkb0xpbmsoZSwgZXZlbnQpIHsKCQl0aGlzLmJ1c3kodHJ1ZSk7CgkJdHJ5IHsKCQkJYXdhaXQgZS5saW5rcy5maW5kKGwgPT4gbC5sYWJlbCA9PSBldmVudC50YXJnZXQuaW5uZXJUZXh0KS5vbkNsaWNrKHRoaXMuZ2V0KCkpOwoJCX0gY2F0Y2ggKGV4KSB7CgkJCWNvbnNvbGUubG9nKCJkb0xpbmsiLCBleCk7CgkJfQoJCXRoaXMuYnVzeShmYWxzZSk7Cgl9CgoJRWRpdGVkVmFsdWUoZSkgewoJCXJldHVybiAodHlwZW9mKGFjZSkgIT09ICJ1bmRlZmluZWQiKSA/IGFjZS5lZGl0KCdwbmwnICsgZS5uYW1lKS5zZXNzaW9uLmdldFZhbHVlKCkgOiAnJzsKCX0KCglhc3luYyBQYW5PbkNsb3NlKGUpIHsKCQlpZiAoZS5lZGl0b3IpIHsKCQkJZS52YWx1ZSA9IHRoaXMuRWRpdGVkVmFsdWUoZSk7CgkJfQoJCWlmIChlLmNsb3NlKSB7CgkJCWF3YWl0IGUuY2xvc2UodGhpcy5nZXQoKSk7CgkJfQoJfQoKCWFzeW5jIFBlbmRBZnRlck9wZW4oZSkgewoJCWlmIChlLmVkaXRvciAmJiB0eXBlb2YoYWNlKSAhPT0gInVuZGVmaW5lZCIpIHsKCQkJYXdhaXQgX0ZyRU1ELk9wZW5FZGl0b3IoJ3BubCcgKyBlLm5hbWUgLyorICctY2VudGVyJyovICwgZS5sYW5ndWFnZSwgZS5sb2FkZXIgfHwgKG8gPT4gZS52YWx1ZSksIGUuc2F2ZXIsIHRoaXMuZ2V0KCksIGUpOwoJCX0KCQlpZiAoZS5vcGVuKSB7CgkJCWF3YWl0IGUub3Blbih0aGlzLmdldCgpKTsKCQl9Cgl9CgoJbGluayhvcHRpb25zKSB7CgkJcmV0dXJuIChvcHRpb25zLmxpbmtzIHx8IFtdKS5maWx0ZXIobCA9PiAhbC5pZ25vcmUpLm1hcChsID0+IGA8YSBocmVmPSIjIiBjbGFzcz0iZWFzeXVpLSR7dGhpcy51aVR5cGVzW29wdGlvbnMudHlwZV19IiBkYXRhLW9wdGlvbnM9JyR7dGhpcy5ldmVudEhhbmRsZXJzKG9wdGlvbnMpfSwgaWNvbkNsczoiaWNvbi0ke2wuaWNvbiB8fCAnb2snfSInPiR7bC5sYWJlbH08L2E+YCkuam9pbignXG4nKTsKCX0KCglhc3luYyBTZXRUcmVlRGF0YShlLCBuLCBkYXRhKSB7CgkJJC5lYWNoKCQoIiNjbWIiICsgZS5uYW1lKVt0aGlzLmVGdW4oZSldKCd0cmVlJykudHJlZSgiZ2V0Q2hpbGRyZW4iLCBuLnRhcmdldCksIChfLCBjKSA9PiAkKCIjY21iIiArIGUubmFtZSlbdGhpcy5lRnVuKGUpXSgndHJlZScpLnRyZWUoInJlbW92ZSIsIGMudGFyZ2V0KSk7CgkJJCgiI2NtYiIgKyBlLm5hbWUpW3RoaXMuZUZ1bihlKV0oJ3RyZWUnKS50cmVlKCJhcHBlbmQiLCB7CgkJCXBhcmVudDogbi50YXJnZXQsCgkJCWRhdGE6IGRhdGEKCQl9KTsKCQlyZXR1cm4gdHJ1ZTsKCX0KCglhc3luYyBFeHBhbmQoZSwgbikgewoJCXRoaXMuU2V0VHJlZURhdGEoZSwgbiwgW3sKCQkJaWQ6IG51bGwsCgkJCXRleHQ6ICJsb2FkaW5nLi4uIgoJCX1dKTsKCQl2YXIgb2JqID0ge307CgkJdmFyIHBGaWVsZCA9IGUucGFyZW50RmllbGQgfHwgJC5tYXAoJC5ncmVwKGUuY29sdW1ucyB8fCBbXSwgYyA9PiBjLnBhcmVudCksIGMgPT4gYy5maWVsZCkuY29uY2F0KFtudWxsXSlbMF07CgkJdmFyIGlkRmllbGQgPSAkLmdyZXAoZS5jb2x1bW5zIHx8IFtdLCBjID0+IGMucHJpbWFyeSkuY29uY2F0KGUuaWRGaWVsZClbMF0uZmllbGQ7CgkJaWYgKHBGaWVsZCkgewoJCQlvYmpbcEZpZWxkXSA9IHsKCQkJCV9zb3VyY2U6IG4uX3NvdXJjZQoJCQl9OwoJCQlpZiAoaWRGaWVsZCkgewoJCQkJb2JqW3BGaWVsZF1baWRGaWVsZF0gPSBuLmlkOwoJCQl9IGVsc2UgewoJCQkJb2JqW3BGaWVsZF0gPSBuLmlkOwoJCQl9CgkJfQoJCWxldCBkYXRhID0gYXdhaXQgdGhpcy5fbG9hZERhdGEoewoJCQlpZDogImNtYiIgKyBlLm5hbWUsCgkJCW9wdGlvbnM6IGUKCQl9LCBvYmopOwoJCXRoaXMuU2V0VHJlZURhdGEoZSwgbiwgZGF0YSk7Cgl9CgoJYXN5bmMgX2xvYWREYXRhKHMsIG8sIHN0YXJ0LCBlbmQpIHsKCQl2YXIgbmFtZSA9IChzICYmIHMub3B0aW9ucyA/IChzLm9wdGlvbnMuQ2xhc3MgPyBzLm9wdGlvbnMuQ2xhc3MuTmFtZS5yZXBsYWNlKCcgJywgJ18nKSA6IChzLm9wdGlvbnMudGFibGUgfHwgcy5vcHRpb25zLm5hbWUpKSA6IHMubmFtZSk7CgoJCWxldCBvU2NvcGUgPSBjb21wYW55LlNjb3BlID8gd2luZG93W2NvbXBhbnkuU2NvcGVdIDogd2luZG93OwoJCW8gPSBvIHx8IChvU2NvcGVbbmFtZV0gPyBuZXcgb1Njb3BlW25hbWVdKCkgOiB7CgkJCUFjdGl2ZTogdHJ1ZSwKCQl9KTsKCQlvID0gKHR5cGVvZiBmaWx0ZXJzICE9PSAidW5kZWZpbmVkIiAmJiBmaWx0ZXJzICYmIGZpbHRlcnNbbmFtZV0pID8gZmlsdGVyc1tuYW1lXShvKSA6IG87CgkJbyA9IChzICYmIHMub3B0aW9ucyAmJiBzLm9wdGlvbnMuc291cmNlID8gcy5vcHRpb25zLnNvdXJjZShvLCB0aGlzLmdldCgpKSA6IG8pOwoJCWxldCBuYW1lcyA9ICQudW5pcXVlU29ydChbcy5vcHRpb25zLnNlYXJjaEZpZWxkXS5jb25jYXQoJC5tYXAoJC5ncmVwKHMub3B0aW9ucy5jb2x1bW5zIHx8IFtdLCBjID0+IGMuc2VhcmNoKSwgYyA9PiBjLmZpZWxkKSwgWyJOYW1lIl0pKTsKCQl2YXIgZnVuID0gdGhpcy5lRnVuKHMub3B0aW9ucyk7CgkJaWYgKCFvW25hbWVzWzBdXSkgb1tuYW1lc1swXV0gPSAkKCIjIiArIHMuaWQpW2Z1bl0oJ2dldFRleHQnKTsKCQl2YXIgZGF0YSA9IG51bGw7CgkJaWYgKHMub3B0aW9ucy5sb2FkZXIpIHsKCQkJZGF0YSA9IGF3YWl0IHMub3B0aW9ucy5sb2FkZXIodGhpcy5nZXQoKSwgcy5vcHRpb25zLCBvKTsKCQl9IGVsc2UgaWYgKGNvbXBhbnkubGlicmFyeSkgewoJCQlsZXQgbGliID0gJyc7CgkJCWlmIChuYW1lLmluZGV4T2YoJy4nKSA+IDApIHsKCQkJCWxpYiA9IG5hbWUuc3BsaXQoJy4nKVswXSArICcuJzsKCQkJCW5hbWUgPSBuYW1lLnNwbGl0KCcuJylbMV07CgkJCX0KCgkJCWRhdGEgPSBhd2FpdCB0aGlzLnNyKCkuXyhsaWIgKyBjb21wYW55LkNvZGUudG9Mb3dlckNhc2UoKSArIG5hbWUgKyAiRmluZGFsbCIsIG51bGwsIG8sIG51bGwsIHN0YXJ0LCBlbmQpOwoJCX0gZWxzZSB7CgkJCS8vIGVtcwoJCQlkYXRhID0gYXdhaXQgby5maW5kQWxsKCk7CgkJCS8vZGF0YSA9IGF3YWl0IHdpbmRvdy5fRnJFTUQuX28obnVsbCwgbyk7CgkJfQoJCWlmIChzLm9wdGlvbnMucG9zdGxvYWQpIHsKCQkJYXdhaXQgcy5vcHRpb25zLnBvc3Rsb2FkKGRhdGEpOwoJCX0KCQkkLmVhY2goZGF0YSwgKGksIGQpID0+IHsKCQkJZC5fX09XTkVSID0gczsKCQkJJC5lYWNoKHMub3B0aW9ucy5jb2x1bW5zLCAoXywgYykgPT4gewoJCQkJaWYgKGMudmFsdWUpIHsKCQkJCQlkW2MuZmllbGRdID0gYy52YWx1ZShkLCBkYXRhLCBpKTsKCQkJCX0KCQkJfSk7CgkJfSk7CgkJaWYgKCFzLm9wdGlvbnMuY29sdW1ucyAmJiBmdW4uaW5kZXhPZigndHJlZScpID4gLTEpIHsKCQkJZGF0YSA9ICQubWFwKGRhdGEsIGQgPT4gewoJCQkJbGV0IHJldCA9IHsKCQkJCQlpZDogZFtzLm9wdGlvbnMuaWRGaWVsZC5maWVsZF0sCgkJCQkJdGV4dDogZFtzLm9wdGlvbnMudGV4dEZpZWxkLmZpZWxkXSwKCQkJCQlzdGF0ZTogZC5zdGF0ZSB8fCAocy5vcHRpb25zLmxvYWRlciA/ICJmaWxlIiA6ICJjbG9zZWQiKSwKCQkJCQlfc291cmNlOiBkLAoJCQkJfTsKCQkJCXJldC5jaGlsZHJlbiA9IChyZXQuc3RhdGUgPT0gImNsb3NlZCIpID8gW3sKCQkJCQl0ZXh0OiAnbG9hZGluZy4uLicKCQkJCX1dIDogbnVsbDsKCQkJCXJldHVybiByZXQ7CgkJCX0pOwoJCX0KCQlyZXR1cm4gZGF0YSB8fCBbXTsKCX0KCglhc3luYyBmaWxsRGF0YShnLCBvLCBzdGFydCwgZW5kKSB7CgkJdmFyIHMgPSBudWxsOwoJCWZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5zZWxlY3RzLmxlbmd0aDsgaSsrKSB7CgkJCWlmICh0aGlzLnNlbGVjdHNbaV0uaWQgPT0gZ1swXS5pZCkgcyA9IHRoaXMuc2VsZWN0c1tpXTsKCQl9CgkJaWYgKCFzKSByZXR1cm47CgkJdGhpcy5idXN5KHRydWUpOwoJCXRyeSB7CgkJCXZhciBmdW4gPSBnWzBdLmNsYXNzTGlzdFsiMCJdLnJlcGxhY2UoJ2Vhc3l1aS0nLCAnJyk7CgkJCXRyeSB7CgkJCQkkKCIjIiArIHMuaWQpW2Z1bl0oJ2dyaWQnKS5kYXRhZ3JpZCgnZ2V0UGFnZXInKS5wYWdpbmF0aW9uKCdsb2FkaW5nJyk7CgkJCX0gY2F0Y2ggKGV4KSB7fQoJCQlpZiAocy5vcHRpb25zLm5vbG9hZCkgewoJCQkJbGV0IF9kYXRhID0gbnVsbDsKCQkJCXRyeSB7CgkJCQkJX2RhdGEgPSAkKCIjIiArIHMuaWQpW2Z1bl0oJ2dyaWQnKS5kYXRhZ3JpZCgiZ2V0RGF0YSIpOwoJCQkJfSBjYXRjaCAoZXgpIHsKCQkJCQlfZGF0YSA9ICQoIiMiICsgcy5pZClbZnVuXSgndHJlZScpLnRyZWUoJ2dldFJvb3QnKTsKCQkJCX0KCQkJCWlmIChfZGF0YSkgewoJCQkJCXJldHVybiB0aGlzLmJ1c3koZmFsc2UpOwoJCQkJfQoJCQl9CgkJCXZhciBkYXRhID0gYXdhaXQgdGhpcy5fbG9hZERhdGEocywgbywgc3RhcnQsIGVuZCk7CgkJCXRyeSB7CgkJCQlpZiAoJCgiIyIgKyBzLmlkKVtmdW5dKCdncmlkJykpICQoIiMiICsgcy5pZClbZnVuXSgnZ3JpZCcpLmRhdGFncmlkKCdnZXRQYWdlcicpLnBhZ2luYXRpb24oJ2xvYWRlZCcpOwoJCQl9IGNhdGNoIChleCkge30KCQkJdHJ5IHsKCQkJCSQoIiMiICsgcy5pZClbZnVuXSgnZ3JpZCcpLmRhdGFncmlkKCdsb2FkRGF0YScsIHsKCQkJCQl0b3RhbDogZGF0YS5Db3VudCB8fCBkYXRhLmxlbmd0aCwKCQkJCQlyb3dzOiBkYXRhLAoJCQkJfSk7CgkJCX0gY2F0Y2ggKGV4KSB7CgkJCQkkKCIjIiArIHMuaWQpW2Z1bl0oJ3RyZWUnKS50cmVlKCdsb2FkRGF0YScsIGRhdGEpOwoJCQl9CgkJfSBjYXRjaCAoZXgpIHsKCQkJY29uc29sZS5sb2coZXgpOwoJCX0KCQl0aGlzLmJ1c3koZmFsc2UpOwoJfQoKCWV2ZW50SGFuZGxlcnMob3B0aW9ucykgewoJCWlmICghdGhpcy5ieU5hbWUob3B0aW9ucy5uYW1lKSkgcmV0dXJuOyAvLyBpZiBub3QgYW4gZWxlbWVudCwgZG8gbm90IHJ1biB0aGUgaGFuZGxlcnMKCgkJcmV0dXJuIHRoaXMuZXZlbnRzLmZpbHRlcihlID0+IGUudHlwZSA9PSBvcHRpb25zLnR5cGUgfHwgdHlwZW9mKGUudHlwZSkgPT09ICd1bmRlZmluZWQnKS5tYXAoZSA9PiBgJHtlLm5hbWV9OiAoJHtlLnBhcmFtcyB8fCAnJ30pID0+IHt0cnl7REZvcm0uJHtlLmhhbmRsZXJ9KERGb3JtLmJ5TmFtZSgiJHtvcHRpb25zLm5hbWV9IikgfHwgJHtfRnJFTUQuX3RvSlMob3B0aW9ucyl9IHx8IHtuYW1lOiAiJHtvcHRpb25zLm5hbWV9Iix0eXBlOiAiJHtvcHRpb25zLnR5cGV9In0sICR7ZS5wYXJhbXN9KX1jYXRjaChleCl7Y29uc29sZS5sb2coIkV2ZW50IEVycm9yOiAke29wdGlvbnMubmFtZX0vJHtvcHRpb25zLnR5cGV9LyR7ZS5uYW1lfSIsIGV4KTt9fWApLmpvaW4oJywnKTsKCX0KCglhc3luYyBQYW5lbE9wZW4oZSkgewoJCWlmIChlLmVkaXRvcikgcmV0dXJuIHRydWU7CgkJbGV0IGNvbnRlbnQgPSBlLnZhbHVlOwoJCWlmIChlLmxvYWRlcikgewoJCQljb250ZW50ID0gYXdhaXQgZS5sb2FkZXIodGhpcy5nZXQoKSk7CgkJfQoJCWlmIChjb250ZW50KSB7CgkJCXRyeSB7CgkJCQkkKCIjcG5sIiArIGUubmFtZSkucGFuZWwoJ2JvZHknKS5odG1sKGNvbnRlbnQpOwoJCQkJY29uc29sZS5sb2coInBubCIgKyBlLm5hbWUgKyAiOiBDb250ZW50IFZhbGlkIik7CgkJCX0gY2F0Y2ggKGV4KSB7CgkJCQkvL2NvbnNvbGUubG9nKGV4KTsKCQkJfQoJCX0KCQlyZXR1cm4gY29udGVudDsKCX0KCglhc3luYyBTZWxlY3RDaGFuZ2Uob3B0aW9ucywgdGFiKSB7CgkJdGhpcy5idXN5KHRydWUpOwoJCSQuZ3JlcCh0aGlzLmVsZW1lbnRzLCBlID0+IGUudHlwZSA9PSAiZ3JpZCIgJiYgZS5ncm91cCA9PSB0YWIpLmZvckVhY2goZSA9PiAkKCIjY21iIiArIGUubmFtZSkuZGF0YWdyaWQoKSk7CgkJdGhpcy5idXN5KGZhbHNlKTsKCX0KCglhc3luYyBGaWVsZENoYW5nZShvcHRpb25zLCB2YWx1ZSkgewoJCXRoaXMuYnVzeSh0cnVlKTsKCQlpZiAob3B0aW9ucyAmJiBvcHRpb25zLmNoYW5nZSkgewoJCQlhd2FpdCBvcHRpb25zLmNoYW5nZSh0aGlzLmdldCgpLCB2YWx1ZSk7CgkJfQoJCXRoaXMuYnVzeShmYWxzZSk7Cgl9CgoJYXN5bmMgVVJMQ2hhbmdlKHMsIG9wdGlvbnMpIHsKCQl0aGlzLmJ1c3kodHJ1ZSk7CgkJb3B0aW9ucy5kYXRhID0gYXdhaXQgJC5nZXQocy52YWx1ZSk7CgkJcmV0dXJuIGF3YWl0IHRoaXMuRmllbGRDaGFuZ2Uocywgb3B0aW9ucyk7Cgl9CgoJVXBsb2FkRmlsZShmLCBvcHRpb25zKSB7CgkJd2luZG93LkRGb3JtLmJ1c3kodHJ1ZSk7CgkJdmFyIGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKCk7CgkJdmFyIGZpbGVpZCA9IE1hdGgucmFuZG9tKCk7CgkJdmFyIG1ldGhvZCA9IG9wdGlvbnMubWV0aG9kIHx8ICJDb250ZW50TWFuYWdlci5jbXNVcGxvYWRGaWxlIjsKCQlmb3JtRGF0YS5hcHBlbmQoJ2ZpbGVpZCcsIGZpbGVpZCk7CgkJdmFyIGZpbGUgPSAkKCIjIiArIGYuZmlsZWJveElkKVswXS5maWxlc1swXTsKCQlmb3JtRGF0YS5hcHBlbmQoJ19fVUZJTEUnLCBmaWxlKTsKCQlpZiAob3B0aW9ucy5sb2NhbCkgewoJCQkvLyBoYW5kbGluZyB0aGUgZmlsZSBsb2NhbGx5CgkJCXZhciByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpOwoJCQlyZWFkZXIub25sb2FkID0gKGUpID0+IHsKCQkJCXZhciBkYXRhID0gZS50YXJnZXQucmVzdWx0OwoJCQkJcmV0ID0gZGF0YTsKCQkJCXdpbmRvdy5ERm9ybS5ieU5hbWUob3B0aW9ucy5uYW1lKS5kYXRhID0gcmV0OwoJCQkJaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy51cGxvYWQpIG9wdGlvbnMudXBsb2FkKHdpbmRvdy5ERm9ybS5nZXQoKSwgcmV0KTsKCQkJfTsKCQkJaWYgKG9wdGlvbnMuYmluYXJ5KSB7CgkJCQlyZWFkZXIucmVhZEFzQmluYXJ5U3RyaW5nKGZpbGUpOwoJCQl9IGVsc2UgaWYgKG9wdGlvbnMuZGF0YXVybCkgewoJCQkJcmVhZGVyLnJlYWRBc0RhdGFVUkwoZmlsZSk7CgkJCX0gZWxzZSB7CgkJCQlyZWFkZXIucmVhZEFzVGV4dChmaWxlKTsKCQkJfQoJCQl3aW5kb3cuREZvcm0uYnVzeShmYWxzZSk7CgkJfSBlbHNlIGlmIChtZXRob2QpIHsKCQkJJC5hamF4KHsKCQkJCXVybDogdGhpcy5zcigpLnNyVVJMICsgIiZtZXRob2Q9IiArIG1ldGhvZCArICImc0lucHV0PSIgKyBmaWxlaWQgKyAiJnByZVRhZz0mcG9zdFRhZz0iLAoJCQkJZGF0YTogZm9ybURhdGEsCgkJCQkvLyBUSElTIE1VU1QgQkUgRE9ORSBGT1IgRklMRSBVUExPQURJTkcKCQkJCWNhY2hlOiBmYWxzZSwKCQkJCWNvbnRlbnRUeXBlOiBmYWxzZSwKCQkJCXR5cGU6ICdQT1NUJywKCQkJCXByb2Nlc3NEYXRhOiBmYWxzZSwKCQkJCXN1Y2Nlc3M6IGRhdGEgPT4gewoJCQkJCXRoaXMuc3IoKS5ydW5TY3JpcHQoZGF0YSk7CgkJCQkJd2luZG93LkRGb3JtLmJ5TmFtZShvcHRpb25zLm5hbWUpLmRhdGEgPSByZXQ7CgkJCQkJaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy51cGxvYWQpIG9wdGlvbnMudXBsb2FkKHdpbmRvdy5ERm9ybS5nZXQoKSwgcmV0KTsKCQkJCQl3aW5kb3cuREZvcm0uYnVzeShmYWxzZSk7CgkJCQl9CgkJCX0pOwoJCX0KCX0KCgllRnVuKGUpIHsKCQl0cnkgewoJCQlpZiAoZS50eXBlID09ICJ0cmVlIikgewoJCQkJaWYgKGUuY29sdW1ucykgewoJCQkJCXJldHVybiAiY29tYm90cmVlZ3JpZCI7CgkJCQl9IGVsc2UgaWYgKHR5cGVvZihlLmNvbWJvKSAhPT0gJ3VuZGVmaW5lZCcgJiYgIWUuY29tYm8pIHsKCQkJCQlyZXR1cm4gJ3RyZWUnOwoJCQkJfSBlbHNlIHsKCQkJCQlyZXR1cm4gImNvbWJvdHJlZSI7CgkJCQl9CgkJCX0gZWxzZSBpZiAoZS50eXBlID09ICduYXZpZ2F0aW9uJykgewoJCQkJcmV0dXJuICd0cmVlJzsKCQkJfSBlbHNlIGlmIChlLnR5cGUgPT0gImNvbWJvdHJlZSIpIHsKCQkJCXJldHVybiAiY29tYm90cmVlZ3JpZCI7CgkJCX0gZWxzZSBpZiAoZS50eXBlID09ICJzZWxlY3QiICYmIGUub3B0aW9ucykgewoJCQkJcmV0dXJuICJjb21ib2JveCI7CgkJCX0KCQkJcmV0dXJuICJjb21ib2dyaWQiOwoJCX0gY2F0Y2ggKGV4KSB7CgkJCXJldHVybiAiY29tYm9ncmlkIjsKCQl9Cgl9CgoJX2ZpbGxXaW5kb3cod2luTmFtZSwgdiwgbWFwKSB7CgkJdiA9IHYgfHwge307CgkJbWFwID0gbWFwIHx8IHt9OwoJCWlmIChBcnJheS5pc0FycmF5KG1hcCkpIHsKCQkJbWFwID0gT2JqZWN0LmZyb21FbnRyaWVzKG5ldyBNYXAobWFwKSk7CgkJfQoKCQltYXAgPSAkLmV4dGVuZCh7fSwgbWFwLCBPYmplY3QuZnJvbUVudHJpZXMoT2JqZWN0LmtleXModikubWFwKGsgPT4gW3dpbk5hbWUgKyBrLCBrXSkpKTsKCgkJbGV0IHMgPSB7fTsKCQlmb3IgKHZhciBtIGluIG1hcCkgewoJCQlpZiAodHlwZW9mKHZbbWFwW21dXSkgPT09ICJ1bmRlZmluZWQiKSB7CgkJCQkvL2NvbnNvbGUubG9nKCdpc191bmRlZmluZWQnLCBtLCBtYXBbbV0sIHZbbWFwW21dXSk7CgkJCQlzW21dID0gbWFwW21dOwoJCQl9IGVsc2UgewoJCQkJLy9jb25zb2xlLmxvZygnaXNfbm90X3VuZGVmaW5lZCcsIG0sIG1hcFttXSwgdlttYXBbbV1dKTsKCQkJCXNbbV0gPSB2W21hcFttXV07CgkJCX0KCQl9CgkJdGhpcy5jbGVhcih3aW5OYW1lKTsKCQkvL2NvbnNvbGUubG9nKCJzIiwgcyk7CgkJdGhpcy5zZXQocyk7CgkJJCgiI3BubF8iICsgd2luTmFtZSkud2luZG93KCJvcGVuIik7Cgl9CgoJd2luZG93VG9FbnRpdHkobywgYkVtcHR5LCBncmlkLCBwcmVmaXgsIGZpbHRlcikgewoJCW8gPSBvIHx8IHRoaXMuZ2V0KCk7CgkJZmlsdGVyID0gZmlsdGVyIHx8ICh2ID0+IHYpOwoJCWxldCByZXQgPSBncmlkID8gKGdyaWQuc2VsZWN0ZWQgfHwgZ3JpZCkgOiBudWxsOwoJCWlmIChiRW1wdHkpIHsKCQkJcmV0ID0ge307CgkJCW8gPSB7fTsKCQl9IGVsc2UgewoJCQlyZXQgPSAocmV0ICYmIHJldC5JZCkgPyB7CgkJCQlJZDogcmV0LklkCgkJCX0gOiB7fTsKCQl9CgoJCXRoaXMuZWxlbWVudHMuZmlsdGVyKGUgPT4gKHByZWZpeCA/IGUuZ3JvdXAgPT0gcHJlZml4IDogdHJ1ZSkgJiYgZS50eXBlICE9ICdsaW5rJyAmJiBbJ18nXS5pbmRleE9mKGUubmFtZS5yZXBsYWNlKHByZWZpeCwgIiIpKSA8IDApLmZvckVhY2goZSA9PiB7CgkJCXJldFtlLm5hbWUucmVwbGFjZShwcmVmaXgsICIiKV0gPSBvW2UubmFtZV07CgkJCXJldHVybiB0cnVlOwoJCX0pOwoKCQlmaWx0ZXIocmV0KTsKCgkJcmV0dXJuIHJldDsKCX0KCgliaW5kKG9iaikgewoJCXZhciBvYmpCaW5kID0gKG8sIGUpID0+IHsKCQkJb1t0aGlzLmVGdW4oZSldKHsKCQkJCW9uU2hvd1BhbmVsOiAoKSA9PiB7CgkJCQkJdGhpcy5maWxsRGF0YSgkKCIjIiArIGUuaWQpLCBudWxsLCAwLCAxMCk7CgkJCQl9LAoJCQkJb25DbGlja1JvdzogKGluZGV4LCByb3cpID0+IHsKCQkJCQl2YXIgcyA9IHJvdyA/IHJvdy5fX09XTkVSIDogbnVsbDsKCQkJCQlpZiAocyAmJiBzLm9wdGlvbnMuc2VsZWN0KSB7CgkJCQkJCXMub3B0aW9ucy5zZWxlY3Qocm93KTsKCQkJCQl9CgkJCQl9CgkJCX0pOwoJCQl0cnkgewoJCQkJdmFyIGRnID0gb1t0aGlzLmVGdW4oZSldKCdncmlkJyk7CgkJCQkvLyBkZy5kYXRhZ3JpZCgnZW5hYmxlRmlsdGVyJykKCQkJCXZhciBzdGF0ZSA9IGRnLmRhdGEoJ2RhdGFncmlkJyk7CgkJCQl2YXIgb3B0cyA9IHN0YXRlLm9wdGlvbnM7CgkJCQl2YXIgb25CZWZvcmVMb2FkID0gb3B0cy5vbkJlZm9yZUxvYWQ7CgkJCQlvcHRzLm9uQmVmb3JlTG9hZCA9IChwYXJhbSkgPT4gewoJCQkJCXN0YXRlLmFsbFJvd3MgPSBudWxsOwoJCQkJCXJldHVybiBvbkJlZm9yZUxvYWQuY2FsbCh0aGlzLCBwYXJhbSk7CgkJCQl9OwoJCQkJdmFyIHBhZ2VyID0gZGcuZGF0YWdyaWQoJ2dldFBhZ2VyJyk7CgkJCQlkZy5kYXRhZ3JpZCgnZ2V0UGFuZWwnKS5wYW5lbCh7CgkJCQkJSUQ6IGkKCQkJCX0pOwoJCQkJcGFnZXIucGFnaW5hdGlvbih7CgkJCQkJb25TZWxlY3RQYWdlOiBmdW5jdGlvbihwYWdlTnVtLCBwYWdlU2l6ZSkgewoJCQkJCQl3aW5kb3cuREZvcm0uZmlsbERhdGEoJCgiIyIgKyB3aW5kb3cuREZvcm0uc2VsZWN0c1skKHRoaXMucGFyZW50Tm9kZSkucGFuZWwoJ29wdGlvbnMnKS5JRF0uaWQpLCBudWxsLCBwYWdlU2l6ZSAqIChwYWdlTnVtIC0gMSksIHBhZ2VTaXplICogcGFnZU51bSk7CgkJCQkJfQoJCQkJfSk7CgkJCQlkZy5kYXRhZ3JpZCgnbG9hZERhdGEnLCBzdGF0ZS5kYXRhKTsKCQkJfSBjYXRjaCAoZXgpIHt9CgkJfQoJCWlmIChvYmopIHsKCQkJb2JqQmluZChvYmopOwoJCX0gZWxzZSB7CgkJCWZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5zZWxlY3RzLmxlbmd0aDsgaSsrKSB7CgkJCQlpZiAodGhpcy5zZWxlY3RzW2ldLm9wdGlvbnMub3B0aW9ucykgewoJCQkJCS8vJCgiIyIgKyB0aGlzLnNlbGVjdHNbaV0uaWQpLmNvbWJvKCk7CgkJCQl9IGVsc2UgewoJCQkJCW9iakJpbmQoJCgiIyIgKyB0aGlzLnNlbGVjdHNbaV0uaWQpLCB0aGlzLnNlbGVjdHNbaV0pOwoJCQkJfQoJCQl9CgoJCQl0aGlzLmVsZW1lbnRzLmZpbHRlcihlID0+IGUud2luZG93KS5mb3JFYWNoKGUgPT4gewoJCQkJbGV0IHQgPSAkKCIjdGJjV2luZG93IikudGFicygiZ2V0VGFiIiwgZS5ncm91cCk7CgkJCQlpZiAodCkgewoJCQkJCXQucGFuZWwoJ29wdGlvbnMnKS50YWIuaGlkZSgpOwoJCQkJfQoJCQl9KTsKCQl9Cgl9CgoJZW5nbGlzaChzKSB7CgkJaWYgKCFzKSByZXR1cm4gIiI7CgkJdmFyIHJlc3VsdCA9IHMucmVwbGFjZSgvKFtBLVpdKS9nLCAiICQxIik7CgkJcmVzdWx0ID0gcmVzdWx0LnJlcGxhY2UoL18vZywgJycpOwoJCXJldHVybiByZXN1bHQuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyByZXN1bHQuc2xpY2UoMSk7Cgl9CgoJb25Ub2dnbGUoZSwgYlZhbHVlKSB7CgkJbGV0IHNUYWcgPSBgI2ZFbGVtZW50XyR7ZS5mb3IubmFtZX0gPiAuZWFzeXVpLSR7dGhpcy51aVR5cGVzW2UuZm9yLnR5cGVdfWA7CgkJbGV0IG9UYWcgPSAkKHNUYWcpOwoJCWUuZm9yLmVuYWJsZWQgPSB0eXBlb2YoYlZhbHVlKSA9PT0gInVuZGVmaW5lZCIgPyAhZS5mb3IuZW5hYmxlZCA6IGJWYWx1ZTsKCgkJb1RhZy5wcm9wKCJkaXNhYmxlZCIsICFlLmZvci5lbmFibGVkKTsKCQkvL29UYWdbdGhpcy51aVR5cGVzW2UuZm9yLnR5cGVdXShlLmZvci5lbmFibGVkID8gImVuYWJsZSIgOiAiZGlzYWJsZSIpOwoJCWNvbnNvbGUubG9nKHNUYWcsIG9UYWcsIHRoaXMudWlUeXBlc1tlLmZvci50eXBlXSwgZS5mb3IuZW5hYmxlZCk7Cgl9CgoJcmVuZGVyKG5hbWUsIHRpdGxlLCBlbGVtZW50cywgYnV0dG9ucywgYkZpeGVkKSB7CgkJdGhpcy5lbGVtZW50cyA9IChlbGVtZW50cyB8fCBbXSkuZmlsdGVyKGUgPT4gIWUuaWdub3JlKTsKCgkJdGhpcy5idXR0b25zID0gYnV0dG9ucyB8fCBbXTsKCQl0aGlzLnNlbGVjdHMgPSBbXTsKCQl0aGlzLmdyaWRzID0gW107CgoJCXRoaXMuZWxlbWVudHMuZmlsdGVyKGUgPT4gZS50eXBlID09ICJ3aW5kb3ciKS5mb3JFYWNoKHcgPT4gdGhpcy5lbGVtZW50cy5zcGxpY2UodGhpcy5lbGVtZW50cy5maW5kSW5kZXgoZSA9PiBlLm5hbWUgPT0gdy5uYW1lKSwgMCwgewoJCQluYW1lOiAiXyIgKyB3Lm5hbWUsCgkJCXR5cGU6ICJsaW5rIiwKCQkJdGl0bGU6IHcudGl0bGUgfHwgdy5uYW1lLAoJCQlncm91cDogdy5ncm91cCwKCQkJd2luZG93OiB3LndpbmRvdywKCQkJc2VjdGlvbjogdy5zZWN0aW9uLAoJCQlsaW5rczogW3sKCQkJCWxhYmVsOiAnT3BlbicsCgkJCQlpY29uOiAnZWRpdCcsCgkJCQlvbkNsaWNrOiBvID0+ICQoIiNwbmwiICsgdy5uYW1lKS53aW5kb3coJ29wZW4nKQoJCQl9XSwKCQl9KSk7CgoJCXRoaXMuc3IoKS5ncm91cEJ5KHRoaXMuZWxlbWVudHMuZmlsdGVyKGUgPT4gZS53aW5kb3cpLCAiZ3JvdXAiKS5mb3JFYWNoKGt2ID0+IHsKCQkJaWYgKCFrdi5rZXkpIHJldHVybjsKCgkJCWxldCBlID0gewoJCQkJbmFtZTogIl8iICsga3Yua2V5LAoJCQkJdGl0bGU6IGt2LmtleSwKCQkJCXR5cGU6ICJ3aW5kb3ciLAoJCQkJZ3JvdXA6IGt2LmtleSwKCQkJCXdpZHRoOiB0aGlzLndpZHRoICogMC45LAoJCQkJaGVpZ2h0OiB0aGlzLmhlaWdodCAqIDAuOSwKCQkJCWxvYWRlcjogbyA9PiB7CgkJCQkJa3YudmFsdWVzLmZpbHRlcih2ID0+IHYudHlwZSAhPT0gJ2xpbmsnIHx8ICh2LnR5cGUgPT0gJ2xpbmsnICYmIHYubmFtZS5zdGFydHNXaXRoKCdfJykpKS5mb3JFYWNoKHYgPT4gJCgiI3BubF8iICsgdi5ncm91cCArICctY2VudGVyJykuYXBwZW5kKCQoIiNmRWxlbWVudF8iICsgdi5uYW1lKSkpOwoJCQkJCXJldHVybiBudWxsOwoJCQkJfSwKCQkJCWJ1dHRvbnM6IFtdLmNvbmNhdC5hcHBseShbXSwga3YudmFsdWVzLmZpbHRlcih2ID0+IHYudHlwZSA9PSAnbGluaycgJiYgIXYubmFtZS5zdGFydHNXaXRoKCdfJykpLm1hcCh2ID0+IFsuLi52LmxpbmtzLm1hcChsID0+ICh7CgkJCQkJbmFtZTogbC5uYW1lIHx8IGwubGFiZWwsCgkJCQkJdGl0bGU6IGwudGl0bGUgfHwgbC5sYWJlbCwKCQkJCQlvbkNsaWNrOiBsLm9uQ2xpY2ssCgkJCQkJaWNvbjogbC5pY29uLAoJCQkJCXdpbmRvdzogdHJ1ZSwKCQkJCQlncm91cDoga3Yua2V5LAoJCQkJfSkpXSkpLAoJCQl9OwoJCQl0aGlzLmJ1dHRvbnMucHVzaCguLi5lLmJ1dHRvbnMpOwoKCQkJdGhpcy5lbGVtZW50cy5wdXNoKGUpOwoJCX0pOwoKCQl2YXIgcmV0ID0gIiI7CgkJLy8gY2hlY2sgdGhlIG9wdGlvbiBvZiB1c2luZyB3aW5kb3coKSBhcyBhIHJlbmRlcmVyIG9mIHRoZSBtYWluIHdpbmRvdy4uLgoJCWlmICh0cnVlKSB7CgkJCXRoaXMuZWxlbWVudHMuZmlsdGVyKGUgPT4gIWUuem9uZSkuZm9yRWFjaChlID0+IGUuem9uZSA9ICdjZW50ZXInKTsKCQkJbGV0IHdPcHRpb25zID0gewoJCQkJbmFtZTogbmFtZSB8fCB0aGlzLm5hbWUsCgkJCQl0aXRsZTogdGl0bGUgfHwgdGhpcy50aXRsZSwKCQkJCXR5cGU6ICd3aW5kb3cnLAoJCQkJdmlzaWJsZTogdHJ1ZSwKCQkJCXdpZHRoOiB0aGlzLndpZHRoLAoJCQkJaGVpZ2h0OiB0aGlzLmhlaWdodCwKCQkJCWZpeGVkOiBiRml4ZWQsCgkJCQlsaW5rczogW3sKCQkJCQlpY29uOiAiaGVscCIsCgkJCQkJYWN0aW9uOiBvID0+ICQoIiNwbmxfX0NvbnNvbGUiKS53aW5kb3coJ29wZW4nKQoJCQkJfV0sCgkJCQlidXR0b25zOiB0aGlzLmJ1dHRvbnMuZmlsdGVyKGIgPT4gIWIud2luZG93KSwKCQkJfTsKCQkJdGhpcy5zcigpLmdyb3VwQnkodGhpcy5lbGVtZW50cywgJ3pvbmUnKS5maWx0ZXIoemcgPT4gemcua2V5KS5mb3JFYWNoKHpnID0+IHsKCQkJCXdPcHRpb25zW3pnLmtleV0gPSB0aGlzLnJlbmRlckVsZW1lbnRzKHpnLnZhbHVlcyk7CgkJCX0pOwoKCQkJcmV0ID0gdGhpcy53aW5kb3cod09wdGlvbnMpOwoJCX0gZWxzZSB7CgkJCXJldCA9IHRoaXMuaGVhZGVyKG5hbWUsIHRpdGxlLCBiRml4ZWQsIFt7CgkJCQlpY29uOiAiaGVscCIsCgkJCQlhY3Rpb246IG8gPT4gJCgiI3BubF9fQ29uc29sZSIpLndpbmRvdygnb3BlbicpCgkJCX1dKTsKCgkJCXJldCArPSB0aGlzLnJlbmRlckVsZW1lbnRzKCk7CgoJCQlyZXQgKz0gdGhpcy5mb290ZXIoYkZpeGVkKTsKCgkJfQoJCS8vIGNvbnNvbGUubG9nKHJldCk7CgoJCXJldHVybiByZXQ7Cgl9CgoJY1dpZHRoKG9wdGlvbnMpIHsKCQlsZXQgcmV0ID0gTWF0aC5mbG9vcigoKG9wdGlvbnMgPyBvcHRpb25zLndpZHRoIDogbnVsbCkgfHwgKHRoaXMud2lkdGggLyAzKSkpOwoJCWlmIChvcHRpb25zLnpvbmUgPT0gJ2Vhc3QnIHx8IG9wdGlvbnMuem9uZSA9PSAnd2VzdCcpIHsKCQkJcmV0ID0gMC4yNSAqIHJldDsgLy8gOTAlIG9mIDMvMTAsIHRoZSB3aWR0aCBvZiB0aGUgbm9ybWFsIGVsZW1lbnQKCQl9IGVsc2UgaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5lZGl0b3IpIHsKCQkJcmV0ID0gd2luZG93LmlubmVyV2lkdGg7CgkJfSBlbHNlIGlmIChvcHRpb25zICYmIG9wdGlvbnMud2lkdGggJiYgdHlwZW9mKG9wdGlvbnMud2lkdGgpID09PSAnc3RyaW5nJykgewoJCQlyZXQgPSB0aGlzLndpZHRoOwoJCX0gZWxzZSBpZiAob3B0aW9ucyAmJiBvcHRpb25zLnR5cGUgPT0gJ3dpbmRvdycgJiYgIW9wdGlvbnMud2lkdGgpIHsKCQkJcmV0ID0gdGhpcy53aWR0aCAqIDAuOTsKCQl9CgoJCS8vIGNvbnNvbGUubG9nKG9wdGlvbnMubmFtZSArICI6IGNXaWR0aCA9ICIgKyByZXQsIG9wdGlvbnMuem9uZSk7CgkJcmV0dXJuIHJldDsKCX0KCgl3aW5kb3cob3B0aW9ucykgewoJCW9wdGlvbnMudGl0bGUgPSBvcHRpb25zLnRpdGxlIHx8IG9wdGlvbnMubmFtZTsKCQl2YXIgcmV0ID0gYAoJCTxkaXYgaWQgPSAicG5sJHtvcHRpb25zLm5hbWV9IiBjbGFzcz0iZWFzeXVpLXdpbmRvdyIgdGl0bGU9IiR7b3B0aW9ucy50aXRsZX0iIGRhdGEtb3B0aW9ucz0nJHt0aGlzLmV2ZW50SGFuZGxlcnMob3B0aW9ucyl9LCBjbG9zZWQ6JHshb3B0aW9ucy52aXNpYmxlfSxtaW5pbWl6YWJsZTokeyFvcHRpb25zLmZpeGVkfSxtYXhpbWl6YWJsZTokeyFvcHRpb25zLmZpeGVkfSxjbG9zYWJsZTokeyFvcHRpb25zLmZpeGVkfSxjb2xsYXBzaWJsZTokeyFvcHRpb25zLmZpeGVkfSxkcmFnZ2FibGU6JHshb3B0aW9ucy5maXhlZH0scmVzaXphYmxlOiR7IW9wdGlvbnMuZml4ZWR9LGljb25DbHM6Imljb24tJHtvcHRpb25zLmljb259IiwgdG9vbHM6IiMke29wdGlvbnMubmFtZX1fdG9vbHMiJyBzdHlsZT0id2lkdGg6JHt0aGlzLmNXaWR0aChvcHRpb25zKX1weDtoZWlnaHQ6JHt0aGlzLmNIZWlnaHQob3B0aW9ucyl9cHg7cGFkZGluZzoxMHB4OyI+CgkJICAgIDxkaXYgY2xhc3M9ImVhc3l1aS1sYXlvdXQiIGRhdGEtb3B0aW9ucz0iZml0OnRydWUiPgoJCWA7CgoJCWxldCBiWm9uZSA9IG9wdGlvbnMuc291dGggPyAnc291dGgnIDogKHRoaXMuem9uZXMuZmluZCh6ID0+IHogPT0gJ3NvdXRoJykgfHwgdGhpcy56b25lc1swXSk7CgkJb3B0aW9uc1tiWm9uZV0gPSBvcHRpb25zW2Jab25lXSB8fCBbXTsKCQlsZXQgeldpZHRoID0gTWF0aC5taW4oMTIwLCB0aGlzLndpZHRoICogMC45NSAvIChvcHRpb25zLmJ1dHRvbnMgPyBvcHRpb25zLmJ1dHRvbnMubGVuZ3RoIDogMSksIHRoaXMuY1dpZHRoKG9wdGlvbnMpKTsKCQlvcHRpb25zW2Jab25lXS5wdXNoKGA8ZGl2IGlkPSJwbmwke29wdGlvbnMubmFtZX0tYnV0dG9ucyIgZGF0YS1vcHRpb25zPSJyZWdpb246JyR7YlpvbmV9Jyxib3JkZXI6ZmFsc2UiIHN0eWxlPSJ0ZXh0LWFsaWduOnJpZ2h0O3BhZGRpbmc6NXB4IDAgMDsiPmAgKyAkLm1hcCgkLmdyZXAob3B0aW9ucy5idXR0b25zIHx8IFtdLCBiID0+ICFiLmlnbm9yZSksIGIgPT4gYDxhIGlkPScke2IubmFtZX0nIGhyZWY9ImphdmFzY3JpcHQ6dm9pZCgwKSIgY2xhc3M9ImVhc3l1aS1saW5rYnV0dG9uIGM2IiBpY29uQ2xzPSJpY29uLSR7Yi5pY29uIHx8ICdzYXZlJ30iIHN0eWxlPSJ3aWR0aDoke3pXaWR0aH1weCIgb25jbGljaz0nd2luZG93LkRGb3JtLmRvQ2xpY2soJHtfRnJFTUQuX3RvSlMoYil9KSc+JHtiLnRpdGxlIHx8IGIubmFtZX08L2E+Jm5ic3A7Jm5ic3A7YCkuam9pbignJykgKyBgPC9kaXY+YCk7CgoJCXRoaXMuem9uZXMuZmlsdGVyKHogPT4gb3B0aW9uc1t6XSkuZm9yRWFjaCh6ID0+IHsKCQkJcmV0ICs9IGAKCQkgICAgICAgIDxkaXYgZGF0YS1vcHRpb25zPSJyZWdpb246JyR7en0nIiB0aXRsZT0iJHsoej09J3dlc3QnIHx8IHo9PSdlYXN0Jyk/JyZuYnNwOyc6Jyd9IiBzdHlsZT0naGVpZ2h0OiR7KHo9PSdub3J0aCd8fHo9PSdzb3V0aCcpPzEwOjEwMH0lO3dpZHRoOiR7KCh6PT0nZWFzdCd8fHo9PSd3ZXN0Jyk/MC4xOjEpKnRoaXMuY1dpZHRoKG9wdGlvbnMpfXB4Jz4KICAgICAgICAJCSAgICAkeyhBcnJheS5pc0FycmF5KG9wdGlvbnNbel0pP29wdGlvbnNbel06W29wdGlvbnNbel1dKS5qb2luKCcnKX0KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICBgOwoJCX0pOwoKCQlyZXQgKz0gYDwvZGl2PjwvZGl2PmA7CgoJCS8vIGxpbmtzICh0b29scykKCQlsZXQgbGlua3MgPSAkLmdyZXAoW10uY29uY2F0KG9wdGlvbnMubGlua3MgfHwgW10pLCBsID0+ICFsLmlnbm9yZSk7CgkJcmV0ICs9IGA8ZGl2IGlkPSIke29wdGlvbnMubmFtZX1fdG9vbHMiPmAgKyAkLm1hcChsaW5rcy5yZXZlcnNlKCksIGwgPT4gYDxhIGhyZWY9ImphdmFzY3JpcHQ6dm9pZCgwKSIgc3R5bGU9ImNvbG9yOmJsYWNrIiBjbGFzcz0iZmFzIGZhLSR7bC5pY29uIHx8ICdhZGQnfSIgb25jbGljaz0nKGFzeW5jICgpID0+IHt2YXIgYSA9ICR7X0ZyRU1ELl90b0pTKGwpfTsgJCgiI3BubCR7b3B0aW9ucy5uYW1lfSIpLndpbmRvdygic2V0VGl0bGUiLCAiJHtvcHRpb25zLnRpdGxlfTogIiArIGEubmFtZSk7IGF3YWl0IGEuYWN0aW9uKERGb3JtLmdldCgpLCBhLCAke19GckVNRC5fdG9KUyhvcHRpb25zKX0pOyAkKCIjcG5sJHtvcHRpb25zLm5hbWV9Iikud2luZG93KCJzZXRUaXRsZSIsICIke29wdGlvbnMudGl0bGV9Iik7fSkoKSc+PC9hPmApLmpvaW4oJ1xuJykgKyBgPC9kaXY+YDsKCgkJcmV0dXJuIHJldDsKCX0KCglhc3luYyBfZW5kKCkgewoJCWxldCBvID0gdGhpcy5nZXQoKTsKCgkJLy8gZG8gbm90IHVzZSB0aGUgZmlyc3QgYnV0dG9uLCBiZWNhdXNlIG1hbnkgZm9ybXMgaGF2ZSBhIENhbmNlbCBidXR0b24gb25seQoJCWxldCBidXR0b24gPSB0aGlzLmJ1dHRvbnMuZmluZChiID0+IGIuYXV0b1N1Ym1pdCkgLyogfHwgdGhpcy5idXR0b25zWzBdKi8gOwoJCWlmIChidXR0b24gJiYgbyAmJiBPYmplY3QudmFsdWVzKG8pLmxlbmd0aCAmJiAodHlwZW9mKGJ1dHRvbi5hdXRvU3VibWl0KSA9PT0gInVuZGVmaW5lZCIgfHwgYnV0dG9uLmF1dG9TdWJtaXQpKSB7CgkJCWxldCB2ID0gT2JqZWN0LnZhbHVlcyhvKS5yZWR1Y2UoKHQsIHYpID0+IHsKCQkJCXJldHVybiAoKHR5cGVvZih2KSAhPT0gIm9iamVjdCIpID8gMSA6IDApICogKHYgPyAxIDogMCk7CgkJCX0pOwoJCQkvL2NvbnNvbGUubG9nKG8sIE9iamVjdC52YWx1ZXMobyksIHYpOwoJCQlpZiAodikgewoJCQkJLy8gYWxsIGZpZWxkcyBoYXZlIHZhbHVlcwoJCQkJYXdhaXQgdGhpcy5kb0NsaWNrKGJ1dHRvbik7CgoJCQl9CgkJfQoJfQoKCWZvb3RlcihiRml4ZWQpIHsKCQlyZXR1cm4gYDwvZm9ybT5gICsgYDxkaXYgaWQ9ImRsZy1idXR0b25zIj5gICsgdGhpcy5idXR0b25zLmZpbHRlcihiID0+ICFiLndpbmRvdykubWFwKGIgPT4gYDxhIGlkPScke2IubmFtZX0nIGhyZWY9ImphdmFzY3JpcHQ6dm9pZCgwKSIgY2xhc3M9ImVhc3l1aS1saW5rYnV0dG9uIGM2IiBpY29uQ2xzPSJpY29uLSR7Yi5pY29uIHx8ICdzYXZlJ30iIHN0eWxlPSJ3aWR0aDoke01hdGgubWluKDEyMCwgdGhpcy53aWR0aCAqIDAuOTUgLyB0aGlzLmJ1dHRvbnMubGVuZ3RoLCB0aGlzLmNXaWR0aCgpKX1weCIgb25jbGljaz0nd2luZG93LkRGb3JtLmRvQ2xpY2soJHtfRnJFTUQuX3RvSlMoYil9KSc+JHtiLnRpdGxlIHx8IGIubmFtZX08L2E+Jm5ic3A7Jm5ic3A7YCkuam9pbignJykgKyAiPC9kaXY+IiArIChiRml4ZWQgPyAiIiA6ICc8L2Rpdj4nKTsKCX0KCgloZWFkZXIobmFtZSwgdGl0bGUsIGJGaXhlZCwgbGlua3MpIHsKCQl0aGlzLnRpdGxlID0gdGl0bGUgfHwgdGhpcy50aXRsZTsKCQluYW1lID0gbmFtZSB8fCB0aGlzLm5hbWU7CgkJdmFyIHJldCA9ICcnOwoKCQlyZXQgKz0gdGhpcy53aW5kb3coewoJCQluYW1lOiAiX19Db25zb2xlIiwKCQkJdHlwZTogIndpbmRvdyIsCgkJCWVkaXRvcjogdHJ1ZSwKCQkJbG9hZGVyOiBvID0+IHdpbmRvdy5sb2dzLnNsaWNlKCkucmV2ZXJzZSgpLm1hcChsID0+IGwuZGF0ZS50b0lTT1N0cmluZygpICsgIjogIiArIGwuYXJncy5tYXAocyA9PiB0eXBlb2YocykgPT09ICdvYmplY3QnID8gKChvYmosIGluZGVudCA9IDIpID0+IHsKCQkJCWxldCBjYWNoZSA9IFtdOwoJCQkJY29uc3QgcmV0VmFsID0gSlNPTi5zdHJpbmdpZnkoCgkJCQkJb2JqLAoJCQkJCShrZXksIHZhbHVlKSA9PgoJCQkJCXR5cGVvZiB2YWx1ZSA9PT0gIm9iamVjdCIgJiYgdmFsdWUgIT09IG51bGwgPwoJCQkJCWNhY2hlLmluY2x1ZGVzKHZhbHVlKSA/CgkJCQkJdW5kZWZpbmVkIC8vIER1cGxpY2F0ZSByZWZlcmVuY2UgZm91bmQsIGRpc2NhcmQga2V5CgkJCQkJOgoJCQkJCWNhY2hlLnB1c2godmFsdWUpICYmIHZhbHVlIC8vIFN0b3JlIHZhbHVlIGluIG91ciBjb2xsZWN0aW9uCgkJCQkJOgoJCQkJCXZhbHVlLAoJCQkJCWluZGVudAoJCQkJKTsKCQkJCWNhY2hlID0gbnVsbDsKCQkJCXJldHVybiByZXRWYWw7CgkJCX0pKHMpIDogcykuam9pbignLCAnKSkuam9pbignXG4nKSwKCQl9KTsKCgkJaWYgKCFiRml4ZWQpIHsKCQkJbGlua3MgPSAobGlua3MgfHwgW10pLmZpbHRlcihsID0+ICFsLmlnbm9yZSk7CgkJCWxldCB0RGF0YSA9ICIiOwoJCQlpZiAobGlua3MubGVuZ3RoKSB7CgkJCQlyZXQgKz0gYDxkaXYgaWQ9IiR7dGhpcy5uYW1lfV90b29scyI+YCArIGxpbmtzLm1hcChsID0+IGA8YSBocmVmPSJqYXZhc2NyaXB0OnZvaWQoMCkiIGNsYXNzPSJpY29uLSR7bC5pY29ufSIgb25jbGljaz0nKGFzeW5jICgpID0+IHt2YXIgYSA9ICR7X0ZyRU1ELl90b0pTKGwpfTsgJCgiI3dpbiR7dGhpcy5uYW1lfSIpLndpbmRvdygic2V0VGl0bGUiLCAiJHt0aGlzLnRpdGxlfTogIiArIGEubmFtZSk7IGF3YWl0IGEuYWN0aW9uKERGb3JtLmdldCgpKTsgJCgiI3dpbiR7dGhpcy5uYW1lfSIpLndpbmRvdygic2V0VGl0bGUiLCAiJHt0aGlzLnRpdGxlfSIpO30pKCknPjwvYT5gKS5qb2luKCdcbicpICsgIjwvZGl2PiI7CgkJCQl0RGF0YSA9IGAsdG9vbHM6IiMke3RoaXMubmFtZX1fdG9vbHMiYDsKCQkJfQoJCQlyZXQgKz0gYDxkaXYgaWQ9J3dpbiR7dGhpcy5uYW1lfScgY2xhc3M9J2Vhc3l1aS13aW5kb3cnIHRpdGxlPScke3RoaXMudGl0bGV9JyBkYXRhLW9wdGlvbnM9J2ljb25DbHM6Imljb24tc2F2ZSIgJHt0RGF0YX0nIHN0eWxlPSd3aWR0aDoke3RoaXMud2lkdGh9cHg7aGVpZ2h0OiR7dGhpcy5oZWlnaHR9cHg7cGFkZGluZzoxMHB4Oyc+YDsKCQl9CgkJcmV0dXJuIHJldCArIGA8Zm9ybSBpZD0iZnJtJHt0aGlzLm5hbWV9IiBtZXRob2Q9InBvc3QiIG5vdmFsaWRhdGU+YDsKCX0KCglyZW5kZXJFbGVtZW50cyhlbGVtZW50cykgewoJCWVsZW1lbnRzID0gZWxlbWVudHMgfHwgdGhpcy5lbGVtZW50czsKCgkJdmFyIHRXaWR0aCA9IE1hdGguZmxvb3IodGhpcy53aWR0aCAqIDAuOTUpOwoJCXZhciB0SGVpZ2h0ID0gTWF0aC5mbG9vcih0aGlzLmhlaWdodCAqIDAuODUpOwoKCQlsZXQgcmV0ID0gJyc7CgkJdmFyIGdFbGVtZW50cyA9IHRoaXMuc3IoKS5ncm91cEJ5KGVsZW1lbnRzLCAiZ3JvdXAiKTsKCQlpZiAoZ0VsZW1lbnRzLmxlbmd0aCA+IDEpIHJldCArPSBgPGRpdiBpZD0idGJjV2luZG93IiBjbGFzcz0iZWFzeXVpLXRhYnMiIGRhdGEtb3B0aW9ucz0nJHt0aGlzLmV2ZW50SGFuZGxlcnMoe3R5cGU6ICd0YWJzJ30pfScgc3R5bGU9IndpZHRoOiR7dFdpZHRofXB4O2hlaWdodDoke3RIZWlnaHR9cHg7Ij5gOwoJCWZvciAodmFyIGcgPSAwOyBnIDwgZ0VsZW1lbnRzLmxlbmd0aDsgZysrKSB7CgkJCWlmIChnRWxlbWVudHMubGVuZ3RoID4gMSkgcmV0ICs9ICc8ZGl2IHRpdGxlPSInICsgKGdFbGVtZW50c1tnXS5rZXkgfHwgIk1haW4iKSArICciIHN0eWxlPSJwYWRkaW5nOjIwcHg7ZGlzcGxheTpub25lOyI+JzsKCQkJdmFyIHNFbGVtZW50cyA9IHRoaXMuc3IoKS5ncm91cEJ5KGdFbGVtZW50c1tnXS52YWx1ZXMsICJzZWN0aW9uIik7CgkJCWlmIChzRWxlbWVudHMubGVuZ3RoID4gMSkgcmV0ICs9ICc8ZGl2IGNsYXNzPSJlYXN5dWktYWNjb3JkaW9uIiBzdHlsZT0id2lkdGg6JyArIHRXaWR0aCArICdweDtoZWlnaHQ6JyArIC8qdEhlaWdodCovICIxMDAlIiArICdweDsiPic7CgkJCWZvciAodmFyIHMgPSAwOyBzIDwgc0VsZW1lbnRzLmxlbmd0aDsgcysrKSB7CgkJCQlyZXQgKz0gYDxkaXYgdGl0bGU9IiR7c0VsZW1lbnRzW3NdLmtleSB8fCAiIn0iIGRhdGEtb3B0aW9ucz0iaWNvbkNsczonaWNvbi1tb3JlJyIgc3R5bGU9InBhZGRpbmc6MTBweDsiPmA7CgkJCQlmb3IgKHZhciBpID0gMDsgaSA8IHNFbGVtZW50c1tzXS52YWx1ZXMubGVuZ3RoOyBpKyspIHsKCQkJCQl2YXIgZSA9IHNFbGVtZW50c1tzXS52YWx1ZXNbaV07CgkJCQkJaWYgKGUuaWdub3JlKSBjb250aW51ZTsKCQkJCQllLnZhbHVlID0gZS52YWx1ZSB8fCAodGhpcy5zcigpLiRfUkVRVUVTVCA/IHRoaXMuc3IoKS4kX1JFUVVFU1QoZS5uYW1lKSA6IG51bGwpOwoJCQkJCXJldCArPSBgPGRpdiBpZD0iZkVsZW1lbnRfJHtlLm5hbWV9IiBjbGFzcz0iZml0ZW0iIHN0eWxlPSJkaXNwbGF5OiAkeyhlLnR5cGU9PSd3aW5kb3cnIHx8IGUuaGlkZGVuKT8nbm9uZSc6Jyd9Ij5gOwoJCQkJCWlmIChlLnRvZ2dsZSkgewoJCQkJCQlyZXQgKz0gYDxhIGhyZWY9IiMiIGNsYXNzPSJlYXN5dWktbGlua2J1dHRvbiIgZGF0YS1vcHRpb25zPScke3RoaXMuZXZlbnRIYW5kbGVycyh7dHlwZTogJ3RvZ2dsZScsIGZvcjogZX0pfSxwbGFpbjp0cnVlLGljb25DbHM6Imljb24tJHtlLmljb24gfHwgJ3NlYXJjaCd9Iicgc3R5bGU9IndpZHRoOjEwMHB4O2hlaWdodDozMHB4Ij4ke2UudGl0bGUgfHwgdGhpcy5lbmdsaXNoKGUubmFtZSl9PC9hPmA7CgkJCQkJfSBlbHNlIHsKCQkJCQkJcmV0ICs9IGA8bGFiZWw+JHtlLnRpdGxlIHx8IHRoaXMuZW5nbGlzaChlLm5hbWUpfTo8L2xhYmVsPmA7CgkJCQkJfQoJCQkJCWlmIChlLnR5cGUgJiYgdGhpc1tlLnR5cGVdKSB7CgkJCQkJCXJldCArPSB0aGlzW2UudHlwZV0oZSk7CgkJCQkJfSBlbHNlIGlmIChlLnJlbmRlcikgewoJCQkJCQlyZXQgKz0gZS5yZW5kZXIoKTsKCQkJCQl9CgkJCQkJcmV0ICs9ICc8L2Rpdj4nOwoJCQkJfQoJCQkJcmV0ICs9ICc8L2Rpdj4nOwoJCQl9CgkJCWlmIChzRWxlbWVudHMubGVuZ3RoID4gMSkgcmV0ICs9ICc8L2Rpdj4nOwoJCQlpZiAoZ0VsZW1lbnRzLmxlbmd0aCA+IDEpIHJldCArPSAiPC9kaXY+IjsKCQl9CgkJaWYgKGdFbGVtZW50cy5sZW5ndGggPiAxKSByZXQgKz0gIjwvZGl2PiI7CgkJcmV0dXJuIHJldDsKCX0KCglpbmZvKG1zZykgewoJCWlmICgkLm1lc3NhZ2VyKSB7CgkJCSQubWVzc2FnZXIuYWxlcnQodGhpcy50aXRsZSwgbXNnLCAnaW5mbycpOwoJCX0gZWxzZSB7CgkJCXRoaXMuc3IoKS5TaG93TWVzc2FnZShtc2csIHRoaXMudGl0bGUpOwoJCX0KCX0KCgllcnJvcihtc2cpIHsKCQlpZiAoJC5tZXNzYWdlcikgewoJCQkkLm1lc3NhZ2VyLmFsZXJ0KHRoaXMudGl0bGUsIG1zZywgJ2Vycm9yJyk7CgkJfSBlbHNlIHsKCQkJdGhpcy5zcigpLlNob3dNZXNzYWdlKG1zZywgdGhpcy50aXRsZSk7CgkJfQoJfQoKCWJ5TmFtZShuYW1lKSB7CgkJcmV0dXJuIHRoaXMuZWxlbWVudHMuZmluZChlID0+IGUubmFtZSA9PT0gbmFtZSk7Cgl9Cn0=",
	"__keys": ["name"],
	"active": true,
	"enabled": true,
	"__trMap": []
}