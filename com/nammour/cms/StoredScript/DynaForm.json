{
	"Id": "ac92446cb5040eb36bece7604a0ac96769f155f6",
	"name": "DynaForm",
	"script": "d2luZG93LkR5bmFGb3JtID0gY2xhc3MgewoJY29uc3RydWN0b3IoKSB7CgkJdGhpcy50aXRsZSA9ICJGb3JtIFRpdGxlIjsKCQl0aGlzLm5hbWUgPSAiZnJtRm9ybSI7CgkJdGhpcy5lbGVtZW50cyA9IFtdOwoJCXRoaXMuc2VsZWN0cyA9IFtdOwoJCXRoaXMuZ3JpZHMgPSBbXTsKCQl0aGlzLmJ1dHRvbnMgPSBbXTsKCQl0aGlzLnpvbmVzID0gWydub3J0aCcsICdzb3V0aCcsICdlYXN0JywgJ3dlc3QnLCAnY2VudGVyJ107CgkJdGhpcy5zVGFibGUgPSBudWxsOwoJCXRoaXMuYkRlYnVnID0gZmFsc2U7CgkJdGhpcy51aVR5cGVzID0gewoJCQlpbnQ6ICJudW1iZXJzcGlubmVyIiwKCQkJbWVudTogInNwbGl0YnV0dG9uIiwKCQkJZGF0ZXRpbWU6ICJkYXRldGltZWJveCIsCgkJCWJvb2w6ICJzd2l0Y2hidXR0b24iLAoJCQlmaWxlOiAiZmlsZWJveCIsCgkJCXRleHQ6ICJ0ZXh0Ym94IiwKCQkJcGFzc3dvcmQ6ICJwYXNzd29yZGJveCIsCgkJCXN0cmluZzogInRleHRib3giLAoJCQlpbWFnZTogImRpYWxvZyIsCgkJCXByb2dyZXNzOiAicHJvZ3Jlc3NiYXIiLAoJCQlsaW5rOiAibGlua2J1dHRvbiIsCgkJCXRyZWU6ICJjb21ib3RyZWUiLAoJCQluYXZpZ2F0aW9uOiAidHJlZSIsCgkJCXNlYXJjaDogJ3NlYXJjaGJveCcsCgkJfTsKCQl0aGlzLmV2ZW50cyA9IFt7CgkJCW5hbWU6ICdvbkNsaWNrJywKCQkJaGFuZGxlcjogJ29uVG9nZ2xlJywKCQkJcGFyYW1zOiAnbj1ldmVudCcsCgkJCXR5cGU6ICd0b2dnbGUnLAoJCX0sIHsKCQkJbmFtZTogJ29uQ2xvc2UnLAoJCQloYW5kbGVyOiAnUGFuT25DbG9zZScsCgkJCXBhcmFtczogJ249ZXZlbnQnLAoJCQl0eXBlOiAnd2luZG93JywKCQl9LCB7CgkJCW5hbWU6ICdvblNlbGVjdCcsCgkJCWhhbmRsZXI6ICdTZWxlY3RDaGFuZ2UnLAoJCQlwYXJhbXM6ICduJywKCQkJdHlwZTogJ3RhYnMnLAoJCX0sIHsKCQkJbmFtZTogJ3NlYXJjaGVyJywKCQkJaGFuZGxlcjogJ0ZpZWxkQ2hhbmdlJywKCQkJcGFyYW1zOiAnbiwgbycsCgkJCXR5cGU6ICdzZWFyY2hib3gnLAoJCX0sIHsKCQkJbmFtZTogJ29uQmVmb3JlRXhwYW5kJywKCQkJaGFuZGxlcjogJ0V4cGFuZCcsCgkJCXBhcmFtczogJ24nLAoJCQl0eXBlOiAndHJlZScsCgkJfSwgewoJCQluYW1lOiAnb25DaGFuZ2UnLAoJCQloYW5kbGVyOiAnRmllbGRDaGFuZ2UnLAoJCQlwYXJhbXM6ICduLCBvJwoJCX0sIHsKCQkJbmFtZTogJ29uQmVmb3JlT3BlbicsCgkJCWhhbmRsZXI6ICdQYW5lbE9wZW4nLAoJCQlwYXJhbXM6ICcnLAoJCQl0eXBlOiAnd2luZG93JywKCQl9LCB7CgkJCW5hbWU6ICdvbk9wZW4nLAoJCQloYW5kbGVyOiAnUGVuZEFmdGVyT3BlbicsCgkJCXBhcmFtczogJycsCgkJCXR5cGU6ICd3aW5kb3cnLAoJCX0sIHsKCQkJbmFtZTogJ29uQ2xpY2snLAoJCQloYW5kbGVyOiAnZG9MaW5rJywKCQkJcGFyYW1zOiAnbj1ldmVudCwgbycsCgkJCXR5cGU6ICdsaW5rJywKCQl9LCB7CgkJCW5hbWU6ICdvbkNsaWNrUm93JywKCQkJaGFuZGxlcjogJ0ZpZWxkQ2hhbmdlJywKCQkJcGFyYW1zOiAnbiwgbycsCgkJCXR5cGU6ICdncmlkJywKCQl9XTsKCgkJaWYgKHR5cGVvZigkKSAhPT0gJ3VuZGVmaW5lZCcpICQod2luZG93KS5yZXNpemUodGhpcy53aW5kb3dSZXNpemVkKTsKCQl0aGlzLndpbmRvd1Jlc2l6ZWQoKTsKCX0KCglzcigpIHsKCQlyZXR1cm4gdHlwZW9mKF9GckVNRCkgIT09ICd1bmRlZmluZWQnID8gX0ZyRU1ELnNyKCkgOiB3aW5kb3cuc3I7Cgl9CgoJcGFyc2UoKSB7CgkJJC5wYXJzZXIucGFyc2UoKTsKCX0KCgl3aW5kb3dSZXNpemVkKCkgewoJCXRoaXMud2lkdGggPSB3aW5kb3cuaW5uZXJXaWR0aDsKCQl0aGlzLmhlaWdodCA9IHdpbmRvdy5pbm5lckhlaWdodCAqIDAuODsKCX0KCgkvKiogQ29tcG9uZW50czo6U3RhcnQgKiovCglDb3JlQ29tcG9uZW50ID0gY2xhc3MgewoJCWNvbnN0cnVjdG9yKHBhZ2UpIHsKCQkJdGhpcy5wYWdlID0gcGFnZTsKCQl9CgoJCV9tZSh2KSB7CgkJCWlmICh2KSB7CgkJCQl3aW5kb3dbY29tcGFueS5sb2dnZWRJbklkZW50aXR5IHx8ICJtZSJdID0gdjsKCQkJfQoKCQkJcmV0dXJuIHdpbmRvd1tjb21wYW55LmxvZ2dlZEluSWRlbnRpdHkgfHwgIm1lIl07CgkJfQoKCQlfY2FuVmlldygpIHsKCQkJaWYgKCF0aGlzLl9tZSgpKSB7CgkJCQl3aW5kb3cuX0ZyRU1ELnNldFVSTCh7CgkJCQkJcGFnZTogJ2xvZ2luJywKCQkJCQlfcmVkaXJlY3Q6IHRoaXMucGFnZS5fY29kZSwKCQkJCX0pOwoJCQkJdGhyb3cgYF9jYW5WaWV3OiAke3RoaXMucGFnZS5fY29kZX0gbm90IGFsbG93ZWQgd2l0aG91dCBsb2dpbiFgOwoJCQl9CgkJfQoKCQlfbmFtZSgpIHsKCQkJaWYgKCF0aGlzLl9tZSgpKSByZXR1cm4gIiI7CgkJCXJldHVybiB0aGlzLl9tZSgpLm5hbWUgPyB0aGlzLl9tZSgpLm5hbWUoKSA6IHRoaXMuX21lKCkuVG9TdHJpbmc7CgkJfQoJfQoKCUluZGV4Q29tcG9uZW50ID0gY2xhc3MgZXh0ZW5kcyB0aGlzLkNvcmVDb21wb25lbnQgewoJCWFzeW5jIG1haW4oKSB7CgkJCXRoaXMuX2NhblZpZXcoKTsKCgkJCXRoaXMucGFnZS5kYXRhID0gewoJCQkJZm9ybTogd2luZG93LkRGb3JtLnJlbmRlcignZnJtSW5kZXgnLCAiTWFpbiBQYWdlIiwgW3sKCQkJCQluYW1lOiAnV2VsY29tZScsCgkJCQkJcmVxdWlyZWQ6IHRydWUsCgkJCQkJdHlwZTogImxhYmVsIiwKCQkJCQl2YWx1ZTogdGhpcy5fbmFtZSgpLAoJCQkJfV0sIFtdKQoJCQl9OwoJCX0KCX0KCglMb2dpbkNvbXBvbmVudCA9IGNsYXNzIGV4dGVuZHMgdGhpcy5Db3JlQ29tcG9uZW50IHsKCQlhc3luYyBfYXV0aGVudGljYXRlKG8pIHsKCQkJcmV0dXJuIG51bGw7CgkJfQoKCQlhc3luYyBfbG9nZ2VkSW4oKSB7fQoKCQlhc3luYyBfbm90TG9nZ2VkSW4oKSB7fQoKCQlhc3luYyBtYWluKCkgewoJCQl0aGlzLnBhZ2UuZGF0YSA9IHsKCQkJCWZvcm06IHdpbmRvdy5ERm9ybS5yZW5kZXIoJ2ZybUxvZ2luJywgIlVzZXIgQXV0aGVudGljYXRpb24iLCBbewoJCQkJCQluYW1lOiAnVXNlcm5hbWUnLAoJCQkJCQlyZXF1aXJlZDogdHJ1ZSwKCQkJCQkJdHlwZTogInN0cmluZyIKCQkJCQl9LAoJCQkJCXsKCQkJCQkJbmFtZTogJ1Bhc3N3b3JkJywKCQkJCQkJcmVxdWlyZWQ6IHRydWUsCgkJCQkJCXR5cGU6ICJwYXNzd29yZCIKCQkJCQl9CgkJCQldLCBbewoJCQkJCW5hbWU6ICdMb2dpbicsCgkJCQkJYXV0b1N1Ym1pdDogdHJ1ZSwKCQkJCQlvbmNsaWNrOiBhc3luYyBvID0+IHsKCQkJCQkJbGV0IHJldCA9IGF3YWl0IHRoaXMuX2F1dGhlbnRpY2F0ZShvKTsKCgkJCQkJCWlmIChyZXQpIHsKCQkJCQkJCXRoaXMuX21lKHJldCk7CgoJCQkJCQkJdHJ5IHsKCQkJCQkJCQlhd2FpdCB0aGlzLl9sb2dnZWRJbigpOwoJCQkJCQkJfSBjYXRjaCAoZXgpIHt9CgoJCQkJCQkJX0ZyRU1ELnNldFVSTCh7CgkJCQkJCQkJcGFnZTogX0ZyRU1ELmhhc2guX3JlZGlyZWN0IHx8ICJpbmRleCIKCQkJCQkJCX0pOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJdHJ5IHsKCQkJCQkJCQlhd2FpdCB0aGlzLl9ub3RMb2dnZWRJbigpOwoJCQkJCQkJfSBjYXRjaCAoZXgpIHt9CgoJCQkJCQkJd2luZG93LkRGb3JtLmVycm9yKCJJbnZhbGlkIHVzZXJuYW1lIG9yIHBhc3N3b3JkIik7CgkJCQkJCX0KCgkJCQkJCXdpbmRvdy5ERm9ybS5idXN5KGZhbHNlKTsKCQkJCQl9CgkJCQl9XSkKCQkJfQoJCX0KCX0KCglTdG9yZUNvbXBvbmVudCA9IGNsYXNzIGV4dGVuZHMgdGhpcy5Db3JlQ29tcG9uZW50IHsKCQlhc3luYyBtYWluKCkgewoJCQl0aGlzLl9jYW5WaWV3KCk7CgoJCQljb25zb2xlLmxvZygiR2VuZXJhdGluZyBDUlVEIHBhZ2UgZm9yOiAiLCB0aGlzLnBhZ2UpOwoKCQkJdGhpcy5wYWdlLmRhdGEgPSBhd2FpdCB3aW5kb3cuREZvcm0uQ1JVRCh0aGlzLnBhZ2UuZGF0YSk7CgkJfQoJfQoJLyoqIENvbXBvbmVudHM6OkVuZCAqKi8KCglpbml0KCkgewoJCXZhciBzZWxlY3QgPSB7CgkJCWluaXQ6IGZ1bmN0aW9uKGNvbnRhaW5lciwgb3B0aW9ucykgewoJCQkJdmFyIG9wID0gbnVsbDsKCQkJCXZhciBmb3AgPSBudWxsOwoJCQkJZm9yICh2YXIgaSA9IDA7IGkgPCB3aW5kb3cuREZvcm0uZ3JpZHMubGVuZ3RoOyBpKyspCgkJCQkJaWYgKHdpbmRvdy5ERm9ybS5ncmlkc1tpXS5pZCA9PSBvcHRpb25zLnNvdXJjZSkgb3AgPSB3aW5kb3cuREZvcm0uZ3JpZHNbaV0ub3B0aW9uczsKCQkJCWZvciAoaSA9IDA7IGkgPCBvcC5jb2x1bW5zLmxlbmd0aDsgaSsrKQoJCQkJCWlmIChvcC5jb2x1bW5zW2ldLm5hbWUgPT0gb3B0aW9ucy5maWVsZCkgZm9wID0gb3AuY29sdW1uc1tpXTsKCQkJCWZvcC53aWR0aCA9ICh3aW5kb3cuREZvcm0ud2lkdGggLyAzKTsKCQkJCXZhciBlID0gJCh3aW5kb3cuREZvcm0uc2VsZWN0KGZvcCkpOwoJCQkJdmFyIGlucHV0ID0gZS5hcHBlbmRUbyhjb250YWluZXIpOwoJCQkJaW5wdXQuY29tYm9ncmlkKCk7CgkJCQl3aW5kb3cuREZvcm0uYmluZChpbnB1dCk7CgkJCQlyZXR1cm4gaW5wdXQ7CgkJCX0sCgkJCWRlc3Ryb3k6IGZ1bmN0aW9uKHRhcmdldCkgewoJCQkJJCh0YXJnZXQpLnJlbW92ZSgpOwoJCQl9LAoJCQlnZXRWYWx1ZTogZnVuY3Rpb24odGFyZ2V0KSB7CgkJCQlyZXR1cm4gJCh0YXJnZXQpLnZhbCgpOwoJCQl9LAoJCQlzZXRWYWx1ZTogZnVuY3Rpb24odGFyZ2V0LCB2YWx1ZSkgewoJCQkJJCh0YXJnZXQpLnZhbCh2YWx1ZSk7CgkJCX0sCgkJCXJlc2l6ZTogZnVuY3Rpb24odGFyZ2V0LCB3aWR0aCkgewoJCQkJJCh0YXJnZXQpLl9vdXRlcldpZHRoKHdpZHRoKTsKCQkJfQoJCX07CgkJJC5leHRlbmQoJC5mbi5kYXRhZ3JpZC5kZWZhdWx0cy5lZGl0b3JzLCB7CgkJCWRhdGV0aW1lOiB7CgkJCQlpbml0OiBmdW5jdGlvbihjb250YWluZXIsIG9wdGlvbnMpIHsKCQkJCQlvcHRpb25zLndpZHRoID0gd2luZG93LkRGb3JtLmNXaWR0aChvcHRpb25zKTsKCQkJCQl2YXIgaW5wdXQgPSAkKHdpbmRvdy5ERm9ybS5kYXRldGltZShvcHRpb25zKSkuYXBwZW5kVG8oY29udGFpbmVyKTsKCQkJCQlpbnB1dC5kYXRldGltZWJveCgpOwoJCQkJCXJldHVybiBpbnB1dDsKCQkJCX0sCgkJCQlkZXN0cm95OiBmdW5jdGlvbih0YXJnZXQpIHsKCQkJCQkkKHRhcmdldCkucmVtb3ZlKCk7CgkJCQl9LAoJCQkJZ2V0VmFsdWU6IGZ1bmN0aW9uKHRhcmdldCkgewoJCQkJCXJldHVybiAkKHRhcmdldCkudmFsKCk7CgkJCQl9LAoJCQkJc2V0VmFsdWU6IGZ1bmN0aW9uKHRhcmdldCwgdmFsdWUpIHsKCQkJCQkkKHRhcmdldCkudmFsKHZhbHVlKTsKCQkJCX0sCgkJCQlyZXNpemU6IGZ1bmN0aW9uKHRhcmdldCwgd2lkdGgpIHsKCQkJCQkkKHRhcmdldCkuX291dGVyV2lkdGgod2lkdGgpOwoJCQkJfQoJCQl9LAoJCQljaGVja2JveDogewoJCQkJaW5pdDogZnVuY3Rpb24oY29udGFpbmVyLCBvcHRpb25zKSB7CgkJCQkJdmFyIGlucHV0ID0gJCh3aW5kb3cuREZvcm0uYm9vbChvcHRpb25zKSkuYXBwZW5kVG8oY29udGFpbmVyKTsKCQkJCQlpbnB1dC5zd2l0Y2hidXR0b24oKTsKCQkJCQlyZXR1cm4gaW5wdXQ7CgkJCQl9LAoJCQkJZGVzdHJveTogZnVuY3Rpb24odGFyZ2V0KSB7CgkJCQkJJCh0YXJnZXQpLnJlbW92ZSgpOwoJCQkJfSwKCQkJCWdldFZhbHVlOiBmdW5jdGlvbih0YXJnZXQpIHsKCQkJCQlyZXR1cm4gJCh0YXJnZXQpLnZhbCgpOwoJCQkJfSwKCQkJCXNldFZhbHVlOiBmdW5jdGlvbih0YXJnZXQsIHZhbHVlKSB7CgkJCQkJJCh0YXJnZXQpLnZhbCh2YWx1ZSk7CgkJCQl9LAoJCQkJcmVzaXplOiBmdW5jdGlvbih0YXJnZXQsIHdpZHRoKSB7CgkJCQkJJCh0YXJnZXQpLl9vdXRlcldpZHRoKHdpZHRoKTsKCQkJCX0KCQkJfSwKCQkJY29tYm90cmVlZ3JpZDogc2VsZWN0LAoJCQlzZWxlY3Q6IHNlbGVjdCwKCQl9KTsKCX0KCglhc2socXVlc3Rpb24sIGZBbnN3ZXIgPSB2ID0+IHYsIG9wdGlvbnMpIHsKCQkkLm1lc3NhZ2VyLmNvbmZpcm0odGhpcy50aXRsZSwgcXVlc3Rpb24sIGZ1bmN0aW9uKHIpIHsKCQkJaWYgKG9wdGlvbnMpIHsKCQkJCWZvciAodmFyIGkgPSAwOyBpIDwgb3B0aW9ucy5sZW5ndGg7IGkrKykgewoJCQkJCWlmIChvcHRpb25zW2ldLmFuc3dlciA9PSByKSB7CgkJCQkJCXJldHVybiBmQW5zd2VyKG9wdGlvbnNbaV0udmFsdWUpOwoJCQkJCX0KCQkJCX0KCQkJfSBlbHNlIHsKCQkJCXJldHVybiBmQW5zd2VyKHIpOwoJCQl9CgkJfSk7Cgl9CgoJdG9wRGF0YShhciwgZ0ZpZWxkLCB2RmllbGQsIHRvcCkgewoJCWlmICghdG9wKSB7CgkJCXJldHVybiBhcjsKCQl9CgkJcmV0ID0gW107CgkJJC5lYWNoKHRoaXMuc3IoKS5ncm91cEJ5KGFyLCBnRmllbGQpLCBmdW5jdGlvbihrZXksIHZhbHVlcykgewoJCQl2YWx1ZXMudmFsdWVzLnNvcnQoKGEsIGIpID0+IHsKCQkJCWlmIChwYXJzZUZsb2F0KGFbdkZpZWxkXSkgPCBwYXJzZUZsb2F0KGJbdkZpZWxkXSkpIHsKCQkJCQlyZXR1cm4gMTsKCQkJCX0gZWxzZSBpZiAocGFyc2VGbG9hdChhW3ZGaWVsZF0pID4gcGFyc2VGbG9hdChiW3ZGaWVsZF0pKSB7CgkJCQkJcmV0dXJuIC0xOwoJCQkJfSBlbHNlIHsKCQkJCQlyZXR1cm4gMDsKCQkJCX0KCQkJfSk7CgkJCSQuZWFjaCh2YWx1ZXMudmFsdWVzLCBmdW5jdGlvbihpLCB2KSB7CgkJCQlpZiAoaSA8IHRvcCkgewoJCQkJCXJldC5wdXNoKHYpOwoJCQkJfQoJCQl9KTsKCQl9KTsKCQlyZXR1cm4gcmV0OwoJfQoKCWFzeW5jIENSVUQoc1RhYmxlLCBiRml4ZWQpIHsKCQl2YXIgZmllbGRzID0gW107CgkJd2luZG93LkRGb3JtLnNUYWJsZSA9IHNUYWJsZTsKCQlpZiAoY29tcGFueS5saWJyYXJ5KSB7CgkJCXZhciByZXQgPSBhd2FpdCB0aGlzLnNyKCkuXygiQ29udGVudE1hbmFnZXIuY21zR2VuZXJhdGVMYXllckNsYXNzIiwgbnVsbCwgY29tcGFueS5saWJyYXJ5ICsgIi4iICsgc1RhYmxlKTsKCQkJZmllbGRzLnB1c2goewoJCQkJZ3JvdXA6ICJNYWluIiwKCQkJCWF0dHJpYnV0ZTogewoJCQkJCVJlbGF0aW9uQ2xhc3M6IHsKCQkJCQkJTmFtZTogc1RhYmxlCgkJCQkJfQoJCQkJfSwKCQkJCW5hbWU6IHdpbmRvdy5ERm9ybS5zVGFibGUsCgkJCQl0eXBlOiAnc2VsZWN0JywKCQkJCXNlbGVjdDogZnVuY3Rpb24obykgewoJCQkJCXdpbmRvdy5ERm9ybS5zZXQobyk7CgkJCQl9CgkJCX0pOwoJCQlmb3IgKHZhciBpID0gMDsgaSA8IHJldC5MYXllckF0dHJpYnV0ZXMubGVuZ3RoOyBpKyspIHsKCQkJCWlmIChyZXQuTGF5ZXJBdHRyaWJ1dGVzW2ldLk5hbWUgPT0gIklkIikgY29udGludWU7CgkJCQlmaWVsZHMucHVzaCh7CgkJCQkJZ3JvdXA6ICJNYWluIiwKCQkJCQluYW1lOiByZXQuTGF5ZXJBdHRyaWJ1dGVzW2ldLk5hbWUsCgkJCQkJdHlwZTogcmV0LkxheWVyQXR0cmlidXRlc1tpXS5OYXRpdmVUeXBlCgkJCQl9KTsKCQkJfQoJCQlmb3IgKGkgPSAwOyBpIDwgcmV0LlJlbGF0aW9uQXR0cmlidXRlcy5sZW5ndGg7IGkrKykgewoJCQkJdmFyIG0gPSByZXQuUmVsYXRpb25BdHRyaWJ1dGVzW2ldLklzQXJyYXk7CgkJCQl2YXIgckNvbHMgPSBbXTsKCQkJCWZvciAodmFyIHAgaW4gcmV0LlJlbGF0aW9uQXR0cmlidXRlc1tpXS5SZWxhdGlvbkNsYXNzKSB7CgkJCQkJaWYgKCQuaW5BcnJheShwLCBbIlRvU3RyaW5nIiwgIl9Ub1N0cmluZyIsICJfX1JPV0lEIiwgIl9fTE9BREVEIiwgIklkIl0pID4gLTEpIGNvbnRpbnVlOwoJCQkJCXJDb2xzLnB1c2goewoJCQkJCQlmaWVsZDogcCwKCQkJCQkJdGl0bGU6IHAKCQkJCQl9KTsKCQkJCX0KCQkJCWZpZWxkcy5wdXNoKHsKCQkJCQlncm91cDogKG0gPyAiT3RoZXIiIDogIlJlbGF0aW9ucyIpLAoJCQkJCUNsYXNzOiByZXQuUmVsYXRpb25BdHRyaWJ1dGVzW2ldLlJlbGF0aW9uQ2xhc3MsCgkJCQkJbmFtZTogcmV0LlJlbGF0aW9uQXR0cmlidXRlc1tpXS5OYW1lLAoJCQkJCXR5cGU6ICdzZWxlY3QnLAoJCQkJCW11bHRpcGxlOiBtLAoJCQkJCXNvdXJjZTogZnVuY3Rpb24obywgZkRhdGEpIHsKCQkJCQkJcmV0dXJuIG87CgkJCQkJfSwKCQkJCQljb2x1bW5zOiByQ29scwoJCQkJfSk7CgkJCX0KCQl9IGVsc2UgewoJCQkvLyBlbXMKCQkJdmFyIGVjID0gKGNvbXBhbnkuU2NvcGUgPyB3aW5kb3dbY29tcGFueS5TY29wZV0gOiB3aW5kb3cpLkVudGl0eUNsYXNzZXMuZmluZChjID0+IGMuTmFtZS5yZXBsYWNlKCcgJywgJ18nKSA9PSBzVGFibGUpOwoJCQlmaWVsZHMucHVzaCh7CgkJCQluYW1lOiBzVGFibGUsCgkJCQl0aXRsZTogZWMuTmFtZSwKCQkJCUNsYXNzOiB7CgkJCQkJTmFtZTogZWMuTmFtZSwKCQkJCQlJZDogZWMuSWQKCQkJCX0sCgkJCQl0eXBlOiAnc2VsZWN0JywKCQkJCXNlbGVjdDogZnVuY3Rpb24obykgewoJCQkJCXdpbmRvdy5ERm9ybS5jbGVhcigpOwoJCQkJCXdpbmRvdy5ERm9ybS5zZXQobyk7CgkJCQl9CgkJCX0pOwoJCQkkLmVhY2goZWMuRW50aXR5QXR0cmlidXRlcywgKF8sIGVhKSA9PiB7CgkJCQlpZiAoIWVhLkVudGl0eVR5cGUpIHsKCQkJCQl2YXIgdHlwZSA9ICJzdHJpbmciOwoJCQkJCWlmIChlYS5Jc0Jvb2wpIHR5cGUgPSAiYm9vbCI7CgkJCQkJaWYgKGVhLklzRGF0ZSkgdHlwZSA9ICJkYXRldGltZSI7CgkJCQkJaWYgKGVhLklzKSB0eXBlID0gImRhdGV0aW1lIjsKCQkJCQlpZiAoZWEuSXNUZXh0KSB0eXBlID0gInRleHQiOwoJCQkJCWZpZWxkcy5wdXNoKHsKCQkJCQkJZ3JvdXA6IGVhLkdyb3VwLk5hbWUsCgkJCQkJCW5hbWU6IGVhLk5hbWUsCgkJCQkJCXR5cGU6IHR5cGUKCQkJCQl9KTsKCQkJCX0gZWxzZSB7CgkJCQkJZmllbGRzLnB1c2goewoJCQkJCQlncm91cDogZWEuR3JvdXAuTmFtZSwKCQkJCQkJbmFtZTogZWEuTmFtZSwKCQkJCQkJQ2xhc3M6IHsKCQkJCQkJCU5hbWU6IGVhLkVudGl0eVR5cGUuTmFtZSwKCQkJCQkJCUlkOiBlYS5FbnRpdHlUeXBlLklkCgkJCQkJCX0sCgkJCQkJCXNvdXJjZTogZnVuY3Rpb24obywgZkRhdGEpIHsKCQkJCQkJCXJldHVybiBvOwoJCQkJCQl9LAoJCQkJCQl0eXBlOiAic2VsZWN0IgoJCQkJCX0pOwoJCQkJfQoJCQl9KTsKCQl9CgkJcmV0dXJuIHsKCQkJZm9ybTogd2luZG93LkRGb3JtLnJlbmRlcihzVGFibGUsIHRoaXMuZW5nbGlzaChzVGFibGUpLCBmaWVsZHMsIFt7CgkJCQluYW1lOiAnUmVzZXQnLAoJCQkJb25jbGljazogZnVuY3Rpb24obykgewoJCQkJCXdpbmRvdy5ERm9ybS5idXN5KGZhbHNlKTsKCQkJCQl3aW5kb3cuREZvcm0uY2xlYXIoKTsKCQkJCX0sCgkJCQlpY29uOiAiY2FuY2VsIgoJCQl9LCB7CgkJCQluYW1lOiAnU2F2ZScsCgkJCQlvbmNsaWNrOiBmdW5jdGlvbihvKSB7CgkJCQkJaWYgKG9bd2luZG93LkRGb3JtLnNUYWJsZV0gJiYgb1t3aW5kb3cuREZvcm0uc1RhYmxlXS5JZCkgby5JZCA9IG9bd2luZG93LkRGb3JtLnNUYWJsZV0uSWQ7CgkJCQkJZGVsZXRlIG9bd2luZG93LkRGb3JtLnNUYWJsZV07CgkJCQkJaWYgKGNvbXBhbnkubGlicmFyeSkgewoJCQkJCQl0aGlzLnNyKCkuXyhjb21wYW55LkNvZGUudG9Mb3dlckNhc2UoKSArICIiICsgd2luZG93LkRGb3JtLnNUYWJsZSArIChvLklkID8gIlVwZGF0ZSIgOiAiSW5zZXJ0IiksIGZ1bmN0aW9uKHJldCkgewoJCQkJCQkJaWYgKHJldCkgewoJCQkJCQkJCXdpbmRvdy5ERm9ybS5pbmZvKHdpbmRvdy5ERm9ybS5zVGFibGUgKyAiIFNhdmVkIik7CgkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCXdpbmRvdy5ERm9ybS5lcnJvcigiVW5hYmxlIHRvIHNhdmUgIiArIHdpbmRvdy5ERm9ybS5zVGFibGUpOwoJCQkJCQkJfQoJCQkJCQkJd2luZG93LkRGb3JtLmJ1c3koZmFsc2UpOwoJCQkJCQl9LCBvKTsKCQkJCQl9IGVsc2UgewoJCQkJCQl0aGlzLnNyKCkuXygiZW1zRW50aXR5T2JqZWN0IiArIChvLklkID8gIlVwZGF0ZSIgOiAiSW5zZXJ0IiksIGZ1bmN0aW9uKHJldCkgewoJCQkJCQkJaWYgKHJldCkgewoJCQkJCQkJCXdpbmRvdy5ERm9ybS5pbmZvKHdpbmRvdy5ERm9ybS5zVGFibGUgKyAiIFNhdmVkIik7CgkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCXdpbmRvdy5ERm9ybS5lcnJvcigiVW5hYmxlIHRvIHNhdmUgIiArIHdpbmRvdy5ERm9ybS5zVGFibGUpOwoJCQkJCQkJfQoJCQkJCQkJd2luZG93LkRGb3JtLmJ1c3koZmFsc2UpOwoJCQkJCQl9LCBvLnRvRW50aXR5T2JqZWN0KCkpOwoJCQkJCX0KCQkJCX0KCQkJfV0sIGJGaXhlZCkKCQl9OwoJfQoKCWFzeW5jIGRvQ2xpY2soYnV0dG9uKSB7CgkJYnV0dG9uID0gdGhpcy5idXR0b25zLmZpbmQoYiA9PiBiLm5hbWUgPT0gYnV0dG9uLm5hbWUgJiYgYi5ncm91cCA9PSBidXR0b24uZ3JvdXApOwoJCXRoaXMuYnVzeSh0cnVlKTsKCQl2YXIgbyA9IHRoaXMuZ2V0KCk7CgkJdmFyIHNNaXNzaW5nID0gdGhpcy5lbGVtZW50cy5maWx0ZXIoZSA9PiAoYnV0dG9uLndpbmRvdyA/IGJ1dHRvbi5ncm91cCA9PSBlLmdyb3VwIDogdHJ1ZSkpLmZpbHRlcihlID0+IGUucmVxdWlyZWQgJiYgIW9bZS5uYW1lXSkubWFwKGUgPT4gIjxsaT4iICsgKGUubGFiZWwgfHwgZS5uYW1lKSArICI8L2xpPiIpLmpvaW4oIiIpOwoJCWlmIChzTWlzc2luZykgewoJCQl3aW5kb3cuX0ZyRU1ELl9lcnJvcigiTWlzc2luZyBtYW5kYXRvcnkgZmllbGRzOjxici8+PHVsPiIgKyBzTWlzc2luZyArICI8L3VsPiIsIDUwMDApOwoJCQl0aGlzLmJ1c3koZmFsc2UpOwoJCQlyZXR1cm47CgkJfQoJCWlmIChidXR0b24ub25jbGljaykgYXdhaXQgYnV0dG9uLm9uY2xpY2sobyk7CgkJaWYgKGJ1dHRvbi5vbkNsaWNrKSBhd2FpdCBidXR0b24ub25DbGljayhvKTsKCQl0aGlzLmJ1c3koZmFsc2UpOwoJfQoKCWJ1c3koYkJ1c3kpIHsKCQlpZiAoIWJCdXN5KSB7CgkJCXZhciB0b3RhbCA9IDA7CgkJCWlmICh0eXBlb2YgbW9tZW50ICE9PSAndW5kZWZpbmVkJykgewoJCQkJdG90YWwgPSBtb21lbnQoKS5kaWZmKG1vbWVudCh0aGlzLmJ1c3lTdGFtcCksICdzZWNvbmRzJyk7CgkJCX0gZWxzZSB7CgkJCQkvLyBubyBtb21lbnQsIHVzZSBzdGFuZGFyZCBEYXRlCgkJCQl0b3RhbCA9IChuZXcgRGF0ZSgpLmdldFRpbWUoKSAtIHRoaXMuYnVzeVN0YW1wID8gdGhpcy5idXN5U3RhbXAuZ2V0VGltZSgpIDogMCkgLyAxMDAwIC8gMzYwMDsKCQkJfQoJCQlpZiAodGhpcy5iRGVidWcpIHsKCQkJCXdpbmRvdy5fRnJFTUQuX2FsZXJ0KCJFeGVjdXRpb24gVGltZTogIiArIHRvdGFsICsgIiBzZWNvbmRzLiIpOwoJCQl9CgkJCWRlbGV0ZSB0aGlzLmJ1c3lTdGFtcDsKCQl9IGVsc2UgewoJCQl0aGlzLmJ1c3lTdGFtcCA9IG5ldyBEYXRlKCk7CgkJfQoKCQkkLmVhY2goJC5tZXJnZSgkLm1hcCh0aGlzLmJ1dHRvbnMsIGIgPT4gYi5uYW1lKSwgJC5tYXAodGhpcy5lbGVtZW50cy5maWx0ZXIoZSA9PiBlLnR5cGUgPT0gJ2xpbmsnKSwgZSA9PiBlLm5hbWUpKSwgKF8sIGUpID0+ICQoJyMnICsgZSkubGlua2J1dHRvbihiQnVzeSA/ICdkaXNhYmxlJyA6ICdlbmFibGUnKSk7Cgl9CgoJcHJlZml4KGUpIHsKCQlzd2l0Y2ggKGUudHlwZSkgewoJCQljYXNlICdsYWJlbCc6CgkJCQlyZXR1cm4gJ2xibCc7CgkJCWNhc2UgJ3RleHQnOgoJCQljYXNlICdzdHJpbmcnOgoJCQljYXNlICdzZWFyY2gnOgoJCQljYXNlICdwYXNzd29yZCc6CgkJCQlyZXR1cm4gJ3R4dCc7CgkJCWNhc2UgIkRhdGVUaW1lIjoKCQkJY2FzZSAiZGF0ZXRpbWUiOgoJCQkJcmV0dXJuICdkdHAnOwoJCQljYXNlICJpbnQiOgoJCQljYXNlICJpbnRlZ2VyIjoKCQkJY2FzZSAibnVtYmVyIjoKCQkJY2FzZSAibG9uZyI6CgkJCWNhc2UgIkxvbmciOgoJCQkJcmV0dXJuICdudWQnOwoJCQljYXNlICdmaWxlJzoKCQkJCXJldHVybiAnZmlsJzsKCQkJY2FzZSAnaW1hZ2UnOgoJCQkJcmV0dXJuICdpbWcnOwoJCQljYXNlICJib29sIjoKCQkJCXJldHVybiAnY2hrJzsKCQkJY2FzZSAid2luZG93IjoKCQkJCXJldHVybiAncG5sJzsKCQkJY2FzZSAicHJvZ3Jlc3MiOgoJCQkJcmV0dXJuICdwcmcnOwoJCQljYXNlICJncmlkIjoKCQkJY2FzZSAidHJlZSI6CgkJCWNhc2UgInNlbGVjdCI6CgkJCQlyZXR1cm4gJ2NtYic7CgkJCWRlZmF1bHQ6CgkJCQlyZXR1cm4gJyc7CgkJfQoJfQoKCWNsZWFyKGdyb3VwKSB7CgkJdmFyIG8gPSB7fTsKCQkkLmVhY2godGhpcy5lbGVtZW50cy5maWx0ZXIoZSA9PiBncm91cCA/IGUuZ3JvdXAgPT0gZ3JvdXAgOiB0cnVlKSwgKF8sIGUpID0+IHsKCQkJdmFyIG5hbWUgPSAoZS5lbXNTb3VyY2UgPyAiXyIgOiAiIikgKyBlLm5hbWU7CgkJCXN3aXRjaCAoZS50eXBlKSB7CgkJCQljYXNlICd0ZXh0JzoKCQkJCWNhc2UgJ3N0cmluZyc6CgkJCQljYXNlICdzZWFyY2gnOgoJCQkJY2FzZSAncGFzc3dvcmQnOgoJCQkJY2FzZSAiRGF0ZVRpbWUiOgoJCQkJY2FzZSAiZGF0ZXRpbWUiOgoJCQkJCW9bbmFtZV0gPSAiIjsKCQkJCQlicmVhazsKCQkJCWNhc2UgImludCI6CgkJCQljYXNlICJudW1iZXIiOgoJCQkJY2FzZSAiaW50ZWdlciI6CgkJCQljYXNlICJsb25nIjoKCQkJCWNhc2UgIkxvbmciOgoJCQkJY2FzZSAicHJvZ3Jlc3MiOgoJCQkJCW9bbmFtZV0gPSAwOwoJCQkJCWJyZWFrOwoJCQkJY2FzZSAidHJlZSI6CgkJCQljYXNlICJzZWxlY3QiOgoJCQkJCW9bbmFtZV0gPSBudWxsOwoJCQkJCWJyZWFrOwoJCQkJY2FzZSAiZ3JpZCI6CgkJCQkJb1tuYW1lXSA/IG9bbmFtZV0uZGF0YSA9IFtdIDogbnVsbDsKCQkJCQlicmVhazsKCQkJCWNhc2UgImJvb2wiOgoJCQkJCW9bbmFtZV0gPSBmYWxzZTsKCQkJCQlicmVhazsKCQkJCWRlZmF1bHQ6CgkJCQkJYnJlYWs7CgkJCX0KCQl9KTsKCQkvL2NvbnNvbGUubG9nKCJjbGVhciIsIG8pOwoJCXRoaXMuc2V0KG8pOwoJCXRoaXMuYnVzeShmYWxzZSk7Cgl9CgoJc2V0KG8sIGVOYW1lKSB7CgkJaWYgKGVOYW1lKSB7CgkJCXZhciBvRWxlbWVudCA9IHRoaXMuYnlOYW1lKGVOYW1lKTsKCQkJaWYgKCFvRWxlbWVudCkgcmV0dXJuOwoJCQl2YXIgYXR0ID0gbnVsbDsKCQkJaWYgKG8gJiYgby5JZCAmJiBvLkVudGl0eUF0dHJpYnV0ZSkgewoJCQkJLy8gYW4gRW50aXR5VmFsdWUKCQkJCWZvciAodmFyIHAgaW4gbykKCQkJCQlpZiAocC5lbmRzV2l0aCgiVmFsdWUiKSkgYXR0ID0gcDsKCQkJCW9FbGVtZW50LmVtc1NvdXJjZSA9IG87CgkJCX0KCQkJdHJ5IHsKCQkJCXN3aXRjaCAob0VsZW1lbnQudHlwZSkgewoJCQkJCWNhc2UgJ2xhYmVsJzoKCQkJCQkJaWYgKGF0dCkgewoJCQkJCQkJJCgiIyIgKyB0aGlzLnByZWZpeChvRWxlbWVudCkgKyBvRWxlbWVudC5uYW1lKS5odG1sKG9bYXR0XSk7CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQkkKCIjIiArIHRoaXMucHJlZml4KG9FbGVtZW50KSArIG9FbGVtZW50Lm5hbWUpLmh0bWwoKG8gJiYgby5FbnRpdHlBdHRyaWJ1dGUpID8gIiIgOiBvKTsKCQkJCQkJfQoJCQkJCQlicmVhazsKCQkJCQljYXNlICd0ZXh0JzoKCQkJCQljYXNlICdzdHJpbmcnOgoJCQkJCWNhc2UgJ3Bhc3N3b3JkJzoKCQkJCQljYXNlICJpbnQiOgoJCQkJCWNhc2UgInNlYXJjaCI6CgkJCQkJY2FzZSAiaW50ZWdlciI6CgkJCQkJY2FzZSAibnVtYmVyIjoKCQkJCQljYXNlICJsb25nIjoKCQkJCQljYXNlICJMb25nIjoKCQkJCQkJaWYgKGF0dCkgewoJCQkJCQkJJCgiIyIgKyB0aGlzLnByZWZpeChvRWxlbWVudCkgKyBvRWxlbWVudC5uYW1lKVt0aGlzLnVpVHlwZXNbb0VsZW1lbnQudHlwZV1dKCJzZXRWYWx1ZSIsIG9bYXR0XSk7CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQkkKCIjIiArIHRoaXMucHJlZml4KG9FbGVtZW50KSArIG9FbGVtZW50Lm5hbWUpW3RoaXMudWlUeXBlc1tvRWxlbWVudC50eXBlXV0oInNldFZhbHVlIiwgKG8gJiYgby5FbnRpdHlBdHRyaWJ1dGUpID8gIiIgOiBvKTsKCQkJCQkJfQoJCQkJCQlicmVhazsKCQkJCQljYXNlICJEYXRlVGltZSI6CgkJCQkJY2FzZSAiZGF0ZXRpbWUiOgoJCQkJCQlpZiAoYXR0KSB7CgkJCQkJCQkkKCIjIiArIHRoaXMucHJlZml4KG9FbGVtZW50KSArIG9FbGVtZW50Lm5hbWUpW3RoaXMudWlUeXBlc1tvRWxlbWVudC50eXBlXV0oJ3NldFZhbHVlJywgKG9bYXR0XSA/IHRoaXMuc3IoKS50b0RhdGVUaW1lKG9bYXR0XSkgOiAiIikpOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJJCgiIyIgKyB0aGlzLnByZWZpeChvRWxlbWVudCkgKyBvRWxlbWVudC5uYW1lKVt0aGlzLnVpVHlwZXNbb0VsZW1lbnQudHlwZV1dKCdzZXRWYWx1ZScsIChvICYmIG8uRW50aXR5QXR0cmlidXRlKSA/ICIiIDogKG8gPyB0aGlzLnNyKCkudG9EYXRlVGltZShvKSA6ICIiKSk7CgkJCQkJCX0KCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAiYm9vbCI6CgkJCQkJCWlmIChhdHQpIHsKCQkJCQkJCSQoIiMiICsgdGhpcy5wcmVmaXgob0VsZW1lbnQpICsgb0VsZW1lbnQubmFtZSlbdGhpcy51aVR5cGVzW29FbGVtZW50LnR5cGVdXSgob1thdHRdID8gJycgOiAndW4nKSArICdjaGVjaycpOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJJCgiIyIgKyB0aGlzLnByZWZpeChvRWxlbWVudCkgKyBvRWxlbWVudC5uYW1lKVt0aGlzLnVpVHlwZXNbb0VsZW1lbnQudHlwZV1dKCgoKG8gJiYgby5FbnRpdHlBdHRyaWJ1dGUpID8gIiIgOiBvKSA/ICcnIDogJ3VuJykgKyAnY2hlY2snKTsKCQkJCQkJfQoJCQkJCQlicmVhazsKCQkJCQljYXNlICJ3aW5kb3ciOgoJCQkJCQlpZiAoYXR0KSB7CgkJCQkJCQlvRWxlbWVudC52YWx1ZSA9IG9bYXR0XTsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCW9FbGVtZW50LnZhbHVlID0gKG8gJiYgby5FbnRpdHlBdHRyaWJ1dGUpID8gIiIgOiBvOwoJCQkJCQl9CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgInByb2dyZXNzIjoKCQkJCQkJdmFyIHYgPSAwOwoJCQkJCQlpZiAoYXR0KSB7CgkJCQkJCQl2ID0gb1thdHRdOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJdiA9IChvICYmIG8uRW50aXR5QXR0cmlidXRlKSA/ICIiIDogbzsKCQkJCQkJfQoJCQkJCQkkKCIjIiArIHRoaXMucHJlZml4KG9FbGVtZW50KSArIG9FbGVtZW50Lm5hbWUpW3RoaXMudWlUeXBlc1tvRWxlbWVudC50eXBlXV0oJ3NldFZhbHVlJywgTWF0aC5yb3VuZCh2ICogMTApIC8gMTApOwoJCQkJCQlicmVhazsKCQkJCQljYXNlICJncmlkIjoKCQkJCQkJbGV0IGNvbHMgPSBKU09OLnBhcnNlKCJ7IiArIHRoaXMubWFwQ29sdW1ucyhvRWxlbWVudCwgdHJ1ZSkgKyAifSIpOwoJCQkJCQkkLmVhY2goY29scy5jb2x1bW5zWzBdLCAoXywgYykgPT4gYy5mb3JtYXR0ZXIgPSB0aGlzLnNyKCkucnVuU2NyaXB0KHRoaXMuZm9ybWF0dGVyKG9FbGVtZW50Lm5hbWUsIGMpKSk7CgkJCQkJCSQoIiMiICsgdGhpcy5wcmVmaXgob0VsZW1lbnQpICsgb0VsZW1lbnQubmFtZSkuZGF0YWdyaWQoY29scyk7CgkJCQkJCWlmIChhdHQpIHsKCQkJCQkJCSQoIiMiICsgdGhpcy5wcmVmaXgob0VsZW1lbnQpICsgb0VsZW1lbnQubmFtZSkuZGF0YWdyaWQoewoJCQkJCQkJCWRhdGE6IG9bYXR0XQoJCQkJCQkJfSk7CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQkkKCIjIiArIHRoaXMucHJlZml4KG9FbGVtZW50KSArIG9FbGVtZW50Lm5hbWUpLmRhdGFncmlkKHsKCQkJCQkJCQlkYXRhOiAobyAmJiBvLkVudGl0eUF0dHJpYnV0ZSkgPyAiIiA6IG8KCQkJCQkJCX0pOwoJCQkJCQl9CgkJCQkJCSQoIiMiICsgdGhpcy5wcmVmaXgob0VsZW1lbnQpICsgb0VsZW1lbnQubmFtZSkuZGF0YWdyaWQoInVuc2VsZWN0QWxsIik7CgkJCQkJCSQoIiMiICsgdGhpcy5wcmVmaXgob0VsZW1lbnQpICsgb0VsZW1lbnQubmFtZSkuZGF0YWdyaWQoKTsKCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAidHJlZSI6CgkJCQkJCXZhciB2ID0gYXR0ID8gb1thdHRdIDogKChvICYmIG8uRW50aXR5QXR0cmlidXRlKSA/ICIiIDogbyk7CgkJCQkJCWlmIChBcnJheS5pc0FycmF5KHYpKSB7CgkJCQkJCQkkKCIjIiArIHRoaXMucHJlZml4KG9FbGVtZW50KSArIG9FbGVtZW50Lm5hbWUpW3RoaXMudWlUeXBlc1tvRWxlbWVudC50eXBlXV0oInRyZWUiKS50cmVlKCJsb2FkRGF0YSIsIHYpOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJJCgiIyIgKyB0aGlzLnByZWZpeChvRWxlbWVudCkgKyBvRWxlbWVudC5uYW1lKVt0aGlzLnVpVHlwZXNbb0VsZW1lbnQudHlwZV1dKCdzZXRWYWx1ZScsIHYpOwoJCQkJCQl9CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgInNlbGVjdCI6CgkJCQkJCWlmIChhdHQpIHsKCQkJCQkJCWlmIChvRWxlbWVudC5vcHRpb25zKSB7CgkJCQkJCQkJJCgiIyIgKyB0aGlzLnByZWZpeChvRWxlbWVudCkgKyBvRWxlbWVudC5uYW1lKS5jb21ibygnc2V0VmFsdWUnICsgKG9FbGVtZW50Lm11bHRpcGxlID8gJ3MnIDogJycpLCAob1thdHRdID8gb1thdHRdIDogIiIpKTsKCQkJCQkJCQkkKCIjIiArIHRoaXMucHJlZml4KG9FbGVtZW50KSArIG9FbGVtZW50Lm5hbWUpLmNvbWJvKCdzZXRWYWx1ZScgKyAob0VsZW1lbnQubXVsdGlwbGUgPyAncycgOiAnJyksIChvW2F0dF0gPyBvW2F0dF0gOiAiIikpOwoJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQkkKCIjIiArIHRoaXMucHJlZml4KG9FbGVtZW50KSArIG9FbGVtZW50Lm5hbWUpLmNvbWJvZ3JpZCgnc2V0VmFsdWUnICsgKG9FbGVtZW50Lm11bHRpcGxlID8gJ3MnIDogJycpLCAob1thdHRdID8gb1thdHRdIDogIiIpKTsKCQkJCQkJCX0KCQkJCQkJfSBlbHNlIHsKCQkJCQkJCXYgPSBudWxsOwoJCQkJCQkJaWYgKG8gPT09IG51bGwpIHsKCgkJCQkJCQl9IGVsc2UgaWYgKG8uY29uc3RydWN0b3IgPT09IEFycmF5KSB7CgoJCQkJCQkJfSBlbHNlIGlmICghby5FbnRpdHlBdHRyaWJ1dGUpIHsKCQkJCQkJCQl2ID0gbyB8fCB7CgkJCQkJCQkJCUlkOiBvLklkLAoJCQkJCQkJCQlfVG9TdHJpbmc6IG8uX1RvU3RyaW5nLAoJCQkJCQkJCQl0b1N0cmluZzogZnVuY3Rpb24oKSB7CgkJCQkJCQkJCQlyZXR1cm4gdGhpcy5fVG9TdHJpbmc7CgkJCQkJCQkJCX0KCQkJCQkJCQl9OwoJCQkJCQkJfQoJCQkJCQkJaWYgKG9FbGVtZW50Lm9wdGlvbnMpIHsKCQkJCQkJCQkkKCIjIiArIHRoaXMucHJlZml4KG9FbGVtZW50KSArIG9FbGVtZW50Lm5hbWUpLmNvbWJvKCdzZXRWYWx1ZScgKyAob0VsZW1lbnQubXVsdGlwbGUgPyAncycgOiAnJyksIHYpOwoJCQkJCQkJCSQoIiMiICsgdGhpcy5wcmVmaXgob0VsZW1lbnQpICsgb0VsZW1lbnQubmFtZSkuY29tYm8oJ3NldFRleHQnICsgKG9FbGVtZW50Lm11bHRpcGxlID8gJ3MnIDogJycpLCB2KTsKCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJJCgiIyIgKyB0aGlzLnByZWZpeChvRWxlbWVudCkgKyBvRWxlbWVudC5uYW1lKS5jb21ib2dyaWQoJ3NldFZhbHVlJyArIChvRWxlbWVudC5tdWx0aXBsZSA/ICdzJyA6ICcnKSwgdik7CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQkJYnJlYWs7CgkJCQkJZGVmYXVsdDoKCQkJCQkJYnJlYWs7CgkJCQl9CgkJCX0gY2F0Y2ggKGV4KSB7CgkJCQljb25zb2xlLmxvZyhleCk7CgkJCX0KCQl9IGVsc2UgewoJCQlmb3IgKHZhciBwIGluIG8pIHsKCQkJCWlmIChwLmluZGV4T2YoJ18nKSA9PT0gMCkgcCA9IHAuc3Vic3RyaW5nKDEpOwoJCQkJdmFyIGUgPSB0aGlzLmJ5TmFtZShwKTsKCQkJCWlmICghZSB8fCAhZS5uYW1lKSBjb250aW51ZTsKCQkJCXZhciB2YWx1ZSA9IG9bcF07CgkJCQlpZiAoZS5uYW1lID09IHRoaXMuc1RhYmxlKSB7CgkJCQkJdmFsdWUgPSBvOwoJCQkJCXZhbHVlLkRhdGUgPSBuZXcgRGF0ZSgpOwoJCQkJfQoJCQkJaWYgKHAgPT0gIkVudGl0eVZhbHVlcyIpIHsKCQkJCQkvLyBhbiBlbXNGb3JtVmFsdWVzIHNvdXJjZQoJCQkJCS8vIGZpbmQgdGhlIEVudGl0eVZhbHVlIGZvciB0aGlzIGVsZW1lbnQgYW5kIHNldCBpdAoJCQkJCWZvciAodmFyIGogPSAwOyBqIDwgby5FbnRpdHlWYWx1ZXMubGVuZ3RoOyBqKyspIHsKCQkJCQkJaWYgKG8uRW50aXR5VmFsdWVzW2pdLkVudGl0eUF0dHJpYnV0ZS5OYW1lID09IGUubmFtZSkgewoJCQkJCQkJLy8gZm91bmQgdGhlIEVudGl0eVZhbHVlIGZvciB0aGlzIGVsZW1lbnQKCQkJCQkJCV92ID0gby5FbnRpdHlWYWx1ZXNbal07CgkJCQkJCQlmb3IgKHZhciBxIGluIF92KSB7CgkJCQkJCQkJaWYgKHEuZW5kc1dpdGgoIlZhbHVlIikpIHsKCQkJCQkJCQkJX3ZbcV0gPSB2YWx1ZTsKCQkJCQkJCQl9CgkJCQkJCQl9CgkJCQkJCQlicmVhazsKCQkJCQkJfQoJCQkJCX0KCQkJCX0KCQkJCXRoaXMuc2V0KHZhbHVlLCBlLm5hbWUpOwoJCQl9CgkJfQoJfQoKCWdldCgpIHsKCQl2YXIgbyA9IHt9OwoJCWlmICh0aGlzLnNUYWJsZSAmJiB3aW5kb3dbdGhpcy5zVGFibGVdKSBvID0gbmV3IHdpbmRvd1t0aGlzLnNUYWJsZV0oKTsKCQlmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuZWxlbWVudHMubGVuZ3RoOyBpKyspIHsKCQkJdmFyIGNuID0gbnVsbDsKCQkJdmFyIHYgPSBudWxsOwoJCQl0cnkgewoJCQkJc3dpdGNoICh0aGlzLmVsZW1lbnRzW2ldLnR5cGUpIHsKCQkJCQljYXNlICdsYWJlbCc6CgkJCQkJCWNuID0gJCgiI2xibCIgKyB0aGlzLmVsZW1lbnRzW2ldLm5hbWUpOwoJCQkJCQl2ID0gY24uaHRtbCgpOwoJCQkJCQlicmVhazsKCQkJCQljYXNlICd0ZXh0JzoKCQkJCQljYXNlICdzdHJpbmcnOgoJCQkJCWNhc2UgJ3NlYXJjaCc6CgkJCQkJY2FzZSAncGFzc3dvcmQnOgoJCQkJCQljbiA9ICQoIiMiICsgdGhpcy5wcmVmaXgodGhpcy5lbGVtZW50c1tpXSkgKyB0aGlzLmVsZW1lbnRzW2ldLm5hbWUpOwoJCQkJCQl2ID0gY24udmFsKCk7CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgImZpbGUiOgoJCQkJCWNhc2UgImltYWdlIjoKCQkJCQkJY24gPSAkKCIjIiArIHRoaXMucHJlZml4KHRoaXMuZWxlbWVudHNbaV0pICsgdGhpcy5lbGVtZW50c1tpXS5uYW1lKTsKCQkJCQkJdiA9IHRoaXMuZWxlbWVudHNbaV0uZGF0YTsKCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAiRGF0ZVRpbWUiOgoJCQkJCWNhc2UgImRhdGV0aW1lIjoKCQkJCQkJdiA9IG5ldyBEYXRlKCQoIiMiICsgdGhpcy5wcmVmaXgodGhpcy5lbGVtZW50c1tpXSkgKyB0aGlzLmVsZW1lbnRzW2ldLm5hbWUpLmRhdGV0aW1lYm94KCdnZXRWYWx1ZScpKTsKCQkJCQkJY24gPSAkKCIjIiArIHRoaXMucHJlZml4KHRoaXMuZWxlbWVudHNbaV0pICsgdGhpcy5lbGVtZW50c1tpXS5uYW1lKTsKCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAicHJvZ3Jlc3MiOgoJCQkJCQljbiA9ICQoIiMiICsgdGhpcy5wcmVmaXgodGhpcy5lbGVtZW50c1tpXSkgKyB0aGlzLmVsZW1lbnRzW2ldLm5hbWUpOwoJCQkJCQl2ID0gY24ucHJvZ3Jlc3NiYXIoJ2dldFZhbHVlJyk7CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgImludCI6CgkJCQkJY2FzZSAiaW50ZWdlciI6CgkJCQkJY2FzZSAibnVtYmVyIjoKCQkJCQljYXNlICJsb25nIjoKCQkJCQljYXNlICJMb25nIjoKCQkJCQkJY24gPSAkKCIjIiArIHRoaXMucHJlZml4KHRoaXMuZWxlbWVudHNbaV0pICsgdGhpcy5lbGVtZW50c1tpXS5uYW1lKTsKCQkJCQkJdiA9IHBhcnNlRmxvYXQoY24udmFsKCkpOwoJCQkJCQlpZiAoaXNOYU4odikpIHYgPSAwOwoJCQkJCQlicmVhazsKCQkJCQljYXNlICJncmlkIjoKCQkJCQkJY24gPSAkKCIjIiArIHRoaXMucHJlZml4KHRoaXMuZWxlbWVudHNbaV0pICsgdGhpcy5lbGVtZW50c1tpXS5uYW1lKTsKCQkJCQkJdiA9IGNuLmRhdGFncmlkKCdnZXREYXRhJyk7CgkJCQkJCXYuc2VsZWN0ZWQgPSBjbi5kYXRhZ3JpZCgiZ2V0U2VsZWN0ZWQiKTsKCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAidHJlZSI6CgkJCQkJCWNuID0gJCgiIyIgKyB0aGlzLnByZWZpeCh0aGlzLmVsZW1lbnRzW2ldKSArIHRoaXMuZWxlbWVudHNbaV0ubmFtZSk7CgkJCQkJCXYgPSBjbi5jb21ib3RyZWUoInRyZWUiKS50cmVlKCJnZXRTZWxlY3RlZCIpOwoJCQkJCQlicmVhazsKCQkJCQljYXNlICJ3aW5kb3ciOgoJCQkJCQl2ID0gdGhpcy5lbGVtZW50c1tpXS52YWx1ZTsKCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAic2VsZWN0IjoKCQkJCQkJaWYgKHRoaXMuZWxlbWVudHNbaV0ub3B0aW9ucykgewoJCQkJCQkJdiA9ICQoIiMiICsgdGhpcy5wcmVmaXgodGhpcy5lbGVtZW50c1tpXSkgKyB0aGlzLmVsZW1lbnRzW2ldLm5hbWUpLmNvbWJvZ3JpZCgnZ2V0VmFsdWUnICsgKHRoaXMuZWxlbWVudHNbaV0ubXVsdGlwbGUgPyAncycgOiAnJykpOwoJCQkJCQkJdiA9IHRoaXMuc3IoKS5ydW5TY3JpcHQodik7CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQl2ID0gJCgiIyIgKyB0aGlzLnByZWZpeCh0aGlzLmVsZW1lbnRzW2ldKSArIHRoaXMuZWxlbWVudHNbaV0ubmFtZSkuY29tYm9ncmlkKCdncmlkJykuZGF0YWdyaWQoJ2dldFNlbGVjdGlvbnMnKTsKCQkJCQkJCWlmICghdiB8fCAhdi5sZW5ndGgpIHsKCQkJCQkJCQl2ID0gJCgiIyIgKyB0aGlzLnByZWZpeCh0aGlzLmVsZW1lbnRzW2ldKSArIHRoaXMuZWxlbWVudHNbaV0ubmFtZSkuY29tYm9ncmlkKCdnZXRWYWx1ZScgKyAodGhpcy5lbGVtZW50c1tpXS5tdWx0aXBsZSA/ICdzJyA6ICcnKSk7CgkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCWlmICghdGhpcy5lbGVtZW50c1tpXS5tdWx0aXBsZSkgdiA9IHZbMF07CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQkJY24gPSAkKCIjIiArIHRoaXMucHJlZml4KHRoaXMuZWxlbWVudHNbaV0pICsgdGhpcy5lbGVtZW50c1tpXS5uYW1lKTsKCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAiYm9vbCI6CgkJCQkJCWNuID0gJCgiIyIgKyB0aGlzLnByZWZpeCh0aGlzLmVsZW1lbnRzW2ldKSArIHRoaXMuZWxlbWVudHNbaV0ubmFtZSk7CgkJCQkJCXYgPSBjbi5zd2l0Y2hidXR0b24oJ29wdGlvbnMnKS5jaGVja2VkOwoJCQkJCQlicmVhazsKCQkJCQlkZWZhdWx0OgoJCQkJCQlicmVhazsKCQkJCX0KCQkJCW9bdGhpcy5lbGVtZW50c1tpXS5uYW1lXSh2KTsKCQkJfSBjYXRjaCAoZSkgewoJCQkJLy9jb25zb2xlLmxvZyh0aGlzLmVsZW1lbnRzW2ldLm5hbWUsIGUpOwoJCQkJb1t0aGlzLmVsZW1lbnRzW2ldLm5hbWVdID0gdjsKCQkJfQoJCQlpZiAoY24pIHsKCQkJCWlmIChvLkVudGl0eVZhbHVlcykgewoJCQkJCWZvciAodmFyIGogPSAwOyBqIDwgby5FbnRpdHlWYWx1ZXMubGVuZ3RoOyBqKyspIHsKCQkJCQkJaWYgKHRoaXMuZWxlbWVudHNbaV0ubmFtZSA9PSB0aGlzLnNUYWJsZSAmJiB0aGlzLmVsZW1lbnRzW2ldLmVtc1NvdXJjZSkgby5JZCA9IHRoaXMuZWxlbWVudHNbaV0uZW1zU291cmNlLklkOwoJCQkJCQlpZiAoby5FbnRpdHlWYWx1ZXNbal0uRW50aXR5QXR0cmlidXRlLk5hbWUgPT0gdGhpcy5lbGVtZW50c1tpXS5uYW1lICYmIHRoaXMuZWxlbWVudHNbaV0uZW1zU291cmNlKSB7CgkJCQkJCQlvLkVudGl0eVZhbHVlc1tqXS5JZCA9IHRoaXMuZWxlbWVudHNbaV0uZW1zU291cmNlLklkOwoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQl9CgkJfQoJCXJldHVybiBvOwoJfQoKCWNIZWlnaHQob3B0aW9ucykgewoJCWlmIChvcHRpb25zICYmIG9wdGlvbnMuZWRpdG9yKSByZXR1cm4gd2luZG93LmlubmVySGVpZ2h0OwoJCWlmIChvcHRpb25zICYmIG9wdGlvbnMuaGVpZ2h0ICYmIHR5cGVvZihvcHRpb25zLmhlaWdodCkgPT09ICdzdHJpbmcnKSByZXR1cm4gdGhpcy5oZWlnaHQ7CgkJaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy50eXBlID09ICd3aW5kb3cnICYmICFvcHRpb25zLmhlaWdodCkgcmV0dXJuIHRoaXMuaGVpZ2h0ICogMC45OwoJCXJldHVybiBNYXRoLmZsb29yKCgob3B0aW9ucyA/IG9wdGlvbnMuaGVpZ2h0IDogbnVsbCkgfHwgKHRoaXMuaGVpZ2h0IC8gMykpKTsKCX0KCglzZWFyY2gob3B0aW9ucykgewoJCXJldHVybiB0aGlzLnN0cmluZyhvcHRpb25zKTsKCX0KCglzdHJpbmcob3B0aW9ucykgewoJCW9wdGlvbnMuaGVpZ2h0ID0gMjA7CgkJb3B0aW9ucy5zaW1wbGUgPSB0cnVlOwoJCXJldHVybiB0aGlzLnRleHQob3B0aW9ucyk7Cgl9CgoJZGF0ZXRpbWUob3B0aW9ucykgewoJCXJldHVybiBgPGlucHV0IGlkPSJkdHAke29wdGlvbnMubmFtZX0iIGNsYXNzPSJlYXN5dWktJHt0aGlzLnVpVHlwZXNbb3B0aW9ucy50eXBlXX0iIHJlcXVpcmVkPSIke29wdGlvbnMucmVxdWlyZWQgPyAndHJ1ZScgOiAnZmFsc2UnfSIgdmFsdWU9IiR7dGhpcy52YWx1ZShvcHRpb25zKX0iIHN0eWxlPSJ3aWR0aDoke3RoaXMuY1dpZHRoKG9wdGlvbnMpfXB4Ij5gOwoJfQoKCXF1ZXJ5KG9wdGlvbnMpIHsKCQlyZXR1cm4gIjxkaXYgaWQ9J3ZzIiArIG9wdGlvbnMubmFtZSArICInPjwvZGl2PiI7Cgl9CgoJRGF0ZVRpbWUob3B0aW9ucykgewoJCXJldHVybiB0aGlzLmRhdGV0aW1lKG9wdGlvbnMpOwoJfQoKCWxvbmcob3B0aW9ucykgewoJCXJldHVybiB0aGlzLmludChvcHRpb25zKTsKCX0KCglMb25nKG9wdGlvbnMpIHsKCQlyZXR1cm4gdGhpcy5sb25nKG9wdGlvbnMpOwoJfQoKCXZhbHVlKG9wdGlvbnMpIHsKCQlpZiAodHlwZW9mIG9wdGlvbnMudmFsdWUgPT09ICdmdW5jdGlvbicpIHsKCQkJdHJ5IHsKCQkJCXJldHVybiBvcHRpb25zLnZhbHVlKHRoaXMuZ2V0KCkpOwoJCQl9IGNhdGNoIChleCkgewoJCQkJY29uc29sZS5sb2coYERGb3JtLnZhbHVlKCR7b3B0aW9ucy5uYW1lfSk6ICR7ZXh9YCk7CgkJCQlyZXR1cm4gJyc7CgkJCX0KCQl9IGVsc2UgewoJCQlzd2l0Y2ggKG9wdGlvbnMudHlwZSkgewoJCQkJY2FzZSAnaW50JzoKCQkJCWNhc2UgJ3Byb2dyZXNzJzoKCQkJCQlyZXR1cm4gb3B0aW9ucy52YWx1ZSB8fCBvcHRpb25zLm1pbiB8fCAwOwoJCQkJY2FzZSAnc3RyaW5nJzoKCQkJCWNhc2UgJ3RleHQnOgoJCQkJY2FzZSAnZGF0ZXRpbWUnOgoJCQkJY2FzZSAnbGFiZWwnOgoJCQkJCXJldHVybiBvcHRpb25zLnZhbHVlIHx8ICIiOwoJCQkJZGVmYXVsdDoKCQkJCQlyZXR1cm4gb3B0aW9ucy52YWx1ZTsKCQkJfQoJCX0KCX0KCglpbnQob3B0aW9ucykgewoJCWxldCByZXQgPSBgPGlucHV0IGlkPSJudWQke29wdGlvbnMubmFtZX0iIGNsYXNzPSJlYXN5dWktJHt0aGlzLnVpVHlwZXNbb3B0aW9ucy50eXBlXX0iIHJlcXVpcmVkPSIke29wdGlvbnMucmVxdWlyZWQgPyAndHJ1ZScgOiAnZmFsc2UnfSIgdmFsdWU9IiR7dGhpcy52YWx1ZShvcHRpb25zKX0iIGRhdGEtb3B0aW9ucz0ibWluOiR7b3B0aW9ucy5taW4gfHwgMH0sbWF4OiR7b3B0aW9ucy5tYXggfHwgMTAwfSxpbmNyZW1lbnQ6JHtvcHRpb25zLmluY3JlbWVudCB8fCAxfSIgc3R5bGU9IndpZHRoOiR7dGhpcy5jV2lkdGgob3B0aW9ucyl9cHg7Ij48L2lucHV0PmA7CgkJLy9jb25zb2xlLmxvZyhyZXQpOwoJCXJldHVybiByZXQ7Cgl9CgoJbWVudShvcHRpb25zKSB7CgkJdmFyIHJldCA9ICIiOwoJCXJldCArPSAnPGRpdiBjbGFzcz0iZWFzeXVpLXBhbmVsIiBpZD0ibW51JyArIG9wdGlvbnMubmFtZSArICciIHN0eWxlPSJwYWRkaW5nOjVweDsiPlxuJzsKCQkkLmVhY2gob3B0aW9ucy5tZW51LCAoXywgbSkgPT4gcmV0ICs9IGA8YSBocmVmPSIjIiBjbGFzcz0iZWFzeXVpLSR7dGhpcy51aVR5cGVzW29wdGlvbnMudHlwZSB8fCAnbWVudSddfSIgZGF0YS1vcHRpb25zPSJtZW51OicjbW0ke20ubGFiZWwucmVwbGFjZSgvIC9nLCAnJyl9JyxpY29uQ2xzOidpY29uLSR7bS5pY29uIHx8ICdub25lJ30nIj4ke20ubGFiZWx9PC9hPlxuYCk7CgkJcmV0ICs9ICI8L2Rpdj5cbiI7CgkJbGV0IGR2ID0gbSA9PiB7CgkJCWxldCByZXQgPSAnPGRpdicgKyAobS5zdWJNZW51cyA/ICcnIDogYCBkYXRhLW9wdGlvbnM9Imljb25DbHM6J2ljb24tJHttLmljb24gfHwgJ25vbmUnfSciYCkgKyAnPlxuJzsKCQkJcmV0ICs9IG0uc3ViTWVudXMgPyAnPHNwYW4+JyArIChtLmxhYmVsIHx8IHRoaXMuZW5nbGlzaChtLmNvZGUpKSArICc8L3NwYW4+XG48ZGl2PicgOiAoYDxzcGFuIHdpZHRoPScxMDAlJyBvbmNsaWNrPScoYXN5bmMgKCkgPT4ge2xldCBtID0gJHtfRnJFTUQuX3RvSlMobSl9OyBpZihtLmFjdGlvbil7cmV0dXJuIGF3YWl0IG0uYWN0aW9uKERGb3JtLmdldCgpLCBtKTt9IGlmIChtLnN1Yk1lbnVzKSByZXR1cm47IGF3YWl0IF9GckVNRC5SZW5kZXJQYWdlKHtfY29kZTogbS5jb2RlIHx8IG0ubGFiZWwucmVwbGFjZSgvIC9nLCAiIikudG9Mb3dlckNhc2UoKX0sIG0uZGF0YSk7fSkoKSc+JHttLmxhYmVsIHx8IHRoaXMuZW5nbGlzaChtLmNvZGUpfTwvc3Bhbj5gKTsKCQkJJC5lYWNoKG0uc3ViTWVudXMsIChfLCBzKSA9PiByZXQgKz0gZHYocykpOwoJCQlyZXQgKz0gKG0uc3ViTWVudXMgPyAiPC9kaXY+XG4iIDogIiIpICsgYDwvZGl2PlxuYDsKCQkJcmV0dXJuIHJldDsKCQl9OwoJCWZvciAodmFyIGkgPSAwOyBpIDwgb3B0aW9ucy5tZW51Lmxlbmd0aDsgaSsrKSB7CgkJCXZhciBtID0gb3B0aW9ucy5tZW51W2ldOwoJCQlyZXQgKz0gJzxkaXYgaWQ9Im1tJyArIG0ubGFiZWwucmVwbGFjZSgvIC9nLCAnJykgKyAnIiBzdHlsZT0id2lkdGg6MTUwcHg7Ij4nOwoJCQlmb3IgKHZhciBqID0gMDsgaiA8IG0uc3ViTWVudXMubGVuZ3RoOyBqKyspIHsKCQkJCXZhciBzbSA9IG0uc3ViTWVudXNbal07CgkJCQlyZXQgKz0gZHYoc20pOwoJCQl9CgkJCXJldCArPSAnPC9kaXY+XG4nOwoJCX0KCQlyZXR1cm4gcmV0OwoJfQoKCWludGVnZXIob3B0aW9ucykgewoJCXJldHVybiB0aGlzLmludChvcHRpb25zKTsKCX0KCgludW1iZXIob3B0aW9ucykgewoJCXJldHVybiB0aGlzLmludChvcHRpb25zKTsKCX0KCglJbnRlZ2VyKG9wdGlvbnMpIHsKCQlyZXR1cm4gdGhpcy5pbnQob3B0aW9ucyk7Cgl9CgoJYm9vbChvcHRpb25zKSB7CgkJcmV0dXJuIGA8aW5wdXQgaWQ9IiR7dGhpcy5wcmVmaXgob3B0aW9ucyl9JHtvcHRpb25zLm5hbWV9IiBkYXRhLWRmb3JtPSJlbGVtZW50OiR7b3B0aW9ucy5uYW1lfSIgcmVxdWlyZWQ9IiR7b3B0aW9ucy5yZXF1aXJlZD8ndHJ1ZSc6J2ZhbHNlJ30iIGRhdGEtb3B0aW9ucz0nZGlzYWJsZWQ6JHtvcHRpb25zLmRpc2FibGVkPyd0cnVlJzonZmFsc2UnfSwke3RoaXMuZXZlbnRIYW5kbGVycyhvcHRpb25zKX0nIGNsYXNzPSJlYXN5dWktJHt0aGlzLnVpVHlwZXNbb3B0aW9ucy50eXBlXX0iICR7b3B0aW9ucy5jaGVja2VkPydjaGVja2VkJzonJ30gLz5gOwoJfQoKCWxhYmVsKG9wdGlvbnMpIHsKCQlyZXR1cm4gYDxzcGFuIGlkPSIke3RoaXMucHJlZml4KG9wdGlvbnMpfSR7b3B0aW9ucy5uYW1lfSIgc3R5bGU9IndpZHRoOiR7dGhpcy5jV2lkdGgob3B0aW9ucyl9cHgiIGRhdGEtb3B0aW9ucz0iZGlzYWJsZWQ6JHtvcHRpb25zLmRpc2FibGVkPyd0cnVlJzonZmFsc2UnfSI+JHt0aGlzLnZhbHVlKG9wdGlvbnMpfTwvc3Bhbj5gOwoJfQoKCXVybChvcHRpb25zKSB7CgkJcmV0dXJuIHRoaXMuc3RyaW5nKG9wdGlvbnMpLnJlcGxhY2UoIkZpZWxkQ2hhbmdlIiwgIlVSTENoYW5nZSIpOwoJfQoKCXRleHQob3B0aW9ucykgewoJCXJldHVybiBgPGlucHV0IGlkPSIke3RoaXMucHJlZml4KG9wdGlvbnMpfSR7b3B0aW9ucy5uYW1lfSIgY2xhc3M9ImVhc3l1aS0ke29wdGlvbnMuZWRpdG9yIHx8IHRoaXMudWlUeXBlc1tvcHRpb25zLnR5cGVdfSIgZGF0YS1vcHRpb25zPSdkaXNhYmxlZDoke29wdGlvbnMuZGlzYWJsZWQ/J3RydWUnOidmYWxzZSd9LCR7dGhpcy5ldmVudEhhbmRsZXJzKG9wdGlvbnMpfScgbXVsdGlsaW5lPSIke29wdGlvbnMuc2ltcGxlID8gJ2ZhbHNlJyA6ICd0cnVlJ30iIHN0eWxlPSJ3aGl0ZS1zcGFjZTpwcmUtd3JhcDt3aWR0aDoke3RoaXMuY1dpZHRoKG9wdGlvbnMpfXB4O2hlaWdodDoke3RoaXMuY0hlaWdodChvcHRpb25zKX1weCIgcmVxdWlyZWQ9IiR7b3B0aW9ucy5yZXF1aXJlZCA/ICd0cnVlJyA6ICdmYWxzZSd9IiB2YWx1ZT0iJHt0aGlzLnZhbHVlKG9wdGlvbnMpfSIgLz5gOwoJfQoKCXBhc3N3b3JkKG9wdGlvbnMpIHsKCQl2YXIgcmV0ID0gdGhpcy5zdHJpbmcob3B0aW9ucyk7CgkJcmV0ID0gcmV0LnJlcGxhY2UoJzxpbnB1dCAnLCAnPGlucHV0IHR5cGU9InBhc3N3b3JkIiAnKTsKCQlyZXR1cm4gcmV0OwoJfQoKCWZpbGUob3B0aW9ucykgewoJCXJldHVybiBgPGlucHV0IGlkPSIke3RoaXMucHJlZml4KG9wdGlvbnMpfSR7b3B0aW9ucy5uYW1lfSIgY2xhc3M9ImVhc3l1aS0ke3RoaXMudWlUeXBlc1tvcHRpb25zLnR5cGVdfSIgZGF0YS1vcHRpb25zPSJvbkNoYW5nZTpmdW5jdGlvbihuLG8pe3ZhciBzID0gJCgnIycgKyB0aGlzLmlkKS5maWxlYm94KCdvcHRpb25zJyk7IHdpbmRvdy5ERm9ybS5VcGxvYWRGaWxlKHMsIHdpbmRvdy5ERm9ybS5ieU5hbWUoJyR7b3B0aW9ucy5uYW1lfScpKTt9IiBzdHlsZT0id2lkdGg6JHt0aGlzLmNXaWR0aChvcHRpb25zKX1weCI+YDsKCX0KCglpbWFnZShvcHRpb25zKSB7CgkJcmV0dXJuIHRoaXMuZmlsZShvcHRpb25zKSArIGA8ZGl2IGlkPSJkbGcke29wdGlvbnMubmFtZX0iIGNsYXNzPSJlYXN5dWktJHt0aGlzLnVpVHlwZXNbb3B0aW9ucy50eXBlXX0iIHRpdGxlPSJJbWFnZSBQcmV2aWV3IiBkYXRhLW9wdGlvbnM9ImNsb3NlZDp0cnVlLGljb25DbHM6J2ljb24tc2F2ZScscmVzaXphYmxlOmZhbHNlLG1vZGFsOnRydWUiIHN0eWxlPSJ3aWR0aDo0MDBweDtoZWlnaHQ6MjAwcHg7cGFkZGluZzoxMHB4Ij48aW1nIGlkPSIke3RoaXMucHJlZml4KG9wdGlvbnMpfSR7b3B0aW9ucy5uYW1lfSIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIvPjwvZGl2PmA7Cgl9CgoJcHJvZ3Jlc3Mob3B0aW9ucykgewoJCWlmICghb3B0aW9ucy5oZWlnaHQpIG9wdGlvbnMuaGVpZ2h0ID0gMjA7IC8vIGZpeCBiaWcgcHJvZ3Jlc3MKCQlyZXR1cm4gYDxkaXYgaWQ9IiR7dGhpcy5wcmVmaXgob3B0aW9ucyl9JHtvcHRpb25zLm5hbWV9IiBjbGFzcz0iZWFzeXVpLSR7dGhpcy51aVR5cGVzW29wdGlvbnMudHlwZV19IiBkYXRhLW9wdGlvbnM9InZhbHVlOiR7dGhpcy52YWx1ZShvcHRpb25zKX0iIHN0eWxlPSJ3aWR0aDoke3RoaXMuY1dpZHRoKG9wdGlvbnMpfXB4O2hlaWdodDoke3RoaXMuY0hlaWdodChvcHRpb25zKX1weCI+PC9kaXY+YDsKCX0KCglmbG93Y2hhcnQob3B0aW9ucykgewoJCXJldHVybiBgPGRpdiBpZD0iZmx3JHtvcHRpb25zLm5hbWV9IiB3aWR0aD0iJHt0aGlzLmNXaWR0aChvcHRpb25zKX0iIGhlaWdodD0iJHt0aGlzLmNIZWlnaHQob3B0aW9ucyl9Ij48L2Rpdj5gOwoJfQoKCWNoYXJ0KG9wdGlvbnMpIHsKCQlyZXR1cm4gYDxkaXYgaWQ9ImNodCR7b3B0aW9ucy5uYW1lfSIgd2lkdGg9IiR7dGhpcy5jV2lkdGgob3B0aW9ucyl9IiBoZWlnaHQ9IiR7dGhpcy5jSGVpZ2h0KG9wdGlvbnMpfSI+PC9kaXY+YDsKCX0KCglmb3JtYXR0ZXIobmFtZSwgYywganNvbikgewoJCWpzb24gPSBqc29uID8gJyInIDogJyc7CgkJcmV0dXJuIGAke2pzb259KHZhbHVlLCByb3csIGluZGV4KSA9PiB7dHJ5e3ZhciBjID0gKERGb3JtLmJ5TmFtZShcYCR7bmFtZX1cYCkuY29sdW1ucyB8fCBbXSkuZmluZChjID0+IGMuZmllbGQ9PVxgJHtjLmZpZWxkfVxgKTsgcmV0dXJuIGMmJmMuZm9ybWF0P2MuZm9ybWF0KHZhbHVlLHJvdyxpbmRleCk6dmFsdWU7fWNhdGNoKGV4KXtyZXR1cm4gdmFsdWU7fSB9JHtqc29ufWA7Cgl9CgoJbWFwQ29sdW1ucyhvcHRpb25zLCBqc29uKSB7CgkJbGV0IGNUaXRsZSA9IGMgPT4gYy50aXRsZSB8fCB0aGlzLmVuZ2xpc2goYy5maWVsZCk7CgoJCXZhciBjb2xzID0gJC5ncmVwKG9wdGlvbnMuY29sdW1ucyB8fCBbXSwgYyA9PiAhYy5pZ25vcmUpOwoJCWxldCByZXQgPSAiIjsKCQlpZiAob3B0aW9ucy5tdWx0aXBsZSkgcmV0ICs9IGB7ImZpZWxkIjonY2snLCJjaGVja2JveCI6dHJ1ZX0sYDsKCQlyZXQgPSBgImZyb3plbkNvbHVtbnMiOiBbW2A7CgkJaWYgKCFvcHRpb25zLmZyb3plbikgewoJCQlyZXQgKz0gYHsiZmllbGQiOiIke29wdGlvbnMuaWRGaWVsZC5maWVsZH0iLCJ0aXRsZSI6ICIke29wdGlvbnMuaWRGaWVsZC50aXRsZX0iLCJzb3J0YWJsZSI6ICJ0cnVlIiwgImZvcm1hdHRlciI6ICR7dGhpcy5mb3JtYXR0ZXIob3B0aW9ucy5uYW1lLCBvcHRpb25zLmlkRmllbGQsIGpzb24pfX0sYDsKCQkJaWYgKG9wdGlvbnMudGV4dEZpZWxkLmZpZWxkICE9IG9wdGlvbnMuaWRGaWVsZC5maWVsZCkgcmV0ICs9IGB7ImZpZWxkIjoiJHtvcHRpb25zLnRleHRGaWVsZC5maWVsZCB8fCBvcHRpb25zLnRleHRGaWVsZC50aXRsZX0iLCJ0aXRsZSI6IiR7b3B0aW9ucy50ZXh0RmllbGQudGl0bGUgfHwgb3B0aW9ucy50ZXh0RmllbGQuZmllbGR9Iiwid2lkdGgiOiIke29wdGlvbnMudGV4dEZpZWxkLndpZHRofHwxMjB9IiwgInNvcnRhYmxlIjogInRydWUiLCAiZm9ybWF0dGVyIjogJHt0aGlzLmZvcm1hdHRlcihvcHRpb25zLm5hbWUsIG9wdGlvbnMudGV4dEZpZWxkLCBqc29uKX19YDsKCQl9IGVsc2UgewoJCQkkLm1hcCgkLmdyZXAoY29scywgYyA9PiBjLmZyb3plbiksIGMgPT4gYHsiZmllbGQiOiIke2MuZmllbGQgfHwgY1RpdGxlKGMpfSIsInRpdGxlIjoiJHtjVGl0bGUoYykgfHwgYy5maWVsZH0iLCJ3aWR0aCI6IiR7Yy53aWR0aHx8MTIwfSIsImFsaWduIjonbGVmdCcsInNvcnRhYmxlIjoidHJ1ZSIsICJmb3JtYXR0ZXIiOiAke3RoaXMuZm9ybWF0dGVyKG9wdGlvbnMubmFtZSwgYywganNvbil9fWApLmpvaW4oIiwiKTsKCQl9CgkJcmV0ICs9IGBdXSwgImNvbHVtbnMiOiBbW2A7CgkJcmV0ICs9ICQubWFwKCQuZ3JlcChjb2xzLCBjID0+ICFjLmZyb3plbiksIGMgPT4gYHsiZmllbGQiOiIke2MuZmllbGQgfHwgY1RpdGxlKGMpfSIsInRpdGxlIjoiJHtjVGl0bGUoYykgfHwgYy5maWVsZH0iLCJhbGlnbiI6ImxlZnQiLCJzb3J0YWJsZSI6InRydWUiLCAiZm9ybWF0dGVyIjogJHt0aGlzLmZvcm1hdHRlcihvcHRpb25zLm5hbWUsIGMsIGpzb24pfX1gKS5qb2luKCIsIik7CgkJcmV0ICs9ICddXSc7CgkJcmV0dXJuIHJldDsKCX0KCglzZWxlY3Qob3B0aW9ucywgdGFnID0gb3B0aW9ucy50YWcsIHR5cGUpIHsKCQlyZXR1cm4gdGhpcy5jb21ibyhvcHRpb25zLCB0YWcsIHR5cGUpOwoJfQoKCXRyZWUob3B0aW9ucykgewoJCXJldHVybiB0aGlzLnNlbGVjdChvcHRpb25zLCAic2VsZWN0Iik7Cgl9CgoJbmF2aWdhdGlvbihvcHRpb25zKSB7CgkJcmV0dXJuIHRoaXMuY29tYm8ob3B0aW9ucywgJ3VsJywgJ3RyZWUnKTsKCX0KCgljb21ibyhvcHRpb25zLCB0YWcsIHR5cGUpIHsKCQl2YXIgY29scyA9ICQuZ3JlcChvcHRpb25zLmNvbHVtbnMgfHwgW10sIGMgPT4gIWMuaWdub3JlKTsKCQl0YWcgPSB0YWcgfHwgInNlbGVjdCI7CgkJb3B0aW9ucy5pZEZpZWxkID0gJC51bmlxdWVTb3J0KFt7CgkJCWZpZWxkOiBvcHRpb25zLmlkRmllbGQsCgkJCXRpdGxlOiBvcHRpb25zLmlkRmllbGQKCQl9XS5jb25jYXQoJC5ncmVwKGNvbHMsIGMgPT4gYy5wcmltYXJ5KSwgW3sKCQkJZmllbGQ6ICdJZCcsCgkJCXRpdGxlOiAnSUQnCgkJfV0pKS5maW5kKHggPT4gdHlwZW9mKHguZmllbGQpICE9PSAidW5kZWZpbmVkIik7CgkJb3B0aW9ucy50ZXh0RmllbGQgPSAkLnVuaXF1ZVNvcnQoW3sKCQkJZmllbGQ6IG9wdGlvbnMudGV4dEZpZWxkLAoJCQl0aXRsZTogb3B0aW9ucy50ZXh0RmllbGQKCQl9XS5jb25jYXQoJC5ncmVwKGNvbHMsIGMgPT4gYy5kaXNwbGF5KSwgW3sKCQkJZmllbGQ6IGNvbXBhbnkubGlicmFyeSA/ICdfVG9TdHJpbmcnIDogJ19uYW1lJywKCQkJdGl0bGU6IG9wdGlvbnMubmFtZSwKCQl9XSkpLmZpbmQoeCA9PiB0eXBlb2YoeC5maWVsZCkgIT09ICJ1bmRlZmluZWQiKTsKCQl2YXIgZnVuID0gdHlwZSB8fCB0aGlzLmVGdW4ob3B0aW9ucyk7CgkJdmFyIGRyb3Bkb3duID0gWydjb21ib3RyZWVncmlkJywgJ2NvbWJvdHJlZScsICdjb21ib2dyaWQnLCAnc2VsZWN0J10uaW5kZXhPZihmdW4pID4gLTE7CgkJaWYgKGRyb3Bkb3duKSB0aGlzLnNlbGVjdHMucHVzaCh7CgkJCWlkOiAiY21iIiArIG9wdGlvbnMubmFtZSwKCQkJb3B0aW9uczogdGhpcy5ieU5hbWUob3B0aW9ucy5uYW1lKQoJCX0pOwoJCXRoaXMuc2VsZWN0cyA9ICQudW5pcXVlU29ydCh0aGlzLnNlbGVjdHMpOwoJCXZhciByZXQgPSBgPCR7dGFnfSBpZD0iY21iJHtvcHRpb25zLm5hbWV9IiBjbGFzcz0iZWFzeXVpLSR7ZnVufSIgc3R5bGU9Im1heC13aWR0aDoke2Ryb3Bkb3duPyc0MDBweCc6dGhpcy5jV2lkdGgob3B0aW9ucyl9OyB3aWR0aDoke3RoaXMuY1dpZHRoKG9wdGlvbnMpfXB4IiByZXF1aXJlZD0iJHsob3B0aW9ucy5yZXF1aXJlZCA/ICd0cnVlJyA6ICdmYWxzZScpfSIgZGF0YS1vcHRpb25zPSdkaXNhYmxlZDoke29wdGlvbnMuZGlzYWJsZWQ/J3RydWUnOidmYWxzZSd9LCR7dGhpcy5ldmVudEhhbmRsZXJzKG9wdGlvbnMpfSwgdmFsdWU6IiR7dGhpcy52YWx1ZShvcHRpb25zKX0iLCByb3dudW1iZXJzOiR7dHlwZW9mKG9wdGlvbnMucm93TnVtYmVycykhPT0ndW5kZWZpbmVkJz9vcHRpb25zLnJvd051bWJlcnM6KGZ1bi5pbmRleE9mKCd0cmVlJyk8LTE/J2ZhbHNlJzondHJ1ZScpfSwgcGFnaW5hdGlvbjoke3R5cGVvZihvcHRpb25zLnBhZ2luYXRpb24pIT09J3VuZGVmaW5lZCc/b3B0aW9ucy5wYWdpbmF0aW9uOihmdW4uaW5kZXhPZigndHJlZScpPC0xPydmYWxzZSc6J3RydWUnKX0sIHBhbmVsV2lkdGg6JHsyKnRoaXMuY1dpZHRoKG9wdGlvbnMpfSwgZml0Q29sdW1uczogdHJ1ZSwgc2luZ2xlU2VsZWN0OiB0cnVlLCBtdWx0aXBsZTokeyhvcHRpb25zLm11bHRpcGxlIHx8ICdmYWxzZScpfSwgaWRGaWVsZDogIiR7b3B0aW9ucy5pZEZpZWxkLmZpZWxkfSIsIGVuYWJsZUZpbHRlcjogJHtvcHRpb25zLmZpbHRlcj8ndHJ1ZSc6J2ZhbHNlJ30sIG5vd3JhcDogZmFsc2UsIHRleHRGaWVsZDogIiR7b3B0aW9ucy50ZXh0RmllbGQuZmllbGR9IiwgdHJlZUZpZWxkOiAiJHtvcHRpb25zLnRleHRGaWVsZC5maWVsZH0iLGA7CgkJaWYgKGZ1bi5pbmRleE9mKCd0cmVlJykgPT0gLTEpIHsKCQkJcmV0ICs9ICdmaXRDb2x1bW5zOiBmYWxzZSwnICsgdGhpcy5tYXBDb2x1bW5zKG9wdGlvbnMpOwoJCX0KCQlpZiAob3B0aW9ucy5kYXRhKSB7CgkJCXJldCArPSBgLGRhdGE6ICR7SlNPTi5zdHJpbmdpZnkob3B0aW9ucy5kYXRhKX1gOwoJCX0KCQlyZXQgKz0gYCc+YDsKCQlpZiAob3B0aW9ucy5vcHRpb25zKSB7CgkJCXJldCArPSAkLm1hcChvcHRpb25zLm9wdGlvbnMsIG8gPT4gYDxvcHRpb24gdmFsdWU9JyR7X0ZyRU1ELl90b0pTKG8pfSc+JHtvLm5hbWUgfHwgb308L29wdGlvbj5gKS5qb2luKCdcbicpOwoJCX0KCQlyZXQgKz0gYDwvJHt0YWd9PmA7CgkJLy8gY29uc29sZS5sb2cocmV0KTsKCQlyZXR1cm4gcmV0OwoJfQoKCWdyaWQob3B0aW9ucywgdGFnLCB0eXBlKSB7CgkJcmV0dXJuIHRoaXMuY29tYm8ob3B0aW9ucywgInRhYmxlIiwgImRhdGFncmlkIik7Cgl9CgoJdHJlZWdyaWQob3B0aW9ucykgewoJCXJldHVybiB0aGlzLmNvbWJvKG9wdGlvbnMsICd0YWJsZScsICd0cmVlJyk7Cgl9CgoJYXN5bmMgZG9MaW5rKGUsIGV2ZW50KSB7CgkJdGhpcy5idXN5KHRydWUpOwoJCXRyeSB7CgkJCWF3YWl0IGUubGlua3MuZmluZChsID0+IGwubGFiZWwgPT0gZXZlbnQudGFyZ2V0LmlubmVyVGV4dCkub25DbGljayh0aGlzLmdldCgpKTsKCQl9IGNhdGNoIChleCkgewoJCQljb25zb2xlLmxvZygiZG9MaW5rIiwgZXgpOwoJCX0KCQl0aGlzLmJ1c3koZmFsc2UpOwoJfQoKCUVkaXRlZFZhbHVlKGUpIHsKCQlyZXR1cm4gKHR5cGVvZihhY2UpICE9PSAidW5kZWZpbmVkIikgPyBhY2UuZWRpdCgncG5sJyArIGUubmFtZSkuc2Vzc2lvbi5nZXRWYWx1ZSgpIDogJyc7Cgl9CgoJYXN5bmMgUGFuT25DbG9zZShlKSB7CgkJaWYgKGUuZWRpdG9yKSB7CgkJCWUudmFsdWUgPSB0aGlzLkVkaXRlZFZhbHVlKGUpOwoJCX0KCQlpZiAoZS5jbG9zZSkgewoJCQlhd2FpdCBlLmNsb3NlKHRoaXMuZ2V0KCkpOwoJCX0KCX0KCglhc3luYyBQZW5kQWZ0ZXJPcGVuKGUpIHsKCQlpZiAoZS5lZGl0b3IgJiYgdHlwZW9mKGFjZSkgIT09ICJ1bmRlZmluZWQiKSB7CgkJCWF3YWl0IF9GckVNRC5PcGVuRWRpdG9yKCdwbmwnICsgZS5uYW1lIC8qKyAnLWNlbnRlcicqLyAsIGUubGFuZ3VhZ2UsIGUubG9hZGVyIHx8IChvID0+IGUudmFsdWUpLCBlLnNhdmVyLCB0aGlzLmdldCgpLCBlKTsKCQl9CgkJaWYgKGUub3BlbikgewoJCQlhd2FpdCBlLm9wZW4odGhpcy5nZXQoKSk7CgkJfQoJfQoKCWxpbmsob3B0aW9ucykgewoJCXJldHVybiAob3B0aW9ucy5saW5rcyB8fCBbXSkuZmlsdGVyKGwgPT4gIWwuaWdub3JlKS5tYXAobCA9PiBgPGEgaHJlZj0iIyIgY2xhc3M9ImVhc3l1aS0ke3RoaXMudWlUeXBlc1tvcHRpb25zLnR5cGVdfSIgZGF0YS1vcHRpb25zPScke3RoaXMuZXZlbnRIYW5kbGVycyhvcHRpb25zKX0sIGljb25DbHM6Imljb24tJHtsLmljb24gfHwgJ29rJ30iJz4ke2wubGFiZWx9PC9hPmApLmpvaW4oJ1xuJyk7Cgl9CgoJYXN5bmMgU2V0VHJlZURhdGEoZSwgbiwgZGF0YSkgewoJCSQuZWFjaCgkKCIjY21iIiArIGUubmFtZSlbdGhpcy5lRnVuKGUpXSgndHJlZScpLnRyZWUoImdldENoaWxkcmVuIiwgbi50YXJnZXQpLCAoXywgYykgPT4gJCgiI2NtYiIgKyBlLm5hbWUpW3RoaXMuZUZ1bihlKV0oJ3RyZWUnKS50cmVlKCJyZW1vdmUiLCBjLnRhcmdldCkpOwoJCSQoIiNjbWIiICsgZS5uYW1lKVt0aGlzLmVGdW4oZSldKCd0cmVlJykudHJlZSgiYXBwZW5kIiwgewoJCQlwYXJlbnQ6IG4udGFyZ2V0LAoJCQlkYXRhOiBkYXRhCgkJfSk7CgkJcmV0dXJuIHRydWU7Cgl9CgoJYXN5bmMgRXhwYW5kKGUsIG4pIHsKCQl0aGlzLlNldFRyZWVEYXRhKGUsIG4sIFt7CgkJCWlkOiBudWxsLAoJCQl0ZXh0OiAibG9hZGluZy4uLiIKCQl9XSk7CgkJdmFyIG9iaiA9IHt9OwoJCXZhciBwRmllbGQgPSBlLnBhcmVudEZpZWxkIHx8ICQubWFwKCQuZ3JlcChlLmNvbHVtbnMgfHwgW10sIGMgPT4gYy5wYXJlbnQpLCBjID0+IGMuZmllbGQpLmNvbmNhdChbbnVsbF0pWzBdOwoJCXZhciBpZEZpZWxkID0gJC5ncmVwKGUuY29sdW1ucyB8fCBbXSwgYyA9PiBjLnByaW1hcnkpLmNvbmNhdChlLmlkRmllbGQpWzBdLmZpZWxkOwoJCWlmIChwRmllbGQpIHsKCQkJb2JqW3BGaWVsZF0gPSB7CgkJCQlfc291cmNlOiBuLl9zb3VyY2UKCQkJfTsKCQkJaWYgKGlkRmllbGQpIHsKCQkJCW9ialtwRmllbGRdW2lkRmllbGRdID0gbi5pZDsKCQkJfSBlbHNlIHsKCQkJCW9ialtwRmllbGRdID0gbi5pZDsKCQkJfQoJCX0KCQlsZXQgZGF0YSA9IGF3YWl0IHRoaXMuX2xvYWREYXRhKHsKCQkJaWQ6ICJjbWIiICsgZS5uYW1lLAoJCQlvcHRpb25zOiBlCgkJfSwgb2JqKTsKCQl0aGlzLlNldFRyZWVEYXRhKGUsIG4sIGRhdGEpOwoJfQoKCWFzeW5jIF9sb2FkRGF0YShzLCBvLCBzdGFydCwgZW5kKSB7CgkJdmFyIG5hbWUgPSAocyAmJiBzLm9wdGlvbnMgPyAocy5vcHRpb25zLkNsYXNzID8gcy5vcHRpb25zLkNsYXNzLk5hbWUucmVwbGFjZSgnICcsICdfJykgOiAocy5vcHRpb25zLnRhYmxlIHx8IHMub3B0aW9ucy5uYW1lKSkgOiBzLm5hbWUpOwoKCQlsZXQgb1Njb3BlID0gY29tcGFueS5TY29wZSA/IHdpbmRvd1tjb21wYW55LlNjb3BlXSA6IHdpbmRvdzsKCQlvID0gbyB8fCAob1Njb3BlW25hbWVdID8gbmV3IG9TY29wZVtuYW1lXSgpIDogewoJCQlBY3RpdmU6IHRydWUsCgkJfSk7CgkJbyA9ICh0eXBlb2YgZmlsdGVycyAhPT0gInVuZGVmaW5lZCIgJiYgZmlsdGVycyAmJiBmaWx0ZXJzW25hbWVdKSA/IGZpbHRlcnNbbmFtZV0obykgOiBvOwoJCW8gPSAocyAmJiBzLm9wdGlvbnMgJiYgcy5vcHRpb25zLnNvdXJjZSA/IHMub3B0aW9ucy5zb3VyY2UobywgdGhpcy5nZXQoKSkgOiBvKTsKCQlsZXQgbmFtZXMgPSAkLnVuaXF1ZVNvcnQoW3Mub3B0aW9ucy5zZWFyY2hGaWVsZF0uY29uY2F0KCQubWFwKCQuZ3JlcChzLm9wdGlvbnMuY29sdW1ucyB8fCBbXSwgYyA9PiBjLnNlYXJjaCksIGMgPT4gYy5maWVsZCksIFsiTmFtZSJdKSk7CgkJdmFyIGZ1biA9IHRoaXMuZUZ1bihzLm9wdGlvbnMpOwoJCWlmICghb1tuYW1lc1swXV0pIG9bbmFtZXNbMF1dID0gJCgiIyIgKyBzLmlkKVtmdW5dKCdnZXRUZXh0Jyk7CgkJdmFyIGRhdGEgPSBudWxsOwoJCWlmIChzLm9wdGlvbnMubG9hZGVyKSB7CgkJCWRhdGEgPSBhd2FpdCBzLm9wdGlvbnMubG9hZGVyKHRoaXMuZ2V0KCksIHMub3B0aW9ucywgbyk7CgkJfSBlbHNlIGlmIChjb21wYW55LmxpYnJhcnkpIHsKCQkJbGV0IGxpYiA9ICcnOwoJCQlpZiAobmFtZS5pbmRleE9mKCcuJykgPiAwKSB7CgkJCQlsaWIgPSBuYW1lLnNwbGl0KCcuJylbMF0gKyAnLic7CgkJCQluYW1lID0gbmFtZS5zcGxpdCgnLicpWzFdOwoJCQl9CgoJCQlkYXRhID0gYXdhaXQgdGhpcy5zcigpLl8obGliICsgY29tcGFueS5Db2RlLnRvTG93ZXJDYXNlKCkgKyBuYW1lICsgIkZpbmRhbGwiLCBudWxsLCBvLCBudWxsLCBzdGFydCwgZW5kKTsKCQl9IGVsc2UgewoJCQkvLyBlbXMKCQkJZGF0YSA9IGF3YWl0IG8uZmluZEFsbCgpOwoJCQkvL2RhdGEgPSBhd2FpdCB3aW5kb3cuX0ZyRU1ELl9vKG51bGwsIG8pOwoJCX0KCQlpZiAocy5vcHRpb25zLnBvc3Rsb2FkKSB7CgkJCWF3YWl0IHMub3B0aW9ucy5wb3N0bG9hZChkYXRhKTsKCQl9CgkJJC5lYWNoKGRhdGEsIChpLCBkKSA9PiB7CgkJCWQuX19PV05FUiA9IHM7CgkJCSQuZWFjaChzLm9wdGlvbnMuY29sdW1ucywgKF8sIGMpID0+IHsKCQkJCWlmIChjLnZhbHVlKSB7CgkJCQkJZFtjLmZpZWxkXSA9IGMudmFsdWUoZCwgZGF0YSwgaSk7CgkJCQl9CgkJCX0pOwoJCX0pOwoJCWlmICghcy5vcHRpb25zLmNvbHVtbnMgJiYgZnVuLmluZGV4T2YoJ3RyZWUnKSA+IC0xKSB7CgkJCWRhdGEgPSAkLm1hcChkYXRhLCBkID0+IHsKCQkJCWxldCByZXQgPSB7CgkJCQkJaWQ6IGRbcy5vcHRpb25zLmlkRmllbGQuZmllbGRdLAoJCQkJCXRleHQ6IGRbcy5vcHRpb25zLnRleHRGaWVsZC5maWVsZF0sCgkJCQkJc3RhdGU6IGQuc3RhdGUgfHwgKHMub3B0aW9ucy5sb2FkZXIgPyAiZmlsZSIgOiAiY2xvc2VkIiksCgkJCQkJX3NvdXJjZTogZCwKCQkJCX07CgkJCQlyZXQuY2hpbGRyZW4gPSAocmV0LnN0YXRlID09ICJjbG9zZWQiKSA/IFt7CgkJCQkJdGV4dDogJ2xvYWRpbmcuLi4nCgkJCQl9XSA6IG51bGw7CgkJCQlyZXR1cm4gcmV0OwoJCQl9KTsKCQl9CgkJcmV0dXJuIGRhdGEgfHwgW107Cgl9CgoJYXN5bmMgZmlsbERhdGEoZywgbywgc3RhcnQsIGVuZCkgewoJCXZhciBzID0gbnVsbDsKCQlmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuc2VsZWN0cy5sZW5ndGg7IGkrKykgewoJCQlpZiAodGhpcy5zZWxlY3RzW2ldLmlkID09IGdbMF0uaWQpIHMgPSB0aGlzLnNlbGVjdHNbaV07CgkJfQoJCWlmICghcykgcmV0dXJuOwoJCXRoaXMuYnVzeSh0cnVlKTsKCQl0cnkgewoJCQl2YXIgZnVuID0gZ1swXS5jbGFzc0xpc3RbIjAiXS5yZXBsYWNlKCdlYXN5dWktJywgJycpOwoJCQl0cnkgewoJCQkJJCgiIyIgKyBzLmlkKVtmdW5dKCdncmlkJykuZGF0YWdyaWQoJ2dldFBhZ2VyJykucGFnaW5hdGlvbignbG9hZGluZycpOwoJCQl9IGNhdGNoIChleCkge30KCQkJaWYgKHMub3B0aW9ucy5ub2xvYWQpIHsKCQkJCWxldCBfZGF0YSA9IG51bGw7CgkJCQl0cnkgewoJCQkJCV9kYXRhID0gJCgiIyIgKyBzLmlkKVtmdW5dKCdncmlkJykuZGF0YWdyaWQoImdldERhdGEiKTsKCQkJCX0gY2F0Y2ggKGV4KSB7CgkJCQkJX2RhdGEgPSAkKCIjIiArIHMuaWQpW2Z1bl0oJ3RyZWUnKS50cmVlKCdnZXRSb290Jyk7CgkJCQl9CgkJCQlpZiAoX2RhdGEpIHsKCQkJCQlyZXR1cm4gdGhpcy5idXN5KGZhbHNlKTsKCQkJCX0KCQkJfQoJCQl2YXIgZGF0YSA9IGF3YWl0IHRoaXMuX2xvYWREYXRhKHMsIG8sIHN0YXJ0LCBlbmQpOwoJCQl0cnkgewoJCQkJaWYgKCQoIiMiICsgcy5pZClbZnVuXSgnZ3JpZCcpKSAkKCIjIiArIHMuaWQpW2Z1bl0oJ2dyaWQnKS5kYXRhZ3JpZCgnZ2V0UGFnZXInKS5wYWdpbmF0aW9uKCdsb2FkZWQnKTsKCQkJfSBjYXRjaCAoZXgpIHt9CgkJCXRyeSB7CgkJCQkkKCIjIiArIHMuaWQpW2Z1bl0oJ2dyaWQnKS5kYXRhZ3JpZCgnbG9hZERhdGEnLCB7CgkJCQkJdG90YWw6IGRhdGEuQ291bnQgfHwgZGF0YS5sZW5ndGgsCgkJCQkJcm93czogZGF0YSwKCQkJCX0pOwoJCQl9IGNhdGNoIChleCkgewoJCQkJJCgiIyIgKyBzLmlkKVtmdW5dKCd0cmVlJykudHJlZSgnbG9hZERhdGEnLCBkYXRhKTsKCQkJfQoJCX0gY2F0Y2ggKGV4KSB7CgkJCWNvbnNvbGUubG9nKGV4KTsKCQl9CgkJdGhpcy5idXN5KGZhbHNlKTsKCX0KCglldmVudEhhbmRsZXJzKG9wdGlvbnMpIHsKCQlpZiAoIXRoaXMuYnlOYW1lKG9wdGlvbnMubmFtZSkpIHJldHVybjsgLy8gaWYgbm90IGFuIGVsZW1lbnQsIGRvIG5vdCBydW4gdGhlIGhhbmRsZXJzCgoJCXJldHVybiB0aGlzLmV2ZW50cy5maWx0ZXIoZSA9PiBlLnR5cGUgPT0gb3B0aW9ucy50eXBlIHx8IHR5cGVvZihlLnR5cGUpID09PSAndW5kZWZpbmVkJykubWFwKGUgPT4gYCR7ZS5uYW1lfTogKCR7ZS5wYXJhbXMgfHwgJyd9KSA9PiB7dHJ5e0RGb3JtLiR7ZS5oYW5kbGVyfShERm9ybS5ieU5hbWUoIiR7b3B0aW9ucy5uYW1lfSIpIHx8ICR7X0ZyRU1ELl90b0pTKG9wdGlvbnMpfSB8fCB7bmFtZTogIiR7b3B0aW9ucy5uYW1lfSIsdHlwZTogIiR7b3B0aW9ucy50eXBlfSJ9LCAke2UucGFyYW1zfSl9Y2F0Y2goZXgpe2NvbnNvbGUubG9nKCJFdmVudCBFcnJvcjogJHtvcHRpb25zLm5hbWV9LyR7b3B0aW9ucy50eXBlfS8ke2UubmFtZX0iLCBleCk7fX1gKS5qb2luKCcsJyk7Cgl9CgoJYXN5bmMgUGFuZWxPcGVuKGUpIHsKCQlpZiAoZS5lZGl0b3IpIHJldHVybiB0cnVlOwoJCWxldCBjb250ZW50ID0gZS52YWx1ZTsKCQlpZiAoZS5sb2FkZXIpIHsKCQkJY29udGVudCA9IGF3YWl0IGUubG9hZGVyKHRoaXMuZ2V0KCkpOwoJCX0KCQlpZiAoY29udGVudCkgewoJCQl0cnkgewoJCQkJJCgiI3BubCIgKyBlLm5hbWUpLnBhbmVsKCdib2R5JykuaHRtbChjb250ZW50KTsKCQkJCWNvbnNvbGUubG9nKCJwbmwiICsgZS5uYW1lICsgIjogQ29udGVudCBWYWxpZCIpOwoJCQl9IGNhdGNoIChleCkgewoJCQkJLy9jb25zb2xlLmxvZyhleCk7CgkJCX0KCQl9CgkJcmV0dXJuIGNvbnRlbnQ7Cgl9CgoJYXN5bmMgU2VsZWN0Q2hhbmdlKG9wdGlvbnMsIHRhYikgewoJCXRoaXMuYnVzeSh0cnVlKTsKCQkkLmdyZXAodGhpcy5lbGVtZW50cywgZSA9PiBlLnR5cGUgPT0gImdyaWQiICYmIGUuZ3JvdXAgPT0gdGFiKS5mb3JFYWNoKGUgPT4gJCgiI2NtYiIgKyBlLm5hbWUpLmRhdGFncmlkKCkpOwoJCXRoaXMuYnVzeShmYWxzZSk7Cgl9CgoJYXN5bmMgRmllbGRDaGFuZ2Uob3B0aW9ucywgdmFsdWUpIHsKCQl0aGlzLmJ1c3kodHJ1ZSk7CgkJaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5jaGFuZ2UpIHsKCQkJYXdhaXQgb3B0aW9ucy5jaGFuZ2UodGhpcy5nZXQoKSwgdmFsdWUpOwoJCX0KCQl0aGlzLmJ1c3koZmFsc2UpOwoJfQoKCWFzeW5jIFVSTENoYW5nZShzLCBvcHRpb25zKSB7CgkJdGhpcy5idXN5KHRydWUpOwoJCW9wdGlvbnMuZGF0YSA9IGF3YWl0ICQuZ2V0KHMudmFsdWUpOwoJCXJldHVybiBhd2FpdCB0aGlzLkZpZWxkQ2hhbmdlKHMsIG9wdGlvbnMpOwoJfQoKCVVwbG9hZEZpbGUoZiwgb3B0aW9ucykgewoJCXdpbmRvdy5ERm9ybS5idXN5KHRydWUpOwoJCXZhciBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSgpOwoJCXZhciBmaWxlaWQgPSBNYXRoLnJhbmRvbSgpOwoJCXZhciBtZXRob2QgPSBvcHRpb25zLm1ldGhvZCB8fCAiQ29udGVudE1hbmFnZXIuY21zVXBsb2FkRmlsZSI7CgkJZm9ybURhdGEuYXBwZW5kKCdmaWxlaWQnLCBmaWxlaWQpOwoJCXZhciBmaWxlID0gJCgiIyIgKyBmLmZpbGVib3hJZClbMF0uZmlsZXNbMF07CgkJZm9ybURhdGEuYXBwZW5kKCdfX1VGSUxFJywgZmlsZSk7CgkJaWYgKG9wdGlvbnMubG9jYWwpIHsKCQkJLy8gaGFuZGxpbmcgdGhlIGZpbGUgbG9jYWxseQoJCQl2YXIgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTsKCQkJcmVhZGVyLm9ubG9hZCA9IChlKSA9PiB7CgkJCQl2YXIgZGF0YSA9IGUudGFyZ2V0LnJlc3VsdDsKCQkJCXJldCA9IGRhdGE7CgkJCQl3aW5kb3cuREZvcm0uYnlOYW1lKG9wdGlvbnMubmFtZSkuZGF0YSA9IHJldDsKCQkJCWlmIChvcHRpb25zICYmIG9wdGlvbnMudXBsb2FkKSBvcHRpb25zLnVwbG9hZCh3aW5kb3cuREZvcm0uZ2V0KCksIHJldCk7CgkJCX07CgkJCWlmIChvcHRpb25zLmJpbmFyeSkgewoJCQkJcmVhZGVyLnJlYWRBc0JpbmFyeVN0cmluZyhmaWxlKTsKCQkJfSBlbHNlIGlmIChvcHRpb25zLmRhdGF1cmwpIHsKCQkJCXJlYWRlci5yZWFkQXNEYXRhVVJMKGZpbGUpOwoJCQl9IGVsc2UgewoJCQkJcmVhZGVyLnJlYWRBc1RleHQoZmlsZSk7CgkJCX0KCQkJd2luZG93LkRGb3JtLmJ1c3koZmFsc2UpOwoJCX0gZWxzZSBpZiAobWV0aG9kKSB7CgkJCSQuYWpheCh7CgkJCQl1cmw6IHRoaXMuc3IoKS5zclVSTCArICImbWV0aG9kPSIgKyBtZXRob2QgKyAiJnNJbnB1dD0iICsgZmlsZWlkICsgIiZwcmVUYWc9JnBvc3RUYWc9IiwKCQkJCWRhdGE6IGZvcm1EYXRhLAoJCQkJLy8gVEhJUyBNVVNUIEJFIERPTkUgRk9SIEZJTEUgVVBMT0FESU5HCgkJCQljYWNoZTogZmFsc2UsCgkJCQljb250ZW50VHlwZTogZmFsc2UsCgkJCQl0eXBlOiAnUE9TVCcsCgkJCQlwcm9jZXNzRGF0YTogZmFsc2UsCgkJCQlzdWNjZXNzOiBkYXRhID0+IHsKCQkJCQl0aGlzLnNyKCkucnVuU2NyaXB0KGRhdGEpOwoJCQkJCXdpbmRvdy5ERm9ybS5ieU5hbWUob3B0aW9ucy5uYW1lKS5kYXRhID0gcmV0OwoJCQkJCWlmIChvcHRpb25zICYmIG9wdGlvbnMudXBsb2FkKSBvcHRpb25zLnVwbG9hZCh3aW5kb3cuREZvcm0uZ2V0KCksIHJldCk7CgkJCQkJd2luZG93LkRGb3JtLmJ1c3koZmFsc2UpOwoJCQkJfQoJCQl9KTsKCQl9Cgl9CgoJZUZ1bihlKSB7CgkJdHJ5IHsKCQkJaWYgKGUudHlwZSA9PSAidHJlZSIpIHsKCQkJCWlmIChlLmNvbHVtbnMpIHsKCQkJCQlyZXR1cm4gImNvbWJvdHJlZWdyaWQiOwoJCQkJfSBlbHNlIGlmICh0eXBlb2YoZS5jb21ibykgIT09ICd1bmRlZmluZWQnICYmICFlLmNvbWJvKSB7CgkJCQkJcmV0dXJuICd0cmVlJzsKCQkJCX0gZWxzZSB7CgkJCQkJcmV0dXJuICJjb21ib3RyZWUiOwoJCQkJfQoJCQl9IGVsc2UgaWYgKGUudHlwZSA9PSAnbmF2aWdhdGlvbicpIHsKCQkJCXJldHVybiAndHJlZSc7CgkJCX0gZWxzZSBpZiAoZS50eXBlID09ICJjb21ib3RyZWUiKSB7CgkJCQlyZXR1cm4gImNvbWJvdHJlZWdyaWQiOwoJCQl9IGVsc2UgaWYgKGUudHlwZSA9PSAic2VsZWN0IiAmJiBlLm9wdGlvbnMpIHsKCQkJCXJldHVybiAiY29tYm9ib3giOwoJCQl9CgkJCXJldHVybiAiY29tYm9ncmlkIjsKCQl9IGNhdGNoIChleCkgewoJCQlyZXR1cm4gImNvbWJvZ3JpZCI7CgkJfQoJfQoKCV9maWxsV2luZG93KHdpbk5hbWUsIHYsIG1hcCkgewoJCXYgPSB2IHx8IHt9OwoJCW1hcCA9IG1hcCB8fCB7fTsKCQlpZiAoQXJyYXkuaXNBcnJheShtYXApKSB7CgkJCW1hcCA9IE9iamVjdC5mcm9tRW50cmllcyhuZXcgTWFwKG1hcCkpOwoJCX0KCgkJbWFwID0gJC5leHRlbmQoe30sIG1hcCwgT2JqZWN0LmZyb21FbnRyaWVzKE9iamVjdC5rZXlzKHYpLm1hcChrID0+IFt3aW5OYW1lICsgaywga10pKSk7CgoJCWxldCBzID0ge307CgkJZm9yICh2YXIgbSBpbiBtYXApIHsKCQkJaWYgKHR5cGVvZih2W21hcFttXV0pID09PSAidW5kZWZpbmVkIikgewoJCQkJLy9jb25zb2xlLmxvZygnaXNfdW5kZWZpbmVkJywgbSwgbWFwW21dLCB2W21hcFttXV0pOwoJCQkJc1ttXSA9IG1hcFttXTsKCQkJfSBlbHNlIHsKCQkJCS8vY29uc29sZS5sb2coJ2lzX25vdF91bmRlZmluZWQnLCBtLCBtYXBbbV0sIHZbbWFwW21dXSk7CgkJCQlzW21dID0gdlttYXBbbV1dOwoJCQl9CgkJfQoJCXRoaXMuY2xlYXIod2luTmFtZSk7CgkJLy9jb25zb2xlLmxvZygicyIsIHMpOwoJCXRoaXMuc2V0KHMpOwoJCSQoIiNwbmxfIiArIHdpbk5hbWUpLndpbmRvdygib3BlbiIpOwoJfQoKCXdpbmRvd1RvRW50aXR5KG8sIGJFbXB0eSwgZ3JpZCwgcHJlZml4LCBmaWx0ZXIpIHsKCQlvID0gbyB8fCB0aGlzLmdldCgpOwoJCWZpbHRlciA9IGZpbHRlciB8fCAodiA9PiB2KTsKCQlsZXQgcmV0ID0gZ3JpZCA/IChncmlkLnNlbGVjdGVkIHx8IGdyaWQpIDogbnVsbDsKCQlpZiAoYkVtcHR5KSB7CgkJCXJldCA9IHt9OwoJCQlvID0ge307CgkJfSBlbHNlIHsKCQkJcmV0ID0gKHJldCAmJiByZXQuSWQpID8gewoJCQkJSWQ6IHJldC5JZAoJCQl9IDoge307CgkJfQoKCQl0aGlzLmVsZW1lbnRzLmZpbHRlcihlID0+IChwcmVmaXggPyBlLmdyb3VwID09IHByZWZpeCA6IHRydWUpICYmIGUudHlwZSAhPSAnbGluaycgJiYgWydfJ10uaW5kZXhPZihlLm5hbWUucmVwbGFjZShwcmVmaXgsICIiKSkgPCAwKS5mb3JFYWNoKGUgPT4gewoJCQlyZXRbZS5uYW1lLnJlcGxhY2UocHJlZml4LCAiIildID0gb1tlLm5hbWVdOwoJCQlyZXR1cm4gdHJ1ZTsKCQl9KTsKCgkJZmlsdGVyKHJldCk7CgoJCXJldHVybiByZXQ7Cgl9CgoJYmluZChvYmopIHsKCQl2YXIgb2JqQmluZCA9IChvLCBlKSA9PiB7CgkJCW9bdGhpcy5lRnVuKGUpXSh7CgkJCQlvblNob3dQYW5lbDogKCkgPT4gewoJCQkJCXRoaXMuZmlsbERhdGEoJCgiIyIgKyBlLmlkKSwgbnVsbCwgMCwgMTApOwoJCQkJfSwKCQkJCW9uQ2xpY2tSb3c6IChpbmRleCwgcm93KSA9PiB7CgkJCQkJdmFyIHMgPSByb3cgPyByb3cuX19PV05FUiA6IG51bGw7CgkJCQkJaWYgKHMgJiYgcy5vcHRpb25zLnNlbGVjdCkgewoJCQkJCQlzLm9wdGlvbnMuc2VsZWN0KHJvdyk7CgkJCQkJfQoJCQkJfQoJCQl9KTsKCQkJdHJ5IHsKCQkJCXZhciBkZyA9IG9bdGhpcy5lRnVuKGUpXSgnZ3JpZCcpOwoJCQkJLy8gZGcuZGF0YWdyaWQoJ2VuYWJsZUZpbHRlcicpCgkJCQl2YXIgc3RhdGUgPSBkZy5kYXRhKCdkYXRhZ3JpZCcpOwoJCQkJdmFyIG9wdHMgPSBzdGF0ZS5vcHRpb25zOwoJCQkJdmFyIG9uQmVmb3JlTG9hZCA9IG9wdHMub25CZWZvcmVMb2FkOwoJCQkJb3B0cy5vbkJlZm9yZUxvYWQgPSAocGFyYW0pID0+IHsKCQkJCQlzdGF0ZS5hbGxSb3dzID0gbnVsbDsKCQkJCQlyZXR1cm4gb25CZWZvcmVMb2FkLmNhbGwodGhpcywgcGFyYW0pOwoJCQkJfTsKCQkJCXZhciBwYWdlciA9IGRnLmRhdGFncmlkKCdnZXRQYWdlcicpOwoJCQkJZGcuZGF0YWdyaWQoJ2dldFBhbmVsJykucGFuZWwoewoJCQkJCUlEOiBpCgkJCQl9KTsKCQkJCXBhZ2VyLnBhZ2luYXRpb24oewoJCQkJCW9uU2VsZWN0UGFnZTogZnVuY3Rpb24ocGFnZU51bSwgcGFnZVNpemUpIHsKCQkJCQkJd2luZG93LkRGb3JtLmZpbGxEYXRhKCQoIiMiICsgd2luZG93LkRGb3JtLnNlbGVjdHNbJCh0aGlzLnBhcmVudE5vZGUpLnBhbmVsKCdvcHRpb25zJykuSURdLmlkKSwgbnVsbCwgcGFnZVNpemUgKiAocGFnZU51bSAtIDEpLCBwYWdlU2l6ZSAqIHBhZ2VOdW0pOwoJCQkJCX0KCQkJCX0pOwoJCQkJZGcuZGF0YWdyaWQoJ2xvYWREYXRhJywgc3RhdGUuZGF0YSk7CgkJCX0gY2F0Y2ggKGV4KSB7fQoJCX0KCQlpZiAob2JqKSB7CgkJCW9iakJpbmQob2JqKTsKCQl9IGVsc2UgewoJCQlmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuc2VsZWN0cy5sZW5ndGg7IGkrKykgewoJCQkJaWYgKHRoaXMuc2VsZWN0c1tpXS5vcHRpb25zLm9wdGlvbnMpIHsKCQkJCQkvLyQoIiMiICsgdGhpcy5zZWxlY3RzW2ldLmlkKS5jb21ibygpOwoJCQkJfSBlbHNlIHsKCQkJCQlvYmpCaW5kKCQoIiMiICsgdGhpcy5zZWxlY3RzW2ldLmlkKSwgdGhpcy5zZWxlY3RzW2ldKTsKCQkJCX0KCQkJfQoKCQkJdGhpcy5lbGVtZW50cy5maWx0ZXIoZSA9PiBlLndpbmRvdykuZm9yRWFjaChlID0+IHsKCQkJCWxldCB0ID0gJCgiI3RiY1dpbmRvdyIpLnRhYnMoImdldFRhYiIsIGUuZ3JvdXApOwoJCQkJaWYgKHQpIHsKCQkJCQl0LnBhbmVsKCdvcHRpb25zJykudGFiLmhpZGUoKTsKCQkJCX0KCQkJfSk7CgkJfQoJfQoKCWVuZ2xpc2gocykgewoJCWlmICghcykgcmV0dXJuICIiOwoJCXZhciByZXN1bHQgPSBzLnJlcGxhY2UoLyhbQS1aXSkvZywgIiAkMSIpOwoJCXJlc3VsdCA9IHJlc3VsdC5yZXBsYWNlKC9fL2csICcnKTsKCQlyZXR1cm4gcmVzdWx0LmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgcmVzdWx0LnNsaWNlKDEpOwoJfQoKCW9uVG9nZ2xlKGUsIGJWYWx1ZSkgewoJCWxldCBzVGFnID0gYCNmRWxlbWVudF8ke2UuZm9yLm5hbWV9ID4gLmVhc3l1aS0ke3RoaXMudWlUeXBlc1tlLmZvci50eXBlXX1gOwoJCWxldCBvVGFnID0gJChzVGFnKTsKCQllLmZvci5lbmFibGVkID0gdHlwZW9mKGJWYWx1ZSkgPT09ICJ1bmRlZmluZWQiID8gIWUuZm9yLmVuYWJsZWQgOiBiVmFsdWU7CgoJCW9UYWcucHJvcCgiZGlzYWJsZWQiLCAhZS5mb3IuZW5hYmxlZCk7CgkJLy9vVGFnW3RoaXMudWlUeXBlc1tlLmZvci50eXBlXV0oZS5mb3IuZW5hYmxlZCA/ICJlbmFibGUiIDogImRpc2FibGUiKTsKCQljb25zb2xlLmxvZyhzVGFnLCBvVGFnLCB0aGlzLnVpVHlwZXNbZS5mb3IudHlwZV0sIGUuZm9yLmVuYWJsZWQpOwoJfQoKCXJlbmRlcihuYW1lLCB0aXRsZSwgZWxlbWVudHMsIGJ1dHRvbnMsIGJGaXhlZCkgewoJCXRoaXMuZWxlbWVudHMgPSAoZWxlbWVudHMgfHwgW10pLmZpbHRlcihlID0+ICFlLmlnbm9yZSk7CgoJCXRoaXMuYnV0dG9ucyA9IGJ1dHRvbnMgfHwgW107CgkJdGhpcy5zZWxlY3RzID0gW107CgkJdGhpcy5ncmlkcyA9IFtdOwoKCQl0aGlzLmVsZW1lbnRzLmZpbHRlcihlID0+IGUudHlwZSA9PSAid2luZG93IikuZm9yRWFjaCh3ID0+IHRoaXMuZWxlbWVudHMuc3BsaWNlKHRoaXMuZWxlbWVudHMuZmluZEluZGV4KGUgPT4gZS5uYW1lID09IHcubmFtZSksIDAsIHsKCQkJbmFtZTogIl8iICsgdy5uYW1lLAoJCQl0eXBlOiAibGluayIsCgkJCXRpdGxlOiB3LnRpdGxlIHx8IHcubmFtZSwKCQkJZ3JvdXA6IHcuZ3JvdXAsCgkJCXdpbmRvdzogdy53aW5kb3csCgkJCXNlY3Rpb246IHcuc2VjdGlvbiwKCQkJbGlua3M6IFt7CgkJCQlsYWJlbDogJ09wZW4nLAoJCQkJaWNvbjogJ2VkaXQnLAoJCQkJb25DbGljazogbyA9PiAkKCIjcG5sIiArIHcubmFtZSkud2luZG93KCdvcGVuJykKCQkJfV0sCgkJfSkpOwoKCQl0aGlzLnNyKCkuZ3JvdXBCeSh0aGlzLmVsZW1lbnRzLmZpbHRlcihlID0+IGUud2luZG93KSwgImdyb3VwIikuZm9yRWFjaChrdiA9PiB7CgkJCWlmICgha3Yua2V5KSByZXR1cm47CgoJCQlsZXQgZSA9IHsKCQkJCW5hbWU6ICJfIiArIGt2LmtleSwKCQkJCXRpdGxlOiBrdi5rZXksCgkJCQl0eXBlOiAid2luZG93IiwKCQkJCWdyb3VwOiBrdi5rZXksCgkJCQl3aWR0aDogdGhpcy53aWR0aCAqIDAuOSwKCQkJCWhlaWdodDogdGhpcy5oZWlnaHQgKiAwLjksCgkJCQlsb2FkZXI6IG8gPT4gewoJCQkJCWt2LnZhbHVlcy5maWx0ZXIodiA9PiB2LnR5cGUgIT09ICdsaW5rJyB8fCAodi50eXBlID09ICdsaW5rJyAmJiB2Lm5hbWUuc3RhcnRzV2l0aCgnXycpKSkuZm9yRWFjaCh2ID0+ICQoIiNwbmxfIiArIHYuZ3JvdXAgKyAnLWNlbnRlcicpLmFwcGVuZCgkKCIjZkVsZW1lbnRfIiArIHYubmFtZSkpKTsKCQkJCQlyZXR1cm4gbnVsbDsKCQkJCX0sCgkJCQlidXR0b25zOiBbXS5jb25jYXQuYXBwbHkoW10sIGt2LnZhbHVlcy5maWx0ZXIodiA9PiB2LnR5cGUgPT0gJ2xpbmsnICYmICF2Lm5hbWUuc3RhcnRzV2l0aCgnXycpKS5tYXAodiA9PiBbLi4udi5saW5rcy5tYXAobCA9PiAoewoJCQkJCW5hbWU6IGwubmFtZSB8fCBsLmxhYmVsLAoJCQkJCXRpdGxlOiBsLnRpdGxlIHx8IGwubGFiZWwsCgkJCQkJb25DbGljazogbC5vbkNsaWNrLAoJCQkJCWljb246IGwuaWNvbiwKCQkJCQl3aW5kb3c6IHRydWUsCgkJCQkJZ3JvdXA6IGt2LmtleSwKCQkJCX0pKV0pKSwKCQkJfTsKCQkJdGhpcy5idXR0b25zLnB1c2goLi4uZS5idXR0b25zKTsKCgkJCXRoaXMuZWxlbWVudHMucHVzaChlKTsKCQl9KTsKCgkJdmFyIHJldCA9ICIiOwoJCS8vIGNoZWNrIHRoZSBvcHRpb24gb2YgdXNpbmcgd2luZG93KCkgYXMgYSByZW5kZXJlciBvZiB0aGUgbWFpbiB3aW5kb3cuLi4KCQlpZiAodHJ1ZSkgewoJCQl0aGlzLmVsZW1lbnRzLmZpbHRlcihlID0+ICFlLnpvbmUpLmZvckVhY2goZSA9PiBlLnpvbmUgPSAnY2VudGVyJyk7CgkJCWxldCB3T3B0aW9ucyA9IHsKCQkJCW5hbWU6IG5hbWUgfHwgdGhpcy5uYW1lLAoJCQkJdGl0bGU6IHRpdGxlIHx8IHRoaXMudGl0bGUsCgkJCQl0eXBlOiAnd2luZG93JywKCQkJCXZpc2libGU6IHRydWUsCgkJCQl3aWR0aDogdGhpcy53aWR0aCwKCQkJCWhlaWdodDogdGhpcy5oZWlnaHQsCgkJCQlmaXhlZDogYkZpeGVkLAoJCQkJbGlua3M6IFt7CgkJCQkJaWNvbjogImhlbHAiLAoJCQkJCWFjdGlvbjogbyA9PiAkKCIjcG5sX19Db25zb2xlIikud2luZG93KCdvcGVuJykKCQkJCX1dLAoJCQkJYnV0dG9uczogdGhpcy5idXR0b25zLmZpbHRlcihiID0+ICFiLndpbmRvdyksCgkJCX07CgkJCXRoaXMuc3IoKS5ncm91cEJ5KHRoaXMuZWxlbWVudHMsICd6b25lJykuZmlsdGVyKHpnID0+IHpnLmtleSkuZm9yRWFjaCh6ZyA9PiB7CgkJCQl3T3B0aW9uc1t6Zy5rZXldID0gdGhpcy5yZW5kZXJFbGVtZW50cyh6Zy52YWx1ZXMpOwoJCQl9KTsKCgkJCXJldCA9IHRoaXMud2luZG93KHdPcHRpb25zKTsKCQl9IGVsc2UgewoJCQlyZXQgPSB0aGlzLmhlYWRlcihuYW1lLCB0aXRsZSwgYkZpeGVkLCBbewoJCQkJaWNvbjogImhlbHAiLAoJCQkJYWN0aW9uOiBvID0+ICQoIiNwbmxfX0NvbnNvbGUiKS53aW5kb3coJ29wZW4nKQoJCQl9XSk7CgoJCQlyZXQgKz0gdGhpcy5yZW5kZXJFbGVtZW50cygpOwoKCQkJcmV0ICs9IHRoaXMuZm9vdGVyKGJGaXhlZCk7CgoJCX0KCQkvLyBjb25zb2xlLmxvZyhyZXQpOwoKCQlyZXR1cm4gcmV0OwoJfQoKCWNXaWR0aChvcHRpb25zKSB7CgkJbGV0IHJldCA9IE1hdGguZmxvb3IoKChvcHRpb25zID8gb3B0aW9ucy53aWR0aCA6IG51bGwpIHx8ICh0aGlzLndpZHRoIC8gMykpKTsKCQlpZiAob3B0aW9ucy56b25lID09ICdlYXN0JyB8fCBvcHRpb25zLnpvbmUgPT0gJ3dlc3QnKSB7CgkJCXJldCA9IDAuMjUgKiByZXQ7IC8vIDkwJSBvZiAzLzEwLCB0aGUgd2lkdGggb2YgdGhlIG5vcm1hbCBlbGVtZW50CgkJfSBlbHNlIGlmIChvcHRpb25zICYmIG9wdGlvbnMuZWRpdG9yKSB7CgkJCXJldCA9IHdpbmRvdy5pbm5lcldpZHRoOwoJCX0gZWxzZSBpZiAob3B0aW9ucyAmJiBvcHRpb25zLndpZHRoICYmIHR5cGVvZihvcHRpb25zLndpZHRoKSA9PT0gJ3N0cmluZycpIHsKCQkJcmV0ID0gdGhpcy53aWR0aDsKCQl9IGVsc2UgaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy50eXBlID09ICd3aW5kb3cnICYmICFvcHRpb25zLndpZHRoKSB7CgkJCXJldCA9IHRoaXMud2lkdGggKiAwLjk7CgkJfQoKCQkvLyBjb25zb2xlLmxvZyhvcHRpb25zLm5hbWUgKyAiOiBjV2lkdGggPSAiICsgcmV0LCBvcHRpb25zLnpvbmUpOwoJCXJldHVybiByZXQ7Cgl9CgoJd2luZG93KG9wdGlvbnMpIHsKCQlvcHRpb25zLnRpdGxlID0gb3B0aW9ucy50aXRsZSB8fCBvcHRpb25zLm5hbWU7CgkJdmFyIHJldCA9IGAKCQk8ZGl2IGlkID0gInBubCR7b3B0aW9ucy5uYW1lfSIgY2xhc3M9ImVhc3l1aS13aW5kb3ciIHRpdGxlPSIke29wdGlvbnMudGl0bGV9IiBkYXRhLW9wdGlvbnM9JyR7dGhpcy5ldmVudEhhbmRsZXJzKG9wdGlvbnMpfSwgY2xvc2VkOiR7IW9wdGlvbnMudmlzaWJsZX0sbWluaW1pemFibGU6JHshb3B0aW9ucy5maXhlZH0sbWF4aW1pemFibGU6JHshb3B0aW9ucy5maXhlZH0sY2xvc2FibGU6JHshb3B0aW9ucy5maXhlZH0sY29sbGFwc2libGU6JHshb3B0aW9ucy5maXhlZH0sZHJhZ2dhYmxlOiR7IW9wdGlvbnMuZml4ZWR9LHJlc2l6YWJsZTokeyFvcHRpb25zLmZpeGVkfSxpY29uQ2xzOiJpY29uLSR7b3B0aW9ucy5pY29ufSIsIHRvb2xzOiIjJHtvcHRpb25zLm5hbWV9X3Rvb2xzIicgc3R5bGU9IndpZHRoOiR7dGhpcy5jV2lkdGgob3B0aW9ucyl9cHg7aGVpZ2h0OiR7dGhpcy5jSGVpZ2h0KG9wdGlvbnMpfXB4O3BhZGRpbmc6MTBweDsiPgoJCSAgICA8ZGl2IGNsYXNzPSJlYXN5dWktbGF5b3V0IiBkYXRhLW9wdGlvbnM9ImZpdDp0cnVlIj4KCQlgOwoKCQlsZXQgYlpvbmUgPSBvcHRpb25zLnNvdXRoID8gJ3NvdXRoJyA6ICh0aGlzLnpvbmVzLmZpbmQoeiA9PiB6ID09ICdzb3V0aCcpIHx8IHRoaXMuem9uZXNbMF0pOwoJCW9wdGlvbnNbYlpvbmVdID0gb3B0aW9uc1tiWm9uZV0gfHwgW107CgkJbGV0IHpXaWR0aCA9IE1hdGgubWluKDEyMCwgdGhpcy53aWR0aCAqIDAuOTUgLyAob3B0aW9ucy5idXR0b25zID8gb3B0aW9ucy5idXR0b25zLmxlbmd0aCA6IDEpLCB0aGlzLmNXaWR0aChvcHRpb25zKSk7CgkJb3B0aW9uc1tiWm9uZV0ucHVzaChgPGRpdiBpZD0icG5sJHtvcHRpb25zLm5hbWV9LWJ1dHRvbnMiIGRhdGEtb3B0aW9ucz0icmVnaW9uOicke2Jab25lfScsYm9yZGVyOmZhbHNlIiBzdHlsZT0idGV4dC1hbGlnbjpyaWdodDtwYWRkaW5nOjVweCAwIDA7Ij5gICsgJC5tYXAoJC5ncmVwKG9wdGlvbnMuYnV0dG9ucyB8fCBbXSwgYiA9PiAhYi5pZ25vcmUpLCBiID0+IGA8YSBpZD0nJHtiLm5hbWV9JyBocmVmPSJqYXZhc2NyaXB0OnZvaWQoMCkiIGNsYXNzPSJlYXN5dWktbGlua2J1dHRvbiBjNiIgaWNvbkNscz0iaWNvbi0ke2IuaWNvbiB8fCAnc2F2ZSd9IiBzdHlsZT0id2lkdGg6JHt6V2lkdGh9cHgiIG9uY2xpY2s9J3dpbmRvdy5ERm9ybS5kb0NsaWNrKCR7X0ZyRU1ELl90b0pTKGIpfSknPiR7Yi50aXRsZSB8fCBiLm5hbWV9PC9hPiZuYnNwOyZuYnNwO2ApLmpvaW4oJycpICsgYDwvZGl2PmApOwoKCQl0aGlzLnpvbmVzLmZpbHRlcih6ID0+IG9wdGlvbnNbel0pLmZvckVhY2goeiA9PiB7CgkJCXJldCArPSBgCgkJICAgICAgICA8ZGl2IGRhdGEtb3B0aW9ucz0icmVnaW9uOicke3p9JyIgdGl0bGU9IiR7KHo9PSd3ZXN0JyB8fCB6PT0nZWFzdCcpPycmbmJzcDsnOicnfSIgc3R5bGU9J2hlaWdodDokeyh6PT0nbm9ydGgnfHx6PT0nc291dGgnKT8xMDoxMDB9JTt3aWR0aDokeygoej09J2Vhc3QnfHx6PT0nd2VzdCcpPzAuMToxKSp0aGlzLmNXaWR0aChvcHRpb25zKX1weCc+CiAgICAgICAgCQkgICAgJHsoQXJyYXkuaXNBcnJheShvcHRpb25zW3pdKT9vcHRpb25zW3pdOltvcHRpb25zW3pdXSkuam9pbignJyl9CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgYDsKCQl9KTsKCgkJcmV0ICs9IGA8L2Rpdj48L2Rpdj5gOwoKCQkvLyBsaW5rcyAodG9vbHMpCgkJbGV0IGxpbmtzID0gJC5ncmVwKFtdLmNvbmNhdChvcHRpb25zLmxpbmtzIHx8IFtdKSwgbCA9PiAhbC5pZ25vcmUpOwoJCXJldCArPSBgPGRpdiBpZD0iJHtvcHRpb25zLm5hbWV9X3Rvb2xzIj5gICsgJC5tYXAobGlua3MucmV2ZXJzZSgpLCBsID0+IGA8YSBocmVmPSJqYXZhc2NyaXB0OnZvaWQoMCkiIHN0eWxlPSJjb2xvcjpibGFjayIgY2xhc3M9ImZhcyBmYS0ke2wuaWNvbiB8fCAnYWRkJ30iIG9uY2xpY2s9Jyhhc3luYyAoKSA9PiB7dmFyIGEgPSAke19GckVNRC5fdG9KUyhsKX07ICQoIiNwbmwke29wdGlvbnMubmFtZX0iKS53aW5kb3coInNldFRpdGxlIiwgIiR7b3B0aW9ucy50aXRsZX06ICIgKyBhLm5hbWUpOyBhd2FpdCBhLmFjdGlvbihERm9ybS5nZXQoKSwgYSwgJHtfRnJFTUQuX3RvSlMob3B0aW9ucyl9KTsgJCgiI3BubCR7b3B0aW9ucy5uYW1lfSIpLndpbmRvdygic2V0VGl0bGUiLCAiJHtvcHRpb25zLnRpdGxlfSIpO30pKCknPjwvYT5gKS5qb2luKCdcbicpICsgYDwvZGl2PmA7CgoJCXJldHVybiByZXQ7Cgl9CgoJYXN5bmMgX2VuZCgpIHsKCQlsZXQgbyA9IHRoaXMuZ2V0KCk7CgoJCS8vIGRvIG5vdCB1c2UgdGhlIGZpcnN0IGJ1dHRvbiwgYmVjYXVzZSBtYW55IGZvcm1zIGhhdmUgYSBDYW5jZWwgYnV0dG9uIG9ubHkKCQlsZXQgYnV0dG9uID0gdGhpcy5idXR0b25zLmZpbmQoYiA9PiBiLmF1dG9TdWJtaXQpIC8qIHx8IHRoaXMuYnV0dG9uc1swXSovIDsKCQlpZiAoYnV0dG9uICYmIG8gJiYgT2JqZWN0LnZhbHVlcyhvKS5sZW5ndGggJiYgKHR5cGVvZihidXR0b24uYXV0b1N1Ym1pdCkgPT09ICJ1bmRlZmluZWQiIHx8IGJ1dHRvbi5hdXRvU3VibWl0KSkgewoJCQlsZXQgdiA9IE9iamVjdC52YWx1ZXMobykucmVkdWNlKCh0LCB2KSA9PiB7CgkJCQlyZXR1cm4gKCh0eXBlb2YodikgIT09ICJvYmplY3QiKSA/IDEgOiAwKSAqICh2ID8gMSA6IDApOwoJCQl9KTsKCQkJLy9jb25zb2xlLmxvZyhvLCBPYmplY3QudmFsdWVzKG8pLCB2KTsKCQkJaWYgKHYpIHsKCQkJCS8vIGFsbCBmaWVsZHMgaGF2ZSB2YWx1ZXMKCQkJCWF3YWl0IHRoaXMuZG9DbGljayhidXR0b24pOwoKCQkJfQoJCX0KCX0KCglmb290ZXIoYkZpeGVkKSB7CgkJcmV0dXJuIGA8L2Zvcm0+YCArIGA8ZGl2IGlkPSJkbGctYnV0dG9ucyI+YCArIHRoaXMuYnV0dG9ucy5maWx0ZXIoYiA9PiAhYi53aW5kb3cpLm1hcChiID0+IGA8YSBpZD0nJHtiLm5hbWV9JyBocmVmPSJqYXZhc2NyaXB0OnZvaWQoMCkiIGNsYXNzPSJlYXN5dWktbGlua2J1dHRvbiBjNiIgaWNvbkNscz0iaWNvbi0ke2IuaWNvbiB8fCAnc2F2ZSd9IiBzdHlsZT0id2lkdGg6JHtNYXRoLm1pbigxMjAsIHRoaXMud2lkdGggKiAwLjk1IC8gdGhpcy5idXR0b25zLmxlbmd0aCwgdGhpcy5jV2lkdGgoKSl9cHgiIG9uY2xpY2s9J3dpbmRvdy5ERm9ybS5kb0NsaWNrKCR7X0ZyRU1ELl90b0pTKGIpfSknPiR7Yi50aXRsZSB8fCBiLm5hbWV9PC9hPiZuYnNwOyZuYnNwO2ApLmpvaW4oJycpICsgIjwvZGl2PiIgKyAoYkZpeGVkID8gIiIgOiAnPC9kaXY+Jyk7Cgl9CgoJaGVhZGVyKG5hbWUsIHRpdGxlLCBiRml4ZWQsIGxpbmtzKSB7CgkJdGhpcy50aXRsZSA9IHRpdGxlIHx8IHRoaXMudGl0bGU7CgkJbmFtZSA9IG5hbWUgfHwgdGhpcy5uYW1lOwoJCXZhciByZXQgPSAnJzsKCgkJcmV0ICs9IHRoaXMud2luZG93KHsKCQkJbmFtZTogIl9fQ29uc29sZSIsCgkJCXR5cGU6ICJ3aW5kb3ciLAoJCQllZGl0b3I6IHRydWUsCgkJCWxvYWRlcjogbyA9PiB3aW5kb3cubG9ncy5zbGljZSgpLnJldmVyc2UoKS5tYXAobCA9PiBsLmRhdGUudG9JU09TdHJpbmcoKSArICI6ICIgKyBsLmFyZ3MubWFwKHMgPT4gdHlwZW9mKHMpID09PSAnb2JqZWN0JyA/ICgob2JqLCBpbmRlbnQgPSAyKSA9PiB7CgkJCQlsZXQgY2FjaGUgPSBbXTsKCQkJCWNvbnN0IHJldFZhbCA9IEpTT04uc3RyaW5naWZ5KAoJCQkJCW9iaiwKCQkJCQkoa2V5LCB2YWx1ZSkgPT4KCQkJCQl0eXBlb2YgdmFsdWUgPT09ICJvYmplY3QiICYmIHZhbHVlICE9PSBudWxsID8KCQkJCQljYWNoZS5pbmNsdWRlcyh2YWx1ZSkgPwoJCQkJCXVuZGVmaW5lZCAvLyBEdXBsaWNhdGUgcmVmZXJlbmNlIGZvdW5kLCBkaXNjYXJkIGtleQoJCQkJCToKCQkJCQljYWNoZS5wdXNoKHZhbHVlKSAmJiB2YWx1ZSAvLyBTdG9yZSB2YWx1ZSBpbiBvdXIgY29sbGVjdGlvbgoJCQkJCToKCQkJCQl2YWx1ZSwKCQkJCQlpbmRlbnQKCQkJCSk7CgkJCQljYWNoZSA9IG51bGw7CgkJCQlyZXR1cm4gcmV0VmFsOwoJCQl9KShzKSA6IHMpLmpvaW4oJywgJykpLmpvaW4oJ1xuJyksCgkJfSk7CgoJCWlmICghYkZpeGVkKSB7CgkJCWxpbmtzID0gKGxpbmtzIHx8IFtdKS5maWx0ZXIobCA9PiAhbC5pZ25vcmUpOwoJCQlsZXQgdERhdGEgPSAiIjsKCQkJaWYgKGxpbmtzLmxlbmd0aCkgewoJCQkJcmV0ICs9IGA8ZGl2IGlkPSIke3RoaXMubmFtZX1fdG9vbHMiPmAgKyBsaW5rcy5tYXAobCA9PiBgPGEgaHJlZj0iamF2YXNjcmlwdDp2b2lkKDApIiBjbGFzcz0iaWNvbi0ke2wuaWNvbn0iIG9uY2xpY2s9Jyhhc3luYyAoKSA9PiB7dmFyIGEgPSAke19GckVNRC5fdG9KUyhsKX07ICQoIiN3aW4ke3RoaXMubmFtZX0iKS53aW5kb3coInNldFRpdGxlIiwgIiR7dGhpcy50aXRsZX06ICIgKyBhLm5hbWUpOyBhd2FpdCBhLmFjdGlvbihERm9ybS5nZXQoKSk7ICQoIiN3aW4ke3RoaXMubmFtZX0iKS53aW5kb3coInNldFRpdGxlIiwgIiR7dGhpcy50aXRsZX0iKTt9KSgpJz48L2E+YCkuam9pbignXG4nKSArICI8L2Rpdj4iOwoJCQkJdERhdGEgPSBgLHRvb2xzOiIjJHt0aGlzLm5hbWV9X3Rvb2xzImA7CgkJCX0KCQkJcmV0ICs9IGA8ZGl2IGlkPSd3aW4ke3RoaXMubmFtZX0nIGNsYXNzPSdlYXN5dWktd2luZG93JyB0aXRsZT0nJHt0aGlzLnRpdGxlfScgZGF0YS1vcHRpb25zPSdpY29uQ2xzOiJpY29uLXNhdmUiICR7dERhdGF9JyBzdHlsZT0nd2lkdGg6JHt0aGlzLndpZHRofXB4O2hlaWdodDoke3RoaXMuaGVpZ2h0fXB4O3BhZGRpbmc6MTBweDsnPmA7CgkJfQoJCXJldHVybiByZXQgKyBgPGZvcm0gaWQ9ImZybSR7dGhpcy5uYW1lfSIgbWV0aG9kPSJwb3N0IiBub3ZhbGlkYXRlPmA7Cgl9CgoJcmVuZGVyRWxlbWVudHMoZWxlbWVudHMpIHsKCQllbGVtZW50cyA9IGVsZW1lbnRzIHx8IHRoaXMuZWxlbWVudHM7CgoJCXZhciB0V2lkdGggPSBNYXRoLmZsb29yKHRoaXMud2lkdGggKiAwLjk1KTsKCQl2YXIgdEhlaWdodCA9IE1hdGguZmxvb3IodGhpcy5oZWlnaHQgKiAwLjg1KTsKCgkJbGV0IHJldCA9ICcnOwoJCXZhciBnRWxlbWVudHMgPSB0aGlzLnNyKCkuZ3JvdXBCeShlbGVtZW50cywgImdyb3VwIik7CgkJaWYgKGdFbGVtZW50cy5sZW5ndGggPiAxKSByZXQgKz0gYDxkaXYgaWQ9InRiY1dpbmRvdyIgY2xhc3M9ImVhc3l1aS10YWJzIiBkYXRhLW9wdGlvbnM9JyR7dGhpcy5ldmVudEhhbmRsZXJzKHt0eXBlOiAndGFicyd9KX0nIHN0eWxlPSJ3aWR0aDoke3RXaWR0aH1weDtoZWlnaHQ6JHt0SGVpZ2h0fXB4OyI+YDsKCQlmb3IgKHZhciBnID0gMDsgZyA8IGdFbGVtZW50cy5sZW5ndGg7IGcrKykgewoJCQlpZiAoZ0VsZW1lbnRzLmxlbmd0aCA+IDEpIHJldCArPSAnPGRpdiB0aXRsZT0iJyArIChnRWxlbWVudHNbZ10ua2V5IHx8ICJNYWluIikgKyAnIiBzdHlsZT0icGFkZGluZzoyMHB4O2Rpc3BsYXk6bm9uZTsiPic7CgkJCXZhciBzRWxlbWVudHMgPSB0aGlzLnNyKCkuZ3JvdXBCeShnRWxlbWVudHNbZ10udmFsdWVzLCAic2VjdGlvbiIpOwoJCQlpZiAoc0VsZW1lbnRzLmxlbmd0aCA+IDEpIHJldCArPSAnPGRpdiBjbGFzcz0iZWFzeXVpLWFjY29yZGlvbiIgc3R5bGU9IndpZHRoOicgKyB0V2lkdGggKyAncHg7aGVpZ2h0OicgKyAvKnRIZWlnaHQqLyAiMTAwJSIgKyAncHg7Ij4nOwoJCQlmb3IgKHZhciBzID0gMDsgcyA8IHNFbGVtZW50cy5sZW5ndGg7IHMrKykgewoJCQkJcmV0ICs9IGA8ZGl2IHRpdGxlPSIke3NFbGVtZW50c1tzXS5rZXkgfHwgIiJ9IiBkYXRhLW9wdGlvbnM9Imljb25DbHM6J2ljb24tbW9yZSciIHN0eWxlPSJwYWRkaW5nOjEwcHg7Ij5gOwoJCQkJZm9yICh2YXIgaSA9IDA7IGkgPCBzRWxlbWVudHNbc10udmFsdWVzLmxlbmd0aDsgaSsrKSB7CgkJCQkJdmFyIGUgPSBzRWxlbWVudHNbc10udmFsdWVzW2ldOwoJCQkJCWlmIChlLmlnbm9yZSkgY29udGludWU7CgkJCQkJZS52YWx1ZSA9IGUudmFsdWUgfHwgdGhpcy5zcigpLiRfUkVRVUVTVChlLm5hbWUpOwoJCQkJCXJldCArPSBgPGRpdiBpZD0iZkVsZW1lbnRfJHtlLm5hbWV9IiBjbGFzcz0iZml0ZW0iIHN0eWxlPSJkaXNwbGF5OiAkeyhlLnR5cGU9PSd3aW5kb3cnIHx8IGUuaGlkZGVuKT8nbm9uZSc6Jyd9Ij5gOwoJCQkJCWlmIChlLnRvZ2dsZSkgewoJCQkJCQlyZXQgKz0gYDxhIGhyZWY9IiMiIGNsYXNzPSJlYXN5dWktbGlua2J1dHRvbiIgZGF0YS1vcHRpb25zPScke3RoaXMuZXZlbnRIYW5kbGVycyh7dHlwZTogJ3RvZ2dsZScsIGZvcjogZX0pfSxwbGFpbjp0cnVlLGljb25DbHM6Imljb24tJHtlLmljb24gfHwgJ3NlYXJjaCd9Iicgc3R5bGU9IndpZHRoOjEwMHB4O2hlaWdodDozMHB4Ij4ke2UudGl0bGUgfHwgdGhpcy5lbmdsaXNoKGUubmFtZSl9PC9hPmA7CgkJCQkJfSBlbHNlIHsKCQkJCQkJcmV0ICs9IGA8bGFiZWw+JHtlLnRpdGxlIHx8IHRoaXMuZW5nbGlzaChlLm5hbWUpfTo8L2xhYmVsPmA7CgkJCQkJfQoJCQkJCWlmIChlLnR5cGUgJiYgdGhpc1tlLnR5cGVdKSB7CgkJCQkJCXJldCArPSB0aGlzW2UudHlwZV0oZSk7CgkJCQkJfSBlbHNlIGlmIChlLnJlbmRlcikgewoJCQkJCQlyZXQgKz0gZS5yZW5kZXIoKTsKCQkJCQl9CgkJCQkJcmV0ICs9ICc8L2Rpdj4nOwoJCQkJfQoJCQkJcmV0ICs9ICc8L2Rpdj4nOwoJCQl9CgkJCWlmIChzRWxlbWVudHMubGVuZ3RoID4gMSkgcmV0ICs9ICc8L2Rpdj4nOwoJCQlpZiAoZ0VsZW1lbnRzLmxlbmd0aCA+IDEpIHJldCArPSAiPC9kaXY+IjsKCQl9CgkJaWYgKGdFbGVtZW50cy5sZW5ndGggPiAxKSByZXQgKz0gIjwvZGl2PiI7CgkJcmV0dXJuIHJldDsKCX0KCglpbmZvKG1zZykgewoJCWlmICgkLm1lc3NhZ2VyKSB7CgkJCSQubWVzc2FnZXIuYWxlcnQodGhpcy50aXRsZSwgbXNnLCAnaW5mbycpOwoJCX0gZWxzZSB7CgkJCXRoaXMuc3IoKS5TaG93TWVzc2FnZShtc2csIHRoaXMudGl0bGUpOwoJCX0KCX0KCgllcnJvcihtc2cpIHsKCQlpZiAoJC5tZXNzYWdlcikgewoJCQkkLm1lc3NhZ2VyLmFsZXJ0KHRoaXMudGl0bGUsIG1zZywgJ2Vycm9yJyk7CgkJfSBlbHNlIHsKCQkJdGhpcy5zcigpLlNob3dNZXNzYWdlKG1zZywgdGhpcy50aXRsZSk7CgkJfQoJfQoKCWJ5TmFtZShuYW1lKSB7CgkJcmV0dXJuIHRoaXMuZWxlbWVudHMuZmluZChlID0+IGUubmFtZSA9PT0gbmFtZSk7Cgl9Cn0=",
	"__keys": ["name"],
	"active": true,
	"enabled": true,
	"__trMap": []
}