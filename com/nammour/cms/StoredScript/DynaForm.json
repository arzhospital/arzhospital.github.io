{
	"Id": "b3b58056ea3ff46693bfc52eccf13ffd6c3c9e60",
	"after": null,
	"async": null,
	"before": null,
	"date": "undefined",
	"name": "DynaForm",
	"order": null,
	"remark": "dW5kZWZpbmVk",
	"script": "d2luZG93LkR5bmFGb3JtID0gY2xhc3MgewoJY29uc3RydWN0b3IoKSB7CgkJdGhpcy50aXRsZSA9ICJGb3JtIFRpdGxlIjsKCQl0aGlzLm5hbWUgPSAiZnJtRm9ybSI7CgkJdGhpcy5lbGVtZW50cyA9IFtdOwoJCXRoaXMuc2VsZWN0cyA9IFtdOwoJCXRoaXMuZ3JpZHMgPSBbXTsKCQl0aGlzLmJ1dHRvbnMgPSBbXTsKCQl0aGlzLnpvbmVzID0gWydub3J0aCcsICdzb3V0aCcsICdlYXN0JywgJ3dlc3QnLCAnY2VudGVyJ107CgkJdGhpcy5zVGFibGUgPSBudWxsOwoJCXRoaXMuYkRlYnVnID0gZmFsc2U7CgkJdGhpcy51aVR5cGVzID0gewoJCQlpbnQ6ICJudW1iZXJzcGlubmVyIiwKCQkJbWVudTogInNwbGl0YnV0dG9uIiwKCQkJZGF0ZXRpbWU6ICJkYXRldGltZWJveCIsCgkJCWJvb2w6ICJzd2l0Y2hidXR0b24iLAoJCQlmaWxlOiAiZmlsZWJveCIsCgkJCXRleHQ6ICJ0ZXh0Ym94IiwKCQkJbGFiZWw6ICJodG1sIiwKCQkJcGFzc3dvcmQ6ICJwYXNzd29yZGJveCIsCgkJCXN0cmluZzogInRleHRib3giLAoJCQlpbWFnZTogImRpYWxvZyIsCgkJCXByb2dyZXNzOiAicHJvZ3Jlc3NiYXIiLAoJCQlsaW5rOiAibGlua2J1dHRvbiIsCgkJCXRyZWU6ICJjb21ib3RyZWUiLAoJCQluYXZpZ2F0aW9uOiAidHJlZSIsCgkJCXNlYXJjaDogJ3NlYXJjaGJveCcsCgkJfTsKCQl0aGlzLmV2ZW50cyA9IFt7CgkJCW5hbWU6ICdvbkNsaWNrJywKCQkJaGFuZGxlcjogJ29uVG9nZ2xlJywKCQkJcGFyYW1zOiAnbj1ldmVudCcsCgkJCXR5cGU6ICd0b2dnbGUnLAoJCX0sIHsKCQkJbmFtZTogJ29uQ2xvc2UnLAoJCQloYW5kbGVyOiAnUGFuT25DbG9zZScsCgkJCXBhcmFtczogJ249ZXZlbnQnLAoJCQl0eXBlOiAnd2luZG93JywKCQl9LCB7CgkJCW5hbWU6ICdvblNlbGVjdCcsCgkJCWhhbmRsZXI6ICdTZWxlY3RDaGFuZ2UnLAoJCQlwYXJhbXM6ICduJywKCQkJdHlwZTogJ3RhYnMnLAoJCX0sIHsKCQkJbmFtZTogJ3NlYXJjaGVyJywKCQkJaGFuZGxlcjogJ0ZpZWxkQ2hhbmdlJywKCQkJcGFyYW1zOiAnbiwgbycsCgkJCXR5cGU6ICdzZWFyY2hib3gnLAoJCX0sIHsKCQkJbmFtZTogJ29uQmVmb3JlRXhwYW5kJywKCQkJaGFuZGxlcjogJ0V4cGFuZCcsCgkJCXBhcmFtczogJ24nLAoJCQl0eXBlOiAndHJlZScsCgkJfSwgewoJCQluYW1lOiAnb25DaGFuZ2UnLAoJCQloYW5kbGVyOiAnRmllbGRDaGFuZ2UnLAoJCQlwYXJhbXM6ICduLCBvJywKCQl9LCB7CgkJCW5hbWU6ICdvbkJlZm9yZU9wZW4nLAoJCQloYW5kbGVyOiAnUGFuZWxPcGVuJywKCQkJcGFyYW1zOiAnJywKCQkJdHlwZTogJ3dpbmRvdycsCgkJfSwgewoJCQluYW1lOiAnb25PcGVuJywKCQkJaGFuZGxlcjogJ1BlbmRBZnRlck9wZW4nLAoJCQlwYXJhbXM6ICcnLAoJCQl0eXBlOiAnd2luZG93JywKCQl9LCB7CgkJCW5hbWU6ICdvbkNsaWNrJywKCQkJaGFuZGxlcjogJ2RvTGluaycsCgkJCXBhcmFtczogJ249ZXZlbnQsIG8nLAoJCQl0eXBlOiAnbGluaycsCgkJfSwgewoJCQluYW1lOiAnb25DbGlja1JvdycsCgkJCWhhbmRsZXI6ICdGaWVsZENoYW5nZScsCgkJCXBhcmFtczogJ24sIG8nLAoJCQl0eXBlOiAnZ3JpZCcsCgkJfV07CgoJCWlmICh0eXBlb2YoJCkgIT09ICd1bmRlZmluZWQnKSAkKHdpbmRvdykucmVzaXplKHRoaXMud2luZG93UmVzaXplZCk7CgkJdGhpcy53aW5kb3dSZXNpemVkKCk7Cgl9CgoJc3IoKSB7CgkJcmV0dXJuIHR5cGVvZihfRnJFTUQpICE9PSAndW5kZWZpbmVkJyA/IF9GckVNRC5zcigpIDogd2luZG93LnNyOwoJfQoKCXBhcnNlKCkgewoJCSQucGFyc2VyLnBhcnNlKCk7Cgl9CgoJd2luZG93UmVzaXplZCgpIHsKCQl0aGlzLndpZHRoID0gd2luZG93LmlubmVyV2lkdGg7CgkJdGhpcy5oZWlnaHQgPSB3aW5kb3cuaW5uZXJIZWlnaHQgKiAwLjg7Cgl9CgoJaW5pdCgpIHsKCQl2YXIgc2VsZWN0ID0gewoJCQlpbml0OiBmdW5jdGlvbihjb250YWluZXIsIG9wdGlvbnMpIHsKCQkJCXZhciBvcCA9IG51bGw7CgkJCQl2YXIgZm9wID0gbnVsbDsKCQkJCWZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5ncmlkcy5sZW5ndGg7IGkrKykKCQkJCQlpZiAodHJ1ZSB8fCB0aGlzLmdyaWRzW2ldLmlkID09IG9wdGlvbnMuc291cmNlKSBvcCA9IHRoaXMuZ3JpZHNbaV0ub3B0aW9uczsKCQkJCWZvciAoaSA9IDA7IGkgPCBvcC5jb2x1bW5zLmxlbmd0aDsgaSsrKQoJCQkJCWlmIChvcC5jb2x1bW5zW2ldLm5hbWUgPT0gb3B0aW9ucy5maWVsZCkgZm9wID0gb3AuY29sdW1uc1tpXTsKCQkJCWZvcC53aWR0aCA9ICh0aGlzLndpZHRoIC8gMyk7CgkJCQl2YXIgZSA9ICQodGhpcy5zZWxlY3QoZm9wKSk7CgkJCQl2YXIgaW5wdXQgPSBlLmFwcGVuZFRvKGNvbnRhaW5lcik7CgkJCQlpbnB1dC5jb21ib2dyaWQoKTsKCQkJCXRoaXMuYmluZChpbnB1dCk7CgkJCQlyZXR1cm4gaW5wdXQ7CgkJCX0sCgkJCWRlc3Ryb3k6IGZ1bmN0aW9uKHRhcmdldCkgewoJCQkJJCh0YXJnZXQpLnJlbW92ZSgpOwoJCQl9LAoJCQlnZXRWYWx1ZTogZnVuY3Rpb24odGFyZ2V0KSB7CgkJCQlyZXR1cm4gJCh0YXJnZXQpLnZhbCgpOwoJCQl9LAoJCQlzZXRWYWx1ZTogZnVuY3Rpb24odGFyZ2V0LCB2YWx1ZSkgewoJCQkJJCh0YXJnZXQpLnZhbCh2YWx1ZSk7CgkJCX0sCgkJCXJlc2l6ZTogZnVuY3Rpb24odGFyZ2V0LCB3aWR0aCkgewoJCQkJJCh0YXJnZXQpLl9vdXRlcldpZHRoKHdpZHRoKTsKCQkJfQoJCX07CgkJJC5leHRlbmQoJC5mbi5kYXRhZ3JpZC5kZWZhdWx0cy5lZGl0b3JzLCB7CgkJCWRhdGV0aW1lOiB7CgkJCQlpbml0OiBmdW5jdGlvbihjb250YWluZXIsIG9wdGlvbnMpIHsKCQkJCQlvcHRpb25zLndpZHRoID0gdGhpcy5jV2lkdGgob3B0aW9ucyk7CgkJCQkJdmFyIGlucHV0ID0gJCh0aGlzLmRhdGV0aW1lKG9wdGlvbnMpKS5hcHBlbmRUbyhjb250YWluZXIpOwoJCQkJCWlucHV0LmRhdGV0aW1lYm94KCk7CgkJCQkJcmV0dXJuIGlucHV0OwoJCQkJfSwKCQkJCWRlc3Ryb3k6IGZ1bmN0aW9uKHRhcmdldCkgewoJCQkJCSQodGFyZ2V0KS5yZW1vdmUoKTsKCQkJCX0sCgkJCQlnZXRWYWx1ZTogZnVuY3Rpb24odGFyZ2V0KSB7CgkJCQkJcmV0dXJuICQodGFyZ2V0KS52YWwoKTsKCQkJCX0sCgkJCQlzZXRWYWx1ZTogZnVuY3Rpb24odGFyZ2V0LCB2YWx1ZSkgewoJCQkJCSQodGFyZ2V0KS52YWwodmFsdWUpOwoJCQkJfSwKCQkJCXJlc2l6ZTogZnVuY3Rpb24odGFyZ2V0LCB3aWR0aCkgewoJCQkJCSQodGFyZ2V0KS5fb3V0ZXJXaWR0aCh3aWR0aCk7CgkJCQl9CgkJCX0sCgkJCWNoZWNrYm94OiB7CgkJCQlpbml0OiBmdW5jdGlvbihjb250YWluZXIsIG9wdGlvbnMpIHsKCQkJCQl2YXIgaW5wdXQgPSAkKHRoaXMuYm9vbChvcHRpb25zKSkuYXBwZW5kVG8oY29udGFpbmVyKTsKCQkJCQlpbnB1dC5zd2l0Y2hidXR0b24oKTsKCQkJCQlyZXR1cm4gaW5wdXQ7CgkJCQl9LAoJCQkJZGVzdHJveTogZnVuY3Rpb24odGFyZ2V0KSB7CgkJCQkJJCh0YXJnZXQpLnJlbW92ZSgpOwoJCQkJfSwKCQkJCWdldFZhbHVlOiBmdW5jdGlvbih0YXJnZXQpIHsKCQkJCQlyZXR1cm4gJCh0YXJnZXQpLnZhbCgpOwoJCQkJfSwKCQkJCXNldFZhbHVlOiBmdW5jdGlvbih0YXJnZXQsIHZhbHVlKSB7CgkJCQkJJCh0YXJnZXQpLnZhbCh2YWx1ZSk7CgkJCQl9LAoJCQkJcmVzaXplOiBmdW5jdGlvbih0YXJnZXQsIHdpZHRoKSB7CgkJCQkJJCh0YXJnZXQpLl9vdXRlcldpZHRoKHdpZHRoKTsKCQkJCX0KCQkJfSwKCQkJY29tYm90cmVlZ3JpZDogc2VsZWN0LAoJCQlzZWxlY3Q6IHNlbGVjdCwKCQl9KTsKCX0KCglhc2socXVlc3Rpb24sIGZBbnN3ZXIgPSB2ID0+IHYsIG9wdGlvbnMpIHsKCQkkLm1lc3NhZ2VyLmNvbmZpcm0odGhpcy50aXRsZSwgcXVlc3Rpb24sIGZ1bmN0aW9uKHIpIHsKCQkJaWYgKG9wdGlvbnMpIHsKCQkJCWZvciAodmFyIGkgPSAwOyBpIDwgb3B0aW9ucy5sZW5ndGg7IGkrKykgewoJCQkJCWlmIChvcHRpb25zW2ldLmFuc3dlciA9PSByKSB7CgkJCQkJCXJldHVybiBmQW5zd2VyKG9wdGlvbnNbaV0udmFsdWUpOwoJCQkJCX0KCQkJCX0KCQkJfSBlbHNlIHsKCQkJCXJldHVybiBmQW5zd2VyKHIpOwoJCQl9CgkJfSk7Cgl9CgoJdG9wRGF0YShhciwgZ0ZpZWxkLCB2RmllbGQsIHRvcCkgewoJCWlmICghdG9wKSB7CgkJCXJldHVybiBhcjsKCQl9CgkJcmV0ID0gW107CgkJJC5lYWNoKHRoaXMuc3IoKS5ncm91cEJ5KGFyLCBnRmllbGQpLCBmdW5jdGlvbihrZXksIHZhbHVlcykgewoJCQl2YWx1ZXMudmFsdWVzLnNvcnQoKGEsIGIpID0+IHsKCQkJCWlmIChwYXJzZUZsb2F0KGFbdkZpZWxkXSkgPCBwYXJzZUZsb2F0KGJbdkZpZWxkXSkpIHsKCQkJCQlyZXR1cm4gMTsKCQkJCX0gZWxzZSBpZiAocGFyc2VGbG9hdChhW3ZGaWVsZF0pID4gcGFyc2VGbG9hdChiW3ZGaWVsZF0pKSB7CgkJCQkJcmV0dXJuIC0xOwoJCQkJfSBlbHNlIHsKCQkJCQlyZXR1cm4gMDsKCQkJCX0KCQkJfSk7CgkJCSQuZWFjaCh2YWx1ZXMudmFsdWVzLCBmdW5jdGlvbihpLCB2KSB7CgkJCQlpZiAoaSA8IHRvcCkgewoJCQkJCXJldC5wdXNoKHYpOwoJCQkJfQoJCQl9KTsKCQl9KTsKCQlyZXR1cm4gcmV0OwoJfQoKCWFzeW5jIGRvQ2xpY2soYnV0dG9uKSB7CgkJbGV0IF90aGlzID0gdHlwZW9mKHRoaXMuZG9DbGljaykgPT09ICdmdW5jdGlvbicgPyB0aGlzIDogd2luZG93LkRGb3JtOwoJCWJ1dHRvbiA9IF90aGlzLmJ1dHRvbnMuZmluZChiID0+IGIubmFtZSA9PSBidXR0b24ubmFtZSAmJiBiLmdyb3VwID09IGJ1dHRvbi5ncm91cCk7CgkJX3RoaXMuYnVzeSh0cnVlKTsKCQlfdGhpcy5zZXQoewoJCQlXb3JrUHJvZ3Jlc3NWYWx1ZTogMjAKCQl9KQoKCQl2YXIgbyA9IF90aGlzLmdldCgpOwoJCXZhciBzTWlzc2luZyA9IF90aGlzLmVsZW1lbnRzLmZpbHRlcihlID0+IChidXR0b24ud2luZG93ID8gYnV0dG9uLmdyb3VwID09IGUuZ3JvdXAgOiB0cnVlKSkuZmlsdGVyKGUgPT4gZS5yZXF1aXJlZCAmJiAhb1tlLm5hbWVdKS5tYXAoZSA9PiAiPGxpPiIgKyAoZS5sYWJlbCB8fCBlLm5hbWUpICsgIjwvbGk+Iikuam9pbigiIik7CgkJaWYgKHNNaXNzaW5nKSB7CgkJCXdpbmRvdy5fRnJFTUQuX2Vycm9yKCJNaXNzaW5nIG1hbmRhdG9yeSBmaWVsZHM6PGJyLz48dWw+IiArIHNNaXNzaW5nICsgIjwvdWw+IiwgNTAwMCk7CgkJCV90aGlzLmJ1c3koZmFsc2UpOwoJCQlyZXR1cm47CgkJfQoJCWlmIChidXR0b24ub25jbGljaykgYXdhaXQgYnV0dG9uLm9uY2xpY2sobyk7CgkJaWYgKGJ1dHRvbi5vbkNsaWNrKSBhd2FpdCBidXR0b24ub25DbGljayhvKTsKCQlfdGhpcy5idXN5KGZhbHNlKTsKCX0KCglidXN5KGJCdXN5KSB7CgkJaWYgKCFiQnVzeSkgewoJCQl2YXIgdG90YWwgPSAwOwoJCQlpZiAodHlwZW9mIG1vbWVudCAhPT0gJ3VuZGVmaW5lZCcpIHsKCQkJCXRvdGFsID0gbW9tZW50KCkuZGlmZihtb21lbnQodGhpcy5idXN5U3RhbXApLCAnc2Vjb25kcycpOwoJCQl9IGVsc2UgewoJCQkJLy8gbm8gbW9tZW50LCB1c2Ugc3RhbmRhcmQgRGF0ZQoJCQkJdG90YWwgPSAobmV3IERhdGUoKS5nZXRUaW1lKCkgLSB0aGlzLmJ1c3lTdGFtcCA/IHRoaXMuYnVzeVN0YW1wLmdldFRpbWUoKSA6IDApIC8gMTAwMCAvIDM2MDA7CgkJCX0KCQkJaWYgKHRoaXMuYkRlYnVnKSB7CgkJCQl3aW5kb3cuX0ZyRU1ELl9hbGVydCgiRXhlY3V0aW9uIFRpbWU6ICIgKyB0b3RhbCArICIgc2Vjb25kcy4iKTsKCQkJfQoJCQlkZWxldGUgdGhpcy5idXN5U3RhbXA7CgoJCQlzZXRJbnRlcnZhbCgxLCAoKSA9PiB0aGlzLlNldCh7CgkJCQlMb2FkaW5nOiAxMAoJCQl9KSk7CgkJfSBlbHNlIHsKCQkJdGhpcy5idXN5U3RhbXAgPSBuZXcgRGF0ZSgpOwoJCX0KCgkJJC5lYWNoKCQubWVyZ2UoJC5tYXAodGhpcy5idXR0b25zLCBiID0+IGIubmFtZSksICQubWFwKHRoaXMuZWxlbWVudHMuZmlsdGVyKGUgPT4gZS50eXBlID09ICdsaW5rJyksIGUgPT4gZS5uYW1lKSksIChfLCBlKSA9PiAkKCcjJyArIGUpLmxpbmtidXR0b24oYkJ1c3kgPyAnZGlzYWJsZScgOiAnZW5hYmxlJykpOwoJfQoKCXByZWZpeChlKSB7CgkJc3dpdGNoIChlLnR5cGUpIHsKCQkJY2FzZSAnbGFiZWwnOgoJCQkJcmV0dXJuICdsYmwnOwoJCQljYXNlICd0ZXh0JzoKCQkJY2FzZSAnc3RyaW5nJzoKCQkJY2FzZSAnc2VhcmNoJzoKCQkJY2FzZSAncGFzc3dvcmQnOgoJCQkJcmV0dXJuICd0eHQnOwoJCQljYXNlICJEYXRlVGltZSI6CgkJCWNhc2UgImRhdGV0aW1lIjoKCQkJCXJldHVybiAnZHRwJzsKCQkJY2FzZSAiaW50IjoKCQkJY2FzZSAiaW50ZWdlciI6CgkJCWNhc2UgIm51bWJlciI6CgkJCWNhc2UgImxvbmciOgoJCQljYXNlICJMb25nIjoKCQkJCXJldHVybiAnbnVkJzsKCQkJY2FzZSAnZmlsZSc6CgkJCQlyZXR1cm4gJ2ZpbCc7CgkJCWNhc2UgJ2ltYWdlJzoKCQkJCXJldHVybiAnaW1nJzsKCQkJY2FzZSAiYm9vbCI6CgkJCQlyZXR1cm4gJ2Noayc7CgkJCWNhc2UgIndpbmRvdyI6CgkJCQlyZXR1cm4gJ3BubCc7CgkJCWNhc2UgInByb2dyZXNzIjoKCQkJCXJldHVybiAncHJnJzsKCQkJY2FzZSAiZ3JpZCI6CgkJCWNhc2UgInRyZWUiOgoJCQljYXNlICJzZWxlY3QiOgoJCQkJcmV0dXJuICdjbWInOwoJCQlkZWZhdWx0OgoJCQkJcmV0dXJuICcnOwoJCX0KCX0KCgljbGVhcihncm91cCkgewoJCXZhciBvID0ge307CgkJJC5lYWNoKHRoaXMuZWxlbWVudHMuZmlsdGVyKGUgPT4gZ3JvdXAgPyBlLmdyb3VwID09IGdyb3VwIDogdHJ1ZSksIChfLCBlKSA9PiB7CgkJCXZhciBuYW1lID0gKGUuZW1zU291cmNlID8gIl8iIDogIiIpICsgZS5uYW1lOwoJCQlzd2l0Y2ggKGUudHlwZSkgewoJCQkJY2FzZSAndGV4dCc6CgkJCQljYXNlICdzdHJpbmcnOgoJCQkJY2FzZSAnc2VhcmNoJzoKCQkJCWNhc2UgJ3Bhc3N3b3JkJzoKCQkJCWNhc2UgIkRhdGVUaW1lIjoKCQkJCWNhc2UgImRhdGV0aW1lIjoKCQkJCQlvW25hbWVdID0gIiI7CgkJCQkJYnJlYWs7CgkJCQljYXNlICJpbnQiOgoJCQkJY2FzZSAibnVtYmVyIjoKCQkJCWNhc2UgImludGVnZXIiOgoJCQkJY2FzZSAibG9uZyI6CgkJCQljYXNlICJMb25nIjoKCQkJCWNhc2UgInByb2dyZXNzIjoKCQkJCQlvW25hbWVdID0gMDsKCQkJCQlicmVhazsKCQkJCWNhc2UgInRyZWUiOgoJCQkJY2FzZSAic2VsZWN0IjoKCQkJCQlvW25hbWVdID0gbnVsbDsKCQkJCQlicmVhazsKCQkJCWNhc2UgImdyaWQiOgoJCQkJCW9bbmFtZV0gPyBvW25hbWVdLmRhdGEgPSBbXSA6IG51bGw7CgkJCQkJYnJlYWs7CgkJCQljYXNlICJib29sIjoKCQkJCQlvW25hbWVdID0gZmFsc2U7CgkJCQkJYnJlYWs7CgkJCQlkZWZhdWx0OgoJCQkJCWJyZWFrOwoJCQl9CgkJfSk7CgkJLy9jb25zb2xlLmxvZygiY2xlYXIiLCBvKTsKCQl0aGlzLnNldChvKTsKCQl0aGlzLmJ1c3koZmFsc2UpOwoJfQoKCXNldChvLCBlTmFtZSkgewoJCWlmIChlTmFtZSkgewoJCQl2YXIgb0VsZW1lbnQgPSB0aGlzLmJ5TmFtZShlTmFtZSk7CgkJCWlmICghb0VsZW1lbnQpIHJldHVybjsKCQkJdmFyIGF0dCA9IG51bGw7CgkJCWlmIChvICYmIG8uSWQgJiYgby5FbnRpdHlBdHRyaWJ1dGUpIHsKCQkJCS8vIGFuIEVudGl0eVZhbHVlCgkJCQlmb3IgKHZhciBwIGluIG8pCgkJCQkJaWYgKHAuZW5kc1dpdGgoIlZhbHVlIikpIGF0dCA9IHA7CgkJCQlvRWxlbWVudC5lbXNTb3VyY2UgPSBvOwoJCQl9CgkJCXRyeSB7CgkJCQlsZXQgZU5hbWUgPSAiIyIgKyB0aGlzLnByZWZpeChvRWxlbWVudCkgKyBvRWxlbWVudC5uYW1lOwoJCQkJbGV0IGVUeXBlID0gdGhpcy51aVR5cGVzW29FbGVtZW50LnR5cGVdOwoJCQkJLy8gY29uc29sZS5sb2coIkR5bmFGb3JtOjpzZXQoIiArIG9FbGVtZW50Lm5hbWUgKyAiKTogIiwgZU5hbWUsIGVUeXBlLCBvKTsKCQkJCXN3aXRjaCAob0VsZW1lbnQudHlwZSkgewoJCQkJCWNhc2UgJ2xhYmVsJzoKCQkJCQkJaWYgKGF0dCkgewoJCQkJCQkJJChlTmFtZSkuaHRtbChvW2F0dF0pOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJJChlTmFtZSkuaHRtbCgobyAmJiBvLkVudGl0eUF0dHJpYnV0ZSkgPyAiIiA6IG8pOwoJCQkJCQl9CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgJ3RleHQnOgoJCQkJCWNhc2UgJ3N0cmluZyc6CgkJCQkJY2FzZSAncGFzc3dvcmQnOgoJCQkJCWNhc2UgImludCI6CgkJCQkJY2FzZSAic2VhcmNoIjoKCQkJCQljYXNlICJpbnRlZ2VyIjoKCQkJCQljYXNlICJudW1iZXIiOgoJCQkJCWNhc2UgImxvbmciOgoJCQkJCWNhc2UgIkxvbmciOgoJCQkJCQlpZiAoYXR0KSB7CgkJCQkJCQkkKGVOYW1lKVtlVHlwZV0oInNldFZhbHVlIiwgb1thdHRdKTsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCSQoZU5hbWUpW2VUeXBlXSgic2V0VmFsdWUiLCAobyAmJiBvLkVudGl0eUF0dHJpYnV0ZSkgPyAiIiA6IG8pOwoJCQkJCQl9CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgIkRhdGVUaW1lIjoKCQkJCQljYXNlICJkYXRldGltZSI6CgkJCQkJCWlmIChhdHQpIHsKCQkJCQkJCSQoZU5hbWUpW2VUeXBlXSgnc2V0VmFsdWUnLCAob1thdHRdID8gdGhpcy5zcigpLnRvRGF0ZVRpbWUob1thdHRdKSA6ICIiKSk7CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQkkKGVOYW1lKVtlVHlwZV0oJ3NldFZhbHVlJywgKG8gJiYgby5FbnRpdHlBdHRyaWJ1dGUpID8gIiIgOiAobyA/IHRoaXMuc3IoKS50b0RhdGVUaW1lKG8pIDogIiIpKTsKCQkJCQkJfQoJCQkJCQlicmVhazsKCQkJCQljYXNlICJib29sIjoKCQkJCQkJaWYgKGF0dCkgewoJCQkJCQkJJChlTmFtZSlbZVR5cGVdKChvW2F0dF0gPyAnJyA6ICd1bicpICsgJ2NoZWNrJyk7CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQkkKGVOYW1lKVtlVHlwZV0oKCgobyAmJiBvLkVudGl0eUF0dHJpYnV0ZSkgPyAiIiA6IG8pID8gJycgOiAndW4nKSArICdjaGVjaycpOwoJCQkJCQl9CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgIndpbmRvdyI6CgkJCQkJCWlmIChhdHQpIHsKCQkJCQkJCW9FbGVtZW50LnZhbHVlID0gb1thdHRdOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJb0VsZW1lbnQudmFsdWUgPSAobyAmJiBvLkVudGl0eUF0dHJpYnV0ZSkgPyAiIiA6IG87CgkJCQkJCX0KCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAicHJvZ3Jlc3MiOgoJCQkJCQl2YXIgdiA9IDA7CgkJCQkJCWlmIChhdHQpIHsKCQkJCQkJCXYgPSBvW2F0dF07CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQl2ID0gKG8gJiYgby5FbnRpdHlBdHRyaWJ1dGUpID8gIiIgOiBvOwoJCQkJCQl9CgkJCQkJCS8vY29uc29sZS5sb2coIiMiICsgdGhpcy5wcmVmaXgob0VsZW1lbnQpICsgb0VsZW1lbnQubmFtZSwgdGhpcy51aVR5cGVzW29FbGVtZW50LnR5cGVdLCBNYXRoLnJvdW5kKHYgKiAxMCkgLyAxMCk7CgkJCQkJCSQoZU5hbWUpW2VUeXBlXSgnc2V0VmFsdWUnLCBNYXRoLnJvdW5kKHYgKiAxMCkgLyAxMCk7CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgImdyaWQiOgoJCQkJCQlsZXQgY29scyA9IEpTT04ucGFyc2UoInsiICsgdGhpcy5tYXBDb2x1bW5zKG9FbGVtZW50LCB0cnVlKSArICJ9Iik7CgkJCQkJCSQuZWFjaChjb2xzLmNvbHVtbnNbMF0sIChfLCBjKSA9PiBjLmZvcm1hdHRlciA9IHRoaXMuc3IoKS5ydW5TY3JpcHQodGhpcy5mb3JtYXR0ZXIob0VsZW1lbnQubmFtZSwgYykpKTsKCQkJCQkJJChlTmFtZSkuZGF0YWdyaWQoY29scyk7CgkJCQkJCWlmIChhdHQpIHsKCQkJCQkJCSQoZU5hbWUpLmRhdGFncmlkKHsKCQkJCQkJCQlkYXRhOiBvW2F0dF0KCQkJCQkJCX0pOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJJChlTmFtZSkuZGF0YWdyaWQoewoJCQkJCQkJCWRhdGE6IChvICYmIG8uRW50aXR5QXR0cmlidXRlKSA/ICIiIDogbwoJCQkJCQkJfSk7CgkJCQkJCX0KCQkJCQkJJChlTmFtZSkuZGF0YWdyaWQoInVuc2VsZWN0QWxsIik7CgkJCQkJCSQoZU5hbWUpLmRhdGFncmlkKCk7CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgInRyZWUiOgoJCQkJCQl2YXIgdiA9IGF0dCA/IG9bYXR0XSA6ICgobyAmJiBvLkVudGl0eUF0dHJpYnV0ZSkgPyAiIiA6IG8pOwoJCQkJCQlpZiAoQXJyYXkuaXNBcnJheSh2KSkgewoJCQkJCQkJJChlTmFtZSlbZVR5cGVdKCJ0cmVlIikudHJlZSgibG9hZERhdGEiLCB2KTsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCSQoZU5hbWUpW2VUeXBlXSgnc2V0VmFsdWUnLCB2KTsKCQkJCQkJfQoJCQkJCQlicmVhazsKCQkJCQljYXNlICJzZWxlY3QiOgoJCQkJCQlpZiAoYXR0KSB7CgkJCQkJCQlpZiAob0VsZW1lbnQub3B0aW9ucykgewoJCQkJCQkJCSQoZU5hbWUpLmNvbWJvKCdzZXRWYWx1ZScgKyAob0VsZW1lbnQubXVsdGlwbGUgPyAncycgOiAnJyksIChvW2F0dF0gPyBvW2F0dF0gOiAiIikpOwoJCQkJCQkJCSQoZU5hbWUpLmNvbWJvKCdzZXRWYWx1ZScgKyAob0VsZW1lbnQubXVsdGlwbGUgPyAncycgOiAnJyksIChvW2F0dF0gPyBvW2F0dF0gOiAiIikpOwoJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQkkKGVOYW1lKS5jb21ib2dyaWQoJ3NldFZhbHVlJyArIChvRWxlbWVudC5tdWx0aXBsZSA/ICdzJyA6ICcnKSwgKG9bYXR0XSA/IG9bYXR0XSA6ICIiKSk7CgkJCQkJCQl9CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQl2ID0gbnVsbDsKCQkJCQkJCWlmIChvID09PSBudWxsKSB7CgoJCQkJCQkJfSBlbHNlIGlmIChvLmNvbnN0cnVjdG9yID09PSBBcnJheSkgewoKCQkJCQkJCX0gZWxzZSBpZiAoIW8uRW50aXR5QXR0cmlidXRlKSB7CgkJCQkJCQkJdiA9IG8gfHwgewoJCQkJCQkJCQlJZDogby5JZCwKCQkJCQkJCQkJX1RvU3RyaW5nOiBvLl9Ub1N0cmluZywKCQkJCQkJCQkJdG9TdHJpbmc6IGZ1bmN0aW9uKCkgewoJCQkJCQkJCQkJcmV0dXJuIHRoaXMuX1RvU3RyaW5nOwoJCQkJCQkJCQl9CgkJCQkJCQkJfTsKCQkJCQkJCX0KCQkJCQkJCWlmIChvRWxlbWVudC5vcHRpb25zKSB7CgkJCQkJCQkJJChlTmFtZSkuY29tYm8oJ3NldFZhbHVlJyArIChvRWxlbWVudC5tdWx0aXBsZSA/ICdzJyA6ICcnKSwgdik7CgkJCQkJCQkJJChlTmFtZSkuY29tYm8oJ3NldFRleHQnICsgKG9FbGVtZW50Lm11bHRpcGxlID8gJ3MnIDogJycpLCB2KTsKCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJJChlTmFtZSkuY29tYm9ncmlkKCdzZXRWYWx1ZScgKyAob0VsZW1lbnQubXVsdGlwbGUgPyAncycgOiAnJyksIHYpOwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJCWJyZWFrOwoJCQkJCWRlZmF1bHQ6CgkJCQkJCWJyZWFrOwoJCQkJfQoJCQl9IGNhdGNoIChleCkgewoJCQkJY29uc29sZS5sb2coZXgpOwoJCQl9CgkJfSBlbHNlIHsKCQkJZm9yICh2YXIgcCBpbiBvKSB7CgkJCQlpZiAocC5pbmRleE9mKCdfJykgPT09IDApIHAgPSBwLnN1YnN0cmluZygxKTsKCQkJCXZhciBlID0gdGhpcy5ieU5hbWUocCk7CgkJCQlpZiAoIWUgfHwgIWUubmFtZSkgY29udGludWU7CgkJCQl2YXIgdmFsdWUgPSBvW3BdOwoJCQkJaWYgKGUubmFtZSA9PSB0aGlzLnNUYWJsZSkgewoJCQkJCXZhbHVlID0gbzsKCQkJCQl2YWx1ZS5EYXRlID0gbmV3IERhdGUoKTsKCQkJCX0KCQkJCWlmIChwID09ICJFbnRpdHlWYWx1ZXMiKSB7CgkJCQkJLy8gYW4gZW1zRm9ybVZhbHVlcyBzb3VyY2UKCQkJCQkvLyBmaW5kIHRoZSBFbnRpdHlWYWx1ZSBmb3IgdGhpcyBlbGVtZW50IGFuZCBzZXQgaXQKCQkJCQlmb3IgKHZhciBqID0gMDsgaiA8IG8uRW50aXR5VmFsdWVzLmxlbmd0aDsgaisrKSB7CgkJCQkJCWlmIChvLkVudGl0eVZhbHVlc1tqXS5FbnRpdHlBdHRyaWJ1dGUuTmFtZSA9PSBlLm5hbWUpIHsKCQkJCQkJCS8vIGZvdW5kIHRoZSBFbnRpdHlWYWx1ZSBmb3IgdGhpcyBlbGVtZW50CgkJCQkJCQlfdiA9IG8uRW50aXR5VmFsdWVzW2pdOwoJCQkJCQkJZm9yICh2YXIgcSBpbiBfdikgewoJCQkJCQkJCWlmIChxLmVuZHNXaXRoKCJWYWx1ZSIpKSB7CgkJCQkJCQkJCV92W3FdID0gdmFsdWU7CgkJCQkJCQkJfQoJCQkJCQkJfQoJCQkJCQkJYnJlYWs7CgkJCQkJCX0KCQkJCQl9CgkJCQl9CgkJCQl0aGlzLnNldCh2YWx1ZSwgZS5uYW1lKTsKCQkJfQoJCX0KCX0KCglnZXQoKSB7CgkJdmFyIG8gPSB7fTsKCQlpZiAodGhpcy5zVGFibGUgJiYgd2luZG93W3RoaXMuc1RhYmxlXSkgbyA9IG5ldyB3aW5kb3dbdGhpcy5zVGFibGVdKCk7CgkJZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7CgkJCXZhciBjbiA9IG51bGw7CgkJCXZhciB2ID0gbnVsbDsKCQkJdHJ5IHsKCQkJCWxldCBlTmFtZSA9ICIjIiArIHRoaXMucHJlZml4KHRoaXMuZWxlbWVudHNbaV0pICsgdGhpcy5lbGVtZW50c1tpXS5uYW1lOwoJCQkJc3dpdGNoICh0aGlzLmVsZW1lbnRzW2ldLnR5cGUpIHsKCQkJCQljYXNlICdsYWJlbCc6CgkJCQkJCWNuID0gJChlTmFtZSk7CgkJCQkJCXYgPSBjbi5odG1sKCk7CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgJ3RleHQnOgoJCQkJCWNhc2UgJ3N0cmluZyc6CgkJCQkJY2FzZSAnc2VhcmNoJzoKCQkJCQljYXNlICdwYXNzd29yZCc6CgkJCQkJCWNuID0gJChlTmFtZSk7CgkJCQkJCXYgPSBjbi52YWwoKTsKCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAiZmlsZSI6CgkJCQkJY2FzZSAiaW1hZ2UiOgoJCQkJCQljbiA9ICQoZU5hbWUpOwoJCQkJCQl2ID0gdGhpcy5lbGVtZW50c1tpXS5kYXRhOwoJCQkJCQlicmVhazsKCQkJCQljYXNlICJEYXRlVGltZSI6CgkJCQkJY2FzZSAiZGF0ZXRpbWUiOgoJCQkJCQl2ID0gbmV3IERhdGUoJChlTmFtZSkuZGF0ZXRpbWVib3goJ2dldFZhbHVlJykpOwoJCQkJCQljbiA9ICQoZU5hbWUpOwoJCQkJCQlicmVhazsKCQkJCQljYXNlICJwcm9ncmVzcyI6CgkJCQkJCWNuID0gJChlTmFtZSk7CgkJCQkJCXYgPSBjbi5wcm9ncmVzc2JhcignZ2V0VmFsdWUnKTsKCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAiaW50IjoKCQkJCQljYXNlICJpbnRlZ2VyIjoKCQkJCQljYXNlICJudW1iZXIiOgoJCQkJCWNhc2UgImxvbmciOgoJCQkJCWNhc2UgIkxvbmciOgoJCQkJCQljbiA9ICQoZU5hbWUpOwoJCQkJCQl2ID0gcGFyc2VGbG9hdChjbi52YWwoKSk7CgkJCQkJCWlmIChpc05hTih2KSkgdiA9IDA7CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgImdyaWQiOgoJCQkJCQljbiA9ICQoZU5hbWUpOwoJCQkJCQl2ID0gY24uZGF0YWdyaWQoJ2dldERhdGEnKTsKCQkJCQkJdi5zZWxlY3RlZCA9IGNuLmRhdGFncmlkKCJnZXRTZWxlY3RlZCIpOwoJCQkJCQlicmVhazsKCQkJCQljYXNlICJ0cmVlIjoKCQkJCQkJY24gPSAkKGVOYW1lKTsKCQkJCQkJdiA9IGNuLmNvbWJvdHJlZSgidHJlZSIpLnRyZWUoImdldFNlbGVjdGVkIik7CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgIndpbmRvdyI6CgkJCQkJCXYgPSB0aGlzLmVsZW1lbnRzW2ldLnZhbHVlOwoJCQkJCQlicmVhazsKCQkJCQljYXNlICJzZWxlY3QiOgoJCQkJCQlpZiAodGhpcy5lbGVtZW50c1tpXS5vcHRpb25zKSB7CgkJCQkJCQl2ID0gJChlTmFtZSkuY29tYm9ncmlkKCdnZXRWYWx1ZScgKyAodGhpcy5lbGVtZW50c1tpXS5tdWx0aXBsZSA/ICdzJyA6ICcnKSk7CgkJCQkJCQl2ID0gdGhpcy5zcigpLnJ1blNjcmlwdCh2KTsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCXYgPSAkKGVOYW1lKS5jb21ib2dyaWQoJ2dyaWQnKS5kYXRhZ3JpZCgnZ2V0U2VsZWN0aW9ucycpOwoJCQkJCQkJaWYgKCF2IHx8ICF2Lmxlbmd0aCkgewoJCQkJCQkJCXYgPSAkKGVOYW1lKS5jb21ib2dyaWQoJ2dldFZhbHVlJyArICh0aGlzLmVsZW1lbnRzW2ldLm11bHRpcGxlID8gJ3MnIDogJycpKTsKCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJaWYgKCF0aGlzLmVsZW1lbnRzW2ldLm11bHRpcGxlKSB2ID0gdlswXTsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCQljbiA9ICQoZU5hbWUpOwoJCQkJCQlicmVhazsKCQkJCQljYXNlICJib29sIjoKCQkJCQkJY24gPSAkKGVOYW1lKTsKCQkJCQkJdiA9IGNuLnN3aXRjaGJ1dHRvbignb3B0aW9ucycpLmNoZWNrZWQ7CgkJCQkJCWJyZWFrOwoJCQkJCWRlZmF1bHQ6CgkJCQkJCWJyZWFrOwoJCQkJfQoJCQkJb1t0aGlzLmVsZW1lbnRzW2ldLm5hbWVdKHYpOwoJCQl9IGNhdGNoIChlKSB7CgkJCQkvL2NvbnNvbGUubG9nKHRoaXMuZWxlbWVudHNbaV0ubmFtZSwgZSk7CgkJCQlvW3RoaXMuZWxlbWVudHNbaV0ubmFtZV0gPSB2OwoJCQl9CgkJCWlmIChjbikgewoJCQkJaWYgKG8uRW50aXR5VmFsdWVzKSB7CgkJCQkJZm9yICh2YXIgaiA9IDA7IGogPCBvLkVudGl0eVZhbHVlcy5sZW5ndGg7IGorKykgewoJCQkJCQlpZiAodGhpcy5lbGVtZW50c1tpXS5uYW1lID09IHRoaXMuc1RhYmxlICYmIHRoaXMuZWxlbWVudHNbaV0uZW1zU291cmNlKSBvLklkID0gdGhpcy5lbGVtZW50c1tpXS5lbXNTb3VyY2UuSWQ7CgkJCQkJCWlmIChvLkVudGl0eVZhbHVlc1tqXS5FbnRpdHlBdHRyaWJ1dGUuTmFtZSA9PSB0aGlzLmVsZW1lbnRzW2ldLm5hbWUgJiYgdGhpcy5lbGVtZW50c1tpXS5lbXNTb3VyY2UpIHsKCQkJCQkJCW8uRW50aXR5VmFsdWVzW2pdLklkID0gdGhpcy5lbGVtZW50c1tpXS5lbXNTb3VyY2UuSWQ7CgkJCQkJCX0KCQkJCQl9CgkJCQl9CgkJCX0KCQl9CgkJcmV0dXJuIG87Cgl9CgoJY0hlaWdodChvcHRpb25zKSB7CgkJaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5lZGl0b3IpIHJldHVybiB3aW5kb3cuaW5uZXJIZWlnaHQ7CgkJaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5oZWlnaHQgJiYgdHlwZW9mKG9wdGlvbnMuaGVpZ2h0KSA9PT0gJ3N0cmluZycpIHJldHVybiB0aGlzLmhlaWdodDsKCQlpZiAob3B0aW9ucyAmJiBvcHRpb25zLnR5cGUgPT0gJ3dpbmRvdycgJiYgIW9wdGlvbnMuaGVpZ2h0KSByZXR1cm4gdGhpcy5oZWlnaHQgKiAwLjk7CgkJcmV0dXJuIE1hdGguZmxvb3IoKChvcHRpb25zID8gb3B0aW9ucy5oZWlnaHQgOiBudWxsKSB8fCAodGhpcy5oZWlnaHQgLyAzKSkpOwoJfQoKCXNlYXJjaChvcHRpb25zKSB7CgkJcmV0dXJuIHRoaXMuc3RyaW5nKG9wdGlvbnMpOwoJfQoKCXN0cmluZyhvcHRpb25zKSB7CgkJb3B0aW9ucy5oZWlnaHQgPSAyMDsKCQlvcHRpb25zLnNpbXBsZSA9IHRydWU7CgkJcmV0dXJuIHRoaXMudGV4dChvcHRpb25zKTsKCX0KCglkYXRldGltZShvcHRpb25zKSB7CgkJcmV0dXJuIGA8aW5wdXQgaWQ9ImR0cCR7b3B0aW9ucy5uYW1lfSIgY2xhc3M9ImVhc3l1aS0ke3RoaXMudWlUeXBlc1tvcHRpb25zLnR5cGVdfSIgcmVxdWlyZWQ9IiR7b3B0aW9ucy5yZXF1aXJlZCA/ICd0cnVlJyA6ICdmYWxzZSd9IiB2YWx1ZT0iJHt0aGlzLnZhbHVlKG9wdGlvbnMpfSIgc3R5bGU9IndpZHRoOiR7dGhpcy5jV2lkdGgob3B0aW9ucyl9cHgiPmA7Cgl9CgoJcXVlcnkob3B0aW9ucykgewoJCXJldHVybiAiPGRpdiBpZD0ndnMiICsgb3B0aW9ucy5uYW1lICsgIic+PC9kaXY+IjsKCX0KCglEYXRlVGltZShvcHRpb25zKSB7CgkJcmV0dXJuIHRoaXMuZGF0ZXRpbWUob3B0aW9ucyk7Cgl9CgoJbG9uZyhvcHRpb25zKSB7CgkJcmV0dXJuIHRoaXMuaW50KG9wdGlvbnMpOwoJfQoKCUxvbmcob3B0aW9ucykgewoJCXJldHVybiB0aGlzLmxvbmcob3B0aW9ucyk7Cgl9CgoJdmFsdWUob3B0aW9ucykgewoJCWlmICh0eXBlb2Ygb3B0aW9ucy52YWx1ZSA9PT0gJ2Z1bmN0aW9uJykgewoJCQl0cnkgewoJCQkJcmV0dXJuIG9wdGlvbnMudmFsdWUodGhpcy5nZXQoKSk7CgkJCX0gY2F0Y2ggKGV4KSB7CgkJCQljb25zb2xlLmxvZyhgREZvcm0udmFsdWUoJHtvcHRpb25zLm5hbWV9KTogJHtleH1gKTsKCQkJCXJldHVybiAnJzsKCQkJfQoJCX0gZWxzZSB7CgkJCXN3aXRjaCAob3B0aW9ucy50eXBlKSB7CgkJCQljYXNlICdpbnQnOgoJCQkJY2FzZSAncHJvZ3Jlc3MnOgoJCQkJCXJldHVybiBvcHRpb25zLnZhbHVlIHx8IG9wdGlvbnMubWluIHx8IDA7CgkJCQljYXNlICdzdHJpbmcnOgoJCQkJY2FzZSAndGV4dCc6CgkJCQljYXNlICdkYXRldGltZSc6CgkJCQljYXNlICdsYWJlbCc6CgkJCQkJcmV0dXJuIG9wdGlvbnMudmFsdWUgfHwgIiI7CgkJCQlkZWZhdWx0OgoJCQkJCXJldHVybiBvcHRpb25zLnZhbHVlOwoJCQl9CgkJfQoJfQoKCWludChvcHRpb25zKSB7CgkJbGV0IHJldCA9IGA8aW5wdXQgaWQ9Im51ZCR7b3B0aW9ucy5uYW1lfSIgY2xhc3M9ImVhc3l1aS0ke3RoaXMudWlUeXBlc1tvcHRpb25zLnR5cGVdfSIgcmVxdWlyZWQ9IiR7b3B0aW9ucy5yZXF1aXJlZCA/ICd0cnVlJyA6ICdmYWxzZSd9IiB2YWx1ZT0iJHt0aGlzLnZhbHVlKG9wdGlvbnMpfSIgZGF0YS1vcHRpb25zPSJtaW46JHtvcHRpb25zLm1pbiB8fCAwfSxtYXg6JHtvcHRpb25zLm1heCB8fCAxMDB9LGluY3JlbWVudDoke29wdGlvbnMuaW5jcmVtZW50IHx8IDF9IiBzdHlsZT0id2lkdGg6JHt0aGlzLmNXaWR0aChvcHRpb25zKX1weDsiPjwvaW5wdXQ+YDsKCQkvL2NvbnNvbGUubG9nKHJldCk7CgkJcmV0dXJuIHJldDsKCX0KCgltZW51KG9wdGlvbnMpIHsKCQlvcHRpb25zLnR5cGUgPSBvcHRpb25zLnR5cGUgfHwgJ21lbnUnOwoKCQlvcHRpb25zLm1lbnUgPSAob3B0aW9ucy5tZW51IHx8IFtdKS5zb3J0KChhLCBiKSA9PiBhLm9yZGVyIC0gYi5vcmRlcik7CgoJCS8vY29uc29sZS5sb2coIkR5bmFGb3JtOjptZW51KCk6IG9wdGlvbnMiLCBvcHRpb25zKTsKCgkJbGV0IHJldCA9ICIiOwoJCXJldCArPSAnPGRpdiBjbGFzcz0iZWFzeXVpLXBhbmVsIiBpZD0ibW51JyArIG9wdGlvbnMubmFtZSArICciIHN0eWxlPSJwYWRkaW5nOjVweDsiPlxuJzsKCgkJcmV0ICs9IG9wdGlvbnMubWVudS5tYXAobSA9PiBgPGEgaHJlZj0iIyIgY2xhc3M9ImVhc3l1aS0ke3RoaXMudWlUeXBlc1tvcHRpb25zLnR5cGVdfSIgZGF0YS1vcHRpb25zPSJtZW51OicjbW0ke20ubGFiZWwucmVwbGFjZSgvIC9nLCAnJyl9JyxpY29uQ2xzOidpY29uLSR7bS5pY29uIHx8ICdub25lJ30nIj4ke20ubGFiZWx9PC9hPmApLmpvaW4oJ1xuJyk7CgoJCS8qJC5lYWNoKG9wdGlvbnMubWVudSwgKF8sIG0pID0+IHJldCArPSBgPGEgaHJlZj0iIyIgY2xhc3M9ImVhc3l1aS0ke3RoaXMudWlUeXBlc1tvcHRpb25zLnR5cGVdfSIgZGF0YS1vcHRpb25zPSJtZW51OicjbW0ke20ubGFiZWwucmVwbGFjZSgvIC9nLCAnJyl9JyxpY29uQ2xzOidpY29uLSR7bS5pY29uIHx8ICdub25lJ30nIj4ke20ubGFiZWx9PC9hPlxuYCk7Ki8KCQlyZXQgKz0gIjwvZGl2PlxuIjsKCgkJbGV0IGR2ID0gbSA9PiB7CgkJCWxldCByZXQgPSAnPGRpdicgKyAobS5zdWJNZW51cyA/ICcnIDogYCBkYXRhLW9wdGlvbnM9Imljb25DbHM6J2ljb24tJHttLmljb24gfHwgJ25vbmUnfSciYCkgKyAnPlxuJzsKCQkJcmV0ICs9IG0uc3ViTWVudXMgPyAnPHNwYW4+JyArIChtLmxhYmVsIHx8IHRoaXMuZW5nbGlzaChtLmNvZGUpKSArICc8L3NwYW4+XG48ZGl2PicgOiAoYDxzcGFuIHdpZHRoPScxMDAlJyBvbmNsaWNrPScoYXN5bmMgKCkgPT4ge2xldCBtID0gJHtfRnJFTUQuX3RvSlMobSl9OyBpZihtLmFjdGlvbil7cmV0dXJuIGF3YWl0IG0uYWN0aW9uKERGb3JtLmdldCgpLCBtKTt9IGlmIChtLnN1Yk1lbnVzKSByZXR1cm47IGF3YWl0IF9GckVNRC5SZW5kZXJQYWdlKHtfY29kZTogbS5jb2RlIHx8IG0ubGFiZWwucmVwbGFjZSgvIC9nLCAiIikudG9Mb3dlckNhc2UoKX0sIG0uZGF0YSk7fSkoKSc+JHttLmxhYmVsIHx8IHRoaXMuZW5nbGlzaChtLmNvZGUpfTwvc3Bhbj5gKTsKCQkJJC5lYWNoKG0uc3ViTWVudXMsIChfLCBzKSA9PiByZXQgKz0gZHYocykpOwoJCQlyZXQgKz0gKG0uc3ViTWVudXMgPyAiPC9kaXY+XG4iIDogIiIpICsgYDwvZGl2PlxuYDsKCQkJcmV0dXJuIHJldDsKCQl9OwoKCQlyZXQgKz0gb3B0aW9ucy5tZW51Lm1hcChtID0+IGA8ZGl2IGlkPSJtbSR7bS5sYWJlbC5yZXBsYWNlKC8gL2csICcnKX0iIHN0eWxlPSJ3aWR0aDoxNTBweDsiPiR7bS5zdWJNZW51cy5tYXAoc20gPT4gZHYoc20pKS5qb2luKCcnKX08L2Rpdj5gKS5qb2luKCdcbicpOwoKCQlyZXR1cm4gcmV0OwoJfQoKCWludGVnZXIob3B0aW9ucykgewoJCXJldHVybiB0aGlzLmludChvcHRpb25zKTsKCX0KCgludW1iZXIob3B0aW9ucykgewoJCXJldHVybiB0aGlzLmludChvcHRpb25zKTsKCX0KCglJbnRlZ2VyKG9wdGlvbnMpIHsKCQlyZXR1cm4gdGhpcy5pbnQob3B0aW9ucyk7Cgl9CgoJYm9vbChvcHRpb25zKSB7CgkJcmV0dXJuIGA8aW5wdXQgaWQ9IiR7dGhpcy5wcmVmaXgob3B0aW9ucyl9JHtvcHRpb25zLm5hbWV9IiBkYXRhLWRmb3JtPSJlbGVtZW50OiR7b3B0aW9ucy5uYW1lfSIgcmVxdWlyZWQ9IiR7b3B0aW9ucy5yZXF1aXJlZD8ndHJ1ZSc6J2ZhbHNlJ30iIGRhdGEtb3B0aW9ucz0nZGlzYWJsZWQ6JHtvcHRpb25zLmRpc2FibGVkPyd0cnVlJzonZmFsc2UnfSwke3RoaXMuZXZlbnRIYW5kbGVycyhvcHRpb25zKX0nIGNsYXNzPSJlYXN5dWktJHt0aGlzLnVpVHlwZXNbb3B0aW9ucy50eXBlXX0iICR7b3B0aW9ucy5jaGVja2VkPydjaGVja2VkJzonJ30gLz5gOwoJfQoKCWxhYmVsKG9wdGlvbnMpIHsKCQlyZXR1cm4gYDxzcGFuIGlkPSIke3RoaXMucHJlZml4KG9wdGlvbnMpfSR7b3B0aW9ucy5uYW1lfSIgc3R5bGU9IndpZHRoOiR7dGhpcy5jV2lkdGgob3B0aW9ucyl9cHgiIGRhdGEtb3B0aW9ucz0iZGlzYWJsZWQ6JHtvcHRpb25zLmRpc2FibGVkPyd0cnVlJzonZmFsc2UnfSI+JHt0aGlzLnZhbHVlKG9wdGlvbnMpfTwvc3Bhbj5gOwoJfQoKCXVybChvcHRpb25zKSB7CgkJcmV0dXJuIHRoaXMuc3RyaW5nKG9wdGlvbnMpLnJlcGxhY2UoIkZpZWxkQ2hhbmdlIiwgIlVSTENoYW5nZSIpOwoJfQoKCXRleHQob3B0aW9ucykgewoJCXJldHVybiBgPGlucHV0IGlkPSIke3RoaXMucHJlZml4KG9wdGlvbnMpfSR7b3B0aW9ucy5uYW1lfSIgY2xhc3M9ImVhc3l1aS0ke29wdGlvbnMuZWRpdG9yIHx8IHRoaXMudWlUeXBlc1tvcHRpb25zLnR5cGVdfSIgZGF0YS1vcHRpb25zPSdkaXNhYmxlZDoke29wdGlvbnMuZGlzYWJsZWQ/J3RydWUnOidmYWxzZSd9LCR7dGhpcy5ldmVudEhhbmRsZXJzKG9wdGlvbnMpfScgbXVsdGlsaW5lPSIke29wdGlvbnMuc2ltcGxlID8gJ2ZhbHNlJyA6ICd0cnVlJ30iIHN0eWxlPSJ3aGl0ZS1zcGFjZTpwcmUtd3JhcDt3aWR0aDoke3RoaXMuY1dpZHRoKG9wdGlvbnMpfXB4O2hlaWdodDoke3RoaXMuY0hlaWdodChvcHRpb25zKX1weCIgcmVxdWlyZWQ9IiR7b3B0aW9ucy5yZXF1aXJlZCA/ICd0cnVlJyA6ICdmYWxzZSd9IiB2YWx1ZT0iJHt0aGlzLnZhbHVlKG9wdGlvbnMpfSIgLz5gOwoJfQoKCXBhc3N3b3JkKG9wdGlvbnMpIHsKCQl2YXIgcmV0ID0gdGhpcy5zdHJpbmcob3B0aW9ucyk7CgkJcmV0ID0gcmV0LnJlcGxhY2UoJzxpbnB1dCAnLCAnPGlucHV0IHR5cGU9InBhc3N3b3JkIiAnKTsKCQlyZXR1cm4gcmV0OwoJfQoKCWZpbGUob3B0aW9ucykgewoJCXJldHVybiBgPGlucHV0IGlkPSIke3RoaXMucHJlZml4KG9wdGlvbnMpfSR7b3B0aW9ucy5uYW1lfSIgY2xhc3M9ImVhc3l1aS0ke3RoaXMudWlUeXBlc1tvcHRpb25zLnR5cGVdfSIgZGF0YS1vcHRpb25zPSJvbkNoYW5nZTpmdW5jdGlvbihuLG8pe3ZhciBzID0gJCgnIycgKyB0aGlzLmlkKS5maWxlYm94KCdvcHRpb25zJyk7IERGb3JtLlVwbG9hZEZpbGUocywgREZvcm0uYnlOYW1lKCcke29wdGlvbnMubmFtZX0nKSk7fSIgc3R5bGU9IndpZHRoOiR7dGhpcy5jV2lkdGgob3B0aW9ucyl9cHgiPmA7Cgl9CgoJaW1hZ2Uob3B0aW9ucykgewoJCXJldHVybiB0aGlzLmZpbGUob3B0aW9ucykgKyBgPGRpdiBpZD0iZGxnJHtvcHRpb25zLm5hbWV9IiBjbGFzcz0iZWFzeXVpLSR7dGhpcy51aVR5cGVzW29wdGlvbnMudHlwZV19IiB0aXRsZT0iSW1hZ2UgUHJldmlldyIgZGF0YS1vcHRpb25zPSJjbG9zZWQ6dHJ1ZSxpY29uQ2xzOidpY29uLXNhdmUnLHJlc2l6YWJsZTpmYWxzZSxtb2RhbDp0cnVlIiBzdHlsZT0id2lkdGg6NDAwcHg7aGVpZ2h0OjIwMHB4O3BhZGRpbmc6MTBweCI+PGltZyBpZD0iJHt0aGlzLnByZWZpeChvcHRpb25zKX0ke29wdGlvbnMubmFtZX0iIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiLz48L2Rpdj5gOwoJfQoKCXByb2dyZXNzKG9wdGlvbnMpIHsKCQlpZiAoIW9wdGlvbnMuaGVpZ2h0KSBvcHRpb25zLmhlaWdodCA9IDIwOyAvLyBmaXggYmlnIHByb2dyZXNzCgkJcmV0dXJuIGA8ZGl2IGlkPSIke3RoaXMucHJlZml4KG9wdGlvbnMpfSR7b3B0aW9ucy5uYW1lfSIgY2xhc3M9ImVhc3l1aS0ke3RoaXMudWlUeXBlc1tvcHRpb25zLnR5cGVdfSIgZGF0YS1vcHRpb25zPSJ2YWx1ZToke3RoaXMudmFsdWUob3B0aW9ucyl9IiBzdHlsZT0id2lkdGg6JHt0aGlzLmNXaWR0aChvcHRpb25zKX1weDtoZWlnaHQ6JHt0aGlzLmNIZWlnaHQob3B0aW9ucyl9cHgiPjwvZGl2PmA7Cgl9CgoJZmxvd2NoYXJ0KG9wdGlvbnMpIHsKCQlyZXR1cm4gYDxkaXYgaWQ9ImZsdyR7b3B0aW9ucy5uYW1lfSIgd2lkdGg9IiR7dGhpcy5jV2lkdGgob3B0aW9ucyl9IiBoZWlnaHQ9IiR7dGhpcy5jSGVpZ2h0KG9wdGlvbnMpfSI+PC9kaXY+YDsKCX0KCgljaGFydChvcHRpb25zKSB7CgkJcmV0dXJuIGA8ZGl2IGlkPSJjaHQke29wdGlvbnMubmFtZX0iIHdpZHRoPSIke3RoaXMuY1dpZHRoKG9wdGlvbnMpfSIgaGVpZ2h0PSIke3RoaXMuY0hlaWdodChvcHRpb25zKX0iPjwvZGl2PmA7Cgl9CgoJZm9ybWF0dGVyKG5hbWUsIGMsIGpzb24pIHsKCQlqc29uID0ganNvbiA/ICciJyA6ICcnOwoJCXJldHVybiBgJHtqc29ufSh2YWx1ZSwgcm93LCBpbmRleCkgPT4ge3RyeXt2YXIgYyA9IChERm9ybS5ieU5hbWUoXGAke25hbWV9XGApLmNvbHVtbnMgfHwgW10pLmZpbmQoYyA9PiBjLmZpZWxkPT1cYCR7Yy5maWVsZH1cYCk7IHJldHVybiBjJiZjLmZvcm1hdD9jLmZvcm1hdCh2YWx1ZSxyb3csaW5kZXgpOnZhbHVlO31jYXRjaChleCl7cmV0dXJuIHZhbHVlO30gfSR7anNvbn1gOwoJfQoKCW1hcENvbHVtbnMob3B0aW9ucywganNvbikgewoJCWxldCBjVGl0bGUgPSBjID0+IGMudGl0bGUgfHwgdGhpcy5lbmdsaXNoKGMuZmllbGQpOwoKCQl2YXIgY29scyA9ICQuZ3JlcChvcHRpb25zLmNvbHVtbnMgfHwgW10sIGMgPT4gIWMuaWdub3JlKTsKCQlsZXQgcmV0ID0gIiI7CgkJaWYgKG9wdGlvbnMubXVsdGlwbGUpIHJldCArPSBgeyJmaWVsZCI6J2NrJywiY2hlY2tib3giOnRydWV9LGA7CgkJcmV0ID0gYCJmcm96ZW5Db2x1bW5zIjogW1tgOwoJCWlmICghb3B0aW9ucy5mcm96ZW4pIHsKCQkJcmV0ICs9IGB7ImZpZWxkIjoiJHtvcHRpb25zLmlkRmllbGQuZmllbGR9IiwidGl0bGUiOiAiJHtvcHRpb25zLmlkRmllbGQudGl0bGV9Iiwic29ydGFibGUiOiAidHJ1ZSIsICJmb3JtYXR0ZXIiOiAke3RoaXMuZm9ybWF0dGVyKG9wdGlvbnMubmFtZSwgb3B0aW9ucy5pZEZpZWxkLCBqc29uKX19LGA7CgkJCWlmIChvcHRpb25zLnRleHRGaWVsZC5maWVsZCAhPSBvcHRpb25zLmlkRmllbGQuZmllbGQpIHJldCArPSBgeyJmaWVsZCI6IiR7b3B0aW9ucy50ZXh0RmllbGQuZmllbGQgfHwgb3B0aW9ucy50ZXh0RmllbGQudGl0bGV9IiwidGl0bGUiOiIke29wdGlvbnMudGV4dEZpZWxkLnRpdGxlIHx8IG9wdGlvbnMudGV4dEZpZWxkLmZpZWxkfSIsIndpZHRoIjoiJHtvcHRpb25zLnRleHRGaWVsZC53aWR0aHx8MTIwfSIsICJzb3J0YWJsZSI6ICJ0cnVlIiwgImZvcm1hdHRlciI6ICR7dGhpcy5mb3JtYXR0ZXIob3B0aW9ucy5uYW1lLCBvcHRpb25zLnRleHRGaWVsZCwganNvbil9fWA7CgkJfSBlbHNlIHsKCQkJJC5tYXAoJC5ncmVwKGNvbHMsIGMgPT4gYy5mcm96ZW4pLCBjID0+IGB7ImZpZWxkIjoiJHtjLmZpZWxkIHx8IGNUaXRsZShjKX0iLCJ0aXRsZSI6IiR7Y1RpdGxlKGMpIHx8IGMuZmllbGR9Iiwid2lkdGgiOiIke2Mud2lkdGh8fDEyMH0iLCJhbGlnbiI6J2xlZnQnLCJzb3J0YWJsZSI6InRydWUiLCAiZm9ybWF0dGVyIjogJHt0aGlzLmZvcm1hdHRlcihvcHRpb25zLm5hbWUsIGMsIGpzb24pfX1gKS5qb2luKCIsIik7CgkJfQoJCXJldCArPSBgXV0sICJjb2x1bW5zIjogW1tgOwoJCXJldCArPSAkLm1hcCgkLmdyZXAoY29scywgYyA9PiAhYy5mcm96ZW4pLCBjID0+IGB7ImZpZWxkIjoiJHtjLmZpZWxkIHx8IGNUaXRsZShjKX0iLCJ0aXRsZSI6IiR7Y1RpdGxlKGMpIHx8IGMuZmllbGR9IiwiYWxpZ24iOiJsZWZ0Iiwic29ydGFibGUiOiJ0cnVlIiwgImZvcm1hdHRlciI6ICR7dGhpcy5mb3JtYXR0ZXIob3B0aW9ucy5uYW1lLCBjLCBqc29uKX19YCkuam9pbigiLCIpOwoJCXJldCArPSAnXV0nOwoKCQkvL2NvbnNvbGUubG9nKCJEeW5hRm9ybTo6bWFwQ29sdW1ucygiICsgb3B0aW9ucy5uYW1lICsgIik6ICIsIHJldCwganNvbik7CgkJcmV0dXJuIHJldDsKCX0KCglzZWxlY3Qob3B0aW9ucywgdGFnID0gb3B0aW9ucy50YWcsIHR5cGUpIHsKCQlyZXR1cm4gdGhpcy5jb21ibyhvcHRpb25zLCB0YWcsIHR5cGUpOwoJfQoKCXRyZWUob3B0aW9ucykgewoJCXJldHVybiB0aGlzLnNlbGVjdChvcHRpb25zLCAic2VsZWN0Iik7Cgl9CgoJbmF2aWdhdGlvbihvcHRpb25zKSB7CgkJcmV0dXJuIHRoaXMuY29tYm8ob3B0aW9ucywgJ3VsJywgJ3RyZWUnKTsKCX0KCgljb21ibyhvcHRpb25zLCB0YWcsIHR5cGUpIHsKCQl2YXIgY29scyA9ICQuZ3JlcChvcHRpb25zLmNvbHVtbnMgfHwgW10sIGMgPT4gIWMuaWdub3JlKTsKCQl0YWcgPSB0YWcgfHwgInNlbGVjdCI7CgoJCW9wdGlvbnMuaWRGaWVsZCA9ICQudW5pcXVlU29ydChbewoJCQlmaWVsZDogb3B0aW9ucy5pZEZpZWxkLAoJCQl0aXRsZTogb3B0aW9ucy5pZEZpZWxkCgkJfV0uY29uY2F0KCQuZ3JlcChjb2xzLCBjID0+IGMucHJpbWFyeSksIFt7CgkJCWZpZWxkOiAnSWQnLAoJCQl0aXRsZTogJ0lEJwoJCX1dKSkuZmluZCh4ID0+IHR5cGVvZih4LmZpZWxkKSAhPT0gInVuZGVmaW5lZCIpOwoKCQlvcHRpb25zLnRleHRGaWVsZCA9ICQudW5pcXVlU29ydChbewoJCQlmaWVsZDogb3B0aW9ucy50ZXh0RmllbGQsCgkJCXRpdGxlOiBvcHRpb25zLnRleHRGaWVsZAoJCX1dLmNvbmNhdCgkLmdyZXAoY29scywgYyA9PiBjLmRpc3BsYXkpLCBbewoJCQlmaWVsZDogJ19Ub1N0cmluZycsCgkJCXRpdGxlOiBvcHRpb25zLm5hbWUsCgkJfV0pKS5maW5kKHggPT4gdHlwZW9mKHguZmllbGQpICE9PSAidW5kZWZpbmVkIik7CgoJCS8vY29uc29sZS5sb2coIkR5bmFGb3JtOjpjb21ibygpOiBvcHRpb25zIiwgb3B0aW9ucyk7CgoJCXZhciBmdW4gPSB0eXBlIHx8IHRoaXMuZUZ1bihvcHRpb25zKTsKCgkJdmFyIGRyb3Bkb3duID0gWydjb21ib3RyZWVncmlkJywgJ2NvbWJvdHJlZScsICdjb21ib2dyaWQnLCAnc2VsZWN0J10uaW5kZXhPZihmdW4pID4gLTE7CgkJaWYgKGRyb3Bkb3duKSB0aGlzLnNlbGVjdHMucHVzaCh7CgkJCWlkOiAiY21iIiArIG9wdGlvbnMubmFtZSwKCQkJb3B0aW9uczogdGhpcy5ieU5hbWUob3B0aW9ucy5uYW1lKQoJCX0pOwoJCXRoaXMuc2VsZWN0cyA9ICQudW5pcXVlU29ydCh0aGlzLnNlbGVjdHMpOwoJCXZhciByZXQgPSBgPCR7dGFnfSBpZD0iY21iJHtvcHRpb25zLm5hbWV9IiBjbGFzcz0iZWFzeXVpLSR7ZnVufSIgc3R5bGU9Im1heC13aWR0aDoke2Ryb3Bkb3duPyc0MDBweCc6dGhpcy5jV2lkdGgob3B0aW9ucyl9OyB3aWR0aDoke3RoaXMuY1dpZHRoKG9wdGlvbnMpfXB4IiByZXF1aXJlZD0iJHsob3B0aW9ucy5yZXF1aXJlZCA/ICd0cnVlJyA6ICdmYWxzZScpfSIgZGF0YS1vcHRpb25zPSdkaXNhYmxlZDoke29wdGlvbnMuZGlzYWJsZWQ/J3RydWUnOidmYWxzZSd9LCR7dGhpcy5ldmVudEhhbmRsZXJzKG9wdGlvbnMpfSwgdmFsdWU6IiR7dGhpcy52YWx1ZShvcHRpb25zKX0iLCByb3dudW1iZXJzOiR7dHlwZW9mKG9wdGlvbnMucm93TnVtYmVycykhPT0ndW5kZWZpbmVkJz9vcHRpb25zLnJvd051bWJlcnM6KGZ1bi5pbmRleE9mKCd0cmVlJyk8LTE/J2ZhbHNlJzondHJ1ZScpfSwgcGFnaW5hdGlvbjoke3R5cGVvZihvcHRpb25zLnBhZ2luYXRpb24pIT09J3VuZGVmaW5lZCc/b3B0aW9ucy5wYWdpbmF0aW9uOihmdW4uaW5kZXhPZigndHJlZScpPC0xPydmYWxzZSc6J3RydWUnKX0sIHBhbmVsV2lkdGg6JHsyKnRoaXMuY1dpZHRoKG9wdGlvbnMpfSwgZml0Q29sdW1uczogdHJ1ZSwgc2luZ2xlU2VsZWN0OiB0cnVlLCBtdWx0aXBsZTokeyhvcHRpb25zLm11bHRpcGxlIHx8ICdmYWxzZScpfSwgaWRGaWVsZDogIiR7b3B0aW9ucy5pZEZpZWxkLmZpZWxkfSIsIGVuYWJsZUZpbHRlcjogJHtvcHRpb25zLmZpbHRlcj8ndHJ1ZSc6J2ZhbHNlJ30sIG5vd3JhcDogZmFsc2UsIHRleHRGaWVsZDogIiR7b3B0aW9ucy50ZXh0RmllbGQuZmllbGR9IiwgdHJlZUZpZWxkOiAiJHtvcHRpb25zLnRleHRGaWVsZC5maWVsZH0iLGA7CgkJaWYgKGZ1bi5pbmRleE9mKCd0cmVlJykgPT0gLTEpIHsKCQkJcmV0ICs9ICdmaXRDb2x1bW5zOiBmYWxzZSwnICsgdGhpcy5tYXBDb2x1bW5zKG9wdGlvbnMpOwoJCX0KCQlpZiAob3B0aW9ucy5kYXRhKSB7CgkJCXJldCArPSBgLGRhdGE6ICR7SlNPTi5zdHJpbmdpZnkob3B0aW9ucy5kYXRhKX1gOwoJCX0KCQlyZXQgKz0gYCc+YDsKCQlpZiAob3B0aW9ucy5vcHRpb25zKSB7CgkJCXJldCArPSAkLm1hcChvcHRpb25zLm9wdGlvbnMsIG8gPT4gYDxvcHRpb24gdmFsdWU9JyR7X0ZyRU1ELl90b0pTKG8pfSc+JHtvLm5hbWUgfHwgb308L29wdGlvbj5gKS5qb2luKCdcbicpOwoJCX0KCQlyZXQgKz0gYDwvJHt0YWd9PmA7CgkJLy8gY29uc29sZS5sb2cocmV0KTsKCQlyZXR1cm4gcmV0OwoJfQoKCWdyaWQob3B0aW9ucywgdGFnLCB0eXBlKSB7CgkJcmV0dXJuIHRoaXMuY29tYm8ob3B0aW9ucywgInRhYmxlIiwgImRhdGFncmlkIik7Cgl9CgoJdHJlZWdyaWQob3B0aW9ucykgewoJCXJldHVybiB0aGlzLmNvbWJvKG9wdGlvbnMsICd0YWJsZScsICd0cmVlJyk7Cgl9CgoJYXN5bmMgZG9MaW5rKGUsIGV2ZW50KSB7CgkJdGhpcy5idXN5KHRydWUpOwoJCXRyeSB7CgkJCWF3YWl0IGUubGlua3MuZmluZChsID0+IGwubGFiZWwgPT0gZXZlbnQudGFyZ2V0LmlubmVyVGV4dCkub25DbGljayh0aGlzLmdldCgpKTsKCQl9IGNhdGNoIChleCkgewoJCQljb25zb2xlLmxvZygiRHluYUZvcm06OmRvTGluaygpOiBFeGNlcHRpb246ICIgKyBleCk7CgkJfQoJCXRoaXMuYnVzeShmYWxzZSk7Cgl9CgoJRWRpdGVkVmFsdWUoZSkgewoJCXJldHVybiAodHlwZW9mKGFjZSkgIT09ICJ1bmRlZmluZWQiKSA/IGFjZS5lZGl0KCdwbmwnICsgZS5uYW1lKS5zZXNzaW9uLmdldFZhbHVlKCkgOiAnJzsKCX0KCglhc3luYyBQYW5PbkNsb3NlKGUpIHsKCQlpZiAoZS5lZGl0b3IpIHsKCQkJZS52YWx1ZSA9IHRoaXMuRWRpdGVkVmFsdWUoZSk7CgkJfQoJCWlmIChlLmNsb3NlKSB7CgkJCWF3YWl0IGUuY2xvc2UodGhpcy5nZXQoKSk7CgkJfQoJfQoKCWFzeW5jIFBlbmRBZnRlck9wZW4oZSkgewoJCWlmIChlLmVkaXRvciAmJiB0eXBlb2YoYWNlKSAhPT0gInVuZGVmaW5lZCIpIHsKCQkJYXdhaXQgX0ZyRU1ELk9wZW5FZGl0b3IoJ3BubCcgKyBlLm5hbWUgLyorICctY2VudGVyJyovICwgZS5sYW5ndWFnZSwgZS5sb2FkZXIgfHwgKG8gPT4gZS52YWx1ZSksIGUuc2F2ZXIsIHRoaXMuZ2V0KCksIGUpOwoJCX0KCQlpZiAoZS5vcGVuKSB7CgkJCWF3YWl0IGUub3Blbih0aGlzLmdldCgpKTsKCQl9Cgl9CgoJbGluayhvcHRpb25zKSB7CgkJcmV0dXJuIChvcHRpb25zLmxpbmtzIHx8IFtdKS5maWx0ZXIobCA9PiAhbC5pZ25vcmUpLm1hcChsID0+IGA8YSBocmVmPSIjIiBjbGFzcz0iZWFzeXVpLSR7dGhpcy51aVR5cGVzW29wdGlvbnMudHlwZV19IiBkYXRhLW9wdGlvbnM9JyR7dGhpcy5ldmVudEhhbmRsZXJzKG9wdGlvbnMpfSwgaWNvbkNsczoiaWNvbi0ke2wuaWNvbiB8fCAnb2snfSInPiR7bC5sYWJlbH08L2E+YCkuam9pbignXG4nKTsKCX0KCglhc3luYyBTZXRUcmVlRGF0YShlLCBuLCBkYXRhKSB7CgkJJC5lYWNoKCQoIiNjbWIiICsgZS5uYW1lKVt0aGlzLmVGdW4oZSldKCd0cmVlJykudHJlZSgiZ2V0Q2hpbGRyZW4iLCBuLnRhcmdldCksIChfLCBjKSA9PiAkKCIjY21iIiArIGUubmFtZSlbdGhpcy5lRnVuKGUpXSgndHJlZScpLnRyZWUoInJlbW92ZSIsIGMudGFyZ2V0KSk7CgkJJCgiI2NtYiIgKyBlLm5hbWUpW3RoaXMuZUZ1bihlKV0oJ3RyZWUnKS50cmVlKCJhcHBlbmQiLCB7CgkJCXBhcmVudDogbi50YXJnZXQsCgkJCWRhdGE6IGRhdGEKCQl9KTsKCQlyZXR1cm4gdHJ1ZTsKCX0KCglhc3luYyBFeHBhbmQoZSwgbikgewoJCXRoaXMuU2V0VHJlZURhdGEoZSwgbiwgW3sKCQkJaWQ6IG51bGwsCgkJCXRleHQ6ICJsb2FkaW5nLi4uIgoJCX1dKTsKCQl2YXIgb2JqID0ge307CgkJdmFyIHBGaWVsZCA9IGUucGFyZW50RmllbGQgfHwgJC5tYXAoJC5ncmVwKGUuY29sdW1ucyB8fCBbXSwgYyA9PiBjLnBhcmVudCksIGMgPT4gYy5maWVsZCkuY29uY2F0KFtudWxsXSlbMF07CgkJdmFyIGlkRmllbGQgPSAkLmdyZXAoZS5jb2x1bW5zIHx8IFtdLCBjID0+IGMucHJpbWFyeSkuY29uY2F0KGUuaWRGaWVsZClbMF0uZmllbGQ7CgkJaWYgKHBGaWVsZCkgewoJCQlvYmpbcEZpZWxkXSA9IHsKCQkJCV9zb3VyY2U6IG4uX3NvdXJjZQoJCQl9OwoJCQlpZiAoaWRGaWVsZCkgewoJCQkJb2JqW3BGaWVsZF1baWRGaWVsZF0gPSBuLmlkOwoJCQl9IGVsc2UgewoJCQkJb2JqW3BGaWVsZF0gPSBuLmlkOwoJCQl9CgkJfQoJCWxldCBkYXRhID0gYXdhaXQgdGhpcy5fbG9hZERhdGEoewoJCQlpZDogImNtYiIgKyBlLm5hbWUsCgkJCW9wdGlvbnM6IGUKCQl9LCBvYmopOwoJCXRoaXMuU2V0VHJlZURhdGEoZSwgbiwgZGF0YSk7Cgl9CgoJYXN5bmMgX2xvYWREYXRhKHMsIG8sIHN0YXJ0LCBlbmQpIHsKCQl2YXIgbmFtZSA9IChzICYmIHMub3B0aW9ucyA/IChzLm9wdGlvbnMuQ2xhc3MgPyBzLm9wdGlvbnMuQ2xhc3MuTmFtZS5yZXBsYWNlKCcgJywgJ18nKSA6IChzLm9wdGlvbnMudGFibGUgfHwgcy5vcHRpb25zLm5hbWUpKSA6IHMubmFtZSk7CgkJbmFtZSA9IG5hbWUudHJpbSgpOyAvLy5zcGxpdCgnLicpLnNsaWNlKC0xKVswXTsKCgkJbGV0IG9TY29wZSA9ICh0eXBlb2YoY29tcGFueSkgIT09ICd1bmRlZmluZWQnICYmIGNvbXBhbnkuU2NvcGUpID8gd2luZG93W2NvbXBhbnkuU2NvcGVdIDogd2luZG93OwoJCS8vY29uc29sZS5sb2coIkR5bmFGb3JtOjpfbG9hZERhdGEoKTogb1Njb3BlIiwgb1Njb3BlKTsKCgkJbyA9IG8gfHwgKChvU2NvcGUgJiYgb1Njb3BlW25hbWVdKSA/IG5ldyBvU2NvcGVbbmFtZV0oKSA6IHsKCQkJQWN0aXZlOiB0cnVlLAoJCX0pOwoKCQlvID0gKHR5cGVvZiBmaWx0ZXJzICE9PSAidW5kZWZpbmVkIiAmJiBmaWx0ZXJzICYmIGZpbHRlcnNbbmFtZV0pID8gZmlsdGVyc1tuYW1lXShvKSA6IG87CgkJdmFyIGZ1biA9IHRoaXMuZUZ1bihzLm9wdGlvbnMpOwoJCWxldCBzVGV4dCA9ICQoIiMiICsgcy5pZClbZnVuXSgnZ2V0VGV4dCcpOwoKCQlvID0gKHMgJiYgcy5vcHRpb25zICYmIHMub3B0aW9ucy5zb3VyY2UpID8gcy5vcHRpb25zLnNvdXJjZShvLCB0aGlzLmdldCgpLCBzVGV4dCkgOiBvOwoJCWxldCBuYW1lcyA9ICQudW5pcXVlU29ydChbcy5vcHRpb25zLnNlYXJjaEZpZWxkXS5jb25jYXQoJC5tYXAoJC5ncmVwKHMub3B0aW9ucy5jb2x1bW5zIHx8IFtdLCBjID0+IGMuc2VhcmNoKSwgYyA9PiBjLmZpZWxkKSwgWyJOYW1lIl0pKS5maWx0ZXIodiA9PiB2KTsKCQlpZiAoIW9bbmFtZXNbMF1dKSBvW25hbWVzWzBdXSA9IHNUZXh0OwoJCS8vY29uc29sZS5sb2coIkR5bmFGb3JtOjpfbG9hZERhdGEoKTogbyIsIG8pOwoJCXZhciBkYXRhID0gbnVsbDsKCgkJbGV0IGxpYiA9ICcnOwoJCWlmIChuYW1lLmluZGV4T2YoJy4nKSA+IDApIHsKCQkJbGliID0gbmFtZS5zcGxpdCgnLicpWzBdICsgJy4nOwoJCQluYW1lID0gbmFtZS5zcGxpdCgnLicpWzFdOwoJCX0KCgkJaWYgKHMub3B0aW9ucy5sb2FkZXIpIHsKCQkJZGF0YSA9IGF3YWl0IHMub3B0aW9ucy5sb2FkZXIodGhpcy5nZXQoKSwgcy5vcHRpb25zLCBvLCBzVGV4dCk7CgkJfSBlbHNlIGlmIChvICYmIHR5cGVvZihvLmZpbmRBbGwpID09PSAnZnVuY3Rpb24nKSB7CgkJCWRhdGEgPSBhd2FpdCBvLmZpbmRBbGwoKTsKCQl9IGVsc2UgaWYgKHR5cGVvZihjb21wYW55KSAhPT0gJ3VuZGVmaW5lZCcgJiYgY29tcGFueS5saWJyYXJ5ICYmIGNvbXBhbnkuQ29kZSAmJiB3aW5kb3cuYkxvY2FsKSB7CgkJCS8vY29uc29sZS5sb2coIkRGb3JtOjpfbG9hZERhdGEoKTogc3IoKS5fKCIgKyBsaWIgKyBjb21wYW55LkNvZGUudG9Mb3dlckNhc2UoKSArIG5hbWUgKyAiRmluZGFsbCIgKyAiKSIsIG8pOwoJCQlkYXRhID0gYXdhaXQgdGhpcy5zcigpLl8obGliICsgY29tcGFueS5Db2RlLnRvTG93ZXJDYXNlKCkgKyBuYW1lICsgIkZpbmRhbGwiLCBudWxsLCBvLCBudWxsLCBzdGFydCwgZW5kKTsKCQl9IGVsc2UgaWYgKF9GckVNRC5hcGlTZXJ2ZXIpIHsKCQkJbyA9IE9iamVjdC5hc3NpZ24oLi4uT2JqZWN0LmtleXMobykubWFwKGsgPT4gKHsKCQkJCVtTdHJpbmcoaykuY2hhckF0KDApLnRvTG93ZXJDYXNlKCkgKyBTdHJpbmcoaykuc2xpY2UoMSldOiBvW2tdCgkJCX0pKSk7CgkJCS8vY29uc29sZS5sb2coIkRGb3JtOjpfbG9hZERhdGEoKTogdXNpbmcgX0ZyRU1ELmFwaVNlcnZlcjogbyIsIG8pOwoJCQlkYXRhID0gYXdhaXQgX0ZyRU1ELmFwaVNlcnZlci5fbmV3KG5hbWUpLl9mcm9tRG9jdW1lbnQobykuZmluZEFsbCgpOwoJCQkvL2RhdGEuZmlsdGVyKGQgPT4gZC5JZCAhPSBkLklkKS5mb3JFYWNoKGQgPT4gZC5JZCA9IGQuX3V1aWQobnVsbCwgbnVsbCwgdHJ1ZSkpOwoJCX0KCgkJaWYgKHMub3B0aW9ucy5wb3N0bG9hZCkgewoJCQlhd2FpdCBzLm9wdGlvbnMucG9zdGxvYWQoZGF0YSk7CgkJfQoJCSQuZWFjaChkYXRhLCAoaSwgZCkgPT4gewoJCQlkLl9fT1dORVIgPSBzOwoJCQkkLmVhY2gocy5vcHRpb25zLmNvbHVtbnMsIChfLCBjKSA9PiB7CgkJCQlpZiAoYy52YWx1ZSkgewoJCQkJCWRbYy5maWVsZF0gPSBjLnZhbHVlKGQsIGRhdGEsIGkpOwoJCQkJfQoJCQl9KTsKCQl9KTsKCQlpZiAoIXMub3B0aW9ucy5jb2x1bW5zICYmIGZ1bi5pbmRleE9mKCd0cmVlJykgPiAtMSkgewoJCQlkYXRhID0gJC5tYXAoZGF0YSwgZCA9PiB7CgkJCQlsZXQgcmV0ID0gewoJCQkJCWlkOiBkW3Mub3B0aW9ucy5pZEZpZWxkLmZpZWxkXSwKCQkJCQl0ZXh0OiBkW3Mub3B0aW9ucy50ZXh0RmllbGQuZmllbGRdLAoJCQkJCXN0YXRlOiBkLnN0YXRlIHx8IChzLm9wdGlvbnMubG9hZGVyID8gImZpbGUiIDogImNsb3NlZCIpLAoJCQkJCV9zb3VyY2U6IGQsCgkJCQl9OwoJCQkJcmV0LmNoaWxkcmVuID0gKHJldC5zdGF0ZSA9PSAiY2xvc2VkIikgPyBbewoJCQkJCXRleHQ6ICdsb2FkaW5nLi4uJwoJCQkJfV0gOiBudWxsOwoJCQkJcmV0dXJuIHJldDsKCQkJfSk7CgkJfQoJCXJldHVybiBkYXRhIHx8IFtdOwoJfQoKCWFzeW5jIGZpbGxEYXRhKGcsIG8sIHN0YXJ0LCBlbmQpIHsKCQl2YXIgcyA9IG51bGw7CgkJZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnNlbGVjdHMubGVuZ3RoOyBpKyspIHsKCQkJaWYgKHRoaXMuc2VsZWN0c1tpXS5pZCA9PSBnWzBdLmlkKSBzID0gdGhpcy5zZWxlY3RzW2ldOwoJCX0KCQlpZiAoIXMpIHJldHVybjsKCQl0aGlzLmJ1c3kodHJ1ZSk7CgkJdHJ5IHsKCQkJdmFyIGZ1biA9IGdbMF0uY2xhc3NMaXN0WyIwIl0ucmVwbGFjZSgnZWFzeXVpLScsICcnKTsKCQkJdHJ5IHsKCQkJCSQoIiMiICsgcy5pZClbZnVuXSgnZ3JpZCcpLmRhdGFncmlkKCdnZXRQYWdlcicpLnBhZ2luYXRpb24oJ2xvYWRpbmcnKTsKCQkJfSBjYXRjaCAoZXgpIHt9CgkJCWlmIChzLm9wdGlvbnMubm9sb2FkKSB7CgkJCQlsZXQgX2RhdGEgPSBudWxsOwoJCQkJdHJ5IHsKCQkJCQlfZGF0YSA9ICQoIiMiICsgcy5pZClbZnVuXSgnZ3JpZCcpLmRhdGFncmlkKCJnZXREYXRhIik7CgkJCQl9IGNhdGNoIChleCkgewoJCQkJCV9kYXRhID0gJCgiIyIgKyBzLmlkKVtmdW5dKCd0cmVlJykudHJlZSgnZ2V0Um9vdCcpOwoJCQkJfQoJCQkJaWYgKF9kYXRhKSB7CgkJCQkJcmV0dXJuIHRoaXMuYnVzeShmYWxzZSk7CgkJCQl9CgkJCX0KCQkJdmFyIGRhdGEgPSBhd2FpdCB0aGlzLl9sb2FkRGF0YShzLCBvLCBzdGFydCwgZW5kKTsKCQkJdHJ5IHsKCQkJCWlmICgkKCIjIiArIHMuaWQpW2Z1bl0oJ2dyaWQnKSkgJCgiIyIgKyBzLmlkKVtmdW5dKCdncmlkJykuZGF0YWdyaWQoJ2dldFBhZ2VyJykucGFnaW5hdGlvbignbG9hZGVkJyk7CgkJCX0gY2F0Y2ggKGV4KSB7fQoJCQl0cnkgewoJCQkJJCgiIyIgKyBzLmlkKVtmdW5dKCdncmlkJykuZGF0YWdyaWQoJ2xvYWREYXRhJywgewoJCQkJCXRvdGFsOiBkYXRhLkNvdW50IHx8IGRhdGEubGVuZ3RoLAoJCQkJCXJvd3M6IGRhdGEsCgkJCQl9KTsKCQkJfSBjYXRjaCAoZXgpIHsKCQkJCSQoIiMiICsgcy5pZClbZnVuXSgndHJlZScpLnRyZWUoJ2xvYWREYXRhJywgZGF0YSk7CgkJCX0KCQl9IGNhdGNoIChleCkgewoJCQljb25zb2xlLmxvZyhleCk7CgkJfQoJCXRoaXMuYnVzeShmYWxzZSk7Cgl9CgoJZXZlbnRIYW5kbGVycyhvcHRpb25zKSB7CgkJLy9jb25zb2xlLmxvZygiRHluYUZvcm06OmV2ZW50SGFuZGxlcnMoKTogb3B0aW9ucyIsIG9wdGlvbnMpOwoJCWlmICghdGhpcy5ieU5hbWUob3B0aW9ucy5uYW1lKSkgcmV0dXJuOyAvLyBpZiBub3QgYW4gZWxlbWVudCwgZG8gbm90IHJ1biB0aGUgaGFuZGxlcnMKCgkJcmV0dXJuIHRoaXMuZXZlbnRzLmZpbHRlcihlID0+IGUudHlwZSA9PSBvcHRpb25zLnR5cGUgfHwgdHlwZW9mKGUudHlwZSkgPT09ICd1bmRlZmluZWQnKS5tYXAoZSA9PiBgJHtlLm5hbWV9OiAoJHtlLnBhcmFtcyB8fCAnJ30pID0+IHt0cnl7REZvcm0uJHtlLmhhbmRsZXJ9KERGb3JtLmJ5TmFtZSgiJHtvcHRpb25zLm5hbWV9IikgfHwgJHtfRnJFTUQuX3RvSlMob3B0aW9ucyl9IHx8IHtuYW1lOiAiJHtvcHRpb25zLm5hbWV9Iix0eXBlOiAiJHtvcHRpb25zLnR5cGV9In0sICR7ZS5wYXJhbXN9KX1jYXRjaChleCl7Y29uc29sZS5sb2coIkV2ZW50IEVycm9yOiAke29wdGlvbnMubmFtZX0vJHtvcHRpb25zLnR5cGV9LyR7ZS5uYW1lfSIsIGV4KTt9fWApLmpvaW4oJywnKTsKCX0KCglhc3luYyBQYW5lbE9wZW4oZSkgewoJCWlmIChlLmVkaXRvcikgcmV0dXJuIHRydWU7CgkJbGV0IGNvbnRlbnQgPSBlLnZhbHVlOwoJCWlmIChlLmxvYWRlcikgewoJCQljb250ZW50ID0gYXdhaXQgZS5sb2FkZXIodGhpcy5nZXQoKSk7CgkJfQoJCWlmIChjb250ZW50KSB7CgkJCXRyeSB7CgkJCQkkKCIjcG5sIiArIGUubmFtZSkucGFuZWwoJ2JvZHknKS5odG1sKGNvbnRlbnQpOwoJCQkJY29uc29sZS5sb2coInBubCIgKyBlLm5hbWUgKyAiOiBDb250ZW50IFZhbGlkIik7CgkJCX0gY2F0Y2ggKGV4KSB7CgkJCQkvL2NvbnNvbGUubG9nKGV4KTsKCQkJfQoJCX0KCQlyZXR1cm4gY29udGVudDsKCX0KCglhc3luYyBTZWxlY3RDaGFuZ2Uob3B0aW9ucywgdGFiKSB7CgkJdGhpcy5idXN5KHRydWUpOwoJCSQuZ3JlcCh0aGlzLmVsZW1lbnRzLCBlID0+IGUudHlwZSA9PSAiZ3JpZCIgJiYgZS5ncm91cCA9PSB0YWIpLmZvckVhY2goZSA9PiAkKCIjY21iIiArIGUubmFtZSkuZGF0YWdyaWQoKSk7CgkJdGhpcy5idXN5KGZhbHNlKTsKCX0KCglhc3luYyBGaWVsZENoYW5nZShvcHRpb25zLCB2YWx1ZSkgewoJCXRoaXMuYnVzeSh0cnVlKTsKCQlpZiAob3B0aW9ucyAmJiBvcHRpb25zLmNoYW5nZSkgewoJCQlhd2FpdCBvcHRpb25zLmNoYW5nZSh0aGlzLmdldCgpLCB2YWx1ZSk7CgkJfQoJCXRoaXMuYnVzeShmYWxzZSk7Cgl9CgoJYXN5bmMgVVJMQ2hhbmdlKHMsIG9wdGlvbnMpIHsKCQlvcHRpb25zLmRhdGEgPSBhd2FpdCAkLmdldChzLnZhbHVlKTsKCQlyZXR1cm4gYXdhaXQgdGhpcy5GaWVsZENoYW5nZShzLCBvcHRpb25zKTsKCX0KCglhc3luYyBVcGxvYWRGaWxlKGYsIG9wdGlvbnMpIHsKCQl0aGlzLmJ1c3kodHJ1ZSk7CgkJdmFyIGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKCk7CgkJdmFyIGZpbGVpZCA9IE1hdGgucmFuZG9tKCk7CgkJdmFyIG1ldGhvZCA9IG9wdGlvbnMubWV0aG9kIHx8ICJDb250ZW50TWFuYWdlci5jbXNVcGxvYWRGaWxlIjsKCQlmb3JtRGF0YS5hcHBlbmQoJ2ZpbGVpZCcsIGZpbGVpZCk7CgkJdmFyIGZpbGUgPSAkKCIjIiArIGYuZmlsZWJveElkKVswXS5maWxlc1swXTsKCQlmb3JtRGF0YS5hcHBlbmQoJ19fVUZJTEUnLCBmaWxlKTsKCQlpZiAob3B0aW9ucy5sb2NhbCkgewoJCQkvLyBoYW5kbGluZyB0aGUgZmlsZSBsb2NhbGx5CgkJCXZhciByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpOwoJCQlyZWFkZXIub25sb2FkID0gYXN5bmMgKGUpID0+IHsKCQkJCXZhciBkYXRhID0gZS50YXJnZXQucmVzdWx0OwoJCQkJREZvcm0uYnlOYW1lKG9wdGlvbnMubmFtZSkuZGF0YSA9IGRhdGE7CgkJCQlpZiAob3B0aW9ucyAmJiBvcHRpb25zLnVwbG9hZCkgYXdhaXQgb3B0aW9ucy51cGxvYWQodGhpcy5nZXQoKSwgZGF0YSk7CgkJCQl0aGlzLmJ1c3koZmFsc2UpOwoJCQl9OwoJCQlpZiAob3B0aW9ucy5iaW5hcnkpIHsKCQkJCXJlYWRlci5yZWFkQXNCaW5hcnlTdHJpbmcoZmlsZSk7CgkJCX0gZWxzZSBpZiAob3B0aW9ucy5kYXRhdXJsKSB7CgkJCQlyZWFkZXIucmVhZEFzRGF0YVVSTChmaWxlKTsKCQkJfSBlbHNlIHsKCQkJCXJlYWRlci5yZWFkQXNUZXh0KGZpbGUpOwoJCQl9CgkJfSBlbHNlIGlmIChtZXRob2QpIHsKCQkJJC5hamF4KHsKCQkJCXVybDogdGhpcy5zcigpLnNyVVJMICsgIiZtZXRob2Q9IiArIG1ldGhvZCArICImc0lucHV0PSIgKyBmaWxlaWQgKyAiJnByZVRhZz0mcG9zdFRhZz0iLAoJCQkJZGF0YTogZm9ybURhdGEsCgkJCQkvLyBUSElTIE1VU1QgQkUgRE9ORSBGT1IgRklMRSBVUExPQURJTkcKCQkJCWNhY2hlOiBmYWxzZSwKCQkJCWNvbnRlbnRUeXBlOiBmYWxzZSwKCQkJCXR5cGU6ICdQT1NUJywKCQkJCXByb2Nlc3NEYXRhOiBmYWxzZSwKCQkJCXN1Y2Nlc3M6IGRhdGEgPT4gewoJCQkJCXRoaXMuc3IoKS5ydW5TY3JpcHQoZGF0YSk7CgkJCQkJdGhpcy5ieU5hbWUob3B0aW9ucy5uYW1lKS5kYXRhID0gcmV0OwoJCQkJCWlmIChvcHRpb25zICYmIG9wdGlvbnMudXBsb2FkKSBvcHRpb25zLnVwbG9hZCh0aGlzLmdldCgpLCByZXQpOwoJCQkJCXRoaXMuYnVzeShmYWxzZSk7CgkJCQl9CgkJCX0pOwoJCX0KCX0KCgllRnVuKGUpIHsKCQl0cnkgewoJCQlpZiAoZS50eXBlID09ICJ0cmVlIikgewoJCQkJaWYgKGUuY29sdW1ucykgewoJCQkJCXJldHVybiAiY29tYm90cmVlZ3JpZCI7CgkJCQl9IGVsc2UgaWYgKHR5cGVvZihlLmNvbWJvKSAhPT0gJ3VuZGVmaW5lZCcgJiYgIWUuY29tYm8pIHsKCQkJCQlyZXR1cm4gJ3RyZWUnOwoJCQkJfSBlbHNlIHsKCQkJCQlyZXR1cm4gImNvbWJvdHJlZSI7CgkJCQl9CgkJCX0gZWxzZSBpZiAoZS50eXBlID09ICduYXZpZ2F0aW9uJykgewoJCQkJcmV0dXJuICd0cmVlJzsKCQkJfSBlbHNlIGlmIChlLnR5cGUgPT0gImNvbWJvdHJlZSIpIHsKCQkJCXJldHVybiAiY29tYm90cmVlZ3JpZCI7CgkJCX0gZWxzZSBpZiAoZS50eXBlID09ICJzZWxlY3QiICYmIGUub3B0aW9ucykgewoJCQkJcmV0dXJuICJjb21ib2JveCI7CgkJCX0KCQkJcmV0dXJuICJjb21ib2dyaWQiOwoJCX0gY2F0Y2ggKGV4KSB7CgkJCXJldHVybiAiY29tYm9ncmlkIjsKCQl9Cgl9CgoJX2ZpbGxXaW5kb3cod2luTmFtZSwgdiwgbWFwKSB7CgkJdiA9IHYgfHwge307CgkJbWFwID0gbWFwIHx8IHt9OwoJCWlmIChBcnJheS5pc0FycmF5KG1hcCkpIHsKCQkJbWFwID0gT2JqZWN0LmZyb21FbnRyaWVzKG5ldyBNYXAobWFwKSk7CgkJfQoKCQltYXAgPSAkLmV4dGVuZCh7fSwgbWFwLCBPYmplY3QuZnJvbUVudHJpZXMoT2JqZWN0LmtleXModikubWFwKGsgPT4gW3dpbk5hbWUgKyBrLCBrXSkpKTsKCgkJbGV0IHMgPSB7fTsKCQlmb3IgKHZhciBtIGluIG1hcCkgewoJCQlpZiAodHlwZW9mKHZbbWFwW21dXSkgPT09ICJ1bmRlZmluZWQiKSB7CgkJCQkvL2NvbnNvbGUubG9nKCdpc191bmRlZmluZWQnLCBtLCBtYXBbbV0sIHZbbWFwW21dXSk7CgkJCQlzW21dID0gbWFwW21dOwoJCQl9IGVsc2UgewoJCQkJLy9jb25zb2xlLmxvZygnaXNfbm90X3VuZGVmaW5lZCcsIG0sIG1hcFttXSwgdlttYXBbbV1dKTsKCQkJCXNbbV0gPSB2W21hcFttXV07CgkJCX0KCQl9CgkJdGhpcy5jbGVhcih3aW5OYW1lKTsKCQkvL2NvbnNvbGUubG9nKCJzIiwgcyk7CgkJdGhpcy5zZXQocyk7CgkJJCgiI3BubF8iICsgd2luTmFtZSkud2luZG93KCJvcGVuIik7Cgl9CgoJd2luZG93VG9FbnRpdHkobywgYkVtcHR5LCBncmlkLCBwcmVmaXgsIGZpbHRlcikgewoJCW8gPSBvIHx8IHRoaXMuZ2V0KCk7CgkJZmlsdGVyID0gZmlsdGVyIHx8ICh2ID0+IHYpOwoJCWxldCByZXQgPSBncmlkID8gKGdyaWQuc2VsZWN0ZWQgfHwgZ3JpZCkgOiBudWxsOwoJCWlmIChiRW1wdHkpIHsKCQkJcmV0ID0ge307CgkJCW8gPSB7fTsKCQl9IGVsc2UgewoJCQlyZXQgPSAocmV0ICYmIHJldC5JZCkgPyB7CgkJCQlJZDogcmV0LklkCgkJCX0gOiB7fTsKCQl9CgoJCXRoaXMuZWxlbWVudHMuZmlsdGVyKGUgPT4gKHByZWZpeCA/IGUuZ3JvdXAgPT0gcHJlZml4IDogdHJ1ZSkgJiYgZS50eXBlICE9ICdsaW5rJyAmJiBbJ18nXS5pbmRleE9mKGUubmFtZS5yZXBsYWNlKHByZWZpeCwgIiIpKSA8IDApLmZvckVhY2goZSA9PiB7CgkJCXJldFtlLm5hbWUucmVwbGFjZShwcmVmaXgsICIiKV0gPSBvW2UubmFtZV07CgkJCXJldHVybiB0cnVlOwoJCX0pOwoKCQlmaWx0ZXIocmV0KTsKCgkJcmV0dXJuIHJldDsKCX0KCgliaW5kKG9iaikgewoJCXZhciBvYmpCaW5kID0gKG8sIGUpID0+IHsKCQkJb1t0aGlzLmVGdW4oZSldKHsKCQkJCW9uU2hvd1BhbmVsOiAoKSA9PiB7CgkJCQkJdGhpcy5maWxsRGF0YSgkKCIjIiArIGUuaWQpLCBudWxsLCAwLCAxMCk7CgkJCQl9LAoJCQkJb25DbGlja1JvdzogKGluZGV4LCByb3cpID0+IHsKCQkJCQl2YXIgcyA9IHJvdyA/IHJvdy5fX09XTkVSIDogbnVsbDsKCQkJCQkvLyBjb25zb2xlLmxvZygib25DbGlja1JvdygpOiAiLCBpbmRleCwgcm93LCBzKTsKCQkJCQlpZiAocyAmJiBzLm9wdGlvbnMuc2VsZWN0KSB7CgkJCQkJCXMub3B0aW9ucy5zZWxlY3Qocm93LCB0aGlzLmdldCgpKTsKCQkJCQl9CgkJCQl9CgkJCX0pOwoJCQl0cnkgewoJCQkJdmFyIGRnID0gb1t0aGlzLmVGdW4oZSldKCdncmlkJyk7CgkJCQkvLyBkZy5kYXRhZ3JpZCgnZW5hYmxlRmlsdGVyJykKCQkJCXZhciBzdGF0ZSA9IGRnLmRhdGEoJ2RhdGFncmlkJyk7CgkJCQl2YXIgb3B0cyA9IHN0YXRlLm9wdGlvbnM7CgkJCQl2YXIgb25CZWZvcmVMb2FkID0gb3B0cy5vbkJlZm9yZUxvYWQ7CgkJCQlvcHRzLm9uQmVmb3JlTG9hZCA9IChwYXJhbSkgPT4gewoJCQkJCXN0YXRlLmFsbFJvd3MgPSBudWxsOwoJCQkJCXJldHVybiBvbkJlZm9yZUxvYWQuY2FsbCh0aGlzLCBwYXJhbSk7CgkJCQl9OwoJCQkJdmFyIHBhZ2VyID0gZGcuZGF0YWdyaWQoJ2dldFBhZ2VyJyk7CgkJCQlkZy5kYXRhZ3JpZCgnZ2V0UGFuZWwnKS5wYW5lbCh7CgkJCQkJSUQ6IGkKCQkJCX0pOwoJCQkJcGFnZXIucGFnaW5hdGlvbih7CgkJCQkJb25TZWxlY3RQYWdlOiBmdW5jdGlvbihwYWdlTnVtLCBwYWdlU2l6ZSkgewoJCQkJCQl0cnkgewoJCQkJCQkJREZvcm0uZmlsbERhdGEoJCgiIyIgKyBERm9ybS5zZWxlY3RzWyQodGhpcy5wYXJlbnROb2RlKS5wYW5lbCgnb3B0aW9ucycpLklEXS5pZCksIG51bGwsIHBhZ2VTaXplICogKHBhZ2VOdW0gLSAxKSwgcGFnZVNpemUgKiBwYWdlTnVtKTsKCQkJCQkJfSBjYXRjaCAoX2V4KSB7CgkJCQkJCQljb25zb2xlLmxvZygiRHluYUZvcm06Om9uU2VsZWN0UGFnZSgpICIsIF9leCk7CgkJCQkJCX0KCQkJCQl9CgkJCQl9KTsKCQkJCWRnLmRhdGFncmlkKCdsb2FkRGF0YScsIHN0YXRlLmRhdGEpOwoJCQl9IGNhdGNoIChleCkge30KCQl9OwoJCWlmIChvYmopIHsKCQkJb2JqQmluZChvYmopOwoJCX0gZWxzZSB7CgkJCWZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5zZWxlY3RzLmxlbmd0aDsgaSsrKSB7CgkJCQlpZiAodGhpcy5zZWxlY3RzW2ldLm9wdGlvbnMub3B0aW9ucykgewoJCQkJCS8vJCgiIyIgKyB0aGlzLnNlbGVjdHNbaV0uaWQpLmNvbWJvKCk7CgkJCQl9IGVsc2UgewoJCQkJCW9iakJpbmQoJCgiIyIgKyB0aGlzLnNlbGVjdHNbaV0uaWQpLCB0aGlzLnNlbGVjdHNbaV0pOwoJCQkJfQoJCQl9CgoJCQl0aGlzLmVsZW1lbnRzLmZpbHRlcihlID0+IGUud2luZG93ICYmIGUuZ3JvdXApLmZvckVhY2goZSA9PiB7CgkJCQlsZXQgdCA9ICQoIiN0YmNXaW5kb3ciKS50YWJzKCJnZXRUYWIiLCBlLmdyb3VwKTsKCQkJCWlmICh0KSB7CgkJCQkJdC5wYW5lbCgnb3B0aW9ucycpLnRhYi5oaWRlKCk7CgkJCQl9CgkJCX0pOwoJCX0KCX0KCgllbmdsaXNoKHMpIHsKCQlpZiAoIXMpIHJldHVybiAiIjsKCQl2YXIgcmVzdWx0ID0gcy5yZXBsYWNlKC8oW0EtWl0pL2csICIgJDEiKTsKCQlyZXN1bHQgPSByZXN1bHQucmVwbGFjZSgvXy9nLCAnJyk7CgkJcmV0dXJuIHJlc3VsdC5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHJlc3VsdC5zbGljZSgxKTsKCX0KCglvblRvZ2dsZShlLCBiVmFsdWUpIHsKCQlsZXQgc1RhZyA9IGAjZkVsZW1lbnRfJHtlLmZvci5uYW1lfSA+IC5lYXN5dWktJHt0aGlzLnVpVHlwZXNbZS5mb3IudHlwZV19YDsKCQlsZXQgb1RhZyA9ICQoc1RhZyk7CgkJZS5mb3IuZW5hYmxlZCA9IHR5cGVvZihiVmFsdWUpID09PSAidW5kZWZpbmVkIiA/ICFlLmZvci5lbmFibGVkIDogYlZhbHVlOwoKCQlvVGFnLnByb3AoImRpc2FibGVkIiwgIWUuZm9yLmVuYWJsZWQpOwoJCS8vb1RhZ1t0aGlzLnVpVHlwZXNbZS5mb3IudHlwZV1dKGUuZm9yLmVuYWJsZWQgPyAiZW5hYmxlIiA6ICJkaXNhYmxlIik7CgkJY29uc29sZS5sb2coc1RhZywgb1RhZywgdGhpcy51aVR5cGVzW2UuZm9yLnR5cGVdLCBlLmZvci5lbmFibGVkKTsKCX0KCglyZW5kZXIobmFtZSwgdGl0bGUsIGVsZW1lbnRzLCBidXR0b25zLCBiRml4ZWQpIHsKCQl0aGlzLmVsZW1lbnRzID0gKGVsZW1lbnRzIHx8IFtdKS5maWx0ZXIoZSA9PiAhZS5pZ25vcmUpOwoKCQl0aGlzLmJ1dHRvbnMgPSBidXR0b25zIHx8IFtdOwoJCXRoaXMuc2VsZWN0cyA9IFtdOwoJCXRoaXMuZ3JpZHMgPSBbXTsKCgkJdGhpcy5lbGVtZW50cy5maWx0ZXIoZSA9PiBlLnR5cGUgPT0gIndpbmRvdyIpLmZvckVhY2godyA9PiB0aGlzLmVsZW1lbnRzLnNwbGljZSh0aGlzLmVsZW1lbnRzLmZpbmRJbmRleChlID0+IGUubmFtZSA9PSB3Lm5hbWUpLCAwLCB7CgkJCW5hbWU6ICJfIiArIHcubmFtZSwKCQkJdHlwZTogImxpbmsiLAoJCQl0aXRsZTogdy50aXRsZSB8fCB0aGlzLmVuZ2xpc2gody5uYW1lKSwKCQkJZ3JvdXA6IHcuZ3JvdXAsCgkJCXdpbmRvdzogdy53aW5kb3csCgkJCXNlY3Rpb246IHcuc2VjdGlvbiwKCQkJbGlua3M6IFt7CgkJCQlsYWJlbDogJ09wZW4nLAoJCQkJaWNvbjogJ2VkaXQnLAoJCQkJb25DbGljazogbyA9PiAkKCIjcG5sIiArIHcubmFtZSkud2luZG93KCdvcGVuJykKCQkJfV0sCgkJfSkpOwoKCQl0aGlzLnNyKCkuZ3JvdXBCeSh0aGlzLmVsZW1lbnRzLmZpbHRlcihlID0+IGUud2luZG93KSwgImdyb3VwIikuZm9yRWFjaChrdiA9PiB7CgkJCWlmICgha3Yua2V5KSByZXR1cm47CgoJCQlsZXQgZSA9IHsKCQkJCW5hbWU6ICJfIiArIGt2LmtleSwKCQkJCXRpdGxlOiBrdi5rZXksCgkJCQl0eXBlOiAid2luZG93IiwKCQkJCWdyb3VwOiBrdi5rZXksCgkJCQl3aWR0aDogdGhpcy53aWR0aCAqIDAuOSwKCQkJCWhlaWdodDogdGhpcy5oZWlnaHQgKiAwLjksCgkJCQlsb2FkZXI6IG8gPT4gewoJCQkJCWt2LnZhbHVlcy5maWx0ZXIodiA9PiB2LnR5cGUgIT09ICdsaW5rJyB8fCAodi50eXBlID09ICdsaW5rJyAmJiB2Lm5hbWUuc3RhcnRzV2l0aCgnXycpKSkuZm9yRWFjaCh2ID0+ICQoIiNwbmxfIiArIHYuZ3JvdXAgKyAnLWNlbnRlcicpLmFwcGVuZCgkKCIjZkVsZW1lbnRfIiArIHYubmFtZSkpKTsKCQkJCQlyZXR1cm4gbnVsbDsKCQkJCX0sCgkJCQlidXR0b25zOiBbXS5jb25jYXQuYXBwbHkoW10sIGt2LnZhbHVlcy5maWx0ZXIodiA9PiB2LnR5cGUgPT0gJ2xpbmsnICYmICF2Lm5hbWUuc3RhcnRzV2l0aCgnXycpKS5tYXAodiA9PiBbLi4udi5saW5rcy5tYXAobCA9PiAoewoJCQkJCW5hbWU6IGwubmFtZSB8fCBsLmxhYmVsLAoJCQkJCXRpdGxlOiBsLnRpdGxlIHx8IGwubGFiZWwsCgkJCQkJb25DbGljazogbC5vbkNsaWNrLAoJCQkJCWljb246IGwuaWNvbiwKCQkJCQl3aW5kb3c6IHRydWUsCgkJCQkJZ3JvdXA6IGt2LmtleSwKCQkJCX0pKV0pKSwKCQkJfTsKCQkJdGhpcy5idXR0b25zLnB1c2goLi4uZS5idXR0b25zKTsKCgkJCXRoaXMuZWxlbWVudHMucHVzaChlKTsKCQl9KTsKCgkJdmFyIHJldCA9ICIiOwoJCS8vIGNoZWNrIHRoZSBvcHRpb24gb2YgdXNpbmcgd2luZG93KCkgYXMgYSByZW5kZXJlciBvZiB0aGUgbWFpbiB3aW5kb3cuLi4KCQlpZiAodHJ1ZSkgewoJCQl0aGlzLmVsZW1lbnRzLmZpbHRlcihlID0+ICFlLnpvbmUpLmZvckVhY2goZSA9PiBlLnpvbmUgPSAnY2VudGVyJyk7CgkJCWxldCB3T3B0aW9ucyA9IHsKCQkJCW5hbWU6IG5hbWUgfHwgdGhpcy5uYW1lLAoJCQkJdGl0bGU6IHRpdGxlIHx8IHRoaXMudGl0bGUsCgkJCQl0eXBlOiAnd2luZG93JywKCQkJCXZpc2libGU6IHRydWUsCgkJCQl3aWR0aDogdGhpcy53aWR0aCwKCQkJCWhlaWdodDogdGhpcy5oZWlnaHQsCgkJCQlmaXhlZDogYkZpeGVkLAoJCQkJbGlua3M6IFt7CgkJCQkJaWNvbjogImhlbHAiLAoJCQkJCWFjdGlvbjogbyA9PiAkKCIjcG5sX19Db25zb2xlIikud2luZG93KCdvcGVuJykKCQkJCX1dLAoJCQkJYnV0dG9uczogdGhpcy5idXR0b25zLmZpbHRlcihiID0+ICFiLndpbmRvdyksCgkJCX07CgkJCXRoaXMuc3IoKS5ncm91cEJ5KHRoaXMuZWxlbWVudHMsICd6b25lJykuZmlsdGVyKHpnID0+IHpnLmtleSkuZm9yRWFjaCh6ZyA9PiB7CgkJCQl3T3B0aW9uc1t6Zy5rZXldID0gdGhpcy5yZW5kZXJFbGVtZW50cyh6Zy52YWx1ZXMpOwoJCQl9KTsKCgkJCXJldCA9IHRoaXMud2luZG93KHdPcHRpb25zKTsKCQl9IGVsc2UgewoJCQlyZXQgPSB0aGlzLmhlYWRlcihuYW1lLCB0aXRsZSwgYkZpeGVkLCBbewoJCQkJaWNvbjogImhlbHAiLAoJCQkJYWN0aW9uOiBvID0+ICQoIiNwbmxfX0NvbnNvbGUiKS53aW5kb3coJ29wZW4nKQoJCQl9XSk7CgoJCQlyZXQgKz0gdGhpcy5yZW5kZXJFbGVtZW50cygpOwoKCQkJcmV0ICs9IHRoaXMuZm9vdGVyKGJGaXhlZCk7CgoJCX0KCQkvLyBjb25zb2xlLmxvZyhyZXQpOwoKCQlyZXR1cm4gcmV0OwoJfQoKCWNXaWR0aChvcHRpb25zKSB7CgkJbGV0IHJldCA9IE1hdGguZmxvb3IoKChvcHRpb25zID8gb3B0aW9ucy53aWR0aCA6IG51bGwpIHx8ICh0aGlzLndpZHRoIC8gMykpKTsKCQlpZiAob3B0aW9ucy56b25lID09ICdlYXN0JyB8fCBvcHRpb25zLnpvbmUgPT0gJ3dlc3QnKSB7CgkJCXJldCA9IDAuMjUgKiByZXQ7IC8vIDkwJSBvZiAzLzEwLCB0aGUgd2lkdGggb2YgdGhlIG5vcm1hbCBlbGVtZW50CgkJfSBlbHNlIGlmIChvcHRpb25zICYmIG9wdGlvbnMuZWRpdG9yKSB7CgkJCXJldCA9IHdpbmRvdy5pbm5lcldpZHRoOwoJCX0gZWxzZSBpZiAob3B0aW9ucyAmJiBvcHRpb25zLndpZHRoICYmIHR5cGVvZihvcHRpb25zLndpZHRoKSA9PT0gJ3N0cmluZycpIHsKCQkJcmV0ID0gdGhpcy53aWR0aDsKCQl9IGVsc2UgaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy50eXBlID09ICd3aW5kb3cnICYmICFvcHRpb25zLndpZHRoKSB7CgkJCXJldCA9IHRoaXMud2lkdGggKiAwLjk7CgkJfQoKCQkvLyBjb25zb2xlLmxvZyhvcHRpb25zLm5hbWUgKyAiOiBjV2lkdGggPSAiICsgcmV0LCBvcHRpb25zLnpvbmUpOwoJCXJldHVybiByZXQ7Cgl9CgoJd2luZG93KG9wdGlvbnMpIHsKCQlvcHRpb25zLnRpdGxlID0gb3B0aW9ucy50aXRsZSB8fCBvcHRpb25zLm5hbWU7CgkJdmFyIHJldCA9IGAKCQk8ZGl2IGlkID0gInBubCR7b3B0aW9ucy5uYW1lfSIgY2xhc3M9ImVhc3l1aS13aW5kb3ciIHRpdGxlPSIke29wdGlvbnMudGl0bGUgfHwgdGhpcy5lbmdsaXNoKG9wdGlvbnMubmFtZSl9IiBkYXRhLW9wdGlvbnM9JyR7dGhpcy5ldmVudEhhbmRsZXJzKG9wdGlvbnMpfSwgY2xvc2VkOiR7IW9wdGlvbnMudmlzaWJsZX0sbWluaW1pemFibGU6JHshb3B0aW9ucy5maXhlZH0sbWF4aW1pemFibGU6JHshb3B0aW9ucy5maXhlZH0sY2xvc2FibGU6JHshb3B0aW9ucy5maXhlZH0sY29sbGFwc2libGU6JHshb3B0aW9ucy5maXhlZH0sZHJhZ2dhYmxlOiR7IW9wdGlvbnMuZml4ZWR9LHJlc2l6YWJsZTokeyFvcHRpb25zLmZpeGVkfSxpY29uQ2xzOiJpY29uLSR7b3B0aW9ucy5pY29ufSIsIHRvb2xzOiIjJHtvcHRpb25zLm5hbWV9X3Rvb2xzIicgc3R5bGU9IndpZHRoOiR7dGhpcy5jV2lkdGgob3B0aW9ucyl9cHg7aGVpZ2h0OiR7dGhpcy5jSGVpZ2h0KG9wdGlvbnMpfXB4O3BhZGRpbmc6MTBweDsiPgoJCSAgICA8ZGl2IGNsYXNzPSJlYXN5dWktbGF5b3V0IiBkYXRhLW9wdGlvbnM9ImZpdDp0cnVlIj4KCQlgOwoKCQlsZXQgYlpvbmUgPSBvcHRpb25zLnNvdXRoID8gJ3NvdXRoJyA6ICh0aGlzLnpvbmVzLmZpbmQoeiA9PiB6ID09ICdzb3V0aCcpIHx8IHRoaXMuem9uZXNbMF0pOwoJCW9wdGlvbnNbYlpvbmVdID0gb3B0aW9uc1tiWm9uZV0gfHwgW107CgkJbGV0IHpXaWR0aCA9IE1hdGgubWluKDEyMCwgdGhpcy53aWR0aCAqIDAuOTUgLyAob3B0aW9ucy5idXR0b25zID8gb3B0aW9ucy5idXR0b25zLmxlbmd0aCA6IDEpLCB0aGlzLmNXaWR0aChvcHRpb25zKSk7CgkJb3B0aW9uc1tiWm9uZV0ucHVzaChgPGRpdiBpZD0icG5sJHtvcHRpb25zLm5hbWV9LWJ1dHRvbnMiIGRhdGEtb3B0aW9ucz0icmVnaW9uOicke2Jab25lfScsYm9yZGVyOmZhbHNlIiBzdHlsZT0idGV4dC1hbGlnbjpyaWdodDtwYWRkaW5nOjVweCAwIDA7Ij5gICsgJC5tYXAoJC5ncmVwKG9wdGlvbnMuYnV0dG9ucyB8fCBbXSwgYiA9PiAhYi5pZ25vcmUpLCBiID0+IGA8YSBpZD0nJHtiLm5hbWV9JyBocmVmPSJqYXZhc2NyaXB0OnZvaWQoMCkiIGNsYXNzPSJlYXN5dWktbGlua2J1dHRvbiBjNiIgaWNvbkNscz0iaWNvbi0ke2IuaWNvbiB8fCAnc2F2ZSd9IiBzdHlsZT0id2lkdGg6JHt6V2lkdGh9cHgiIG9uY2xpY2s9J0RGb3JtLmRvQ2xpY2soJHtfRnJFTUQuX3RvSlMoYil9KSc+JHtiLnRpdGxlIHx8IGIubmFtZX08L2E+Jm5ic3A7Jm5ic3A7YCkuam9pbignJykgKyBgPC9kaXY+YCk7CgoJCXRoaXMuem9uZXMuZmlsdGVyKHogPT4gb3B0aW9uc1t6XSkuZm9yRWFjaCh6ID0+IHsKCQkJcmV0ICs9IGAKCQkgICAgICAgIDxkaXYgZGF0YS1vcHRpb25zPSJyZWdpb246JyR7en0nIiB0aXRsZT0iJHsoej09J3dlc3QnIHx8IHo9PSdlYXN0Jyk/JyZuYnNwOyc6Jyd9IiBzdHlsZT0naGVpZ2h0OiR7KHo9PSdub3J0aCd8fHo9PSdzb3V0aCcpPzEwOjEwMH0lO3dpZHRoOiR7KCh6PT0nZWFzdCd8fHo9PSd3ZXN0Jyk/MC4xOjEpKnRoaXMuY1dpZHRoKG9wdGlvbnMpfXB4Jz4KICAgICAgICAJCSAgICAkeyhBcnJheS5pc0FycmF5KG9wdGlvbnNbel0pP29wdGlvbnNbel06W29wdGlvbnNbel1dKS5qb2luKCcnKX0KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICBgOwoJCX0pOwoKCQlyZXQgKz0gYDwvZGl2PjwvZGl2PmA7CgoJCS8vIGxpbmtzICh0b29scykKCQlsZXQgbGlua3MgPSAkLmdyZXAoW10uY29uY2F0KG9wdGlvbnMubGlua3MgfHwgW10pLCBsID0+ICFsLmlnbm9yZSk7CgkJcmV0ICs9IGA8ZGl2IGlkPSIke29wdGlvbnMubmFtZX1fdG9vbHMiPmAgKyAkLm1hcChsaW5rcy5yZXZlcnNlKCksIGwgPT4gYDxhIGhyZWY9ImphdmFzY3JpcHQ6dm9pZCgwKSIgc3R5bGU9ImNvbG9yOmJsYWNrIiBjbGFzcz0iZmFzIGZhLSR7bC5pY29uIHx8ICdhZGQnfSIgb25jbGljaz0nKGFzeW5jICgpID0+IHt2YXIgYSA9ICR7X0ZyRU1ELl90b0pTKGwpfTsgJCgiI3BubCR7b3B0aW9ucy5uYW1lfSIpLndpbmRvdygic2V0VGl0bGUiLCAiJHtvcHRpb25zLnRpdGxlfTogIiArIGEubmFtZSk7IGF3YWl0IGEuYWN0aW9uKERGb3JtLmdldCgpLCBhLCAke19GckVNRC5fdG9KUyhvcHRpb25zKX0pOyAkKCIjcG5sJHtvcHRpb25zLm5hbWV9Iikud2luZG93KCJzZXRUaXRsZSIsICIke29wdGlvbnMudGl0bGV9Iik7fSkoKSc+PC9hPmApLmpvaW4oJ1xuJykgKyBgPC9kaXY+YDsKCgkJcmV0dXJuIHJldDsKCX0KCglhc3luYyBfZW5kKCkgewoJCWxldCBvID0gdGhpcy5nZXQoKTsKCgkJLy8gZG8gbm90IHVzZSB0aGUgZmlyc3QgYnV0dG9uLCBiZWNhdXNlIG1hbnkgZm9ybXMgaGF2ZSBhIENhbmNlbCBidXR0b24gb25seQoJCWxldCBidXR0b24gPSB0aGlzLmJ1dHRvbnMuZmluZChiID0+IGIuYXV0b1N1Ym1pdCkgLyogfHwgdGhpcy5idXR0b25zWzBdKi8gOwoJCWlmIChidXR0b24gJiYgbyAmJiBPYmplY3QudmFsdWVzKG8pLmxlbmd0aCAmJiAodHlwZW9mKGJ1dHRvbi5hdXRvU3VibWl0KSA9PT0gInVuZGVmaW5lZCIgfHwgYnV0dG9uLmF1dG9TdWJtaXQpKSB7CgkJCWxldCB2ID0gT2JqZWN0LnZhbHVlcyhvKS5yZWR1Y2UoKHQsIHYpID0+IHsKCQkJCXJldHVybiAoKHR5cGVvZih2KSAhPT0gIm9iamVjdCIpID8gMSA6IDApICogKHYgPyAxIDogMCk7CgkJCX0pOwoJCQkvL2NvbnNvbGUubG9nKG8sIE9iamVjdC52YWx1ZXMobyksIHYpOwoJCQlpZiAodikgewoJCQkJLy8gYWxsIGZpZWxkcyBoYXZlIHZhbHVlcwoJCQkJYXdhaXQgdGhpcy5kb0NsaWNrKGJ1dHRvbik7CgoJCQl9CgkJfQoJfQoKCWZvb3RlcihiRml4ZWQpIHsKCQlyZXR1cm4gYDwvZm9ybT5gICsgYDxkaXYgaWQ9ImRsZy1idXR0b25zIj5gICsgdGhpcy5idXR0b25zLmZpbHRlcihiID0+ICFiLndpbmRvdykubWFwKGIgPT4gYDxhIGlkPScke2IubmFtZX0nIGhyZWY9ImphdmFzY3JpcHQ6dm9pZCgwKSIgY2xhc3M9ImVhc3l1aS1saW5rYnV0dG9uIGM2IiBpY29uQ2xzPSJpY29uLSR7Yi5pY29uIHx8ICdzYXZlJ30iIHN0eWxlPSJ3aWR0aDoke01hdGgubWluKDEyMCwgdGhpcy53aWR0aCAqIDAuOTUgLyB0aGlzLmJ1dHRvbnMubGVuZ3RoLCB0aGlzLmNXaWR0aCgpKX1weCIgb25jbGljaz0nREZvcm0uZG9DbGljaygke19GckVNRC5fdG9KUyhiKX0pJz4ke2IudGl0bGUgfHwgYi5uYW1lfTwvYT4mbmJzcDsmbmJzcDtgKS5qb2luKCcnKSArICI8L2Rpdj4iICsgKGJGaXhlZCA/ICIiIDogJzwvZGl2PicpOwoJfQoKCWhlYWRlcihuYW1lLCB0aXRsZSwgYkZpeGVkLCBsaW5rcykgewoJCXRoaXMudGl0bGUgPSB0aXRsZSB8fCB0aGlzLnRpdGxlOwoJCW5hbWUgPSBuYW1lIHx8IHRoaXMubmFtZTsKCQl2YXIgcmV0ID0gJyc7CgoJCXJldCArPSB0aGlzLndpbmRvdyh7CgkJCW5hbWU6ICJfX0NvbnNvbGUiLAoJCQl0eXBlOiAid2luZG93IiwKCQkJZWRpdG9yOiB0cnVlLAoJCQlsb2FkZXI6IG8gPT4gd2luZG93LmxvZ3Muc2xpY2UoKS5yZXZlcnNlKCkubWFwKGwgPT4gbC5kYXRlLnRvSVNPU3RyaW5nKCkgKyAiOiAiICsgbC5hcmdzLm1hcChzID0+IHR5cGVvZihzKSA9PT0gJ29iamVjdCcgPyAoKG9iaiwgaW5kZW50ID0gMikgPT4gewoJCQkJbGV0IGNhY2hlID0gW107CgkJCQljb25zdCByZXRWYWwgPSBKU09OLnN0cmluZ2lmeSgKCQkJCQlvYmosCgkJCQkJKGtleSwgdmFsdWUpID0+CgkJCQkJdHlwZW9mIHZhbHVlID09PSAib2JqZWN0IiAmJiB2YWx1ZSAhPT0gbnVsbCA/CgkJCQkJY2FjaGUuaW5jbHVkZXModmFsdWUpID8KCQkJCQl1bmRlZmluZWQgLy8gRHVwbGljYXRlIHJlZmVyZW5jZSBmb3VuZCwgZGlzY2FyZCBrZXkKCQkJCQk6CgkJCQkJY2FjaGUucHVzaCh2YWx1ZSkgJiYgdmFsdWUgLy8gU3RvcmUgdmFsdWUgaW4gb3VyIGNvbGxlY3Rpb24KCQkJCQk6CgkJCQkJdmFsdWUsCgkJCQkJaW5kZW50CgkJCQkpOwoJCQkJY2FjaGUgPSBudWxsOwoJCQkJcmV0dXJuIHJldFZhbDsKCQkJfSkocykgOiBzKS5qb2luKCcsICcpKS5qb2luKCdcbicpLAoJCX0pOwoKCQlpZiAoIWJGaXhlZCkgewoJCQlsaW5rcyA9IChsaW5rcyB8fCBbXSkuZmlsdGVyKGwgPT4gIWwuaWdub3JlKTsKCQkJbGV0IHREYXRhID0gIiI7CgkJCWlmIChsaW5rcy5sZW5ndGgpIHsKCQkJCXJldCArPSBgPGRpdiBpZD0iJHt0aGlzLm5hbWV9X3Rvb2xzIj5gICsgbGlua3MubWFwKGwgPT4gYDxhIGhyZWY9ImphdmFzY3JpcHQ6dm9pZCgwKSIgY2xhc3M9Imljb24tJHtsLmljb259IiBvbmNsaWNrPScoYXN5bmMgKCkgPT4ge3ZhciBhID0gJHtfRnJFTUQuX3RvSlMobCl9OyAkKCIjd2luJHt0aGlzLm5hbWV9Iikud2luZG93KCJzZXRUaXRsZSIsICIke3RoaXMudGl0bGV9OiAiICsgYS5uYW1lKTsgYXdhaXQgYS5hY3Rpb24oREZvcm0uZ2V0KCkpOyAkKCIjd2luJHt0aGlzLm5hbWV9Iikud2luZG93KCJzZXRUaXRsZSIsICIke3RoaXMudGl0bGV9Iik7fSkoKSc+PC9hPmApLmpvaW4oJ1xuJykgKyAiPC9kaXY+IjsKCQkJCXREYXRhID0gYCx0b29sczoiIyR7dGhpcy5uYW1lfV90b29scyJgOwoJCQl9CgkJCXJldCArPSBgPGRpdiBpZD0nd2luJHt0aGlzLm5hbWV9JyBjbGFzcz0nZWFzeXVpLXdpbmRvdycgdGl0bGU9JyR7dGhpcy50aXRsZSB8fCB0aGlzLmVuZ2xpc2godGhpcy5uYW1lKX0nIGRhdGEtb3B0aW9ucz0naWNvbkNsczoiaWNvbi1zYXZlIiAke3REYXRhfScgc3R5bGU9J3dpZHRoOiR7dGhpcy53aWR0aH1weDtoZWlnaHQ6JHt0aGlzLmhlaWdodH1weDtwYWRkaW5nOjEwcHg7Jz5gOwoJCX0KCQlyZXR1cm4gcmV0ICsgYDxmb3JtIGlkPSJmcm0ke3RoaXMubmFtZX0iIG1ldGhvZD0icG9zdCIgbm92YWxpZGF0ZT5gOwoJfQoKCXJlbmRlckVsZW1lbnRzKGVsZW1lbnRzKSB7CgkJZWxlbWVudHMgPSBlbGVtZW50cyB8fCB0aGlzLmVsZW1lbnRzOwoKCQl2YXIgdFdpZHRoID0gTWF0aC5mbG9vcih0aGlzLndpZHRoICogMC45NSk7CgkJdmFyIHRIZWlnaHQgPSBNYXRoLmZsb29yKHRoaXMuaGVpZ2h0ICogMC44NSk7CgoJCWxldCByZXQgPSAnJzsKCQl2YXIgZ0VsZW1lbnRzID0gdGhpcy5zcigpLmdyb3VwQnkoZWxlbWVudHMsICJncm91cCIpOwoJCWlmIChnRWxlbWVudHMubGVuZ3RoID4gMSkgcmV0ICs9IGA8ZGl2IGlkPSJ0YmNXaW5kb3ciIGNsYXNzPSJlYXN5dWktdGFicyIgZGF0YS1vcHRpb25zPScke3RoaXMuZXZlbnRIYW5kbGVycyh7dHlwZTogJ3RhYnMnfSl9JyBzdHlsZT0id2lkdGg6JHt0V2lkdGh9cHg7aGVpZ2h0OiR7dEhlaWdodH1weDsiPmA7CgkJZm9yICh2YXIgZyA9IDA7IGcgPCBnRWxlbWVudHMubGVuZ3RoOyBnKyspIHsKCQkJaWYgKGdFbGVtZW50cy5sZW5ndGggPiAxKSByZXQgKz0gJzxkaXYgdGl0bGU9IicgKyAoZ0VsZW1lbnRzW2ddLmtleSB8fCAiTWFpbiIpICsgJyIgc3R5bGU9InBhZGRpbmc6MjBweDtkaXNwbGF5Om5vbmU7Ij4nOwoJCQl2YXIgc0VsZW1lbnRzID0gdGhpcy5zcigpLmdyb3VwQnkoZ0VsZW1lbnRzW2ddLnZhbHVlcywgInNlY3Rpb24iKTsKCQkJaWYgKHNFbGVtZW50cy5sZW5ndGggPiAxKSByZXQgKz0gJzxkaXYgY2xhc3M9ImVhc3l1aS1hY2NvcmRpb24iIHN0eWxlPSJ3aWR0aDonICsgdFdpZHRoICsgJ3B4O2hlaWdodDonICsgLyp0SGVpZ2h0Ki8gIjEwMCUiICsgJ3B4OyI+JzsKCQkJZm9yICh2YXIgcyA9IDA7IHMgPCBzRWxlbWVudHMubGVuZ3RoOyBzKyspIHsKCQkJCXJldCArPSBgPGRpdiB0aXRsZT0iJHtzRWxlbWVudHNbc10ua2V5IHx8ICIifSIgZGF0YS1vcHRpb25zPSJpY29uQ2xzOidpY29uLW1vcmUnIiBzdHlsZT0icGFkZGluZzoxMHB4OyI+YDsKCQkJCWZvciAodmFyIGkgPSAwOyBpIDwgc0VsZW1lbnRzW3NdLnZhbHVlcy5sZW5ndGg7IGkrKykgewoJCQkJCXZhciBlID0gc0VsZW1lbnRzW3NdLnZhbHVlc1tpXTsKCQkJCQlpZiAoZS5pZ25vcmUpIGNvbnRpbnVlOwoJCQkJCWUudmFsdWUgPSBlLnZhbHVlIHx8IF9GckVNRC5oYXNoW2UubmFtZV0gfHwgKF9GckVNRC5hcGlTZXJ2ZXIgPyBfRnJFTUQuYXBpU2VydmVyLl9fY29uZmlnKCd0ZXN0XycgKyBlLm5hbWUsICcnKSA6ICcnKTsKCQkJCQlyZXQgKz0gYDxkaXYgaWQ9ImZFbGVtZW50XyR7ZS5uYW1lfSIgY2xhc3M9ImZpdGVtIiBzdHlsZT0iZGlzcGxheTogJHsoZS50eXBlPT0nd2luZG93JyB8fCBlLmhpZGRlbik/J25vbmUnOicnfSI+YDsKCQkJCQlpZiAoZS50b2dnbGUpIHsKCQkJCQkJcmV0ICs9IGA8YSBocmVmPSIjIiBjbGFzcz0iZWFzeXVpLWxpbmtidXR0b24iIGRhdGEtb3B0aW9ucz0nJHt0aGlzLmV2ZW50SGFuZGxlcnMoe3R5cGU6ICd0b2dnbGUnLCBmb3I6IGV9KX0scGxhaW46dHJ1ZSxpY29uQ2xzOiJpY29uLSR7ZS5pY29uIHx8ICdzZWFyY2gnfSInIHN0eWxlPSJ3aWR0aDoxMDBweDtoZWlnaHQ6MzBweCI+JHtlLnRpdGxlIHx8IHRoaXMuZW5nbGlzaChlLm5hbWUpfTwvYT5gOwoJCQkJCX0gZWxzZSB7CgkJCQkJCXJldCArPSBgPGxhYmVsPiR7ZS50aXRsZSB8fCB0aGlzLmVuZ2xpc2goZS5uYW1lKX06PC9sYWJlbD5gOwoJCQkJCX0KCQkJCQlpZiAoZS50eXBlICYmIHRoaXNbZS50eXBlXSkgewoJCQkJCQlyZXQgKz0gdGhpc1tlLnR5cGVdKGUpOwoJCQkJCX0gZWxzZSBpZiAoZS5yZW5kZXIpIHsKCQkJCQkJcmV0ICs9IGUucmVuZGVyKCk7CgkJCQkJfQoJCQkJCXJldCArPSAnPC9kaXY+JzsKCQkJCX0KCQkJCXJldCArPSAnPC9kaXY+JzsKCQkJfQoJCQlpZiAoc0VsZW1lbnRzLmxlbmd0aCA+IDEpIHJldCArPSAnPC9kaXY+JzsKCQkJaWYgKGdFbGVtZW50cy5sZW5ndGggPiAxKSByZXQgKz0gIjwvZGl2PiI7CgkJfQoJCWlmIChnRWxlbWVudHMubGVuZ3RoID4gMSkgcmV0ICs9ICI8L2Rpdj4iOwoJCXJldHVybiByZXQ7Cgl9CgoJaW5mbyhtc2cpIHsKCQlpZiAoJC5tZXNzYWdlcikgewoJCQkkLm1lc3NhZ2VyLmFsZXJ0KHRoaXMudGl0bGUsIG1zZywgJ2luZm8nKTsKCQl9IGVsc2UgewoJCQl0aGlzLnNyKCkuU2hvd01lc3NhZ2UobXNnLCB0aGlzLnRpdGxlKTsKCQl9Cgl9CgoJZXJyb3IobXNnKSB7CgkJaWYgKCQubWVzc2FnZXIpIHsKCQkJJC5tZXNzYWdlci5hbGVydCh0aGlzLnRpdGxlLCBtc2csICdlcnJvcicpOwoJCX0gZWxzZSB7CgkJCXRoaXMuc3IoKS5TaG93TWVzc2FnZShtc2csIHRoaXMudGl0bGUpOwoJCX0KCX0KCglieU5hbWUobmFtZSkgewoJCXJldHVybiB0aGlzLmVsZW1lbnRzLmZpbmQoZSA9PiBlLm5hbWUgPT09IG5hbWUpOwoJfQoKCS8qKiBDb21wb25lbnRzOjpTdGFydCAqKi8KCUNvcmVDb21wb25lbnQgPSBjbGFzcyB7CgkJY29uc3RydWN0b3IocGFnZSwgZEZvcm0sIG9TY29wZSkgewoJCQl0aGlzLnBhZ2UgPSBwYWdlOwoJCQl0aGlzLmRGb3JtID0gZEZvcm0gfHwgREZvcm07CgkJCXRoaXMub1Njb3BlID0gb1Njb3BlOwoJCX0KCgkJX3NlcnZlcigpIHsKCQkJbGV0IHNjb3BlID0gd2luZG93LmJMb2NhbCA/ICJwbGF0Zm9ybW1hbmFnZXIiIDogX0ZyRU1ELmFwaVNlcnZlci5TY29wZTsKCQkJcmV0dXJuIG5ldyhfRnJFTUQuX19zY29wZShzY29wZSlbX0ZyRU1ELl9fc2NvcGUoc2NvcGUpLkVudGl0eUNsYXNzZXMuZmluZChjID0+IGMuSXNNYWluKS5OYW1lXSkoKTsKCQl9CgoJCV9lYVRvRmllbGQoZWEpIHsKCQkJaWYgKGVhLkVudGl0eVR5cGUpIHJldHVybiB7CgkJCQlncm91cDogZWEuR3JvdXAuTmFtZSwKCQkJCW5hbWU6IGVhLk5hbWUsCgkJCQlfdHlwZTogZWEuRW50aXR5VHlwZS5FbnRpdHlBdHRyaWJ1dGVzLmZpbmQocGVhID0+ICFwZWEuRW50aXR5TWV0aG9kICYmIHBlYS5FbnRpdHlUeXBlID09IGVhLkVudGl0eVR5cGUpID8gJ3RyZWUnIDogJ3NlbGVjdCcsCgkJCQl0eXBlOiAnc2VsZWN0JywKCQkJCXBhcmVudEZpZWxkOiBlYS5FbnRpdHlUeXBlLkVudGl0eUF0dHJpYnV0ZXMuZmluZChwZWEgPT4gIXBlYS5FbnRpdHlNZXRob2QgJiYgcGVhLkVudGl0eVR5cGUgPT0gZWEuRW50aXR5VHlwZSk/Lk5hbWUsCgkJCQkvL2lkRmllbGQ6ICdfVG9TdHJpbmcnLAoJCQkJem9uZTogJ2NlbnRlcicsCgkJCQlDbGFzczogewoJCQkJCU5hbWU6IGVhLkVudGl0eVR5cGUuTmFtZSwKCQkJCQlJZDogZWEuRW50aXR5VHlwZS5JZAoJCQkJfSwKCQkJCXNvdXJjZTogKG8sIGZEYXRhLCBzVGV4dCkgPT4gKHsKCQkJCQlPUEVSQVRPUlM6IHsKCQkJCQkJW2VhLkVudGl0eVR5cGUuRW50aXR5QXR0cmlidXRlcy5maW5kKGVhID0+IGVhLklzU3RyaW5nKS5OYW1lXTogJ2xpa2UnCgkJCQkJfSwKCQkJCQlbZWEuRW50aXR5VHlwZS5FbnRpdHlBdHRyaWJ1dGVzLmZpbmQoZWEgPT4gZWEuSXNTdHJpbmcpLk5hbWVdOiBzVGV4dAoKCQkJCX0pLAoJCQl9OwoJCQlpZiAoZWEuSXNUZXh0KSByZXR1cm4gewoJCQkJZ3JvdXA6IGVhLkdyb3VwLk5hbWUsCgkJCQluYW1lOiBlYS5OYW1lLAoJCQkJdHlwZTogJ3dpbmRvdycsCgkJCQl6b25lOiAnY2VudGVyJywKCQkJCWVkaXRvcjogdHJ1ZSwKCQkJCWxhbmd1YWdlOiBvID0+IGVhLk5hbWUgPT0gJ3NjcmlwdCcgPyAnamF2YXNjcmlwdCcgOiAidGV4dCIsCgkJCX07CgoJCQlyZXR1cm4gewoJCQkJZ3JvdXA6IGVhLkdyb3VwLk5hbWUsCgkJCQluYW1lOiBlYS5OYW1lLAoJCQkJem9uZTogJ2NlbnRlcicsCgkJCQl0eXBlOiBPYmplY3QuZW50cmllcyh7CgkJCQkJQm9vbDogJ2Jvb2wnLAoJCQkJCURhdGU6ICdkYXRldGltZScsCgkJCQkJSW50OiAnaW50JywKCQkJCQlMb25nOiAnbG9uZycsCgkJCQkJSW1hZ2U6ICdpbWFnZScsCgkJCQkJU3RyaW5nOiAnc3RyaW5nJwoJCQkJfSkuZmluZChlID0+IGVhWydJcycgKyBlWzBdXSlbMV0sCgkJCX07CgkJfQoKCQlidXN5KGJCdXN5KSB7CgkJCXJldHVybiB0aGlzLmRGb3JtLmJ1c3koYkJ1c3kpOwoJCX0KCgkJX21lKHYpIHsKCQkJbGV0IG1lTmFtZSA9ICh0eXBlb2YoY29tcGFueSkgIT09ICd1bmRlZmluZWQnKSA/IChjb21wYW55LmxvZ2dlZEluSWRlbnRpdHkgfHwgIm1lIikgOiAibWUiOwoJCQlpZiAodikgewoJCQkJd2luZG93W21lTmFtZV0gPSB2OwoJCQl9CgoJCQlyZXR1cm4gd2luZG93W21lTmFtZV07CgkJfQoKCQlfY2FuVmlldygpIHsKCQkJaWYgKCF0aGlzLl9tZSgpKSB7CgkJCQl3aW5kb3cuX0ZyRU1ELnNldFVSTCh7CgkJCQkJcGFnZTogJ2xvZ2luJywKCQkJCQlfcmVkaXJlY3Q6IHRoaXMucGFnZS5fY29kZSwKCQkJCX0pOwoJCQkJdGhyb3cgYF9jYW5WaWV3OiAke3RoaXMucGFnZS5fY29kZX0gbm90IGFsbG93ZWQgd2l0aG91dCBsb2dpbiFgOwoJCQl9CgkJfQoKCQlfbmFtZSgpIHsKCQkJaWYgKCF0aGlzLl9tZSgpKSByZXR1cm4gIiI7CgkJCXJldHVybiB0aGlzLl9tZSgpLm5hbWUgPyB0aGlzLl9tZSgpLm5hbWUoKSA6IHRoaXMuX21lKCkuVG9TdHJpbmc7CgkJfQoJfQoKCU1haW5Db21wb25lbnQgPSBjbGFzcyBleHRlbmRzIHRoaXMuQ29yZUNvbXBvbmVudCB7CgkJX21lbnVDbGFzc2VzKHNjb3BlKSB7CgkJCWxldCBvU2NvcGUgPSBfRnJFTUQuX19zY29wZShzY29wZSk7CgkJCS8vY29uc29sZS5sb2coIk1haW5Db21wb25lbnQ6Ol9tZW51Q2xhc3NlcygiICsgc2NvcGUgKyAiKTogb1Njb3BlIiwgc2NvcGUsIG9TY29wZSwgX0ZyRU1ELmFwaVNlcnZlcik7CgkJCWlmICghb1Njb3BlKSByZXR1cm4gW107CgoJCQlyZXR1cm4gX0ZyRU1ELnNyKCkuZ3JvdXBCeShvU2NvcGUuRW50aXR5Q2xhc3NlcywgJ0VudGl0eU1vZHVsZScpLm1hcChnID0+ICh7CgkJCQlsYWJlbDogKGcua2V5ID8gdGhpcy5kRm9ybS5lbmdsaXNoKGcua2V5Lk5hbWUpIDogbnVsbCkgfHwgJ01haW4nLAoJCQkJc3ViTWVudXM6IF9GckVNRC5zcigpLmdyb3VwQnkoZy52YWx1ZXMsICdHcm91cCcpLm1hcChndiA9PiAoewoJCQkJCWxhYmVsOiAoZ3Yua2V5ID8gdGhpcy5kRm9ybS5lbmdsaXNoKGd2LmtleS5OYW1lKSA6IG51bGwpIHx8ICdNYWluJywKCQkJCQlzdWJNZW51czogZ3YudmFsdWVzLm1hcChndnYgPT4gKHsKCQkJCQkJbGFiZWw6IHRoaXMuZEZvcm0uZW5nbGlzaChndnYuTmFtZSksCgkJCQkJCWNvZGU6ICdzdG9yZScsCgkJCQkJCWRhdGE6IGd2di5OYW1lCgkJCQkJfSkpCgkJCQl9KSkKCQkJfSkpOwoJCX0KCgkJX21lbnVNZXRob2RzKHNjb3BlKSB7CgkJCWxldCBvU2NvcGUgPSBfRnJFTUQuX19zY29wZShzY29wZSk7CgkJCS8vY29uc29sZS5sb2coIk1haW5Db21wb25lbnQ6Ol9tZW51TWV0aG9kcygiICsgc2NvcGUgKyAiKTogb1Njb3BlIiwgc2NvcGUsIG9TY29wZSwgX0ZyRU1ELmFwaVNlcnZlcik7CgkJCWlmICghb1Njb3BlKSByZXR1cm4gW107CgoJCQlyZXR1cm4gX0ZyRU1ELnNyKCkuZ3JvdXBCeShvU2NvcGUuRW50aXR5Q2xhc3Nlcy5maWx0ZXIoZWMgPT4gZWMuRW50aXR5TWV0aG9kcy5sZW5ndGgpLCAnRW50aXR5TW9kdWxlJykubWFwKGcgPT4gKHsKCQkJCWxhYmVsOiAoZy5rZXkgPyB0aGlzLmRGb3JtLmVuZ2xpc2goZy5rZXkuTmFtZSkgOiBudWxsKSB8fCAnTWFpbicsCgkJCQlzdWJNZW51czogX0ZyRU1ELnNyKCkuZ3JvdXBCeShnLnZhbHVlcywgJ0dyb3VwJykubWFwKGd2ID0+ICh7CgkJCQkJbGFiZWw6IChndi5rZXkgPyB0aGlzLmRGb3JtLmVuZ2xpc2goZ3Yua2V5Lk5hbWUpIDogbnVsbCkgfHwgJ01haW4nLAoJCQkJCXN1Yk1lbnVzOiBndi52YWx1ZXMubWFwKG1jID0+ICh7CgkJCQkJCWxhYmVsOiB0aGlzLmRGb3JtLmVuZ2xpc2gobWMuTmFtZSksCgkJCQkJCXN1Yk1lbnVzOiBtYy5FbnRpdHlNZXRob2RzLm1hcChlbSA9PiAoewoJCQkJCQkJbGFiZWw6IHRoaXMuZEZvcm0uZW5nbGlzaChlbS5OYW1lKSwKCQkJCQkJCWNvZGU6ICdtZXRob2QnLAoJCQkJCQkJZGF0YTogbWMuTmFtZSArICIuIiArIGVtLk5hbWUKCQkJCQkJfSkpCgkJCQkJfSkpCgkJCQl9KSkKCQkJfSkpOwoJCX0KCgkJX2J1aWxkTWVudShzY29wZSkgewoJCQlyZXR1cm4gW3sKCQkJCWxhYmVsOiAiTWFpbiIsCgkJCQlvcmRlcjogLTEsCgkJCQlzdWJNZW51czogW3sKCQkJCQlsYWJlbDogJ0luZGV4JywKCQkJCX0sIHsKCQkJCQlsYWJlbDogIkxvZ2luIiwKCQkJCX0sIHsKCQkJCQlsYWJlbDogIkxvYWQiLAoJCQkJfSwgewoJCQkJCWxhYmVsOiAiU2F2ZSIsCgkJCQl9LCB7CgkJCQkJbGFiZWw6ICJMb2dvdXQiCgkJCQl9XQoJCQl9LCB7CgkJCQlsYWJlbDogIlByb2Nlc3MiLAoJCQkJb3JkZXI6IDk5OTk4LAoJCQkJc3ViTWVudXM6IHRoaXMuX21lbnVNZXRob2RzKHNjb3BlKQoJCQl9LCB7CgkJCQlsYWJlbDogIlNldHVwIiwKCQkJCW9yZGVyOiA5OTk5OSwKCQkJCXN1Yk1lbnVzOiB0aGlzLl9tZW51Q2xhc3NlcyhzY29wZSkKCQkJfV07CgkJfQoJfQoKCUxvYWRDb21wb25lbnQgPSBjbGFzcyBleHRlbmRzIHRoaXMuQ29yZUNvbXBvbmVudCB7CgkJYXN5bmMgbWFpbigpIHsKCQkJdGhpcy5wYWdlLmRhdGEgPSB7CgkJCQlmb3JtOiB0aGlzLmRGb3JtLnJlbmRlcignZnJtTG9hZCcsICJMb2FkIFNldHVwIERhdGEiLCBbewoJCQkJCW5hbWU6ICdFeGNlbCcsCgkJCQkJdHlwZTogImZpbGUiLAoJCQkJCWJpbmFyeTogdHJ1ZSwKCQkJCQlsb2NhbDogdHJ1ZSwKCQkJCQl1cGxvYWQ6IGFzeW5jIChmRGF0YSwgZGF0YSkgPT4gewoJCQkJCQl0aGlzLmRGb3JtLnNldCh7CgkJCQkJCQlQcm9ncmVzczogMAoJCQkJCQl9KTsKCgkJCQkJCWxldCB0YWJsZXMgPSBbXTsKCQkJCQkJbGV0IG9iaiA9IFtdOwoKCQkJCQkJbGV0IHNlcnZlciA9IHRoaXMuX3NlcnZlcigpOwoKCQkJCQkJY29uc3Qgd2IgPSBuZXcgRXhjZWxKUy5Xb3JrYm9vaygpOwoJCQkJCQljb25zb2xlLmNsZWFyKCk7CgkJCQkJCWxldCB3b3JrYm9vayA9IGF3YWl0IHdiLnhsc3gubG9hZChkYXRhKTsKCQkJCQkJd29ya2Jvb2suZWFjaFNoZWV0KChzaGVldCwgaWQpID0+IHsKCQkJCQkJCWxldCBzVGFibGVzID0gc2hlZXQuZ2V0VGFibGVzKCk7CgkJCQkJCQlzVGFibGVzLmZvckVhY2godCA9PiB0LnRhYmxlLnNoZWV0ID0gc2hlZXQpOwoJCQkJCQkJdGFibGVzLnB1c2goLi4uc1RhYmxlcyk7CgkJCQkJCX0pOwoJCQkJCQl0YWJsZXMgPSB0YWJsZXMuZmxhdCgpLm1hcCh0ID0+IHQudGFibGUpOwoKCQkJCQkJLy9jb25zb2xlLmNsZWFyKCk7CgkJCQkJCXRhYmxlcy5mb3JFYWNoKHQgPT4gewoJCQkJCQkJLy9jb25zb2xlLmxvZyh0Lm5hbWUsIHQuY29sdW1ucywgdC5zaGVldC5nZXRDZWxsKCdBMicpLnZhbHVlKTsKCQkJCQkJCWZvciAodmFyIGkgPSAyOyB0LnNoZWV0LmdldENlbGwoJ0EnICsgaSkudmFsdWUgIT09IG51bGw7IGkrKykgewoJCQkJCQkJCW9iai5wdXNoKHNlcnZlci5fbmV3KHQubmFtZSkuX2Zyb21Eb2N1bWVudChPYmplY3QuYXNzaWduKC4uLnQuY29sdW1ucy5tYXAoKGMsIGNpKSA9PiAoewoJCQkJCQkJCQlbYy5uYW1lXTogdC5zaGVldC5nZXRDZWxsKFN0cmluZy5mcm9tQ2hhckNvZGUoJ0EnLmNoYXJDb2RlQXQoMCkgKyBjaSkgKyBpKS52YWx1ZQoJCQkJCQkJCX0pKSkpKTsKCQkJCQkJCX0KCQkJCQkJfSk7CgoJCQkJCQlmb3IgYXdhaXQgKGNvbnN0IG8gb2Ygb2JqKSB7CgkJCQkJCQkvL2F3YWl0IF9GckVNRC5fd2FpdCgxMDAwKQoJCQkJCQkJYXdhaXQgby5zdG9yZSgpOwoJCQkJCQkJdGhpcy5kRm9ybS5zZXQoewoJCQkJCQkJCVByb2dyZXNzOiB0aGlzLmRGb3JtLmdldCgpLlByb2dyZXNzICsgMTAwLjAgLyBvYmoubGVuZ3RoCgkJCQkJCQl9KTsKCQkJCQkJfQoKCQkJCQkJX0ZyRU1ELlJlbmRlclBhZ2UoewoJCQkJCQkJX2NvZGU6ICdsb2dpbicKCQkJCQkJfSk7CgkJCQkJfQoJCQkJfSwgewoJCQkJCW5hbWU6ICJQcm9ncmVzcyIsCgkJCQkJdHlwZTogInByb2dyZXNzIiwKCQkJCX1dLCBbewoJCQkJCW5hbWU6ICdMb2FkJywKCQkJCQlvbmNsaWNrOiBhc3luYyBvID0+IHt9CgkJCQl9XSkKCQkJfTsKCQl9Cgl9CgoJU2F2ZUNvbXBvbmVudCA9IGNsYXNzIGV4dGVuZHMgdGhpcy5Db3JlQ29tcG9uZW50IHsKCQlhc3luYyBtYWluKCkgewoJCQkvL3RoaXMuX2NhblZpZXcoKTsKCgkJCXRoaXMucGFnZS5kYXRhID0gewoJCQkJZm9ybTogdGhpcy5kRm9ybS5yZW5kZXIoJ2ZybVNhdmUnLCAiU2F2ZSBTZXR1cCBEYXRhIiwgW3sKCQkJCQluYW1lOiAnU2F2ZScsCgkJCQkJdHlwZTogImxhYmVsIiwKCQkJCQl2YWx1ZTogIkV4cG9ydCB0byBFeGNlbCIsCgkJCQl9LCB7CgkJCQkJbmFtZTogJ1RpdGxlJywKCQkJCQl0eXBlOiAnc3RyaW5nJywKCQkJCQl2YWx1ZTogJycsCgkJCQl9LCB7CgkJCQkJbmFtZTogIlByb2dyZXNzIiwKCQkJCQl0eXBlOiAicHJvZ3Jlc3MiLAoJCQkJfV0sIFt7CgkJCQkJbmFtZTogJ1NhdmUnLAoJCQkJCW9uY2xpY2s6IGFzeW5jIG8gPT4gewoJCQkJCQljb25zb2xlLmNsZWFyKCk7CgoJCQkJCQl0aGlzLmRGb3JtLnNldCh7CgkJCQkJCQlQcm9ncmVzczogMAoJCQkJCQl9KTsKCgkJCQkJCWxldCBzZXJ2ZXIgPSB0aGlzLl9zZXJ2ZXIoKTsKCgkJCQkJCWxldCB0VGVtcGxhdGUgPSB7CgkJCQkJCQloZWFkZXJSb3c6IHRydWUsCgkJCQkJCQlzdHlsZTogewoJCQkJCQkJCXRoZW1lOiAnVGFibGVTdHlsZURhcmszJywKCQkJCQkJCQlzaG93Um93U3RyaXBlczogdHJ1ZSwKCQkJCQkJCX0sCgkJCQkJCX07CgkJCQkJCWxldCB0YWJsZXMgPSBbXTsKCQkJCQkJZm9yIGF3YWl0IChjb25zdCBjIG9mIF9GckVNRC5fX3Njb3BlKHNlcnZlci5TY29wZSkuRW50aXR5Q2xhc3Nlcy5zb3J0KChhLCBiKSA9PiBhLlJhbmsgLSBiLlJhbmspKSB7CgkJCQkJCQkvL2NvbnNvbGUubG9nKCJEeW5hRm9ybTo6U2F2ZUNvbXBvbmVudCgpOiAiICsgYy5OYW1lICsgIiwgUmFuaz0iICsgYy5SYW5rKTsKCQkJCQkJCXRhYmxlcy5wdXNoKE9iamVjdC5hc3NpZ24oSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSh0VGVtcGxhdGUpKSwgYXdhaXQgc2VydmVyLl9uZXcoYy5OYW1lKS5fdG9UYWJ1bGFyKCkpKTsKCQkJCQkJCXRoaXMuZEZvcm0uc2V0KHsKCQkJCQkJCQlQcm9ncmVzczogdGhpcy5kRm9ybS5nZXQoKS5Qcm9ncmVzcyArIDEwMC4wIC8gX0ZyRU1ELl9fc2NvcGUoc2VydmVyLlNjb3BlKS5FbnRpdHlDbGFzc2VzLmxlbmd0aAoJCQkJCQkJfSk7CgkJCQkJCX0KCQkJCQkJdGFibGVzLmZvckVhY2godCA9PiB0LnJlZiA9ICdBMTonICsgU3RyaW5nLmZyb21DaGFyQ29kZSgnQScuY2hhckNvZGVBdCgwKSArIHQuY29sdW1ucy5sZW5ndGggLSAxKSArICh0LnJvd3MubGVuZ3RoICsgMSkpOwoKCQkJCQkJbGV0IHJnYiA9IChsZXR0ZXJzID0gJzAxMjM0NTY3ODlBQkNERUYnKSA9PiBBcnJheSg2KS5tYXAoaSA9PiBsZXR0ZXJzW01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDE2KV0pLmpvaW4oJycpOwoKCQkJCQkJY29uc3Qgd29ya2Jvb2sgPSBuZXcgRXhjZWxKUy5Xb3JrYm9vaygpOwoJCQkJCQl0YWJsZXMuZm9yRWFjaCh0ID0+IHdvcmtib29rLmFkZFdvcmtzaGVldCh0Lm5hbWUsIHsKCQkJCQkJCXByb3BlcnRpZXM6IHsKCQkJCQkJCQl0YWJDb2xvcjogewoJCQkJCQkJCQlhcmdiOiAnRicgKyByZ2IoKQoJCQkJCQkJCX0KCQkJCQkJCX0KCQkJCQkJfSkuYWRkVGFibGUodCkpOwoKCQkJCQkJbGV0IGJ1ZmZlciA9IGF3YWl0IHdvcmtib29rLnhsc3gud3JpdGVCdWZmZXIoewoJCQkJCQkJZGF0ZUZvcm1hdDogJ1lZWVktTU0tREQgSEg6bW06c3MnCgkJCQkJCX0pOwoKCQkJCQkJY29uc3QgbGluayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTsKCQkJCQkJbGluay5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwoJCQkJCQlkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGxpbmspOwoJCQkJCQlsaW5rLmhyZWYgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKG5ldyBCbG9iKFtidWZmZXJdLCB7CgkJCQkJCQl0eXBlOiAnYXBwbGljYXRpb24vdm5kLm9wZW54bWxmb3JtYXRzLW9mZmljZWRvY3VtZW50LnNwcmVhZHNoZWV0bWwuc2hlZXQ7Y2hhcnNldD1VVEYtOCcKCQkJCQkJfSkpOwoJCQkJCQlsaW5rLmRvd25sb2FkID0gKG8uVGl0bGUgfHwgc2VydmVyLlNjb3BlIHx8ICJkYXRhIikgKyAiLnhsc3giOwoJCQkJCQlsaW5rLmNsaWNrKCk7CgkJCQkJfQoJCQkJfV0pCgkJCX07CgkJfQoJfQoKCUluZGV4Q29tcG9uZW50ID0gY2xhc3MgZXh0ZW5kcyB0aGlzLkNvcmVDb21wb25lbnQgewoJCWFzeW5jIG1haW4oKSB7CgkJCXRoaXMuX2NhblZpZXcoKTsKCgkJCXRoaXMucGFnZS5kYXRhID0gewoJCQkJZm9ybTogdGhpcy5kRm9ybS5yZW5kZXIoJ2ZybUluZGV4JywgIk1haW4gUGFnZSIsIFt7CgkJCQkJbmFtZTogJ1dlbGNvbWUnLAoJCQkJCXJlcXVpcmVkOiB0cnVlLAoJCQkJCXR5cGU6ICJsYWJlbCIsCgkJCQkJdmFsdWU6IHRoaXMuX25hbWUoKSwKCQkJCX1dLCBbXSkKCQkJfTsKCQl9Cgl9CgoJTG9nb3V0Q29tcG9uZW50ID0gY2xhc3MgZXh0ZW5kcyB0aGlzLkNvcmVDb21wb25lbnQgewoJCW1haW4oKSB7CgkJCXRoaXMuX2NhblZpZXcoKTsKCgkJCWRlbGV0ZSB3aW5kb3cubWU7CgoJCQl0aGlzLnBhZ2UuZGF0YSA9IHsKCQkJCWZvcm06IHRoaXMuZEZvcm0ucmVuZGVyKCdmcm1Mb2dvdXQnLCAiTG9nb3V0IiwgW3sKCQkJCQkJbmFtZTogIkxvZ291dCIsCgkJCQkJCXR5cGU6ICJsYWJlbCIsCgkJCQkJCXZhbHVlOiAibG9nb3V0IGluIHByb2dyZXNzLi4uIgoJCQkJCX1dLAoJCQkJCVtdKQoJCQl9OwoKCQkJX0ZyRU1ELlJlbmRlclBhZ2UoewoJCQkJX2NvZGU6ICJsb2dpbiIKCQkJfSk7CgkJfQoJfQoKCUxvZ2luQ29tcG9uZW50ID0gY2xhc3MgZXh0ZW5kcyB0aGlzLkNvcmVDb21wb25lbnQgewoJCWFzeW5jIF9hdXRoZW50aWNhdGUobykgewoJCQkvL2lmICghd2luZG93LmJMb2NhbCAmJiAoIV9GckVNRC5fX3Njb3BlKCkgfHwgIV9GckVNRC5fX3Njb3BlKCkuRW50aXR5Q2xhc3NlcykpIHJldHVybjsKCgkJCWxldCBhdXRoQ2xhc3NOYW1lID0gX0ZyRU1ELl9fc2NvcGUoKT8uRW50aXR5Q2xhc3Nlcz8uZmluZChjID0+IGMuRW50aXR5QXR0cmlidXRlcy5maW5kKGVhID0+IGVhLk5hbWUgPT0gJ3VzZXJuYW1lJykpPy5OYW1lOwoJCQlpZiAoX0ZyRU1ELmFwaVNlcnZlciAmJiBhdXRoQ2xhc3NOYW1lKSByZXR1cm4gYXdhaXQgX0ZyRU1ELmFwaVNlcnZlci5fbmV3KGF1dGhDbGFzc05hbWUpLnVzZXJuYW1lKG8uVXNlcm5hbWUsICc9JykucGFzc3dvcmQoby5QYXNzd29yZCwgJz0nKS5hY3RpdmUodHJ1ZSkuZW5hYmxlZCh0cnVlKS5maW5kKCk7CgoJCQlhdXRoQ2xhc3NOYW1lID0gYXV0aENsYXNzTmFtZSB8fCAod2luZG93LmJMb2NhbCA/ICh7CgkJCQljbXM6ICJBdXRob3IiLAoJCQkJZW1zOiAiRW1wbG95ZWUiCgkJCX0pW2NvbXBhbnkuQ29kZV0gOiBudWxsKTsKCgkJCW8uT1BFUkFUT1JTID0gewoJCQkJVXNlcm5hbWU6ICI9IiwKCQkJCVBhc3N3b3JkOiAiPSIKCQkJfTsKCgkJCWlmIChhdXRoQ2xhc3NOYW1lKSByZXR1cm4gKGF3YWl0IHNyLl8oImVtcyIgKyBhdXRoQ2xhc3NOYW1lICsgIkZpbmQiLCBudWxsLCBvKSk7CgkJfQoKCQlhc3luYyBfbG9nZ2VkSW4oKSB7fQoKCQlhc3luYyBfbm90TG9nZ2VkSW4oKSB7fQoKCQlhc3luYyBtYWluKCkgewoJCQl0aGlzLnBhZ2UuZGF0YSA9IHsKCQkJCWZvcm06IHRoaXMuZEZvcm0ucmVuZGVyKCdmcm1Mb2dpbicsICJVc2VyIEF1dGhlbnRpY2F0aW9uIiwgW3sKCQkJCQkJbmFtZTogJ1VzZXJuYW1lJywKCQkJCQkJcmVxdWlyZWQ6IHRydWUsCgkJCQkJCXR5cGU6ICJzdHJpbmciCgkJCQkJfSwKCQkJCQl7CgkJCQkJCW5hbWU6ICdQYXNzd29yZCcsCgkJCQkJCXJlcXVpcmVkOiB0cnVlLAoJCQkJCQl0eXBlOiAicGFzc3dvcmQiCgkJCQkJfQoJCQkJXSwgW3sKCQkJCQluYW1lOiAnTG9naW4nLAoJCQkJCWF1dG9TdWJtaXQ6IHRydWUsCgkJCQkJb25jbGljazogYXN5bmMgbyA9PiB7CgkJCQkJCWxldCByZXQgPSBhd2FpdCB0aGlzLl9hdXRoZW50aWNhdGUobyk7CgoJCQkJCQlpZiAocmV0KSB7CgkJCQkJCQl0aGlzLl9tZShyZXQpOwoKCQkJCQkJCXRyeSB7CgkJCQkJCQkJYXdhaXQgdGhpcy5fbG9nZ2VkSW4oKTsKCQkJCQkJCX0gY2F0Y2ggKGV4KSB7fQoKCQkJCQkJCV9GckVNRC5zZXRVUkwoewoJCQkJCQkJCXBhZ2U6IF9GckVNRC5oYXNoLl9yZWRpcmVjdCB8fCAiaW5kZXgiCgkJCQkJCQl9KTsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCXRyeSB7CgkJCQkJCQkJYXdhaXQgdGhpcy5fbm90TG9nZ2VkSW4oKTsKCQkJCQkJCX0gY2F0Y2ggKGV4KSB7fQoKCQkJCQkJCXRoaXMuZEZvcm0uZXJyb3IoIkludmFsaWQgdXNlcm5hbWUgb3IgcGFzc3dvcmQiKTsKCQkJCQkJfQoKCQkJCQkJdGhpcy5kRm9ybS5idXN5KGZhbHNlKTsKCQkJCQl9CgkJCQl9XSkKCQkJfTsKCQl9Cgl9CgoJTWV0aG9kQ29tcG9uZW50ID0gY2xhc3MgZXh0ZW5kcyB0aGlzLkNvcmVDb21wb25lbnQgewoJCWFzeW5jIG1haW4oKSB7CgkJCXRoaXMuX2NhblZpZXcoKTsKCgkJCXRoaXMuc01ldGhvZCA9IHRoaXMucGFnZS5kYXRhOwoJCQljb25zb2xlLmNsZWFyKCk7CgoJCQlsZXQgZW0gPSAoX0ZyRU1ELl9fc2NvcGUoKSB8fCB0aGlzLm9TY29wZSkuRW50aXR5Q2xhc3Nlcy5maW5kKGMgPT4gYy5OYW1lID09IHRoaXMuc01ldGhvZC5zcGxpdCgnLicpWzBdKS5FbnRpdHlNZXRob2RzLmZpbmQobSA9PiBtLk5hbWUgPT0gdGhpcy5zTWV0aG9kLnNwbGl0KCcuJylbMV0pOwoKCQkJdGhpcy5wYWdlLmRhdGEgPSB7CgkJCQlmb3JtOiB0aGlzLmRGb3JtLnJlbmRlcih0aGlzLnNNZXRob2QsIF9GckVNRC5fdGl0bGVDYXNlKHRoaXMuc01ldGhvZC5zcGxpdCgnLicpWzBdKSArICcgOjogJyArIF9GckVNRC5fdGl0bGVDYXNlKHRoaXMuc01ldGhvZC5zcGxpdCgnLicpWzFdKSwgZW0uTWV0aG9kUGFyYW1ldGVycy5tYXAocCA9PiB0aGlzLl9lYVRvRmllbGQocCkpLCBbewoJCQkJCW5hbWU6ICdSZXNldCcsCgkJCQkJb25jbGljazogbyA9PiB7CgkJCQkJCXRoaXMuZEZvcm0uY2xlYXIoKTsKCQkJCQl9LAoJCQkJCWljb246ICJjYW5jZWwiCgkJCQl9LCB7CgkJCQkJbmFtZTogJ1JlbG9hZCcsCgkJCQkJb25jbGljazogbyA9PiBfRnJFTUQuUmVuZGVyUGFnZSh7CgkJCQkJCV9jb2RlOiAnc3RvcmUnCgkJCQkJfSwgdGhpcy5zVGFibGUpLAoJCQkJCWljb246ICJyZWxvYWQiCgkJCQl9LCB7CgkJCQkJbmFtZTogJ1NhdmUnLAoJCQkJCW9uY2xpY2s6IGFzeW5jIG8gPT4gewoJCQkJCQlsZXQgb2JqID0gX0ZyRU1ELmFwaVNlcnZlci5fbmV3KHRoaXMuc1RhYmxlKTsKCQkJCQkJLy9jb25zb2xlLmxvZygib25jbGljaygpIiwgdGhpcy5zVGFibGUsIG9iaiwgbywgb1t0aGlzLnNUYWJsZV0pOwoJCQkJCQlpZiAob1t0aGlzLnNUYWJsZV0gJiYgdHlwZW9mKG9bdGhpcy5zVGFibGVdLl9fc3luY19vbikgPT09ICdmdW5jdGlvbicgJiYgb1t0aGlzLnNUYWJsZV0uX19zeW5jX29uKCkpIG9iai5JZCA9IG9bdGhpcy5zVGFibGVdLklkOwoKCQkJCQkJZWMuRW50aXR5QXR0cmlidXRlcy5maWx0ZXIoZWEgPT4gIWVhLkVudGl0eU1ldGhvZCkuZm9yRWFjaChlYSA9PiBvYmpbZWEuTmFtZV0ob1tlYS5OYW1lXSkpOwoJCQkJCQkvL3JldHVybiBjb25zb2xlLmxvZyhvYmouX3RvRmlsZU5hbWUoKSwgb2JqKTsKCQkJCQkJYXdhaXQgb2JqLnN0b3JlKCk7CgkJCQkJfQoJCQkJfV0pCgkJCX07CgkJfQoJfQoKCVN0b3JlQ29tcG9uZW50ID0gY2xhc3MgZXh0ZW5kcyB0aGlzLkNvcmVDb21wb25lbnQgewoJCWFzeW5jIG1haW4oKSB7CgkJCXRoaXMuX2NhblZpZXcoKTsKCgkJCXRoaXMuc1RhYmxlID0gdGhpcy5wYWdlLmRhdGE7CgkJCWNvbnNvbGUuY2xlYXIoKTsKCgkJCS8vY29uc29sZS5sb2coIkR5bmFGb3JtOjpTdG9yZUNvbXBvbmVudCgpOiBzVGFibGUiLCB0aGlzLnNUYWJsZSk7CgoJCQlsZXQgZWMgPSBfRnJFTUQuX19zY29wZSgpLkVudGl0eUNsYXNzZXMuZmluZChjID0+IGMuTmFtZSA9PSB0aGlzLnNUYWJsZSk7CgoJCQl0aGlzLnBhZ2UuZGF0YSA9IHsKCQkJCWZvcm06IHRoaXMuZEZvcm0ucmVuZGVyKGVjLk5hbWUucmVwbGFjZSgvXCAvZywgJ18nKSwgX0ZyRU1ELl90aXRsZUNhc2UoZWMuTmFtZSksIFt7CgkJCQkJbmFtZTogZWMuTmFtZS5yZXBsYWNlKC9cIC9nLCAnXycpLAoJCQkJCXRpdGxlOiBfRnJFTUQuX3RpdGxlQ2FzZShlYy5OYW1lKSwKCQkJCQlDbGFzczogewoJCQkJCQlOYW1lOiBlYy5OYW1lLAoJCQkJCQlJZDogZWMuSWQKCQkJCQl9LAoJCQkJCXpvbmU6ICdub3J0aCcsCgkJCQkJdHlwZTogZWMuRW50aXR5QXR0cmlidXRlcy5maW5kKHBlYSA9PiAhcGVhLkVudGl0eU1ldGhvZCAmJiBwZWEuRW50aXR5VHlwZSA9PSBlYykgPyAndHJlZScgOiAnc2VsZWN0JywKCQkJCQlwYXJlbnRGaWVsZDogZWMuRW50aXR5QXR0cmlidXRlcy5maW5kKHBlYSA9PiAhcGVhLkVudGl0eU1ldGhvZCAmJiBwZWEuRW50aXR5VHlwZSA9PSBlYyk/Lk5hbWUsCgkJCQkJLy9zZWFyY2hGaWVsZDogZWMuRW50aXR5QXR0cmlidXRlcy5maW5kKGVhID0+IGVhLklzU3RyaW5nKS5OYW1lLAoJCQkJCS8vaWRGaWVsZDogJ19Ub1N0cmluZycsCgkJCQkJc291cmNlOiAobywgZkRhdGEsIHNUZXh0KSA9PiAoewoJCQkJCQlPUEVSQVRPUlM6IHsKCQkJCQkJCVtlYy5FbnRpdHlBdHRyaWJ1dGVzLmZpbmQoZWEgPT4gZWEuSXNTdHJpbmcpLk5hbWVdOiAnbGlrZScKCQkJCQkJfSwKCQkJCQkJW2VjLkVudGl0eUF0dHJpYnV0ZXMuZmluZChlYSA9PiBlYS5Jc1N0cmluZykuTmFtZV06IHNUZXh0CgoJCQkJCX0pLAoJCQkJCXNlbGVjdDogYXN5bmMgbyA9PiB7CgkJCQkJCXRoaXMuZEZvcm0uY2xlYXIoKTsKCQkJCQkJdGhpcy5kRm9ybS5idXN5KHRydWUpOwoKCQkJCQkJbGV0IHIgPSBhd2FpdCBvLmZpbmQoKTsKCQkJCQkJdGhpcy5kRm9ybS5zZXQoT2JqZWN0LmFzc2lnbih7CgkJCQkJCQlbZWMuTmFtZS5yZXBsYWNlKC9cIC9nLCAnXycpXTogcgoJCQkJCQl9LCAuLi5lYy5FbnRpdHlBdHRyaWJ1dGVzLmZpbHRlcihlYSA9PiAhZWEuRW50aXR5TWV0aG9kKS5maWx0ZXIoZWEgPT4gdHlwZW9mKHJbZWEuTmFtZV0oKSkgIT09ICd1bmRlZmluZWQnKS5tYXAoZWEgPT4gKHsKCQkJCQkJCVtlYS5OYW1lXTogcltlYS5OYW1lXSgpCgkJCQkJCX0pKSkpOwoJCQkJCQl0aGlzLmRGb3JtLmJ1c3koZmFsc2UpOwoJCQkJCX0KCQkJCX1dLmNvbmNhdCguLi5lYy5FbnRpdHlBdHRyaWJ1dGVzLmZpbHRlcihlYSA9PiAhZWEuRW50aXR5TWV0aG9kKS5tYXAoZWEgPT4gdGhpcy5fZWFUb0ZpZWxkKGVhKSkpLCBbewoJCQkJCW5hbWU6ICdSZXNldCcsCgkJCQkJb25jbGljazogbyA9PiB7CgkJCQkJCXRoaXMuZEZvcm0uY2xlYXIoKTsKCQkJCQl9LAoJCQkJCWljb246ICJjYW5jZWwiCgkJCQl9LCB7CgkJCQkJbmFtZTogJ1JlbG9hZCcsCgkJCQkJb25jbGljazogbyA9PiBfRnJFTUQuUmVuZGVyUGFnZSh7CgkJCQkJCV9jb2RlOiAnc3RvcmUnCgkJCQkJfSwgdGhpcy5zVGFibGUpLAoJCQkJCWljb246ICJyZWxvYWQiCgkJCQl9LCB7CgkJCQkJbmFtZTogJ1NhdmUnLAoJCQkJCW9uY2xpY2s6IGFzeW5jIG8gPT4gewoJCQkJCQlsZXQgb2JqID0gX0ZyRU1ELmFwaVNlcnZlci5fbmV3KHRoaXMuc1RhYmxlKTsKCQkJCQkJLy9jb25zb2xlLmxvZygib25jbGljaygpIiwgdGhpcy5zVGFibGUsIG9iaiwgbywgb1t0aGlzLnNUYWJsZV0pOwoJCQkJCQlpZiAob1t0aGlzLnNUYWJsZV0gJiYgdHlwZW9mKG9bdGhpcy5zVGFibGVdLl9fc3luY19vbikgPT09ICdmdW5jdGlvbicgJiYgb1t0aGlzLnNUYWJsZV0uX19zeW5jX29uKCkpIG9iai5JZCA9IG9bdGhpcy5zVGFibGVdLklkOwoKCQkJCQkJZWMuRW50aXR5QXR0cmlidXRlcy5maWx0ZXIoZWEgPT4gIWVhLkVudGl0eU1ldGhvZCkuZm9yRWFjaChlYSA9PiBvYmpbZWEuTmFtZV0ob1tlYS5OYW1lXSkpOwoJCQkJCQkvL3JldHVybiBjb25zb2xlLmxvZyhvYmouX3RvRmlsZU5hbWUoKSwgb2JqKTsKCQkJCQkJYXdhaXQgb2JqLnN0b3JlKCk7CgkJCQkJfQoJCQkJfV0pCgkJCX07CgkJfQoJfQoJLyoqIENvbXBvbmVudHM6OkVuZCAqKi8KfTs=",
	"Name": "DynaForm",
	"Script": "d2luZG93LkR5bmFGb3JtID0gY2xhc3MgewoJY29uc3RydWN0b3IoKSB7CgkJdGhpcy50aXRsZSA9ICJGb3JtIFRpdGxlIjsKCQl0aGlzLm5hbWUgPSAiZnJtRm9ybSI7CgkJdGhpcy5lbGVtZW50cyA9IFtdOwoJCXRoaXMuc2VsZWN0cyA9IFtdOwoJCXRoaXMuZ3JpZHMgPSBbXTsKCQl0aGlzLmJ1dHRvbnMgPSBbXTsKCQl0aGlzLnpvbmVzID0gWydub3J0aCcsICdzb3V0aCcsICdlYXN0JywgJ3dlc3QnLCAnY2VudGVyJ107CgkJdGhpcy5zVGFibGUgPSBudWxsOwoJCXRoaXMuYkRlYnVnID0gZmFsc2U7CgkJdGhpcy51aVR5cGVzID0gewoJCQlpbnQ6ICJudW1iZXJzcGlubmVyIiwKCQkJbWVudTogInNwbGl0YnV0dG9uIiwKCQkJZGF0ZXRpbWU6ICJkYXRldGltZWJveCIsCgkJCWJvb2w6ICJzd2l0Y2hidXR0b24iLAoJCQlmaWxlOiAiZmlsZWJveCIsCgkJCXRleHQ6ICJ0ZXh0Ym94IiwKCQkJbGFiZWw6ICJodG1sIiwKCQkJcGFzc3dvcmQ6ICJwYXNzd29yZGJveCIsCgkJCXN0cmluZzogInRleHRib3giLAoJCQlpbWFnZTogImRpYWxvZyIsCgkJCXByb2dyZXNzOiAicHJvZ3Jlc3NiYXIiLAoJCQlsaW5rOiAibGlua2J1dHRvbiIsCgkJCXRyZWU6ICJjb21ib3RyZWUiLAoJCQluYXZpZ2F0aW9uOiAidHJlZSIsCgkJCXNlYXJjaDogJ3NlYXJjaGJveCcsCgkJfTsKCQl0aGlzLmV2ZW50cyA9IFt7CgkJCW5hbWU6ICdvbkNsaWNrJywKCQkJaGFuZGxlcjogJ29uVG9nZ2xlJywKCQkJcGFyYW1zOiAnbj1ldmVudCcsCgkJCXR5cGU6ICd0b2dnbGUnLAoJCX0sIHsKCQkJbmFtZTogJ29uQ2xvc2UnLAoJCQloYW5kbGVyOiAnUGFuT25DbG9zZScsCgkJCXBhcmFtczogJ249ZXZlbnQnLAoJCQl0eXBlOiAnd2luZG93JywKCQl9LCB7CgkJCW5hbWU6ICdvblNlbGVjdCcsCgkJCWhhbmRsZXI6ICdTZWxlY3RDaGFuZ2UnLAoJCQlwYXJhbXM6ICduJywKCQkJdHlwZTogJ3RhYnMnLAoJCX0sIHsKCQkJbmFtZTogJ3NlYXJjaGVyJywKCQkJaGFuZGxlcjogJ0ZpZWxkQ2hhbmdlJywKCQkJcGFyYW1zOiAnbiwgbycsCgkJCXR5cGU6ICdzZWFyY2hib3gnLAoJCX0sIHsKCQkJbmFtZTogJ29uQmVmb3JlRXhwYW5kJywKCQkJaGFuZGxlcjogJ0V4cGFuZCcsCgkJCXBhcmFtczogJ24nLAoJCQl0eXBlOiAndHJlZScsCgkJfSwgewoJCQluYW1lOiAnb25DaGFuZ2UnLAoJCQloYW5kbGVyOiAnRmllbGRDaGFuZ2UnLAoJCQlwYXJhbXM6ICduLCBvJywKCQl9LCB7CgkJCW5hbWU6ICdvbkJlZm9yZU9wZW4nLAoJCQloYW5kbGVyOiAnUGFuZWxPcGVuJywKCQkJcGFyYW1zOiAnJywKCQkJdHlwZTogJ3dpbmRvdycsCgkJfSwgewoJCQluYW1lOiAnb25PcGVuJywKCQkJaGFuZGxlcjogJ1BlbmRBZnRlck9wZW4nLAoJCQlwYXJhbXM6ICcnLAoJCQl0eXBlOiAnd2luZG93JywKCQl9LCB7CgkJCW5hbWU6ICdvbkNsaWNrJywKCQkJaGFuZGxlcjogJ2RvTGluaycsCgkJCXBhcmFtczogJ249ZXZlbnQsIG8nLAoJCQl0eXBlOiAnbGluaycsCgkJfSwgewoJCQluYW1lOiAnb25DbGlja1JvdycsCgkJCWhhbmRsZXI6ICdGaWVsZENoYW5nZScsCgkJCXBhcmFtczogJ24sIG8nLAoJCQl0eXBlOiAnZ3JpZCcsCgkJfV07CgoJCWlmICh0eXBlb2YoJCkgIT09ICd1bmRlZmluZWQnKSAkKHdpbmRvdykucmVzaXplKHRoaXMud2luZG93UmVzaXplZCk7CgkJdGhpcy53aW5kb3dSZXNpemVkKCk7Cgl9CgoJc3IoKSB7CgkJcmV0dXJuIHR5cGVvZihfRnJFTUQpICE9PSAndW5kZWZpbmVkJyA/IF9GckVNRC5zcigpIDogd2luZG93LnNyOwoJfQoKCXBhcnNlKCkgewoJCSQucGFyc2VyLnBhcnNlKCk7Cgl9CgoJd2luZG93UmVzaXplZCgpIHsKCQl0aGlzLndpZHRoID0gd2luZG93LmlubmVyV2lkdGg7CgkJdGhpcy5oZWlnaHQgPSB3aW5kb3cuaW5uZXJIZWlnaHQgKiAwLjg7Cgl9CgoJaW5pdCgpIHsKCQl2YXIgc2VsZWN0ID0gewoJCQlpbml0OiBmdW5jdGlvbihjb250YWluZXIsIG9wdGlvbnMpIHsKCQkJCXZhciBvcCA9IG51bGw7CgkJCQl2YXIgZm9wID0gbnVsbDsKCQkJCWZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5ncmlkcy5sZW5ndGg7IGkrKykKCQkJCQlpZiAodHJ1ZSB8fCB0aGlzLmdyaWRzW2ldLmlkID09IG9wdGlvbnMuc291cmNlKSBvcCA9IHRoaXMuZ3JpZHNbaV0ub3B0aW9uczsKCQkJCWZvciAoaSA9IDA7IGkgPCBvcC5jb2x1bW5zLmxlbmd0aDsgaSsrKQoJCQkJCWlmIChvcC5jb2x1bW5zW2ldLm5hbWUgPT0gb3B0aW9ucy5maWVsZCkgZm9wID0gb3AuY29sdW1uc1tpXTsKCQkJCWZvcC53aWR0aCA9ICh0aGlzLndpZHRoIC8gMyk7CgkJCQl2YXIgZSA9ICQodGhpcy5zZWxlY3QoZm9wKSk7CgkJCQl2YXIgaW5wdXQgPSBlLmFwcGVuZFRvKGNvbnRhaW5lcik7CgkJCQlpbnB1dC5jb21ib2dyaWQoKTsKCQkJCXRoaXMuYmluZChpbnB1dCk7CgkJCQlyZXR1cm4gaW5wdXQ7CgkJCX0sCgkJCWRlc3Ryb3k6IGZ1bmN0aW9uKHRhcmdldCkgewoJCQkJJCh0YXJnZXQpLnJlbW92ZSgpOwoJCQl9LAoJCQlnZXRWYWx1ZTogZnVuY3Rpb24odGFyZ2V0KSB7CgkJCQlyZXR1cm4gJCh0YXJnZXQpLnZhbCgpOwoJCQl9LAoJCQlzZXRWYWx1ZTogZnVuY3Rpb24odGFyZ2V0LCB2YWx1ZSkgewoJCQkJJCh0YXJnZXQpLnZhbCh2YWx1ZSk7CgkJCX0sCgkJCXJlc2l6ZTogZnVuY3Rpb24odGFyZ2V0LCB3aWR0aCkgewoJCQkJJCh0YXJnZXQpLl9vdXRlcldpZHRoKHdpZHRoKTsKCQkJfQoJCX07CgkJJC5leHRlbmQoJC5mbi5kYXRhZ3JpZC5kZWZhdWx0cy5lZGl0b3JzLCB7CgkJCWRhdGV0aW1lOiB7CgkJCQlpbml0OiBmdW5jdGlvbihjb250YWluZXIsIG9wdGlvbnMpIHsKCQkJCQlvcHRpb25zLndpZHRoID0gdGhpcy5jV2lkdGgob3B0aW9ucyk7CgkJCQkJdmFyIGlucHV0ID0gJCh0aGlzLmRhdGV0aW1lKG9wdGlvbnMpKS5hcHBlbmRUbyhjb250YWluZXIpOwoJCQkJCWlucHV0LmRhdGV0aW1lYm94KCk7CgkJCQkJcmV0dXJuIGlucHV0OwoJCQkJfSwKCQkJCWRlc3Ryb3k6IGZ1bmN0aW9uKHRhcmdldCkgewoJCQkJCSQodGFyZ2V0KS5yZW1vdmUoKTsKCQkJCX0sCgkJCQlnZXRWYWx1ZTogZnVuY3Rpb24odGFyZ2V0KSB7CgkJCQkJcmV0dXJuICQodGFyZ2V0KS52YWwoKTsKCQkJCX0sCgkJCQlzZXRWYWx1ZTogZnVuY3Rpb24odGFyZ2V0LCB2YWx1ZSkgewoJCQkJCSQodGFyZ2V0KS52YWwodmFsdWUpOwoJCQkJfSwKCQkJCXJlc2l6ZTogZnVuY3Rpb24odGFyZ2V0LCB3aWR0aCkgewoJCQkJCSQodGFyZ2V0KS5fb3V0ZXJXaWR0aCh3aWR0aCk7CgkJCQl9CgkJCX0sCgkJCWNoZWNrYm94OiB7CgkJCQlpbml0OiBmdW5jdGlvbihjb250YWluZXIsIG9wdGlvbnMpIHsKCQkJCQl2YXIgaW5wdXQgPSAkKHRoaXMuYm9vbChvcHRpb25zKSkuYXBwZW5kVG8oY29udGFpbmVyKTsKCQkJCQlpbnB1dC5zd2l0Y2hidXR0b24oKTsKCQkJCQlyZXR1cm4gaW5wdXQ7CgkJCQl9LAoJCQkJZGVzdHJveTogZnVuY3Rpb24odGFyZ2V0KSB7CgkJCQkJJCh0YXJnZXQpLnJlbW92ZSgpOwoJCQkJfSwKCQkJCWdldFZhbHVlOiBmdW5jdGlvbih0YXJnZXQpIHsKCQkJCQlyZXR1cm4gJCh0YXJnZXQpLnZhbCgpOwoJCQkJfSwKCQkJCXNldFZhbHVlOiBmdW5jdGlvbih0YXJnZXQsIHZhbHVlKSB7CgkJCQkJJCh0YXJnZXQpLnZhbCh2YWx1ZSk7CgkJCQl9LAoJCQkJcmVzaXplOiBmdW5jdGlvbih0YXJnZXQsIHdpZHRoKSB7CgkJCQkJJCh0YXJnZXQpLl9vdXRlcldpZHRoKHdpZHRoKTsKCQkJCX0KCQkJfSwKCQkJY29tYm90cmVlZ3JpZDogc2VsZWN0LAoJCQlzZWxlY3Q6IHNlbGVjdCwKCQl9KTsKCX0KCglhc2socXVlc3Rpb24sIGZBbnN3ZXIgPSB2ID0+IHYsIG9wdGlvbnMpIHsKCQkkLm1lc3NhZ2VyLmNvbmZpcm0odGhpcy50aXRsZSwgcXVlc3Rpb24sIGZ1bmN0aW9uKHIpIHsKCQkJaWYgKG9wdGlvbnMpIHsKCQkJCWZvciAodmFyIGkgPSAwOyBpIDwgb3B0aW9ucy5sZW5ndGg7IGkrKykgewoJCQkJCWlmIChvcHRpb25zW2ldLmFuc3dlciA9PSByKSB7CgkJCQkJCXJldHVybiBmQW5zd2VyKG9wdGlvbnNbaV0udmFsdWUpOwoJCQkJCX0KCQkJCX0KCQkJfSBlbHNlIHsKCQkJCXJldHVybiBmQW5zd2VyKHIpOwoJCQl9CgkJfSk7Cgl9CgoJdG9wRGF0YShhciwgZ0ZpZWxkLCB2RmllbGQsIHRvcCkgewoJCWlmICghdG9wKSB7CgkJCXJldHVybiBhcjsKCQl9CgkJcmV0ID0gW107CgkJJC5lYWNoKHRoaXMuc3IoKS5ncm91cEJ5KGFyLCBnRmllbGQpLCBmdW5jdGlvbihrZXksIHZhbHVlcykgewoJCQl2YWx1ZXMudmFsdWVzLnNvcnQoKGEsIGIpID0+IHsKCQkJCWlmIChwYXJzZUZsb2F0KGFbdkZpZWxkXSkgPCBwYXJzZUZsb2F0KGJbdkZpZWxkXSkpIHsKCQkJCQlyZXR1cm4gMTsKCQkJCX0gZWxzZSBpZiAocGFyc2VGbG9hdChhW3ZGaWVsZF0pID4gcGFyc2VGbG9hdChiW3ZGaWVsZF0pKSB7CgkJCQkJcmV0dXJuIC0xOwoJCQkJfSBlbHNlIHsKCQkJCQlyZXR1cm4gMDsKCQkJCX0KCQkJfSk7CgkJCSQuZWFjaCh2YWx1ZXMudmFsdWVzLCBmdW5jdGlvbihpLCB2KSB7CgkJCQlpZiAoaSA8IHRvcCkgewoJCQkJCXJldC5wdXNoKHYpOwoJCQkJfQoJCQl9KTsKCQl9KTsKCQlyZXR1cm4gcmV0OwoJfQoKCWFzeW5jIGRvQ2xpY2soYnV0dG9uKSB7CgkJbGV0IF90aGlzID0gdHlwZW9mKHRoaXMuZG9DbGljaykgPT09ICdmdW5jdGlvbicgPyB0aGlzIDogd2luZG93LkRGb3JtOwoJCWJ1dHRvbiA9IF90aGlzLmJ1dHRvbnMuZmluZChiID0+IGIubmFtZSA9PSBidXR0b24ubmFtZSAmJiBiLmdyb3VwID09IGJ1dHRvbi5ncm91cCk7CgkJX3RoaXMuYnVzeSh0cnVlKTsKCQlfdGhpcy5zZXQoewoJCQlXb3JrUHJvZ3Jlc3NWYWx1ZTogMjAKCQl9KQoKCQl2YXIgbyA9IF90aGlzLmdldCgpOwoJCXZhciBzTWlzc2luZyA9IF90aGlzLmVsZW1lbnRzLmZpbHRlcihlID0+IChidXR0b24ud2luZG93ID8gYnV0dG9uLmdyb3VwID09IGUuZ3JvdXAgOiB0cnVlKSkuZmlsdGVyKGUgPT4gZS5yZXF1aXJlZCAmJiAhb1tlLm5hbWVdKS5tYXAoZSA9PiAiPGxpPiIgKyAoZS5sYWJlbCB8fCBlLm5hbWUpICsgIjwvbGk+Iikuam9pbigiIik7CgkJaWYgKHNNaXNzaW5nKSB7CgkJCXdpbmRvdy5fRnJFTUQuX2Vycm9yKCJNaXNzaW5nIG1hbmRhdG9yeSBmaWVsZHM6PGJyLz48dWw+IiArIHNNaXNzaW5nICsgIjwvdWw+IiwgNTAwMCk7CgkJCV90aGlzLmJ1c3koZmFsc2UpOwoJCQlyZXR1cm47CgkJfQoJCWlmIChidXR0b24ub25jbGljaykgYXdhaXQgYnV0dG9uLm9uY2xpY2sobyk7CgkJaWYgKGJ1dHRvbi5vbkNsaWNrKSBhd2FpdCBidXR0b24ub25DbGljayhvKTsKCQlfdGhpcy5idXN5KGZhbHNlKTsKCX0KCglidXN5KGJCdXN5KSB7CgkJaWYgKCFiQnVzeSkgewoJCQl2YXIgdG90YWwgPSAwOwoJCQlpZiAodHlwZW9mIG1vbWVudCAhPT0gJ3VuZGVmaW5lZCcpIHsKCQkJCXRvdGFsID0gbW9tZW50KCkuZGlmZihtb21lbnQodGhpcy5idXN5U3RhbXApLCAnc2Vjb25kcycpOwoJCQl9IGVsc2UgewoJCQkJLy8gbm8gbW9tZW50LCB1c2Ugc3RhbmRhcmQgRGF0ZQoJCQkJdG90YWwgPSAobmV3IERhdGUoKS5nZXRUaW1lKCkgLSB0aGlzLmJ1c3lTdGFtcCA/IHRoaXMuYnVzeVN0YW1wLmdldFRpbWUoKSA6IDApIC8gMTAwMCAvIDM2MDA7CgkJCX0KCQkJaWYgKHRoaXMuYkRlYnVnKSB7CgkJCQl3aW5kb3cuX0ZyRU1ELl9hbGVydCgiRXhlY3V0aW9uIFRpbWU6ICIgKyB0b3RhbCArICIgc2Vjb25kcy4iKTsKCQkJfQoJCQlkZWxldGUgdGhpcy5idXN5U3RhbXA7CgoJCQlzZXRJbnRlcnZhbCgxLCAoKSA9PiB0aGlzLlNldCh7CgkJCQlMb2FkaW5nOiAxMAoJCQl9KSk7CgkJfSBlbHNlIHsKCQkJdGhpcy5idXN5U3RhbXAgPSBuZXcgRGF0ZSgpOwoJCX0KCgkJJC5lYWNoKCQubWVyZ2UoJC5tYXAodGhpcy5idXR0b25zLCBiID0+IGIubmFtZSksICQubWFwKHRoaXMuZWxlbWVudHMuZmlsdGVyKGUgPT4gZS50eXBlID09ICdsaW5rJyksIGUgPT4gZS5uYW1lKSksIChfLCBlKSA9PiAkKCcjJyArIGUpLmxpbmtidXR0b24oYkJ1c3kgPyAnZGlzYWJsZScgOiAnZW5hYmxlJykpOwoJfQoKCXByZWZpeChlKSB7CgkJc3dpdGNoIChlLnR5cGUpIHsKCQkJY2FzZSAnbGFiZWwnOgoJCQkJcmV0dXJuICdsYmwnOwoJCQljYXNlICd0ZXh0JzoKCQkJY2FzZSAnc3RyaW5nJzoKCQkJY2FzZSAnc2VhcmNoJzoKCQkJY2FzZSAncGFzc3dvcmQnOgoJCQkJcmV0dXJuICd0eHQnOwoJCQljYXNlICJEYXRlVGltZSI6CgkJCWNhc2UgImRhdGV0aW1lIjoKCQkJCXJldHVybiAnZHRwJzsKCQkJY2FzZSAiaW50IjoKCQkJY2FzZSAiaW50ZWdlciI6CgkJCWNhc2UgIm51bWJlciI6CgkJCWNhc2UgImxvbmciOgoJCQljYXNlICJMb25nIjoKCQkJCXJldHVybiAnbnVkJzsKCQkJY2FzZSAnZmlsZSc6CgkJCQlyZXR1cm4gJ2ZpbCc7CgkJCWNhc2UgJ2ltYWdlJzoKCQkJCXJldHVybiAnaW1nJzsKCQkJY2FzZSAiYm9vbCI6CgkJCQlyZXR1cm4gJ2Noayc7CgkJCWNhc2UgIndpbmRvdyI6CgkJCQlyZXR1cm4gJ3BubCc7CgkJCWNhc2UgInByb2dyZXNzIjoKCQkJCXJldHVybiAncHJnJzsKCQkJY2FzZSAiZ3JpZCI6CgkJCWNhc2UgInRyZWUiOgoJCQljYXNlICJzZWxlY3QiOgoJCQkJcmV0dXJuICdjbWInOwoJCQlkZWZhdWx0OgoJCQkJcmV0dXJuICcnOwoJCX0KCX0KCgljbGVhcihncm91cCkgewoJCXZhciBvID0ge307CgkJJC5lYWNoKHRoaXMuZWxlbWVudHMuZmlsdGVyKGUgPT4gZ3JvdXAgPyBlLmdyb3VwID09IGdyb3VwIDogdHJ1ZSksIChfLCBlKSA9PiB7CgkJCXZhciBuYW1lID0gKGUuZW1zU291cmNlID8gIl8iIDogIiIpICsgZS5uYW1lOwoJCQlzd2l0Y2ggKGUudHlwZSkgewoJCQkJY2FzZSAndGV4dCc6CgkJCQljYXNlICdzdHJpbmcnOgoJCQkJY2FzZSAnc2VhcmNoJzoKCQkJCWNhc2UgJ3Bhc3N3b3JkJzoKCQkJCWNhc2UgIkRhdGVUaW1lIjoKCQkJCWNhc2UgImRhdGV0aW1lIjoKCQkJCQlvW25hbWVdID0gIiI7CgkJCQkJYnJlYWs7CgkJCQljYXNlICJpbnQiOgoJCQkJY2FzZSAibnVtYmVyIjoKCQkJCWNhc2UgImludGVnZXIiOgoJCQkJY2FzZSAibG9uZyI6CgkJCQljYXNlICJMb25nIjoKCQkJCWNhc2UgInByb2dyZXNzIjoKCQkJCQlvW25hbWVdID0gMDsKCQkJCQlicmVhazsKCQkJCWNhc2UgInRyZWUiOgoJCQkJY2FzZSAic2VsZWN0IjoKCQkJCQlvW25hbWVdID0gbnVsbDsKCQkJCQlicmVhazsKCQkJCWNhc2UgImdyaWQiOgoJCQkJCW9bbmFtZV0gPyBvW25hbWVdLmRhdGEgPSBbXSA6IG51bGw7CgkJCQkJYnJlYWs7CgkJCQljYXNlICJib29sIjoKCQkJCQlvW25hbWVdID0gZmFsc2U7CgkJCQkJYnJlYWs7CgkJCQlkZWZhdWx0OgoJCQkJCWJyZWFrOwoJCQl9CgkJfSk7CgkJLy9jb25zb2xlLmxvZygiY2xlYXIiLCBvKTsKCQl0aGlzLnNldChvKTsKCQl0aGlzLmJ1c3koZmFsc2UpOwoJfQoKCXNldChvLCBlTmFtZSkgewoJCWlmIChlTmFtZSkgewoJCQl2YXIgb0VsZW1lbnQgPSB0aGlzLmJ5TmFtZShlTmFtZSk7CgkJCWlmICghb0VsZW1lbnQpIHJldHVybjsKCQkJdmFyIGF0dCA9IG51bGw7CgkJCWlmIChvICYmIG8uSWQgJiYgby5FbnRpdHlBdHRyaWJ1dGUpIHsKCQkJCS8vIGFuIEVudGl0eVZhbHVlCgkJCQlmb3IgKHZhciBwIGluIG8pCgkJCQkJaWYgKHAuZW5kc1dpdGgoIlZhbHVlIikpIGF0dCA9IHA7CgkJCQlvRWxlbWVudC5lbXNTb3VyY2UgPSBvOwoJCQl9CgkJCXRyeSB7CgkJCQlsZXQgZU5hbWUgPSAiIyIgKyB0aGlzLnByZWZpeChvRWxlbWVudCkgKyBvRWxlbWVudC5uYW1lOwoJCQkJbGV0IGVUeXBlID0gdGhpcy51aVR5cGVzW29FbGVtZW50LnR5cGVdOwoJCQkJLy8gY29uc29sZS5sb2coIkR5bmFGb3JtOjpzZXQoIiArIG9FbGVtZW50Lm5hbWUgKyAiKTogIiwgZU5hbWUsIGVUeXBlLCBvKTsKCQkJCXN3aXRjaCAob0VsZW1lbnQudHlwZSkgewoJCQkJCWNhc2UgJ2xhYmVsJzoKCQkJCQkJaWYgKGF0dCkgewoJCQkJCQkJJChlTmFtZSkuaHRtbChvW2F0dF0pOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJJChlTmFtZSkuaHRtbCgobyAmJiBvLkVudGl0eUF0dHJpYnV0ZSkgPyAiIiA6IG8pOwoJCQkJCQl9CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgJ3RleHQnOgoJCQkJCWNhc2UgJ3N0cmluZyc6CgkJCQkJY2FzZSAncGFzc3dvcmQnOgoJCQkJCWNhc2UgImludCI6CgkJCQkJY2FzZSAic2VhcmNoIjoKCQkJCQljYXNlICJpbnRlZ2VyIjoKCQkJCQljYXNlICJudW1iZXIiOgoJCQkJCWNhc2UgImxvbmciOgoJCQkJCWNhc2UgIkxvbmciOgoJCQkJCQlpZiAoYXR0KSB7CgkJCQkJCQkkKGVOYW1lKVtlVHlwZV0oInNldFZhbHVlIiwgb1thdHRdKTsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCSQoZU5hbWUpW2VUeXBlXSgic2V0VmFsdWUiLCAobyAmJiBvLkVudGl0eUF0dHJpYnV0ZSkgPyAiIiA6IG8pOwoJCQkJCQl9CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgIkRhdGVUaW1lIjoKCQkJCQljYXNlICJkYXRldGltZSI6CgkJCQkJCWlmIChhdHQpIHsKCQkJCQkJCSQoZU5hbWUpW2VUeXBlXSgnc2V0VmFsdWUnLCAob1thdHRdID8gdGhpcy5zcigpLnRvRGF0ZVRpbWUob1thdHRdKSA6ICIiKSk7CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQkkKGVOYW1lKVtlVHlwZV0oJ3NldFZhbHVlJywgKG8gJiYgby5FbnRpdHlBdHRyaWJ1dGUpID8gIiIgOiAobyA/IHRoaXMuc3IoKS50b0RhdGVUaW1lKG8pIDogIiIpKTsKCQkJCQkJfQoJCQkJCQlicmVhazsKCQkJCQljYXNlICJib29sIjoKCQkJCQkJaWYgKGF0dCkgewoJCQkJCQkJJChlTmFtZSlbZVR5cGVdKChvW2F0dF0gPyAnJyA6ICd1bicpICsgJ2NoZWNrJyk7CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQkkKGVOYW1lKVtlVHlwZV0oKCgobyAmJiBvLkVudGl0eUF0dHJpYnV0ZSkgPyAiIiA6IG8pID8gJycgOiAndW4nKSArICdjaGVjaycpOwoJCQkJCQl9CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgIndpbmRvdyI6CgkJCQkJCWlmIChhdHQpIHsKCQkJCQkJCW9FbGVtZW50LnZhbHVlID0gb1thdHRdOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJb0VsZW1lbnQudmFsdWUgPSAobyAmJiBvLkVudGl0eUF0dHJpYnV0ZSkgPyAiIiA6IG87CgkJCQkJCX0KCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAicHJvZ3Jlc3MiOgoJCQkJCQl2YXIgdiA9IDA7CgkJCQkJCWlmIChhdHQpIHsKCQkJCQkJCXYgPSBvW2F0dF07CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQl2ID0gKG8gJiYgby5FbnRpdHlBdHRyaWJ1dGUpID8gIiIgOiBvOwoJCQkJCQl9CgkJCQkJCS8vY29uc29sZS5sb2coIiMiICsgdGhpcy5wcmVmaXgob0VsZW1lbnQpICsgb0VsZW1lbnQubmFtZSwgdGhpcy51aVR5cGVzW29FbGVtZW50LnR5cGVdLCBNYXRoLnJvdW5kKHYgKiAxMCkgLyAxMCk7CgkJCQkJCSQoZU5hbWUpW2VUeXBlXSgnc2V0VmFsdWUnLCBNYXRoLnJvdW5kKHYgKiAxMCkgLyAxMCk7CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgImdyaWQiOgoJCQkJCQlsZXQgY29scyA9IEpTT04ucGFyc2UoInsiICsgdGhpcy5tYXBDb2x1bW5zKG9FbGVtZW50LCB0cnVlKSArICJ9Iik7CgkJCQkJCSQuZWFjaChjb2xzLmNvbHVtbnNbMF0sIChfLCBjKSA9PiBjLmZvcm1hdHRlciA9IHRoaXMuc3IoKS5ydW5TY3JpcHQodGhpcy5mb3JtYXR0ZXIob0VsZW1lbnQubmFtZSwgYykpKTsKCQkJCQkJJChlTmFtZSkuZGF0YWdyaWQoY29scyk7CgkJCQkJCWlmIChhdHQpIHsKCQkJCQkJCSQoZU5hbWUpLmRhdGFncmlkKHsKCQkJCQkJCQlkYXRhOiBvW2F0dF0KCQkJCQkJCX0pOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJJChlTmFtZSkuZGF0YWdyaWQoewoJCQkJCQkJCWRhdGE6IChvICYmIG8uRW50aXR5QXR0cmlidXRlKSA/ICIiIDogbwoJCQkJCQkJfSk7CgkJCQkJCX0KCQkJCQkJJChlTmFtZSkuZGF0YWdyaWQoInVuc2VsZWN0QWxsIik7CgkJCQkJCSQoZU5hbWUpLmRhdGFncmlkKCk7CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgInRyZWUiOgoJCQkJCQl2YXIgdiA9IGF0dCA/IG9bYXR0XSA6ICgobyAmJiBvLkVudGl0eUF0dHJpYnV0ZSkgPyAiIiA6IG8pOwoJCQkJCQlpZiAoQXJyYXkuaXNBcnJheSh2KSkgewoJCQkJCQkJJChlTmFtZSlbZVR5cGVdKCJ0cmVlIikudHJlZSgibG9hZERhdGEiLCB2KTsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCSQoZU5hbWUpW2VUeXBlXSgnc2V0VmFsdWUnLCB2KTsKCQkJCQkJfQoJCQkJCQlicmVhazsKCQkJCQljYXNlICJzZWxlY3QiOgoJCQkJCQlpZiAoYXR0KSB7CgkJCQkJCQlpZiAob0VsZW1lbnQub3B0aW9ucykgewoJCQkJCQkJCSQoZU5hbWUpLmNvbWJvKCdzZXRWYWx1ZScgKyAob0VsZW1lbnQubXVsdGlwbGUgPyAncycgOiAnJyksIChvW2F0dF0gPyBvW2F0dF0gOiAiIikpOwoJCQkJCQkJCSQoZU5hbWUpLmNvbWJvKCdzZXRWYWx1ZScgKyAob0VsZW1lbnQubXVsdGlwbGUgPyAncycgOiAnJyksIChvW2F0dF0gPyBvW2F0dF0gOiAiIikpOwoJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQkkKGVOYW1lKS5jb21ib2dyaWQoJ3NldFZhbHVlJyArIChvRWxlbWVudC5tdWx0aXBsZSA/ICdzJyA6ICcnKSwgKG9bYXR0XSA/IG9bYXR0XSA6ICIiKSk7CgkJCQkJCQl9CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQl2ID0gbnVsbDsKCQkJCQkJCWlmIChvID09PSBudWxsKSB7CgoJCQkJCQkJfSBlbHNlIGlmIChvLmNvbnN0cnVjdG9yID09PSBBcnJheSkgewoKCQkJCQkJCX0gZWxzZSBpZiAoIW8uRW50aXR5QXR0cmlidXRlKSB7CgkJCQkJCQkJdiA9IG8gfHwgewoJCQkJCQkJCQlJZDogby5JZCwKCQkJCQkJCQkJX1RvU3RyaW5nOiBvLl9Ub1N0cmluZywKCQkJCQkJCQkJdG9TdHJpbmc6IGZ1bmN0aW9uKCkgewoJCQkJCQkJCQkJcmV0dXJuIHRoaXMuX1RvU3RyaW5nOwoJCQkJCQkJCQl9CgkJCQkJCQkJfTsKCQkJCQkJCX0KCQkJCQkJCWlmIChvRWxlbWVudC5vcHRpb25zKSB7CgkJCQkJCQkJJChlTmFtZSkuY29tYm8oJ3NldFZhbHVlJyArIChvRWxlbWVudC5tdWx0aXBsZSA/ICdzJyA6ICcnKSwgdik7CgkJCQkJCQkJJChlTmFtZSkuY29tYm8oJ3NldFRleHQnICsgKG9FbGVtZW50Lm11bHRpcGxlID8gJ3MnIDogJycpLCB2KTsKCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJJChlTmFtZSkuY29tYm9ncmlkKCdzZXRWYWx1ZScgKyAob0VsZW1lbnQubXVsdGlwbGUgPyAncycgOiAnJyksIHYpOwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJCWJyZWFrOwoJCQkJCWRlZmF1bHQ6CgkJCQkJCWJyZWFrOwoJCQkJfQoJCQl9IGNhdGNoIChleCkgewoJCQkJY29uc29sZS5sb2coZXgpOwoJCQl9CgkJfSBlbHNlIHsKCQkJZm9yICh2YXIgcCBpbiBvKSB7CgkJCQlpZiAocC5pbmRleE9mKCdfJykgPT09IDApIHAgPSBwLnN1YnN0cmluZygxKTsKCQkJCXZhciBlID0gdGhpcy5ieU5hbWUocCk7CgkJCQlpZiAoIWUgfHwgIWUubmFtZSkgY29udGludWU7CgkJCQl2YXIgdmFsdWUgPSBvW3BdOwoJCQkJaWYgKGUubmFtZSA9PSB0aGlzLnNUYWJsZSkgewoJCQkJCXZhbHVlID0gbzsKCQkJCQl2YWx1ZS5EYXRlID0gbmV3IERhdGUoKTsKCQkJCX0KCQkJCWlmIChwID09ICJFbnRpdHlWYWx1ZXMiKSB7CgkJCQkJLy8gYW4gZW1zRm9ybVZhbHVlcyBzb3VyY2UKCQkJCQkvLyBmaW5kIHRoZSBFbnRpdHlWYWx1ZSBmb3IgdGhpcyBlbGVtZW50IGFuZCBzZXQgaXQKCQkJCQlmb3IgKHZhciBqID0gMDsgaiA8IG8uRW50aXR5VmFsdWVzLmxlbmd0aDsgaisrKSB7CgkJCQkJCWlmIChvLkVudGl0eVZhbHVlc1tqXS5FbnRpdHlBdHRyaWJ1dGUuTmFtZSA9PSBlLm5hbWUpIHsKCQkJCQkJCS8vIGZvdW5kIHRoZSBFbnRpdHlWYWx1ZSBmb3IgdGhpcyBlbGVtZW50CgkJCQkJCQlfdiA9IG8uRW50aXR5VmFsdWVzW2pdOwoJCQkJCQkJZm9yICh2YXIgcSBpbiBfdikgewoJCQkJCQkJCWlmIChxLmVuZHNXaXRoKCJWYWx1ZSIpKSB7CgkJCQkJCQkJCV92W3FdID0gdmFsdWU7CgkJCQkJCQkJfQoJCQkJCQkJfQoJCQkJCQkJYnJlYWs7CgkJCQkJCX0KCQkJCQl9CgkJCQl9CgkJCQl0aGlzLnNldCh2YWx1ZSwgZS5uYW1lKTsKCQkJfQoJCX0KCX0KCglnZXQoKSB7CgkJdmFyIG8gPSB7fTsKCQlpZiAodGhpcy5zVGFibGUgJiYgd2luZG93W3RoaXMuc1RhYmxlXSkgbyA9IG5ldyB3aW5kb3dbdGhpcy5zVGFibGVdKCk7CgkJZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7CgkJCXZhciBjbiA9IG51bGw7CgkJCXZhciB2ID0gbnVsbDsKCQkJdHJ5IHsKCQkJCWxldCBlTmFtZSA9ICIjIiArIHRoaXMucHJlZml4KHRoaXMuZWxlbWVudHNbaV0pICsgdGhpcy5lbGVtZW50c1tpXS5uYW1lOwoJCQkJc3dpdGNoICh0aGlzLmVsZW1lbnRzW2ldLnR5cGUpIHsKCQkJCQljYXNlICdsYWJlbCc6CgkJCQkJCWNuID0gJChlTmFtZSk7CgkJCQkJCXYgPSBjbi5odG1sKCk7CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgJ3RleHQnOgoJCQkJCWNhc2UgJ3N0cmluZyc6CgkJCQkJY2FzZSAnc2VhcmNoJzoKCQkJCQljYXNlICdwYXNzd29yZCc6CgkJCQkJCWNuID0gJChlTmFtZSk7CgkJCQkJCXYgPSBjbi52YWwoKTsKCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAiZmlsZSI6CgkJCQkJY2FzZSAiaW1hZ2UiOgoJCQkJCQljbiA9ICQoZU5hbWUpOwoJCQkJCQl2ID0gdGhpcy5lbGVtZW50c1tpXS5kYXRhOwoJCQkJCQlicmVhazsKCQkJCQljYXNlICJEYXRlVGltZSI6CgkJCQkJY2FzZSAiZGF0ZXRpbWUiOgoJCQkJCQl2ID0gbmV3IERhdGUoJChlTmFtZSkuZGF0ZXRpbWVib3goJ2dldFZhbHVlJykpOwoJCQkJCQljbiA9ICQoZU5hbWUpOwoJCQkJCQlicmVhazsKCQkJCQljYXNlICJwcm9ncmVzcyI6CgkJCQkJCWNuID0gJChlTmFtZSk7CgkJCQkJCXYgPSBjbi5wcm9ncmVzc2JhcignZ2V0VmFsdWUnKTsKCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAiaW50IjoKCQkJCQljYXNlICJpbnRlZ2VyIjoKCQkJCQljYXNlICJudW1iZXIiOgoJCQkJCWNhc2UgImxvbmciOgoJCQkJCWNhc2UgIkxvbmciOgoJCQkJCQljbiA9ICQoZU5hbWUpOwoJCQkJCQl2ID0gcGFyc2VGbG9hdChjbi52YWwoKSk7CgkJCQkJCWlmIChpc05hTih2KSkgdiA9IDA7CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgImdyaWQiOgoJCQkJCQljbiA9ICQoZU5hbWUpOwoJCQkJCQl2ID0gY24uZGF0YWdyaWQoJ2dldERhdGEnKTsKCQkJCQkJdi5zZWxlY3RlZCA9IGNuLmRhdGFncmlkKCJnZXRTZWxlY3RlZCIpOwoJCQkJCQlicmVhazsKCQkJCQljYXNlICJ0cmVlIjoKCQkJCQkJY24gPSAkKGVOYW1lKTsKCQkJCQkJdiA9IGNuLmNvbWJvdHJlZSgidHJlZSIpLnRyZWUoImdldFNlbGVjdGVkIik7CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgIndpbmRvdyI6CgkJCQkJCXYgPSB0aGlzLmVsZW1lbnRzW2ldLnZhbHVlOwoJCQkJCQlicmVhazsKCQkJCQljYXNlICJzZWxlY3QiOgoJCQkJCQlpZiAodGhpcy5lbGVtZW50c1tpXS5vcHRpb25zKSB7CgkJCQkJCQl2ID0gJChlTmFtZSkuY29tYm9ncmlkKCdnZXRWYWx1ZScgKyAodGhpcy5lbGVtZW50c1tpXS5tdWx0aXBsZSA/ICdzJyA6ICcnKSk7CgkJCQkJCQl2ID0gdGhpcy5zcigpLnJ1blNjcmlwdCh2KTsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCXYgPSAkKGVOYW1lKS5jb21ib2dyaWQoJ2dyaWQnKS5kYXRhZ3JpZCgnZ2V0U2VsZWN0aW9ucycpOwoJCQkJCQkJaWYgKCF2IHx8ICF2Lmxlbmd0aCkgewoJCQkJCQkJCXYgPSAkKGVOYW1lKS5jb21ib2dyaWQoJ2dldFZhbHVlJyArICh0aGlzLmVsZW1lbnRzW2ldLm11bHRpcGxlID8gJ3MnIDogJycpKTsKCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJaWYgKCF0aGlzLmVsZW1lbnRzW2ldLm11bHRpcGxlKSB2ID0gdlswXTsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCQljbiA9ICQoZU5hbWUpOwoJCQkJCQlicmVhazsKCQkJCQljYXNlICJib29sIjoKCQkJCQkJY24gPSAkKGVOYW1lKTsKCQkJCQkJdiA9IGNuLnN3aXRjaGJ1dHRvbignb3B0aW9ucycpLmNoZWNrZWQ7CgkJCQkJCWJyZWFrOwoJCQkJCWRlZmF1bHQ6CgkJCQkJCWJyZWFrOwoJCQkJfQoJCQkJb1t0aGlzLmVsZW1lbnRzW2ldLm5hbWVdKHYpOwoJCQl9IGNhdGNoIChlKSB7CgkJCQkvL2NvbnNvbGUubG9nKHRoaXMuZWxlbWVudHNbaV0ubmFtZSwgZSk7CgkJCQlvW3RoaXMuZWxlbWVudHNbaV0ubmFtZV0gPSB2OwoJCQl9CgkJCWlmIChjbikgewoJCQkJaWYgKG8uRW50aXR5VmFsdWVzKSB7CgkJCQkJZm9yICh2YXIgaiA9IDA7IGogPCBvLkVudGl0eVZhbHVlcy5sZW5ndGg7IGorKykgewoJCQkJCQlpZiAodGhpcy5lbGVtZW50c1tpXS5uYW1lID09IHRoaXMuc1RhYmxlICYmIHRoaXMuZWxlbWVudHNbaV0uZW1zU291cmNlKSBvLklkID0gdGhpcy5lbGVtZW50c1tpXS5lbXNTb3VyY2UuSWQ7CgkJCQkJCWlmIChvLkVudGl0eVZhbHVlc1tqXS5FbnRpdHlBdHRyaWJ1dGUuTmFtZSA9PSB0aGlzLmVsZW1lbnRzW2ldLm5hbWUgJiYgdGhpcy5lbGVtZW50c1tpXS5lbXNTb3VyY2UpIHsKCQkJCQkJCW8uRW50aXR5VmFsdWVzW2pdLklkID0gdGhpcy5lbGVtZW50c1tpXS5lbXNTb3VyY2UuSWQ7CgkJCQkJCX0KCQkJCQl9CgkJCQl9CgkJCX0KCQl9CgkJcmV0dXJuIG87Cgl9CgoJY0hlaWdodChvcHRpb25zKSB7CgkJaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5lZGl0b3IpIHJldHVybiB3aW5kb3cuaW5uZXJIZWlnaHQ7CgkJaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5oZWlnaHQgJiYgdHlwZW9mKG9wdGlvbnMuaGVpZ2h0KSA9PT0gJ3N0cmluZycpIHJldHVybiB0aGlzLmhlaWdodDsKCQlpZiAob3B0aW9ucyAmJiBvcHRpb25zLnR5cGUgPT0gJ3dpbmRvdycgJiYgIW9wdGlvbnMuaGVpZ2h0KSByZXR1cm4gdGhpcy5oZWlnaHQgKiAwLjk7CgkJcmV0dXJuIE1hdGguZmxvb3IoKChvcHRpb25zID8gb3B0aW9ucy5oZWlnaHQgOiBudWxsKSB8fCAodGhpcy5oZWlnaHQgLyAzKSkpOwoJfQoKCXNlYXJjaChvcHRpb25zKSB7CgkJcmV0dXJuIHRoaXMuc3RyaW5nKG9wdGlvbnMpOwoJfQoKCXN0cmluZyhvcHRpb25zKSB7CgkJb3B0aW9ucy5oZWlnaHQgPSAyMDsKCQlvcHRpb25zLnNpbXBsZSA9IHRydWU7CgkJcmV0dXJuIHRoaXMudGV4dChvcHRpb25zKTsKCX0KCglkYXRldGltZShvcHRpb25zKSB7CgkJcmV0dXJuIGA8aW5wdXQgaWQ9ImR0cCR7b3B0aW9ucy5uYW1lfSIgY2xhc3M9ImVhc3l1aS0ke3RoaXMudWlUeXBlc1tvcHRpb25zLnR5cGVdfSIgcmVxdWlyZWQ9IiR7b3B0aW9ucy5yZXF1aXJlZCA/ICd0cnVlJyA6ICdmYWxzZSd9IiB2YWx1ZT0iJHt0aGlzLnZhbHVlKG9wdGlvbnMpfSIgc3R5bGU9IndpZHRoOiR7dGhpcy5jV2lkdGgob3B0aW9ucyl9cHgiPmA7Cgl9CgoJcXVlcnkob3B0aW9ucykgewoJCXJldHVybiAiPGRpdiBpZD0ndnMiICsgb3B0aW9ucy5uYW1lICsgIic+PC9kaXY+IjsKCX0KCglEYXRlVGltZShvcHRpb25zKSB7CgkJcmV0dXJuIHRoaXMuZGF0ZXRpbWUob3B0aW9ucyk7Cgl9CgoJbG9uZyhvcHRpb25zKSB7CgkJcmV0dXJuIHRoaXMuaW50KG9wdGlvbnMpOwoJfQoKCUxvbmcob3B0aW9ucykgewoJCXJldHVybiB0aGlzLmxvbmcob3B0aW9ucyk7Cgl9CgoJdmFsdWUob3B0aW9ucykgewoJCWlmICh0eXBlb2Ygb3B0aW9ucy52YWx1ZSA9PT0gJ2Z1bmN0aW9uJykgewoJCQl0cnkgewoJCQkJcmV0dXJuIG9wdGlvbnMudmFsdWUodGhpcy5nZXQoKSk7CgkJCX0gY2F0Y2ggKGV4KSB7CgkJCQljb25zb2xlLmxvZyhgREZvcm0udmFsdWUoJHtvcHRpb25zLm5hbWV9KTogJHtleH1gKTsKCQkJCXJldHVybiAnJzsKCQkJfQoJCX0gZWxzZSB7CgkJCXN3aXRjaCAob3B0aW9ucy50eXBlKSB7CgkJCQljYXNlICdpbnQnOgoJCQkJY2FzZSAncHJvZ3Jlc3MnOgoJCQkJCXJldHVybiBvcHRpb25zLnZhbHVlIHx8IG9wdGlvbnMubWluIHx8IDA7CgkJCQljYXNlICdzdHJpbmcnOgoJCQkJY2FzZSAndGV4dCc6CgkJCQljYXNlICdkYXRldGltZSc6CgkJCQljYXNlICdsYWJlbCc6CgkJCQkJcmV0dXJuIG9wdGlvbnMudmFsdWUgfHwgIiI7CgkJCQlkZWZhdWx0OgoJCQkJCXJldHVybiBvcHRpb25zLnZhbHVlOwoJCQl9CgkJfQoJfQoKCWludChvcHRpb25zKSB7CgkJbGV0IHJldCA9IGA8aW5wdXQgaWQ9Im51ZCR7b3B0aW9ucy5uYW1lfSIgY2xhc3M9ImVhc3l1aS0ke3RoaXMudWlUeXBlc1tvcHRpb25zLnR5cGVdfSIgcmVxdWlyZWQ9IiR7b3B0aW9ucy5yZXF1aXJlZCA/ICd0cnVlJyA6ICdmYWxzZSd9IiB2YWx1ZT0iJHt0aGlzLnZhbHVlKG9wdGlvbnMpfSIgZGF0YS1vcHRpb25zPSJtaW46JHtvcHRpb25zLm1pbiB8fCAwfSxtYXg6JHtvcHRpb25zLm1heCB8fCAxMDB9LGluY3JlbWVudDoke29wdGlvbnMuaW5jcmVtZW50IHx8IDF9IiBzdHlsZT0id2lkdGg6JHt0aGlzLmNXaWR0aChvcHRpb25zKX1weDsiPjwvaW5wdXQ+YDsKCQkvL2NvbnNvbGUubG9nKHJldCk7CgkJcmV0dXJuIHJldDsKCX0KCgltZW51KG9wdGlvbnMpIHsKCQlvcHRpb25zLnR5cGUgPSBvcHRpb25zLnR5cGUgfHwgJ21lbnUnOwoKCQlvcHRpb25zLm1lbnUgPSAob3B0aW9ucy5tZW51IHx8IFtdKS5zb3J0KChhLCBiKSA9PiBhLm9yZGVyIC0gYi5vcmRlcik7CgoJCS8vY29uc29sZS5sb2coIkR5bmFGb3JtOjptZW51KCk6IG9wdGlvbnMiLCBvcHRpb25zKTsKCgkJbGV0IHJldCA9ICIiOwoJCXJldCArPSAnPGRpdiBjbGFzcz0iZWFzeXVpLXBhbmVsIiBpZD0ibW51JyArIG9wdGlvbnMubmFtZSArICciIHN0eWxlPSJwYWRkaW5nOjVweDsiPlxuJzsKCgkJcmV0ICs9IG9wdGlvbnMubWVudS5tYXAobSA9PiBgPGEgaHJlZj0iIyIgY2xhc3M9ImVhc3l1aS0ke3RoaXMudWlUeXBlc1tvcHRpb25zLnR5cGVdfSIgZGF0YS1vcHRpb25zPSJtZW51OicjbW0ke20ubGFiZWwucmVwbGFjZSgvIC9nLCAnJyl9JyxpY29uQ2xzOidpY29uLSR7bS5pY29uIHx8ICdub25lJ30nIj4ke20ubGFiZWx9PC9hPmApLmpvaW4oJ1xuJyk7CgoJCS8qJC5lYWNoKG9wdGlvbnMubWVudSwgKF8sIG0pID0+IHJldCArPSBgPGEgaHJlZj0iIyIgY2xhc3M9ImVhc3l1aS0ke3RoaXMudWlUeXBlc1tvcHRpb25zLnR5cGVdfSIgZGF0YS1vcHRpb25zPSJtZW51OicjbW0ke20ubGFiZWwucmVwbGFjZSgvIC9nLCAnJyl9JyxpY29uQ2xzOidpY29uLSR7bS5pY29uIHx8ICdub25lJ30nIj4ke20ubGFiZWx9PC9hPlxuYCk7Ki8KCQlyZXQgKz0gIjwvZGl2PlxuIjsKCgkJbGV0IGR2ID0gbSA9PiB7CgkJCWxldCByZXQgPSAnPGRpdicgKyAobS5zdWJNZW51cyA/ICcnIDogYCBkYXRhLW9wdGlvbnM9Imljb25DbHM6J2ljb24tJHttLmljb24gfHwgJ25vbmUnfSciYCkgKyAnPlxuJzsKCQkJcmV0ICs9IG0uc3ViTWVudXMgPyAnPHNwYW4+JyArIChtLmxhYmVsIHx8IHRoaXMuZW5nbGlzaChtLmNvZGUpKSArICc8L3NwYW4+XG48ZGl2PicgOiAoYDxzcGFuIHdpZHRoPScxMDAlJyBvbmNsaWNrPScoYXN5bmMgKCkgPT4ge2xldCBtID0gJHtfRnJFTUQuX3RvSlMobSl9OyBpZihtLmFjdGlvbil7cmV0dXJuIGF3YWl0IG0uYWN0aW9uKERGb3JtLmdldCgpLCBtKTt9IGlmIChtLnN1Yk1lbnVzKSByZXR1cm47IGF3YWl0IF9GckVNRC5SZW5kZXJQYWdlKHtfY29kZTogbS5jb2RlIHx8IG0ubGFiZWwucmVwbGFjZSgvIC9nLCAiIikudG9Mb3dlckNhc2UoKX0sIG0uZGF0YSk7fSkoKSc+JHttLmxhYmVsIHx8IHRoaXMuZW5nbGlzaChtLmNvZGUpfTwvc3Bhbj5gKTsKCQkJJC5lYWNoKG0uc3ViTWVudXMsIChfLCBzKSA9PiByZXQgKz0gZHYocykpOwoJCQlyZXQgKz0gKG0uc3ViTWVudXMgPyAiPC9kaXY+XG4iIDogIiIpICsgYDwvZGl2PlxuYDsKCQkJcmV0dXJuIHJldDsKCQl9OwoKCQlyZXQgKz0gb3B0aW9ucy5tZW51Lm1hcChtID0+IGA8ZGl2IGlkPSJtbSR7bS5sYWJlbC5yZXBsYWNlKC8gL2csICcnKX0iIHN0eWxlPSJ3aWR0aDoxNTBweDsiPiR7bS5zdWJNZW51cy5tYXAoc20gPT4gZHYoc20pKS5qb2luKCcnKX08L2Rpdj5gKS5qb2luKCdcbicpOwoKCQlyZXR1cm4gcmV0OwoJfQoKCWludGVnZXIob3B0aW9ucykgewoJCXJldHVybiB0aGlzLmludChvcHRpb25zKTsKCX0KCgludW1iZXIob3B0aW9ucykgewoJCXJldHVybiB0aGlzLmludChvcHRpb25zKTsKCX0KCglJbnRlZ2VyKG9wdGlvbnMpIHsKCQlyZXR1cm4gdGhpcy5pbnQob3B0aW9ucyk7Cgl9CgoJYm9vbChvcHRpb25zKSB7CgkJcmV0dXJuIGA8aW5wdXQgaWQ9IiR7dGhpcy5wcmVmaXgob3B0aW9ucyl9JHtvcHRpb25zLm5hbWV9IiBkYXRhLWRmb3JtPSJlbGVtZW50OiR7b3B0aW9ucy5uYW1lfSIgcmVxdWlyZWQ9IiR7b3B0aW9ucy5yZXF1aXJlZD8ndHJ1ZSc6J2ZhbHNlJ30iIGRhdGEtb3B0aW9ucz0nZGlzYWJsZWQ6JHtvcHRpb25zLmRpc2FibGVkPyd0cnVlJzonZmFsc2UnfSwke3RoaXMuZXZlbnRIYW5kbGVycyhvcHRpb25zKX0nIGNsYXNzPSJlYXN5dWktJHt0aGlzLnVpVHlwZXNbb3B0aW9ucy50eXBlXX0iICR7b3B0aW9ucy5jaGVja2VkPydjaGVja2VkJzonJ30gLz5gOwoJfQoKCWxhYmVsKG9wdGlvbnMpIHsKCQlyZXR1cm4gYDxzcGFuIGlkPSIke3RoaXMucHJlZml4KG9wdGlvbnMpfSR7b3B0aW9ucy5uYW1lfSIgc3R5bGU9IndpZHRoOiR7dGhpcy5jV2lkdGgob3B0aW9ucyl9cHgiIGRhdGEtb3B0aW9ucz0iZGlzYWJsZWQ6JHtvcHRpb25zLmRpc2FibGVkPyd0cnVlJzonZmFsc2UnfSI+JHt0aGlzLnZhbHVlKG9wdGlvbnMpfTwvc3Bhbj5gOwoJfQoKCXVybChvcHRpb25zKSB7CgkJcmV0dXJuIHRoaXMuc3RyaW5nKG9wdGlvbnMpLnJlcGxhY2UoIkZpZWxkQ2hhbmdlIiwgIlVSTENoYW5nZSIpOwoJfQoKCXRleHQob3B0aW9ucykgewoJCXJldHVybiBgPGlucHV0IGlkPSIke3RoaXMucHJlZml4KG9wdGlvbnMpfSR7b3B0aW9ucy5uYW1lfSIgY2xhc3M9ImVhc3l1aS0ke29wdGlvbnMuZWRpdG9yIHx8IHRoaXMudWlUeXBlc1tvcHRpb25zLnR5cGVdfSIgZGF0YS1vcHRpb25zPSdkaXNhYmxlZDoke29wdGlvbnMuZGlzYWJsZWQ/J3RydWUnOidmYWxzZSd9LCR7dGhpcy5ldmVudEhhbmRsZXJzKG9wdGlvbnMpfScgbXVsdGlsaW5lPSIke29wdGlvbnMuc2ltcGxlID8gJ2ZhbHNlJyA6ICd0cnVlJ30iIHN0eWxlPSJ3aGl0ZS1zcGFjZTpwcmUtd3JhcDt3aWR0aDoke3RoaXMuY1dpZHRoKG9wdGlvbnMpfXB4O2hlaWdodDoke3RoaXMuY0hlaWdodChvcHRpb25zKX1weCIgcmVxdWlyZWQ9IiR7b3B0aW9ucy5yZXF1aXJlZCA/ICd0cnVlJyA6ICdmYWxzZSd9IiB2YWx1ZT0iJHt0aGlzLnZhbHVlKG9wdGlvbnMpfSIgLz5gOwoJfQoKCXBhc3N3b3JkKG9wdGlvbnMpIHsKCQl2YXIgcmV0ID0gdGhpcy5zdHJpbmcob3B0aW9ucyk7CgkJcmV0ID0gcmV0LnJlcGxhY2UoJzxpbnB1dCAnLCAnPGlucHV0IHR5cGU9InBhc3N3b3JkIiAnKTsKCQlyZXR1cm4gcmV0OwoJfQoKCWZpbGUob3B0aW9ucykgewoJCXJldHVybiBgPGlucHV0IGlkPSIke3RoaXMucHJlZml4KG9wdGlvbnMpfSR7b3B0aW9ucy5uYW1lfSIgY2xhc3M9ImVhc3l1aS0ke3RoaXMudWlUeXBlc1tvcHRpb25zLnR5cGVdfSIgZGF0YS1vcHRpb25zPSJvbkNoYW5nZTpmdW5jdGlvbihuLG8pe3ZhciBzID0gJCgnIycgKyB0aGlzLmlkKS5maWxlYm94KCdvcHRpb25zJyk7IERGb3JtLlVwbG9hZEZpbGUocywgREZvcm0uYnlOYW1lKCcke29wdGlvbnMubmFtZX0nKSk7fSIgc3R5bGU9IndpZHRoOiR7dGhpcy5jV2lkdGgob3B0aW9ucyl9cHgiPmA7Cgl9CgoJaW1hZ2Uob3B0aW9ucykgewoJCXJldHVybiB0aGlzLmZpbGUob3B0aW9ucykgKyBgPGRpdiBpZD0iZGxnJHtvcHRpb25zLm5hbWV9IiBjbGFzcz0iZWFzeXVpLSR7dGhpcy51aVR5cGVzW29wdGlvbnMudHlwZV19IiB0aXRsZT0iSW1hZ2UgUHJldmlldyIgZGF0YS1vcHRpb25zPSJjbG9zZWQ6dHJ1ZSxpY29uQ2xzOidpY29uLXNhdmUnLHJlc2l6YWJsZTpmYWxzZSxtb2RhbDp0cnVlIiBzdHlsZT0id2lkdGg6NDAwcHg7aGVpZ2h0OjIwMHB4O3BhZGRpbmc6MTBweCI+PGltZyBpZD0iJHt0aGlzLnByZWZpeChvcHRpb25zKX0ke29wdGlvbnMubmFtZX0iIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiLz48L2Rpdj5gOwoJfQoKCXByb2dyZXNzKG9wdGlvbnMpIHsKCQlpZiAoIW9wdGlvbnMuaGVpZ2h0KSBvcHRpb25zLmhlaWdodCA9IDIwOyAvLyBmaXggYmlnIHByb2dyZXNzCgkJcmV0dXJuIGA8ZGl2IGlkPSIke3RoaXMucHJlZml4KG9wdGlvbnMpfSR7b3B0aW9ucy5uYW1lfSIgY2xhc3M9ImVhc3l1aS0ke3RoaXMudWlUeXBlc1tvcHRpb25zLnR5cGVdfSIgZGF0YS1vcHRpb25zPSJ2YWx1ZToke3RoaXMudmFsdWUob3B0aW9ucyl9IiBzdHlsZT0id2lkdGg6JHt0aGlzLmNXaWR0aChvcHRpb25zKX1weDtoZWlnaHQ6JHt0aGlzLmNIZWlnaHQob3B0aW9ucyl9cHgiPjwvZGl2PmA7Cgl9CgoJZmxvd2NoYXJ0KG9wdGlvbnMpIHsKCQlyZXR1cm4gYDxkaXYgaWQ9ImZsdyR7b3B0aW9ucy5uYW1lfSIgd2lkdGg9IiR7dGhpcy5jV2lkdGgob3B0aW9ucyl9IiBoZWlnaHQ9IiR7dGhpcy5jSGVpZ2h0KG9wdGlvbnMpfSI+PC9kaXY+YDsKCX0KCgljaGFydChvcHRpb25zKSB7CgkJcmV0dXJuIGA8ZGl2IGlkPSJjaHQke29wdGlvbnMubmFtZX0iIHdpZHRoPSIke3RoaXMuY1dpZHRoKG9wdGlvbnMpfSIgaGVpZ2h0PSIke3RoaXMuY0hlaWdodChvcHRpb25zKX0iPjwvZGl2PmA7Cgl9CgoJZm9ybWF0dGVyKG5hbWUsIGMsIGpzb24pIHsKCQlqc29uID0ganNvbiA/ICciJyA6ICcnOwoJCXJldHVybiBgJHtqc29ufSh2YWx1ZSwgcm93LCBpbmRleCkgPT4ge3RyeXt2YXIgYyA9IChERm9ybS5ieU5hbWUoXGAke25hbWV9XGApLmNvbHVtbnMgfHwgW10pLmZpbmQoYyA9PiBjLmZpZWxkPT1cYCR7Yy5maWVsZH1cYCk7IHJldHVybiBjJiZjLmZvcm1hdD9jLmZvcm1hdCh2YWx1ZSxyb3csaW5kZXgpOnZhbHVlO31jYXRjaChleCl7cmV0dXJuIHZhbHVlO30gfSR7anNvbn1gOwoJfQoKCW1hcENvbHVtbnMob3B0aW9ucywganNvbikgewoJCWxldCBjVGl0bGUgPSBjID0+IGMudGl0bGUgfHwgdGhpcy5lbmdsaXNoKGMuZmllbGQpOwoKCQl2YXIgY29scyA9ICQuZ3JlcChvcHRpb25zLmNvbHVtbnMgfHwgW10sIGMgPT4gIWMuaWdub3JlKTsKCQlsZXQgcmV0ID0gIiI7CgkJaWYgKG9wdGlvbnMubXVsdGlwbGUpIHJldCArPSBgeyJmaWVsZCI6J2NrJywiY2hlY2tib3giOnRydWV9LGA7CgkJcmV0ID0gYCJmcm96ZW5Db2x1bW5zIjogW1tgOwoJCWlmICghb3B0aW9ucy5mcm96ZW4pIHsKCQkJcmV0ICs9IGB7ImZpZWxkIjoiJHtvcHRpb25zLmlkRmllbGQuZmllbGR9IiwidGl0bGUiOiAiJHtvcHRpb25zLmlkRmllbGQudGl0bGV9Iiwic29ydGFibGUiOiAidHJ1ZSIsICJmb3JtYXR0ZXIiOiAke3RoaXMuZm9ybWF0dGVyKG9wdGlvbnMubmFtZSwgb3B0aW9ucy5pZEZpZWxkLCBqc29uKX19LGA7CgkJCWlmIChvcHRpb25zLnRleHRGaWVsZC5maWVsZCAhPSBvcHRpb25zLmlkRmllbGQuZmllbGQpIHJldCArPSBgeyJmaWVsZCI6IiR7b3B0aW9ucy50ZXh0RmllbGQuZmllbGQgfHwgb3B0aW9ucy50ZXh0RmllbGQudGl0bGV9IiwidGl0bGUiOiIke29wdGlvbnMudGV4dEZpZWxkLnRpdGxlIHx8IG9wdGlvbnMudGV4dEZpZWxkLmZpZWxkfSIsIndpZHRoIjoiJHtvcHRpb25zLnRleHRGaWVsZC53aWR0aHx8MTIwfSIsICJzb3J0YWJsZSI6ICJ0cnVlIiwgImZvcm1hdHRlciI6ICR7dGhpcy5mb3JtYXR0ZXIob3B0aW9ucy5uYW1lLCBvcHRpb25zLnRleHRGaWVsZCwganNvbil9fWA7CgkJfSBlbHNlIHsKCQkJJC5tYXAoJC5ncmVwKGNvbHMsIGMgPT4gYy5mcm96ZW4pLCBjID0+IGB7ImZpZWxkIjoiJHtjLmZpZWxkIHx8IGNUaXRsZShjKX0iLCJ0aXRsZSI6IiR7Y1RpdGxlKGMpIHx8IGMuZmllbGR9Iiwid2lkdGgiOiIke2Mud2lkdGh8fDEyMH0iLCJhbGlnbiI6J2xlZnQnLCJzb3J0YWJsZSI6InRydWUiLCAiZm9ybWF0dGVyIjogJHt0aGlzLmZvcm1hdHRlcihvcHRpb25zLm5hbWUsIGMsIGpzb24pfX1gKS5qb2luKCIsIik7CgkJfQoJCXJldCArPSBgXV0sICJjb2x1bW5zIjogW1tgOwoJCXJldCArPSAkLm1hcCgkLmdyZXAoY29scywgYyA9PiAhYy5mcm96ZW4pLCBjID0+IGB7ImZpZWxkIjoiJHtjLmZpZWxkIHx8IGNUaXRsZShjKX0iLCJ0aXRsZSI6IiR7Y1RpdGxlKGMpIHx8IGMuZmllbGR9IiwiYWxpZ24iOiJsZWZ0Iiwic29ydGFibGUiOiJ0cnVlIiwgImZvcm1hdHRlciI6ICR7dGhpcy5mb3JtYXR0ZXIob3B0aW9ucy5uYW1lLCBjLCBqc29uKX19YCkuam9pbigiLCIpOwoJCXJldCArPSAnXV0nOwoKCQkvL2NvbnNvbGUubG9nKCJEeW5hRm9ybTo6bWFwQ29sdW1ucygiICsgb3B0aW9ucy5uYW1lICsgIik6ICIsIHJldCwganNvbik7CgkJcmV0dXJuIHJldDsKCX0KCglzZWxlY3Qob3B0aW9ucywgdGFnID0gb3B0aW9ucy50YWcsIHR5cGUpIHsKCQlyZXR1cm4gdGhpcy5jb21ibyhvcHRpb25zLCB0YWcsIHR5cGUpOwoJfQoKCXRyZWUob3B0aW9ucykgewoJCXJldHVybiB0aGlzLnNlbGVjdChvcHRpb25zLCAic2VsZWN0Iik7Cgl9CgoJbmF2aWdhdGlvbihvcHRpb25zKSB7CgkJcmV0dXJuIHRoaXMuY29tYm8ob3B0aW9ucywgJ3VsJywgJ3RyZWUnKTsKCX0KCgljb21ibyhvcHRpb25zLCB0YWcsIHR5cGUpIHsKCQl2YXIgY29scyA9ICQuZ3JlcChvcHRpb25zLmNvbHVtbnMgfHwgW10sIGMgPT4gIWMuaWdub3JlKTsKCQl0YWcgPSB0YWcgfHwgInNlbGVjdCI7CgoJCW9wdGlvbnMuaWRGaWVsZCA9ICQudW5pcXVlU29ydChbewoJCQlmaWVsZDogb3B0aW9ucy5pZEZpZWxkLAoJCQl0aXRsZTogb3B0aW9ucy5pZEZpZWxkCgkJfV0uY29uY2F0KCQuZ3JlcChjb2xzLCBjID0+IGMucHJpbWFyeSksIFt7CgkJCWZpZWxkOiAnSWQnLAoJCQl0aXRsZTogJ0lEJwoJCX1dKSkuZmluZCh4ID0+IHR5cGVvZih4LmZpZWxkKSAhPT0gInVuZGVmaW5lZCIpOwoKCQlvcHRpb25zLnRleHRGaWVsZCA9ICQudW5pcXVlU29ydChbewoJCQlmaWVsZDogb3B0aW9ucy50ZXh0RmllbGQsCgkJCXRpdGxlOiBvcHRpb25zLnRleHRGaWVsZAoJCX1dLmNvbmNhdCgkLmdyZXAoY29scywgYyA9PiBjLmRpc3BsYXkpLCBbewoJCQlmaWVsZDogJ19Ub1N0cmluZycsCgkJCXRpdGxlOiBvcHRpb25zLm5hbWUsCgkJfV0pKS5maW5kKHggPT4gdHlwZW9mKHguZmllbGQpICE9PSAidW5kZWZpbmVkIik7CgoJCS8vY29uc29sZS5sb2coIkR5bmFGb3JtOjpjb21ibygpOiBvcHRpb25zIiwgb3B0aW9ucyk7CgoJCXZhciBmdW4gPSB0eXBlIHx8IHRoaXMuZUZ1bihvcHRpb25zKTsKCgkJdmFyIGRyb3Bkb3duID0gWydjb21ib3RyZWVncmlkJywgJ2NvbWJvdHJlZScsICdjb21ib2dyaWQnLCAnc2VsZWN0J10uaW5kZXhPZihmdW4pID4gLTE7CgkJaWYgKGRyb3Bkb3duKSB0aGlzLnNlbGVjdHMucHVzaCh7CgkJCWlkOiAiY21iIiArIG9wdGlvbnMubmFtZSwKCQkJb3B0aW9uczogdGhpcy5ieU5hbWUob3B0aW9ucy5uYW1lKQoJCX0pOwoJCXRoaXMuc2VsZWN0cyA9ICQudW5pcXVlU29ydCh0aGlzLnNlbGVjdHMpOwoJCXZhciByZXQgPSBgPCR7dGFnfSBpZD0iY21iJHtvcHRpb25zLm5hbWV9IiBjbGFzcz0iZWFzeXVpLSR7ZnVufSIgc3R5bGU9Im1heC13aWR0aDoke2Ryb3Bkb3duPyc0MDBweCc6dGhpcy5jV2lkdGgob3B0aW9ucyl9OyB3aWR0aDoke3RoaXMuY1dpZHRoKG9wdGlvbnMpfXB4IiByZXF1aXJlZD0iJHsob3B0aW9ucy5yZXF1aXJlZCA/ICd0cnVlJyA6ICdmYWxzZScpfSIgZGF0YS1vcHRpb25zPSdkaXNhYmxlZDoke29wdGlvbnMuZGlzYWJsZWQ/J3RydWUnOidmYWxzZSd9LCR7dGhpcy5ldmVudEhhbmRsZXJzKG9wdGlvbnMpfSwgdmFsdWU6IiR7dGhpcy52YWx1ZShvcHRpb25zKX0iLCByb3dudW1iZXJzOiR7dHlwZW9mKG9wdGlvbnMucm93TnVtYmVycykhPT0ndW5kZWZpbmVkJz9vcHRpb25zLnJvd051bWJlcnM6KGZ1bi5pbmRleE9mKCd0cmVlJyk8LTE/J2ZhbHNlJzondHJ1ZScpfSwgcGFnaW5hdGlvbjoke3R5cGVvZihvcHRpb25zLnBhZ2luYXRpb24pIT09J3VuZGVmaW5lZCc/b3B0aW9ucy5wYWdpbmF0aW9uOihmdW4uaW5kZXhPZigndHJlZScpPC0xPydmYWxzZSc6J3RydWUnKX0sIHBhbmVsV2lkdGg6JHsyKnRoaXMuY1dpZHRoKG9wdGlvbnMpfSwgZml0Q29sdW1uczogdHJ1ZSwgc2luZ2xlU2VsZWN0OiB0cnVlLCBtdWx0aXBsZTokeyhvcHRpb25zLm11bHRpcGxlIHx8ICdmYWxzZScpfSwgaWRGaWVsZDogIiR7b3B0aW9ucy5pZEZpZWxkLmZpZWxkfSIsIGVuYWJsZUZpbHRlcjogJHtvcHRpb25zLmZpbHRlcj8ndHJ1ZSc6J2ZhbHNlJ30sIG5vd3JhcDogZmFsc2UsIHRleHRGaWVsZDogIiR7b3B0aW9ucy50ZXh0RmllbGQuZmllbGR9IiwgdHJlZUZpZWxkOiAiJHtvcHRpb25zLnRleHRGaWVsZC5maWVsZH0iLGA7CgkJaWYgKGZ1bi5pbmRleE9mKCd0cmVlJykgPT0gLTEpIHsKCQkJcmV0ICs9ICdmaXRDb2x1bW5zOiBmYWxzZSwnICsgdGhpcy5tYXBDb2x1bW5zKG9wdGlvbnMpOwoJCX0KCQlpZiAob3B0aW9ucy5kYXRhKSB7CgkJCXJldCArPSBgLGRhdGE6ICR7SlNPTi5zdHJpbmdpZnkob3B0aW9ucy5kYXRhKX1gOwoJCX0KCQlyZXQgKz0gYCc+YDsKCQlpZiAob3B0aW9ucy5vcHRpb25zKSB7CgkJCXJldCArPSAkLm1hcChvcHRpb25zLm9wdGlvbnMsIG8gPT4gYDxvcHRpb24gdmFsdWU9JyR7X0ZyRU1ELl90b0pTKG8pfSc+JHtvLm5hbWUgfHwgb308L29wdGlvbj5gKS5qb2luKCdcbicpOwoJCX0KCQlyZXQgKz0gYDwvJHt0YWd9PmA7CgkJLy8gY29uc29sZS5sb2cocmV0KTsKCQlyZXR1cm4gcmV0OwoJfQoKCWdyaWQob3B0aW9ucywgdGFnLCB0eXBlKSB7CgkJcmV0dXJuIHRoaXMuY29tYm8ob3B0aW9ucywgInRhYmxlIiwgImRhdGFncmlkIik7Cgl9CgoJdHJlZWdyaWQob3B0aW9ucykgewoJCXJldHVybiB0aGlzLmNvbWJvKG9wdGlvbnMsICd0YWJsZScsICd0cmVlJyk7Cgl9CgoJYXN5bmMgZG9MaW5rKGUsIGV2ZW50KSB7CgkJdGhpcy5idXN5KHRydWUpOwoJCXRyeSB7CgkJCWF3YWl0IGUubGlua3MuZmluZChsID0+IGwubGFiZWwgPT0gZXZlbnQudGFyZ2V0LmlubmVyVGV4dCkub25DbGljayh0aGlzLmdldCgpKTsKCQl9IGNhdGNoIChleCkgewoJCQljb25zb2xlLmxvZygiRHluYUZvcm06OmRvTGluaygpOiBFeGNlcHRpb246ICIgKyBleCk7CgkJfQoJCXRoaXMuYnVzeShmYWxzZSk7Cgl9CgoJRWRpdGVkVmFsdWUoZSkgewoJCXJldHVybiAodHlwZW9mKGFjZSkgIT09ICJ1bmRlZmluZWQiKSA/IGFjZS5lZGl0KCdwbmwnICsgZS5uYW1lKS5zZXNzaW9uLmdldFZhbHVlKCkgOiAnJzsKCX0KCglhc3luYyBQYW5PbkNsb3NlKGUpIHsKCQlpZiAoZS5lZGl0b3IpIHsKCQkJZS52YWx1ZSA9IHRoaXMuRWRpdGVkVmFsdWUoZSk7CgkJfQoJCWlmIChlLmNsb3NlKSB7CgkJCWF3YWl0IGUuY2xvc2UodGhpcy5nZXQoKSk7CgkJfQoJfQoKCWFzeW5jIFBlbmRBZnRlck9wZW4oZSkgewoJCWlmIChlLmVkaXRvciAmJiB0eXBlb2YoYWNlKSAhPT0gInVuZGVmaW5lZCIpIHsKCQkJYXdhaXQgX0ZyRU1ELk9wZW5FZGl0b3IoJ3BubCcgKyBlLm5hbWUgLyorICctY2VudGVyJyovICwgZS5sYW5ndWFnZSwgZS5sb2FkZXIgfHwgKG8gPT4gZS52YWx1ZSksIGUuc2F2ZXIsIHRoaXMuZ2V0KCksIGUpOwoJCX0KCQlpZiAoZS5vcGVuKSB7CgkJCWF3YWl0IGUub3Blbih0aGlzLmdldCgpKTsKCQl9Cgl9CgoJbGluayhvcHRpb25zKSB7CgkJcmV0dXJuIChvcHRpb25zLmxpbmtzIHx8IFtdKS5maWx0ZXIobCA9PiAhbC5pZ25vcmUpLm1hcChsID0+IGA8YSBocmVmPSIjIiBjbGFzcz0iZWFzeXVpLSR7dGhpcy51aVR5cGVzW29wdGlvbnMudHlwZV19IiBkYXRhLW9wdGlvbnM9JyR7dGhpcy5ldmVudEhhbmRsZXJzKG9wdGlvbnMpfSwgaWNvbkNsczoiaWNvbi0ke2wuaWNvbiB8fCAnb2snfSInPiR7bC5sYWJlbH08L2E+YCkuam9pbignXG4nKTsKCX0KCglhc3luYyBTZXRUcmVlRGF0YShlLCBuLCBkYXRhKSB7CgkJJC5lYWNoKCQoIiNjbWIiICsgZS5uYW1lKVt0aGlzLmVGdW4oZSldKCd0cmVlJykudHJlZSgiZ2V0Q2hpbGRyZW4iLCBuLnRhcmdldCksIChfLCBjKSA9PiAkKCIjY21iIiArIGUubmFtZSlbdGhpcy5lRnVuKGUpXSgndHJlZScpLnRyZWUoInJlbW92ZSIsIGMudGFyZ2V0KSk7CgkJJCgiI2NtYiIgKyBlLm5hbWUpW3RoaXMuZUZ1bihlKV0oJ3RyZWUnKS50cmVlKCJhcHBlbmQiLCB7CgkJCXBhcmVudDogbi50YXJnZXQsCgkJCWRhdGE6IGRhdGEKCQl9KTsKCQlyZXR1cm4gdHJ1ZTsKCX0KCglhc3luYyBFeHBhbmQoZSwgbikgewoJCXRoaXMuU2V0VHJlZURhdGEoZSwgbiwgW3sKCQkJaWQ6IG51bGwsCgkJCXRleHQ6ICJsb2FkaW5nLi4uIgoJCX1dKTsKCQl2YXIgb2JqID0ge307CgkJdmFyIHBGaWVsZCA9IGUucGFyZW50RmllbGQgfHwgJC5tYXAoJC5ncmVwKGUuY29sdW1ucyB8fCBbXSwgYyA9PiBjLnBhcmVudCksIGMgPT4gYy5maWVsZCkuY29uY2F0KFtudWxsXSlbMF07CgkJdmFyIGlkRmllbGQgPSAkLmdyZXAoZS5jb2x1bW5zIHx8IFtdLCBjID0+IGMucHJpbWFyeSkuY29uY2F0KGUuaWRGaWVsZClbMF0uZmllbGQ7CgkJaWYgKHBGaWVsZCkgewoJCQlvYmpbcEZpZWxkXSA9IHsKCQkJCV9zb3VyY2U6IG4uX3NvdXJjZQoJCQl9OwoJCQlpZiAoaWRGaWVsZCkgewoJCQkJb2JqW3BGaWVsZF1baWRGaWVsZF0gPSBuLmlkOwoJCQl9IGVsc2UgewoJCQkJb2JqW3BGaWVsZF0gPSBuLmlkOwoJCQl9CgkJfQoJCWxldCBkYXRhID0gYXdhaXQgdGhpcy5fbG9hZERhdGEoewoJCQlpZDogImNtYiIgKyBlLm5hbWUsCgkJCW9wdGlvbnM6IGUKCQl9LCBvYmopOwoJCXRoaXMuU2V0VHJlZURhdGEoZSwgbiwgZGF0YSk7Cgl9CgoJYXN5bmMgX2xvYWREYXRhKHMsIG8sIHN0YXJ0LCBlbmQpIHsKCQl2YXIgbmFtZSA9IChzICYmIHMub3B0aW9ucyA/IChzLm9wdGlvbnMuQ2xhc3MgPyBzLm9wdGlvbnMuQ2xhc3MuTmFtZS5yZXBsYWNlKCcgJywgJ18nKSA6IChzLm9wdGlvbnMudGFibGUgfHwgcy5vcHRpb25zLm5hbWUpKSA6IHMubmFtZSk7CgkJbmFtZSA9IG5hbWUudHJpbSgpOyAvLy5zcGxpdCgnLicpLnNsaWNlKC0xKVswXTsKCgkJbGV0IG9TY29wZSA9ICh0eXBlb2YoY29tcGFueSkgIT09ICd1bmRlZmluZWQnICYmIGNvbXBhbnkuU2NvcGUpID8gd2luZG93W2NvbXBhbnkuU2NvcGVdIDogd2luZG93OwoJCS8vY29uc29sZS5sb2coIkR5bmFGb3JtOjpfbG9hZERhdGEoKTogb1Njb3BlIiwgb1Njb3BlKTsKCgkJbyA9IG8gfHwgKChvU2NvcGUgJiYgb1Njb3BlW25hbWVdKSA/IG5ldyBvU2NvcGVbbmFtZV0oKSA6IHsKCQkJQWN0aXZlOiB0cnVlLAoJCX0pOwoKCQlvID0gKHR5cGVvZiBmaWx0ZXJzICE9PSAidW5kZWZpbmVkIiAmJiBmaWx0ZXJzICYmIGZpbHRlcnNbbmFtZV0pID8gZmlsdGVyc1tuYW1lXShvKSA6IG87CgkJdmFyIGZ1biA9IHRoaXMuZUZ1bihzLm9wdGlvbnMpOwoJCWxldCBzVGV4dCA9ICQoIiMiICsgcy5pZClbZnVuXSgnZ2V0VGV4dCcpOwoKCQlvID0gKHMgJiYgcy5vcHRpb25zICYmIHMub3B0aW9ucy5zb3VyY2UpID8gcy5vcHRpb25zLnNvdXJjZShvLCB0aGlzLmdldCgpLCBzVGV4dCkgOiBvOwoJCWxldCBuYW1lcyA9ICQudW5pcXVlU29ydChbcy5vcHRpb25zLnNlYXJjaEZpZWxkXS5jb25jYXQoJC5tYXAoJC5ncmVwKHMub3B0aW9ucy5jb2x1bW5zIHx8IFtdLCBjID0+IGMuc2VhcmNoKSwgYyA9PiBjLmZpZWxkKSwgWyJOYW1lIl0pKS5maWx0ZXIodiA9PiB2KTsKCQlpZiAoIW9bbmFtZXNbMF1dKSBvW25hbWVzWzBdXSA9IHNUZXh0OwoJCS8vY29uc29sZS5sb2coIkR5bmFGb3JtOjpfbG9hZERhdGEoKTogbyIsIG8pOwoJCXZhciBkYXRhID0gbnVsbDsKCgkJbGV0IGxpYiA9ICcnOwoJCWlmIChuYW1lLmluZGV4T2YoJy4nKSA+IDApIHsKCQkJbGliID0gbmFtZS5zcGxpdCgnLicpWzBdICsgJy4nOwoJCQluYW1lID0gbmFtZS5zcGxpdCgnLicpWzFdOwoJCX0KCgkJaWYgKHMub3B0aW9ucy5sb2FkZXIpIHsKCQkJZGF0YSA9IGF3YWl0IHMub3B0aW9ucy5sb2FkZXIodGhpcy5nZXQoKSwgcy5vcHRpb25zLCBvLCBzVGV4dCk7CgkJfSBlbHNlIGlmIChvICYmIHR5cGVvZihvLmZpbmRBbGwpID09PSAnZnVuY3Rpb24nKSB7CgkJCWRhdGEgPSBhd2FpdCBvLmZpbmRBbGwoKTsKCQl9IGVsc2UgaWYgKHR5cGVvZihjb21wYW55KSAhPT0gJ3VuZGVmaW5lZCcgJiYgY29tcGFueS5saWJyYXJ5ICYmIGNvbXBhbnkuQ29kZSAmJiB3aW5kb3cuYkxvY2FsKSB7CgkJCS8vY29uc29sZS5sb2coIkRGb3JtOjpfbG9hZERhdGEoKTogc3IoKS5fKCIgKyBsaWIgKyBjb21wYW55LkNvZGUudG9Mb3dlckNhc2UoKSArIG5hbWUgKyAiRmluZGFsbCIgKyAiKSIsIG8pOwoJCQlkYXRhID0gYXdhaXQgdGhpcy5zcigpLl8obGliICsgY29tcGFueS5Db2RlLnRvTG93ZXJDYXNlKCkgKyBuYW1lICsgIkZpbmRhbGwiLCBudWxsLCBvLCBudWxsLCBzdGFydCwgZW5kKTsKCQl9IGVsc2UgaWYgKF9GckVNRC5hcGlTZXJ2ZXIpIHsKCQkJbyA9IE9iamVjdC5hc3NpZ24oLi4uT2JqZWN0LmtleXMobykubWFwKGsgPT4gKHsKCQkJCVtTdHJpbmcoaykuY2hhckF0KDApLnRvTG93ZXJDYXNlKCkgKyBTdHJpbmcoaykuc2xpY2UoMSldOiBvW2tdCgkJCX0pKSk7CgkJCS8vY29uc29sZS5sb2coIkRGb3JtOjpfbG9hZERhdGEoKTogdXNpbmcgX0ZyRU1ELmFwaVNlcnZlcjogbyIsIG8pOwoJCQlkYXRhID0gYXdhaXQgX0ZyRU1ELmFwaVNlcnZlci5fbmV3KG5hbWUpLl9mcm9tRG9jdW1lbnQobykuZmluZEFsbCgpOwoJCQkvL2RhdGEuZmlsdGVyKGQgPT4gZC5JZCAhPSBkLklkKS5mb3JFYWNoKGQgPT4gZC5JZCA9IGQuX3V1aWQobnVsbCwgbnVsbCwgdHJ1ZSkpOwoJCX0KCgkJaWYgKHMub3B0aW9ucy5wb3N0bG9hZCkgewoJCQlhd2FpdCBzLm9wdGlvbnMucG9zdGxvYWQoZGF0YSk7CgkJfQoJCSQuZWFjaChkYXRhLCAoaSwgZCkgPT4gewoJCQlkLl9fT1dORVIgPSBzOwoJCQkkLmVhY2gocy5vcHRpb25zLmNvbHVtbnMsIChfLCBjKSA9PiB7CgkJCQlpZiAoYy52YWx1ZSkgewoJCQkJCWRbYy5maWVsZF0gPSBjLnZhbHVlKGQsIGRhdGEsIGkpOwoJCQkJfQoJCQl9KTsKCQl9KTsKCQlpZiAoIXMub3B0aW9ucy5jb2x1bW5zICYmIGZ1bi5pbmRleE9mKCd0cmVlJykgPiAtMSkgewoJCQlkYXRhID0gJC5tYXAoZGF0YSwgZCA9PiB7CgkJCQlsZXQgcmV0ID0gewoJCQkJCWlkOiBkW3Mub3B0aW9ucy5pZEZpZWxkLmZpZWxkXSwKCQkJCQl0ZXh0OiBkW3Mub3B0aW9ucy50ZXh0RmllbGQuZmllbGRdLAoJCQkJCXN0YXRlOiBkLnN0YXRlIHx8IChzLm9wdGlvbnMubG9hZGVyID8gImZpbGUiIDogImNsb3NlZCIpLAoJCQkJCV9zb3VyY2U6IGQsCgkJCQl9OwoJCQkJcmV0LmNoaWxkcmVuID0gKHJldC5zdGF0ZSA9PSAiY2xvc2VkIikgPyBbewoJCQkJCXRleHQ6ICdsb2FkaW5nLi4uJwoJCQkJfV0gOiBudWxsOwoJCQkJcmV0dXJuIHJldDsKCQkJfSk7CgkJfQoJCXJldHVybiBkYXRhIHx8IFtdOwoJfQoKCWFzeW5jIGZpbGxEYXRhKGcsIG8sIHN0YXJ0LCBlbmQpIHsKCQl2YXIgcyA9IG51bGw7CgkJZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnNlbGVjdHMubGVuZ3RoOyBpKyspIHsKCQkJaWYgKHRoaXMuc2VsZWN0c1tpXS5pZCA9PSBnWzBdLmlkKSBzID0gdGhpcy5zZWxlY3RzW2ldOwoJCX0KCQlpZiAoIXMpIHJldHVybjsKCQl0aGlzLmJ1c3kodHJ1ZSk7CgkJdHJ5IHsKCQkJdmFyIGZ1biA9IGdbMF0uY2xhc3NMaXN0WyIwIl0ucmVwbGFjZSgnZWFzeXVpLScsICcnKTsKCQkJdHJ5IHsKCQkJCSQoIiMiICsgcy5pZClbZnVuXSgnZ3JpZCcpLmRhdGFncmlkKCdnZXRQYWdlcicpLnBhZ2luYXRpb24oJ2xvYWRpbmcnKTsKCQkJfSBjYXRjaCAoZXgpIHt9CgkJCWlmIChzLm9wdGlvbnMubm9sb2FkKSB7CgkJCQlsZXQgX2RhdGEgPSBudWxsOwoJCQkJdHJ5IHsKCQkJCQlfZGF0YSA9ICQoIiMiICsgcy5pZClbZnVuXSgnZ3JpZCcpLmRhdGFncmlkKCJnZXREYXRhIik7CgkJCQl9IGNhdGNoIChleCkgewoJCQkJCV9kYXRhID0gJCgiIyIgKyBzLmlkKVtmdW5dKCd0cmVlJykudHJlZSgnZ2V0Um9vdCcpOwoJCQkJfQoJCQkJaWYgKF9kYXRhKSB7CgkJCQkJcmV0dXJuIHRoaXMuYnVzeShmYWxzZSk7CgkJCQl9CgkJCX0KCQkJdmFyIGRhdGEgPSBhd2FpdCB0aGlzLl9sb2FkRGF0YShzLCBvLCBzdGFydCwgZW5kKTsKCQkJdHJ5IHsKCQkJCWlmICgkKCIjIiArIHMuaWQpW2Z1bl0oJ2dyaWQnKSkgJCgiIyIgKyBzLmlkKVtmdW5dKCdncmlkJykuZGF0YWdyaWQoJ2dldFBhZ2VyJykucGFnaW5hdGlvbignbG9hZGVkJyk7CgkJCX0gY2F0Y2ggKGV4KSB7fQoJCQl0cnkgewoJCQkJJCgiIyIgKyBzLmlkKVtmdW5dKCdncmlkJykuZGF0YWdyaWQoJ2xvYWREYXRhJywgewoJCQkJCXRvdGFsOiBkYXRhLkNvdW50IHx8IGRhdGEubGVuZ3RoLAoJCQkJCXJvd3M6IGRhdGEsCgkJCQl9KTsKCQkJfSBjYXRjaCAoZXgpIHsKCQkJCSQoIiMiICsgcy5pZClbZnVuXSgndHJlZScpLnRyZWUoJ2xvYWREYXRhJywgZGF0YSk7CgkJCX0KCQl9IGNhdGNoIChleCkgewoJCQljb25zb2xlLmxvZyhleCk7CgkJfQoJCXRoaXMuYnVzeShmYWxzZSk7Cgl9CgoJZXZlbnRIYW5kbGVycyhvcHRpb25zKSB7CgkJLy9jb25zb2xlLmxvZygiRHluYUZvcm06OmV2ZW50SGFuZGxlcnMoKTogb3B0aW9ucyIsIG9wdGlvbnMpOwoJCWlmICghdGhpcy5ieU5hbWUob3B0aW9ucy5uYW1lKSkgcmV0dXJuOyAvLyBpZiBub3QgYW4gZWxlbWVudCwgZG8gbm90IHJ1biB0aGUgaGFuZGxlcnMKCgkJcmV0dXJuIHRoaXMuZXZlbnRzLmZpbHRlcihlID0+IGUudHlwZSA9PSBvcHRpb25zLnR5cGUgfHwgdHlwZW9mKGUudHlwZSkgPT09ICd1bmRlZmluZWQnKS5tYXAoZSA9PiBgJHtlLm5hbWV9OiAoJHtlLnBhcmFtcyB8fCAnJ30pID0+IHt0cnl7REZvcm0uJHtlLmhhbmRsZXJ9KERGb3JtLmJ5TmFtZSgiJHtvcHRpb25zLm5hbWV9IikgfHwgJHtfRnJFTUQuX3RvSlMob3B0aW9ucyl9IHx8IHtuYW1lOiAiJHtvcHRpb25zLm5hbWV9Iix0eXBlOiAiJHtvcHRpb25zLnR5cGV9In0sICR7ZS5wYXJhbXN9KX1jYXRjaChleCl7Y29uc29sZS5sb2coIkV2ZW50IEVycm9yOiAke29wdGlvbnMubmFtZX0vJHtvcHRpb25zLnR5cGV9LyR7ZS5uYW1lfSIsIGV4KTt9fWApLmpvaW4oJywnKTsKCX0KCglhc3luYyBQYW5lbE9wZW4oZSkgewoJCWlmIChlLmVkaXRvcikgcmV0dXJuIHRydWU7CgkJbGV0IGNvbnRlbnQgPSBlLnZhbHVlOwoJCWlmIChlLmxvYWRlcikgewoJCQljb250ZW50ID0gYXdhaXQgZS5sb2FkZXIodGhpcy5nZXQoKSk7CgkJfQoJCWlmIChjb250ZW50KSB7CgkJCXRyeSB7CgkJCQkkKCIjcG5sIiArIGUubmFtZSkucGFuZWwoJ2JvZHknKS5odG1sKGNvbnRlbnQpOwoJCQkJY29uc29sZS5sb2coInBubCIgKyBlLm5hbWUgKyAiOiBDb250ZW50IFZhbGlkIik7CgkJCX0gY2F0Y2ggKGV4KSB7CgkJCQkvL2NvbnNvbGUubG9nKGV4KTsKCQkJfQoJCX0KCQlyZXR1cm4gY29udGVudDsKCX0KCglhc3luYyBTZWxlY3RDaGFuZ2Uob3B0aW9ucywgdGFiKSB7CgkJdGhpcy5idXN5KHRydWUpOwoJCSQuZ3JlcCh0aGlzLmVsZW1lbnRzLCBlID0+IGUudHlwZSA9PSAiZ3JpZCIgJiYgZS5ncm91cCA9PSB0YWIpLmZvckVhY2goZSA9PiAkKCIjY21iIiArIGUubmFtZSkuZGF0YWdyaWQoKSk7CgkJdGhpcy5idXN5KGZhbHNlKTsKCX0KCglhc3luYyBGaWVsZENoYW5nZShvcHRpb25zLCB2YWx1ZSkgewoJCXRoaXMuYnVzeSh0cnVlKTsKCQlpZiAob3B0aW9ucyAmJiBvcHRpb25zLmNoYW5nZSkgewoJCQlhd2FpdCBvcHRpb25zLmNoYW5nZSh0aGlzLmdldCgpLCB2YWx1ZSk7CgkJfQoJCXRoaXMuYnVzeShmYWxzZSk7Cgl9CgoJYXN5bmMgVVJMQ2hhbmdlKHMsIG9wdGlvbnMpIHsKCQlvcHRpb25zLmRhdGEgPSBhd2FpdCAkLmdldChzLnZhbHVlKTsKCQlyZXR1cm4gYXdhaXQgdGhpcy5GaWVsZENoYW5nZShzLCBvcHRpb25zKTsKCX0KCglhc3luYyBVcGxvYWRGaWxlKGYsIG9wdGlvbnMpIHsKCQl0aGlzLmJ1c3kodHJ1ZSk7CgkJdmFyIGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKCk7CgkJdmFyIGZpbGVpZCA9IE1hdGgucmFuZG9tKCk7CgkJdmFyIG1ldGhvZCA9IG9wdGlvbnMubWV0aG9kIHx8ICJDb250ZW50TWFuYWdlci5jbXNVcGxvYWRGaWxlIjsKCQlmb3JtRGF0YS5hcHBlbmQoJ2ZpbGVpZCcsIGZpbGVpZCk7CgkJdmFyIGZpbGUgPSAkKCIjIiArIGYuZmlsZWJveElkKVswXS5maWxlc1swXTsKCQlmb3JtRGF0YS5hcHBlbmQoJ19fVUZJTEUnLCBmaWxlKTsKCQlpZiAob3B0aW9ucy5sb2NhbCkgewoJCQkvLyBoYW5kbGluZyB0aGUgZmlsZSBsb2NhbGx5CgkJCXZhciByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpOwoJCQlyZWFkZXIub25sb2FkID0gYXN5bmMgKGUpID0+IHsKCQkJCXZhciBkYXRhID0gZS50YXJnZXQucmVzdWx0OwoJCQkJREZvcm0uYnlOYW1lKG9wdGlvbnMubmFtZSkuZGF0YSA9IGRhdGE7CgkJCQlpZiAob3B0aW9ucyAmJiBvcHRpb25zLnVwbG9hZCkgYXdhaXQgb3B0aW9ucy51cGxvYWQodGhpcy5nZXQoKSwgZGF0YSk7CgkJCQl0aGlzLmJ1c3koZmFsc2UpOwoJCQl9OwoJCQlpZiAob3B0aW9ucy5iaW5hcnkpIHsKCQkJCXJlYWRlci5yZWFkQXNCaW5hcnlTdHJpbmcoZmlsZSk7CgkJCX0gZWxzZSBpZiAob3B0aW9ucy5kYXRhdXJsKSB7CgkJCQlyZWFkZXIucmVhZEFzRGF0YVVSTChmaWxlKTsKCQkJfSBlbHNlIHsKCQkJCXJlYWRlci5yZWFkQXNUZXh0KGZpbGUpOwoJCQl9CgkJfSBlbHNlIGlmIChtZXRob2QpIHsKCQkJJC5hamF4KHsKCQkJCXVybDogdGhpcy5zcigpLnNyVVJMICsgIiZtZXRob2Q9IiArIG1ldGhvZCArICImc0lucHV0PSIgKyBmaWxlaWQgKyAiJnByZVRhZz0mcG9zdFRhZz0iLAoJCQkJZGF0YTogZm9ybURhdGEsCgkJCQkvLyBUSElTIE1VU1QgQkUgRE9ORSBGT1IgRklMRSBVUExPQURJTkcKCQkJCWNhY2hlOiBmYWxzZSwKCQkJCWNvbnRlbnRUeXBlOiBmYWxzZSwKCQkJCXR5cGU6ICdQT1NUJywKCQkJCXByb2Nlc3NEYXRhOiBmYWxzZSwKCQkJCXN1Y2Nlc3M6IGRhdGEgPT4gewoJCQkJCXRoaXMuc3IoKS5ydW5TY3JpcHQoZGF0YSk7CgkJCQkJdGhpcy5ieU5hbWUob3B0aW9ucy5uYW1lKS5kYXRhID0gcmV0OwoJCQkJCWlmIChvcHRpb25zICYmIG9wdGlvbnMudXBsb2FkKSBvcHRpb25zLnVwbG9hZCh0aGlzLmdldCgpLCByZXQpOwoJCQkJCXRoaXMuYnVzeShmYWxzZSk7CgkJCQl9CgkJCX0pOwoJCX0KCX0KCgllRnVuKGUpIHsKCQl0cnkgewoJCQlpZiAoZS50eXBlID09ICJ0cmVlIikgewoJCQkJaWYgKGUuY29sdW1ucykgewoJCQkJCXJldHVybiAiY29tYm90cmVlZ3JpZCI7CgkJCQl9IGVsc2UgaWYgKHR5cGVvZihlLmNvbWJvKSAhPT0gJ3VuZGVmaW5lZCcgJiYgIWUuY29tYm8pIHsKCQkJCQlyZXR1cm4gJ3RyZWUnOwoJCQkJfSBlbHNlIHsKCQkJCQlyZXR1cm4gImNvbWJvdHJlZSI7CgkJCQl9CgkJCX0gZWxzZSBpZiAoZS50eXBlID09ICduYXZpZ2F0aW9uJykgewoJCQkJcmV0dXJuICd0cmVlJzsKCQkJfSBlbHNlIGlmIChlLnR5cGUgPT0gImNvbWJvdHJlZSIpIHsKCQkJCXJldHVybiAiY29tYm90cmVlZ3JpZCI7CgkJCX0gZWxzZSBpZiAoZS50eXBlID09ICJzZWxlY3QiICYmIGUub3B0aW9ucykgewoJCQkJcmV0dXJuICJjb21ib2JveCI7CgkJCX0KCQkJcmV0dXJuICJjb21ib2dyaWQiOwoJCX0gY2F0Y2ggKGV4KSB7CgkJCXJldHVybiAiY29tYm9ncmlkIjsKCQl9Cgl9CgoJX2ZpbGxXaW5kb3cod2luTmFtZSwgdiwgbWFwKSB7CgkJdiA9IHYgfHwge307CgkJbWFwID0gbWFwIHx8IHt9OwoJCWlmIChBcnJheS5pc0FycmF5KG1hcCkpIHsKCQkJbWFwID0gT2JqZWN0LmZyb21FbnRyaWVzKG5ldyBNYXAobWFwKSk7CgkJfQoKCQltYXAgPSAkLmV4dGVuZCh7fSwgbWFwLCBPYmplY3QuZnJvbUVudHJpZXMoT2JqZWN0LmtleXModikubWFwKGsgPT4gW3dpbk5hbWUgKyBrLCBrXSkpKTsKCgkJbGV0IHMgPSB7fTsKCQlmb3IgKHZhciBtIGluIG1hcCkgewoJCQlpZiAodHlwZW9mKHZbbWFwW21dXSkgPT09ICJ1bmRlZmluZWQiKSB7CgkJCQkvL2NvbnNvbGUubG9nKCdpc191bmRlZmluZWQnLCBtLCBtYXBbbV0sIHZbbWFwW21dXSk7CgkJCQlzW21dID0gbWFwW21dOwoJCQl9IGVsc2UgewoJCQkJLy9jb25zb2xlLmxvZygnaXNfbm90X3VuZGVmaW5lZCcsIG0sIG1hcFttXSwgdlttYXBbbV1dKTsKCQkJCXNbbV0gPSB2W21hcFttXV07CgkJCX0KCQl9CgkJdGhpcy5jbGVhcih3aW5OYW1lKTsKCQkvL2NvbnNvbGUubG9nKCJzIiwgcyk7CgkJdGhpcy5zZXQocyk7CgkJJCgiI3BubF8iICsgd2luTmFtZSkud2luZG93KCJvcGVuIik7Cgl9CgoJd2luZG93VG9FbnRpdHkobywgYkVtcHR5LCBncmlkLCBwcmVmaXgsIGZpbHRlcikgewoJCW8gPSBvIHx8IHRoaXMuZ2V0KCk7CgkJZmlsdGVyID0gZmlsdGVyIHx8ICh2ID0+IHYpOwoJCWxldCByZXQgPSBncmlkID8gKGdyaWQuc2VsZWN0ZWQgfHwgZ3JpZCkgOiBudWxsOwoJCWlmIChiRW1wdHkpIHsKCQkJcmV0ID0ge307CgkJCW8gPSB7fTsKCQl9IGVsc2UgewoJCQlyZXQgPSAocmV0ICYmIHJldC5JZCkgPyB7CgkJCQlJZDogcmV0LklkCgkJCX0gOiB7fTsKCQl9CgoJCXRoaXMuZWxlbWVudHMuZmlsdGVyKGUgPT4gKHByZWZpeCA/IGUuZ3JvdXAgPT0gcHJlZml4IDogdHJ1ZSkgJiYgZS50eXBlICE9ICdsaW5rJyAmJiBbJ18nXS5pbmRleE9mKGUubmFtZS5yZXBsYWNlKHByZWZpeCwgIiIpKSA8IDApLmZvckVhY2goZSA9PiB7CgkJCXJldFtlLm5hbWUucmVwbGFjZShwcmVmaXgsICIiKV0gPSBvW2UubmFtZV07CgkJCXJldHVybiB0cnVlOwoJCX0pOwoKCQlmaWx0ZXIocmV0KTsKCgkJcmV0dXJuIHJldDsKCX0KCgliaW5kKG9iaikgewoJCXZhciBvYmpCaW5kID0gKG8sIGUpID0+IHsKCQkJb1t0aGlzLmVGdW4oZSldKHsKCQkJCW9uU2hvd1BhbmVsOiAoKSA9PiB7CgkJCQkJdGhpcy5maWxsRGF0YSgkKCIjIiArIGUuaWQpLCBudWxsLCAwLCAxMCk7CgkJCQl9LAoJCQkJb25DbGlja1JvdzogKGluZGV4LCByb3cpID0+IHsKCQkJCQl2YXIgcyA9IHJvdyA/IHJvdy5fX09XTkVSIDogbnVsbDsKCQkJCQkvLyBjb25zb2xlLmxvZygib25DbGlja1JvdygpOiAiLCBpbmRleCwgcm93LCBzKTsKCQkJCQlpZiAocyAmJiBzLm9wdGlvbnMuc2VsZWN0KSB7CgkJCQkJCXMub3B0aW9ucy5zZWxlY3Qocm93LCB0aGlzLmdldCgpKTsKCQkJCQl9CgkJCQl9CgkJCX0pOwoJCQl0cnkgewoJCQkJdmFyIGRnID0gb1t0aGlzLmVGdW4oZSldKCdncmlkJyk7CgkJCQkvLyBkZy5kYXRhZ3JpZCgnZW5hYmxlRmlsdGVyJykKCQkJCXZhciBzdGF0ZSA9IGRnLmRhdGEoJ2RhdGFncmlkJyk7CgkJCQl2YXIgb3B0cyA9IHN0YXRlLm9wdGlvbnM7CgkJCQl2YXIgb25CZWZvcmVMb2FkID0gb3B0cy5vbkJlZm9yZUxvYWQ7CgkJCQlvcHRzLm9uQmVmb3JlTG9hZCA9IChwYXJhbSkgPT4gewoJCQkJCXN0YXRlLmFsbFJvd3MgPSBudWxsOwoJCQkJCXJldHVybiBvbkJlZm9yZUxvYWQuY2FsbCh0aGlzLCBwYXJhbSk7CgkJCQl9OwoJCQkJdmFyIHBhZ2VyID0gZGcuZGF0YWdyaWQoJ2dldFBhZ2VyJyk7CgkJCQlkZy5kYXRhZ3JpZCgnZ2V0UGFuZWwnKS5wYW5lbCh7CgkJCQkJSUQ6IGkKCQkJCX0pOwoJCQkJcGFnZXIucGFnaW5hdGlvbih7CgkJCQkJb25TZWxlY3RQYWdlOiBmdW5jdGlvbihwYWdlTnVtLCBwYWdlU2l6ZSkgewoJCQkJCQl0cnkgewoJCQkJCQkJREZvcm0uZmlsbERhdGEoJCgiIyIgKyBERm9ybS5zZWxlY3RzWyQodGhpcy5wYXJlbnROb2RlKS5wYW5lbCgnb3B0aW9ucycpLklEXS5pZCksIG51bGwsIHBhZ2VTaXplICogKHBhZ2VOdW0gLSAxKSwgcGFnZVNpemUgKiBwYWdlTnVtKTsKCQkJCQkJfSBjYXRjaCAoX2V4KSB7CgkJCQkJCQljb25zb2xlLmxvZygiRHluYUZvcm06Om9uU2VsZWN0UGFnZSgpICIsIF9leCk7CgkJCQkJCX0KCQkJCQl9CgkJCQl9KTsKCQkJCWRnLmRhdGFncmlkKCdsb2FkRGF0YScsIHN0YXRlLmRhdGEpOwoJCQl9IGNhdGNoIChleCkge30KCQl9OwoJCWlmIChvYmopIHsKCQkJb2JqQmluZChvYmopOwoJCX0gZWxzZSB7CgkJCWZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5zZWxlY3RzLmxlbmd0aDsgaSsrKSB7CgkJCQlpZiAodGhpcy5zZWxlY3RzW2ldLm9wdGlvbnMub3B0aW9ucykgewoJCQkJCS8vJCgiIyIgKyB0aGlzLnNlbGVjdHNbaV0uaWQpLmNvbWJvKCk7CgkJCQl9IGVsc2UgewoJCQkJCW9iakJpbmQoJCgiIyIgKyB0aGlzLnNlbGVjdHNbaV0uaWQpLCB0aGlzLnNlbGVjdHNbaV0pOwoJCQkJfQoJCQl9CgoJCQl0aGlzLmVsZW1lbnRzLmZpbHRlcihlID0+IGUud2luZG93ICYmIGUuZ3JvdXApLmZvckVhY2goZSA9PiB7CgkJCQlsZXQgdCA9ICQoIiN0YmNXaW5kb3ciKS50YWJzKCJnZXRUYWIiLCBlLmdyb3VwKTsKCQkJCWlmICh0KSB7CgkJCQkJdC5wYW5lbCgnb3B0aW9ucycpLnRhYi5oaWRlKCk7CgkJCQl9CgkJCX0pOwoJCX0KCX0KCgllbmdsaXNoKHMpIHsKCQlpZiAoIXMpIHJldHVybiAiIjsKCQl2YXIgcmVzdWx0ID0gcy5yZXBsYWNlKC8oW0EtWl0pL2csICIgJDEiKTsKCQlyZXN1bHQgPSByZXN1bHQucmVwbGFjZSgvXy9nLCAnJyk7CgkJcmV0dXJuIHJlc3VsdC5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHJlc3VsdC5zbGljZSgxKTsKCX0KCglvblRvZ2dsZShlLCBiVmFsdWUpIHsKCQlsZXQgc1RhZyA9IGAjZkVsZW1lbnRfJHtlLmZvci5uYW1lfSA+IC5lYXN5dWktJHt0aGlzLnVpVHlwZXNbZS5mb3IudHlwZV19YDsKCQlsZXQgb1RhZyA9ICQoc1RhZyk7CgkJZS5mb3IuZW5hYmxlZCA9IHR5cGVvZihiVmFsdWUpID09PSAidW5kZWZpbmVkIiA/ICFlLmZvci5lbmFibGVkIDogYlZhbHVlOwoKCQlvVGFnLnByb3AoImRpc2FibGVkIiwgIWUuZm9yLmVuYWJsZWQpOwoJCS8vb1RhZ1t0aGlzLnVpVHlwZXNbZS5mb3IudHlwZV1dKGUuZm9yLmVuYWJsZWQgPyAiZW5hYmxlIiA6ICJkaXNhYmxlIik7CgkJY29uc29sZS5sb2coc1RhZywgb1RhZywgdGhpcy51aVR5cGVzW2UuZm9yLnR5cGVdLCBlLmZvci5lbmFibGVkKTsKCX0KCglyZW5kZXIobmFtZSwgdGl0bGUsIGVsZW1lbnRzLCBidXR0b25zLCBiRml4ZWQpIHsKCQl0aGlzLmVsZW1lbnRzID0gKGVsZW1lbnRzIHx8IFtdKS5maWx0ZXIoZSA9PiAhZS5pZ25vcmUpOwoKCQl0aGlzLmJ1dHRvbnMgPSBidXR0b25zIHx8IFtdOwoJCXRoaXMuc2VsZWN0cyA9IFtdOwoJCXRoaXMuZ3JpZHMgPSBbXTsKCgkJdGhpcy5lbGVtZW50cy5maWx0ZXIoZSA9PiBlLnR5cGUgPT0gIndpbmRvdyIpLmZvckVhY2godyA9PiB0aGlzLmVsZW1lbnRzLnNwbGljZSh0aGlzLmVsZW1lbnRzLmZpbmRJbmRleChlID0+IGUubmFtZSA9PSB3Lm5hbWUpLCAwLCB7CgkJCW5hbWU6ICJfIiArIHcubmFtZSwKCQkJdHlwZTogImxpbmsiLAoJCQl0aXRsZTogdy50aXRsZSB8fCB0aGlzLmVuZ2xpc2gody5uYW1lKSwKCQkJZ3JvdXA6IHcuZ3JvdXAsCgkJCXdpbmRvdzogdy53aW5kb3csCgkJCXNlY3Rpb246IHcuc2VjdGlvbiwKCQkJbGlua3M6IFt7CgkJCQlsYWJlbDogJ09wZW4nLAoJCQkJaWNvbjogJ2VkaXQnLAoJCQkJb25DbGljazogbyA9PiAkKCIjcG5sIiArIHcubmFtZSkud2luZG93KCdvcGVuJykKCQkJfV0sCgkJfSkpOwoKCQl0aGlzLnNyKCkuZ3JvdXBCeSh0aGlzLmVsZW1lbnRzLmZpbHRlcihlID0+IGUud2luZG93KSwgImdyb3VwIikuZm9yRWFjaChrdiA9PiB7CgkJCWlmICgha3Yua2V5KSByZXR1cm47CgoJCQlsZXQgZSA9IHsKCQkJCW5hbWU6ICJfIiArIGt2LmtleSwKCQkJCXRpdGxlOiBrdi5rZXksCgkJCQl0eXBlOiAid2luZG93IiwKCQkJCWdyb3VwOiBrdi5rZXksCgkJCQl3aWR0aDogdGhpcy53aWR0aCAqIDAuOSwKCQkJCWhlaWdodDogdGhpcy5oZWlnaHQgKiAwLjksCgkJCQlsb2FkZXI6IG8gPT4gewoJCQkJCWt2LnZhbHVlcy5maWx0ZXIodiA9PiB2LnR5cGUgIT09ICdsaW5rJyB8fCAodi50eXBlID09ICdsaW5rJyAmJiB2Lm5hbWUuc3RhcnRzV2l0aCgnXycpKSkuZm9yRWFjaCh2ID0+ICQoIiNwbmxfIiArIHYuZ3JvdXAgKyAnLWNlbnRlcicpLmFwcGVuZCgkKCIjZkVsZW1lbnRfIiArIHYubmFtZSkpKTsKCQkJCQlyZXR1cm4gbnVsbDsKCQkJCX0sCgkJCQlidXR0b25zOiBbXS5jb25jYXQuYXBwbHkoW10sIGt2LnZhbHVlcy5maWx0ZXIodiA9PiB2LnR5cGUgPT0gJ2xpbmsnICYmICF2Lm5hbWUuc3RhcnRzV2l0aCgnXycpKS5tYXAodiA9PiBbLi4udi5saW5rcy5tYXAobCA9PiAoewoJCQkJCW5hbWU6IGwubmFtZSB8fCBsLmxhYmVsLAoJCQkJCXRpdGxlOiBsLnRpdGxlIHx8IGwubGFiZWwsCgkJCQkJb25DbGljazogbC5vbkNsaWNrLAoJCQkJCWljb246IGwuaWNvbiwKCQkJCQl3aW5kb3c6IHRydWUsCgkJCQkJZ3JvdXA6IGt2LmtleSwKCQkJCX0pKV0pKSwKCQkJfTsKCQkJdGhpcy5idXR0b25zLnB1c2goLi4uZS5idXR0b25zKTsKCgkJCXRoaXMuZWxlbWVudHMucHVzaChlKTsKCQl9KTsKCgkJdmFyIHJldCA9ICIiOwoJCS8vIGNoZWNrIHRoZSBvcHRpb24gb2YgdXNpbmcgd2luZG93KCkgYXMgYSByZW5kZXJlciBvZiB0aGUgbWFpbiB3aW5kb3cuLi4KCQlpZiAodHJ1ZSkgewoJCQl0aGlzLmVsZW1lbnRzLmZpbHRlcihlID0+ICFlLnpvbmUpLmZvckVhY2goZSA9PiBlLnpvbmUgPSAnY2VudGVyJyk7CgkJCWxldCB3T3B0aW9ucyA9IHsKCQkJCW5hbWU6IG5hbWUgfHwgdGhpcy5uYW1lLAoJCQkJdGl0bGU6IHRpdGxlIHx8IHRoaXMudGl0bGUsCgkJCQl0eXBlOiAnd2luZG93JywKCQkJCXZpc2libGU6IHRydWUsCgkJCQl3aWR0aDogdGhpcy53aWR0aCwKCQkJCWhlaWdodDogdGhpcy5oZWlnaHQsCgkJCQlmaXhlZDogYkZpeGVkLAoJCQkJbGlua3M6IFt7CgkJCQkJaWNvbjogImhlbHAiLAoJCQkJCWFjdGlvbjogbyA9PiAkKCIjcG5sX19Db25zb2xlIikud2luZG93KCdvcGVuJykKCQkJCX1dLAoJCQkJYnV0dG9uczogdGhpcy5idXR0b25zLmZpbHRlcihiID0+ICFiLndpbmRvdyksCgkJCX07CgkJCXRoaXMuc3IoKS5ncm91cEJ5KHRoaXMuZWxlbWVudHMsICd6b25lJykuZmlsdGVyKHpnID0+IHpnLmtleSkuZm9yRWFjaCh6ZyA9PiB7CgkJCQl3T3B0aW9uc1t6Zy5rZXldID0gdGhpcy5yZW5kZXJFbGVtZW50cyh6Zy52YWx1ZXMpOwoJCQl9KTsKCgkJCXJldCA9IHRoaXMud2luZG93KHdPcHRpb25zKTsKCQl9IGVsc2UgewoJCQlyZXQgPSB0aGlzLmhlYWRlcihuYW1lLCB0aXRsZSwgYkZpeGVkLCBbewoJCQkJaWNvbjogImhlbHAiLAoJCQkJYWN0aW9uOiBvID0+ICQoIiNwbmxfX0NvbnNvbGUiKS53aW5kb3coJ29wZW4nKQoJCQl9XSk7CgoJCQlyZXQgKz0gdGhpcy5yZW5kZXJFbGVtZW50cygpOwoKCQkJcmV0ICs9IHRoaXMuZm9vdGVyKGJGaXhlZCk7CgoJCX0KCQkvLyBjb25zb2xlLmxvZyhyZXQpOwoKCQlyZXR1cm4gcmV0OwoJfQoKCWNXaWR0aChvcHRpb25zKSB7CgkJbGV0IHJldCA9IE1hdGguZmxvb3IoKChvcHRpb25zID8gb3B0aW9ucy53aWR0aCA6IG51bGwpIHx8ICh0aGlzLndpZHRoIC8gMykpKTsKCQlpZiAob3B0aW9ucy56b25lID09ICdlYXN0JyB8fCBvcHRpb25zLnpvbmUgPT0gJ3dlc3QnKSB7CgkJCXJldCA9IDAuMjUgKiByZXQ7IC8vIDkwJSBvZiAzLzEwLCB0aGUgd2lkdGggb2YgdGhlIG5vcm1hbCBlbGVtZW50CgkJfSBlbHNlIGlmIChvcHRpb25zICYmIG9wdGlvbnMuZWRpdG9yKSB7CgkJCXJldCA9IHdpbmRvdy5pbm5lcldpZHRoOwoJCX0gZWxzZSBpZiAob3B0aW9ucyAmJiBvcHRpb25zLndpZHRoICYmIHR5cGVvZihvcHRpb25zLndpZHRoKSA9PT0gJ3N0cmluZycpIHsKCQkJcmV0ID0gdGhpcy53aWR0aDsKCQl9IGVsc2UgaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy50eXBlID09ICd3aW5kb3cnICYmICFvcHRpb25zLndpZHRoKSB7CgkJCXJldCA9IHRoaXMud2lkdGggKiAwLjk7CgkJfQoKCQkvLyBjb25zb2xlLmxvZyhvcHRpb25zLm5hbWUgKyAiOiBjV2lkdGggPSAiICsgcmV0LCBvcHRpb25zLnpvbmUpOwoJCXJldHVybiByZXQ7Cgl9CgoJd2luZG93KG9wdGlvbnMpIHsKCQlvcHRpb25zLnRpdGxlID0gb3B0aW9ucy50aXRsZSB8fCBvcHRpb25zLm5hbWU7CgkJdmFyIHJldCA9IGAKCQk8ZGl2IGlkID0gInBubCR7b3B0aW9ucy5uYW1lfSIgY2xhc3M9ImVhc3l1aS13aW5kb3ciIHRpdGxlPSIke29wdGlvbnMudGl0bGUgfHwgdGhpcy5lbmdsaXNoKG9wdGlvbnMubmFtZSl9IiBkYXRhLW9wdGlvbnM9JyR7dGhpcy5ldmVudEhhbmRsZXJzKG9wdGlvbnMpfSwgY2xvc2VkOiR7IW9wdGlvbnMudmlzaWJsZX0sbWluaW1pemFibGU6JHshb3B0aW9ucy5maXhlZH0sbWF4aW1pemFibGU6JHshb3B0aW9ucy5maXhlZH0sY2xvc2FibGU6JHshb3B0aW9ucy5maXhlZH0sY29sbGFwc2libGU6JHshb3B0aW9ucy5maXhlZH0sZHJhZ2dhYmxlOiR7IW9wdGlvbnMuZml4ZWR9LHJlc2l6YWJsZTokeyFvcHRpb25zLmZpeGVkfSxpY29uQ2xzOiJpY29uLSR7b3B0aW9ucy5pY29ufSIsIHRvb2xzOiIjJHtvcHRpb25zLm5hbWV9X3Rvb2xzIicgc3R5bGU9IndpZHRoOiR7dGhpcy5jV2lkdGgob3B0aW9ucyl9cHg7aGVpZ2h0OiR7dGhpcy5jSGVpZ2h0KG9wdGlvbnMpfXB4O3BhZGRpbmc6MTBweDsiPgoJCSAgICA8ZGl2IGNsYXNzPSJlYXN5dWktbGF5b3V0IiBkYXRhLW9wdGlvbnM9ImZpdDp0cnVlIj4KCQlgOwoKCQlsZXQgYlpvbmUgPSBvcHRpb25zLnNvdXRoID8gJ3NvdXRoJyA6ICh0aGlzLnpvbmVzLmZpbmQoeiA9PiB6ID09ICdzb3V0aCcpIHx8IHRoaXMuem9uZXNbMF0pOwoJCW9wdGlvbnNbYlpvbmVdID0gb3B0aW9uc1tiWm9uZV0gfHwgW107CgkJbGV0IHpXaWR0aCA9IE1hdGgubWluKDEyMCwgdGhpcy53aWR0aCAqIDAuOTUgLyAob3B0aW9ucy5idXR0b25zID8gb3B0aW9ucy5idXR0b25zLmxlbmd0aCA6IDEpLCB0aGlzLmNXaWR0aChvcHRpb25zKSk7CgkJb3B0aW9uc1tiWm9uZV0ucHVzaChgPGRpdiBpZD0icG5sJHtvcHRpb25zLm5hbWV9LWJ1dHRvbnMiIGRhdGEtb3B0aW9ucz0icmVnaW9uOicke2Jab25lfScsYm9yZGVyOmZhbHNlIiBzdHlsZT0idGV4dC1hbGlnbjpyaWdodDtwYWRkaW5nOjVweCAwIDA7Ij5gICsgJC5tYXAoJC5ncmVwKG9wdGlvbnMuYnV0dG9ucyB8fCBbXSwgYiA9PiAhYi5pZ25vcmUpLCBiID0+IGA8YSBpZD0nJHtiLm5hbWV9JyBocmVmPSJqYXZhc2NyaXB0OnZvaWQoMCkiIGNsYXNzPSJlYXN5dWktbGlua2J1dHRvbiBjNiIgaWNvbkNscz0iaWNvbi0ke2IuaWNvbiB8fCAnc2F2ZSd9IiBzdHlsZT0id2lkdGg6JHt6V2lkdGh9cHgiIG9uY2xpY2s9J0RGb3JtLmRvQ2xpY2soJHtfRnJFTUQuX3RvSlMoYil9KSc+JHtiLnRpdGxlIHx8IGIubmFtZX08L2E+Jm5ic3A7Jm5ic3A7YCkuam9pbignJykgKyBgPC9kaXY+YCk7CgoJCXRoaXMuem9uZXMuZmlsdGVyKHogPT4gb3B0aW9uc1t6XSkuZm9yRWFjaCh6ID0+IHsKCQkJcmV0ICs9IGAKCQkgICAgICAgIDxkaXYgZGF0YS1vcHRpb25zPSJyZWdpb246JyR7en0nIiB0aXRsZT0iJHsoej09J3dlc3QnIHx8IHo9PSdlYXN0Jyk/JyZuYnNwOyc6Jyd9IiBzdHlsZT0naGVpZ2h0OiR7KHo9PSdub3J0aCd8fHo9PSdzb3V0aCcpPzEwOjEwMH0lO3dpZHRoOiR7KCh6PT0nZWFzdCd8fHo9PSd3ZXN0Jyk/MC4xOjEpKnRoaXMuY1dpZHRoKG9wdGlvbnMpfXB4Jz4KICAgICAgICAJCSAgICAkeyhBcnJheS5pc0FycmF5KG9wdGlvbnNbel0pP29wdGlvbnNbel06W29wdGlvbnNbel1dKS5qb2luKCcnKX0KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICBgOwoJCX0pOwoKCQlyZXQgKz0gYDwvZGl2PjwvZGl2PmA7CgoJCS8vIGxpbmtzICh0b29scykKCQlsZXQgbGlua3MgPSAkLmdyZXAoW10uY29uY2F0KG9wdGlvbnMubGlua3MgfHwgW10pLCBsID0+ICFsLmlnbm9yZSk7CgkJcmV0ICs9IGA8ZGl2IGlkPSIke29wdGlvbnMubmFtZX1fdG9vbHMiPmAgKyAkLm1hcChsaW5rcy5yZXZlcnNlKCksIGwgPT4gYDxhIGhyZWY9ImphdmFzY3JpcHQ6dm9pZCgwKSIgc3R5bGU9ImNvbG9yOmJsYWNrIiBjbGFzcz0iZmFzIGZhLSR7bC5pY29uIHx8ICdhZGQnfSIgb25jbGljaz0nKGFzeW5jICgpID0+IHt2YXIgYSA9ICR7X0ZyRU1ELl90b0pTKGwpfTsgJCgiI3BubCR7b3B0aW9ucy5uYW1lfSIpLndpbmRvdygic2V0VGl0bGUiLCAiJHtvcHRpb25zLnRpdGxlfTogIiArIGEubmFtZSk7IGF3YWl0IGEuYWN0aW9uKERGb3JtLmdldCgpLCBhLCAke19GckVNRC5fdG9KUyhvcHRpb25zKX0pOyAkKCIjcG5sJHtvcHRpb25zLm5hbWV9Iikud2luZG93KCJzZXRUaXRsZSIsICIke29wdGlvbnMudGl0bGV9Iik7fSkoKSc+PC9hPmApLmpvaW4oJ1xuJykgKyBgPC9kaXY+YDsKCgkJcmV0dXJuIHJldDsKCX0KCglhc3luYyBfZW5kKCkgewoJCWxldCBvID0gdGhpcy5nZXQoKTsKCgkJLy8gZG8gbm90IHVzZSB0aGUgZmlyc3QgYnV0dG9uLCBiZWNhdXNlIG1hbnkgZm9ybXMgaGF2ZSBhIENhbmNlbCBidXR0b24gb25seQoJCWxldCBidXR0b24gPSB0aGlzLmJ1dHRvbnMuZmluZChiID0+IGIuYXV0b1N1Ym1pdCkgLyogfHwgdGhpcy5idXR0b25zWzBdKi8gOwoJCWlmIChidXR0b24gJiYgbyAmJiBPYmplY3QudmFsdWVzKG8pLmxlbmd0aCAmJiAodHlwZW9mKGJ1dHRvbi5hdXRvU3VibWl0KSA9PT0gInVuZGVmaW5lZCIgfHwgYnV0dG9uLmF1dG9TdWJtaXQpKSB7CgkJCWxldCB2ID0gT2JqZWN0LnZhbHVlcyhvKS5yZWR1Y2UoKHQsIHYpID0+IHsKCQkJCXJldHVybiAoKHR5cGVvZih2KSAhPT0gIm9iamVjdCIpID8gMSA6IDApICogKHYgPyAxIDogMCk7CgkJCX0pOwoJCQkvL2NvbnNvbGUubG9nKG8sIE9iamVjdC52YWx1ZXMobyksIHYpOwoJCQlpZiAodikgewoJCQkJLy8gYWxsIGZpZWxkcyBoYXZlIHZhbHVlcwoJCQkJYXdhaXQgdGhpcy5kb0NsaWNrKGJ1dHRvbik7CgoJCQl9CgkJfQoJfQoKCWZvb3RlcihiRml4ZWQpIHsKCQlyZXR1cm4gYDwvZm9ybT5gICsgYDxkaXYgaWQ9ImRsZy1idXR0b25zIj5gICsgdGhpcy5idXR0b25zLmZpbHRlcihiID0+ICFiLndpbmRvdykubWFwKGIgPT4gYDxhIGlkPScke2IubmFtZX0nIGhyZWY9ImphdmFzY3JpcHQ6dm9pZCgwKSIgY2xhc3M9ImVhc3l1aS1saW5rYnV0dG9uIGM2IiBpY29uQ2xzPSJpY29uLSR7Yi5pY29uIHx8ICdzYXZlJ30iIHN0eWxlPSJ3aWR0aDoke01hdGgubWluKDEyMCwgdGhpcy53aWR0aCAqIDAuOTUgLyB0aGlzLmJ1dHRvbnMubGVuZ3RoLCB0aGlzLmNXaWR0aCgpKX1weCIgb25jbGljaz0nREZvcm0uZG9DbGljaygke19GckVNRC5fdG9KUyhiKX0pJz4ke2IudGl0bGUgfHwgYi5uYW1lfTwvYT4mbmJzcDsmbmJzcDtgKS5qb2luKCcnKSArICI8L2Rpdj4iICsgKGJGaXhlZCA/ICIiIDogJzwvZGl2PicpOwoJfQoKCWhlYWRlcihuYW1lLCB0aXRsZSwgYkZpeGVkLCBsaW5rcykgewoJCXRoaXMudGl0bGUgPSB0aXRsZSB8fCB0aGlzLnRpdGxlOwoJCW5hbWUgPSBuYW1lIHx8IHRoaXMubmFtZTsKCQl2YXIgcmV0ID0gJyc7CgoJCXJldCArPSB0aGlzLndpbmRvdyh7CgkJCW5hbWU6ICJfX0NvbnNvbGUiLAoJCQl0eXBlOiAid2luZG93IiwKCQkJZWRpdG9yOiB0cnVlLAoJCQlsb2FkZXI6IG8gPT4gd2luZG93LmxvZ3Muc2xpY2UoKS5yZXZlcnNlKCkubWFwKGwgPT4gbC5kYXRlLnRvSVNPU3RyaW5nKCkgKyAiOiAiICsgbC5hcmdzLm1hcChzID0+IHR5cGVvZihzKSA9PT0gJ29iamVjdCcgPyAoKG9iaiwgaW5kZW50ID0gMikgPT4gewoJCQkJbGV0IGNhY2hlID0gW107CgkJCQljb25zdCByZXRWYWwgPSBKU09OLnN0cmluZ2lmeSgKCQkJCQlvYmosCgkJCQkJKGtleSwgdmFsdWUpID0+CgkJCQkJdHlwZW9mIHZhbHVlID09PSAib2JqZWN0IiAmJiB2YWx1ZSAhPT0gbnVsbCA/CgkJCQkJY2FjaGUuaW5jbHVkZXModmFsdWUpID8KCQkJCQl1bmRlZmluZWQgLy8gRHVwbGljYXRlIHJlZmVyZW5jZSBmb3VuZCwgZGlzY2FyZCBrZXkKCQkJCQk6CgkJCQkJY2FjaGUucHVzaCh2YWx1ZSkgJiYgdmFsdWUgLy8gU3RvcmUgdmFsdWUgaW4gb3VyIGNvbGxlY3Rpb24KCQkJCQk6CgkJCQkJdmFsdWUsCgkJCQkJaW5kZW50CgkJCQkpOwoJCQkJY2FjaGUgPSBudWxsOwoJCQkJcmV0dXJuIHJldFZhbDsKCQkJfSkocykgOiBzKS5qb2luKCcsICcpKS5qb2luKCdcbicpLAoJCX0pOwoKCQlpZiAoIWJGaXhlZCkgewoJCQlsaW5rcyA9IChsaW5rcyB8fCBbXSkuZmlsdGVyKGwgPT4gIWwuaWdub3JlKTsKCQkJbGV0IHREYXRhID0gIiI7CgkJCWlmIChsaW5rcy5sZW5ndGgpIHsKCQkJCXJldCArPSBgPGRpdiBpZD0iJHt0aGlzLm5hbWV9X3Rvb2xzIj5gICsgbGlua3MubWFwKGwgPT4gYDxhIGhyZWY9ImphdmFzY3JpcHQ6dm9pZCgwKSIgY2xhc3M9Imljb24tJHtsLmljb259IiBvbmNsaWNrPScoYXN5bmMgKCkgPT4ge3ZhciBhID0gJHtfRnJFTUQuX3RvSlMobCl9OyAkKCIjd2luJHt0aGlzLm5hbWV9Iikud2luZG93KCJzZXRUaXRsZSIsICIke3RoaXMudGl0bGV9OiAiICsgYS5uYW1lKTsgYXdhaXQgYS5hY3Rpb24oREZvcm0uZ2V0KCkpOyAkKCIjd2luJHt0aGlzLm5hbWV9Iikud2luZG93KCJzZXRUaXRsZSIsICIke3RoaXMudGl0bGV9Iik7fSkoKSc+PC9hPmApLmpvaW4oJ1xuJykgKyAiPC9kaXY+IjsKCQkJCXREYXRhID0gYCx0b29sczoiIyR7dGhpcy5uYW1lfV90b29scyJgOwoJCQl9CgkJCXJldCArPSBgPGRpdiBpZD0nd2luJHt0aGlzLm5hbWV9JyBjbGFzcz0nZWFzeXVpLXdpbmRvdycgdGl0bGU9JyR7dGhpcy50aXRsZSB8fCB0aGlzLmVuZ2xpc2godGhpcy5uYW1lKX0nIGRhdGEtb3B0aW9ucz0naWNvbkNsczoiaWNvbi1zYXZlIiAke3REYXRhfScgc3R5bGU9J3dpZHRoOiR7dGhpcy53aWR0aH1weDtoZWlnaHQ6JHt0aGlzLmhlaWdodH1weDtwYWRkaW5nOjEwcHg7Jz5gOwoJCX0KCQlyZXR1cm4gcmV0ICsgYDxmb3JtIGlkPSJmcm0ke3RoaXMubmFtZX0iIG1ldGhvZD0icG9zdCIgbm92YWxpZGF0ZT5gOwoJfQoKCXJlbmRlckVsZW1lbnRzKGVsZW1lbnRzKSB7CgkJZWxlbWVudHMgPSBlbGVtZW50cyB8fCB0aGlzLmVsZW1lbnRzOwoKCQl2YXIgdFdpZHRoID0gTWF0aC5mbG9vcih0aGlzLndpZHRoICogMC45NSk7CgkJdmFyIHRIZWlnaHQgPSBNYXRoLmZsb29yKHRoaXMuaGVpZ2h0ICogMC44NSk7CgoJCWxldCByZXQgPSAnJzsKCQl2YXIgZ0VsZW1lbnRzID0gdGhpcy5zcigpLmdyb3VwQnkoZWxlbWVudHMsICJncm91cCIpOwoJCWlmIChnRWxlbWVudHMubGVuZ3RoID4gMSkgcmV0ICs9IGA8ZGl2IGlkPSJ0YmNXaW5kb3ciIGNsYXNzPSJlYXN5dWktdGFicyIgZGF0YS1vcHRpb25zPScke3RoaXMuZXZlbnRIYW5kbGVycyh7dHlwZTogJ3RhYnMnfSl9JyBzdHlsZT0id2lkdGg6JHt0V2lkdGh9cHg7aGVpZ2h0OiR7dEhlaWdodH1weDsiPmA7CgkJZm9yICh2YXIgZyA9IDA7IGcgPCBnRWxlbWVudHMubGVuZ3RoOyBnKyspIHsKCQkJaWYgKGdFbGVtZW50cy5sZW5ndGggPiAxKSByZXQgKz0gJzxkaXYgdGl0bGU9IicgKyAoZ0VsZW1lbnRzW2ddLmtleSB8fCAiTWFpbiIpICsgJyIgc3R5bGU9InBhZGRpbmc6MjBweDtkaXNwbGF5Om5vbmU7Ij4nOwoJCQl2YXIgc0VsZW1lbnRzID0gdGhpcy5zcigpLmdyb3VwQnkoZ0VsZW1lbnRzW2ddLnZhbHVlcywgInNlY3Rpb24iKTsKCQkJaWYgKHNFbGVtZW50cy5sZW5ndGggPiAxKSByZXQgKz0gJzxkaXYgY2xhc3M9ImVhc3l1aS1hY2NvcmRpb24iIHN0eWxlPSJ3aWR0aDonICsgdFdpZHRoICsgJ3B4O2hlaWdodDonICsgLyp0SGVpZ2h0Ki8gIjEwMCUiICsgJ3B4OyI+JzsKCQkJZm9yICh2YXIgcyA9IDA7IHMgPCBzRWxlbWVudHMubGVuZ3RoOyBzKyspIHsKCQkJCXJldCArPSBgPGRpdiB0aXRsZT0iJHtzRWxlbWVudHNbc10ua2V5IHx8ICIifSIgZGF0YS1vcHRpb25zPSJpY29uQ2xzOidpY29uLW1vcmUnIiBzdHlsZT0icGFkZGluZzoxMHB4OyI+YDsKCQkJCWZvciAodmFyIGkgPSAwOyBpIDwgc0VsZW1lbnRzW3NdLnZhbHVlcy5sZW5ndGg7IGkrKykgewoJCQkJCXZhciBlID0gc0VsZW1lbnRzW3NdLnZhbHVlc1tpXTsKCQkJCQlpZiAoZS5pZ25vcmUpIGNvbnRpbnVlOwoJCQkJCWUudmFsdWUgPSBlLnZhbHVlIHx8IF9GckVNRC5oYXNoW2UubmFtZV0gfHwgKF9GckVNRC5hcGlTZXJ2ZXIgPyBfRnJFTUQuYXBpU2VydmVyLl9fY29uZmlnKCd0ZXN0XycgKyBlLm5hbWUsICcnKSA6ICcnKTsKCQkJCQlyZXQgKz0gYDxkaXYgaWQ9ImZFbGVtZW50XyR7ZS5uYW1lfSIgY2xhc3M9ImZpdGVtIiBzdHlsZT0iZGlzcGxheTogJHsoZS50eXBlPT0nd2luZG93JyB8fCBlLmhpZGRlbik/J25vbmUnOicnfSI+YDsKCQkJCQlpZiAoZS50b2dnbGUpIHsKCQkJCQkJcmV0ICs9IGA8YSBocmVmPSIjIiBjbGFzcz0iZWFzeXVpLWxpbmtidXR0b24iIGRhdGEtb3B0aW9ucz0nJHt0aGlzLmV2ZW50SGFuZGxlcnMoe3R5cGU6ICd0b2dnbGUnLCBmb3I6IGV9KX0scGxhaW46dHJ1ZSxpY29uQ2xzOiJpY29uLSR7ZS5pY29uIHx8ICdzZWFyY2gnfSInIHN0eWxlPSJ3aWR0aDoxMDBweDtoZWlnaHQ6MzBweCI+JHtlLnRpdGxlIHx8IHRoaXMuZW5nbGlzaChlLm5hbWUpfTwvYT5gOwoJCQkJCX0gZWxzZSB7CgkJCQkJCXJldCArPSBgPGxhYmVsPiR7ZS50aXRsZSB8fCB0aGlzLmVuZ2xpc2goZS5uYW1lKX06PC9sYWJlbD5gOwoJCQkJCX0KCQkJCQlpZiAoZS50eXBlICYmIHRoaXNbZS50eXBlXSkgewoJCQkJCQlyZXQgKz0gdGhpc1tlLnR5cGVdKGUpOwoJCQkJCX0gZWxzZSBpZiAoZS5yZW5kZXIpIHsKCQkJCQkJcmV0ICs9IGUucmVuZGVyKCk7CgkJCQkJfQoJCQkJCXJldCArPSAnPC9kaXY+JzsKCQkJCX0KCQkJCXJldCArPSAnPC9kaXY+JzsKCQkJfQoJCQlpZiAoc0VsZW1lbnRzLmxlbmd0aCA+IDEpIHJldCArPSAnPC9kaXY+JzsKCQkJaWYgKGdFbGVtZW50cy5sZW5ndGggPiAxKSByZXQgKz0gIjwvZGl2PiI7CgkJfQoJCWlmIChnRWxlbWVudHMubGVuZ3RoID4gMSkgcmV0ICs9ICI8L2Rpdj4iOwoJCXJldHVybiByZXQ7Cgl9CgoJaW5mbyhtc2cpIHsKCQlpZiAoJC5tZXNzYWdlcikgewoJCQkkLm1lc3NhZ2VyLmFsZXJ0KHRoaXMudGl0bGUsIG1zZywgJ2luZm8nKTsKCQl9IGVsc2UgewoJCQl0aGlzLnNyKCkuU2hvd01lc3NhZ2UobXNnLCB0aGlzLnRpdGxlKTsKCQl9Cgl9CgoJZXJyb3IobXNnKSB7CgkJaWYgKCQubWVzc2FnZXIpIHsKCQkJJC5tZXNzYWdlci5hbGVydCh0aGlzLnRpdGxlLCBtc2csICdlcnJvcicpOwoJCX0gZWxzZSB7CgkJCXRoaXMuc3IoKS5TaG93TWVzc2FnZShtc2csIHRoaXMudGl0bGUpOwoJCX0KCX0KCglieU5hbWUobmFtZSkgewoJCXJldHVybiB0aGlzLmVsZW1lbnRzLmZpbmQoZSA9PiBlLm5hbWUgPT09IG5hbWUpOwoJfQoKCS8qKiBDb21wb25lbnRzOjpTdGFydCAqKi8KCUNvcmVDb21wb25lbnQgPSBjbGFzcyB7CgkJY29uc3RydWN0b3IocGFnZSwgZEZvcm0sIG9TY29wZSkgewoJCQl0aGlzLnBhZ2UgPSBwYWdlOwoJCQl0aGlzLmRGb3JtID0gZEZvcm0gfHwgREZvcm07CgkJCXRoaXMub1Njb3BlID0gb1Njb3BlOwoJCX0KCgkJX3NlcnZlcigpIHsKCQkJbGV0IHNjb3BlID0gd2luZG93LmJMb2NhbCA/ICJwbGF0Zm9ybW1hbmFnZXIiIDogX0ZyRU1ELmFwaVNlcnZlci5TY29wZTsKCQkJcmV0dXJuIG5ldyhfRnJFTUQuX19zY29wZShzY29wZSlbX0ZyRU1ELl9fc2NvcGUoc2NvcGUpLkVudGl0eUNsYXNzZXMuZmluZChjID0+IGMuSXNNYWluKS5OYW1lXSkoKTsKCQl9CgoJCV9lYVRvRmllbGQoZWEpIHsKCQkJaWYgKGVhLkVudGl0eVR5cGUpIHJldHVybiB7CgkJCQlncm91cDogZWEuR3JvdXAuTmFtZSwKCQkJCW5hbWU6IGVhLk5hbWUsCgkJCQlfdHlwZTogZWEuRW50aXR5VHlwZS5FbnRpdHlBdHRyaWJ1dGVzLmZpbmQocGVhID0+ICFwZWEuRW50aXR5TWV0aG9kICYmIHBlYS5FbnRpdHlUeXBlID09IGVhLkVudGl0eVR5cGUpID8gJ3RyZWUnIDogJ3NlbGVjdCcsCgkJCQl0eXBlOiAnc2VsZWN0JywKCQkJCXBhcmVudEZpZWxkOiBlYS5FbnRpdHlUeXBlLkVudGl0eUF0dHJpYnV0ZXMuZmluZChwZWEgPT4gIXBlYS5FbnRpdHlNZXRob2QgJiYgcGVhLkVudGl0eVR5cGUgPT0gZWEuRW50aXR5VHlwZSk/Lk5hbWUsCgkJCQkvL2lkRmllbGQ6ICdfVG9TdHJpbmcnLAoJCQkJem9uZTogJ2NlbnRlcicsCgkJCQlDbGFzczogewoJCQkJCU5hbWU6IGVhLkVudGl0eVR5cGUuTmFtZSwKCQkJCQlJZDogZWEuRW50aXR5VHlwZS5JZAoJCQkJfSwKCQkJCXNvdXJjZTogKG8sIGZEYXRhLCBzVGV4dCkgPT4gKHsKCQkJCQlPUEVSQVRPUlM6IHsKCQkJCQkJW2VhLkVudGl0eVR5cGUuRW50aXR5QXR0cmlidXRlcy5maW5kKGVhID0+IGVhLklzU3RyaW5nKS5OYW1lXTogJ2xpa2UnCgkJCQkJfSwKCQkJCQlbZWEuRW50aXR5VHlwZS5FbnRpdHlBdHRyaWJ1dGVzLmZpbmQoZWEgPT4gZWEuSXNTdHJpbmcpLk5hbWVdOiBzVGV4dAoKCQkJCX0pLAoJCQl9OwoJCQlpZiAoZWEuSXNUZXh0KSByZXR1cm4gewoJCQkJZ3JvdXA6IGVhLkdyb3VwLk5hbWUsCgkJCQluYW1lOiBlYS5OYW1lLAoJCQkJdHlwZTogJ3dpbmRvdycsCgkJCQl6b25lOiAnY2VudGVyJywKCQkJCWVkaXRvcjogdHJ1ZSwKCQkJCWxhbmd1YWdlOiBvID0+IGVhLk5hbWUgPT0gJ3NjcmlwdCcgPyAnamF2YXNjcmlwdCcgOiAidGV4dCIsCgkJCX07CgoJCQlyZXR1cm4gewoJCQkJZ3JvdXA6IGVhLkdyb3VwLk5hbWUsCgkJCQluYW1lOiBlYS5OYW1lLAoJCQkJem9uZTogJ2NlbnRlcicsCgkJCQl0eXBlOiBPYmplY3QuZW50cmllcyh7CgkJCQkJQm9vbDogJ2Jvb2wnLAoJCQkJCURhdGU6ICdkYXRldGltZScsCgkJCQkJSW50OiAnaW50JywKCQkJCQlMb25nOiAnbG9uZycsCgkJCQkJSW1hZ2U6ICdpbWFnZScsCgkJCQkJU3RyaW5nOiAnc3RyaW5nJwoJCQkJfSkuZmluZChlID0+IGVhWydJcycgKyBlWzBdXSlbMV0sCgkJCX07CgkJfQoKCQlidXN5KGJCdXN5KSB7CgkJCXJldHVybiB0aGlzLmRGb3JtLmJ1c3koYkJ1c3kpOwoJCX0KCgkJX21lKHYpIHsKCQkJbGV0IG1lTmFtZSA9ICh0eXBlb2YoY29tcGFueSkgIT09ICd1bmRlZmluZWQnKSA/IChjb21wYW55LmxvZ2dlZEluSWRlbnRpdHkgfHwgIm1lIikgOiAibWUiOwoJCQlpZiAodikgewoJCQkJd2luZG93W21lTmFtZV0gPSB2OwoJCQl9CgoJCQlyZXR1cm4gd2luZG93W21lTmFtZV07CgkJfQoKCQlfY2FuVmlldygpIHsKCQkJaWYgKCF0aGlzLl9tZSgpKSB7CgkJCQl3aW5kb3cuX0ZyRU1ELnNldFVSTCh7CgkJCQkJcGFnZTogJ2xvZ2luJywKCQkJCQlfcmVkaXJlY3Q6IHRoaXMucGFnZS5fY29kZSwKCQkJCX0pOwoJCQkJdGhyb3cgYF9jYW5WaWV3OiAke3RoaXMucGFnZS5fY29kZX0gbm90IGFsbG93ZWQgd2l0aG91dCBsb2dpbiFgOwoJCQl9CgkJfQoKCQlfbmFtZSgpIHsKCQkJaWYgKCF0aGlzLl9tZSgpKSByZXR1cm4gIiI7CgkJCXJldHVybiB0aGlzLl9tZSgpLm5hbWUgPyB0aGlzLl9tZSgpLm5hbWUoKSA6IHRoaXMuX21lKCkuVG9TdHJpbmc7CgkJfQoJfQoKCU1haW5Db21wb25lbnQgPSBjbGFzcyBleHRlbmRzIHRoaXMuQ29yZUNvbXBvbmVudCB7CgkJX21lbnVDbGFzc2VzKHNjb3BlKSB7CgkJCWxldCBvU2NvcGUgPSBfRnJFTUQuX19zY29wZShzY29wZSk7CgkJCS8vY29uc29sZS5sb2coIk1haW5Db21wb25lbnQ6Ol9tZW51Q2xhc3NlcygiICsgc2NvcGUgKyAiKTogb1Njb3BlIiwgc2NvcGUsIG9TY29wZSwgX0ZyRU1ELmFwaVNlcnZlcik7CgkJCWlmICghb1Njb3BlKSByZXR1cm4gW107CgoJCQlyZXR1cm4gX0ZyRU1ELnNyKCkuZ3JvdXBCeShvU2NvcGUuRW50aXR5Q2xhc3NlcywgJ0VudGl0eU1vZHVsZScpLm1hcChnID0+ICh7CgkJCQlsYWJlbDogKGcua2V5ID8gdGhpcy5kRm9ybS5lbmdsaXNoKGcua2V5Lk5hbWUpIDogbnVsbCkgfHwgJ01haW4nLAoJCQkJc3ViTWVudXM6IF9GckVNRC5zcigpLmdyb3VwQnkoZy52YWx1ZXMsICdHcm91cCcpLm1hcChndiA9PiAoewoJCQkJCWxhYmVsOiAoZ3Yua2V5ID8gdGhpcy5kRm9ybS5lbmdsaXNoKGd2LmtleS5OYW1lKSA6IG51bGwpIHx8ICdNYWluJywKCQkJCQlzdWJNZW51czogZ3YudmFsdWVzLm1hcChndnYgPT4gKHsKCQkJCQkJbGFiZWw6IHRoaXMuZEZvcm0uZW5nbGlzaChndnYuTmFtZSksCgkJCQkJCWNvZGU6ICdzdG9yZScsCgkJCQkJCWRhdGE6IGd2di5OYW1lCgkJCQkJfSkpCgkJCQl9KSkKCQkJfSkpOwoJCX0KCgkJX21lbnVNZXRob2RzKHNjb3BlKSB7CgkJCWxldCBvU2NvcGUgPSBfRnJFTUQuX19zY29wZShzY29wZSk7CgkJCS8vY29uc29sZS5sb2coIk1haW5Db21wb25lbnQ6Ol9tZW51TWV0aG9kcygiICsgc2NvcGUgKyAiKTogb1Njb3BlIiwgc2NvcGUsIG9TY29wZSwgX0ZyRU1ELmFwaVNlcnZlcik7CgkJCWlmICghb1Njb3BlKSByZXR1cm4gW107CgoJCQlyZXR1cm4gX0ZyRU1ELnNyKCkuZ3JvdXBCeShvU2NvcGUuRW50aXR5Q2xhc3Nlcy5maWx0ZXIoZWMgPT4gZWMuRW50aXR5TWV0aG9kcy5sZW5ndGgpLCAnRW50aXR5TW9kdWxlJykubWFwKGcgPT4gKHsKCQkJCWxhYmVsOiAoZy5rZXkgPyB0aGlzLmRGb3JtLmVuZ2xpc2goZy5rZXkuTmFtZSkgOiBudWxsKSB8fCAnTWFpbicsCgkJCQlzdWJNZW51czogX0ZyRU1ELnNyKCkuZ3JvdXBCeShnLnZhbHVlcywgJ0dyb3VwJykubWFwKGd2ID0+ICh7CgkJCQkJbGFiZWw6IChndi5rZXkgPyB0aGlzLmRGb3JtLmVuZ2xpc2goZ3Yua2V5Lk5hbWUpIDogbnVsbCkgfHwgJ01haW4nLAoJCQkJCXN1Yk1lbnVzOiBndi52YWx1ZXMubWFwKG1jID0+ICh7CgkJCQkJCWxhYmVsOiB0aGlzLmRGb3JtLmVuZ2xpc2gobWMuTmFtZSksCgkJCQkJCXN1Yk1lbnVzOiBtYy5FbnRpdHlNZXRob2RzLm1hcChlbSA9PiAoewoJCQkJCQkJbGFiZWw6IHRoaXMuZEZvcm0uZW5nbGlzaChlbS5OYW1lKSwKCQkJCQkJCWNvZGU6ICdtZXRob2QnLAoJCQkJCQkJZGF0YTogbWMuTmFtZSArICIuIiArIGVtLk5hbWUKCQkJCQkJfSkpCgkJCQkJfSkpCgkJCQl9KSkKCQkJfSkpOwoJCX0KCgkJX2J1aWxkTWVudShzY29wZSkgewoJCQlyZXR1cm4gW3sKCQkJCWxhYmVsOiAiTWFpbiIsCgkJCQlvcmRlcjogLTEsCgkJCQlzdWJNZW51czogW3sKCQkJCQlsYWJlbDogJ0luZGV4JywKCQkJCX0sIHsKCQkJCQlsYWJlbDogIkxvZ2luIiwKCQkJCX0sIHsKCQkJCQlsYWJlbDogIkxvYWQiLAoJCQkJfSwgewoJCQkJCWxhYmVsOiAiU2F2ZSIsCgkJCQl9LCB7CgkJCQkJbGFiZWw6ICJMb2dvdXQiCgkJCQl9XQoJCQl9LCB7CgkJCQlsYWJlbDogIlByb2Nlc3MiLAoJCQkJb3JkZXI6IDk5OTk4LAoJCQkJc3ViTWVudXM6IHRoaXMuX21lbnVNZXRob2RzKHNjb3BlKQoJCQl9LCB7CgkJCQlsYWJlbDogIlNldHVwIiwKCQkJCW9yZGVyOiA5OTk5OSwKCQkJCXN1Yk1lbnVzOiB0aGlzLl9tZW51Q2xhc3NlcyhzY29wZSkKCQkJfV07CgkJfQoJfQoKCUxvYWRDb21wb25lbnQgPSBjbGFzcyBleHRlbmRzIHRoaXMuQ29yZUNvbXBvbmVudCB7CgkJYXN5bmMgbWFpbigpIHsKCQkJdGhpcy5wYWdlLmRhdGEgPSB7CgkJCQlmb3JtOiB0aGlzLmRGb3JtLnJlbmRlcignZnJtTG9hZCcsICJMb2FkIFNldHVwIERhdGEiLCBbewoJCQkJCW5hbWU6ICdFeGNlbCcsCgkJCQkJdHlwZTogImZpbGUiLAoJCQkJCWJpbmFyeTogdHJ1ZSwKCQkJCQlsb2NhbDogdHJ1ZSwKCQkJCQl1cGxvYWQ6IGFzeW5jIChmRGF0YSwgZGF0YSkgPT4gewoJCQkJCQl0aGlzLmRGb3JtLnNldCh7CgkJCQkJCQlQcm9ncmVzczogMAoJCQkJCQl9KTsKCgkJCQkJCWxldCB0YWJsZXMgPSBbXTsKCQkJCQkJbGV0IG9iaiA9IFtdOwoKCQkJCQkJbGV0IHNlcnZlciA9IHRoaXMuX3NlcnZlcigpOwoKCQkJCQkJY29uc3Qgd2IgPSBuZXcgRXhjZWxKUy5Xb3JrYm9vaygpOwoJCQkJCQljb25zb2xlLmNsZWFyKCk7CgkJCQkJCWxldCB3b3JrYm9vayA9IGF3YWl0IHdiLnhsc3gubG9hZChkYXRhKTsKCQkJCQkJd29ya2Jvb2suZWFjaFNoZWV0KChzaGVldCwgaWQpID0+IHsKCQkJCQkJCWxldCBzVGFibGVzID0gc2hlZXQuZ2V0VGFibGVzKCk7CgkJCQkJCQlzVGFibGVzLmZvckVhY2godCA9PiB0LnRhYmxlLnNoZWV0ID0gc2hlZXQpOwoJCQkJCQkJdGFibGVzLnB1c2goLi4uc1RhYmxlcyk7CgkJCQkJCX0pOwoJCQkJCQl0YWJsZXMgPSB0YWJsZXMuZmxhdCgpLm1hcCh0ID0+IHQudGFibGUpOwoKCQkJCQkJLy9jb25zb2xlLmNsZWFyKCk7CgkJCQkJCXRhYmxlcy5mb3JFYWNoKHQgPT4gewoJCQkJCQkJLy9jb25zb2xlLmxvZyh0Lm5hbWUsIHQuY29sdW1ucywgdC5zaGVldC5nZXRDZWxsKCdBMicpLnZhbHVlKTsKCQkJCQkJCWZvciAodmFyIGkgPSAyOyB0LnNoZWV0LmdldENlbGwoJ0EnICsgaSkudmFsdWUgIT09IG51bGw7IGkrKykgewoJCQkJCQkJCW9iai5wdXNoKHNlcnZlci5fbmV3KHQubmFtZSkuX2Zyb21Eb2N1bWVudChPYmplY3QuYXNzaWduKC4uLnQuY29sdW1ucy5tYXAoKGMsIGNpKSA9PiAoewoJCQkJCQkJCQlbYy5uYW1lXTogdC5zaGVldC5nZXRDZWxsKFN0cmluZy5mcm9tQ2hhckNvZGUoJ0EnLmNoYXJDb2RlQXQoMCkgKyBjaSkgKyBpKS52YWx1ZQoJCQkJCQkJCX0pKSkpKTsKCQkJCQkJCX0KCQkJCQkJfSk7CgoJCQkJCQlmb3IgYXdhaXQgKGNvbnN0IG8gb2Ygb2JqKSB7CgkJCQkJCQkvL2F3YWl0IF9GckVNRC5fd2FpdCgxMDAwKQoJCQkJCQkJYXdhaXQgby5zdG9yZSgpOwoJCQkJCQkJdGhpcy5kRm9ybS5zZXQoewoJCQkJCQkJCVByb2dyZXNzOiB0aGlzLmRGb3JtLmdldCgpLlByb2dyZXNzICsgMTAwLjAgLyBvYmoubGVuZ3RoCgkJCQkJCQl9KTsKCQkJCQkJfQoKCQkJCQkJX0ZyRU1ELlJlbmRlclBhZ2UoewoJCQkJCQkJX2NvZGU6ICdsb2dpbicKCQkJCQkJfSk7CgkJCQkJfQoJCQkJfSwgewoJCQkJCW5hbWU6ICJQcm9ncmVzcyIsCgkJCQkJdHlwZTogInByb2dyZXNzIiwKCQkJCX1dLCBbewoJCQkJCW5hbWU6ICdMb2FkJywKCQkJCQlvbmNsaWNrOiBhc3luYyBvID0+IHt9CgkJCQl9XSkKCQkJfTsKCQl9Cgl9CgoJU2F2ZUNvbXBvbmVudCA9IGNsYXNzIGV4dGVuZHMgdGhpcy5Db3JlQ29tcG9uZW50IHsKCQlhc3luYyBtYWluKCkgewoJCQkvL3RoaXMuX2NhblZpZXcoKTsKCgkJCXRoaXMucGFnZS5kYXRhID0gewoJCQkJZm9ybTogdGhpcy5kRm9ybS5yZW5kZXIoJ2ZybVNhdmUnLCAiU2F2ZSBTZXR1cCBEYXRhIiwgW3sKCQkJCQluYW1lOiAnU2F2ZScsCgkJCQkJdHlwZTogImxhYmVsIiwKCQkJCQl2YWx1ZTogIkV4cG9ydCB0byBFeGNlbCIsCgkJCQl9LCB7CgkJCQkJbmFtZTogJ1RpdGxlJywKCQkJCQl0eXBlOiAnc3RyaW5nJywKCQkJCQl2YWx1ZTogJycsCgkJCQl9LCB7CgkJCQkJbmFtZTogIlByb2dyZXNzIiwKCQkJCQl0eXBlOiAicHJvZ3Jlc3MiLAoJCQkJfV0sIFt7CgkJCQkJbmFtZTogJ1NhdmUnLAoJCQkJCW9uY2xpY2s6IGFzeW5jIG8gPT4gewoJCQkJCQljb25zb2xlLmNsZWFyKCk7CgoJCQkJCQl0aGlzLmRGb3JtLnNldCh7CgkJCQkJCQlQcm9ncmVzczogMAoJCQkJCQl9KTsKCgkJCQkJCWxldCBzZXJ2ZXIgPSB0aGlzLl9zZXJ2ZXIoKTsKCgkJCQkJCWxldCB0VGVtcGxhdGUgPSB7CgkJCQkJCQloZWFkZXJSb3c6IHRydWUsCgkJCQkJCQlzdHlsZTogewoJCQkJCQkJCXRoZW1lOiAnVGFibGVTdHlsZURhcmszJywKCQkJCQkJCQlzaG93Um93U3RyaXBlczogdHJ1ZSwKCQkJCQkJCX0sCgkJCQkJCX07CgkJCQkJCWxldCB0YWJsZXMgPSBbXTsKCQkJCQkJZm9yIGF3YWl0IChjb25zdCBjIG9mIF9GckVNRC5fX3Njb3BlKHNlcnZlci5TY29wZSkuRW50aXR5Q2xhc3Nlcy5zb3J0KChhLCBiKSA9PiBhLlJhbmsgLSBiLlJhbmspKSB7CgkJCQkJCQkvL2NvbnNvbGUubG9nKCJEeW5hRm9ybTo6U2F2ZUNvbXBvbmVudCgpOiAiICsgYy5OYW1lICsgIiwgUmFuaz0iICsgYy5SYW5rKTsKCQkJCQkJCXRhYmxlcy5wdXNoKE9iamVjdC5hc3NpZ24oSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSh0VGVtcGxhdGUpKSwgYXdhaXQgc2VydmVyLl9uZXcoYy5OYW1lKS5fdG9UYWJ1bGFyKCkpKTsKCQkJCQkJCXRoaXMuZEZvcm0uc2V0KHsKCQkJCQkJCQlQcm9ncmVzczogdGhpcy5kRm9ybS5nZXQoKS5Qcm9ncmVzcyArIDEwMC4wIC8gX0ZyRU1ELl9fc2NvcGUoc2VydmVyLlNjb3BlKS5FbnRpdHlDbGFzc2VzLmxlbmd0aAoJCQkJCQkJfSk7CgkJCQkJCX0KCQkJCQkJdGFibGVzLmZvckVhY2godCA9PiB0LnJlZiA9ICdBMTonICsgU3RyaW5nLmZyb21DaGFyQ29kZSgnQScuY2hhckNvZGVBdCgwKSArIHQuY29sdW1ucy5sZW5ndGggLSAxKSArICh0LnJvd3MubGVuZ3RoICsgMSkpOwoKCQkJCQkJbGV0IHJnYiA9IChsZXR0ZXJzID0gJzAxMjM0NTY3ODlBQkNERUYnKSA9PiBBcnJheSg2KS5tYXAoaSA9PiBsZXR0ZXJzW01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDE2KV0pLmpvaW4oJycpOwoKCQkJCQkJY29uc3Qgd29ya2Jvb2sgPSBuZXcgRXhjZWxKUy5Xb3JrYm9vaygpOwoJCQkJCQl0YWJsZXMuZm9yRWFjaCh0ID0+IHdvcmtib29rLmFkZFdvcmtzaGVldCh0Lm5hbWUsIHsKCQkJCQkJCXByb3BlcnRpZXM6IHsKCQkJCQkJCQl0YWJDb2xvcjogewoJCQkJCQkJCQlhcmdiOiAnRicgKyByZ2IoKQoJCQkJCQkJCX0KCQkJCQkJCX0KCQkJCQkJfSkuYWRkVGFibGUodCkpOwoKCQkJCQkJbGV0IGJ1ZmZlciA9IGF3YWl0IHdvcmtib29rLnhsc3gud3JpdGVCdWZmZXIoewoJCQkJCQkJZGF0ZUZvcm1hdDogJ1lZWVktTU0tREQgSEg6bW06c3MnCgkJCQkJCX0pOwoKCQkJCQkJY29uc3QgbGluayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTsKCQkJCQkJbGluay5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwoJCQkJCQlkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGxpbmspOwoJCQkJCQlsaW5rLmhyZWYgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKG5ldyBCbG9iKFtidWZmZXJdLCB7CgkJCQkJCQl0eXBlOiAnYXBwbGljYXRpb24vdm5kLm9wZW54bWxmb3JtYXRzLW9mZmljZWRvY3VtZW50LnNwcmVhZHNoZWV0bWwuc2hlZXQ7Y2hhcnNldD1VVEYtOCcKCQkJCQkJfSkpOwoJCQkJCQlsaW5rLmRvd25sb2FkID0gKG8uVGl0bGUgfHwgc2VydmVyLlNjb3BlIHx8ICJkYXRhIikgKyAiLnhsc3giOwoJCQkJCQlsaW5rLmNsaWNrKCk7CgkJCQkJfQoJCQkJfV0pCgkJCX07CgkJfQoJfQoKCUluZGV4Q29tcG9uZW50ID0gY2xhc3MgZXh0ZW5kcyB0aGlzLkNvcmVDb21wb25lbnQgewoJCWFzeW5jIG1haW4oKSB7CgkJCXRoaXMuX2NhblZpZXcoKTsKCgkJCXRoaXMucGFnZS5kYXRhID0gewoJCQkJZm9ybTogdGhpcy5kRm9ybS5yZW5kZXIoJ2ZybUluZGV4JywgIk1haW4gUGFnZSIsIFt7CgkJCQkJbmFtZTogJ1dlbGNvbWUnLAoJCQkJCXJlcXVpcmVkOiB0cnVlLAoJCQkJCXR5cGU6ICJsYWJlbCIsCgkJCQkJdmFsdWU6IHRoaXMuX25hbWUoKSwKCQkJCX1dLCBbXSkKCQkJfTsKCQl9Cgl9CgoJTG9nb3V0Q29tcG9uZW50ID0gY2xhc3MgZXh0ZW5kcyB0aGlzLkNvcmVDb21wb25lbnQgewoJCW1haW4oKSB7CgkJCXRoaXMuX2NhblZpZXcoKTsKCgkJCWRlbGV0ZSB3aW5kb3cubWU7CgoJCQl0aGlzLnBhZ2UuZGF0YSA9IHsKCQkJCWZvcm06IHRoaXMuZEZvcm0ucmVuZGVyKCdmcm1Mb2dvdXQnLCAiTG9nb3V0IiwgW3sKCQkJCQkJbmFtZTogIkxvZ291dCIsCgkJCQkJCXR5cGU6ICJsYWJlbCIsCgkJCQkJCXZhbHVlOiAibG9nb3V0IGluIHByb2dyZXNzLi4uIgoJCQkJCX1dLAoJCQkJCVtdKQoJCQl9OwoKCQkJX0ZyRU1ELlJlbmRlclBhZ2UoewoJCQkJX2NvZGU6ICJsb2dpbiIKCQkJfSk7CgkJfQoJfQoKCUxvZ2luQ29tcG9uZW50ID0gY2xhc3MgZXh0ZW5kcyB0aGlzLkNvcmVDb21wb25lbnQgewoJCWFzeW5jIF9hdXRoZW50aWNhdGUobykgewoJCQkvL2lmICghd2luZG93LmJMb2NhbCAmJiAoIV9GckVNRC5fX3Njb3BlKCkgfHwgIV9GckVNRC5fX3Njb3BlKCkuRW50aXR5Q2xhc3NlcykpIHJldHVybjsKCgkJCWxldCBhdXRoQ2xhc3NOYW1lID0gX0ZyRU1ELl9fc2NvcGUoKT8uRW50aXR5Q2xhc3Nlcz8uZmluZChjID0+IGMuRW50aXR5QXR0cmlidXRlcy5maW5kKGVhID0+IGVhLk5hbWUgPT0gJ3VzZXJuYW1lJykpPy5OYW1lOwoJCQlpZiAoX0ZyRU1ELmFwaVNlcnZlciAmJiBhdXRoQ2xhc3NOYW1lKSByZXR1cm4gYXdhaXQgX0ZyRU1ELmFwaVNlcnZlci5fbmV3KGF1dGhDbGFzc05hbWUpLnVzZXJuYW1lKG8uVXNlcm5hbWUsICc9JykucGFzc3dvcmQoby5QYXNzd29yZCwgJz0nKS5hY3RpdmUodHJ1ZSkuZW5hYmxlZCh0cnVlKS5maW5kKCk7CgoJCQlhdXRoQ2xhc3NOYW1lID0gYXV0aENsYXNzTmFtZSB8fCAod2luZG93LmJMb2NhbCA/ICh7CgkJCQljbXM6ICJBdXRob3IiLAoJCQkJZW1zOiAiRW1wbG95ZWUiCgkJCX0pW2NvbXBhbnkuQ29kZV0gOiBudWxsKTsKCgkJCW8uT1BFUkFUT1JTID0gewoJCQkJVXNlcm5hbWU6ICI9IiwKCQkJCVBhc3N3b3JkOiAiPSIKCQkJfTsKCgkJCWlmIChhdXRoQ2xhc3NOYW1lKSByZXR1cm4gKGF3YWl0IHNyLl8oImVtcyIgKyBhdXRoQ2xhc3NOYW1lICsgIkZpbmQiLCBudWxsLCBvKSk7CgkJfQoKCQlhc3luYyBfbG9nZ2VkSW4oKSB7fQoKCQlhc3luYyBfbm90TG9nZ2VkSW4oKSB7fQoKCQlhc3luYyBtYWluKCkgewoJCQl0aGlzLnBhZ2UuZGF0YSA9IHsKCQkJCWZvcm06IHRoaXMuZEZvcm0ucmVuZGVyKCdmcm1Mb2dpbicsICJVc2VyIEF1dGhlbnRpY2F0aW9uIiwgW3sKCQkJCQkJbmFtZTogJ1VzZXJuYW1lJywKCQkJCQkJcmVxdWlyZWQ6IHRydWUsCgkJCQkJCXR5cGU6ICJzdHJpbmciCgkJCQkJfSwKCQkJCQl7CgkJCQkJCW5hbWU6ICdQYXNzd29yZCcsCgkJCQkJCXJlcXVpcmVkOiB0cnVlLAoJCQkJCQl0eXBlOiAicGFzc3dvcmQiCgkJCQkJfQoJCQkJXSwgW3sKCQkJCQluYW1lOiAnTG9naW4nLAoJCQkJCWF1dG9TdWJtaXQ6IHRydWUsCgkJCQkJb25jbGljazogYXN5bmMgbyA9PiB7CgkJCQkJCWxldCByZXQgPSBhd2FpdCB0aGlzLl9hdXRoZW50aWNhdGUobyk7CgoJCQkJCQlpZiAocmV0KSB7CgkJCQkJCQl0aGlzLl9tZShyZXQpOwoKCQkJCQkJCXRyeSB7CgkJCQkJCQkJYXdhaXQgdGhpcy5fbG9nZ2VkSW4oKTsKCQkJCQkJCX0gY2F0Y2ggKGV4KSB7fQoKCQkJCQkJCV9GckVNRC5zZXRVUkwoewoJCQkJCQkJCXBhZ2U6IF9GckVNRC5oYXNoLl9yZWRpcmVjdCB8fCAiaW5kZXgiCgkJCQkJCQl9KTsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCXRyeSB7CgkJCQkJCQkJYXdhaXQgdGhpcy5fbm90TG9nZ2VkSW4oKTsKCQkJCQkJCX0gY2F0Y2ggKGV4KSB7fQoKCQkJCQkJCXRoaXMuZEZvcm0uZXJyb3IoIkludmFsaWQgdXNlcm5hbWUgb3IgcGFzc3dvcmQiKTsKCQkJCQkJfQoKCQkJCQkJdGhpcy5kRm9ybS5idXN5KGZhbHNlKTsKCQkJCQl9CgkJCQl9XSkKCQkJfTsKCQl9Cgl9CgoJTWV0aG9kQ29tcG9uZW50ID0gY2xhc3MgZXh0ZW5kcyB0aGlzLkNvcmVDb21wb25lbnQgewoJCWFzeW5jIG1haW4oKSB7CgkJCXRoaXMuX2NhblZpZXcoKTsKCgkJCXRoaXMuc01ldGhvZCA9IHRoaXMucGFnZS5kYXRhOwoJCQljb25zb2xlLmNsZWFyKCk7CgoJCQlsZXQgZW0gPSAoX0ZyRU1ELl9fc2NvcGUoKSB8fCB0aGlzLm9TY29wZSkuRW50aXR5Q2xhc3Nlcy5maW5kKGMgPT4gYy5OYW1lID09IHRoaXMuc01ldGhvZC5zcGxpdCgnLicpWzBdKS5FbnRpdHlNZXRob2RzLmZpbmQobSA9PiBtLk5hbWUgPT0gdGhpcy5zTWV0aG9kLnNwbGl0KCcuJylbMV0pOwoKCQkJdGhpcy5wYWdlLmRhdGEgPSB7CgkJCQlmb3JtOiB0aGlzLmRGb3JtLnJlbmRlcih0aGlzLnNNZXRob2QsIF9GckVNRC5fdGl0bGVDYXNlKHRoaXMuc01ldGhvZC5zcGxpdCgnLicpWzBdKSArICcgOjogJyArIF9GckVNRC5fdGl0bGVDYXNlKHRoaXMuc01ldGhvZC5zcGxpdCgnLicpWzFdKSwgZW0uTWV0aG9kUGFyYW1ldGVycy5tYXAocCA9PiB0aGlzLl9lYVRvRmllbGQocCkpLCBbewoJCQkJCW5hbWU6ICdSZXNldCcsCgkJCQkJb25jbGljazogbyA9PiB7CgkJCQkJCXRoaXMuZEZvcm0uY2xlYXIoKTsKCQkJCQl9LAoJCQkJCWljb246ICJjYW5jZWwiCgkJCQl9LCB7CgkJCQkJbmFtZTogJ1JlbG9hZCcsCgkJCQkJb25jbGljazogbyA9PiBfRnJFTUQuUmVuZGVyUGFnZSh7CgkJCQkJCV9jb2RlOiAnc3RvcmUnCgkJCQkJfSwgdGhpcy5zVGFibGUpLAoJCQkJCWljb246ICJyZWxvYWQiCgkJCQl9LCB7CgkJCQkJbmFtZTogJ1NhdmUnLAoJCQkJCW9uY2xpY2s6IGFzeW5jIG8gPT4gewoJCQkJCQlsZXQgb2JqID0gX0ZyRU1ELmFwaVNlcnZlci5fbmV3KHRoaXMuc1RhYmxlKTsKCQkJCQkJLy9jb25zb2xlLmxvZygib25jbGljaygpIiwgdGhpcy5zVGFibGUsIG9iaiwgbywgb1t0aGlzLnNUYWJsZV0pOwoJCQkJCQlpZiAob1t0aGlzLnNUYWJsZV0gJiYgdHlwZW9mKG9bdGhpcy5zVGFibGVdLl9fc3luY19vbikgPT09ICdmdW5jdGlvbicgJiYgb1t0aGlzLnNUYWJsZV0uX19zeW5jX29uKCkpIG9iai5JZCA9IG9bdGhpcy5zVGFibGVdLklkOwoKCQkJCQkJZWMuRW50aXR5QXR0cmlidXRlcy5maWx0ZXIoZWEgPT4gIWVhLkVudGl0eU1ldGhvZCkuZm9yRWFjaChlYSA9PiBvYmpbZWEuTmFtZV0ob1tlYS5OYW1lXSkpOwoJCQkJCQkvL3JldHVybiBjb25zb2xlLmxvZyhvYmouX3RvRmlsZU5hbWUoKSwgb2JqKTsKCQkJCQkJYXdhaXQgb2JqLnN0b3JlKCk7CgkJCQkJfQoJCQkJfV0pCgkJCX07CgkJfQoJfQoKCVN0b3JlQ29tcG9uZW50ID0gY2xhc3MgZXh0ZW5kcyB0aGlzLkNvcmVDb21wb25lbnQgewoJCWFzeW5jIG1haW4oKSB7CgkJCXRoaXMuX2NhblZpZXcoKTsKCgkJCXRoaXMuc1RhYmxlID0gdGhpcy5wYWdlLmRhdGE7CgkJCWNvbnNvbGUuY2xlYXIoKTsKCgkJCS8vY29uc29sZS5sb2coIkR5bmFGb3JtOjpTdG9yZUNvbXBvbmVudCgpOiBzVGFibGUiLCB0aGlzLnNUYWJsZSk7CgoJCQlsZXQgZWMgPSBfRnJFTUQuX19zY29wZSgpLkVudGl0eUNsYXNzZXMuZmluZChjID0+IGMuTmFtZSA9PSB0aGlzLnNUYWJsZSk7CgoJCQl0aGlzLnBhZ2UuZGF0YSA9IHsKCQkJCWZvcm06IHRoaXMuZEZvcm0ucmVuZGVyKGVjLk5hbWUucmVwbGFjZSgvXCAvZywgJ18nKSwgX0ZyRU1ELl90aXRsZUNhc2UoZWMuTmFtZSksIFt7CgkJCQkJbmFtZTogZWMuTmFtZS5yZXBsYWNlKC9cIC9nLCAnXycpLAoJCQkJCXRpdGxlOiBfRnJFTUQuX3RpdGxlQ2FzZShlYy5OYW1lKSwKCQkJCQlDbGFzczogewoJCQkJCQlOYW1lOiBlYy5OYW1lLAoJCQkJCQlJZDogZWMuSWQKCQkJCQl9LAoJCQkJCXpvbmU6ICdub3J0aCcsCgkJCQkJdHlwZTogZWMuRW50aXR5QXR0cmlidXRlcy5maW5kKHBlYSA9PiAhcGVhLkVudGl0eU1ldGhvZCAmJiBwZWEuRW50aXR5VHlwZSA9PSBlYykgPyAndHJlZScgOiAnc2VsZWN0JywKCQkJCQlwYXJlbnRGaWVsZDogZWMuRW50aXR5QXR0cmlidXRlcy5maW5kKHBlYSA9PiAhcGVhLkVudGl0eU1ldGhvZCAmJiBwZWEuRW50aXR5VHlwZSA9PSBlYyk/Lk5hbWUsCgkJCQkJLy9zZWFyY2hGaWVsZDogZWMuRW50aXR5QXR0cmlidXRlcy5maW5kKGVhID0+IGVhLklzU3RyaW5nKS5OYW1lLAoJCQkJCS8vaWRGaWVsZDogJ19Ub1N0cmluZycsCgkJCQkJc291cmNlOiAobywgZkRhdGEsIHNUZXh0KSA9PiAoewoJCQkJCQlPUEVSQVRPUlM6IHsKCQkJCQkJCVtlYy5FbnRpdHlBdHRyaWJ1dGVzLmZpbmQoZWEgPT4gZWEuSXNTdHJpbmcpLk5hbWVdOiAnbGlrZScKCQkJCQkJfSwKCQkJCQkJW2VjLkVudGl0eUF0dHJpYnV0ZXMuZmluZChlYSA9PiBlYS5Jc1N0cmluZykuTmFtZV06IHNUZXh0CgoJCQkJCX0pLAoJCQkJCXNlbGVjdDogYXN5bmMgbyA9PiB7CgkJCQkJCXRoaXMuZEZvcm0uY2xlYXIoKTsKCQkJCQkJdGhpcy5kRm9ybS5idXN5KHRydWUpOwoKCQkJCQkJbGV0IHIgPSBhd2FpdCBvLmZpbmQoKTsKCQkJCQkJdGhpcy5kRm9ybS5zZXQoT2JqZWN0LmFzc2lnbih7CgkJCQkJCQlbZWMuTmFtZS5yZXBsYWNlKC9cIC9nLCAnXycpXTogcgoJCQkJCQl9LCAuLi5lYy5FbnRpdHlBdHRyaWJ1dGVzLmZpbHRlcihlYSA9PiAhZWEuRW50aXR5TWV0aG9kKS5maWx0ZXIoZWEgPT4gdHlwZW9mKHJbZWEuTmFtZV0oKSkgIT09ICd1bmRlZmluZWQnKS5tYXAoZWEgPT4gKHsKCQkJCQkJCVtlYS5OYW1lXTogcltlYS5OYW1lXSgpCgkJCQkJCX0pKSkpOwoJCQkJCQl0aGlzLmRGb3JtLmJ1c3koZmFsc2UpOwoJCQkJCX0KCQkJCX1dLmNvbmNhdCguLi5lYy5FbnRpdHlBdHRyaWJ1dGVzLmZpbHRlcihlYSA9PiAhZWEuRW50aXR5TWV0aG9kKS5tYXAoZWEgPT4gdGhpcy5fZWFUb0ZpZWxkKGVhKSkpLCBbewoJCQkJCW5hbWU6ICdSZXNldCcsCgkJCQkJb25jbGljazogbyA9PiB7CgkJCQkJCXRoaXMuZEZvcm0uY2xlYXIoKTsKCQkJCQl9LAoJCQkJCWljb246ICJjYW5jZWwiCgkJCQl9LCB7CgkJCQkJbmFtZTogJ1JlbG9hZCcsCgkJCQkJb25jbGljazogbyA9PiBfRnJFTUQuUmVuZGVyUGFnZSh7CgkJCQkJCV9jb2RlOiAnc3RvcmUnCgkJCQkJfSwgdGhpcy5zVGFibGUpLAoJCQkJCWljb246ICJyZWxvYWQiCgkJCQl9LCB7CgkJCQkJbmFtZTogJ1NhdmUnLAoJCQkJCW9uY2xpY2s6IGFzeW5jIG8gPT4gewoJCQkJCQlsZXQgb2JqID0gX0ZyRU1ELmFwaVNlcnZlci5fbmV3KHRoaXMuc1RhYmxlKTsKCQkJCQkJLy9jb25zb2xlLmxvZygib25jbGljaygpIiwgdGhpcy5zVGFibGUsIG9iaiwgbywgb1t0aGlzLnNUYWJsZV0pOwoJCQkJCQlpZiAob1t0aGlzLnNUYWJsZV0gJiYgdHlwZW9mKG9bdGhpcy5zVGFibGVdLl9fc3luY19vbikgPT09ICdmdW5jdGlvbicgJiYgb1t0aGlzLnNUYWJsZV0uX19zeW5jX29uKCkpIG9iai5JZCA9IG9bdGhpcy5zVGFibGVdLklkOwoKCQkJCQkJZWMuRW50aXR5QXR0cmlidXRlcy5maWx0ZXIoZWEgPT4gIWVhLkVudGl0eU1ldGhvZCkuZm9yRWFjaChlYSA9PiBvYmpbZWEuTmFtZV0ob1tlYS5OYW1lXSkpOwoJCQkJCQkvL3JldHVybiBjb25zb2xlLmxvZyhvYmouX3RvRmlsZU5hbWUoKSwgb2JqKTsKCQkJCQkJYXdhaXQgb2JqLnN0b3JlKCk7CgkJCQkJfQoJCQkJfV0pCgkJCX07CgkJfQoJfQoJLyoqIENvbXBvbmVudHM6OkVuZCAqKi8KfTs=",
	"storedMethod": null,
	"__keys": ["name"],
	"active": true,
	"enabled": true,
	"__trMap": []
}