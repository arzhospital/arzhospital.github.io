{
	"Id": "dfe6fe6045c83cc6f686b4ea7f113661ebf0bc67",
	"after": null,
	"async": null,
	"before": null,
	"date": "undefined",
	"name": "DynaForm",
	"order": null,
	"remark": "dW5kZWZpbmVk",
	"script": "d2luZG93LkR5bmFGb3JtID0gY2xhc3MgewoJY29uc3RydWN0b3IoKSB7CgkJdGhpcy50aXRsZSA9ICJGb3JtIFRpdGxlIjsKCQl0aGlzLm5hbWUgPSAiZnJtRm9ybSI7CgkJdGhpcy5lbGVtZW50cyA9IFtdOwoJCXRoaXMuc2VsZWN0cyA9IFtdOwoJCXRoaXMuZ3JpZHMgPSBbXTsKCQl0aGlzLmJ1dHRvbnMgPSBbXTsKCQl0aGlzLnpvbmVzID0gWydub3J0aCcsICdzb3V0aCcsICdlYXN0JywgJ3dlc3QnLCAnY2VudGVyJ107CgkJdGhpcy5zVGFibGUgPSBudWxsOwoJCXRoaXMuYkRlYnVnID0gZmFsc2U7CgkJdGhpcy51aVR5cGVzID0gewoJCQlpbnQ6ICJudW1iZXJzcGlubmVyIiwKCQkJbWVudTogInNwbGl0YnV0dG9uIiwKCQkJZGF0ZXRpbWU6ICJkYXRldGltZWJveCIsCgkJCWJvb2w6ICJzd2l0Y2hidXR0b24iLAoJCQlmaWxlOiAiZmlsZWJveCIsCgkJCXRleHQ6ICJ0ZXh0Ym94IiwKCQkJbGFiZWw6ICJodG1sIiwKCQkJcGFzc3dvcmQ6ICJwYXNzd29yZGJveCIsCgkJCXN0cmluZzogInRleHRib3giLAoJCQlpbWFnZTogImRpYWxvZyIsCgkJCXByb2dyZXNzOiAicHJvZ3Jlc3NiYXIiLAoJCQlsaW5rOiAibGlua2J1dHRvbiIsCgkJCXRyZWU6ICJjb21ib3RyZWUiLAoJCQluYXZpZ2F0aW9uOiAidHJlZSIsCgkJCXNlYXJjaDogJ3NlYXJjaGJveCcsCgkJfTsKCQl0aGlzLmV2ZW50cyA9IFt7CgkJCW5hbWU6ICdvbkNsaWNrJywKCQkJaGFuZGxlcjogJ29uVG9nZ2xlJywKCQkJcGFyYW1zOiAnbj1ldmVudCcsCgkJCXR5cGU6ICd0b2dnbGUnLAoJCX0sIHsKCQkJbmFtZTogJ29uQ2xvc2UnLAoJCQloYW5kbGVyOiAnUGFuT25DbG9zZScsCgkJCXBhcmFtczogJ249ZXZlbnQnLAoJCQl0eXBlOiAnd2luZG93JywKCQl9LCB7CgkJCW5hbWU6ICdvblNlbGVjdCcsCgkJCWhhbmRsZXI6ICdTZWxlY3RDaGFuZ2UnLAoJCQlwYXJhbXM6ICduJywKCQkJdHlwZTogJ3RhYnMnLAoJCX0sIHsKCQkJbmFtZTogJ3NlYXJjaGVyJywKCQkJaGFuZGxlcjogJ0ZpZWxkQ2hhbmdlJywKCQkJcGFyYW1zOiAnbiwgbycsCgkJCXR5cGU6ICdzZWFyY2hib3gnLAoJCX0sIHsKCQkJbmFtZTogJ29uQmVmb3JlRXhwYW5kJywKCQkJaGFuZGxlcjogJ0V4cGFuZCcsCgkJCXBhcmFtczogJ24nLAoJCQl0eXBlOiAndHJlZScsCgkJfSwgewoJCQluYW1lOiAnb25DaGFuZ2UnLAoJCQloYW5kbGVyOiAnRmllbGRDaGFuZ2UnLAoJCQlwYXJhbXM6ICduLCBvJywKCQl9LCB7CgkJCW5hbWU6ICdvbkJlZm9yZU9wZW4nLAoJCQloYW5kbGVyOiAnUGFuZWxPcGVuJywKCQkJcGFyYW1zOiAnJywKCQkJdHlwZTogJ3dpbmRvdycsCgkJfSwgewoJCQluYW1lOiAnb25PcGVuJywKCQkJaGFuZGxlcjogJ1BlbmRBZnRlck9wZW4nLAoJCQlwYXJhbXM6ICcnLAoJCQl0eXBlOiAnd2luZG93JywKCQl9LCB7CgkJCW5hbWU6ICdvbkNsaWNrJywKCQkJaGFuZGxlcjogJ2RvTGluaycsCgkJCXBhcmFtczogJ249ZXZlbnQsIG8nLAoJCQl0eXBlOiAnbGluaycsCgkJfSwgewoJCQluYW1lOiAnb25DbGlja1JvdycsCgkJCWhhbmRsZXI6ICdGaWVsZENoYW5nZScsCgkJCXBhcmFtczogJ24sIG8nLAoJCQl0eXBlOiAnZ3JpZCcsCgkJfV07CgoJCWlmICh0eXBlb2YoJCkgIT09ICd1bmRlZmluZWQnKSAkKHdpbmRvdykucmVzaXplKHRoaXMud2luZG93UmVzaXplZCk7CgkJdGhpcy53aW5kb3dSZXNpemVkKCk7Cgl9CgoJc3IoKSB7CgkJcmV0dXJuIHR5cGVvZihfRnJFTUQpICE9PSAndW5kZWZpbmVkJyA/IF9GckVNRC5zcigpIDogd2luZG93LnNyOwoJfQoKCXBhcnNlKCkgewoJCSQucGFyc2VyLnBhcnNlKCk7Cgl9CgoJd2luZG93UmVzaXplZCgpIHsKCQl0aGlzLndpZHRoID0gd2luZG93LmlubmVyV2lkdGg7CgkJdGhpcy5oZWlnaHQgPSB3aW5kb3cuaW5uZXJIZWlnaHQgKiAwLjg7Cgl9CgoJaW5pdCgpIHsKCQl2YXIgc2VsZWN0ID0gewoJCQlpbml0OiBmdW5jdGlvbihjb250YWluZXIsIG9wdGlvbnMpIHsKCQkJCXZhciBvcCA9IG51bGw7CgkJCQl2YXIgZm9wID0gbnVsbDsKCQkJCWZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5ncmlkcy5sZW5ndGg7IGkrKykKCQkJCQlpZiAodHJ1ZSB8fCB0aGlzLmdyaWRzW2ldLmlkID09IG9wdGlvbnMuc291cmNlKSBvcCA9IHRoaXMuZ3JpZHNbaV0ub3B0aW9uczsKCQkJCWZvciAoaSA9IDA7IGkgPCBvcC5jb2x1bW5zLmxlbmd0aDsgaSsrKQoJCQkJCWlmIChvcC5jb2x1bW5zW2ldLm5hbWUgPT0gb3B0aW9ucy5maWVsZCkgZm9wID0gb3AuY29sdW1uc1tpXTsKCQkJCWZvcC53aWR0aCA9ICh0aGlzLndpZHRoIC8gMyk7CgkJCQl2YXIgZSA9ICQodGhpcy5zZWxlY3QoZm9wKSk7CgkJCQl2YXIgaW5wdXQgPSBlLmFwcGVuZFRvKGNvbnRhaW5lcik7CgkJCQlpbnB1dC5jb21ib2dyaWQoKTsKCQkJCXRoaXMuYmluZChpbnB1dCk7CgkJCQlyZXR1cm4gaW5wdXQ7CgkJCX0sCgkJCWRlc3Ryb3k6IGZ1bmN0aW9uKHRhcmdldCkgewoJCQkJJCh0YXJnZXQpLnJlbW92ZSgpOwoJCQl9LAoJCQlnZXRWYWx1ZTogZnVuY3Rpb24odGFyZ2V0KSB7CgkJCQlyZXR1cm4gJCh0YXJnZXQpLnZhbCgpOwoJCQl9LAoJCQlzZXRWYWx1ZTogZnVuY3Rpb24odGFyZ2V0LCB2YWx1ZSkgewoJCQkJJCh0YXJnZXQpLnZhbCh2YWx1ZSk7CgkJCX0sCgkJCXJlc2l6ZTogZnVuY3Rpb24odGFyZ2V0LCB3aWR0aCkgewoJCQkJJCh0YXJnZXQpLl9vdXRlcldpZHRoKHdpZHRoKTsKCQkJfQoJCX07CgkJJC5leHRlbmQoJC5mbi5kYXRhZ3JpZC5kZWZhdWx0cy5lZGl0b3JzLCB7CgkJCWRhdGV0aW1lOiB7CgkJCQlpbml0OiBmdW5jdGlvbihjb250YWluZXIsIG9wdGlvbnMpIHsKCQkJCQlvcHRpb25zLndpZHRoID0gdGhpcy5jV2lkdGgob3B0aW9ucyk7CgkJCQkJdmFyIGlucHV0ID0gJCh0aGlzLmRhdGV0aW1lKG9wdGlvbnMpKS5hcHBlbmRUbyhjb250YWluZXIpOwoJCQkJCWlucHV0LmRhdGV0aW1lYm94KCk7CgkJCQkJcmV0dXJuIGlucHV0OwoJCQkJfSwKCQkJCWRlc3Ryb3k6IGZ1bmN0aW9uKHRhcmdldCkgewoJCQkJCSQodGFyZ2V0KS5yZW1vdmUoKTsKCQkJCX0sCgkJCQlnZXRWYWx1ZTogZnVuY3Rpb24odGFyZ2V0KSB7CgkJCQkJcmV0dXJuICQodGFyZ2V0KS52YWwoKTsKCQkJCX0sCgkJCQlzZXRWYWx1ZTogZnVuY3Rpb24odGFyZ2V0LCB2YWx1ZSkgewoJCQkJCSQodGFyZ2V0KS52YWwodmFsdWUpOwoJCQkJfSwKCQkJCXJlc2l6ZTogZnVuY3Rpb24odGFyZ2V0LCB3aWR0aCkgewoJCQkJCSQodGFyZ2V0KS5fb3V0ZXJXaWR0aCh3aWR0aCk7CgkJCQl9CgkJCX0sCgkJCWNoZWNrYm94OiB7CgkJCQlpbml0OiBmdW5jdGlvbihjb250YWluZXIsIG9wdGlvbnMpIHsKCQkJCQl2YXIgaW5wdXQgPSAkKHRoaXMuYm9vbChvcHRpb25zKSkuYXBwZW5kVG8oY29udGFpbmVyKTsKCQkJCQlpbnB1dC5zd2l0Y2hidXR0b24oKTsKCQkJCQlyZXR1cm4gaW5wdXQ7CgkJCQl9LAoJCQkJZGVzdHJveTogZnVuY3Rpb24odGFyZ2V0KSB7CgkJCQkJJCh0YXJnZXQpLnJlbW92ZSgpOwoJCQkJfSwKCQkJCWdldFZhbHVlOiBmdW5jdGlvbih0YXJnZXQpIHsKCQkJCQlyZXR1cm4gJCh0YXJnZXQpLnZhbCgpOwoJCQkJfSwKCQkJCXNldFZhbHVlOiBmdW5jdGlvbih0YXJnZXQsIHZhbHVlKSB7CgkJCQkJJCh0YXJnZXQpLnZhbCh2YWx1ZSk7CgkJCQl9LAoJCQkJcmVzaXplOiBmdW5jdGlvbih0YXJnZXQsIHdpZHRoKSB7CgkJCQkJJCh0YXJnZXQpLl9vdXRlcldpZHRoKHdpZHRoKTsKCQkJCX0KCQkJfSwKCQkJY29tYm90cmVlZ3JpZDogc2VsZWN0LAoJCQlzZWxlY3Q6IHNlbGVjdCwKCQl9KTsKCX0KCglhc2socXVlc3Rpb24sIGZBbnN3ZXIgPSB2ID0+IHYsIG9wdGlvbnMpIHsKCQkkLm1lc3NhZ2VyLmNvbmZpcm0odGhpcy50aXRsZSwgcXVlc3Rpb24sIGZ1bmN0aW9uKHIpIHsKCQkJaWYgKG9wdGlvbnMpIHsKCQkJCWZvciAodmFyIGkgPSAwOyBpIDwgb3B0aW9ucy5sZW5ndGg7IGkrKykgewoJCQkJCWlmIChvcHRpb25zW2ldLmFuc3dlciA9PSByKSB7CgkJCQkJCXJldHVybiBmQW5zd2VyKG9wdGlvbnNbaV0udmFsdWUpOwoJCQkJCX0KCQkJCX0KCQkJfSBlbHNlIHsKCQkJCXJldHVybiBmQW5zd2VyKHIpOwoJCQl9CgkJfSk7Cgl9CgoJdG9wRGF0YShhciwgZ0ZpZWxkLCB2RmllbGQsIHRvcCkgewoJCWlmICghdG9wKSB7CgkJCXJldHVybiBhcjsKCQl9CgkJcmV0ID0gW107CgkJJC5lYWNoKHRoaXMuc3IoKS5ncm91cEJ5KGFyLCBnRmllbGQpLCBmdW5jdGlvbihrZXksIHZhbHVlcykgewoJCQl2YWx1ZXMudmFsdWVzLnNvcnQoKGEsIGIpID0+IHsKCQkJCWlmIChwYXJzZUZsb2F0KGFbdkZpZWxkXSkgPCBwYXJzZUZsb2F0KGJbdkZpZWxkXSkpIHsKCQkJCQlyZXR1cm4gMTsKCQkJCX0gZWxzZSBpZiAocGFyc2VGbG9hdChhW3ZGaWVsZF0pID4gcGFyc2VGbG9hdChiW3ZGaWVsZF0pKSB7CgkJCQkJcmV0dXJuIC0xOwoJCQkJfSBlbHNlIHsKCQkJCQlyZXR1cm4gMDsKCQkJCX0KCQkJfSk7CgkJCSQuZWFjaCh2YWx1ZXMudmFsdWVzLCBmdW5jdGlvbihpLCB2KSB7CgkJCQlpZiAoaSA8IHRvcCkgewoJCQkJCXJldC5wdXNoKHYpOwoJCQkJfQoJCQl9KTsKCQl9KTsKCQlyZXR1cm4gcmV0OwoJfQoKCWFzeW5jIGRvQ2xpY2soYnV0dG9uKSB7CgkJbGV0IF90aGlzID0gdHlwZW9mKHRoaXMuZG9DbGljaykgPT09ICdmdW5jdGlvbicgPyB0aGlzIDogd2luZG93LkRGb3JtOwoJCWJ1dHRvbiA9IF90aGlzLmJ1dHRvbnMuZmluZChiID0+IGIubmFtZSA9PSBidXR0b24ubmFtZSAmJiBiLmdyb3VwID09IGJ1dHRvbi5ncm91cCk7CgkJX3RoaXMuYnVzeSh0cnVlKTsKCQlfdGhpcy5zZXQoewoJCQlXb3JrUHJvZ3Jlc3NWYWx1ZTogMjAKCQl9KQoKCQl2YXIgbyA9IF90aGlzLmdldCgpOwoJCXZhciBzTWlzc2luZyA9IF90aGlzLmVsZW1lbnRzLmZpbHRlcihlID0+IChidXR0b24ud2luZG93ID8gYnV0dG9uLmdyb3VwID09IGUuZ3JvdXAgOiB0cnVlKSkuZmlsdGVyKGUgPT4gZS5yZXF1aXJlZCAmJiAhb1tlLm5hbWVdKS5tYXAoZSA9PiAiPGxpPiIgKyAoZS5sYWJlbCB8fCBlLm5hbWUpICsgIjwvbGk+Iikuam9pbigiIik7CgkJaWYgKHNNaXNzaW5nKSB7CgkJCXdpbmRvdy5fRnJFTUQuX2Vycm9yKCJNaXNzaW5nIG1hbmRhdG9yeSBmaWVsZHM6PGJyLz48dWw+IiArIHNNaXNzaW5nICsgIjwvdWw+IiwgNTAwMCk7CgkJCV90aGlzLmJ1c3koZmFsc2UpOwoJCQlyZXR1cm47CgkJfQoJCWlmIChidXR0b24ub25jbGljaykgYXdhaXQgYnV0dG9uLm9uY2xpY2sobyk7CgkJaWYgKGJ1dHRvbi5vbkNsaWNrKSBhd2FpdCBidXR0b24ub25DbGljayhvKTsKCQlfdGhpcy5idXN5KGZhbHNlKTsKCX0KCglidXN5KGJCdXN5KSB7CgkJaWYgKCFiQnVzeSkgewoJCQl2YXIgdG90YWwgPSAwOwoJCQlpZiAodHlwZW9mIG1vbWVudCAhPT0gJ3VuZGVmaW5lZCcpIHsKCQkJCXRvdGFsID0gbW9tZW50KCkuZGlmZihtb21lbnQodGhpcy5idXN5U3RhbXApLCAnc2Vjb25kcycpOwoJCQl9IGVsc2UgewoJCQkJLy8gbm8gbW9tZW50LCB1c2Ugc3RhbmRhcmQgRGF0ZQoJCQkJdG90YWwgPSAobmV3IERhdGUoKS5nZXRUaW1lKCkgLSB0aGlzLmJ1c3lTdGFtcCA/IHRoaXMuYnVzeVN0YW1wLmdldFRpbWUoKSA6IDApIC8gMTAwMCAvIDM2MDA7CgkJCX0KCQkJaWYgKHRoaXMuYkRlYnVnKSB7CgkJCQl3aW5kb3cuX0ZyRU1ELl9hbGVydCgiRXhlY3V0aW9uIFRpbWU6ICIgKyB0b3RhbCArICIgc2Vjb25kcy4iKTsKCQkJfQoJCQlkZWxldGUgdGhpcy5idXN5U3RhbXA7CgoJCQlzZXRJbnRlcnZhbCgxLCAoKSA9PiB0aGlzLlNldCh7CgkJCQlMb2FkaW5nOiAxMAoJCQl9KSk7CgkJfSBlbHNlIHsKCQkJdGhpcy5idXN5U3RhbXAgPSBuZXcgRGF0ZSgpOwoJCX0KCgkJJC5lYWNoKCQubWVyZ2UoJC5tYXAodGhpcy5idXR0b25zLCBiID0+IGIubmFtZSksICQubWFwKHRoaXMuZWxlbWVudHMuZmlsdGVyKGUgPT4gZS50eXBlID09ICdsaW5rJyksIGUgPT4gZS5uYW1lKSksIChfLCBlKSA9PiAkKCcjJyArIGUpLmxpbmtidXR0b24oYkJ1c3kgPyAnZGlzYWJsZScgOiAnZW5hYmxlJykpOwoJfQoKCXByZWZpeChlKSB7CgkJc3dpdGNoIChlLnR5cGUpIHsKCQkJY2FzZSAnbGFiZWwnOgoJCQkJcmV0dXJuICdsYmwnOwoJCQljYXNlICd0ZXh0JzoKCQkJY2FzZSAnc3RyaW5nJzoKCQkJY2FzZSAnc2VhcmNoJzoKCQkJY2FzZSAncGFzc3dvcmQnOgoJCQkJcmV0dXJuICd0eHQnOwoJCQljYXNlICJEYXRlVGltZSI6CgkJCWNhc2UgImRhdGV0aW1lIjoKCQkJCXJldHVybiAnZHRwJzsKCQkJY2FzZSAiaW50IjoKCQkJY2FzZSAiaW50ZWdlciI6CgkJCWNhc2UgIm51bWJlciI6CgkJCWNhc2UgImxvbmciOgoJCQljYXNlICJMb25nIjoKCQkJCXJldHVybiAnbnVkJzsKCQkJY2FzZSAnZmlsZSc6CgkJCQlyZXR1cm4gJ2ZpbCc7CgkJCWNhc2UgJ2ltYWdlJzoKCQkJCXJldHVybiAnaW1nJzsKCQkJY2FzZSAiYm9vbCI6CgkJCQlyZXR1cm4gJ2Noayc7CgkJCWNhc2UgIndpbmRvdyI6CgkJCQlyZXR1cm4gJ3BubCc7CgkJCWNhc2UgInByb2dyZXNzIjoKCQkJCXJldHVybiAncHJnJzsKCQkJY2FzZSAiZ3JpZCI6CgkJCWNhc2UgInRyZWUiOgoJCQljYXNlICJzZWxlY3QiOgoJCQkJcmV0dXJuICdjbWInOwoJCQlkZWZhdWx0OgoJCQkJcmV0dXJuICcnOwoJCX0KCX0KCgljbGVhcihncm91cCkgewoJCXZhciBvID0ge307CgkJJC5lYWNoKHRoaXMuZWxlbWVudHMuZmlsdGVyKGUgPT4gZ3JvdXAgPyBlLmdyb3VwID09IGdyb3VwIDogdHJ1ZSksIChfLCBlKSA9PiB7CgkJCXZhciBuYW1lID0gKGUuZW1zU291cmNlID8gIl8iIDogIiIpICsgZS5uYW1lOwoJCQlzd2l0Y2ggKGUudHlwZSkgewoJCQkJY2FzZSAndGV4dCc6CgkJCQljYXNlICdzdHJpbmcnOgoJCQkJY2FzZSAnc2VhcmNoJzoKCQkJCWNhc2UgJ3Bhc3N3b3JkJzoKCQkJCWNhc2UgIkRhdGVUaW1lIjoKCQkJCWNhc2UgImRhdGV0aW1lIjoKCQkJCQlvW25hbWVdID0gIiI7CgkJCQkJYnJlYWs7CgkJCQljYXNlICJpbnQiOgoJCQkJY2FzZSAibnVtYmVyIjoKCQkJCWNhc2UgImludGVnZXIiOgoJCQkJY2FzZSAibG9uZyI6CgkJCQljYXNlICJMb25nIjoKCQkJCWNhc2UgInByb2dyZXNzIjoKCQkJCQlvW25hbWVdID0gMDsKCQkJCQlicmVhazsKCQkJCWNhc2UgInRyZWUiOgoJCQkJY2FzZSAic2VsZWN0IjoKCQkJCQlvW25hbWVdID0gbnVsbDsKCQkJCQlicmVhazsKCQkJCWNhc2UgImdyaWQiOgoJCQkJCW9bbmFtZV0gPyBvW25hbWVdLmRhdGEgPSBbXSA6IG51bGw7CgkJCQkJYnJlYWs7CgkJCQljYXNlICJib29sIjoKCQkJCQlvW25hbWVdID0gZmFsc2U7CgkJCQkJYnJlYWs7CgkJCQlkZWZhdWx0OgoJCQkJCWJyZWFrOwoJCQl9CgkJfSk7CgkJLy9jb25zb2xlLmxvZygiY2xlYXIiLCBvKTsKCQl0aGlzLnNldChvKTsKCQl0aGlzLmJ1c3koZmFsc2UpOwoJfQoKCXNldChvLCBlTmFtZSkgewoJCWlmIChlTmFtZSkgewoJCQl2YXIgb0VsZW1lbnQgPSB0aGlzLmJ5TmFtZShlTmFtZSk7CgkJCWlmICghb0VsZW1lbnQpIHJldHVybjsKCQkJdmFyIGF0dCA9IG51bGw7CgkJCWlmIChvICYmIG8uSWQgJiYgby5FbnRpdHlBdHRyaWJ1dGUpIHsKCQkJCS8vIGFuIEVudGl0eVZhbHVlCgkJCQlmb3IgKHZhciBwIGluIG8pCgkJCQkJaWYgKHAuZW5kc1dpdGgoIlZhbHVlIikpIGF0dCA9IHA7CgkJCQlvRWxlbWVudC5lbXNTb3VyY2UgPSBvOwoJCQl9CgkJCXRyeSB7CgkJCQlsZXQgZU5hbWUgPSAiIyIgKyB0aGlzLnByZWZpeChvRWxlbWVudCkgKyBvRWxlbWVudC5uYW1lOwoJCQkJbGV0IGVUeXBlID0gdGhpcy51aVR5cGVzW29FbGVtZW50LnR5cGVdOwoJCQkJLy8gY29uc29sZS5sb2coIkR5bmFGb3JtOjpzZXQoIiArIG9FbGVtZW50Lm5hbWUgKyAiKTogIiwgZU5hbWUsIGVUeXBlLCBvKTsKCQkJCXN3aXRjaCAob0VsZW1lbnQudHlwZSkgewoJCQkJCWNhc2UgJ2xhYmVsJzoKCQkJCQkJaWYgKGF0dCkgewoJCQkJCQkJJChlTmFtZSkuaHRtbChvW2F0dF0pOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJJChlTmFtZSkuaHRtbCgobyAmJiBvLkVudGl0eUF0dHJpYnV0ZSkgPyAiIiA6IG8pOwoJCQkJCQl9CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgJ3RleHQnOgoJCQkJCWNhc2UgJ3N0cmluZyc6CgkJCQkJY2FzZSAncGFzc3dvcmQnOgoJCQkJCWNhc2UgImludCI6CgkJCQkJY2FzZSAic2VhcmNoIjoKCQkJCQljYXNlICJpbnRlZ2VyIjoKCQkJCQljYXNlICJudW1iZXIiOgoJCQkJCWNhc2UgImxvbmciOgoJCQkJCWNhc2UgIkxvbmciOgoJCQkJCQlpZiAoYXR0KSB7CgkJCQkJCQkkKGVOYW1lKVtlVHlwZV0oInNldFZhbHVlIiwgb1thdHRdKTsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCSQoZU5hbWUpW2VUeXBlXSgic2V0VmFsdWUiLCAobyAmJiBvLkVudGl0eUF0dHJpYnV0ZSkgPyAiIiA6IG8pOwoJCQkJCQl9CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgIkRhdGVUaW1lIjoKCQkJCQljYXNlICJkYXRldGltZSI6CgkJCQkJCWlmIChhdHQpIHsKCQkJCQkJCSQoZU5hbWUpW2VUeXBlXSgnc2V0VmFsdWUnLCAob1thdHRdID8gdGhpcy5zcigpLnRvRGF0ZVRpbWUob1thdHRdKSA6ICIiKSk7CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQkkKGVOYW1lKVtlVHlwZV0oJ3NldFZhbHVlJywgKG8gJiYgby5FbnRpdHlBdHRyaWJ1dGUpID8gIiIgOiAobyA/IHRoaXMuc3IoKS50b0RhdGVUaW1lKG8pIDogIiIpKTsKCQkJCQkJfQoJCQkJCQlicmVhazsKCQkJCQljYXNlICJib29sIjoKCQkJCQkJaWYgKGF0dCkgewoJCQkJCQkJJChlTmFtZSlbZVR5cGVdKChvW2F0dF0gPyAnJyA6ICd1bicpICsgJ2NoZWNrJyk7CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQkkKGVOYW1lKVtlVHlwZV0oKCgobyAmJiBvLkVudGl0eUF0dHJpYnV0ZSkgPyAiIiA6IG8pID8gJycgOiAndW4nKSArICdjaGVjaycpOwoJCQkJCQl9CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgIndpbmRvdyI6CgkJCQkJCWlmIChhdHQpIHsKCQkJCQkJCW9FbGVtZW50LnZhbHVlID0gb1thdHRdOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJb0VsZW1lbnQudmFsdWUgPSAobyAmJiBvLkVudGl0eUF0dHJpYnV0ZSkgPyAiIiA6IG87CgkJCQkJCX0KCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAicHJvZ3Jlc3MiOgoJCQkJCQl2YXIgdiA9IDA7CgkJCQkJCWlmIChhdHQpIHsKCQkJCQkJCXYgPSBvW2F0dF07CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQl2ID0gKG8gJiYgby5FbnRpdHlBdHRyaWJ1dGUpID8gIiIgOiBvOwoJCQkJCQl9CgkJCQkJCS8vY29uc29sZS5sb2coIiMiICsgdGhpcy5wcmVmaXgob0VsZW1lbnQpICsgb0VsZW1lbnQubmFtZSwgdGhpcy51aVR5cGVzW29FbGVtZW50LnR5cGVdLCBNYXRoLnJvdW5kKHYgKiAxMCkgLyAxMCk7CgkJCQkJCSQoZU5hbWUpW2VUeXBlXSgnc2V0VmFsdWUnLCBNYXRoLnJvdW5kKHYgKiAxMCkgLyAxMCk7CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgImdyaWQiOgoJCQkJCQlsZXQgY29scyA9IEpTT04ucGFyc2UoInsiICsgdGhpcy5tYXBDb2x1bW5zKG9FbGVtZW50LCB0cnVlKSArICJ9Iik7CgkJCQkJCSQuZWFjaChjb2xzLmNvbHVtbnNbMF0sIChfLCBjKSA9PiBjLmZvcm1hdHRlciA9IHRoaXMuc3IoKS5ydW5TY3JpcHQodGhpcy5mb3JtYXR0ZXIob0VsZW1lbnQubmFtZSwgYykpKTsKCQkJCQkJJChlTmFtZSkuZGF0YWdyaWQoY29scyk7CgkJCQkJCWlmIChhdHQpIHsKCQkJCQkJCSQoZU5hbWUpLmRhdGFncmlkKHsKCQkJCQkJCQlkYXRhOiBvW2F0dF0KCQkJCQkJCX0pOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJJChlTmFtZSkuZGF0YWdyaWQoewoJCQkJCQkJCWRhdGE6IChvICYmIG8uRW50aXR5QXR0cmlidXRlKSA/ICIiIDogbwoJCQkJCQkJfSk7CgkJCQkJCX0KCQkJCQkJJChlTmFtZSkuZGF0YWdyaWQoInVuc2VsZWN0QWxsIik7CgkJCQkJCSQoZU5hbWUpLmRhdGFncmlkKCk7CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgInRyZWUiOgoJCQkJCQl2YXIgdiA9IGF0dCA/IG9bYXR0XSA6ICgobyAmJiBvLkVudGl0eUF0dHJpYnV0ZSkgPyAiIiA6IG8pOwoJCQkJCQlpZiAoQXJyYXkuaXNBcnJheSh2KSkgewoJCQkJCQkJJChlTmFtZSlbZVR5cGVdKCJ0cmVlIikudHJlZSgibG9hZERhdGEiLCB2KTsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCSQoZU5hbWUpW2VUeXBlXSgnc2V0VmFsdWUnLCB2KTsKCQkJCQkJfQoJCQkJCQlicmVhazsKCQkJCQljYXNlICJzZWxlY3QiOgoJCQkJCQlpZiAoYXR0KSB7CgkJCQkJCQlpZiAob0VsZW1lbnQub3B0aW9ucykgewoJCQkJCQkJCSQoZU5hbWUpLmNvbWJvKCdzZXRWYWx1ZScgKyAob0VsZW1lbnQubXVsdGlwbGUgPyAncycgOiAnJyksIChvW2F0dF0gPyBvW2F0dF0gOiAiIikpOwoJCQkJCQkJCSQoZU5hbWUpLmNvbWJvKCdzZXRWYWx1ZScgKyAob0VsZW1lbnQubXVsdGlwbGUgPyAncycgOiAnJyksIChvW2F0dF0gPyBvW2F0dF0gOiAiIikpOwoJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQkkKGVOYW1lKS5jb21ib2dyaWQoJ3NldFZhbHVlJyArIChvRWxlbWVudC5tdWx0aXBsZSA/ICdzJyA6ICcnKSwgKG9bYXR0XSA/IG9bYXR0XSA6ICIiKSk7CgkJCQkJCQl9CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQl2ID0gbnVsbDsKCQkJCQkJCWlmIChvID09PSBudWxsKSB7CgoJCQkJCQkJfSBlbHNlIGlmIChvLmNvbnN0cnVjdG9yID09PSBBcnJheSkgewoKCQkJCQkJCX0gZWxzZSBpZiAoIW8uRW50aXR5QXR0cmlidXRlKSB7CgkJCQkJCQkJdiA9IG8gfHwgewoJCQkJCQkJCQlJZDogby5JZCwKCQkJCQkJCQkJX1RvU3RyaW5nOiBvLl9Ub1N0cmluZywKCQkJCQkJCQkJdG9TdHJpbmc6IGZ1bmN0aW9uKCkgewoJCQkJCQkJCQkJcmV0dXJuIHRoaXMuX1RvU3RyaW5nOwoJCQkJCQkJCQl9CgkJCQkJCQkJfTsKCQkJCQkJCX0KCQkJCQkJCWlmIChvRWxlbWVudC5vcHRpb25zKSB7CgkJCQkJCQkJJChlTmFtZSkuY29tYm8oJ3NldFZhbHVlJyArIChvRWxlbWVudC5tdWx0aXBsZSA/ICdzJyA6ICcnKSwgdik7CgkJCQkJCQkJJChlTmFtZSkuY29tYm8oJ3NldFRleHQnICsgKG9FbGVtZW50Lm11bHRpcGxlID8gJ3MnIDogJycpLCB2KTsKCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJJChlTmFtZSkuY29tYm9ncmlkKCdzZXRWYWx1ZScgKyAob0VsZW1lbnQubXVsdGlwbGUgPyAncycgOiAnJyksIHYpOwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJCWJyZWFrOwoJCQkJCWRlZmF1bHQ6CgkJCQkJCWJyZWFrOwoJCQkJfQoJCQl9IGNhdGNoIChleCkgewoJCQkJY29uc29sZS5sb2coZXgpOwoJCQl9CgkJfSBlbHNlIHsKCQkJZm9yICh2YXIgcCBpbiBvKSB7CgkJCQlpZiAocC5pbmRleE9mKCdfJykgPT09IDApIHAgPSBwLnN1YnN0cmluZygxKTsKCQkJCXZhciBlID0gdGhpcy5ieU5hbWUocCk7CgkJCQlpZiAoIWUgfHwgIWUubmFtZSkgY29udGludWU7CgkJCQl2YXIgdmFsdWUgPSBvW3BdOwoJCQkJaWYgKGUubmFtZSA9PSB0aGlzLnNUYWJsZSkgewoJCQkJCXZhbHVlID0gbzsKCQkJCQl2YWx1ZS5EYXRlID0gbmV3IERhdGUoKTsKCQkJCX0KCQkJCWlmIChwID09ICJFbnRpdHlWYWx1ZXMiKSB7CgkJCQkJLy8gYW4gZW1zRm9ybVZhbHVlcyBzb3VyY2UKCQkJCQkvLyBmaW5kIHRoZSBFbnRpdHlWYWx1ZSBmb3IgdGhpcyBlbGVtZW50IGFuZCBzZXQgaXQKCQkJCQlmb3IgKHZhciBqID0gMDsgaiA8IG8uRW50aXR5VmFsdWVzLmxlbmd0aDsgaisrKSB7CgkJCQkJCWlmIChvLkVudGl0eVZhbHVlc1tqXS5FbnRpdHlBdHRyaWJ1dGUuTmFtZSA9PSBlLm5hbWUpIHsKCQkJCQkJCS8vIGZvdW5kIHRoZSBFbnRpdHlWYWx1ZSBmb3IgdGhpcyBlbGVtZW50CgkJCQkJCQlfdiA9IG8uRW50aXR5VmFsdWVzW2pdOwoJCQkJCQkJZm9yICh2YXIgcSBpbiBfdikgewoJCQkJCQkJCWlmIChxLmVuZHNXaXRoKCJWYWx1ZSIpKSB7CgkJCQkJCQkJCV92W3FdID0gdmFsdWU7CgkJCQkJCQkJfQoJCQkJCQkJfQoJCQkJCQkJYnJlYWs7CgkJCQkJCX0KCQkJCQl9CgkJCQl9CgkJCQl0aGlzLnNldCh2YWx1ZSwgZS5uYW1lKTsKCQkJfQoJCX0KCX0KCglnZXQoKSB7CgkJdmFyIG8gPSB7fTsKCQlpZiAodGhpcy5zVGFibGUgJiYgd2luZG93W3RoaXMuc1RhYmxlXSkgbyA9IG5ldyB3aW5kb3dbdGhpcy5zVGFibGVdKCk7CgkJZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7CgkJCXZhciBjbiA9IG51bGw7CgkJCXZhciB2ID0gbnVsbDsKCQkJdHJ5IHsKCQkJCWxldCBlTmFtZSA9ICIjIiArIHRoaXMucHJlZml4KHRoaXMuZWxlbWVudHNbaV0pICsgdGhpcy5lbGVtZW50c1tpXS5uYW1lOwoJCQkJc3dpdGNoICh0aGlzLmVsZW1lbnRzW2ldLnR5cGUpIHsKCQkJCQljYXNlICdsYWJlbCc6CgkJCQkJCWNuID0gJChlTmFtZSk7CgkJCQkJCXYgPSBjbi5odG1sKCk7CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgJ3RleHQnOgoJCQkJCWNhc2UgJ3N0cmluZyc6CgkJCQkJY2FzZSAnc2VhcmNoJzoKCQkJCQljYXNlICdwYXNzd29yZCc6CgkJCQkJCWNuID0gJChlTmFtZSk7CgkJCQkJCXYgPSBjbi52YWwoKTsKCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAiZmlsZSI6CgkJCQkJY2FzZSAiaW1hZ2UiOgoJCQkJCQljbiA9ICQoZU5hbWUpOwoJCQkJCQl2ID0gdGhpcy5lbGVtZW50c1tpXS5kYXRhOwoJCQkJCQlicmVhazsKCQkJCQljYXNlICJEYXRlVGltZSI6CgkJCQkJY2FzZSAiZGF0ZXRpbWUiOgoJCQkJCQl2ID0gbmV3IERhdGUoJChlTmFtZSkuZGF0ZXRpbWVib3goJ2dldFZhbHVlJykpOwoJCQkJCQljbiA9ICQoZU5hbWUpOwoJCQkJCQlicmVhazsKCQkJCQljYXNlICJwcm9ncmVzcyI6CgkJCQkJCWNuID0gJChlTmFtZSk7CgkJCQkJCXYgPSBjbi5wcm9ncmVzc2JhcignZ2V0VmFsdWUnKTsKCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAiaW50IjoKCQkJCQljYXNlICJpbnRlZ2VyIjoKCQkJCQljYXNlICJudW1iZXIiOgoJCQkJCWNhc2UgImxvbmciOgoJCQkJCWNhc2UgIkxvbmciOgoJCQkJCQljbiA9ICQoZU5hbWUpOwoJCQkJCQl2ID0gcGFyc2VGbG9hdChjbi52YWwoKSk7CgkJCQkJCWlmIChpc05hTih2KSkgdiA9IDA7CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgImdyaWQiOgoJCQkJCQljbiA9ICQoZU5hbWUpOwoJCQkJCQl2ID0gY24uZGF0YWdyaWQoJ2dldERhdGEnKTsKCQkJCQkJdi5zZWxlY3RlZCA9IGNuLmRhdGFncmlkKCJnZXRTZWxlY3RlZCIpOwoJCQkJCQlicmVhazsKCQkJCQljYXNlICJ0cmVlIjoKCQkJCQkJY24gPSAkKGVOYW1lKTsKCQkJCQkJdiA9IGNuLmNvbWJvdHJlZSgidHJlZSIpLnRyZWUoImdldFNlbGVjdGVkIik7CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgIndpbmRvdyI6CgkJCQkJCXYgPSB0aGlzLmVsZW1lbnRzW2ldLnZhbHVlOwoJCQkJCQlicmVhazsKCQkJCQljYXNlICJzZWxlY3QiOgoJCQkJCQlpZiAodGhpcy5lbGVtZW50c1tpXS5vcHRpb25zKSB7CgkJCQkJCQl2ID0gJChlTmFtZSkuY29tYm9ncmlkKCdnZXRWYWx1ZScgKyAodGhpcy5lbGVtZW50c1tpXS5tdWx0aXBsZSA/ICdzJyA6ICcnKSk7CgkJCQkJCQl2ID0gdGhpcy5zcigpLnJ1blNjcmlwdCh2KTsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCXYgPSAkKGVOYW1lKS5jb21ib2dyaWQoJ2dyaWQnKS5kYXRhZ3JpZCgnZ2V0U2VsZWN0aW9ucycpOwoJCQkJCQkJaWYgKCF2IHx8ICF2Lmxlbmd0aCkgewoJCQkJCQkJCXYgPSAkKGVOYW1lKS5jb21ib2dyaWQoJ2dldFZhbHVlJyArICh0aGlzLmVsZW1lbnRzW2ldLm11bHRpcGxlID8gJ3MnIDogJycpKTsKCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJaWYgKCF0aGlzLmVsZW1lbnRzW2ldLm11bHRpcGxlKSB2ID0gdlswXTsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCQljbiA9ICQoZU5hbWUpOwoJCQkJCQlicmVhazsKCQkJCQljYXNlICJib29sIjoKCQkJCQkJY24gPSAkKGVOYW1lKTsKCQkJCQkJdiA9IGNuLnN3aXRjaGJ1dHRvbignb3B0aW9ucycpLmNoZWNrZWQ7CgkJCQkJCWJyZWFrOwoJCQkJCWRlZmF1bHQ6CgkJCQkJCWJyZWFrOwoJCQkJfQoJCQkJb1t0aGlzLmVsZW1lbnRzW2ldLm5hbWVdKHYpOwoJCQl9IGNhdGNoIChlKSB7CgkJCQkvL2NvbnNvbGUubG9nKHRoaXMuZWxlbWVudHNbaV0ubmFtZSwgZSk7CgkJCQlvW3RoaXMuZWxlbWVudHNbaV0ubmFtZV0gPSB2OwoJCQl9CgkJCWlmIChjbikgewoJCQkJaWYgKG8uRW50aXR5VmFsdWVzKSB7CgkJCQkJZm9yICh2YXIgaiA9IDA7IGogPCBvLkVudGl0eVZhbHVlcy5sZW5ndGg7IGorKykgewoJCQkJCQlpZiAodGhpcy5lbGVtZW50c1tpXS5uYW1lID09IHRoaXMuc1RhYmxlICYmIHRoaXMuZWxlbWVudHNbaV0uZW1zU291cmNlKSBvLklkID0gdGhpcy5lbGVtZW50c1tpXS5lbXNTb3VyY2UuSWQ7CgkJCQkJCWlmIChvLkVudGl0eVZhbHVlc1tqXS5FbnRpdHlBdHRyaWJ1dGUuTmFtZSA9PSB0aGlzLmVsZW1lbnRzW2ldLm5hbWUgJiYgdGhpcy5lbGVtZW50c1tpXS5lbXNTb3VyY2UpIHsKCQkJCQkJCW8uRW50aXR5VmFsdWVzW2pdLklkID0gdGhpcy5lbGVtZW50c1tpXS5lbXNTb3VyY2UuSWQ7CgkJCQkJCX0KCQkJCQl9CgkJCQl9CgkJCX0KCQl9CgkJcmV0dXJuIG87Cgl9CgoJY0hlaWdodChvcHRpb25zKSB7CgkJaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5lZGl0b3IpIHJldHVybiB3aW5kb3cuaW5uZXJIZWlnaHQ7CgkJaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5oZWlnaHQgJiYgdHlwZW9mKG9wdGlvbnMuaGVpZ2h0KSA9PT0gJ3N0cmluZycpIHJldHVybiB0aGlzLmhlaWdodDsKCQlpZiAob3B0aW9ucyAmJiBvcHRpb25zLnR5cGUgPT0gJ3dpbmRvdycgJiYgIW9wdGlvbnMuaGVpZ2h0KSByZXR1cm4gdGhpcy5oZWlnaHQgKiAwLjk7CgkJcmV0dXJuIE1hdGguZmxvb3IoKChvcHRpb25zID8gb3B0aW9ucy5oZWlnaHQgOiBudWxsKSB8fCAodGhpcy5oZWlnaHQgLyAzKSkpOwoJfQoKCXNlYXJjaChvcHRpb25zKSB7CgkJcmV0dXJuIHRoaXMuc3RyaW5nKG9wdGlvbnMpOwoJfQoKCXN0cmluZyhvcHRpb25zKSB7CgkJb3B0aW9ucy5oZWlnaHQgPSAyMDsKCQlvcHRpb25zLnNpbXBsZSA9IHRydWU7CgkJcmV0dXJuIHRoaXMudGV4dChvcHRpb25zKTsKCX0KCglkYXRldGltZShvcHRpb25zKSB7CgkJcmV0dXJuIGA8aW5wdXQgaWQ9ImR0cCR7b3B0aW9ucy5uYW1lfSIgY2xhc3M9ImVhc3l1aS0ke3RoaXMudWlUeXBlc1tvcHRpb25zLnR5cGVdfSIgcmVxdWlyZWQ9IiR7b3B0aW9ucy5yZXF1aXJlZCA/ICd0cnVlJyA6ICdmYWxzZSd9IiB2YWx1ZT0iJHt0aGlzLnZhbHVlKG9wdGlvbnMpfSIgc3R5bGU9IndpZHRoOiR7dGhpcy5jV2lkdGgob3B0aW9ucyl9cHgiPmA7Cgl9CgoJcXVlcnkob3B0aW9ucykgewoJCXJldHVybiAiPGRpdiBpZD0ndnMiICsgb3B0aW9ucy5uYW1lICsgIic+PC9kaXY+IjsKCX0KCglEYXRlVGltZShvcHRpb25zKSB7CgkJcmV0dXJuIHRoaXMuZGF0ZXRpbWUob3B0aW9ucyk7Cgl9CgoJbG9uZyhvcHRpb25zKSB7CgkJcmV0dXJuIHRoaXMuaW50KG9wdGlvbnMpOwoJfQoKCUxvbmcob3B0aW9ucykgewoJCXJldHVybiB0aGlzLmxvbmcob3B0aW9ucyk7Cgl9CgoJdmFsdWUob3B0aW9ucykgewoJCWlmICh0eXBlb2Ygb3B0aW9ucy52YWx1ZSA9PT0gJ2Z1bmN0aW9uJykgewoJCQl0cnkgewoJCQkJcmV0dXJuIG9wdGlvbnMudmFsdWUodGhpcy5nZXQoKSk7CgkJCX0gY2F0Y2ggKGV4KSB7CgkJCQljb25zb2xlLmxvZyhgREZvcm0udmFsdWUoJHtvcHRpb25zLm5hbWV9KTogJHtleH1gKTsKCQkJCXJldHVybiAnJzsKCQkJfQoJCX0gZWxzZSB7CgkJCXN3aXRjaCAob3B0aW9ucy50eXBlKSB7CgkJCQljYXNlICdpbnQnOgoJCQkJY2FzZSAncHJvZ3Jlc3MnOgoJCQkJCXJldHVybiBvcHRpb25zLnZhbHVlIHx8IG9wdGlvbnMubWluIHx8IDA7CgkJCQljYXNlICdzdHJpbmcnOgoJCQkJY2FzZSAndGV4dCc6CgkJCQljYXNlICdkYXRldGltZSc6CgkJCQljYXNlICdsYWJlbCc6CgkJCQkJcmV0dXJuIG9wdGlvbnMudmFsdWUgfHwgIiI7CgkJCQlkZWZhdWx0OgoJCQkJCXJldHVybiBvcHRpb25zLnZhbHVlOwoJCQl9CgkJfQoJfQoKCWludChvcHRpb25zKSB7CgkJbGV0IHJldCA9IGA8aW5wdXQgaWQ9Im51ZCR7b3B0aW9ucy5uYW1lfSIgY2xhc3M9ImVhc3l1aS0ke3RoaXMudWlUeXBlc1tvcHRpb25zLnR5cGVdfSIgcmVxdWlyZWQ9IiR7b3B0aW9ucy5yZXF1aXJlZCA/ICd0cnVlJyA6ICdmYWxzZSd9IiB2YWx1ZT0iJHt0aGlzLnZhbHVlKG9wdGlvbnMpfSIgZGF0YS1vcHRpb25zPSJtaW46JHtvcHRpb25zLm1pbiB8fCAwfSxtYXg6JHtvcHRpb25zLm1heCB8fCAxMDB9LGluY3JlbWVudDoke29wdGlvbnMuaW5jcmVtZW50IHx8IDF9IiBzdHlsZT0id2lkdGg6JHt0aGlzLmNXaWR0aChvcHRpb25zKX1weDsiPjwvaW5wdXQ+YDsKCQkvL2NvbnNvbGUubG9nKHJldCk7CgkJcmV0dXJuIHJldDsKCX0KCgltZW51KG9wdGlvbnMpIHsKCQlvcHRpb25zLnR5cGUgPSBvcHRpb25zLnR5cGUgfHwgJ21lbnUnOwoKCQlvcHRpb25zLm1lbnUgPSAob3B0aW9ucy5tZW51IHx8IFtdKS5zb3J0KChhLCBiKSA9PiBhLm9yZGVyIC0gYi5vcmRlcik7CgoJCS8vY29uc29sZS5sb2coIkR5bmFGb3JtOjptZW51KCk6IG9wdGlvbnMiLCBvcHRpb25zKTsKCgkJbGV0IHJldCA9ICIiOwoJCXJldCArPSAnPGRpdiBjbGFzcz0iZWFzeXVpLXBhbmVsIiBpZD0ibW51JyArIG9wdGlvbnMubmFtZSArICciIHN0eWxlPSJwYWRkaW5nOjVweDsiPlxuJzsKCgkJcmV0ICs9IG9wdGlvbnMubWVudS5tYXAobSA9PiBgPGEgaHJlZj0iIyIgY2xhc3M9ImVhc3l1aS0ke3RoaXMudWlUeXBlc1tvcHRpb25zLnR5cGVdfSIgZGF0YS1vcHRpb25zPSJtZW51OicjbW0ke20ubGFiZWwucmVwbGFjZSgvIC9nLCAnJyl9JyxpY29uQ2xzOidpY29uLSR7bS5pY29uIHx8ICdub25lJ30nIj4ke20ubGFiZWx9PC9hPmApLmpvaW4oJ1xuJyk7CgoJCS8qJC5lYWNoKG9wdGlvbnMubWVudSwgKF8sIG0pID0+IHJldCArPSBgPGEgaHJlZj0iIyIgY2xhc3M9ImVhc3l1aS0ke3RoaXMudWlUeXBlc1tvcHRpb25zLnR5cGVdfSIgZGF0YS1vcHRpb25zPSJtZW51OicjbW0ke20ubGFiZWwucmVwbGFjZSgvIC9nLCAnJyl9JyxpY29uQ2xzOidpY29uLSR7bS5pY29uIHx8ICdub25lJ30nIj4ke20ubGFiZWx9PC9hPlxuYCk7Ki8KCQlyZXQgKz0gIjwvZGl2PlxuIjsKCgkJbGV0IGR2ID0gbSA9PiB7CgkJCWxldCByZXQgPSAnPGRpdicgKyAobS5zdWJNZW51cyA/ICcnIDogYCBkYXRhLW9wdGlvbnM9Imljb25DbHM6J2ljb24tJHttLmljb24gfHwgJ25vbmUnfSciYCkgKyAnPlxuJzsKCQkJcmV0ICs9IG0uc3ViTWVudXMgPyAnPHNwYW4+JyArIChtLmxhYmVsIHx8IHRoaXMuZW5nbGlzaChtLmNvZGUpKSArICc8L3NwYW4+XG48ZGl2PicgOiAoYDxzcGFuIHdpZHRoPScxMDAlJyBvbmNsaWNrPScoYXN5bmMgKCkgPT4ge2xldCBtID0gJHtfRnJFTUQuX3RvSlMobSl9OyBpZihtLmFjdGlvbil7cmV0dXJuIGF3YWl0IG0uYWN0aW9uKERGb3JtLmdldCgpLCBtKTt9IGlmIChtLnN1Yk1lbnVzKSByZXR1cm47IGF3YWl0IF9GckVNRC5SZW5kZXJQYWdlKHtfY29kZTogbS5jb2RlIHx8IG0ubGFiZWwucmVwbGFjZSgvIC9nLCAiIikudG9Mb3dlckNhc2UoKX0sIG0uZGF0YSk7fSkoKSc+JHttLmxhYmVsIHx8IHRoaXMuZW5nbGlzaChtLmNvZGUpfTwvc3Bhbj5gKTsKCQkJJC5lYWNoKG0uc3ViTWVudXMsIChfLCBzKSA9PiByZXQgKz0gZHYocykpOwoJCQlyZXQgKz0gKG0uc3ViTWVudXMgPyAiPC9kaXY+XG4iIDogIiIpICsgYDwvZGl2PlxuYDsKCQkJcmV0dXJuIHJldDsKCQl9OwoKCQlyZXQgKz0gb3B0aW9ucy5tZW51Lm1hcChtID0+IGA8ZGl2IGlkPSJtbSR7bS5sYWJlbC5yZXBsYWNlKC8gL2csICcnKX0iIHN0eWxlPSJ3aWR0aDoxNTBweDsiPiR7bS5zdWJNZW51cy5tYXAoc20gPT4gZHYoc20pKS5qb2luKCcnKX08L2Rpdj5gKS5qb2luKCdcbicpOwoKCQlyZXR1cm4gcmV0OwoJfQoKCWludGVnZXIob3B0aW9ucykgewoJCXJldHVybiB0aGlzLmludChvcHRpb25zKTsKCX0KCgludW1iZXIob3B0aW9ucykgewoJCXJldHVybiB0aGlzLmludChvcHRpb25zKTsKCX0KCglJbnRlZ2VyKG9wdGlvbnMpIHsKCQlyZXR1cm4gdGhpcy5pbnQob3B0aW9ucyk7Cgl9CgoJYm9vbChvcHRpb25zKSB7CgkJcmV0dXJuIGA8aW5wdXQgaWQ9IiR7dGhpcy5wcmVmaXgob3B0aW9ucyl9JHtvcHRpb25zLm5hbWV9IiBkYXRhLWRmb3JtPSJlbGVtZW50OiR7b3B0aW9ucy5uYW1lfSIgcmVxdWlyZWQ9IiR7b3B0aW9ucy5yZXF1aXJlZD8ndHJ1ZSc6J2ZhbHNlJ30iIGRhdGEtb3B0aW9ucz0nZGlzYWJsZWQ6JHtvcHRpb25zLmRpc2FibGVkPyd0cnVlJzonZmFsc2UnfSwke3RoaXMuZXZlbnRIYW5kbGVycyhvcHRpb25zKX0nIGNsYXNzPSJlYXN5dWktJHt0aGlzLnVpVHlwZXNbb3B0aW9ucy50eXBlXX0iICR7b3B0aW9ucy5jaGVja2VkPydjaGVja2VkJzonJ30gLz5gOwoJfQoKCWxhYmVsKG9wdGlvbnMpIHsKCQlyZXR1cm4gYDxzcGFuIGlkPSIke3RoaXMucHJlZml4KG9wdGlvbnMpfSR7b3B0aW9ucy5uYW1lfSIgc3R5bGU9IndpZHRoOiR7dGhpcy5jV2lkdGgob3B0aW9ucyl9cHgiIGRhdGEtb3B0aW9ucz0iZGlzYWJsZWQ6JHtvcHRpb25zLmRpc2FibGVkPyd0cnVlJzonZmFsc2UnfSI+JHt0aGlzLnZhbHVlKG9wdGlvbnMpfTwvc3Bhbj5gOwoJfQoKCXVybChvcHRpb25zKSB7CgkJcmV0dXJuIHRoaXMuc3RyaW5nKG9wdGlvbnMpLnJlcGxhY2UoIkZpZWxkQ2hhbmdlIiwgIlVSTENoYW5nZSIpOwoJfQoKCXRleHQob3B0aW9ucykgewoJCXJldHVybiBgPGlucHV0IGlkPSIke3RoaXMucHJlZml4KG9wdGlvbnMpfSR7b3B0aW9ucy5uYW1lfSIgY2xhc3M9ImVhc3l1aS0ke29wdGlvbnMuZWRpdG9yIHx8IHRoaXMudWlUeXBlc1tvcHRpb25zLnR5cGVdfSIgZGF0YS1vcHRpb25zPSdkaXNhYmxlZDoke29wdGlvbnMuZGlzYWJsZWQ/J3RydWUnOidmYWxzZSd9LCR7dGhpcy5ldmVudEhhbmRsZXJzKG9wdGlvbnMpfScgbXVsdGlsaW5lPSIke29wdGlvbnMuc2ltcGxlID8gJ2ZhbHNlJyA6ICd0cnVlJ30iIHN0eWxlPSJ3aGl0ZS1zcGFjZTpwcmUtd3JhcDt3aWR0aDoke3RoaXMuY1dpZHRoKG9wdGlvbnMpfXB4O2hlaWdodDoke3RoaXMuY0hlaWdodChvcHRpb25zKX1weCIgcmVxdWlyZWQ9IiR7b3B0aW9ucy5yZXF1aXJlZCA/ICd0cnVlJyA6ICdmYWxzZSd9IiB2YWx1ZT0iJHt0aGlzLnZhbHVlKG9wdGlvbnMpfSIgLz5gOwoJfQoKCXBhc3N3b3JkKG9wdGlvbnMpIHsKCQl2YXIgcmV0ID0gdGhpcy5zdHJpbmcob3B0aW9ucyk7CgkJcmV0ID0gcmV0LnJlcGxhY2UoJzxpbnB1dCAnLCAnPGlucHV0IHR5cGU9InBhc3N3b3JkIiAnKTsKCQlyZXR1cm4gcmV0OwoJfQoKCWZpbGUob3B0aW9ucykgewoJCXJldHVybiBgPGlucHV0IGlkPSIke3RoaXMucHJlZml4KG9wdGlvbnMpfSR7b3B0aW9ucy5uYW1lfSIgY2xhc3M9ImVhc3l1aS0ke3RoaXMudWlUeXBlc1tvcHRpb25zLnR5cGVdfSIgZGF0YS1vcHRpb25zPSJvbkNoYW5nZTpmdW5jdGlvbihuLG8pe3ZhciBzID0gJCgnIycgKyB0aGlzLmlkKS5maWxlYm94KCdvcHRpb25zJyk7IERGb3JtLlVwbG9hZEZpbGUocywgREZvcm0uYnlOYW1lKCcke29wdGlvbnMubmFtZX0nKSk7fSIgc3R5bGU9IndpZHRoOiR7dGhpcy5jV2lkdGgob3B0aW9ucyl9cHgiPmA7Cgl9CgoJaW1hZ2Uob3B0aW9ucykgewoJCXJldHVybiB0aGlzLmZpbGUob3B0aW9ucykgKyBgPGRpdiBpZD0iZGxnJHtvcHRpb25zLm5hbWV9IiBjbGFzcz0iZWFzeXVpLSR7dGhpcy51aVR5cGVzW29wdGlvbnMudHlwZV19IiB0aXRsZT0iSW1hZ2UgUHJldmlldyIgZGF0YS1vcHRpb25zPSJjbG9zZWQ6dHJ1ZSxpY29uQ2xzOidpY29uLXNhdmUnLHJlc2l6YWJsZTpmYWxzZSxtb2RhbDp0cnVlIiBzdHlsZT0id2lkdGg6NDAwcHg7aGVpZ2h0OjIwMHB4O3BhZGRpbmc6MTBweCI+PGltZyBpZD0iJHt0aGlzLnByZWZpeChvcHRpb25zKX0ke29wdGlvbnMubmFtZX0iIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiLz48L2Rpdj5gOwoJfQoKCXByb2dyZXNzKG9wdGlvbnMpIHsKCQlpZiAoIW9wdGlvbnMuaGVpZ2h0KSBvcHRpb25zLmhlaWdodCA9IDIwOyAvLyBmaXggYmlnIHByb2dyZXNzCgkJcmV0dXJuIGA8ZGl2IGlkPSIke3RoaXMucHJlZml4KG9wdGlvbnMpfSR7b3B0aW9ucy5uYW1lfSIgY2xhc3M9ImVhc3l1aS0ke3RoaXMudWlUeXBlc1tvcHRpb25zLnR5cGVdfSIgZGF0YS1vcHRpb25zPSJ2YWx1ZToke3RoaXMudmFsdWUob3B0aW9ucyl9IiBzdHlsZT0id2lkdGg6JHt0aGlzLmNXaWR0aChvcHRpb25zKX1weDtoZWlnaHQ6JHt0aGlzLmNIZWlnaHQob3B0aW9ucyl9cHgiPjwvZGl2PmA7Cgl9CgoJZmxvd2NoYXJ0KG9wdGlvbnMpIHsKCQlyZXR1cm4gYDxkaXYgaWQ9ImZsdyR7b3B0aW9ucy5uYW1lfSIgd2lkdGg9IiR7dGhpcy5jV2lkdGgob3B0aW9ucyl9IiBoZWlnaHQ9IiR7dGhpcy5jSGVpZ2h0KG9wdGlvbnMpfSI+PC9kaXY+YDsKCX0KCgljaGFydChvcHRpb25zKSB7CgkJcmV0dXJuIGA8ZGl2IGlkPSJjaHQke29wdGlvbnMubmFtZX0iIHdpZHRoPSIke3RoaXMuY1dpZHRoKG9wdGlvbnMpfSIgaGVpZ2h0PSIke3RoaXMuY0hlaWdodChvcHRpb25zKX0iPjwvZGl2PmA7Cgl9CgoJZm9ybWF0dGVyKG5hbWUsIGMsIGpzb24pIHsKCQlqc29uID0ganNvbiA/ICciJyA6ICcnOwoJCXJldHVybiBgJHtqc29ufSh2YWx1ZSwgcm93LCBpbmRleCkgPT4ge3RyeXt2YXIgYyA9IChERm9ybS5ieU5hbWUoXGAke25hbWV9XGApLmNvbHVtbnMgfHwgW10pLmZpbmQoYyA9PiBjLmZpZWxkPT1cYCR7Yy5maWVsZH1cYCk7IHJldHVybiBjJiZjLmZvcm1hdD9jLmZvcm1hdCh2YWx1ZSxyb3csaW5kZXgpOnZhbHVlO31jYXRjaChleCl7cmV0dXJuIHZhbHVlO30gfSR7anNvbn1gOwoJfQoKCW1hcENvbHVtbnMob3B0aW9ucywganNvbikgewoJCWxldCBjVGl0bGUgPSBjID0+IGMudGl0bGUgfHwgdGhpcy5lbmdsaXNoKGMuZmllbGQpOwoKCQl2YXIgY29scyA9ICQuZ3JlcChvcHRpb25zLmNvbHVtbnMgfHwgW10sIGMgPT4gIWMuaWdub3JlKTsKCQlsZXQgcmV0ID0gIiI7CgkJaWYgKG9wdGlvbnMubXVsdGlwbGUpIHJldCArPSBgeyJmaWVsZCI6J2NrJywiY2hlY2tib3giOnRydWV9LGA7CgkJcmV0ID0gYCJmcm96ZW5Db2x1bW5zIjogW1tgOwoJCWlmICghb3B0aW9ucy5mcm96ZW4pIHsKCQkJcmV0ICs9IGB7ImZpZWxkIjoiJHtvcHRpb25zLmlkRmllbGQuZmllbGR9IiwidGl0bGUiOiAiJHtvcHRpb25zLmlkRmllbGQudGl0bGV9Iiwic29ydGFibGUiOiAidHJ1ZSIsICJmb3JtYXR0ZXIiOiAke3RoaXMuZm9ybWF0dGVyKG9wdGlvbnMubmFtZSwgb3B0aW9ucy5pZEZpZWxkLCBqc29uKX19LGA7CgkJCWlmIChvcHRpb25zLnRleHRGaWVsZC5maWVsZCAhPSBvcHRpb25zLmlkRmllbGQuZmllbGQpIHJldCArPSBgeyJmaWVsZCI6IiR7b3B0aW9ucy50ZXh0RmllbGQuZmllbGQgfHwgb3B0aW9ucy50ZXh0RmllbGQudGl0bGV9IiwidGl0bGUiOiIke29wdGlvbnMudGV4dEZpZWxkLnRpdGxlIHx8IG9wdGlvbnMudGV4dEZpZWxkLmZpZWxkfSIsIndpZHRoIjoiJHtvcHRpb25zLnRleHRGaWVsZC53aWR0aHx8MTIwfSIsICJzb3J0YWJsZSI6ICJ0cnVlIiwgImZvcm1hdHRlciI6ICR7dGhpcy5mb3JtYXR0ZXIob3B0aW9ucy5uYW1lLCBvcHRpb25zLnRleHRGaWVsZCwganNvbil9fWA7CgkJfSBlbHNlIHsKCQkJJC5tYXAoJC5ncmVwKGNvbHMsIGMgPT4gYy5mcm96ZW4pLCBjID0+IGB7ImZpZWxkIjoiJHtjLmZpZWxkIHx8IGNUaXRsZShjKX0iLCJ0aXRsZSI6IiR7Y1RpdGxlKGMpIHx8IGMuZmllbGR9Iiwid2lkdGgiOiIke2Mud2lkdGh8fDEyMH0iLCJhbGlnbiI6J2xlZnQnLCJzb3J0YWJsZSI6InRydWUiLCAiZm9ybWF0dGVyIjogJHt0aGlzLmZvcm1hdHRlcihvcHRpb25zLm5hbWUsIGMsIGpzb24pfX1gKS5qb2luKCIsIik7CgkJfQoJCXJldCArPSBgXV0sICJjb2x1bW5zIjogW1tgOwoJCXJldCArPSAkLm1hcCgkLmdyZXAoY29scywgYyA9PiAhYy5mcm96ZW4pLCBjID0+IGB7ImZpZWxkIjoiJHtjLmZpZWxkIHx8IGNUaXRsZShjKX0iLCJ0aXRsZSI6IiR7Y1RpdGxlKGMpIHx8IGMuZmllbGR9IiwiYWxpZ24iOiJsZWZ0Iiwic29ydGFibGUiOiJ0cnVlIiwgImZvcm1hdHRlciI6ICR7dGhpcy5mb3JtYXR0ZXIob3B0aW9ucy5uYW1lLCBjLCBqc29uKX19YCkuam9pbigiLCIpOwoJCXJldCArPSAnXV0nOwoKCQkvL2NvbnNvbGUubG9nKCJEeW5hRm9ybTo6bWFwQ29sdW1ucygiICsgb3B0aW9ucy5uYW1lICsgIik6ICIsIHJldCwganNvbik7CgkJcmV0dXJuIHJldDsKCX0KCglzZWxlY3Qob3B0aW9ucywgdGFnID0gb3B0aW9ucy50YWcsIHR5cGUpIHsKCQlyZXR1cm4gdGhpcy5jb21ibyhvcHRpb25zLCB0YWcsIHR5cGUpOwoJfQoKCXRyZWUob3B0aW9ucykgewoJCXJldHVybiB0aGlzLnNlbGVjdChvcHRpb25zLCAic2VsZWN0Iik7Cgl9CgoJbmF2aWdhdGlvbihvcHRpb25zKSB7CgkJcmV0dXJuIHRoaXMuY29tYm8ob3B0aW9ucywgJ3VsJywgJ3RyZWUnKTsKCX0KCgljb21ibyhvcHRpb25zLCB0YWcsIHR5cGUpIHsKCQl2YXIgY29scyA9ICQuZ3JlcChvcHRpb25zLmNvbHVtbnMgfHwgW10sIGMgPT4gIWMuaWdub3JlKTsKCQl0YWcgPSB0YWcgfHwgInNlbGVjdCI7CgoJCW9wdGlvbnMuaWRGaWVsZCA9ICQudW5pcXVlU29ydChbewoJCQlmaWVsZDogb3B0aW9ucy5pZEZpZWxkLAoJCQl0aXRsZTogb3B0aW9ucy5pZEZpZWxkCgkJfV0uY29uY2F0KCQuZ3JlcChjb2xzLCBjID0+IGMucHJpbWFyeSksIFt7CgkJCWZpZWxkOiAnSWQnLAoJCQl0aXRsZTogJ0lEJwoJCX1dKSkuZmluZCh4ID0+IHR5cGVvZih4LmZpZWxkKSAhPT0gInVuZGVmaW5lZCIpOwoKCQlvcHRpb25zLnRleHRGaWVsZCA9ICQudW5pcXVlU29ydChbewoJCQlmaWVsZDogb3B0aW9ucy50ZXh0RmllbGQsCgkJCXRpdGxlOiBvcHRpb25zLnRleHRGaWVsZAoJCX1dLmNvbmNhdCgkLmdyZXAoY29scywgYyA9PiBjLmRpc3BsYXkpLCBbewoJCQlmaWVsZDogJ19Ub1N0cmluZycsCgkJCXRpdGxlOiBvcHRpb25zLm5hbWUsCgkJfV0pKS5maW5kKHggPT4gdHlwZW9mKHguZmllbGQpICE9PSAidW5kZWZpbmVkIik7CgoJCS8vY29uc29sZS5sb2coIkR5bmFGb3JtOjpjb21ibygpOiBvcHRpb25zIiwgb3B0aW9ucyk7CgoJCXZhciBmdW4gPSB0eXBlIHx8IHRoaXMuZUZ1bihvcHRpb25zKTsKCgkJdmFyIGRyb3Bkb3duID0gWydjb21ib3RyZWVncmlkJywgJ2NvbWJvdHJlZScsICdjb21ib2dyaWQnLCAnc2VsZWN0J10uaW5kZXhPZihmdW4pID4gLTE7CgkJaWYgKGRyb3Bkb3duKSB0aGlzLnNlbGVjdHMucHVzaCh7CgkJCWlkOiAiY21iIiArIG9wdGlvbnMubmFtZSwKCQkJb3B0aW9uczogdGhpcy5ieU5hbWUob3B0aW9ucy5uYW1lKQoJCX0pOwoJCXRoaXMuc2VsZWN0cyA9ICQudW5pcXVlU29ydCh0aGlzLnNlbGVjdHMpOwoJCXZhciByZXQgPSBgPCR7dGFnfSBpZD0iY21iJHtvcHRpb25zLm5hbWV9IiBjbGFzcz0iZWFzeXVpLSR7ZnVufSIgc3R5bGU9Im1heC13aWR0aDoke2Ryb3Bkb3duPyc0MDBweCc6dGhpcy5jV2lkdGgob3B0aW9ucyl9OyB3aWR0aDoke3RoaXMuY1dpZHRoKG9wdGlvbnMpfXB4IiByZXF1aXJlZD0iJHsob3B0aW9ucy5yZXF1aXJlZCA/ICd0cnVlJyA6ICdmYWxzZScpfSIgZGF0YS1vcHRpb25zPSdkaXNhYmxlZDoke29wdGlvbnMuZGlzYWJsZWQ/J3RydWUnOidmYWxzZSd9LCR7dGhpcy5ldmVudEhhbmRsZXJzKG9wdGlvbnMpfSwgdmFsdWU6IiR7dGhpcy52YWx1ZShvcHRpb25zKX0iLCByb3dudW1iZXJzOiR7dHlwZW9mKG9wdGlvbnMucm93TnVtYmVycykhPT0ndW5kZWZpbmVkJz9vcHRpb25zLnJvd051bWJlcnM6KGZ1bi5pbmRleE9mKCd0cmVlJyk8LTE/J2ZhbHNlJzondHJ1ZScpfSwgcGFnaW5hdGlvbjoke3R5cGVvZihvcHRpb25zLnBhZ2luYXRpb24pIT09J3VuZGVmaW5lZCc/b3B0aW9ucy5wYWdpbmF0aW9uOihmdW4uaW5kZXhPZigndHJlZScpPC0xPydmYWxzZSc6J3RydWUnKX0sIHBhbmVsV2lkdGg6JHsyKnRoaXMuY1dpZHRoKG9wdGlvbnMpfSwgZml0Q29sdW1uczogdHJ1ZSwgc2luZ2xlU2VsZWN0OiB0cnVlLCBtdWx0aXBsZTokeyhvcHRpb25zLm11bHRpcGxlIHx8ICdmYWxzZScpfSwgaWRGaWVsZDogIiR7b3B0aW9ucy5pZEZpZWxkLmZpZWxkfSIsIGVuYWJsZUZpbHRlcjogJHtvcHRpb25zLmZpbHRlcj8ndHJ1ZSc6J2ZhbHNlJ30sIG5vd3JhcDogZmFsc2UsIHRleHRGaWVsZDogIiR7b3B0aW9ucy50ZXh0RmllbGQuZmllbGR9IiwgdHJlZUZpZWxkOiAiJHtvcHRpb25zLnRleHRGaWVsZC5maWVsZH0iLGA7CgkJaWYgKGZ1bi5pbmRleE9mKCd0cmVlJykgPT0gLTEpIHsKCQkJcmV0ICs9ICdmaXRDb2x1bW5zOiBmYWxzZSwnICsgdGhpcy5tYXBDb2x1bW5zKG9wdGlvbnMpOwoJCX0KCQlpZiAob3B0aW9ucy5kYXRhKSB7CgkJCXJldCArPSBgLGRhdGE6ICR7SlNPTi5zdHJpbmdpZnkob3B0aW9ucy5kYXRhKX1gOwoJCX0KCQlyZXQgKz0gYCc+YDsKCQlpZiAob3B0aW9ucy5vcHRpb25zKSB7CgkJCXJldCArPSAkLm1hcChvcHRpb25zLm9wdGlvbnMsIG8gPT4gYDxvcHRpb24gdmFsdWU9JyR7X0ZyRU1ELl90b0pTKG8pfSc+JHtvLm5hbWUgfHwgb308L29wdGlvbj5gKS5qb2luKCdcbicpOwoJCX0KCQlyZXQgKz0gYDwvJHt0YWd9PmA7CgoJCXJldCArPSB0aGlzLmxpbmtzKG9wdGlvbnMpOwoKCQkvLyBjb25zb2xlLmxvZyhyZXQpOwoJCXJldHVybiByZXQ7Cgl9CgoJZ3JpZChvcHRpb25zLCB0YWcsIHR5cGUpIHsKCQlyZXR1cm4gdGhpcy5jb21ibyhvcHRpb25zLCAidGFibGUiLCAiZGF0YWdyaWQiKTsKCX0KCgl0cmVlZ3JpZChvcHRpb25zKSB7CgkJcmV0dXJuIHRoaXMuY29tYm8ob3B0aW9ucywgJ3RhYmxlJywgJ3RyZWUnKTsKCX0KCglhc3luYyBkb0xpbmsoZSwgZXZlbnQpIHsKCQl0aGlzLmJ1c3kodHJ1ZSk7CgkJdHJ5IHsKCQkJYXdhaXQgZS5saW5rcy5maW5kKGwgPT4gbC5sYWJlbCA9PSBldmVudC50YXJnZXQuaW5uZXJUZXh0KS5vbkNsaWNrKHRoaXMuZ2V0KCkpOwoJCX0gY2F0Y2ggKGV4KSB7CgkJCWNvbnNvbGUubG9nKCJEeW5hRm9ybTo6ZG9MaW5rKCk6IEV4Y2VwdGlvbjogIiArIGV4KTsKCQl9CgkJdGhpcy5idXN5KGZhbHNlKTsKCX0KCglFZGl0ZWRWYWx1ZShlKSB7CgkJcmV0dXJuICh0eXBlb2YoYWNlKSAhPT0gInVuZGVmaW5lZCIpID8gYWNlLmVkaXQoJ3BubCcgKyBlLm5hbWUpLnNlc3Npb24uZ2V0VmFsdWUoKSA6ICcnOwoJfQoKCWFzeW5jIFBhbk9uQ2xvc2UoZSkgewoJCWlmIChlLmVkaXRvcikgewoJCQllLnZhbHVlID0gdGhpcy5FZGl0ZWRWYWx1ZShlKTsKCQl9CgkJaWYgKGUuY2xvc2UpIHsKCQkJYXdhaXQgZS5jbG9zZSh0aGlzLmdldCgpKTsKCQl9Cgl9CgoJYXN5bmMgUGVuZEFmdGVyT3BlbihlKSB7CgkJaWYgKGUuZWRpdG9yICYmIHR5cGVvZihhY2UpICE9PSAidW5kZWZpbmVkIikgewoJCQlhd2FpdCBfRnJFTUQuT3BlbkVkaXRvcigncG5sJyArIGUubmFtZSAvKisgJy1jZW50ZXInKi8gLCBlLmxhbmd1YWdlLCBlLmxvYWRlciB8fCAobyA9PiBlLnZhbHVlKSwgZS5zYXZlciwgdGhpcy5nZXQoKSwgZSk7CgkJfQoJCWlmIChlLm9wZW4pIHsKCQkJYXdhaXQgZS5vcGVuKHRoaXMuZ2V0KCkpOwoJCX0KCX0KCglsaW5rcyhvcHRpb25zKSB7CgkJcmV0dXJuIChvcHRpb25zLmxpbmtzIHx8IFtdKS5maWx0ZXIobCA9PiAhbC5pZ25vcmUpLnJldmVyc2UoKS5tYXAobCA9PiBgPGEgaHJlZj0iamF2YXNjcmlwdDp2b2lkKDApIiBzdHlsZT0iY29sb3I6YmxhY2siIGNsYXNzPSJmYXMgZmEtJHtsLmljb24gfHwgJ2FkZCd9IiBvbmNsaWNrPScoYXN5bmMgKCkgPT4ge3ZhciBhID0gJHtfRnJFTUQuX3RvSlMobCl9OyAkKCIjcG5sJHtvcHRpb25zLm5hbWV9Iikud2luZG93KCJzZXRUaXRsZSIsICIke29wdGlvbnMudGl0bGV9OiAiICsgYS5uYW1lKTsgYXdhaXQgYS5hY3Rpb24oREZvcm0uZ2V0KCksIGEsICR7X0ZyRU1ELl90b0pTKG9wdGlvbnMpfSk7ICQoIiNwbmwke29wdGlvbnMubmFtZX0iKS53aW5kb3coInNldFRpdGxlIiwgIiR7b3B0aW9ucy50aXRsZX0iKTt9KSgpJz48L2E+YCkuam9pbignXG4nKTsKCX0KCglsaW5rKG9wdGlvbnMpIHsKCQlyZXR1cm4gKG9wdGlvbnMubGlua3MgfHwgW10pLmZpbHRlcihsID0+ICFsLmlnbm9yZSkubWFwKGwgPT4gYDxhIGhyZWY9IiMiIGNsYXNzPSJlYXN5dWktJHt0aGlzLnVpVHlwZXNbb3B0aW9ucy50eXBlXX0iIGRhdGEtb3B0aW9ucz0nJHt0aGlzLmV2ZW50SGFuZGxlcnMob3B0aW9ucyl9LCBpY29uQ2xzOiJpY29uLSR7bC5pY29uIHx8ICdvayd9Iic+JHtsLmxhYmVsIHx8ICcnfTwvYT5gKS5qb2luKCdcbicpOwoJfQoKCWFzeW5jIFNldFRyZWVEYXRhKGUsIG4sIGRhdGEpIHsKCQkkLmVhY2goJCgiI2NtYiIgKyBlLm5hbWUpW3RoaXMuZUZ1bihlKV0oJ3RyZWUnKS50cmVlKCJnZXRDaGlsZHJlbiIsIG4udGFyZ2V0KSwgKF8sIGMpID0+ICQoIiNjbWIiICsgZS5uYW1lKVt0aGlzLmVGdW4oZSldKCd0cmVlJykudHJlZSgicmVtb3ZlIiwgYy50YXJnZXQpKTsKCQkkKCIjY21iIiArIGUubmFtZSlbdGhpcy5lRnVuKGUpXSgndHJlZScpLnRyZWUoImFwcGVuZCIsIHsKCQkJcGFyZW50OiBuLnRhcmdldCwKCQkJZGF0YTogZGF0YQoJCX0pOwoJCXJldHVybiB0cnVlOwoJfQoKCWFzeW5jIEV4cGFuZChlLCBuKSB7CgkJdGhpcy5TZXRUcmVlRGF0YShlLCBuLCBbewoJCQlpZDogbnVsbCwKCQkJdGV4dDogImxvYWRpbmcuLi4iCgkJfV0pOwoJCXZhciBvYmogPSB7fTsKCQl2YXIgcEZpZWxkID0gZS5wYXJlbnRGaWVsZCB8fCAkLm1hcCgkLmdyZXAoZS5jb2x1bW5zIHx8IFtdLCBjID0+IGMucGFyZW50KSwgYyA9PiBjLmZpZWxkKS5jb25jYXQoW251bGxdKVswXTsKCQl2YXIgaWRGaWVsZCA9ICQuZ3JlcChlLmNvbHVtbnMgfHwgW10sIGMgPT4gYy5wcmltYXJ5KS5jb25jYXQoZS5pZEZpZWxkKVswXS5maWVsZDsKCQlpZiAocEZpZWxkKSB7CgkJCW9ialtwRmllbGRdID0gewoJCQkJX3NvdXJjZTogbi5fc291cmNlCgkJCX07CgkJCWlmIChpZEZpZWxkKSB7CgkJCQlvYmpbcEZpZWxkXVtpZEZpZWxkXSA9IG4uaWQ7CgkJCX0gZWxzZSB7CgkJCQlvYmpbcEZpZWxkXSA9IG4uaWQ7CgkJCX0KCQl9CgkJbGV0IGRhdGEgPSBhd2FpdCB0aGlzLl9sb2FkRGF0YSh7CgkJCWlkOiAiY21iIiArIGUubmFtZSwKCQkJb3B0aW9uczogZQoJCX0sIG9iaik7CgkJdGhpcy5TZXRUcmVlRGF0YShlLCBuLCBkYXRhKTsKCX0KCglhc3luYyBfbG9hZERhdGEocywgbywgc3RhcnQsIGVuZCkgewoJCXZhciBuYW1lID0gKHMgJiYgcy5vcHRpb25zID8gKHMub3B0aW9ucy5DbGFzcyA/IHMub3B0aW9ucy5DbGFzcy5OYW1lLnJlcGxhY2UoJyAnLCAnXycpIDogKHMub3B0aW9ucy50YWJsZSB8fCBzLm9wdGlvbnMubmFtZSkpIDogcy5uYW1lKTsKCQluYW1lID0gbmFtZS50cmltKCk7IC8vLnNwbGl0KCcuJykuc2xpY2UoLTEpWzBdOwoKCQlsZXQgb1Njb3BlID0gKHR5cGVvZihjb21wYW55KSAhPT0gJ3VuZGVmaW5lZCcgJiYgY29tcGFueS5TY29wZSkgPyB3aW5kb3dbY29tcGFueS5TY29wZV0gOiB3aW5kb3c7CgkJLy9jb25zb2xlLmxvZygiRHluYUZvcm06Ol9sb2FkRGF0YSgpOiBvU2NvcGUiLCBvU2NvcGUpOwoKCQlvID0gbyB8fCAoKG9TY29wZSAmJiBvU2NvcGVbbmFtZV0pID8gbmV3IG9TY29wZVtuYW1lXSgpIDogewoJCQlBY3RpdmU6IHRydWUsCgkJfSk7CgoJCW8gPSAodHlwZW9mIGZpbHRlcnMgIT09ICJ1bmRlZmluZWQiICYmIGZpbHRlcnMgJiYgZmlsdGVyc1tuYW1lXSkgPyBmaWx0ZXJzW25hbWVdKG8pIDogbzsKCQl2YXIgZnVuID0gdGhpcy5lRnVuKHMub3B0aW9ucyk7CgkJbGV0IHNUZXh0ID0gJCgiIyIgKyBzLmlkKVtmdW5dKCdnZXRUZXh0Jyk7CgoJCW8gPSAocyAmJiBzLm9wdGlvbnMgJiYgcy5vcHRpb25zLnNvdXJjZSkgPyBzLm9wdGlvbnMuc291cmNlKG8sIHRoaXMuZ2V0KCksIHNUZXh0KSA6IG87CgkJbGV0IG5hbWVzID0gJC51bmlxdWVTb3J0KFtzLm9wdGlvbnMuc2VhcmNoRmllbGRdLmNvbmNhdCgkLm1hcCgkLmdyZXAocy5vcHRpb25zLmNvbHVtbnMgfHwgW10sIGMgPT4gYy5zZWFyY2gpLCBjID0+IGMuZmllbGQpLCBbIk5hbWUiXSkpLmZpbHRlcih2ID0+IHYpOwoJCWlmICghb1tuYW1lc1swXV0pIG9bbmFtZXNbMF1dID0gc1RleHQ7CgkJLy9jb25zb2xlLmxvZygiRHluYUZvcm06Ol9sb2FkRGF0YSgpOiBvIiwgbyk7CgkJdmFyIGRhdGEgPSBudWxsOwoKCQlsZXQgbGliID0gJyc7CgkJaWYgKG5hbWUuaW5kZXhPZignLicpID4gMCkgewoJCQlsaWIgPSBuYW1lLnNwbGl0KCcuJylbMF0gKyAnLic7CgkJCW5hbWUgPSBuYW1lLnNwbGl0KCcuJylbMV07CgkJfQoKCQlpZiAocy5vcHRpb25zLmxvYWRlcikgewoJCQlkYXRhID0gYXdhaXQgcy5vcHRpb25zLmxvYWRlcih0aGlzLmdldCgpLCBzLm9wdGlvbnMsIG8sIHNUZXh0KTsKCQl9IGVsc2UgaWYgKG8gJiYgdHlwZW9mKG8uZmluZEFsbCkgPT09ICdmdW5jdGlvbicpIHsKCQkJZGF0YSA9IGF3YWl0IG8uZmluZEFsbCgpOwoJCX0gZWxzZSBpZiAodHlwZW9mKGNvbXBhbnkpICE9PSAndW5kZWZpbmVkJyAmJiBjb21wYW55LmxpYnJhcnkgJiYgY29tcGFueS5Db2RlICYmIHdpbmRvdy5iTG9jYWwpIHsKCQkJLy9jb25zb2xlLmxvZygiREZvcm06Ol9sb2FkRGF0YSgpOiBzcigpLl8oIiArIGxpYiArIGNvbXBhbnkuQ29kZS50b0xvd2VyQ2FzZSgpICsgbmFtZSArICJGaW5kYWxsIiArICIpIiwgbyk7CgkJCWRhdGEgPSBhd2FpdCB0aGlzLnNyKCkuXyhsaWIgKyBjb21wYW55LkNvZGUudG9Mb3dlckNhc2UoKSArIG5hbWUgKyAiRmluZGFsbCIsIG51bGwsIG8sIG51bGwsIHN0YXJ0LCBlbmQpOwoJCX0gZWxzZSBpZiAoX0ZyRU1ELmFwaVNlcnZlcikgewoJCQlvID0gT2JqZWN0LmFzc2lnbiguLi5PYmplY3Qua2V5cyhvKS5tYXAoayA9PiAoewoJCQkJW1N0cmluZyhrKS5jaGFyQXQoMCkudG9Mb3dlckNhc2UoKSArIFN0cmluZyhrKS5zbGljZSgxKV06IG9ba10KCQkJfSkpKTsKCQkJLy9jb25zb2xlLmxvZygiREZvcm06Ol9sb2FkRGF0YSgpOiB1c2luZyBfRnJFTUQuYXBpU2VydmVyOiBvIiwgbyk7CgkJCWRhdGEgPSBhd2FpdCBfRnJFTUQuYXBpU2VydmVyLl9uZXcobmFtZSkuX2Zyb21Eb2N1bWVudChvKS5maW5kQWxsKCk7CgkJCS8vZGF0YS5maWx0ZXIoZCA9PiBkLklkICE9IGQuSWQpLmZvckVhY2goZCA9PiBkLklkID0gZC5fdXVpZChudWxsLCBudWxsLCB0cnVlKSk7CgkJfQoKCQlpZiAocy5vcHRpb25zLnBvc3Rsb2FkKSB7CgkJCWF3YWl0IHMub3B0aW9ucy5wb3N0bG9hZChkYXRhKTsKCQl9CgkJJC5lYWNoKGRhdGEsIChpLCBkKSA9PiB7CgkJCWQuX19PV05FUiA9IHM7CgkJCSQuZWFjaChzLm9wdGlvbnMuY29sdW1ucywgKF8sIGMpID0+IHsKCQkJCWlmIChjLnZhbHVlKSB7CgkJCQkJZFtjLmZpZWxkXSA9IGMudmFsdWUoZCwgZGF0YSwgaSk7CgkJCQl9CgkJCX0pOwoJCX0pOwoJCWlmICghcy5vcHRpb25zLmNvbHVtbnMgJiYgZnVuLmluZGV4T2YoJ3RyZWUnKSA+IC0xKSB7CgkJCWRhdGEgPSAkLm1hcChkYXRhLCBkID0+IHsKCQkJCWxldCByZXQgPSB7CgkJCQkJaWQ6IGRbcy5vcHRpb25zLmlkRmllbGQuZmllbGRdLAoJCQkJCXRleHQ6IGRbcy5vcHRpb25zLnRleHRGaWVsZC5maWVsZF0sCgkJCQkJc3RhdGU6IGQuc3RhdGUgfHwgKHMub3B0aW9ucy5sb2FkZXIgPyAiZmlsZSIgOiAiY2xvc2VkIiksCgkJCQkJX3NvdXJjZTogZCwKCQkJCX07CgkJCQlyZXQuY2hpbGRyZW4gPSAocmV0LnN0YXRlID09ICJjbG9zZWQiKSA/IFt7CgkJCQkJdGV4dDogJ2xvYWRpbmcuLi4nCgkJCQl9XSA6IG51bGw7CgkJCQlyZXR1cm4gcmV0OwoJCQl9KTsKCQl9CgkJcmV0dXJuIGRhdGEgfHwgW107Cgl9CgoJYXN5bmMgZmlsbERhdGEoZywgbywgc3RhcnQsIGVuZCkgewoJCXZhciBzID0gbnVsbDsKCQlmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuc2VsZWN0cy5sZW5ndGg7IGkrKykgewoJCQlpZiAodGhpcy5zZWxlY3RzW2ldLmlkID09IGdbMF0uaWQpIHMgPSB0aGlzLnNlbGVjdHNbaV07CgkJfQoJCWlmICghcykgcmV0dXJuOwoJCXRoaXMuYnVzeSh0cnVlKTsKCQl0cnkgewoJCQl2YXIgZnVuID0gZ1swXS5jbGFzc0xpc3RbIjAiXS5yZXBsYWNlKCdlYXN5dWktJywgJycpOwoJCQl0cnkgewoJCQkJJCgiIyIgKyBzLmlkKVtmdW5dKCdncmlkJykuZGF0YWdyaWQoJ2dldFBhZ2VyJykucGFnaW5hdGlvbignbG9hZGluZycpOwoJCQl9IGNhdGNoIChleCkge30KCQkJaWYgKHMub3B0aW9ucy5ub2xvYWQpIHsKCQkJCWxldCBfZGF0YSA9IG51bGw7CgkJCQl0cnkgewoJCQkJCV9kYXRhID0gJCgiIyIgKyBzLmlkKVtmdW5dKCdncmlkJykuZGF0YWdyaWQoImdldERhdGEiKTsKCQkJCX0gY2F0Y2ggKGV4KSB7CgkJCQkJX2RhdGEgPSAkKCIjIiArIHMuaWQpW2Z1bl0oJ3RyZWUnKS50cmVlKCdnZXRSb290Jyk7CgkJCQl9CgkJCQlpZiAoX2RhdGEpIHsKCQkJCQlyZXR1cm4gdGhpcy5idXN5KGZhbHNlKTsKCQkJCX0KCQkJfQoJCQl2YXIgZGF0YSA9IGF3YWl0IHRoaXMuX2xvYWREYXRhKHMsIG8sIHN0YXJ0LCBlbmQpOwoJCQl0cnkgewoJCQkJaWYgKCQoIiMiICsgcy5pZClbZnVuXSgnZ3JpZCcpKSAkKCIjIiArIHMuaWQpW2Z1bl0oJ2dyaWQnKS5kYXRhZ3JpZCgnZ2V0UGFnZXInKS5wYWdpbmF0aW9uKCdsb2FkZWQnKTsKCQkJfSBjYXRjaCAoZXgpIHt9CgkJCXRyeSB7CgkJCQkkKCIjIiArIHMuaWQpW2Z1bl0oJ2dyaWQnKS5kYXRhZ3JpZCgnbG9hZERhdGEnLCB7CgkJCQkJdG90YWw6IGRhdGEuQ291bnQgfHwgZGF0YS5sZW5ndGgsCgkJCQkJcm93czogZGF0YSwKCQkJCX0pOwoJCQl9IGNhdGNoIChleCkgewoJCQkJJCgiIyIgKyBzLmlkKVtmdW5dKCd0cmVlJykudHJlZSgnbG9hZERhdGEnLCBkYXRhKTsKCQkJfQoJCX0gY2F0Y2ggKGV4KSB7CgkJCWNvbnNvbGUubG9nKGV4KTsKCQl9CgkJdGhpcy5idXN5KGZhbHNlKTsKCX0KCglldmVudEhhbmRsZXJzKG9wdGlvbnMpIHsKCQkvL2NvbnNvbGUubG9nKCJEeW5hRm9ybTo6ZXZlbnRIYW5kbGVycygpOiBvcHRpb25zIiwgb3B0aW9ucyk7CgkJaWYgKCF0aGlzLmJ5TmFtZShvcHRpb25zLm5hbWUpKSByZXR1cm47IC8vIGlmIG5vdCBhbiBlbGVtZW50LCBkbyBub3QgcnVuIHRoZSBoYW5kbGVycwoKCQlyZXR1cm4gdGhpcy5ldmVudHMuZmlsdGVyKGUgPT4gZS50eXBlID09IG9wdGlvbnMudHlwZSB8fCB0eXBlb2YoZS50eXBlKSA9PT0gJ3VuZGVmaW5lZCcpLm1hcChlID0+IGAke2UubmFtZX06ICgke2UucGFyYW1zIHx8ICcnfSkgPT4ge3RyeXtERm9ybS4ke2UuaGFuZGxlcn0oREZvcm0uYnlOYW1lKCIke29wdGlvbnMubmFtZX0iKSB8fCAke19GckVNRC5fdG9KUyhvcHRpb25zKX0gfHwge25hbWU6ICIke29wdGlvbnMubmFtZX0iLHR5cGU6ICIke29wdGlvbnMudHlwZX0ifSwgJHtlLnBhcmFtc30pfWNhdGNoKGV4KXtjb25zb2xlLmxvZygiRXZlbnQgRXJyb3I6ICR7b3B0aW9ucy5uYW1lfS8ke29wdGlvbnMudHlwZX0vJHtlLm5hbWV9IiwgZXgpO319YCkuam9pbignLCcpOwoJfQoKCWFzeW5jIFBhbmVsT3BlbihlKSB7CgkJaWYgKGUuZWRpdG9yKSByZXR1cm4gdHJ1ZTsKCQlsZXQgY29udGVudCA9IGUudmFsdWU7CgkJaWYgKGUubG9hZGVyKSB7CgkJCWNvbnRlbnQgPSBhd2FpdCBlLmxvYWRlcih0aGlzLmdldCgpKTsKCQl9CgkJaWYgKGNvbnRlbnQpIHsKCQkJdHJ5IHsKCQkJCSQoIiNwbmwiICsgZS5uYW1lKS5wYW5lbCgnYm9keScpLmh0bWwoY29udGVudCk7CgkJCQljb25zb2xlLmxvZygicG5sIiArIGUubmFtZSArICI6IENvbnRlbnQgVmFsaWQiKTsKCQkJfSBjYXRjaCAoZXgpIHsKCQkJCS8vY29uc29sZS5sb2coZXgpOwoJCQl9CgkJfQoJCXJldHVybiBjb250ZW50OwoJfQoKCWFzeW5jIFNlbGVjdENoYW5nZShvcHRpb25zLCB0YWIpIHsKCQl0aGlzLmJ1c3kodHJ1ZSk7CgkJJC5ncmVwKHRoaXMuZWxlbWVudHMsIGUgPT4gZS50eXBlID09ICJncmlkIiAmJiBlLmdyb3VwID09IHRhYikuZm9yRWFjaChlID0+ICQoIiNjbWIiICsgZS5uYW1lKS5kYXRhZ3JpZCgpKTsKCQl0aGlzLmJ1c3koZmFsc2UpOwoJfQoKCWFzeW5jIEZpZWxkQ2hhbmdlKG9wdGlvbnMsIHZhbHVlKSB7CgkJdGhpcy5idXN5KHRydWUpOwoJCWlmIChvcHRpb25zICYmIG9wdGlvbnMuY2hhbmdlKSB7CgkJCWF3YWl0IG9wdGlvbnMuY2hhbmdlKHRoaXMuZ2V0KCksIHZhbHVlKTsKCQl9CgkJdGhpcy5idXN5KGZhbHNlKTsKCX0KCglhc3luYyBVUkxDaGFuZ2Uocywgb3B0aW9ucykgewoJCW9wdGlvbnMuZGF0YSA9IGF3YWl0ICQuZ2V0KHMudmFsdWUpOwoJCXJldHVybiBhd2FpdCB0aGlzLkZpZWxkQ2hhbmdlKHMsIG9wdGlvbnMpOwoJfQoKCWFzeW5jIFVwbG9hZEZpbGUoZiwgb3B0aW9ucykgewoJCXRoaXMuYnVzeSh0cnVlKTsKCQl2YXIgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEoKTsKCQl2YXIgZmlsZWlkID0gTWF0aC5yYW5kb20oKTsKCQl2YXIgbWV0aG9kID0gb3B0aW9ucy5tZXRob2QgfHwgIkNvbnRlbnRNYW5hZ2VyLmNtc1VwbG9hZEZpbGUiOwoJCWZvcm1EYXRhLmFwcGVuZCgnZmlsZWlkJywgZmlsZWlkKTsKCQl2YXIgZmlsZSA9ICQoIiMiICsgZi5maWxlYm94SWQpWzBdLmZpbGVzWzBdOwoJCWZvcm1EYXRhLmFwcGVuZCgnX19VRklMRScsIGZpbGUpOwoJCWlmIChvcHRpb25zLmxvY2FsKSB7CgkJCS8vIGhhbmRsaW5nIHRoZSBmaWxlIGxvY2FsbHkKCQkJdmFyIHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7CgkJCXJlYWRlci5vbmxvYWQgPSBhc3luYyAoZSkgPT4gewoJCQkJdmFyIGRhdGEgPSBlLnRhcmdldC5yZXN1bHQ7CgoJCQkJbGV0IGZFeHQgPSBmLnZhbHVlLnNwbGl0KCcuJylbMV07CgkJCQlsZXQgZkxvYWRlciA9IG51bGw7CgkJCQlsZXQgZkRhdGEgPSBudWxsOwoKCQkJCWlmICgoZkV4dCA9PSAneG1sJyB8fCBvcHRpb25zLnhtbCkgJiYgdHlwZW9mKGZhc3RYTUwpICE9PSAndW5kZWZpbmVkJykgewoJCQkJCWZEYXRhID0gbmV3IGZhc3RYTUwuWE1MUGFyc2VyKHsKCQkJCQkJaWdub3JlQXR0cmlidXRlczogZmFsc2UKCQkJCQl9KS5wYXJzZShkYXRhKTsKCQkJCQlmTG9hZGVyID0gb3B0aW9ucy54bWw7CgkJCQl9IGVsc2UgaWYgKChmRXh0ID09ICd4bHN4JyB8fCBvcHRpb25zLmV4Y2VsKSAmJiB0eXBlb2YoRXhjZWxKUykgIT09ICd1bmRlZmluZWQnKSB7CgkJCQkJLy8gZGF0YSBpcyBhbiBleGNlbCBiaW5hcnkgZmlsZQoJCQkJCWNvbnN0IHdiID0gbmV3IEV4Y2VsSlMuV29ya2Jvb2soKTsKCQkJCQlsZXQgd29ya2Jvb2sgPSBhd2FpdCB3Yi54bHN4LmxvYWQoZGF0YSk7CgkJCQkJbGV0IGFyRGF0YSA9IHt9OwoJCQkJCXdvcmtib29rLmVhY2hTaGVldCgoc2hlZXQsIGlkKSA9PiB7CgkJCQkJCWxldCBjb2x1bW5zID0gW107CgkJCQkJCWZvciAodmFyIGkgPSAwOyBzaGVldC5nZXRDZWxsKFN0cmluZy5mcm9tQ2hhckNvZGUoJ0EnLmNoYXJDb2RlQXQoMCkgKyBpKSArICcxJykudmFsdWU7IGkrKykgY29sdW1ucy5wdXNoKHNoZWV0LmdldENlbGwoU3RyaW5nLmZyb21DaGFyQ29kZSgnQScuY2hhckNvZGVBdCgwKSArIGkpICsgJzEnKS52YWx1ZSk7CgoJCQkJCQlsZXQgckRhdGEgPSBbXTsKCQkJCQkJZm9yICh2YXIgaiA9IDI7IHNoZWV0LmdldENlbGwoIkEiICsgaikudmFsdWU7IGorKykgewoJCQkJCQkJckRhdGEucHVzaChPYmplY3QuYXNzaWduKC4uLmNvbHVtbnMubWFwKChjLCBpKSA9PiAoewoJCQkJCQkJCVtjXTogc2hlZXQuZ2V0Q2VsbChTdHJpbmcuZnJvbUNoYXJDb2RlKCdBJy5jaGFyQ29kZUF0KDApICsgaSkgKyBqKS52YWx1ZQoJCQkJCQkJfSkpKSk7CgkJCQkJCX0KCgkJCQkJCWFyRGF0YVtzaGVldC5uYW1lXSA9IHJEYXRhOwoJCQkJCX0pOwoJCQkJCWZEYXRhID0gYXJEYXRhOwoJCQkJCWZMb2FkZXIgPSBvcHRpb25zLmV4Y2VsOwoJCQkJfQoKCQkJCURGb3JtLmJ5TmFtZShvcHRpb25zLm5hbWUpLmRhdGEgPSBmRGF0YSB8fCBkYXRhOwoJCQkJYXdhaXQgKGZMb2FkZXIgfHwgb3B0aW9ucy51cGxvYWQpKHRoaXMuZ2V0KCksIGZEYXRhIHx8IGRhdGEsIGYudmFsdWUpOwoKCQkJCXRoaXMuYnVzeShmYWxzZSk7CgkJCX07CgkJCWlmIChvcHRpb25zLmJpbmFyeSkgewoJCQkJcmVhZGVyLnJlYWRBc0JpbmFyeVN0cmluZyhmaWxlKTsKCQkJfSBlbHNlIGlmIChvcHRpb25zLmRhdGF1cmwpIHsKCQkJCXJlYWRlci5yZWFkQXNEYXRhVVJMKGZpbGUpOwoJCQl9IGVsc2UgewoJCQkJcmVhZGVyLnJlYWRBc1RleHQoZmlsZSk7CgkJCX0KCQl9IGVsc2UgaWYgKG1ldGhvZCkgewoJCQkkLmFqYXgoewoJCQkJdXJsOiB0aGlzLnNyKCkuc3JVUkwgKyAiJm1ldGhvZD0iICsgbWV0aG9kICsgIiZzSW5wdXQ9IiArIGZpbGVpZCArICImcHJlVGFnPSZwb3N0VGFnPSIsCgkJCQlkYXRhOiBmb3JtRGF0YSwKCQkJCS8vIFRISVMgTVVTVCBCRSBET05FIEZPUiBGSUxFIFVQTE9BRElORwoJCQkJY2FjaGU6IGZhbHNlLAoJCQkJY29udGVudFR5cGU6IGZhbHNlLAoJCQkJdHlwZTogJ1BPU1QnLAoJCQkJcHJvY2Vzc0RhdGE6IGZhbHNlLAoJCQkJc3VjY2VzczogZGF0YSA9PiB7CgkJCQkJdGhpcy5zcigpLnJ1blNjcmlwdChkYXRhKTsKCQkJCQl0aGlzLmJ5TmFtZShvcHRpb25zLm5hbWUpLmRhdGEgPSByZXQ7CgkJCQkJaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy51cGxvYWQpIG9wdGlvbnMudXBsb2FkKHRoaXMuZ2V0KCksIHJldCk7CgkJCQkJdGhpcy5idXN5KGZhbHNlKTsKCQkJCX0KCQkJfSk7CgkJfQoJfQoKCWVGdW4oZSkgewoJCXRyeSB7CgkJCWlmIChlLnR5cGUgPT0gInRyZWUiKSB7CgkJCQlpZiAoZS5jb2x1bW5zKSB7CgkJCQkJcmV0dXJuICJjb21ib3RyZWVncmlkIjsKCQkJCX0gZWxzZSBpZiAodHlwZW9mKGUuY29tYm8pICE9PSAndW5kZWZpbmVkJyAmJiAhZS5jb21ibykgewoJCQkJCXJldHVybiAndHJlZSc7CgkJCQl9IGVsc2UgewoJCQkJCXJldHVybiAiY29tYm90cmVlIjsKCQkJCX0KCQkJfSBlbHNlIGlmIChlLnR5cGUgPT0gJ25hdmlnYXRpb24nKSB7CgkJCQlyZXR1cm4gJ3RyZWUnOwoJCQl9IGVsc2UgaWYgKGUudHlwZSA9PSAiY29tYm90cmVlIikgewoJCQkJcmV0dXJuICJjb21ib3RyZWVncmlkIjsKCQkJfSBlbHNlIGlmIChlLnR5cGUgPT0gInNlbGVjdCIgJiYgZS5vcHRpb25zKSB7CgkJCQlyZXR1cm4gImNvbWJvYm94IjsKCQkJfQoJCQlyZXR1cm4gImNvbWJvZ3JpZCI7CgkJfSBjYXRjaCAoZXgpIHsKCQkJcmV0dXJuICJjb21ib2dyaWQiOwoJCX0KCX0KCglfZmlsbFdpbmRvdyh3aW5OYW1lLCB2LCBtYXApIHsKCQl2ID0gdiB8fCB7fTsKCQltYXAgPSBtYXAgfHwge307CgkJaWYgKEFycmF5LmlzQXJyYXkobWFwKSkgewoJCQltYXAgPSBPYmplY3QuZnJvbUVudHJpZXMobmV3IE1hcChtYXApKTsKCQl9CgoJCW1hcCA9ICQuZXh0ZW5kKHt9LCBtYXAsIE9iamVjdC5mcm9tRW50cmllcyhPYmplY3Qua2V5cyh2KS5tYXAoayA9PiBbd2luTmFtZSArIGssIGtdKSkpOwoKCQlsZXQgcyA9IHt9OwoJCWZvciAodmFyIG0gaW4gbWFwKSB7CgkJCWlmICh0eXBlb2YodlttYXBbbV1dKSA9PT0gInVuZGVmaW5lZCIpIHsKCQkJCS8vY29uc29sZS5sb2coJ2lzX3VuZGVmaW5lZCcsIG0sIG1hcFttXSwgdlttYXBbbV1dKTsKCQkJCXNbbV0gPSBtYXBbbV07CgkJCX0gZWxzZSB7CgkJCQkvL2NvbnNvbGUubG9nKCdpc19ub3RfdW5kZWZpbmVkJywgbSwgbWFwW21dLCB2W21hcFttXV0pOwoJCQkJc1ttXSA9IHZbbWFwW21dXTsKCQkJfQoJCX0KCQl0aGlzLmNsZWFyKHdpbk5hbWUpOwoJCS8vY29uc29sZS5sb2coInMiLCBzKTsKCQl0aGlzLnNldChzKTsKCQkkKCIjcG5sXyIgKyB3aW5OYW1lKS53aW5kb3coIm9wZW4iKTsKCX0KCgl3aW5kb3dUb0VudGl0eShvLCBiRW1wdHksIGdyaWQsIHByZWZpeCwgZmlsdGVyKSB7CgkJbyA9IG8gfHwgdGhpcy5nZXQoKTsKCQlmaWx0ZXIgPSBmaWx0ZXIgfHwgKHYgPT4gdik7CgkJbGV0IHJldCA9IGdyaWQgPyAoZ3JpZC5zZWxlY3RlZCB8fCBncmlkKSA6IG51bGw7CgkJaWYgKGJFbXB0eSkgewoJCQlyZXQgPSB7fTsKCQkJbyA9IHt9OwoJCX0gZWxzZSB7CgkJCXJldCA9IChyZXQgJiYgcmV0LklkKSA/IHsKCQkJCUlkOiByZXQuSWQKCQkJfSA6IHt9OwoJCX0KCgkJdGhpcy5lbGVtZW50cy5maWx0ZXIoZSA9PiAocHJlZml4ID8gZS5ncm91cCA9PSBwcmVmaXggOiB0cnVlKSAmJiBlLnR5cGUgIT0gJ2xpbmsnICYmIFsnXyddLmluZGV4T2YoZS5uYW1lLnJlcGxhY2UocHJlZml4LCAiIikpIDwgMCkuZm9yRWFjaChlID0+IHsKCQkJcmV0W2UubmFtZS5yZXBsYWNlKHByZWZpeCwgIiIpXSA9IG9bZS5uYW1lXTsKCQkJcmV0dXJuIHRydWU7CgkJfSk7CgoJCWZpbHRlcihyZXQpOwoKCQlyZXR1cm4gcmV0OwoJfQoKCWJpbmQob2JqKSB7CgkJdmFyIG9iakJpbmQgPSAobywgZSkgPT4gewoJCQlvW3RoaXMuZUZ1bihlKV0oewoJCQkJb25TaG93UGFuZWw6ICgpID0+IHsKCQkJCQl0aGlzLmZpbGxEYXRhKCQoIiMiICsgZS5pZCksIG51bGwsIDAsIDEwKTsKCQkJCX0sCgkJCQlvbkNsaWNrUm93OiAoaW5kZXgsIHJvdykgPT4gewoJCQkJCXZhciBzID0gcm93ID8gcm93Ll9fT1dORVIgOiBudWxsOwoJCQkJCS8vIGNvbnNvbGUubG9nKCJvbkNsaWNrUm93KCk6ICIsIGluZGV4LCByb3csIHMpOwoJCQkJCWlmIChzICYmIHMub3B0aW9ucy5zZWxlY3QpIHsKCQkJCQkJcy5vcHRpb25zLnNlbGVjdChyb3csIHRoaXMuZ2V0KCkpOwoJCQkJCX0KCQkJCX0KCQkJfSk7CgkJCXRyeSB7CgkJCQl2YXIgZGcgPSBvW3RoaXMuZUZ1bihlKV0oJ2dyaWQnKTsKCQkJCS8vIGRnLmRhdGFncmlkKCdlbmFibGVGaWx0ZXInKQoJCQkJdmFyIHN0YXRlID0gZGcuZGF0YSgnZGF0YWdyaWQnKTsKCQkJCXZhciBvcHRzID0gc3RhdGUub3B0aW9uczsKCQkJCXZhciBvbkJlZm9yZUxvYWQgPSBvcHRzLm9uQmVmb3JlTG9hZDsKCQkJCW9wdHMub25CZWZvcmVMb2FkID0gKHBhcmFtKSA9PiB7CgkJCQkJc3RhdGUuYWxsUm93cyA9IG51bGw7CgkJCQkJcmV0dXJuIG9uQmVmb3JlTG9hZC5jYWxsKHRoaXMsIHBhcmFtKTsKCQkJCX07CgkJCQl2YXIgcGFnZXIgPSBkZy5kYXRhZ3JpZCgnZ2V0UGFnZXInKTsKCQkJCWRnLmRhdGFncmlkKCdnZXRQYW5lbCcpLnBhbmVsKHsKCQkJCQlJRDogaQoJCQkJfSk7CgkJCQlwYWdlci5wYWdpbmF0aW9uKHsKCQkJCQlvblNlbGVjdFBhZ2U6IGZ1bmN0aW9uKHBhZ2VOdW0sIHBhZ2VTaXplKSB7CgkJCQkJCXRyeSB7CgkJCQkJCQlERm9ybS5maWxsRGF0YSgkKCIjIiArIERGb3JtLnNlbGVjdHNbJCh0aGlzLnBhcmVudE5vZGUpLnBhbmVsKCdvcHRpb25zJykuSURdLmlkKSwgbnVsbCwgcGFnZVNpemUgKiAocGFnZU51bSAtIDEpLCBwYWdlU2l6ZSAqIHBhZ2VOdW0pOwoJCQkJCQl9IGNhdGNoIChfZXgpIHsKCQkJCQkJCWNvbnNvbGUubG9nKCJEeW5hRm9ybTo6b25TZWxlY3RQYWdlKCkgIiwgX2V4KTsKCQkJCQkJfQoJCQkJCX0KCQkJCX0pOwoJCQkJZGcuZGF0YWdyaWQoJ2xvYWREYXRhJywgc3RhdGUuZGF0YSk7CgkJCX0gY2F0Y2ggKGV4KSB7fQoJCX07CgkJaWYgKG9iaikgewoJCQlvYmpCaW5kKG9iaik7CgkJfSBlbHNlIHsKCQkJZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnNlbGVjdHMubGVuZ3RoOyBpKyspIHsKCQkJCWlmICh0aGlzLnNlbGVjdHNbaV0ub3B0aW9ucy5vcHRpb25zKSB7CgkJCQkJLy8kKCIjIiArIHRoaXMuc2VsZWN0c1tpXS5pZCkuY29tYm8oKTsKCQkJCX0gZWxzZSB7CgkJCQkJb2JqQmluZCgkKCIjIiArIHRoaXMuc2VsZWN0c1tpXS5pZCksIHRoaXMuc2VsZWN0c1tpXSk7CgkJCQl9CgkJCX0KCgkJCXRoaXMuZWxlbWVudHMuZmlsdGVyKGUgPT4gZS53aW5kb3cgJiYgZS5ncm91cCkuZm9yRWFjaChlID0+IHsKCQkJCWxldCB0ID0gJCgiI3RiY1dpbmRvdyIpLnRhYnMoImdldFRhYiIsIGUuZ3JvdXApOwoJCQkJaWYgKHQpIHsKCQkJCQl0LnBhbmVsKCdvcHRpb25zJykudGFiLmhpZGUoKTsKCQkJCX0KCQkJfSk7CgkJfQoJfQoKCWVuZ2xpc2gocykgewoJCWlmICghcykgcmV0dXJuICIiOwoJCXZhciByZXN1bHQgPSBzLnJlcGxhY2UoLyhbQS1aXSkvZywgIiAkMSIpOwoJCXJlc3VsdCA9IHJlc3VsdC5yZXBsYWNlKC9fL2csICcnKTsKCQlyZXR1cm4gcmVzdWx0LmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgcmVzdWx0LnNsaWNlKDEpOwoJfQoKCW9uVG9nZ2xlKGUsIGJWYWx1ZSkgewoJCWxldCBzVGFnID0gYCNmRWxlbWVudF8ke2UuZm9yLm5hbWV9ID4gLmVhc3l1aS0ke3RoaXMudWlUeXBlc1tlLmZvci50eXBlXX1gOwoJCWxldCBvVGFnID0gJChzVGFnKTsKCQllLmZvci5lbmFibGVkID0gdHlwZW9mKGJWYWx1ZSkgPT09ICJ1bmRlZmluZWQiID8gIWUuZm9yLmVuYWJsZWQgOiBiVmFsdWU7CgoJCW9UYWcucHJvcCgiZGlzYWJsZWQiLCAhZS5mb3IuZW5hYmxlZCk7CgkJLy9vVGFnW3RoaXMudWlUeXBlc1tlLmZvci50eXBlXV0oZS5mb3IuZW5hYmxlZCA/ICJlbmFibGUiIDogImRpc2FibGUiKTsKCQljb25zb2xlLmxvZyhzVGFnLCBvVGFnLCB0aGlzLnVpVHlwZXNbZS5mb3IudHlwZV0sIGUuZm9yLmVuYWJsZWQpOwoJfQoKCXJlbmRlcihuYW1lLCB0aXRsZSwgZWxlbWVudHMsIGJ1dHRvbnMsIGJGaXhlZCkgewoJCXRoaXMuZWxlbWVudHMgPSAoZWxlbWVudHMgfHwgW10pLmZpbHRlcihlID0+ICFlLmlnbm9yZSk7CgoJCXRoaXMuYnV0dG9ucyA9IGJ1dHRvbnMgfHwgW107CgkJdGhpcy5zZWxlY3RzID0gW107CgkJdGhpcy5ncmlkcyA9IFtdOwoKCQl0aGlzLmVsZW1lbnRzLmZpbHRlcihlID0+IGUudHlwZSA9PSAid2luZG93IikuZm9yRWFjaCh3ID0+IHRoaXMuZWxlbWVudHMuc3BsaWNlKHRoaXMuZWxlbWVudHMuZmluZEluZGV4KGUgPT4gZS5uYW1lID09IHcubmFtZSksIDAsIHsKCQkJbmFtZTogIl8iICsgdy5uYW1lLAoJCQl0eXBlOiAibGluayIsCgkJCXRpdGxlOiB3LnRpdGxlIHx8IHRoaXMuZW5nbGlzaCh3Lm5hbWUpLAoJCQlncm91cDogdy5ncm91cCwKCQkJd2luZG93OiB3LndpbmRvdywKCQkJc2VjdGlvbjogdy5zZWN0aW9uLAoJCQlsaW5rczogW3sKCQkJCWxhYmVsOiAnT3BlbicsCgkJCQlpY29uOiAnZWRpdCcsCgkJCQlvbkNsaWNrOiBvID0+ICQoIiNwbmwiICsgdy5uYW1lKS53aW5kb3coJ29wZW4nKQoJCQl9XSwKCQl9KSk7CgoJCXRoaXMuc3IoKS5ncm91cEJ5KHRoaXMuZWxlbWVudHMuZmlsdGVyKGUgPT4gZS53aW5kb3cpLCAiZ3JvdXAiKS5mb3JFYWNoKGt2ID0+IHsKCQkJaWYgKCFrdi5rZXkpIHJldHVybjsKCgkJCWxldCBlID0gewoJCQkJbmFtZTogIl8iICsga3Yua2V5LAoJCQkJdGl0bGU6IGt2LmtleSwKCQkJCXR5cGU6ICJ3aW5kb3ciLAoJCQkJZ3JvdXA6IGt2LmtleSwKCQkJCXdpZHRoOiB0aGlzLndpZHRoICogMC45LAoJCQkJaGVpZ2h0OiB0aGlzLmhlaWdodCAqIDAuOSwKCQkJCWxvYWRlcjogbyA9PiB7CgkJCQkJa3YudmFsdWVzLmZpbHRlcih2ID0+IHYudHlwZSAhPT0gJ2xpbmsnIHx8ICh2LnR5cGUgPT0gJ2xpbmsnICYmIHYubmFtZS5zdGFydHNXaXRoKCdfJykpKS5mb3JFYWNoKHYgPT4gJCgiI3BubF8iICsgdi5ncm91cCArICctY2VudGVyJykuYXBwZW5kKCQoIiNmRWxlbWVudF8iICsgdi5uYW1lKSkpOwoJCQkJCXJldHVybiBudWxsOwoJCQkJfSwKCQkJCWJ1dHRvbnM6IFtdLmNvbmNhdC5hcHBseShbXSwga3YudmFsdWVzLmZpbHRlcih2ID0+IHYudHlwZSA9PSAnbGluaycgJiYgIXYubmFtZS5zdGFydHNXaXRoKCdfJykpLm1hcCh2ID0+IFsuLi52LmxpbmtzLm1hcChsID0+ICh7CgkJCQkJbmFtZTogbC5uYW1lIHx8IGwubGFiZWwsCgkJCQkJdGl0bGU6IGwudGl0bGUgfHwgbC5sYWJlbCwKCQkJCQlvbkNsaWNrOiBsLm9uQ2xpY2ssCgkJCQkJaWNvbjogbC5pY29uLAoJCQkJCXdpbmRvdzogdHJ1ZSwKCQkJCQlncm91cDoga3Yua2V5LAoJCQkJfSkpXSkpLAoJCQl9OwoJCQl0aGlzLmJ1dHRvbnMucHVzaCguLi5lLmJ1dHRvbnMpOwoKCQkJdGhpcy5lbGVtZW50cy5wdXNoKGUpOwoJCX0pOwoKCQlsZXQgcmV0ID0gIiI7CgkJdGhpcy5lbGVtZW50cy5maWx0ZXIoZSA9PiAhZS56b25lKS5mb3JFYWNoKGUgPT4gZS56b25lID0gJ2NlbnRlcicpOwoJCWxldCB3T3B0aW9ucyA9IHsKCQkJbmFtZTogbmFtZSB8fCB0aGlzLm5hbWUsCgkJCXRpdGxlOiB0aXRsZSB8fCB0aGlzLnRpdGxlLAoJCQl0eXBlOiAnd2luZG93JywKCQkJdmlzaWJsZTogdHJ1ZSwKCQkJd2lkdGg6IHRoaXMud2lkdGgsCgkJCWhlaWdodDogdGhpcy5oZWlnaHQsCgkJCWZpeGVkOiBiRml4ZWQsCgkJCWxpbmtzOiBbewoJCQkJaWNvbjogImhlbHAiLAoJCQkJYWN0aW9uOiBvID0+ICQoIiNwbmxfX0NvbnNvbGUiKS53aW5kb3coJ29wZW4nKQoJCQl9XSwKCQkJYnV0dG9uczogdGhpcy5idXR0b25zLmZpbHRlcihiID0+ICFiLndpbmRvdyksCgkJfTsKCQl0aGlzLnNyKCkuZ3JvdXBCeSh0aGlzLmVsZW1lbnRzLCAnem9uZScpLmZpbHRlcih6ZyA9PiB6Zy5rZXkpLmZvckVhY2goemcgPT4gewoJCQl3T3B0aW9uc1t6Zy5rZXldID0gdGhpcy5yZW5kZXJFbGVtZW50cyh6Zy52YWx1ZXMpOwoJCX0pOwoKCQlyZXQgPSB0aGlzLndpbmRvdyh3T3B0aW9ucyk7CgkJLy8gY29uc29sZS5sb2cocmV0KTsKCgkJcmV0dXJuIHJldDsKCX0KCgljV2lkdGgob3B0aW9ucykgewoJCWxldCByZXQgPSBNYXRoLmZsb29yKCgob3B0aW9ucyA/IG9wdGlvbnMud2lkdGggOiBudWxsKSB8fCAodGhpcy53aWR0aCAvIDMpKSk7CgkJaWYgKG9wdGlvbnMuem9uZSA9PSAnZWFzdCcgfHwgb3B0aW9ucy56b25lID09ICd3ZXN0JykgewoJCQlyZXQgPSAwLjI1ICogcmV0OyAvLyA5MCUgb2YgMy8xMCwgdGhlIHdpZHRoIG9mIHRoZSBub3JtYWwgZWxlbWVudAoJCX0gZWxzZSBpZiAob3B0aW9ucyAmJiBvcHRpb25zLmVkaXRvcikgewoJCQlyZXQgPSB3aW5kb3cuaW5uZXJXaWR0aDsKCQl9IGVsc2UgaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy53aWR0aCAmJiB0eXBlb2Yob3B0aW9ucy53aWR0aCkgPT09ICdzdHJpbmcnKSB7CgkJCXJldCA9IHRoaXMud2lkdGg7CgkJfSBlbHNlIGlmIChvcHRpb25zICYmIG9wdGlvbnMudHlwZSA9PSAnd2luZG93JyAmJiAhb3B0aW9ucy53aWR0aCkgewoJCQlyZXQgPSB0aGlzLndpZHRoICogMC45OwoJCX0KCgkJLy8gY29uc29sZS5sb2cob3B0aW9ucy5uYW1lICsgIjogY1dpZHRoID0gIiArIHJldCwgb3B0aW9ucy56b25lKTsKCQlyZXR1cm4gcmV0OwoJfQoKCXdpbmRvdyhvcHRpb25zKSB7CgkJb3B0aW9ucy50aXRsZSA9IG9wdGlvbnMudGl0bGUgfHwgb3B0aW9ucy5uYW1lOwoJCXZhciByZXQgPSBgCgkJPGRpdiBpZCA9ICJwbmwke29wdGlvbnMubmFtZX0iIGNsYXNzPSJlYXN5dWktd2luZG93IiB0aXRsZT0iJHtvcHRpb25zLnRpdGxlIHx8IHRoaXMuZW5nbGlzaChvcHRpb25zLm5hbWUpfSIgZGF0YS1vcHRpb25zPScke3RoaXMuZXZlbnRIYW5kbGVycyhvcHRpb25zKX0sIGNsb3NlZDokeyFvcHRpb25zLnZpc2libGV9LG1pbmltaXphYmxlOiR7IW9wdGlvbnMuZml4ZWR9LG1heGltaXphYmxlOiR7IW9wdGlvbnMuZml4ZWR9LGNsb3NhYmxlOiR7IW9wdGlvbnMuZml4ZWR9LGNvbGxhcHNpYmxlOiR7IW9wdGlvbnMuZml4ZWR9LGRyYWdnYWJsZTokeyFvcHRpb25zLmZpeGVkfSxyZXNpemFibGU6JHshb3B0aW9ucy5maXhlZH0saWNvbkNsczoiaWNvbi0ke29wdGlvbnMuaWNvbn0iLCB0b29sczoiIyR7b3B0aW9ucy5uYW1lfV90b29scyInIHN0eWxlPSJ3aWR0aDoke3RoaXMuY1dpZHRoKG9wdGlvbnMpfXB4O2hlaWdodDoke3RoaXMuY0hlaWdodChvcHRpb25zKX1weDtwYWRkaW5nOjEwcHg7Ij4KCQkgICAgPGRpdiBjbGFzcz0iZWFzeXVpLWxheW91dCIgZGF0YS1vcHRpb25zPSJmaXQ6dHJ1ZSI+CgkJYDsKCgkJbGV0IGJab25lID0gb3B0aW9ucy5zb3V0aCA/ICdzb3V0aCcgOiAodGhpcy56b25lcy5maW5kKHogPT4geiA9PSAnc291dGgnKSB8fCB0aGlzLnpvbmVzWzBdKTsKCQlvcHRpb25zW2Jab25lXSA9IG9wdGlvbnNbYlpvbmVdIHx8IFtdOwoJCWxldCB6V2lkdGggPSBNYXRoLm1pbigxMjAsIHRoaXMud2lkdGggKiAwLjk1IC8gKG9wdGlvbnMuYnV0dG9ucyA/IG9wdGlvbnMuYnV0dG9ucy5sZW5ndGggOiAxKSwgdGhpcy5jV2lkdGgob3B0aW9ucykpOwoJCW9wdGlvbnNbYlpvbmVdLnB1c2goYDxkaXYgaWQ9InBubCR7b3B0aW9ucy5uYW1lfS1idXR0b25zIiBkYXRhLW9wdGlvbnM9InJlZ2lvbjonJHtiWm9uZX0nLGJvcmRlcjpmYWxzZSIgc3R5bGU9InRleHQtYWxpZ246cmlnaHQ7cGFkZGluZzo1cHggMCAwOyI+YCArICQubWFwKCQuZ3JlcChvcHRpb25zLmJ1dHRvbnMgfHwgW10sIGIgPT4gIWIuaWdub3JlKSwgYiA9PiBgPGEgaWQ9JyR7Yi5uYW1lfScgaHJlZj0iamF2YXNjcmlwdDp2b2lkKDApIiBjbGFzcz0iZWFzeXVpLWxpbmtidXR0b24gYzYiIGljb25DbHM9Imljb24tJHtiLmljb24gfHwgJ3NhdmUnfSIgc3R5bGU9IndpZHRoOiR7eldpZHRofXB4IiBvbmNsaWNrPSdERm9ybS5kb0NsaWNrKCR7X0ZyRU1ELl90b0pTKGIpfSknPiR7Yi50aXRsZSB8fCBiLm5hbWV9PC9hPiZuYnNwOyZuYnNwO2ApLmpvaW4oJycpICsgYDwvZGl2PmApOwoKCQl0aGlzLnpvbmVzLmZpbHRlcih6ID0+IG9wdGlvbnNbel0pLmZvckVhY2goeiA9PiB7CgkJCXJldCArPSBgCgkJICAgICAgICA8ZGl2IGRhdGEtb3B0aW9ucz0icmVnaW9uOicke3p9JyIgdGl0bGU9IiR7KHo9PSd3ZXN0JyB8fCB6PT0nZWFzdCcpPycmbmJzcDsnOicnfSIgc3R5bGU9J2hlaWdodDokeyh6PT0nbm9ydGgnfHx6PT0nc291dGgnKT8xMDoxMDB9JTt3aWR0aDokeygoej09J2Vhc3QnfHx6PT0nd2VzdCcpPzAuMToxKSp0aGlzLmNXaWR0aChvcHRpb25zKX1weCc+CiAgICAgICAgCQkgICAgJHsoQXJyYXkuaXNBcnJheShvcHRpb25zW3pdKT9vcHRpb25zW3pdOltvcHRpb25zW3pdXSkuam9pbignJyl9CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgYDsKCQl9KTsKCgkJcmV0ICs9IGA8L2Rpdj48L2Rpdj5gOwoKCQkvLyBsaW5rcyAodG9vbHMpCgkJcmV0ICs9IGA8ZGl2IGlkPSIke29wdGlvbnMubmFtZX1fdG9vbHMiPmAgKyB0aGlzLmxpbmtzKG9wdGlvbnMpICsgYDwvZGl2PmA7CgoJCS8vIGNvbnNvbGUubG9nKCJEeW5hRm9ybTo6d2luZG93KCkiLCByZXQpOwoKCQlyZXR1cm4gcmV0OwoJfQoKCWFzeW5jIF9lbmQoKSB7CgkJbGV0IG8gPSB0aGlzLmdldCgpOwoKCQkvLyBkbyBub3QgdXNlIHRoZSBmaXJzdCBidXR0b24sIGJlY2F1c2UgbWFueSBmb3JtcyBoYXZlIGEgQ2FuY2VsIGJ1dHRvbiBvbmx5CgkJbGV0IGJ1dHRvbiA9IHRoaXMuYnV0dG9ucy5maW5kKGIgPT4gYi5hdXRvU3VibWl0KSAvKiB8fCB0aGlzLmJ1dHRvbnNbMF0qLyA7CgkJaWYgKGJ1dHRvbiAmJiBvICYmIE9iamVjdC52YWx1ZXMobykubGVuZ3RoICYmICh0eXBlb2YoYnV0dG9uLmF1dG9TdWJtaXQpID09PSAidW5kZWZpbmVkIiB8fCBidXR0b24uYXV0b1N1Ym1pdCkpIHsKCQkJbGV0IHYgPSBPYmplY3QudmFsdWVzKG8pLnJlZHVjZSgodCwgdikgPT4gewoJCQkJcmV0dXJuICgodHlwZW9mKHYpICE9PSAib2JqZWN0IikgPyAxIDogMCkgKiAodiA/IDEgOiAwKTsKCQkJfSk7CgkJCS8vY29uc29sZS5sb2cobywgT2JqZWN0LnZhbHVlcyhvKSwgdik7CgkJCWlmICh2KSB7CgkJCQkvLyBhbGwgZmllbGRzIGhhdmUgdmFsdWVzCgkJCQlhd2FpdCB0aGlzLmRvQ2xpY2soYnV0dG9uKTsKCgkJCX0KCQl9Cgl9CgoJZm9vdGVyKGJGaXhlZCkgewoJCXJldHVybiBgPC9mb3JtPmAgKyBgPGRpdiBpZD0iZGxnLWJ1dHRvbnMiPmAgKyB0aGlzLmJ1dHRvbnMuZmlsdGVyKGIgPT4gIWIud2luZG93KS5tYXAoYiA9PiBgPGEgaWQ9JyR7Yi5uYW1lfScgaHJlZj0iamF2YXNjcmlwdDp2b2lkKDApIiBjbGFzcz0iZWFzeXVpLWxpbmtidXR0b24gYzYiIGljb25DbHM9Imljb24tJHtiLmljb24gfHwgJ3NhdmUnfSIgc3R5bGU9IndpZHRoOiR7TWF0aC5taW4oMTIwLCB0aGlzLndpZHRoICogMC45NSAvIHRoaXMuYnV0dG9ucy5sZW5ndGgsIHRoaXMuY1dpZHRoKCkpfXB4IiBvbmNsaWNrPSdERm9ybS5kb0NsaWNrKCR7X0ZyRU1ELl90b0pTKGIpfSknPiR7Yi50aXRsZSB8fCB0aGlzLmVuZ2xpc2goYi5uYW1lKX08L2E+Jm5ic3A7Jm5ic3A7YCkuam9pbignJykgKyAiPC9kaXY+IiArIChiRml4ZWQgPyAiIiA6ICc8L2Rpdj4nKTsKCX0KCgloZWFkZXIobmFtZSwgdGl0bGUsIGJGaXhlZCwgbGlua3MpIHsKCQl0aGlzLnRpdGxlID0gdGl0bGUgfHwgdGhpcy50aXRsZTsKCQluYW1lID0gbmFtZSB8fCB0aGlzLm5hbWU7CgkJdmFyIHJldCA9ICcnOwoKCQlyZXQgKz0gdGhpcy53aW5kb3coewoJCQluYW1lOiAiX19Db25zb2xlIiwKCQkJdHlwZTogIndpbmRvdyIsCgkJCWVkaXRvcjogdHJ1ZSwKCQkJbG9hZGVyOiBvID0+IHdpbmRvdy5sb2dzLnNsaWNlKCkucmV2ZXJzZSgpLm1hcChsID0+IGwuZGF0ZS50b0lTT1N0cmluZygpICsgIjogIiArIGwuYXJncy5tYXAocyA9PiB0eXBlb2YocykgPT09ICdvYmplY3QnID8gKChvYmosIGluZGVudCA9IDIpID0+IHsKCQkJCWxldCBjYWNoZSA9IFtdOwoJCQkJY29uc3QgcmV0VmFsID0gSlNPTi5zdHJpbmdpZnkoCgkJCQkJb2JqLAoJCQkJCShrZXksIHZhbHVlKSA9PgoJCQkJCXR5cGVvZiB2YWx1ZSA9PT0gIm9iamVjdCIgJiYgdmFsdWUgIT09IG51bGwgPwoJCQkJCWNhY2hlLmluY2x1ZGVzKHZhbHVlKSA/CgkJCQkJdW5kZWZpbmVkIC8vIER1cGxpY2F0ZSByZWZlcmVuY2UgZm91bmQsIGRpc2NhcmQga2V5CgkJCQkJOgoJCQkJCWNhY2hlLnB1c2godmFsdWUpICYmIHZhbHVlIC8vIFN0b3JlIHZhbHVlIGluIG91ciBjb2xsZWN0aW9uCgkJCQkJOgoJCQkJCXZhbHVlLAoJCQkJCWluZGVudAoJCQkJKTsKCQkJCWNhY2hlID0gbnVsbDsKCQkJCXJldHVybiByZXRWYWw7CgkJCX0pKHMpIDogcykuam9pbignLCAnKSkuam9pbignXG4nKSwKCQl9KTsKCgkJaWYgKCFiRml4ZWQpIHsKCQkJbGlua3MgPSAobGlua3MgfHwgW10pLmZpbHRlcihsID0+ICFsLmlnbm9yZSk7CgkJCWxldCB0RGF0YSA9ICIiOwoJCQlpZiAobGlua3MubGVuZ3RoKSB7CgkJCQlyZXQgKz0gYDxkaXYgaWQ9IiR7dGhpcy5uYW1lfV90b29scyI+YCArIGxpbmtzLm1hcChsID0+IGA8YSBocmVmPSJqYXZhc2NyaXB0OnZvaWQoMCkiIGNsYXNzPSJpY29uLSR7bC5pY29ufSIgb25jbGljaz0nKGFzeW5jICgpID0+IHt2YXIgYSA9ICR7X0ZyRU1ELl90b0pTKGwpfTsgJCgiI3dpbiR7dGhpcy5uYW1lfSIpLndpbmRvdygic2V0VGl0bGUiLCAiJHt0aGlzLnRpdGxlfTogIiArIGEubmFtZSk7IGF3YWl0IGEuYWN0aW9uKERGb3JtLmdldCgpKTsgJCgiI3dpbiR7dGhpcy5uYW1lfSIpLndpbmRvdygic2V0VGl0bGUiLCAiJHt0aGlzLnRpdGxlfSIpO30pKCknPjwvYT5gKS5qb2luKCdcbicpICsgIjwvZGl2PiI7CgkJCQl0RGF0YSA9IGAsdG9vbHM6IiMke3RoaXMubmFtZX1fdG9vbHMiYDsKCQkJfQoJCQlyZXQgKz0gYDxkaXYgaWQ9J3dpbiR7dGhpcy5uYW1lfScgY2xhc3M9J2Vhc3l1aS13aW5kb3cnIHRpdGxlPScke3RoaXMudGl0bGUgfHwgdGhpcy5lbmdsaXNoKHRoaXMubmFtZSl9JyBkYXRhLW9wdGlvbnM9J2ljb25DbHM6Imljb24tc2F2ZSIgJHt0RGF0YX0nIHN0eWxlPSd3aWR0aDoke3RoaXMud2lkdGh9cHg7aGVpZ2h0OiR7dGhpcy5oZWlnaHR9cHg7cGFkZGluZzoxMHB4Oyc+YDsKCQl9CgkJcmV0dXJuIHJldCArIGA8Zm9ybSBpZD0iZnJtJHt0aGlzLm5hbWV9IiBtZXRob2Q9InBvc3QiIG5vdmFsaWRhdGU+YDsKCX0KCglyZW5kZXJFbGVtZW50cyhlbGVtZW50cykgewoJCWVsZW1lbnRzID0gZWxlbWVudHMgfHwgdGhpcy5lbGVtZW50czsKCgkJdmFyIHRXaWR0aCA9IE1hdGguZmxvb3IodGhpcy53aWR0aCAqIDAuOTUpOwoJCXZhciB0SGVpZ2h0ID0gTWF0aC5mbG9vcih0aGlzLmhlaWdodCAqIDAuODUpOwoKCQlsZXQgcmV0ID0gJyc7CgkJdmFyIGdFbGVtZW50cyA9IHRoaXMuc3IoKS5ncm91cEJ5KGVsZW1lbnRzLCAiZ3JvdXAiKTsKCQlpZiAoZ0VsZW1lbnRzLmxlbmd0aCA+IDEpIHJldCArPSBgPGRpdiBpZD0idGJjV2luZG93IiBjbGFzcz0iZWFzeXVpLXRhYnMiIGRhdGEtb3B0aW9ucz0nJHt0aGlzLmV2ZW50SGFuZGxlcnMoe3R5cGU6ICd0YWJzJ30pfScgc3R5bGU9IndpZHRoOiR7dFdpZHRofXB4O2hlaWdodDoke3RIZWlnaHR9cHg7Ij5gOwoJCWZvciAodmFyIGcgPSAwOyBnIDwgZ0VsZW1lbnRzLmxlbmd0aDsgZysrKSB7CgkJCWlmIChnRWxlbWVudHMubGVuZ3RoID4gMSkgcmV0ICs9ICc8ZGl2IHRpdGxlPSInICsgKGdFbGVtZW50c1tnXS5rZXkgfHwgIk1haW4iKSArICciIHN0eWxlPSJwYWRkaW5nOjIwcHg7ZGlzcGxheTpub25lOyI+JzsKCQkJdmFyIHNFbGVtZW50cyA9IHRoaXMuc3IoKS5ncm91cEJ5KGdFbGVtZW50c1tnXS52YWx1ZXMsICJzZWN0aW9uIik7CgkJCWlmIChzRWxlbWVudHMubGVuZ3RoID4gMSkgcmV0ICs9ICc8ZGl2IGNsYXNzPSJlYXN5dWktYWNjb3JkaW9uIiBzdHlsZT0id2lkdGg6JyArIHRXaWR0aCArICdweDtoZWlnaHQ6JyArIC8qdEhlaWdodCovICIxMDAlIiArICdweDsiPic7CgkJCWZvciAodmFyIHMgPSAwOyBzIDwgc0VsZW1lbnRzLmxlbmd0aDsgcysrKSB7CgkJCQlyZXQgKz0gYDxkaXYgdGl0bGU9IiR7c0VsZW1lbnRzW3NdLmtleSB8fCAiIn0iIGRhdGEtb3B0aW9ucz0iaWNvbkNsczonaWNvbi1tb3JlJyIgc3R5bGU9InBhZGRpbmc6MTBweDsiPmA7CgkJCQlmb3IgKHZhciBpID0gMDsgaSA8IHNFbGVtZW50c1tzXS52YWx1ZXMubGVuZ3RoOyBpKyspIHsKCQkJCQl2YXIgZSA9IHNFbGVtZW50c1tzXS52YWx1ZXNbaV07CgkJCQkJaWYgKGUuaWdub3JlKSBjb250aW51ZTsKCQkJCQllLnZhbHVlID0gZS52YWx1ZSB8fCBfRnJFTUQuaGFzaFtlLm5hbWVdIHx8IChfRnJFTUQuYXBpU2VydmVyID8gX0ZyRU1ELmFwaVNlcnZlci5fX2NvbmZpZygndGVzdF8nICsgZS5uYW1lLCAnJykgOiAnJyk7CgkJCQkJcmV0ICs9IGA8ZGl2IGlkPSJmRWxlbWVudF8ke2UubmFtZX0iIGNsYXNzPSJmaXRlbSIgc3R5bGU9ImRpc3BsYXk6ICR7KGUudHlwZT09J3dpbmRvdycgfHwgZS5oaWRkZW4pPydub25lJzonJ30iPmA7CgkJCQkJaWYgKGUudG9nZ2xlKSB7CgkJCQkJCXJldCArPSBgPGEgaHJlZj0iIyIgY2xhc3M9ImVhc3l1aS1saW5rYnV0dG9uIiBkYXRhLW9wdGlvbnM9JyR7dGhpcy5ldmVudEhhbmRsZXJzKHt0eXBlOiAndG9nZ2xlJywgZm9yOiBlfSl9LHBsYWluOnRydWUsaWNvbkNsczoiaWNvbi0ke2UuaWNvbiB8fCAnc2VhcmNoJ30iJyBzdHlsZT0id2lkdGg6MTAwcHg7aGVpZ2h0OjMwcHgiPiR7ZS50aXRsZSB8fCB0aGlzLmVuZ2xpc2goZS5uYW1lKX08L2E+YDsKCQkJCQl9IGVsc2UgewoJCQkJCQlyZXQgKz0gYDxsYWJlbD4ke2UudGl0bGUgfHwgdGhpcy5lbmdsaXNoKGUubmFtZSl9OjwvbGFiZWw+YDsKCQkJCQl9CgkJCQkJaWYgKGUudHlwZSAmJiB0aGlzW2UudHlwZV0pIHsKCQkJCQkJcmV0ICs9IHRoaXNbZS50eXBlXShlKTsKCQkJCQl9IGVsc2UgaWYgKGUucmVuZGVyKSB7CgkJCQkJCXJldCArPSBlLnJlbmRlcigpOwoJCQkJCX0KCQkJCQlyZXQgKz0gJzwvZGl2Pic7CgkJCQl9CgkJCQlyZXQgKz0gJzwvZGl2Pic7CgkJCX0KCQkJaWYgKHNFbGVtZW50cy5sZW5ndGggPiAxKSByZXQgKz0gJzwvZGl2Pic7CgkJCWlmIChnRWxlbWVudHMubGVuZ3RoID4gMSkgcmV0ICs9ICI8L2Rpdj4iOwoJCX0KCQlpZiAoZ0VsZW1lbnRzLmxlbmd0aCA+IDEpIHJldCArPSAiPC9kaXY+IjsKCQlyZXR1cm4gcmV0OwoJfQoKCWluZm8obXNnKSB7CgkJaWYgKCQubWVzc2FnZXIpIHsKCQkJJC5tZXNzYWdlci5hbGVydCh0aGlzLnRpdGxlLCBtc2csICdpbmZvJyk7CgkJfSBlbHNlIHsKCQkJdGhpcy5zcigpLlNob3dNZXNzYWdlKG1zZywgdGhpcy50aXRsZSk7CgkJfQoJfQoKCWVycm9yKG1zZykgewoJCWlmICgkLm1lc3NhZ2VyKSB7CgkJCSQubWVzc2FnZXIuYWxlcnQodGhpcy50aXRsZSwgbXNnLCAnZXJyb3InKTsKCQl9IGVsc2UgewoJCQl0aGlzLnNyKCkuU2hvd01lc3NhZ2UobXNnLCB0aGlzLnRpdGxlKTsKCQl9Cgl9CgoJYnlOYW1lKG5hbWUpIHsKCQlyZXR1cm4gdGhpcy5lbGVtZW50cy5maW5kKGUgPT4gZS5uYW1lID09PSBuYW1lKTsKCX0KCgkvKiogQ29tcG9uZW50czo6U3RhcnQgKiovCglDb3JlQ29tcG9uZW50ID0gY2xhc3MgewoJCWNvbnN0cnVjdG9yKHBhZ2UsIGRGb3JtLCBvU2NvcGUpIHsKCQkJdGhpcy5wYWdlID0gcGFnZTsKCQkJdGhpcy5kRm9ybSA9IGRGb3JtIHx8IERGb3JtOwoJCQl0aGlzLnNjb3BlID0gdGhpcy5zY29wZSB8fCBfRnJFTUQ/LmFwaVNlcnZlcj8uU2NvcGU7CgkJCXRoaXMub1Njb3BlID0gb1Njb3BlIHx8IF9GckVNRC5fX3Njb3BlKHRoaXMuc2NvcGUpOwoJCX0KCgkJX2VudGl0eUZpZWxkKGVjKSB7CgkJCXJldHVybiB7CgkJCQluYW1lOiBlYy5OYW1lLnJlcGxhY2UoL1wgL2csICdfJyksCgkJCQl0aXRsZTogX0ZyRU1ELl90aXRsZUNhc2UoZWMuTmFtZSksCgkJCQlDbGFzczogewoJCQkJCU5hbWU6IGVjLk5hbWUsCgkJCQkJSWQ6IGVjLklkCgkJCQl9LAoJCQkJem9uZTogJ25vcnRoJywKCQkJCXR5cGU6IGVjLkVudGl0eUF0dHJpYnV0ZXMuZmluZChwZWEgPT4gIXBlYS5FbnRpdHlNZXRob2QgJiYgcGVhLkVudGl0eVR5cGUgPT0gZWMpID8gJ3RyZWUnIDogJ3NlbGVjdCcsCgkJCQlwYXJlbnRGaWVsZDogZWMuRW50aXR5QXR0cmlidXRlcy5maW5kKHBlYSA9PiAhcGVhLkVudGl0eU1ldGhvZCAmJiBwZWEuRW50aXR5VHlwZSA9PSBlYyk/Lk5hbWUsCgkJCQkvL3NlYXJjaEZpZWxkOiBlYy5FbnRpdHlBdHRyaWJ1dGVzLmZpbmQoZWEgPT4gZWEuSXNTdHJpbmcpLk5hbWUsCgkJCQkvL2lkRmllbGQ6ICdfVG9TdHJpbmcnLAoJCQkJc291cmNlOiAobywgZkRhdGEsIHNUZXh0KSA9PiAoewoJCQkJCU9QRVJBVE9SUzogewoJCQkJCQlbZWMuRW50aXR5QXR0cmlidXRlcy5maW5kKGVhID0+IGVhLklzU3RyaW5nKS5OYW1lXTogJ2xpa2UnCgkJCQkJfSwKCQkJCQlbZWMuRW50aXR5QXR0cmlidXRlcy5maW5kKGVhID0+IGVhLklzU3RyaW5nKS5OYW1lXTogc1RleHQKCgkJCQl9KSwKCQkJfTsKCQl9CgoJCV9lYVRvRmllbGQoZWEpIHsKCQkJbGV0IHJldCA9IG51bGw7CgoJCQlpZiAoZWEuRW50aXR5VHlwZSkgewoJCQkJcmV0ID0gewoJCQkJCV90eXBlOiBlYS5FbnRpdHlUeXBlLkVudGl0eUF0dHJpYnV0ZXMuZmluZChwZWEgPT4gIXBlYS5FbnRpdHlNZXRob2QgJiYgcGVhLkVudGl0eVR5cGUgPT0gZWEuRW50aXR5VHlwZSkgPyAndHJlZScgOiAnc2VsZWN0JywKCQkJCQl0eXBlOiAnc2VsZWN0JywKCQkJCQlwYXJlbnRGaWVsZDogZWEuRW50aXR5VHlwZS5FbnRpdHlBdHRyaWJ1dGVzLmZpbmQocGVhID0+ICFwZWEuRW50aXR5TWV0aG9kICYmIHBlYS5FbnRpdHlUeXBlID09IGVhLkVudGl0eVR5cGUpPy5OYW1lLAoJCQkJCS8vaWRGaWVsZDogJ19Ub1N0cmluZycsCgkJCQkJem9uZTogJ2NlbnRlcicsCgkJCQkJQ2xhc3M6IHsKCQkJCQkJTmFtZTogZWEuRW50aXR5VHlwZS5OYW1lLAoJCQkJCQlJZDogZWEuRW50aXR5VHlwZS5JZAoJCQkJCX0sCgkJCQkJc291cmNlOiAobywgZkRhdGEsIHNUZXh0KSA9PiAoewoJCQkJCQlPUEVSQVRPUlM6IHsKCQkJCQkJCVtlYS5FbnRpdHlUeXBlLkVudGl0eUF0dHJpYnV0ZXMuZmluZChlYSA9PiBlYS5Jc1N0cmluZykuTmFtZV06ICdsaWtlJwoJCQkJCQl9LAoJCQkJCQlbZWEuRW50aXR5VHlwZS5FbnRpdHlBdHRyaWJ1dGVzLmZpbmQoZWEgPT4gZWEuSXNTdHJpbmcpLk5hbWVdOiBzVGV4dAoKCQkJCQl9KSwKCQkJCQlsaW5rczogW3sKCQkJCQkJbmFtZTogJ3VpTGluaycsCgkJCQkJCWljb246IGVhLkVudGl0eU1ldGhvZCA/ICdzYXZlJyA6ICdhY3Rpb24nLAoJCQkJCQlDbGFzczogewoJCQkJCQkJTmFtZTogZWEuRW50aXR5VHlwZS5OYW1lLAoJCQkJCQkJSWQ6IGVhLkVudGl0eVR5cGUuSWQKCQkJCQkJfSwKCQkJCQkJYWN0aW9uOiBlYS5FbnRpdHlNZXRob2QgPyAoYXN5bmMgKG8sIGwsIG9wdGlvbnMpID0+IHsKCQkJCQkJCS8vY29uc29sZS5sb2cobywgbCwgb3B0aW9ucyk7CgkJCQkJCQlfRnJFTUQuUmVuZGVyUGFnZSh7CgkJCQkJCQkJX2NvZGU6ICdzdG9yZScsCgkJCQkJCQl9LCB7CgkJCQkJCQkJQ2xhc3M6IGwuQ2xhc3MsCgkJCQkJCQkJW2wuQ2xhc3MuTmFtZS5yZXBsYWNlKC9cIC9nLCAnJyldOiBvW29wdGlvbnMubmFtZV0KCQkJCQkJCX0pOwoJCQkJCQl9KSA6IChhc3luYyAobywgbCwgb3B0aW9ucykgPT4ge30pLAoJCQkJCX1dCgkJCQl9OwoJCQl9IGVsc2UgaWYgKGVhLklzVGV4dCkgewoJCQkJcmV0ID0gewoJCQkJCXR5cGU6ICd3aW5kb3cnLAoJCQkJCXpvbmU6ICdjZW50ZXInLAoJCQkJCWVkaXRvcjogdHJ1ZSwKCQkJCQlsYW5ndWFnZTogdHlwZW9mKGVhLklzVGV4dCkgPT09ICdzdHJpbmcnID8gZWEuSXNUZXh0IDogKGVhLk5hbWUuaW5kZXhPZignc2NyaXB0JykgPj0gMCA/ICdqYXZhc2NyaXB0JyA6ICd0ZXh0JyksCgkJCQl9OwoJCQkJLy9jb25zb2xlLmxvZygiRHluYUZvcm06Ol9lYVRvRmllbGQoIiArIGVhLk5hbWUgKyAiKTogcmV0IiwgcmV0KTsKCQkJfSBlbHNlIHsKCQkJCXJldCA9IHsKCQkJCQl6b25lOiAnY2VudGVyJywKCQkJCQlbZWEuSXNCb29sID8gJ2NoZWNrZWQnIDogJ3ZhbHVlJ106IGVhLkRlZmF1bHQsCgkJCQkJdHlwZTogT2JqZWN0LmVudHJpZXMoewoJCQkJCQlCb29sOiAnYm9vbCcsCgkJCQkJCURhdGU6ICdkYXRldGltZScsCgkJCQkJCUludDogJ2ludCcsCgkJCQkJCUxvbmc6ICdsb25nJywKCQkJCQkJSW1hZ2U6ICdpbWFnZScsCgkJCQkJCVN0cmluZzogJ3N0cmluZycsCgkJCQkJCUZpbGU6ICdmaWxlJywKCQkJCQkJRmxvYXQ6ICdpbnQnLAoJCQkJCX0pLmZpbmQoZSA9PiBlYVsnSXMnICsgZVswXV0pWzFdLAoJCQkJfTsKCQkJfQoKCQkJaWYgKGVhLklzRmlsZSkgewoJCQkJcmV0LmxvY2FsID0gdHJ1ZTsKCQkJCXJldC5iaW5hcnkgPSB0cnVlOwoJCQkJcmV0LnVwbG9hZCA9IChmRGF0YSwgZGF0YSwgZmlsZU5hbWUpID0+IHsKCQkJCQkvLyB1cGxvYWRlZAoJCQkJfTsKCQkJfQoKCQkJcmV0ID0gT2JqZWN0LmFzc2lnbih7CgkJCQlncm91cDogZWEuR3JvdXA/Lk5hbWUsCgkJCQluYW1lOiBlYS5OYW1lLAoJCQl9LCByZXQpOwoKCQkJaWYgKGVhLkVudGl0eU1ldGhvZD8uUmVzcG9uc2VBdHRyaWJ1dGUgPT0gZWEpIHsKCQkJCS8vcmV0LnpvbmUgPSAnc291dGgnOwoJCQl9CgoJCQkvL2NvbnNvbGUubG9nKCJfZWFUb0ZpZWxkKCIgKyBlYS5OYW1lICsgIik6ICIsIHJldCk7CgoJCQlyZXR1cm4gcmV0OwoJCX0KCgkJYnVzeShiQnVzeSkgewoJCQlyZXR1cm4gdGhpcy5kRm9ybS5idXN5KGJCdXN5KTsKCQl9CgoJCV9tZSh2KSB7CgkJCWxldCBtZU5hbWUgPSAodHlwZW9mKGNvbXBhbnkpICE9PSAndW5kZWZpbmVkJykgPyAoY29tcGFueS5sb2dnZWRJbklkZW50aXR5IHx8ICJtZSIpIDogIm1lIjsKCQkJaWYgKHYpIHsKCQkJCXdpbmRvd1ttZU5hbWVdID0gdjsKCQkJfQoKCQkJcmV0dXJuIHdpbmRvd1ttZU5hbWVdOwoJCX0KCgkJYXN5bmMgX3JlbmRlcigpIHsKCQkJLy8gb3ZlcnJpZGUgdG8gZ2VuZXJhdGUgY29tcG9uZW50IGNvbnRlbnQKCQkJcmV0dXJuICIiOwoJCX0KCgkJX2NhblZpZXcoKSB7CgkJCWlmICghdGhpcy5fbWUoKSkgewoJCQkJd2luZG93Ll9GckVNRC5zZXRVUkwoewoJCQkJCXBhZ2U6ICdsb2dpbicsCgkJCQkJX3JlZGlyZWN0OiB0aGlzLnBhZ2UuX2NvZGUsCgkJCQl9KTsKCQkJCXRocm93IGBfY2FuVmlldzogJHt0aGlzLnBhZ2UuX2NvZGV9IG5vdCBhbGxvd2VkIHdpdGhvdXQgbG9naW4hYDsKCQkJfQoJCX0KCX0KCglDb250ZW50Q29tcG9uZW50ID0gY2xhc3MgZXh0ZW5kcyB0aGlzLkNvcmVDb21wb25lbnQgewoJCWFzeW5jIG1haW4oKSB7CgkJCWNvbnNvbGUubG9nKCJDb250ZW50Q29tcG9uZW50OjptYWluKCkiLCAiR09UIEhFUkUiKTsKCQl9CgoJCWFzeW5jIF9yZW5kZXIoKSB7CgkJCXJldHVybiB0aGlzLnBhZ2U/LkJvZHkgfHwgdGhpcy5wYWdlPy5fYm9keTsKCQl9Cgl9CgoJSGVhZGVyQ29tcG9uZW50ID0gY2xhc3MgZXh0ZW5kcyB0aGlzLkNvcmVDb21wb25lbnQgewoJCWFzeW5jIG1haW4oKSB7CgkJCS8vY29uc29sZS5sb2coIkhlYWRlckNvbXBvbmVudDo6bWFpbigpIiwgIkdPVCBIRVJFIikKCQl9CgoJCV9tZW51Q2xhc3NlcygpIHsKCQkJLy9jb25zb2xlLmxvZygiSGVhZGVyQ29tcG9uZW50OjpfbWVudUNsYXNzZXMoIiArIHNjb3BlICsgIik6IG9TY29wZSIsIHRoaXMuc2NvcGUsIHRoaXMub1Njb3BlLCBfRnJFTUQuYXBpU2VydmVyKTsKCQkJaWYgKCF0aGlzLm9TY29wZSkgcmV0dXJuIFtdOwoKCQkJcmV0dXJuIF9GckVNRC5ncm91cEJ5KHRoaXMub1Njb3BlLkVudGl0eUNsYXNzZXMsICdFbnRpdHlNb2R1bGUnKS5tYXAoZyA9PiAoewoJCQkJbGFiZWw6IChnLmtleSA/IHRoaXMuZEZvcm0uZW5nbGlzaChnLmtleS5OYW1lKSA6IG51bGwpIHx8ICdNYWluJywKCQkJCXN1Yk1lbnVzOiBfRnJFTUQuZ3JvdXBCeShnLnZhbHVlcywgJ0dyb3VwJykubWFwKGd2ID0+ICh7CgkJCQkJbGFiZWw6IChndi5rZXkgPyB0aGlzLmRGb3JtLmVuZ2xpc2goZ3Yua2V5Lk5hbWUpIDogbnVsbCkgfHwgJ01haW4nLAoJCQkJCXN1Yk1lbnVzOiAoZ3YudmFsdWVzIHx8IFtdKS5tYXAoZ3Z2ID0+ICh7CgkJCQkJCWxhYmVsOiB0aGlzLmRGb3JtLmVuZ2xpc2goZ3Z2Lk5hbWUpLAoJCQkJCQljb2RlOiAnc3RvcmUnLAoJCQkJCQlkYXRhOiBndnYuTmFtZQoJCQkJCX0pKQoJCQkJfSkpCgkJCX0pKTsKCQl9CgoJCV9tZW51TWV0aG9kcygpIHsKCQkJLy9jb25zb2xlLmxvZygiSGVhZGVyQ29tcG9uZW50OjpfbWVudU1ldGhvZHMoIiArIHRoaXMuc2NvcGUgKyAiKTogdGhpcy5vU2NvcGUiLCB0aGlzLnNjb3BlLCB0aGlzLm9TY29wZSwgX0ZyRU1ELmFwaVNlcnZlcik7CgkJCWlmICghdGhpcy5vU2NvcGUpIHJldHVybiBbXTsKCgkJCS8vY29uc29sZS5sb2coIkhlYWRlckNvbXBvbmVudDo6X21lbnVNZXRob2RzKCk6IGNsYXNzZXMiLCBfRnJFTUQuZ3JvdXBCeSh0aGlzLm9TY29wZS5FbnRpdHlDbGFzc2VzLmZpbHRlcihlYyA9PiBlYy5FbnRpdHlNZXRob2RzLmxlbmd0aCksICdFbnRpdHlNb2R1bGUnKSk7CgoJCQlyZXR1cm4gX0ZyRU1ELmdyb3VwQnkodGhpcy5vU2NvcGUuRW50aXR5Q2xhc3Nlcy5maWx0ZXIoZWMgPT4gZWMuRW50aXR5TWV0aG9kcy5sZW5ndGgpLCAnRW50aXR5TW9kdWxlJykubWFwKGcgPT4gKHsKCQkJCWxhYmVsOiAoZy5rZXkgPyB0aGlzLmRGb3JtLmVuZ2xpc2goZy5rZXkuTmFtZSkgOiBudWxsKSB8fCAnTWFpbicsCgkJCQlzdWJNZW51czogX0ZyRU1ELmdyb3VwQnkoZy52YWx1ZXMsICdHcm91cCcpLm1hcChndiA9PiAoewoJCQkJCWxhYmVsOiAoZ3Yua2V5ID8gdGhpcy5kRm9ybS5lbmdsaXNoKGd2LmtleS5OYW1lKSA6IG51bGwpIHx8ICdNYWluJywKCQkJCQlzdWJNZW51czogKGd2LnZhbHVlcyB8fCBbXSkubWFwKG1jID0+ICh7CgkJCQkJCWxhYmVsOiB0aGlzLmRGb3JtLmVuZ2xpc2gobWMuTmFtZSksCgkJCQkJCXN1Yk1lbnVzOiBtYy5FbnRpdHlNZXRob2RzLm1hcChlbSA9PiAoewoJCQkJCQkJbGFiZWw6IHRoaXMuZEZvcm0uZW5nbGlzaChlbS5OYW1lKSwKCQkJCQkJCWNvZGU6ICdtZXRob2QnLAoJCQkJCQkJZGF0YTogbWMuTmFtZSArICIuIiArIGVtLk5hbWUKCQkJCQkJfSkpCgkJCQkJfSkpCgkJCQl9KSkKCQkJfSkpOwoJCX0KCgkJX2J1aWxkTWVudShzY29wZSkgewoJCQlyZXR1cm4gW3sKCQkJCWxhYmVsOiAiTWFpbiIsCgkJCQlvcmRlcjogLTEsCgkJCQlzdWJNZW51czogW3sKCQkJCQlsYWJlbDogJ0luZGV4JywKCQkJCX0sIHsKCQkJCQlsYWJlbDogIkxvZ2luIiwKCQkJCX0sIHsKCQkJCQlsYWJlbDogIkxvYWQiLAoJCQkJfSwgewoJCQkJCWxhYmVsOiAiU2F2ZSIsCgkJCQl9LCB7CgkJCQkJbGFiZWw6ICJMb2dvdXQiCgkJCQl9XQoJCQl9LCB7CgkJCQlsYWJlbDogIlByb2Nlc3MiLAoJCQkJb3JkZXI6IDk5OTk4LAoJCQkJc3ViTWVudXM6IHRoaXMuX21lbnVNZXRob2RzKHNjb3BlKQoJCQl9LCB7CgkJCQlsYWJlbDogIlNldHVwIiwKCQkJCW9yZGVyOiA5OTk5OSwKCQkJCXN1Yk1lbnVzOiB0aGlzLl9tZW51Q2xhc3NlcyhzY29wZSkKCQkJfV07CgkJfQoKCQlhc3luYyBfcmVuZGVyKCkgewoJCQlyZXR1cm4gYAo8c3R5bGUgdHlwZT0idGV4dC9jc3MiPgoJI2ZtIHsKCQltYXJnaW46IDA7CgkJcGFkZGluZzogMTBweCAzMHB4OwoJfQoKCS5mdGl0bGUgewoJCWZvbnQtc2l6ZTogMTRweDsKCQlmb250LXdlaWdodDogYm9sZDsKCQlwYWRkaW5nOiA1cHggMDsKCQltYXJnaW4tYm90dG9tOiAxMHB4OwoJCWJvcmRlci1ib3R0b206IDFweCBzb2xpZCAjY2NjOwoJfQoKCS5maXRlbSB7CgkJbWFyZ2luLWJvdHRvbTogNXB4OwoJfQoKCS5maXRlbSBsYWJlbCB7CgkJZGlzcGxheTogaW5saW5lLWJsb2NrOwoJCXdpZHRoOiAxMDBweDsKCX0KCgkuZml0ZW0gaW5wdXQgewoJCXdpZHRoOiAxNjBweDsKCX0KPC9zdHlsZT4KCQkJYCArIHRoaXMuZEZvcm0ubWVudSh7CgkJCQltZW51OiB0aGlzLl9idWlsZE1lbnUoKQoJCQl9KTsKCQl9Cgl9CgoJTWFpbkNvbXBvbmVudCA9IGNsYXNzIGV4dGVuZHMgdGhpcy5Db3JlQ29tcG9uZW50IHsKCQlhc3luYyBtYWluKCkgewoJCQkvLyAKCQl9CgoJCWFzeW5jIF9yZW5kZXIoKSB7CgkJCXJldHVybiBgPCU9dHlwZW9mKGZvcm0pIT09J3VuZGVmaW5lZCc/Zm9ybTonJyU+YDsKCQl9Cgl9CgoJTG9hZENvbXBvbmVudCA9IGNsYXNzIGV4dGVuZHMgdGhpcy5Db3JlQ29tcG9uZW50IHsKCQlhc3luYyBtYWluKCkgewoJCQl0aGlzLnBhZ2UuZGF0YSA9IHsKCQkJCWZvcm06IHRoaXMuZEZvcm0ucmVuZGVyKCdmcm1Mb2FkJywgIkxvYWQgU2V0dXAgRGF0YSIsIFt7CgkJCQkJbmFtZTogJ0V4Y2VsJywKCQkJCQl0eXBlOiAiZmlsZSIsCgkJCQkJYmluYXJ5OiB0cnVlLAoJCQkJCWxvY2FsOiB0cnVlLAoJCQkJCWV4Y2VsOiBhc3luYyAoZkRhdGEsIGRhdGEsIGZpbGVuYW1lKSA9PiB7CgkJCQkJCWNvbnNvbGUuY2xlYXIoKTsKCgkJCQkJCXRoaXMuZEZvcm0uc2V0KHsKCQkJCQkJCVByb2dyZXNzOiAwCgkJCQkJCX0pOwoKCQkJCQkJbGV0IHNlcnZlciA9IG5ldyh0aGlzLm9TY29wZVt0aGlzLm9TY29wZS5FbnRpdHlDbGFzc2VzLmZpbmQoYyA9PiBjLklzTWFpbikuTmFtZV0pKCk7IC8qdGhpcy5fc2VydmVyKGZpbGVuYW1lLnNwbGl0KCcuJylbMF0pOyovCgkJCQkJCWxldCBvYmogPSBPYmplY3Qua2V5cyhkYXRhKS5maWx0ZXIoayA9PiBkYXRhW2tdLmxlbmd0aCkubWFwKGsgPT4gZGF0YVtrXS5tYXAoZCA9PiBzZXJ2ZXIuX25ldyhrKS5fZnJvbURvY3VtZW50KGQpKSkuZmxhdCgpOwoJCQkJCQlmb3IgYXdhaXQgKGNvbnN0IG8gb2Ygb2JqKSB7CgkJCQkJCQlhd2FpdCBvLnN0b3JlKCk7CgkJCQkJCQl0aGlzLmRGb3JtLnNldCh7CgkJCQkJCQkJUHJvZ3Jlc3M6IHRoaXMuZEZvcm0uZ2V0KCkuUHJvZ3Jlc3MgKyAxMDAuMCAvIG9iai5sZW5ndGgKCQkJCQkJCX0pOwoJCQkJCQl9CgoJCQkJCQlfRnJFTUQuUmVuZGVyUGFnZSh7CgkJCQkJCQlfY29kZTogJ2xvZ2luJwoJCQkJCQl9KTsKCQkJCQl9LAoJCQkJfSwgewoJCQkJCW5hbWU6ICJQcm9ncmVzcyIsCgkJCQkJdHlwZTogInByb2dyZXNzIiwKCQkJCX1dLCBbewoJCQkJCW5hbWU6ICdMb2FkJywKCQkJCQlvbmNsaWNrOiBhc3luYyBvID0+IHt9CgkJCQl9XSkKCQkJfTsKCQl9Cgl9CgoJU2F2ZUNvbXBvbmVudCA9IGNsYXNzIGV4dGVuZHMgdGhpcy5Db3JlQ29tcG9uZW50IHsKCQlhc3luYyBtYWluKCkgewoJCQkvL3RoaXMuX2NhblZpZXcoKTsKCgkJCXRoaXMucGFnZS5kYXRhID0gewoJCQkJZm9ybTogdGhpcy5kRm9ybS5yZW5kZXIoJ2ZybVNhdmUnLCAiU2F2ZSBTZXR1cCBEYXRhIiwgW3sKCQkJCQluYW1lOiAnU2F2ZScsCgkJCQkJdHlwZTogImxhYmVsIiwKCQkJCQl2YWx1ZTogIkV4cG9ydCB0byBFeGNlbCIsCgkJCQl9LCB7CgkJCQkJbmFtZTogJ1RpdGxlJywKCQkJCQl0eXBlOiAnc3RyaW5nJywKCQkJCQl2YWx1ZTogJycsCgkJCQl9LCB7CgkJCQkJbmFtZTogIlByb2dyZXNzIiwKCQkJCQl0eXBlOiAicHJvZ3Jlc3MiLAoJCQkJfV0sIFt7CgkJCQkJbmFtZTogJ1NhdmUnLAoJCQkJCW9uY2xpY2s6IGFzeW5jIG8gPT4gewoJCQkJCQljb25zb2xlLmNsZWFyKCk7CgoJCQkJCQl0aGlzLmRGb3JtLnNldCh7CgkJCQkJCQlQcm9ncmVzczogMAoJCQkJCQl9KTsKCgkJCQkJCWxldCBzZXJ2ZXIgPSBuZXcodGhpcy5vU2NvcGVbdGhpcy5vU2NvcGUuRW50aXR5Q2xhc3Nlcy5maW5kKGMgPT4gYy5Jc01haW4pLk5hbWVdKSgpOwoKCQkJCQkJbGV0IHRUZW1wbGF0ZSA9IHsKCQkJCQkJCWhlYWRlclJvdzogdHJ1ZSwKCQkJCQkJCXN0eWxlOiB7CgkJCQkJCQkJdGhlbWU6ICdUYWJsZVN0eWxlRGFyazMnLAoJCQkJCQkJCXNob3dSb3dTdHJpcGVzOiB0cnVlLAoJCQkJCQkJfSwKCQkJCQkJfTsKCQkJCQkJbGV0IHRhYmxlcyA9IFtdOwoJCQkJCQlmb3IgYXdhaXQgKGNvbnN0IGMgb2YgX0ZyRU1ELl9fc2NvcGUoc2VydmVyLlNjb3BlKS5FbnRpdHlDbGFzc2VzLnNvcnQoKGEsIGIpID0+IGEuUmFuayAtIGIuUmFuaykpIHsKCQkJCQkJCS8vY29uc29sZS5sb2coIkR5bmFGb3JtOjpTYXZlQ29tcG9uZW50KCk6ICIgKyBjLk5hbWUgKyAiLCBSYW5rPSIgKyBjLlJhbmspOwoJCQkJCQkJdGFibGVzLnB1c2goT2JqZWN0LmFzc2lnbihKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHRUZW1wbGF0ZSkpLCBhd2FpdCBzZXJ2ZXIuX25ldyhjLk5hbWUpLl90b1RhYnVsYXIoKSkpOwoJCQkJCQkJdGhpcy5kRm9ybS5zZXQoewoJCQkJCQkJCVByb2dyZXNzOiB0aGlzLmRGb3JtLmdldCgpLlByb2dyZXNzICsgMTAwLjAgLyBfRnJFTUQuX19zY29wZShzZXJ2ZXIuU2NvcGUpLkVudGl0eUNsYXNzZXMubGVuZ3RoCgkJCQkJCQl9KTsKCQkJCQkJfQoJCQkJCQl0YWJsZXMuZm9yRWFjaCh0ID0+IHQucmVmID0gJ0ExOicgKyBTdHJpbmcuZnJvbUNoYXJDb2RlKCdBJy5jaGFyQ29kZUF0KDApICsgdC5jb2x1bW5zLmxlbmd0aCAtIDEpICsgKHQucm93cy5sZW5ndGggKyAxKSk7CgoJCQkJCQlsZXQgcmdiID0gKGxldHRlcnMgPSAnMDEyMzQ1Njc4OUFCQ0RFRicpID0+IEFycmF5KDYpLm1hcChpID0+IGxldHRlcnNbTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTYpXSkuam9pbignJyk7CgoJCQkJCQljb25zdCB3b3JrYm9vayA9IG5ldyBFeGNlbEpTLldvcmtib29rKCk7CgkJCQkJCXRhYmxlcy5mb3JFYWNoKHQgPT4gd29ya2Jvb2suYWRkV29ya3NoZWV0KHQubmFtZSwgewoJCQkJCQkJcHJvcGVydGllczogewoJCQkJCQkJCXRhYkNvbG9yOiB7CgkJCQkJCQkJCWFyZ2I6ICdGJyArIHJnYigpCgkJCQkJCQkJfQoJCQkJCQkJfQoJCQkJCQl9KS5hZGRUYWJsZSh0KSk7CgoJCQkJCQlsZXQgYnVmZmVyID0gYXdhaXQgd29ya2Jvb2sueGxzeC53cml0ZUJ1ZmZlcih7CgkJCQkJCQlkYXRlRm9ybWF0OiAnWVlZWS1NTS1ERCBISDptbTpzcycKCQkJCQkJfSk7CgoJCQkJCQljb25zdCBsaW5rID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpOwoJCQkJCQlsaW5rLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CgkJCQkJCWRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQobGluayk7CgkJCQkJCWxpbmsuaHJlZiA9IFVSTC5jcmVhdGVPYmplY3RVUkwobmV3IEJsb2IoW2J1ZmZlcl0sIHsKCQkJCQkJCXR5cGU6ICdhcHBsaWNhdGlvbi92bmQub3BlbnhtbGZvcm1hdHMtb2ZmaWNlZG9jdW1lbnQuc3ByZWFkc2hlZXRtbC5zaGVldDtjaGFyc2V0PVVURi04JwoJCQkJCQl9KSk7CgkJCQkJCWxpbmsuZG93bmxvYWQgPSAoby5UaXRsZSB8fCBzZXJ2ZXIuU2NvcGUgfHwgImRhdGEiKSArICIueGxzeCI7CgkJCQkJCWxpbmsuY2xpY2soKTsKCQkJCQl9CgkJCQl9XSkKCQkJfTsKCQl9Cgl9CgoJSW5kZXhDb21wb25lbnQgPSBjbGFzcyBleHRlbmRzIHRoaXMuQ29yZUNvbXBvbmVudCB7CgkJYXN5bmMgbWFpbigpIHsKCQkJdGhpcy5fY2FuVmlldygpOwoKCQkJdGhpcy5wYWdlLmRhdGEgPSB7CgkJCQlmb3JtOiB0aGlzLmRGb3JtLnJlbmRlcignZnJtSW5kZXgnLCAiTWFpbiBQYWdlIiwgW3sKCQkJCQluYW1lOiAnV2VsY29tZScsCgkJCQkJcmVxdWlyZWQ6IHRydWUsCgkJCQkJdHlwZTogImxhYmVsIiwKCQkJCQl2YWx1ZTogdGhpcy5fbWUoKT8ubmFtZT8uKCkgfHwgdGhpcy5fbWUoKT8uX3RvU3RyaW5nPy4oKSB8fCB0aGlzLl9tZSgpPy5Ub1N0cmluZywKCQkJCX1dLCBbXSkKCQkJfTsKCQl9Cgl9CgoJTG9nb3V0Q29tcG9uZW50ID0gY2xhc3MgZXh0ZW5kcyB0aGlzLkNvcmVDb21wb25lbnQgewoJCWFzeW5jIG1haW4oKSB7CgkJCXRoaXMuX2NhblZpZXcoKTsKCgkJCWRlbGV0ZSB3aW5kb3cubWU7CgoJCQl0aGlzLnBhZ2UuZGF0YSA9IHsKCQkJCWZvcm06IHRoaXMuZEZvcm0ucmVuZGVyKCdmcm1Mb2dvdXQnLCAiTG9nb3V0IiwgW3sKCQkJCQkJbmFtZTogIkxvZ291dCIsCgkJCQkJCXR5cGU6ICJsYWJlbCIsCgkJCQkJCXZhbHVlOiAibG9nb3V0IGluIHByb2dyZXNzLi4uIgoJCQkJCX1dLAoJCQkJCVtdKQoJCQl9OwoKCQkJX0ZyRU1ELlJlbmRlclBhZ2UoewoJCQkJX2NvZGU6ICJsb2dpbiIKCQkJfSk7CgkJfQoJfQoKCUxvZ2luQ29tcG9uZW50ID0gY2xhc3MgZXh0ZW5kcyB0aGlzLkNvcmVDb21wb25lbnQgewoJCWFzeW5jIF9hdXRoZW50aWNhdGUobykgewoJCQljb25zb2xlLmxvZygiX2F1dGhlbnRpY2F0ZSgpOiAiLCB0aGlzLm9TY29wZSwgdGhpcy5zY29wZSk7CgkJCWxldCBhdXRoQ2xhc3NOYW1lID0gdGhpcy5vU2NvcGU/LkVudGl0eUNsYXNzZXM/LmZpbmQoYyA9PiBjLkVudGl0eUF0dHJpYnV0ZXMuZmluZChlYSA9PiBlYS5OYW1lID09ICd1c2VybmFtZScpKT8uTmFtZTsKCgkJCWlmIChhdXRoQ2xhc3NOYW1lKSByZXR1cm4gYXdhaXQgbmV3KHRoaXMub1Njb3BlW3RoaXMub1Njb3BlLkVudGl0eUNsYXNzZXMuZmluZChjID0+IGMuSXNNYWluKS5OYW1lXSkoKS5fbmV3KGF1dGhDbGFzc05hbWUpLnVzZXJuYW1lKG8uVXNlcm5hbWUsICc9JykucGFzc3dvcmQoby5QYXNzd29yZCwgJz0nKS5hY3RpdmUodHJ1ZSkuZW5hYmxlZCh0cnVlKS5maW5kKCk7CgoJCQlhdXRoQ2xhc3NOYW1lID0gYXV0aENsYXNzTmFtZSB8fCAod2luZG93LmJMb2NhbCA/ICh7CgkJCQljbXM6ICJBdXRob3IiLAoJCQkJZW1zOiAiRW1wbG95ZWUiCgkJCX0pW2NvbXBhbnkuQ29kZV0gOiBudWxsKTsKCgkJCW8uT1BFUkFUT1JTID0gewoJCQkJVXNlcm5hbWU6ICI9IiwKCQkJCVBhc3N3b3JkOiAiPSIKCQkJfTsKCgkJCWlmIChhdXRoQ2xhc3NOYW1lKSByZXR1cm4gKGF3YWl0IHNyLl8oImVtcyIgKyBhdXRoQ2xhc3NOYW1lICsgIkZpbmQiLCBudWxsLCBvKSk7CgkJfQoKCQlhc3luYyBfbG9nZ2VkSW4oKSB7fQoKCQlhc3luYyBfbm90TG9nZ2VkSW4oKSB7fQoKCQlhc3luYyBtYWluKCkgewoJCQl0aGlzLnBhZ2UuZGF0YSA9IHsKCQkJCWZvcm06IHRoaXMuZEZvcm0ucmVuZGVyKCdmcm1Mb2dpbicsICJVc2VyIEF1dGhlbnRpY2F0aW9uIiwgW3sKCQkJCQkJbmFtZTogJ1VzZXJuYW1lJywKCQkJCQkJcmVxdWlyZWQ6IHRydWUsCgkJCQkJCXR5cGU6ICJzdHJpbmciCgkJCQkJfSwKCQkJCQl7CgkJCQkJCW5hbWU6ICdQYXNzd29yZCcsCgkJCQkJCXJlcXVpcmVkOiB0cnVlLAoJCQkJCQl0eXBlOiAicGFzc3dvcmQiCgkJCQkJfQoJCQkJXSwgW3sKCQkJCQluYW1lOiAnTG9naW4nLAoJCQkJCWF1dG9TdWJtaXQ6IHRydWUsCgkJCQkJb25jbGljazogYXN5bmMgbyA9PiB7CgkJCQkJCWxldCByZXQgPSBhd2FpdCB0aGlzLl9hdXRoZW50aWNhdGUobyk7CgoJCQkJCQlpZiAocmV0KSB7CgkJCQkJCQl0aGlzLl9tZShyZXQpOwoKCQkJCQkJCXRyeSB7CgkJCQkJCQkJYXdhaXQgdGhpcy5fbG9nZ2VkSW4oKTsKCQkJCQkJCX0gY2F0Y2ggKGV4KSB7fQoKCQkJCQkJCV9GckVNRC5zZXRVUkwoewoJCQkJCQkJCXBhZ2U6IF9GckVNRC5oYXNoLl9yZWRpcmVjdCB8fCAiaW5kZXgiCgkJCQkJCQl9KTsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCXRyeSB7CgkJCQkJCQkJYXdhaXQgdGhpcy5fbm90TG9nZ2VkSW4oKTsKCQkJCQkJCX0gY2F0Y2ggKGV4KSB7fQoKCQkJCQkJCXRoaXMuZEZvcm0uZXJyb3IoIkludmFsaWQgdXNlcm5hbWUgb3IgcGFzc3dvcmQiKTsKCQkJCQkJfQoKCQkJCQkJdGhpcy5kRm9ybS5idXN5KGZhbHNlKTsKCQkJCQl9CgkJCQl9XSkKCQkJfTsKCQl9Cgl9CgoJTWV0aG9kQ29tcG9uZW50ID0gY2xhc3MgZXh0ZW5kcyB0aGlzLkNvcmVDb21wb25lbnQgewoJCWFzeW5jIG1haW4oKSB7CgkJCXRoaXMuX2NhblZpZXcoKTsKCgkJCXRoaXMuc01ldGhvZCA9IHRoaXMucGFnZS5kYXRhOwoJCQljb25zb2xlLmNsZWFyKCk7CgoJCQlsZXQgZWMgPSB0aGlzLm9TY29wZS5FbnRpdHlDbGFzc2VzLmZpbmQoYyA9PiBjLk5hbWUgPT0gdGhpcy5zTWV0aG9kLnNwbGl0KCcuJylbMF0pOwoJCQlsZXQgZW0gPSBlYy5FbnRpdHlNZXRob2RzLmZpbmQobSA9PiBtLk5hbWUgPT0gdGhpcy5zTWV0aG9kLnNwbGl0KCcuJylbMV0pOwoKCQkJdGhpcy5wYWdlLmRhdGEgPSB7CgkJCQlmb3JtOiB0aGlzLmRGb3JtLnJlbmRlcih0aGlzLnNNZXRob2QsIF9GckVNRC5fdGl0bGVDYXNlKGVjLk5hbWUpICsgJyA6OiAnICsgX0ZyRU1ELl90aXRsZUNhc2UoZW0uTmFtZSksIFt0aGlzLl9lbnRpdHlGaWVsZChlYyldLmNvbmNhdCguLi5lbS5NZXRob2RQYXJhbWV0ZXJzLm1hcChwID0+IHRoaXMuX2VhVG9GaWVsZChwKSkpLmNvbmNhdChbdGhpcy5fZWFUb0ZpZWxkKGVtLlJlc3BvbnNlQXR0cmlidXRlKV0pLCBbewoJCQkJCW5hbWU6ICdSZXNldCcsCgkJCQkJb25jbGljazogbyA9PiB7CgkJCQkJCXRoaXMuZEZvcm0uY2xlYXIoKTsKCQkJCQl9LAoJCQkJCWljb246ICJjYW5jZWwiCgkJCQl9LCB7CgkJCQkJbmFtZTogJ1JlbG9hZCcsCgkJCQkJb25jbGljazogbyA9PiBfRnJFTUQuUmVuZGVyUGFnZSh7CgkJCQkJCV9jb2RlOiAnbWV0aG9kJwoJCQkJCX0sIHRoaXMucGFnZS5kYXRhKSwKCQkJCQlpY29uOiAicmVsb2FkIgoJCQkJfSwgewoJCQkJCW5hbWU6IGVtLk5hbWUsCgkJCQkJdGl0bGU6IF9GckVNRC5fdGl0bGVDYXNlKGVtLk5hbWUpLAoJCQkJCW9uY2xpY2s6IGFzeW5jIG8gPT4gewoJCQkJCQlsZXQgb2JqID0gb1tlYy5OYW1lXSB8fCBfRnJFTUQuYXBpU2VydmVyLl9uZXcoZWMuTmFtZSk7CgkJCQkJCWNvbnNvbGUubG9nKCJvbmNsaWNrKCkiLCBlYy5OYW1lLCBvYmosIG8sIG9bZWMuTmFtZV0pOwoJCQkJCQkvL2lmIChvW3RoaXMuc1RhYmxlXSAmJiB0eXBlb2Yob1t0aGlzLnNUYWJsZV0uX19zeW5jX29uKSA9PT0gJ2Z1bmN0aW9uJyAmJiBvW3RoaXMuc1RhYmxlXS5fX3N5bmNfb24oKSkgb2JqLklkID0gb1t0aGlzLnNUYWJsZV0uSWQ7CgoJCQkJCQlhd2FpdCBvYmpbZW0uTmFtZV0oLi4uZW0uTWV0aG9kUGFyYW1ldGVycy5tYXAocCA9PiBvW3AuTmFtZV0pKTsKCQkJCQl9CgkJCQl9XSkKCQkJfTsKCQl9Cgl9CgoJU3RvcmVDb21wb25lbnQgPSBjbGFzcyBleHRlbmRzIHRoaXMuQ29yZUNvbXBvbmVudCB7CgkJYXN5bmMgbWFpbigpIHsKCQkJdGhpcy5fY2FuVmlldygpOwoKCQkJaWYgKHR5cGVvZih0aGlzLnBhZ2UuZGF0YSkgPT09ICdzdHJpbmcnKSB7CgkJCQl0aGlzLnNUYWJsZSA9IHRoaXMucGFnZS5kYXRhOwoJCQl9IGVsc2UgaWYgKHR5cGVvZih0aGlzLnBhZ2UuZGF0YSkgPT09ICdvYmplY3QnKSB7CgkJCQl0aGlzLnNUYWJsZSA9IHRoaXMucGFnZS5kYXRhLkNsYXNzLk5hbWU7CgkJCX0KCQkJY29uc29sZS5jbGVhcigpOwoKCQkJY29uc29sZS5sb2coIkR5bmFGb3JtOjpTdG9yZUNvbXBvbmVudCgpOiB0aGlzLnBhZ2UuZGF0YSIsIHRoaXMucGFnZS5kYXRhKTsKCgkJCWxldCBlYyA9IHRoaXMub1Njb3BlLkVudGl0eUNsYXNzZXMuZmluZChjID0+IGMuTmFtZSA9PSB0aGlzLnNUYWJsZSk7CgoJCQl0aGlzLnBhZ2UuZGF0YSA9IHsKCQkJCWZvcm06IHRoaXMuZEZvcm0ucmVuZGVyKGVjLk5hbWUucmVwbGFjZSgvXCAvZywgJ18nKSwgX0ZyRU1ELl90aXRsZUNhc2UoZWMuTmFtZSksIFtPYmplY3QuYXNzaWduKHRoaXMuX2VudGl0eUZpZWxkKGVjKSwgewoJCQkJCXNlbGVjdDogYXN5bmMgbyA9PiB7CgkJCQkJCXRoaXMuZEZvcm0uY2xlYXIoKTsKCQkJCQkJdGhpcy5kRm9ybS5idXN5KHRydWUpOwoKCQkJCQkJbGV0IHIgPSBhd2FpdCBvLmZpbmQoKTsKCQkJCQkJdGhpcy5kRm9ybS5zZXQoT2JqZWN0LmFzc2lnbih7CgkJCQkJCQlbZWMuTmFtZS5yZXBsYWNlKC9cIC9nLCAnXycpXTogcgoJCQkJCQl9LCAuLi5lYy5FbnRpdHlBdHRyaWJ1dGVzLmZpbHRlcihlYSA9PiAhZWEuRW50aXR5TWV0aG9kKS5maWx0ZXIoZWEgPT4gdHlwZW9mKHJbZWEuTmFtZV0oKSkgIT09ICd1bmRlZmluZWQnKS5tYXAoZWEgPT4gKHsKCQkJCQkJCVtlYS5OYW1lXTogcltlYS5OYW1lXSgpCgkJCQkJCX0pKSkpOwoJCQkJCQl0aGlzLmRGb3JtLmJ1c3koZmFsc2UpOwoJCQkJCX0KCQkJCX0pXS5jb25jYXQoLi4uZWMuRW50aXR5QXR0cmlidXRlcy5maWx0ZXIoZWEgPT4gIWVhLkVudGl0eU1ldGhvZCkubWFwKGVhID0+IHRoaXMuX2VhVG9GaWVsZChlYSkpKSwgW3sKCQkJCQluYW1lOiAnUmVzZXQnLAoJCQkJCW9uY2xpY2s6IG8gPT4gewoJCQkJCQl0aGlzLmRGb3JtLmNsZWFyKCk7CgkJCQkJfSwKCQkJCQlpY29uOiAiY2FuY2VsIgoJCQkJfSwgewoJCQkJCW5hbWU6ICdSZWxvYWQnLAoJCQkJCW9uY2xpY2s6IG8gPT4gX0ZyRU1ELlJlbmRlclBhZ2UoewoJCQkJCQlfY29kZTogJ3N0b3JlJwoJCQkJCX0sIHRoaXMucGFnZS5kYXRhKSwKCQkJCQlpY29uOiAicmVsb2FkIgoJCQkJfSwgewoJCQkJCW5hbWU6ICdTYXZlJywKCQkJCQlvbmNsaWNrOiBhc3luYyBvID0+IHsKCQkJCQkJbGV0IG9iaiA9IF9GckVNRC5hcGlTZXJ2ZXIuX25ldyh0aGlzLnNUYWJsZSk7CgkJCQkJCS8vY29uc29sZS5sb2coIm9uY2xpY2soKSIsIHRoaXMuc1RhYmxlLCBvYmosIG8sIG9bdGhpcy5zVGFibGVdKTsKCQkJCQkJaWYgKG9bdGhpcy5zVGFibGVdICYmIHR5cGVvZihvW3RoaXMuc1RhYmxlXS5fX3N5bmNfb24pID09PSAnZnVuY3Rpb24nICYmIG9bdGhpcy5zVGFibGVdLl9fc3luY19vbigpKSBvYmouSWQgPSBvW3RoaXMuc1RhYmxlXS5JZDsKCgkJCQkJCWVjLkVudGl0eUF0dHJpYnV0ZXMuZmlsdGVyKGVhID0+ICFlYS5FbnRpdHlNZXRob2QpLmZvckVhY2goZWEgPT4gb2JqW2VhLk5hbWVdKG9bZWEuTmFtZV0pKTsKCQkJCQkJLy9yZXR1cm4gY29uc29sZS5sb2cob2JqLl90b0ZpbGVOYW1lKCksIG9iaik7CgkJCQkJCWF3YWl0IG9iai5zdG9yZSgpOwoJCQkJCX0KCQkJCX1dKQoJCQl9OwoJCX0KCX0KCS8qKiBDb21wb25lbnRzOjpFbmQgKiovCn07",
	"storedMethod": null,
	"__keys": ["name"],
	"active": true,
	"enabled": true,
	"__trMap": []
}