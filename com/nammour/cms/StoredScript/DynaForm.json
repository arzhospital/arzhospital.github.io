{
	"Id": "5a442889184747f6cfc5de625264acae7a32355e",
	"name": "DynaForm",
	"script": "d2luZG93LkR5bmFGb3JtID0gY2xhc3MgewoJY29uc3RydWN0b3IoKSB7CgkJdGhpcy50aXRsZSA9ICJGb3JtIFRpdGxlIjsKCQl0aGlzLm5hbWUgPSAiZnJtRm9ybSI7CgkJdGhpcy5lbGVtZW50cyA9IFtdOwoJCXRoaXMuc2VsZWN0cyA9IFtdOwoJCXRoaXMuZ3JpZHMgPSBbXTsKCQl0aGlzLmJ1dHRvbnMgPSBbXTsKCQl0aGlzLnpvbmVzID0gWydub3J0aCcsICdzb3V0aCcsICdlYXN0JywgJ3dlc3QnLCAnY2VudGVyJ107CgkJdGhpcy5zVGFibGUgPSBudWxsOwoJCXRoaXMuYkRlYnVnID0gZmFsc2U7CgkJdGhpcy51aVR5cGVzID0gewoJCQlpbnQ6ICJudW1iZXJzcGlubmVyIiwKCQkJbWVudTogInNwbGl0YnV0dG9uIiwKCQkJZGF0ZXRpbWU6ICJkYXRldGltZWJveCIsCgkJCWJvb2w6ICJzd2l0Y2hidXR0b24iLAoJCQlmaWxlOiAiZmlsZWJveCIsCgkJCXRleHQ6ICJ0ZXh0Ym94IiwKCQkJcGFzc3dvcmQ6ICJwYXNzd29yZGJveCIsCgkJCXN0cmluZzogInRleHRib3giLAoJCQlpbWFnZTogImRpYWxvZyIsCgkJCXByb2dyZXNzOiAicHJvZ3Jlc3NiYXIiLAoJCQlsaW5rOiAibGlua2J1dHRvbiIsCgkJCXRyZWU6ICJjb21ib3RyZWUiLAoJCQluYXZpZ2F0aW9uOiAidHJlZSIsCgkJCXNlYXJjaDogJ3NlYXJjaGJveCcsCgkJfTsKCQl0aGlzLmV2ZW50cyA9IFt7CgkJCW5hbWU6ICdvbkNsaWNrJywKCQkJaGFuZGxlcjogJ29uVG9nZ2xlJywKCQkJcGFyYW1zOiAnbj1ldmVudCcsCgkJCXR5cGU6ICd0b2dnbGUnLAoJCX0sIHsKCQkJbmFtZTogJ29uQ2xvc2UnLAoJCQloYW5kbGVyOiAnUGFuT25DbG9zZScsCgkJCXBhcmFtczogJ249ZXZlbnQnLAoJCQl0eXBlOiAnd2luZG93JywKCQl9LCB7CgkJCW5hbWU6ICdvblNlbGVjdCcsCgkJCWhhbmRsZXI6ICdTZWxlY3RDaGFuZ2UnLAoJCQlwYXJhbXM6ICduJywKCQkJdHlwZTogJ3RhYnMnLAoJCX0sIHsKCQkJbmFtZTogJ3NlYXJjaGVyJywKCQkJaGFuZGxlcjogJ0ZpZWxkQ2hhbmdlJywKCQkJcGFyYW1zOiAnbiwgbycsCgkJCXR5cGU6ICdzZWFyY2hib3gnLAoJCX0sIHsKCQkJbmFtZTogJ29uQmVmb3JlRXhwYW5kJywKCQkJaGFuZGxlcjogJ0V4cGFuZCcsCgkJCXBhcmFtczogJ24nLAoJCQl0eXBlOiAndHJlZScsCgkJfSwgewoJCQluYW1lOiAnb25DaGFuZ2UnLAoJCQloYW5kbGVyOiAnRmllbGRDaGFuZ2UnLAoJCQlwYXJhbXM6ICduLCBvJwoJCX0sIHsKCQkJbmFtZTogJ29uQmVmb3JlT3BlbicsCgkJCWhhbmRsZXI6ICdQYW5lbE9wZW4nLAoJCQlwYXJhbXM6ICcnLAoJCQl0eXBlOiAnd2luZG93JywKCQl9LCB7CgkJCW5hbWU6ICdvbk9wZW4nLAoJCQloYW5kbGVyOiAnUGVuZEFmdGVyT3BlbicsCgkJCXBhcmFtczogJycsCgkJCXR5cGU6ICd3aW5kb3cnLAoJCX0sIHsKCQkJbmFtZTogJ29uQ2xpY2snLAoJCQloYW5kbGVyOiAnZG9MaW5rJywKCQkJcGFyYW1zOiAnbj1ldmVudCwgbycsCgkJCXR5cGU6ICdsaW5rJywKCQl9LCB7CgkJCW5hbWU6ICdvbkNsaWNrUm93JywKCQkJaGFuZGxlcjogJ0ZpZWxkQ2hhbmdlJywKCQkJcGFyYW1zOiAnbiwgbycsCgkJCXR5cGU6ICdncmlkJywKCQl9XTsKCgkJaWYgKHR5cGVvZigkKSAhPT0gJ3VuZGVmaW5lZCcpICQod2luZG93KS5yZXNpemUodGhpcy53aW5kb3dSZXNpemVkKTsKCQl0aGlzLndpbmRvd1Jlc2l6ZWQoKTsKCX0KCglzcigpIHsKCQlyZXR1cm4gdHlwZW9mKF9GckVNRCkgIT09ICd1bmRlZmluZWQnID8gX0ZyRU1ELnNyKCkgOiB3aW5kb3cuc3I7Cgl9CgoJcGFyc2UoKSB7CgkJJC5wYXJzZXIucGFyc2UoKTsKCX0KCgl3aW5kb3dSZXNpemVkKCkgewoJCXRoaXMud2lkdGggPSB3aW5kb3cuaW5uZXJXaWR0aDsKCQl0aGlzLmhlaWdodCA9IHdpbmRvdy5pbm5lckhlaWdodCAqIDAuODsKCX0KCglpbml0KCkgewoJCXZhciBzZWxlY3QgPSB7CgkJCWluaXQ6IGZ1bmN0aW9uKGNvbnRhaW5lciwgb3B0aW9ucykgewoJCQkJdmFyIG9wID0gbnVsbDsKCQkJCXZhciBmb3AgPSBudWxsOwoJCQkJZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmdyaWRzLmxlbmd0aDsgaSsrKQoJCQkJCWlmICh0aGlzLmdyaWRzW2ldLmlkID09IG9wdGlvbnMuc291cmNlKSBvcCA9IHRoaXMuZ3JpZHNbaV0ub3B0aW9uczsKCQkJCWZvciAoaSA9IDA7IGkgPCBvcC5jb2x1bW5zLmxlbmd0aDsgaSsrKQoJCQkJCWlmIChvcC5jb2x1bW5zW2ldLm5hbWUgPT0gb3B0aW9ucy5maWVsZCkgZm9wID0gb3AuY29sdW1uc1tpXTsKCQkJCWZvcC53aWR0aCA9ICh0aGlzLndpZHRoIC8gMyk7CgkJCQl2YXIgZSA9ICQodGhpcy5zZWxlY3QoZm9wKSk7CgkJCQl2YXIgaW5wdXQgPSBlLmFwcGVuZFRvKGNvbnRhaW5lcik7CgkJCQlpbnB1dC5jb21ib2dyaWQoKTsKCQkJCXRoaXMuYmluZChpbnB1dCk7CgkJCQlyZXR1cm4gaW5wdXQ7CgkJCX0sCgkJCWRlc3Ryb3k6IGZ1bmN0aW9uKHRhcmdldCkgewoJCQkJJCh0YXJnZXQpLnJlbW92ZSgpOwoJCQl9LAoJCQlnZXRWYWx1ZTogZnVuY3Rpb24odGFyZ2V0KSB7CgkJCQlyZXR1cm4gJCh0YXJnZXQpLnZhbCgpOwoJCQl9LAoJCQlzZXRWYWx1ZTogZnVuY3Rpb24odGFyZ2V0LCB2YWx1ZSkgewoJCQkJJCh0YXJnZXQpLnZhbCh2YWx1ZSk7CgkJCX0sCgkJCXJlc2l6ZTogZnVuY3Rpb24odGFyZ2V0LCB3aWR0aCkgewoJCQkJJCh0YXJnZXQpLl9vdXRlcldpZHRoKHdpZHRoKTsKCQkJfQoJCX07CgkJJC5leHRlbmQoJC5mbi5kYXRhZ3JpZC5kZWZhdWx0cy5lZGl0b3JzLCB7CgkJCWRhdGV0aW1lOiB7CgkJCQlpbml0OiBmdW5jdGlvbihjb250YWluZXIsIG9wdGlvbnMpIHsKCQkJCQlvcHRpb25zLndpZHRoID0gdGhpcy5jV2lkdGgob3B0aW9ucyk7CgkJCQkJdmFyIGlucHV0ID0gJCh0aGlzLmRhdGV0aW1lKG9wdGlvbnMpKS5hcHBlbmRUbyhjb250YWluZXIpOwoJCQkJCWlucHV0LmRhdGV0aW1lYm94KCk7CgkJCQkJcmV0dXJuIGlucHV0OwoJCQkJfSwKCQkJCWRlc3Ryb3k6IGZ1bmN0aW9uKHRhcmdldCkgewoJCQkJCSQodGFyZ2V0KS5yZW1vdmUoKTsKCQkJCX0sCgkJCQlnZXRWYWx1ZTogZnVuY3Rpb24odGFyZ2V0KSB7CgkJCQkJcmV0dXJuICQodGFyZ2V0KS52YWwoKTsKCQkJCX0sCgkJCQlzZXRWYWx1ZTogZnVuY3Rpb24odGFyZ2V0LCB2YWx1ZSkgewoJCQkJCSQodGFyZ2V0KS52YWwodmFsdWUpOwoJCQkJfSwKCQkJCXJlc2l6ZTogZnVuY3Rpb24odGFyZ2V0LCB3aWR0aCkgewoJCQkJCSQodGFyZ2V0KS5fb3V0ZXJXaWR0aCh3aWR0aCk7CgkJCQl9CgkJCX0sCgkJCWNoZWNrYm94OiB7CgkJCQlpbml0OiBmdW5jdGlvbihjb250YWluZXIsIG9wdGlvbnMpIHsKCQkJCQl2YXIgaW5wdXQgPSAkKHRoaXMuYm9vbChvcHRpb25zKSkuYXBwZW5kVG8oY29udGFpbmVyKTsKCQkJCQlpbnB1dC5zd2l0Y2hidXR0b24oKTsKCQkJCQlyZXR1cm4gaW5wdXQ7CgkJCQl9LAoJCQkJZGVzdHJveTogZnVuY3Rpb24odGFyZ2V0KSB7CgkJCQkJJCh0YXJnZXQpLnJlbW92ZSgpOwoJCQkJfSwKCQkJCWdldFZhbHVlOiBmdW5jdGlvbih0YXJnZXQpIHsKCQkJCQlyZXR1cm4gJCh0YXJnZXQpLnZhbCgpOwoJCQkJfSwKCQkJCXNldFZhbHVlOiBmdW5jdGlvbih0YXJnZXQsIHZhbHVlKSB7CgkJCQkJJCh0YXJnZXQpLnZhbCh2YWx1ZSk7CgkJCQl9LAoJCQkJcmVzaXplOiBmdW5jdGlvbih0YXJnZXQsIHdpZHRoKSB7CgkJCQkJJCh0YXJnZXQpLl9vdXRlcldpZHRoKHdpZHRoKTsKCQkJCX0KCQkJfSwKCQkJY29tYm90cmVlZ3JpZDogc2VsZWN0LAoJCQlzZWxlY3Q6IHNlbGVjdCwKCQl9KTsKCX0KCglhc2socXVlc3Rpb24sIGZBbnN3ZXIgPSB2ID0+IHYsIG9wdGlvbnMpIHsKCQkkLm1lc3NhZ2VyLmNvbmZpcm0odGhpcy50aXRsZSwgcXVlc3Rpb24sIGZ1bmN0aW9uKHIpIHsKCQkJaWYgKG9wdGlvbnMpIHsKCQkJCWZvciAodmFyIGkgPSAwOyBpIDwgb3B0aW9ucy5sZW5ndGg7IGkrKykgewoJCQkJCWlmIChvcHRpb25zW2ldLmFuc3dlciA9PSByKSB7CgkJCQkJCXJldHVybiBmQW5zd2VyKG9wdGlvbnNbaV0udmFsdWUpOwoJCQkJCX0KCQkJCX0KCQkJfSBlbHNlIHsKCQkJCXJldHVybiBmQW5zd2VyKHIpOwoJCQl9CgkJfSk7Cgl9CgoJdG9wRGF0YShhciwgZ0ZpZWxkLCB2RmllbGQsIHRvcCkgewoJCWlmICghdG9wKSB7CgkJCXJldHVybiBhcjsKCQl9CgkJcmV0ID0gW107CgkJJC5lYWNoKHRoaXMuc3IoKS5ncm91cEJ5KGFyLCBnRmllbGQpLCBmdW5jdGlvbihrZXksIHZhbHVlcykgewoJCQl2YWx1ZXMudmFsdWVzLnNvcnQoKGEsIGIpID0+IHsKCQkJCWlmIChwYXJzZUZsb2F0KGFbdkZpZWxkXSkgPCBwYXJzZUZsb2F0KGJbdkZpZWxkXSkpIHsKCQkJCQlyZXR1cm4gMTsKCQkJCX0gZWxzZSBpZiAocGFyc2VGbG9hdChhW3ZGaWVsZF0pID4gcGFyc2VGbG9hdChiW3ZGaWVsZF0pKSB7CgkJCQkJcmV0dXJuIC0xOwoJCQkJfSBlbHNlIHsKCQkJCQlyZXR1cm4gMDsKCQkJCX0KCQkJfSk7CgkJCSQuZWFjaCh2YWx1ZXMudmFsdWVzLCBmdW5jdGlvbihpLCB2KSB7CgkJCQlpZiAoaSA8IHRvcCkgewoJCQkJCXJldC5wdXNoKHYpOwoJCQkJfQoJCQl9KTsKCQl9KTsKCQlyZXR1cm4gcmV0OwoJfQoKCWFzeW5jIENSVUQoc1RhYmxlLCBiRml4ZWQpIHsKCQl2YXIgZmllbGRzID0gW107CgkJdGhpcy5zVGFibGUgPSBzVGFibGU7CgkJaWYgKGNvbXBhbnkubGlicmFyeSkgewoJCQl2YXIgcmV0ID0gYXdhaXQgdGhpcy5zcigpLl8oIkNvbnRlbnRNYW5hZ2VyLmNtc0dlbmVyYXRlTGF5ZXJDbGFzcyIsIG51bGwsIGNvbXBhbnkubGlicmFyeSArICIuIiArIHNUYWJsZSk7CgkJCWZpZWxkcy5wdXNoKHsKCQkJCWdyb3VwOiAiTWFpbiIsCgkJCQlhdHRyaWJ1dGU6IHsKCQkJCQlSZWxhdGlvbkNsYXNzOiB7CgkJCQkJCU5hbWU6IHNUYWJsZQoJCQkJCX0KCQkJCX0sCgkJCQluYW1lOiB0aGlzLnNUYWJsZSwKCQkJCXR5cGU6ICdzZWxlY3QnLAoJCQkJc2VsZWN0OiBmdW5jdGlvbihvKSB7CgkJCQkJdGhpcy5zZXQobyk7CgkJCQl9CgkJCX0pOwoJCQlmb3IgKHZhciBpID0gMDsgaSA8IHJldC5MYXllckF0dHJpYnV0ZXMubGVuZ3RoOyBpKyspIHsKCQkJCWlmIChyZXQuTGF5ZXJBdHRyaWJ1dGVzW2ldLk5hbWUgPT0gIklkIikgY29udGludWU7CgkJCQlmaWVsZHMucHVzaCh7CgkJCQkJZ3JvdXA6ICJNYWluIiwKCQkJCQluYW1lOiByZXQuTGF5ZXJBdHRyaWJ1dGVzW2ldLk5hbWUsCgkJCQkJdHlwZTogcmV0LkxheWVyQXR0cmlidXRlc1tpXS5OYXRpdmVUeXBlCgkJCQl9KTsKCQkJfQoJCQlmb3IgKGkgPSAwOyBpIDwgcmV0LlJlbGF0aW9uQXR0cmlidXRlcy5sZW5ndGg7IGkrKykgewoJCQkJdmFyIG0gPSByZXQuUmVsYXRpb25BdHRyaWJ1dGVzW2ldLklzQXJyYXk7CgkJCQl2YXIgckNvbHMgPSBbXTsKCQkJCWZvciAodmFyIHAgaW4gcmV0LlJlbGF0aW9uQXR0cmlidXRlc1tpXS5SZWxhdGlvbkNsYXNzKSB7CgkJCQkJaWYgKCQuaW5BcnJheShwLCBbIlRvU3RyaW5nIiwgIl9Ub1N0cmluZyIsICJfX1JPV0lEIiwgIl9fTE9BREVEIiwgIklkIl0pID4gLTEpIGNvbnRpbnVlOwoJCQkJCXJDb2xzLnB1c2goewoJCQkJCQlmaWVsZDogcCwKCQkJCQkJdGl0bGU6IHAKCQkJCQl9KTsKCQkJCX0KCQkJCWZpZWxkcy5wdXNoKHsKCQkJCQlncm91cDogKG0gPyAiT3RoZXIiIDogIlJlbGF0aW9ucyIpLAoJCQkJCUNsYXNzOiByZXQuUmVsYXRpb25BdHRyaWJ1dGVzW2ldLlJlbGF0aW9uQ2xhc3MsCgkJCQkJbmFtZTogcmV0LlJlbGF0aW9uQXR0cmlidXRlc1tpXS5OYW1lLAoJCQkJCXR5cGU6ICdzZWxlY3QnLAoJCQkJCW11bHRpcGxlOiBtLAoJCQkJCXNvdXJjZTogZnVuY3Rpb24obywgZkRhdGEpIHsKCQkJCQkJcmV0dXJuIG87CgkJCQkJfSwKCQkJCQljb2x1bW5zOiByQ29scwoJCQkJfSk7CgkJCX0KCQl9IGVsc2UgewoJCQkvLyBlbXMKCQkJdmFyIGVjID0gKGNvbXBhbnkuU2NvcGUgPyB3aW5kb3dbY29tcGFueS5TY29wZV0gOiB3aW5kb3cpLkVudGl0eUNsYXNzZXMuZmluZChjID0+IGMuTmFtZS5yZXBsYWNlKCcgJywgJ18nKSA9PSBzVGFibGUpOwoJCQlmaWVsZHMucHVzaCh7CgkJCQluYW1lOiBzVGFibGUsCgkJCQl0aXRsZTogZWMuTmFtZSwKCQkJCUNsYXNzOiB7CgkJCQkJTmFtZTogZWMuTmFtZSwKCQkJCQlJZDogZWMuSWQKCQkJCX0sCgkJCQl0eXBlOiAnc2VsZWN0JywKCQkJCXNlbGVjdDogZnVuY3Rpb24obykgewoJCQkJCXRoaXMuY2xlYXIoKTsKCQkJCQl0aGlzLnNldChvKTsKCQkJCX0KCQkJfSk7CgkJCSQuZWFjaChlYy5FbnRpdHlBdHRyaWJ1dGVzLCAoXywgZWEpID0+IHsKCQkJCWlmICghZWEuRW50aXR5VHlwZSkgewoJCQkJCXZhciB0eXBlID0gInN0cmluZyI7CgkJCQkJaWYgKGVhLklzQm9vbCkgdHlwZSA9ICJib29sIjsKCQkJCQlpZiAoZWEuSXNEYXRlKSB0eXBlID0gImRhdGV0aW1lIjsKCQkJCQlpZiAoZWEuSXMpIHR5cGUgPSAiZGF0ZXRpbWUiOwoJCQkJCWlmIChlYS5Jc1RleHQpIHR5cGUgPSAidGV4dCI7CgkJCQkJZmllbGRzLnB1c2goewoJCQkJCQlncm91cDogZWEuR3JvdXAuTmFtZSwKCQkJCQkJbmFtZTogZWEuTmFtZSwKCQkJCQkJdHlwZTogdHlwZQoJCQkJCX0pOwoJCQkJfSBlbHNlIHsKCQkJCQlmaWVsZHMucHVzaCh7CgkJCQkJCWdyb3VwOiBlYS5Hcm91cC5OYW1lLAoJCQkJCQluYW1lOiBlYS5OYW1lLAoJCQkJCQlDbGFzczogewoJCQkJCQkJTmFtZTogZWEuRW50aXR5VHlwZS5OYW1lLAoJCQkJCQkJSWQ6IGVhLkVudGl0eVR5cGUuSWQKCQkJCQkJfSwKCQkJCQkJc291cmNlOiBmdW5jdGlvbihvLCBmRGF0YSkgewoJCQkJCQkJcmV0dXJuIG87CgkJCQkJCX0sCgkJCQkJCXR5cGU6ICJzZWxlY3QiCgkJCQkJfSk7CgkJCQl9CgkJCX0pOwoJCX0KCQlyZXR1cm4gewoJCQlmb3JtOiB0aGlzLmRGb3JtLnJlbmRlcihzVGFibGUsIHRoaXMuZW5nbGlzaChzVGFibGUpLCBmaWVsZHMsIFt7CgkJCQluYW1lOiAnUmVzZXQnLAoJCQkJb25jbGljazogZnVuY3Rpb24obykgewoJCQkJCXRoaXMuYnVzeShmYWxzZSk7CgkJCQkJdGhpcy5jbGVhcigpOwoJCQkJfSwKCQkJCWljb246ICJjYW5jZWwiCgkJCX0sIHsKCQkJCW5hbWU6ICdTYXZlJywKCQkJCW9uY2xpY2s6IGZ1bmN0aW9uKG8pIHsKCQkJCQlpZiAob1t0aGlzLnNUYWJsZV0gJiYgb1t0aGlzLnNUYWJsZV0uSWQpIG8uSWQgPSBvW3RoaXMuc1RhYmxlXS5JZDsKCQkJCQlkZWxldGUgb1t0aGlzLnNUYWJsZV07CgkJCQkJaWYgKGNvbXBhbnkubGlicmFyeSkgewoJCQkJCQl0aGlzLnNyKCkuXyhjb21wYW55LkNvZGUudG9Mb3dlckNhc2UoKSArICIiICsgdGhpcy5zVGFibGUgKyAoby5JZCA/ICJVcGRhdGUiIDogIkluc2VydCIpLCBmdW5jdGlvbihyZXQpIHsKCQkJCQkJCWlmIChyZXQpIHsKCQkJCQkJCQl0aGlzLmluZm8odGhpcy5zVGFibGUgKyAiIFNhdmVkIik7CgkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCXRoaXMuZXJyb3IoIlVuYWJsZSB0byBzYXZlICIgKyB0aGlzLnNUYWJsZSk7CgkJCQkJCQl9CgkJCQkJCQl0aGlzLmJ1c3koZmFsc2UpOwoJCQkJCQl9LCBvKTsKCQkJCQl9IGVsc2UgewoJCQkJCQl0aGlzLnNyKCkuXygiZW1zRW50aXR5T2JqZWN0IiArIChvLklkID8gIlVwZGF0ZSIgOiAiSW5zZXJ0IiksIGZ1bmN0aW9uKHJldCkgewoJCQkJCQkJaWYgKHJldCkgewoJCQkJCQkJCXRoaXMuaW5mbyh0aGlzLnNUYWJsZSArICIgU2F2ZWQiKTsKCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJdGhpcy5lcnJvcigiVW5hYmxlIHRvIHNhdmUgIiArIHRoaXMuc1RhYmxlKTsKCQkJCQkJCX0KCQkJCQkJCXRoaXMuYnVzeShmYWxzZSk7CgkJCQkJCX0sIG8udG9FbnRpdHlPYmplY3QoKSk7CgkJCQkJfQoJCQkJfQoJCQl9XSwgYkZpeGVkKQoJCX07Cgl9CgoJYXN5bmMgZG9DbGljayhidXR0b24pIHsKCQlsZXQgX3RoaXMgPSB0eXBlb2YodGhpcy5kb0NsaWNrKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMgOiB3aW5kb3cuREZvcm07CgkJYnV0dG9uID0gX3RoaXMuYnV0dG9ucy5maW5kKGIgPT4gYi5uYW1lID09IGJ1dHRvbi5uYW1lICYmIGIuZ3JvdXAgPT0gYnV0dG9uLmdyb3VwKTsKCQlfdGhpcy5idXN5KHRydWUpOwoJCXZhciBvID0gX3RoaXMuZ2V0KCk7CgkJdmFyIHNNaXNzaW5nID0gX3RoaXMuZWxlbWVudHMuZmlsdGVyKGUgPT4gKGJ1dHRvbi53aW5kb3cgPyBidXR0b24uZ3JvdXAgPT0gZS5ncm91cCA6IHRydWUpKS5maWx0ZXIoZSA9PiBlLnJlcXVpcmVkICYmICFvW2UubmFtZV0pLm1hcChlID0+ICI8bGk+IiArIChlLmxhYmVsIHx8IGUubmFtZSkgKyAiPC9saT4iKS5qb2luKCIiKTsKCQlpZiAoc01pc3NpbmcpIHsKCQkJd2luZG93Ll9GckVNRC5fZXJyb3IoIk1pc3NpbmcgbWFuZGF0b3J5IGZpZWxkczo8YnIvPjx1bD4iICsgc01pc3NpbmcgKyAiPC91bD4iLCA1MDAwKTsKCQkJX3RoaXMuYnVzeShmYWxzZSk7CgkJCXJldHVybjsKCQl9CgkJaWYgKGJ1dHRvbi5vbmNsaWNrKSBhd2FpdCBidXR0b24ub25jbGljayhvKTsKCQlpZiAoYnV0dG9uLm9uQ2xpY2spIGF3YWl0IGJ1dHRvbi5vbkNsaWNrKG8pOwoJCV90aGlzLmJ1c3koZmFsc2UpOwoJfQoKCWJ1c3koYkJ1c3kpIHsKCQlpZiAoIWJCdXN5KSB7CgkJCXZhciB0b3RhbCA9IDA7CgkJCWlmICh0eXBlb2YgbW9tZW50ICE9PSAndW5kZWZpbmVkJykgewoJCQkJdG90YWwgPSBtb21lbnQoKS5kaWZmKG1vbWVudCh0aGlzLmJ1c3lTdGFtcCksICdzZWNvbmRzJyk7CgkJCX0gZWxzZSB7CgkJCQkvLyBubyBtb21lbnQsIHVzZSBzdGFuZGFyZCBEYXRlCgkJCQl0b3RhbCA9IChuZXcgRGF0ZSgpLmdldFRpbWUoKSAtIHRoaXMuYnVzeVN0YW1wID8gdGhpcy5idXN5U3RhbXAuZ2V0VGltZSgpIDogMCkgLyAxMDAwIC8gMzYwMDsKCQkJfQoJCQlpZiAodGhpcy5iRGVidWcpIHsKCQkJCXdpbmRvdy5fRnJFTUQuX2FsZXJ0KCJFeGVjdXRpb24gVGltZTogIiArIHRvdGFsICsgIiBzZWNvbmRzLiIpOwoJCQl9CgkJCWRlbGV0ZSB0aGlzLmJ1c3lTdGFtcDsKCQl9IGVsc2UgewoJCQl0aGlzLmJ1c3lTdGFtcCA9IG5ldyBEYXRlKCk7CgkJfQoKCQkkLmVhY2goJC5tZXJnZSgkLm1hcCh0aGlzLmJ1dHRvbnMsIGIgPT4gYi5uYW1lKSwgJC5tYXAodGhpcy5lbGVtZW50cy5maWx0ZXIoZSA9PiBlLnR5cGUgPT0gJ2xpbmsnKSwgZSA9PiBlLm5hbWUpKSwgKF8sIGUpID0+ICQoJyMnICsgZSkubGlua2J1dHRvbihiQnVzeSA/ICdkaXNhYmxlJyA6ICdlbmFibGUnKSk7Cgl9CgoJcHJlZml4KGUpIHsKCQlzd2l0Y2ggKGUudHlwZSkgewoJCQljYXNlICdsYWJlbCc6CgkJCQlyZXR1cm4gJ2xibCc7CgkJCWNhc2UgJ3RleHQnOgoJCQljYXNlICdzdHJpbmcnOgoJCQljYXNlICdzZWFyY2gnOgoJCQljYXNlICdwYXNzd29yZCc6CgkJCQlyZXR1cm4gJ3R4dCc7CgkJCWNhc2UgIkRhdGVUaW1lIjoKCQkJY2FzZSAiZGF0ZXRpbWUiOgoJCQkJcmV0dXJuICdkdHAnOwoJCQljYXNlICJpbnQiOgoJCQljYXNlICJpbnRlZ2VyIjoKCQkJY2FzZSAibnVtYmVyIjoKCQkJY2FzZSAibG9uZyI6CgkJCWNhc2UgIkxvbmciOgoJCQkJcmV0dXJuICdudWQnOwoJCQljYXNlICdmaWxlJzoKCQkJCXJldHVybiAnZmlsJzsKCQkJY2FzZSAnaW1hZ2UnOgoJCQkJcmV0dXJuICdpbWcnOwoJCQljYXNlICJib29sIjoKCQkJCXJldHVybiAnY2hrJzsKCQkJY2FzZSAid2luZG93IjoKCQkJCXJldHVybiAncG5sJzsKCQkJY2FzZSAicHJvZ3Jlc3MiOgoJCQkJcmV0dXJuICdwcmcnOwoJCQljYXNlICJncmlkIjoKCQkJY2FzZSAidHJlZSI6CgkJCWNhc2UgInNlbGVjdCI6CgkJCQlyZXR1cm4gJ2NtYic7CgkJCWRlZmF1bHQ6CgkJCQlyZXR1cm4gJyc7CgkJfQoJfQoKCWNsZWFyKGdyb3VwKSB7CgkJdmFyIG8gPSB7fTsKCQkkLmVhY2godGhpcy5lbGVtZW50cy5maWx0ZXIoZSA9PiBncm91cCA/IGUuZ3JvdXAgPT0gZ3JvdXAgOiB0cnVlKSwgKF8sIGUpID0+IHsKCQkJdmFyIG5hbWUgPSAoZS5lbXNTb3VyY2UgPyAiXyIgOiAiIikgKyBlLm5hbWU7CgkJCXN3aXRjaCAoZS50eXBlKSB7CgkJCQljYXNlICd0ZXh0JzoKCQkJCWNhc2UgJ3N0cmluZyc6CgkJCQljYXNlICdzZWFyY2gnOgoJCQkJY2FzZSAncGFzc3dvcmQnOgoJCQkJY2FzZSAiRGF0ZVRpbWUiOgoJCQkJY2FzZSAiZGF0ZXRpbWUiOgoJCQkJCW9bbmFtZV0gPSAiIjsKCQkJCQlicmVhazsKCQkJCWNhc2UgImludCI6CgkJCQljYXNlICJudW1iZXIiOgoJCQkJY2FzZSAiaW50ZWdlciI6CgkJCQljYXNlICJsb25nIjoKCQkJCWNhc2UgIkxvbmciOgoJCQkJY2FzZSAicHJvZ3Jlc3MiOgoJCQkJCW9bbmFtZV0gPSAwOwoJCQkJCWJyZWFrOwoJCQkJY2FzZSAidHJlZSI6CgkJCQljYXNlICJzZWxlY3QiOgoJCQkJCW9bbmFtZV0gPSBudWxsOwoJCQkJCWJyZWFrOwoJCQkJY2FzZSAiZ3JpZCI6CgkJCQkJb1tuYW1lXSA/IG9bbmFtZV0uZGF0YSA9IFtdIDogbnVsbDsKCQkJCQlicmVhazsKCQkJCWNhc2UgImJvb2wiOgoJCQkJCW9bbmFtZV0gPSBmYWxzZTsKCQkJCQlicmVhazsKCQkJCWRlZmF1bHQ6CgkJCQkJYnJlYWs7CgkJCX0KCQl9KTsKCQkvL2NvbnNvbGUubG9nKCJjbGVhciIsIG8pOwoJCXRoaXMuc2V0KG8pOwoJCXRoaXMuYnVzeShmYWxzZSk7Cgl9CgoJc2V0KG8sIGVOYW1lKSB7CgkJaWYgKGVOYW1lKSB7CgkJCXZhciBvRWxlbWVudCA9IHRoaXMuYnlOYW1lKGVOYW1lKTsKCQkJaWYgKCFvRWxlbWVudCkgcmV0dXJuOwoJCQl2YXIgYXR0ID0gbnVsbDsKCQkJaWYgKG8gJiYgby5JZCAmJiBvLkVudGl0eUF0dHJpYnV0ZSkgewoJCQkJLy8gYW4gRW50aXR5VmFsdWUKCQkJCWZvciAodmFyIHAgaW4gbykKCQkJCQlpZiAocC5lbmRzV2l0aCgiVmFsdWUiKSkgYXR0ID0gcDsKCQkJCW9FbGVtZW50LmVtc1NvdXJjZSA9IG87CgkJCX0KCQkJdHJ5IHsKCQkJCXN3aXRjaCAob0VsZW1lbnQudHlwZSkgewoJCQkJCWNhc2UgJ2xhYmVsJzoKCQkJCQkJaWYgKGF0dCkgewoJCQkJCQkJJCgiIyIgKyB0aGlzLnByZWZpeChvRWxlbWVudCkgKyBvRWxlbWVudC5uYW1lKS5odG1sKG9bYXR0XSk7CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQkkKCIjIiArIHRoaXMucHJlZml4KG9FbGVtZW50KSArIG9FbGVtZW50Lm5hbWUpLmh0bWwoKG8gJiYgby5FbnRpdHlBdHRyaWJ1dGUpID8gIiIgOiBvKTsKCQkJCQkJfQoJCQkJCQlicmVhazsKCQkJCQljYXNlICd0ZXh0JzoKCQkJCQljYXNlICdzdHJpbmcnOgoJCQkJCWNhc2UgJ3Bhc3N3b3JkJzoKCQkJCQljYXNlICJpbnQiOgoJCQkJCWNhc2UgInNlYXJjaCI6CgkJCQkJY2FzZSAiaW50ZWdlciI6CgkJCQkJY2FzZSAibnVtYmVyIjoKCQkJCQljYXNlICJsb25nIjoKCQkJCQljYXNlICJMb25nIjoKCQkJCQkJaWYgKGF0dCkgewoJCQkJCQkJJCgiIyIgKyB0aGlzLnByZWZpeChvRWxlbWVudCkgKyBvRWxlbWVudC5uYW1lKVt0aGlzLnVpVHlwZXNbb0VsZW1lbnQudHlwZV1dKCJzZXRWYWx1ZSIsIG9bYXR0XSk7CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQkkKCIjIiArIHRoaXMucHJlZml4KG9FbGVtZW50KSArIG9FbGVtZW50Lm5hbWUpW3RoaXMudWlUeXBlc1tvRWxlbWVudC50eXBlXV0oInNldFZhbHVlIiwgKG8gJiYgby5FbnRpdHlBdHRyaWJ1dGUpID8gIiIgOiBvKTsKCQkJCQkJfQoJCQkJCQlicmVhazsKCQkJCQljYXNlICJEYXRlVGltZSI6CgkJCQkJY2FzZSAiZGF0ZXRpbWUiOgoJCQkJCQlpZiAoYXR0KSB7CgkJCQkJCQkkKCIjIiArIHRoaXMucHJlZml4KG9FbGVtZW50KSArIG9FbGVtZW50Lm5hbWUpW3RoaXMudWlUeXBlc1tvRWxlbWVudC50eXBlXV0oJ3NldFZhbHVlJywgKG9bYXR0XSA/IHRoaXMuc3IoKS50b0RhdGVUaW1lKG9bYXR0XSkgOiAiIikpOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJJCgiIyIgKyB0aGlzLnByZWZpeChvRWxlbWVudCkgKyBvRWxlbWVudC5uYW1lKVt0aGlzLnVpVHlwZXNbb0VsZW1lbnQudHlwZV1dKCdzZXRWYWx1ZScsIChvICYmIG8uRW50aXR5QXR0cmlidXRlKSA/ICIiIDogKG8gPyB0aGlzLnNyKCkudG9EYXRlVGltZShvKSA6ICIiKSk7CgkJCQkJCX0KCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAiYm9vbCI6CgkJCQkJCWlmIChhdHQpIHsKCQkJCQkJCSQoIiMiICsgdGhpcy5wcmVmaXgob0VsZW1lbnQpICsgb0VsZW1lbnQubmFtZSlbdGhpcy51aVR5cGVzW29FbGVtZW50LnR5cGVdXSgob1thdHRdID8gJycgOiAndW4nKSArICdjaGVjaycpOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJJCgiIyIgKyB0aGlzLnByZWZpeChvRWxlbWVudCkgKyBvRWxlbWVudC5uYW1lKVt0aGlzLnVpVHlwZXNbb0VsZW1lbnQudHlwZV1dKCgoKG8gJiYgby5FbnRpdHlBdHRyaWJ1dGUpID8gIiIgOiBvKSA/ICcnIDogJ3VuJykgKyAnY2hlY2snKTsKCQkJCQkJfQoJCQkJCQlicmVhazsKCQkJCQljYXNlICJ3aW5kb3ciOgoJCQkJCQlpZiAoYXR0KSB7CgkJCQkJCQlvRWxlbWVudC52YWx1ZSA9IG9bYXR0XTsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCW9FbGVtZW50LnZhbHVlID0gKG8gJiYgby5FbnRpdHlBdHRyaWJ1dGUpID8gIiIgOiBvOwoJCQkJCQl9CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgInByb2dyZXNzIjoKCQkJCQkJdmFyIHYgPSAwOwoJCQkJCQlpZiAoYXR0KSB7CgkJCQkJCQl2ID0gb1thdHRdOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJdiA9IChvICYmIG8uRW50aXR5QXR0cmlidXRlKSA/ICIiIDogbzsKCQkJCQkJfQoJCQkJCQkkKCIjIiArIHRoaXMucHJlZml4KG9FbGVtZW50KSArIG9FbGVtZW50Lm5hbWUpW3RoaXMudWlUeXBlc1tvRWxlbWVudC50eXBlXV0oJ3NldFZhbHVlJywgTWF0aC5yb3VuZCh2ICogMTApIC8gMTApOwoJCQkJCQlicmVhazsKCQkJCQljYXNlICJncmlkIjoKCQkJCQkJbGV0IGNvbHMgPSBKU09OLnBhcnNlKCJ7IiArIHRoaXMubWFwQ29sdW1ucyhvRWxlbWVudCwgdHJ1ZSkgKyAifSIpOwoJCQkJCQkkLmVhY2goY29scy5jb2x1bW5zWzBdLCAoXywgYykgPT4gYy5mb3JtYXR0ZXIgPSB0aGlzLnNyKCkucnVuU2NyaXB0KHRoaXMuZm9ybWF0dGVyKG9FbGVtZW50Lm5hbWUsIGMpKSk7CgkJCQkJCSQoIiMiICsgdGhpcy5wcmVmaXgob0VsZW1lbnQpICsgb0VsZW1lbnQubmFtZSkuZGF0YWdyaWQoY29scyk7CgkJCQkJCWlmIChhdHQpIHsKCQkJCQkJCSQoIiMiICsgdGhpcy5wcmVmaXgob0VsZW1lbnQpICsgb0VsZW1lbnQubmFtZSkuZGF0YWdyaWQoewoJCQkJCQkJCWRhdGE6IG9bYXR0XQoJCQkJCQkJfSk7CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQkkKCIjIiArIHRoaXMucHJlZml4KG9FbGVtZW50KSArIG9FbGVtZW50Lm5hbWUpLmRhdGFncmlkKHsKCQkJCQkJCQlkYXRhOiAobyAmJiBvLkVudGl0eUF0dHJpYnV0ZSkgPyAiIiA6IG8KCQkJCQkJCX0pOwoJCQkJCQl9CgkJCQkJCSQoIiMiICsgdGhpcy5wcmVmaXgob0VsZW1lbnQpICsgb0VsZW1lbnQubmFtZSkuZGF0YWdyaWQoInVuc2VsZWN0QWxsIik7CgkJCQkJCSQoIiMiICsgdGhpcy5wcmVmaXgob0VsZW1lbnQpICsgb0VsZW1lbnQubmFtZSkuZGF0YWdyaWQoKTsKCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAidHJlZSI6CgkJCQkJCXZhciB2ID0gYXR0ID8gb1thdHRdIDogKChvICYmIG8uRW50aXR5QXR0cmlidXRlKSA/ICIiIDogbyk7CgkJCQkJCWlmIChBcnJheS5pc0FycmF5KHYpKSB7CgkJCQkJCQkkKCIjIiArIHRoaXMucHJlZml4KG9FbGVtZW50KSArIG9FbGVtZW50Lm5hbWUpW3RoaXMudWlUeXBlc1tvRWxlbWVudC50eXBlXV0oInRyZWUiKS50cmVlKCJsb2FkRGF0YSIsIHYpOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJJCgiIyIgKyB0aGlzLnByZWZpeChvRWxlbWVudCkgKyBvRWxlbWVudC5uYW1lKVt0aGlzLnVpVHlwZXNbb0VsZW1lbnQudHlwZV1dKCdzZXRWYWx1ZScsIHYpOwoJCQkJCQl9CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgInNlbGVjdCI6CgkJCQkJCWlmIChhdHQpIHsKCQkJCQkJCWlmIChvRWxlbWVudC5vcHRpb25zKSB7CgkJCQkJCQkJJCgiIyIgKyB0aGlzLnByZWZpeChvRWxlbWVudCkgKyBvRWxlbWVudC5uYW1lKS5jb21ibygnc2V0VmFsdWUnICsgKG9FbGVtZW50Lm11bHRpcGxlID8gJ3MnIDogJycpLCAob1thdHRdID8gb1thdHRdIDogIiIpKTsKCQkJCQkJCQkkKCIjIiArIHRoaXMucHJlZml4KG9FbGVtZW50KSArIG9FbGVtZW50Lm5hbWUpLmNvbWJvKCdzZXRWYWx1ZScgKyAob0VsZW1lbnQubXVsdGlwbGUgPyAncycgOiAnJyksIChvW2F0dF0gPyBvW2F0dF0gOiAiIikpOwoJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQkkKCIjIiArIHRoaXMucHJlZml4KG9FbGVtZW50KSArIG9FbGVtZW50Lm5hbWUpLmNvbWJvZ3JpZCgnc2V0VmFsdWUnICsgKG9FbGVtZW50Lm11bHRpcGxlID8gJ3MnIDogJycpLCAob1thdHRdID8gb1thdHRdIDogIiIpKTsKCQkJCQkJCX0KCQkJCQkJfSBlbHNlIHsKCQkJCQkJCXYgPSBudWxsOwoJCQkJCQkJaWYgKG8gPT09IG51bGwpIHsKCgkJCQkJCQl9IGVsc2UgaWYgKG8uY29uc3RydWN0b3IgPT09IEFycmF5KSB7CgoJCQkJCQkJfSBlbHNlIGlmICghby5FbnRpdHlBdHRyaWJ1dGUpIHsKCQkJCQkJCQl2ID0gbyB8fCB7CgkJCQkJCQkJCUlkOiBvLklkLAoJCQkJCQkJCQlfVG9TdHJpbmc6IG8uX1RvU3RyaW5nLAoJCQkJCQkJCQl0b1N0cmluZzogZnVuY3Rpb24oKSB7CgkJCQkJCQkJCQlyZXR1cm4gdGhpcy5fVG9TdHJpbmc7CgkJCQkJCQkJCX0KCQkJCQkJCQl9OwoJCQkJCQkJfQoJCQkJCQkJaWYgKG9FbGVtZW50Lm9wdGlvbnMpIHsKCQkJCQkJCQkkKCIjIiArIHRoaXMucHJlZml4KG9FbGVtZW50KSArIG9FbGVtZW50Lm5hbWUpLmNvbWJvKCdzZXRWYWx1ZScgKyAob0VsZW1lbnQubXVsdGlwbGUgPyAncycgOiAnJyksIHYpOwoJCQkJCQkJCSQoIiMiICsgdGhpcy5wcmVmaXgob0VsZW1lbnQpICsgb0VsZW1lbnQubmFtZSkuY29tYm8oJ3NldFRleHQnICsgKG9FbGVtZW50Lm11bHRpcGxlID8gJ3MnIDogJycpLCB2KTsKCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJJCgiIyIgKyB0aGlzLnByZWZpeChvRWxlbWVudCkgKyBvRWxlbWVudC5uYW1lKS5jb21ib2dyaWQoJ3NldFZhbHVlJyArIChvRWxlbWVudC5tdWx0aXBsZSA/ICdzJyA6ICcnKSwgdik7CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQkJYnJlYWs7CgkJCQkJZGVmYXVsdDoKCQkJCQkJYnJlYWs7CgkJCQl9CgkJCX0gY2F0Y2ggKGV4KSB7CgkJCQljb25zb2xlLmxvZyhleCk7CgkJCX0KCQl9IGVsc2UgewoJCQlmb3IgKHZhciBwIGluIG8pIHsKCQkJCWlmIChwLmluZGV4T2YoJ18nKSA9PT0gMCkgcCA9IHAuc3Vic3RyaW5nKDEpOwoJCQkJdmFyIGUgPSB0aGlzLmJ5TmFtZShwKTsKCQkJCWlmICghZSB8fCAhZS5uYW1lKSBjb250aW51ZTsKCQkJCXZhciB2YWx1ZSA9IG9bcF07CgkJCQlpZiAoZS5uYW1lID09IHRoaXMuc1RhYmxlKSB7CgkJCQkJdmFsdWUgPSBvOwoJCQkJCXZhbHVlLkRhdGUgPSBuZXcgRGF0ZSgpOwoJCQkJfQoJCQkJaWYgKHAgPT0gIkVudGl0eVZhbHVlcyIpIHsKCQkJCQkvLyBhbiBlbXNGb3JtVmFsdWVzIHNvdXJjZQoJCQkJCS8vIGZpbmQgdGhlIEVudGl0eVZhbHVlIGZvciB0aGlzIGVsZW1lbnQgYW5kIHNldCBpdAoJCQkJCWZvciAodmFyIGogPSAwOyBqIDwgby5FbnRpdHlWYWx1ZXMubGVuZ3RoOyBqKyspIHsKCQkJCQkJaWYgKG8uRW50aXR5VmFsdWVzW2pdLkVudGl0eUF0dHJpYnV0ZS5OYW1lID09IGUubmFtZSkgewoJCQkJCQkJLy8gZm91bmQgdGhlIEVudGl0eVZhbHVlIGZvciB0aGlzIGVsZW1lbnQKCQkJCQkJCV92ID0gby5FbnRpdHlWYWx1ZXNbal07CgkJCQkJCQlmb3IgKHZhciBxIGluIF92KSB7CgkJCQkJCQkJaWYgKHEuZW5kc1dpdGgoIlZhbHVlIikpIHsKCQkJCQkJCQkJX3ZbcV0gPSB2YWx1ZTsKCQkJCQkJCQl9CgkJCQkJCQl9CgkJCQkJCQlicmVhazsKCQkJCQkJfQoJCQkJCX0KCQkJCX0KCQkJCXRoaXMuc2V0KHZhbHVlLCBlLm5hbWUpOwoJCQl9CgkJfQoJfQoKCWdldCgpIHsKCQl2YXIgbyA9IHt9OwoJCWlmICh0aGlzLnNUYWJsZSAmJiB3aW5kb3dbdGhpcy5zVGFibGVdKSBvID0gbmV3IHdpbmRvd1t0aGlzLnNUYWJsZV0oKTsKCQlmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuZWxlbWVudHMubGVuZ3RoOyBpKyspIHsKCQkJdmFyIGNuID0gbnVsbDsKCQkJdmFyIHYgPSBudWxsOwoJCQl0cnkgewoJCQkJc3dpdGNoICh0aGlzLmVsZW1lbnRzW2ldLnR5cGUpIHsKCQkJCQljYXNlICdsYWJlbCc6CgkJCQkJCWNuID0gJCgiI2xibCIgKyB0aGlzLmVsZW1lbnRzW2ldLm5hbWUpOwoJCQkJCQl2ID0gY24uaHRtbCgpOwoJCQkJCQlicmVhazsKCQkJCQljYXNlICd0ZXh0JzoKCQkJCQljYXNlICdzdHJpbmcnOgoJCQkJCWNhc2UgJ3NlYXJjaCc6CgkJCQkJY2FzZSAncGFzc3dvcmQnOgoJCQkJCQljbiA9ICQoIiMiICsgdGhpcy5wcmVmaXgodGhpcy5lbGVtZW50c1tpXSkgKyB0aGlzLmVsZW1lbnRzW2ldLm5hbWUpOwoJCQkJCQl2ID0gY24udmFsKCk7CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgImZpbGUiOgoJCQkJCWNhc2UgImltYWdlIjoKCQkJCQkJY24gPSAkKCIjIiArIHRoaXMucHJlZml4KHRoaXMuZWxlbWVudHNbaV0pICsgdGhpcy5lbGVtZW50c1tpXS5uYW1lKTsKCQkJCQkJdiA9IHRoaXMuZWxlbWVudHNbaV0uZGF0YTsKCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAiRGF0ZVRpbWUiOgoJCQkJCWNhc2UgImRhdGV0aW1lIjoKCQkJCQkJdiA9IG5ldyBEYXRlKCQoIiMiICsgdGhpcy5wcmVmaXgodGhpcy5lbGVtZW50c1tpXSkgKyB0aGlzLmVsZW1lbnRzW2ldLm5hbWUpLmRhdGV0aW1lYm94KCdnZXRWYWx1ZScpKTsKCQkJCQkJY24gPSAkKCIjIiArIHRoaXMucHJlZml4KHRoaXMuZWxlbWVudHNbaV0pICsgdGhpcy5lbGVtZW50c1tpXS5uYW1lKTsKCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAicHJvZ3Jlc3MiOgoJCQkJCQljbiA9ICQoIiMiICsgdGhpcy5wcmVmaXgodGhpcy5lbGVtZW50c1tpXSkgKyB0aGlzLmVsZW1lbnRzW2ldLm5hbWUpOwoJCQkJCQl2ID0gY24ucHJvZ3Jlc3NiYXIoJ2dldFZhbHVlJyk7CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgImludCI6CgkJCQkJY2FzZSAiaW50ZWdlciI6CgkJCQkJY2FzZSAibnVtYmVyIjoKCQkJCQljYXNlICJsb25nIjoKCQkJCQljYXNlICJMb25nIjoKCQkJCQkJY24gPSAkKCIjIiArIHRoaXMucHJlZml4KHRoaXMuZWxlbWVudHNbaV0pICsgdGhpcy5lbGVtZW50c1tpXS5uYW1lKTsKCQkJCQkJdiA9IHBhcnNlRmxvYXQoY24udmFsKCkpOwoJCQkJCQlpZiAoaXNOYU4odikpIHYgPSAwOwoJCQkJCQlicmVhazsKCQkJCQljYXNlICJncmlkIjoKCQkJCQkJY24gPSAkKCIjIiArIHRoaXMucHJlZml4KHRoaXMuZWxlbWVudHNbaV0pICsgdGhpcy5lbGVtZW50c1tpXS5uYW1lKTsKCQkJCQkJdiA9IGNuLmRhdGFncmlkKCdnZXREYXRhJyk7CgkJCQkJCXYuc2VsZWN0ZWQgPSBjbi5kYXRhZ3JpZCgiZ2V0U2VsZWN0ZWQiKTsKCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAidHJlZSI6CgkJCQkJCWNuID0gJCgiIyIgKyB0aGlzLnByZWZpeCh0aGlzLmVsZW1lbnRzW2ldKSArIHRoaXMuZWxlbWVudHNbaV0ubmFtZSk7CgkJCQkJCXYgPSBjbi5jb21ib3RyZWUoInRyZWUiKS50cmVlKCJnZXRTZWxlY3RlZCIpOwoJCQkJCQlicmVhazsKCQkJCQljYXNlICJ3aW5kb3ciOgoJCQkJCQl2ID0gdGhpcy5lbGVtZW50c1tpXS52YWx1ZTsKCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAic2VsZWN0IjoKCQkJCQkJaWYgKHRoaXMuZWxlbWVudHNbaV0ub3B0aW9ucykgewoJCQkJCQkJdiA9ICQoIiMiICsgdGhpcy5wcmVmaXgodGhpcy5lbGVtZW50c1tpXSkgKyB0aGlzLmVsZW1lbnRzW2ldLm5hbWUpLmNvbWJvZ3JpZCgnZ2V0VmFsdWUnICsgKHRoaXMuZWxlbWVudHNbaV0ubXVsdGlwbGUgPyAncycgOiAnJykpOwoJCQkJCQkJdiA9IHRoaXMuc3IoKS5ydW5TY3JpcHQodik7CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQl2ID0gJCgiIyIgKyB0aGlzLnByZWZpeCh0aGlzLmVsZW1lbnRzW2ldKSArIHRoaXMuZWxlbWVudHNbaV0ubmFtZSkuY29tYm9ncmlkKCdncmlkJykuZGF0YWdyaWQoJ2dldFNlbGVjdGlvbnMnKTsKCQkJCQkJCWlmICghdiB8fCAhdi5sZW5ndGgpIHsKCQkJCQkJCQl2ID0gJCgiIyIgKyB0aGlzLnByZWZpeCh0aGlzLmVsZW1lbnRzW2ldKSArIHRoaXMuZWxlbWVudHNbaV0ubmFtZSkuY29tYm9ncmlkKCdnZXRWYWx1ZScgKyAodGhpcy5lbGVtZW50c1tpXS5tdWx0aXBsZSA/ICdzJyA6ICcnKSk7CgkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCWlmICghdGhpcy5lbGVtZW50c1tpXS5tdWx0aXBsZSkgdiA9IHZbMF07CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQkJY24gPSAkKCIjIiArIHRoaXMucHJlZml4KHRoaXMuZWxlbWVudHNbaV0pICsgdGhpcy5lbGVtZW50c1tpXS5uYW1lKTsKCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAiYm9vbCI6CgkJCQkJCWNuID0gJCgiIyIgKyB0aGlzLnByZWZpeCh0aGlzLmVsZW1lbnRzW2ldKSArIHRoaXMuZWxlbWVudHNbaV0ubmFtZSk7CgkJCQkJCXYgPSBjbi5zd2l0Y2hidXR0b24oJ29wdGlvbnMnKS5jaGVja2VkOwoJCQkJCQlicmVhazsKCQkJCQlkZWZhdWx0OgoJCQkJCQlicmVhazsKCQkJCX0KCQkJCW9bdGhpcy5lbGVtZW50c1tpXS5uYW1lXSh2KTsKCQkJfSBjYXRjaCAoZSkgewoJCQkJLy9jb25zb2xlLmxvZyh0aGlzLmVsZW1lbnRzW2ldLm5hbWUsIGUpOwoJCQkJb1t0aGlzLmVsZW1lbnRzW2ldLm5hbWVdID0gdjsKCQkJfQoJCQlpZiAoY24pIHsKCQkJCWlmIChvLkVudGl0eVZhbHVlcykgewoJCQkJCWZvciAodmFyIGogPSAwOyBqIDwgby5FbnRpdHlWYWx1ZXMubGVuZ3RoOyBqKyspIHsKCQkJCQkJaWYgKHRoaXMuZWxlbWVudHNbaV0ubmFtZSA9PSB0aGlzLnNUYWJsZSAmJiB0aGlzLmVsZW1lbnRzW2ldLmVtc1NvdXJjZSkgby5JZCA9IHRoaXMuZWxlbWVudHNbaV0uZW1zU291cmNlLklkOwoJCQkJCQlpZiAoby5FbnRpdHlWYWx1ZXNbal0uRW50aXR5QXR0cmlidXRlLk5hbWUgPT0gdGhpcy5lbGVtZW50c1tpXS5uYW1lICYmIHRoaXMuZWxlbWVudHNbaV0uZW1zU291cmNlKSB7CgkJCQkJCQlvLkVudGl0eVZhbHVlc1tqXS5JZCA9IHRoaXMuZWxlbWVudHNbaV0uZW1zU291cmNlLklkOwoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQl9CgkJfQoJCXJldHVybiBvOwoJfQoKCWNIZWlnaHQob3B0aW9ucykgewoJCWlmIChvcHRpb25zICYmIG9wdGlvbnMuZWRpdG9yKSByZXR1cm4gd2luZG93LmlubmVySGVpZ2h0OwoJCWlmIChvcHRpb25zICYmIG9wdGlvbnMuaGVpZ2h0ICYmIHR5cGVvZihvcHRpb25zLmhlaWdodCkgPT09ICdzdHJpbmcnKSByZXR1cm4gdGhpcy5oZWlnaHQ7CgkJaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy50eXBlID09ICd3aW5kb3cnICYmICFvcHRpb25zLmhlaWdodCkgcmV0dXJuIHRoaXMuaGVpZ2h0ICogMC45OwoJCXJldHVybiBNYXRoLmZsb29yKCgob3B0aW9ucyA/IG9wdGlvbnMuaGVpZ2h0IDogbnVsbCkgfHwgKHRoaXMuaGVpZ2h0IC8gMykpKTsKCX0KCglzZWFyY2gob3B0aW9ucykgewoJCXJldHVybiB0aGlzLnN0cmluZyhvcHRpb25zKTsKCX0KCglzdHJpbmcob3B0aW9ucykgewoJCW9wdGlvbnMuaGVpZ2h0ID0gMjA7CgkJb3B0aW9ucy5zaW1wbGUgPSB0cnVlOwoJCXJldHVybiB0aGlzLnRleHQob3B0aW9ucyk7Cgl9CgoJZGF0ZXRpbWUob3B0aW9ucykgewoJCXJldHVybiBgPGlucHV0IGlkPSJkdHAke29wdGlvbnMubmFtZX0iIGNsYXNzPSJlYXN5dWktJHt0aGlzLnVpVHlwZXNbb3B0aW9ucy50eXBlXX0iIHJlcXVpcmVkPSIke29wdGlvbnMucmVxdWlyZWQgPyAndHJ1ZScgOiAnZmFsc2UnfSIgdmFsdWU9IiR7dGhpcy52YWx1ZShvcHRpb25zKX0iIHN0eWxlPSJ3aWR0aDoke3RoaXMuY1dpZHRoKG9wdGlvbnMpfXB4Ij5gOwoJfQoKCXF1ZXJ5KG9wdGlvbnMpIHsKCQlyZXR1cm4gIjxkaXYgaWQ9J3ZzIiArIG9wdGlvbnMubmFtZSArICInPjwvZGl2PiI7Cgl9CgoJRGF0ZVRpbWUob3B0aW9ucykgewoJCXJldHVybiB0aGlzLmRhdGV0aW1lKG9wdGlvbnMpOwoJfQoKCWxvbmcob3B0aW9ucykgewoJCXJldHVybiB0aGlzLmludChvcHRpb25zKTsKCX0KCglMb25nKG9wdGlvbnMpIHsKCQlyZXR1cm4gdGhpcy5sb25nKG9wdGlvbnMpOwoJfQoKCXZhbHVlKG9wdGlvbnMpIHsKCQlpZiAodHlwZW9mIG9wdGlvbnMudmFsdWUgPT09ICdmdW5jdGlvbicpIHsKCQkJdHJ5IHsKCQkJCXJldHVybiBvcHRpb25zLnZhbHVlKHRoaXMuZ2V0KCkpOwoJCQl9IGNhdGNoIChleCkgewoJCQkJY29uc29sZS5sb2coYERGb3JtLnZhbHVlKCR7b3B0aW9ucy5uYW1lfSk6ICR7ZXh9YCk7CgkJCQlyZXR1cm4gJyc7CgkJCX0KCQl9IGVsc2UgewoJCQlzd2l0Y2ggKG9wdGlvbnMudHlwZSkgewoJCQkJY2FzZSAnaW50JzoKCQkJCWNhc2UgJ3Byb2dyZXNzJzoKCQkJCQlyZXR1cm4gb3B0aW9ucy52YWx1ZSB8fCBvcHRpb25zLm1pbiB8fCAwOwoJCQkJY2FzZSAnc3RyaW5nJzoKCQkJCWNhc2UgJ3RleHQnOgoJCQkJY2FzZSAnZGF0ZXRpbWUnOgoJCQkJY2FzZSAnbGFiZWwnOgoJCQkJCXJldHVybiBvcHRpb25zLnZhbHVlIHx8ICIiOwoJCQkJZGVmYXVsdDoKCQkJCQlyZXR1cm4gb3B0aW9ucy52YWx1ZTsKCQkJfQoJCX0KCX0KCglpbnQob3B0aW9ucykgewoJCWxldCByZXQgPSBgPGlucHV0IGlkPSJudWQke29wdGlvbnMubmFtZX0iIGNsYXNzPSJlYXN5dWktJHt0aGlzLnVpVHlwZXNbb3B0aW9ucy50eXBlXX0iIHJlcXVpcmVkPSIke29wdGlvbnMucmVxdWlyZWQgPyAndHJ1ZScgOiAnZmFsc2UnfSIgdmFsdWU9IiR7dGhpcy52YWx1ZShvcHRpb25zKX0iIGRhdGEtb3B0aW9ucz0ibWluOiR7b3B0aW9ucy5taW4gfHwgMH0sbWF4OiR7b3B0aW9ucy5tYXggfHwgMTAwfSxpbmNyZW1lbnQ6JHtvcHRpb25zLmluY3JlbWVudCB8fCAxfSIgc3R5bGU9IndpZHRoOiR7dGhpcy5jV2lkdGgob3B0aW9ucyl9cHg7Ij48L2lucHV0PmA7CgkJLy9jb25zb2xlLmxvZyhyZXQpOwoJCXJldHVybiByZXQ7Cgl9CgoJbWVudShvcHRpb25zKSB7CgkJdmFyIHJldCA9ICIiOwoJCXJldCArPSAnPGRpdiBjbGFzcz0iZWFzeXVpLXBhbmVsIiBpZD0ibW51JyArIG9wdGlvbnMubmFtZSArICciIHN0eWxlPSJwYWRkaW5nOjVweDsiPlxuJzsKCQkkLmVhY2gob3B0aW9ucy5tZW51LCAoXywgbSkgPT4gcmV0ICs9IGA8YSBocmVmPSIjIiBjbGFzcz0iZWFzeXVpLSR7dGhpcy51aVR5cGVzW29wdGlvbnMudHlwZSB8fCAnbWVudSddfSIgZGF0YS1vcHRpb25zPSJtZW51OicjbW0ke20ubGFiZWwucmVwbGFjZSgvIC9nLCAnJyl9JyxpY29uQ2xzOidpY29uLSR7bS5pY29uIHx8ICdub25lJ30nIj4ke20ubGFiZWx9PC9hPlxuYCk7CgkJcmV0ICs9ICI8L2Rpdj5cbiI7CgkJbGV0IGR2ID0gbSA9PiB7CgkJCWxldCByZXQgPSAnPGRpdicgKyAobS5zdWJNZW51cyA/ICcnIDogYCBkYXRhLW9wdGlvbnM9Imljb25DbHM6J2ljb24tJHttLmljb24gfHwgJ25vbmUnfSciYCkgKyAnPlxuJzsKCQkJcmV0ICs9IG0uc3ViTWVudXMgPyAnPHNwYW4+JyArIChtLmxhYmVsIHx8IHRoaXMuZW5nbGlzaChtLmNvZGUpKSArICc8L3NwYW4+XG48ZGl2PicgOiAoYDxzcGFuIHdpZHRoPScxMDAlJyBvbmNsaWNrPScoYXN5bmMgKCkgPT4ge2xldCBtID0gJHtfRnJFTUQuX3RvSlMobSl9OyBpZihtLmFjdGlvbil7cmV0dXJuIGF3YWl0IG0uYWN0aW9uKERGb3JtLmdldCgpLCBtKTt9IGlmIChtLnN1Yk1lbnVzKSByZXR1cm47IGF3YWl0IF9GckVNRC5SZW5kZXJQYWdlKHtfY29kZTogbS5jb2RlIHx8IG0ubGFiZWwucmVwbGFjZSgvIC9nLCAiIikudG9Mb3dlckNhc2UoKX0sIG0uZGF0YSk7fSkoKSc+JHttLmxhYmVsIHx8IHRoaXMuZW5nbGlzaChtLmNvZGUpfTwvc3Bhbj5gKTsKCQkJJC5lYWNoKG0uc3ViTWVudXMsIChfLCBzKSA9PiByZXQgKz0gZHYocykpOwoJCQlyZXQgKz0gKG0uc3ViTWVudXMgPyAiPC9kaXY+XG4iIDogIiIpICsgYDwvZGl2PlxuYDsKCQkJcmV0dXJuIHJldDsKCQl9OwoJCWZvciAodmFyIGkgPSAwOyBpIDwgb3B0aW9ucy5tZW51Lmxlbmd0aDsgaSsrKSB7CgkJCXZhciBtID0gb3B0aW9ucy5tZW51W2ldOwoJCQlyZXQgKz0gJzxkaXYgaWQ9Im1tJyArIG0ubGFiZWwucmVwbGFjZSgvIC9nLCAnJykgKyAnIiBzdHlsZT0id2lkdGg6MTUwcHg7Ij4nOwoJCQlmb3IgKHZhciBqID0gMDsgaiA8IG0uc3ViTWVudXMubGVuZ3RoOyBqKyspIHsKCQkJCXZhciBzbSA9IG0uc3ViTWVudXNbal07CgkJCQlyZXQgKz0gZHYoc20pOwoJCQl9CgkJCXJldCArPSAnPC9kaXY+XG4nOwoJCX0KCQlyZXR1cm4gcmV0OwoJfQoKCWludGVnZXIob3B0aW9ucykgewoJCXJldHVybiB0aGlzLmludChvcHRpb25zKTsKCX0KCgludW1iZXIob3B0aW9ucykgewoJCXJldHVybiB0aGlzLmludChvcHRpb25zKTsKCX0KCglJbnRlZ2VyKG9wdGlvbnMpIHsKCQlyZXR1cm4gdGhpcy5pbnQob3B0aW9ucyk7Cgl9CgoJYm9vbChvcHRpb25zKSB7CgkJcmV0dXJuIGA8aW5wdXQgaWQ9IiR7dGhpcy5wcmVmaXgob3B0aW9ucyl9JHtvcHRpb25zLm5hbWV9IiBkYXRhLWRmb3JtPSJlbGVtZW50OiR7b3B0aW9ucy5uYW1lfSIgcmVxdWlyZWQ9IiR7b3B0aW9ucy5yZXF1aXJlZD8ndHJ1ZSc6J2ZhbHNlJ30iIGRhdGEtb3B0aW9ucz0nZGlzYWJsZWQ6JHtvcHRpb25zLmRpc2FibGVkPyd0cnVlJzonZmFsc2UnfSwke3RoaXMuZXZlbnRIYW5kbGVycyhvcHRpb25zKX0nIGNsYXNzPSJlYXN5dWktJHt0aGlzLnVpVHlwZXNbb3B0aW9ucy50eXBlXX0iICR7b3B0aW9ucy5jaGVja2VkPydjaGVja2VkJzonJ30gLz5gOwoJfQoKCWxhYmVsKG9wdGlvbnMpIHsKCQlyZXR1cm4gYDxzcGFuIGlkPSIke3RoaXMucHJlZml4KG9wdGlvbnMpfSR7b3B0aW9ucy5uYW1lfSIgc3R5bGU9IndpZHRoOiR7dGhpcy5jV2lkdGgob3B0aW9ucyl9cHgiIGRhdGEtb3B0aW9ucz0iZGlzYWJsZWQ6JHtvcHRpb25zLmRpc2FibGVkPyd0cnVlJzonZmFsc2UnfSI+JHt0aGlzLnZhbHVlKG9wdGlvbnMpfTwvc3Bhbj5gOwoJfQoKCXVybChvcHRpb25zKSB7CgkJcmV0dXJuIHRoaXMuc3RyaW5nKG9wdGlvbnMpLnJlcGxhY2UoIkZpZWxkQ2hhbmdlIiwgIlVSTENoYW5nZSIpOwoJfQoKCXRleHQob3B0aW9ucykgewoJCXJldHVybiBgPGlucHV0IGlkPSIke3RoaXMucHJlZml4KG9wdGlvbnMpfSR7b3B0aW9ucy5uYW1lfSIgY2xhc3M9ImVhc3l1aS0ke29wdGlvbnMuZWRpdG9yIHx8IHRoaXMudWlUeXBlc1tvcHRpb25zLnR5cGVdfSIgZGF0YS1vcHRpb25zPSdkaXNhYmxlZDoke29wdGlvbnMuZGlzYWJsZWQ/J3RydWUnOidmYWxzZSd9LCR7dGhpcy5ldmVudEhhbmRsZXJzKG9wdGlvbnMpfScgbXVsdGlsaW5lPSIke29wdGlvbnMuc2ltcGxlID8gJ2ZhbHNlJyA6ICd0cnVlJ30iIHN0eWxlPSJ3aGl0ZS1zcGFjZTpwcmUtd3JhcDt3aWR0aDoke3RoaXMuY1dpZHRoKG9wdGlvbnMpfXB4O2hlaWdodDoke3RoaXMuY0hlaWdodChvcHRpb25zKX1weCIgcmVxdWlyZWQ9IiR7b3B0aW9ucy5yZXF1aXJlZCA/ICd0cnVlJyA6ICdmYWxzZSd9IiB2YWx1ZT0iJHt0aGlzLnZhbHVlKG9wdGlvbnMpfSIgLz5gOwoJfQoKCXBhc3N3b3JkKG9wdGlvbnMpIHsKCQl2YXIgcmV0ID0gdGhpcy5zdHJpbmcob3B0aW9ucyk7CgkJcmV0ID0gcmV0LnJlcGxhY2UoJzxpbnB1dCAnLCAnPGlucHV0IHR5cGU9InBhc3N3b3JkIiAnKTsKCQlyZXR1cm4gcmV0OwoJfQoKCWZpbGUob3B0aW9ucykgewoJCXJldHVybiBgPGlucHV0IGlkPSIke3RoaXMucHJlZml4KG9wdGlvbnMpfSR7b3B0aW9ucy5uYW1lfSIgY2xhc3M9ImVhc3l1aS0ke3RoaXMudWlUeXBlc1tvcHRpb25zLnR5cGVdfSIgZGF0YS1vcHRpb25zPSJvbkNoYW5nZTpmdW5jdGlvbihuLG8pe3ZhciBzID0gJCgnIycgKyB0aGlzLmlkKS5maWxlYm94KCdvcHRpb25zJyk7IHRoaXMuVXBsb2FkRmlsZShzLCB0aGlzLmJ5TmFtZSgnJHtvcHRpb25zLm5hbWV9JykpO30iIHN0eWxlPSJ3aWR0aDoke3RoaXMuY1dpZHRoKG9wdGlvbnMpfXB4Ij5gOwoJfQoKCWltYWdlKG9wdGlvbnMpIHsKCQlyZXR1cm4gdGhpcy5maWxlKG9wdGlvbnMpICsgYDxkaXYgaWQ9ImRsZyR7b3B0aW9ucy5uYW1lfSIgY2xhc3M9ImVhc3l1aS0ke3RoaXMudWlUeXBlc1tvcHRpb25zLnR5cGVdfSIgdGl0bGU9IkltYWdlIFByZXZpZXciIGRhdGEtb3B0aW9ucz0iY2xvc2VkOnRydWUsaWNvbkNsczonaWNvbi1zYXZlJyxyZXNpemFibGU6ZmFsc2UsbW9kYWw6dHJ1ZSIgc3R5bGU9IndpZHRoOjQwMHB4O2hlaWdodDoyMDBweDtwYWRkaW5nOjEwcHgiPjxpbWcgaWQ9IiR7dGhpcy5wcmVmaXgob3B0aW9ucyl9JHtvcHRpb25zLm5hbWV9IiB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIi8+PC9kaXY+YDsKCX0KCglwcm9ncmVzcyhvcHRpb25zKSB7CgkJaWYgKCFvcHRpb25zLmhlaWdodCkgb3B0aW9ucy5oZWlnaHQgPSAyMDsgLy8gZml4IGJpZyBwcm9ncmVzcwoJCXJldHVybiBgPGRpdiBpZD0iJHt0aGlzLnByZWZpeChvcHRpb25zKX0ke29wdGlvbnMubmFtZX0iIGNsYXNzPSJlYXN5dWktJHt0aGlzLnVpVHlwZXNbb3B0aW9ucy50eXBlXX0iIGRhdGEtb3B0aW9ucz0idmFsdWU6JHt0aGlzLnZhbHVlKG9wdGlvbnMpfSIgc3R5bGU9IndpZHRoOiR7dGhpcy5jV2lkdGgob3B0aW9ucyl9cHg7aGVpZ2h0OiR7dGhpcy5jSGVpZ2h0KG9wdGlvbnMpfXB4Ij48L2Rpdj5gOwoJfQoKCWZsb3djaGFydChvcHRpb25zKSB7CgkJcmV0dXJuIGA8ZGl2IGlkPSJmbHcke29wdGlvbnMubmFtZX0iIHdpZHRoPSIke3RoaXMuY1dpZHRoKG9wdGlvbnMpfSIgaGVpZ2h0PSIke3RoaXMuY0hlaWdodChvcHRpb25zKX0iPjwvZGl2PmA7Cgl9CgoJY2hhcnQob3B0aW9ucykgewoJCXJldHVybiBgPGRpdiBpZD0iY2h0JHtvcHRpb25zLm5hbWV9IiB3aWR0aD0iJHt0aGlzLmNXaWR0aChvcHRpb25zKX0iIGhlaWdodD0iJHt0aGlzLmNIZWlnaHQob3B0aW9ucyl9Ij48L2Rpdj5gOwoJfQoKCWZvcm1hdHRlcihuYW1lLCBjLCBqc29uKSB7CgkJanNvbiA9IGpzb24gPyAnIicgOiAnJzsKCQlyZXR1cm4gYCR7anNvbn0odmFsdWUsIHJvdywgaW5kZXgpID0+IHt0cnl7dmFyIGMgPSAoREZvcm0uYnlOYW1lKFxgJHtuYW1lfVxgKS5jb2x1bW5zIHx8IFtdKS5maW5kKGMgPT4gYy5maWVsZD09XGAke2MuZmllbGR9XGApOyByZXR1cm4gYyYmYy5mb3JtYXQ/Yy5mb3JtYXQodmFsdWUscm93LGluZGV4KTp2YWx1ZTt9Y2F0Y2goZXgpe3JldHVybiB2YWx1ZTt9IH0ke2pzb259YDsKCX0KCgltYXBDb2x1bW5zKG9wdGlvbnMsIGpzb24pIHsKCQlsZXQgY1RpdGxlID0gYyA9PiBjLnRpdGxlIHx8IHRoaXMuZW5nbGlzaChjLmZpZWxkKTsKCgkJdmFyIGNvbHMgPSAkLmdyZXAob3B0aW9ucy5jb2x1bW5zIHx8IFtdLCBjID0+ICFjLmlnbm9yZSk7CgkJbGV0IHJldCA9ICIiOwoJCWlmIChvcHRpb25zLm11bHRpcGxlKSByZXQgKz0gYHsiZmllbGQiOidjaycsImNoZWNrYm94Ijp0cnVlfSxgOwoJCXJldCA9IGAiZnJvemVuQ29sdW1ucyI6IFtbYDsKCQlpZiAoIW9wdGlvbnMuZnJvemVuKSB7CgkJCXJldCArPSBgeyJmaWVsZCI6IiR7b3B0aW9ucy5pZEZpZWxkLmZpZWxkfSIsInRpdGxlIjogIiR7b3B0aW9ucy5pZEZpZWxkLnRpdGxlfSIsInNvcnRhYmxlIjogInRydWUiLCAiZm9ybWF0dGVyIjogJHt0aGlzLmZvcm1hdHRlcihvcHRpb25zLm5hbWUsIG9wdGlvbnMuaWRGaWVsZCwganNvbil9fSxgOwoJCQlpZiAob3B0aW9ucy50ZXh0RmllbGQuZmllbGQgIT0gb3B0aW9ucy5pZEZpZWxkLmZpZWxkKSByZXQgKz0gYHsiZmllbGQiOiIke29wdGlvbnMudGV4dEZpZWxkLmZpZWxkIHx8IG9wdGlvbnMudGV4dEZpZWxkLnRpdGxlfSIsInRpdGxlIjoiJHtvcHRpb25zLnRleHRGaWVsZC50aXRsZSB8fCBvcHRpb25zLnRleHRGaWVsZC5maWVsZH0iLCJ3aWR0aCI6IiR7b3B0aW9ucy50ZXh0RmllbGQud2lkdGh8fDEyMH0iLCAic29ydGFibGUiOiAidHJ1ZSIsICJmb3JtYXR0ZXIiOiAke3RoaXMuZm9ybWF0dGVyKG9wdGlvbnMubmFtZSwgb3B0aW9ucy50ZXh0RmllbGQsIGpzb24pfX1gOwoJCX0gZWxzZSB7CgkJCSQubWFwKCQuZ3JlcChjb2xzLCBjID0+IGMuZnJvemVuKSwgYyA9PiBgeyJmaWVsZCI6IiR7Yy5maWVsZCB8fCBjVGl0bGUoYyl9IiwidGl0bGUiOiIke2NUaXRsZShjKSB8fCBjLmZpZWxkfSIsIndpZHRoIjoiJHtjLndpZHRofHwxMjB9IiwiYWxpZ24iOidsZWZ0Jywic29ydGFibGUiOiJ0cnVlIiwgImZvcm1hdHRlciI6ICR7dGhpcy5mb3JtYXR0ZXIob3B0aW9ucy5uYW1lLCBjLCBqc29uKX19YCkuam9pbigiLCIpOwoJCX0KCQlyZXQgKz0gYF1dLCAiY29sdW1ucyI6IFtbYDsKCQlyZXQgKz0gJC5tYXAoJC5ncmVwKGNvbHMsIGMgPT4gIWMuZnJvemVuKSwgYyA9PiBgeyJmaWVsZCI6IiR7Yy5maWVsZCB8fCBjVGl0bGUoYyl9IiwidGl0bGUiOiIke2NUaXRsZShjKSB8fCBjLmZpZWxkfSIsImFsaWduIjoibGVmdCIsInNvcnRhYmxlIjoidHJ1ZSIsICJmb3JtYXR0ZXIiOiAke3RoaXMuZm9ybWF0dGVyKG9wdGlvbnMubmFtZSwgYywganNvbil9fWApLmpvaW4oIiwiKTsKCQlyZXQgKz0gJ11dJzsKCQlyZXR1cm4gcmV0OwoJfQoKCXNlbGVjdChvcHRpb25zLCB0YWcgPSBvcHRpb25zLnRhZywgdHlwZSkgewoJCXJldHVybiB0aGlzLmNvbWJvKG9wdGlvbnMsIHRhZywgdHlwZSk7Cgl9CgoJdHJlZShvcHRpb25zKSB7CgkJcmV0dXJuIHRoaXMuc2VsZWN0KG9wdGlvbnMsICJzZWxlY3QiKTsKCX0KCgluYXZpZ2F0aW9uKG9wdGlvbnMpIHsKCQlyZXR1cm4gdGhpcy5jb21ibyhvcHRpb25zLCAndWwnLCAndHJlZScpOwoJfQoKCWNvbWJvKG9wdGlvbnMsIHRhZywgdHlwZSkgewoJCXZhciBjb2xzID0gJC5ncmVwKG9wdGlvbnMuY29sdW1ucyB8fCBbXSwgYyA9PiAhYy5pZ25vcmUpOwoJCXRhZyA9IHRhZyB8fCAic2VsZWN0IjsKCQlvcHRpb25zLmlkRmllbGQgPSAkLnVuaXF1ZVNvcnQoW3sKCQkJZmllbGQ6IG9wdGlvbnMuaWRGaWVsZCwKCQkJdGl0bGU6IG9wdGlvbnMuaWRGaWVsZAoJCX1dLmNvbmNhdCgkLmdyZXAoY29scywgYyA9PiBjLnByaW1hcnkpLCBbewoJCQlmaWVsZDogJ0lkJywKCQkJdGl0bGU6ICdJRCcKCQl9XSkpLmZpbmQoeCA9PiB0eXBlb2YoeC5maWVsZCkgIT09ICJ1bmRlZmluZWQiKTsKCQlvcHRpb25zLnRleHRGaWVsZCA9ICQudW5pcXVlU29ydChbewoJCQlmaWVsZDogb3B0aW9ucy50ZXh0RmllbGQsCgkJCXRpdGxlOiBvcHRpb25zLnRleHRGaWVsZAoJCX1dLmNvbmNhdCgkLmdyZXAoY29scywgYyA9PiBjLmRpc3BsYXkpLCBbewoJCQlmaWVsZDogJ19Ub1N0cmluZycsCgkJCXRpdGxlOiBvcHRpb25zLm5hbWUsCgkJfV0pKS5maW5kKHggPT4gdHlwZW9mKHguZmllbGQpICE9PSAidW5kZWZpbmVkIik7CgkJdmFyIGZ1biA9IHR5cGUgfHwgdGhpcy5lRnVuKG9wdGlvbnMpOwoJCXZhciBkcm9wZG93biA9IFsnY29tYm90cmVlZ3JpZCcsICdjb21ib3RyZWUnLCAnY29tYm9ncmlkJywgJ3NlbGVjdCddLmluZGV4T2YoZnVuKSA+IC0xOwoJCWlmIChkcm9wZG93bikgdGhpcy5zZWxlY3RzLnB1c2goewoJCQlpZDogImNtYiIgKyBvcHRpb25zLm5hbWUsCgkJCW9wdGlvbnM6IHRoaXMuYnlOYW1lKG9wdGlvbnMubmFtZSkKCQl9KTsKCQl0aGlzLnNlbGVjdHMgPSAkLnVuaXF1ZVNvcnQodGhpcy5zZWxlY3RzKTsKCQl2YXIgcmV0ID0gYDwke3RhZ30gaWQ9ImNtYiR7b3B0aW9ucy5uYW1lfSIgY2xhc3M9ImVhc3l1aS0ke2Z1bn0iIHN0eWxlPSJtYXgtd2lkdGg6JHtkcm9wZG93bj8nNDAwcHgnOnRoaXMuY1dpZHRoKG9wdGlvbnMpfTsgd2lkdGg6JHt0aGlzLmNXaWR0aChvcHRpb25zKX1weCIgcmVxdWlyZWQ9IiR7KG9wdGlvbnMucmVxdWlyZWQgPyAndHJ1ZScgOiAnZmFsc2UnKX0iIGRhdGEtb3B0aW9ucz0nZGlzYWJsZWQ6JHtvcHRpb25zLmRpc2FibGVkPyd0cnVlJzonZmFsc2UnfSwke3RoaXMuZXZlbnRIYW5kbGVycyhvcHRpb25zKX0sIHZhbHVlOiIke3RoaXMudmFsdWUob3B0aW9ucyl9Iiwgcm93bnVtYmVyczoke3R5cGVvZihvcHRpb25zLnJvd051bWJlcnMpIT09J3VuZGVmaW5lZCc/b3B0aW9ucy5yb3dOdW1iZXJzOihmdW4uaW5kZXhPZigndHJlZScpPC0xPydmYWxzZSc6J3RydWUnKX0sIHBhZ2luYXRpb246JHt0eXBlb2Yob3B0aW9ucy5wYWdpbmF0aW9uKSE9PSd1bmRlZmluZWQnP29wdGlvbnMucGFnaW5hdGlvbjooZnVuLmluZGV4T2YoJ3RyZWUnKTwtMT8nZmFsc2UnOid0cnVlJyl9LCBwYW5lbFdpZHRoOiR7Mip0aGlzLmNXaWR0aChvcHRpb25zKX0sIGZpdENvbHVtbnM6IHRydWUsIHNpbmdsZVNlbGVjdDogdHJ1ZSwgbXVsdGlwbGU6JHsob3B0aW9ucy5tdWx0aXBsZSB8fCAnZmFsc2UnKX0sIGlkRmllbGQ6ICIke29wdGlvbnMuaWRGaWVsZC5maWVsZH0iLCBlbmFibGVGaWx0ZXI6ICR7b3B0aW9ucy5maWx0ZXI/J3RydWUnOidmYWxzZSd9LCBub3dyYXA6IGZhbHNlLCB0ZXh0RmllbGQ6ICIke29wdGlvbnMudGV4dEZpZWxkLmZpZWxkfSIsIHRyZWVGaWVsZDogIiR7b3B0aW9ucy50ZXh0RmllbGQuZmllbGR9IixgOwoJCWlmIChmdW4uaW5kZXhPZigndHJlZScpID09IC0xKSB7CgkJCXJldCArPSAnZml0Q29sdW1uczogZmFsc2UsJyArIHRoaXMubWFwQ29sdW1ucyhvcHRpb25zKTsKCQl9CgkJaWYgKG9wdGlvbnMuZGF0YSkgewoJCQlyZXQgKz0gYCxkYXRhOiAke0pTT04uc3RyaW5naWZ5KG9wdGlvbnMuZGF0YSl9YDsKCQl9CgkJcmV0ICs9IGAnPmA7CgkJaWYgKG9wdGlvbnMub3B0aW9ucykgewoJCQlyZXQgKz0gJC5tYXAob3B0aW9ucy5vcHRpb25zLCBvID0+IGA8b3B0aW9uIHZhbHVlPScke19GckVNRC5fdG9KUyhvKX0nPiR7by5uYW1lIHx8IG99PC9vcHRpb24+YCkuam9pbignXG4nKTsKCQl9CgkJcmV0ICs9IGA8LyR7dGFnfT5gOwoJCS8vIGNvbnNvbGUubG9nKHJldCk7CgkJcmV0dXJuIHJldDsKCX0KCglncmlkKG9wdGlvbnMsIHRhZywgdHlwZSkgewoJCXJldHVybiB0aGlzLmNvbWJvKG9wdGlvbnMsICJ0YWJsZSIsICJkYXRhZ3JpZCIpOwoJfQoKCXRyZWVncmlkKG9wdGlvbnMpIHsKCQlyZXR1cm4gdGhpcy5jb21ibyhvcHRpb25zLCAndGFibGUnLCAndHJlZScpOwoJfQoKCWFzeW5jIGRvTGluayhlLCBldmVudCkgewoJCXRoaXMuYnVzeSh0cnVlKTsKCQl0cnkgewoJCQlhd2FpdCBlLmxpbmtzLmZpbmQobCA9PiBsLmxhYmVsID09IGV2ZW50LnRhcmdldC5pbm5lclRleHQpLm9uQ2xpY2sodGhpcy5nZXQoKSk7CgkJfSBjYXRjaCAoZXgpIHsKCQkJY29uc29sZS5sb2coImRvTGluayIsIGV4KTsKCQl9CgkJdGhpcy5idXN5KGZhbHNlKTsKCX0KCglFZGl0ZWRWYWx1ZShlKSB7CgkJcmV0dXJuICh0eXBlb2YoYWNlKSAhPT0gInVuZGVmaW5lZCIpID8gYWNlLmVkaXQoJ3BubCcgKyBlLm5hbWUpLnNlc3Npb24uZ2V0VmFsdWUoKSA6ICcnOwoJfQoKCWFzeW5jIFBhbk9uQ2xvc2UoZSkgewoJCWlmIChlLmVkaXRvcikgewoJCQllLnZhbHVlID0gdGhpcy5FZGl0ZWRWYWx1ZShlKTsKCQl9CgkJaWYgKGUuY2xvc2UpIHsKCQkJYXdhaXQgZS5jbG9zZSh0aGlzLmdldCgpKTsKCQl9Cgl9CgoJYXN5bmMgUGVuZEFmdGVyT3BlbihlKSB7CgkJaWYgKGUuZWRpdG9yICYmIHR5cGVvZihhY2UpICE9PSAidW5kZWZpbmVkIikgewoJCQlhd2FpdCBfRnJFTUQuT3BlbkVkaXRvcigncG5sJyArIGUubmFtZSAvKisgJy1jZW50ZXInKi8gLCBlLmxhbmd1YWdlLCBlLmxvYWRlciB8fCAobyA9PiBlLnZhbHVlKSwgZS5zYXZlciwgdGhpcy5nZXQoKSwgZSk7CgkJfQoJCWlmIChlLm9wZW4pIHsKCQkJYXdhaXQgZS5vcGVuKHRoaXMuZ2V0KCkpOwoJCX0KCX0KCglsaW5rKG9wdGlvbnMpIHsKCQlyZXR1cm4gKG9wdGlvbnMubGlua3MgfHwgW10pLmZpbHRlcihsID0+ICFsLmlnbm9yZSkubWFwKGwgPT4gYDxhIGhyZWY9IiMiIGNsYXNzPSJlYXN5dWktJHt0aGlzLnVpVHlwZXNbb3B0aW9ucy50eXBlXX0iIGRhdGEtb3B0aW9ucz0nJHt0aGlzLmV2ZW50SGFuZGxlcnMob3B0aW9ucyl9LCBpY29uQ2xzOiJpY29uLSR7bC5pY29uIHx8ICdvayd9Iic+JHtsLmxhYmVsfTwvYT5gKS5qb2luKCdcbicpOwoJfQoKCWFzeW5jIFNldFRyZWVEYXRhKGUsIG4sIGRhdGEpIHsKCQkkLmVhY2goJCgiI2NtYiIgKyBlLm5hbWUpW3RoaXMuZUZ1bihlKV0oJ3RyZWUnKS50cmVlKCJnZXRDaGlsZHJlbiIsIG4udGFyZ2V0KSwgKF8sIGMpID0+ICQoIiNjbWIiICsgZS5uYW1lKVt0aGlzLmVGdW4oZSldKCd0cmVlJykudHJlZSgicmVtb3ZlIiwgYy50YXJnZXQpKTsKCQkkKCIjY21iIiArIGUubmFtZSlbdGhpcy5lRnVuKGUpXSgndHJlZScpLnRyZWUoImFwcGVuZCIsIHsKCQkJcGFyZW50OiBuLnRhcmdldCwKCQkJZGF0YTogZGF0YQoJCX0pOwoJCXJldHVybiB0cnVlOwoJfQoKCWFzeW5jIEV4cGFuZChlLCBuKSB7CgkJdGhpcy5TZXRUcmVlRGF0YShlLCBuLCBbewoJCQlpZDogbnVsbCwKCQkJdGV4dDogImxvYWRpbmcuLi4iCgkJfV0pOwoJCXZhciBvYmogPSB7fTsKCQl2YXIgcEZpZWxkID0gZS5wYXJlbnRGaWVsZCB8fCAkLm1hcCgkLmdyZXAoZS5jb2x1bW5zIHx8IFtdLCBjID0+IGMucGFyZW50KSwgYyA9PiBjLmZpZWxkKS5jb25jYXQoW251bGxdKVswXTsKCQl2YXIgaWRGaWVsZCA9ICQuZ3JlcChlLmNvbHVtbnMgfHwgW10sIGMgPT4gYy5wcmltYXJ5KS5jb25jYXQoZS5pZEZpZWxkKVswXS5maWVsZDsKCQlpZiAocEZpZWxkKSB7CgkJCW9ialtwRmllbGRdID0gewoJCQkJX3NvdXJjZTogbi5fc291cmNlCgkJCX07CgkJCWlmIChpZEZpZWxkKSB7CgkJCQlvYmpbcEZpZWxkXVtpZEZpZWxkXSA9IG4uaWQ7CgkJCX0gZWxzZSB7CgkJCQlvYmpbcEZpZWxkXSA9IG4uaWQ7CgkJCX0KCQl9CgkJbGV0IGRhdGEgPSBhd2FpdCB0aGlzLl9sb2FkRGF0YSh7CgkJCWlkOiAiY21iIiArIGUubmFtZSwKCQkJb3B0aW9uczogZQoJCX0sIG9iaik7CgkJdGhpcy5TZXRUcmVlRGF0YShlLCBuLCBkYXRhKTsKCX0KCglhc3luYyBfbG9hZERhdGEocywgbywgc3RhcnQsIGVuZCkgewoJCXZhciBuYW1lID0gKHMgJiYgcy5vcHRpb25zID8gKHMub3B0aW9ucy5DbGFzcyA/IHMub3B0aW9ucy5DbGFzcy5OYW1lLnJlcGxhY2UoJyAnLCAnXycpIDogKHMub3B0aW9ucy50YWJsZSB8fCBzLm9wdGlvbnMubmFtZSkpIDogcy5uYW1lKTsKCQluYW1lID0gbmFtZS50cmltKCk7IC8vLnNwbGl0KCcuJykuc2xpY2UoLTEpWzBdOwoKCQlsZXQgb1Njb3BlID0gKHR5cGVvZihjb21wYW55KSAhPT0gJ3VuZGVmaW5lZCcgJiYgY29tcGFueS5TY29wZSkgPyB3aW5kb3dbY29tcGFueS5TY29wZV0gOiB3aW5kb3c7CgkJbyA9IG8gfHwgKChvU2NvcGUgJiYgb1Njb3BlW25hbWVdKSA/IG5ldyBvU2NvcGVbbmFtZV0oKSA6IHsKCQkJQWN0aXZlOiB0cnVlLAoJCX0pOwoKCQlvID0gKHR5cGVvZiBmaWx0ZXJzICE9PSAidW5kZWZpbmVkIiAmJiBmaWx0ZXJzICYmIGZpbHRlcnNbbmFtZV0pID8gZmlsdGVyc1tuYW1lXShvKSA6IG87CgkJbyA9IChzICYmIHMub3B0aW9ucyAmJiBzLm9wdGlvbnMuc291cmNlID8gcy5vcHRpb25zLnNvdXJjZShvLCB0aGlzLmdldCgpKSA6IG8pOwoJCWxldCBuYW1lcyA9ICQudW5pcXVlU29ydChbcy5vcHRpb25zLnNlYXJjaEZpZWxkXS5jb25jYXQoJC5tYXAoJC5ncmVwKHMub3B0aW9ucy5jb2x1bW5zIHx8IFtdLCBjID0+IGMuc2VhcmNoKSwgYyA9PiBjLmZpZWxkKSwgWyJOYW1lIl0pKTsKCQl2YXIgZnVuID0gdGhpcy5lRnVuKHMub3B0aW9ucyk7CgkJaWYgKCFvW25hbWVzWzBdXSkgb1tuYW1lc1swXV0gPSAkKCIjIiArIHMuaWQpW2Z1bl0oJ2dldFRleHQnKTsKCQl2YXIgZGF0YSA9IG51bGw7CgoJCWxldCBsaWIgPSAnJzsKCQlpZiAobmFtZS5pbmRleE9mKCcuJykgPiAwKSB7CgkJCWxpYiA9IG5hbWUuc3BsaXQoJy4nKVswXSArICcuJzsKCQkJbmFtZSA9IG5hbWUuc3BsaXQoJy4nKVsxXTsKCQl9CgoJCWlmIChzLm9wdGlvbnMubG9hZGVyKSB7CgkJCWRhdGEgPSBhd2FpdCBzLm9wdGlvbnMubG9hZGVyKHRoaXMuZ2V0KCksIHMub3B0aW9ucywgbyk7CgkJfSBlbHNlIGlmICh0eXBlb2YoY29tcGFueSkgIT09ICd1bmRlZmluZWQnICYmIGNvbXBhbnkubGlicmFyeSAmJiBjb21wYW55LkNvZGUpIHsKCQkJLy9jb25zb2xlLmxvZygiREZvcm06Ol9sb2FkRGF0YSgpOiBzcigpLl8oIiArIGxpYiArIGNvbXBhbnkuQ29kZS50b0xvd2VyQ2FzZSgpICsgbmFtZSArICJGaW5kYWxsIiArICIpIiwgbyk7CgkJCWRhdGEgPSBhd2FpdCB0aGlzLnNyKCkuXyhsaWIgKyBjb21wYW55LkNvZGUudG9Mb3dlckNhc2UoKSArIG5hbWUgKyAiRmluZGFsbCIsIG51bGwsIG8sIG51bGwsIHN0YXJ0LCBlbmQpOwoJCX0gZWxzZSBpZiAoX0ZyRU1ELmFwaVNlcnZlcikgewoJCQlkYXRhID0gYXdhaXQgX0ZyRU1ELmFwaVNlcnZlci5fbmV3KG5hbWUpLl9mcm9tRG9jdW1lbnQoT2JqZWN0LmFzc2lnbiguLi5PYmplY3Qua2V5cyhvKS5tYXAoayA9PiAoewoJCQkJW1N0cmluZyhrKS5jaGFyQXQoMCkudG9Mb3dlckNhc2UoKSArIFN0cmluZyhrKS5zbGljZSgxKV06IG9ba10KCQkJfSkpKSkuZmluZEFsbCgpOwoJCX0gZWxzZSB7CgkJCS8vIGVtcwoJCQlkYXRhID0gYXdhaXQgby5maW5kQWxsKCk7CgkJCS8vZGF0YSA9IGF3YWl0IHdpbmRvdy5fRnJFTUQuX28obnVsbCwgbyk7CgkJfQoJCWlmIChzLm9wdGlvbnMucG9zdGxvYWQpIHsKCQkJYXdhaXQgcy5vcHRpb25zLnBvc3Rsb2FkKGRhdGEpOwoJCX0KCQkkLmVhY2goZGF0YSwgKGksIGQpID0+IHsKCQkJZC5fX09XTkVSID0gczsKCQkJJC5lYWNoKHMub3B0aW9ucy5jb2x1bW5zLCAoXywgYykgPT4gewoJCQkJaWYgKGMudmFsdWUpIHsKCQkJCQlkW2MuZmllbGRdID0gYy52YWx1ZShkLCBkYXRhLCBpKTsKCQkJCX0KCQkJfSk7CgkJfSk7CgkJaWYgKCFzLm9wdGlvbnMuY29sdW1ucyAmJiBmdW4uaW5kZXhPZigndHJlZScpID4gLTEpIHsKCQkJZGF0YSA9ICQubWFwKGRhdGEsIGQgPT4gewoJCQkJbGV0IHJldCA9IHsKCQkJCQlpZDogZFtzLm9wdGlvbnMuaWRGaWVsZC5maWVsZF0sCgkJCQkJdGV4dDogZFtzLm9wdGlvbnMudGV4dEZpZWxkLmZpZWxkXSwKCQkJCQlzdGF0ZTogZC5zdGF0ZSB8fCAocy5vcHRpb25zLmxvYWRlciA/ICJmaWxlIiA6ICJjbG9zZWQiKSwKCQkJCQlfc291cmNlOiBkLAoJCQkJfTsKCQkJCXJldC5jaGlsZHJlbiA9IChyZXQuc3RhdGUgPT0gImNsb3NlZCIpID8gW3sKCQkJCQl0ZXh0OiAnbG9hZGluZy4uLicKCQkJCX1dIDogbnVsbDsKCQkJCXJldHVybiByZXQ7CgkJCX0pOwoJCX0KCQlyZXR1cm4gZGF0YSB8fCBbXTsKCX0KCglhc3luYyBmaWxsRGF0YShnLCBvLCBzdGFydCwgZW5kKSB7CgkJdmFyIHMgPSBudWxsOwoJCWZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5zZWxlY3RzLmxlbmd0aDsgaSsrKSB7CgkJCWlmICh0aGlzLnNlbGVjdHNbaV0uaWQgPT0gZ1swXS5pZCkgcyA9IHRoaXMuc2VsZWN0c1tpXTsKCQl9CgkJaWYgKCFzKSByZXR1cm47CgkJdGhpcy5idXN5KHRydWUpOwoJCXRyeSB7CgkJCXZhciBmdW4gPSBnWzBdLmNsYXNzTGlzdFsiMCJdLnJlcGxhY2UoJ2Vhc3l1aS0nLCAnJyk7CgkJCXRyeSB7CgkJCQkkKCIjIiArIHMuaWQpW2Z1bl0oJ2dyaWQnKS5kYXRhZ3JpZCgnZ2V0UGFnZXInKS5wYWdpbmF0aW9uKCdsb2FkaW5nJyk7CgkJCX0gY2F0Y2ggKGV4KSB7fQoJCQlpZiAocy5vcHRpb25zLm5vbG9hZCkgewoJCQkJbGV0IF9kYXRhID0gbnVsbDsKCQkJCXRyeSB7CgkJCQkJX2RhdGEgPSAkKCIjIiArIHMuaWQpW2Z1bl0oJ2dyaWQnKS5kYXRhZ3JpZCgiZ2V0RGF0YSIpOwoJCQkJfSBjYXRjaCAoZXgpIHsKCQkJCQlfZGF0YSA9ICQoIiMiICsgcy5pZClbZnVuXSgndHJlZScpLnRyZWUoJ2dldFJvb3QnKTsKCQkJCX0KCQkJCWlmIChfZGF0YSkgewoJCQkJCXJldHVybiB0aGlzLmJ1c3koZmFsc2UpOwoJCQkJfQoJCQl9CgkJCXZhciBkYXRhID0gYXdhaXQgdGhpcy5fbG9hZERhdGEocywgbywgc3RhcnQsIGVuZCk7CgkJCXRyeSB7CgkJCQlpZiAoJCgiIyIgKyBzLmlkKVtmdW5dKCdncmlkJykpICQoIiMiICsgcy5pZClbZnVuXSgnZ3JpZCcpLmRhdGFncmlkKCdnZXRQYWdlcicpLnBhZ2luYXRpb24oJ2xvYWRlZCcpOwoJCQl9IGNhdGNoIChleCkge30KCQkJdHJ5IHsKCQkJCSQoIiMiICsgcy5pZClbZnVuXSgnZ3JpZCcpLmRhdGFncmlkKCdsb2FkRGF0YScsIHsKCQkJCQl0b3RhbDogZGF0YS5Db3VudCB8fCBkYXRhLmxlbmd0aCwKCQkJCQlyb3dzOiBkYXRhLAoJCQkJfSk7CgkJCX0gY2F0Y2ggKGV4KSB7CgkJCQkkKCIjIiArIHMuaWQpW2Z1bl0oJ3RyZWUnKS50cmVlKCdsb2FkRGF0YScsIGRhdGEpOwoJCQl9CgkJfSBjYXRjaCAoZXgpIHsKCQkJY29uc29sZS5sb2coZXgpOwoJCX0KCQl0aGlzLmJ1c3koZmFsc2UpOwoJfQoKCWV2ZW50SGFuZGxlcnMob3B0aW9ucykgewoJCWlmICghdGhpcy5ieU5hbWUob3B0aW9ucy5uYW1lKSkgcmV0dXJuOyAvLyBpZiBub3QgYW4gZWxlbWVudCwgZG8gbm90IHJ1biB0aGUgaGFuZGxlcnMKCgkJcmV0dXJuIHRoaXMuZXZlbnRzLmZpbHRlcihlID0+IGUudHlwZSA9PSBvcHRpb25zLnR5cGUgfHwgdHlwZW9mKGUudHlwZSkgPT09ICd1bmRlZmluZWQnKS5tYXAoZSA9PiBgJHtlLm5hbWV9OiAoJHtlLnBhcmFtcyB8fCAnJ30pID0+IHt0cnl7REZvcm0uJHtlLmhhbmRsZXJ9KERGb3JtLmJ5TmFtZSgiJHtvcHRpb25zLm5hbWV9IikgfHwgJHtfRnJFTUQuX3RvSlMob3B0aW9ucyl9IHx8IHtuYW1lOiAiJHtvcHRpb25zLm5hbWV9Iix0eXBlOiAiJHtvcHRpb25zLnR5cGV9In0sICR7ZS5wYXJhbXN9KX1jYXRjaChleCl7Y29uc29sZS5sb2coIkV2ZW50IEVycm9yOiAke29wdGlvbnMubmFtZX0vJHtvcHRpb25zLnR5cGV9LyR7ZS5uYW1lfSIsIGV4KTt9fWApLmpvaW4oJywnKTsKCX0KCglhc3luYyBQYW5lbE9wZW4oZSkgewoJCWlmIChlLmVkaXRvcikgcmV0dXJuIHRydWU7CgkJbGV0IGNvbnRlbnQgPSBlLnZhbHVlOwoJCWlmIChlLmxvYWRlcikgewoJCQljb250ZW50ID0gYXdhaXQgZS5sb2FkZXIodGhpcy5nZXQoKSk7CgkJfQoJCWlmIChjb250ZW50KSB7CgkJCXRyeSB7CgkJCQkkKCIjcG5sIiArIGUubmFtZSkucGFuZWwoJ2JvZHknKS5odG1sKGNvbnRlbnQpOwoJCQkJY29uc29sZS5sb2coInBubCIgKyBlLm5hbWUgKyAiOiBDb250ZW50IFZhbGlkIik7CgkJCX0gY2F0Y2ggKGV4KSB7CgkJCQkvL2NvbnNvbGUubG9nKGV4KTsKCQkJfQoJCX0KCQlyZXR1cm4gY29udGVudDsKCX0KCglhc3luYyBTZWxlY3RDaGFuZ2Uob3B0aW9ucywgdGFiKSB7CgkJdGhpcy5idXN5KHRydWUpOwoJCSQuZ3JlcCh0aGlzLmVsZW1lbnRzLCBlID0+IGUudHlwZSA9PSAiZ3JpZCIgJiYgZS5ncm91cCA9PSB0YWIpLmZvckVhY2goZSA9PiAkKCIjY21iIiArIGUubmFtZSkuZGF0YWdyaWQoKSk7CgkJdGhpcy5idXN5KGZhbHNlKTsKCX0KCglhc3luYyBGaWVsZENoYW5nZShvcHRpb25zLCB2YWx1ZSkgewoJCXRoaXMuYnVzeSh0cnVlKTsKCQlpZiAob3B0aW9ucyAmJiBvcHRpb25zLmNoYW5nZSkgewoJCQlhd2FpdCBvcHRpb25zLmNoYW5nZSh0aGlzLmdldCgpLCB2YWx1ZSk7CgkJfQoJCXRoaXMuYnVzeShmYWxzZSk7Cgl9CgoJYXN5bmMgVVJMQ2hhbmdlKHMsIG9wdGlvbnMpIHsKCQl0aGlzLmJ1c3kodHJ1ZSk7CgkJb3B0aW9ucy5kYXRhID0gYXdhaXQgJC5nZXQocy52YWx1ZSk7CgkJcmV0dXJuIGF3YWl0IHRoaXMuRmllbGRDaGFuZ2Uocywgb3B0aW9ucyk7Cgl9CgoJVXBsb2FkRmlsZShmLCBvcHRpb25zKSB7CgkJdGhpcy5idXN5KHRydWUpOwoJCXZhciBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSgpOwoJCXZhciBmaWxlaWQgPSBNYXRoLnJhbmRvbSgpOwoJCXZhciBtZXRob2QgPSBvcHRpb25zLm1ldGhvZCB8fCAiQ29udGVudE1hbmFnZXIuY21zVXBsb2FkRmlsZSI7CgkJZm9ybURhdGEuYXBwZW5kKCdmaWxlaWQnLCBmaWxlaWQpOwoJCXZhciBmaWxlID0gJCgiIyIgKyBmLmZpbGVib3hJZClbMF0uZmlsZXNbMF07CgkJZm9ybURhdGEuYXBwZW5kKCdfX1VGSUxFJywgZmlsZSk7CgkJaWYgKG9wdGlvbnMubG9jYWwpIHsKCQkJLy8gaGFuZGxpbmcgdGhlIGZpbGUgbG9jYWxseQoJCQl2YXIgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTsKCQkJcmVhZGVyLm9ubG9hZCA9IChlKSA9PiB7CgkJCQl2YXIgZGF0YSA9IGUudGFyZ2V0LnJlc3VsdDsKCQkJCXJldCA9IGRhdGE7CgkJCQl0aGlzLmJ5TmFtZShvcHRpb25zLm5hbWUpLmRhdGEgPSByZXQ7CgkJCQlpZiAob3B0aW9ucyAmJiBvcHRpb25zLnVwbG9hZCkgb3B0aW9ucy51cGxvYWQodGhpcy5nZXQoKSwgcmV0KTsKCQkJfTsKCQkJaWYgKG9wdGlvbnMuYmluYXJ5KSB7CgkJCQlyZWFkZXIucmVhZEFzQmluYXJ5U3RyaW5nKGZpbGUpOwoJCQl9IGVsc2UgaWYgKG9wdGlvbnMuZGF0YXVybCkgewoJCQkJcmVhZGVyLnJlYWRBc0RhdGFVUkwoZmlsZSk7CgkJCX0gZWxzZSB7CgkJCQlyZWFkZXIucmVhZEFzVGV4dChmaWxlKTsKCQkJfQoJCQl0aGlzLmJ1c3koZmFsc2UpOwoJCX0gZWxzZSBpZiAobWV0aG9kKSB7CgkJCSQuYWpheCh7CgkJCQl1cmw6IHRoaXMuc3IoKS5zclVSTCArICImbWV0aG9kPSIgKyBtZXRob2QgKyAiJnNJbnB1dD0iICsgZmlsZWlkICsgIiZwcmVUYWc9JnBvc3RUYWc9IiwKCQkJCWRhdGE6IGZvcm1EYXRhLAoJCQkJLy8gVEhJUyBNVVNUIEJFIERPTkUgRk9SIEZJTEUgVVBMT0FESU5HCgkJCQljYWNoZTogZmFsc2UsCgkJCQljb250ZW50VHlwZTogZmFsc2UsCgkJCQl0eXBlOiAnUE9TVCcsCgkJCQlwcm9jZXNzRGF0YTogZmFsc2UsCgkJCQlzdWNjZXNzOiBkYXRhID0+IHsKCQkJCQl0aGlzLnNyKCkucnVuU2NyaXB0KGRhdGEpOwoJCQkJCXRoaXMuYnlOYW1lKG9wdGlvbnMubmFtZSkuZGF0YSA9IHJldDsKCQkJCQlpZiAob3B0aW9ucyAmJiBvcHRpb25zLnVwbG9hZCkgb3B0aW9ucy51cGxvYWQodGhpcy5nZXQoKSwgcmV0KTsKCQkJCQl0aGlzLmJ1c3koZmFsc2UpOwoJCQkJfQoJCQl9KTsKCQl9Cgl9CgoJZUZ1bihlKSB7CgkJdHJ5IHsKCQkJaWYgKGUudHlwZSA9PSAidHJlZSIpIHsKCQkJCWlmIChlLmNvbHVtbnMpIHsKCQkJCQlyZXR1cm4gImNvbWJvdHJlZWdyaWQiOwoJCQkJfSBlbHNlIGlmICh0eXBlb2YoZS5jb21ibykgIT09ICd1bmRlZmluZWQnICYmICFlLmNvbWJvKSB7CgkJCQkJcmV0dXJuICd0cmVlJzsKCQkJCX0gZWxzZSB7CgkJCQkJcmV0dXJuICJjb21ib3RyZWUiOwoJCQkJfQoJCQl9IGVsc2UgaWYgKGUudHlwZSA9PSAnbmF2aWdhdGlvbicpIHsKCQkJCXJldHVybiAndHJlZSc7CgkJCX0gZWxzZSBpZiAoZS50eXBlID09ICJjb21ib3RyZWUiKSB7CgkJCQlyZXR1cm4gImNvbWJvdHJlZWdyaWQiOwoJCQl9IGVsc2UgaWYgKGUudHlwZSA9PSAic2VsZWN0IiAmJiBlLm9wdGlvbnMpIHsKCQkJCXJldHVybiAiY29tYm9ib3giOwoJCQl9CgkJCXJldHVybiAiY29tYm9ncmlkIjsKCQl9IGNhdGNoIChleCkgewoJCQlyZXR1cm4gImNvbWJvZ3JpZCI7CgkJfQoJfQoKCV9maWxsV2luZG93KHdpbk5hbWUsIHYsIG1hcCkgewoJCXYgPSB2IHx8IHt9OwoJCW1hcCA9IG1hcCB8fCB7fTsKCQlpZiAoQXJyYXkuaXNBcnJheShtYXApKSB7CgkJCW1hcCA9IE9iamVjdC5mcm9tRW50cmllcyhuZXcgTWFwKG1hcCkpOwoJCX0KCgkJbWFwID0gJC5leHRlbmQoe30sIG1hcCwgT2JqZWN0LmZyb21FbnRyaWVzKE9iamVjdC5rZXlzKHYpLm1hcChrID0+IFt3aW5OYW1lICsgaywga10pKSk7CgoJCWxldCBzID0ge307CgkJZm9yICh2YXIgbSBpbiBtYXApIHsKCQkJaWYgKHR5cGVvZih2W21hcFttXV0pID09PSAidW5kZWZpbmVkIikgewoJCQkJLy9jb25zb2xlLmxvZygnaXNfdW5kZWZpbmVkJywgbSwgbWFwW21dLCB2W21hcFttXV0pOwoJCQkJc1ttXSA9IG1hcFttXTsKCQkJfSBlbHNlIHsKCQkJCS8vY29uc29sZS5sb2coJ2lzX25vdF91bmRlZmluZWQnLCBtLCBtYXBbbV0sIHZbbWFwW21dXSk7CgkJCQlzW21dID0gdlttYXBbbV1dOwoJCQl9CgkJfQoJCXRoaXMuY2xlYXIod2luTmFtZSk7CgkJLy9jb25zb2xlLmxvZygicyIsIHMpOwoJCXRoaXMuc2V0KHMpOwoJCSQoIiNwbmxfIiArIHdpbk5hbWUpLndpbmRvdygib3BlbiIpOwoJfQoKCXdpbmRvd1RvRW50aXR5KG8sIGJFbXB0eSwgZ3JpZCwgcHJlZml4LCBmaWx0ZXIpIHsKCQlvID0gbyB8fCB0aGlzLmdldCgpOwoJCWZpbHRlciA9IGZpbHRlciB8fCAodiA9PiB2KTsKCQlsZXQgcmV0ID0gZ3JpZCA/IChncmlkLnNlbGVjdGVkIHx8IGdyaWQpIDogbnVsbDsKCQlpZiAoYkVtcHR5KSB7CgkJCXJldCA9IHt9OwoJCQlvID0ge307CgkJfSBlbHNlIHsKCQkJcmV0ID0gKHJldCAmJiByZXQuSWQpID8gewoJCQkJSWQ6IHJldC5JZAoJCQl9IDoge307CgkJfQoKCQl0aGlzLmVsZW1lbnRzLmZpbHRlcihlID0+IChwcmVmaXggPyBlLmdyb3VwID09IHByZWZpeCA6IHRydWUpICYmIGUudHlwZSAhPSAnbGluaycgJiYgWydfJ10uaW5kZXhPZihlLm5hbWUucmVwbGFjZShwcmVmaXgsICIiKSkgPCAwKS5mb3JFYWNoKGUgPT4gewoJCQlyZXRbZS5uYW1lLnJlcGxhY2UocHJlZml4LCAiIildID0gb1tlLm5hbWVdOwoJCQlyZXR1cm4gdHJ1ZTsKCQl9KTsKCgkJZmlsdGVyKHJldCk7CgoJCXJldHVybiByZXQ7Cgl9CgoJYmluZChvYmopIHsKCQl2YXIgb2JqQmluZCA9IChvLCBlKSA9PiB7CgkJCW9bdGhpcy5lRnVuKGUpXSh7CgkJCQlvblNob3dQYW5lbDogKCkgPT4gewoJCQkJCXRoaXMuZmlsbERhdGEoJCgiIyIgKyBlLmlkKSwgbnVsbCwgMCwgMTApOwoJCQkJfSwKCQkJCW9uQ2xpY2tSb3c6IChpbmRleCwgcm93KSA9PiB7CgkJCQkJdmFyIHMgPSByb3cgPyByb3cuX19PV05FUiA6IG51bGw7CgkJCQkJaWYgKHMgJiYgcy5vcHRpb25zLnNlbGVjdCkgewoJCQkJCQlzLm9wdGlvbnMuc2VsZWN0KHJvdyk7CgkJCQkJfQoJCQkJfQoJCQl9KTsKCQkJdHJ5IHsKCQkJCXZhciBkZyA9IG9bdGhpcy5lRnVuKGUpXSgnZ3JpZCcpOwoJCQkJLy8gZGcuZGF0YWdyaWQoJ2VuYWJsZUZpbHRlcicpCgkJCQl2YXIgc3RhdGUgPSBkZy5kYXRhKCdkYXRhZ3JpZCcpOwoJCQkJdmFyIG9wdHMgPSBzdGF0ZS5vcHRpb25zOwoJCQkJdmFyIG9uQmVmb3JlTG9hZCA9IG9wdHMub25CZWZvcmVMb2FkOwoJCQkJb3B0cy5vbkJlZm9yZUxvYWQgPSAocGFyYW0pID0+IHsKCQkJCQlzdGF0ZS5hbGxSb3dzID0gbnVsbDsKCQkJCQlyZXR1cm4gb25CZWZvcmVMb2FkLmNhbGwodGhpcywgcGFyYW0pOwoJCQkJfTsKCQkJCXZhciBwYWdlciA9IGRnLmRhdGFncmlkKCdnZXRQYWdlcicpOwoJCQkJZGcuZGF0YWdyaWQoJ2dldFBhbmVsJykucGFuZWwoewoJCQkJCUlEOiBpCgkJCQl9KTsKCQkJCXBhZ2VyLnBhZ2luYXRpb24oewoJCQkJCW9uU2VsZWN0UGFnZTogZnVuY3Rpb24ocGFnZU51bSwgcGFnZVNpemUpIHsKCQkJCQkJdGhpcy5maWxsRGF0YSgkKCIjIiArIHRoaXMuc2VsZWN0c1skKHRoaXMucGFyZW50Tm9kZSkucGFuZWwoJ29wdGlvbnMnKS5JRF0uaWQpLCBudWxsLCBwYWdlU2l6ZSAqIChwYWdlTnVtIC0gMSksIHBhZ2VTaXplICogcGFnZU51bSk7CgkJCQkJfQoJCQkJfSk7CgkJCQlkZy5kYXRhZ3JpZCgnbG9hZERhdGEnLCBzdGF0ZS5kYXRhKTsKCQkJfSBjYXRjaCAoZXgpIHt9CgkJfQoJCWlmIChvYmopIHsKCQkJb2JqQmluZChvYmopOwoJCX0gZWxzZSB7CgkJCWZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5zZWxlY3RzLmxlbmd0aDsgaSsrKSB7CgkJCQlpZiAodGhpcy5zZWxlY3RzW2ldLm9wdGlvbnMub3B0aW9ucykgewoJCQkJCS8vJCgiIyIgKyB0aGlzLnNlbGVjdHNbaV0uaWQpLmNvbWJvKCk7CgkJCQl9IGVsc2UgewoJCQkJCW9iakJpbmQoJCgiIyIgKyB0aGlzLnNlbGVjdHNbaV0uaWQpLCB0aGlzLnNlbGVjdHNbaV0pOwoJCQkJfQoJCQl9CgoJCQl0aGlzLmVsZW1lbnRzLmZpbHRlcihlID0+IGUud2luZG93KS5mb3JFYWNoKGUgPT4gewoJCQkJbGV0IHQgPSAkKCIjdGJjV2luZG93IikudGFicygiZ2V0VGFiIiwgZS5ncm91cCk7CgkJCQlpZiAodCkgewoJCQkJCXQucGFuZWwoJ29wdGlvbnMnKS50YWIuaGlkZSgpOwoJCQkJfQoJCQl9KTsKCQl9Cgl9CgoJZW5nbGlzaChzKSB7CgkJaWYgKCFzKSByZXR1cm4gIiI7CgkJdmFyIHJlc3VsdCA9IHMucmVwbGFjZSgvKFtBLVpdKS9nLCAiICQxIik7CgkJcmVzdWx0ID0gcmVzdWx0LnJlcGxhY2UoL18vZywgJycpOwoJCXJldHVybiByZXN1bHQuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyByZXN1bHQuc2xpY2UoMSk7Cgl9CgoJb25Ub2dnbGUoZSwgYlZhbHVlKSB7CgkJbGV0IHNUYWcgPSBgI2ZFbGVtZW50XyR7ZS5mb3IubmFtZX0gPiAuZWFzeXVpLSR7dGhpcy51aVR5cGVzW2UuZm9yLnR5cGVdfWA7CgkJbGV0IG9UYWcgPSAkKHNUYWcpOwoJCWUuZm9yLmVuYWJsZWQgPSB0eXBlb2YoYlZhbHVlKSA9PT0gInVuZGVmaW5lZCIgPyAhZS5mb3IuZW5hYmxlZCA6IGJWYWx1ZTsKCgkJb1RhZy5wcm9wKCJkaXNhYmxlZCIsICFlLmZvci5lbmFibGVkKTsKCQkvL29UYWdbdGhpcy51aVR5cGVzW2UuZm9yLnR5cGVdXShlLmZvci5lbmFibGVkID8gImVuYWJsZSIgOiAiZGlzYWJsZSIpOwoJCWNvbnNvbGUubG9nKHNUYWcsIG9UYWcsIHRoaXMudWlUeXBlc1tlLmZvci50eXBlXSwgZS5mb3IuZW5hYmxlZCk7Cgl9CgoJcmVuZGVyKG5hbWUsIHRpdGxlLCBlbGVtZW50cywgYnV0dG9ucywgYkZpeGVkKSB7CgkJdGhpcy5lbGVtZW50cyA9IChlbGVtZW50cyB8fCBbXSkuZmlsdGVyKGUgPT4gIWUuaWdub3JlKTsKCgkJdGhpcy5idXR0b25zID0gYnV0dG9ucyB8fCBbXTsKCQl0aGlzLnNlbGVjdHMgPSBbXTsKCQl0aGlzLmdyaWRzID0gW107CgoJCXRoaXMuZWxlbWVudHMuZmlsdGVyKGUgPT4gZS50eXBlID09ICJ3aW5kb3ciKS5mb3JFYWNoKHcgPT4gdGhpcy5lbGVtZW50cy5zcGxpY2UodGhpcy5lbGVtZW50cy5maW5kSW5kZXgoZSA9PiBlLm5hbWUgPT0gdy5uYW1lKSwgMCwgewoJCQluYW1lOiAiXyIgKyB3Lm5hbWUsCgkJCXR5cGU6ICJsaW5rIiwKCQkJdGl0bGU6IHcudGl0bGUgfHwgdy5uYW1lLAoJCQlncm91cDogdy5ncm91cCwKCQkJd2luZG93OiB3LndpbmRvdywKCQkJc2VjdGlvbjogdy5zZWN0aW9uLAoJCQlsaW5rczogW3sKCQkJCWxhYmVsOiAnT3BlbicsCgkJCQlpY29uOiAnZWRpdCcsCgkJCQlvbkNsaWNrOiBvID0+ICQoIiNwbmwiICsgdy5uYW1lKS53aW5kb3coJ29wZW4nKQoJCQl9XSwKCQl9KSk7CgoJCXRoaXMuc3IoKS5ncm91cEJ5KHRoaXMuZWxlbWVudHMuZmlsdGVyKGUgPT4gZS53aW5kb3cpLCAiZ3JvdXAiKS5mb3JFYWNoKGt2ID0+IHsKCQkJaWYgKCFrdi5rZXkpIHJldHVybjsKCgkJCWxldCBlID0gewoJCQkJbmFtZTogIl8iICsga3Yua2V5LAoJCQkJdGl0bGU6IGt2LmtleSwKCQkJCXR5cGU6ICJ3aW5kb3ciLAoJCQkJZ3JvdXA6IGt2LmtleSwKCQkJCXdpZHRoOiB0aGlzLndpZHRoICogMC45LAoJCQkJaGVpZ2h0OiB0aGlzLmhlaWdodCAqIDAuOSwKCQkJCWxvYWRlcjogbyA9PiB7CgkJCQkJa3YudmFsdWVzLmZpbHRlcih2ID0+IHYudHlwZSAhPT0gJ2xpbmsnIHx8ICh2LnR5cGUgPT0gJ2xpbmsnICYmIHYubmFtZS5zdGFydHNXaXRoKCdfJykpKS5mb3JFYWNoKHYgPT4gJCgiI3BubF8iICsgdi5ncm91cCArICctY2VudGVyJykuYXBwZW5kKCQoIiNmRWxlbWVudF8iICsgdi5uYW1lKSkpOwoJCQkJCXJldHVybiBudWxsOwoJCQkJfSwKCQkJCWJ1dHRvbnM6IFtdLmNvbmNhdC5hcHBseShbXSwga3YudmFsdWVzLmZpbHRlcih2ID0+IHYudHlwZSA9PSAnbGluaycgJiYgIXYubmFtZS5zdGFydHNXaXRoKCdfJykpLm1hcCh2ID0+IFsuLi52LmxpbmtzLm1hcChsID0+ICh7CgkJCQkJbmFtZTogbC5uYW1lIHx8IGwubGFiZWwsCgkJCQkJdGl0bGU6IGwudGl0bGUgfHwgbC5sYWJlbCwKCQkJCQlvbkNsaWNrOiBsLm9uQ2xpY2ssCgkJCQkJaWNvbjogbC5pY29uLAoJCQkJCXdpbmRvdzogdHJ1ZSwKCQkJCQlncm91cDoga3Yua2V5LAoJCQkJfSkpXSkpLAoJCQl9OwoJCQl0aGlzLmJ1dHRvbnMucHVzaCguLi5lLmJ1dHRvbnMpOwoKCQkJdGhpcy5lbGVtZW50cy5wdXNoKGUpOwoJCX0pOwoKCQl2YXIgcmV0ID0gIiI7CgkJLy8gY2hlY2sgdGhlIG9wdGlvbiBvZiB1c2luZyB3aW5kb3coKSBhcyBhIHJlbmRlcmVyIG9mIHRoZSBtYWluIHdpbmRvdy4uLgoJCWlmICh0cnVlKSB7CgkJCXRoaXMuZWxlbWVudHMuZmlsdGVyKGUgPT4gIWUuem9uZSkuZm9yRWFjaChlID0+IGUuem9uZSA9ICdjZW50ZXInKTsKCQkJbGV0IHdPcHRpb25zID0gewoJCQkJbmFtZTogbmFtZSB8fCB0aGlzLm5hbWUsCgkJCQl0aXRsZTogdGl0bGUgfHwgdGhpcy50aXRsZSwKCQkJCXR5cGU6ICd3aW5kb3cnLAoJCQkJdmlzaWJsZTogdHJ1ZSwKCQkJCXdpZHRoOiB0aGlzLndpZHRoLAoJCQkJaGVpZ2h0OiB0aGlzLmhlaWdodCwKCQkJCWZpeGVkOiBiRml4ZWQsCgkJCQlsaW5rczogW3sKCQkJCQlpY29uOiAiaGVscCIsCgkJCQkJYWN0aW9uOiBvID0+ICQoIiNwbmxfX0NvbnNvbGUiKS53aW5kb3coJ29wZW4nKQoJCQkJfV0sCgkJCQlidXR0b25zOiB0aGlzLmJ1dHRvbnMuZmlsdGVyKGIgPT4gIWIud2luZG93KSwKCQkJfTsKCQkJdGhpcy5zcigpLmdyb3VwQnkodGhpcy5lbGVtZW50cywgJ3pvbmUnKS5maWx0ZXIoemcgPT4gemcua2V5KS5mb3JFYWNoKHpnID0+IHsKCQkJCXdPcHRpb25zW3pnLmtleV0gPSB0aGlzLnJlbmRlckVsZW1lbnRzKHpnLnZhbHVlcyk7CgkJCX0pOwoKCQkJcmV0ID0gdGhpcy53aW5kb3cod09wdGlvbnMpOwoJCX0gZWxzZSB7CgkJCXJldCA9IHRoaXMuaGVhZGVyKG5hbWUsIHRpdGxlLCBiRml4ZWQsIFt7CgkJCQlpY29uOiAiaGVscCIsCgkJCQlhY3Rpb246IG8gPT4gJCgiI3BubF9fQ29uc29sZSIpLndpbmRvdygnb3BlbicpCgkJCX1dKTsKCgkJCXJldCArPSB0aGlzLnJlbmRlckVsZW1lbnRzKCk7CgoJCQlyZXQgKz0gdGhpcy5mb290ZXIoYkZpeGVkKTsKCgkJfQoJCS8vIGNvbnNvbGUubG9nKHJldCk7CgoJCXJldHVybiByZXQ7Cgl9CgoJY1dpZHRoKG9wdGlvbnMpIHsKCQlsZXQgcmV0ID0gTWF0aC5mbG9vcigoKG9wdGlvbnMgPyBvcHRpb25zLndpZHRoIDogbnVsbCkgfHwgKHRoaXMud2lkdGggLyAzKSkpOwoJCWlmIChvcHRpb25zLnpvbmUgPT0gJ2Vhc3QnIHx8IG9wdGlvbnMuem9uZSA9PSAnd2VzdCcpIHsKCQkJcmV0ID0gMC4yNSAqIHJldDsgLy8gOTAlIG9mIDMvMTAsIHRoZSB3aWR0aCBvZiB0aGUgbm9ybWFsIGVsZW1lbnQKCQl9IGVsc2UgaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5lZGl0b3IpIHsKCQkJcmV0ID0gd2luZG93LmlubmVyV2lkdGg7CgkJfSBlbHNlIGlmIChvcHRpb25zICYmIG9wdGlvbnMud2lkdGggJiYgdHlwZW9mKG9wdGlvbnMud2lkdGgpID09PSAnc3RyaW5nJykgewoJCQlyZXQgPSB0aGlzLndpZHRoOwoJCX0gZWxzZSBpZiAob3B0aW9ucyAmJiBvcHRpb25zLnR5cGUgPT0gJ3dpbmRvdycgJiYgIW9wdGlvbnMud2lkdGgpIHsKCQkJcmV0ID0gdGhpcy53aWR0aCAqIDAuOTsKCQl9CgoJCS8vIGNvbnNvbGUubG9nKG9wdGlvbnMubmFtZSArICI6IGNXaWR0aCA9ICIgKyByZXQsIG9wdGlvbnMuem9uZSk7CgkJcmV0dXJuIHJldDsKCX0KCgl3aW5kb3cob3B0aW9ucykgewoJCW9wdGlvbnMudGl0bGUgPSBvcHRpb25zLnRpdGxlIHx8IG9wdGlvbnMubmFtZTsKCQl2YXIgcmV0ID0gYAoJCTxkaXYgaWQgPSAicG5sJHtvcHRpb25zLm5hbWV9IiBjbGFzcz0iZWFzeXVpLXdpbmRvdyIgdGl0bGU9IiR7b3B0aW9ucy50aXRsZX0iIGRhdGEtb3B0aW9ucz0nJHt0aGlzLmV2ZW50SGFuZGxlcnMob3B0aW9ucyl9LCBjbG9zZWQ6JHshb3B0aW9ucy52aXNpYmxlfSxtaW5pbWl6YWJsZTokeyFvcHRpb25zLmZpeGVkfSxtYXhpbWl6YWJsZTokeyFvcHRpb25zLmZpeGVkfSxjbG9zYWJsZTokeyFvcHRpb25zLmZpeGVkfSxjb2xsYXBzaWJsZTokeyFvcHRpb25zLmZpeGVkfSxkcmFnZ2FibGU6JHshb3B0aW9ucy5maXhlZH0scmVzaXphYmxlOiR7IW9wdGlvbnMuZml4ZWR9LGljb25DbHM6Imljb24tJHtvcHRpb25zLmljb259IiwgdG9vbHM6IiMke29wdGlvbnMubmFtZX1fdG9vbHMiJyBzdHlsZT0id2lkdGg6JHt0aGlzLmNXaWR0aChvcHRpb25zKX1weDtoZWlnaHQ6JHt0aGlzLmNIZWlnaHQob3B0aW9ucyl9cHg7cGFkZGluZzoxMHB4OyI+CgkJICAgIDxkaXYgY2xhc3M9ImVhc3l1aS1sYXlvdXQiIGRhdGEtb3B0aW9ucz0iZml0OnRydWUiPgoJCWA7CgoJCWxldCBiWm9uZSA9IG9wdGlvbnMuc291dGggPyAnc291dGgnIDogKHRoaXMuem9uZXMuZmluZCh6ID0+IHogPT0gJ3NvdXRoJykgfHwgdGhpcy56b25lc1swXSk7CgkJb3B0aW9uc1tiWm9uZV0gPSBvcHRpb25zW2Jab25lXSB8fCBbXTsKCQlsZXQgeldpZHRoID0gTWF0aC5taW4oMTIwLCB0aGlzLndpZHRoICogMC45NSAvIChvcHRpb25zLmJ1dHRvbnMgPyBvcHRpb25zLmJ1dHRvbnMubGVuZ3RoIDogMSksIHRoaXMuY1dpZHRoKG9wdGlvbnMpKTsKCQlvcHRpb25zW2Jab25lXS5wdXNoKGA8ZGl2IGlkPSJwbmwke29wdGlvbnMubmFtZX0tYnV0dG9ucyIgZGF0YS1vcHRpb25zPSJyZWdpb246JyR7YlpvbmV9Jyxib3JkZXI6ZmFsc2UiIHN0eWxlPSJ0ZXh0LWFsaWduOnJpZ2h0O3BhZGRpbmc6NXB4IDAgMDsiPmAgKyAkLm1hcCgkLmdyZXAob3B0aW9ucy5idXR0b25zIHx8IFtdLCBiID0+ICFiLmlnbm9yZSksIGIgPT4gYDxhIGlkPScke2IubmFtZX0nIGhyZWY9ImphdmFzY3JpcHQ6dm9pZCgwKSIgY2xhc3M9ImVhc3l1aS1saW5rYnV0dG9uIGM2IiBpY29uQ2xzPSJpY29uLSR7Yi5pY29uIHx8ICdzYXZlJ30iIHN0eWxlPSJ3aWR0aDoke3pXaWR0aH1weCIgb25jbGljaz0ndGhpcy5kb0NsaWNrKCR7X0ZyRU1ELl90b0pTKGIpfSknPiR7Yi50aXRsZSB8fCBiLm5hbWV9PC9hPiZuYnNwOyZuYnNwO2ApLmpvaW4oJycpICsgYDwvZGl2PmApOwoKCQl0aGlzLnpvbmVzLmZpbHRlcih6ID0+IG9wdGlvbnNbel0pLmZvckVhY2goeiA9PiB7CgkJCXJldCArPSBgCgkJICAgICAgICA8ZGl2IGRhdGEtb3B0aW9ucz0icmVnaW9uOicke3p9JyIgdGl0bGU9IiR7KHo9PSd3ZXN0JyB8fCB6PT0nZWFzdCcpPycmbmJzcDsnOicnfSIgc3R5bGU9J2hlaWdodDokeyh6PT0nbm9ydGgnfHx6PT0nc291dGgnKT8xMDoxMDB9JTt3aWR0aDokeygoej09J2Vhc3QnfHx6PT0nd2VzdCcpPzAuMToxKSp0aGlzLmNXaWR0aChvcHRpb25zKX1weCc+CiAgICAgICAgCQkgICAgJHsoQXJyYXkuaXNBcnJheShvcHRpb25zW3pdKT9vcHRpb25zW3pdOltvcHRpb25zW3pdXSkuam9pbignJyl9CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgYDsKCQl9KTsKCgkJcmV0ICs9IGA8L2Rpdj48L2Rpdj5gOwoKCQkvLyBsaW5rcyAodG9vbHMpCgkJbGV0IGxpbmtzID0gJC5ncmVwKFtdLmNvbmNhdChvcHRpb25zLmxpbmtzIHx8IFtdKSwgbCA9PiAhbC5pZ25vcmUpOwoJCXJldCArPSBgPGRpdiBpZD0iJHtvcHRpb25zLm5hbWV9X3Rvb2xzIj5gICsgJC5tYXAobGlua3MucmV2ZXJzZSgpLCBsID0+IGA8YSBocmVmPSJqYXZhc2NyaXB0OnZvaWQoMCkiIHN0eWxlPSJjb2xvcjpibGFjayIgY2xhc3M9ImZhcyBmYS0ke2wuaWNvbiB8fCAnYWRkJ30iIG9uY2xpY2s9Jyhhc3luYyAoKSA9PiB7dmFyIGEgPSAke19GckVNRC5fdG9KUyhsKX07ICQoIiNwbmwke29wdGlvbnMubmFtZX0iKS53aW5kb3coInNldFRpdGxlIiwgIiR7b3B0aW9ucy50aXRsZX06ICIgKyBhLm5hbWUpOyBhd2FpdCBhLmFjdGlvbihERm9ybS5nZXQoKSwgYSwgJHtfRnJFTUQuX3RvSlMob3B0aW9ucyl9KTsgJCgiI3BubCR7b3B0aW9ucy5uYW1lfSIpLndpbmRvdygic2V0VGl0bGUiLCAiJHtvcHRpb25zLnRpdGxlfSIpO30pKCknPjwvYT5gKS5qb2luKCdcbicpICsgYDwvZGl2PmA7CgoJCXJldHVybiByZXQ7Cgl9CgoJYXN5bmMgX2VuZCgpIHsKCQlsZXQgbyA9IHRoaXMuZ2V0KCk7CgoJCS8vIGRvIG5vdCB1c2UgdGhlIGZpcnN0IGJ1dHRvbiwgYmVjYXVzZSBtYW55IGZvcm1zIGhhdmUgYSBDYW5jZWwgYnV0dG9uIG9ubHkKCQlsZXQgYnV0dG9uID0gdGhpcy5idXR0b25zLmZpbmQoYiA9PiBiLmF1dG9TdWJtaXQpIC8qIHx8IHRoaXMuYnV0dG9uc1swXSovIDsKCQlpZiAoYnV0dG9uICYmIG8gJiYgT2JqZWN0LnZhbHVlcyhvKS5sZW5ndGggJiYgKHR5cGVvZihidXR0b24uYXV0b1N1Ym1pdCkgPT09ICJ1bmRlZmluZWQiIHx8IGJ1dHRvbi5hdXRvU3VibWl0KSkgewoJCQlsZXQgdiA9IE9iamVjdC52YWx1ZXMobykucmVkdWNlKCh0LCB2KSA9PiB7CgkJCQlyZXR1cm4gKCh0eXBlb2YodikgIT09ICJvYmplY3QiKSA/IDEgOiAwKSAqICh2ID8gMSA6IDApOwoJCQl9KTsKCQkJLy9jb25zb2xlLmxvZyhvLCBPYmplY3QudmFsdWVzKG8pLCB2KTsKCQkJaWYgKHYpIHsKCQkJCS8vIGFsbCBmaWVsZHMgaGF2ZSB2YWx1ZXMKCQkJCWF3YWl0IHRoaXMuZG9DbGljayhidXR0b24pOwoKCQkJfQoJCX0KCX0KCglmb290ZXIoYkZpeGVkKSB7CgkJcmV0dXJuIGA8L2Zvcm0+YCArIGA8ZGl2IGlkPSJkbGctYnV0dG9ucyI+YCArIHRoaXMuYnV0dG9ucy5maWx0ZXIoYiA9PiAhYi53aW5kb3cpLm1hcChiID0+IGA8YSBpZD0nJHtiLm5hbWV9JyBocmVmPSJqYXZhc2NyaXB0OnZvaWQoMCkiIGNsYXNzPSJlYXN5dWktbGlua2J1dHRvbiBjNiIgaWNvbkNscz0iaWNvbi0ke2IuaWNvbiB8fCAnc2F2ZSd9IiBzdHlsZT0id2lkdGg6JHtNYXRoLm1pbigxMjAsIHRoaXMud2lkdGggKiAwLjk1IC8gdGhpcy5idXR0b25zLmxlbmd0aCwgdGhpcy5jV2lkdGgoKSl9cHgiIG9uY2xpY2s9J3RoaXMuZG9DbGljaygke19GckVNRC5fdG9KUyhiKX0pJz4ke2IudGl0bGUgfHwgYi5uYW1lfTwvYT4mbmJzcDsmbmJzcDtgKS5qb2luKCcnKSArICI8L2Rpdj4iICsgKGJGaXhlZCA/ICIiIDogJzwvZGl2PicpOwoJfQoKCWhlYWRlcihuYW1lLCB0aXRsZSwgYkZpeGVkLCBsaW5rcykgewoJCXRoaXMudGl0bGUgPSB0aXRsZSB8fCB0aGlzLnRpdGxlOwoJCW5hbWUgPSBuYW1lIHx8IHRoaXMubmFtZTsKCQl2YXIgcmV0ID0gJyc7CgoJCXJldCArPSB0aGlzLndpbmRvdyh7CgkJCW5hbWU6ICJfX0NvbnNvbGUiLAoJCQl0eXBlOiAid2luZG93IiwKCQkJZWRpdG9yOiB0cnVlLAoJCQlsb2FkZXI6IG8gPT4gd2luZG93LmxvZ3Muc2xpY2UoKS5yZXZlcnNlKCkubWFwKGwgPT4gbC5kYXRlLnRvSVNPU3RyaW5nKCkgKyAiOiAiICsgbC5hcmdzLm1hcChzID0+IHR5cGVvZihzKSA9PT0gJ29iamVjdCcgPyAoKG9iaiwgaW5kZW50ID0gMikgPT4gewoJCQkJbGV0IGNhY2hlID0gW107CgkJCQljb25zdCByZXRWYWwgPSBKU09OLnN0cmluZ2lmeSgKCQkJCQlvYmosCgkJCQkJKGtleSwgdmFsdWUpID0+CgkJCQkJdHlwZW9mIHZhbHVlID09PSAib2JqZWN0IiAmJiB2YWx1ZSAhPT0gbnVsbCA/CgkJCQkJY2FjaGUuaW5jbHVkZXModmFsdWUpID8KCQkJCQl1bmRlZmluZWQgLy8gRHVwbGljYXRlIHJlZmVyZW5jZSBmb3VuZCwgZGlzY2FyZCBrZXkKCQkJCQk6CgkJCQkJY2FjaGUucHVzaCh2YWx1ZSkgJiYgdmFsdWUgLy8gU3RvcmUgdmFsdWUgaW4gb3VyIGNvbGxlY3Rpb24KCQkJCQk6CgkJCQkJdmFsdWUsCgkJCQkJaW5kZW50CgkJCQkpOwoJCQkJY2FjaGUgPSBudWxsOwoJCQkJcmV0dXJuIHJldFZhbDsKCQkJfSkocykgOiBzKS5qb2luKCcsICcpKS5qb2luKCdcbicpLAoJCX0pOwoKCQlpZiAoIWJGaXhlZCkgewoJCQlsaW5rcyA9IChsaW5rcyB8fCBbXSkuZmlsdGVyKGwgPT4gIWwuaWdub3JlKTsKCQkJbGV0IHREYXRhID0gIiI7CgkJCWlmIChsaW5rcy5sZW5ndGgpIHsKCQkJCXJldCArPSBgPGRpdiBpZD0iJHt0aGlzLm5hbWV9X3Rvb2xzIj5gICsgbGlua3MubWFwKGwgPT4gYDxhIGhyZWY9ImphdmFzY3JpcHQ6dm9pZCgwKSIgY2xhc3M9Imljb24tJHtsLmljb259IiBvbmNsaWNrPScoYXN5bmMgKCkgPT4ge3ZhciBhID0gJHtfRnJFTUQuX3RvSlMobCl9OyAkKCIjd2luJHt0aGlzLm5hbWV9Iikud2luZG93KCJzZXRUaXRsZSIsICIke3RoaXMudGl0bGV9OiAiICsgYS5uYW1lKTsgYXdhaXQgYS5hY3Rpb24oREZvcm0uZ2V0KCkpOyAkKCIjd2luJHt0aGlzLm5hbWV9Iikud2luZG93KCJzZXRUaXRsZSIsICIke3RoaXMudGl0bGV9Iik7fSkoKSc+PC9hPmApLmpvaW4oJ1xuJykgKyAiPC9kaXY+IjsKCQkJCXREYXRhID0gYCx0b29sczoiIyR7dGhpcy5uYW1lfV90b29scyJgOwoJCQl9CgkJCXJldCArPSBgPGRpdiBpZD0nd2luJHt0aGlzLm5hbWV9JyBjbGFzcz0nZWFzeXVpLXdpbmRvdycgdGl0bGU9JyR7dGhpcy50aXRsZX0nIGRhdGEtb3B0aW9ucz0naWNvbkNsczoiaWNvbi1zYXZlIiAke3REYXRhfScgc3R5bGU9J3dpZHRoOiR7dGhpcy53aWR0aH1weDtoZWlnaHQ6JHt0aGlzLmhlaWdodH1weDtwYWRkaW5nOjEwcHg7Jz5gOwoJCX0KCQlyZXR1cm4gcmV0ICsgYDxmb3JtIGlkPSJmcm0ke3RoaXMubmFtZX0iIG1ldGhvZD0icG9zdCIgbm92YWxpZGF0ZT5gOwoJfQoKCXJlbmRlckVsZW1lbnRzKGVsZW1lbnRzKSB7CgkJZWxlbWVudHMgPSBlbGVtZW50cyB8fCB0aGlzLmVsZW1lbnRzOwoKCQl2YXIgdFdpZHRoID0gTWF0aC5mbG9vcih0aGlzLndpZHRoICogMC45NSk7CgkJdmFyIHRIZWlnaHQgPSBNYXRoLmZsb29yKHRoaXMuaGVpZ2h0ICogMC44NSk7CgoJCWxldCByZXQgPSAnJzsKCQl2YXIgZ0VsZW1lbnRzID0gdGhpcy5zcigpLmdyb3VwQnkoZWxlbWVudHMsICJncm91cCIpOwoJCWlmIChnRWxlbWVudHMubGVuZ3RoID4gMSkgcmV0ICs9IGA8ZGl2IGlkPSJ0YmNXaW5kb3ciIGNsYXNzPSJlYXN5dWktdGFicyIgZGF0YS1vcHRpb25zPScke3RoaXMuZXZlbnRIYW5kbGVycyh7dHlwZTogJ3RhYnMnfSl9JyBzdHlsZT0id2lkdGg6JHt0V2lkdGh9cHg7aGVpZ2h0OiR7dEhlaWdodH1weDsiPmA7CgkJZm9yICh2YXIgZyA9IDA7IGcgPCBnRWxlbWVudHMubGVuZ3RoOyBnKyspIHsKCQkJaWYgKGdFbGVtZW50cy5sZW5ndGggPiAxKSByZXQgKz0gJzxkaXYgdGl0bGU9IicgKyAoZ0VsZW1lbnRzW2ddLmtleSB8fCAiTWFpbiIpICsgJyIgc3R5bGU9InBhZGRpbmc6MjBweDtkaXNwbGF5Om5vbmU7Ij4nOwoJCQl2YXIgc0VsZW1lbnRzID0gdGhpcy5zcigpLmdyb3VwQnkoZ0VsZW1lbnRzW2ddLnZhbHVlcywgInNlY3Rpb24iKTsKCQkJaWYgKHNFbGVtZW50cy5sZW5ndGggPiAxKSByZXQgKz0gJzxkaXYgY2xhc3M9ImVhc3l1aS1hY2NvcmRpb24iIHN0eWxlPSJ3aWR0aDonICsgdFdpZHRoICsgJ3B4O2hlaWdodDonICsgLyp0SGVpZ2h0Ki8gIjEwMCUiICsgJ3B4OyI+JzsKCQkJZm9yICh2YXIgcyA9IDA7IHMgPCBzRWxlbWVudHMubGVuZ3RoOyBzKyspIHsKCQkJCXJldCArPSBgPGRpdiB0aXRsZT0iJHtzRWxlbWVudHNbc10ua2V5IHx8ICIifSIgZGF0YS1vcHRpb25zPSJpY29uQ2xzOidpY29uLW1vcmUnIiBzdHlsZT0icGFkZGluZzoxMHB4OyI+YDsKCQkJCWZvciAodmFyIGkgPSAwOyBpIDwgc0VsZW1lbnRzW3NdLnZhbHVlcy5sZW5ndGg7IGkrKykgewoJCQkJCXZhciBlID0gc0VsZW1lbnRzW3NdLnZhbHVlc1tpXTsKCQkJCQlpZiAoZS5pZ25vcmUpIGNvbnRpbnVlOwoJCQkJCWUudmFsdWUgPSBlLnZhbHVlIHx8IF9GckVNRC5oYXNoW2UubmFtZV0gfHwgKF9GckVNRC5hcGlTZXJ2ZXIgPyBfRnJFTUQuYXBpU2VydmVyLl9fY29uZmlnKCd0ZXN0XycgKyBlLm5hbWUsICcnKSA6ICcnKTsKCQkJCQlyZXQgKz0gYDxkaXYgaWQ9ImZFbGVtZW50XyR7ZS5uYW1lfSIgY2xhc3M9ImZpdGVtIiBzdHlsZT0iZGlzcGxheTogJHsoZS50eXBlPT0nd2luZG93JyB8fCBlLmhpZGRlbik/J25vbmUnOicnfSI+YDsKCQkJCQlpZiAoZS50b2dnbGUpIHsKCQkJCQkJcmV0ICs9IGA8YSBocmVmPSIjIiBjbGFzcz0iZWFzeXVpLWxpbmtidXR0b24iIGRhdGEtb3B0aW9ucz0nJHt0aGlzLmV2ZW50SGFuZGxlcnMoe3R5cGU6ICd0b2dnbGUnLCBmb3I6IGV9KX0scGxhaW46dHJ1ZSxpY29uQ2xzOiJpY29uLSR7ZS5pY29uIHx8ICdzZWFyY2gnfSInIHN0eWxlPSJ3aWR0aDoxMDBweDtoZWlnaHQ6MzBweCI+JHtlLnRpdGxlIHx8IHRoaXMuZW5nbGlzaChlLm5hbWUpfTwvYT5gOwoJCQkJCX0gZWxzZSB7CgkJCQkJCXJldCArPSBgPGxhYmVsPiR7ZS50aXRsZSB8fCB0aGlzLmVuZ2xpc2goZS5uYW1lKX06PC9sYWJlbD5gOwoJCQkJCX0KCQkJCQlpZiAoZS50eXBlICYmIHRoaXNbZS50eXBlXSkgewoJCQkJCQlyZXQgKz0gdGhpc1tlLnR5cGVdKGUpOwoJCQkJCX0gZWxzZSBpZiAoZS5yZW5kZXIpIHsKCQkJCQkJcmV0ICs9IGUucmVuZGVyKCk7CgkJCQkJfQoJCQkJCXJldCArPSAnPC9kaXY+JzsKCQkJCX0KCQkJCXJldCArPSAnPC9kaXY+JzsKCQkJfQoJCQlpZiAoc0VsZW1lbnRzLmxlbmd0aCA+IDEpIHJldCArPSAnPC9kaXY+JzsKCQkJaWYgKGdFbGVtZW50cy5sZW5ndGggPiAxKSByZXQgKz0gIjwvZGl2PiI7CgkJfQoJCWlmIChnRWxlbWVudHMubGVuZ3RoID4gMSkgcmV0ICs9ICI8L2Rpdj4iOwoJCXJldHVybiByZXQ7Cgl9CgoJaW5mbyhtc2cpIHsKCQlpZiAoJC5tZXNzYWdlcikgewoJCQkkLm1lc3NhZ2VyLmFsZXJ0KHRoaXMudGl0bGUsIG1zZywgJ2luZm8nKTsKCQl9IGVsc2UgewoJCQl0aGlzLnNyKCkuU2hvd01lc3NhZ2UobXNnLCB0aGlzLnRpdGxlKTsKCQl9Cgl9CgoJZXJyb3IobXNnKSB7CgkJaWYgKCQubWVzc2FnZXIpIHsKCQkJJC5tZXNzYWdlci5hbGVydCh0aGlzLnRpdGxlLCBtc2csICdlcnJvcicpOwoJCX0gZWxzZSB7CgkJCXRoaXMuc3IoKS5TaG93TWVzc2FnZShtc2csIHRoaXMudGl0bGUpOwoJCX0KCX0KCglieU5hbWUobmFtZSkgewoJCXJldHVybiB0aGlzLmVsZW1lbnRzLmZpbmQoZSA9PiBlLm5hbWUgPT09IG5hbWUpOwoJfQoKCS8qKiBDb21wb25lbnRzOjpTdGFydCAqKi8KCUNvcmVDb21wb25lbnQgPSBjbGFzcyB7CgkJY29uc3RydWN0b3IocGFnZSwgZEZvcm0pIHsKCQkJdGhpcy5wYWdlID0gcGFnZTsKCQkJdGhpcy5kRm9ybSA9IGRGb3JtOwoJCX0KCgkJYnVzeShiQnVzeSkgewoJCQlyZXR1cm4gdGhpcy5kRm9ybS5idXN5KGJCdXN5KTsKCQl9CgoJCV9tZSh2KSB7CgkJCWxldCBtZU5hbWUgPSAodHlwZW9mKGNvbXBhbnkpICE9PSAndW5kZWZpbmVkJykgPyAoY29tcGFueS5sb2dnZWRJbklkZW50aXR5IHx8ICJtZSIpIDogIm1lIjsKCQkJaWYgKHYpIHsKCQkJCXdpbmRvd1ttZU5hbWVdID0gdjsKCQkJfQoKCQkJcmV0dXJuIHdpbmRvd1ttZU5hbWVdOwoJCX0KCgkJX2NhblZpZXcoKSB7CgkJCWlmICghdGhpcy5fbWUoKSkgewoJCQkJd2luZG93Ll9GckVNRC5zZXRVUkwoewoJCQkJCXBhZ2U6ICdsb2dpbicsCgkJCQkJX3JlZGlyZWN0OiB0aGlzLnBhZ2UuX2NvZGUsCgkJCQl9KTsKCQkJCXRocm93IGBfY2FuVmlldzogJHt0aGlzLnBhZ2UuX2NvZGV9IG5vdCBhbGxvd2VkIHdpdGhvdXQgbG9naW4hYDsKCQkJfQoJCX0KCgkJX25hbWUoKSB7CgkJCWlmICghdGhpcy5fbWUoKSkgcmV0dXJuICIiOwoJCQlyZXR1cm4gdGhpcy5fbWUoKS5uYW1lID8gdGhpcy5fbWUoKS5uYW1lKCkgOiB0aGlzLl9tZSgpLlRvU3RyaW5nOwoJCX0KCX0KCglJbmRleENvbXBvbmVudCA9IGNsYXNzIGV4dGVuZHMgdGhpcy5Db3JlQ29tcG9uZW50IHsKCQlhc3luYyBtYWluKCkgewoJCQl0aGlzLl9jYW5WaWV3KCk7CgoJCQl0aGlzLnBhZ2UuZGF0YSA9IHsKCQkJCWZvcm06IHRoaXMuZEZvcm0ucmVuZGVyKCdmcm1JbmRleCcsICJNYWluIFBhZ2UiLCBbewoJCQkJCW5hbWU6ICdXZWxjb21lJywKCQkJCQlyZXF1aXJlZDogdHJ1ZSwKCQkJCQl0eXBlOiAibGFiZWwiLAoJCQkJCXZhbHVlOiB0aGlzLl9uYW1lKCksCgkJCQl9XSwgW10pCgkJCX07CgkJfQoJfQoKCUxvZ2luQ29tcG9uZW50ID0gY2xhc3MgZXh0ZW5kcyB0aGlzLkNvcmVDb21wb25lbnQgewoJCWFzeW5jIF9hdXRoZW50aWNhdGUobykgewoJCQlyZXR1cm4gbnVsbDsKCQl9CgoJCWFzeW5jIF9sb2dnZWRJbigpIHt9CgoJCWFzeW5jIF9ub3RMb2dnZWRJbigpIHt9CgoJCWFzeW5jIG1haW4oKSB7CgkJCXRoaXMucGFnZS5kYXRhID0gewoJCQkJZm9ybTogdGhpcy5kRm9ybS5yZW5kZXIoJ2ZybUxvZ2luJywgIlVzZXIgQXV0aGVudGljYXRpb24iLCBbewoJCQkJCQluYW1lOiAnVXNlcm5hbWUnLAoJCQkJCQlyZXF1aXJlZDogdHJ1ZSwKCQkJCQkJdHlwZTogInN0cmluZyIKCQkJCQl9LAoJCQkJCXsKCQkJCQkJbmFtZTogJ1Bhc3N3b3JkJywKCQkJCQkJcmVxdWlyZWQ6IHRydWUsCgkJCQkJCXR5cGU6ICJwYXNzd29yZCIKCQkJCQl9CgkJCQldLCBbewoJCQkJCW5hbWU6ICdMb2dpbicsCgkJCQkJYXV0b1N1Ym1pdDogdHJ1ZSwKCQkJCQlvbmNsaWNrOiBhc3luYyBvID0+IHsKCQkJCQkJbGV0IHJldCA9IGF3YWl0IHRoaXMuX2F1dGhlbnRpY2F0ZShvKTsKCgkJCQkJCWlmIChyZXQpIHsKCQkJCQkJCXRoaXMuX21lKHJldCk7CgoJCQkJCQkJdHJ5IHsKCQkJCQkJCQlhd2FpdCB0aGlzLl9sb2dnZWRJbigpOwoJCQkJCQkJfSBjYXRjaCAoZXgpIHt9CgoJCQkJCQkJX0ZyRU1ELnNldFVSTCh7CgkJCQkJCQkJcGFnZTogX0ZyRU1ELmhhc2guX3JlZGlyZWN0IHx8ICJpbmRleCIKCQkJCQkJCX0pOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJdHJ5IHsKCQkJCQkJCQlhd2FpdCB0aGlzLl9ub3RMb2dnZWRJbigpOwoJCQkJCQkJfSBjYXRjaCAoZXgpIHt9CgoJCQkJCQkJdGhpcy5kRm9ybS5lcnJvcigiSW52YWxpZCB1c2VybmFtZSBvciBwYXNzd29yZCIpOwoJCQkJCQl9CgoJCQkJCQl0aGlzLmRGb3JtLmJ1c3koZmFsc2UpOwoJCQkJCX0KCQkJCX1dKQoJCQl9OwoJCX0KCX0KCglTdG9yZUNvbXBvbmVudCA9IGNsYXNzIGV4dGVuZHMgdGhpcy5Db3JlQ29tcG9uZW50IHsKCQlhc3luYyBtYWluKCkgewoJCQl0aGlzLl9jYW5WaWV3KCk7CgoJCQljb25zb2xlLmxvZygiR2VuZXJhdGluZyBDUlVEIHBhZ2UgZm9yOiAiLCB0aGlzLnBhZ2UpOwoKCQkJdGhpcy5wYWdlLmRhdGEgPSBhd2FpdCB0aGlzLkNSVUQodGhpcy5wYWdlLmRhdGEpOwoJCX0KCX0KCS8qKiBDb21wb25lbnRzOjpFbmQgKiovCn07",
	"__keys": ["name"],
	"active": true,
	"enabled": true,
	"__trMap": []
}