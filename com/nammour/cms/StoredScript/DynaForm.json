{
	"Id": "09fa8eff85f82e8678f6a2dfc31f2ee425dbd84b",
	"name": "DynaForm",
	"script": "d2luZG93LkR5bmFGb3JtID0gY2xhc3MgewoJY29uc3RydWN0b3IoKSB7CgkJdGhpcy50aXRsZSA9ICJGb3JtIFRpdGxlIjsKCQl0aGlzLm5hbWUgPSAiZnJtRm9ybSI7CgkJdGhpcy5lbGVtZW50cyA9IFtdOwoJCXRoaXMuc2VsZWN0cyA9IFtdOwoJCXRoaXMuZ3JpZHMgPSBbXTsKCQl0aGlzLmJ1dHRvbnMgPSBbXTsKCQl0aGlzLnpvbmVzID0gWydub3J0aCcsICdzb3V0aCcsICdlYXN0JywgJ3dlc3QnLCAnY2VudGVyJ107CgkJdGhpcy5zVGFibGUgPSBudWxsOwoJCXRoaXMuYkRlYnVnID0gZmFsc2U7CgkJdGhpcy51aVR5cGVzID0gewoJCQlpbnQ6ICJudW1iZXJzcGlubmVyIiwKCQkJbWVudTogInNwbGl0YnV0dG9uIiwKCQkJZGF0ZXRpbWU6ICJkYXRldGltZWJveCIsCgkJCWJvb2w6ICJzd2l0Y2hidXR0b24iLAoJCQlmaWxlOiAiZmlsZWJveCIsCgkJCXRleHQ6ICJ0ZXh0Ym94IiwKCQkJcGFzc3dvcmQ6ICJwYXNzd29yZGJveCIsCgkJCXN0cmluZzogInRleHRib3giLAoJCQlpbWFnZTogImRpYWxvZyIsCgkJCXByb2dyZXNzOiAicHJvZ3Jlc3NiYXIiLAoJCQlsaW5rOiAibGlua2J1dHRvbiIsCgkJCXRyZWU6ICJjb21ib3RyZWUiLAoJCQluYXZpZ2F0aW9uOiAidHJlZSIsCgkJCXNlYXJjaDogJ3NlYXJjaGJveCcsCgkJfTsKCQl0aGlzLmV2ZW50cyA9IFt7CgkJCW5hbWU6ICdvbkNsaWNrJywKCQkJaGFuZGxlcjogJ29uVG9nZ2xlJywKCQkJcGFyYW1zOiAnbj1ldmVudCcsCgkJCXR5cGU6ICd0b2dnbGUnLAoJCX0sIHsKCQkJbmFtZTogJ29uQ2xvc2UnLAoJCQloYW5kbGVyOiAnUGFuT25DbG9zZScsCgkJCXBhcmFtczogJ249ZXZlbnQnLAoJCQl0eXBlOiAnd2luZG93JywKCQl9LCB7CgkJCW5hbWU6ICdvblNlbGVjdCcsCgkJCWhhbmRsZXI6ICdTZWxlY3RDaGFuZ2UnLAoJCQlwYXJhbXM6ICduJywKCQkJdHlwZTogJ3RhYnMnLAoJCX0sIHsKCQkJbmFtZTogJ3NlYXJjaGVyJywKCQkJaGFuZGxlcjogJ0ZpZWxkQ2hhbmdlJywKCQkJcGFyYW1zOiAnbiwgbycsCgkJCXR5cGU6ICdzZWFyY2hib3gnLAoJCX0sIHsKCQkJbmFtZTogJ29uQmVmb3JlRXhwYW5kJywKCQkJaGFuZGxlcjogJ0V4cGFuZCcsCgkJCXBhcmFtczogJ24nLAoJCQl0eXBlOiAndHJlZScsCgkJfSwgewoJCQluYW1lOiAnb25DaGFuZ2UnLAoJCQloYW5kbGVyOiAnRmllbGRDaGFuZ2UnLAoJCQlwYXJhbXM6ICduLCBvJwoJCX0sIHsKCQkJbmFtZTogJ29uQmVmb3JlT3BlbicsCgkJCWhhbmRsZXI6ICdQYW5lbE9wZW4nLAoJCQlwYXJhbXM6ICcnLAoJCQl0eXBlOiAnd2luZG93JywKCQl9LCB7CgkJCW5hbWU6ICdvbk9wZW4nLAoJCQloYW5kbGVyOiAnUGVuZEFmdGVyT3BlbicsCgkJCXBhcmFtczogJycsCgkJCXR5cGU6ICd3aW5kb3cnLAoJCX0sIHsKCQkJbmFtZTogJ29uQ2xpY2snLAoJCQloYW5kbGVyOiAnZG9MaW5rJywKCQkJcGFyYW1zOiAnbj1ldmVudCwgbycsCgkJCXR5cGU6ICdsaW5rJywKCQl9LCB7CgkJCW5hbWU6ICdvbkNsaWNrUm93JywKCQkJaGFuZGxlcjogJ0ZpZWxkQ2hhbmdlJywKCQkJcGFyYW1zOiAnbiwgbycsCgkJCXR5cGU6ICdncmlkJywKCQl9XTsKCgkJaWYgKHR5cGVvZigkKSAhPT0gJ3VuZGVmaW5lZCcpICQod2luZG93KS5yZXNpemUodGhpcy53aW5kb3dSZXNpemVkKTsKCQl0aGlzLndpbmRvd1Jlc2l6ZWQoKTsKCX0KCglzcigpIHsKCQlyZXR1cm4gdHlwZW9mKF9GckVNRCkgIT09ICd1bmRlZmluZWQnID8gX0ZyRU1ELnNyKCkgOiB3aW5kb3cuc3I7Cgl9CgoJcGFyc2UoKSB7CgkJJC5wYXJzZXIucGFyc2UoKTsKCX0KCgl3aW5kb3dSZXNpemVkKCkgewoJCXRoaXMud2lkdGggPSB3aW5kb3cuaW5uZXJXaWR0aDsKCQl0aGlzLmhlaWdodCA9IHdpbmRvdy5pbm5lckhlaWdodCAqIDAuODsKCX0KCgkvKiogQ29tcG9uZW50czo6U3RhcnQgKiovCglDb3JlQ29tcG9uZW50ID0gY2xhc3MgewoJCWNvbnN0cnVjdG9yKHBhZ2UsIGRGb3JtKSB7CgkJCXRoaXMucGFnZSA9IHBhZ2U7CgkJCXRoaXMuZEZvcm0gPSBkRm9ybTsKCQl9CgoJCWJ1c3koYkJ1c3kpIHsKCQkJcmV0dXJuIHRoaXMuZEZvcm0uYnVzeShiQnVzeSk7CgkJfQoKCQlfbWUodikgewoJCQlsZXQgbWVOYW1lID0gKHR5cGVvZihjb21wYW55KSAhPT0gJ3VuZGVmaW5lZCcpID8gKGNvbXBhbnkubG9nZ2VkSW5JZGVudGl0eSB8fCAibWUiKSA6ICJtZSI7CgkJCWlmICh2KSB7CgkJCQl3aW5kb3dbbWVOYW1lXSA9IHY7CgkJCX0KCgkJCXJldHVybiB3aW5kb3dbbWVOYW1lXTsKCQl9CgoJCV9jYW5WaWV3KCkgewoJCQlpZiAoIXRoaXMuX21lKCkpIHsKCQkJCXdpbmRvdy5fRnJFTUQuc2V0VVJMKHsKCQkJCQlwYWdlOiAnbG9naW4nLAoJCQkJCV9yZWRpcmVjdDogdGhpcy5wYWdlLl9jb2RlLAoJCQkJfSk7CgkJCQl0aHJvdyBgX2NhblZpZXc6ICR7dGhpcy5wYWdlLl9jb2RlfSBub3QgYWxsb3dlZCB3aXRob3V0IGxvZ2luIWA7CgkJCX0KCQl9CgoJCV9uYW1lKCkgewoJCQlpZiAoIXRoaXMuX21lKCkpIHJldHVybiAiIjsKCQkJcmV0dXJuIHRoaXMuX21lKCkubmFtZSA/IHRoaXMuX21lKCkubmFtZSgpIDogdGhpcy5fbWUoKS5Ub1N0cmluZzsKCQl9Cgl9CgoJSW5kZXhDb21wb25lbnQgPSBjbGFzcyBleHRlbmRzIHRoaXMuQ29yZUNvbXBvbmVudCB7CgkJYXN5bmMgbWFpbigpIHsKCQkJdGhpcy5fY2FuVmlldygpOwoKCQkJdGhpcy5wYWdlLmRhdGEgPSB7CgkJCQlmb3JtOiB0aGlzLmRGb3JtLnJlbmRlcignZnJtSW5kZXgnLCAiTWFpbiBQYWdlIiwgW3sKCQkJCQluYW1lOiAnV2VsY29tZScsCgkJCQkJcmVxdWlyZWQ6IHRydWUsCgkJCQkJdHlwZTogImxhYmVsIiwKCQkJCQl2YWx1ZTogdGhpcy5fbmFtZSgpLAoJCQkJfV0sIFtdKQoJCQl9OwoJCX0KCX0KCglMb2dpbkNvbXBvbmVudCA9IGNsYXNzIGV4dGVuZHMgdGhpcy5Db3JlQ29tcG9uZW50IHsKCQlhc3luYyBfYXV0aGVudGljYXRlKG8pIHsKCQkJcmV0dXJuIG51bGw7CgkJfQoKCQlhc3luYyBfbG9nZ2VkSW4oKSB7fQoKCQlhc3luYyBfbm90TG9nZ2VkSW4oKSB7fQoKCQlhc3luYyBtYWluKCkgewoJCQl0aGlzLnBhZ2UuZGF0YSA9IHsKCQkJCWZvcm06IHRoaXMuZEZvcm0ucmVuZGVyKCdmcm1Mb2dpbicsICJVc2VyIEF1dGhlbnRpY2F0aW9uIiwgW3sKCQkJCQkJbmFtZTogJ1VzZXJuYW1lJywKCQkJCQkJcmVxdWlyZWQ6IHRydWUsCgkJCQkJCXR5cGU6ICJzdHJpbmciCgkJCQkJfSwKCQkJCQl7CgkJCQkJCW5hbWU6ICdQYXNzd29yZCcsCgkJCQkJCXJlcXVpcmVkOiB0cnVlLAoJCQkJCQl0eXBlOiAicGFzc3dvcmQiCgkJCQkJfQoJCQkJXSwgW3sKCQkJCQluYW1lOiAnTG9naW4nLAoJCQkJCWF1dG9TdWJtaXQ6IHRydWUsCgkJCQkJb25jbGljazogYXN5bmMgbyA9PiB7CgkJCQkJCWxldCByZXQgPSBhd2FpdCB0aGlzLl9hdXRoZW50aWNhdGUobyk7CgoJCQkJCQlpZiAocmV0KSB7CgkJCQkJCQl0aGlzLl9tZShyZXQpOwoKCQkJCQkJCXRyeSB7CgkJCQkJCQkJYXdhaXQgdGhpcy5fbG9nZ2VkSW4oKTsKCQkJCQkJCX0gY2F0Y2ggKGV4KSB7fQoKCQkJCQkJCV9GckVNRC5zZXRVUkwoewoJCQkJCQkJCXBhZ2U6IF9GckVNRC5oYXNoLl9yZWRpcmVjdCB8fCAiaW5kZXgiCgkJCQkJCQl9KTsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCXRyeSB7CgkJCQkJCQkJYXdhaXQgdGhpcy5fbm90TG9nZ2VkSW4oKTsKCQkJCQkJCX0gY2F0Y2ggKGV4KSB7fQoKCQkJCQkJCXRoaXMuZXJyb3IoIkludmFsaWQgdXNlcm5hbWUgb3IgcGFzc3dvcmQiKTsKCQkJCQkJfQoKCQkJCQkJdGhpcy5idXN5KGZhbHNlKTsKCQkJCQl9CgkJCQl9XSkKCQkJfQoJCX0KCX0KCglTdG9yZUNvbXBvbmVudCA9IGNsYXNzIGV4dGVuZHMgdGhpcy5Db3JlQ29tcG9uZW50IHsKCQlhc3luYyBtYWluKCkgewoJCQl0aGlzLl9jYW5WaWV3KCk7CgoJCQljb25zb2xlLmxvZygiR2VuZXJhdGluZyBDUlVEIHBhZ2UgZm9yOiAiLCB0aGlzLnBhZ2UpOwoKCQkJdGhpcy5wYWdlLmRhdGEgPSBhd2FpdCB0aGlzLkNSVUQodGhpcy5wYWdlLmRhdGEpOwoJCX0KCX0KCS8qKiBDb21wb25lbnRzOjpFbmQgKiovCgoJaW5pdCgpIHsKCQl2YXIgc2VsZWN0ID0gewoJCQlpbml0OiBmdW5jdGlvbihjb250YWluZXIsIG9wdGlvbnMpIHsKCQkJCXZhciBvcCA9IG51bGw7CgkJCQl2YXIgZm9wID0gbnVsbDsKCQkJCWZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5ncmlkcy5sZW5ndGg7IGkrKykKCQkJCQlpZiAodGhpcy5ncmlkc1tpXS5pZCA9PSBvcHRpb25zLnNvdXJjZSkgb3AgPSB0aGlzLmdyaWRzW2ldLm9wdGlvbnM7CgkJCQlmb3IgKGkgPSAwOyBpIDwgb3AuY29sdW1ucy5sZW5ndGg7IGkrKykKCQkJCQlpZiAob3AuY29sdW1uc1tpXS5uYW1lID09IG9wdGlvbnMuZmllbGQpIGZvcCA9IG9wLmNvbHVtbnNbaV07CgkJCQlmb3Aud2lkdGggPSAodGhpcy53aWR0aCAvIDMpOwoJCQkJdmFyIGUgPSAkKHRoaXMuc2VsZWN0KGZvcCkpOwoJCQkJdmFyIGlucHV0ID0gZS5hcHBlbmRUbyhjb250YWluZXIpOwoJCQkJaW5wdXQuY29tYm9ncmlkKCk7CgkJCQl0aGlzLmJpbmQoaW5wdXQpOwoJCQkJcmV0dXJuIGlucHV0OwoJCQl9LAoJCQlkZXN0cm95OiBmdW5jdGlvbih0YXJnZXQpIHsKCQkJCSQodGFyZ2V0KS5yZW1vdmUoKTsKCQkJfSwKCQkJZ2V0VmFsdWU6IGZ1bmN0aW9uKHRhcmdldCkgewoJCQkJcmV0dXJuICQodGFyZ2V0KS52YWwoKTsKCQkJfSwKCQkJc2V0VmFsdWU6IGZ1bmN0aW9uKHRhcmdldCwgdmFsdWUpIHsKCQkJCSQodGFyZ2V0KS52YWwodmFsdWUpOwoJCQl9LAoJCQlyZXNpemU6IGZ1bmN0aW9uKHRhcmdldCwgd2lkdGgpIHsKCQkJCSQodGFyZ2V0KS5fb3V0ZXJXaWR0aCh3aWR0aCk7CgkJCX0KCQl9OwoJCSQuZXh0ZW5kKCQuZm4uZGF0YWdyaWQuZGVmYXVsdHMuZWRpdG9ycywgewoJCQlkYXRldGltZTogewoJCQkJaW5pdDogZnVuY3Rpb24oY29udGFpbmVyLCBvcHRpb25zKSB7CgkJCQkJb3B0aW9ucy53aWR0aCA9IHRoaXMuY1dpZHRoKG9wdGlvbnMpOwoJCQkJCXZhciBpbnB1dCA9ICQodGhpcy5kYXRldGltZShvcHRpb25zKSkuYXBwZW5kVG8oY29udGFpbmVyKTsKCQkJCQlpbnB1dC5kYXRldGltZWJveCgpOwoJCQkJCXJldHVybiBpbnB1dDsKCQkJCX0sCgkJCQlkZXN0cm95OiBmdW5jdGlvbih0YXJnZXQpIHsKCQkJCQkkKHRhcmdldCkucmVtb3ZlKCk7CgkJCQl9LAoJCQkJZ2V0VmFsdWU6IGZ1bmN0aW9uKHRhcmdldCkgewoJCQkJCXJldHVybiAkKHRhcmdldCkudmFsKCk7CgkJCQl9LAoJCQkJc2V0VmFsdWU6IGZ1bmN0aW9uKHRhcmdldCwgdmFsdWUpIHsKCQkJCQkkKHRhcmdldCkudmFsKHZhbHVlKTsKCQkJCX0sCgkJCQlyZXNpemU6IGZ1bmN0aW9uKHRhcmdldCwgd2lkdGgpIHsKCQkJCQkkKHRhcmdldCkuX291dGVyV2lkdGgod2lkdGgpOwoJCQkJfQoJCQl9LAoJCQljaGVja2JveDogewoJCQkJaW5pdDogZnVuY3Rpb24oY29udGFpbmVyLCBvcHRpb25zKSB7CgkJCQkJdmFyIGlucHV0ID0gJCh0aGlzLmJvb2wob3B0aW9ucykpLmFwcGVuZFRvKGNvbnRhaW5lcik7CgkJCQkJaW5wdXQuc3dpdGNoYnV0dG9uKCk7CgkJCQkJcmV0dXJuIGlucHV0OwoJCQkJfSwKCQkJCWRlc3Ryb3k6IGZ1bmN0aW9uKHRhcmdldCkgewoJCQkJCSQodGFyZ2V0KS5yZW1vdmUoKTsKCQkJCX0sCgkJCQlnZXRWYWx1ZTogZnVuY3Rpb24odGFyZ2V0KSB7CgkJCQkJcmV0dXJuICQodGFyZ2V0KS52YWwoKTsKCQkJCX0sCgkJCQlzZXRWYWx1ZTogZnVuY3Rpb24odGFyZ2V0LCB2YWx1ZSkgewoJCQkJCSQodGFyZ2V0KS52YWwodmFsdWUpOwoJCQkJfSwKCQkJCXJlc2l6ZTogZnVuY3Rpb24odGFyZ2V0LCB3aWR0aCkgewoJCQkJCSQodGFyZ2V0KS5fb3V0ZXJXaWR0aCh3aWR0aCk7CgkJCQl9CgkJCX0sCgkJCWNvbWJvdHJlZWdyaWQ6IHNlbGVjdCwKCQkJc2VsZWN0OiBzZWxlY3QsCgkJfSk7Cgl9CgoJYXNrKHF1ZXN0aW9uLCBmQW5zd2VyID0gdiA9PiB2LCBvcHRpb25zKSB7CgkJJC5tZXNzYWdlci5jb25maXJtKHRoaXMudGl0bGUsIHF1ZXN0aW9uLCBmdW5jdGlvbihyKSB7CgkJCWlmIChvcHRpb25zKSB7CgkJCQlmb3IgKHZhciBpID0gMDsgaSA8IG9wdGlvbnMubGVuZ3RoOyBpKyspIHsKCQkJCQlpZiAob3B0aW9uc1tpXS5hbnN3ZXIgPT0gcikgewoJCQkJCQlyZXR1cm4gZkFuc3dlcihvcHRpb25zW2ldLnZhbHVlKTsKCQkJCQl9CgkJCQl9CgkJCX0gZWxzZSB7CgkJCQlyZXR1cm4gZkFuc3dlcihyKTsKCQkJfQoJCX0pOwoJfQoKCXRvcERhdGEoYXIsIGdGaWVsZCwgdkZpZWxkLCB0b3ApIHsKCQlpZiAoIXRvcCkgewoJCQlyZXR1cm4gYXI7CgkJfQoJCXJldCA9IFtdOwoJCSQuZWFjaCh0aGlzLnNyKCkuZ3JvdXBCeShhciwgZ0ZpZWxkKSwgZnVuY3Rpb24oa2V5LCB2YWx1ZXMpIHsKCQkJdmFsdWVzLnZhbHVlcy5zb3J0KChhLCBiKSA9PiB7CgkJCQlpZiAocGFyc2VGbG9hdChhW3ZGaWVsZF0pIDwgcGFyc2VGbG9hdChiW3ZGaWVsZF0pKSB7CgkJCQkJcmV0dXJuIDE7CgkJCQl9IGVsc2UgaWYgKHBhcnNlRmxvYXQoYVt2RmllbGRdKSA+IHBhcnNlRmxvYXQoYlt2RmllbGRdKSkgewoJCQkJCXJldHVybiAtMTsKCQkJCX0gZWxzZSB7CgkJCQkJcmV0dXJuIDA7CgkJCQl9CgkJCX0pOwoJCQkkLmVhY2godmFsdWVzLnZhbHVlcywgZnVuY3Rpb24oaSwgdikgewoJCQkJaWYgKGkgPCB0b3ApIHsKCQkJCQlyZXQucHVzaCh2KTsKCQkJCX0KCQkJfSk7CgkJfSk7CgkJcmV0dXJuIHJldDsKCX0KCglhc3luYyBDUlVEKHNUYWJsZSwgYkZpeGVkKSB7CgkJdmFyIGZpZWxkcyA9IFtdOwoJCXRoaXMuc1RhYmxlID0gc1RhYmxlOwoJCWlmIChjb21wYW55LmxpYnJhcnkpIHsKCQkJdmFyIHJldCA9IGF3YWl0IHRoaXMuc3IoKS5fKCJDb250ZW50TWFuYWdlci5jbXNHZW5lcmF0ZUxheWVyQ2xhc3MiLCBudWxsLCBjb21wYW55LmxpYnJhcnkgKyAiLiIgKyBzVGFibGUpOwoJCQlmaWVsZHMucHVzaCh7CgkJCQlncm91cDogIk1haW4iLAoJCQkJYXR0cmlidXRlOiB7CgkJCQkJUmVsYXRpb25DbGFzczogewoJCQkJCQlOYW1lOiBzVGFibGUKCQkJCQl9CgkJCQl9LAoJCQkJbmFtZTogdGhpcy5zVGFibGUsCgkJCQl0eXBlOiAnc2VsZWN0JywKCQkJCXNlbGVjdDogZnVuY3Rpb24obykgewoJCQkJCXRoaXMuc2V0KG8pOwoJCQkJfQoJCQl9KTsKCQkJZm9yICh2YXIgaSA9IDA7IGkgPCByZXQuTGF5ZXJBdHRyaWJ1dGVzLmxlbmd0aDsgaSsrKSB7CgkJCQlpZiAocmV0LkxheWVyQXR0cmlidXRlc1tpXS5OYW1lID09ICJJZCIpIGNvbnRpbnVlOwoJCQkJZmllbGRzLnB1c2goewoJCQkJCWdyb3VwOiAiTWFpbiIsCgkJCQkJbmFtZTogcmV0LkxheWVyQXR0cmlidXRlc1tpXS5OYW1lLAoJCQkJCXR5cGU6IHJldC5MYXllckF0dHJpYnV0ZXNbaV0uTmF0aXZlVHlwZQoJCQkJfSk7CgkJCX0KCQkJZm9yIChpID0gMDsgaSA8IHJldC5SZWxhdGlvbkF0dHJpYnV0ZXMubGVuZ3RoOyBpKyspIHsKCQkJCXZhciBtID0gcmV0LlJlbGF0aW9uQXR0cmlidXRlc1tpXS5Jc0FycmF5OwoJCQkJdmFyIHJDb2xzID0gW107CgkJCQlmb3IgKHZhciBwIGluIHJldC5SZWxhdGlvbkF0dHJpYnV0ZXNbaV0uUmVsYXRpb25DbGFzcykgewoJCQkJCWlmICgkLmluQXJyYXkocCwgWyJUb1N0cmluZyIsICJfVG9TdHJpbmciLCAiX19ST1dJRCIsICJfX0xPQURFRCIsICJJZCJdKSA+IC0xKSBjb250aW51ZTsKCQkJCQlyQ29scy5wdXNoKHsKCQkJCQkJZmllbGQ6IHAsCgkJCQkJCXRpdGxlOiBwCgkJCQkJfSk7CgkJCQl9CgkJCQlmaWVsZHMucHVzaCh7CgkJCQkJZ3JvdXA6IChtID8gIk90aGVyIiA6ICJSZWxhdGlvbnMiKSwKCQkJCQlDbGFzczogcmV0LlJlbGF0aW9uQXR0cmlidXRlc1tpXS5SZWxhdGlvbkNsYXNzLAoJCQkJCW5hbWU6IHJldC5SZWxhdGlvbkF0dHJpYnV0ZXNbaV0uTmFtZSwKCQkJCQl0eXBlOiAnc2VsZWN0JywKCQkJCQltdWx0aXBsZTogbSwKCQkJCQlzb3VyY2U6IGZ1bmN0aW9uKG8sIGZEYXRhKSB7CgkJCQkJCXJldHVybiBvOwoJCQkJCX0sCgkJCQkJY29sdW1uczogckNvbHMKCQkJCX0pOwoJCQl9CgkJfSBlbHNlIHsKCQkJLy8gZW1zCgkJCXZhciBlYyA9IChjb21wYW55LlNjb3BlID8gd2luZG93W2NvbXBhbnkuU2NvcGVdIDogd2luZG93KS5FbnRpdHlDbGFzc2VzLmZpbmQoYyA9PiBjLk5hbWUucmVwbGFjZSgnICcsICdfJykgPT0gc1RhYmxlKTsKCQkJZmllbGRzLnB1c2goewoJCQkJbmFtZTogc1RhYmxlLAoJCQkJdGl0bGU6IGVjLk5hbWUsCgkJCQlDbGFzczogewoJCQkJCU5hbWU6IGVjLk5hbWUsCgkJCQkJSWQ6IGVjLklkCgkJCQl9LAoJCQkJdHlwZTogJ3NlbGVjdCcsCgkJCQlzZWxlY3Q6IGZ1bmN0aW9uKG8pIHsKCQkJCQl0aGlzLmNsZWFyKCk7CgkJCQkJdGhpcy5zZXQobyk7CgkJCQl9CgkJCX0pOwoJCQkkLmVhY2goZWMuRW50aXR5QXR0cmlidXRlcywgKF8sIGVhKSA9PiB7CgkJCQlpZiAoIWVhLkVudGl0eVR5cGUpIHsKCQkJCQl2YXIgdHlwZSA9ICJzdHJpbmciOwoJCQkJCWlmIChlYS5Jc0Jvb2wpIHR5cGUgPSAiYm9vbCI7CgkJCQkJaWYgKGVhLklzRGF0ZSkgdHlwZSA9ICJkYXRldGltZSI7CgkJCQkJaWYgKGVhLklzKSB0eXBlID0gImRhdGV0aW1lIjsKCQkJCQlpZiAoZWEuSXNUZXh0KSB0eXBlID0gInRleHQiOwoJCQkJCWZpZWxkcy5wdXNoKHsKCQkJCQkJZ3JvdXA6IGVhLkdyb3VwLk5hbWUsCgkJCQkJCW5hbWU6IGVhLk5hbWUsCgkJCQkJCXR5cGU6IHR5cGUKCQkJCQl9KTsKCQkJCX0gZWxzZSB7CgkJCQkJZmllbGRzLnB1c2goewoJCQkJCQlncm91cDogZWEuR3JvdXAuTmFtZSwKCQkJCQkJbmFtZTogZWEuTmFtZSwKCQkJCQkJQ2xhc3M6IHsKCQkJCQkJCU5hbWU6IGVhLkVudGl0eVR5cGUuTmFtZSwKCQkJCQkJCUlkOiBlYS5FbnRpdHlUeXBlLklkCgkJCQkJCX0sCgkJCQkJCXNvdXJjZTogZnVuY3Rpb24obywgZkRhdGEpIHsKCQkJCQkJCXJldHVybiBvOwoJCQkJCQl9LAoJCQkJCQl0eXBlOiAic2VsZWN0IgoJCQkJCX0pOwoJCQkJfQoJCQl9KTsKCQl9CgkJcmV0dXJuIHsKCQkJZm9ybTogdGhpcy5kRm9ybS5yZW5kZXIoc1RhYmxlLCB0aGlzLmVuZ2xpc2goc1RhYmxlKSwgZmllbGRzLCBbewoJCQkJbmFtZTogJ1Jlc2V0JywKCQkJCW9uY2xpY2s6IGZ1bmN0aW9uKG8pIHsKCQkJCQl0aGlzLmJ1c3koZmFsc2UpOwoJCQkJCXRoaXMuY2xlYXIoKTsKCQkJCX0sCgkJCQlpY29uOiAiY2FuY2VsIgoJCQl9LCB7CgkJCQluYW1lOiAnU2F2ZScsCgkJCQlvbmNsaWNrOiBmdW5jdGlvbihvKSB7CgkJCQkJaWYgKG9bdGhpcy5zVGFibGVdICYmIG9bdGhpcy5zVGFibGVdLklkKSBvLklkID0gb1t0aGlzLnNUYWJsZV0uSWQ7CgkJCQkJZGVsZXRlIG9bdGhpcy5zVGFibGVdOwoJCQkJCWlmIChjb21wYW55LmxpYnJhcnkpIHsKCQkJCQkJdGhpcy5zcigpLl8oY29tcGFueS5Db2RlLnRvTG93ZXJDYXNlKCkgKyAiIiArIHRoaXMuc1RhYmxlICsgKG8uSWQgPyAiVXBkYXRlIiA6ICJJbnNlcnQiKSwgZnVuY3Rpb24ocmV0KSB7CgkJCQkJCQlpZiAocmV0KSB7CgkJCQkJCQkJdGhpcy5pbmZvKHRoaXMuc1RhYmxlICsgIiBTYXZlZCIpOwoJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQl0aGlzLmVycm9yKCJVbmFibGUgdG8gc2F2ZSAiICsgdGhpcy5zVGFibGUpOwoJCQkJCQkJfQoJCQkJCQkJdGhpcy5idXN5KGZhbHNlKTsKCQkJCQkJfSwgbyk7CgkJCQkJfSBlbHNlIHsKCQkJCQkJdGhpcy5zcigpLl8oImVtc0VudGl0eU9iamVjdCIgKyAoby5JZCA/ICJVcGRhdGUiIDogIkluc2VydCIpLCBmdW5jdGlvbihyZXQpIHsKCQkJCQkJCWlmIChyZXQpIHsKCQkJCQkJCQl0aGlzLmluZm8odGhpcy5zVGFibGUgKyAiIFNhdmVkIik7CgkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCXRoaXMuZXJyb3IoIlVuYWJsZSB0byBzYXZlICIgKyB0aGlzLnNUYWJsZSk7CgkJCQkJCQl9CgkJCQkJCQl0aGlzLmJ1c3koZmFsc2UpOwoJCQkJCQl9LCBvLnRvRW50aXR5T2JqZWN0KCkpOwoJCQkJCX0KCQkJCX0KCQkJfV0sIGJGaXhlZCkKCQl9OwoJfQoKCWFzeW5jIGRvQ2xpY2soYnV0dG9uKSB7CgkJYnV0dG9uID0gdGhpcy5idXR0b25zLmZpbmQoYiA9PiBiLm5hbWUgPT0gYnV0dG9uLm5hbWUgJiYgYi5ncm91cCA9PSBidXR0b24uZ3JvdXApOwoJCXRoaXMuYnVzeSh0cnVlKTsKCQl2YXIgbyA9IHRoaXMuZ2V0KCk7CgkJdmFyIHNNaXNzaW5nID0gdGhpcy5lbGVtZW50cy5maWx0ZXIoZSA9PiAoYnV0dG9uLndpbmRvdyA/IGJ1dHRvbi5ncm91cCA9PSBlLmdyb3VwIDogdHJ1ZSkpLmZpbHRlcihlID0+IGUucmVxdWlyZWQgJiYgIW9bZS5uYW1lXSkubWFwKGUgPT4gIjxsaT4iICsgKGUubGFiZWwgfHwgZS5uYW1lKSArICI8L2xpPiIpLmpvaW4oIiIpOwoJCWlmIChzTWlzc2luZykgewoJCQl3aW5kb3cuX0ZyRU1ELl9lcnJvcigiTWlzc2luZyBtYW5kYXRvcnkgZmllbGRzOjxici8+PHVsPiIgKyBzTWlzc2luZyArICI8L3VsPiIsIDUwMDApOwoJCQl0aGlzLmJ1c3koZmFsc2UpOwoJCQlyZXR1cm47CgkJfQoJCWlmIChidXR0b24ub25jbGljaykgYXdhaXQgYnV0dG9uLm9uY2xpY2sobyk7CgkJaWYgKGJ1dHRvbi5vbkNsaWNrKSBhd2FpdCBidXR0b24ub25DbGljayhvKTsKCQl0aGlzLmJ1c3koZmFsc2UpOwoJfQoKCWJ1c3koYkJ1c3kpIHsKCQlpZiAoIWJCdXN5KSB7CgkJCXZhciB0b3RhbCA9IDA7CgkJCWlmICh0eXBlb2YgbW9tZW50ICE9PSAndW5kZWZpbmVkJykgewoJCQkJdG90YWwgPSBtb21lbnQoKS5kaWZmKG1vbWVudCh0aGlzLmJ1c3lTdGFtcCksICdzZWNvbmRzJyk7CgkJCX0gZWxzZSB7CgkJCQkvLyBubyBtb21lbnQsIHVzZSBzdGFuZGFyZCBEYXRlCgkJCQl0b3RhbCA9IChuZXcgRGF0ZSgpLmdldFRpbWUoKSAtIHRoaXMuYnVzeVN0YW1wID8gdGhpcy5idXN5U3RhbXAuZ2V0VGltZSgpIDogMCkgLyAxMDAwIC8gMzYwMDsKCQkJfQoJCQlpZiAodGhpcy5iRGVidWcpIHsKCQkJCXdpbmRvdy5fRnJFTUQuX2FsZXJ0KCJFeGVjdXRpb24gVGltZTogIiArIHRvdGFsICsgIiBzZWNvbmRzLiIpOwoJCQl9CgkJCWRlbGV0ZSB0aGlzLmJ1c3lTdGFtcDsKCQl9IGVsc2UgewoJCQl0aGlzLmJ1c3lTdGFtcCA9IG5ldyBEYXRlKCk7CgkJfQoKCQkkLmVhY2goJC5tZXJnZSgkLm1hcCh0aGlzLmJ1dHRvbnMsIGIgPT4gYi5uYW1lKSwgJC5tYXAodGhpcy5lbGVtZW50cy5maWx0ZXIoZSA9PiBlLnR5cGUgPT0gJ2xpbmsnKSwgZSA9PiBlLm5hbWUpKSwgKF8sIGUpID0+ICQoJyMnICsgZSkubGlua2J1dHRvbihiQnVzeSA/ICdkaXNhYmxlJyA6ICdlbmFibGUnKSk7Cgl9CgoJcHJlZml4KGUpIHsKCQlzd2l0Y2ggKGUudHlwZSkgewoJCQljYXNlICdsYWJlbCc6CgkJCQlyZXR1cm4gJ2xibCc7CgkJCWNhc2UgJ3RleHQnOgoJCQljYXNlICdzdHJpbmcnOgoJCQljYXNlICdzZWFyY2gnOgoJCQljYXNlICdwYXNzd29yZCc6CgkJCQlyZXR1cm4gJ3R4dCc7CgkJCWNhc2UgIkRhdGVUaW1lIjoKCQkJY2FzZSAiZGF0ZXRpbWUiOgoJCQkJcmV0dXJuICdkdHAnOwoJCQljYXNlICJpbnQiOgoJCQljYXNlICJpbnRlZ2VyIjoKCQkJY2FzZSAibnVtYmVyIjoKCQkJY2FzZSAibG9uZyI6CgkJCWNhc2UgIkxvbmciOgoJCQkJcmV0dXJuICdudWQnOwoJCQljYXNlICdmaWxlJzoKCQkJCXJldHVybiAnZmlsJzsKCQkJY2FzZSAnaW1hZ2UnOgoJCQkJcmV0dXJuICdpbWcnOwoJCQljYXNlICJib29sIjoKCQkJCXJldHVybiAnY2hrJzsKCQkJY2FzZSAid2luZG93IjoKCQkJCXJldHVybiAncG5sJzsKCQkJY2FzZSAicHJvZ3Jlc3MiOgoJCQkJcmV0dXJuICdwcmcnOwoJCQljYXNlICJncmlkIjoKCQkJY2FzZSAidHJlZSI6CgkJCWNhc2UgInNlbGVjdCI6CgkJCQlyZXR1cm4gJ2NtYic7CgkJCWRlZmF1bHQ6CgkJCQlyZXR1cm4gJyc7CgkJfQoJfQoKCWNsZWFyKGdyb3VwKSB7CgkJdmFyIG8gPSB7fTsKCQkkLmVhY2godGhpcy5lbGVtZW50cy5maWx0ZXIoZSA9PiBncm91cCA/IGUuZ3JvdXAgPT0gZ3JvdXAgOiB0cnVlKSwgKF8sIGUpID0+IHsKCQkJdmFyIG5hbWUgPSAoZS5lbXNTb3VyY2UgPyAiXyIgOiAiIikgKyBlLm5hbWU7CgkJCXN3aXRjaCAoZS50eXBlKSB7CgkJCQljYXNlICd0ZXh0JzoKCQkJCWNhc2UgJ3N0cmluZyc6CgkJCQljYXNlICdzZWFyY2gnOgoJCQkJY2FzZSAncGFzc3dvcmQnOgoJCQkJY2FzZSAiRGF0ZVRpbWUiOgoJCQkJY2FzZSAiZGF0ZXRpbWUiOgoJCQkJCW9bbmFtZV0gPSAiIjsKCQkJCQlicmVhazsKCQkJCWNhc2UgImludCI6CgkJCQljYXNlICJudW1iZXIiOgoJCQkJY2FzZSAiaW50ZWdlciI6CgkJCQljYXNlICJsb25nIjoKCQkJCWNhc2UgIkxvbmciOgoJCQkJY2FzZSAicHJvZ3Jlc3MiOgoJCQkJCW9bbmFtZV0gPSAwOwoJCQkJCWJyZWFrOwoJCQkJY2FzZSAidHJlZSI6CgkJCQljYXNlICJzZWxlY3QiOgoJCQkJCW9bbmFtZV0gPSBudWxsOwoJCQkJCWJyZWFrOwoJCQkJY2FzZSAiZ3JpZCI6CgkJCQkJb1tuYW1lXSA/IG9bbmFtZV0uZGF0YSA9IFtdIDogbnVsbDsKCQkJCQlicmVhazsKCQkJCWNhc2UgImJvb2wiOgoJCQkJCW9bbmFtZV0gPSBmYWxzZTsKCQkJCQlicmVhazsKCQkJCWRlZmF1bHQ6CgkJCQkJYnJlYWs7CgkJCX0KCQl9KTsKCQkvL2NvbnNvbGUubG9nKCJjbGVhciIsIG8pOwoJCXRoaXMuc2V0KG8pOwoJCXRoaXMuYnVzeShmYWxzZSk7Cgl9CgoJc2V0KG8sIGVOYW1lKSB7CgkJaWYgKGVOYW1lKSB7CgkJCXZhciBvRWxlbWVudCA9IHRoaXMuYnlOYW1lKGVOYW1lKTsKCQkJaWYgKCFvRWxlbWVudCkgcmV0dXJuOwoJCQl2YXIgYXR0ID0gbnVsbDsKCQkJaWYgKG8gJiYgby5JZCAmJiBvLkVudGl0eUF0dHJpYnV0ZSkgewoJCQkJLy8gYW4gRW50aXR5VmFsdWUKCQkJCWZvciAodmFyIHAgaW4gbykKCQkJCQlpZiAocC5lbmRzV2l0aCgiVmFsdWUiKSkgYXR0ID0gcDsKCQkJCW9FbGVtZW50LmVtc1NvdXJjZSA9IG87CgkJCX0KCQkJdHJ5IHsKCQkJCXN3aXRjaCAob0VsZW1lbnQudHlwZSkgewoJCQkJCWNhc2UgJ2xhYmVsJzoKCQkJCQkJaWYgKGF0dCkgewoJCQkJCQkJJCgiIyIgKyB0aGlzLnByZWZpeChvRWxlbWVudCkgKyBvRWxlbWVudC5uYW1lKS5odG1sKG9bYXR0XSk7CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQkkKCIjIiArIHRoaXMucHJlZml4KG9FbGVtZW50KSArIG9FbGVtZW50Lm5hbWUpLmh0bWwoKG8gJiYgby5FbnRpdHlBdHRyaWJ1dGUpID8gIiIgOiBvKTsKCQkJCQkJfQoJCQkJCQlicmVhazsKCQkJCQljYXNlICd0ZXh0JzoKCQkJCQljYXNlICdzdHJpbmcnOgoJCQkJCWNhc2UgJ3Bhc3N3b3JkJzoKCQkJCQljYXNlICJpbnQiOgoJCQkJCWNhc2UgInNlYXJjaCI6CgkJCQkJY2FzZSAiaW50ZWdlciI6CgkJCQkJY2FzZSAibnVtYmVyIjoKCQkJCQljYXNlICJsb25nIjoKCQkJCQljYXNlICJMb25nIjoKCQkJCQkJaWYgKGF0dCkgewoJCQkJCQkJJCgiIyIgKyB0aGlzLnByZWZpeChvRWxlbWVudCkgKyBvRWxlbWVudC5uYW1lKVt0aGlzLnVpVHlwZXNbb0VsZW1lbnQudHlwZV1dKCJzZXRWYWx1ZSIsIG9bYXR0XSk7CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQkkKCIjIiArIHRoaXMucHJlZml4KG9FbGVtZW50KSArIG9FbGVtZW50Lm5hbWUpW3RoaXMudWlUeXBlc1tvRWxlbWVudC50eXBlXV0oInNldFZhbHVlIiwgKG8gJiYgby5FbnRpdHlBdHRyaWJ1dGUpID8gIiIgOiBvKTsKCQkJCQkJfQoJCQkJCQlicmVhazsKCQkJCQljYXNlICJEYXRlVGltZSI6CgkJCQkJY2FzZSAiZGF0ZXRpbWUiOgoJCQkJCQlpZiAoYXR0KSB7CgkJCQkJCQkkKCIjIiArIHRoaXMucHJlZml4KG9FbGVtZW50KSArIG9FbGVtZW50Lm5hbWUpW3RoaXMudWlUeXBlc1tvRWxlbWVudC50eXBlXV0oJ3NldFZhbHVlJywgKG9bYXR0XSA/IHRoaXMuc3IoKS50b0RhdGVUaW1lKG9bYXR0XSkgOiAiIikpOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJJCgiIyIgKyB0aGlzLnByZWZpeChvRWxlbWVudCkgKyBvRWxlbWVudC5uYW1lKVt0aGlzLnVpVHlwZXNbb0VsZW1lbnQudHlwZV1dKCdzZXRWYWx1ZScsIChvICYmIG8uRW50aXR5QXR0cmlidXRlKSA/ICIiIDogKG8gPyB0aGlzLnNyKCkudG9EYXRlVGltZShvKSA6ICIiKSk7CgkJCQkJCX0KCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAiYm9vbCI6CgkJCQkJCWlmIChhdHQpIHsKCQkJCQkJCSQoIiMiICsgdGhpcy5wcmVmaXgob0VsZW1lbnQpICsgb0VsZW1lbnQubmFtZSlbdGhpcy51aVR5cGVzW29FbGVtZW50LnR5cGVdXSgob1thdHRdID8gJycgOiAndW4nKSArICdjaGVjaycpOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJJCgiIyIgKyB0aGlzLnByZWZpeChvRWxlbWVudCkgKyBvRWxlbWVudC5uYW1lKVt0aGlzLnVpVHlwZXNbb0VsZW1lbnQudHlwZV1dKCgoKG8gJiYgby5FbnRpdHlBdHRyaWJ1dGUpID8gIiIgOiBvKSA/ICcnIDogJ3VuJykgKyAnY2hlY2snKTsKCQkJCQkJfQoJCQkJCQlicmVhazsKCQkJCQljYXNlICJ3aW5kb3ciOgoJCQkJCQlpZiAoYXR0KSB7CgkJCQkJCQlvRWxlbWVudC52YWx1ZSA9IG9bYXR0XTsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCW9FbGVtZW50LnZhbHVlID0gKG8gJiYgby5FbnRpdHlBdHRyaWJ1dGUpID8gIiIgOiBvOwoJCQkJCQl9CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgInByb2dyZXNzIjoKCQkJCQkJdmFyIHYgPSAwOwoJCQkJCQlpZiAoYXR0KSB7CgkJCQkJCQl2ID0gb1thdHRdOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJdiA9IChvICYmIG8uRW50aXR5QXR0cmlidXRlKSA/ICIiIDogbzsKCQkJCQkJfQoJCQkJCQkkKCIjIiArIHRoaXMucHJlZml4KG9FbGVtZW50KSArIG9FbGVtZW50Lm5hbWUpW3RoaXMudWlUeXBlc1tvRWxlbWVudC50eXBlXV0oJ3NldFZhbHVlJywgTWF0aC5yb3VuZCh2ICogMTApIC8gMTApOwoJCQkJCQlicmVhazsKCQkJCQljYXNlICJncmlkIjoKCQkJCQkJbGV0IGNvbHMgPSBKU09OLnBhcnNlKCJ7IiArIHRoaXMubWFwQ29sdW1ucyhvRWxlbWVudCwgdHJ1ZSkgKyAifSIpOwoJCQkJCQkkLmVhY2goY29scy5jb2x1bW5zWzBdLCAoXywgYykgPT4gYy5mb3JtYXR0ZXIgPSB0aGlzLnNyKCkucnVuU2NyaXB0KHRoaXMuZm9ybWF0dGVyKG9FbGVtZW50Lm5hbWUsIGMpKSk7CgkJCQkJCSQoIiMiICsgdGhpcy5wcmVmaXgob0VsZW1lbnQpICsgb0VsZW1lbnQubmFtZSkuZGF0YWdyaWQoY29scyk7CgkJCQkJCWlmIChhdHQpIHsKCQkJCQkJCSQoIiMiICsgdGhpcy5wcmVmaXgob0VsZW1lbnQpICsgb0VsZW1lbnQubmFtZSkuZGF0YWdyaWQoewoJCQkJCQkJCWRhdGE6IG9bYXR0XQoJCQkJCQkJfSk7CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQkkKCIjIiArIHRoaXMucHJlZml4KG9FbGVtZW50KSArIG9FbGVtZW50Lm5hbWUpLmRhdGFncmlkKHsKCQkJCQkJCQlkYXRhOiAobyAmJiBvLkVudGl0eUF0dHJpYnV0ZSkgPyAiIiA6IG8KCQkJCQkJCX0pOwoJCQkJCQl9CgkJCQkJCSQoIiMiICsgdGhpcy5wcmVmaXgob0VsZW1lbnQpICsgb0VsZW1lbnQubmFtZSkuZGF0YWdyaWQoInVuc2VsZWN0QWxsIik7CgkJCQkJCSQoIiMiICsgdGhpcy5wcmVmaXgob0VsZW1lbnQpICsgb0VsZW1lbnQubmFtZSkuZGF0YWdyaWQoKTsKCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAidHJlZSI6CgkJCQkJCXZhciB2ID0gYXR0ID8gb1thdHRdIDogKChvICYmIG8uRW50aXR5QXR0cmlidXRlKSA/ICIiIDogbyk7CgkJCQkJCWlmIChBcnJheS5pc0FycmF5KHYpKSB7CgkJCQkJCQkkKCIjIiArIHRoaXMucHJlZml4KG9FbGVtZW50KSArIG9FbGVtZW50Lm5hbWUpW3RoaXMudWlUeXBlc1tvRWxlbWVudC50eXBlXV0oInRyZWUiKS50cmVlKCJsb2FkRGF0YSIsIHYpOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJJCgiIyIgKyB0aGlzLnByZWZpeChvRWxlbWVudCkgKyBvRWxlbWVudC5uYW1lKVt0aGlzLnVpVHlwZXNbb0VsZW1lbnQudHlwZV1dKCdzZXRWYWx1ZScsIHYpOwoJCQkJCQl9CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgInNlbGVjdCI6CgkJCQkJCWlmIChhdHQpIHsKCQkJCQkJCWlmIChvRWxlbWVudC5vcHRpb25zKSB7CgkJCQkJCQkJJCgiIyIgKyB0aGlzLnByZWZpeChvRWxlbWVudCkgKyBvRWxlbWVudC5uYW1lKS5jb21ibygnc2V0VmFsdWUnICsgKG9FbGVtZW50Lm11bHRpcGxlID8gJ3MnIDogJycpLCAob1thdHRdID8gb1thdHRdIDogIiIpKTsKCQkJCQkJCQkkKCIjIiArIHRoaXMucHJlZml4KG9FbGVtZW50KSArIG9FbGVtZW50Lm5hbWUpLmNvbWJvKCdzZXRWYWx1ZScgKyAob0VsZW1lbnQubXVsdGlwbGUgPyAncycgOiAnJyksIChvW2F0dF0gPyBvW2F0dF0gOiAiIikpOwoJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQkkKCIjIiArIHRoaXMucHJlZml4KG9FbGVtZW50KSArIG9FbGVtZW50Lm5hbWUpLmNvbWJvZ3JpZCgnc2V0VmFsdWUnICsgKG9FbGVtZW50Lm11bHRpcGxlID8gJ3MnIDogJycpLCAob1thdHRdID8gb1thdHRdIDogIiIpKTsKCQkJCQkJCX0KCQkJCQkJfSBlbHNlIHsKCQkJCQkJCXYgPSBudWxsOwoJCQkJCQkJaWYgKG8gPT09IG51bGwpIHsKCgkJCQkJCQl9IGVsc2UgaWYgKG8uY29uc3RydWN0b3IgPT09IEFycmF5KSB7CgoJCQkJCQkJfSBlbHNlIGlmICghby5FbnRpdHlBdHRyaWJ1dGUpIHsKCQkJCQkJCQl2ID0gbyB8fCB7CgkJCQkJCQkJCUlkOiBvLklkLAoJCQkJCQkJCQlfVG9TdHJpbmc6IG8uX1RvU3RyaW5nLAoJCQkJCQkJCQl0b1N0cmluZzogZnVuY3Rpb24oKSB7CgkJCQkJCQkJCQlyZXR1cm4gdGhpcy5fVG9TdHJpbmc7CgkJCQkJCQkJCX0KCQkJCQkJCQl9OwoJCQkJCQkJfQoJCQkJCQkJaWYgKG9FbGVtZW50Lm9wdGlvbnMpIHsKCQkJCQkJCQkkKCIjIiArIHRoaXMucHJlZml4KG9FbGVtZW50KSArIG9FbGVtZW50Lm5hbWUpLmNvbWJvKCdzZXRWYWx1ZScgKyAob0VsZW1lbnQubXVsdGlwbGUgPyAncycgOiAnJyksIHYpOwoJCQkJCQkJCSQoIiMiICsgdGhpcy5wcmVmaXgob0VsZW1lbnQpICsgb0VsZW1lbnQubmFtZSkuY29tYm8oJ3NldFRleHQnICsgKG9FbGVtZW50Lm11bHRpcGxlID8gJ3MnIDogJycpLCB2KTsKCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJJCgiIyIgKyB0aGlzLnByZWZpeChvRWxlbWVudCkgKyBvRWxlbWVudC5uYW1lKS5jb21ib2dyaWQoJ3NldFZhbHVlJyArIChvRWxlbWVudC5tdWx0aXBsZSA/ICdzJyA6ICcnKSwgdik7CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQkJYnJlYWs7CgkJCQkJZGVmYXVsdDoKCQkJCQkJYnJlYWs7CgkJCQl9CgkJCX0gY2F0Y2ggKGV4KSB7CgkJCQljb25zb2xlLmxvZyhleCk7CgkJCX0KCQl9IGVsc2UgewoJCQlmb3IgKHZhciBwIGluIG8pIHsKCQkJCWlmIChwLmluZGV4T2YoJ18nKSA9PT0gMCkgcCA9IHAuc3Vic3RyaW5nKDEpOwoJCQkJdmFyIGUgPSB0aGlzLmJ5TmFtZShwKTsKCQkJCWlmICghZSB8fCAhZS5uYW1lKSBjb250aW51ZTsKCQkJCXZhciB2YWx1ZSA9IG9bcF07CgkJCQlpZiAoZS5uYW1lID09IHRoaXMuc1RhYmxlKSB7CgkJCQkJdmFsdWUgPSBvOwoJCQkJCXZhbHVlLkRhdGUgPSBuZXcgRGF0ZSgpOwoJCQkJfQoJCQkJaWYgKHAgPT0gIkVudGl0eVZhbHVlcyIpIHsKCQkJCQkvLyBhbiBlbXNGb3JtVmFsdWVzIHNvdXJjZQoJCQkJCS8vIGZpbmQgdGhlIEVudGl0eVZhbHVlIGZvciB0aGlzIGVsZW1lbnQgYW5kIHNldCBpdAoJCQkJCWZvciAodmFyIGogPSAwOyBqIDwgby5FbnRpdHlWYWx1ZXMubGVuZ3RoOyBqKyspIHsKCQkJCQkJaWYgKG8uRW50aXR5VmFsdWVzW2pdLkVudGl0eUF0dHJpYnV0ZS5OYW1lID09IGUubmFtZSkgewoJCQkJCQkJLy8gZm91bmQgdGhlIEVudGl0eVZhbHVlIGZvciB0aGlzIGVsZW1lbnQKCQkJCQkJCV92ID0gby5FbnRpdHlWYWx1ZXNbal07CgkJCQkJCQlmb3IgKHZhciBxIGluIF92KSB7CgkJCQkJCQkJaWYgKHEuZW5kc1dpdGgoIlZhbHVlIikpIHsKCQkJCQkJCQkJX3ZbcV0gPSB2YWx1ZTsKCQkJCQkJCQl9CgkJCQkJCQl9CgkJCQkJCQlicmVhazsKCQkJCQkJfQoJCQkJCX0KCQkJCX0KCQkJCXRoaXMuc2V0KHZhbHVlLCBlLm5hbWUpOwoJCQl9CgkJfQoJfQoKCWdldCgpIHsKCQl2YXIgbyA9IHt9OwoJCWlmICh0aGlzLnNUYWJsZSAmJiB3aW5kb3dbdGhpcy5zVGFibGVdKSBvID0gbmV3IHdpbmRvd1t0aGlzLnNUYWJsZV0oKTsKCQlmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuZWxlbWVudHMubGVuZ3RoOyBpKyspIHsKCQkJdmFyIGNuID0gbnVsbDsKCQkJdmFyIHYgPSBudWxsOwoJCQl0cnkgewoJCQkJc3dpdGNoICh0aGlzLmVsZW1lbnRzW2ldLnR5cGUpIHsKCQkJCQljYXNlICdsYWJlbCc6CgkJCQkJCWNuID0gJCgiI2xibCIgKyB0aGlzLmVsZW1lbnRzW2ldLm5hbWUpOwoJCQkJCQl2ID0gY24uaHRtbCgpOwoJCQkJCQlicmVhazsKCQkJCQljYXNlICd0ZXh0JzoKCQkJCQljYXNlICdzdHJpbmcnOgoJCQkJCWNhc2UgJ3NlYXJjaCc6CgkJCQkJY2FzZSAncGFzc3dvcmQnOgoJCQkJCQljbiA9ICQoIiMiICsgdGhpcy5wcmVmaXgodGhpcy5lbGVtZW50c1tpXSkgKyB0aGlzLmVsZW1lbnRzW2ldLm5hbWUpOwoJCQkJCQl2ID0gY24udmFsKCk7CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgImZpbGUiOgoJCQkJCWNhc2UgImltYWdlIjoKCQkJCQkJY24gPSAkKCIjIiArIHRoaXMucHJlZml4KHRoaXMuZWxlbWVudHNbaV0pICsgdGhpcy5lbGVtZW50c1tpXS5uYW1lKTsKCQkJCQkJdiA9IHRoaXMuZWxlbWVudHNbaV0uZGF0YTsKCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAiRGF0ZVRpbWUiOgoJCQkJCWNhc2UgImRhdGV0aW1lIjoKCQkJCQkJdiA9IG5ldyBEYXRlKCQoIiMiICsgdGhpcy5wcmVmaXgodGhpcy5lbGVtZW50c1tpXSkgKyB0aGlzLmVsZW1lbnRzW2ldLm5hbWUpLmRhdGV0aW1lYm94KCdnZXRWYWx1ZScpKTsKCQkJCQkJY24gPSAkKCIjIiArIHRoaXMucHJlZml4KHRoaXMuZWxlbWVudHNbaV0pICsgdGhpcy5lbGVtZW50c1tpXS5uYW1lKTsKCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAicHJvZ3Jlc3MiOgoJCQkJCQljbiA9ICQoIiMiICsgdGhpcy5wcmVmaXgodGhpcy5lbGVtZW50c1tpXSkgKyB0aGlzLmVsZW1lbnRzW2ldLm5hbWUpOwoJCQkJCQl2ID0gY24ucHJvZ3Jlc3NiYXIoJ2dldFZhbHVlJyk7CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgImludCI6CgkJCQkJY2FzZSAiaW50ZWdlciI6CgkJCQkJY2FzZSAibnVtYmVyIjoKCQkJCQljYXNlICJsb25nIjoKCQkJCQljYXNlICJMb25nIjoKCQkJCQkJY24gPSAkKCIjIiArIHRoaXMucHJlZml4KHRoaXMuZWxlbWVudHNbaV0pICsgdGhpcy5lbGVtZW50c1tpXS5uYW1lKTsKCQkJCQkJdiA9IHBhcnNlRmxvYXQoY24udmFsKCkpOwoJCQkJCQlpZiAoaXNOYU4odikpIHYgPSAwOwoJCQkJCQlicmVhazsKCQkJCQljYXNlICJncmlkIjoKCQkJCQkJY24gPSAkKCIjIiArIHRoaXMucHJlZml4KHRoaXMuZWxlbWVudHNbaV0pICsgdGhpcy5lbGVtZW50c1tpXS5uYW1lKTsKCQkJCQkJdiA9IGNuLmRhdGFncmlkKCdnZXREYXRhJyk7CgkJCQkJCXYuc2VsZWN0ZWQgPSBjbi5kYXRhZ3JpZCgiZ2V0U2VsZWN0ZWQiKTsKCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAidHJlZSI6CgkJCQkJCWNuID0gJCgiIyIgKyB0aGlzLnByZWZpeCh0aGlzLmVsZW1lbnRzW2ldKSArIHRoaXMuZWxlbWVudHNbaV0ubmFtZSk7CgkJCQkJCXYgPSBjbi5jb21ib3RyZWUoInRyZWUiKS50cmVlKCJnZXRTZWxlY3RlZCIpOwoJCQkJCQlicmVhazsKCQkJCQljYXNlICJ3aW5kb3ciOgoJCQkJCQl2ID0gdGhpcy5lbGVtZW50c1tpXS52YWx1ZTsKCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAic2VsZWN0IjoKCQkJCQkJaWYgKHRoaXMuZWxlbWVudHNbaV0ub3B0aW9ucykgewoJCQkJCQkJdiA9ICQoIiMiICsgdGhpcy5wcmVmaXgodGhpcy5lbGVtZW50c1tpXSkgKyB0aGlzLmVsZW1lbnRzW2ldLm5hbWUpLmNvbWJvZ3JpZCgnZ2V0VmFsdWUnICsgKHRoaXMuZWxlbWVudHNbaV0ubXVsdGlwbGUgPyAncycgOiAnJykpOwoJCQkJCQkJdiA9IHRoaXMuc3IoKS5ydW5TY3JpcHQodik7CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQl2ID0gJCgiIyIgKyB0aGlzLnByZWZpeCh0aGlzLmVsZW1lbnRzW2ldKSArIHRoaXMuZWxlbWVudHNbaV0ubmFtZSkuY29tYm9ncmlkKCdncmlkJykuZGF0YWdyaWQoJ2dldFNlbGVjdGlvbnMnKTsKCQkJCQkJCWlmICghdiB8fCAhdi5sZW5ndGgpIHsKCQkJCQkJCQl2ID0gJCgiIyIgKyB0aGlzLnByZWZpeCh0aGlzLmVsZW1lbnRzW2ldKSArIHRoaXMuZWxlbWVudHNbaV0ubmFtZSkuY29tYm9ncmlkKCdnZXRWYWx1ZScgKyAodGhpcy5lbGVtZW50c1tpXS5tdWx0aXBsZSA/ICdzJyA6ICcnKSk7CgkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCWlmICghdGhpcy5lbGVtZW50c1tpXS5tdWx0aXBsZSkgdiA9IHZbMF07CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQkJY24gPSAkKCIjIiArIHRoaXMucHJlZml4KHRoaXMuZWxlbWVudHNbaV0pICsgdGhpcy5lbGVtZW50c1tpXS5uYW1lKTsKCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAiYm9vbCI6CgkJCQkJCWNuID0gJCgiIyIgKyB0aGlzLnByZWZpeCh0aGlzLmVsZW1lbnRzW2ldKSArIHRoaXMuZWxlbWVudHNbaV0ubmFtZSk7CgkJCQkJCXYgPSBjbi5zd2l0Y2hidXR0b24oJ29wdGlvbnMnKS5jaGVja2VkOwoJCQkJCQlicmVhazsKCQkJCQlkZWZhdWx0OgoJCQkJCQlicmVhazsKCQkJCX0KCQkJCW9bdGhpcy5lbGVtZW50c1tpXS5uYW1lXSh2KTsKCQkJfSBjYXRjaCAoZSkgewoJCQkJLy9jb25zb2xlLmxvZyh0aGlzLmVsZW1lbnRzW2ldLm5hbWUsIGUpOwoJCQkJb1t0aGlzLmVsZW1lbnRzW2ldLm5hbWVdID0gdjsKCQkJfQoJCQlpZiAoY24pIHsKCQkJCWlmIChvLkVudGl0eVZhbHVlcykgewoJCQkJCWZvciAodmFyIGogPSAwOyBqIDwgby5FbnRpdHlWYWx1ZXMubGVuZ3RoOyBqKyspIHsKCQkJCQkJaWYgKHRoaXMuZWxlbWVudHNbaV0ubmFtZSA9PSB0aGlzLnNUYWJsZSAmJiB0aGlzLmVsZW1lbnRzW2ldLmVtc1NvdXJjZSkgby5JZCA9IHRoaXMuZWxlbWVudHNbaV0uZW1zU291cmNlLklkOwoJCQkJCQlpZiAoby5FbnRpdHlWYWx1ZXNbal0uRW50aXR5QXR0cmlidXRlLk5hbWUgPT0gdGhpcy5lbGVtZW50c1tpXS5uYW1lICYmIHRoaXMuZWxlbWVudHNbaV0uZW1zU291cmNlKSB7CgkJCQkJCQlvLkVudGl0eVZhbHVlc1tqXS5JZCA9IHRoaXMuZWxlbWVudHNbaV0uZW1zU291cmNlLklkOwoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQl9CgkJfQoJCXJldHVybiBvOwoJfQoKCWNIZWlnaHQob3B0aW9ucykgewoJCWlmIChvcHRpb25zICYmIG9wdGlvbnMuZWRpdG9yKSByZXR1cm4gd2luZG93LmlubmVySGVpZ2h0OwoJCWlmIChvcHRpb25zICYmIG9wdGlvbnMuaGVpZ2h0ICYmIHR5cGVvZihvcHRpb25zLmhlaWdodCkgPT09ICdzdHJpbmcnKSByZXR1cm4gdGhpcy5oZWlnaHQ7CgkJaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy50eXBlID09ICd3aW5kb3cnICYmICFvcHRpb25zLmhlaWdodCkgcmV0dXJuIHRoaXMuaGVpZ2h0ICogMC45OwoJCXJldHVybiBNYXRoLmZsb29yKCgob3B0aW9ucyA/IG9wdGlvbnMuaGVpZ2h0IDogbnVsbCkgfHwgKHRoaXMuaGVpZ2h0IC8gMykpKTsKCX0KCglzZWFyY2gob3B0aW9ucykgewoJCXJldHVybiB0aGlzLnN0cmluZyhvcHRpb25zKTsKCX0KCglzdHJpbmcob3B0aW9ucykgewoJCW9wdGlvbnMuaGVpZ2h0ID0gMjA7CgkJb3B0aW9ucy5zaW1wbGUgPSB0cnVlOwoJCXJldHVybiB0aGlzLnRleHQob3B0aW9ucyk7Cgl9CgoJZGF0ZXRpbWUob3B0aW9ucykgewoJCXJldHVybiBgPGlucHV0IGlkPSJkdHAke29wdGlvbnMubmFtZX0iIGNsYXNzPSJlYXN5dWktJHt0aGlzLnVpVHlwZXNbb3B0aW9ucy50eXBlXX0iIHJlcXVpcmVkPSIke29wdGlvbnMucmVxdWlyZWQgPyAndHJ1ZScgOiAnZmFsc2UnfSIgdmFsdWU9IiR7dGhpcy52YWx1ZShvcHRpb25zKX0iIHN0eWxlPSJ3aWR0aDoke3RoaXMuY1dpZHRoKG9wdGlvbnMpfXB4Ij5gOwoJfQoKCXF1ZXJ5KG9wdGlvbnMpIHsKCQlyZXR1cm4gIjxkaXYgaWQ9J3ZzIiArIG9wdGlvbnMubmFtZSArICInPjwvZGl2PiI7Cgl9CgoJRGF0ZVRpbWUob3B0aW9ucykgewoJCXJldHVybiB0aGlzLmRhdGV0aW1lKG9wdGlvbnMpOwoJfQoKCWxvbmcob3B0aW9ucykgewoJCXJldHVybiB0aGlzLmludChvcHRpb25zKTsKCX0KCglMb25nKG9wdGlvbnMpIHsKCQlyZXR1cm4gdGhpcy5sb25nKG9wdGlvbnMpOwoJfQoKCXZhbHVlKG9wdGlvbnMpIHsKCQlpZiAodHlwZW9mIG9wdGlvbnMudmFsdWUgPT09ICdmdW5jdGlvbicpIHsKCQkJdHJ5IHsKCQkJCXJldHVybiBvcHRpb25zLnZhbHVlKHRoaXMuZ2V0KCkpOwoJCQl9IGNhdGNoIChleCkgewoJCQkJY29uc29sZS5sb2coYERGb3JtLnZhbHVlKCR7b3B0aW9ucy5uYW1lfSk6ICR7ZXh9YCk7CgkJCQlyZXR1cm4gJyc7CgkJCX0KCQl9IGVsc2UgewoJCQlzd2l0Y2ggKG9wdGlvbnMudHlwZSkgewoJCQkJY2FzZSAnaW50JzoKCQkJCWNhc2UgJ3Byb2dyZXNzJzoKCQkJCQlyZXR1cm4gb3B0aW9ucy52YWx1ZSB8fCBvcHRpb25zLm1pbiB8fCAwOwoJCQkJY2FzZSAnc3RyaW5nJzoKCQkJCWNhc2UgJ3RleHQnOgoJCQkJY2FzZSAnZGF0ZXRpbWUnOgoJCQkJY2FzZSAnbGFiZWwnOgoJCQkJCXJldHVybiBvcHRpb25zLnZhbHVlIHx8ICIiOwoJCQkJZGVmYXVsdDoKCQkJCQlyZXR1cm4gb3B0aW9ucy52YWx1ZTsKCQkJfQoJCX0KCX0KCglpbnQob3B0aW9ucykgewoJCWxldCByZXQgPSBgPGlucHV0IGlkPSJudWQke29wdGlvbnMubmFtZX0iIGNsYXNzPSJlYXN5dWktJHt0aGlzLnVpVHlwZXNbb3B0aW9ucy50eXBlXX0iIHJlcXVpcmVkPSIke29wdGlvbnMucmVxdWlyZWQgPyAndHJ1ZScgOiAnZmFsc2UnfSIgdmFsdWU9IiR7dGhpcy52YWx1ZShvcHRpb25zKX0iIGRhdGEtb3B0aW9ucz0ibWluOiR7b3B0aW9ucy5taW4gfHwgMH0sbWF4OiR7b3B0aW9ucy5tYXggfHwgMTAwfSxpbmNyZW1lbnQ6JHtvcHRpb25zLmluY3JlbWVudCB8fCAxfSIgc3R5bGU9IndpZHRoOiR7dGhpcy5jV2lkdGgob3B0aW9ucyl9cHg7Ij48L2lucHV0PmA7CgkJLy9jb25zb2xlLmxvZyhyZXQpOwoJCXJldHVybiByZXQ7Cgl9CgoJbWVudShvcHRpb25zKSB7CgkJdmFyIHJldCA9ICIiOwoJCXJldCArPSAnPGRpdiBjbGFzcz0iZWFzeXVpLXBhbmVsIiBpZD0ibW51JyArIG9wdGlvbnMubmFtZSArICciIHN0eWxlPSJwYWRkaW5nOjVweDsiPlxuJzsKCQkkLmVhY2gob3B0aW9ucy5tZW51LCAoXywgbSkgPT4gcmV0ICs9IGA8YSBocmVmPSIjIiBjbGFzcz0iZWFzeXVpLSR7dGhpcy51aVR5cGVzW29wdGlvbnMudHlwZSB8fCAnbWVudSddfSIgZGF0YS1vcHRpb25zPSJtZW51OicjbW0ke20ubGFiZWwucmVwbGFjZSgvIC9nLCAnJyl9JyxpY29uQ2xzOidpY29uLSR7bS5pY29uIHx8ICdub25lJ30nIj4ke20ubGFiZWx9PC9hPlxuYCk7CgkJcmV0ICs9ICI8L2Rpdj5cbiI7CgkJbGV0IGR2ID0gbSA9PiB7CgkJCWxldCByZXQgPSAnPGRpdicgKyAobS5zdWJNZW51cyA/ICcnIDogYCBkYXRhLW9wdGlvbnM9Imljb25DbHM6J2ljb24tJHttLmljb24gfHwgJ25vbmUnfSciYCkgKyAnPlxuJzsKCQkJcmV0ICs9IG0uc3ViTWVudXMgPyAnPHNwYW4+JyArIChtLmxhYmVsIHx8IHRoaXMuZW5nbGlzaChtLmNvZGUpKSArICc8L3NwYW4+XG48ZGl2PicgOiAoYDxzcGFuIHdpZHRoPScxMDAlJyBvbmNsaWNrPScoYXN5bmMgKCkgPT4ge2xldCBtID0gJHtfRnJFTUQuX3RvSlMobSl9OyBpZihtLmFjdGlvbil7cmV0dXJuIGF3YWl0IG0uYWN0aW9uKERGb3JtLmdldCgpLCBtKTt9IGlmIChtLnN1Yk1lbnVzKSByZXR1cm47IGF3YWl0IF9GckVNRC5SZW5kZXJQYWdlKHtfY29kZTogbS5jb2RlIHx8IG0ubGFiZWwucmVwbGFjZSgvIC9nLCAiIikudG9Mb3dlckNhc2UoKX0sIG0uZGF0YSk7fSkoKSc+JHttLmxhYmVsIHx8IHRoaXMuZW5nbGlzaChtLmNvZGUpfTwvc3Bhbj5gKTsKCQkJJC5lYWNoKG0uc3ViTWVudXMsIChfLCBzKSA9PiByZXQgKz0gZHYocykpOwoJCQlyZXQgKz0gKG0uc3ViTWVudXMgPyAiPC9kaXY+XG4iIDogIiIpICsgYDwvZGl2PlxuYDsKCQkJcmV0dXJuIHJldDsKCQl9OwoJCWZvciAodmFyIGkgPSAwOyBpIDwgb3B0aW9ucy5tZW51Lmxlbmd0aDsgaSsrKSB7CgkJCXZhciBtID0gb3B0aW9ucy5tZW51W2ldOwoJCQlyZXQgKz0gJzxkaXYgaWQ9Im1tJyArIG0ubGFiZWwucmVwbGFjZSgvIC9nLCAnJykgKyAnIiBzdHlsZT0id2lkdGg6MTUwcHg7Ij4nOwoJCQlmb3IgKHZhciBqID0gMDsgaiA8IG0uc3ViTWVudXMubGVuZ3RoOyBqKyspIHsKCQkJCXZhciBzbSA9IG0uc3ViTWVudXNbal07CgkJCQlyZXQgKz0gZHYoc20pOwoJCQl9CgkJCXJldCArPSAnPC9kaXY+XG4nOwoJCX0KCQlyZXR1cm4gcmV0OwoJfQoKCWludGVnZXIob3B0aW9ucykgewoJCXJldHVybiB0aGlzLmludChvcHRpb25zKTsKCX0KCgludW1iZXIob3B0aW9ucykgewoJCXJldHVybiB0aGlzLmludChvcHRpb25zKTsKCX0KCglJbnRlZ2VyKG9wdGlvbnMpIHsKCQlyZXR1cm4gdGhpcy5pbnQob3B0aW9ucyk7Cgl9CgoJYm9vbChvcHRpb25zKSB7CgkJcmV0dXJuIGA8aW5wdXQgaWQ9IiR7dGhpcy5wcmVmaXgob3B0aW9ucyl9JHtvcHRpb25zLm5hbWV9IiBkYXRhLWRmb3JtPSJlbGVtZW50OiR7b3B0aW9ucy5uYW1lfSIgcmVxdWlyZWQ9IiR7b3B0aW9ucy5yZXF1aXJlZD8ndHJ1ZSc6J2ZhbHNlJ30iIGRhdGEtb3B0aW9ucz0nZGlzYWJsZWQ6JHtvcHRpb25zLmRpc2FibGVkPyd0cnVlJzonZmFsc2UnfSwke3RoaXMuZXZlbnRIYW5kbGVycyhvcHRpb25zKX0nIGNsYXNzPSJlYXN5dWktJHt0aGlzLnVpVHlwZXNbb3B0aW9ucy50eXBlXX0iICR7b3B0aW9ucy5jaGVja2VkPydjaGVja2VkJzonJ30gLz5gOwoJfQoKCWxhYmVsKG9wdGlvbnMpIHsKCQlyZXR1cm4gYDxzcGFuIGlkPSIke3RoaXMucHJlZml4KG9wdGlvbnMpfSR7b3B0aW9ucy5uYW1lfSIgc3R5bGU9IndpZHRoOiR7dGhpcy5jV2lkdGgob3B0aW9ucyl9cHgiIGRhdGEtb3B0aW9ucz0iZGlzYWJsZWQ6JHtvcHRpb25zLmRpc2FibGVkPyd0cnVlJzonZmFsc2UnfSI+JHt0aGlzLnZhbHVlKG9wdGlvbnMpfTwvc3Bhbj5gOwoJfQoKCXVybChvcHRpb25zKSB7CgkJcmV0dXJuIHRoaXMuc3RyaW5nKG9wdGlvbnMpLnJlcGxhY2UoIkZpZWxkQ2hhbmdlIiwgIlVSTENoYW5nZSIpOwoJfQoKCXRleHQob3B0aW9ucykgewoJCXJldHVybiBgPGlucHV0IGlkPSIke3RoaXMucHJlZml4KG9wdGlvbnMpfSR7b3B0aW9ucy5uYW1lfSIgY2xhc3M9ImVhc3l1aS0ke29wdGlvbnMuZWRpdG9yIHx8IHRoaXMudWlUeXBlc1tvcHRpb25zLnR5cGVdfSIgZGF0YS1vcHRpb25zPSdkaXNhYmxlZDoke29wdGlvbnMuZGlzYWJsZWQ/J3RydWUnOidmYWxzZSd9LCR7dGhpcy5ldmVudEhhbmRsZXJzKG9wdGlvbnMpfScgbXVsdGlsaW5lPSIke29wdGlvbnMuc2ltcGxlID8gJ2ZhbHNlJyA6ICd0cnVlJ30iIHN0eWxlPSJ3aGl0ZS1zcGFjZTpwcmUtd3JhcDt3aWR0aDoke3RoaXMuY1dpZHRoKG9wdGlvbnMpfXB4O2hlaWdodDoke3RoaXMuY0hlaWdodChvcHRpb25zKX1weCIgcmVxdWlyZWQ9IiR7b3B0aW9ucy5yZXF1aXJlZCA/ICd0cnVlJyA6ICdmYWxzZSd9IiB2YWx1ZT0iJHt0aGlzLnZhbHVlKG9wdGlvbnMpfSIgLz5gOwoJfQoKCXBhc3N3b3JkKG9wdGlvbnMpIHsKCQl2YXIgcmV0ID0gdGhpcy5zdHJpbmcob3B0aW9ucyk7CgkJcmV0ID0gcmV0LnJlcGxhY2UoJzxpbnB1dCAnLCAnPGlucHV0IHR5cGU9InBhc3N3b3JkIiAnKTsKCQlyZXR1cm4gcmV0OwoJfQoKCWZpbGUob3B0aW9ucykgewoJCXJldHVybiBgPGlucHV0IGlkPSIke3RoaXMucHJlZml4KG9wdGlvbnMpfSR7b3B0aW9ucy5uYW1lfSIgY2xhc3M9ImVhc3l1aS0ke3RoaXMudWlUeXBlc1tvcHRpb25zLnR5cGVdfSIgZGF0YS1vcHRpb25zPSJvbkNoYW5nZTpmdW5jdGlvbihuLG8pe3ZhciBzID0gJCgnIycgKyB0aGlzLmlkKS5maWxlYm94KCdvcHRpb25zJyk7IHRoaXMuVXBsb2FkRmlsZShzLCB0aGlzLmJ5TmFtZSgnJHtvcHRpb25zLm5hbWV9JykpO30iIHN0eWxlPSJ3aWR0aDoke3RoaXMuY1dpZHRoKG9wdGlvbnMpfXB4Ij5gOwoJfQoKCWltYWdlKG9wdGlvbnMpIHsKCQlyZXR1cm4gdGhpcy5maWxlKG9wdGlvbnMpICsgYDxkaXYgaWQ9ImRsZyR7b3B0aW9ucy5uYW1lfSIgY2xhc3M9ImVhc3l1aS0ke3RoaXMudWlUeXBlc1tvcHRpb25zLnR5cGVdfSIgdGl0bGU9IkltYWdlIFByZXZpZXciIGRhdGEtb3B0aW9ucz0iY2xvc2VkOnRydWUsaWNvbkNsczonaWNvbi1zYXZlJyxyZXNpemFibGU6ZmFsc2UsbW9kYWw6dHJ1ZSIgc3R5bGU9IndpZHRoOjQwMHB4O2hlaWdodDoyMDBweDtwYWRkaW5nOjEwcHgiPjxpbWcgaWQ9IiR7dGhpcy5wcmVmaXgob3B0aW9ucyl9JHtvcHRpb25zLm5hbWV9IiB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIi8+PC9kaXY+YDsKCX0KCglwcm9ncmVzcyhvcHRpb25zKSB7CgkJaWYgKCFvcHRpb25zLmhlaWdodCkgb3B0aW9ucy5oZWlnaHQgPSAyMDsgLy8gZml4IGJpZyBwcm9ncmVzcwoJCXJldHVybiBgPGRpdiBpZD0iJHt0aGlzLnByZWZpeChvcHRpb25zKX0ke29wdGlvbnMubmFtZX0iIGNsYXNzPSJlYXN5dWktJHt0aGlzLnVpVHlwZXNbb3B0aW9ucy50eXBlXX0iIGRhdGEtb3B0aW9ucz0idmFsdWU6JHt0aGlzLnZhbHVlKG9wdGlvbnMpfSIgc3R5bGU9IndpZHRoOiR7dGhpcy5jV2lkdGgob3B0aW9ucyl9cHg7aGVpZ2h0OiR7dGhpcy5jSGVpZ2h0KG9wdGlvbnMpfXB4Ij48L2Rpdj5gOwoJfQoKCWZsb3djaGFydChvcHRpb25zKSB7CgkJcmV0dXJuIGA8ZGl2IGlkPSJmbHcke29wdGlvbnMubmFtZX0iIHdpZHRoPSIke3RoaXMuY1dpZHRoKG9wdGlvbnMpfSIgaGVpZ2h0PSIke3RoaXMuY0hlaWdodChvcHRpb25zKX0iPjwvZGl2PmA7Cgl9CgoJY2hhcnQob3B0aW9ucykgewoJCXJldHVybiBgPGRpdiBpZD0iY2h0JHtvcHRpb25zLm5hbWV9IiB3aWR0aD0iJHt0aGlzLmNXaWR0aChvcHRpb25zKX0iIGhlaWdodD0iJHt0aGlzLmNIZWlnaHQob3B0aW9ucyl9Ij48L2Rpdj5gOwoJfQoKCWZvcm1hdHRlcihuYW1lLCBjLCBqc29uKSB7CgkJanNvbiA9IGpzb24gPyAnIicgOiAnJzsKCQlyZXR1cm4gYCR7anNvbn0odmFsdWUsIHJvdywgaW5kZXgpID0+IHt0cnl7dmFyIGMgPSAoREZvcm0uYnlOYW1lKFxgJHtuYW1lfVxgKS5jb2x1bW5zIHx8IFtdKS5maW5kKGMgPT4gYy5maWVsZD09XGAke2MuZmllbGR9XGApOyByZXR1cm4gYyYmYy5mb3JtYXQ/Yy5mb3JtYXQodmFsdWUscm93LGluZGV4KTp2YWx1ZTt9Y2F0Y2goZXgpe3JldHVybiB2YWx1ZTt9IH0ke2pzb259YDsKCX0KCgltYXBDb2x1bW5zKG9wdGlvbnMsIGpzb24pIHsKCQlsZXQgY1RpdGxlID0gYyA9PiBjLnRpdGxlIHx8IHRoaXMuZW5nbGlzaChjLmZpZWxkKTsKCgkJdmFyIGNvbHMgPSAkLmdyZXAob3B0aW9ucy5jb2x1bW5zIHx8IFtdLCBjID0+ICFjLmlnbm9yZSk7CgkJbGV0IHJldCA9ICIiOwoJCWlmIChvcHRpb25zLm11bHRpcGxlKSByZXQgKz0gYHsiZmllbGQiOidjaycsImNoZWNrYm94Ijp0cnVlfSxgOwoJCXJldCA9IGAiZnJvemVuQ29sdW1ucyI6IFtbYDsKCQlpZiAoIW9wdGlvbnMuZnJvemVuKSB7CgkJCXJldCArPSBgeyJmaWVsZCI6IiR7b3B0aW9ucy5pZEZpZWxkLmZpZWxkfSIsInRpdGxlIjogIiR7b3B0aW9ucy5pZEZpZWxkLnRpdGxlfSIsInNvcnRhYmxlIjogInRydWUiLCAiZm9ybWF0dGVyIjogJHt0aGlzLmZvcm1hdHRlcihvcHRpb25zLm5hbWUsIG9wdGlvbnMuaWRGaWVsZCwganNvbil9fSxgOwoJCQlpZiAob3B0aW9ucy50ZXh0RmllbGQuZmllbGQgIT0gb3B0aW9ucy5pZEZpZWxkLmZpZWxkKSByZXQgKz0gYHsiZmllbGQiOiIke29wdGlvbnMudGV4dEZpZWxkLmZpZWxkIHx8IG9wdGlvbnMudGV4dEZpZWxkLnRpdGxlfSIsInRpdGxlIjoiJHtvcHRpb25zLnRleHRGaWVsZC50aXRsZSB8fCBvcHRpb25zLnRleHRGaWVsZC5maWVsZH0iLCJ3aWR0aCI6IiR7b3B0aW9ucy50ZXh0RmllbGQud2lkdGh8fDEyMH0iLCAic29ydGFibGUiOiAidHJ1ZSIsICJmb3JtYXR0ZXIiOiAke3RoaXMuZm9ybWF0dGVyKG9wdGlvbnMubmFtZSwgb3B0aW9ucy50ZXh0RmllbGQsIGpzb24pfX1gOwoJCX0gZWxzZSB7CgkJCSQubWFwKCQuZ3JlcChjb2xzLCBjID0+IGMuZnJvemVuKSwgYyA9PiBgeyJmaWVsZCI6IiR7Yy5maWVsZCB8fCBjVGl0bGUoYyl9IiwidGl0bGUiOiIke2NUaXRsZShjKSB8fCBjLmZpZWxkfSIsIndpZHRoIjoiJHtjLndpZHRofHwxMjB9IiwiYWxpZ24iOidsZWZ0Jywic29ydGFibGUiOiJ0cnVlIiwgImZvcm1hdHRlciI6ICR7dGhpcy5mb3JtYXR0ZXIob3B0aW9ucy5uYW1lLCBjLCBqc29uKX19YCkuam9pbigiLCIpOwoJCX0KCQlyZXQgKz0gYF1dLCAiY29sdW1ucyI6IFtbYDsKCQlyZXQgKz0gJC5tYXAoJC5ncmVwKGNvbHMsIGMgPT4gIWMuZnJvemVuKSwgYyA9PiBgeyJmaWVsZCI6IiR7Yy5maWVsZCB8fCBjVGl0bGUoYyl9IiwidGl0bGUiOiIke2NUaXRsZShjKSB8fCBjLmZpZWxkfSIsImFsaWduIjoibGVmdCIsInNvcnRhYmxlIjoidHJ1ZSIsICJmb3JtYXR0ZXIiOiAke3RoaXMuZm9ybWF0dGVyKG9wdGlvbnMubmFtZSwgYywganNvbil9fWApLmpvaW4oIiwiKTsKCQlyZXQgKz0gJ11dJzsKCQlyZXR1cm4gcmV0OwoJfQoKCXNlbGVjdChvcHRpb25zLCB0YWcgPSBvcHRpb25zLnRhZywgdHlwZSkgewoJCXJldHVybiB0aGlzLmNvbWJvKG9wdGlvbnMsIHRhZywgdHlwZSk7Cgl9CgoJdHJlZShvcHRpb25zKSB7CgkJcmV0dXJuIHRoaXMuc2VsZWN0KG9wdGlvbnMsICJzZWxlY3QiKTsKCX0KCgluYXZpZ2F0aW9uKG9wdGlvbnMpIHsKCQlyZXR1cm4gdGhpcy5jb21ibyhvcHRpb25zLCAndWwnLCAndHJlZScpOwoJfQoKCWNvbWJvKG9wdGlvbnMsIHRhZywgdHlwZSkgewoJCXZhciBjb2xzID0gJC5ncmVwKG9wdGlvbnMuY29sdW1ucyB8fCBbXSwgYyA9PiAhYy5pZ25vcmUpOwoJCXRhZyA9IHRhZyB8fCAic2VsZWN0IjsKCQlvcHRpb25zLmlkRmllbGQgPSAkLnVuaXF1ZVNvcnQoW3sKCQkJZmllbGQ6IG9wdGlvbnMuaWRGaWVsZCwKCQkJdGl0bGU6IG9wdGlvbnMuaWRGaWVsZAoJCX1dLmNvbmNhdCgkLmdyZXAoY29scywgYyA9PiBjLnByaW1hcnkpLCBbewoJCQlmaWVsZDogJ0lkJywKCQkJdGl0bGU6ICdJRCcKCQl9XSkpLmZpbmQoeCA9PiB0eXBlb2YoeC5maWVsZCkgIT09ICJ1bmRlZmluZWQiKTsKCQlvcHRpb25zLnRleHRGaWVsZCA9ICQudW5pcXVlU29ydChbewoJCQlmaWVsZDogb3B0aW9ucy50ZXh0RmllbGQsCgkJCXRpdGxlOiBvcHRpb25zLnRleHRGaWVsZAoJCX1dLmNvbmNhdCgkLmdyZXAoY29scywgYyA9PiBjLmRpc3BsYXkpLCBbewoJCQlmaWVsZDogJ19Ub1N0cmluZycsCgkJCXRpdGxlOiBvcHRpb25zLm5hbWUsCgkJfV0pKS5maW5kKHggPT4gdHlwZW9mKHguZmllbGQpICE9PSAidW5kZWZpbmVkIik7CgkJdmFyIGZ1biA9IHR5cGUgfHwgdGhpcy5lRnVuKG9wdGlvbnMpOwoJCXZhciBkcm9wZG93biA9IFsnY29tYm90cmVlZ3JpZCcsICdjb21ib3RyZWUnLCAnY29tYm9ncmlkJywgJ3NlbGVjdCddLmluZGV4T2YoZnVuKSA+IC0xOwoJCWlmIChkcm9wZG93bikgdGhpcy5zZWxlY3RzLnB1c2goewoJCQlpZDogImNtYiIgKyBvcHRpb25zLm5hbWUsCgkJCW9wdGlvbnM6IHRoaXMuYnlOYW1lKG9wdGlvbnMubmFtZSkKCQl9KTsKCQl0aGlzLnNlbGVjdHMgPSAkLnVuaXF1ZVNvcnQodGhpcy5zZWxlY3RzKTsKCQl2YXIgcmV0ID0gYDwke3RhZ30gaWQ9ImNtYiR7b3B0aW9ucy5uYW1lfSIgY2xhc3M9ImVhc3l1aS0ke2Z1bn0iIHN0eWxlPSJtYXgtd2lkdGg6JHtkcm9wZG93bj8nNDAwcHgnOnRoaXMuY1dpZHRoKG9wdGlvbnMpfTsgd2lkdGg6JHt0aGlzLmNXaWR0aChvcHRpb25zKX1weCIgcmVxdWlyZWQ9IiR7KG9wdGlvbnMucmVxdWlyZWQgPyAndHJ1ZScgOiAnZmFsc2UnKX0iIGRhdGEtb3B0aW9ucz0nZGlzYWJsZWQ6JHtvcHRpb25zLmRpc2FibGVkPyd0cnVlJzonZmFsc2UnfSwke3RoaXMuZXZlbnRIYW5kbGVycyhvcHRpb25zKX0sIHZhbHVlOiIke3RoaXMudmFsdWUob3B0aW9ucyl9Iiwgcm93bnVtYmVyczoke3R5cGVvZihvcHRpb25zLnJvd051bWJlcnMpIT09J3VuZGVmaW5lZCc/b3B0aW9ucy5yb3dOdW1iZXJzOihmdW4uaW5kZXhPZigndHJlZScpPC0xPydmYWxzZSc6J3RydWUnKX0sIHBhZ2luYXRpb246JHt0eXBlb2Yob3B0aW9ucy5wYWdpbmF0aW9uKSE9PSd1bmRlZmluZWQnP29wdGlvbnMucGFnaW5hdGlvbjooZnVuLmluZGV4T2YoJ3RyZWUnKTwtMT8nZmFsc2UnOid0cnVlJyl9LCBwYW5lbFdpZHRoOiR7Mip0aGlzLmNXaWR0aChvcHRpb25zKX0sIGZpdENvbHVtbnM6IHRydWUsIHNpbmdsZVNlbGVjdDogdHJ1ZSwgbXVsdGlwbGU6JHsob3B0aW9ucy5tdWx0aXBsZSB8fCAnZmFsc2UnKX0sIGlkRmllbGQ6ICIke29wdGlvbnMuaWRGaWVsZC5maWVsZH0iLCBlbmFibGVGaWx0ZXI6ICR7b3B0aW9ucy5maWx0ZXI/J3RydWUnOidmYWxzZSd9LCBub3dyYXA6IGZhbHNlLCB0ZXh0RmllbGQ6ICIke29wdGlvbnMudGV4dEZpZWxkLmZpZWxkfSIsIHRyZWVGaWVsZDogIiR7b3B0aW9ucy50ZXh0RmllbGQuZmllbGR9IixgOwoJCWlmIChmdW4uaW5kZXhPZigndHJlZScpID09IC0xKSB7CgkJCXJldCArPSAnZml0Q29sdW1uczogZmFsc2UsJyArIHRoaXMubWFwQ29sdW1ucyhvcHRpb25zKTsKCQl9CgkJaWYgKG9wdGlvbnMuZGF0YSkgewoJCQlyZXQgKz0gYCxkYXRhOiAke0pTT04uc3RyaW5naWZ5KG9wdGlvbnMuZGF0YSl9YDsKCQl9CgkJcmV0ICs9IGAnPmA7CgkJaWYgKG9wdGlvbnMub3B0aW9ucykgewoJCQlyZXQgKz0gJC5tYXAob3B0aW9ucy5vcHRpb25zLCBvID0+IGA8b3B0aW9uIHZhbHVlPScke19GckVNRC5fdG9KUyhvKX0nPiR7by5uYW1lIHx8IG99PC9vcHRpb24+YCkuam9pbignXG4nKTsKCQl9CgkJcmV0ICs9IGA8LyR7dGFnfT5gOwoJCS8vIGNvbnNvbGUubG9nKHJldCk7CgkJcmV0dXJuIHJldDsKCX0KCglncmlkKG9wdGlvbnMsIHRhZywgdHlwZSkgewoJCXJldHVybiB0aGlzLmNvbWJvKG9wdGlvbnMsICJ0YWJsZSIsICJkYXRhZ3JpZCIpOwoJfQoKCXRyZWVncmlkKG9wdGlvbnMpIHsKCQlyZXR1cm4gdGhpcy5jb21ibyhvcHRpb25zLCAndGFibGUnLCAndHJlZScpOwoJfQoKCWFzeW5jIGRvTGluayhlLCBldmVudCkgewoJCXRoaXMuYnVzeSh0cnVlKTsKCQl0cnkgewoJCQlhd2FpdCBlLmxpbmtzLmZpbmQobCA9PiBsLmxhYmVsID09IGV2ZW50LnRhcmdldC5pbm5lclRleHQpLm9uQ2xpY2sodGhpcy5nZXQoKSk7CgkJfSBjYXRjaCAoZXgpIHsKCQkJY29uc29sZS5sb2coImRvTGluayIsIGV4KTsKCQl9CgkJdGhpcy5idXN5KGZhbHNlKTsKCX0KCglFZGl0ZWRWYWx1ZShlKSB7CgkJcmV0dXJuICh0eXBlb2YoYWNlKSAhPT0gInVuZGVmaW5lZCIpID8gYWNlLmVkaXQoJ3BubCcgKyBlLm5hbWUpLnNlc3Npb24uZ2V0VmFsdWUoKSA6ICcnOwoJfQoKCWFzeW5jIFBhbk9uQ2xvc2UoZSkgewoJCWlmIChlLmVkaXRvcikgewoJCQllLnZhbHVlID0gdGhpcy5FZGl0ZWRWYWx1ZShlKTsKCQl9CgkJaWYgKGUuY2xvc2UpIHsKCQkJYXdhaXQgZS5jbG9zZSh0aGlzLmdldCgpKTsKCQl9Cgl9CgoJYXN5bmMgUGVuZEFmdGVyT3BlbihlKSB7CgkJaWYgKGUuZWRpdG9yICYmIHR5cGVvZihhY2UpICE9PSAidW5kZWZpbmVkIikgewoJCQlhd2FpdCBfRnJFTUQuT3BlbkVkaXRvcigncG5sJyArIGUubmFtZSAvKisgJy1jZW50ZXInKi8gLCBlLmxhbmd1YWdlLCBlLmxvYWRlciB8fCAobyA9PiBlLnZhbHVlKSwgZS5zYXZlciwgdGhpcy5nZXQoKSwgZSk7CgkJfQoJCWlmIChlLm9wZW4pIHsKCQkJYXdhaXQgZS5vcGVuKHRoaXMuZ2V0KCkpOwoJCX0KCX0KCglsaW5rKG9wdGlvbnMpIHsKCQlyZXR1cm4gKG9wdGlvbnMubGlua3MgfHwgW10pLmZpbHRlcihsID0+ICFsLmlnbm9yZSkubWFwKGwgPT4gYDxhIGhyZWY9IiMiIGNsYXNzPSJlYXN5dWktJHt0aGlzLnVpVHlwZXNbb3B0aW9ucy50eXBlXX0iIGRhdGEtb3B0aW9ucz0nJHt0aGlzLmV2ZW50SGFuZGxlcnMob3B0aW9ucyl9LCBpY29uQ2xzOiJpY29uLSR7bC5pY29uIHx8ICdvayd9Iic+JHtsLmxhYmVsfTwvYT5gKS5qb2luKCdcbicpOwoJfQoKCWFzeW5jIFNldFRyZWVEYXRhKGUsIG4sIGRhdGEpIHsKCQkkLmVhY2goJCgiI2NtYiIgKyBlLm5hbWUpW3RoaXMuZUZ1bihlKV0oJ3RyZWUnKS50cmVlKCJnZXRDaGlsZHJlbiIsIG4udGFyZ2V0KSwgKF8sIGMpID0+ICQoIiNjbWIiICsgZS5uYW1lKVt0aGlzLmVGdW4oZSldKCd0cmVlJykudHJlZSgicmVtb3ZlIiwgYy50YXJnZXQpKTsKCQkkKCIjY21iIiArIGUubmFtZSlbdGhpcy5lRnVuKGUpXSgndHJlZScpLnRyZWUoImFwcGVuZCIsIHsKCQkJcGFyZW50OiBuLnRhcmdldCwKCQkJZGF0YTogZGF0YQoJCX0pOwoJCXJldHVybiB0cnVlOwoJfQoKCWFzeW5jIEV4cGFuZChlLCBuKSB7CgkJdGhpcy5TZXRUcmVlRGF0YShlLCBuLCBbewoJCQlpZDogbnVsbCwKCQkJdGV4dDogImxvYWRpbmcuLi4iCgkJfV0pOwoJCXZhciBvYmogPSB7fTsKCQl2YXIgcEZpZWxkID0gZS5wYXJlbnRGaWVsZCB8fCAkLm1hcCgkLmdyZXAoZS5jb2x1bW5zIHx8IFtdLCBjID0+IGMucGFyZW50KSwgYyA9PiBjLmZpZWxkKS5jb25jYXQoW251bGxdKVswXTsKCQl2YXIgaWRGaWVsZCA9ICQuZ3JlcChlLmNvbHVtbnMgfHwgW10sIGMgPT4gYy5wcmltYXJ5KS5jb25jYXQoZS5pZEZpZWxkKVswXS5maWVsZDsKCQlpZiAocEZpZWxkKSB7CgkJCW9ialtwRmllbGRdID0gewoJCQkJX3NvdXJjZTogbi5fc291cmNlCgkJCX07CgkJCWlmIChpZEZpZWxkKSB7CgkJCQlvYmpbcEZpZWxkXVtpZEZpZWxkXSA9IG4uaWQ7CgkJCX0gZWxzZSB7CgkJCQlvYmpbcEZpZWxkXSA9IG4uaWQ7CgkJCX0KCQl9CgkJbGV0IGRhdGEgPSBhd2FpdCB0aGlzLl9sb2FkRGF0YSh7CgkJCWlkOiAiY21iIiArIGUubmFtZSwKCQkJb3B0aW9uczogZQoJCX0sIG9iaik7CgkJdGhpcy5TZXRUcmVlRGF0YShlLCBuLCBkYXRhKTsKCX0KCglhc3luYyBfbG9hZERhdGEocywgbywgc3RhcnQsIGVuZCkgewoJCXZhciBuYW1lID0gKHMgJiYgcy5vcHRpb25zID8gKHMub3B0aW9ucy5DbGFzcyA/IHMub3B0aW9ucy5DbGFzcy5OYW1lLnJlcGxhY2UoJyAnLCAnXycpIDogKHMub3B0aW9ucy50YWJsZSB8fCBzLm9wdGlvbnMubmFtZSkpIDogcy5uYW1lKTsKCQluYW1lID0gbmFtZS50cmltKCk7CgoJCWxldCBvU2NvcGUgPSAodHlwZW9mKGNvbXBhbnkpICE9PSAndW5kZWZpbmVkJyAmJiBjb21wYW55LlNjb3BlKSA/IHdpbmRvd1tjb21wYW55LlNjb3BlXSA6IHdpbmRvdzsKCQlvID0gbyB8fCAob1Njb3BlW25hbWVdID8gbmV3IG9TY29wZVtuYW1lXSgpIDogewoJCQlBY3RpdmU6IHRydWUsCgkJfSk7CgkJbyA9ICh0eXBlb2YgZmlsdGVycyAhPT0gInVuZGVmaW5lZCIgJiYgZmlsdGVycyAmJiBmaWx0ZXJzW25hbWVdKSA/IGZpbHRlcnNbbmFtZV0obykgOiBvOwoJCW8gPSAocyAmJiBzLm9wdGlvbnMgJiYgcy5vcHRpb25zLnNvdXJjZSA/IHMub3B0aW9ucy5zb3VyY2UobywgdGhpcy5nZXQoKSkgOiBvKTsKCQlsZXQgbmFtZXMgPSAkLnVuaXF1ZVNvcnQoW3Mub3B0aW9ucy5zZWFyY2hGaWVsZF0uY29uY2F0KCQubWFwKCQuZ3JlcChzLm9wdGlvbnMuY29sdW1ucyB8fCBbXSwgYyA9PiBjLnNlYXJjaCksIGMgPT4gYy5maWVsZCksIFsiTmFtZSJdKSk7CgkJdmFyIGZ1biA9IHRoaXMuZUZ1bihzLm9wdGlvbnMpOwoJCWlmICghb1tuYW1lc1swXV0pIG9bbmFtZXNbMF1dID0gJCgiIyIgKyBzLmlkKVtmdW5dKCdnZXRUZXh0Jyk7CgkJdmFyIGRhdGEgPSBudWxsOwoKCQlsZXQgbGliID0gJyc7CgkJaWYgKG5hbWUuaW5kZXhPZignLicpID4gMCkgewoJCQlsaWIgPSBuYW1lLnNwbGl0KCcuJylbMF0gKyAnLic7CgkJCW5hbWUgPSBuYW1lLnNwbGl0KCcuJylbMV07CgkJfQoKCQlpZiAocy5vcHRpb25zLmxvYWRlcikgewoJCQlkYXRhID0gYXdhaXQgcy5vcHRpb25zLmxvYWRlcih0aGlzLmdldCgpLCBzLm9wdGlvbnMsIG8pOwoJCX0gZWxzZSBpZiAodHlwZW9mKGNvbXBhbnkpICE9PSAndW5kZWZpbmVkJyAmJiBjb21wYW55LmxpYnJhcnkgJiYgY29tcGFueS5Db2RlKSB7CgkJCS8vY29uc29sZS5sb2coIkRGb3JtOjpfbG9hZERhdGEoKTogc3IoKS5fKCIgKyBsaWIgKyBjb21wYW55LkNvZGUudG9Mb3dlckNhc2UoKSArIG5hbWUgKyAiRmluZGFsbCIgKyAiKSIsIG8pOwoJCQlkYXRhID0gYXdhaXQgdGhpcy5zcigpLl8obGliICsgY29tcGFueS5Db2RlLnRvTG93ZXJDYXNlKCkgKyBuYW1lICsgIkZpbmRhbGwiLCBudWxsLCBvLCBudWxsLCBzdGFydCwgZW5kKTsKCQl9IGVsc2UgaWYgKF9GckVNRC5hcGlTZXJ2ZXIpIHsKCQkJZGF0YSA9IGF3YWl0IF9GckVNRC5hcGlTZXJ2ZXIuX25ldyhuYW1lKS5fZnJvbURvY3VtZW50KE9iamVjdC5hc3NpZ24oLi4uT2JqZWN0LmtleXMobykubWFwKGsgPT4gKHsKCQkJCVtTdHJpbmcoaykuY2hhckF0KDApLnRvTG93ZXJDYXNlKCkgKyBTdHJpbmcoaykuc2xpY2UoMSldOiBvW2tdCgkJCX0pKSkpLmZpbmRBbGwoKTsKCQl9IGVsc2UgewoJCQkvLyBlbXMKCQkJZGF0YSA9IGF3YWl0IG8uZmluZEFsbCgpOwoJCQkvL2RhdGEgPSBhd2FpdCB3aW5kb3cuX0ZyRU1ELl9vKG51bGwsIG8pOwoJCX0KCQlpZiAocy5vcHRpb25zLnBvc3Rsb2FkKSB7CgkJCWF3YWl0IHMub3B0aW9ucy5wb3N0bG9hZChkYXRhKTsKCQl9CgkJJC5lYWNoKGRhdGEsIChpLCBkKSA9PiB7CgkJCWQuX19PV05FUiA9IHM7CgkJCSQuZWFjaChzLm9wdGlvbnMuY29sdW1ucywgKF8sIGMpID0+IHsKCQkJCWlmIChjLnZhbHVlKSB7CgkJCQkJZFtjLmZpZWxkXSA9IGMudmFsdWUoZCwgZGF0YSwgaSk7CgkJCQl9CgkJCX0pOwoJCX0pOwoJCWlmICghcy5vcHRpb25zLmNvbHVtbnMgJiYgZnVuLmluZGV4T2YoJ3RyZWUnKSA+IC0xKSB7CgkJCWRhdGEgPSAkLm1hcChkYXRhLCBkID0+IHsKCQkJCWxldCByZXQgPSB7CgkJCQkJaWQ6IGRbcy5vcHRpb25zLmlkRmllbGQuZmllbGRdLAoJCQkJCXRleHQ6IGRbcy5vcHRpb25zLnRleHRGaWVsZC5maWVsZF0sCgkJCQkJc3RhdGU6IGQuc3RhdGUgfHwgKHMub3B0aW9ucy5sb2FkZXIgPyAiZmlsZSIgOiAiY2xvc2VkIiksCgkJCQkJX3NvdXJjZTogZCwKCQkJCX07CgkJCQlyZXQuY2hpbGRyZW4gPSAocmV0LnN0YXRlID09ICJjbG9zZWQiKSA/IFt7CgkJCQkJdGV4dDogJ2xvYWRpbmcuLi4nCgkJCQl9XSA6IG51bGw7CgkJCQlyZXR1cm4gcmV0OwoJCQl9KTsKCQl9CgkJcmV0dXJuIGRhdGEgfHwgW107Cgl9CgoJYXN5bmMgZmlsbERhdGEoZywgbywgc3RhcnQsIGVuZCkgewoJCXZhciBzID0gbnVsbDsKCQlmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuc2VsZWN0cy5sZW5ndGg7IGkrKykgewoJCQlpZiAodGhpcy5zZWxlY3RzW2ldLmlkID09IGdbMF0uaWQpIHMgPSB0aGlzLnNlbGVjdHNbaV07CgkJfQoJCWlmICghcykgcmV0dXJuOwoJCXRoaXMuYnVzeSh0cnVlKTsKCQl0cnkgewoJCQl2YXIgZnVuID0gZ1swXS5jbGFzc0xpc3RbIjAiXS5yZXBsYWNlKCdlYXN5dWktJywgJycpOwoJCQl0cnkgewoJCQkJJCgiIyIgKyBzLmlkKVtmdW5dKCdncmlkJykuZGF0YWdyaWQoJ2dldFBhZ2VyJykucGFnaW5hdGlvbignbG9hZGluZycpOwoJCQl9IGNhdGNoIChleCkge30KCQkJaWYgKHMub3B0aW9ucy5ub2xvYWQpIHsKCQkJCWxldCBfZGF0YSA9IG51bGw7CgkJCQl0cnkgewoJCQkJCV9kYXRhID0gJCgiIyIgKyBzLmlkKVtmdW5dKCdncmlkJykuZGF0YWdyaWQoImdldERhdGEiKTsKCQkJCX0gY2F0Y2ggKGV4KSB7CgkJCQkJX2RhdGEgPSAkKCIjIiArIHMuaWQpW2Z1bl0oJ3RyZWUnKS50cmVlKCdnZXRSb290Jyk7CgkJCQl9CgkJCQlpZiAoX2RhdGEpIHsKCQkJCQlyZXR1cm4gdGhpcy5idXN5KGZhbHNlKTsKCQkJCX0KCQkJfQoJCQl2YXIgZGF0YSA9IGF3YWl0IHRoaXMuX2xvYWREYXRhKHMsIG8sIHN0YXJ0LCBlbmQpOwoJCQl0cnkgewoJCQkJaWYgKCQoIiMiICsgcy5pZClbZnVuXSgnZ3JpZCcpKSAkKCIjIiArIHMuaWQpW2Z1bl0oJ2dyaWQnKS5kYXRhZ3JpZCgnZ2V0UGFnZXInKS5wYWdpbmF0aW9uKCdsb2FkZWQnKTsKCQkJfSBjYXRjaCAoZXgpIHt9CgkJCXRyeSB7CgkJCQkkKCIjIiArIHMuaWQpW2Z1bl0oJ2dyaWQnKS5kYXRhZ3JpZCgnbG9hZERhdGEnLCB7CgkJCQkJdG90YWw6IGRhdGEuQ291bnQgfHwgZGF0YS5sZW5ndGgsCgkJCQkJcm93czogZGF0YSwKCQkJCX0pOwoJCQl9IGNhdGNoIChleCkgewoJCQkJJCgiIyIgKyBzLmlkKVtmdW5dKCd0cmVlJykudHJlZSgnbG9hZERhdGEnLCBkYXRhKTsKCQkJfQoJCX0gY2F0Y2ggKGV4KSB7CgkJCWNvbnNvbGUubG9nKGV4KTsKCQl9CgkJdGhpcy5idXN5KGZhbHNlKTsKCX0KCglldmVudEhhbmRsZXJzKG9wdGlvbnMpIHsKCQlpZiAoIXRoaXMuYnlOYW1lKG9wdGlvbnMubmFtZSkpIHJldHVybjsgLy8gaWYgbm90IGFuIGVsZW1lbnQsIGRvIG5vdCBydW4gdGhlIGhhbmRsZXJzCgoJCXJldHVybiB0aGlzLmV2ZW50cy5maWx0ZXIoZSA9PiBlLnR5cGUgPT0gb3B0aW9ucy50eXBlIHx8IHR5cGVvZihlLnR5cGUpID09PSAndW5kZWZpbmVkJykubWFwKGUgPT4gYCR7ZS5uYW1lfTogKCR7ZS5wYXJhbXMgfHwgJyd9KSA9PiB7dHJ5e0RGb3JtLiR7ZS5oYW5kbGVyfShERm9ybS5ieU5hbWUoIiR7b3B0aW9ucy5uYW1lfSIpIHx8ICR7X0ZyRU1ELl90b0pTKG9wdGlvbnMpfSB8fCB7bmFtZTogIiR7b3B0aW9ucy5uYW1lfSIsdHlwZTogIiR7b3B0aW9ucy50eXBlfSJ9LCAke2UucGFyYW1zfSl9Y2F0Y2goZXgpe2NvbnNvbGUubG9nKCJFdmVudCBFcnJvcjogJHtvcHRpb25zLm5hbWV9LyR7b3B0aW9ucy50eXBlfS8ke2UubmFtZX0iLCBleCk7fX1gKS5qb2luKCcsJyk7Cgl9CgoJYXN5bmMgUGFuZWxPcGVuKGUpIHsKCQlpZiAoZS5lZGl0b3IpIHJldHVybiB0cnVlOwoJCWxldCBjb250ZW50ID0gZS52YWx1ZTsKCQlpZiAoZS5sb2FkZXIpIHsKCQkJY29udGVudCA9IGF3YWl0IGUubG9hZGVyKHRoaXMuZ2V0KCkpOwoJCX0KCQlpZiAoY29udGVudCkgewoJCQl0cnkgewoJCQkJJCgiI3BubCIgKyBlLm5hbWUpLnBhbmVsKCdib2R5JykuaHRtbChjb250ZW50KTsKCQkJCWNvbnNvbGUubG9nKCJwbmwiICsgZS5uYW1lICsgIjogQ29udGVudCBWYWxpZCIpOwoJCQl9IGNhdGNoIChleCkgewoJCQkJLy9jb25zb2xlLmxvZyhleCk7CgkJCX0KCQl9CgkJcmV0dXJuIGNvbnRlbnQ7Cgl9CgoJYXN5bmMgU2VsZWN0Q2hhbmdlKG9wdGlvbnMsIHRhYikgewoJCXRoaXMuYnVzeSh0cnVlKTsKCQkkLmdyZXAodGhpcy5lbGVtZW50cywgZSA9PiBlLnR5cGUgPT0gImdyaWQiICYmIGUuZ3JvdXAgPT0gdGFiKS5mb3JFYWNoKGUgPT4gJCgiI2NtYiIgKyBlLm5hbWUpLmRhdGFncmlkKCkpOwoJCXRoaXMuYnVzeShmYWxzZSk7Cgl9CgoJYXN5bmMgRmllbGRDaGFuZ2Uob3B0aW9ucywgdmFsdWUpIHsKCQl0aGlzLmJ1c3kodHJ1ZSk7CgkJaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5jaGFuZ2UpIHsKCQkJYXdhaXQgb3B0aW9ucy5jaGFuZ2UodGhpcy5nZXQoKSwgdmFsdWUpOwoJCX0KCQl0aGlzLmJ1c3koZmFsc2UpOwoJfQoKCWFzeW5jIFVSTENoYW5nZShzLCBvcHRpb25zKSB7CgkJdGhpcy5idXN5KHRydWUpOwoJCW9wdGlvbnMuZGF0YSA9IGF3YWl0ICQuZ2V0KHMudmFsdWUpOwoJCXJldHVybiBhd2FpdCB0aGlzLkZpZWxkQ2hhbmdlKHMsIG9wdGlvbnMpOwoJfQoKCVVwbG9hZEZpbGUoZiwgb3B0aW9ucykgewoJCXRoaXMuYnVzeSh0cnVlKTsKCQl2YXIgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEoKTsKCQl2YXIgZmlsZWlkID0gTWF0aC5yYW5kb20oKTsKCQl2YXIgbWV0aG9kID0gb3B0aW9ucy5tZXRob2QgfHwgIkNvbnRlbnRNYW5hZ2VyLmNtc1VwbG9hZEZpbGUiOwoJCWZvcm1EYXRhLmFwcGVuZCgnZmlsZWlkJywgZmlsZWlkKTsKCQl2YXIgZmlsZSA9ICQoIiMiICsgZi5maWxlYm94SWQpWzBdLmZpbGVzWzBdOwoJCWZvcm1EYXRhLmFwcGVuZCgnX19VRklMRScsIGZpbGUpOwoJCWlmIChvcHRpb25zLmxvY2FsKSB7CgkJCS8vIGhhbmRsaW5nIHRoZSBmaWxlIGxvY2FsbHkKCQkJdmFyIHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7CgkJCXJlYWRlci5vbmxvYWQgPSAoZSkgPT4gewoJCQkJdmFyIGRhdGEgPSBlLnRhcmdldC5yZXN1bHQ7CgkJCQlyZXQgPSBkYXRhOwoJCQkJdGhpcy5ieU5hbWUob3B0aW9ucy5uYW1lKS5kYXRhID0gcmV0OwoJCQkJaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy51cGxvYWQpIG9wdGlvbnMudXBsb2FkKHRoaXMuZ2V0KCksIHJldCk7CgkJCX07CgkJCWlmIChvcHRpb25zLmJpbmFyeSkgewoJCQkJcmVhZGVyLnJlYWRBc0JpbmFyeVN0cmluZyhmaWxlKTsKCQkJfSBlbHNlIGlmIChvcHRpb25zLmRhdGF1cmwpIHsKCQkJCXJlYWRlci5yZWFkQXNEYXRhVVJMKGZpbGUpOwoJCQl9IGVsc2UgewoJCQkJcmVhZGVyLnJlYWRBc1RleHQoZmlsZSk7CgkJCX0KCQkJdGhpcy5idXN5KGZhbHNlKTsKCQl9IGVsc2UgaWYgKG1ldGhvZCkgewoJCQkkLmFqYXgoewoJCQkJdXJsOiB0aGlzLnNyKCkuc3JVUkwgKyAiJm1ldGhvZD0iICsgbWV0aG9kICsgIiZzSW5wdXQ9IiArIGZpbGVpZCArICImcHJlVGFnPSZwb3N0VGFnPSIsCgkJCQlkYXRhOiBmb3JtRGF0YSwKCQkJCS8vIFRISVMgTVVTVCBCRSBET05FIEZPUiBGSUxFIFVQTE9BRElORwoJCQkJY2FjaGU6IGZhbHNlLAoJCQkJY29udGVudFR5cGU6IGZhbHNlLAoJCQkJdHlwZTogJ1BPU1QnLAoJCQkJcHJvY2Vzc0RhdGE6IGZhbHNlLAoJCQkJc3VjY2VzczogZGF0YSA9PiB7CgkJCQkJdGhpcy5zcigpLnJ1blNjcmlwdChkYXRhKTsKCQkJCQl0aGlzLmJ5TmFtZShvcHRpb25zLm5hbWUpLmRhdGEgPSByZXQ7CgkJCQkJaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy51cGxvYWQpIG9wdGlvbnMudXBsb2FkKHRoaXMuZ2V0KCksIHJldCk7CgkJCQkJdGhpcy5idXN5KGZhbHNlKTsKCQkJCX0KCQkJfSk7CgkJfQoJfQoKCWVGdW4oZSkgewoJCXRyeSB7CgkJCWlmIChlLnR5cGUgPT0gInRyZWUiKSB7CgkJCQlpZiAoZS5jb2x1bW5zKSB7CgkJCQkJcmV0dXJuICJjb21ib3RyZWVncmlkIjsKCQkJCX0gZWxzZSBpZiAodHlwZW9mKGUuY29tYm8pICE9PSAndW5kZWZpbmVkJyAmJiAhZS5jb21ibykgewoJCQkJCXJldHVybiAndHJlZSc7CgkJCQl9IGVsc2UgewoJCQkJCXJldHVybiAiY29tYm90cmVlIjsKCQkJCX0KCQkJfSBlbHNlIGlmIChlLnR5cGUgPT0gJ25hdmlnYXRpb24nKSB7CgkJCQlyZXR1cm4gJ3RyZWUnOwoJCQl9IGVsc2UgaWYgKGUudHlwZSA9PSAiY29tYm90cmVlIikgewoJCQkJcmV0dXJuICJjb21ib3RyZWVncmlkIjsKCQkJfSBlbHNlIGlmIChlLnR5cGUgPT0gInNlbGVjdCIgJiYgZS5vcHRpb25zKSB7CgkJCQlyZXR1cm4gImNvbWJvYm94IjsKCQkJfQoJCQlyZXR1cm4gImNvbWJvZ3JpZCI7CgkJfSBjYXRjaCAoZXgpIHsKCQkJcmV0dXJuICJjb21ib2dyaWQiOwoJCX0KCX0KCglfZmlsbFdpbmRvdyh3aW5OYW1lLCB2LCBtYXApIHsKCQl2ID0gdiB8fCB7fTsKCQltYXAgPSBtYXAgfHwge307CgkJaWYgKEFycmF5LmlzQXJyYXkobWFwKSkgewoJCQltYXAgPSBPYmplY3QuZnJvbUVudHJpZXMobmV3IE1hcChtYXApKTsKCQl9CgoJCW1hcCA9ICQuZXh0ZW5kKHt9LCBtYXAsIE9iamVjdC5mcm9tRW50cmllcyhPYmplY3Qua2V5cyh2KS5tYXAoayA9PiBbd2luTmFtZSArIGssIGtdKSkpOwoKCQlsZXQgcyA9IHt9OwoJCWZvciAodmFyIG0gaW4gbWFwKSB7CgkJCWlmICh0eXBlb2YodlttYXBbbV1dKSA9PT0gInVuZGVmaW5lZCIpIHsKCQkJCS8vY29uc29sZS5sb2coJ2lzX3VuZGVmaW5lZCcsIG0sIG1hcFttXSwgdlttYXBbbV1dKTsKCQkJCXNbbV0gPSBtYXBbbV07CgkJCX0gZWxzZSB7CgkJCQkvL2NvbnNvbGUubG9nKCdpc19ub3RfdW5kZWZpbmVkJywgbSwgbWFwW21dLCB2W21hcFttXV0pOwoJCQkJc1ttXSA9IHZbbWFwW21dXTsKCQkJfQoJCX0KCQl0aGlzLmNsZWFyKHdpbk5hbWUpOwoJCS8vY29uc29sZS5sb2coInMiLCBzKTsKCQl0aGlzLnNldChzKTsKCQkkKCIjcG5sXyIgKyB3aW5OYW1lKS53aW5kb3coIm9wZW4iKTsKCX0KCgl3aW5kb3dUb0VudGl0eShvLCBiRW1wdHksIGdyaWQsIHByZWZpeCwgZmlsdGVyKSB7CgkJbyA9IG8gfHwgdGhpcy5nZXQoKTsKCQlmaWx0ZXIgPSBmaWx0ZXIgfHwgKHYgPT4gdik7CgkJbGV0IHJldCA9IGdyaWQgPyAoZ3JpZC5zZWxlY3RlZCB8fCBncmlkKSA6IG51bGw7CgkJaWYgKGJFbXB0eSkgewoJCQlyZXQgPSB7fTsKCQkJbyA9IHt9OwoJCX0gZWxzZSB7CgkJCXJldCA9IChyZXQgJiYgcmV0LklkKSA/IHsKCQkJCUlkOiByZXQuSWQKCQkJfSA6IHt9OwoJCX0KCgkJdGhpcy5lbGVtZW50cy5maWx0ZXIoZSA9PiAocHJlZml4ID8gZS5ncm91cCA9PSBwcmVmaXggOiB0cnVlKSAmJiBlLnR5cGUgIT0gJ2xpbmsnICYmIFsnXyddLmluZGV4T2YoZS5uYW1lLnJlcGxhY2UocHJlZml4LCAiIikpIDwgMCkuZm9yRWFjaChlID0+IHsKCQkJcmV0W2UubmFtZS5yZXBsYWNlKHByZWZpeCwgIiIpXSA9IG9bZS5uYW1lXTsKCQkJcmV0dXJuIHRydWU7CgkJfSk7CgoJCWZpbHRlcihyZXQpOwoKCQlyZXR1cm4gcmV0OwoJfQoKCWJpbmQob2JqKSB7CgkJdmFyIG9iakJpbmQgPSAobywgZSkgPT4gewoJCQlvW3RoaXMuZUZ1bihlKV0oewoJCQkJb25TaG93UGFuZWw6ICgpID0+IHsKCQkJCQl0aGlzLmZpbGxEYXRhKCQoIiMiICsgZS5pZCksIG51bGwsIDAsIDEwKTsKCQkJCX0sCgkJCQlvbkNsaWNrUm93OiAoaW5kZXgsIHJvdykgPT4gewoJCQkJCXZhciBzID0gcm93ID8gcm93Ll9fT1dORVIgOiBudWxsOwoJCQkJCWlmIChzICYmIHMub3B0aW9ucy5zZWxlY3QpIHsKCQkJCQkJcy5vcHRpb25zLnNlbGVjdChyb3cpOwoJCQkJCX0KCQkJCX0KCQkJfSk7CgkJCXRyeSB7CgkJCQl2YXIgZGcgPSBvW3RoaXMuZUZ1bihlKV0oJ2dyaWQnKTsKCQkJCS8vIGRnLmRhdGFncmlkKCdlbmFibGVGaWx0ZXInKQoJCQkJdmFyIHN0YXRlID0gZGcuZGF0YSgnZGF0YWdyaWQnKTsKCQkJCXZhciBvcHRzID0gc3RhdGUub3B0aW9uczsKCQkJCXZhciBvbkJlZm9yZUxvYWQgPSBvcHRzLm9uQmVmb3JlTG9hZDsKCQkJCW9wdHMub25CZWZvcmVMb2FkID0gKHBhcmFtKSA9PiB7CgkJCQkJc3RhdGUuYWxsUm93cyA9IG51bGw7CgkJCQkJcmV0dXJuIG9uQmVmb3JlTG9hZC5jYWxsKHRoaXMsIHBhcmFtKTsKCQkJCX07CgkJCQl2YXIgcGFnZXIgPSBkZy5kYXRhZ3JpZCgnZ2V0UGFnZXInKTsKCQkJCWRnLmRhdGFncmlkKCdnZXRQYW5lbCcpLnBhbmVsKHsKCQkJCQlJRDogaQoJCQkJfSk7CgkJCQlwYWdlci5wYWdpbmF0aW9uKHsKCQkJCQlvblNlbGVjdFBhZ2U6IGZ1bmN0aW9uKHBhZ2VOdW0sIHBhZ2VTaXplKSB7CgkJCQkJCXRoaXMuZmlsbERhdGEoJCgiIyIgKyB0aGlzLnNlbGVjdHNbJCh0aGlzLnBhcmVudE5vZGUpLnBhbmVsKCdvcHRpb25zJykuSURdLmlkKSwgbnVsbCwgcGFnZVNpemUgKiAocGFnZU51bSAtIDEpLCBwYWdlU2l6ZSAqIHBhZ2VOdW0pOwoJCQkJCX0KCQkJCX0pOwoJCQkJZGcuZGF0YWdyaWQoJ2xvYWREYXRhJywgc3RhdGUuZGF0YSk7CgkJCX0gY2F0Y2ggKGV4KSB7fQoJCX0KCQlpZiAob2JqKSB7CgkJCW9iakJpbmQob2JqKTsKCQl9IGVsc2UgewoJCQlmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuc2VsZWN0cy5sZW5ndGg7IGkrKykgewoJCQkJaWYgKHRoaXMuc2VsZWN0c1tpXS5vcHRpb25zLm9wdGlvbnMpIHsKCQkJCQkvLyQoIiMiICsgdGhpcy5zZWxlY3RzW2ldLmlkKS5jb21ibygpOwoJCQkJfSBlbHNlIHsKCQkJCQlvYmpCaW5kKCQoIiMiICsgdGhpcy5zZWxlY3RzW2ldLmlkKSwgdGhpcy5zZWxlY3RzW2ldKTsKCQkJCX0KCQkJfQoKCQkJdGhpcy5lbGVtZW50cy5maWx0ZXIoZSA9PiBlLndpbmRvdykuZm9yRWFjaChlID0+IHsKCQkJCWxldCB0ID0gJCgiI3RiY1dpbmRvdyIpLnRhYnMoImdldFRhYiIsIGUuZ3JvdXApOwoJCQkJaWYgKHQpIHsKCQkJCQl0LnBhbmVsKCdvcHRpb25zJykudGFiLmhpZGUoKTsKCQkJCX0KCQkJfSk7CgkJfQoJfQoKCWVuZ2xpc2gocykgewoJCWlmICghcykgcmV0dXJuICIiOwoJCXZhciByZXN1bHQgPSBzLnJlcGxhY2UoLyhbQS1aXSkvZywgIiAkMSIpOwoJCXJlc3VsdCA9IHJlc3VsdC5yZXBsYWNlKC9fL2csICcnKTsKCQlyZXR1cm4gcmVzdWx0LmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgcmVzdWx0LnNsaWNlKDEpOwoJfQoKCW9uVG9nZ2xlKGUsIGJWYWx1ZSkgewoJCWxldCBzVGFnID0gYCNmRWxlbWVudF8ke2UuZm9yLm5hbWV9ID4gLmVhc3l1aS0ke3RoaXMudWlUeXBlc1tlLmZvci50eXBlXX1gOwoJCWxldCBvVGFnID0gJChzVGFnKTsKCQllLmZvci5lbmFibGVkID0gdHlwZW9mKGJWYWx1ZSkgPT09ICJ1bmRlZmluZWQiID8gIWUuZm9yLmVuYWJsZWQgOiBiVmFsdWU7CgoJCW9UYWcucHJvcCgiZGlzYWJsZWQiLCAhZS5mb3IuZW5hYmxlZCk7CgkJLy9vVGFnW3RoaXMudWlUeXBlc1tlLmZvci50eXBlXV0oZS5mb3IuZW5hYmxlZCA/ICJlbmFibGUiIDogImRpc2FibGUiKTsKCQljb25zb2xlLmxvZyhzVGFnLCBvVGFnLCB0aGlzLnVpVHlwZXNbZS5mb3IudHlwZV0sIGUuZm9yLmVuYWJsZWQpOwoJfQoKCXJlbmRlcihuYW1lLCB0aXRsZSwgZWxlbWVudHMsIGJ1dHRvbnMsIGJGaXhlZCkgewoJCXRoaXMuZWxlbWVudHMgPSAoZWxlbWVudHMgfHwgW10pLmZpbHRlcihlID0+ICFlLmlnbm9yZSk7CgoJCXRoaXMuYnV0dG9ucyA9IGJ1dHRvbnMgfHwgW107CgkJdGhpcy5zZWxlY3RzID0gW107CgkJdGhpcy5ncmlkcyA9IFtdOwoKCQl0aGlzLmVsZW1lbnRzLmZpbHRlcihlID0+IGUudHlwZSA9PSAid2luZG93IikuZm9yRWFjaCh3ID0+IHRoaXMuZWxlbWVudHMuc3BsaWNlKHRoaXMuZWxlbWVudHMuZmluZEluZGV4KGUgPT4gZS5uYW1lID09IHcubmFtZSksIDAsIHsKCQkJbmFtZTogIl8iICsgdy5uYW1lLAoJCQl0eXBlOiAibGluayIsCgkJCXRpdGxlOiB3LnRpdGxlIHx8IHcubmFtZSwKCQkJZ3JvdXA6IHcuZ3JvdXAsCgkJCXdpbmRvdzogdy53aW5kb3csCgkJCXNlY3Rpb246IHcuc2VjdGlvbiwKCQkJbGlua3M6IFt7CgkJCQlsYWJlbDogJ09wZW4nLAoJCQkJaWNvbjogJ2VkaXQnLAoJCQkJb25DbGljazogbyA9PiAkKCIjcG5sIiArIHcubmFtZSkud2luZG93KCdvcGVuJykKCQkJfV0sCgkJfSkpOwoKCQl0aGlzLnNyKCkuZ3JvdXBCeSh0aGlzLmVsZW1lbnRzLmZpbHRlcihlID0+IGUud2luZG93KSwgImdyb3VwIikuZm9yRWFjaChrdiA9PiB7CgkJCWlmICgha3Yua2V5KSByZXR1cm47CgoJCQlsZXQgZSA9IHsKCQkJCW5hbWU6ICJfIiArIGt2LmtleSwKCQkJCXRpdGxlOiBrdi5rZXksCgkJCQl0eXBlOiAid2luZG93IiwKCQkJCWdyb3VwOiBrdi5rZXksCgkJCQl3aWR0aDogdGhpcy53aWR0aCAqIDAuOSwKCQkJCWhlaWdodDogdGhpcy5oZWlnaHQgKiAwLjksCgkJCQlsb2FkZXI6IG8gPT4gewoJCQkJCWt2LnZhbHVlcy5maWx0ZXIodiA9PiB2LnR5cGUgIT09ICdsaW5rJyB8fCAodi50eXBlID09ICdsaW5rJyAmJiB2Lm5hbWUuc3RhcnRzV2l0aCgnXycpKSkuZm9yRWFjaCh2ID0+ICQoIiNwbmxfIiArIHYuZ3JvdXAgKyAnLWNlbnRlcicpLmFwcGVuZCgkKCIjZkVsZW1lbnRfIiArIHYubmFtZSkpKTsKCQkJCQlyZXR1cm4gbnVsbDsKCQkJCX0sCgkJCQlidXR0b25zOiBbXS5jb25jYXQuYXBwbHkoW10sIGt2LnZhbHVlcy5maWx0ZXIodiA9PiB2LnR5cGUgPT0gJ2xpbmsnICYmICF2Lm5hbWUuc3RhcnRzV2l0aCgnXycpKS5tYXAodiA9PiBbLi4udi5saW5rcy5tYXAobCA9PiAoewoJCQkJCW5hbWU6IGwubmFtZSB8fCBsLmxhYmVsLAoJCQkJCXRpdGxlOiBsLnRpdGxlIHx8IGwubGFiZWwsCgkJCQkJb25DbGljazogbC5vbkNsaWNrLAoJCQkJCWljb246IGwuaWNvbiwKCQkJCQl3aW5kb3c6IHRydWUsCgkJCQkJZ3JvdXA6IGt2LmtleSwKCQkJCX0pKV0pKSwKCQkJfTsKCQkJdGhpcy5idXR0b25zLnB1c2goLi4uZS5idXR0b25zKTsKCgkJCXRoaXMuZWxlbWVudHMucHVzaChlKTsKCQl9KTsKCgkJdmFyIHJldCA9ICIiOwoJCS8vIGNoZWNrIHRoZSBvcHRpb24gb2YgdXNpbmcgd2luZG93KCkgYXMgYSByZW5kZXJlciBvZiB0aGUgbWFpbiB3aW5kb3cuLi4KCQlpZiAodHJ1ZSkgewoJCQl0aGlzLmVsZW1lbnRzLmZpbHRlcihlID0+ICFlLnpvbmUpLmZvckVhY2goZSA9PiBlLnpvbmUgPSAnY2VudGVyJyk7CgkJCWxldCB3T3B0aW9ucyA9IHsKCQkJCW5hbWU6IG5hbWUgfHwgdGhpcy5uYW1lLAoJCQkJdGl0bGU6IHRpdGxlIHx8IHRoaXMudGl0bGUsCgkJCQl0eXBlOiAnd2luZG93JywKCQkJCXZpc2libGU6IHRydWUsCgkJCQl3aWR0aDogdGhpcy53aWR0aCwKCQkJCWhlaWdodDogdGhpcy5oZWlnaHQsCgkJCQlmaXhlZDogYkZpeGVkLAoJCQkJbGlua3M6IFt7CgkJCQkJaWNvbjogImhlbHAiLAoJCQkJCWFjdGlvbjogbyA9PiAkKCIjcG5sX19Db25zb2xlIikud2luZG93KCdvcGVuJykKCQkJCX1dLAoJCQkJYnV0dG9uczogdGhpcy5idXR0b25zLmZpbHRlcihiID0+ICFiLndpbmRvdyksCgkJCX07CgkJCXRoaXMuc3IoKS5ncm91cEJ5KHRoaXMuZWxlbWVudHMsICd6b25lJykuZmlsdGVyKHpnID0+IHpnLmtleSkuZm9yRWFjaCh6ZyA9PiB7CgkJCQl3T3B0aW9uc1t6Zy5rZXldID0gdGhpcy5yZW5kZXJFbGVtZW50cyh6Zy52YWx1ZXMpOwoJCQl9KTsKCgkJCXJldCA9IHRoaXMud2luZG93KHdPcHRpb25zKTsKCQl9IGVsc2UgewoJCQlyZXQgPSB0aGlzLmhlYWRlcihuYW1lLCB0aXRsZSwgYkZpeGVkLCBbewoJCQkJaWNvbjogImhlbHAiLAoJCQkJYWN0aW9uOiBvID0+ICQoIiNwbmxfX0NvbnNvbGUiKS53aW5kb3coJ29wZW4nKQoJCQl9XSk7CgoJCQlyZXQgKz0gdGhpcy5yZW5kZXJFbGVtZW50cygpOwoKCQkJcmV0ICs9IHRoaXMuZm9vdGVyKGJGaXhlZCk7CgoJCX0KCQkvLyBjb25zb2xlLmxvZyhyZXQpOwoKCQlyZXR1cm4gcmV0OwoJfQoKCWNXaWR0aChvcHRpb25zKSB7CgkJbGV0IHJldCA9IE1hdGguZmxvb3IoKChvcHRpb25zID8gb3B0aW9ucy53aWR0aCA6IG51bGwpIHx8ICh0aGlzLndpZHRoIC8gMykpKTsKCQlpZiAob3B0aW9ucy56b25lID09ICdlYXN0JyB8fCBvcHRpb25zLnpvbmUgPT0gJ3dlc3QnKSB7CgkJCXJldCA9IDAuMjUgKiByZXQ7IC8vIDkwJSBvZiAzLzEwLCB0aGUgd2lkdGggb2YgdGhlIG5vcm1hbCBlbGVtZW50CgkJfSBlbHNlIGlmIChvcHRpb25zICYmIG9wdGlvbnMuZWRpdG9yKSB7CgkJCXJldCA9IHdpbmRvdy5pbm5lcldpZHRoOwoJCX0gZWxzZSBpZiAob3B0aW9ucyAmJiBvcHRpb25zLndpZHRoICYmIHR5cGVvZihvcHRpb25zLndpZHRoKSA9PT0gJ3N0cmluZycpIHsKCQkJcmV0ID0gdGhpcy53aWR0aDsKCQl9IGVsc2UgaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy50eXBlID09ICd3aW5kb3cnICYmICFvcHRpb25zLndpZHRoKSB7CgkJCXJldCA9IHRoaXMud2lkdGggKiAwLjk7CgkJfQoKCQkvLyBjb25zb2xlLmxvZyhvcHRpb25zLm5hbWUgKyAiOiBjV2lkdGggPSAiICsgcmV0LCBvcHRpb25zLnpvbmUpOwoJCXJldHVybiByZXQ7Cgl9CgoJd2luZG93KG9wdGlvbnMpIHsKCQlvcHRpb25zLnRpdGxlID0gb3B0aW9ucy50aXRsZSB8fCBvcHRpb25zLm5hbWU7CgkJdmFyIHJldCA9IGAKCQk8ZGl2IGlkID0gInBubCR7b3B0aW9ucy5uYW1lfSIgY2xhc3M9ImVhc3l1aS13aW5kb3ciIHRpdGxlPSIke29wdGlvbnMudGl0bGV9IiBkYXRhLW9wdGlvbnM9JyR7dGhpcy5ldmVudEhhbmRsZXJzKG9wdGlvbnMpfSwgY2xvc2VkOiR7IW9wdGlvbnMudmlzaWJsZX0sbWluaW1pemFibGU6JHshb3B0aW9ucy5maXhlZH0sbWF4aW1pemFibGU6JHshb3B0aW9ucy5maXhlZH0sY2xvc2FibGU6JHshb3B0aW9ucy5maXhlZH0sY29sbGFwc2libGU6JHshb3B0aW9ucy5maXhlZH0sZHJhZ2dhYmxlOiR7IW9wdGlvbnMuZml4ZWR9LHJlc2l6YWJsZTokeyFvcHRpb25zLmZpeGVkfSxpY29uQ2xzOiJpY29uLSR7b3B0aW9ucy5pY29ufSIsIHRvb2xzOiIjJHtvcHRpb25zLm5hbWV9X3Rvb2xzIicgc3R5bGU9IndpZHRoOiR7dGhpcy5jV2lkdGgob3B0aW9ucyl9cHg7aGVpZ2h0OiR7dGhpcy5jSGVpZ2h0KG9wdGlvbnMpfXB4O3BhZGRpbmc6MTBweDsiPgoJCSAgICA8ZGl2IGNsYXNzPSJlYXN5dWktbGF5b3V0IiBkYXRhLW9wdGlvbnM9ImZpdDp0cnVlIj4KCQlgOwoKCQlsZXQgYlpvbmUgPSBvcHRpb25zLnNvdXRoID8gJ3NvdXRoJyA6ICh0aGlzLnpvbmVzLmZpbmQoeiA9PiB6ID09ICdzb3V0aCcpIHx8IHRoaXMuem9uZXNbMF0pOwoJCW9wdGlvbnNbYlpvbmVdID0gb3B0aW9uc1tiWm9uZV0gfHwgW107CgkJbGV0IHpXaWR0aCA9IE1hdGgubWluKDEyMCwgdGhpcy53aWR0aCAqIDAuOTUgLyAob3B0aW9ucy5idXR0b25zID8gb3B0aW9ucy5idXR0b25zLmxlbmd0aCA6IDEpLCB0aGlzLmNXaWR0aChvcHRpb25zKSk7CgkJb3B0aW9uc1tiWm9uZV0ucHVzaChgPGRpdiBpZD0icG5sJHtvcHRpb25zLm5hbWV9LWJ1dHRvbnMiIGRhdGEtb3B0aW9ucz0icmVnaW9uOicke2Jab25lfScsYm9yZGVyOmZhbHNlIiBzdHlsZT0idGV4dC1hbGlnbjpyaWdodDtwYWRkaW5nOjVweCAwIDA7Ij5gICsgJC5tYXAoJC5ncmVwKG9wdGlvbnMuYnV0dG9ucyB8fCBbXSwgYiA9PiAhYi5pZ25vcmUpLCBiID0+IGA8YSBpZD0nJHtiLm5hbWV9JyBocmVmPSJqYXZhc2NyaXB0OnZvaWQoMCkiIGNsYXNzPSJlYXN5dWktbGlua2J1dHRvbiBjNiIgaWNvbkNscz0iaWNvbi0ke2IuaWNvbiB8fCAnc2F2ZSd9IiBzdHlsZT0id2lkdGg6JHt6V2lkdGh9cHgiIG9uY2xpY2s9J3RoaXMuZG9DbGljaygke19GckVNRC5fdG9KUyhiKX0pJz4ke2IudGl0bGUgfHwgYi5uYW1lfTwvYT4mbmJzcDsmbmJzcDtgKS5qb2luKCcnKSArIGA8L2Rpdj5gKTsKCgkJdGhpcy56b25lcy5maWx0ZXIoeiA9PiBvcHRpb25zW3pdKS5mb3JFYWNoKHogPT4gewoJCQlyZXQgKz0gYAoJCSAgICAgICAgPGRpdiBkYXRhLW9wdGlvbnM9InJlZ2lvbjonJHt6fSciIHRpdGxlPSIkeyh6PT0nd2VzdCcgfHwgej09J2Vhc3QnKT8nJm5ic3A7JzonJ30iIHN0eWxlPSdoZWlnaHQ6JHsoej09J25vcnRoJ3x8ej09J3NvdXRoJyk/MTA6MTAwfSU7d2lkdGg6JHsoKHo9PSdlYXN0J3x8ej09J3dlc3QnKT8wLjE6MSkqdGhpcy5jV2lkdGgob3B0aW9ucyl9cHgnPgogICAgICAgIAkJICAgICR7KEFycmF5LmlzQXJyYXkob3B0aW9uc1t6XSk/b3B0aW9uc1t6XTpbb3B0aW9uc1t6XV0pLmpvaW4oJycpfQogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIGA7CgkJfSk7CgoJCXJldCArPSBgPC9kaXY+PC9kaXY+YDsKCgkJLy8gbGlua3MgKHRvb2xzKQoJCWxldCBsaW5rcyA9ICQuZ3JlcChbXS5jb25jYXQob3B0aW9ucy5saW5rcyB8fCBbXSksIGwgPT4gIWwuaWdub3JlKTsKCQlyZXQgKz0gYDxkaXYgaWQ9IiR7b3B0aW9ucy5uYW1lfV90b29scyI+YCArICQubWFwKGxpbmtzLnJldmVyc2UoKSwgbCA9PiBgPGEgaHJlZj0iamF2YXNjcmlwdDp2b2lkKDApIiBzdHlsZT0iY29sb3I6YmxhY2siIGNsYXNzPSJmYXMgZmEtJHtsLmljb24gfHwgJ2FkZCd9IiBvbmNsaWNrPScoYXN5bmMgKCkgPT4ge3ZhciBhID0gJHtfRnJFTUQuX3RvSlMobCl9OyAkKCIjcG5sJHtvcHRpb25zLm5hbWV9Iikud2luZG93KCJzZXRUaXRsZSIsICIke29wdGlvbnMudGl0bGV9OiAiICsgYS5uYW1lKTsgYXdhaXQgYS5hY3Rpb24oREZvcm0uZ2V0KCksIGEsICR7X0ZyRU1ELl90b0pTKG9wdGlvbnMpfSk7ICQoIiNwbmwke29wdGlvbnMubmFtZX0iKS53aW5kb3coInNldFRpdGxlIiwgIiR7b3B0aW9ucy50aXRsZX0iKTt9KSgpJz48L2E+YCkuam9pbignXG4nKSArIGA8L2Rpdj5gOwoKCQlyZXR1cm4gcmV0OwoJfQoKCWFzeW5jIF9lbmQoKSB7CgkJbGV0IG8gPSB0aGlzLmdldCgpOwoKCQkvLyBkbyBub3QgdXNlIHRoZSBmaXJzdCBidXR0b24sIGJlY2F1c2UgbWFueSBmb3JtcyBoYXZlIGEgQ2FuY2VsIGJ1dHRvbiBvbmx5CgkJbGV0IGJ1dHRvbiA9IHRoaXMuYnV0dG9ucy5maW5kKGIgPT4gYi5hdXRvU3VibWl0KSAvKiB8fCB0aGlzLmJ1dHRvbnNbMF0qLyA7CgkJaWYgKGJ1dHRvbiAmJiBvICYmIE9iamVjdC52YWx1ZXMobykubGVuZ3RoICYmICh0eXBlb2YoYnV0dG9uLmF1dG9TdWJtaXQpID09PSAidW5kZWZpbmVkIiB8fCBidXR0b24uYXV0b1N1Ym1pdCkpIHsKCQkJbGV0IHYgPSBPYmplY3QudmFsdWVzKG8pLnJlZHVjZSgodCwgdikgPT4gewoJCQkJcmV0dXJuICgodHlwZW9mKHYpICE9PSAib2JqZWN0IikgPyAxIDogMCkgKiAodiA/IDEgOiAwKTsKCQkJfSk7CgkJCS8vY29uc29sZS5sb2cobywgT2JqZWN0LnZhbHVlcyhvKSwgdik7CgkJCWlmICh2KSB7CgkJCQkvLyBhbGwgZmllbGRzIGhhdmUgdmFsdWVzCgkJCQlhd2FpdCB0aGlzLmRvQ2xpY2soYnV0dG9uKTsKCgkJCX0KCQl9Cgl9CgoJZm9vdGVyKGJGaXhlZCkgewoJCXJldHVybiBgPC9mb3JtPmAgKyBgPGRpdiBpZD0iZGxnLWJ1dHRvbnMiPmAgKyB0aGlzLmJ1dHRvbnMuZmlsdGVyKGIgPT4gIWIud2luZG93KS5tYXAoYiA9PiBgPGEgaWQ9JyR7Yi5uYW1lfScgaHJlZj0iamF2YXNjcmlwdDp2b2lkKDApIiBjbGFzcz0iZWFzeXVpLWxpbmtidXR0b24gYzYiIGljb25DbHM9Imljb24tJHtiLmljb24gfHwgJ3NhdmUnfSIgc3R5bGU9IndpZHRoOiR7TWF0aC5taW4oMTIwLCB0aGlzLndpZHRoICogMC45NSAvIHRoaXMuYnV0dG9ucy5sZW5ndGgsIHRoaXMuY1dpZHRoKCkpfXB4IiBvbmNsaWNrPSd0aGlzLmRvQ2xpY2soJHtfRnJFTUQuX3RvSlMoYil9KSc+JHtiLnRpdGxlIHx8IGIubmFtZX08L2E+Jm5ic3A7Jm5ic3A7YCkuam9pbignJykgKyAiPC9kaXY+IiArIChiRml4ZWQgPyAiIiA6ICc8L2Rpdj4nKTsKCX0KCgloZWFkZXIobmFtZSwgdGl0bGUsIGJGaXhlZCwgbGlua3MpIHsKCQl0aGlzLnRpdGxlID0gdGl0bGUgfHwgdGhpcy50aXRsZTsKCQluYW1lID0gbmFtZSB8fCB0aGlzLm5hbWU7CgkJdmFyIHJldCA9ICcnOwoKCQlyZXQgKz0gdGhpcy53aW5kb3coewoJCQluYW1lOiAiX19Db25zb2xlIiwKCQkJdHlwZTogIndpbmRvdyIsCgkJCWVkaXRvcjogdHJ1ZSwKCQkJbG9hZGVyOiBvID0+IHdpbmRvdy5sb2dzLnNsaWNlKCkucmV2ZXJzZSgpLm1hcChsID0+IGwuZGF0ZS50b0lTT1N0cmluZygpICsgIjogIiArIGwuYXJncy5tYXAocyA9PiB0eXBlb2YocykgPT09ICdvYmplY3QnID8gKChvYmosIGluZGVudCA9IDIpID0+IHsKCQkJCWxldCBjYWNoZSA9IFtdOwoJCQkJY29uc3QgcmV0VmFsID0gSlNPTi5zdHJpbmdpZnkoCgkJCQkJb2JqLAoJCQkJCShrZXksIHZhbHVlKSA9PgoJCQkJCXR5cGVvZiB2YWx1ZSA9PT0gIm9iamVjdCIgJiYgdmFsdWUgIT09IG51bGwgPwoJCQkJCWNhY2hlLmluY2x1ZGVzKHZhbHVlKSA/CgkJCQkJdW5kZWZpbmVkIC8vIER1cGxpY2F0ZSByZWZlcmVuY2UgZm91bmQsIGRpc2NhcmQga2V5CgkJCQkJOgoJCQkJCWNhY2hlLnB1c2godmFsdWUpICYmIHZhbHVlIC8vIFN0b3JlIHZhbHVlIGluIG91ciBjb2xsZWN0aW9uCgkJCQkJOgoJCQkJCXZhbHVlLAoJCQkJCWluZGVudAoJCQkJKTsKCQkJCWNhY2hlID0gbnVsbDsKCQkJCXJldHVybiByZXRWYWw7CgkJCX0pKHMpIDogcykuam9pbignLCAnKSkuam9pbignXG4nKSwKCQl9KTsKCgkJaWYgKCFiRml4ZWQpIHsKCQkJbGlua3MgPSAobGlua3MgfHwgW10pLmZpbHRlcihsID0+ICFsLmlnbm9yZSk7CgkJCWxldCB0RGF0YSA9ICIiOwoJCQlpZiAobGlua3MubGVuZ3RoKSB7CgkJCQlyZXQgKz0gYDxkaXYgaWQ9IiR7dGhpcy5uYW1lfV90b29scyI+YCArIGxpbmtzLm1hcChsID0+IGA8YSBocmVmPSJqYXZhc2NyaXB0OnZvaWQoMCkiIGNsYXNzPSJpY29uLSR7bC5pY29ufSIgb25jbGljaz0nKGFzeW5jICgpID0+IHt2YXIgYSA9ICR7X0ZyRU1ELl90b0pTKGwpfTsgJCgiI3dpbiR7dGhpcy5uYW1lfSIpLndpbmRvdygic2V0VGl0bGUiLCAiJHt0aGlzLnRpdGxlfTogIiArIGEubmFtZSk7IGF3YWl0IGEuYWN0aW9uKERGb3JtLmdldCgpKTsgJCgiI3dpbiR7dGhpcy5uYW1lfSIpLndpbmRvdygic2V0VGl0bGUiLCAiJHt0aGlzLnRpdGxlfSIpO30pKCknPjwvYT5gKS5qb2luKCdcbicpICsgIjwvZGl2PiI7CgkJCQl0RGF0YSA9IGAsdG9vbHM6IiMke3RoaXMubmFtZX1fdG9vbHMiYDsKCQkJfQoJCQlyZXQgKz0gYDxkaXYgaWQ9J3dpbiR7dGhpcy5uYW1lfScgY2xhc3M9J2Vhc3l1aS13aW5kb3cnIHRpdGxlPScke3RoaXMudGl0bGV9JyBkYXRhLW9wdGlvbnM9J2ljb25DbHM6Imljb24tc2F2ZSIgJHt0RGF0YX0nIHN0eWxlPSd3aWR0aDoke3RoaXMud2lkdGh9cHg7aGVpZ2h0OiR7dGhpcy5oZWlnaHR9cHg7cGFkZGluZzoxMHB4Oyc+YDsKCQl9CgkJcmV0dXJuIHJldCArIGA8Zm9ybSBpZD0iZnJtJHt0aGlzLm5hbWV9IiBtZXRob2Q9InBvc3QiIG5vdmFsaWRhdGU+YDsKCX0KCglyZW5kZXJFbGVtZW50cyhlbGVtZW50cykgewoJCWVsZW1lbnRzID0gZWxlbWVudHMgfHwgdGhpcy5lbGVtZW50czsKCgkJdmFyIHRXaWR0aCA9IE1hdGguZmxvb3IodGhpcy53aWR0aCAqIDAuOTUpOwoJCXZhciB0SGVpZ2h0ID0gTWF0aC5mbG9vcih0aGlzLmhlaWdodCAqIDAuODUpOwoKCQlsZXQgcmV0ID0gJyc7CgkJdmFyIGdFbGVtZW50cyA9IHRoaXMuc3IoKS5ncm91cEJ5KGVsZW1lbnRzLCAiZ3JvdXAiKTsKCQlpZiAoZ0VsZW1lbnRzLmxlbmd0aCA+IDEpIHJldCArPSBgPGRpdiBpZD0idGJjV2luZG93IiBjbGFzcz0iZWFzeXVpLXRhYnMiIGRhdGEtb3B0aW9ucz0nJHt0aGlzLmV2ZW50SGFuZGxlcnMoe3R5cGU6ICd0YWJzJ30pfScgc3R5bGU9IndpZHRoOiR7dFdpZHRofXB4O2hlaWdodDoke3RIZWlnaHR9cHg7Ij5gOwoJCWZvciAodmFyIGcgPSAwOyBnIDwgZ0VsZW1lbnRzLmxlbmd0aDsgZysrKSB7CgkJCWlmIChnRWxlbWVudHMubGVuZ3RoID4gMSkgcmV0ICs9ICc8ZGl2IHRpdGxlPSInICsgKGdFbGVtZW50c1tnXS5rZXkgfHwgIk1haW4iKSArICciIHN0eWxlPSJwYWRkaW5nOjIwcHg7ZGlzcGxheTpub25lOyI+JzsKCQkJdmFyIHNFbGVtZW50cyA9IHRoaXMuc3IoKS5ncm91cEJ5KGdFbGVtZW50c1tnXS52YWx1ZXMsICJzZWN0aW9uIik7CgkJCWlmIChzRWxlbWVudHMubGVuZ3RoID4gMSkgcmV0ICs9ICc8ZGl2IGNsYXNzPSJlYXN5dWktYWNjb3JkaW9uIiBzdHlsZT0id2lkdGg6JyArIHRXaWR0aCArICdweDtoZWlnaHQ6JyArIC8qdEhlaWdodCovICIxMDAlIiArICdweDsiPic7CgkJCWZvciAodmFyIHMgPSAwOyBzIDwgc0VsZW1lbnRzLmxlbmd0aDsgcysrKSB7CgkJCQlyZXQgKz0gYDxkaXYgdGl0bGU9IiR7c0VsZW1lbnRzW3NdLmtleSB8fCAiIn0iIGRhdGEtb3B0aW9ucz0iaWNvbkNsczonaWNvbi1tb3JlJyIgc3R5bGU9InBhZGRpbmc6MTBweDsiPmA7CgkJCQlmb3IgKHZhciBpID0gMDsgaSA8IHNFbGVtZW50c1tzXS52YWx1ZXMubGVuZ3RoOyBpKyspIHsKCQkJCQl2YXIgZSA9IHNFbGVtZW50c1tzXS52YWx1ZXNbaV07CgkJCQkJaWYgKGUuaWdub3JlKSBjb250aW51ZTsKCQkJCQllLnZhbHVlID0gZS52YWx1ZSB8fCBfRnJFTUQuaGFzaFtlLm5hbWVdIHx8IChfRnJFTUQuYXBpU2VydmVyID8gX0ZyRU1ELmFwaVNlcnZlci5fX2NvbmZpZygndGVzdF8nICsgZS5uYW1lLCAnJykgOiAnJyk7CgkJCQkJcmV0ICs9IGA8ZGl2IGlkPSJmRWxlbWVudF8ke2UubmFtZX0iIGNsYXNzPSJmaXRlbSIgc3R5bGU9ImRpc3BsYXk6ICR7KGUudHlwZT09J3dpbmRvdycgfHwgZS5oaWRkZW4pPydub25lJzonJ30iPmA7CgkJCQkJaWYgKGUudG9nZ2xlKSB7CgkJCQkJCXJldCArPSBgPGEgaHJlZj0iIyIgY2xhc3M9ImVhc3l1aS1saW5rYnV0dG9uIiBkYXRhLW9wdGlvbnM9JyR7dGhpcy5ldmVudEhhbmRsZXJzKHt0eXBlOiAndG9nZ2xlJywgZm9yOiBlfSl9LHBsYWluOnRydWUsaWNvbkNsczoiaWNvbi0ke2UuaWNvbiB8fCAnc2VhcmNoJ30iJyBzdHlsZT0id2lkdGg6MTAwcHg7aGVpZ2h0OjMwcHgiPiR7ZS50aXRsZSB8fCB0aGlzLmVuZ2xpc2goZS5uYW1lKX08L2E+YDsKCQkJCQl9IGVsc2UgewoJCQkJCQlyZXQgKz0gYDxsYWJlbD4ke2UudGl0bGUgfHwgdGhpcy5lbmdsaXNoKGUubmFtZSl9OjwvbGFiZWw+YDsKCQkJCQl9CgkJCQkJaWYgKGUudHlwZSAmJiB0aGlzW2UudHlwZV0pIHsKCQkJCQkJcmV0ICs9IHRoaXNbZS50eXBlXShlKTsKCQkJCQl9IGVsc2UgaWYgKGUucmVuZGVyKSB7CgkJCQkJCXJldCArPSBlLnJlbmRlcigpOwoJCQkJCX0KCQkJCQlyZXQgKz0gJzwvZGl2Pic7CgkJCQl9CgkJCQlyZXQgKz0gJzwvZGl2Pic7CgkJCX0KCQkJaWYgKHNFbGVtZW50cy5sZW5ndGggPiAxKSByZXQgKz0gJzwvZGl2Pic7CgkJCWlmIChnRWxlbWVudHMubGVuZ3RoID4gMSkgcmV0ICs9ICI8L2Rpdj4iOwoJCX0KCQlpZiAoZ0VsZW1lbnRzLmxlbmd0aCA+IDEpIHJldCArPSAiPC9kaXY+IjsKCQlyZXR1cm4gcmV0OwoJfQoKCWluZm8obXNnKSB7CgkJaWYgKCQubWVzc2FnZXIpIHsKCQkJJC5tZXNzYWdlci5hbGVydCh0aGlzLnRpdGxlLCBtc2csICdpbmZvJyk7CgkJfSBlbHNlIHsKCQkJdGhpcy5zcigpLlNob3dNZXNzYWdlKG1zZywgdGhpcy50aXRsZSk7CgkJfQoJfQoKCWVycm9yKG1zZykgewoJCWlmICgkLm1lc3NhZ2VyKSB7CgkJCSQubWVzc2FnZXIuYWxlcnQodGhpcy50aXRsZSwgbXNnLCAnZXJyb3InKTsKCQl9IGVsc2UgewoJCQl0aGlzLnNyKCkuU2hvd01lc3NhZ2UobXNnLCB0aGlzLnRpdGxlKTsKCQl9Cgl9CgoJYnlOYW1lKG5hbWUpIHsKCQlyZXR1cm4gdGhpcy5lbGVtZW50cy5maW5kKGUgPT4gZS5uYW1lID09PSBuYW1lKTsKCX0KfTs=",
	"__keys": ["name"],
	"active": true,
	"enabled": true,
	"__trMap": []
}