{
	"Id": "78110c50ba7670c96081d1e98f180bd2b5f25d71",
	"after": null,
	"async": null,
	"before": null,
	"date": "undefined",
	"name": "DynaForm",
	"order": null,
	"remark": "dW5kZWZpbmVk",
	"script": "d2luZG93LkR5bmFGb3JtID0gY2xhc3MgewoJY29uc3RydWN0b3IoKSB7CgkJdGhpcy50aXRsZSA9ICJGb3JtIFRpdGxlIjsKCQl0aGlzLm5hbWUgPSAiZnJtRm9ybSI7CgkJdGhpcy5lbGVtZW50cyA9IFtdOwoJCXRoaXMuc2VsZWN0cyA9IFtdOwoJCXRoaXMuZ3JpZHMgPSBbXTsKCQl0aGlzLmJ1dHRvbnMgPSBbXTsKCQl0aGlzLnpvbmVzID0gWydub3J0aCcsICdzb3V0aCcsICdlYXN0JywgJ3dlc3QnLCAnY2VudGVyJ107CgkJdGhpcy5zVGFibGUgPSBudWxsOwoJCXRoaXMuYkRlYnVnID0gZmFsc2U7CgkJdGhpcy51aVR5cGVzID0gewoJCQlpbnQ6ICJudW1iZXJzcGlubmVyIiwKCQkJbWVudTogInNwbGl0YnV0dG9uIiwKCQkJZGF0ZXRpbWU6ICJkYXRldGltZWJveCIsCgkJCWJvb2w6ICJzd2l0Y2hidXR0b24iLAoJCQlmaWxlOiAiZmlsZWJveCIsCgkJCXRleHQ6ICJ0ZXh0Ym94IiwKCQkJcGFzc3dvcmQ6ICJwYXNzd29yZGJveCIsCgkJCXN0cmluZzogInRleHRib3giLAoJCQlpbWFnZTogImRpYWxvZyIsCgkJCXByb2dyZXNzOiAicHJvZ3Jlc3NiYXIiLAoJCQlsaW5rOiAibGlua2J1dHRvbiIsCgkJCXRyZWU6ICJjb21ib3RyZWUiLAoJCQluYXZpZ2F0aW9uOiAidHJlZSIsCgkJCXNlYXJjaDogJ3NlYXJjaGJveCcsCgkJfTsKCQl0aGlzLmV2ZW50cyA9IFt7CgkJCW5hbWU6ICdvbkNsaWNrJywKCQkJaGFuZGxlcjogJ29uVG9nZ2xlJywKCQkJcGFyYW1zOiAnbj1ldmVudCcsCgkJCXR5cGU6ICd0b2dnbGUnLAoJCX0sIHsKCQkJbmFtZTogJ29uQ2xvc2UnLAoJCQloYW5kbGVyOiAnUGFuT25DbG9zZScsCgkJCXBhcmFtczogJ249ZXZlbnQnLAoJCQl0eXBlOiAnd2luZG93JywKCQl9LCB7CgkJCW5hbWU6ICdvblNlbGVjdCcsCgkJCWhhbmRsZXI6ICdTZWxlY3RDaGFuZ2UnLAoJCQlwYXJhbXM6ICduJywKCQkJdHlwZTogJ3RhYnMnLAoJCX0sIHsKCQkJbmFtZTogJ3NlYXJjaGVyJywKCQkJaGFuZGxlcjogJ0ZpZWxkQ2hhbmdlJywKCQkJcGFyYW1zOiAnbiwgbycsCgkJCXR5cGU6ICdzZWFyY2hib3gnLAoJCX0sIHsKCQkJbmFtZTogJ29uQmVmb3JlRXhwYW5kJywKCQkJaGFuZGxlcjogJ0V4cGFuZCcsCgkJCXBhcmFtczogJ24nLAoJCQl0eXBlOiAndHJlZScsCgkJfSwgewoJCQluYW1lOiAnb25DaGFuZ2UnLAoJCQloYW5kbGVyOiAnRmllbGRDaGFuZ2UnLAoJCQlwYXJhbXM6ICduLCBvJwoJCX0sIHsKCQkJbmFtZTogJ29uQmVmb3JlT3BlbicsCgkJCWhhbmRsZXI6ICdQYW5lbE9wZW4nLAoJCQlwYXJhbXM6ICcnLAoJCQl0eXBlOiAnd2luZG93JywKCQl9LCB7CgkJCW5hbWU6ICdvbk9wZW4nLAoJCQloYW5kbGVyOiAnUGVuZEFmdGVyT3BlbicsCgkJCXBhcmFtczogJycsCgkJCXR5cGU6ICd3aW5kb3cnLAoJCX0sIHsKCQkJbmFtZTogJ29uQ2xpY2snLAoJCQloYW5kbGVyOiAnZG9MaW5rJywKCQkJcGFyYW1zOiAnbj1ldmVudCwgbycsCgkJCXR5cGU6ICdsaW5rJywKCQl9LCB7CgkJCW5hbWU6ICdvbkNsaWNrUm93JywKCQkJaGFuZGxlcjogJ0ZpZWxkQ2hhbmdlJywKCQkJcGFyYW1zOiAnbiwgbycsCgkJCXR5cGU6ICdncmlkJywKCQl9XTsKCgkJaWYgKHR5cGVvZigkKSAhPT0gJ3VuZGVmaW5lZCcpICQod2luZG93KS5yZXNpemUodGhpcy53aW5kb3dSZXNpemVkKTsKCQl0aGlzLndpbmRvd1Jlc2l6ZWQoKTsKCX0KCglzcigpIHsKCQlyZXR1cm4gdHlwZW9mKF9GckVNRCkgIT09ICd1bmRlZmluZWQnID8gX0ZyRU1ELnNyKCkgOiB3aW5kb3cuc3I7Cgl9CgoJcGFyc2UoKSB7CgkJJC5wYXJzZXIucGFyc2UoKTsKCX0KCgl3aW5kb3dSZXNpemVkKCkgewoJCXRoaXMud2lkdGggPSB3aW5kb3cuaW5uZXJXaWR0aDsKCQl0aGlzLmhlaWdodCA9IHdpbmRvdy5pbm5lckhlaWdodCAqIDAuODsKCX0KCglpbml0KCkgewoJCXZhciBzZWxlY3QgPSB7CgkJCWluaXQ6IGZ1bmN0aW9uKGNvbnRhaW5lciwgb3B0aW9ucykgewoJCQkJdmFyIG9wID0gbnVsbDsKCQkJCXZhciBmb3AgPSBudWxsOwoJCQkJZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmdyaWRzLmxlbmd0aDsgaSsrKQoJCQkJCWlmICh0cnVlIHx8IHRoaXMuZ3JpZHNbaV0uaWQgPT0gb3B0aW9ucy5zb3VyY2UpIG9wID0gdGhpcy5ncmlkc1tpXS5vcHRpb25zOwoJCQkJZm9yIChpID0gMDsgaSA8IG9wLmNvbHVtbnMubGVuZ3RoOyBpKyspCgkJCQkJaWYgKG9wLmNvbHVtbnNbaV0ubmFtZSA9PSBvcHRpb25zLmZpZWxkKSBmb3AgPSBvcC5jb2x1bW5zW2ldOwoJCQkJZm9wLndpZHRoID0gKHRoaXMud2lkdGggLyAzKTsKCQkJCXZhciBlID0gJCh0aGlzLnNlbGVjdChmb3ApKTsKCQkJCXZhciBpbnB1dCA9IGUuYXBwZW5kVG8oY29udGFpbmVyKTsKCQkJCWlucHV0LmNvbWJvZ3JpZCgpOwoJCQkJdGhpcy5iaW5kKGlucHV0KTsKCQkJCXJldHVybiBpbnB1dDsKCQkJfSwKCQkJZGVzdHJveTogZnVuY3Rpb24odGFyZ2V0KSB7CgkJCQkkKHRhcmdldCkucmVtb3ZlKCk7CgkJCX0sCgkJCWdldFZhbHVlOiBmdW5jdGlvbih0YXJnZXQpIHsKCQkJCXJldHVybiAkKHRhcmdldCkudmFsKCk7CgkJCX0sCgkJCXNldFZhbHVlOiBmdW5jdGlvbih0YXJnZXQsIHZhbHVlKSB7CgkJCQkkKHRhcmdldCkudmFsKHZhbHVlKTsKCQkJfSwKCQkJcmVzaXplOiBmdW5jdGlvbih0YXJnZXQsIHdpZHRoKSB7CgkJCQkkKHRhcmdldCkuX291dGVyV2lkdGgod2lkdGgpOwoJCQl9CgkJfTsKCQkkLmV4dGVuZCgkLmZuLmRhdGFncmlkLmRlZmF1bHRzLmVkaXRvcnMsIHsKCQkJZGF0ZXRpbWU6IHsKCQkJCWluaXQ6IGZ1bmN0aW9uKGNvbnRhaW5lciwgb3B0aW9ucykgewoJCQkJCW9wdGlvbnMud2lkdGggPSB0aGlzLmNXaWR0aChvcHRpb25zKTsKCQkJCQl2YXIgaW5wdXQgPSAkKHRoaXMuZGF0ZXRpbWUob3B0aW9ucykpLmFwcGVuZFRvKGNvbnRhaW5lcik7CgkJCQkJaW5wdXQuZGF0ZXRpbWVib3goKTsKCQkJCQlyZXR1cm4gaW5wdXQ7CgkJCQl9LAoJCQkJZGVzdHJveTogZnVuY3Rpb24odGFyZ2V0KSB7CgkJCQkJJCh0YXJnZXQpLnJlbW92ZSgpOwoJCQkJfSwKCQkJCWdldFZhbHVlOiBmdW5jdGlvbih0YXJnZXQpIHsKCQkJCQlyZXR1cm4gJCh0YXJnZXQpLnZhbCgpOwoJCQkJfSwKCQkJCXNldFZhbHVlOiBmdW5jdGlvbih0YXJnZXQsIHZhbHVlKSB7CgkJCQkJJCh0YXJnZXQpLnZhbCh2YWx1ZSk7CgkJCQl9LAoJCQkJcmVzaXplOiBmdW5jdGlvbih0YXJnZXQsIHdpZHRoKSB7CgkJCQkJJCh0YXJnZXQpLl9vdXRlcldpZHRoKHdpZHRoKTsKCQkJCX0KCQkJfSwKCQkJY2hlY2tib3g6IHsKCQkJCWluaXQ6IGZ1bmN0aW9uKGNvbnRhaW5lciwgb3B0aW9ucykgewoJCQkJCXZhciBpbnB1dCA9ICQodGhpcy5ib29sKG9wdGlvbnMpKS5hcHBlbmRUbyhjb250YWluZXIpOwoJCQkJCWlucHV0LnN3aXRjaGJ1dHRvbigpOwoJCQkJCXJldHVybiBpbnB1dDsKCQkJCX0sCgkJCQlkZXN0cm95OiBmdW5jdGlvbih0YXJnZXQpIHsKCQkJCQkkKHRhcmdldCkucmVtb3ZlKCk7CgkJCQl9LAoJCQkJZ2V0VmFsdWU6IGZ1bmN0aW9uKHRhcmdldCkgewoJCQkJCXJldHVybiAkKHRhcmdldCkudmFsKCk7CgkJCQl9LAoJCQkJc2V0VmFsdWU6IGZ1bmN0aW9uKHRhcmdldCwgdmFsdWUpIHsKCQkJCQkkKHRhcmdldCkudmFsKHZhbHVlKTsKCQkJCX0sCgkJCQlyZXNpemU6IGZ1bmN0aW9uKHRhcmdldCwgd2lkdGgpIHsKCQkJCQkkKHRhcmdldCkuX291dGVyV2lkdGgod2lkdGgpOwoJCQkJfQoJCQl9LAoJCQljb21ib3RyZWVncmlkOiBzZWxlY3QsCgkJCXNlbGVjdDogc2VsZWN0LAoJCX0pOwoJfQoKCWFzayhxdWVzdGlvbiwgZkFuc3dlciA9IHYgPT4gdiwgb3B0aW9ucykgewoJCSQubWVzc2FnZXIuY29uZmlybSh0aGlzLnRpdGxlLCBxdWVzdGlvbiwgZnVuY3Rpb24ocikgewoJCQlpZiAob3B0aW9ucykgewoJCQkJZm9yICh2YXIgaSA9IDA7IGkgPCBvcHRpb25zLmxlbmd0aDsgaSsrKSB7CgkJCQkJaWYgKG9wdGlvbnNbaV0uYW5zd2VyID09IHIpIHsKCQkJCQkJcmV0dXJuIGZBbnN3ZXIob3B0aW9uc1tpXS52YWx1ZSk7CgkJCQkJfQoJCQkJfQoJCQl9IGVsc2UgewoJCQkJcmV0dXJuIGZBbnN3ZXIocik7CgkJCX0KCQl9KTsKCX0KCgl0b3BEYXRhKGFyLCBnRmllbGQsIHZGaWVsZCwgdG9wKSB7CgkJaWYgKCF0b3ApIHsKCQkJcmV0dXJuIGFyOwoJCX0KCQlyZXQgPSBbXTsKCQkkLmVhY2godGhpcy5zcigpLmdyb3VwQnkoYXIsIGdGaWVsZCksIGZ1bmN0aW9uKGtleSwgdmFsdWVzKSB7CgkJCXZhbHVlcy52YWx1ZXMuc29ydCgoYSwgYikgPT4gewoJCQkJaWYgKHBhcnNlRmxvYXQoYVt2RmllbGRdKSA8IHBhcnNlRmxvYXQoYlt2RmllbGRdKSkgewoJCQkJCXJldHVybiAxOwoJCQkJfSBlbHNlIGlmIChwYXJzZUZsb2F0KGFbdkZpZWxkXSkgPiBwYXJzZUZsb2F0KGJbdkZpZWxkXSkpIHsKCQkJCQlyZXR1cm4gLTE7CgkJCQl9IGVsc2UgewoJCQkJCXJldHVybiAwOwoJCQkJfQoJCQl9KTsKCQkJJC5lYWNoKHZhbHVlcy52YWx1ZXMsIGZ1bmN0aW9uKGksIHYpIHsKCQkJCWlmIChpIDwgdG9wKSB7CgkJCQkJcmV0LnB1c2godik7CgkJCQl9CgkJCX0pOwoJCX0pOwoJCXJldHVybiByZXQ7Cgl9CgoJYXN5bmMgZG9DbGljayhidXR0b24pIHsKCQlsZXQgX3RoaXMgPSB0eXBlb2YodGhpcy5kb0NsaWNrKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMgOiB3aW5kb3cuREZvcm07CgkJYnV0dG9uID0gX3RoaXMuYnV0dG9ucy5maW5kKGIgPT4gYi5uYW1lID09IGJ1dHRvbi5uYW1lICYmIGIuZ3JvdXAgPT0gYnV0dG9uLmdyb3VwKTsKCQlfdGhpcy5idXN5KHRydWUpOwoJCV90aGlzLnNldCh7CgkJCVdvcmtQcm9ncmVzc1ZhbHVlOiAyMAoJCX0pCgoJCXZhciBvID0gX3RoaXMuZ2V0KCk7CgkJdmFyIHNNaXNzaW5nID0gX3RoaXMuZWxlbWVudHMuZmlsdGVyKGUgPT4gKGJ1dHRvbi53aW5kb3cgPyBidXR0b24uZ3JvdXAgPT0gZS5ncm91cCA6IHRydWUpKS5maWx0ZXIoZSA9PiBlLnJlcXVpcmVkICYmICFvW2UubmFtZV0pLm1hcChlID0+ICI8bGk+IiArIChlLmxhYmVsIHx8IGUubmFtZSkgKyAiPC9saT4iKS5qb2luKCIiKTsKCQlpZiAoc01pc3NpbmcpIHsKCQkJd2luZG93Ll9GckVNRC5fZXJyb3IoIk1pc3NpbmcgbWFuZGF0b3J5IGZpZWxkczo8YnIvPjx1bD4iICsgc01pc3NpbmcgKyAiPC91bD4iLCA1MDAwKTsKCQkJX3RoaXMuYnVzeShmYWxzZSk7CgkJCXJldHVybjsKCQl9CgkJaWYgKGJ1dHRvbi5vbmNsaWNrKSBhd2FpdCBidXR0b24ub25jbGljayhvKTsKCQlpZiAoYnV0dG9uLm9uQ2xpY2spIGF3YWl0IGJ1dHRvbi5vbkNsaWNrKG8pOwoJCV90aGlzLmJ1c3koZmFsc2UpOwoJfQoKCWJ1c3koYkJ1c3kpIHsKCQlpZiAoIWJCdXN5KSB7CgkJCXZhciB0b3RhbCA9IDA7CgkJCWlmICh0eXBlb2YgbW9tZW50ICE9PSAndW5kZWZpbmVkJykgewoJCQkJdG90YWwgPSBtb21lbnQoKS5kaWZmKG1vbWVudCh0aGlzLmJ1c3lTdGFtcCksICdzZWNvbmRzJyk7CgkJCX0gZWxzZSB7CgkJCQkvLyBubyBtb21lbnQsIHVzZSBzdGFuZGFyZCBEYXRlCgkJCQl0b3RhbCA9IChuZXcgRGF0ZSgpLmdldFRpbWUoKSAtIHRoaXMuYnVzeVN0YW1wID8gdGhpcy5idXN5U3RhbXAuZ2V0VGltZSgpIDogMCkgLyAxMDAwIC8gMzYwMDsKCQkJfQoJCQlpZiAodGhpcy5iRGVidWcpIHsKCQkJCXdpbmRvdy5fRnJFTUQuX2FsZXJ0KCJFeGVjdXRpb24gVGltZTogIiArIHRvdGFsICsgIiBzZWNvbmRzLiIpOwoJCQl9CgkJCWRlbGV0ZSB0aGlzLmJ1c3lTdGFtcDsKCgkJCXNldEludGVydmFsKDEsICgpID0+IHRoaXMuU2V0KHsKCQkJCUxvYWRpbmc6IDEwCgkJCX0pKTsKCQl9IGVsc2UgewoJCQl0aGlzLmJ1c3lTdGFtcCA9IG5ldyBEYXRlKCk7CgkJfQoKCQkkLmVhY2goJC5tZXJnZSgkLm1hcCh0aGlzLmJ1dHRvbnMsIGIgPT4gYi5uYW1lKSwgJC5tYXAodGhpcy5lbGVtZW50cy5maWx0ZXIoZSA9PiBlLnR5cGUgPT0gJ2xpbmsnKSwgZSA9PiBlLm5hbWUpKSwgKF8sIGUpID0+ICQoJyMnICsgZSkubGlua2J1dHRvbihiQnVzeSA/ICdkaXNhYmxlJyA6ICdlbmFibGUnKSk7Cgl9CgoJcHJlZml4KGUpIHsKCQlzd2l0Y2ggKGUudHlwZSkgewoJCQljYXNlICdsYWJlbCc6CgkJCQlyZXR1cm4gJ2xibCc7CgkJCWNhc2UgJ3RleHQnOgoJCQljYXNlICdzdHJpbmcnOgoJCQljYXNlICdzZWFyY2gnOgoJCQljYXNlICdwYXNzd29yZCc6CgkJCQlyZXR1cm4gJ3R4dCc7CgkJCWNhc2UgIkRhdGVUaW1lIjoKCQkJY2FzZSAiZGF0ZXRpbWUiOgoJCQkJcmV0dXJuICdkdHAnOwoJCQljYXNlICJpbnQiOgoJCQljYXNlICJpbnRlZ2VyIjoKCQkJY2FzZSAibnVtYmVyIjoKCQkJY2FzZSAibG9uZyI6CgkJCWNhc2UgIkxvbmciOgoJCQkJcmV0dXJuICdudWQnOwoJCQljYXNlICdmaWxlJzoKCQkJCXJldHVybiAnZmlsJzsKCQkJY2FzZSAnaW1hZ2UnOgoJCQkJcmV0dXJuICdpbWcnOwoJCQljYXNlICJib29sIjoKCQkJCXJldHVybiAnY2hrJzsKCQkJY2FzZSAid2luZG93IjoKCQkJCXJldHVybiAncG5sJzsKCQkJY2FzZSAicHJvZ3Jlc3MiOgoJCQkJcmV0dXJuICdwcmcnOwoJCQljYXNlICJncmlkIjoKCQkJY2FzZSAidHJlZSI6CgkJCWNhc2UgInNlbGVjdCI6CgkJCQlyZXR1cm4gJ2NtYic7CgkJCWRlZmF1bHQ6CgkJCQlyZXR1cm4gJyc7CgkJfQoJfQoKCWNsZWFyKGdyb3VwKSB7CgkJdmFyIG8gPSB7fTsKCQkkLmVhY2godGhpcy5lbGVtZW50cy5maWx0ZXIoZSA9PiBncm91cCA/IGUuZ3JvdXAgPT0gZ3JvdXAgOiB0cnVlKSwgKF8sIGUpID0+IHsKCQkJdmFyIG5hbWUgPSAoZS5lbXNTb3VyY2UgPyAiXyIgOiAiIikgKyBlLm5hbWU7CgkJCXN3aXRjaCAoZS50eXBlKSB7CgkJCQljYXNlICd0ZXh0JzoKCQkJCWNhc2UgJ3N0cmluZyc6CgkJCQljYXNlICdzZWFyY2gnOgoJCQkJY2FzZSAncGFzc3dvcmQnOgoJCQkJY2FzZSAiRGF0ZVRpbWUiOgoJCQkJY2FzZSAiZGF0ZXRpbWUiOgoJCQkJCW9bbmFtZV0gPSAiIjsKCQkJCQlicmVhazsKCQkJCWNhc2UgImludCI6CgkJCQljYXNlICJudW1iZXIiOgoJCQkJY2FzZSAiaW50ZWdlciI6CgkJCQljYXNlICJsb25nIjoKCQkJCWNhc2UgIkxvbmciOgoJCQkJY2FzZSAicHJvZ3Jlc3MiOgoJCQkJCW9bbmFtZV0gPSAwOwoJCQkJCWJyZWFrOwoJCQkJY2FzZSAidHJlZSI6CgkJCQljYXNlICJzZWxlY3QiOgoJCQkJCW9bbmFtZV0gPSBudWxsOwoJCQkJCWJyZWFrOwoJCQkJY2FzZSAiZ3JpZCI6CgkJCQkJb1tuYW1lXSA/IG9bbmFtZV0uZGF0YSA9IFtdIDogbnVsbDsKCQkJCQlicmVhazsKCQkJCWNhc2UgImJvb2wiOgoJCQkJCW9bbmFtZV0gPSBmYWxzZTsKCQkJCQlicmVhazsKCQkJCWRlZmF1bHQ6CgkJCQkJYnJlYWs7CgkJCX0KCQl9KTsKCQkvL2NvbnNvbGUubG9nKCJjbGVhciIsIG8pOwoJCXRoaXMuc2V0KG8pOwoJCXRoaXMuYnVzeShmYWxzZSk7Cgl9CgoJc2V0KG8sIGVOYW1lKSB7CgkJaWYgKGVOYW1lKSB7CgkJCXZhciBvRWxlbWVudCA9IHRoaXMuYnlOYW1lKGVOYW1lKTsKCQkJaWYgKCFvRWxlbWVudCkgcmV0dXJuOwoJCQl2YXIgYXR0ID0gbnVsbDsKCQkJaWYgKG8gJiYgby5JZCAmJiBvLkVudGl0eUF0dHJpYnV0ZSkgewoJCQkJLy8gYW4gRW50aXR5VmFsdWUKCQkJCWZvciAodmFyIHAgaW4gbykKCQkJCQlpZiAocC5lbmRzV2l0aCgiVmFsdWUiKSkgYXR0ID0gcDsKCQkJCW9FbGVtZW50LmVtc1NvdXJjZSA9IG87CgkJCX0KCQkJdHJ5IHsKCQkJCXN3aXRjaCAob0VsZW1lbnQudHlwZSkgewoJCQkJCWNhc2UgJ2xhYmVsJzoKCQkJCQkJaWYgKGF0dCkgewoJCQkJCQkJJCgiIyIgKyB0aGlzLnByZWZpeChvRWxlbWVudCkgKyBvRWxlbWVudC5uYW1lKS5odG1sKG9bYXR0XSk7CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQkkKCIjIiArIHRoaXMucHJlZml4KG9FbGVtZW50KSArIG9FbGVtZW50Lm5hbWUpLmh0bWwoKG8gJiYgby5FbnRpdHlBdHRyaWJ1dGUpID8gIiIgOiBvKTsKCQkJCQkJfQoJCQkJCQlicmVhazsKCQkJCQljYXNlICd0ZXh0JzoKCQkJCQljYXNlICdzdHJpbmcnOgoJCQkJCWNhc2UgJ3Bhc3N3b3JkJzoKCQkJCQljYXNlICJpbnQiOgoJCQkJCWNhc2UgInNlYXJjaCI6CgkJCQkJY2FzZSAiaW50ZWdlciI6CgkJCQkJY2FzZSAibnVtYmVyIjoKCQkJCQljYXNlICJsb25nIjoKCQkJCQljYXNlICJMb25nIjoKCQkJCQkJaWYgKGF0dCkgewoJCQkJCQkJJCgiIyIgKyB0aGlzLnByZWZpeChvRWxlbWVudCkgKyBvRWxlbWVudC5uYW1lKVt0aGlzLnVpVHlwZXNbb0VsZW1lbnQudHlwZV1dKCJzZXRWYWx1ZSIsIG9bYXR0XSk7CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQkkKCIjIiArIHRoaXMucHJlZml4KG9FbGVtZW50KSArIG9FbGVtZW50Lm5hbWUpW3RoaXMudWlUeXBlc1tvRWxlbWVudC50eXBlXV0oInNldFZhbHVlIiwgKG8gJiYgby5FbnRpdHlBdHRyaWJ1dGUpID8gIiIgOiBvKTsKCQkJCQkJfQoJCQkJCQlicmVhazsKCQkJCQljYXNlICJEYXRlVGltZSI6CgkJCQkJY2FzZSAiZGF0ZXRpbWUiOgoJCQkJCQlpZiAoYXR0KSB7CgkJCQkJCQkkKCIjIiArIHRoaXMucHJlZml4KG9FbGVtZW50KSArIG9FbGVtZW50Lm5hbWUpW3RoaXMudWlUeXBlc1tvRWxlbWVudC50eXBlXV0oJ3NldFZhbHVlJywgKG9bYXR0XSA/IHRoaXMuc3IoKS50b0RhdGVUaW1lKG9bYXR0XSkgOiAiIikpOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJJCgiIyIgKyB0aGlzLnByZWZpeChvRWxlbWVudCkgKyBvRWxlbWVudC5uYW1lKVt0aGlzLnVpVHlwZXNbb0VsZW1lbnQudHlwZV1dKCdzZXRWYWx1ZScsIChvICYmIG8uRW50aXR5QXR0cmlidXRlKSA/ICIiIDogKG8gPyB0aGlzLnNyKCkudG9EYXRlVGltZShvKSA6ICIiKSk7CgkJCQkJCX0KCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAiYm9vbCI6CgkJCQkJCWlmIChhdHQpIHsKCQkJCQkJCSQoIiMiICsgdGhpcy5wcmVmaXgob0VsZW1lbnQpICsgb0VsZW1lbnQubmFtZSlbdGhpcy51aVR5cGVzW29FbGVtZW50LnR5cGVdXSgob1thdHRdID8gJycgOiAndW4nKSArICdjaGVjaycpOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJJCgiIyIgKyB0aGlzLnByZWZpeChvRWxlbWVudCkgKyBvRWxlbWVudC5uYW1lKVt0aGlzLnVpVHlwZXNbb0VsZW1lbnQudHlwZV1dKCgoKG8gJiYgby5FbnRpdHlBdHRyaWJ1dGUpID8gIiIgOiBvKSA/ICcnIDogJ3VuJykgKyAnY2hlY2snKTsKCQkJCQkJfQoJCQkJCQlicmVhazsKCQkJCQljYXNlICJ3aW5kb3ciOgoJCQkJCQlpZiAoYXR0KSB7CgkJCQkJCQlvRWxlbWVudC52YWx1ZSA9IG9bYXR0XTsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCW9FbGVtZW50LnZhbHVlID0gKG8gJiYgby5FbnRpdHlBdHRyaWJ1dGUpID8gIiIgOiBvOwoJCQkJCQl9CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgInByb2dyZXNzIjoKCQkJCQkJdmFyIHYgPSAwOwoJCQkJCQlpZiAoYXR0KSB7CgkJCQkJCQl2ID0gb1thdHRdOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJdiA9IChvICYmIG8uRW50aXR5QXR0cmlidXRlKSA/ICIiIDogbzsKCQkJCQkJfQoJCQkJCQkvL2NvbnNvbGUubG9nKCIjIiArIHRoaXMucHJlZml4KG9FbGVtZW50KSArIG9FbGVtZW50Lm5hbWUsIHRoaXMudWlUeXBlc1tvRWxlbWVudC50eXBlXSwgTWF0aC5yb3VuZCh2ICogMTApIC8gMTApOwoJCQkJCQkkKCIjIiArIHRoaXMucHJlZml4KG9FbGVtZW50KSArIG9FbGVtZW50Lm5hbWUpW3RoaXMudWlUeXBlc1tvRWxlbWVudC50eXBlXV0oJ3NldFZhbHVlJywgTWF0aC5yb3VuZCh2ICogMTApIC8gMTApOwoJCQkJCQlicmVhazsKCQkJCQljYXNlICJncmlkIjoKCQkJCQkJbGV0IGNvbHMgPSBKU09OLnBhcnNlKCJ7IiArIHRoaXMubWFwQ29sdW1ucyhvRWxlbWVudCwgdHJ1ZSkgKyAifSIpOwoJCQkJCQkkLmVhY2goY29scy5jb2x1bW5zWzBdLCAoXywgYykgPT4gYy5mb3JtYXR0ZXIgPSB0aGlzLnNyKCkucnVuU2NyaXB0KHRoaXMuZm9ybWF0dGVyKG9FbGVtZW50Lm5hbWUsIGMpKSk7CgkJCQkJCSQoIiMiICsgdGhpcy5wcmVmaXgob0VsZW1lbnQpICsgb0VsZW1lbnQubmFtZSkuZGF0YWdyaWQoY29scyk7CgkJCQkJCWlmIChhdHQpIHsKCQkJCQkJCSQoIiMiICsgdGhpcy5wcmVmaXgob0VsZW1lbnQpICsgb0VsZW1lbnQubmFtZSkuZGF0YWdyaWQoewoJCQkJCQkJCWRhdGE6IG9bYXR0XQoJCQkJCQkJfSk7CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQkkKCIjIiArIHRoaXMucHJlZml4KG9FbGVtZW50KSArIG9FbGVtZW50Lm5hbWUpLmRhdGFncmlkKHsKCQkJCQkJCQlkYXRhOiAobyAmJiBvLkVudGl0eUF0dHJpYnV0ZSkgPyAiIiA6IG8KCQkJCQkJCX0pOwoJCQkJCQl9CgkJCQkJCSQoIiMiICsgdGhpcy5wcmVmaXgob0VsZW1lbnQpICsgb0VsZW1lbnQubmFtZSkuZGF0YWdyaWQoInVuc2VsZWN0QWxsIik7CgkJCQkJCSQoIiMiICsgdGhpcy5wcmVmaXgob0VsZW1lbnQpICsgb0VsZW1lbnQubmFtZSkuZGF0YWdyaWQoKTsKCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAidHJlZSI6CgkJCQkJCXZhciB2ID0gYXR0ID8gb1thdHRdIDogKChvICYmIG8uRW50aXR5QXR0cmlidXRlKSA/ICIiIDogbyk7CgkJCQkJCWlmIChBcnJheS5pc0FycmF5KHYpKSB7CgkJCQkJCQkkKCIjIiArIHRoaXMucHJlZml4KG9FbGVtZW50KSArIG9FbGVtZW50Lm5hbWUpW3RoaXMudWlUeXBlc1tvRWxlbWVudC50eXBlXV0oInRyZWUiKS50cmVlKCJsb2FkRGF0YSIsIHYpOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJJCgiIyIgKyB0aGlzLnByZWZpeChvRWxlbWVudCkgKyBvRWxlbWVudC5uYW1lKVt0aGlzLnVpVHlwZXNbb0VsZW1lbnQudHlwZV1dKCdzZXRWYWx1ZScsIHYpOwoJCQkJCQl9CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgInNlbGVjdCI6CgkJCQkJCWlmIChhdHQpIHsKCQkJCQkJCWlmIChvRWxlbWVudC5vcHRpb25zKSB7CgkJCQkJCQkJJCgiIyIgKyB0aGlzLnByZWZpeChvRWxlbWVudCkgKyBvRWxlbWVudC5uYW1lKS5jb21ibygnc2V0VmFsdWUnICsgKG9FbGVtZW50Lm11bHRpcGxlID8gJ3MnIDogJycpLCAob1thdHRdID8gb1thdHRdIDogIiIpKTsKCQkJCQkJCQkkKCIjIiArIHRoaXMucHJlZml4KG9FbGVtZW50KSArIG9FbGVtZW50Lm5hbWUpLmNvbWJvKCdzZXRWYWx1ZScgKyAob0VsZW1lbnQubXVsdGlwbGUgPyAncycgOiAnJyksIChvW2F0dF0gPyBvW2F0dF0gOiAiIikpOwoJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQkkKCIjIiArIHRoaXMucHJlZml4KG9FbGVtZW50KSArIG9FbGVtZW50Lm5hbWUpLmNvbWJvZ3JpZCgnc2V0VmFsdWUnICsgKG9FbGVtZW50Lm11bHRpcGxlID8gJ3MnIDogJycpLCAob1thdHRdID8gb1thdHRdIDogIiIpKTsKCQkJCQkJCX0KCQkJCQkJfSBlbHNlIHsKCQkJCQkJCXYgPSBudWxsOwoJCQkJCQkJaWYgKG8gPT09IG51bGwpIHsKCgkJCQkJCQl9IGVsc2UgaWYgKG8uY29uc3RydWN0b3IgPT09IEFycmF5KSB7CgoJCQkJCQkJfSBlbHNlIGlmICghby5FbnRpdHlBdHRyaWJ1dGUpIHsKCQkJCQkJCQl2ID0gbyB8fCB7CgkJCQkJCQkJCUlkOiBvLklkLAoJCQkJCQkJCQlfVG9TdHJpbmc6IG8uX1RvU3RyaW5nLAoJCQkJCQkJCQl0b1N0cmluZzogZnVuY3Rpb24oKSB7CgkJCQkJCQkJCQlyZXR1cm4gdGhpcy5fVG9TdHJpbmc7CgkJCQkJCQkJCX0KCQkJCQkJCQl9OwoJCQkJCQkJfQoJCQkJCQkJaWYgKG9FbGVtZW50Lm9wdGlvbnMpIHsKCQkJCQkJCQkkKCIjIiArIHRoaXMucHJlZml4KG9FbGVtZW50KSArIG9FbGVtZW50Lm5hbWUpLmNvbWJvKCdzZXRWYWx1ZScgKyAob0VsZW1lbnQubXVsdGlwbGUgPyAncycgOiAnJyksIHYpOwoJCQkJCQkJCSQoIiMiICsgdGhpcy5wcmVmaXgob0VsZW1lbnQpICsgb0VsZW1lbnQubmFtZSkuY29tYm8oJ3NldFRleHQnICsgKG9FbGVtZW50Lm11bHRpcGxlID8gJ3MnIDogJycpLCB2KTsKCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJJCgiIyIgKyB0aGlzLnByZWZpeChvRWxlbWVudCkgKyBvRWxlbWVudC5uYW1lKS5jb21ib2dyaWQoJ3NldFZhbHVlJyArIChvRWxlbWVudC5tdWx0aXBsZSA/ICdzJyA6ICcnKSwgdik7CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQkJYnJlYWs7CgkJCQkJZGVmYXVsdDoKCQkJCQkJYnJlYWs7CgkJCQl9CgkJCX0gY2F0Y2ggKGV4KSB7CgkJCQljb25zb2xlLmxvZyhleCk7CgkJCX0KCQl9IGVsc2UgewoJCQlmb3IgKHZhciBwIGluIG8pIHsKCQkJCWlmIChwLmluZGV4T2YoJ18nKSA9PT0gMCkgcCA9IHAuc3Vic3RyaW5nKDEpOwoJCQkJdmFyIGUgPSB0aGlzLmJ5TmFtZShwKTsKCQkJCWlmICghZSB8fCAhZS5uYW1lKSBjb250aW51ZTsKCQkJCXZhciB2YWx1ZSA9IG9bcF07CgkJCQlpZiAoZS5uYW1lID09IHRoaXMuc1RhYmxlKSB7CgkJCQkJdmFsdWUgPSBvOwoJCQkJCXZhbHVlLkRhdGUgPSBuZXcgRGF0ZSgpOwoJCQkJfQoJCQkJaWYgKHAgPT0gIkVudGl0eVZhbHVlcyIpIHsKCQkJCQkvLyBhbiBlbXNGb3JtVmFsdWVzIHNvdXJjZQoJCQkJCS8vIGZpbmQgdGhlIEVudGl0eVZhbHVlIGZvciB0aGlzIGVsZW1lbnQgYW5kIHNldCBpdAoJCQkJCWZvciAodmFyIGogPSAwOyBqIDwgby5FbnRpdHlWYWx1ZXMubGVuZ3RoOyBqKyspIHsKCQkJCQkJaWYgKG8uRW50aXR5VmFsdWVzW2pdLkVudGl0eUF0dHJpYnV0ZS5OYW1lID09IGUubmFtZSkgewoJCQkJCQkJLy8gZm91bmQgdGhlIEVudGl0eVZhbHVlIGZvciB0aGlzIGVsZW1lbnQKCQkJCQkJCV92ID0gby5FbnRpdHlWYWx1ZXNbal07CgkJCQkJCQlmb3IgKHZhciBxIGluIF92KSB7CgkJCQkJCQkJaWYgKHEuZW5kc1dpdGgoIlZhbHVlIikpIHsKCQkJCQkJCQkJX3ZbcV0gPSB2YWx1ZTsKCQkJCQkJCQl9CgkJCQkJCQl9CgkJCQkJCQlicmVhazsKCQkJCQkJfQoJCQkJCX0KCQkJCX0KCQkJCXRoaXMuc2V0KHZhbHVlLCBlLm5hbWUpOwoJCQl9CgkJfQoJfQoKCWdldCgpIHsKCQl2YXIgbyA9IHt9OwoJCWlmICh0aGlzLnNUYWJsZSAmJiB3aW5kb3dbdGhpcy5zVGFibGVdKSBvID0gbmV3IHdpbmRvd1t0aGlzLnNUYWJsZV0oKTsKCQlmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuZWxlbWVudHMubGVuZ3RoOyBpKyspIHsKCQkJdmFyIGNuID0gbnVsbDsKCQkJdmFyIHYgPSBudWxsOwoJCQl0cnkgewoJCQkJbGV0IGVOYW1lID0gIiMiICsgdGhpcy5wcmVmaXgodGhpcy5lbGVtZW50c1tpXSkgKyB0aGlzLmVsZW1lbnRzW2ldLm5hbWU7CgkJCQlzd2l0Y2ggKHRoaXMuZWxlbWVudHNbaV0udHlwZSkgewoJCQkJCWNhc2UgJ2xhYmVsJzoKCQkJCQkJY24gPSAkKGVOYW1lKTsKCQkJCQkJdiA9IGNuLmh0bWwoKTsKCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAndGV4dCc6CgkJCQkJY2FzZSAnc3RyaW5nJzoKCQkJCQljYXNlICdzZWFyY2gnOgoJCQkJCWNhc2UgJ3Bhc3N3b3JkJzoKCQkJCQkJY24gPSAkKGVOYW1lKTsKCQkJCQkJdiA9IGNuLnZhbCgpOwoJCQkJCQlicmVhazsKCQkJCQljYXNlICJmaWxlIjoKCQkJCQljYXNlICJpbWFnZSI6CgkJCQkJCWNuID0gJChlTmFtZSk7CgkJCQkJCXYgPSB0aGlzLmVsZW1lbnRzW2ldLmRhdGE7CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgIkRhdGVUaW1lIjoKCQkJCQljYXNlICJkYXRldGltZSI6CgkJCQkJCXYgPSBuZXcgRGF0ZSgkKGVOYW1lKS5kYXRldGltZWJveCgnZ2V0VmFsdWUnKSk7CgkJCQkJCWNuID0gJChlTmFtZSk7CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgInByb2dyZXNzIjoKCQkJCQkJY24gPSAkKGVOYW1lKTsKCQkJCQkJdiA9IGNuLnByb2dyZXNzYmFyKCdnZXRWYWx1ZScpOwoJCQkJCQlicmVhazsKCQkJCQljYXNlICJpbnQiOgoJCQkJCWNhc2UgImludGVnZXIiOgoJCQkJCWNhc2UgIm51bWJlciI6CgkJCQkJY2FzZSAibG9uZyI6CgkJCQkJY2FzZSAiTG9uZyI6CgkJCQkJCWNuID0gJChlTmFtZSk7CgkJCQkJCXYgPSBwYXJzZUZsb2F0KGNuLnZhbCgpKTsKCQkJCQkJaWYgKGlzTmFOKHYpKSB2ID0gMDsKCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAiZ3JpZCI6CgkJCQkJCWNuID0gJChlTmFtZSk7CgkJCQkJCXYgPSBjbi5kYXRhZ3JpZCgnZ2V0RGF0YScpOwoJCQkJCQl2LnNlbGVjdGVkID0gY24uZGF0YWdyaWQoImdldFNlbGVjdGVkIik7CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgInRyZWUiOgoJCQkJCQljbiA9ICQoZU5hbWUpOwoJCQkJCQl2ID0gY24uY29tYm90cmVlKCJ0cmVlIikudHJlZSgiZ2V0U2VsZWN0ZWQiKTsKCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAid2luZG93IjoKCQkJCQkJdiA9IHRoaXMuZWxlbWVudHNbaV0udmFsdWU7CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgInNlbGVjdCI6CgkJCQkJCWlmICh0aGlzLmVsZW1lbnRzW2ldLm9wdGlvbnMpIHsKCQkJCQkJCXYgPSAkKGVOYW1lKS5jb21ib2dyaWQoJ2dldFZhbHVlJyArICh0aGlzLmVsZW1lbnRzW2ldLm11bHRpcGxlID8gJ3MnIDogJycpKTsKCQkJCQkJCXYgPSB0aGlzLnNyKCkucnVuU2NyaXB0KHYpOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJdiA9ICQoZU5hbWUpLmNvbWJvZ3JpZCgnZ3JpZCcpLmRhdGFncmlkKCdnZXRTZWxlY3Rpb25zJyk7CgkJCQkJCQlpZiAoIXYgfHwgIXYubGVuZ3RoKSB7CgkJCQkJCQkJdiA9ICQoZU5hbWUpLmNvbWJvZ3JpZCgnZ2V0VmFsdWUnICsgKHRoaXMuZWxlbWVudHNbaV0ubXVsdGlwbGUgPyAncycgOiAnJykpOwoJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQlpZiAoIXRoaXMuZWxlbWVudHNbaV0ubXVsdGlwbGUpIHYgPSB2WzBdOwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJCWNuID0gJChlTmFtZSk7CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgImJvb2wiOgoJCQkJCQljbiA9ICQoZU5hbWUpOwoJCQkJCQl2ID0gY24uc3dpdGNoYnV0dG9uKCdvcHRpb25zJykuY2hlY2tlZDsKCQkJCQkJYnJlYWs7CgkJCQkJZGVmYXVsdDoKCQkJCQkJYnJlYWs7CgkJCQl9CgkJCQlvW3RoaXMuZWxlbWVudHNbaV0ubmFtZV0odik7CgkJCX0gY2F0Y2ggKGUpIHsKCQkJCS8vY29uc29sZS5sb2codGhpcy5lbGVtZW50c1tpXS5uYW1lLCBlKTsKCQkJCW9bdGhpcy5lbGVtZW50c1tpXS5uYW1lXSA9IHY7CgkJCX0KCQkJaWYgKGNuKSB7CgkJCQlpZiAoby5FbnRpdHlWYWx1ZXMpIHsKCQkJCQlmb3IgKHZhciBqID0gMDsgaiA8IG8uRW50aXR5VmFsdWVzLmxlbmd0aDsgaisrKSB7CgkJCQkJCWlmICh0aGlzLmVsZW1lbnRzW2ldLm5hbWUgPT0gdGhpcy5zVGFibGUgJiYgdGhpcy5lbGVtZW50c1tpXS5lbXNTb3VyY2UpIG8uSWQgPSB0aGlzLmVsZW1lbnRzW2ldLmVtc1NvdXJjZS5JZDsKCQkJCQkJaWYgKG8uRW50aXR5VmFsdWVzW2pdLkVudGl0eUF0dHJpYnV0ZS5OYW1lID09IHRoaXMuZWxlbWVudHNbaV0ubmFtZSAmJiB0aGlzLmVsZW1lbnRzW2ldLmVtc1NvdXJjZSkgewoJCQkJCQkJby5FbnRpdHlWYWx1ZXNbal0uSWQgPSB0aGlzLmVsZW1lbnRzW2ldLmVtc1NvdXJjZS5JZDsKCQkJCQkJfQoJCQkJCX0KCQkJCX0KCQkJfQoJCX0KCQlyZXR1cm4gbzsKCX0KCgljSGVpZ2h0KG9wdGlvbnMpIHsKCQlpZiAob3B0aW9ucyAmJiBvcHRpb25zLmVkaXRvcikgcmV0dXJuIHdpbmRvdy5pbm5lckhlaWdodDsKCQlpZiAob3B0aW9ucyAmJiBvcHRpb25zLmhlaWdodCAmJiB0eXBlb2Yob3B0aW9ucy5oZWlnaHQpID09PSAnc3RyaW5nJykgcmV0dXJuIHRoaXMuaGVpZ2h0OwoJCWlmIChvcHRpb25zICYmIG9wdGlvbnMudHlwZSA9PSAnd2luZG93JyAmJiAhb3B0aW9ucy5oZWlnaHQpIHJldHVybiB0aGlzLmhlaWdodCAqIDAuOTsKCQlyZXR1cm4gTWF0aC5mbG9vcigoKG9wdGlvbnMgPyBvcHRpb25zLmhlaWdodCA6IG51bGwpIHx8ICh0aGlzLmhlaWdodCAvIDMpKSk7Cgl9CgoJc2VhcmNoKG9wdGlvbnMpIHsKCQlyZXR1cm4gdGhpcy5zdHJpbmcob3B0aW9ucyk7Cgl9CgoJc3RyaW5nKG9wdGlvbnMpIHsKCQlvcHRpb25zLmhlaWdodCA9IDIwOwoJCW9wdGlvbnMuc2ltcGxlID0gdHJ1ZTsKCQlyZXR1cm4gdGhpcy50ZXh0KG9wdGlvbnMpOwoJfQoKCWRhdGV0aW1lKG9wdGlvbnMpIHsKCQlyZXR1cm4gYDxpbnB1dCBpZD0iZHRwJHtvcHRpb25zLm5hbWV9IiBjbGFzcz0iZWFzeXVpLSR7dGhpcy51aVR5cGVzW29wdGlvbnMudHlwZV19IiByZXF1aXJlZD0iJHtvcHRpb25zLnJlcXVpcmVkID8gJ3RydWUnIDogJ2ZhbHNlJ30iIHZhbHVlPSIke3RoaXMudmFsdWUob3B0aW9ucyl9IiBzdHlsZT0id2lkdGg6JHt0aGlzLmNXaWR0aChvcHRpb25zKX1weCI+YDsKCX0KCglxdWVyeShvcHRpb25zKSB7CgkJcmV0dXJuICI8ZGl2IGlkPSd2cyIgKyBvcHRpb25zLm5hbWUgKyAiJz48L2Rpdj4iOwoJfQoKCURhdGVUaW1lKG9wdGlvbnMpIHsKCQlyZXR1cm4gdGhpcy5kYXRldGltZShvcHRpb25zKTsKCX0KCglsb25nKG9wdGlvbnMpIHsKCQlyZXR1cm4gdGhpcy5pbnQob3B0aW9ucyk7Cgl9CgoJTG9uZyhvcHRpb25zKSB7CgkJcmV0dXJuIHRoaXMubG9uZyhvcHRpb25zKTsKCX0KCgl2YWx1ZShvcHRpb25zKSB7CgkJaWYgKHR5cGVvZiBvcHRpb25zLnZhbHVlID09PSAnZnVuY3Rpb24nKSB7CgkJCXRyeSB7CgkJCQlyZXR1cm4gb3B0aW9ucy52YWx1ZSh0aGlzLmdldCgpKTsKCQkJfSBjYXRjaCAoZXgpIHsKCQkJCWNvbnNvbGUubG9nKGBERm9ybS52YWx1ZSgke29wdGlvbnMubmFtZX0pOiAke2V4fWApOwoJCQkJcmV0dXJuICcnOwoJCQl9CgkJfSBlbHNlIHsKCQkJc3dpdGNoIChvcHRpb25zLnR5cGUpIHsKCQkJCWNhc2UgJ2ludCc6CgkJCQljYXNlICdwcm9ncmVzcyc6CgkJCQkJcmV0dXJuIG9wdGlvbnMudmFsdWUgfHwgb3B0aW9ucy5taW4gfHwgMDsKCQkJCWNhc2UgJ3N0cmluZyc6CgkJCQljYXNlICd0ZXh0JzoKCQkJCWNhc2UgJ2RhdGV0aW1lJzoKCQkJCWNhc2UgJ2xhYmVsJzoKCQkJCQlyZXR1cm4gb3B0aW9ucy52YWx1ZSB8fCAiIjsKCQkJCWRlZmF1bHQ6CgkJCQkJcmV0dXJuIG9wdGlvbnMudmFsdWU7CgkJCX0KCQl9Cgl9CgoJaW50KG9wdGlvbnMpIHsKCQlsZXQgcmV0ID0gYDxpbnB1dCBpZD0ibnVkJHtvcHRpb25zLm5hbWV9IiBjbGFzcz0iZWFzeXVpLSR7dGhpcy51aVR5cGVzW29wdGlvbnMudHlwZV19IiByZXF1aXJlZD0iJHtvcHRpb25zLnJlcXVpcmVkID8gJ3RydWUnIDogJ2ZhbHNlJ30iIHZhbHVlPSIke3RoaXMudmFsdWUob3B0aW9ucyl9IiBkYXRhLW9wdGlvbnM9Im1pbjoke29wdGlvbnMubWluIHx8IDB9LG1heDoke29wdGlvbnMubWF4IHx8IDEwMH0saW5jcmVtZW50OiR7b3B0aW9ucy5pbmNyZW1lbnQgfHwgMX0iIHN0eWxlPSJ3aWR0aDoke3RoaXMuY1dpZHRoKG9wdGlvbnMpfXB4OyI+PC9pbnB1dD5gOwoJCS8vY29uc29sZS5sb2cocmV0KTsKCQlyZXR1cm4gcmV0OwoJfQoKCW1lbnUob3B0aW9ucykgewoJCXZhciByZXQgPSAiIjsKCQlyZXQgKz0gJzxkaXYgY2xhc3M9ImVhc3l1aS1wYW5lbCIgaWQ9Im1udScgKyBvcHRpb25zLm5hbWUgKyAnIiBzdHlsZT0icGFkZGluZzo1cHg7Ij5cbic7CgkJJC5lYWNoKG9wdGlvbnMubWVudSwgKF8sIG0pID0+IHJldCArPSBgPGEgaHJlZj0iIyIgY2xhc3M9ImVhc3l1aS0ke3RoaXMudWlUeXBlc1tvcHRpb25zLnR5cGUgfHwgJ21lbnUnXX0iIGRhdGEtb3B0aW9ucz0ibWVudTonI21tJHttLmxhYmVsLnJlcGxhY2UoLyAvZywgJycpfScsaWNvbkNsczonaWNvbi0ke20uaWNvbiB8fCAnbm9uZSd9JyI+JHttLmxhYmVsfTwvYT5cbmApOwoJCXJldCArPSAiPC9kaXY+XG4iOwoJCWxldCBkdiA9IG0gPT4gewoJCQlsZXQgcmV0ID0gJzxkaXYnICsgKG0uc3ViTWVudXMgPyAnJyA6IGAgZGF0YS1vcHRpb25zPSJpY29uQ2xzOidpY29uLSR7bS5pY29uIHx8ICdub25lJ30nImApICsgJz5cbic7CgkJCXJldCArPSBtLnN1Yk1lbnVzID8gJzxzcGFuPicgKyAobS5sYWJlbCB8fCB0aGlzLmVuZ2xpc2gobS5jb2RlKSkgKyAnPC9zcGFuPlxuPGRpdj4nIDogKGA8c3BhbiB3aWR0aD0nMTAwJScgb25jbGljaz0nKGFzeW5jICgpID0+IHtsZXQgbSA9ICR7X0ZyRU1ELl90b0pTKG0pfTsgaWYobS5hY3Rpb24pe3JldHVybiBhd2FpdCBtLmFjdGlvbihERm9ybS5nZXQoKSwgbSk7fSBpZiAobS5zdWJNZW51cykgcmV0dXJuOyBhd2FpdCBfRnJFTUQuUmVuZGVyUGFnZSh7X2NvZGU6IG0uY29kZSB8fCBtLmxhYmVsLnJlcGxhY2UoLyAvZywgIiIpLnRvTG93ZXJDYXNlKCl9LCBtLmRhdGEpO30pKCknPiR7bS5sYWJlbCB8fCB0aGlzLmVuZ2xpc2gobS5jb2RlKX08L3NwYW4+YCk7CgkJCSQuZWFjaChtLnN1Yk1lbnVzLCAoXywgcykgPT4gcmV0ICs9IGR2KHMpKTsKCQkJcmV0ICs9IChtLnN1Yk1lbnVzID8gIjwvZGl2PlxuIiA6ICIiKSArIGA8L2Rpdj5cbmA7CgkJCXJldHVybiByZXQ7CgkJfTsKCQlmb3IgKHZhciBpID0gMDsgaSA8IG9wdGlvbnMubWVudS5sZW5ndGg7IGkrKykgewoJCQl2YXIgbSA9IG9wdGlvbnMubWVudVtpXTsKCQkJcmV0ICs9ICc8ZGl2IGlkPSJtbScgKyBtLmxhYmVsLnJlcGxhY2UoLyAvZywgJycpICsgJyIgc3R5bGU9IndpZHRoOjE1MHB4OyI+JzsKCQkJZm9yICh2YXIgaiA9IDA7IGogPCBtLnN1Yk1lbnVzLmxlbmd0aDsgaisrKSB7CgkJCQl2YXIgc20gPSBtLnN1Yk1lbnVzW2pdOwoJCQkJcmV0ICs9IGR2KHNtKTsKCQkJfQoJCQlyZXQgKz0gJzwvZGl2PlxuJzsKCQl9CgkJcmV0dXJuIHJldDsKCX0KCglpbnRlZ2VyKG9wdGlvbnMpIHsKCQlyZXR1cm4gdGhpcy5pbnQob3B0aW9ucyk7Cgl9CgoJbnVtYmVyKG9wdGlvbnMpIHsKCQlyZXR1cm4gdGhpcy5pbnQob3B0aW9ucyk7Cgl9CgoJSW50ZWdlcihvcHRpb25zKSB7CgkJcmV0dXJuIHRoaXMuaW50KG9wdGlvbnMpOwoJfQoKCWJvb2wob3B0aW9ucykgewoJCXJldHVybiBgPGlucHV0IGlkPSIke3RoaXMucHJlZml4KG9wdGlvbnMpfSR7b3B0aW9ucy5uYW1lfSIgZGF0YS1kZm9ybT0iZWxlbWVudDoke29wdGlvbnMubmFtZX0iIHJlcXVpcmVkPSIke29wdGlvbnMucmVxdWlyZWQ/J3RydWUnOidmYWxzZSd9IiBkYXRhLW9wdGlvbnM9J2Rpc2FibGVkOiR7b3B0aW9ucy5kaXNhYmxlZD8ndHJ1ZSc6J2ZhbHNlJ30sJHt0aGlzLmV2ZW50SGFuZGxlcnMob3B0aW9ucyl9JyBjbGFzcz0iZWFzeXVpLSR7dGhpcy51aVR5cGVzW29wdGlvbnMudHlwZV19IiAke29wdGlvbnMuY2hlY2tlZD8nY2hlY2tlZCc6Jyd9IC8+YDsKCX0KCglsYWJlbChvcHRpb25zKSB7CgkJcmV0dXJuIGA8c3BhbiBpZD0iJHt0aGlzLnByZWZpeChvcHRpb25zKX0ke29wdGlvbnMubmFtZX0iIHN0eWxlPSJ3aWR0aDoke3RoaXMuY1dpZHRoKG9wdGlvbnMpfXB4IiBkYXRhLW9wdGlvbnM9ImRpc2FibGVkOiR7b3B0aW9ucy5kaXNhYmxlZD8ndHJ1ZSc6J2ZhbHNlJ30iPiR7dGhpcy52YWx1ZShvcHRpb25zKX08L3NwYW4+YDsKCX0KCgl1cmwob3B0aW9ucykgewoJCXJldHVybiB0aGlzLnN0cmluZyhvcHRpb25zKS5yZXBsYWNlKCJGaWVsZENoYW5nZSIsICJVUkxDaGFuZ2UiKTsKCX0KCgl0ZXh0KG9wdGlvbnMpIHsKCQlyZXR1cm4gYDxpbnB1dCBpZD0iJHt0aGlzLnByZWZpeChvcHRpb25zKX0ke29wdGlvbnMubmFtZX0iIGNsYXNzPSJlYXN5dWktJHtvcHRpb25zLmVkaXRvciB8fCB0aGlzLnVpVHlwZXNbb3B0aW9ucy50eXBlXX0iIGRhdGEtb3B0aW9ucz0nZGlzYWJsZWQ6JHtvcHRpb25zLmRpc2FibGVkPyd0cnVlJzonZmFsc2UnfSwke3RoaXMuZXZlbnRIYW5kbGVycyhvcHRpb25zKX0nIG11bHRpbGluZT0iJHtvcHRpb25zLnNpbXBsZSA/ICdmYWxzZScgOiAndHJ1ZSd9IiBzdHlsZT0id2hpdGUtc3BhY2U6cHJlLXdyYXA7d2lkdGg6JHt0aGlzLmNXaWR0aChvcHRpb25zKX1weDtoZWlnaHQ6JHt0aGlzLmNIZWlnaHQob3B0aW9ucyl9cHgiIHJlcXVpcmVkPSIke29wdGlvbnMucmVxdWlyZWQgPyAndHJ1ZScgOiAnZmFsc2UnfSIgdmFsdWU9IiR7dGhpcy52YWx1ZShvcHRpb25zKX0iIC8+YDsKCX0KCglwYXNzd29yZChvcHRpb25zKSB7CgkJdmFyIHJldCA9IHRoaXMuc3RyaW5nKG9wdGlvbnMpOwoJCXJldCA9IHJldC5yZXBsYWNlKCc8aW5wdXQgJywgJzxpbnB1dCB0eXBlPSJwYXNzd29yZCIgJyk7CgkJcmV0dXJuIHJldDsKCX0KCglmaWxlKG9wdGlvbnMpIHsKCQlyZXR1cm4gYDxpbnB1dCBpZD0iJHt0aGlzLnByZWZpeChvcHRpb25zKX0ke29wdGlvbnMubmFtZX0iIGNsYXNzPSJlYXN5dWktJHt0aGlzLnVpVHlwZXNbb3B0aW9ucy50eXBlXX0iIGRhdGEtb3B0aW9ucz0ib25DaGFuZ2U6ZnVuY3Rpb24obixvKXt2YXIgcyA9ICQoJyMnICsgdGhpcy5pZCkuZmlsZWJveCgnb3B0aW9ucycpOyB0aGlzLlVwbG9hZEZpbGUocywgdGhpcy5ieU5hbWUoJyR7b3B0aW9ucy5uYW1lfScpKTt9IiBzdHlsZT0id2lkdGg6JHt0aGlzLmNXaWR0aChvcHRpb25zKX1weCI+YDsKCX0KCglpbWFnZShvcHRpb25zKSB7CgkJcmV0dXJuIHRoaXMuZmlsZShvcHRpb25zKSArIGA8ZGl2IGlkPSJkbGcke29wdGlvbnMubmFtZX0iIGNsYXNzPSJlYXN5dWktJHt0aGlzLnVpVHlwZXNbb3B0aW9ucy50eXBlXX0iIHRpdGxlPSJJbWFnZSBQcmV2aWV3IiBkYXRhLW9wdGlvbnM9ImNsb3NlZDp0cnVlLGljb25DbHM6J2ljb24tc2F2ZScscmVzaXphYmxlOmZhbHNlLG1vZGFsOnRydWUiIHN0eWxlPSJ3aWR0aDo0MDBweDtoZWlnaHQ6MjAwcHg7cGFkZGluZzoxMHB4Ij48aW1nIGlkPSIke3RoaXMucHJlZml4KG9wdGlvbnMpfSR7b3B0aW9ucy5uYW1lfSIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIvPjwvZGl2PmA7Cgl9CgoJcHJvZ3Jlc3Mob3B0aW9ucykgewoJCWlmICghb3B0aW9ucy5oZWlnaHQpIG9wdGlvbnMuaGVpZ2h0ID0gMjA7IC8vIGZpeCBiaWcgcHJvZ3Jlc3MKCQlyZXR1cm4gYDxkaXYgaWQ9IiR7dGhpcy5wcmVmaXgob3B0aW9ucyl9JHtvcHRpb25zLm5hbWV9IiBjbGFzcz0iZWFzeXVpLSR7dGhpcy51aVR5cGVzW29wdGlvbnMudHlwZV19IiBkYXRhLW9wdGlvbnM9InZhbHVlOiR7dGhpcy52YWx1ZShvcHRpb25zKX0iIHN0eWxlPSJ3aWR0aDoke3RoaXMuY1dpZHRoKG9wdGlvbnMpfXB4O2hlaWdodDoke3RoaXMuY0hlaWdodChvcHRpb25zKX1weCI+PC9kaXY+YDsKCX0KCglmbG93Y2hhcnQob3B0aW9ucykgewoJCXJldHVybiBgPGRpdiBpZD0iZmx3JHtvcHRpb25zLm5hbWV9IiB3aWR0aD0iJHt0aGlzLmNXaWR0aChvcHRpb25zKX0iIGhlaWdodD0iJHt0aGlzLmNIZWlnaHQob3B0aW9ucyl9Ij48L2Rpdj5gOwoJfQoKCWNoYXJ0KG9wdGlvbnMpIHsKCQlyZXR1cm4gYDxkaXYgaWQ9ImNodCR7b3B0aW9ucy5uYW1lfSIgd2lkdGg9IiR7dGhpcy5jV2lkdGgob3B0aW9ucyl9IiBoZWlnaHQ9IiR7dGhpcy5jSGVpZ2h0KG9wdGlvbnMpfSI+PC9kaXY+YDsKCX0KCglmb3JtYXR0ZXIobmFtZSwgYywganNvbikgewoJCWpzb24gPSBqc29uID8gJyInIDogJyc7CgkJcmV0dXJuIGAke2pzb259KHZhbHVlLCByb3csIGluZGV4KSA9PiB7dHJ5e3ZhciBjID0gKERGb3JtLmJ5TmFtZShcYCR7bmFtZX1cYCkuY29sdW1ucyB8fCBbXSkuZmluZChjID0+IGMuZmllbGQ9PVxgJHtjLmZpZWxkfVxgKTsgcmV0dXJuIGMmJmMuZm9ybWF0P2MuZm9ybWF0KHZhbHVlLHJvdyxpbmRleCk6dmFsdWU7fWNhdGNoKGV4KXtyZXR1cm4gdmFsdWU7fSB9JHtqc29ufWA7Cgl9CgoJbWFwQ29sdW1ucyhvcHRpb25zLCBqc29uKSB7CgkJbGV0IGNUaXRsZSA9IGMgPT4gYy50aXRsZSB8fCB0aGlzLmVuZ2xpc2goYy5maWVsZCk7CgoJCXZhciBjb2xzID0gJC5ncmVwKG9wdGlvbnMuY29sdW1ucyB8fCBbXSwgYyA9PiAhYy5pZ25vcmUpOwoJCWxldCByZXQgPSAiIjsKCQlpZiAob3B0aW9ucy5tdWx0aXBsZSkgcmV0ICs9IGB7ImZpZWxkIjonY2snLCJjaGVja2JveCI6dHJ1ZX0sYDsKCQlyZXQgPSBgImZyb3plbkNvbHVtbnMiOiBbW2A7CgkJaWYgKCFvcHRpb25zLmZyb3plbikgewoJCQlyZXQgKz0gYHsiZmllbGQiOiIke29wdGlvbnMuaWRGaWVsZC5maWVsZH0iLCJ0aXRsZSI6ICIke29wdGlvbnMuaWRGaWVsZC50aXRsZX0iLCJzb3J0YWJsZSI6ICJ0cnVlIiwgImZvcm1hdHRlciI6ICR7dGhpcy5mb3JtYXR0ZXIob3B0aW9ucy5uYW1lLCBvcHRpb25zLmlkRmllbGQsIGpzb24pfX0sYDsKCQkJaWYgKG9wdGlvbnMudGV4dEZpZWxkLmZpZWxkICE9IG9wdGlvbnMuaWRGaWVsZC5maWVsZCkgcmV0ICs9IGB7ImZpZWxkIjoiJHtvcHRpb25zLnRleHRGaWVsZC5maWVsZCB8fCBvcHRpb25zLnRleHRGaWVsZC50aXRsZX0iLCJ0aXRsZSI6IiR7b3B0aW9ucy50ZXh0RmllbGQudGl0bGUgfHwgb3B0aW9ucy50ZXh0RmllbGQuZmllbGR9Iiwid2lkdGgiOiIke29wdGlvbnMudGV4dEZpZWxkLndpZHRofHwxMjB9IiwgInNvcnRhYmxlIjogInRydWUiLCAiZm9ybWF0dGVyIjogJHt0aGlzLmZvcm1hdHRlcihvcHRpb25zLm5hbWUsIG9wdGlvbnMudGV4dEZpZWxkLCBqc29uKX19YDsKCQl9IGVsc2UgewoJCQkkLm1hcCgkLmdyZXAoY29scywgYyA9PiBjLmZyb3plbiksIGMgPT4gYHsiZmllbGQiOiIke2MuZmllbGQgfHwgY1RpdGxlKGMpfSIsInRpdGxlIjoiJHtjVGl0bGUoYykgfHwgYy5maWVsZH0iLCJ3aWR0aCI6IiR7Yy53aWR0aHx8MTIwfSIsImFsaWduIjonbGVmdCcsInNvcnRhYmxlIjoidHJ1ZSIsICJmb3JtYXR0ZXIiOiAke3RoaXMuZm9ybWF0dGVyKG9wdGlvbnMubmFtZSwgYywganNvbil9fWApLmpvaW4oIiwiKTsKCQl9CgkJcmV0ICs9IGBdXSwgImNvbHVtbnMiOiBbW2A7CgkJcmV0ICs9ICQubWFwKCQuZ3JlcChjb2xzLCBjID0+ICFjLmZyb3plbiksIGMgPT4gYHsiZmllbGQiOiIke2MuZmllbGQgfHwgY1RpdGxlKGMpfSIsInRpdGxlIjoiJHtjVGl0bGUoYykgfHwgYy5maWVsZH0iLCJhbGlnbiI6ImxlZnQiLCJzb3J0YWJsZSI6InRydWUiLCAiZm9ybWF0dGVyIjogJHt0aGlzLmZvcm1hdHRlcihvcHRpb25zLm5hbWUsIGMsIGpzb24pfX1gKS5qb2luKCIsIik7CgkJcmV0ICs9ICddXSc7CgkJcmV0dXJuIHJldDsKCX0KCglzZWxlY3Qob3B0aW9ucywgdGFnID0gb3B0aW9ucy50YWcsIHR5cGUpIHsKCQlyZXR1cm4gdGhpcy5jb21ibyhvcHRpb25zLCB0YWcsIHR5cGUpOwoJfQoKCXRyZWUob3B0aW9ucykgewoJCXJldHVybiB0aGlzLnNlbGVjdChvcHRpb25zLCAic2VsZWN0Iik7Cgl9CgoJbmF2aWdhdGlvbihvcHRpb25zKSB7CgkJcmV0dXJuIHRoaXMuY29tYm8ob3B0aW9ucywgJ3VsJywgJ3RyZWUnKTsKCX0KCgljb21ibyhvcHRpb25zLCB0YWcsIHR5cGUpIHsKCQl2YXIgY29scyA9ICQuZ3JlcChvcHRpb25zLmNvbHVtbnMgfHwgW10sIGMgPT4gIWMuaWdub3JlKTsKCQl0YWcgPSB0YWcgfHwgInNlbGVjdCI7CgoJCW9wdGlvbnMuaWRGaWVsZCA9ICQudW5pcXVlU29ydChbewoJCQlmaWVsZDogb3B0aW9ucy5pZEZpZWxkLAoJCQl0aXRsZTogb3B0aW9ucy5pZEZpZWxkCgkJfV0uY29uY2F0KCQuZ3JlcChjb2xzLCBjID0+IGMucHJpbWFyeSksIFt7CgkJCWZpZWxkOiAnSWQnLAoJCQl0aXRsZTogJ0lEJwoJCX1dKSkuZmluZCh4ID0+IHR5cGVvZih4LmZpZWxkKSAhPT0gInVuZGVmaW5lZCIpOwoKCQlvcHRpb25zLnRleHRGaWVsZCA9ICQudW5pcXVlU29ydChbewoJCQlmaWVsZDogb3B0aW9ucy50ZXh0RmllbGQsCgkJCXRpdGxlOiBvcHRpb25zLnRleHRGaWVsZAoJCX1dLmNvbmNhdCgkLmdyZXAoY29scywgYyA9PiBjLmRpc3BsYXkpLCBbewoJCQlmaWVsZDogJ19Ub1N0cmluZycsCgkJCXRpdGxlOiBvcHRpb25zLm5hbWUsCgkJfV0pKS5maW5kKHggPT4gdHlwZW9mKHguZmllbGQpICE9PSAidW5kZWZpbmVkIik7CgoJCWNvbnNvbGUubG9nKCJEeW5hRm9ybTo6Y29tYm8oKTogb3B0aW9ucyIsIG9wdGlvbnMpOwoKCQl2YXIgZnVuID0gdHlwZSB8fCB0aGlzLmVGdW4ob3B0aW9ucyk7CgoJCXZhciBkcm9wZG93biA9IFsnY29tYm90cmVlZ3JpZCcsICdjb21ib3RyZWUnLCAnY29tYm9ncmlkJywgJ3NlbGVjdCddLmluZGV4T2YoZnVuKSA+IC0xOwoJCWlmIChkcm9wZG93bikgdGhpcy5zZWxlY3RzLnB1c2goewoJCQlpZDogImNtYiIgKyBvcHRpb25zLm5hbWUsCgkJCW9wdGlvbnM6IHRoaXMuYnlOYW1lKG9wdGlvbnMubmFtZSkKCQl9KTsKCQl0aGlzLnNlbGVjdHMgPSAkLnVuaXF1ZVNvcnQodGhpcy5zZWxlY3RzKTsKCQl2YXIgcmV0ID0gYDwke3RhZ30gaWQ9ImNtYiR7b3B0aW9ucy5uYW1lfSIgY2xhc3M9ImVhc3l1aS0ke2Z1bn0iIHN0eWxlPSJtYXgtd2lkdGg6JHtkcm9wZG93bj8nNDAwcHgnOnRoaXMuY1dpZHRoKG9wdGlvbnMpfTsgd2lkdGg6JHt0aGlzLmNXaWR0aChvcHRpb25zKX1weCIgcmVxdWlyZWQ9IiR7KG9wdGlvbnMucmVxdWlyZWQgPyAndHJ1ZScgOiAnZmFsc2UnKX0iIGRhdGEtb3B0aW9ucz0nZGlzYWJsZWQ6JHtvcHRpb25zLmRpc2FibGVkPyd0cnVlJzonZmFsc2UnfSwke3RoaXMuZXZlbnRIYW5kbGVycyhvcHRpb25zKX0sIHZhbHVlOiIke3RoaXMudmFsdWUob3B0aW9ucyl9Iiwgcm93bnVtYmVyczoke3R5cGVvZihvcHRpb25zLnJvd051bWJlcnMpIT09J3VuZGVmaW5lZCc/b3B0aW9ucy5yb3dOdW1iZXJzOihmdW4uaW5kZXhPZigndHJlZScpPC0xPydmYWxzZSc6J3RydWUnKX0sIHBhZ2luYXRpb246JHt0eXBlb2Yob3B0aW9ucy5wYWdpbmF0aW9uKSE9PSd1bmRlZmluZWQnP29wdGlvbnMucGFnaW5hdGlvbjooZnVuLmluZGV4T2YoJ3RyZWUnKTwtMT8nZmFsc2UnOid0cnVlJyl9LCBwYW5lbFdpZHRoOiR7Mip0aGlzLmNXaWR0aChvcHRpb25zKX0sIGZpdENvbHVtbnM6IHRydWUsIHNpbmdsZVNlbGVjdDogdHJ1ZSwgbXVsdGlwbGU6JHsob3B0aW9ucy5tdWx0aXBsZSB8fCAnZmFsc2UnKX0sIGlkRmllbGQ6ICIke29wdGlvbnMuaWRGaWVsZC5maWVsZH0iLCBlbmFibGVGaWx0ZXI6ICR7b3B0aW9ucy5maWx0ZXI/J3RydWUnOidmYWxzZSd9LCBub3dyYXA6IGZhbHNlLCB0ZXh0RmllbGQ6ICIke29wdGlvbnMudGV4dEZpZWxkLmZpZWxkfSIsIHRyZWVGaWVsZDogIiR7b3B0aW9ucy50ZXh0RmllbGQuZmllbGR9IixgOwoJCWlmIChmdW4uaW5kZXhPZigndHJlZScpID09IC0xKSB7CgkJCXJldCArPSAnZml0Q29sdW1uczogZmFsc2UsJyArIHRoaXMubWFwQ29sdW1ucyhvcHRpb25zKTsKCQl9CgkJaWYgKG9wdGlvbnMuZGF0YSkgewoJCQlyZXQgKz0gYCxkYXRhOiAke0pTT04uc3RyaW5naWZ5KG9wdGlvbnMuZGF0YSl9YDsKCQl9CgkJcmV0ICs9IGAnPmA7CgkJaWYgKG9wdGlvbnMub3B0aW9ucykgewoJCQlyZXQgKz0gJC5tYXAob3B0aW9ucy5vcHRpb25zLCBvID0+IGA8b3B0aW9uIHZhbHVlPScke19GckVNRC5fdG9KUyhvKX0nPiR7by5uYW1lIHx8IG99PC9vcHRpb24+YCkuam9pbignXG4nKTsKCQl9CgkJcmV0ICs9IGA8LyR7dGFnfT5gOwoJCS8vIGNvbnNvbGUubG9nKHJldCk7CgkJcmV0dXJuIHJldDsKCX0KCglncmlkKG9wdGlvbnMsIHRhZywgdHlwZSkgewoJCXJldHVybiB0aGlzLmNvbWJvKG9wdGlvbnMsICJ0YWJsZSIsICJkYXRhZ3JpZCIpOwoJfQoKCXRyZWVncmlkKG9wdGlvbnMpIHsKCQlyZXR1cm4gdGhpcy5jb21ibyhvcHRpb25zLCAndGFibGUnLCAndHJlZScpOwoJfQoKCWFzeW5jIGRvTGluayhlLCBldmVudCkgewoJCXRoaXMuYnVzeSh0cnVlKTsKCQl0cnkgewoJCQlhd2FpdCBlLmxpbmtzLmZpbmQobCA9PiBsLmxhYmVsID09IGV2ZW50LnRhcmdldC5pbm5lclRleHQpLm9uQ2xpY2sodGhpcy5nZXQoKSk7CgkJfSBjYXRjaCAoZXgpIHsKCQkJY29uc29sZS5sb2coIkR5bmFGb3JtOjpkb0xpbmsoKTogRXhjZXB0aW9uOiAiICsgZXgpOwoJCX0KCQl0aGlzLmJ1c3koZmFsc2UpOwoJfQoKCUVkaXRlZFZhbHVlKGUpIHsKCQlyZXR1cm4gKHR5cGVvZihhY2UpICE9PSAidW5kZWZpbmVkIikgPyBhY2UuZWRpdCgncG5sJyArIGUubmFtZSkuc2Vzc2lvbi5nZXRWYWx1ZSgpIDogJyc7Cgl9CgoJYXN5bmMgUGFuT25DbG9zZShlKSB7CgkJaWYgKGUuZWRpdG9yKSB7CgkJCWUudmFsdWUgPSB0aGlzLkVkaXRlZFZhbHVlKGUpOwoJCX0KCQlpZiAoZS5jbG9zZSkgewoJCQlhd2FpdCBlLmNsb3NlKHRoaXMuZ2V0KCkpOwoJCX0KCX0KCglhc3luYyBQZW5kQWZ0ZXJPcGVuKGUpIHsKCQlpZiAoZS5lZGl0b3IgJiYgdHlwZW9mKGFjZSkgIT09ICJ1bmRlZmluZWQiKSB7CgkJCWF3YWl0IF9GckVNRC5PcGVuRWRpdG9yKCdwbmwnICsgZS5uYW1lIC8qKyAnLWNlbnRlcicqLyAsIGUubGFuZ3VhZ2UsIGUubG9hZGVyIHx8IChvID0+IGUudmFsdWUpLCBlLnNhdmVyLCB0aGlzLmdldCgpLCBlKTsKCQl9CgkJaWYgKGUub3BlbikgewoJCQlhd2FpdCBlLm9wZW4odGhpcy5nZXQoKSk7CgkJfQoJfQoKCWxpbmsob3B0aW9ucykgewoJCXJldHVybiAob3B0aW9ucy5saW5rcyB8fCBbXSkuZmlsdGVyKGwgPT4gIWwuaWdub3JlKS5tYXAobCA9PiBgPGEgaHJlZj0iIyIgY2xhc3M9ImVhc3l1aS0ke3RoaXMudWlUeXBlc1tvcHRpb25zLnR5cGVdfSIgZGF0YS1vcHRpb25zPScke3RoaXMuZXZlbnRIYW5kbGVycyhvcHRpb25zKX0sIGljb25DbHM6Imljb24tJHtsLmljb24gfHwgJ29rJ30iJz4ke2wubGFiZWx9PC9hPmApLmpvaW4oJ1xuJyk7Cgl9CgoJYXN5bmMgU2V0VHJlZURhdGEoZSwgbiwgZGF0YSkgewoJCSQuZWFjaCgkKCIjY21iIiArIGUubmFtZSlbdGhpcy5lRnVuKGUpXSgndHJlZScpLnRyZWUoImdldENoaWxkcmVuIiwgbi50YXJnZXQpLCAoXywgYykgPT4gJCgiI2NtYiIgKyBlLm5hbWUpW3RoaXMuZUZ1bihlKV0oJ3RyZWUnKS50cmVlKCJyZW1vdmUiLCBjLnRhcmdldCkpOwoJCSQoIiNjbWIiICsgZS5uYW1lKVt0aGlzLmVGdW4oZSldKCd0cmVlJykudHJlZSgiYXBwZW5kIiwgewoJCQlwYXJlbnQ6IG4udGFyZ2V0LAoJCQlkYXRhOiBkYXRhCgkJfSk7CgkJcmV0dXJuIHRydWU7Cgl9CgoJYXN5bmMgRXhwYW5kKGUsIG4pIHsKCQl0aGlzLlNldFRyZWVEYXRhKGUsIG4sIFt7CgkJCWlkOiBudWxsLAoJCQl0ZXh0OiAibG9hZGluZy4uLiIKCQl9XSk7CgkJdmFyIG9iaiA9IHt9OwoJCXZhciBwRmllbGQgPSBlLnBhcmVudEZpZWxkIHx8ICQubWFwKCQuZ3JlcChlLmNvbHVtbnMgfHwgW10sIGMgPT4gYy5wYXJlbnQpLCBjID0+IGMuZmllbGQpLmNvbmNhdChbbnVsbF0pWzBdOwoJCXZhciBpZEZpZWxkID0gJC5ncmVwKGUuY29sdW1ucyB8fCBbXSwgYyA9PiBjLnByaW1hcnkpLmNvbmNhdChlLmlkRmllbGQpWzBdLmZpZWxkOwoJCWlmIChwRmllbGQpIHsKCQkJb2JqW3BGaWVsZF0gPSB7CgkJCQlfc291cmNlOiBuLl9zb3VyY2UKCQkJfTsKCQkJaWYgKGlkRmllbGQpIHsKCQkJCW9ialtwRmllbGRdW2lkRmllbGRdID0gbi5pZDsKCQkJfSBlbHNlIHsKCQkJCW9ialtwRmllbGRdID0gbi5pZDsKCQkJfQoJCX0KCQlsZXQgZGF0YSA9IGF3YWl0IHRoaXMuX2xvYWREYXRhKHsKCQkJaWQ6ICJjbWIiICsgZS5uYW1lLAoJCQlvcHRpb25zOiBlCgkJfSwgb2JqKTsKCQl0aGlzLlNldFRyZWVEYXRhKGUsIG4sIGRhdGEpOwoJfQoKCWFzeW5jIF9sb2FkRGF0YShzLCBvLCBzdGFydCwgZW5kKSB7CgkJdmFyIG5hbWUgPSAocyAmJiBzLm9wdGlvbnMgPyAocy5vcHRpb25zLkNsYXNzID8gcy5vcHRpb25zLkNsYXNzLk5hbWUucmVwbGFjZSgnICcsICdfJykgOiAocy5vcHRpb25zLnRhYmxlIHx8IHMub3B0aW9ucy5uYW1lKSkgOiBzLm5hbWUpOwoJCW5hbWUgPSBuYW1lLnRyaW0oKTsgLy8uc3BsaXQoJy4nKS5zbGljZSgtMSlbMF07CgoJCWxldCBvU2NvcGUgPSAodHlwZW9mKGNvbXBhbnkpICE9PSAndW5kZWZpbmVkJyAmJiBjb21wYW55LlNjb3BlKSA/IHdpbmRvd1tjb21wYW55LlNjb3BlXSA6IHdpbmRvdzsKCQlvID0gbyB8fCAoKG9TY29wZSAmJiBvU2NvcGVbbmFtZV0pID8gbmV3IG9TY29wZVtuYW1lXSgpIDogewoJCQlBY3RpdmU6IHRydWUsCgkJfSk7CgoJCW8gPSAodHlwZW9mIGZpbHRlcnMgIT09ICJ1bmRlZmluZWQiICYmIGZpbHRlcnMgJiYgZmlsdGVyc1tuYW1lXSkgPyBmaWx0ZXJzW25hbWVdKG8pIDogbzsKCQl2YXIgZnVuID0gdGhpcy5lRnVuKHMub3B0aW9ucyk7CgkJbGV0IHNUZXh0ID0gJCgiIyIgKyBzLmlkKVtmdW5dKCdnZXRUZXh0Jyk7CgoJCW8gPSAocyAmJiBzLm9wdGlvbnMgJiYgcy5vcHRpb25zLnNvdXJjZSkgPyBzLm9wdGlvbnMuc291cmNlKG8sIHRoaXMuZ2V0KCksIHNUZXh0KSA6IG87CgkJbGV0IG5hbWVzID0gJC51bmlxdWVTb3J0KFtzLm9wdGlvbnMuc2VhcmNoRmllbGRdLmNvbmNhdCgkLm1hcCgkLmdyZXAocy5vcHRpb25zLmNvbHVtbnMgfHwgW10sIGMgPT4gYy5zZWFyY2gpLCBjID0+IGMuZmllbGQpLCBbIk5hbWUiXSkpLmZpbHRlcih2ID0+IHYpOwoJCWlmICghb1tuYW1lc1swXV0pIG9bbmFtZXNbMF1dID0gc1RleHQ7CgkJLy9jb25zb2xlLmxvZygiRHluYUZvcm06Ol9sb2FkRGF0YSgpOiBvIiwgbyk7CgkJdmFyIGRhdGEgPSBudWxsOwoKCQlsZXQgbGliID0gJyc7CgkJaWYgKG5hbWUuaW5kZXhPZignLicpID4gMCkgewoJCQlsaWIgPSBuYW1lLnNwbGl0KCcuJylbMF0gKyAnLic7CgkJCW5hbWUgPSBuYW1lLnNwbGl0KCcuJylbMV07CgkJfQoKCQlpZiAocy5vcHRpb25zLmxvYWRlcikgewoJCQlkYXRhID0gYXdhaXQgcy5vcHRpb25zLmxvYWRlcih0aGlzLmdldCgpLCBzLm9wdGlvbnMsIG8sIHNUZXh0KTsKCQl9IGVsc2UgaWYgKG8gJiYgdHlwZW9mKG8uZmluZEFsbCkgPT09ICdmdW5jdGlvbicpIHsKCQkJZGF0YSA9IGF3YWl0IG8uZmluZEFsbCgpOwoJCX0gZWxzZSBpZiAodHlwZW9mKGNvbXBhbnkpICE9PSAndW5kZWZpbmVkJyAmJiBjb21wYW55LmxpYnJhcnkgJiYgY29tcGFueS5Db2RlICYmIHdpbmRvdy5iTG9jYWwpIHsKCQkJLy9jb25zb2xlLmxvZygiREZvcm06Ol9sb2FkRGF0YSgpOiBzcigpLl8oIiArIGxpYiArIGNvbXBhbnkuQ29kZS50b0xvd2VyQ2FzZSgpICsgbmFtZSArICJGaW5kYWxsIiArICIpIiwgbyk7CgkJCWRhdGEgPSBhd2FpdCB0aGlzLnNyKCkuXyhsaWIgKyBjb21wYW55LkNvZGUudG9Mb3dlckNhc2UoKSArIG5hbWUgKyAiRmluZGFsbCIsIG51bGwsIG8sIG51bGwsIHN0YXJ0LCBlbmQpOwoJCX0gZWxzZSBpZiAoX0ZyRU1ELmFwaVNlcnZlcikgewoJCQlvID0gT2JqZWN0LmFzc2lnbiguLi5PYmplY3Qua2V5cyhvKS5tYXAoayA9PiAoewoJCQkJW1N0cmluZyhrKS5jaGFyQXQoMCkudG9Mb3dlckNhc2UoKSArIFN0cmluZyhrKS5zbGljZSgxKV06IG9ba10KCQkJfSkpKTsKCQkJLy9jb25zb2xlLmxvZygiREZvcm06Ol9sb2FkRGF0YSgpOiB1c2luZyBfRnJFTUQuYXBpU2VydmVyOiBvIiwgbyk7CgkJCWRhdGEgPSBhd2FpdCBfRnJFTUQuYXBpU2VydmVyLl9uZXcobmFtZSkuX2Zyb21Eb2N1bWVudChvKS5maW5kQWxsKCk7CgkJfQoKCQlpZiAocy5vcHRpb25zLnBvc3Rsb2FkKSB7CgkJCWF3YWl0IHMub3B0aW9ucy5wb3N0bG9hZChkYXRhKTsKCQl9CgkJJC5lYWNoKGRhdGEsIChpLCBkKSA9PiB7CgkJCWQuX19PV05FUiA9IHM7CgkJCSQuZWFjaChzLm9wdGlvbnMuY29sdW1ucywgKF8sIGMpID0+IHsKCQkJCWlmIChjLnZhbHVlKSB7CgkJCQkJZFtjLmZpZWxkXSA9IGMudmFsdWUoZCwgZGF0YSwgaSk7CgkJCQl9CgkJCX0pOwoJCX0pOwoJCWlmICghcy5vcHRpb25zLmNvbHVtbnMgJiYgZnVuLmluZGV4T2YoJ3RyZWUnKSA+IC0xKSB7CgkJCWRhdGEgPSAkLm1hcChkYXRhLCBkID0+IHsKCQkJCWxldCByZXQgPSB7CgkJCQkJaWQ6IGRbcy5vcHRpb25zLmlkRmllbGQuZmllbGRdLAoJCQkJCXRleHQ6IGRbcy5vcHRpb25zLnRleHRGaWVsZC5maWVsZF0sCgkJCQkJc3RhdGU6IGQuc3RhdGUgfHwgKHMub3B0aW9ucy5sb2FkZXIgPyAiZmlsZSIgOiAiY2xvc2VkIiksCgkJCQkJX3NvdXJjZTogZCwKCQkJCX07CgkJCQlyZXQuY2hpbGRyZW4gPSAocmV0LnN0YXRlID09ICJjbG9zZWQiKSA/IFt7CgkJCQkJdGV4dDogJ2xvYWRpbmcuLi4nCgkJCQl9XSA6IG51bGw7CgkJCQlyZXR1cm4gcmV0OwoJCQl9KTsKCQl9CgkJcmV0dXJuIGRhdGEgfHwgW107Cgl9CgoJYXN5bmMgZmlsbERhdGEoZywgbywgc3RhcnQsIGVuZCkgewoJCXZhciBzID0gbnVsbDsKCQlmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuc2VsZWN0cy5sZW5ndGg7IGkrKykgewoJCQlpZiAodGhpcy5zZWxlY3RzW2ldLmlkID09IGdbMF0uaWQpIHMgPSB0aGlzLnNlbGVjdHNbaV07CgkJfQoJCWlmICghcykgcmV0dXJuOwoJCXRoaXMuYnVzeSh0cnVlKTsKCQl0cnkgewoJCQl2YXIgZnVuID0gZ1swXS5jbGFzc0xpc3RbIjAiXS5yZXBsYWNlKCdlYXN5dWktJywgJycpOwoJCQl0cnkgewoJCQkJJCgiIyIgKyBzLmlkKVtmdW5dKCdncmlkJykuZGF0YWdyaWQoJ2dldFBhZ2VyJykucGFnaW5hdGlvbignbG9hZGluZycpOwoJCQl9IGNhdGNoIChleCkge30KCQkJaWYgKHMub3B0aW9ucy5ub2xvYWQpIHsKCQkJCWxldCBfZGF0YSA9IG51bGw7CgkJCQl0cnkgewoJCQkJCV9kYXRhID0gJCgiIyIgKyBzLmlkKVtmdW5dKCdncmlkJykuZGF0YWdyaWQoImdldERhdGEiKTsKCQkJCX0gY2F0Y2ggKGV4KSB7CgkJCQkJX2RhdGEgPSAkKCIjIiArIHMuaWQpW2Z1bl0oJ3RyZWUnKS50cmVlKCdnZXRSb290Jyk7CgkJCQl9CgkJCQlpZiAoX2RhdGEpIHsKCQkJCQlyZXR1cm4gdGhpcy5idXN5KGZhbHNlKTsKCQkJCX0KCQkJfQoJCQl2YXIgZGF0YSA9IGF3YWl0IHRoaXMuX2xvYWREYXRhKHMsIG8sIHN0YXJ0LCBlbmQpOwoJCQl0cnkgewoJCQkJaWYgKCQoIiMiICsgcy5pZClbZnVuXSgnZ3JpZCcpKSAkKCIjIiArIHMuaWQpW2Z1bl0oJ2dyaWQnKS5kYXRhZ3JpZCgnZ2V0UGFnZXInKS5wYWdpbmF0aW9uKCdsb2FkZWQnKTsKCQkJfSBjYXRjaCAoZXgpIHt9CgkJCXRyeSB7CgkJCQkkKCIjIiArIHMuaWQpW2Z1bl0oJ2dyaWQnKS5kYXRhZ3JpZCgnbG9hZERhdGEnLCB7CgkJCQkJdG90YWw6IGRhdGEuQ291bnQgfHwgZGF0YS5sZW5ndGgsCgkJCQkJcm93czogZGF0YSwKCQkJCX0pOwoJCQl9IGNhdGNoIChleCkgewoJCQkJJCgiIyIgKyBzLmlkKVtmdW5dKCd0cmVlJykudHJlZSgnbG9hZERhdGEnLCBkYXRhKTsKCQkJfQoJCX0gY2F0Y2ggKGV4KSB7CgkJCWNvbnNvbGUubG9nKGV4KTsKCQl9CgkJdGhpcy5idXN5KGZhbHNlKTsKCX0KCglldmVudEhhbmRsZXJzKG9wdGlvbnMpIHsKCQlpZiAoIXRoaXMuYnlOYW1lKG9wdGlvbnMubmFtZSkpIHJldHVybjsgLy8gaWYgbm90IGFuIGVsZW1lbnQsIGRvIG5vdCBydW4gdGhlIGhhbmRsZXJzCgoJCXJldHVybiB0aGlzLmV2ZW50cy5maWx0ZXIoZSA9PiBlLnR5cGUgPT0gb3B0aW9ucy50eXBlIHx8IHR5cGVvZihlLnR5cGUpID09PSAndW5kZWZpbmVkJykubWFwKGUgPT4gYCR7ZS5uYW1lfTogKCR7ZS5wYXJhbXMgfHwgJyd9KSA9PiB7dHJ5e0RGb3JtLiR7ZS5oYW5kbGVyfShERm9ybS5ieU5hbWUoIiR7b3B0aW9ucy5uYW1lfSIpIHx8ICR7X0ZyRU1ELl90b0pTKG9wdGlvbnMpfSB8fCB7bmFtZTogIiR7b3B0aW9ucy5uYW1lfSIsdHlwZTogIiR7b3B0aW9ucy50eXBlfSJ9LCAke2UucGFyYW1zfSl9Y2F0Y2goZXgpe2NvbnNvbGUubG9nKCJFdmVudCBFcnJvcjogJHtvcHRpb25zLm5hbWV9LyR7b3B0aW9ucy50eXBlfS8ke2UubmFtZX0iLCBleCk7fX1gKS5qb2luKCcsJyk7Cgl9CgoJYXN5bmMgUGFuZWxPcGVuKGUpIHsKCQlpZiAoZS5lZGl0b3IpIHJldHVybiB0cnVlOwoJCWxldCBjb250ZW50ID0gZS52YWx1ZTsKCQlpZiAoZS5sb2FkZXIpIHsKCQkJY29udGVudCA9IGF3YWl0IGUubG9hZGVyKHRoaXMuZ2V0KCkpOwoJCX0KCQlpZiAoY29udGVudCkgewoJCQl0cnkgewoJCQkJJCgiI3BubCIgKyBlLm5hbWUpLnBhbmVsKCdib2R5JykuaHRtbChjb250ZW50KTsKCQkJCWNvbnNvbGUubG9nKCJwbmwiICsgZS5uYW1lICsgIjogQ29udGVudCBWYWxpZCIpOwoJCQl9IGNhdGNoIChleCkgewoJCQkJLy9jb25zb2xlLmxvZyhleCk7CgkJCX0KCQl9CgkJcmV0dXJuIGNvbnRlbnQ7Cgl9CgoJYXN5bmMgU2VsZWN0Q2hhbmdlKG9wdGlvbnMsIHRhYikgewoJCXRoaXMuYnVzeSh0cnVlKTsKCQkkLmdyZXAodGhpcy5lbGVtZW50cywgZSA9PiBlLnR5cGUgPT0gImdyaWQiICYmIGUuZ3JvdXAgPT0gdGFiKS5mb3JFYWNoKGUgPT4gJCgiI2NtYiIgKyBlLm5hbWUpLmRhdGFncmlkKCkpOwoJCXRoaXMuYnVzeShmYWxzZSk7Cgl9CgoJYXN5bmMgRmllbGRDaGFuZ2Uob3B0aW9ucywgdmFsdWUpIHsKCQl0aGlzLmJ1c3kodHJ1ZSk7CgkJaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5jaGFuZ2UpIHsKCQkJYXdhaXQgb3B0aW9ucy5jaGFuZ2UodGhpcy5nZXQoKSwgdmFsdWUpOwoJCX0KCQl0aGlzLmJ1c3koZmFsc2UpOwoJfQoKCWFzeW5jIFVSTENoYW5nZShzLCBvcHRpb25zKSB7CgkJb3B0aW9ucy5kYXRhID0gYXdhaXQgJC5nZXQocy52YWx1ZSk7CgkJcmV0dXJuIGF3YWl0IHRoaXMuRmllbGRDaGFuZ2Uocywgb3B0aW9ucyk7Cgl9CgoJVXBsb2FkRmlsZShmLCBvcHRpb25zKSB7CgkJdGhpcy5idXN5KHRydWUpOwoJCXZhciBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSgpOwoJCXZhciBmaWxlaWQgPSBNYXRoLnJhbmRvbSgpOwoJCXZhciBtZXRob2QgPSBvcHRpb25zLm1ldGhvZCB8fCAiQ29udGVudE1hbmFnZXIuY21zVXBsb2FkRmlsZSI7CgkJZm9ybURhdGEuYXBwZW5kKCdmaWxlaWQnLCBmaWxlaWQpOwoJCXZhciBmaWxlID0gJCgiIyIgKyBmLmZpbGVib3hJZClbMF0uZmlsZXNbMF07CgkJZm9ybURhdGEuYXBwZW5kKCdfX1VGSUxFJywgZmlsZSk7CgkJaWYgKG9wdGlvbnMubG9jYWwpIHsKCQkJLy8gaGFuZGxpbmcgdGhlIGZpbGUgbG9jYWxseQoJCQl2YXIgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTsKCQkJcmVhZGVyLm9ubG9hZCA9IChlKSA9PiB7CgkJCQl2YXIgZGF0YSA9IGUudGFyZ2V0LnJlc3VsdDsKCQkJCXJldCA9IGRhdGE7CgkJCQl0aGlzLmJ5TmFtZShvcHRpb25zLm5hbWUpLmRhdGEgPSByZXQ7CgkJCQlpZiAob3B0aW9ucyAmJiBvcHRpb25zLnVwbG9hZCkgb3B0aW9ucy51cGxvYWQodGhpcy5nZXQoKSwgcmV0KTsKCQkJfTsKCQkJaWYgKG9wdGlvbnMuYmluYXJ5KSB7CgkJCQlyZWFkZXIucmVhZEFzQmluYXJ5U3RyaW5nKGZpbGUpOwoJCQl9IGVsc2UgaWYgKG9wdGlvbnMuZGF0YXVybCkgewoJCQkJcmVhZGVyLnJlYWRBc0RhdGFVUkwoZmlsZSk7CgkJCX0gZWxzZSB7CgkJCQlyZWFkZXIucmVhZEFzVGV4dChmaWxlKTsKCQkJfQoJCQl0aGlzLmJ1c3koZmFsc2UpOwoJCX0gZWxzZSBpZiAobWV0aG9kKSB7CgkJCSQuYWpheCh7CgkJCQl1cmw6IHRoaXMuc3IoKS5zclVSTCArICImbWV0aG9kPSIgKyBtZXRob2QgKyAiJnNJbnB1dD0iICsgZmlsZWlkICsgIiZwcmVUYWc9JnBvc3RUYWc9IiwKCQkJCWRhdGE6IGZvcm1EYXRhLAoJCQkJLy8gVEhJUyBNVVNUIEJFIERPTkUgRk9SIEZJTEUgVVBMT0FESU5HCgkJCQljYWNoZTogZmFsc2UsCgkJCQljb250ZW50VHlwZTogZmFsc2UsCgkJCQl0eXBlOiAnUE9TVCcsCgkJCQlwcm9jZXNzRGF0YTogZmFsc2UsCgkJCQlzdWNjZXNzOiBkYXRhID0+IHsKCQkJCQl0aGlzLnNyKCkucnVuU2NyaXB0KGRhdGEpOwoJCQkJCXRoaXMuYnlOYW1lKG9wdGlvbnMubmFtZSkuZGF0YSA9IHJldDsKCQkJCQlpZiAob3B0aW9ucyAmJiBvcHRpb25zLnVwbG9hZCkgb3B0aW9ucy51cGxvYWQodGhpcy5nZXQoKSwgcmV0KTsKCQkJCQl0aGlzLmJ1c3koZmFsc2UpOwoJCQkJfQoJCQl9KTsKCQl9Cgl9CgoJZUZ1bihlKSB7CgkJdHJ5IHsKCQkJaWYgKGUudHlwZSA9PSAidHJlZSIpIHsKCQkJCWlmIChlLmNvbHVtbnMpIHsKCQkJCQlyZXR1cm4gImNvbWJvdHJlZWdyaWQiOwoJCQkJfSBlbHNlIGlmICh0eXBlb2YoZS5jb21ibykgIT09ICd1bmRlZmluZWQnICYmICFlLmNvbWJvKSB7CgkJCQkJcmV0dXJuICd0cmVlJzsKCQkJCX0gZWxzZSB7CgkJCQkJcmV0dXJuICJjb21ib3RyZWUiOwoJCQkJfQoJCQl9IGVsc2UgaWYgKGUudHlwZSA9PSAnbmF2aWdhdGlvbicpIHsKCQkJCXJldHVybiAndHJlZSc7CgkJCX0gZWxzZSBpZiAoZS50eXBlID09ICJjb21ib3RyZWUiKSB7CgkJCQlyZXR1cm4gImNvbWJvdHJlZWdyaWQiOwoJCQl9IGVsc2UgaWYgKGUudHlwZSA9PSAic2VsZWN0IiAmJiBlLm9wdGlvbnMpIHsKCQkJCXJldHVybiAiY29tYm9ib3giOwoJCQl9CgkJCXJldHVybiAiY29tYm9ncmlkIjsKCQl9IGNhdGNoIChleCkgewoJCQlyZXR1cm4gImNvbWJvZ3JpZCI7CgkJfQoJfQoKCV9maWxsV2luZG93KHdpbk5hbWUsIHYsIG1hcCkgewoJCXYgPSB2IHx8IHt9OwoJCW1hcCA9IG1hcCB8fCB7fTsKCQlpZiAoQXJyYXkuaXNBcnJheShtYXApKSB7CgkJCW1hcCA9IE9iamVjdC5mcm9tRW50cmllcyhuZXcgTWFwKG1hcCkpOwoJCX0KCgkJbWFwID0gJC5leHRlbmQoe30sIG1hcCwgT2JqZWN0LmZyb21FbnRyaWVzKE9iamVjdC5rZXlzKHYpLm1hcChrID0+IFt3aW5OYW1lICsgaywga10pKSk7CgoJCWxldCBzID0ge307CgkJZm9yICh2YXIgbSBpbiBtYXApIHsKCQkJaWYgKHR5cGVvZih2W21hcFttXV0pID09PSAidW5kZWZpbmVkIikgewoJCQkJLy9jb25zb2xlLmxvZygnaXNfdW5kZWZpbmVkJywgbSwgbWFwW21dLCB2W21hcFttXV0pOwoJCQkJc1ttXSA9IG1hcFttXTsKCQkJfSBlbHNlIHsKCQkJCS8vY29uc29sZS5sb2coJ2lzX25vdF91bmRlZmluZWQnLCBtLCBtYXBbbV0sIHZbbWFwW21dXSk7CgkJCQlzW21dID0gdlttYXBbbV1dOwoJCQl9CgkJfQoJCXRoaXMuY2xlYXIod2luTmFtZSk7CgkJLy9jb25zb2xlLmxvZygicyIsIHMpOwoJCXRoaXMuc2V0KHMpOwoJCSQoIiNwbmxfIiArIHdpbk5hbWUpLndpbmRvdygib3BlbiIpOwoJfQoKCXdpbmRvd1RvRW50aXR5KG8sIGJFbXB0eSwgZ3JpZCwgcHJlZml4LCBmaWx0ZXIpIHsKCQlvID0gbyB8fCB0aGlzLmdldCgpOwoJCWZpbHRlciA9IGZpbHRlciB8fCAodiA9PiB2KTsKCQlsZXQgcmV0ID0gZ3JpZCA/IChncmlkLnNlbGVjdGVkIHx8IGdyaWQpIDogbnVsbDsKCQlpZiAoYkVtcHR5KSB7CgkJCXJldCA9IHt9OwoJCQlvID0ge307CgkJfSBlbHNlIHsKCQkJcmV0ID0gKHJldCAmJiByZXQuSWQpID8gewoJCQkJSWQ6IHJldC5JZAoJCQl9IDoge307CgkJfQoKCQl0aGlzLmVsZW1lbnRzLmZpbHRlcihlID0+IChwcmVmaXggPyBlLmdyb3VwID09IHByZWZpeCA6IHRydWUpICYmIGUudHlwZSAhPSAnbGluaycgJiYgWydfJ10uaW5kZXhPZihlLm5hbWUucmVwbGFjZShwcmVmaXgsICIiKSkgPCAwKS5mb3JFYWNoKGUgPT4gewoJCQlyZXRbZS5uYW1lLnJlcGxhY2UocHJlZml4LCAiIildID0gb1tlLm5hbWVdOwoJCQlyZXR1cm4gdHJ1ZTsKCQl9KTsKCgkJZmlsdGVyKHJldCk7CgoJCXJldHVybiByZXQ7Cgl9CgoJYmluZChvYmopIHsKCQl2YXIgb2JqQmluZCA9IChvLCBlKSA9PiB7CgkJCW9bdGhpcy5lRnVuKGUpXSh7CgkJCQlvblNob3dQYW5lbDogKCkgPT4gewoJCQkJCXRoaXMuZmlsbERhdGEoJCgiIyIgKyBlLmlkKSwgbnVsbCwgMCwgMTApOwoJCQkJfSwKCQkJCW9uQ2xpY2tSb3c6IChpbmRleCwgcm93KSA9PiB7CgkJCQkJdmFyIHMgPSByb3cgPyByb3cuX19PV05FUiA6IG51bGw7CgkJCQkJLy9jb25zb2xlLmxvZygib25DbGlja1JvdygpOiAiLCBpbmRleCwgcm93LCBzKTsKCQkJCQlpZiAocyAmJiBzLm9wdGlvbnMuc2VsZWN0KSB7CgkJCQkJCXMub3B0aW9ucy5zZWxlY3Qocm93LCB0aGlzLmdldCgpKTsKCQkJCQl9CgkJCQl9CgkJCX0pOwoJCQl0cnkgewoJCQkJdmFyIGRnID0gb1t0aGlzLmVGdW4oZSldKCdncmlkJyk7CgkJCQkvLyBkZy5kYXRhZ3JpZCgnZW5hYmxlRmlsdGVyJykKCQkJCXZhciBzdGF0ZSA9IGRnLmRhdGEoJ2RhdGFncmlkJyk7CgkJCQl2YXIgb3B0cyA9IHN0YXRlLm9wdGlvbnM7CgkJCQl2YXIgb25CZWZvcmVMb2FkID0gb3B0cy5vbkJlZm9yZUxvYWQ7CgkJCQlvcHRzLm9uQmVmb3JlTG9hZCA9IChwYXJhbSkgPT4gewoJCQkJCXN0YXRlLmFsbFJvd3MgPSBudWxsOwoJCQkJCXJldHVybiBvbkJlZm9yZUxvYWQuY2FsbCh0aGlzLCBwYXJhbSk7CgkJCQl9OwoJCQkJdmFyIHBhZ2VyID0gZGcuZGF0YWdyaWQoJ2dldFBhZ2VyJyk7CgkJCQlkZy5kYXRhZ3JpZCgnZ2V0UGFuZWwnKS5wYW5lbCh7CgkJCQkJSUQ6IGkKCQkJCX0pOwoJCQkJcGFnZXIucGFnaW5hdGlvbih7CgkJCQkJb25TZWxlY3RQYWdlOiBmdW5jdGlvbihwYWdlTnVtLCBwYWdlU2l6ZSkgewoJCQkJCQl0cnkgewoJCQkJCQkJREZvcm0uZmlsbERhdGEoJCgiIyIgKyBERm9ybS5zZWxlY3RzWyQodGhpcy5wYXJlbnROb2RlKS5wYW5lbCgnb3B0aW9ucycpLklEXS5pZCksIG51bGwsIHBhZ2VTaXplICogKHBhZ2VOdW0gLSAxKSwgcGFnZVNpemUgKiBwYWdlTnVtKTsKCQkJCQkJfSBjYXRjaCAoX2V4KSB7CgkJCQkJCQljb25zb2xlLmxvZygiRHluYUZvcm06Om9uU2VsZWN0UGFnZSgpICIsIF9leCk7CgkJCQkJCX0KCQkJCQl9CgkJCQl9KTsKCQkJCWRnLmRhdGFncmlkKCdsb2FkRGF0YScsIHN0YXRlLmRhdGEpOwoJCQl9IGNhdGNoIChleCkge30KCQl9OwoJCWlmIChvYmopIHsKCQkJb2JqQmluZChvYmopOwoJCX0gZWxzZSB7CgkJCWZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5zZWxlY3RzLmxlbmd0aDsgaSsrKSB7CgkJCQlpZiAodGhpcy5zZWxlY3RzW2ldLm9wdGlvbnMub3B0aW9ucykgewoJCQkJCS8vJCgiIyIgKyB0aGlzLnNlbGVjdHNbaV0uaWQpLmNvbWJvKCk7CgkJCQl9IGVsc2UgewoJCQkJCW9iakJpbmQoJCgiIyIgKyB0aGlzLnNlbGVjdHNbaV0uaWQpLCB0aGlzLnNlbGVjdHNbaV0pOwoJCQkJfQoJCQl9CgoJCQl0aGlzLmVsZW1lbnRzLmZpbHRlcihlID0+IGUud2luZG93ICYmIGUuZ3JvdXApLmZvckVhY2goZSA9PiB7CgkJCQlsZXQgdCA9ICQoIiN0YmNXaW5kb3ciKS50YWJzKCJnZXRUYWIiLCBlLmdyb3VwKTsKCQkJCWlmICh0KSB7CgkJCQkJdC5wYW5lbCgnb3B0aW9ucycpLnRhYi5oaWRlKCk7CgkJCQl9CgkJCX0pOwoJCX0KCX0KCgllbmdsaXNoKHMpIHsKCQlpZiAoIXMpIHJldHVybiAiIjsKCQl2YXIgcmVzdWx0ID0gcy5yZXBsYWNlKC8oW0EtWl0pL2csICIgJDEiKTsKCQlyZXN1bHQgPSByZXN1bHQucmVwbGFjZSgvXy9nLCAnJyk7CgkJcmV0dXJuIHJlc3VsdC5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHJlc3VsdC5zbGljZSgxKTsKCX0KCglvblRvZ2dsZShlLCBiVmFsdWUpIHsKCQlsZXQgc1RhZyA9IGAjZkVsZW1lbnRfJHtlLmZvci5uYW1lfSA+IC5lYXN5dWktJHt0aGlzLnVpVHlwZXNbZS5mb3IudHlwZV19YDsKCQlsZXQgb1RhZyA9ICQoc1RhZyk7CgkJZS5mb3IuZW5hYmxlZCA9IHR5cGVvZihiVmFsdWUpID09PSAidW5kZWZpbmVkIiA/ICFlLmZvci5lbmFibGVkIDogYlZhbHVlOwoKCQlvVGFnLnByb3AoImRpc2FibGVkIiwgIWUuZm9yLmVuYWJsZWQpOwoJCS8vb1RhZ1t0aGlzLnVpVHlwZXNbZS5mb3IudHlwZV1dKGUuZm9yLmVuYWJsZWQgPyAiZW5hYmxlIiA6ICJkaXNhYmxlIik7CgkJY29uc29sZS5sb2coc1RhZywgb1RhZywgdGhpcy51aVR5cGVzW2UuZm9yLnR5cGVdLCBlLmZvci5lbmFibGVkKTsKCX0KCglyZW5kZXIobmFtZSwgdGl0bGUsIGVsZW1lbnRzLCBidXR0b25zLCBiRml4ZWQpIHsKCQl0aGlzLmVsZW1lbnRzID0gKGVsZW1lbnRzIHx8IFtdKS5maWx0ZXIoZSA9PiAhZS5pZ25vcmUpOwoKCQl0aGlzLmJ1dHRvbnMgPSBidXR0b25zIHx8IFtdOwoJCXRoaXMuc2VsZWN0cyA9IFtdOwoJCXRoaXMuZ3JpZHMgPSBbXTsKCgkJdGhpcy5lbGVtZW50cy5maWx0ZXIoZSA9PiBlLnR5cGUgPT0gIndpbmRvdyIpLmZvckVhY2godyA9PiB0aGlzLmVsZW1lbnRzLnNwbGljZSh0aGlzLmVsZW1lbnRzLmZpbmRJbmRleChlID0+IGUubmFtZSA9PSB3Lm5hbWUpLCAwLCB7CgkJCW5hbWU6ICJfIiArIHcubmFtZSwKCQkJdHlwZTogImxpbmsiLAoJCQl0aXRsZTogdy50aXRsZSB8fCB3Lm5hbWUsCgkJCWdyb3VwOiB3Lmdyb3VwLAoJCQl3aW5kb3c6IHcud2luZG93LAoJCQlzZWN0aW9uOiB3LnNlY3Rpb24sCgkJCWxpbmtzOiBbewoJCQkJbGFiZWw6ICdPcGVuJywKCQkJCWljb246ICdlZGl0JywKCQkJCW9uQ2xpY2s6IG8gPT4gJCgiI3BubCIgKyB3Lm5hbWUpLndpbmRvdygnb3BlbicpCgkJCX1dLAoJCX0pKTsKCgkJdGhpcy5zcigpLmdyb3VwQnkodGhpcy5lbGVtZW50cy5maWx0ZXIoZSA9PiBlLndpbmRvdyksICJncm91cCIpLmZvckVhY2goa3YgPT4gewoJCQlpZiAoIWt2LmtleSkgcmV0dXJuOwoKCQkJbGV0IGUgPSB7CgkJCQluYW1lOiAiXyIgKyBrdi5rZXksCgkJCQl0aXRsZToga3Yua2V5LAoJCQkJdHlwZTogIndpbmRvdyIsCgkJCQlncm91cDoga3Yua2V5LAoJCQkJd2lkdGg6IHRoaXMud2lkdGggKiAwLjksCgkJCQloZWlnaHQ6IHRoaXMuaGVpZ2h0ICogMC45LAoJCQkJbG9hZGVyOiBvID0+IHsKCQkJCQlrdi52YWx1ZXMuZmlsdGVyKHYgPT4gdi50eXBlICE9PSAnbGluaycgfHwgKHYudHlwZSA9PSAnbGluaycgJiYgdi5uYW1lLnN0YXJ0c1dpdGgoJ18nKSkpLmZvckVhY2godiA9PiAkKCIjcG5sXyIgKyB2Lmdyb3VwICsgJy1jZW50ZXInKS5hcHBlbmQoJCgiI2ZFbGVtZW50XyIgKyB2Lm5hbWUpKSk7CgkJCQkJcmV0dXJuIG51bGw7CgkJCQl9LAoJCQkJYnV0dG9uczogW10uY29uY2F0LmFwcGx5KFtdLCBrdi52YWx1ZXMuZmlsdGVyKHYgPT4gdi50eXBlID09ICdsaW5rJyAmJiAhdi5uYW1lLnN0YXJ0c1dpdGgoJ18nKSkubWFwKHYgPT4gWy4uLnYubGlua3MubWFwKGwgPT4gKHsKCQkJCQluYW1lOiBsLm5hbWUgfHwgbC5sYWJlbCwKCQkJCQl0aXRsZTogbC50aXRsZSB8fCBsLmxhYmVsLAoJCQkJCW9uQ2xpY2s6IGwub25DbGljaywKCQkJCQlpY29uOiBsLmljb24sCgkJCQkJd2luZG93OiB0cnVlLAoJCQkJCWdyb3VwOiBrdi5rZXksCgkJCQl9KSldKSksCgkJCX07CgkJCXRoaXMuYnV0dG9ucy5wdXNoKC4uLmUuYnV0dG9ucyk7CgoJCQl0aGlzLmVsZW1lbnRzLnB1c2goZSk7CgkJfSk7CgoJCXZhciByZXQgPSAiIjsKCQkvLyBjaGVjayB0aGUgb3B0aW9uIG9mIHVzaW5nIHdpbmRvdygpIGFzIGEgcmVuZGVyZXIgb2YgdGhlIG1haW4gd2luZG93Li4uCgkJaWYgKHRydWUpIHsKCQkJdGhpcy5lbGVtZW50cy5maWx0ZXIoZSA9PiAhZS56b25lKS5mb3JFYWNoKGUgPT4gZS56b25lID0gJ2NlbnRlcicpOwoJCQlsZXQgd09wdGlvbnMgPSB7CgkJCQluYW1lOiBuYW1lIHx8IHRoaXMubmFtZSwKCQkJCXRpdGxlOiB0aXRsZSB8fCB0aGlzLnRpdGxlLAoJCQkJdHlwZTogJ3dpbmRvdycsCgkJCQl2aXNpYmxlOiB0cnVlLAoJCQkJd2lkdGg6IHRoaXMud2lkdGgsCgkJCQloZWlnaHQ6IHRoaXMuaGVpZ2h0LAoJCQkJZml4ZWQ6IGJGaXhlZCwKCQkJCWxpbmtzOiBbewoJCQkJCWljb246ICJoZWxwIiwKCQkJCQlhY3Rpb246IG8gPT4gJCgiI3BubF9fQ29uc29sZSIpLndpbmRvdygnb3BlbicpCgkJCQl9XSwKCQkJCWJ1dHRvbnM6IHRoaXMuYnV0dG9ucy5maWx0ZXIoYiA9PiAhYi53aW5kb3cpLAoJCQl9OwoJCQl0aGlzLnNyKCkuZ3JvdXBCeSh0aGlzLmVsZW1lbnRzLCAnem9uZScpLmZpbHRlcih6ZyA9PiB6Zy5rZXkpLmZvckVhY2goemcgPT4gewoJCQkJd09wdGlvbnNbemcua2V5XSA9IHRoaXMucmVuZGVyRWxlbWVudHMoemcudmFsdWVzKTsKCQkJfSk7CgoJCQlyZXQgPSB0aGlzLndpbmRvdyh3T3B0aW9ucyk7CgkJfSBlbHNlIHsKCQkJcmV0ID0gdGhpcy5oZWFkZXIobmFtZSwgdGl0bGUsIGJGaXhlZCwgW3sKCQkJCWljb246ICJoZWxwIiwKCQkJCWFjdGlvbjogbyA9PiAkKCIjcG5sX19Db25zb2xlIikud2luZG93KCdvcGVuJykKCQkJfV0pOwoKCQkJcmV0ICs9IHRoaXMucmVuZGVyRWxlbWVudHMoKTsKCgkJCXJldCArPSB0aGlzLmZvb3RlcihiRml4ZWQpOwoKCQl9CgkJLy8gY29uc29sZS5sb2cocmV0KTsKCgkJcmV0dXJuIHJldDsKCX0KCgljV2lkdGgob3B0aW9ucykgewoJCWxldCByZXQgPSBNYXRoLmZsb29yKCgob3B0aW9ucyA/IG9wdGlvbnMud2lkdGggOiBudWxsKSB8fCAodGhpcy53aWR0aCAvIDMpKSk7CgkJaWYgKG9wdGlvbnMuem9uZSA9PSAnZWFzdCcgfHwgb3B0aW9ucy56b25lID09ICd3ZXN0JykgewoJCQlyZXQgPSAwLjI1ICogcmV0OyAvLyA5MCUgb2YgMy8xMCwgdGhlIHdpZHRoIG9mIHRoZSBub3JtYWwgZWxlbWVudAoJCX0gZWxzZSBpZiAob3B0aW9ucyAmJiBvcHRpb25zLmVkaXRvcikgewoJCQlyZXQgPSB3aW5kb3cuaW5uZXJXaWR0aDsKCQl9IGVsc2UgaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy53aWR0aCAmJiB0eXBlb2Yob3B0aW9ucy53aWR0aCkgPT09ICdzdHJpbmcnKSB7CgkJCXJldCA9IHRoaXMud2lkdGg7CgkJfSBlbHNlIGlmIChvcHRpb25zICYmIG9wdGlvbnMudHlwZSA9PSAnd2luZG93JyAmJiAhb3B0aW9ucy53aWR0aCkgewoJCQlyZXQgPSB0aGlzLndpZHRoICogMC45OwoJCX0KCgkJLy8gY29uc29sZS5sb2cob3B0aW9ucy5uYW1lICsgIjogY1dpZHRoID0gIiArIHJldCwgb3B0aW9ucy56b25lKTsKCQlyZXR1cm4gcmV0OwoJfQoKCXdpbmRvdyhvcHRpb25zKSB7CgkJb3B0aW9ucy50aXRsZSA9IG9wdGlvbnMudGl0bGUgfHwgb3B0aW9ucy5uYW1lOwoJCXZhciByZXQgPSBgCgkJPGRpdiBpZCA9ICJwbmwke29wdGlvbnMubmFtZX0iIGNsYXNzPSJlYXN5dWktd2luZG93IiB0aXRsZT0iJHtvcHRpb25zLnRpdGxlIHx8IHRoaXMuZW5nbGlzaChvcHRpb25zLm5hbWUpfSIgZGF0YS1vcHRpb25zPScke3RoaXMuZXZlbnRIYW5kbGVycyhvcHRpb25zKX0sIGNsb3NlZDokeyFvcHRpb25zLnZpc2libGV9LG1pbmltaXphYmxlOiR7IW9wdGlvbnMuZml4ZWR9LG1heGltaXphYmxlOiR7IW9wdGlvbnMuZml4ZWR9LGNsb3NhYmxlOiR7IW9wdGlvbnMuZml4ZWR9LGNvbGxhcHNpYmxlOiR7IW9wdGlvbnMuZml4ZWR9LGRyYWdnYWJsZTokeyFvcHRpb25zLmZpeGVkfSxyZXNpemFibGU6JHshb3B0aW9ucy5maXhlZH0saWNvbkNsczoiaWNvbi0ke29wdGlvbnMuaWNvbn0iLCB0b29sczoiIyR7b3B0aW9ucy5uYW1lfV90b29scyInIHN0eWxlPSJ3aWR0aDoke3RoaXMuY1dpZHRoKG9wdGlvbnMpfXB4O2hlaWdodDoke3RoaXMuY0hlaWdodChvcHRpb25zKX1weDtwYWRkaW5nOjEwcHg7Ij4KCQkgICAgPGRpdiBjbGFzcz0iZWFzeXVpLWxheW91dCIgZGF0YS1vcHRpb25zPSJmaXQ6dHJ1ZSI+CgkJYDsKCgkJbGV0IGJab25lID0gb3B0aW9ucy5zb3V0aCA/ICdzb3V0aCcgOiAodGhpcy56b25lcy5maW5kKHogPT4geiA9PSAnc291dGgnKSB8fCB0aGlzLnpvbmVzWzBdKTsKCQlvcHRpb25zW2Jab25lXSA9IG9wdGlvbnNbYlpvbmVdIHx8IFtdOwoJCWxldCB6V2lkdGggPSBNYXRoLm1pbigxMjAsIHRoaXMud2lkdGggKiAwLjk1IC8gKG9wdGlvbnMuYnV0dG9ucyA/IG9wdGlvbnMuYnV0dG9ucy5sZW5ndGggOiAxKSwgdGhpcy5jV2lkdGgob3B0aW9ucykpOwoJCW9wdGlvbnNbYlpvbmVdLnB1c2goYDxkaXYgaWQ9InBubCR7b3B0aW9ucy5uYW1lfS1idXR0b25zIiBkYXRhLW9wdGlvbnM9InJlZ2lvbjonJHtiWm9uZX0nLGJvcmRlcjpmYWxzZSIgc3R5bGU9InRleHQtYWxpZ246cmlnaHQ7cGFkZGluZzo1cHggMCAwOyI+YCArICQubWFwKCQuZ3JlcChvcHRpb25zLmJ1dHRvbnMgfHwgW10sIGIgPT4gIWIuaWdub3JlKSwgYiA9PiBgPGEgaWQ9JyR7Yi5uYW1lfScgaHJlZj0iamF2YXNjcmlwdDp2b2lkKDApIiBjbGFzcz0iZWFzeXVpLWxpbmtidXR0b24gYzYiIGljb25DbHM9Imljb24tJHtiLmljb24gfHwgJ3NhdmUnfSIgc3R5bGU9IndpZHRoOiR7eldpZHRofXB4IiBvbmNsaWNrPSdERm9ybS5kb0NsaWNrKCR7X0ZyRU1ELl90b0pTKGIpfSknPiR7Yi50aXRsZSB8fCBiLm5hbWV9PC9hPiZuYnNwOyZuYnNwO2ApLmpvaW4oJycpICsgYDwvZGl2PmApOwoKCQl0aGlzLnpvbmVzLmZpbHRlcih6ID0+IG9wdGlvbnNbel0pLmZvckVhY2goeiA9PiB7CgkJCXJldCArPSBgCgkJICAgICAgICA8ZGl2IGRhdGEtb3B0aW9ucz0icmVnaW9uOicke3p9JyIgdGl0bGU9IiR7KHo9PSd3ZXN0JyB8fCB6PT0nZWFzdCcpPycmbmJzcDsnOicnfSIgc3R5bGU9J2hlaWdodDokeyh6PT0nbm9ydGgnfHx6PT0nc291dGgnKT8xMDoxMDB9JTt3aWR0aDokeygoej09J2Vhc3QnfHx6PT0nd2VzdCcpPzAuMToxKSp0aGlzLmNXaWR0aChvcHRpb25zKX1weCc+CiAgICAgICAgCQkgICAgJHsoQXJyYXkuaXNBcnJheShvcHRpb25zW3pdKT9vcHRpb25zW3pdOltvcHRpb25zW3pdXSkuam9pbignJyl9CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgYDsKCQl9KTsKCgkJcmV0ICs9IGA8L2Rpdj48L2Rpdj5gOwoKCQkvLyBsaW5rcyAodG9vbHMpCgkJbGV0IGxpbmtzID0gJC5ncmVwKFtdLmNvbmNhdChvcHRpb25zLmxpbmtzIHx8IFtdKSwgbCA9PiAhbC5pZ25vcmUpOwoJCXJldCArPSBgPGRpdiBpZD0iJHtvcHRpb25zLm5hbWV9X3Rvb2xzIj5gICsgJC5tYXAobGlua3MucmV2ZXJzZSgpLCBsID0+IGA8YSBocmVmPSJqYXZhc2NyaXB0OnZvaWQoMCkiIHN0eWxlPSJjb2xvcjpibGFjayIgY2xhc3M9ImZhcyBmYS0ke2wuaWNvbiB8fCAnYWRkJ30iIG9uY2xpY2s9Jyhhc3luYyAoKSA9PiB7dmFyIGEgPSAke19GckVNRC5fdG9KUyhsKX07ICQoIiNwbmwke29wdGlvbnMubmFtZX0iKS53aW5kb3coInNldFRpdGxlIiwgIiR7b3B0aW9ucy50aXRsZX06ICIgKyBhLm5hbWUpOyBhd2FpdCBhLmFjdGlvbihERm9ybS5nZXQoKSwgYSwgJHtfRnJFTUQuX3RvSlMob3B0aW9ucyl9KTsgJCgiI3BubCR7b3B0aW9ucy5uYW1lfSIpLndpbmRvdygic2V0VGl0bGUiLCAiJHtvcHRpb25zLnRpdGxlfSIpO30pKCknPjwvYT5gKS5qb2luKCdcbicpICsgYDwvZGl2PmA7CgoJCXJldHVybiByZXQ7Cgl9CgoJYXN5bmMgX2VuZCgpIHsKCQlsZXQgbyA9IHRoaXMuZ2V0KCk7CgoJCS8vIGRvIG5vdCB1c2UgdGhlIGZpcnN0IGJ1dHRvbiwgYmVjYXVzZSBtYW55IGZvcm1zIGhhdmUgYSBDYW5jZWwgYnV0dG9uIG9ubHkKCQlsZXQgYnV0dG9uID0gdGhpcy5idXR0b25zLmZpbmQoYiA9PiBiLmF1dG9TdWJtaXQpIC8qIHx8IHRoaXMuYnV0dG9uc1swXSovIDsKCQlpZiAoYnV0dG9uICYmIG8gJiYgT2JqZWN0LnZhbHVlcyhvKS5sZW5ndGggJiYgKHR5cGVvZihidXR0b24uYXV0b1N1Ym1pdCkgPT09ICJ1bmRlZmluZWQiIHx8IGJ1dHRvbi5hdXRvU3VibWl0KSkgewoJCQlsZXQgdiA9IE9iamVjdC52YWx1ZXMobykucmVkdWNlKCh0LCB2KSA9PiB7CgkJCQlyZXR1cm4gKCh0eXBlb2YodikgIT09ICJvYmplY3QiKSA/IDEgOiAwKSAqICh2ID8gMSA6IDApOwoJCQl9KTsKCQkJLy9jb25zb2xlLmxvZyhvLCBPYmplY3QudmFsdWVzKG8pLCB2KTsKCQkJaWYgKHYpIHsKCQkJCS8vIGFsbCBmaWVsZHMgaGF2ZSB2YWx1ZXMKCQkJCWF3YWl0IHRoaXMuZG9DbGljayhidXR0b24pOwoKCQkJfQoJCX0KCX0KCglmb290ZXIoYkZpeGVkKSB7CgkJcmV0dXJuIGA8L2Zvcm0+YCArIGA8ZGl2IGlkPSJkbGctYnV0dG9ucyI+YCArIHRoaXMuYnV0dG9ucy5maWx0ZXIoYiA9PiAhYi53aW5kb3cpLm1hcChiID0+IGA8YSBpZD0nJHtiLm5hbWV9JyBocmVmPSJqYXZhc2NyaXB0OnZvaWQoMCkiIGNsYXNzPSJlYXN5dWktbGlua2J1dHRvbiBjNiIgaWNvbkNscz0iaWNvbi0ke2IuaWNvbiB8fCAnc2F2ZSd9IiBzdHlsZT0id2lkdGg6JHtNYXRoLm1pbigxMjAsIHRoaXMud2lkdGggKiAwLjk1IC8gdGhpcy5idXR0b25zLmxlbmd0aCwgdGhpcy5jV2lkdGgoKSl9cHgiIG9uY2xpY2s9J0RGb3JtLmRvQ2xpY2soJHtfRnJFTUQuX3RvSlMoYil9KSc+JHtiLnRpdGxlIHx8IGIubmFtZX08L2E+Jm5ic3A7Jm5ic3A7YCkuam9pbignJykgKyAiPC9kaXY+IiArIChiRml4ZWQgPyAiIiA6ICc8L2Rpdj4nKTsKCX0KCgloZWFkZXIobmFtZSwgdGl0bGUsIGJGaXhlZCwgbGlua3MpIHsKCQl0aGlzLnRpdGxlID0gdGl0bGUgfHwgdGhpcy50aXRsZTsKCQluYW1lID0gbmFtZSB8fCB0aGlzLm5hbWU7CgkJdmFyIHJldCA9ICcnOwoKCQlyZXQgKz0gdGhpcy53aW5kb3coewoJCQluYW1lOiAiX19Db25zb2xlIiwKCQkJdHlwZTogIndpbmRvdyIsCgkJCWVkaXRvcjogdHJ1ZSwKCQkJbG9hZGVyOiBvID0+IHdpbmRvdy5sb2dzLnNsaWNlKCkucmV2ZXJzZSgpLm1hcChsID0+IGwuZGF0ZS50b0lTT1N0cmluZygpICsgIjogIiArIGwuYXJncy5tYXAocyA9PiB0eXBlb2YocykgPT09ICdvYmplY3QnID8gKChvYmosIGluZGVudCA9IDIpID0+IHsKCQkJCWxldCBjYWNoZSA9IFtdOwoJCQkJY29uc3QgcmV0VmFsID0gSlNPTi5zdHJpbmdpZnkoCgkJCQkJb2JqLAoJCQkJCShrZXksIHZhbHVlKSA9PgoJCQkJCXR5cGVvZiB2YWx1ZSA9PT0gIm9iamVjdCIgJiYgdmFsdWUgIT09IG51bGwgPwoJCQkJCWNhY2hlLmluY2x1ZGVzKHZhbHVlKSA/CgkJCQkJdW5kZWZpbmVkIC8vIER1cGxpY2F0ZSByZWZlcmVuY2UgZm91bmQsIGRpc2NhcmQga2V5CgkJCQkJOgoJCQkJCWNhY2hlLnB1c2godmFsdWUpICYmIHZhbHVlIC8vIFN0b3JlIHZhbHVlIGluIG91ciBjb2xsZWN0aW9uCgkJCQkJOgoJCQkJCXZhbHVlLAoJCQkJCWluZGVudAoJCQkJKTsKCQkJCWNhY2hlID0gbnVsbDsKCQkJCXJldHVybiByZXRWYWw7CgkJCX0pKHMpIDogcykuam9pbignLCAnKSkuam9pbignXG4nKSwKCQl9KTsKCgkJaWYgKCFiRml4ZWQpIHsKCQkJbGlua3MgPSAobGlua3MgfHwgW10pLmZpbHRlcihsID0+ICFsLmlnbm9yZSk7CgkJCWxldCB0RGF0YSA9ICIiOwoJCQlpZiAobGlua3MubGVuZ3RoKSB7CgkJCQlyZXQgKz0gYDxkaXYgaWQ9IiR7dGhpcy5uYW1lfV90b29scyI+YCArIGxpbmtzLm1hcChsID0+IGA8YSBocmVmPSJqYXZhc2NyaXB0OnZvaWQoMCkiIGNsYXNzPSJpY29uLSR7bC5pY29ufSIgb25jbGljaz0nKGFzeW5jICgpID0+IHt2YXIgYSA9ICR7X0ZyRU1ELl90b0pTKGwpfTsgJCgiI3dpbiR7dGhpcy5uYW1lfSIpLndpbmRvdygic2V0VGl0bGUiLCAiJHt0aGlzLnRpdGxlfTogIiArIGEubmFtZSk7IGF3YWl0IGEuYWN0aW9uKERGb3JtLmdldCgpKTsgJCgiI3dpbiR7dGhpcy5uYW1lfSIpLndpbmRvdygic2V0VGl0bGUiLCAiJHt0aGlzLnRpdGxlfSIpO30pKCknPjwvYT5gKS5qb2luKCdcbicpICsgIjwvZGl2PiI7CgkJCQl0RGF0YSA9IGAsdG9vbHM6IiMke3RoaXMubmFtZX1fdG9vbHMiYDsKCQkJfQoJCQlyZXQgKz0gYDxkaXYgaWQ9J3dpbiR7dGhpcy5uYW1lfScgY2xhc3M9J2Vhc3l1aS13aW5kb3cnIHRpdGxlPScke3RoaXMudGl0bGUgfHwgdGhpcy5lbmdsaXNoKHRoaXMubmFtZSl9JyBkYXRhLW9wdGlvbnM9J2ljb25DbHM6Imljb24tc2F2ZSIgJHt0RGF0YX0nIHN0eWxlPSd3aWR0aDoke3RoaXMud2lkdGh9cHg7aGVpZ2h0OiR7dGhpcy5oZWlnaHR9cHg7cGFkZGluZzoxMHB4Oyc+YDsKCQl9CgkJcmV0dXJuIHJldCArIGA8Zm9ybSBpZD0iZnJtJHt0aGlzLm5hbWV9IiBtZXRob2Q9InBvc3QiIG5vdmFsaWRhdGU+YDsKCX0KCglyZW5kZXJFbGVtZW50cyhlbGVtZW50cykgewoJCWVsZW1lbnRzID0gZWxlbWVudHMgfHwgdGhpcy5lbGVtZW50czsKCgkJdmFyIHRXaWR0aCA9IE1hdGguZmxvb3IodGhpcy53aWR0aCAqIDAuOTUpOwoJCXZhciB0SGVpZ2h0ID0gTWF0aC5mbG9vcih0aGlzLmhlaWdodCAqIDAuODUpOwoKCQlsZXQgcmV0ID0gJyc7CgkJdmFyIGdFbGVtZW50cyA9IHRoaXMuc3IoKS5ncm91cEJ5KGVsZW1lbnRzLCAiZ3JvdXAiKTsKCQlpZiAoZ0VsZW1lbnRzLmxlbmd0aCA+IDEpIHJldCArPSBgPGRpdiBpZD0idGJjV2luZG93IiBjbGFzcz0iZWFzeXVpLXRhYnMiIGRhdGEtb3B0aW9ucz0nJHt0aGlzLmV2ZW50SGFuZGxlcnMoe3R5cGU6ICd0YWJzJ30pfScgc3R5bGU9IndpZHRoOiR7dFdpZHRofXB4O2hlaWdodDoke3RIZWlnaHR9cHg7Ij5gOwoJCWZvciAodmFyIGcgPSAwOyBnIDwgZ0VsZW1lbnRzLmxlbmd0aDsgZysrKSB7CgkJCWlmIChnRWxlbWVudHMubGVuZ3RoID4gMSkgcmV0ICs9ICc8ZGl2IHRpdGxlPSInICsgKGdFbGVtZW50c1tnXS5rZXkgfHwgIk1haW4iKSArICciIHN0eWxlPSJwYWRkaW5nOjIwcHg7ZGlzcGxheTpub25lOyI+JzsKCQkJdmFyIHNFbGVtZW50cyA9IHRoaXMuc3IoKS5ncm91cEJ5KGdFbGVtZW50c1tnXS52YWx1ZXMsICJzZWN0aW9uIik7CgkJCWlmIChzRWxlbWVudHMubGVuZ3RoID4gMSkgcmV0ICs9ICc8ZGl2IGNsYXNzPSJlYXN5dWktYWNjb3JkaW9uIiBzdHlsZT0id2lkdGg6JyArIHRXaWR0aCArICdweDtoZWlnaHQ6JyArIC8qdEhlaWdodCovICIxMDAlIiArICdweDsiPic7CgkJCWZvciAodmFyIHMgPSAwOyBzIDwgc0VsZW1lbnRzLmxlbmd0aDsgcysrKSB7CgkJCQlyZXQgKz0gYDxkaXYgdGl0bGU9IiR7c0VsZW1lbnRzW3NdLmtleSB8fCAiIn0iIGRhdGEtb3B0aW9ucz0iaWNvbkNsczonaWNvbi1tb3JlJyIgc3R5bGU9InBhZGRpbmc6MTBweDsiPmA7CgkJCQlmb3IgKHZhciBpID0gMDsgaSA8IHNFbGVtZW50c1tzXS52YWx1ZXMubGVuZ3RoOyBpKyspIHsKCQkJCQl2YXIgZSA9IHNFbGVtZW50c1tzXS52YWx1ZXNbaV07CgkJCQkJaWYgKGUuaWdub3JlKSBjb250aW51ZTsKCQkJCQllLnZhbHVlID0gZS52YWx1ZSB8fCBfRnJFTUQuaGFzaFtlLm5hbWVdIHx8IChfRnJFTUQuYXBpU2VydmVyID8gX0ZyRU1ELmFwaVNlcnZlci5fX2NvbmZpZygndGVzdF8nICsgZS5uYW1lLCAnJykgOiAnJyk7CgkJCQkJcmV0ICs9IGA8ZGl2IGlkPSJmRWxlbWVudF8ke2UubmFtZX0iIGNsYXNzPSJmaXRlbSIgc3R5bGU9ImRpc3BsYXk6ICR7KGUudHlwZT09J3dpbmRvdycgfHwgZS5oaWRkZW4pPydub25lJzonJ30iPmA7CgkJCQkJaWYgKGUudG9nZ2xlKSB7CgkJCQkJCXJldCArPSBgPGEgaHJlZj0iIyIgY2xhc3M9ImVhc3l1aS1saW5rYnV0dG9uIiBkYXRhLW9wdGlvbnM9JyR7dGhpcy5ldmVudEhhbmRsZXJzKHt0eXBlOiAndG9nZ2xlJywgZm9yOiBlfSl9LHBsYWluOnRydWUsaWNvbkNsczoiaWNvbi0ke2UuaWNvbiB8fCAnc2VhcmNoJ30iJyBzdHlsZT0id2lkdGg6MTAwcHg7aGVpZ2h0OjMwcHgiPiR7ZS50aXRsZSB8fCB0aGlzLmVuZ2xpc2goZS5uYW1lKX08L2E+YDsKCQkJCQl9IGVsc2UgewoJCQkJCQlyZXQgKz0gYDxsYWJlbD4ke2UudGl0bGUgfHwgdGhpcy5lbmdsaXNoKGUubmFtZSl9OjwvbGFiZWw+YDsKCQkJCQl9CgkJCQkJaWYgKGUudHlwZSAmJiB0aGlzW2UudHlwZV0pIHsKCQkJCQkJcmV0ICs9IHRoaXNbZS50eXBlXShlKTsKCQkJCQl9IGVsc2UgaWYgKGUucmVuZGVyKSB7CgkJCQkJCXJldCArPSBlLnJlbmRlcigpOwoJCQkJCX0KCQkJCQlyZXQgKz0gJzwvZGl2Pic7CgkJCQl9CgkJCQlyZXQgKz0gJzwvZGl2Pic7CgkJCX0KCQkJaWYgKHNFbGVtZW50cy5sZW5ndGggPiAxKSByZXQgKz0gJzwvZGl2Pic7CgkJCWlmIChnRWxlbWVudHMubGVuZ3RoID4gMSkgcmV0ICs9ICI8L2Rpdj4iOwoJCX0KCQlpZiAoZ0VsZW1lbnRzLmxlbmd0aCA+IDEpIHJldCArPSAiPC9kaXY+IjsKCQlyZXR1cm4gcmV0OwoJfQoKCWluZm8obXNnKSB7CgkJaWYgKCQubWVzc2FnZXIpIHsKCQkJJC5tZXNzYWdlci5hbGVydCh0aGlzLnRpdGxlLCBtc2csICdpbmZvJyk7CgkJfSBlbHNlIHsKCQkJdGhpcy5zcigpLlNob3dNZXNzYWdlKG1zZywgdGhpcy50aXRsZSk7CgkJfQoJfQoKCWVycm9yKG1zZykgewoJCWlmICgkLm1lc3NhZ2VyKSB7CgkJCSQubWVzc2FnZXIuYWxlcnQodGhpcy50aXRsZSwgbXNnLCAnZXJyb3InKTsKCQl9IGVsc2UgewoJCQl0aGlzLnNyKCkuU2hvd01lc3NhZ2UobXNnLCB0aGlzLnRpdGxlKTsKCQl9Cgl9CgoJYnlOYW1lKG5hbWUpIHsKCQlyZXR1cm4gdGhpcy5lbGVtZW50cy5maW5kKGUgPT4gZS5uYW1lID09PSBuYW1lKTsKCX0KCgkvKiogQ29tcG9uZW50czo6U3RhcnQgKiovCglDb3JlQ29tcG9uZW50ID0gY2xhc3MgewoJCWNvbnN0cnVjdG9yKHBhZ2UsIGRGb3JtKSB7CgkJCXRoaXMucGFnZSA9IHBhZ2U7CgkJCXRoaXMuZEZvcm0gPSBkRm9ybTsKCQl9CgoJCWJ1c3koYkJ1c3kpIHsKCQkJcmV0dXJuIHRoaXMuZEZvcm0uYnVzeShiQnVzeSk7CgkJfQoKCQlfbWUodikgewoJCQlsZXQgbWVOYW1lID0gKHR5cGVvZihjb21wYW55KSAhPT0gJ3VuZGVmaW5lZCcpID8gKGNvbXBhbnkubG9nZ2VkSW5JZGVudGl0eSB8fCAibWUiKSA6ICJtZSI7CgkJCWlmICh2KSB7CgkJCQl3aW5kb3dbbWVOYW1lXSA9IHY7CgkJCX0KCgkJCXJldHVybiB3aW5kb3dbbWVOYW1lXTsKCQl9CgoJCV9jYW5WaWV3KCkgewoJCQlpZiAoIXRoaXMuX21lKCkpIHsKCQkJCXdpbmRvdy5fRnJFTUQuc2V0VVJMKHsKCQkJCQlwYWdlOiAnbG9naW4nLAoJCQkJCV9yZWRpcmVjdDogdGhpcy5wYWdlLl9jb2RlLAoJCQkJfSk7CgkJCQl0aHJvdyBgX2NhblZpZXc6ICR7dGhpcy5wYWdlLl9jb2RlfSBub3QgYWxsb3dlZCB3aXRob3V0IGxvZ2luIWA7CgkJCX0KCQl9CgoJCV9uYW1lKCkgewoJCQlpZiAoIXRoaXMuX21lKCkpIHJldHVybiAiIjsKCQkJcmV0dXJuIHRoaXMuX21lKCkubmFtZSA/IHRoaXMuX21lKCkubmFtZSgpIDogdGhpcy5fbWUoKS5Ub1N0cmluZzsKCQl9Cgl9CgoJSW5kZXhDb21wb25lbnQgPSBjbGFzcyBleHRlbmRzIHRoaXMuQ29yZUNvbXBvbmVudCB7CgkJYXN5bmMgbWFpbigpIHsKCQkJdGhpcy5fY2FuVmlldygpOwoKCQkJdGhpcy5wYWdlLmRhdGEgPSB7CgkJCQlmb3JtOiB0aGlzLmRGb3JtLnJlbmRlcignZnJtSW5kZXgnLCAiTWFpbiBQYWdlIiwgW3sKCQkJCQluYW1lOiAnV2VsY29tZScsCgkJCQkJcmVxdWlyZWQ6IHRydWUsCgkJCQkJdHlwZTogImxhYmVsIiwKCQkJCQl2YWx1ZTogdGhpcy5fbmFtZSgpLAoJCQkJfV0sIFtdKQoJCQl9OwoJCX0KCX0KCglMb2dpbkNvbXBvbmVudCA9IGNsYXNzIGV4dGVuZHMgdGhpcy5Db3JlQ29tcG9uZW50IHsKCQlhc3luYyBfYXV0aGVudGljYXRlKG8pIHsKCQkJcmV0dXJuIG51bGw7CgkJfQoKCQlhc3luYyBfbG9nZ2VkSW4oKSB7fQoKCQlhc3luYyBfbm90TG9nZ2VkSW4oKSB7fQoKCQlhc3luYyBtYWluKCkgewoJCQl0aGlzLnBhZ2UuZGF0YSA9IHsKCQkJCWZvcm06IHRoaXMuZEZvcm0ucmVuZGVyKCdmcm1Mb2dpbicsICJVc2VyIEF1dGhlbnRpY2F0aW9uIiwgW3sKCQkJCQkJbmFtZTogJ1VzZXJuYW1lJywKCQkJCQkJcmVxdWlyZWQ6IHRydWUsCgkJCQkJCXR5cGU6ICJzdHJpbmciCgkJCQkJfSwKCQkJCQl7CgkJCQkJCW5hbWU6ICdQYXNzd29yZCcsCgkJCQkJCXJlcXVpcmVkOiB0cnVlLAoJCQkJCQl0eXBlOiAicGFzc3dvcmQiCgkJCQkJfQoJCQkJXSwgW3sKCQkJCQluYW1lOiAnTG9naW4nLAoJCQkJCWF1dG9TdWJtaXQ6IHRydWUsCgkJCQkJb25jbGljazogYXN5bmMgbyA9PiB7CgkJCQkJCWxldCByZXQgPSBhd2FpdCB0aGlzLl9hdXRoZW50aWNhdGUobyk7CgoJCQkJCQlpZiAocmV0KSB7CgkJCQkJCQl0aGlzLl9tZShyZXQpOwoKCQkJCQkJCXRyeSB7CgkJCQkJCQkJYXdhaXQgdGhpcy5fbG9nZ2VkSW4oKTsKCQkJCQkJCX0gY2F0Y2ggKGV4KSB7fQoKCQkJCQkJCV9GckVNRC5zZXRVUkwoewoJCQkJCQkJCXBhZ2U6IF9GckVNRC5oYXNoLl9yZWRpcmVjdCB8fCAiaW5kZXgiCgkJCQkJCQl9KTsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCXRyeSB7CgkJCQkJCQkJYXdhaXQgdGhpcy5fbm90TG9nZ2VkSW4oKTsKCQkJCQkJCX0gY2F0Y2ggKGV4KSB7fQoKCQkJCQkJCXRoaXMuZEZvcm0uZXJyb3IoIkludmFsaWQgdXNlcm5hbWUgb3IgcGFzc3dvcmQiKTsKCQkJCQkJfQoKCQkJCQkJdGhpcy5kRm9ybS5idXN5KGZhbHNlKTsKCQkJCQl9CgkJCQl9XSkKCQkJfTsKCQl9Cgl9CgoJU3RvcmVDb21wb25lbnQgPSBjbGFzcyBleHRlbmRzIHRoaXMuQ29yZUNvbXBvbmVudCB7CgkJYXN5bmMgbWFpbigpIHt9Cgl9CgkvKiogQ29tcG9uZW50czo6RW5kICoqLwp9Ow==",
	"Name": "DynaForm",
	"Script": "d2luZG93LkR5bmFGb3JtID0gY2xhc3MgewoJY29uc3RydWN0b3IoKSB7CgkJdGhpcy50aXRsZSA9ICJGb3JtIFRpdGxlIjsKCQl0aGlzLm5hbWUgPSAiZnJtRm9ybSI7CgkJdGhpcy5lbGVtZW50cyA9IFtdOwoJCXRoaXMuc2VsZWN0cyA9IFtdOwoJCXRoaXMuZ3JpZHMgPSBbXTsKCQl0aGlzLmJ1dHRvbnMgPSBbXTsKCQl0aGlzLnpvbmVzID0gWydub3J0aCcsICdzb3V0aCcsICdlYXN0JywgJ3dlc3QnLCAnY2VudGVyJ107CgkJdGhpcy5zVGFibGUgPSBudWxsOwoJCXRoaXMuYkRlYnVnID0gZmFsc2U7CgkJdGhpcy51aVR5cGVzID0gewoJCQlpbnQ6ICJudW1iZXJzcGlubmVyIiwKCQkJbWVudTogInNwbGl0YnV0dG9uIiwKCQkJZGF0ZXRpbWU6ICJkYXRldGltZWJveCIsCgkJCWJvb2w6ICJzd2l0Y2hidXR0b24iLAoJCQlmaWxlOiAiZmlsZWJveCIsCgkJCXRleHQ6ICJ0ZXh0Ym94IiwKCQkJcGFzc3dvcmQ6ICJwYXNzd29yZGJveCIsCgkJCXN0cmluZzogInRleHRib3giLAoJCQlpbWFnZTogImRpYWxvZyIsCgkJCXByb2dyZXNzOiAicHJvZ3Jlc3NiYXIiLAoJCQlsaW5rOiAibGlua2J1dHRvbiIsCgkJCXRyZWU6ICJjb21ib3RyZWUiLAoJCQluYXZpZ2F0aW9uOiAidHJlZSIsCgkJCXNlYXJjaDogJ3NlYXJjaGJveCcsCgkJfTsKCQl0aGlzLmV2ZW50cyA9IFt7CgkJCW5hbWU6ICdvbkNsaWNrJywKCQkJaGFuZGxlcjogJ29uVG9nZ2xlJywKCQkJcGFyYW1zOiAnbj1ldmVudCcsCgkJCXR5cGU6ICd0b2dnbGUnLAoJCX0sIHsKCQkJbmFtZTogJ29uQ2xvc2UnLAoJCQloYW5kbGVyOiAnUGFuT25DbG9zZScsCgkJCXBhcmFtczogJ249ZXZlbnQnLAoJCQl0eXBlOiAnd2luZG93JywKCQl9LCB7CgkJCW5hbWU6ICdvblNlbGVjdCcsCgkJCWhhbmRsZXI6ICdTZWxlY3RDaGFuZ2UnLAoJCQlwYXJhbXM6ICduJywKCQkJdHlwZTogJ3RhYnMnLAoJCX0sIHsKCQkJbmFtZTogJ3NlYXJjaGVyJywKCQkJaGFuZGxlcjogJ0ZpZWxkQ2hhbmdlJywKCQkJcGFyYW1zOiAnbiwgbycsCgkJCXR5cGU6ICdzZWFyY2hib3gnLAoJCX0sIHsKCQkJbmFtZTogJ29uQmVmb3JlRXhwYW5kJywKCQkJaGFuZGxlcjogJ0V4cGFuZCcsCgkJCXBhcmFtczogJ24nLAoJCQl0eXBlOiAndHJlZScsCgkJfSwgewoJCQluYW1lOiAnb25DaGFuZ2UnLAoJCQloYW5kbGVyOiAnRmllbGRDaGFuZ2UnLAoJCQlwYXJhbXM6ICduLCBvJwoJCX0sIHsKCQkJbmFtZTogJ29uQmVmb3JlT3BlbicsCgkJCWhhbmRsZXI6ICdQYW5lbE9wZW4nLAoJCQlwYXJhbXM6ICcnLAoJCQl0eXBlOiAnd2luZG93JywKCQl9LCB7CgkJCW5hbWU6ICdvbk9wZW4nLAoJCQloYW5kbGVyOiAnUGVuZEFmdGVyT3BlbicsCgkJCXBhcmFtczogJycsCgkJCXR5cGU6ICd3aW5kb3cnLAoJCX0sIHsKCQkJbmFtZTogJ29uQ2xpY2snLAoJCQloYW5kbGVyOiAnZG9MaW5rJywKCQkJcGFyYW1zOiAnbj1ldmVudCwgbycsCgkJCXR5cGU6ICdsaW5rJywKCQl9LCB7CgkJCW5hbWU6ICdvbkNsaWNrUm93JywKCQkJaGFuZGxlcjogJ0ZpZWxkQ2hhbmdlJywKCQkJcGFyYW1zOiAnbiwgbycsCgkJCXR5cGU6ICdncmlkJywKCQl9XTsKCgkJaWYgKHR5cGVvZigkKSAhPT0gJ3VuZGVmaW5lZCcpICQod2luZG93KS5yZXNpemUodGhpcy53aW5kb3dSZXNpemVkKTsKCQl0aGlzLndpbmRvd1Jlc2l6ZWQoKTsKCX0KCglzcigpIHsKCQlyZXR1cm4gdHlwZW9mKF9GckVNRCkgIT09ICd1bmRlZmluZWQnID8gX0ZyRU1ELnNyKCkgOiB3aW5kb3cuc3I7Cgl9CgoJcGFyc2UoKSB7CgkJJC5wYXJzZXIucGFyc2UoKTsKCX0KCgl3aW5kb3dSZXNpemVkKCkgewoJCXRoaXMud2lkdGggPSB3aW5kb3cuaW5uZXJXaWR0aDsKCQl0aGlzLmhlaWdodCA9IHdpbmRvdy5pbm5lckhlaWdodCAqIDAuODsKCX0KCglpbml0KCkgewoJCXZhciBzZWxlY3QgPSB7CgkJCWluaXQ6IGZ1bmN0aW9uKGNvbnRhaW5lciwgb3B0aW9ucykgewoJCQkJdmFyIG9wID0gbnVsbDsKCQkJCXZhciBmb3AgPSBudWxsOwoJCQkJZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmdyaWRzLmxlbmd0aDsgaSsrKQoJCQkJCWlmICh0cnVlIHx8IHRoaXMuZ3JpZHNbaV0uaWQgPT0gb3B0aW9ucy5zb3VyY2UpIG9wID0gdGhpcy5ncmlkc1tpXS5vcHRpb25zOwoJCQkJZm9yIChpID0gMDsgaSA8IG9wLmNvbHVtbnMubGVuZ3RoOyBpKyspCgkJCQkJaWYgKG9wLmNvbHVtbnNbaV0ubmFtZSA9PSBvcHRpb25zLmZpZWxkKSBmb3AgPSBvcC5jb2x1bW5zW2ldOwoJCQkJZm9wLndpZHRoID0gKHRoaXMud2lkdGggLyAzKTsKCQkJCXZhciBlID0gJCh0aGlzLnNlbGVjdChmb3ApKTsKCQkJCXZhciBpbnB1dCA9IGUuYXBwZW5kVG8oY29udGFpbmVyKTsKCQkJCWlucHV0LmNvbWJvZ3JpZCgpOwoJCQkJdGhpcy5iaW5kKGlucHV0KTsKCQkJCXJldHVybiBpbnB1dDsKCQkJfSwKCQkJZGVzdHJveTogZnVuY3Rpb24odGFyZ2V0KSB7CgkJCQkkKHRhcmdldCkucmVtb3ZlKCk7CgkJCX0sCgkJCWdldFZhbHVlOiBmdW5jdGlvbih0YXJnZXQpIHsKCQkJCXJldHVybiAkKHRhcmdldCkudmFsKCk7CgkJCX0sCgkJCXNldFZhbHVlOiBmdW5jdGlvbih0YXJnZXQsIHZhbHVlKSB7CgkJCQkkKHRhcmdldCkudmFsKHZhbHVlKTsKCQkJfSwKCQkJcmVzaXplOiBmdW5jdGlvbih0YXJnZXQsIHdpZHRoKSB7CgkJCQkkKHRhcmdldCkuX291dGVyV2lkdGgod2lkdGgpOwoJCQl9CgkJfTsKCQkkLmV4dGVuZCgkLmZuLmRhdGFncmlkLmRlZmF1bHRzLmVkaXRvcnMsIHsKCQkJZGF0ZXRpbWU6IHsKCQkJCWluaXQ6IGZ1bmN0aW9uKGNvbnRhaW5lciwgb3B0aW9ucykgewoJCQkJCW9wdGlvbnMud2lkdGggPSB0aGlzLmNXaWR0aChvcHRpb25zKTsKCQkJCQl2YXIgaW5wdXQgPSAkKHRoaXMuZGF0ZXRpbWUob3B0aW9ucykpLmFwcGVuZFRvKGNvbnRhaW5lcik7CgkJCQkJaW5wdXQuZGF0ZXRpbWVib3goKTsKCQkJCQlyZXR1cm4gaW5wdXQ7CgkJCQl9LAoJCQkJZGVzdHJveTogZnVuY3Rpb24odGFyZ2V0KSB7CgkJCQkJJCh0YXJnZXQpLnJlbW92ZSgpOwoJCQkJfSwKCQkJCWdldFZhbHVlOiBmdW5jdGlvbih0YXJnZXQpIHsKCQkJCQlyZXR1cm4gJCh0YXJnZXQpLnZhbCgpOwoJCQkJfSwKCQkJCXNldFZhbHVlOiBmdW5jdGlvbih0YXJnZXQsIHZhbHVlKSB7CgkJCQkJJCh0YXJnZXQpLnZhbCh2YWx1ZSk7CgkJCQl9LAoJCQkJcmVzaXplOiBmdW5jdGlvbih0YXJnZXQsIHdpZHRoKSB7CgkJCQkJJCh0YXJnZXQpLl9vdXRlcldpZHRoKHdpZHRoKTsKCQkJCX0KCQkJfSwKCQkJY2hlY2tib3g6IHsKCQkJCWluaXQ6IGZ1bmN0aW9uKGNvbnRhaW5lciwgb3B0aW9ucykgewoJCQkJCXZhciBpbnB1dCA9ICQodGhpcy5ib29sKG9wdGlvbnMpKS5hcHBlbmRUbyhjb250YWluZXIpOwoJCQkJCWlucHV0LnN3aXRjaGJ1dHRvbigpOwoJCQkJCXJldHVybiBpbnB1dDsKCQkJCX0sCgkJCQlkZXN0cm95OiBmdW5jdGlvbih0YXJnZXQpIHsKCQkJCQkkKHRhcmdldCkucmVtb3ZlKCk7CgkJCQl9LAoJCQkJZ2V0VmFsdWU6IGZ1bmN0aW9uKHRhcmdldCkgewoJCQkJCXJldHVybiAkKHRhcmdldCkudmFsKCk7CgkJCQl9LAoJCQkJc2V0VmFsdWU6IGZ1bmN0aW9uKHRhcmdldCwgdmFsdWUpIHsKCQkJCQkkKHRhcmdldCkudmFsKHZhbHVlKTsKCQkJCX0sCgkJCQlyZXNpemU6IGZ1bmN0aW9uKHRhcmdldCwgd2lkdGgpIHsKCQkJCQkkKHRhcmdldCkuX291dGVyV2lkdGgod2lkdGgpOwoJCQkJfQoJCQl9LAoJCQljb21ib3RyZWVncmlkOiBzZWxlY3QsCgkJCXNlbGVjdDogc2VsZWN0LAoJCX0pOwoJfQoKCWFzayhxdWVzdGlvbiwgZkFuc3dlciA9IHYgPT4gdiwgb3B0aW9ucykgewoJCSQubWVzc2FnZXIuY29uZmlybSh0aGlzLnRpdGxlLCBxdWVzdGlvbiwgZnVuY3Rpb24ocikgewoJCQlpZiAob3B0aW9ucykgewoJCQkJZm9yICh2YXIgaSA9IDA7IGkgPCBvcHRpb25zLmxlbmd0aDsgaSsrKSB7CgkJCQkJaWYgKG9wdGlvbnNbaV0uYW5zd2VyID09IHIpIHsKCQkJCQkJcmV0dXJuIGZBbnN3ZXIob3B0aW9uc1tpXS52YWx1ZSk7CgkJCQkJfQoJCQkJfQoJCQl9IGVsc2UgewoJCQkJcmV0dXJuIGZBbnN3ZXIocik7CgkJCX0KCQl9KTsKCX0KCgl0b3BEYXRhKGFyLCBnRmllbGQsIHZGaWVsZCwgdG9wKSB7CgkJaWYgKCF0b3ApIHsKCQkJcmV0dXJuIGFyOwoJCX0KCQlyZXQgPSBbXTsKCQkkLmVhY2godGhpcy5zcigpLmdyb3VwQnkoYXIsIGdGaWVsZCksIGZ1bmN0aW9uKGtleSwgdmFsdWVzKSB7CgkJCXZhbHVlcy52YWx1ZXMuc29ydCgoYSwgYikgPT4gewoJCQkJaWYgKHBhcnNlRmxvYXQoYVt2RmllbGRdKSA8IHBhcnNlRmxvYXQoYlt2RmllbGRdKSkgewoJCQkJCXJldHVybiAxOwoJCQkJfSBlbHNlIGlmIChwYXJzZUZsb2F0KGFbdkZpZWxkXSkgPiBwYXJzZUZsb2F0KGJbdkZpZWxkXSkpIHsKCQkJCQlyZXR1cm4gLTE7CgkJCQl9IGVsc2UgewoJCQkJCXJldHVybiAwOwoJCQkJfQoJCQl9KTsKCQkJJC5lYWNoKHZhbHVlcy52YWx1ZXMsIGZ1bmN0aW9uKGksIHYpIHsKCQkJCWlmIChpIDwgdG9wKSB7CgkJCQkJcmV0LnB1c2godik7CgkJCQl9CgkJCX0pOwoJCX0pOwoJCXJldHVybiByZXQ7Cgl9CgoJYXN5bmMgZG9DbGljayhidXR0b24pIHsKCQlsZXQgX3RoaXMgPSB0eXBlb2YodGhpcy5kb0NsaWNrKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMgOiB3aW5kb3cuREZvcm07CgkJYnV0dG9uID0gX3RoaXMuYnV0dG9ucy5maW5kKGIgPT4gYi5uYW1lID09IGJ1dHRvbi5uYW1lICYmIGIuZ3JvdXAgPT0gYnV0dG9uLmdyb3VwKTsKCQlfdGhpcy5idXN5KHRydWUpOwoJCV90aGlzLnNldCh7CgkJCVdvcmtQcm9ncmVzc1ZhbHVlOiAyMAoJCX0pCgoJCXZhciBvID0gX3RoaXMuZ2V0KCk7CgkJdmFyIHNNaXNzaW5nID0gX3RoaXMuZWxlbWVudHMuZmlsdGVyKGUgPT4gKGJ1dHRvbi53aW5kb3cgPyBidXR0b24uZ3JvdXAgPT0gZS5ncm91cCA6IHRydWUpKS5maWx0ZXIoZSA9PiBlLnJlcXVpcmVkICYmICFvW2UubmFtZV0pLm1hcChlID0+ICI8bGk+IiArIChlLmxhYmVsIHx8IGUubmFtZSkgKyAiPC9saT4iKS5qb2luKCIiKTsKCQlpZiAoc01pc3NpbmcpIHsKCQkJd2luZG93Ll9GckVNRC5fZXJyb3IoIk1pc3NpbmcgbWFuZGF0b3J5IGZpZWxkczo8YnIvPjx1bD4iICsgc01pc3NpbmcgKyAiPC91bD4iLCA1MDAwKTsKCQkJX3RoaXMuYnVzeShmYWxzZSk7CgkJCXJldHVybjsKCQl9CgkJaWYgKGJ1dHRvbi5vbmNsaWNrKSBhd2FpdCBidXR0b24ub25jbGljayhvKTsKCQlpZiAoYnV0dG9uLm9uQ2xpY2spIGF3YWl0IGJ1dHRvbi5vbkNsaWNrKG8pOwoJCV90aGlzLmJ1c3koZmFsc2UpOwoJfQoKCWJ1c3koYkJ1c3kpIHsKCQlpZiAoIWJCdXN5KSB7CgkJCXZhciB0b3RhbCA9IDA7CgkJCWlmICh0eXBlb2YgbW9tZW50ICE9PSAndW5kZWZpbmVkJykgewoJCQkJdG90YWwgPSBtb21lbnQoKS5kaWZmKG1vbWVudCh0aGlzLmJ1c3lTdGFtcCksICdzZWNvbmRzJyk7CgkJCX0gZWxzZSB7CgkJCQkvLyBubyBtb21lbnQsIHVzZSBzdGFuZGFyZCBEYXRlCgkJCQl0b3RhbCA9IChuZXcgRGF0ZSgpLmdldFRpbWUoKSAtIHRoaXMuYnVzeVN0YW1wID8gdGhpcy5idXN5U3RhbXAuZ2V0VGltZSgpIDogMCkgLyAxMDAwIC8gMzYwMDsKCQkJfQoJCQlpZiAodGhpcy5iRGVidWcpIHsKCQkJCXdpbmRvdy5fRnJFTUQuX2FsZXJ0KCJFeGVjdXRpb24gVGltZTogIiArIHRvdGFsICsgIiBzZWNvbmRzLiIpOwoJCQl9CgkJCWRlbGV0ZSB0aGlzLmJ1c3lTdGFtcDsKCgkJCXNldEludGVydmFsKDEsICgpID0+IHRoaXMuU2V0KHsKCQkJCUxvYWRpbmc6IDEwCgkJCX0pKTsKCQl9IGVsc2UgewoJCQl0aGlzLmJ1c3lTdGFtcCA9IG5ldyBEYXRlKCk7CgkJfQoKCQkkLmVhY2goJC5tZXJnZSgkLm1hcCh0aGlzLmJ1dHRvbnMsIGIgPT4gYi5uYW1lKSwgJC5tYXAodGhpcy5lbGVtZW50cy5maWx0ZXIoZSA9PiBlLnR5cGUgPT0gJ2xpbmsnKSwgZSA9PiBlLm5hbWUpKSwgKF8sIGUpID0+ICQoJyMnICsgZSkubGlua2J1dHRvbihiQnVzeSA/ICdkaXNhYmxlJyA6ICdlbmFibGUnKSk7Cgl9CgoJcHJlZml4KGUpIHsKCQlzd2l0Y2ggKGUudHlwZSkgewoJCQljYXNlICdsYWJlbCc6CgkJCQlyZXR1cm4gJ2xibCc7CgkJCWNhc2UgJ3RleHQnOgoJCQljYXNlICdzdHJpbmcnOgoJCQljYXNlICdzZWFyY2gnOgoJCQljYXNlICdwYXNzd29yZCc6CgkJCQlyZXR1cm4gJ3R4dCc7CgkJCWNhc2UgIkRhdGVUaW1lIjoKCQkJY2FzZSAiZGF0ZXRpbWUiOgoJCQkJcmV0dXJuICdkdHAnOwoJCQljYXNlICJpbnQiOgoJCQljYXNlICJpbnRlZ2VyIjoKCQkJY2FzZSAibnVtYmVyIjoKCQkJY2FzZSAibG9uZyI6CgkJCWNhc2UgIkxvbmciOgoJCQkJcmV0dXJuICdudWQnOwoJCQljYXNlICdmaWxlJzoKCQkJCXJldHVybiAnZmlsJzsKCQkJY2FzZSAnaW1hZ2UnOgoJCQkJcmV0dXJuICdpbWcnOwoJCQljYXNlICJib29sIjoKCQkJCXJldHVybiAnY2hrJzsKCQkJY2FzZSAid2luZG93IjoKCQkJCXJldHVybiAncG5sJzsKCQkJY2FzZSAicHJvZ3Jlc3MiOgoJCQkJcmV0dXJuICdwcmcnOwoJCQljYXNlICJncmlkIjoKCQkJY2FzZSAidHJlZSI6CgkJCWNhc2UgInNlbGVjdCI6CgkJCQlyZXR1cm4gJ2NtYic7CgkJCWRlZmF1bHQ6CgkJCQlyZXR1cm4gJyc7CgkJfQoJfQoKCWNsZWFyKGdyb3VwKSB7CgkJdmFyIG8gPSB7fTsKCQkkLmVhY2godGhpcy5lbGVtZW50cy5maWx0ZXIoZSA9PiBncm91cCA/IGUuZ3JvdXAgPT0gZ3JvdXAgOiB0cnVlKSwgKF8sIGUpID0+IHsKCQkJdmFyIG5hbWUgPSAoZS5lbXNTb3VyY2UgPyAiXyIgOiAiIikgKyBlLm5hbWU7CgkJCXN3aXRjaCAoZS50eXBlKSB7CgkJCQljYXNlICd0ZXh0JzoKCQkJCWNhc2UgJ3N0cmluZyc6CgkJCQljYXNlICdzZWFyY2gnOgoJCQkJY2FzZSAncGFzc3dvcmQnOgoJCQkJY2FzZSAiRGF0ZVRpbWUiOgoJCQkJY2FzZSAiZGF0ZXRpbWUiOgoJCQkJCW9bbmFtZV0gPSAiIjsKCQkJCQlicmVhazsKCQkJCWNhc2UgImludCI6CgkJCQljYXNlICJudW1iZXIiOgoJCQkJY2FzZSAiaW50ZWdlciI6CgkJCQljYXNlICJsb25nIjoKCQkJCWNhc2UgIkxvbmciOgoJCQkJY2FzZSAicHJvZ3Jlc3MiOgoJCQkJCW9bbmFtZV0gPSAwOwoJCQkJCWJyZWFrOwoJCQkJY2FzZSAidHJlZSI6CgkJCQljYXNlICJzZWxlY3QiOgoJCQkJCW9bbmFtZV0gPSBudWxsOwoJCQkJCWJyZWFrOwoJCQkJY2FzZSAiZ3JpZCI6CgkJCQkJb1tuYW1lXSA/IG9bbmFtZV0uZGF0YSA9IFtdIDogbnVsbDsKCQkJCQlicmVhazsKCQkJCWNhc2UgImJvb2wiOgoJCQkJCW9bbmFtZV0gPSBmYWxzZTsKCQkJCQlicmVhazsKCQkJCWRlZmF1bHQ6CgkJCQkJYnJlYWs7CgkJCX0KCQl9KTsKCQkvL2NvbnNvbGUubG9nKCJjbGVhciIsIG8pOwoJCXRoaXMuc2V0KG8pOwoJCXRoaXMuYnVzeShmYWxzZSk7Cgl9CgoJc2V0KG8sIGVOYW1lKSB7CgkJaWYgKGVOYW1lKSB7CgkJCXZhciBvRWxlbWVudCA9IHRoaXMuYnlOYW1lKGVOYW1lKTsKCQkJaWYgKCFvRWxlbWVudCkgcmV0dXJuOwoJCQl2YXIgYXR0ID0gbnVsbDsKCQkJaWYgKG8gJiYgby5JZCAmJiBvLkVudGl0eUF0dHJpYnV0ZSkgewoJCQkJLy8gYW4gRW50aXR5VmFsdWUKCQkJCWZvciAodmFyIHAgaW4gbykKCQkJCQlpZiAocC5lbmRzV2l0aCgiVmFsdWUiKSkgYXR0ID0gcDsKCQkJCW9FbGVtZW50LmVtc1NvdXJjZSA9IG87CgkJCX0KCQkJdHJ5IHsKCQkJCXN3aXRjaCAob0VsZW1lbnQudHlwZSkgewoJCQkJCWNhc2UgJ2xhYmVsJzoKCQkJCQkJaWYgKGF0dCkgewoJCQkJCQkJJCgiIyIgKyB0aGlzLnByZWZpeChvRWxlbWVudCkgKyBvRWxlbWVudC5uYW1lKS5odG1sKG9bYXR0XSk7CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQkkKCIjIiArIHRoaXMucHJlZml4KG9FbGVtZW50KSArIG9FbGVtZW50Lm5hbWUpLmh0bWwoKG8gJiYgby5FbnRpdHlBdHRyaWJ1dGUpID8gIiIgOiBvKTsKCQkJCQkJfQoJCQkJCQlicmVhazsKCQkJCQljYXNlICd0ZXh0JzoKCQkJCQljYXNlICdzdHJpbmcnOgoJCQkJCWNhc2UgJ3Bhc3N3b3JkJzoKCQkJCQljYXNlICJpbnQiOgoJCQkJCWNhc2UgInNlYXJjaCI6CgkJCQkJY2FzZSAiaW50ZWdlciI6CgkJCQkJY2FzZSAibnVtYmVyIjoKCQkJCQljYXNlICJsb25nIjoKCQkJCQljYXNlICJMb25nIjoKCQkJCQkJaWYgKGF0dCkgewoJCQkJCQkJJCgiIyIgKyB0aGlzLnByZWZpeChvRWxlbWVudCkgKyBvRWxlbWVudC5uYW1lKVt0aGlzLnVpVHlwZXNbb0VsZW1lbnQudHlwZV1dKCJzZXRWYWx1ZSIsIG9bYXR0XSk7CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQkkKCIjIiArIHRoaXMucHJlZml4KG9FbGVtZW50KSArIG9FbGVtZW50Lm5hbWUpW3RoaXMudWlUeXBlc1tvRWxlbWVudC50eXBlXV0oInNldFZhbHVlIiwgKG8gJiYgby5FbnRpdHlBdHRyaWJ1dGUpID8gIiIgOiBvKTsKCQkJCQkJfQoJCQkJCQlicmVhazsKCQkJCQljYXNlICJEYXRlVGltZSI6CgkJCQkJY2FzZSAiZGF0ZXRpbWUiOgoJCQkJCQlpZiAoYXR0KSB7CgkJCQkJCQkkKCIjIiArIHRoaXMucHJlZml4KG9FbGVtZW50KSArIG9FbGVtZW50Lm5hbWUpW3RoaXMudWlUeXBlc1tvRWxlbWVudC50eXBlXV0oJ3NldFZhbHVlJywgKG9bYXR0XSA/IHRoaXMuc3IoKS50b0RhdGVUaW1lKG9bYXR0XSkgOiAiIikpOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJJCgiIyIgKyB0aGlzLnByZWZpeChvRWxlbWVudCkgKyBvRWxlbWVudC5uYW1lKVt0aGlzLnVpVHlwZXNbb0VsZW1lbnQudHlwZV1dKCdzZXRWYWx1ZScsIChvICYmIG8uRW50aXR5QXR0cmlidXRlKSA/ICIiIDogKG8gPyB0aGlzLnNyKCkudG9EYXRlVGltZShvKSA6ICIiKSk7CgkJCQkJCX0KCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAiYm9vbCI6CgkJCQkJCWlmIChhdHQpIHsKCQkJCQkJCSQoIiMiICsgdGhpcy5wcmVmaXgob0VsZW1lbnQpICsgb0VsZW1lbnQubmFtZSlbdGhpcy51aVR5cGVzW29FbGVtZW50LnR5cGVdXSgob1thdHRdID8gJycgOiAndW4nKSArICdjaGVjaycpOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJJCgiIyIgKyB0aGlzLnByZWZpeChvRWxlbWVudCkgKyBvRWxlbWVudC5uYW1lKVt0aGlzLnVpVHlwZXNbb0VsZW1lbnQudHlwZV1dKCgoKG8gJiYgby5FbnRpdHlBdHRyaWJ1dGUpID8gIiIgOiBvKSA/ICcnIDogJ3VuJykgKyAnY2hlY2snKTsKCQkJCQkJfQoJCQkJCQlicmVhazsKCQkJCQljYXNlICJ3aW5kb3ciOgoJCQkJCQlpZiAoYXR0KSB7CgkJCQkJCQlvRWxlbWVudC52YWx1ZSA9IG9bYXR0XTsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCW9FbGVtZW50LnZhbHVlID0gKG8gJiYgby5FbnRpdHlBdHRyaWJ1dGUpID8gIiIgOiBvOwoJCQkJCQl9CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgInByb2dyZXNzIjoKCQkJCQkJdmFyIHYgPSAwOwoJCQkJCQlpZiAoYXR0KSB7CgkJCQkJCQl2ID0gb1thdHRdOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJdiA9IChvICYmIG8uRW50aXR5QXR0cmlidXRlKSA/ICIiIDogbzsKCQkJCQkJfQoJCQkJCQkvL2NvbnNvbGUubG9nKCIjIiArIHRoaXMucHJlZml4KG9FbGVtZW50KSArIG9FbGVtZW50Lm5hbWUsIHRoaXMudWlUeXBlc1tvRWxlbWVudC50eXBlXSwgTWF0aC5yb3VuZCh2ICogMTApIC8gMTApOwoJCQkJCQkkKCIjIiArIHRoaXMucHJlZml4KG9FbGVtZW50KSArIG9FbGVtZW50Lm5hbWUpW3RoaXMudWlUeXBlc1tvRWxlbWVudC50eXBlXV0oJ3NldFZhbHVlJywgTWF0aC5yb3VuZCh2ICogMTApIC8gMTApOwoJCQkJCQlicmVhazsKCQkJCQljYXNlICJncmlkIjoKCQkJCQkJbGV0IGNvbHMgPSBKU09OLnBhcnNlKCJ7IiArIHRoaXMubWFwQ29sdW1ucyhvRWxlbWVudCwgdHJ1ZSkgKyAifSIpOwoJCQkJCQkkLmVhY2goY29scy5jb2x1bW5zWzBdLCAoXywgYykgPT4gYy5mb3JtYXR0ZXIgPSB0aGlzLnNyKCkucnVuU2NyaXB0KHRoaXMuZm9ybWF0dGVyKG9FbGVtZW50Lm5hbWUsIGMpKSk7CgkJCQkJCSQoIiMiICsgdGhpcy5wcmVmaXgob0VsZW1lbnQpICsgb0VsZW1lbnQubmFtZSkuZGF0YWdyaWQoY29scyk7CgkJCQkJCWlmIChhdHQpIHsKCQkJCQkJCSQoIiMiICsgdGhpcy5wcmVmaXgob0VsZW1lbnQpICsgb0VsZW1lbnQubmFtZSkuZGF0YWdyaWQoewoJCQkJCQkJCWRhdGE6IG9bYXR0XQoJCQkJCQkJfSk7CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQkkKCIjIiArIHRoaXMucHJlZml4KG9FbGVtZW50KSArIG9FbGVtZW50Lm5hbWUpLmRhdGFncmlkKHsKCQkJCQkJCQlkYXRhOiAobyAmJiBvLkVudGl0eUF0dHJpYnV0ZSkgPyAiIiA6IG8KCQkJCQkJCX0pOwoJCQkJCQl9CgkJCQkJCSQoIiMiICsgdGhpcy5wcmVmaXgob0VsZW1lbnQpICsgb0VsZW1lbnQubmFtZSkuZGF0YWdyaWQoInVuc2VsZWN0QWxsIik7CgkJCQkJCSQoIiMiICsgdGhpcy5wcmVmaXgob0VsZW1lbnQpICsgb0VsZW1lbnQubmFtZSkuZGF0YWdyaWQoKTsKCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAidHJlZSI6CgkJCQkJCXZhciB2ID0gYXR0ID8gb1thdHRdIDogKChvICYmIG8uRW50aXR5QXR0cmlidXRlKSA/ICIiIDogbyk7CgkJCQkJCWlmIChBcnJheS5pc0FycmF5KHYpKSB7CgkJCQkJCQkkKCIjIiArIHRoaXMucHJlZml4KG9FbGVtZW50KSArIG9FbGVtZW50Lm5hbWUpW3RoaXMudWlUeXBlc1tvRWxlbWVudC50eXBlXV0oInRyZWUiKS50cmVlKCJsb2FkRGF0YSIsIHYpOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJJCgiIyIgKyB0aGlzLnByZWZpeChvRWxlbWVudCkgKyBvRWxlbWVudC5uYW1lKVt0aGlzLnVpVHlwZXNbb0VsZW1lbnQudHlwZV1dKCdzZXRWYWx1ZScsIHYpOwoJCQkJCQl9CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgInNlbGVjdCI6CgkJCQkJCWlmIChhdHQpIHsKCQkJCQkJCWlmIChvRWxlbWVudC5vcHRpb25zKSB7CgkJCQkJCQkJJCgiIyIgKyB0aGlzLnByZWZpeChvRWxlbWVudCkgKyBvRWxlbWVudC5uYW1lKS5jb21ibygnc2V0VmFsdWUnICsgKG9FbGVtZW50Lm11bHRpcGxlID8gJ3MnIDogJycpLCAob1thdHRdID8gb1thdHRdIDogIiIpKTsKCQkJCQkJCQkkKCIjIiArIHRoaXMucHJlZml4KG9FbGVtZW50KSArIG9FbGVtZW50Lm5hbWUpLmNvbWJvKCdzZXRWYWx1ZScgKyAob0VsZW1lbnQubXVsdGlwbGUgPyAncycgOiAnJyksIChvW2F0dF0gPyBvW2F0dF0gOiAiIikpOwoJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQkkKCIjIiArIHRoaXMucHJlZml4KG9FbGVtZW50KSArIG9FbGVtZW50Lm5hbWUpLmNvbWJvZ3JpZCgnc2V0VmFsdWUnICsgKG9FbGVtZW50Lm11bHRpcGxlID8gJ3MnIDogJycpLCAob1thdHRdID8gb1thdHRdIDogIiIpKTsKCQkJCQkJCX0KCQkJCQkJfSBlbHNlIHsKCQkJCQkJCXYgPSBudWxsOwoJCQkJCQkJaWYgKG8gPT09IG51bGwpIHsKCgkJCQkJCQl9IGVsc2UgaWYgKG8uY29uc3RydWN0b3IgPT09IEFycmF5KSB7CgoJCQkJCQkJfSBlbHNlIGlmICghby5FbnRpdHlBdHRyaWJ1dGUpIHsKCQkJCQkJCQl2ID0gbyB8fCB7CgkJCQkJCQkJCUlkOiBvLklkLAoJCQkJCQkJCQlfVG9TdHJpbmc6IG8uX1RvU3RyaW5nLAoJCQkJCQkJCQl0b1N0cmluZzogZnVuY3Rpb24oKSB7CgkJCQkJCQkJCQlyZXR1cm4gdGhpcy5fVG9TdHJpbmc7CgkJCQkJCQkJCX0KCQkJCQkJCQl9OwoJCQkJCQkJfQoJCQkJCQkJaWYgKG9FbGVtZW50Lm9wdGlvbnMpIHsKCQkJCQkJCQkkKCIjIiArIHRoaXMucHJlZml4KG9FbGVtZW50KSArIG9FbGVtZW50Lm5hbWUpLmNvbWJvKCdzZXRWYWx1ZScgKyAob0VsZW1lbnQubXVsdGlwbGUgPyAncycgOiAnJyksIHYpOwoJCQkJCQkJCSQoIiMiICsgdGhpcy5wcmVmaXgob0VsZW1lbnQpICsgb0VsZW1lbnQubmFtZSkuY29tYm8oJ3NldFRleHQnICsgKG9FbGVtZW50Lm11bHRpcGxlID8gJ3MnIDogJycpLCB2KTsKCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJJCgiIyIgKyB0aGlzLnByZWZpeChvRWxlbWVudCkgKyBvRWxlbWVudC5uYW1lKS5jb21ib2dyaWQoJ3NldFZhbHVlJyArIChvRWxlbWVudC5tdWx0aXBsZSA/ICdzJyA6ICcnKSwgdik7CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQkJYnJlYWs7CgkJCQkJZGVmYXVsdDoKCQkJCQkJYnJlYWs7CgkJCQl9CgkJCX0gY2F0Y2ggKGV4KSB7CgkJCQljb25zb2xlLmxvZyhleCk7CgkJCX0KCQl9IGVsc2UgewoJCQlmb3IgKHZhciBwIGluIG8pIHsKCQkJCWlmIChwLmluZGV4T2YoJ18nKSA9PT0gMCkgcCA9IHAuc3Vic3RyaW5nKDEpOwoJCQkJdmFyIGUgPSB0aGlzLmJ5TmFtZShwKTsKCQkJCWlmICghZSB8fCAhZS5uYW1lKSBjb250aW51ZTsKCQkJCXZhciB2YWx1ZSA9IG9bcF07CgkJCQlpZiAoZS5uYW1lID09IHRoaXMuc1RhYmxlKSB7CgkJCQkJdmFsdWUgPSBvOwoJCQkJCXZhbHVlLkRhdGUgPSBuZXcgRGF0ZSgpOwoJCQkJfQoJCQkJaWYgKHAgPT0gIkVudGl0eVZhbHVlcyIpIHsKCQkJCQkvLyBhbiBlbXNGb3JtVmFsdWVzIHNvdXJjZQoJCQkJCS8vIGZpbmQgdGhlIEVudGl0eVZhbHVlIGZvciB0aGlzIGVsZW1lbnQgYW5kIHNldCBpdAoJCQkJCWZvciAodmFyIGogPSAwOyBqIDwgby5FbnRpdHlWYWx1ZXMubGVuZ3RoOyBqKyspIHsKCQkJCQkJaWYgKG8uRW50aXR5VmFsdWVzW2pdLkVudGl0eUF0dHJpYnV0ZS5OYW1lID09IGUubmFtZSkgewoJCQkJCQkJLy8gZm91bmQgdGhlIEVudGl0eVZhbHVlIGZvciB0aGlzIGVsZW1lbnQKCQkJCQkJCV92ID0gby5FbnRpdHlWYWx1ZXNbal07CgkJCQkJCQlmb3IgKHZhciBxIGluIF92KSB7CgkJCQkJCQkJaWYgKHEuZW5kc1dpdGgoIlZhbHVlIikpIHsKCQkJCQkJCQkJX3ZbcV0gPSB2YWx1ZTsKCQkJCQkJCQl9CgkJCQkJCQl9CgkJCQkJCQlicmVhazsKCQkJCQkJfQoJCQkJCX0KCQkJCX0KCQkJCXRoaXMuc2V0KHZhbHVlLCBlLm5hbWUpOwoJCQl9CgkJfQoJfQoKCWdldCgpIHsKCQl2YXIgbyA9IHt9OwoJCWlmICh0aGlzLnNUYWJsZSAmJiB3aW5kb3dbdGhpcy5zVGFibGVdKSBvID0gbmV3IHdpbmRvd1t0aGlzLnNUYWJsZV0oKTsKCQlmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuZWxlbWVudHMubGVuZ3RoOyBpKyspIHsKCQkJdmFyIGNuID0gbnVsbDsKCQkJdmFyIHYgPSBudWxsOwoJCQl0cnkgewoJCQkJbGV0IGVOYW1lID0gIiMiICsgdGhpcy5wcmVmaXgodGhpcy5lbGVtZW50c1tpXSkgKyB0aGlzLmVsZW1lbnRzW2ldLm5hbWU7CgkJCQlzd2l0Y2ggKHRoaXMuZWxlbWVudHNbaV0udHlwZSkgewoJCQkJCWNhc2UgJ2xhYmVsJzoKCQkJCQkJY24gPSAkKGVOYW1lKTsKCQkJCQkJdiA9IGNuLmh0bWwoKTsKCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAndGV4dCc6CgkJCQkJY2FzZSAnc3RyaW5nJzoKCQkJCQljYXNlICdzZWFyY2gnOgoJCQkJCWNhc2UgJ3Bhc3N3b3JkJzoKCQkJCQkJY24gPSAkKGVOYW1lKTsKCQkJCQkJdiA9IGNuLnZhbCgpOwoJCQkJCQlicmVhazsKCQkJCQljYXNlICJmaWxlIjoKCQkJCQljYXNlICJpbWFnZSI6CgkJCQkJCWNuID0gJChlTmFtZSk7CgkJCQkJCXYgPSB0aGlzLmVsZW1lbnRzW2ldLmRhdGE7CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgIkRhdGVUaW1lIjoKCQkJCQljYXNlICJkYXRldGltZSI6CgkJCQkJCXYgPSBuZXcgRGF0ZSgkKGVOYW1lKS5kYXRldGltZWJveCgnZ2V0VmFsdWUnKSk7CgkJCQkJCWNuID0gJChlTmFtZSk7CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgInByb2dyZXNzIjoKCQkJCQkJY24gPSAkKGVOYW1lKTsKCQkJCQkJdiA9IGNuLnByb2dyZXNzYmFyKCdnZXRWYWx1ZScpOwoJCQkJCQlicmVhazsKCQkJCQljYXNlICJpbnQiOgoJCQkJCWNhc2UgImludGVnZXIiOgoJCQkJCWNhc2UgIm51bWJlciI6CgkJCQkJY2FzZSAibG9uZyI6CgkJCQkJY2FzZSAiTG9uZyI6CgkJCQkJCWNuID0gJChlTmFtZSk7CgkJCQkJCXYgPSBwYXJzZUZsb2F0KGNuLnZhbCgpKTsKCQkJCQkJaWYgKGlzTmFOKHYpKSB2ID0gMDsKCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAiZ3JpZCI6CgkJCQkJCWNuID0gJChlTmFtZSk7CgkJCQkJCXYgPSBjbi5kYXRhZ3JpZCgnZ2V0RGF0YScpOwoJCQkJCQl2LnNlbGVjdGVkID0gY24uZGF0YWdyaWQoImdldFNlbGVjdGVkIik7CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgInRyZWUiOgoJCQkJCQljbiA9ICQoZU5hbWUpOwoJCQkJCQl2ID0gY24uY29tYm90cmVlKCJ0cmVlIikudHJlZSgiZ2V0U2VsZWN0ZWQiKTsKCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAid2luZG93IjoKCQkJCQkJdiA9IHRoaXMuZWxlbWVudHNbaV0udmFsdWU7CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgInNlbGVjdCI6CgkJCQkJCWlmICh0aGlzLmVsZW1lbnRzW2ldLm9wdGlvbnMpIHsKCQkJCQkJCXYgPSAkKGVOYW1lKS5jb21ib2dyaWQoJ2dldFZhbHVlJyArICh0aGlzLmVsZW1lbnRzW2ldLm11bHRpcGxlID8gJ3MnIDogJycpKTsKCQkJCQkJCXYgPSB0aGlzLnNyKCkucnVuU2NyaXB0KHYpOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJdiA9ICQoZU5hbWUpLmNvbWJvZ3JpZCgnZ3JpZCcpLmRhdGFncmlkKCdnZXRTZWxlY3Rpb25zJyk7CgkJCQkJCQlpZiAoIXYgfHwgIXYubGVuZ3RoKSB7CgkJCQkJCQkJdiA9ICQoZU5hbWUpLmNvbWJvZ3JpZCgnZ2V0VmFsdWUnICsgKHRoaXMuZWxlbWVudHNbaV0ubXVsdGlwbGUgPyAncycgOiAnJykpOwoJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQlpZiAoIXRoaXMuZWxlbWVudHNbaV0ubXVsdGlwbGUpIHYgPSB2WzBdOwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJCWNuID0gJChlTmFtZSk7CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgImJvb2wiOgoJCQkJCQljbiA9ICQoZU5hbWUpOwoJCQkJCQl2ID0gY24uc3dpdGNoYnV0dG9uKCdvcHRpb25zJykuY2hlY2tlZDsKCQkJCQkJYnJlYWs7CgkJCQkJZGVmYXVsdDoKCQkJCQkJYnJlYWs7CgkJCQl9CgkJCQlvW3RoaXMuZWxlbWVudHNbaV0ubmFtZV0odik7CgkJCX0gY2F0Y2ggKGUpIHsKCQkJCS8vY29uc29sZS5sb2codGhpcy5lbGVtZW50c1tpXS5uYW1lLCBlKTsKCQkJCW9bdGhpcy5lbGVtZW50c1tpXS5uYW1lXSA9IHY7CgkJCX0KCQkJaWYgKGNuKSB7CgkJCQlpZiAoby5FbnRpdHlWYWx1ZXMpIHsKCQkJCQlmb3IgKHZhciBqID0gMDsgaiA8IG8uRW50aXR5VmFsdWVzLmxlbmd0aDsgaisrKSB7CgkJCQkJCWlmICh0aGlzLmVsZW1lbnRzW2ldLm5hbWUgPT0gdGhpcy5zVGFibGUgJiYgdGhpcy5lbGVtZW50c1tpXS5lbXNTb3VyY2UpIG8uSWQgPSB0aGlzLmVsZW1lbnRzW2ldLmVtc1NvdXJjZS5JZDsKCQkJCQkJaWYgKG8uRW50aXR5VmFsdWVzW2pdLkVudGl0eUF0dHJpYnV0ZS5OYW1lID09IHRoaXMuZWxlbWVudHNbaV0ubmFtZSAmJiB0aGlzLmVsZW1lbnRzW2ldLmVtc1NvdXJjZSkgewoJCQkJCQkJby5FbnRpdHlWYWx1ZXNbal0uSWQgPSB0aGlzLmVsZW1lbnRzW2ldLmVtc1NvdXJjZS5JZDsKCQkJCQkJfQoJCQkJCX0KCQkJCX0KCQkJfQoJCX0KCQlyZXR1cm4gbzsKCX0KCgljSGVpZ2h0KG9wdGlvbnMpIHsKCQlpZiAob3B0aW9ucyAmJiBvcHRpb25zLmVkaXRvcikgcmV0dXJuIHdpbmRvdy5pbm5lckhlaWdodDsKCQlpZiAob3B0aW9ucyAmJiBvcHRpb25zLmhlaWdodCAmJiB0eXBlb2Yob3B0aW9ucy5oZWlnaHQpID09PSAnc3RyaW5nJykgcmV0dXJuIHRoaXMuaGVpZ2h0OwoJCWlmIChvcHRpb25zICYmIG9wdGlvbnMudHlwZSA9PSAnd2luZG93JyAmJiAhb3B0aW9ucy5oZWlnaHQpIHJldHVybiB0aGlzLmhlaWdodCAqIDAuOTsKCQlyZXR1cm4gTWF0aC5mbG9vcigoKG9wdGlvbnMgPyBvcHRpb25zLmhlaWdodCA6IG51bGwpIHx8ICh0aGlzLmhlaWdodCAvIDMpKSk7Cgl9CgoJc2VhcmNoKG9wdGlvbnMpIHsKCQlyZXR1cm4gdGhpcy5zdHJpbmcob3B0aW9ucyk7Cgl9CgoJc3RyaW5nKG9wdGlvbnMpIHsKCQlvcHRpb25zLmhlaWdodCA9IDIwOwoJCW9wdGlvbnMuc2ltcGxlID0gdHJ1ZTsKCQlyZXR1cm4gdGhpcy50ZXh0KG9wdGlvbnMpOwoJfQoKCWRhdGV0aW1lKG9wdGlvbnMpIHsKCQlyZXR1cm4gYDxpbnB1dCBpZD0iZHRwJHtvcHRpb25zLm5hbWV9IiBjbGFzcz0iZWFzeXVpLSR7dGhpcy51aVR5cGVzW29wdGlvbnMudHlwZV19IiByZXF1aXJlZD0iJHtvcHRpb25zLnJlcXVpcmVkID8gJ3RydWUnIDogJ2ZhbHNlJ30iIHZhbHVlPSIke3RoaXMudmFsdWUob3B0aW9ucyl9IiBzdHlsZT0id2lkdGg6JHt0aGlzLmNXaWR0aChvcHRpb25zKX1weCI+YDsKCX0KCglxdWVyeShvcHRpb25zKSB7CgkJcmV0dXJuICI8ZGl2IGlkPSd2cyIgKyBvcHRpb25zLm5hbWUgKyAiJz48L2Rpdj4iOwoJfQoKCURhdGVUaW1lKG9wdGlvbnMpIHsKCQlyZXR1cm4gdGhpcy5kYXRldGltZShvcHRpb25zKTsKCX0KCglsb25nKG9wdGlvbnMpIHsKCQlyZXR1cm4gdGhpcy5pbnQob3B0aW9ucyk7Cgl9CgoJTG9uZyhvcHRpb25zKSB7CgkJcmV0dXJuIHRoaXMubG9uZyhvcHRpb25zKTsKCX0KCgl2YWx1ZShvcHRpb25zKSB7CgkJaWYgKHR5cGVvZiBvcHRpb25zLnZhbHVlID09PSAnZnVuY3Rpb24nKSB7CgkJCXRyeSB7CgkJCQlyZXR1cm4gb3B0aW9ucy52YWx1ZSh0aGlzLmdldCgpKTsKCQkJfSBjYXRjaCAoZXgpIHsKCQkJCWNvbnNvbGUubG9nKGBERm9ybS52YWx1ZSgke29wdGlvbnMubmFtZX0pOiAke2V4fWApOwoJCQkJcmV0dXJuICcnOwoJCQl9CgkJfSBlbHNlIHsKCQkJc3dpdGNoIChvcHRpb25zLnR5cGUpIHsKCQkJCWNhc2UgJ2ludCc6CgkJCQljYXNlICdwcm9ncmVzcyc6CgkJCQkJcmV0dXJuIG9wdGlvbnMudmFsdWUgfHwgb3B0aW9ucy5taW4gfHwgMDsKCQkJCWNhc2UgJ3N0cmluZyc6CgkJCQljYXNlICd0ZXh0JzoKCQkJCWNhc2UgJ2RhdGV0aW1lJzoKCQkJCWNhc2UgJ2xhYmVsJzoKCQkJCQlyZXR1cm4gb3B0aW9ucy52YWx1ZSB8fCAiIjsKCQkJCWRlZmF1bHQ6CgkJCQkJcmV0dXJuIG9wdGlvbnMudmFsdWU7CgkJCX0KCQl9Cgl9CgoJaW50KG9wdGlvbnMpIHsKCQlsZXQgcmV0ID0gYDxpbnB1dCBpZD0ibnVkJHtvcHRpb25zLm5hbWV9IiBjbGFzcz0iZWFzeXVpLSR7dGhpcy51aVR5cGVzW29wdGlvbnMudHlwZV19IiByZXF1aXJlZD0iJHtvcHRpb25zLnJlcXVpcmVkID8gJ3RydWUnIDogJ2ZhbHNlJ30iIHZhbHVlPSIke3RoaXMudmFsdWUob3B0aW9ucyl9IiBkYXRhLW9wdGlvbnM9Im1pbjoke29wdGlvbnMubWluIHx8IDB9LG1heDoke29wdGlvbnMubWF4IHx8IDEwMH0saW5jcmVtZW50OiR7b3B0aW9ucy5pbmNyZW1lbnQgfHwgMX0iIHN0eWxlPSJ3aWR0aDoke3RoaXMuY1dpZHRoKG9wdGlvbnMpfXB4OyI+PC9pbnB1dD5gOwoJCS8vY29uc29sZS5sb2cocmV0KTsKCQlyZXR1cm4gcmV0OwoJfQoKCW1lbnUob3B0aW9ucykgewoJCXZhciByZXQgPSAiIjsKCQlyZXQgKz0gJzxkaXYgY2xhc3M9ImVhc3l1aS1wYW5lbCIgaWQ9Im1udScgKyBvcHRpb25zLm5hbWUgKyAnIiBzdHlsZT0icGFkZGluZzo1cHg7Ij5cbic7CgkJJC5lYWNoKG9wdGlvbnMubWVudSwgKF8sIG0pID0+IHJldCArPSBgPGEgaHJlZj0iIyIgY2xhc3M9ImVhc3l1aS0ke3RoaXMudWlUeXBlc1tvcHRpb25zLnR5cGUgfHwgJ21lbnUnXX0iIGRhdGEtb3B0aW9ucz0ibWVudTonI21tJHttLmxhYmVsLnJlcGxhY2UoLyAvZywgJycpfScsaWNvbkNsczonaWNvbi0ke20uaWNvbiB8fCAnbm9uZSd9JyI+JHttLmxhYmVsfTwvYT5cbmApOwoJCXJldCArPSAiPC9kaXY+XG4iOwoJCWxldCBkdiA9IG0gPT4gewoJCQlsZXQgcmV0ID0gJzxkaXYnICsgKG0uc3ViTWVudXMgPyAnJyA6IGAgZGF0YS1vcHRpb25zPSJpY29uQ2xzOidpY29uLSR7bS5pY29uIHx8ICdub25lJ30nImApICsgJz5cbic7CgkJCXJldCArPSBtLnN1Yk1lbnVzID8gJzxzcGFuPicgKyAobS5sYWJlbCB8fCB0aGlzLmVuZ2xpc2gobS5jb2RlKSkgKyAnPC9zcGFuPlxuPGRpdj4nIDogKGA8c3BhbiB3aWR0aD0nMTAwJScgb25jbGljaz0nKGFzeW5jICgpID0+IHtsZXQgbSA9ICR7X0ZyRU1ELl90b0pTKG0pfTsgaWYobS5hY3Rpb24pe3JldHVybiBhd2FpdCBtLmFjdGlvbihERm9ybS5nZXQoKSwgbSk7fSBpZiAobS5zdWJNZW51cykgcmV0dXJuOyBhd2FpdCBfRnJFTUQuUmVuZGVyUGFnZSh7X2NvZGU6IG0uY29kZSB8fCBtLmxhYmVsLnJlcGxhY2UoLyAvZywgIiIpLnRvTG93ZXJDYXNlKCl9LCBtLmRhdGEpO30pKCknPiR7bS5sYWJlbCB8fCB0aGlzLmVuZ2xpc2gobS5jb2RlKX08L3NwYW4+YCk7CgkJCSQuZWFjaChtLnN1Yk1lbnVzLCAoXywgcykgPT4gcmV0ICs9IGR2KHMpKTsKCQkJcmV0ICs9IChtLnN1Yk1lbnVzID8gIjwvZGl2PlxuIiA6ICIiKSArIGA8L2Rpdj5cbmA7CgkJCXJldHVybiByZXQ7CgkJfTsKCQlmb3IgKHZhciBpID0gMDsgaSA8IG9wdGlvbnMubWVudS5sZW5ndGg7IGkrKykgewoJCQl2YXIgbSA9IG9wdGlvbnMubWVudVtpXTsKCQkJcmV0ICs9ICc8ZGl2IGlkPSJtbScgKyBtLmxhYmVsLnJlcGxhY2UoLyAvZywgJycpICsgJyIgc3R5bGU9IndpZHRoOjE1MHB4OyI+JzsKCQkJZm9yICh2YXIgaiA9IDA7IGogPCBtLnN1Yk1lbnVzLmxlbmd0aDsgaisrKSB7CgkJCQl2YXIgc20gPSBtLnN1Yk1lbnVzW2pdOwoJCQkJcmV0ICs9IGR2KHNtKTsKCQkJfQoJCQlyZXQgKz0gJzwvZGl2PlxuJzsKCQl9CgkJcmV0dXJuIHJldDsKCX0KCglpbnRlZ2VyKG9wdGlvbnMpIHsKCQlyZXR1cm4gdGhpcy5pbnQob3B0aW9ucyk7Cgl9CgoJbnVtYmVyKG9wdGlvbnMpIHsKCQlyZXR1cm4gdGhpcy5pbnQob3B0aW9ucyk7Cgl9CgoJSW50ZWdlcihvcHRpb25zKSB7CgkJcmV0dXJuIHRoaXMuaW50KG9wdGlvbnMpOwoJfQoKCWJvb2wob3B0aW9ucykgewoJCXJldHVybiBgPGlucHV0IGlkPSIke3RoaXMucHJlZml4KG9wdGlvbnMpfSR7b3B0aW9ucy5uYW1lfSIgZGF0YS1kZm9ybT0iZWxlbWVudDoke29wdGlvbnMubmFtZX0iIHJlcXVpcmVkPSIke29wdGlvbnMucmVxdWlyZWQ/J3RydWUnOidmYWxzZSd9IiBkYXRhLW9wdGlvbnM9J2Rpc2FibGVkOiR7b3B0aW9ucy5kaXNhYmxlZD8ndHJ1ZSc6J2ZhbHNlJ30sJHt0aGlzLmV2ZW50SGFuZGxlcnMob3B0aW9ucyl9JyBjbGFzcz0iZWFzeXVpLSR7dGhpcy51aVR5cGVzW29wdGlvbnMudHlwZV19IiAke29wdGlvbnMuY2hlY2tlZD8nY2hlY2tlZCc6Jyd9IC8+YDsKCX0KCglsYWJlbChvcHRpb25zKSB7CgkJcmV0dXJuIGA8c3BhbiBpZD0iJHt0aGlzLnByZWZpeChvcHRpb25zKX0ke29wdGlvbnMubmFtZX0iIHN0eWxlPSJ3aWR0aDoke3RoaXMuY1dpZHRoKG9wdGlvbnMpfXB4IiBkYXRhLW9wdGlvbnM9ImRpc2FibGVkOiR7b3B0aW9ucy5kaXNhYmxlZD8ndHJ1ZSc6J2ZhbHNlJ30iPiR7dGhpcy52YWx1ZShvcHRpb25zKX08L3NwYW4+YDsKCX0KCgl1cmwob3B0aW9ucykgewoJCXJldHVybiB0aGlzLnN0cmluZyhvcHRpb25zKS5yZXBsYWNlKCJGaWVsZENoYW5nZSIsICJVUkxDaGFuZ2UiKTsKCX0KCgl0ZXh0KG9wdGlvbnMpIHsKCQlyZXR1cm4gYDxpbnB1dCBpZD0iJHt0aGlzLnByZWZpeChvcHRpb25zKX0ke29wdGlvbnMubmFtZX0iIGNsYXNzPSJlYXN5dWktJHtvcHRpb25zLmVkaXRvciB8fCB0aGlzLnVpVHlwZXNbb3B0aW9ucy50eXBlXX0iIGRhdGEtb3B0aW9ucz0nZGlzYWJsZWQ6JHtvcHRpb25zLmRpc2FibGVkPyd0cnVlJzonZmFsc2UnfSwke3RoaXMuZXZlbnRIYW5kbGVycyhvcHRpb25zKX0nIG11bHRpbGluZT0iJHtvcHRpb25zLnNpbXBsZSA/ICdmYWxzZScgOiAndHJ1ZSd9IiBzdHlsZT0id2hpdGUtc3BhY2U6cHJlLXdyYXA7d2lkdGg6JHt0aGlzLmNXaWR0aChvcHRpb25zKX1weDtoZWlnaHQ6JHt0aGlzLmNIZWlnaHQob3B0aW9ucyl9cHgiIHJlcXVpcmVkPSIke29wdGlvbnMucmVxdWlyZWQgPyAndHJ1ZScgOiAnZmFsc2UnfSIgdmFsdWU9IiR7dGhpcy52YWx1ZShvcHRpb25zKX0iIC8+YDsKCX0KCglwYXNzd29yZChvcHRpb25zKSB7CgkJdmFyIHJldCA9IHRoaXMuc3RyaW5nKG9wdGlvbnMpOwoJCXJldCA9IHJldC5yZXBsYWNlKCc8aW5wdXQgJywgJzxpbnB1dCB0eXBlPSJwYXNzd29yZCIgJyk7CgkJcmV0dXJuIHJldDsKCX0KCglmaWxlKG9wdGlvbnMpIHsKCQlyZXR1cm4gYDxpbnB1dCBpZD0iJHt0aGlzLnByZWZpeChvcHRpb25zKX0ke29wdGlvbnMubmFtZX0iIGNsYXNzPSJlYXN5dWktJHt0aGlzLnVpVHlwZXNbb3B0aW9ucy50eXBlXX0iIGRhdGEtb3B0aW9ucz0ib25DaGFuZ2U6ZnVuY3Rpb24obixvKXt2YXIgcyA9ICQoJyMnICsgdGhpcy5pZCkuZmlsZWJveCgnb3B0aW9ucycpOyB0aGlzLlVwbG9hZEZpbGUocywgdGhpcy5ieU5hbWUoJyR7b3B0aW9ucy5uYW1lfScpKTt9IiBzdHlsZT0id2lkdGg6JHt0aGlzLmNXaWR0aChvcHRpb25zKX1weCI+YDsKCX0KCglpbWFnZShvcHRpb25zKSB7CgkJcmV0dXJuIHRoaXMuZmlsZShvcHRpb25zKSArIGA8ZGl2IGlkPSJkbGcke29wdGlvbnMubmFtZX0iIGNsYXNzPSJlYXN5dWktJHt0aGlzLnVpVHlwZXNbb3B0aW9ucy50eXBlXX0iIHRpdGxlPSJJbWFnZSBQcmV2aWV3IiBkYXRhLW9wdGlvbnM9ImNsb3NlZDp0cnVlLGljb25DbHM6J2ljb24tc2F2ZScscmVzaXphYmxlOmZhbHNlLG1vZGFsOnRydWUiIHN0eWxlPSJ3aWR0aDo0MDBweDtoZWlnaHQ6MjAwcHg7cGFkZGluZzoxMHB4Ij48aW1nIGlkPSIke3RoaXMucHJlZml4KG9wdGlvbnMpfSR7b3B0aW9ucy5uYW1lfSIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIvPjwvZGl2PmA7Cgl9CgoJcHJvZ3Jlc3Mob3B0aW9ucykgewoJCWlmICghb3B0aW9ucy5oZWlnaHQpIG9wdGlvbnMuaGVpZ2h0ID0gMjA7IC8vIGZpeCBiaWcgcHJvZ3Jlc3MKCQlyZXR1cm4gYDxkaXYgaWQ9IiR7dGhpcy5wcmVmaXgob3B0aW9ucyl9JHtvcHRpb25zLm5hbWV9IiBjbGFzcz0iZWFzeXVpLSR7dGhpcy51aVR5cGVzW29wdGlvbnMudHlwZV19IiBkYXRhLW9wdGlvbnM9InZhbHVlOiR7dGhpcy52YWx1ZShvcHRpb25zKX0iIHN0eWxlPSJ3aWR0aDoke3RoaXMuY1dpZHRoKG9wdGlvbnMpfXB4O2hlaWdodDoke3RoaXMuY0hlaWdodChvcHRpb25zKX1weCI+PC9kaXY+YDsKCX0KCglmbG93Y2hhcnQob3B0aW9ucykgewoJCXJldHVybiBgPGRpdiBpZD0iZmx3JHtvcHRpb25zLm5hbWV9IiB3aWR0aD0iJHt0aGlzLmNXaWR0aChvcHRpb25zKX0iIGhlaWdodD0iJHt0aGlzLmNIZWlnaHQob3B0aW9ucyl9Ij48L2Rpdj5gOwoJfQoKCWNoYXJ0KG9wdGlvbnMpIHsKCQlyZXR1cm4gYDxkaXYgaWQ9ImNodCR7b3B0aW9ucy5uYW1lfSIgd2lkdGg9IiR7dGhpcy5jV2lkdGgob3B0aW9ucyl9IiBoZWlnaHQ9IiR7dGhpcy5jSGVpZ2h0KG9wdGlvbnMpfSI+PC9kaXY+YDsKCX0KCglmb3JtYXR0ZXIobmFtZSwgYywganNvbikgewoJCWpzb24gPSBqc29uID8gJyInIDogJyc7CgkJcmV0dXJuIGAke2pzb259KHZhbHVlLCByb3csIGluZGV4KSA9PiB7dHJ5e3ZhciBjID0gKERGb3JtLmJ5TmFtZShcYCR7bmFtZX1cYCkuY29sdW1ucyB8fCBbXSkuZmluZChjID0+IGMuZmllbGQ9PVxgJHtjLmZpZWxkfVxgKTsgcmV0dXJuIGMmJmMuZm9ybWF0P2MuZm9ybWF0KHZhbHVlLHJvdyxpbmRleCk6dmFsdWU7fWNhdGNoKGV4KXtyZXR1cm4gdmFsdWU7fSB9JHtqc29ufWA7Cgl9CgoJbWFwQ29sdW1ucyhvcHRpb25zLCBqc29uKSB7CgkJbGV0IGNUaXRsZSA9IGMgPT4gYy50aXRsZSB8fCB0aGlzLmVuZ2xpc2goYy5maWVsZCk7CgoJCXZhciBjb2xzID0gJC5ncmVwKG9wdGlvbnMuY29sdW1ucyB8fCBbXSwgYyA9PiAhYy5pZ25vcmUpOwoJCWxldCByZXQgPSAiIjsKCQlpZiAob3B0aW9ucy5tdWx0aXBsZSkgcmV0ICs9IGB7ImZpZWxkIjonY2snLCJjaGVja2JveCI6dHJ1ZX0sYDsKCQlyZXQgPSBgImZyb3plbkNvbHVtbnMiOiBbW2A7CgkJaWYgKCFvcHRpb25zLmZyb3plbikgewoJCQlyZXQgKz0gYHsiZmllbGQiOiIke29wdGlvbnMuaWRGaWVsZC5maWVsZH0iLCJ0aXRsZSI6ICIke29wdGlvbnMuaWRGaWVsZC50aXRsZX0iLCJzb3J0YWJsZSI6ICJ0cnVlIiwgImZvcm1hdHRlciI6ICR7dGhpcy5mb3JtYXR0ZXIob3B0aW9ucy5uYW1lLCBvcHRpb25zLmlkRmllbGQsIGpzb24pfX0sYDsKCQkJaWYgKG9wdGlvbnMudGV4dEZpZWxkLmZpZWxkICE9IG9wdGlvbnMuaWRGaWVsZC5maWVsZCkgcmV0ICs9IGB7ImZpZWxkIjoiJHtvcHRpb25zLnRleHRGaWVsZC5maWVsZCB8fCBvcHRpb25zLnRleHRGaWVsZC50aXRsZX0iLCJ0aXRsZSI6IiR7b3B0aW9ucy50ZXh0RmllbGQudGl0bGUgfHwgb3B0aW9ucy50ZXh0RmllbGQuZmllbGR9Iiwid2lkdGgiOiIke29wdGlvbnMudGV4dEZpZWxkLndpZHRofHwxMjB9IiwgInNvcnRhYmxlIjogInRydWUiLCAiZm9ybWF0dGVyIjogJHt0aGlzLmZvcm1hdHRlcihvcHRpb25zLm5hbWUsIG9wdGlvbnMudGV4dEZpZWxkLCBqc29uKX19YDsKCQl9IGVsc2UgewoJCQkkLm1hcCgkLmdyZXAoY29scywgYyA9PiBjLmZyb3plbiksIGMgPT4gYHsiZmllbGQiOiIke2MuZmllbGQgfHwgY1RpdGxlKGMpfSIsInRpdGxlIjoiJHtjVGl0bGUoYykgfHwgYy5maWVsZH0iLCJ3aWR0aCI6IiR7Yy53aWR0aHx8MTIwfSIsImFsaWduIjonbGVmdCcsInNvcnRhYmxlIjoidHJ1ZSIsICJmb3JtYXR0ZXIiOiAke3RoaXMuZm9ybWF0dGVyKG9wdGlvbnMubmFtZSwgYywganNvbil9fWApLmpvaW4oIiwiKTsKCQl9CgkJcmV0ICs9IGBdXSwgImNvbHVtbnMiOiBbW2A7CgkJcmV0ICs9ICQubWFwKCQuZ3JlcChjb2xzLCBjID0+ICFjLmZyb3plbiksIGMgPT4gYHsiZmllbGQiOiIke2MuZmllbGQgfHwgY1RpdGxlKGMpfSIsInRpdGxlIjoiJHtjVGl0bGUoYykgfHwgYy5maWVsZH0iLCJhbGlnbiI6ImxlZnQiLCJzb3J0YWJsZSI6InRydWUiLCAiZm9ybWF0dGVyIjogJHt0aGlzLmZvcm1hdHRlcihvcHRpb25zLm5hbWUsIGMsIGpzb24pfX1gKS5qb2luKCIsIik7CgkJcmV0ICs9ICddXSc7CgkJcmV0dXJuIHJldDsKCX0KCglzZWxlY3Qob3B0aW9ucywgdGFnID0gb3B0aW9ucy50YWcsIHR5cGUpIHsKCQlyZXR1cm4gdGhpcy5jb21ibyhvcHRpb25zLCB0YWcsIHR5cGUpOwoJfQoKCXRyZWUob3B0aW9ucykgewoJCXJldHVybiB0aGlzLnNlbGVjdChvcHRpb25zLCAic2VsZWN0Iik7Cgl9CgoJbmF2aWdhdGlvbihvcHRpb25zKSB7CgkJcmV0dXJuIHRoaXMuY29tYm8ob3B0aW9ucywgJ3VsJywgJ3RyZWUnKTsKCX0KCgljb21ibyhvcHRpb25zLCB0YWcsIHR5cGUpIHsKCQl2YXIgY29scyA9ICQuZ3JlcChvcHRpb25zLmNvbHVtbnMgfHwgW10sIGMgPT4gIWMuaWdub3JlKTsKCQl0YWcgPSB0YWcgfHwgInNlbGVjdCI7CgoJCW9wdGlvbnMuaWRGaWVsZCA9ICQudW5pcXVlU29ydChbewoJCQlmaWVsZDogb3B0aW9ucy5pZEZpZWxkLAoJCQl0aXRsZTogb3B0aW9ucy5pZEZpZWxkCgkJfV0uY29uY2F0KCQuZ3JlcChjb2xzLCBjID0+IGMucHJpbWFyeSksIFt7CgkJCWZpZWxkOiAnSWQnLAoJCQl0aXRsZTogJ0lEJwoJCX1dKSkuZmluZCh4ID0+IHR5cGVvZih4LmZpZWxkKSAhPT0gInVuZGVmaW5lZCIpOwoKCQlvcHRpb25zLnRleHRGaWVsZCA9ICQudW5pcXVlU29ydChbewoJCQlmaWVsZDogb3B0aW9ucy50ZXh0RmllbGQsCgkJCXRpdGxlOiBvcHRpb25zLnRleHRGaWVsZAoJCX1dLmNvbmNhdCgkLmdyZXAoY29scywgYyA9PiBjLmRpc3BsYXkpLCBbewoJCQlmaWVsZDogJ19Ub1N0cmluZycsCgkJCXRpdGxlOiBvcHRpb25zLm5hbWUsCgkJfV0pKS5maW5kKHggPT4gdHlwZW9mKHguZmllbGQpICE9PSAidW5kZWZpbmVkIik7CgoJCWNvbnNvbGUubG9nKCJEeW5hRm9ybTo6Y29tYm8oKTogb3B0aW9ucyIsIG9wdGlvbnMpOwoKCQl2YXIgZnVuID0gdHlwZSB8fCB0aGlzLmVGdW4ob3B0aW9ucyk7CgoJCXZhciBkcm9wZG93biA9IFsnY29tYm90cmVlZ3JpZCcsICdjb21ib3RyZWUnLCAnY29tYm9ncmlkJywgJ3NlbGVjdCddLmluZGV4T2YoZnVuKSA+IC0xOwoJCWlmIChkcm9wZG93bikgdGhpcy5zZWxlY3RzLnB1c2goewoJCQlpZDogImNtYiIgKyBvcHRpb25zLm5hbWUsCgkJCW9wdGlvbnM6IHRoaXMuYnlOYW1lKG9wdGlvbnMubmFtZSkKCQl9KTsKCQl0aGlzLnNlbGVjdHMgPSAkLnVuaXF1ZVNvcnQodGhpcy5zZWxlY3RzKTsKCQl2YXIgcmV0ID0gYDwke3RhZ30gaWQ9ImNtYiR7b3B0aW9ucy5uYW1lfSIgY2xhc3M9ImVhc3l1aS0ke2Z1bn0iIHN0eWxlPSJtYXgtd2lkdGg6JHtkcm9wZG93bj8nNDAwcHgnOnRoaXMuY1dpZHRoKG9wdGlvbnMpfTsgd2lkdGg6JHt0aGlzLmNXaWR0aChvcHRpb25zKX1weCIgcmVxdWlyZWQ9IiR7KG9wdGlvbnMucmVxdWlyZWQgPyAndHJ1ZScgOiAnZmFsc2UnKX0iIGRhdGEtb3B0aW9ucz0nZGlzYWJsZWQ6JHtvcHRpb25zLmRpc2FibGVkPyd0cnVlJzonZmFsc2UnfSwke3RoaXMuZXZlbnRIYW5kbGVycyhvcHRpb25zKX0sIHZhbHVlOiIke3RoaXMudmFsdWUob3B0aW9ucyl9Iiwgcm93bnVtYmVyczoke3R5cGVvZihvcHRpb25zLnJvd051bWJlcnMpIT09J3VuZGVmaW5lZCc/b3B0aW9ucy5yb3dOdW1iZXJzOihmdW4uaW5kZXhPZigndHJlZScpPC0xPydmYWxzZSc6J3RydWUnKX0sIHBhZ2luYXRpb246JHt0eXBlb2Yob3B0aW9ucy5wYWdpbmF0aW9uKSE9PSd1bmRlZmluZWQnP29wdGlvbnMucGFnaW5hdGlvbjooZnVuLmluZGV4T2YoJ3RyZWUnKTwtMT8nZmFsc2UnOid0cnVlJyl9LCBwYW5lbFdpZHRoOiR7Mip0aGlzLmNXaWR0aChvcHRpb25zKX0sIGZpdENvbHVtbnM6IHRydWUsIHNpbmdsZVNlbGVjdDogdHJ1ZSwgbXVsdGlwbGU6JHsob3B0aW9ucy5tdWx0aXBsZSB8fCAnZmFsc2UnKX0sIGlkRmllbGQ6ICIke29wdGlvbnMuaWRGaWVsZC5maWVsZH0iLCBlbmFibGVGaWx0ZXI6ICR7b3B0aW9ucy5maWx0ZXI/J3RydWUnOidmYWxzZSd9LCBub3dyYXA6IGZhbHNlLCB0ZXh0RmllbGQ6ICIke29wdGlvbnMudGV4dEZpZWxkLmZpZWxkfSIsIHRyZWVGaWVsZDogIiR7b3B0aW9ucy50ZXh0RmllbGQuZmllbGR9IixgOwoJCWlmIChmdW4uaW5kZXhPZigndHJlZScpID09IC0xKSB7CgkJCXJldCArPSAnZml0Q29sdW1uczogZmFsc2UsJyArIHRoaXMubWFwQ29sdW1ucyhvcHRpb25zKTsKCQl9CgkJaWYgKG9wdGlvbnMuZGF0YSkgewoJCQlyZXQgKz0gYCxkYXRhOiAke0pTT04uc3RyaW5naWZ5KG9wdGlvbnMuZGF0YSl9YDsKCQl9CgkJcmV0ICs9IGAnPmA7CgkJaWYgKG9wdGlvbnMub3B0aW9ucykgewoJCQlyZXQgKz0gJC5tYXAob3B0aW9ucy5vcHRpb25zLCBvID0+IGA8b3B0aW9uIHZhbHVlPScke19GckVNRC5fdG9KUyhvKX0nPiR7by5uYW1lIHx8IG99PC9vcHRpb24+YCkuam9pbignXG4nKTsKCQl9CgkJcmV0ICs9IGA8LyR7dGFnfT5gOwoJCS8vIGNvbnNvbGUubG9nKHJldCk7CgkJcmV0dXJuIHJldDsKCX0KCglncmlkKG9wdGlvbnMsIHRhZywgdHlwZSkgewoJCXJldHVybiB0aGlzLmNvbWJvKG9wdGlvbnMsICJ0YWJsZSIsICJkYXRhZ3JpZCIpOwoJfQoKCXRyZWVncmlkKG9wdGlvbnMpIHsKCQlyZXR1cm4gdGhpcy5jb21ibyhvcHRpb25zLCAndGFibGUnLCAndHJlZScpOwoJfQoKCWFzeW5jIGRvTGluayhlLCBldmVudCkgewoJCXRoaXMuYnVzeSh0cnVlKTsKCQl0cnkgewoJCQlhd2FpdCBlLmxpbmtzLmZpbmQobCA9PiBsLmxhYmVsID09IGV2ZW50LnRhcmdldC5pbm5lclRleHQpLm9uQ2xpY2sodGhpcy5nZXQoKSk7CgkJfSBjYXRjaCAoZXgpIHsKCQkJY29uc29sZS5sb2coIkR5bmFGb3JtOjpkb0xpbmsoKTogRXhjZXB0aW9uOiAiICsgZXgpOwoJCX0KCQl0aGlzLmJ1c3koZmFsc2UpOwoJfQoKCUVkaXRlZFZhbHVlKGUpIHsKCQlyZXR1cm4gKHR5cGVvZihhY2UpICE9PSAidW5kZWZpbmVkIikgPyBhY2UuZWRpdCgncG5sJyArIGUubmFtZSkuc2Vzc2lvbi5nZXRWYWx1ZSgpIDogJyc7Cgl9CgoJYXN5bmMgUGFuT25DbG9zZShlKSB7CgkJaWYgKGUuZWRpdG9yKSB7CgkJCWUudmFsdWUgPSB0aGlzLkVkaXRlZFZhbHVlKGUpOwoJCX0KCQlpZiAoZS5jbG9zZSkgewoJCQlhd2FpdCBlLmNsb3NlKHRoaXMuZ2V0KCkpOwoJCX0KCX0KCglhc3luYyBQZW5kQWZ0ZXJPcGVuKGUpIHsKCQlpZiAoZS5lZGl0b3IgJiYgdHlwZW9mKGFjZSkgIT09ICJ1bmRlZmluZWQiKSB7CgkJCWF3YWl0IF9GckVNRC5PcGVuRWRpdG9yKCdwbmwnICsgZS5uYW1lIC8qKyAnLWNlbnRlcicqLyAsIGUubGFuZ3VhZ2UsIGUubG9hZGVyIHx8IChvID0+IGUudmFsdWUpLCBlLnNhdmVyLCB0aGlzLmdldCgpLCBlKTsKCQl9CgkJaWYgKGUub3BlbikgewoJCQlhd2FpdCBlLm9wZW4odGhpcy5nZXQoKSk7CgkJfQoJfQoKCWxpbmsob3B0aW9ucykgewoJCXJldHVybiAob3B0aW9ucy5saW5rcyB8fCBbXSkuZmlsdGVyKGwgPT4gIWwuaWdub3JlKS5tYXAobCA9PiBgPGEgaHJlZj0iIyIgY2xhc3M9ImVhc3l1aS0ke3RoaXMudWlUeXBlc1tvcHRpb25zLnR5cGVdfSIgZGF0YS1vcHRpb25zPScke3RoaXMuZXZlbnRIYW5kbGVycyhvcHRpb25zKX0sIGljb25DbHM6Imljb24tJHtsLmljb24gfHwgJ29rJ30iJz4ke2wubGFiZWx9PC9hPmApLmpvaW4oJ1xuJyk7Cgl9CgoJYXN5bmMgU2V0VHJlZURhdGEoZSwgbiwgZGF0YSkgewoJCSQuZWFjaCgkKCIjY21iIiArIGUubmFtZSlbdGhpcy5lRnVuKGUpXSgndHJlZScpLnRyZWUoImdldENoaWxkcmVuIiwgbi50YXJnZXQpLCAoXywgYykgPT4gJCgiI2NtYiIgKyBlLm5hbWUpW3RoaXMuZUZ1bihlKV0oJ3RyZWUnKS50cmVlKCJyZW1vdmUiLCBjLnRhcmdldCkpOwoJCSQoIiNjbWIiICsgZS5uYW1lKVt0aGlzLmVGdW4oZSldKCd0cmVlJykudHJlZSgiYXBwZW5kIiwgewoJCQlwYXJlbnQ6IG4udGFyZ2V0LAoJCQlkYXRhOiBkYXRhCgkJfSk7CgkJcmV0dXJuIHRydWU7Cgl9CgoJYXN5bmMgRXhwYW5kKGUsIG4pIHsKCQl0aGlzLlNldFRyZWVEYXRhKGUsIG4sIFt7CgkJCWlkOiBudWxsLAoJCQl0ZXh0OiAibG9hZGluZy4uLiIKCQl9XSk7CgkJdmFyIG9iaiA9IHt9OwoJCXZhciBwRmllbGQgPSBlLnBhcmVudEZpZWxkIHx8ICQubWFwKCQuZ3JlcChlLmNvbHVtbnMgfHwgW10sIGMgPT4gYy5wYXJlbnQpLCBjID0+IGMuZmllbGQpLmNvbmNhdChbbnVsbF0pWzBdOwoJCXZhciBpZEZpZWxkID0gJC5ncmVwKGUuY29sdW1ucyB8fCBbXSwgYyA9PiBjLnByaW1hcnkpLmNvbmNhdChlLmlkRmllbGQpWzBdLmZpZWxkOwoJCWlmIChwRmllbGQpIHsKCQkJb2JqW3BGaWVsZF0gPSB7CgkJCQlfc291cmNlOiBuLl9zb3VyY2UKCQkJfTsKCQkJaWYgKGlkRmllbGQpIHsKCQkJCW9ialtwRmllbGRdW2lkRmllbGRdID0gbi5pZDsKCQkJfSBlbHNlIHsKCQkJCW9ialtwRmllbGRdID0gbi5pZDsKCQkJfQoJCX0KCQlsZXQgZGF0YSA9IGF3YWl0IHRoaXMuX2xvYWREYXRhKHsKCQkJaWQ6ICJjbWIiICsgZS5uYW1lLAoJCQlvcHRpb25zOiBlCgkJfSwgb2JqKTsKCQl0aGlzLlNldFRyZWVEYXRhKGUsIG4sIGRhdGEpOwoJfQoKCWFzeW5jIF9sb2FkRGF0YShzLCBvLCBzdGFydCwgZW5kKSB7CgkJdmFyIG5hbWUgPSAocyAmJiBzLm9wdGlvbnMgPyAocy5vcHRpb25zLkNsYXNzID8gcy5vcHRpb25zLkNsYXNzLk5hbWUucmVwbGFjZSgnICcsICdfJykgOiAocy5vcHRpb25zLnRhYmxlIHx8IHMub3B0aW9ucy5uYW1lKSkgOiBzLm5hbWUpOwoJCW5hbWUgPSBuYW1lLnRyaW0oKTsgLy8uc3BsaXQoJy4nKS5zbGljZSgtMSlbMF07CgoJCWxldCBvU2NvcGUgPSAodHlwZW9mKGNvbXBhbnkpICE9PSAndW5kZWZpbmVkJyAmJiBjb21wYW55LlNjb3BlKSA/IHdpbmRvd1tjb21wYW55LlNjb3BlXSA6IHdpbmRvdzsKCQlvID0gbyB8fCAoKG9TY29wZSAmJiBvU2NvcGVbbmFtZV0pID8gbmV3IG9TY29wZVtuYW1lXSgpIDogewoJCQlBY3RpdmU6IHRydWUsCgkJfSk7CgoJCW8gPSAodHlwZW9mIGZpbHRlcnMgIT09ICJ1bmRlZmluZWQiICYmIGZpbHRlcnMgJiYgZmlsdGVyc1tuYW1lXSkgPyBmaWx0ZXJzW25hbWVdKG8pIDogbzsKCQl2YXIgZnVuID0gdGhpcy5lRnVuKHMub3B0aW9ucyk7CgkJbGV0IHNUZXh0ID0gJCgiIyIgKyBzLmlkKVtmdW5dKCdnZXRUZXh0Jyk7CgoJCW8gPSAocyAmJiBzLm9wdGlvbnMgJiYgcy5vcHRpb25zLnNvdXJjZSkgPyBzLm9wdGlvbnMuc291cmNlKG8sIHRoaXMuZ2V0KCksIHNUZXh0KSA6IG87CgkJbGV0IG5hbWVzID0gJC51bmlxdWVTb3J0KFtzLm9wdGlvbnMuc2VhcmNoRmllbGRdLmNvbmNhdCgkLm1hcCgkLmdyZXAocy5vcHRpb25zLmNvbHVtbnMgfHwgW10sIGMgPT4gYy5zZWFyY2gpLCBjID0+IGMuZmllbGQpLCBbIk5hbWUiXSkpLmZpbHRlcih2ID0+IHYpOwoJCWlmICghb1tuYW1lc1swXV0pIG9bbmFtZXNbMF1dID0gc1RleHQ7CgkJLy9jb25zb2xlLmxvZygiRHluYUZvcm06Ol9sb2FkRGF0YSgpOiBvIiwgbyk7CgkJdmFyIGRhdGEgPSBudWxsOwoKCQlsZXQgbGliID0gJyc7CgkJaWYgKG5hbWUuaW5kZXhPZignLicpID4gMCkgewoJCQlsaWIgPSBuYW1lLnNwbGl0KCcuJylbMF0gKyAnLic7CgkJCW5hbWUgPSBuYW1lLnNwbGl0KCcuJylbMV07CgkJfQoKCQlpZiAocy5vcHRpb25zLmxvYWRlcikgewoJCQlkYXRhID0gYXdhaXQgcy5vcHRpb25zLmxvYWRlcih0aGlzLmdldCgpLCBzLm9wdGlvbnMsIG8sIHNUZXh0KTsKCQl9IGVsc2UgaWYgKG8gJiYgdHlwZW9mKG8uZmluZEFsbCkgPT09ICdmdW5jdGlvbicpIHsKCQkJZGF0YSA9IGF3YWl0IG8uZmluZEFsbCgpOwoJCX0gZWxzZSBpZiAodHlwZW9mKGNvbXBhbnkpICE9PSAndW5kZWZpbmVkJyAmJiBjb21wYW55LmxpYnJhcnkgJiYgY29tcGFueS5Db2RlICYmIHdpbmRvdy5iTG9jYWwpIHsKCQkJLy9jb25zb2xlLmxvZygiREZvcm06Ol9sb2FkRGF0YSgpOiBzcigpLl8oIiArIGxpYiArIGNvbXBhbnkuQ29kZS50b0xvd2VyQ2FzZSgpICsgbmFtZSArICJGaW5kYWxsIiArICIpIiwgbyk7CgkJCWRhdGEgPSBhd2FpdCB0aGlzLnNyKCkuXyhsaWIgKyBjb21wYW55LkNvZGUudG9Mb3dlckNhc2UoKSArIG5hbWUgKyAiRmluZGFsbCIsIG51bGwsIG8sIG51bGwsIHN0YXJ0LCBlbmQpOwoJCX0gZWxzZSBpZiAoX0ZyRU1ELmFwaVNlcnZlcikgewoJCQlvID0gT2JqZWN0LmFzc2lnbiguLi5PYmplY3Qua2V5cyhvKS5tYXAoayA9PiAoewoJCQkJW1N0cmluZyhrKS5jaGFyQXQoMCkudG9Mb3dlckNhc2UoKSArIFN0cmluZyhrKS5zbGljZSgxKV06IG9ba10KCQkJfSkpKTsKCQkJLy9jb25zb2xlLmxvZygiREZvcm06Ol9sb2FkRGF0YSgpOiB1c2luZyBfRnJFTUQuYXBpU2VydmVyOiBvIiwgbyk7CgkJCWRhdGEgPSBhd2FpdCBfRnJFTUQuYXBpU2VydmVyLl9uZXcobmFtZSkuX2Zyb21Eb2N1bWVudChvKS5maW5kQWxsKCk7CgkJfQoKCQlpZiAocy5vcHRpb25zLnBvc3Rsb2FkKSB7CgkJCWF3YWl0IHMub3B0aW9ucy5wb3N0bG9hZChkYXRhKTsKCQl9CgkJJC5lYWNoKGRhdGEsIChpLCBkKSA9PiB7CgkJCWQuX19PV05FUiA9IHM7CgkJCSQuZWFjaChzLm9wdGlvbnMuY29sdW1ucywgKF8sIGMpID0+IHsKCQkJCWlmIChjLnZhbHVlKSB7CgkJCQkJZFtjLmZpZWxkXSA9IGMudmFsdWUoZCwgZGF0YSwgaSk7CgkJCQl9CgkJCX0pOwoJCX0pOwoJCWlmICghcy5vcHRpb25zLmNvbHVtbnMgJiYgZnVuLmluZGV4T2YoJ3RyZWUnKSA+IC0xKSB7CgkJCWRhdGEgPSAkLm1hcChkYXRhLCBkID0+IHsKCQkJCWxldCByZXQgPSB7CgkJCQkJaWQ6IGRbcy5vcHRpb25zLmlkRmllbGQuZmllbGRdLAoJCQkJCXRleHQ6IGRbcy5vcHRpb25zLnRleHRGaWVsZC5maWVsZF0sCgkJCQkJc3RhdGU6IGQuc3RhdGUgfHwgKHMub3B0aW9ucy5sb2FkZXIgPyAiZmlsZSIgOiAiY2xvc2VkIiksCgkJCQkJX3NvdXJjZTogZCwKCQkJCX07CgkJCQlyZXQuY2hpbGRyZW4gPSAocmV0LnN0YXRlID09ICJjbG9zZWQiKSA/IFt7CgkJCQkJdGV4dDogJ2xvYWRpbmcuLi4nCgkJCQl9XSA6IG51bGw7CgkJCQlyZXR1cm4gcmV0OwoJCQl9KTsKCQl9CgkJcmV0dXJuIGRhdGEgfHwgW107Cgl9CgoJYXN5bmMgZmlsbERhdGEoZywgbywgc3RhcnQsIGVuZCkgewoJCXZhciBzID0gbnVsbDsKCQlmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuc2VsZWN0cy5sZW5ndGg7IGkrKykgewoJCQlpZiAodGhpcy5zZWxlY3RzW2ldLmlkID09IGdbMF0uaWQpIHMgPSB0aGlzLnNlbGVjdHNbaV07CgkJfQoJCWlmICghcykgcmV0dXJuOwoJCXRoaXMuYnVzeSh0cnVlKTsKCQl0cnkgewoJCQl2YXIgZnVuID0gZ1swXS5jbGFzc0xpc3RbIjAiXS5yZXBsYWNlKCdlYXN5dWktJywgJycpOwoJCQl0cnkgewoJCQkJJCgiIyIgKyBzLmlkKVtmdW5dKCdncmlkJykuZGF0YWdyaWQoJ2dldFBhZ2VyJykucGFnaW5hdGlvbignbG9hZGluZycpOwoJCQl9IGNhdGNoIChleCkge30KCQkJaWYgKHMub3B0aW9ucy5ub2xvYWQpIHsKCQkJCWxldCBfZGF0YSA9IG51bGw7CgkJCQl0cnkgewoJCQkJCV9kYXRhID0gJCgiIyIgKyBzLmlkKVtmdW5dKCdncmlkJykuZGF0YWdyaWQoImdldERhdGEiKTsKCQkJCX0gY2F0Y2ggKGV4KSB7CgkJCQkJX2RhdGEgPSAkKCIjIiArIHMuaWQpW2Z1bl0oJ3RyZWUnKS50cmVlKCdnZXRSb290Jyk7CgkJCQl9CgkJCQlpZiAoX2RhdGEpIHsKCQkJCQlyZXR1cm4gdGhpcy5idXN5KGZhbHNlKTsKCQkJCX0KCQkJfQoJCQl2YXIgZGF0YSA9IGF3YWl0IHRoaXMuX2xvYWREYXRhKHMsIG8sIHN0YXJ0LCBlbmQpOwoJCQl0cnkgewoJCQkJaWYgKCQoIiMiICsgcy5pZClbZnVuXSgnZ3JpZCcpKSAkKCIjIiArIHMuaWQpW2Z1bl0oJ2dyaWQnKS5kYXRhZ3JpZCgnZ2V0UGFnZXInKS5wYWdpbmF0aW9uKCdsb2FkZWQnKTsKCQkJfSBjYXRjaCAoZXgpIHt9CgkJCXRyeSB7CgkJCQkkKCIjIiArIHMuaWQpW2Z1bl0oJ2dyaWQnKS5kYXRhZ3JpZCgnbG9hZERhdGEnLCB7CgkJCQkJdG90YWw6IGRhdGEuQ291bnQgfHwgZGF0YS5sZW5ndGgsCgkJCQkJcm93czogZGF0YSwKCQkJCX0pOwoJCQl9IGNhdGNoIChleCkgewoJCQkJJCgiIyIgKyBzLmlkKVtmdW5dKCd0cmVlJykudHJlZSgnbG9hZERhdGEnLCBkYXRhKTsKCQkJfQoJCX0gY2F0Y2ggKGV4KSB7CgkJCWNvbnNvbGUubG9nKGV4KTsKCQl9CgkJdGhpcy5idXN5KGZhbHNlKTsKCX0KCglldmVudEhhbmRsZXJzKG9wdGlvbnMpIHsKCQlpZiAoIXRoaXMuYnlOYW1lKG9wdGlvbnMubmFtZSkpIHJldHVybjsgLy8gaWYgbm90IGFuIGVsZW1lbnQsIGRvIG5vdCBydW4gdGhlIGhhbmRsZXJzCgoJCXJldHVybiB0aGlzLmV2ZW50cy5maWx0ZXIoZSA9PiBlLnR5cGUgPT0gb3B0aW9ucy50eXBlIHx8IHR5cGVvZihlLnR5cGUpID09PSAndW5kZWZpbmVkJykubWFwKGUgPT4gYCR7ZS5uYW1lfTogKCR7ZS5wYXJhbXMgfHwgJyd9KSA9PiB7dHJ5e0RGb3JtLiR7ZS5oYW5kbGVyfShERm9ybS5ieU5hbWUoIiR7b3B0aW9ucy5uYW1lfSIpIHx8ICR7X0ZyRU1ELl90b0pTKG9wdGlvbnMpfSB8fCB7bmFtZTogIiR7b3B0aW9ucy5uYW1lfSIsdHlwZTogIiR7b3B0aW9ucy50eXBlfSJ9LCAke2UucGFyYW1zfSl9Y2F0Y2goZXgpe2NvbnNvbGUubG9nKCJFdmVudCBFcnJvcjogJHtvcHRpb25zLm5hbWV9LyR7b3B0aW9ucy50eXBlfS8ke2UubmFtZX0iLCBleCk7fX1gKS5qb2luKCcsJyk7Cgl9CgoJYXN5bmMgUGFuZWxPcGVuKGUpIHsKCQlpZiAoZS5lZGl0b3IpIHJldHVybiB0cnVlOwoJCWxldCBjb250ZW50ID0gZS52YWx1ZTsKCQlpZiAoZS5sb2FkZXIpIHsKCQkJY29udGVudCA9IGF3YWl0IGUubG9hZGVyKHRoaXMuZ2V0KCkpOwoJCX0KCQlpZiAoY29udGVudCkgewoJCQl0cnkgewoJCQkJJCgiI3BubCIgKyBlLm5hbWUpLnBhbmVsKCdib2R5JykuaHRtbChjb250ZW50KTsKCQkJCWNvbnNvbGUubG9nKCJwbmwiICsgZS5uYW1lICsgIjogQ29udGVudCBWYWxpZCIpOwoJCQl9IGNhdGNoIChleCkgewoJCQkJLy9jb25zb2xlLmxvZyhleCk7CgkJCX0KCQl9CgkJcmV0dXJuIGNvbnRlbnQ7Cgl9CgoJYXN5bmMgU2VsZWN0Q2hhbmdlKG9wdGlvbnMsIHRhYikgewoJCXRoaXMuYnVzeSh0cnVlKTsKCQkkLmdyZXAodGhpcy5lbGVtZW50cywgZSA9PiBlLnR5cGUgPT0gImdyaWQiICYmIGUuZ3JvdXAgPT0gdGFiKS5mb3JFYWNoKGUgPT4gJCgiI2NtYiIgKyBlLm5hbWUpLmRhdGFncmlkKCkpOwoJCXRoaXMuYnVzeShmYWxzZSk7Cgl9CgoJYXN5bmMgRmllbGRDaGFuZ2Uob3B0aW9ucywgdmFsdWUpIHsKCQl0aGlzLmJ1c3kodHJ1ZSk7CgkJaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5jaGFuZ2UpIHsKCQkJYXdhaXQgb3B0aW9ucy5jaGFuZ2UodGhpcy5nZXQoKSwgdmFsdWUpOwoJCX0KCQl0aGlzLmJ1c3koZmFsc2UpOwoJfQoKCWFzeW5jIFVSTENoYW5nZShzLCBvcHRpb25zKSB7CgkJb3B0aW9ucy5kYXRhID0gYXdhaXQgJC5nZXQocy52YWx1ZSk7CgkJcmV0dXJuIGF3YWl0IHRoaXMuRmllbGRDaGFuZ2Uocywgb3B0aW9ucyk7Cgl9CgoJVXBsb2FkRmlsZShmLCBvcHRpb25zKSB7CgkJdGhpcy5idXN5KHRydWUpOwoJCXZhciBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSgpOwoJCXZhciBmaWxlaWQgPSBNYXRoLnJhbmRvbSgpOwoJCXZhciBtZXRob2QgPSBvcHRpb25zLm1ldGhvZCB8fCAiQ29udGVudE1hbmFnZXIuY21zVXBsb2FkRmlsZSI7CgkJZm9ybURhdGEuYXBwZW5kKCdmaWxlaWQnLCBmaWxlaWQpOwoJCXZhciBmaWxlID0gJCgiIyIgKyBmLmZpbGVib3hJZClbMF0uZmlsZXNbMF07CgkJZm9ybURhdGEuYXBwZW5kKCdfX1VGSUxFJywgZmlsZSk7CgkJaWYgKG9wdGlvbnMubG9jYWwpIHsKCQkJLy8gaGFuZGxpbmcgdGhlIGZpbGUgbG9jYWxseQoJCQl2YXIgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTsKCQkJcmVhZGVyLm9ubG9hZCA9IChlKSA9PiB7CgkJCQl2YXIgZGF0YSA9IGUudGFyZ2V0LnJlc3VsdDsKCQkJCXJldCA9IGRhdGE7CgkJCQl0aGlzLmJ5TmFtZShvcHRpb25zLm5hbWUpLmRhdGEgPSByZXQ7CgkJCQlpZiAob3B0aW9ucyAmJiBvcHRpb25zLnVwbG9hZCkgb3B0aW9ucy51cGxvYWQodGhpcy5nZXQoKSwgcmV0KTsKCQkJfTsKCQkJaWYgKG9wdGlvbnMuYmluYXJ5KSB7CgkJCQlyZWFkZXIucmVhZEFzQmluYXJ5U3RyaW5nKGZpbGUpOwoJCQl9IGVsc2UgaWYgKG9wdGlvbnMuZGF0YXVybCkgewoJCQkJcmVhZGVyLnJlYWRBc0RhdGFVUkwoZmlsZSk7CgkJCX0gZWxzZSB7CgkJCQlyZWFkZXIucmVhZEFzVGV4dChmaWxlKTsKCQkJfQoJCQl0aGlzLmJ1c3koZmFsc2UpOwoJCX0gZWxzZSBpZiAobWV0aG9kKSB7CgkJCSQuYWpheCh7CgkJCQl1cmw6IHRoaXMuc3IoKS5zclVSTCArICImbWV0aG9kPSIgKyBtZXRob2QgKyAiJnNJbnB1dD0iICsgZmlsZWlkICsgIiZwcmVUYWc9JnBvc3RUYWc9IiwKCQkJCWRhdGE6IGZvcm1EYXRhLAoJCQkJLy8gVEhJUyBNVVNUIEJFIERPTkUgRk9SIEZJTEUgVVBMT0FESU5HCgkJCQljYWNoZTogZmFsc2UsCgkJCQljb250ZW50VHlwZTogZmFsc2UsCgkJCQl0eXBlOiAnUE9TVCcsCgkJCQlwcm9jZXNzRGF0YTogZmFsc2UsCgkJCQlzdWNjZXNzOiBkYXRhID0+IHsKCQkJCQl0aGlzLnNyKCkucnVuU2NyaXB0KGRhdGEpOwoJCQkJCXRoaXMuYnlOYW1lKG9wdGlvbnMubmFtZSkuZGF0YSA9IHJldDsKCQkJCQlpZiAob3B0aW9ucyAmJiBvcHRpb25zLnVwbG9hZCkgb3B0aW9ucy51cGxvYWQodGhpcy5nZXQoKSwgcmV0KTsKCQkJCQl0aGlzLmJ1c3koZmFsc2UpOwoJCQkJfQoJCQl9KTsKCQl9Cgl9CgoJZUZ1bihlKSB7CgkJdHJ5IHsKCQkJaWYgKGUudHlwZSA9PSAidHJlZSIpIHsKCQkJCWlmIChlLmNvbHVtbnMpIHsKCQkJCQlyZXR1cm4gImNvbWJvdHJlZWdyaWQiOwoJCQkJfSBlbHNlIGlmICh0eXBlb2YoZS5jb21ibykgIT09ICd1bmRlZmluZWQnICYmICFlLmNvbWJvKSB7CgkJCQkJcmV0dXJuICd0cmVlJzsKCQkJCX0gZWxzZSB7CgkJCQkJcmV0dXJuICJjb21ib3RyZWUiOwoJCQkJfQoJCQl9IGVsc2UgaWYgKGUudHlwZSA9PSAnbmF2aWdhdGlvbicpIHsKCQkJCXJldHVybiAndHJlZSc7CgkJCX0gZWxzZSBpZiAoZS50eXBlID09ICJjb21ib3RyZWUiKSB7CgkJCQlyZXR1cm4gImNvbWJvdHJlZWdyaWQiOwoJCQl9IGVsc2UgaWYgKGUudHlwZSA9PSAic2VsZWN0IiAmJiBlLm9wdGlvbnMpIHsKCQkJCXJldHVybiAiY29tYm9ib3giOwoJCQl9CgkJCXJldHVybiAiY29tYm9ncmlkIjsKCQl9IGNhdGNoIChleCkgewoJCQlyZXR1cm4gImNvbWJvZ3JpZCI7CgkJfQoJfQoKCV9maWxsV2luZG93KHdpbk5hbWUsIHYsIG1hcCkgewoJCXYgPSB2IHx8IHt9OwoJCW1hcCA9IG1hcCB8fCB7fTsKCQlpZiAoQXJyYXkuaXNBcnJheShtYXApKSB7CgkJCW1hcCA9IE9iamVjdC5mcm9tRW50cmllcyhuZXcgTWFwKG1hcCkpOwoJCX0KCgkJbWFwID0gJC5leHRlbmQoe30sIG1hcCwgT2JqZWN0LmZyb21FbnRyaWVzKE9iamVjdC5rZXlzKHYpLm1hcChrID0+IFt3aW5OYW1lICsgaywga10pKSk7CgoJCWxldCBzID0ge307CgkJZm9yICh2YXIgbSBpbiBtYXApIHsKCQkJaWYgKHR5cGVvZih2W21hcFttXV0pID09PSAidW5kZWZpbmVkIikgewoJCQkJLy9jb25zb2xlLmxvZygnaXNfdW5kZWZpbmVkJywgbSwgbWFwW21dLCB2W21hcFttXV0pOwoJCQkJc1ttXSA9IG1hcFttXTsKCQkJfSBlbHNlIHsKCQkJCS8vY29uc29sZS5sb2coJ2lzX25vdF91bmRlZmluZWQnLCBtLCBtYXBbbV0sIHZbbWFwW21dXSk7CgkJCQlzW21dID0gdlttYXBbbV1dOwoJCQl9CgkJfQoJCXRoaXMuY2xlYXIod2luTmFtZSk7CgkJLy9jb25zb2xlLmxvZygicyIsIHMpOwoJCXRoaXMuc2V0KHMpOwoJCSQoIiNwbmxfIiArIHdpbk5hbWUpLndpbmRvdygib3BlbiIpOwoJfQoKCXdpbmRvd1RvRW50aXR5KG8sIGJFbXB0eSwgZ3JpZCwgcHJlZml4LCBmaWx0ZXIpIHsKCQlvID0gbyB8fCB0aGlzLmdldCgpOwoJCWZpbHRlciA9IGZpbHRlciB8fCAodiA9PiB2KTsKCQlsZXQgcmV0ID0gZ3JpZCA/IChncmlkLnNlbGVjdGVkIHx8IGdyaWQpIDogbnVsbDsKCQlpZiAoYkVtcHR5KSB7CgkJCXJldCA9IHt9OwoJCQlvID0ge307CgkJfSBlbHNlIHsKCQkJcmV0ID0gKHJldCAmJiByZXQuSWQpID8gewoJCQkJSWQ6IHJldC5JZAoJCQl9IDoge307CgkJfQoKCQl0aGlzLmVsZW1lbnRzLmZpbHRlcihlID0+IChwcmVmaXggPyBlLmdyb3VwID09IHByZWZpeCA6IHRydWUpICYmIGUudHlwZSAhPSAnbGluaycgJiYgWydfJ10uaW5kZXhPZihlLm5hbWUucmVwbGFjZShwcmVmaXgsICIiKSkgPCAwKS5mb3JFYWNoKGUgPT4gewoJCQlyZXRbZS5uYW1lLnJlcGxhY2UocHJlZml4LCAiIildID0gb1tlLm5hbWVdOwoJCQlyZXR1cm4gdHJ1ZTsKCQl9KTsKCgkJZmlsdGVyKHJldCk7CgoJCXJldHVybiByZXQ7Cgl9CgoJYmluZChvYmopIHsKCQl2YXIgb2JqQmluZCA9IChvLCBlKSA9PiB7CgkJCW9bdGhpcy5lRnVuKGUpXSh7CgkJCQlvblNob3dQYW5lbDogKCkgPT4gewoJCQkJCXRoaXMuZmlsbERhdGEoJCgiIyIgKyBlLmlkKSwgbnVsbCwgMCwgMTApOwoJCQkJfSwKCQkJCW9uQ2xpY2tSb3c6IChpbmRleCwgcm93KSA9PiB7CgkJCQkJdmFyIHMgPSByb3cgPyByb3cuX19PV05FUiA6IG51bGw7CgkJCQkJLy9jb25zb2xlLmxvZygib25DbGlja1JvdygpOiAiLCBpbmRleCwgcm93LCBzKTsKCQkJCQlpZiAocyAmJiBzLm9wdGlvbnMuc2VsZWN0KSB7CgkJCQkJCXMub3B0aW9ucy5zZWxlY3Qocm93LCB0aGlzLmdldCgpKTsKCQkJCQl9CgkJCQl9CgkJCX0pOwoJCQl0cnkgewoJCQkJdmFyIGRnID0gb1t0aGlzLmVGdW4oZSldKCdncmlkJyk7CgkJCQkvLyBkZy5kYXRhZ3JpZCgnZW5hYmxlRmlsdGVyJykKCQkJCXZhciBzdGF0ZSA9IGRnLmRhdGEoJ2RhdGFncmlkJyk7CgkJCQl2YXIgb3B0cyA9IHN0YXRlLm9wdGlvbnM7CgkJCQl2YXIgb25CZWZvcmVMb2FkID0gb3B0cy5vbkJlZm9yZUxvYWQ7CgkJCQlvcHRzLm9uQmVmb3JlTG9hZCA9IChwYXJhbSkgPT4gewoJCQkJCXN0YXRlLmFsbFJvd3MgPSBudWxsOwoJCQkJCXJldHVybiBvbkJlZm9yZUxvYWQuY2FsbCh0aGlzLCBwYXJhbSk7CgkJCQl9OwoJCQkJdmFyIHBhZ2VyID0gZGcuZGF0YWdyaWQoJ2dldFBhZ2VyJyk7CgkJCQlkZy5kYXRhZ3JpZCgnZ2V0UGFuZWwnKS5wYW5lbCh7CgkJCQkJSUQ6IGkKCQkJCX0pOwoJCQkJcGFnZXIucGFnaW5hdGlvbih7CgkJCQkJb25TZWxlY3RQYWdlOiBmdW5jdGlvbihwYWdlTnVtLCBwYWdlU2l6ZSkgewoJCQkJCQl0cnkgewoJCQkJCQkJREZvcm0uZmlsbERhdGEoJCgiIyIgKyBERm9ybS5zZWxlY3RzWyQodGhpcy5wYXJlbnROb2RlKS5wYW5lbCgnb3B0aW9ucycpLklEXS5pZCksIG51bGwsIHBhZ2VTaXplICogKHBhZ2VOdW0gLSAxKSwgcGFnZVNpemUgKiBwYWdlTnVtKTsKCQkJCQkJfSBjYXRjaCAoX2V4KSB7CgkJCQkJCQljb25zb2xlLmxvZygiRHluYUZvcm06Om9uU2VsZWN0UGFnZSgpICIsIF9leCk7CgkJCQkJCX0KCQkJCQl9CgkJCQl9KTsKCQkJCWRnLmRhdGFncmlkKCdsb2FkRGF0YScsIHN0YXRlLmRhdGEpOwoJCQl9IGNhdGNoIChleCkge30KCQl9OwoJCWlmIChvYmopIHsKCQkJb2JqQmluZChvYmopOwoJCX0gZWxzZSB7CgkJCWZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5zZWxlY3RzLmxlbmd0aDsgaSsrKSB7CgkJCQlpZiAodGhpcy5zZWxlY3RzW2ldLm9wdGlvbnMub3B0aW9ucykgewoJCQkJCS8vJCgiIyIgKyB0aGlzLnNlbGVjdHNbaV0uaWQpLmNvbWJvKCk7CgkJCQl9IGVsc2UgewoJCQkJCW9iakJpbmQoJCgiIyIgKyB0aGlzLnNlbGVjdHNbaV0uaWQpLCB0aGlzLnNlbGVjdHNbaV0pOwoJCQkJfQoJCQl9CgoJCQl0aGlzLmVsZW1lbnRzLmZpbHRlcihlID0+IGUud2luZG93ICYmIGUuZ3JvdXApLmZvckVhY2goZSA9PiB7CgkJCQlsZXQgdCA9ICQoIiN0YmNXaW5kb3ciKS50YWJzKCJnZXRUYWIiLCBlLmdyb3VwKTsKCQkJCWlmICh0KSB7CgkJCQkJdC5wYW5lbCgnb3B0aW9ucycpLnRhYi5oaWRlKCk7CgkJCQl9CgkJCX0pOwoJCX0KCX0KCgllbmdsaXNoKHMpIHsKCQlpZiAoIXMpIHJldHVybiAiIjsKCQl2YXIgcmVzdWx0ID0gcy5yZXBsYWNlKC8oW0EtWl0pL2csICIgJDEiKTsKCQlyZXN1bHQgPSByZXN1bHQucmVwbGFjZSgvXy9nLCAnJyk7CgkJcmV0dXJuIHJlc3VsdC5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHJlc3VsdC5zbGljZSgxKTsKCX0KCglvblRvZ2dsZShlLCBiVmFsdWUpIHsKCQlsZXQgc1RhZyA9IGAjZkVsZW1lbnRfJHtlLmZvci5uYW1lfSA+IC5lYXN5dWktJHt0aGlzLnVpVHlwZXNbZS5mb3IudHlwZV19YDsKCQlsZXQgb1RhZyA9ICQoc1RhZyk7CgkJZS5mb3IuZW5hYmxlZCA9IHR5cGVvZihiVmFsdWUpID09PSAidW5kZWZpbmVkIiA/ICFlLmZvci5lbmFibGVkIDogYlZhbHVlOwoKCQlvVGFnLnByb3AoImRpc2FibGVkIiwgIWUuZm9yLmVuYWJsZWQpOwoJCS8vb1RhZ1t0aGlzLnVpVHlwZXNbZS5mb3IudHlwZV1dKGUuZm9yLmVuYWJsZWQgPyAiZW5hYmxlIiA6ICJkaXNhYmxlIik7CgkJY29uc29sZS5sb2coc1RhZywgb1RhZywgdGhpcy51aVR5cGVzW2UuZm9yLnR5cGVdLCBlLmZvci5lbmFibGVkKTsKCX0KCglyZW5kZXIobmFtZSwgdGl0bGUsIGVsZW1lbnRzLCBidXR0b25zLCBiRml4ZWQpIHsKCQl0aGlzLmVsZW1lbnRzID0gKGVsZW1lbnRzIHx8IFtdKS5maWx0ZXIoZSA9PiAhZS5pZ25vcmUpOwoKCQl0aGlzLmJ1dHRvbnMgPSBidXR0b25zIHx8IFtdOwoJCXRoaXMuc2VsZWN0cyA9IFtdOwoJCXRoaXMuZ3JpZHMgPSBbXTsKCgkJdGhpcy5lbGVtZW50cy5maWx0ZXIoZSA9PiBlLnR5cGUgPT0gIndpbmRvdyIpLmZvckVhY2godyA9PiB0aGlzLmVsZW1lbnRzLnNwbGljZSh0aGlzLmVsZW1lbnRzLmZpbmRJbmRleChlID0+IGUubmFtZSA9PSB3Lm5hbWUpLCAwLCB7CgkJCW5hbWU6ICJfIiArIHcubmFtZSwKCQkJdHlwZTogImxpbmsiLAoJCQl0aXRsZTogdy50aXRsZSB8fCB3Lm5hbWUsCgkJCWdyb3VwOiB3Lmdyb3VwLAoJCQl3aW5kb3c6IHcud2luZG93LAoJCQlzZWN0aW9uOiB3LnNlY3Rpb24sCgkJCWxpbmtzOiBbewoJCQkJbGFiZWw6ICdPcGVuJywKCQkJCWljb246ICdlZGl0JywKCQkJCW9uQ2xpY2s6IG8gPT4gJCgiI3BubCIgKyB3Lm5hbWUpLndpbmRvdygnb3BlbicpCgkJCX1dLAoJCX0pKTsKCgkJdGhpcy5zcigpLmdyb3VwQnkodGhpcy5lbGVtZW50cy5maWx0ZXIoZSA9PiBlLndpbmRvdyksICJncm91cCIpLmZvckVhY2goa3YgPT4gewoJCQlpZiAoIWt2LmtleSkgcmV0dXJuOwoKCQkJbGV0IGUgPSB7CgkJCQluYW1lOiAiXyIgKyBrdi5rZXksCgkJCQl0aXRsZToga3Yua2V5LAoJCQkJdHlwZTogIndpbmRvdyIsCgkJCQlncm91cDoga3Yua2V5LAoJCQkJd2lkdGg6IHRoaXMud2lkdGggKiAwLjksCgkJCQloZWlnaHQ6IHRoaXMuaGVpZ2h0ICogMC45LAoJCQkJbG9hZGVyOiBvID0+IHsKCQkJCQlrdi52YWx1ZXMuZmlsdGVyKHYgPT4gdi50eXBlICE9PSAnbGluaycgfHwgKHYudHlwZSA9PSAnbGluaycgJiYgdi5uYW1lLnN0YXJ0c1dpdGgoJ18nKSkpLmZvckVhY2godiA9PiAkKCIjcG5sXyIgKyB2Lmdyb3VwICsgJy1jZW50ZXInKS5hcHBlbmQoJCgiI2ZFbGVtZW50XyIgKyB2Lm5hbWUpKSk7CgkJCQkJcmV0dXJuIG51bGw7CgkJCQl9LAoJCQkJYnV0dG9uczogW10uY29uY2F0LmFwcGx5KFtdLCBrdi52YWx1ZXMuZmlsdGVyKHYgPT4gdi50eXBlID09ICdsaW5rJyAmJiAhdi5uYW1lLnN0YXJ0c1dpdGgoJ18nKSkubWFwKHYgPT4gWy4uLnYubGlua3MubWFwKGwgPT4gKHsKCQkJCQluYW1lOiBsLm5hbWUgfHwgbC5sYWJlbCwKCQkJCQl0aXRsZTogbC50aXRsZSB8fCBsLmxhYmVsLAoJCQkJCW9uQ2xpY2s6IGwub25DbGljaywKCQkJCQlpY29uOiBsLmljb24sCgkJCQkJd2luZG93OiB0cnVlLAoJCQkJCWdyb3VwOiBrdi5rZXksCgkJCQl9KSldKSksCgkJCX07CgkJCXRoaXMuYnV0dG9ucy5wdXNoKC4uLmUuYnV0dG9ucyk7CgoJCQl0aGlzLmVsZW1lbnRzLnB1c2goZSk7CgkJfSk7CgoJCXZhciByZXQgPSAiIjsKCQkvLyBjaGVjayB0aGUgb3B0aW9uIG9mIHVzaW5nIHdpbmRvdygpIGFzIGEgcmVuZGVyZXIgb2YgdGhlIG1haW4gd2luZG93Li4uCgkJaWYgKHRydWUpIHsKCQkJdGhpcy5lbGVtZW50cy5maWx0ZXIoZSA9PiAhZS56b25lKS5mb3JFYWNoKGUgPT4gZS56b25lID0gJ2NlbnRlcicpOwoJCQlsZXQgd09wdGlvbnMgPSB7CgkJCQluYW1lOiBuYW1lIHx8IHRoaXMubmFtZSwKCQkJCXRpdGxlOiB0aXRsZSB8fCB0aGlzLnRpdGxlLAoJCQkJdHlwZTogJ3dpbmRvdycsCgkJCQl2aXNpYmxlOiB0cnVlLAoJCQkJd2lkdGg6IHRoaXMud2lkdGgsCgkJCQloZWlnaHQ6IHRoaXMuaGVpZ2h0LAoJCQkJZml4ZWQ6IGJGaXhlZCwKCQkJCWxpbmtzOiBbewoJCQkJCWljb246ICJoZWxwIiwKCQkJCQlhY3Rpb246IG8gPT4gJCgiI3BubF9fQ29uc29sZSIpLndpbmRvdygnb3BlbicpCgkJCQl9XSwKCQkJCWJ1dHRvbnM6IHRoaXMuYnV0dG9ucy5maWx0ZXIoYiA9PiAhYi53aW5kb3cpLAoJCQl9OwoJCQl0aGlzLnNyKCkuZ3JvdXBCeSh0aGlzLmVsZW1lbnRzLCAnem9uZScpLmZpbHRlcih6ZyA9PiB6Zy5rZXkpLmZvckVhY2goemcgPT4gewoJCQkJd09wdGlvbnNbemcua2V5XSA9IHRoaXMucmVuZGVyRWxlbWVudHMoemcudmFsdWVzKTsKCQkJfSk7CgoJCQlyZXQgPSB0aGlzLndpbmRvdyh3T3B0aW9ucyk7CgkJfSBlbHNlIHsKCQkJcmV0ID0gdGhpcy5oZWFkZXIobmFtZSwgdGl0bGUsIGJGaXhlZCwgW3sKCQkJCWljb246ICJoZWxwIiwKCQkJCWFjdGlvbjogbyA9PiAkKCIjcG5sX19Db25zb2xlIikud2luZG93KCdvcGVuJykKCQkJfV0pOwoKCQkJcmV0ICs9IHRoaXMucmVuZGVyRWxlbWVudHMoKTsKCgkJCXJldCArPSB0aGlzLmZvb3RlcihiRml4ZWQpOwoKCQl9CgkJLy8gY29uc29sZS5sb2cocmV0KTsKCgkJcmV0dXJuIHJldDsKCX0KCgljV2lkdGgob3B0aW9ucykgewoJCWxldCByZXQgPSBNYXRoLmZsb29yKCgob3B0aW9ucyA/IG9wdGlvbnMud2lkdGggOiBudWxsKSB8fCAodGhpcy53aWR0aCAvIDMpKSk7CgkJaWYgKG9wdGlvbnMuem9uZSA9PSAnZWFzdCcgfHwgb3B0aW9ucy56b25lID09ICd3ZXN0JykgewoJCQlyZXQgPSAwLjI1ICogcmV0OyAvLyA5MCUgb2YgMy8xMCwgdGhlIHdpZHRoIG9mIHRoZSBub3JtYWwgZWxlbWVudAoJCX0gZWxzZSBpZiAob3B0aW9ucyAmJiBvcHRpb25zLmVkaXRvcikgewoJCQlyZXQgPSB3aW5kb3cuaW5uZXJXaWR0aDsKCQl9IGVsc2UgaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy53aWR0aCAmJiB0eXBlb2Yob3B0aW9ucy53aWR0aCkgPT09ICdzdHJpbmcnKSB7CgkJCXJldCA9IHRoaXMud2lkdGg7CgkJfSBlbHNlIGlmIChvcHRpb25zICYmIG9wdGlvbnMudHlwZSA9PSAnd2luZG93JyAmJiAhb3B0aW9ucy53aWR0aCkgewoJCQlyZXQgPSB0aGlzLndpZHRoICogMC45OwoJCX0KCgkJLy8gY29uc29sZS5sb2cob3B0aW9ucy5uYW1lICsgIjogY1dpZHRoID0gIiArIHJldCwgb3B0aW9ucy56b25lKTsKCQlyZXR1cm4gcmV0OwoJfQoKCXdpbmRvdyhvcHRpb25zKSB7CgkJb3B0aW9ucy50aXRsZSA9IG9wdGlvbnMudGl0bGUgfHwgb3B0aW9ucy5uYW1lOwoJCXZhciByZXQgPSBgCgkJPGRpdiBpZCA9ICJwbmwke29wdGlvbnMubmFtZX0iIGNsYXNzPSJlYXN5dWktd2luZG93IiB0aXRsZT0iJHtvcHRpb25zLnRpdGxlIHx8IHRoaXMuZW5nbGlzaChvcHRpb25zLm5hbWUpfSIgZGF0YS1vcHRpb25zPScke3RoaXMuZXZlbnRIYW5kbGVycyhvcHRpb25zKX0sIGNsb3NlZDokeyFvcHRpb25zLnZpc2libGV9LG1pbmltaXphYmxlOiR7IW9wdGlvbnMuZml4ZWR9LG1heGltaXphYmxlOiR7IW9wdGlvbnMuZml4ZWR9LGNsb3NhYmxlOiR7IW9wdGlvbnMuZml4ZWR9LGNvbGxhcHNpYmxlOiR7IW9wdGlvbnMuZml4ZWR9LGRyYWdnYWJsZTokeyFvcHRpb25zLmZpeGVkfSxyZXNpemFibGU6JHshb3B0aW9ucy5maXhlZH0saWNvbkNsczoiaWNvbi0ke29wdGlvbnMuaWNvbn0iLCB0b29sczoiIyR7b3B0aW9ucy5uYW1lfV90b29scyInIHN0eWxlPSJ3aWR0aDoke3RoaXMuY1dpZHRoKG9wdGlvbnMpfXB4O2hlaWdodDoke3RoaXMuY0hlaWdodChvcHRpb25zKX1weDtwYWRkaW5nOjEwcHg7Ij4KCQkgICAgPGRpdiBjbGFzcz0iZWFzeXVpLWxheW91dCIgZGF0YS1vcHRpb25zPSJmaXQ6dHJ1ZSI+CgkJYDsKCgkJbGV0IGJab25lID0gb3B0aW9ucy5zb3V0aCA/ICdzb3V0aCcgOiAodGhpcy56b25lcy5maW5kKHogPT4geiA9PSAnc291dGgnKSB8fCB0aGlzLnpvbmVzWzBdKTsKCQlvcHRpb25zW2Jab25lXSA9IG9wdGlvbnNbYlpvbmVdIHx8IFtdOwoJCWxldCB6V2lkdGggPSBNYXRoLm1pbigxMjAsIHRoaXMud2lkdGggKiAwLjk1IC8gKG9wdGlvbnMuYnV0dG9ucyA/IG9wdGlvbnMuYnV0dG9ucy5sZW5ndGggOiAxKSwgdGhpcy5jV2lkdGgob3B0aW9ucykpOwoJCW9wdGlvbnNbYlpvbmVdLnB1c2goYDxkaXYgaWQ9InBubCR7b3B0aW9ucy5uYW1lfS1idXR0b25zIiBkYXRhLW9wdGlvbnM9InJlZ2lvbjonJHtiWm9uZX0nLGJvcmRlcjpmYWxzZSIgc3R5bGU9InRleHQtYWxpZ246cmlnaHQ7cGFkZGluZzo1cHggMCAwOyI+YCArICQubWFwKCQuZ3JlcChvcHRpb25zLmJ1dHRvbnMgfHwgW10sIGIgPT4gIWIuaWdub3JlKSwgYiA9PiBgPGEgaWQ9JyR7Yi5uYW1lfScgaHJlZj0iamF2YXNjcmlwdDp2b2lkKDApIiBjbGFzcz0iZWFzeXVpLWxpbmtidXR0b24gYzYiIGljb25DbHM9Imljb24tJHtiLmljb24gfHwgJ3NhdmUnfSIgc3R5bGU9IndpZHRoOiR7eldpZHRofXB4IiBvbmNsaWNrPSdERm9ybS5kb0NsaWNrKCR7X0ZyRU1ELl90b0pTKGIpfSknPiR7Yi50aXRsZSB8fCBiLm5hbWV9PC9hPiZuYnNwOyZuYnNwO2ApLmpvaW4oJycpICsgYDwvZGl2PmApOwoKCQl0aGlzLnpvbmVzLmZpbHRlcih6ID0+IG9wdGlvbnNbel0pLmZvckVhY2goeiA9PiB7CgkJCXJldCArPSBgCgkJICAgICAgICA8ZGl2IGRhdGEtb3B0aW9ucz0icmVnaW9uOicke3p9JyIgdGl0bGU9IiR7KHo9PSd3ZXN0JyB8fCB6PT0nZWFzdCcpPycmbmJzcDsnOicnfSIgc3R5bGU9J2hlaWdodDokeyh6PT0nbm9ydGgnfHx6PT0nc291dGgnKT8xMDoxMDB9JTt3aWR0aDokeygoej09J2Vhc3QnfHx6PT0nd2VzdCcpPzAuMToxKSp0aGlzLmNXaWR0aChvcHRpb25zKX1weCc+CiAgICAgICAgCQkgICAgJHsoQXJyYXkuaXNBcnJheShvcHRpb25zW3pdKT9vcHRpb25zW3pdOltvcHRpb25zW3pdXSkuam9pbignJyl9CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgYDsKCQl9KTsKCgkJcmV0ICs9IGA8L2Rpdj48L2Rpdj5gOwoKCQkvLyBsaW5rcyAodG9vbHMpCgkJbGV0IGxpbmtzID0gJC5ncmVwKFtdLmNvbmNhdChvcHRpb25zLmxpbmtzIHx8IFtdKSwgbCA9PiAhbC5pZ25vcmUpOwoJCXJldCArPSBgPGRpdiBpZD0iJHtvcHRpb25zLm5hbWV9X3Rvb2xzIj5gICsgJC5tYXAobGlua3MucmV2ZXJzZSgpLCBsID0+IGA8YSBocmVmPSJqYXZhc2NyaXB0OnZvaWQoMCkiIHN0eWxlPSJjb2xvcjpibGFjayIgY2xhc3M9ImZhcyBmYS0ke2wuaWNvbiB8fCAnYWRkJ30iIG9uY2xpY2s9Jyhhc3luYyAoKSA9PiB7dmFyIGEgPSAke19GckVNRC5fdG9KUyhsKX07ICQoIiNwbmwke29wdGlvbnMubmFtZX0iKS53aW5kb3coInNldFRpdGxlIiwgIiR7b3B0aW9ucy50aXRsZX06ICIgKyBhLm5hbWUpOyBhd2FpdCBhLmFjdGlvbihERm9ybS5nZXQoKSwgYSwgJHtfRnJFTUQuX3RvSlMob3B0aW9ucyl9KTsgJCgiI3BubCR7b3B0aW9ucy5uYW1lfSIpLndpbmRvdygic2V0VGl0bGUiLCAiJHtvcHRpb25zLnRpdGxlfSIpO30pKCknPjwvYT5gKS5qb2luKCdcbicpICsgYDwvZGl2PmA7CgoJCXJldHVybiByZXQ7Cgl9CgoJYXN5bmMgX2VuZCgpIHsKCQlsZXQgbyA9IHRoaXMuZ2V0KCk7CgoJCS8vIGRvIG5vdCB1c2UgdGhlIGZpcnN0IGJ1dHRvbiwgYmVjYXVzZSBtYW55IGZvcm1zIGhhdmUgYSBDYW5jZWwgYnV0dG9uIG9ubHkKCQlsZXQgYnV0dG9uID0gdGhpcy5idXR0b25zLmZpbmQoYiA9PiBiLmF1dG9TdWJtaXQpIC8qIHx8IHRoaXMuYnV0dG9uc1swXSovIDsKCQlpZiAoYnV0dG9uICYmIG8gJiYgT2JqZWN0LnZhbHVlcyhvKS5sZW5ndGggJiYgKHR5cGVvZihidXR0b24uYXV0b1N1Ym1pdCkgPT09ICJ1bmRlZmluZWQiIHx8IGJ1dHRvbi5hdXRvU3VibWl0KSkgewoJCQlsZXQgdiA9IE9iamVjdC52YWx1ZXMobykucmVkdWNlKCh0LCB2KSA9PiB7CgkJCQlyZXR1cm4gKCh0eXBlb2YodikgIT09ICJvYmplY3QiKSA/IDEgOiAwKSAqICh2ID8gMSA6IDApOwoJCQl9KTsKCQkJLy9jb25zb2xlLmxvZyhvLCBPYmplY3QudmFsdWVzKG8pLCB2KTsKCQkJaWYgKHYpIHsKCQkJCS8vIGFsbCBmaWVsZHMgaGF2ZSB2YWx1ZXMKCQkJCWF3YWl0IHRoaXMuZG9DbGljayhidXR0b24pOwoKCQkJfQoJCX0KCX0KCglmb290ZXIoYkZpeGVkKSB7CgkJcmV0dXJuIGA8L2Zvcm0+YCArIGA8ZGl2IGlkPSJkbGctYnV0dG9ucyI+YCArIHRoaXMuYnV0dG9ucy5maWx0ZXIoYiA9PiAhYi53aW5kb3cpLm1hcChiID0+IGA8YSBpZD0nJHtiLm5hbWV9JyBocmVmPSJqYXZhc2NyaXB0OnZvaWQoMCkiIGNsYXNzPSJlYXN5dWktbGlua2J1dHRvbiBjNiIgaWNvbkNscz0iaWNvbi0ke2IuaWNvbiB8fCAnc2F2ZSd9IiBzdHlsZT0id2lkdGg6JHtNYXRoLm1pbigxMjAsIHRoaXMud2lkdGggKiAwLjk1IC8gdGhpcy5idXR0b25zLmxlbmd0aCwgdGhpcy5jV2lkdGgoKSl9cHgiIG9uY2xpY2s9J0RGb3JtLmRvQ2xpY2soJHtfRnJFTUQuX3RvSlMoYil9KSc+JHtiLnRpdGxlIHx8IGIubmFtZX08L2E+Jm5ic3A7Jm5ic3A7YCkuam9pbignJykgKyAiPC9kaXY+IiArIChiRml4ZWQgPyAiIiA6ICc8L2Rpdj4nKTsKCX0KCgloZWFkZXIobmFtZSwgdGl0bGUsIGJGaXhlZCwgbGlua3MpIHsKCQl0aGlzLnRpdGxlID0gdGl0bGUgfHwgdGhpcy50aXRsZTsKCQluYW1lID0gbmFtZSB8fCB0aGlzLm5hbWU7CgkJdmFyIHJldCA9ICcnOwoKCQlyZXQgKz0gdGhpcy53aW5kb3coewoJCQluYW1lOiAiX19Db25zb2xlIiwKCQkJdHlwZTogIndpbmRvdyIsCgkJCWVkaXRvcjogdHJ1ZSwKCQkJbG9hZGVyOiBvID0+IHdpbmRvdy5sb2dzLnNsaWNlKCkucmV2ZXJzZSgpLm1hcChsID0+IGwuZGF0ZS50b0lTT1N0cmluZygpICsgIjogIiArIGwuYXJncy5tYXAocyA9PiB0eXBlb2YocykgPT09ICdvYmplY3QnID8gKChvYmosIGluZGVudCA9IDIpID0+IHsKCQkJCWxldCBjYWNoZSA9IFtdOwoJCQkJY29uc3QgcmV0VmFsID0gSlNPTi5zdHJpbmdpZnkoCgkJCQkJb2JqLAoJCQkJCShrZXksIHZhbHVlKSA9PgoJCQkJCXR5cGVvZiB2YWx1ZSA9PT0gIm9iamVjdCIgJiYgdmFsdWUgIT09IG51bGwgPwoJCQkJCWNhY2hlLmluY2x1ZGVzKHZhbHVlKSA/CgkJCQkJdW5kZWZpbmVkIC8vIER1cGxpY2F0ZSByZWZlcmVuY2UgZm91bmQsIGRpc2NhcmQga2V5CgkJCQkJOgoJCQkJCWNhY2hlLnB1c2godmFsdWUpICYmIHZhbHVlIC8vIFN0b3JlIHZhbHVlIGluIG91ciBjb2xsZWN0aW9uCgkJCQkJOgoJCQkJCXZhbHVlLAoJCQkJCWluZGVudAoJCQkJKTsKCQkJCWNhY2hlID0gbnVsbDsKCQkJCXJldHVybiByZXRWYWw7CgkJCX0pKHMpIDogcykuam9pbignLCAnKSkuam9pbignXG4nKSwKCQl9KTsKCgkJaWYgKCFiRml4ZWQpIHsKCQkJbGlua3MgPSAobGlua3MgfHwgW10pLmZpbHRlcihsID0+ICFsLmlnbm9yZSk7CgkJCWxldCB0RGF0YSA9ICIiOwoJCQlpZiAobGlua3MubGVuZ3RoKSB7CgkJCQlyZXQgKz0gYDxkaXYgaWQ9IiR7dGhpcy5uYW1lfV90b29scyI+YCArIGxpbmtzLm1hcChsID0+IGA8YSBocmVmPSJqYXZhc2NyaXB0OnZvaWQoMCkiIGNsYXNzPSJpY29uLSR7bC5pY29ufSIgb25jbGljaz0nKGFzeW5jICgpID0+IHt2YXIgYSA9ICR7X0ZyRU1ELl90b0pTKGwpfTsgJCgiI3dpbiR7dGhpcy5uYW1lfSIpLndpbmRvdygic2V0VGl0bGUiLCAiJHt0aGlzLnRpdGxlfTogIiArIGEubmFtZSk7IGF3YWl0IGEuYWN0aW9uKERGb3JtLmdldCgpKTsgJCgiI3dpbiR7dGhpcy5uYW1lfSIpLndpbmRvdygic2V0VGl0bGUiLCAiJHt0aGlzLnRpdGxlfSIpO30pKCknPjwvYT5gKS5qb2luKCdcbicpICsgIjwvZGl2PiI7CgkJCQl0RGF0YSA9IGAsdG9vbHM6IiMke3RoaXMubmFtZX1fdG9vbHMiYDsKCQkJfQoJCQlyZXQgKz0gYDxkaXYgaWQ9J3dpbiR7dGhpcy5uYW1lfScgY2xhc3M9J2Vhc3l1aS13aW5kb3cnIHRpdGxlPScke3RoaXMudGl0bGUgfHwgdGhpcy5lbmdsaXNoKHRoaXMubmFtZSl9JyBkYXRhLW9wdGlvbnM9J2ljb25DbHM6Imljb24tc2F2ZSIgJHt0RGF0YX0nIHN0eWxlPSd3aWR0aDoke3RoaXMud2lkdGh9cHg7aGVpZ2h0OiR7dGhpcy5oZWlnaHR9cHg7cGFkZGluZzoxMHB4Oyc+YDsKCQl9CgkJcmV0dXJuIHJldCArIGA8Zm9ybSBpZD0iZnJtJHt0aGlzLm5hbWV9IiBtZXRob2Q9InBvc3QiIG5vdmFsaWRhdGU+YDsKCX0KCglyZW5kZXJFbGVtZW50cyhlbGVtZW50cykgewoJCWVsZW1lbnRzID0gZWxlbWVudHMgfHwgdGhpcy5lbGVtZW50czsKCgkJdmFyIHRXaWR0aCA9IE1hdGguZmxvb3IodGhpcy53aWR0aCAqIDAuOTUpOwoJCXZhciB0SGVpZ2h0ID0gTWF0aC5mbG9vcih0aGlzLmhlaWdodCAqIDAuODUpOwoKCQlsZXQgcmV0ID0gJyc7CgkJdmFyIGdFbGVtZW50cyA9IHRoaXMuc3IoKS5ncm91cEJ5KGVsZW1lbnRzLCAiZ3JvdXAiKTsKCQlpZiAoZ0VsZW1lbnRzLmxlbmd0aCA+IDEpIHJldCArPSBgPGRpdiBpZD0idGJjV2luZG93IiBjbGFzcz0iZWFzeXVpLXRhYnMiIGRhdGEtb3B0aW9ucz0nJHt0aGlzLmV2ZW50SGFuZGxlcnMoe3R5cGU6ICd0YWJzJ30pfScgc3R5bGU9IndpZHRoOiR7dFdpZHRofXB4O2hlaWdodDoke3RIZWlnaHR9cHg7Ij5gOwoJCWZvciAodmFyIGcgPSAwOyBnIDwgZ0VsZW1lbnRzLmxlbmd0aDsgZysrKSB7CgkJCWlmIChnRWxlbWVudHMubGVuZ3RoID4gMSkgcmV0ICs9ICc8ZGl2IHRpdGxlPSInICsgKGdFbGVtZW50c1tnXS5rZXkgfHwgIk1haW4iKSArICciIHN0eWxlPSJwYWRkaW5nOjIwcHg7ZGlzcGxheTpub25lOyI+JzsKCQkJdmFyIHNFbGVtZW50cyA9IHRoaXMuc3IoKS5ncm91cEJ5KGdFbGVtZW50c1tnXS52YWx1ZXMsICJzZWN0aW9uIik7CgkJCWlmIChzRWxlbWVudHMubGVuZ3RoID4gMSkgcmV0ICs9ICc8ZGl2IGNsYXNzPSJlYXN5dWktYWNjb3JkaW9uIiBzdHlsZT0id2lkdGg6JyArIHRXaWR0aCArICdweDtoZWlnaHQ6JyArIC8qdEhlaWdodCovICIxMDAlIiArICdweDsiPic7CgkJCWZvciAodmFyIHMgPSAwOyBzIDwgc0VsZW1lbnRzLmxlbmd0aDsgcysrKSB7CgkJCQlyZXQgKz0gYDxkaXYgdGl0bGU9IiR7c0VsZW1lbnRzW3NdLmtleSB8fCAiIn0iIGRhdGEtb3B0aW9ucz0iaWNvbkNsczonaWNvbi1tb3JlJyIgc3R5bGU9InBhZGRpbmc6MTBweDsiPmA7CgkJCQlmb3IgKHZhciBpID0gMDsgaSA8IHNFbGVtZW50c1tzXS52YWx1ZXMubGVuZ3RoOyBpKyspIHsKCQkJCQl2YXIgZSA9IHNFbGVtZW50c1tzXS52YWx1ZXNbaV07CgkJCQkJaWYgKGUuaWdub3JlKSBjb250aW51ZTsKCQkJCQllLnZhbHVlID0gZS52YWx1ZSB8fCBfRnJFTUQuaGFzaFtlLm5hbWVdIHx8IChfRnJFTUQuYXBpU2VydmVyID8gX0ZyRU1ELmFwaVNlcnZlci5fX2NvbmZpZygndGVzdF8nICsgZS5uYW1lLCAnJykgOiAnJyk7CgkJCQkJcmV0ICs9IGA8ZGl2IGlkPSJmRWxlbWVudF8ke2UubmFtZX0iIGNsYXNzPSJmaXRlbSIgc3R5bGU9ImRpc3BsYXk6ICR7KGUudHlwZT09J3dpbmRvdycgfHwgZS5oaWRkZW4pPydub25lJzonJ30iPmA7CgkJCQkJaWYgKGUudG9nZ2xlKSB7CgkJCQkJCXJldCArPSBgPGEgaHJlZj0iIyIgY2xhc3M9ImVhc3l1aS1saW5rYnV0dG9uIiBkYXRhLW9wdGlvbnM9JyR7dGhpcy5ldmVudEhhbmRsZXJzKHt0eXBlOiAndG9nZ2xlJywgZm9yOiBlfSl9LHBsYWluOnRydWUsaWNvbkNsczoiaWNvbi0ke2UuaWNvbiB8fCAnc2VhcmNoJ30iJyBzdHlsZT0id2lkdGg6MTAwcHg7aGVpZ2h0OjMwcHgiPiR7ZS50aXRsZSB8fCB0aGlzLmVuZ2xpc2goZS5uYW1lKX08L2E+YDsKCQkJCQl9IGVsc2UgewoJCQkJCQlyZXQgKz0gYDxsYWJlbD4ke2UudGl0bGUgfHwgdGhpcy5lbmdsaXNoKGUubmFtZSl9OjwvbGFiZWw+YDsKCQkJCQl9CgkJCQkJaWYgKGUudHlwZSAmJiB0aGlzW2UudHlwZV0pIHsKCQkJCQkJcmV0ICs9IHRoaXNbZS50eXBlXShlKTsKCQkJCQl9IGVsc2UgaWYgKGUucmVuZGVyKSB7CgkJCQkJCXJldCArPSBlLnJlbmRlcigpOwoJCQkJCX0KCQkJCQlyZXQgKz0gJzwvZGl2Pic7CgkJCQl9CgkJCQlyZXQgKz0gJzwvZGl2Pic7CgkJCX0KCQkJaWYgKHNFbGVtZW50cy5sZW5ndGggPiAxKSByZXQgKz0gJzwvZGl2Pic7CgkJCWlmIChnRWxlbWVudHMubGVuZ3RoID4gMSkgcmV0ICs9ICI8L2Rpdj4iOwoJCX0KCQlpZiAoZ0VsZW1lbnRzLmxlbmd0aCA+IDEpIHJldCArPSAiPC9kaXY+IjsKCQlyZXR1cm4gcmV0OwoJfQoKCWluZm8obXNnKSB7CgkJaWYgKCQubWVzc2FnZXIpIHsKCQkJJC5tZXNzYWdlci5hbGVydCh0aGlzLnRpdGxlLCBtc2csICdpbmZvJyk7CgkJfSBlbHNlIHsKCQkJdGhpcy5zcigpLlNob3dNZXNzYWdlKG1zZywgdGhpcy50aXRsZSk7CgkJfQoJfQoKCWVycm9yKG1zZykgewoJCWlmICgkLm1lc3NhZ2VyKSB7CgkJCSQubWVzc2FnZXIuYWxlcnQodGhpcy50aXRsZSwgbXNnLCAnZXJyb3InKTsKCQl9IGVsc2UgewoJCQl0aGlzLnNyKCkuU2hvd01lc3NhZ2UobXNnLCB0aGlzLnRpdGxlKTsKCQl9Cgl9CgoJYnlOYW1lKG5hbWUpIHsKCQlyZXR1cm4gdGhpcy5lbGVtZW50cy5maW5kKGUgPT4gZS5uYW1lID09PSBuYW1lKTsKCX0KCgkvKiogQ29tcG9uZW50czo6U3RhcnQgKiovCglDb3JlQ29tcG9uZW50ID0gY2xhc3MgewoJCWNvbnN0cnVjdG9yKHBhZ2UsIGRGb3JtKSB7CgkJCXRoaXMucGFnZSA9IHBhZ2U7CgkJCXRoaXMuZEZvcm0gPSBkRm9ybTsKCQl9CgoJCWJ1c3koYkJ1c3kpIHsKCQkJcmV0dXJuIHRoaXMuZEZvcm0uYnVzeShiQnVzeSk7CgkJfQoKCQlfbWUodikgewoJCQlsZXQgbWVOYW1lID0gKHR5cGVvZihjb21wYW55KSAhPT0gJ3VuZGVmaW5lZCcpID8gKGNvbXBhbnkubG9nZ2VkSW5JZGVudGl0eSB8fCAibWUiKSA6ICJtZSI7CgkJCWlmICh2KSB7CgkJCQl3aW5kb3dbbWVOYW1lXSA9IHY7CgkJCX0KCgkJCXJldHVybiB3aW5kb3dbbWVOYW1lXTsKCQl9CgoJCV9jYW5WaWV3KCkgewoJCQlpZiAoIXRoaXMuX21lKCkpIHsKCQkJCXdpbmRvdy5fRnJFTUQuc2V0VVJMKHsKCQkJCQlwYWdlOiAnbG9naW4nLAoJCQkJCV9yZWRpcmVjdDogdGhpcy5wYWdlLl9jb2RlLAoJCQkJfSk7CgkJCQl0aHJvdyBgX2NhblZpZXc6ICR7dGhpcy5wYWdlLl9jb2RlfSBub3QgYWxsb3dlZCB3aXRob3V0IGxvZ2luIWA7CgkJCX0KCQl9CgoJCV9uYW1lKCkgewoJCQlpZiAoIXRoaXMuX21lKCkpIHJldHVybiAiIjsKCQkJcmV0dXJuIHRoaXMuX21lKCkubmFtZSA/IHRoaXMuX21lKCkubmFtZSgpIDogdGhpcy5fbWUoKS5Ub1N0cmluZzsKCQl9Cgl9CgoJSW5kZXhDb21wb25lbnQgPSBjbGFzcyBleHRlbmRzIHRoaXMuQ29yZUNvbXBvbmVudCB7CgkJYXN5bmMgbWFpbigpIHsKCQkJdGhpcy5fY2FuVmlldygpOwoKCQkJdGhpcy5wYWdlLmRhdGEgPSB7CgkJCQlmb3JtOiB0aGlzLmRGb3JtLnJlbmRlcignZnJtSW5kZXgnLCAiTWFpbiBQYWdlIiwgW3sKCQkJCQluYW1lOiAnV2VsY29tZScsCgkJCQkJcmVxdWlyZWQ6IHRydWUsCgkJCQkJdHlwZTogImxhYmVsIiwKCQkJCQl2YWx1ZTogdGhpcy5fbmFtZSgpLAoJCQkJfV0sIFtdKQoJCQl9OwoJCX0KCX0KCglMb2dpbkNvbXBvbmVudCA9IGNsYXNzIGV4dGVuZHMgdGhpcy5Db3JlQ29tcG9uZW50IHsKCQlhc3luYyBfYXV0aGVudGljYXRlKG8pIHsKCQkJcmV0dXJuIG51bGw7CgkJfQoKCQlhc3luYyBfbG9nZ2VkSW4oKSB7fQoKCQlhc3luYyBfbm90TG9nZ2VkSW4oKSB7fQoKCQlhc3luYyBtYWluKCkgewoJCQl0aGlzLnBhZ2UuZGF0YSA9IHsKCQkJCWZvcm06IHRoaXMuZEZvcm0ucmVuZGVyKCdmcm1Mb2dpbicsICJVc2VyIEF1dGhlbnRpY2F0aW9uIiwgW3sKCQkJCQkJbmFtZTogJ1VzZXJuYW1lJywKCQkJCQkJcmVxdWlyZWQ6IHRydWUsCgkJCQkJCXR5cGU6ICJzdHJpbmciCgkJCQkJfSwKCQkJCQl7CgkJCQkJCW5hbWU6ICdQYXNzd29yZCcsCgkJCQkJCXJlcXVpcmVkOiB0cnVlLAoJCQkJCQl0eXBlOiAicGFzc3dvcmQiCgkJCQkJfQoJCQkJXSwgW3sKCQkJCQluYW1lOiAnTG9naW4nLAoJCQkJCWF1dG9TdWJtaXQ6IHRydWUsCgkJCQkJb25jbGljazogYXN5bmMgbyA9PiB7CgkJCQkJCWxldCByZXQgPSBhd2FpdCB0aGlzLl9hdXRoZW50aWNhdGUobyk7CgoJCQkJCQlpZiAocmV0KSB7CgkJCQkJCQl0aGlzLl9tZShyZXQpOwoKCQkJCQkJCXRyeSB7CgkJCQkJCQkJYXdhaXQgdGhpcy5fbG9nZ2VkSW4oKTsKCQkJCQkJCX0gY2F0Y2ggKGV4KSB7fQoKCQkJCQkJCV9GckVNRC5zZXRVUkwoewoJCQkJCQkJCXBhZ2U6IF9GckVNRC5oYXNoLl9yZWRpcmVjdCB8fCAiaW5kZXgiCgkJCQkJCQl9KTsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCXRyeSB7CgkJCQkJCQkJYXdhaXQgdGhpcy5fbm90TG9nZ2VkSW4oKTsKCQkJCQkJCX0gY2F0Y2ggKGV4KSB7fQoKCQkJCQkJCXRoaXMuZEZvcm0uZXJyb3IoIkludmFsaWQgdXNlcm5hbWUgb3IgcGFzc3dvcmQiKTsKCQkJCQkJfQoKCQkJCQkJdGhpcy5kRm9ybS5idXN5KGZhbHNlKTsKCQkJCQl9CgkJCQl9XSkKCQkJfTsKCQl9Cgl9CgoJU3RvcmVDb21wb25lbnQgPSBjbGFzcyBleHRlbmRzIHRoaXMuQ29yZUNvbXBvbmVudCB7CgkJYXN5bmMgbWFpbigpIHt9Cgl9CgkvKiogQ29tcG9uZW50czo6RW5kICoqLwp9Ow==",
	"storedMethod": null,
	"__keys": ["name"],
	"active": true,
	"enabled": true,
	"__trMap": []
}