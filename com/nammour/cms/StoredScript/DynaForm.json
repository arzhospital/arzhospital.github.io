{
	"Id": "4e672df0491cd0d0d45996442bdea4abfb9e2ab1",
	"name": "DynaForm",
	"script": "d2luZG93LkR5bmFGb3JtID0gY2xhc3MgewoJY29uc3RydWN0b3IoKSB7CgkJdGhpcy50aXRsZSA9ICJGb3JtIFRpdGxlIjsKCQl0aGlzLm5hbWUgPSAiZnJtRm9ybSI7CgkJdGhpcy5lbGVtZW50cyA9IFtdOwoJCXRoaXMuc2VsZWN0cyA9IFtdOwoJCXRoaXMuZ3JpZHMgPSBbXTsKCQl0aGlzLmJ1dHRvbnMgPSBbXTsKCQl0aGlzLnpvbmVzID0gWydub3J0aCcsICdzb3V0aCcsICdlYXN0JywgJ3dlc3QnLCAnY2VudGVyJ107CgkJdGhpcy5zVGFibGUgPSBudWxsOwoJCXRoaXMuYkRlYnVnID0gZmFsc2U7CgkJdGhpcy51aVR5cGVzID0gewoJCQlpbnQ6ICJudW1iZXJzcGlubmVyIiwKCQkJbWVudTogInNwbGl0YnV0dG9uIiwKCQkJZGF0ZXRpbWU6ICJkYXRldGltZWJveCIsCgkJCWJvb2w6ICJzd2l0Y2hidXR0b24iLAoJCQlmaWxlOiAiZmlsZWJveCIsCgkJCXRleHQ6ICJ0ZXh0Ym94IiwKCQkJcGFzc3dvcmQ6ICJwYXNzd29yZGJveCIsCgkJCXN0cmluZzogInRleHRib3giLAoJCQlpbWFnZTogImRpYWxvZyIsCgkJCXByb2dyZXNzOiAicHJvZ3Jlc3NiYXIiLAoJCQlsaW5rOiAibGlua2J1dHRvbiIsCgkJCXRyZWU6ICJjb21ib3RyZWUiLAoJCQluYXZpZ2F0aW9uOiAidHJlZSIsCgkJCXNlYXJjaDogJ3NlYXJjaGJveCcsCgkJfTsKCQl0aGlzLmV2ZW50cyA9IFt7CgkJCW5hbWU6ICdvbkNsaWNrJywKCQkJaGFuZGxlcjogJ29uVG9nZ2xlJywKCQkJcGFyYW1zOiAnbj1ldmVudCcsCgkJCXR5cGU6ICd0b2dnbGUnLAoJCX0sIHsKCQkJbmFtZTogJ29uQ2xvc2UnLAoJCQloYW5kbGVyOiAnUGFuT25DbG9zZScsCgkJCXBhcmFtczogJ249ZXZlbnQnLAoJCQl0eXBlOiAnd2luZG93JywKCQl9LCB7CgkJCW5hbWU6ICdvblNlbGVjdCcsCgkJCWhhbmRsZXI6ICdTZWxlY3RDaGFuZ2UnLAoJCQlwYXJhbXM6ICduJywKCQkJdHlwZTogJ3RhYnMnLAoJCX0sIHsKCQkJbmFtZTogJ3NlYXJjaGVyJywKCQkJaGFuZGxlcjogJ0ZpZWxkQ2hhbmdlJywKCQkJcGFyYW1zOiAnbiwgbycsCgkJCXR5cGU6ICdzZWFyY2hib3gnLAoJCX0sIHsKCQkJbmFtZTogJ29uQmVmb3JlRXhwYW5kJywKCQkJaGFuZGxlcjogJ0V4cGFuZCcsCgkJCXBhcmFtczogJ24nLAoJCQl0eXBlOiAndHJlZScsCgkJfSwgewoJCQluYW1lOiAnb25DaGFuZ2UnLAoJCQloYW5kbGVyOiAnRmllbGRDaGFuZ2UnLAoJCQlwYXJhbXM6ICduLCBvJwoJCX0sIHsKCQkJbmFtZTogJ29uQmVmb3JlT3BlbicsCgkJCWhhbmRsZXI6ICdQYW5lbE9wZW4nLAoJCQlwYXJhbXM6ICcnLAoJCQl0eXBlOiAnd2luZG93JywKCQl9LCB7CgkJCW5hbWU6ICdvbk9wZW4nLAoJCQloYW5kbGVyOiAnUGVuZEFmdGVyT3BlbicsCgkJCXBhcmFtczogJycsCgkJCXR5cGU6ICd3aW5kb3cnLAoJCX0sIHsKCQkJbmFtZTogJ29uQ2xpY2snLAoJCQloYW5kbGVyOiAnZG9MaW5rJywKCQkJcGFyYW1zOiAnbj1ldmVudCwgbycsCgkJCXR5cGU6ICdsaW5rJywKCQl9LCB7CgkJCW5hbWU6ICdvbkNsaWNrUm93JywKCQkJaGFuZGxlcjogJ0ZpZWxkQ2hhbmdlJywKCQkJcGFyYW1zOiAnbiwgbycsCgkJCXR5cGU6ICdncmlkJywKCQl9XTsKCgkJaWYgKHR5cGVvZigkKSAhPT0gJ3VuZGVmaW5lZCcpICQod2luZG93KS5yZXNpemUodGhpcy53aW5kb3dSZXNpemVkKTsKCQl0aGlzLndpbmRvd1Jlc2l6ZWQoKTsKCX0KCglzcigpIHsKCQlyZXR1cm4gdHlwZW9mKF9GckVNRCkgIT09ICd1bmRlZmluZWQnID8gX0ZyRU1ELnNyKCkgOiB3aW5kb3cuc3I7Cgl9CgoJcGFyc2UoKSB7CgkJJC5wYXJzZXIucGFyc2UoKTsKCX0KCgl3aW5kb3dSZXNpemVkKCkgewoJCXRoaXMud2lkdGggPSB3aW5kb3cuaW5uZXJXaWR0aDsKCQl0aGlzLmhlaWdodCA9IHdpbmRvdy5pbm5lckhlaWdodCAqIDAuODsKCX0KCgkvKiogQ29tcG9uZW50czo6U3RhcnQgKiovCglDb3JlQ29tcG9uZW50ID0gY2xhc3MgewoJCWNvbnN0cnVjdG9yKHBhZ2UpIHsKCQkJdGhpcy5wYWdlID0gcGFnZTsKCQl9CgoJCV9tZSh2KSB7CgkJCWxldCBtZU5hbWUgPSAodHlwZW9mKGNvbXBhbnkpICE9PSAndW5kZWZpbmVkJykgPyAoY29tcGFueS5sb2dnZWRJbklkZW50aXR5IHx8ICJtZSIpIDogIm1lIjsKCQkJaWYgKHYpIHsKCQkJCXdpbmRvd1ttZU5hbWVdID0gdjsKCQkJfQoKCQkJcmV0dXJuIHdpbmRvd1ttZU5hbWVdOwoJCX0KCgkJX2NhblZpZXcoKSB7CgkJCWlmICghdGhpcy5fbWUoKSkgewoJCQkJd2luZG93Ll9GckVNRC5zZXRVUkwoewoJCQkJCXBhZ2U6ICdsb2dpbicsCgkJCQkJX3JlZGlyZWN0OiB0aGlzLnBhZ2UuX2NvZGUsCgkJCQl9KTsKCQkJCXRocm93IGBfY2FuVmlldzogJHt0aGlzLnBhZ2UuX2NvZGV9IG5vdCBhbGxvd2VkIHdpdGhvdXQgbG9naW4hYDsKCQkJfQoJCX0KCgkJX25hbWUoKSB7CgkJCWlmICghdGhpcy5fbWUoKSkgcmV0dXJuICIiOwoJCQlyZXR1cm4gdGhpcy5fbWUoKS5uYW1lID8gdGhpcy5fbWUoKS5uYW1lKCkgOiB0aGlzLl9tZSgpLlRvU3RyaW5nOwoJCX0KCX0KCglJbmRleENvbXBvbmVudCA9IGNsYXNzIGV4dGVuZHMgdGhpcy5Db3JlQ29tcG9uZW50IHsKCQlhc3luYyBtYWluKCkgewoJCQl0aGlzLl9jYW5WaWV3KCk7CgoJCQl0aGlzLnBhZ2UuZGF0YSA9IHsKCQkJCWZvcm06IHdpbmRvdy5ERm9ybS5yZW5kZXIoJ2ZybUluZGV4JywgIk1haW4gUGFnZSIsIFt7CgkJCQkJbmFtZTogJ1dlbGNvbWUnLAoJCQkJCXJlcXVpcmVkOiB0cnVlLAoJCQkJCXR5cGU6ICJsYWJlbCIsCgkJCQkJdmFsdWU6IHRoaXMuX25hbWUoKSwKCQkJCX1dLCBbXSkKCQkJfTsKCQl9Cgl9CgoJTG9naW5Db21wb25lbnQgPSBjbGFzcyBleHRlbmRzIHRoaXMuQ29yZUNvbXBvbmVudCB7CgkJYXN5bmMgX2F1dGhlbnRpY2F0ZShvKSB7CgkJCXJldHVybiBudWxsOwoJCX0KCgkJYXN5bmMgX2xvZ2dlZEluKCkge30KCgkJYXN5bmMgX25vdExvZ2dlZEluKCkge30KCgkJYXN5bmMgbWFpbigpIHsKCQkJdGhpcy5wYWdlLmRhdGEgPSB7CgkJCQlmb3JtOiB3aW5kb3cuREZvcm0ucmVuZGVyKCdmcm1Mb2dpbicsICJVc2VyIEF1dGhlbnRpY2F0aW9uIiwgW3sKCQkJCQkJbmFtZTogJ1VzZXJuYW1lJywKCQkJCQkJcmVxdWlyZWQ6IHRydWUsCgkJCQkJCXR5cGU6ICJzdHJpbmciCgkJCQkJfSwKCQkJCQl7CgkJCQkJCW5hbWU6ICdQYXNzd29yZCcsCgkJCQkJCXJlcXVpcmVkOiB0cnVlLAoJCQkJCQl0eXBlOiAicGFzc3dvcmQiCgkJCQkJfQoJCQkJXSwgW3sKCQkJCQluYW1lOiAnTG9naW4nLAoJCQkJCWF1dG9TdWJtaXQ6IHRydWUsCgkJCQkJb25jbGljazogYXN5bmMgbyA9PiB7CgkJCQkJCWxldCByZXQgPSBhd2FpdCB0aGlzLl9hdXRoZW50aWNhdGUobyk7CgoJCQkJCQlpZiAocmV0KSB7CgkJCQkJCQl0aGlzLl9tZShyZXQpOwoKCQkJCQkJCXRyeSB7CgkJCQkJCQkJYXdhaXQgdGhpcy5fbG9nZ2VkSW4oKTsKCQkJCQkJCX0gY2F0Y2ggKGV4KSB7fQoKCQkJCQkJCV9GckVNRC5zZXRVUkwoewoJCQkJCQkJCXBhZ2U6IF9GckVNRC5oYXNoLl9yZWRpcmVjdCB8fCAiaW5kZXgiCgkJCQkJCQl9KTsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCXRyeSB7CgkJCQkJCQkJYXdhaXQgdGhpcy5fbm90TG9nZ2VkSW4oKTsKCQkJCQkJCX0gY2F0Y2ggKGV4KSB7fQoKCQkJCQkJCXdpbmRvdy5ERm9ybS5lcnJvcigiSW52YWxpZCB1c2VybmFtZSBvciBwYXNzd29yZCIpOwoJCQkJCQl9CgoJCQkJCQl3aW5kb3cuREZvcm0uYnVzeShmYWxzZSk7CgkJCQkJfQoJCQkJfV0pCgkJCX0KCQl9Cgl9CgoJU3RvcmVDb21wb25lbnQgPSBjbGFzcyBleHRlbmRzIHRoaXMuQ29yZUNvbXBvbmVudCB7CgkJYXN5bmMgbWFpbigpIHsKCQkJdGhpcy5fY2FuVmlldygpOwoKCQkJY29uc29sZS5sb2coIkdlbmVyYXRpbmcgQ1JVRCBwYWdlIGZvcjogIiwgdGhpcy5wYWdlKTsKCgkJCXRoaXMucGFnZS5kYXRhID0gYXdhaXQgd2luZG93LkRGb3JtLkNSVUQodGhpcy5wYWdlLmRhdGEpOwoJCX0KCX0KCS8qKiBDb21wb25lbnRzOjpFbmQgKiovCgoJaW5pdCgpIHsKCQl2YXIgc2VsZWN0ID0gewoJCQlpbml0OiBmdW5jdGlvbihjb250YWluZXIsIG9wdGlvbnMpIHsKCQkJCXZhciBvcCA9IG51bGw7CgkJCQl2YXIgZm9wID0gbnVsbDsKCQkJCWZvciAodmFyIGkgPSAwOyBpIDwgd2luZG93LkRGb3JtLmdyaWRzLmxlbmd0aDsgaSsrKQoJCQkJCWlmICh3aW5kb3cuREZvcm0uZ3JpZHNbaV0uaWQgPT0gb3B0aW9ucy5zb3VyY2UpIG9wID0gd2luZG93LkRGb3JtLmdyaWRzW2ldLm9wdGlvbnM7CgkJCQlmb3IgKGkgPSAwOyBpIDwgb3AuY29sdW1ucy5sZW5ndGg7IGkrKykKCQkJCQlpZiAob3AuY29sdW1uc1tpXS5uYW1lID09IG9wdGlvbnMuZmllbGQpIGZvcCA9IG9wLmNvbHVtbnNbaV07CgkJCQlmb3Aud2lkdGggPSAod2luZG93LkRGb3JtLndpZHRoIC8gMyk7CgkJCQl2YXIgZSA9ICQod2luZG93LkRGb3JtLnNlbGVjdChmb3ApKTsKCQkJCXZhciBpbnB1dCA9IGUuYXBwZW5kVG8oY29udGFpbmVyKTsKCQkJCWlucHV0LmNvbWJvZ3JpZCgpOwoJCQkJd2luZG93LkRGb3JtLmJpbmQoaW5wdXQpOwoJCQkJcmV0dXJuIGlucHV0OwoJCQl9LAoJCQlkZXN0cm95OiBmdW5jdGlvbih0YXJnZXQpIHsKCQkJCSQodGFyZ2V0KS5yZW1vdmUoKTsKCQkJfSwKCQkJZ2V0VmFsdWU6IGZ1bmN0aW9uKHRhcmdldCkgewoJCQkJcmV0dXJuICQodGFyZ2V0KS52YWwoKTsKCQkJfSwKCQkJc2V0VmFsdWU6IGZ1bmN0aW9uKHRhcmdldCwgdmFsdWUpIHsKCQkJCSQodGFyZ2V0KS52YWwodmFsdWUpOwoJCQl9LAoJCQlyZXNpemU6IGZ1bmN0aW9uKHRhcmdldCwgd2lkdGgpIHsKCQkJCSQodGFyZ2V0KS5fb3V0ZXJXaWR0aCh3aWR0aCk7CgkJCX0KCQl9OwoJCSQuZXh0ZW5kKCQuZm4uZGF0YWdyaWQuZGVmYXVsdHMuZWRpdG9ycywgewoJCQlkYXRldGltZTogewoJCQkJaW5pdDogZnVuY3Rpb24oY29udGFpbmVyLCBvcHRpb25zKSB7CgkJCQkJb3B0aW9ucy53aWR0aCA9IHdpbmRvdy5ERm9ybS5jV2lkdGgob3B0aW9ucyk7CgkJCQkJdmFyIGlucHV0ID0gJCh3aW5kb3cuREZvcm0uZGF0ZXRpbWUob3B0aW9ucykpLmFwcGVuZFRvKGNvbnRhaW5lcik7CgkJCQkJaW5wdXQuZGF0ZXRpbWVib3goKTsKCQkJCQlyZXR1cm4gaW5wdXQ7CgkJCQl9LAoJCQkJZGVzdHJveTogZnVuY3Rpb24odGFyZ2V0KSB7CgkJCQkJJCh0YXJnZXQpLnJlbW92ZSgpOwoJCQkJfSwKCQkJCWdldFZhbHVlOiBmdW5jdGlvbih0YXJnZXQpIHsKCQkJCQlyZXR1cm4gJCh0YXJnZXQpLnZhbCgpOwoJCQkJfSwKCQkJCXNldFZhbHVlOiBmdW5jdGlvbih0YXJnZXQsIHZhbHVlKSB7CgkJCQkJJCh0YXJnZXQpLnZhbCh2YWx1ZSk7CgkJCQl9LAoJCQkJcmVzaXplOiBmdW5jdGlvbih0YXJnZXQsIHdpZHRoKSB7CgkJCQkJJCh0YXJnZXQpLl9vdXRlcldpZHRoKHdpZHRoKTsKCQkJCX0KCQkJfSwKCQkJY2hlY2tib3g6IHsKCQkJCWluaXQ6IGZ1bmN0aW9uKGNvbnRhaW5lciwgb3B0aW9ucykgewoJCQkJCXZhciBpbnB1dCA9ICQod2luZG93LkRGb3JtLmJvb2wob3B0aW9ucykpLmFwcGVuZFRvKGNvbnRhaW5lcik7CgkJCQkJaW5wdXQuc3dpdGNoYnV0dG9uKCk7CgkJCQkJcmV0dXJuIGlucHV0OwoJCQkJfSwKCQkJCWRlc3Ryb3k6IGZ1bmN0aW9uKHRhcmdldCkgewoJCQkJCSQodGFyZ2V0KS5yZW1vdmUoKTsKCQkJCX0sCgkJCQlnZXRWYWx1ZTogZnVuY3Rpb24odGFyZ2V0KSB7CgkJCQkJcmV0dXJuICQodGFyZ2V0KS52YWwoKTsKCQkJCX0sCgkJCQlzZXRWYWx1ZTogZnVuY3Rpb24odGFyZ2V0LCB2YWx1ZSkgewoJCQkJCSQodGFyZ2V0KS52YWwodmFsdWUpOwoJCQkJfSwKCQkJCXJlc2l6ZTogZnVuY3Rpb24odGFyZ2V0LCB3aWR0aCkgewoJCQkJCSQodGFyZ2V0KS5fb3V0ZXJXaWR0aCh3aWR0aCk7CgkJCQl9CgkJCX0sCgkJCWNvbWJvdHJlZWdyaWQ6IHNlbGVjdCwKCQkJc2VsZWN0OiBzZWxlY3QsCgkJfSk7Cgl9CgoJYXNrKHF1ZXN0aW9uLCBmQW5zd2VyID0gdiA9PiB2LCBvcHRpb25zKSB7CgkJJC5tZXNzYWdlci5jb25maXJtKHRoaXMudGl0bGUsIHF1ZXN0aW9uLCBmdW5jdGlvbihyKSB7CgkJCWlmIChvcHRpb25zKSB7CgkJCQlmb3IgKHZhciBpID0gMDsgaSA8IG9wdGlvbnMubGVuZ3RoOyBpKyspIHsKCQkJCQlpZiAob3B0aW9uc1tpXS5hbnN3ZXIgPT0gcikgewoJCQkJCQlyZXR1cm4gZkFuc3dlcihvcHRpb25zW2ldLnZhbHVlKTsKCQkJCQl9CgkJCQl9CgkJCX0gZWxzZSB7CgkJCQlyZXR1cm4gZkFuc3dlcihyKTsKCQkJfQoJCX0pOwoJfQoKCXRvcERhdGEoYXIsIGdGaWVsZCwgdkZpZWxkLCB0b3ApIHsKCQlpZiAoIXRvcCkgewoJCQlyZXR1cm4gYXI7CgkJfQoJCXJldCA9IFtdOwoJCSQuZWFjaCh0aGlzLnNyKCkuZ3JvdXBCeShhciwgZ0ZpZWxkKSwgZnVuY3Rpb24oa2V5LCB2YWx1ZXMpIHsKCQkJdmFsdWVzLnZhbHVlcy5zb3J0KChhLCBiKSA9PiB7CgkJCQlpZiAocGFyc2VGbG9hdChhW3ZGaWVsZF0pIDwgcGFyc2VGbG9hdChiW3ZGaWVsZF0pKSB7CgkJCQkJcmV0dXJuIDE7CgkJCQl9IGVsc2UgaWYgKHBhcnNlRmxvYXQoYVt2RmllbGRdKSA+IHBhcnNlRmxvYXQoYlt2RmllbGRdKSkgewoJCQkJCXJldHVybiAtMTsKCQkJCX0gZWxzZSB7CgkJCQkJcmV0dXJuIDA7CgkJCQl9CgkJCX0pOwoJCQkkLmVhY2godmFsdWVzLnZhbHVlcywgZnVuY3Rpb24oaSwgdikgewoJCQkJaWYgKGkgPCB0b3ApIHsKCQkJCQlyZXQucHVzaCh2KTsKCQkJCX0KCQkJfSk7CgkJfSk7CgkJcmV0dXJuIHJldDsKCX0KCglhc3luYyBDUlVEKHNUYWJsZSwgYkZpeGVkKSB7CgkJdmFyIGZpZWxkcyA9IFtdOwoJCXdpbmRvdy5ERm9ybS5zVGFibGUgPSBzVGFibGU7CgkJaWYgKGNvbXBhbnkubGlicmFyeSkgewoJCQl2YXIgcmV0ID0gYXdhaXQgdGhpcy5zcigpLl8oIkNvbnRlbnRNYW5hZ2VyLmNtc0dlbmVyYXRlTGF5ZXJDbGFzcyIsIG51bGwsIGNvbXBhbnkubGlicmFyeSArICIuIiArIHNUYWJsZSk7CgkJCWZpZWxkcy5wdXNoKHsKCQkJCWdyb3VwOiAiTWFpbiIsCgkJCQlhdHRyaWJ1dGU6IHsKCQkJCQlSZWxhdGlvbkNsYXNzOiB7CgkJCQkJCU5hbWU6IHNUYWJsZQoJCQkJCX0KCQkJCX0sCgkJCQluYW1lOiB3aW5kb3cuREZvcm0uc1RhYmxlLAoJCQkJdHlwZTogJ3NlbGVjdCcsCgkJCQlzZWxlY3Q6IGZ1bmN0aW9uKG8pIHsKCQkJCQl3aW5kb3cuREZvcm0uc2V0KG8pOwoJCQkJfQoJCQl9KTsKCQkJZm9yICh2YXIgaSA9IDA7IGkgPCByZXQuTGF5ZXJBdHRyaWJ1dGVzLmxlbmd0aDsgaSsrKSB7CgkJCQlpZiAocmV0LkxheWVyQXR0cmlidXRlc1tpXS5OYW1lID09ICJJZCIpIGNvbnRpbnVlOwoJCQkJZmllbGRzLnB1c2goewoJCQkJCWdyb3VwOiAiTWFpbiIsCgkJCQkJbmFtZTogcmV0LkxheWVyQXR0cmlidXRlc1tpXS5OYW1lLAoJCQkJCXR5cGU6IHJldC5MYXllckF0dHJpYnV0ZXNbaV0uTmF0aXZlVHlwZQoJCQkJfSk7CgkJCX0KCQkJZm9yIChpID0gMDsgaSA8IHJldC5SZWxhdGlvbkF0dHJpYnV0ZXMubGVuZ3RoOyBpKyspIHsKCQkJCXZhciBtID0gcmV0LlJlbGF0aW9uQXR0cmlidXRlc1tpXS5Jc0FycmF5OwoJCQkJdmFyIHJDb2xzID0gW107CgkJCQlmb3IgKHZhciBwIGluIHJldC5SZWxhdGlvbkF0dHJpYnV0ZXNbaV0uUmVsYXRpb25DbGFzcykgewoJCQkJCWlmICgkLmluQXJyYXkocCwgWyJUb1N0cmluZyIsICJfVG9TdHJpbmciLCAiX19ST1dJRCIsICJfX0xPQURFRCIsICJJZCJdKSA+IC0xKSBjb250aW51ZTsKCQkJCQlyQ29scy5wdXNoKHsKCQkJCQkJZmllbGQ6IHAsCgkJCQkJCXRpdGxlOiBwCgkJCQkJfSk7CgkJCQl9CgkJCQlmaWVsZHMucHVzaCh7CgkJCQkJZ3JvdXA6IChtID8gIk90aGVyIiA6ICJSZWxhdGlvbnMiKSwKCQkJCQlDbGFzczogcmV0LlJlbGF0aW9uQXR0cmlidXRlc1tpXS5SZWxhdGlvbkNsYXNzLAoJCQkJCW5hbWU6IHJldC5SZWxhdGlvbkF0dHJpYnV0ZXNbaV0uTmFtZSwKCQkJCQl0eXBlOiAnc2VsZWN0JywKCQkJCQltdWx0aXBsZTogbSwKCQkJCQlzb3VyY2U6IGZ1bmN0aW9uKG8sIGZEYXRhKSB7CgkJCQkJCXJldHVybiBvOwoJCQkJCX0sCgkJCQkJY29sdW1uczogckNvbHMKCQkJCX0pOwoJCQl9CgkJfSBlbHNlIHsKCQkJLy8gZW1zCgkJCXZhciBlYyA9IChjb21wYW55LlNjb3BlID8gd2luZG93W2NvbXBhbnkuU2NvcGVdIDogd2luZG93KS5FbnRpdHlDbGFzc2VzLmZpbmQoYyA9PiBjLk5hbWUucmVwbGFjZSgnICcsICdfJykgPT0gc1RhYmxlKTsKCQkJZmllbGRzLnB1c2goewoJCQkJbmFtZTogc1RhYmxlLAoJCQkJdGl0bGU6IGVjLk5hbWUsCgkJCQlDbGFzczogewoJCQkJCU5hbWU6IGVjLk5hbWUsCgkJCQkJSWQ6IGVjLklkCgkJCQl9LAoJCQkJdHlwZTogJ3NlbGVjdCcsCgkJCQlzZWxlY3Q6IGZ1bmN0aW9uKG8pIHsKCQkJCQl3aW5kb3cuREZvcm0uY2xlYXIoKTsKCQkJCQl3aW5kb3cuREZvcm0uc2V0KG8pOwoJCQkJfQoJCQl9KTsKCQkJJC5lYWNoKGVjLkVudGl0eUF0dHJpYnV0ZXMsIChfLCBlYSkgPT4gewoJCQkJaWYgKCFlYS5FbnRpdHlUeXBlKSB7CgkJCQkJdmFyIHR5cGUgPSAic3RyaW5nIjsKCQkJCQlpZiAoZWEuSXNCb29sKSB0eXBlID0gImJvb2wiOwoJCQkJCWlmIChlYS5Jc0RhdGUpIHR5cGUgPSAiZGF0ZXRpbWUiOwoJCQkJCWlmIChlYS5JcykgdHlwZSA9ICJkYXRldGltZSI7CgkJCQkJaWYgKGVhLklzVGV4dCkgdHlwZSA9ICJ0ZXh0IjsKCQkJCQlmaWVsZHMucHVzaCh7CgkJCQkJCWdyb3VwOiBlYS5Hcm91cC5OYW1lLAoJCQkJCQluYW1lOiBlYS5OYW1lLAoJCQkJCQl0eXBlOiB0eXBlCgkJCQkJfSk7CgkJCQl9IGVsc2UgewoJCQkJCWZpZWxkcy5wdXNoKHsKCQkJCQkJZ3JvdXA6IGVhLkdyb3VwLk5hbWUsCgkJCQkJCW5hbWU6IGVhLk5hbWUsCgkJCQkJCUNsYXNzOiB7CgkJCQkJCQlOYW1lOiBlYS5FbnRpdHlUeXBlLk5hbWUsCgkJCQkJCQlJZDogZWEuRW50aXR5VHlwZS5JZAoJCQkJCQl9LAoJCQkJCQlzb3VyY2U6IGZ1bmN0aW9uKG8sIGZEYXRhKSB7CgkJCQkJCQlyZXR1cm4gbzsKCQkJCQkJfSwKCQkJCQkJdHlwZTogInNlbGVjdCIKCQkJCQl9KTsKCQkJCX0KCQkJfSk7CgkJfQoJCXJldHVybiB7CgkJCWZvcm06IHdpbmRvdy5ERm9ybS5yZW5kZXIoc1RhYmxlLCB0aGlzLmVuZ2xpc2goc1RhYmxlKSwgZmllbGRzLCBbewoJCQkJbmFtZTogJ1Jlc2V0JywKCQkJCW9uY2xpY2s6IGZ1bmN0aW9uKG8pIHsKCQkJCQl3aW5kb3cuREZvcm0uYnVzeShmYWxzZSk7CgkJCQkJd2luZG93LkRGb3JtLmNsZWFyKCk7CgkJCQl9LAoJCQkJaWNvbjogImNhbmNlbCIKCQkJfSwgewoJCQkJbmFtZTogJ1NhdmUnLAoJCQkJb25jbGljazogZnVuY3Rpb24obykgewoJCQkJCWlmIChvW3dpbmRvdy5ERm9ybS5zVGFibGVdICYmIG9bd2luZG93LkRGb3JtLnNUYWJsZV0uSWQpIG8uSWQgPSBvW3dpbmRvdy5ERm9ybS5zVGFibGVdLklkOwoJCQkJCWRlbGV0ZSBvW3dpbmRvdy5ERm9ybS5zVGFibGVdOwoJCQkJCWlmIChjb21wYW55LmxpYnJhcnkpIHsKCQkJCQkJdGhpcy5zcigpLl8oY29tcGFueS5Db2RlLnRvTG93ZXJDYXNlKCkgKyAiIiArIHdpbmRvdy5ERm9ybS5zVGFibGUgKyAoby5JZCA/ICJVcGRhdGUiIDogIkluc2VydCIpLCBmdW5jdGlvbihyZXQpIHsKCQkJCQkJCWlmIChyZXQpIHsKCQkJCQkJCQl3aW5kb3cuREZvcm0uaW5mbyh3aW5kb3cuREZvcm0uc1RhYmxlICsgIiBTYXZlZCIpOwoJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQl3aW5kb3cuREZvcm0uZXJyb3IoIlVuYWJsZSB0byBzYXZlICIgKyB3aW5kb3cuREZvcm0uc1RhYmxlKTsKCQkJCQkJCX0KCQkJCQkJCXdpbmRvdy5ERm9ybS5idXN5KGZhbHNlKTsKCQkJCQkJfSwgbyk7CgkJCQkJfSBlbHNlIHsKCQkJCQkJdGhpcy5zcigpLl8oImVtc0VudGl0eU9iamVjdCIgKyAoby5JZCA/ICJVcGRhdGUiIDogIkluc2VydCIpLCBmdW5jdGlvbihyZXQpIHsKCQkJCQkJCWlmIChyZXQpIHsKCQkJCQkJCQl3aW5kb3cuREZvcm0uaW5mbyh3aW5kb3cuREZvcm0uc1RhYmxlICsgIiBTYXZlZCIpOwoJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQl3aW5kb3cuREZvcm0uZXJyb3IoIlVuYWJsZSB0byBzYXZlICIgKyB3aW5kb3cuREZvcm0uc1RhYmxlKTsKCQkJCQkJCX0KCQkJCQkJCXdpbmRvdy5ERm9ybS5idXN5KGZhbHNlKTsKCQkJCQkJfSwgby50b0VudGl0eU9iamVjdCgpKTsKCQkJCQl9CgkJCQl9CgkJCX1dLCBiRml4ZWQpCgkJfTsKCX0KCglhc3luYyBkb0NsaWNrKGJ1dHRvbikgewoJCWJ1dHRvbiA9IHRoaXMuYnV0dG9ucy5maW5kKGIgPT4gYi5uYW1lID09IGJ1dHRvbi5uYW1lICYmIGIuZ3JvdXAgPT0gYnV0dG9uLmdyb3VwKTsKCQl0aGlzLmJ1c3kodHJ1ZSk7CgkJdmFyIG8gPSB0aGlzLmdldCgpOwoJCXZhciBzTWlzc2luZyA9IHRoaXMuZWxlbWVudHMuZmlsdGVyKGUgPT4gKGJ1dHRvbi53aW5kb3cgPyBidXR0b24uZ3JvdXAgPT0gZS5ncm91cCA6IHRydWUpKS5maWx0ZXIoZSA9PiBlLnJlcXVpcmVkICYmICFvW2UubmFtZV0pLm1hcChlID0+ICI8bGk+IiArIChlLmxhYmVsIHx8IGUubmFtZSkgKyAiPC9saT4iKS5qb2luKCIiKTsKCQlpZiAoc01pc3NpbmcpIHsKCQkJd2luZG93Ll9GckVNRC5fZXJyb3IoIk1pc3NpbmcgbWFuZGF0b3J5IGZpZWxkczo8YnIvPjx1bD4iICsgc01pc3NpbmcgKyAiPC91bD4iLCA1MDAwKTsKCQkJdGhpcy5idXN5KGZhbHNlKTsKCQkJcmV0dXJuOwoJCX0KCQlpZiAoYnV0dG9uLm9uY2xpY2spIGF3YWl0IGJ1dHRvbi5vbmNsaWNrKG8pOwoJCWlmIChidXR0b24ub25DbGljaykgYXdhaXQgYnV0dG9uLm9uQ2xpY2sobyk7CgkJdGhpcy5idXN5KGZhbHNlKTsKCX0KCglidXN5KGJCdXN5KSB7CgkJaWYgKCFiQnVzeSkgewoJCQl2YXIgdG90YWwgPSAwOwoJCQlpZiAodHlwZW9mIG1vbWVudCAhPT0gJ3VuZGVmaW5lZCcpIHsKCQkJCXRvdGFsID0gbW9tZW50KCkuZGlmZihtb21lbnQodGhpcy5idXN5U3RhbXApLCAnc2Vjb25kcycpOwoJCQl9IGVsc2UgewoJCQkJLy8gbm8gbW9tZW50LCB1c2Ugc3RhbmRhcmQgRGF0ZQoJCQkJdG90YWwgPSAobmV3IERhdGUoKS5nZXRUaW1lKCkgLSB0aGlzLmJ1c3lTdGFtcCA/IHRoaXMuYnVzeVN0YW1wLmdldFRpbWUoKSA6IDApIC8gMTAwMCAvIDM2MDA7CgkJCX0KCQkJaWYgKHRoaXMuYkRlYnVnKSB7CgkJCQl3aW5kb3cuX0ZyRU1ELl9hbGVydCgiRXhlY3V0aW9uIFRpbWU6ICIgKyB0b3RhbCArICIgc2Vjb25kcy4iKTsKCQkJfQoJCQlkZWxldGUgdGhpcy5idXN5U3RhbXA7CgkJfSBlbHNlIHsKCQkJdGhpcy5idXN5U3RhbXAgPSBuZXcgRGF0ZSgpOwoJCX0KCgkJJC5lYWNoKCQubWVyZ2UoJC5tYXAodGhpcy5idXR0b25zLCBiID0+IGIubmFtZSksICQubWFwKHRoaXMuZWxlbWVudHMuZmlsdGVyKGUgPT4gZS50eXBlID09ICdsaW5rJyksIGUgPT4gZS5uYW1lKSksIChfLCBlKSA9PiAkKCcjJyArIGUpLmxpbmtidXR0b24oYkJ1c3kgPyAnZGlzYWJsZScgOiAnZW5hYmxlJykpOwoJfQoKCXByZWZpeChlKSB7CgkJc3dpdGNoIChlLnR5cGUpIHsKCQkJY2FzZSAnbGFiZWwnOgoJCQkJcmV0dXJuICdsYmwnOwoJCQljYXNlICd0ZXh0JzoKCQkJY2FzZSAnc3RyaW5nJzoKCQkJY2FzZSAnc2VhcmNoJzoKCQkJY2FzZSAncGFzc3dvcmQnOgoJCQkJcmV0dXJuICd0eHQnOwoJCQljYXNlICJEYXRlVGltZSI6CgkJCWNhc2UgImRhdGV0aW1lIjoKCQkJCXJldHVybiAnZHRwJzsKCQkJY2FzZSAiaW50IjoKCQkJY2FzZSAiaW50ZWdlciI6CgkJCWNhc2UgIm51bWJlciI6CgkJCWNhc2UgImxvbmciOgoJCQljYXNlICJMb25nIjoKCQkJCXJldHVybiAnbnVkJzsKCQkJY2FzZSAnZmlsZSc6CgkJCQlyZXR1cm4gJ2ZpbCc7CgkJCWNhc2UgJ2ltYWdlJzoKCQkJCXJldHVybiAnaW1nJzsKCQkJY2FzZSAiYm9vbCI6CgkJCQlyZXR1cm4gJ2Noayc7CgkJCWNhc2UgIndpbmRvdyI6CgkJCQlyZXR1cm4gJ3BubCc7CgkJCWNhc2UgInByb2dyZXNzIjoKCQkJCXJldHVybiAncHJnJzsKCQkJY2FzZSAiZ3JpZCI6CgkJCWNhc2UgInRyZWUiOgoJCQljYXNlICJzZWxlY3QiOgoJCQkJcmV0dXJuICdjbWInOwoJCQlkZWZhdWx0OgoJCQkJcmV0dXJuICcnOwoJCX0KCX0KCgljbGVhcihncm91cCkgewoJCXZhciBvID0ge307CgkJJC5lYWNoKHRoaXMuZWxlbWVudHMuZmlsdGVyKGUgPT4gZ3JvdXAgPyBlLmdyb3VwID09IGdyb3VwIDogdHJ1ZSksIChfLCBlKSA9PiB7CgkJCXZhciBuYW1lID0gKGUuZW1zU291cmNlID8gIl8iIDogIiIpICsgZS5uYW1lOwoJCQlzd2l0Y2ggKGUudHlwZSkgewoJCQkJY2FzZSAndGV4dCc6CgkJCQljYXNlICdzdHJpbmcnOgoJCQkJY2FzZSAnc2VhcmNoJzoKCQkJCWNhc2UgJ3Bhc3N3b3JkJzoKCQkJCWNhc2UgIkRhdGVUaW1lIjoKCQkJCWNhc2UgImRhdGV0aW1lIjoKCQkJCQlvW25hbWVdID0gIiI7CgkJCQkJYnJlYWs7CgkJCQljYXNlICJpbnQiOgoJCQkJY2FzZSAibnVtYmVyIjoKCQkJCWNhc2UgImludGVnZXIiOgoJCQkJY2FzZSAibG9uZyI6CgkJCQljYXNlICJMb25nIjoKCQkJCWNhc2UgInByb2dyZXNzIjoKCQkJCQlvW25hbWVdID0gMDsKCQkJCQlicmVhazsKCQkJCWNhc2UgInRyZWUiOgoJCQkJY2FzZSAic2VsZWN0IjoKCQkJCQlvW25hbWVdID0gbnVsbDsKCQkJCQlicmVhazsKCQkJCWNhc2UgImdyaWQiOgoJCQkJCW9bbmFtZV0gPyBvW25hbWVdLmRhdGEgPSBbXSA6IG51bGw7CgkJCQkJYnJlYWs7CgkJCQljYXNlICJib29sIjoKCQkJCQlvW25hbWVdID0gZmFsc2U7CgkJCQkJYnJlYWs7CgkJCQlkZWZhdWx0OgoJCQkJCWJyZWFrOwoJCQl9CgkJfSk7CgkJLy9jb25zb2xlLmxvZygiY2xlYXIiLCBvKTsKCQl0aGlzLnNldChvKTsKCQl0aGlzLmJ1c3koZmFsc2UpOwoJfQoKCXNldChvLCBlTmFtZSkgewoJCWlmIChlTmFtZSkgewoJCQl2YXIgb0VsZW1lbnQgPSB0aGlzLmJ5TmFtZShlTmFtZSk7CgkJCWlmICghb0VsZW1lbnQpIHJldHVybjsKCQkJdmFyIGF0dCA9IG51bGw7CgkJCWlmIChvICYmIG8uSWQgJiYgby5FbnRpdHlBdHRyaWJ1dGUpIHsKCQkJCS8vIGFuIEVudGl0eVZhbHVlCgkJCQlmb3IgKHZhciBwIGluIG8pCgkJCQkJaWYgKHAuZW5kc1dpdGgoIlZhbHVlIikpIGF0dCA9IHA7CgkJCQlvRWxlbWVudC5lbXNTb3VyY2UgPSBvOwoJCQl9CgkJCXRyeSB7CgkJCQlzd2l0Y2ggKG9FbGVtZW50LnR5cGUpIHsKCQkJCQljYXNlICdsYWJlbCc6CgkJCQkJCWlmIChhdHQpIHsKCQkJCQkJCSQoIiMiICsgdGhpcy5wcmVmaXgob0VsZW1lbnQpICsgb0VsZW1lbnQubmFtZSkuaHRtbChvW2F0dF0pOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJJCgiIyIgKyB0aGlzLnByZWZpeChvRWxlbWVudCkgKyBvRWxlbWVudC5uYW1lKS5odG1sKChvICYmIG8uRW50aXR5QXR0cmlidXRlKSA/ICIiIDogbyk7CgkJCQkJCX0KCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAndGV4dCc6CgkJCQkJY2FzZSAnc3RyaW5nJzoKCQkJCQljYXNlICdwYXNzd29yZCc6CgkJCQkJY2FzZSAiaW50IjoKCQkJCQljYXNlICJzZWFyY2giOgoJCQkJCWNhc2UgImludGVnZXIiOgoJCQkJCWNhc2UgIm51bWJlciI6CgkJCQkJY2FzZSAibG9uZyI6CgkJCQkJY2FzZSAiTG9uZyI6CgkJCQkJCWlmIChhdHQpIHsKCQkJCQkJCSQoIiMiICsgdGhpcy5wcmVmaXgob0VsZW1lbnQpICsgb0VsZW1lbnQubmFtZSlbdGhpcy51aVR5cGVzW29FbGVtZW50LnR5cGVdXSgic2V0VmFsdWUiLCBvW2F0dF0pOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJJCgiIyIgKyB0aGlzLnByZWZpeChvRWxlbWVudCkgKyBvRWxlbWVudC5uYW1lKVt0aGlzLnVpVHlwZXNbb0VsZW1lbnQudHlwZV1dKCJzZXRWYWx1ZSIsIChvICYmIG8uRW50aXR5QXR0cmlidXRlKSA/ICIiIDogbyk7CgkJCQkJCX0KCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAiRGF0ZVRpbWUiOgoJCQkJCWNhc2UgImRhdGV0aW1lIjoKCQkJCQkJaWYgKGF0dCkgewoJCQkJCQkJJCgiIyIgKyB0aGlzLnByZWZpeChvRWxlbWVudCkgKyBvRWxlbWVudC5uYW1lKVt0aGlzLnVpVHlwZXNbb0VsZW1lbnQudHlwZV1dKCdzZXRWYWx1ZScsIChvW2F0dF0gPyB0aGlzLnNyKCkudG9EYXRlVGltZShvW2F0dF0pIDogIiIpKTsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCSQoIiMiICsgdGhpcy5wcmVmaXgob0VsZW1lbnQpICsgb0VsZW1lbnQubmFtZSlbdGhpcy51aVR5cGVzW29FbGVtZW50LnR5cGVdXSgnc2V0VmFsdWUnLCAobyAmJiBvLkVudGl0eUF0dHJpYnV0ZSkgPyAiIiA6IChvID8gdGhpcy5zcigpLnRvRGF0ZVRpbWUobykgOiAiIikpOwoJCQkJCQl9CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgImJvb2wiOgoJCQkJCQlpZiAoYXR0KSB7CgkJCQkJCQkkKCIjIiArIHRoaXMucHJlZml4KG9FbGVtZW50KSArIG9FbGVtZW50Lm5hbWUpW3RoaXMudWlUeXBlc1tvRWxlbWVudC50eXBlXV0oKG9bYXR0XSA/ICcnIDogJ3VuJykgKyAnY2hlY2snKTsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCSQoIiMiICsgdGhpcy5wcmVmaXgob0VsZW1lbnQpICsgb0VsZW1lbnQubmFtZSlbdGhpcy51aVR5cGVzW29FbGVtZW50LnR5cGVdXSgoKChvICYmIG8uRW50aXR5QXR0cmlidXRlKSA/ICIiIDogbykgPyAnJyA6ICd1bicpICsgJ2NoZWNrJyk7CgkJCQkJCX0KCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAid2luZG93IjoKCQkJCQkJaWYgKGF0dCkgewoJCQkJCQkJb0VsZW1lbnQudmFsdWUgPSBvW2F0dF07CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQlvRWxlbWVudC52YWx1ZSA9IChvICYmIG8uRW50aXR5QXR0cmlidXRlKSA/ICIiIDogbzsKCQkJCQkJfQoJCQkJCQlicmVhazsKCQkJCQljYXNlICJwcm9ncmVzcyI6CgkJCQkJCXZhciB2ID0gMDsKCQkJCQkJaWYgKGF0dCkgewoJCQkJCQkJdiA9IG9bYXR0XTsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCXYgPSAobyAmJiBvLkVudGl0eUF0dHJpYnV0ZSkgPyAiIiA6IG87CgkJCQkJCX0KCQkJCQkJJCgiIyIgKyB0aGlzLnByZWZpeChvRWxlbWVudCkgKyBvRWxlbWVudC5uYW1lKVt0aGlzLnVpVHlwZXNbb0VsZW1lbnQudHlwZV1dKCdzZXRWYWx1ZScsIE1hdGgucm91bmQodiAqIDEwKSAvIDEwKTsKCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAiZ3JpZCI6CgkJCQkJCWxldCBjb2xzID0gSlNPTi5wYXJzZSgieyIgKyB0aGlzLm1hcENvbHVtbnMob0VsZW1lbnQsIHRydWUpICsgIn0iKTsKCQkJCQkJJC5lYWNoKGNvbHMuY29sdW1uc1swXSwgKF8sIGMpID0+IGMuZm9ybWF0dGVyID0gdGhpcy5zcigpLnJ1blNjcmlwdCh0aGlzLmZvcm1hdHRlcihvRWxlbWVudC5uYW1lLCBjKSkpOwoJCQkJCQkkKCIjIiArIHRoaXMucHJlZml4KG9FbGVtZW50KSArIG9FbGVtZW50Lm5hbWUpLmRhdGFncmlkKGNvbHMpOwoJCQkJCQlpZiAoYXR0KSB7CgkJCQkJCQkkKCIjIiArIHRoaXMucHJlZml4KG9FbGVtZW50KSArIG9FbGVtZW50Lm5hbWUpLmRhdGFncmlkKHsKCQkJCQkJCQlkYXRhOiBvW2F0dF0KCQkJCQkJCX0pOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJJCgiIyIgKyB0aGlzLnByZWZpeChvRWxlbWVudCkgKyBvRWxlbWVudC5uYW1lKS5kYXRhZ3JpZCh7CgkJCQkJCQkJZGF0YTogKG8gJiYgby5FbnRpdHlBdHRyaWJ1dGUpID8gIiIgOiBvCgkJCQkJCQl9KTsKCQkJCQkJfQoJCQkJCQkkKCIjIiArIHRoaXMucHJlZml4KG9FbGVtZW50KSArIG9FbGVtZW50Lm5hbWUpLmRhdGFncmlkKCJ1bnNlbGVjdEFsbCIpOwoJCQkJCQkkKCIjIiArIHRoaXMucHJlZml4KG9FbGVtZW50KSArIG9FbGVtZW50Lm5hbWUpLmRhdGFncmlkKCk7CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgInRyZWUiOgoJCQkJCQl2YXIgdiA9IGF0dCA/IG9bYXR0XSA6ICgobyAmJiBvLkVudGl0eUF0dHJpYnV0ZSkgPyAiIiA6IG8pOwoJCQkJCQlpZiAoQXJyYXkuaXNBcnJheSh2KSkgewoJCQkJCQkJJCgiIyIgKyB0aGlzLnByZWZpeChvRWxlbWVudCkgKyBvRWxlbWVudC5uYW1lKVt0aGlzLnVpVHlwZXNbb0VsZW1lbnQudHlwZV1dKCJ0cmVlIikudHJlZSgibG9hZERhdGEiLCB2KTsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCSQoIiMiICsgdGhpcy5wcmVmaXgob0VsZW1lbnQpICsgb0VsZW1lbnQubmFtZSlbdGhpcy51aVR5cGVzW29FbGVtZW50LnR5cGVdXSgnc2V0VmFsdWUnLCB2KTsKCQkJCQkJfQoJCQkJCQlicmVhazsKCQkJCQljYXNlICJzZWxlY3QiOgoJCQkJCQlpZiAoYXR0KSB7CgkJCQkJCQlpZiAob0VsZW1lbnQub3B0aW9ucykgewoJCQkJCQkJCSQoIiMiICsgdGhpcy5wcmVmaXgob0VsZW1lbnQpICsgb0VsZW1lbnQubmFtZSkuY29tYm8oJ3NldFZhbHVlJyArIChvRWxlbWVudC5tdWx0aXBsZSA/ICdzJyA6ICcnKSwgKG9bYXR0XSA/IG9bYXR0XSA6ICIiKSk7CgkJCQkJCQkJJCgiIyIgKyB0aGlzLnByZWZpeChvRWxlbWVudCkgKyBvRWxlbWVudC5uYW1lKS5jb21ibygnc2V0VmFsdWUnICsgKG9FbGVtZW50Lm11bHRpcGxlID8gJ3MnIDogJycpLCAob1thdHRdID8gb1thdHRdIDogIiIpKTsKCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJJCgiIyIgKyB0aGlzLnByZWZpeChvRWxlbWVudCkgKyBvRWxlbWVudC5uYW1lKS5jb21ib2dyaWQoJ3NldFZhbHVlJyArIChvRWxlbWVudC5tdWx0aXBsZSA/ICdzJyA6ICcnKSwgKG9bYXR0XSA/IG9bYXR0XSA6ICIiKSk7CgkJCQkJCQl9CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQl2ID0gbnVsbDsKCQkJCQkJCWlmIChvID09PSBudWxsKSB7CgoJCQkJCQkJfSBlbHNlIGlmIChvLmNvbnN0cnVjdG9yID09PSBBcnJheSkgewoKCQkJCQkJCX0gZWxzZSBpZiAoIW8uRW50aXR5QXR0cmlidXRlKSB7CgkJCQkJCQkJdiA9IG8gfHwgewoJCQkJCQkJCQlJZDogby5JZCwKCQkJCQkJCQkJX1RvU3RyaW5nOiBvLl9Ub1N0cmluZywKCQkJCQkJCQkJdG9TdHJpbmc6IGZ1bmN0aW9uKCkgewoJCQkJCQkJCQkJcmV0dXJuIHRoaXMuX1RvU3RyaW5nOwoJCQkJCQkJCQl9CgkJCQkJCQkJfTsKCQkJCQkJCX0KCQkJCQkJCWlmIChvRWxlbWVudC5vcHRpb25zKSB7CgkJCQkJCQkJJCgiIyIgKyB0aGlzLnByZWZpeChvRWxlbWVudCkgKyBvRWxlbWVudC5uYW1lKS5jb21ibygnc2V0VmFsdWUnICsgKG9FbGVtZW50Lm11bHRpcGxlID8gJ3MnIDogJycpLCB2KTsKCQkJCQkJCQkkKCIjIiArIHRoaXMucHJlZml4KG9FbGVtZW50KSArIG9FbGVtZW50Lm5hbWUpLmNvbWJvKCdzZXRUZXh0JyArIChvRWxlbWVudC5tdWx0aXBsZSA/ICdzJyA6ICcnKSwgdik7CgkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCSQoIiMiICsgdGhpcy5wcmVmaXgob0VsZW1lbnQpICsgb0VsZW1lbnQubmFtZSkuY29tYm9ncmlkKCdzZXRWYWx1ZScgKyAob0VsZW1lbnQubXVsdGlwbGUgPyAncycgOiAnJyksIHYpOwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJCWJyZWFrOwoJCQkJCWRlZmF1bHQ6CgkJCQkJCWJyZWFrOwoJCQkJfQoJCQl9IGNhdGNoIChleCkgewoJCQkJY29uc29sZS5sb2coZXgpOwoJCQl9CgkJfSBlbHNlIHsKCQkJZm9yICh2YXIgcCBpbiBvKSB7CgkJCQlpZiAocC5pbmRleE9mKCdfJykgPT09IDApIHAgPSBwLnN1YnN0cmluZygxKTsKCQkJCXZhciBlID0gdGhpcy5ieU5hbWUocCk7CgkJCQlpZiAoIWUgfHwgIWUubmFtZSkgY29udGludWU7CgkJCQl2YXIgdmFsdWUgPSBvW3BdOwoJCQkJaWYgKGUubmFtZSA9PSB0aGlzLnNUYWJsZSkgewoJCQkJCXZhbHVlID0gbzsKCQkJCQl2YWx1ZS5EYXRlID0gbmV3IERhdGUoKTsKCQkJCX0KCQkJCWlmIChwID09ICJFbnRpdHlWYWx1ZXMiKSB7CgkJCQkJLy8gYW4gZW1zRm9ybVZhbHVlcyBzb3VyY2UKCQkJCQkvLyBmaW5kIHRoZSBFbnRpdHlWYWx1ZSBmb3IgdGhpcyBlbGVtZW50IGFuZCBzZXQgaXQKCQkJCQlmb3IgKHZhciBqID0gMDsgaiA8IG8uRW50aXR5VmFsdWVzLmxlbmd0aDsgaisrKSB7CgkJCQkJCWlmIChvLkVudGl0eVZhbHVlc1tqXS5FbnRpdHlBdHRyaWJ1dGUuTmFtZSA9PSBlLm5hbWUpIHsKCQkJCQkJCS8vIGZvdW5kIHRoZSBFbnRpdHlWYWx1ZSBmb3IgdGhpcyBlbGVtZW50CgkJCQkJCQlfdiA9IG8uRW50aXR5VmFsdWVzW2pdOwoJCQkJCQkJZm9yICh2YXIgcSBpbiBfdikgewoJCQkJCQkJCWlmIChxLmVuZHNXaXRoKCJWYWx1ZSIpKSB7CgkJCQkJCQkJCV92W3FdID0gdmFsdWU7CgkJCQkJCQkJfQoJCQkJCQkJfQoJCQkJCQkJYnJlYWs7CgkJCQkJCX0KCQkJCQl9CgkJCQl9CgkJCQl0aGlzLnNldCh2YWx1ZSwgZS5uYW1lKTsKCQkJfQoJCX0KCX0KCglnZXQoKSB7CgkJdmFyIG8gPSB7fTsKCQlpZiAodGhpcy5zVGFibGUgJiYgd2luZG93W3RoaXMuc1RhYmxlXSkgbyA9IG5ldyB3aW5kb3dbdGhpcy5zVGFibGVdKCk7CgkJZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7CgkJCXZhciBjbiA9IG51bGw7CgkJCXZhciB2ID0gbnVsbDsKCQkJdHJ5IHsKCQkJCXN3aXRjaCAodGhpcy5lbGVtZW50c1tpXS50eXBlKSB7CgkJCQkJY2FzZSAnbGFiZWwnOgoJCQkJCQljbiA9ICQoIiNsYmwiICsgdGhpcy5lbGVtZW50c1tpXS5uYW1lKTsKCQkJCQkJdiA9IGNuLmh0bWwoKTsKCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAndGV4dCc6CgkJCQkJY2FzZSAnc3RyaW5nJzoKCQkJCQljYXNlICdzZWFyY2gnOgoJCQkJCWNhc2UgJ3Bhc3N3b3JkJzoKCQkJCQkJY24gPSAkKCIjIiArIHRoaXMucHJlZml4KHRoaXMuZWxlbWVudHNbaV0pICsgdGhpcy5lbGVtZW50c1tpXS5uYW1lKTsKCQkJCQkJdiA9IGNuLnZhbCgpOwoJCQkJCQlicmVhazsKCQkJCQljYXNlICJmaWxlIjoKCQkJCQljYXNlICJpbWFnZSI6CgkJCQkJCWNuID0gJCgiIyIgKyB0aGlzLnByZWZpeCh0aGlzLmVsZW1lbnRzW2ldKSArIHRoaXMuZWxlbWVudHNbaV0ubmFtZSk7CgkJCQkJCXYgPSB0aGlzLmVsZW1lbnRzW2ldLmRhdGE7CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgIkRhdGVUaW1lIjoKCQkJCQljYXNlICJkYXRldGltZSI6CgkJCQkJCXYgPSBuZXcgRGF0ZSgkKCIjIiArIHRoaXMucHJlZml4KHRoaXMuZWxlbWVudHNbaV0pICsgdGhpcy5lbGVtZW50c1tpXS5uYW1lKS5kYXRldGltZWJveCgnZ2V0VmFsdWUnKSk7CgkJCQkJCWNuID0gJCgiIyIgKyB0aGlzLnByZWZpeCh0aGlzLmVsZW1lbnRzW2ldKSArIHRoaXMuZWxlbWVudHNbaV0ubmFtZSk7CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgInByb2dyZXNzIjoKCQkJCQkJY24gPSAkKCIjIiArIHRoaXMucHJlZml4KHRoaXMuZWxlbWVudHNbaV0pICsgdGhpcy5lbGVtZW50c1tpXS5uYW1lKTsKCQkJCQkJdiA9IGNuLnByb2dyZXNzYmFyKCdnZXRWYWx1ZScpOwoJCQkJCQlicmVhazsKCQkJCQljYXNlICJpbnQiOgoJCQkJCWNhc2UgImludGVnZXIiOgoJCQkJCWNhc2UgIm51bWJlciI6CgkJCQkJY2FzZSAibG9uZyI6CgkJCQkJY2FzZSAiTG9uZyI6CgkJCQkJCWNuID0gJCgiIyIgKyB0aGlzLnByZWZpeCh0aGlzLmVsZW1lbnRzW2ldKSArIHRoaXMuZWxlbWVudHNbaV0ubmFtZSk7CgkJCQkJCXYgPSBwYXJzZUZsb2F0KGNuLnZhbCgpKTsKCQkJCQkJaWYgKGlzTmFOKHYpKSB2ID0gMDsKCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAiZ3JpZCI6CgkJCQkJCWNuID0gJCgiIyIgKyB0aGlzLnByZWZpeCh0aGlzLmVsZW1lbnRzW2ldKSArIHRoaXMuZWxlbWVudHNbaV0ubmFtZSk7CgkJCQkJCXYgPSBjbi5kYXRhZ3JpZCgnZ2V0RGF0YScpOwoJCQkJCQl2LnNlbGVjdGVkID0gY24uZGF0YWdyaWQoImdldFNlbGVjdGVkIik7CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgInRyZWUiOgoJCQkJCQljbiA9ICQoIiMiICsgdGhpcy5wcmVmaXgodGhpcy5lbGVtZW50c1tpXSkgKyB0aGlzLmVsZW1lbnRzW2ldLm5hbWUpOwoJCQkJCQl2ID0gY24uY29tYm90cmVlKCJ0cmVlIikudHJlZSgiZ2V0U2VsZWN0ZWQiKTsKCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAid2luZG93IjoKCQkJCQkJdiA9IHRoaXMuZWxlbWVudHNbaV0udmFsdWU7CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgInNlbGVjdCI6CgkJCQkJCWlmICh0aGlzLmVsZW1lbnRzW2ldLm9wdGlvbnMpIHsKCQkJCQkJCXYgPSAkKCIjIiArIHRoaXMucHJlZml4KHRoaXMuZWxlbWVudHNbaV0pICsgdGhpcy5lbGVtZW50c1tpXS5uYW1lKS5jb21ib2dyaWQoJ2dldFZhbHVlJyArICh0aGlzLmVsZW1lbnRzW2ldLm11bHRpcGxlID8gJ3MnIDogJycpKTsKCQkJCQkJCXYgPSB0aGlzLnNyKCkucnVuU2NyaXB0KHYpOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJdiA9ICQoIiMiICsgdGhpcy5wcmVmaXgodGhpcy5lbGVtZW50c1tpXSkgKyB0aGlzLmVsZW1lbnRzW2ldLm5hbWUpLmNvbWJvZ3JpZCgnZ3JpZCcpLmRhdGFncmlkKCdnZXRTZWxlY3Rpb25zJyk7CgkJCQkJCQlpZiAoIXYgfHwgIXYubGVuZ3RoKSB7CgkJCQkJCQkJdiA9ICQoIiMiICsgdGhpcy5wcmVmaXgodGhpcy5lbGVtZW50c1tpXSkgKyB0aGlzLmVsZW1lbnRzW2ldLm5hbWUpLmNvbWJvZ3JpZCgnZ2V0VmFsdWUnICsgKHRoaXMuZWxlbWVudHNbaV0ubXVsdGlwbGUgPyAncycgOiAnJykpOwoJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQlpZiAoIXRoaXMuZWxlbWVudHNbaV0ubXVsdGlwbGUpIHYgPSB2WzBdOwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJCWNuID0gJCgiIyIgKyB0aGlzLnByZWZpeCh0aGlzLmVsZW1lbnRzW2ldKSArIHRoaXMuZWxlbWVudHNbaV0ubmFtZSk7CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgImJvb2wiOgoJCQkJCQljbiA9ICQoIiMiICsgdGhpcy5wcmVmaXgodGhpcy5lbGVtZW50c1tpXSkgKyB0aGlzLmVsZW1lbnRzW2ldLm5hbWUpOwoJCQkJCQl2ID0gY24uc3dpdGNoYnV0dG9uKCdvcHRpb25zJykuY2hlY2tlZDsKCQkJCQkJYnJlYWs7CgkJCQkJZGVmYXVsdDoKCQkJCQkJYnJlYWs7CgkJCQl9CgkJCQlvW3RoaXMuZWxlbWVudHNbaV0ubmFtZV0odik7CgkJCX0gY2F0Y2ggKGUpIHsKCQkJCS8vY29uc29sZS5sb2codGhpcy5lbGVtZW50c1tpXS5uYW1lLCBlKTsKCQkJCW9bdGhpcy5lbGVtZW50c1tpXS5uYW1lXSA9IHY7CgkJCX0KCQkJaWYgKGNuKSB7CgkJCQlpZiAoby5FbnRpdHlWYWx1ZXMpIHsKCQkJCQlmb3IgKHZhciBqID0gMDsgaiA8IG8uRW50aXR5VmFsdWVzLmxlbmd0aDsgaisrKSB7CgkJCQkJCWlmICh0aGlzLmVsZW1lbnRzW2ldLm5hbWUgPT0gdGhpcy5zVGFibGUgJiYgdGhpcy5lbGVtZW50c1tpXS5lbXNTb3VyY2UpIG8uSWQgPSB0aGlzLmVsZW1lbnRzW2ldLmVtc1NvdXJjZS5JZDsKCQkJCQkJaWYgKG8uRW50aXR5VmFsdWVzW2pdLkVudGl0eUF0dHJpYnV0ZS5OYW1lID09IHRoaXMuZWxlbWVudHNbaV0ubmFtZSAmJiB0aGlzLmVsZW1lbnRzW2ldLmVtc1NvdXJjZSkgewoJCQkJCQkJby5FbnRpdHlWYWx1ZXNbal0uSWQgPSB0aGlzLmVsZW1lbnRzW2ldLmVtc1NvdXJjZS5JZDsKCQkJCQkJfQoJCQkJCX0KCQkJCX0KCQkJfQoJCX0KCQlyZXR1cm4gbzsKCX0KCgljSGVpZ2h0KG9wdGlvbnMpIHsKCQlpZiAob3B0aW9ucyAmJiBvcHRpb25zLmVkaXRvcikgcmV0dXJuIHdpbmRvdy5pbm5lckhlaWdodDsKCQlpZiAob3B0aW9ucyAmJiBvcHRpb25zLmhlaWdodCAmJiB0eXBlb2Yob3B0aW9ucy5oZWlnaHQpID09PSAnc3RyaW5nJykgcmV0dXJuIHRoaXMuaGVpZ2h0OwoJCWlmIChvcHRpb25zICYmIG9wdGlvbnMudHlwZSA9PSAnd2luZG93JyAmJiAhb3B0aW9ucy5oZWlnaHQpIHJldHVybiB0aGlzLmhlaWdodCAqIDAuOTsKCQlyZXR1cm4gTWF0aC5mbG9vcigoKG9wdGlvbnMgPyBvcHRpb25zLmhlaWdodCA6IG51bGwpIHx8ICh0aGlzLmhlaWdodCAvIDMpKSk7Cgl9CgoJc2VhcmNoKG9wdGlvbnMpIHsKCQlyZXR1cm4gdGhpcy5zdHJpbmcob3B0aW9ucyk7Cgl9CgoJc3RyaW5nKG9wdGlvbnMpIHsKCQlvcHRpb25zLmhlaWdodCA9IDIwOwoJCW9wdGlvbnMuc2ltcGxlID0gdHJ1ZTsKCQlyZXR1cm4gdGhpcy50ZXh0KG9wdGlvbnMpOwoJfQoKCWRhdGV0aW1lKG9wdGlvbnMpIHsKCQlyZXR1cm4gYDxpbnB1dCBpZD0iZHRwJHtvcHRpb25zLm5hbWV9IiBjbGFzcz0iZWFzeXVpLSR7dGhpcy51aVR5cGVzW29wdGlvbnMudHlwZV19IiByZXF1aXJlZD0iJHtvcHRpb25zLnJlcXVpcmVkID8gJ3RydWUnIDogJ2ZhbHNlJ30iIHZhbHVlPSIke3RoaXMudmFsdWUob3B0aW9ucyl9IiBzdHlsZT0id2lkdGg6JHt0aGlzLmNXaWR0aChvcHRpb25zKX1weCI+YDsKCX0KCglxdWVyeShvcHRpb25zKSB7CgkJcmV0dXJuICI8ZGl2IGlkPSd2cyIgKyBvcHRpb25zLm5hbWUgKyAiJz48L2Rpdj4iOwoJfQoKCURhdGVUaW1lKG9wdGlvbnMpIHsKCQlyZXR1cm4gdGhpcy5kYXRldGltZShvcHRpb25zKTsKCX0KCglsb25nKG9wdGlvbnMpIHsKCQlyZXR1cm4gdGhpcy5pbnQob3B0aW9ucyk7Cgl9CgoJTG9uZyhvcHRpb25zKSB7CgkJcmV0dXJuIHRoaXMubG9uZyhvcHRpb25zKTsKCX0KCgl2YWx1ZShvcHRpb25zKSB7CgkJaWYgKHR5cGVvZiBvcHRpb25zLnZhbHVlID09PSAnZnVuY3Rpb24nKSB7CgkJCXRyeSB7CgkJCQlyZXR1cm4gb3B0aW9ucy52YWx1ZSh0aGlzLmdldCgpKTsKCQkJfSBjYXRjaCAoZXgpIHsKCQkJCWNvbnNvbGUubG9nKGBERm9ybS52YWx1ZSgke29wdGlvbnMubmFtZX0pOiAke2V4fWApOwoJCQkJcmV0dXJuICcnOwoJCQl9CgkJfSBlbHNlIHsKCQkJc3dpdGNoIChvcHRpb25zLnR5cGUpIHsKCQkJCWNhc2UgJ2ludCc6CgkJCQljYXNlICdwcm9ncmVzcyc6CgkJCQkJcmV0dXJuIG9wdGlvbnMudmFsdWUgfHwgb3B0aW9ucy5taW4gfHwgMDsKCQkJCWNhc2UgJ3N0cmluZyc6CgkJCQljYXNlICd0ZXh0JzoKCQkJCWNhc2UgJ2RhdGV0aW1lJzoKCQkJCWNhc2UgJ2xhYmVsJzoKCQkJCQlyZXR1cm4gb3B0aW9ucy52YWx1ZSB8fCAiIjsKCQkJCWRlZmF1bHQ6CgkJCQkJcmV0dXJuIG9wdGlvbnMudmFsdWU7CgkJCX0KCQl9Cgl9CgoJaW50KG9wdGlvbnMpIHsKCQlsZXQgcmV0ID0gYDxpbnB1dCBpZD0ibnVkJHtvcHRpb25zLm5hbWV9IiBjbGFzcz0iZWFzeXVpLSR7dGhpcy51aVR5cGVzW29wdGlvbnMudHlwZV19IiByZXF1aXJlZD0iJHtvcHRpb25zLnJlcXVpcmVkID8gJ3RydWUnIDogJ2ZhbHNlJ30iIHZhbHVlPSIke3RoaXMudmFsdWUob3B0aW9ucyl9IiBkYXRhLW9wdGlvbnM9Im1pbjoke29wdGlvbnMubWluIHx8IDB9LG1heDoke29wdGlvbnMubWF4IHx8IDEwMH0saW5jcmVtZW50OiR7b3B0aW9ucy5pbmNyZW1lbnQgfHwgMX0iIHN0eWxlPSJ3aWR0aDoke3RoaXMuY1dpZHRoKG9wdGlvbnMpfXB4OyI+PC9pbnB1dD5gOwoJCS8vY29uc29sZS5sb2cocmV0KTsKCQlyZXR1cm4gcmV0OwoJfQoKCW1lbnUob3B0aW9ucykgewoJCXZhciByZXQgPSAiIjsKCQlyZXQgKz0gJzxkaXYgY2xhc3M9ImVhc3l1aS1wYW5lbCIgaWQ9Im1udScgKyBvcHRpb25zLm5hbWUgKyAnIiBzdHlsZT0icGFkZGluZzo1cHg7Ij5cbic7CgkJJC5lYWNoKG9wdGlvbnMubWVudSwgKF8sIG0pID0+IHJldCArPSBgPGEgaHJlZj0iIyIgY2xhc3M9ImVhc3l1aS0ke3RoaXMudWlUeXBlc1tvcHRpb25zLnR5cGUgfHwgJ21lbnUnXX0iIGRhdGEtb3B0aW9ucz0ibWVudTonI21tJHttLmxhYmVsLnJlcGxhY2UoLyAvZywgJycpfScsaWNvbkNsczonaWNvbi0ke20uaWNvbiB8fCAnbm9uZSd9JyI+JHttLmxhYmVsfTwvYT5cbmApOwoJCXJldCArPSAiPC9kaXY+XG4iOwoJCWxldCBkdiA9IG0gPT4gewoJCQlsZXQgcmV0ID0gJzxkaXYnICsgKG0uc3ViTWVudXMgPyAnJyA6IGAgZGF0YS1vcHRpb25zPSJpY29uQ2xzOidpY29uLSR7bS5pY29uIHx8ICdub25lJ30nImApICsgJz5cbic7CgkJCXJldCArPSBtLnN1Yk1lbnVzID8gJzxzcGFuPicgKyAobS5sYWJlbCB8fCB0aGlzLmVuZ2xpc2gobS5jb2RlKSkgKyAnPC9zcGFuPlxuPGRpdj4nIDogKGA8c3BhbiB3aWR0aD0nMTAwJScgb25jbGljaz0nKGFzeW5jICgpID0+IHtsZXQgbSA9ICR7X0ZyRU1ELl90b0pTKG0pfTsgaWYobS5hY3Rpb24pe3JldHVybiBhd2FpdCBtLmFjdGlvbihERm9ybS5nZXQoKSwgbSk7fSBpZiAobS5zdWJNZW51cykgcmV0dXJuOyBhd2FpdCBfRnJFTUQuUmVuZGVyUGFnZSh7X2NvZGU6IG0uY29kZSB8fCBtLmxhYmVsLnJlcGxhY2UoLyAvZywgIiIpLnRvTG93ZXJDYXNlKCl9LCBtLmRhdGEpO30pKCknPiR7bS5sYWJlbCB8fCB0aGlzLmVuZ2xpc2gobS5jb2RlKX08L3NwYW4+YCk7CgkJCSQuZWFjaChtLnN1Yk1lbnVzLCAoXywgcykgPT4gcmV0ICs9IGR2KHMpKTsKCQkJcmV0ICs9IChtLnN1Yk1lbnVzID8gIjwvZGl2PlxuIiA6ICIiKSArIGA8L2Rpdj5cbmA7CgkJCXJldHVybiByZXQ7CgkJfTsKCQlmb3IgKHZhciBpID0gMDsgaSA8IG9wdGlvbnMubWVudS5sZW5ndGg7IGkrKykgewoJCQl2YXIgbSA9IG9wdGlvbnMubWVudVtpXTsKCQkJcmV0ICs9ICc8ZGl2IGlkPSJtbScgKyBtLmxhYmVsLnJlcGxhY2UoLyAvZywgJycpICsgJyIgc3R5bGU9IndpZHRoOjE1MHB4OyI+JzsKCQkJZm9yICh2YXIgaiA9IDA7IGogPCBtLnN1Yk1lbnVzLmxlbmd0aDsgaisrKSB7CgkJCQl2YXIgc20gPSBtLnN1Yk1lbnVzW2pdOwoJCQkJcmV0ICs9IGR2KHNtKTsKCQkJfQoJCQlyZXQgKz0gJzwvZGl2PlxuJzsKCQl9CgkJcmV0dXJuIHJldDsKCX0KCglpbnRlZ2VyKG9wdGlvbnMpIHsKCQlyZXR1cm4gdGhpcy5pbnQob3B0aW9ucyk7Cgl9CgoJbnVtYmVyKG9wdGlvbnMpIHsKCQlyZXR1cm4gdGhpcy5pbnQob3B0aW9ucyk7Cgl9CgoJSW50ZWdlcihvcHRpb25zKSB7CgkJcmV0dXJuIHRoaXMuaW50KG9wdGlvbnMpOwoJfQoKCWJvb2wob3B0aW9ucykgewoJCXJldHVybiBgPGlucHV0IGlkPSIke3RoaXMucHJlZml4KG9wdGlvbnMpfSR7b3B0aW9ucy5uYW1lfSIgZGF0YS1kZm9ybT0iZWxlbWVudDoke29wdGlvbnMubmFtZX0iIHJlcXVpcmVkPSIke29wdGlvbnMucmVxdWlyZWQ/J3RydWUnOidmYWxzZSd9IiBkYXRhLW9wdGlvbnM9J2Rpc2FibGVkOiR7b3B0aW9ucy5kaXNhYmxlZD8ndHJ1ZSc6J2ZhbHNlJ30sJHt0aGlzLmV2ZW50SGFuZGxlcnMob3B0aW9ucyl9JyBjbGFzcz0iZWFzeXVpLSR7dGhpcy51aVR5cGVzW29wdGlvbnMudHlwZV19IiAke29wdGlvbnMuY2hlY2tlZD8nY2hlY2tlZCc6Jyd9IC8+YDsKCX0KCglsYWJlbChvcHRpb25zKSB7CgkJcmV0dXJuIGA8c3BhbiBpZD0iJHt0aGlzLnByZWZpeChvcHRpb25zKX0ke29wdGlvbnMubmFtZX0iIHN0eWxlPSJ3aWR0aDoke3RoaXMuY1dpZHRoKG9wdGlvbnMpfXB4IiBkYXRhLW9wdGlvbnM9ImRpc2FibGVkOiR7b3B0aW9ucy5kaXNhYmxlZD8ndHJ1ZSc6J2ZhbHNlJ30iPiR7dGhpcy52YWx1ZShvcHRpb25zKX08L3NwYW4+YDsKCX0KCgl1cmwob3B0aW9ucykgewoJCXJldHVybiB0aGlzLnN0cmluZyhvcHRpb25zKS5yZXBsYWNlKCJGaWVsZENoYW5nZSIsICJVUkxDaGFuZ2UiKTsKCX0KCgl0ZXh0KG9wdGlvbnMpIHsKCQlyZXR1cm4gYDxpbnB1dCBpZD0iJHt0aGlzLnByZWZpeChvcHRpb25zKX0ke29wdGlvbnMubmFtZX0iIGNsYXNzPSJlYXN5dWktJHtvcHRpb25zLmVkaXRvciB8fCB0aGlzLnVpVHlwZXNbb3B0aW9ucy50eXBlXX0iIGRhdGEtb3B0aW9ucz0nZGlzYWJsZWQ6JHtvcHRpb25zLmRpc2FibGVkPyd0cnVlJzonZmFsc2UnfSwke3RoaXMuZXZlbnRIYW5kbGVycyhvcHRpb25zKX0nIG11bHRpbGluZT0iJHtvcHRpb25zLnNpbXBsZSA/ICdmYWxzZScgOiAndHJ1ZSd9IiBzdHlsZT0id2hpdGUtc3BhY2U6cHJlLXdyYXA7d2lkdGg6JHt0aGlzLmNXaWR0aChvcHRpb25zKX1weDtoZWlnaHQ6JHt0aGlzLmNIZWlnaHQob3B0aW9ucyl9cHgiIHJlcXVpcmVkPSIke29wdGlvbnMucmVxdWlyZWQgPyAndHJ1ZScgOiAnZmFsc2UnfSIgdmFsdWU9IiR7dGhpcy52YWx1ZShvcHRpb25zKX0iIC8+YDsKCX0KCglwYXNzd29yZChvcHRpb25zKSB7CgkJdmFyIHJldCA9IHRoaXMuc3RyaW5nKG9wdGlvbnMpOwoJCXJldCA9IHJldC5yZXBsYWNlKCc8aW5wdXQgJywgJzxpbnB1dCB0eXBlPSJwYXNzd29yZCIgJyk7CgkJcmV0dXJuIHJldDsKCX0KCglmaWxlKG9wdGlvbnMpIHsKCQlyZXR1cm4gYDxpbnB1dCBpZD0iJHt0aGlzLnByZWZpeChvcHRpb25zKX0ke29wdGlvbnMubmFtZX0iIGNsYXNzPSJlYXN5dWktJHt0aGlzLnVpVHlwZXNbb3B0aW9ucy50eXBlXX0iIGRhdGEtb3B0aW9ucz0ib25DaGFuZ2U6ZnVuY3Rpb24obixvKXt2YXIgcyA9ICQoJyMnICsgdGhpcy5pZCkuZmlsZWJveCgnb3B0aW9ucycpOyB3aW5kb3cuREZvcm0uVXBsb2FkRmlsZShzLCB3aW5kb3cuREZvcm0uYnlOYW1lKCcke29wdGlvbnMubmFtZX0nKSk7fSIgc3R5bGU9IndpZHRoOiR7dGhpcy5jV2lkdGgob3B0aW9ucyl9cHgiPmA7Cgl9CgoJaW1hZ2Uob3B0aW9ucykgewoJCXJldHVybiB0aGlzLmZpbGUob3B0aW9ucykgKyBgPGRpdiBpZD0iZGxnJHtvcHRpb25zLm5hbWV9IiBjbGFzcz0iZWFzeXVpLSR7dGhpcy51aVR5cGVzW29wdGlvbnMudHlwZV19IiB0aXRsZT0iSW1hZ2UgUHJldmlldyIgZGF0YS1vcHRpb25zPSJjbG9zZWQ6dHJ1ZSxpY29uQ2xzOidpY29uLXNhdmUnLHJlc2l6YWJsZTpmYWxzZSxtb2RhbDp0cnVlIiBzdHlsZT0id2lkdGg6NDAwcHg7aGVpZ2h0OjIwMHB4O3BhZGRpbmc6MTBweCI+PGltZyBpZD0iJHt0aGlzLnByZWZpeChvcHRpb25zKX0ke29wdGlvbnMubmFtZX0iIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiLz48L2Rpdj5gOwoJfQoKCXByb2dyZXNzKG9wdGlvbnMpIHsKCQlpZiAoIW9wdGlvbnMuaGVpZ2h0KSBvcHRpb25zLmhlaWdodCA9IDIwOyAvLyBmaXggYmlnIHByb2dyZXNzCgkJcmV0dXJuIGA8ZGl2IGlkPSIke3RoaXMucHJlZml4KG9wdGlvbnMpfSR7b3B0aW9ucy5uYW1lfSIgY2xhc3M9ImVhc3l1aS0ke3RoaXMudWlUeXBlc1tvcHRpb25zLnR5cGVdfSIgZGF0YS1vcHRpb25zPSJ2YWx1ZToke3RoaXMudmFsdWUob3B0aW9ucyl9IiBzdHlsZT0id2lkdGg6JHt0aGlzLmNXaWR0aChvcHRpb25zKX1weDtoZWlnaHQ6JHt0aGlzLmNIZWlnaHQob3B0aW9ucyl9cHgiPjwvZGl2PmA7Cgl9CgoJZmxvd2NoYXJ0KG9wdGlvbnMpIHsKCQlyZXR1cm4gYDxkaXYgaWQ9ImZsdyR7b3B0aW9ucy5uYW1lfSIgd2lkdGg9IiR7dGhpcy5jV2lkdGgob3B0aW9ucyl9IiBoZWlnaHQ9IiR7dGhpcy5jSGVpZ2h0KG9wdGlvbnMpfSI+PC9kaXY+YDsKCX0KCgljaGFydChvcHRpb25zKSB7CgkJcmV0dXJuIGA8ZGl2IGlkPSJjaHQke29wdGlvbnMubmFtZX0iIHdpZHRoPSIke3RoaXMuY1dpZHRoKG9wdGlvbnMpfSIgaGVpZ2h0PSIke3RoaXMuY0hlaWdodChvcHRpb25zKX0iPjwvZGl2PmA7Cgl9CgoJZm9ybWF0dGVyKG5hbWUsIGMsIGpzb24pIHsKCQlqc29uID0ganNvbiA/ICciJyA6ICcnOwoJCXJldHVybiBgJHtqc29ufSh2YWx1ZSwgcm93LCBpbmRleCkgPT4ge3RyeXt2YXIgYyA9IChERm9ybS5ieU5hbWUoXGAke25hbWV9XGApLmNvbHVtbnMgfHwgW10pLmZpbmQoYyA9PiBjLmZpZWxkPT1cYCR7Yy5maWVsZH1cYCk7IHJldHVybiBjJiZjLmZvcm1hdD9jLmZvcm1hdCh2YWx1ZSxyb3csaW5kZXgpOnZhbHVlO31jYXRjaChleCl7cmV0dXJuIHZhbHVlO30gfSR7anNvbn1gOwoJfQoKCW1hcENvbHVtbnMob3B0aW9ucywganNvbikgewoJCWxldCBjVGl0bGUgPSBjID0+IGMudGl0bGUgfHwgdGhpcy5lbmdsaXNoKGMuZmllbGQpOwoKCQl2YXIgY29scyA9ICQuZ3JlcChvcHRpb25zLmNvbHVtbnMgfHwgW10sIGMgPT4gIWMuaWdub3JlKTsKCQlsZXQgcmV0ID0gIiI7CgkJaWYgKG9wdGlvbnMubXVsdGlwbGUpIHJldCArPSBgeyJmaWVsZCI6J2NrJywiY2hlY2tib3giOnRydWV9LGA7CgkJcmV0ID0gYCJmcm96ZW5Db2x1bW5zIjogW1tgOwoJCWlmICghb3B0aW9ucy5mcm96ZW4pIHsKCQkJcmV0ICs9IGB7ImZpZWxkIjoiJHtvcHRpb25zLmlkRmllbGQuZmllbGR9IiwidGl0bGUiOiAiJHtvcHRpb25zLmlkRmllbGQudGl0bGV9Iiwic29ydGFibGUiOiAidHJ1ZSIsICJmb3JtYXR0ZXIiOiAke3RoaXMuZm9ybWF0dGVyKG9wdGlvbnMubmFtZSwgb3B0aW9ucy5pZEZpZWxkLCBqc29uKX19LGA7CgkJCWlmIChvcHRpb25zLnRleHRGaWVsZC5maWVsZCAhPSBvcHRpb25zLmlkRmllbGQuZmllbGQpIHJldCArPSBgeyJmaWVsZCI6IiR7b3B0aW9ucy50ZXh0RmllbGQuZmllbGQgfHwgb3B0aW9ucy50ZXh0RmllbGQudGl0bGV9IiwidGl0bGUiOiIke29wdGlvbnMudGV4dEZpZWxkLnRpdGxlIHx8IG9wdGlvbnMudGV4dEZpZWxkLmZpZWxkfSIsIndpZHRoIjoiJHtvcHRpb25zLnRleHRGaWVsZC53aWR0aHx8MTIwfSIsICJzb3J0YWJsZSI6ICJ0cnVlIiwgImZvcm1hdHRlciI6ICR7dGhpcy5mb3JtYXR0ZXIob3B0aW9ucy5uYW1lLCBvcHRpb25zLnRleHRGaWVsZCwganNvbil9fWA7CgkJfSBlbHNlIHsKCQkJJC5tYXAoJC5ncmVwKGNvbHMsIGMgPT4gYy5mcm96ZW4pLCBjID0+IGB7ImZpZWxkIjoiJHtjLmZpZWxkIHx8IGNUaXRsZShjKX0iLCJ0aXRsZSI6IiR7Y1RpdGxlKGMpIHx8IGMuZmllbGR9Iiwid2lkdGgiOiIke2Mud2lkdGh8fDEyMH0iLCJhbGlnbiI6J2xlZnQnLCJzb3J0YWJsZSI6InRydWUiLCAiZm9ybWF0dGVyIjogJHt0aGlzLmZvcm1hdHRlcihvcHRpb25zLm5hbWUsIGMsIGpzb24pfX1gKS5qb2luKCIsIik7CgkJfQoJCXJldCArPSBgXV0sICJjb2x1bW5zIjogW1tgOwoJCXJldCArPSAkLm1hcCgkLmdyZXAoY29scywgYyA9PiAhYy5mcm96ZW4pLCBjID0+IGB7ImZpZWxkIjoiJHtjLmZpZWxkIHx8IGNUaXRsZShjKX0iLCJ0aXRsZSI6IiR7Y1RpdGxlKGMpIHx8IGMuZmllbGR9IiwiYWxpZ24iOiJsZWZ0Iiwic29ydGFibGUiOiJ0cnVlIiwgImZvcm1hdHRlciI6ICR7dGhpcy5mb3JtYXR0ZXIob3B0aW9ucy5uYW1lLCBjLCBqc29uKX19YCkuam9pbigiLCIpOwoJCXJldCArPSAnXV0nOwoJCXJldHVybiByZXQ7Cgl9CgoJc2VsZWN0KG9wdGlvbnMsIHRhZyA9IG9wdGlvbnMudGFnLCB0eXBlKSB7CgkJcmV0dXJuIHRoaXMuY29tYm8ob3B0aW9ucywgdGFnLCB0eXBlKTsKCX0KCgl0cmVlKG9wdGlvbnMpIHsKCQlyZXR1cm4gdGhpcy5zZWxlY3Qob3B0aW9ucywgInNlbGVjdCIpOwoJfQoKCW5hdmlnYXRpb24ob3B0aW9ucykgewoJCXJldHVybiB0aGlzLmNvbWJvKG9wdGlvbnMsICd1bCcsICd0cmVlJyk7Cgl9CgoJY29tYm8ob3B0aW9ucywgdGFnLCB0eXBlKSB7CgkJdmFyIGNvbHMgPSAkLmdyZXAob3B0aW9ucy5jb2x1bW5zIHx8IFtdLCBjID0+ICFjLmlnbm9yZSk7CgkJdGFnID0gdGFnIHx8ICJzZWxlY3QiOwoJCW9wdGlvbnMuaWRGaWVsZCA9ICQudW5pcXVlU29ydChbewoJCQlmaWVsZDogb3B0aW9ucy5pZEZpZWxkLAoJCQl0aXRsZTogb3B0aW9ucy5pZEZpZWxkCgkJfV0uY29uY2F0KCQuZ3JlcChjb2xzLCBjID0+IGMucHJpbWFyeSksIFt7CgkJCWZpZWxkOiAnSWQnLAoJCQl0aXRsZTogJ0lEJwoJCX1dKSkuZmluZCh4ID0+IHR5cGVvZih4LmZpZWxkKSAhPT0gInVuZGVmaW5lZCIpOwoJCW9wdGlvbnMudGV4dEZpZWxkID0gJC51bmlxdWVTb3J0KFt7CgkJCWZpZWxkOiBvcHRpb25zLnRleHRGaWVsZCwKCQkJdGl0bGU6IG9wdGlvbnMudGV4dEZpZWxkCgkJfV0uY29uY2F0KCQuZ3JlcChjb2xzLCBjID0+IGMuZGlzcGxheSksIFt7CgkJCWZpZWxkOiAoKHR5cGVvZihjb21wYW55KSAhPT0gJ3VuZGVmaW5lZCcpID8gKGNvbXBhbnkubGlicmFyeSA/ICdfVG9TdHJpbmcnIDogJ19uYW1lJykgOiAnX25hbWUnKSwKCQkJdGl0bGU6IG9wdGlvbnMubmFtZSwKCQl9XSkpLmZpbmQoeCA9PiB0eXBlb2YoeC5maWVsZCkgIT09ICJ1bmRlZmluZWQiKTsKCQl2YXIgZnVuID0gdHlwZSB8fCB0aGlzLmVGdW4ob3B0aW9ucyk7CgkJdmFyIGRyb3Bkb3duID0gWydjb21ib3RyZWVncmlkJywgJ2NvbWJvdHJlZScsICdjb21ib2dyaWQnLCAnc2VsZWN0J10uaW5kZXhPZihmdW4pID4gLTE7CgkJaWYgKGRyb3Bkb3duKSB0aGlzLnNlbGVjdHMucHVzaCh7CgkJCWlkOiAiY21iIiArIG9wdGlvbnMubmFtZSwKCQkJb3B0aW9uczogdGhpcy5ieU5hbWUob3B0aW9ucy5uYW1lKQoJCX0pOwoJCXRoaXMuc2VsZWN0cyA9ICQudW5pcXVlU29ydCh0aGlzLnNlbGVjdHMpOwoJCXZhciByZXQgPSBgPCR7dGFnfSBpZD0iY21iJHtvcHRpb25zLm5hbWV9IiBjbGFzcz0iZWFzeXVpLSR7ZnVufSIgc3R5bGU9Im1heC13aWR0aDoke2Ryb3Bkb3duPyc0MDBweCc6dGhpcy5jV2lkdGgob3B0aW9ucyl9OyB3aWR0aDoke3RoaXMuY1dpZHRoKG9wdGlvbnMpfXB4IiByZXF1aXJlZD0iJHsob3B0aW9ucy5yZXF1aXJlZCA/ICd0cnVlJyA6ICdmYWxzZScpfSIgZGF0YS1vcHRpb25zPSdkaXNhYmxlZDoke29wdGlvbnMuZGlzYWJsZWQ/J3RydWUnOidmYWxzZSd9LCR7dGhpcy5ldmVudEhhbmRsZXJzKG9wdGlvbnMpfSwgdmFsdWU6IiR7dGhpcy52YWx1ZShvcHRpb25zKX0iLCByb3dudW1iZXJzOiR7dHlwZW9mKG9wdGlvbnMucm93TnVtYmVycykhPT0ndW5kZWZpbmVkJz9vcHRpb25zLnJvd051bWJlcnM6KGZ1bi5pbmRleE9mKCd0cmVlJyk8LTE/J2ZhbHNlJzondHJ1ZScpfSwgcGFnaW5hdGlvbjoke3R5cGVvZihvcHRpb25zLnBhZ2luYXRpb24pIT09J3VuZGVmaW5lZCc/b3B0aW9ucy5wYWdpbmF0aW9uOihmdW4uaW5kZXhPZigndHJlZScpPC0xPydmYWxzZSc6J3RydWUnKX0sIHBhbmVsV2lkdGg6JHsyKnRoaXMuY1dpZHRoKG9wdGlvbnMpfSwgZml0Q29sdW1uczogdHJ1ZSwgc2luZ2xlU2VsZWN0OiB0cnVlLCBtdWx0aXBsZTokeyhvcHRpb25zLm11bHRpcGxlIHx8ICdmYWxzZScpfSwgaWRGaWVsZDogIiR7b3B0aW9ucy5pZEZpZWxkLmZpZWxkfSIsIGVuYWJsZUZpbHRlcjogJHtvcHRpb25zLmZpbHRlcj8ndHJ1ZSc6J2ZhbHNlJ30sIG5vd3JhcDogZmFsc2UsIHRleHRGaWVsZDogIiR7b3B0aW9ucy50ZXh0RmllbGQuZmllbGR9IiwgdHJlZUZpZWxkOiAiJHtvcHRpb25zLnRleHRGaWVsZC5maWVsZH0iLGA7CgkJaWYgKGZ1bi5pbmRleE9mKCd0cmVlJykgPT0gLTEpIHsKCQkJcmV0ICs9ICdmaXRDb2x1bW5zOiBmYWxzZSwnICsgdGhpcy5tYXBDb2x1bW5zKG9wdGlvbnMpOwoJCX0KCQlpZiAob3B0aW9ucy5kYXRhKSB7CgkJCXJldCArPSBgLGRhdGE6ICR7SlNPTi5zdHJpbmdpZnkob3B0aW9ucy5kYXRhKX1gOwoJCX0KCQlyZXQgKz0gYCc+YDsKCQlpZiAob3B0aW9ucy5vcHRpb25zKSB7CgkJCXJldCArPSAkLm1hcChvcHRpb25zLm9wdGlvbnMsIG8gPT4gYDxvcHRpb24gdmFsdWU9JyR7X0ZyRU1ELl90b0pTKG8pfSc+JHtvLm5hbWUgfHwgb308L29wdGlvbj5gKS5qb2luKCdcbicpOwoJCX0KCQlyZXQgKz0gYDwvJHt0YWd9PmA7CgkJLy8gY29uc29sZS5sb2cocmV0KTsKCQlyZXR1cm4gcmV0OwoJfQoKCWdyaWQob3B0aW9ucywgdGFnLCB0eXBlKSB7CgkJcmV0dXJuIHRoaXMuY29tYm8ob3B0aW9ucywgInRhYmxlIiwgImRhdGFncmlkIik7Cgl9CgoJdHJlZWdyaWQob3B0aW9ucykgewoJCXJldHVybiB0aGlzLmNvbWJvKG9wdGlvbnMsICd0YWJsZScsICd0cmVlJyk7Cgl9CgoJYXN5bmMgZG9MaW5rKGUsIGV2ZW50KSB7CgkJdGhpcy5idXN5KHRydWUpOwoJCXRyeSB7CgkJCWF3YWl0IGUubGlua3MuZmluZChsID0+IGwubGFiZWwgPT0gZXZlbnQudGFyZ2V0LmlubmVyVGV4dCkub25DbGljayh0aGlzLmdldCgpKTsKCQl9IGNhdGNoIChleCkgewoJCQljb25zb2xlLmxvZygiZG9MaW5rIiwgZXgpOwoJCX0KCQl0aGlzLmJ1c3koZmFsc2UpOwoJfQoKCUVkaXRlZFZhbHVlKGUpIHsKCQlyZXR1cm4gKHR5cGVvZihhY2UpICE9PSAidW5kZWZpbmVkIikgPyBhY2UuZWRpdCgncG5sJyArIGUubmFtZSkuc2Vzc2lvbi5nZXRWYWx1ZSgpIDogJyc7Cgl9CgoJYXN5bmMgUGFuT25DbG9zZShlKSB7CgkJaWYgKGUuZWRpdG9yKSB7CgkJCWUudmFsdWUgPSB0aGlzLkVkaXRlZFZhbHVlKGUpOwoJCX0KCQlpZiAoZS5jbG9zZSkgewoJCQlhd2FpdCBlLmNsb3NlKHRoaXMuZ2V0KCkpOwoJCX0KCX0KCglhc3luYyBQZW5kQWZ0ZXJPcGVuKGUpIHsKCQlpZiAoZS5lZGl0b3IgJiYgdHlwZW9mKGFjZSkgIT09ICJ1bmRlZmluZWQiKSB7CgkJCWF3YWl0IF9GckVNRC5PcGVuRWRpdG9yKCdwbmwnICsgZS5uYW1lIC8qKyAnLWNlbnRlcicqLyAsIGUubGFuZ3VhZ2UsIGUubG9hZGVyIHx8IChvID0+IGUudmFsdWUpLCBlLnNhdmVyLCB0aGlzLmdldCgpLCBlKTsKCQl9CgkJaWYgKGUub3BlbikgewoJCQlhd2FpdCBlLm9wZW4odGhpcy5nZXQoKSk7CgkJfQoJfQoKCWxpbmsob3B0aW9ucykgewoJCXJldHVybiAob3B0aW9ucy5saW5rcyB8fCBbXSkuZmlsdGVyKGwgPT4gIWwuaWdub3JlKS5tYXAobCA9PiBgPGEgaHJlZj0iIyIgY2xhc3M9ImVhc3l1aS0ke3RoaXMudWlUeXBlc1tvcHRpb25zLnR5cGVdfSIgZGF0YS1vcHRpb25zPScke3RoaXMuZXZlbnRIYW5kbGVycyhvcHRpb25zKX0sIGljb25DbHM6Imljb24tJHtsLmljb24gfHwgJ29rJ30iJz4ke2wubGFiZWx9PC9hPmApLmpvaW4oJ1xuJyk7Cgl9CgoJYXN5bmMgU2V0VHJlZURhdGEoZSwgbiwgZGF0YSkgewoJCSQuZWFjaCgkKCIjY21iIiArIGUubmFtZSlbdGhpcy5lRnVuKGUpXSgndHJlZScpLnRyZWUoImdldENoaWxkcmVuIiwgbi50YXJnZXQpLCAoXywgYykgPT4gJCgiI2NtYiIgKyBlLm5hbWUpW3RoaXMuZUZ1bihlKV0oJ3RyZWUnKS50cmVlKCJyZW1vdmUiLCBjLnRhcmdldCkpOwoJCSQoIiNjbWIiICsgZS5uYW1lKVt0aGlzLmVGdW4oZSldKCd0cmVlJykudHJlZSgiYXBwZW5kIiwgewoJCQlwYXJlbnQ6IG4udGFyZ2V0LAoJCQlkYXRhOiBkYXRhCgkJfSk7CgkJcmV0dXJuIHRydWU7Cgl9CgoJYXN5bmMgRXhwYW5kKGUsIG4pIHsKCQl0aGlzLlNldFRyZWVEYXRhKGUsIG4sIFt7CgkJCWlkOiBudWxsLAoJCQl0ZXh0OiAibG9hZGluZy4uLiIKCQl9XSk7CgkJdmFyIG9iaiA9IHt9OwoJCXZhciBwRmllbGQgPSBlLnBhcmVudEZpZWxkIHx8ICQubWFwKCQuZ3JlcChlLmNvbHVtbnMgfHwgW10sIGMgPT4gYy5wYXJlbnQpLCBjID0+IGMuZmllbGQpLmNvbmNhdChbbnVsbF0pWzBdOwoJCXZhciBpZEZpZWxkID0gJC5ncmVwKGUuY29sdW1ucyB8fCBbXSwgYyA9PiBjLnByaW1hcnkpLmNvbmNhdChlLmlkRmllbGQpWzBdLmZpZWxkOwoJCWlmIChwRmllbGQpIHsKCQkJb2JqW3BGaWVsZF0gPSB7CgkJCQlfc291cmNlOiBuLl9zb3VyY2UKCQkJfTsKCQkJaWYgKGlkRmllbGQpIHsKCQkJCW9ialtwRmllbGRdW2lkRmllbGRdID0gbi5pZDsKCQkJfSBlbHNlIHsKCQkJCW9ialtwRmllbGRdID0gbi5pZDsKCQkJfQoJCX0KCQlsZXQgZGF0YSA9IGF3YWl0IHRoaXMuX2xvYWREYXRhKHsKCQkJaWQ6ICJjbWIiICsgZS5uYW1lLAoJCQlvcHRpb25zOiBlCgkJfSwgb2JqKTsKCQl0aGlzLlNldFRyZWVEYXRhKGUsIG4sIGRhdGEpOwoJfQoKCWFzeW5jIF9sb2FkRGF0YShzLCBvLCBzdGFydCwgZW5kKSB7CgkJdmFyIG5hbWUgPSAocyAmJiBzLm9wdGlvbnMgPyAocy5vcHRpb25zLkNsYXNzID8gcy5vcHRpb25zLkNsYXNzLk5hbWUucmVwbGFjZSgnICcsICdfJykgOiAocy5vcHRpb25zLnRhYmxlIHx8IHMub3B0aW9ucy5uYW1lKSkgOiBzLm5hbWUpOwoKCQlsZXQgb1Njb3BlID0gKHR5cGVvZihjb21wYW55KSAhPT0gJ3VuZGVmaW5lZCcgJiYgY29tcGFueS5TY29wZSkgPyB3aW5kb3dbY29tcGFueS5TY29wZV0gOiB3aW5kb3c7CgkJbyA9IG8gfHwgKG9TY29wZVtuYW1lXSA/IG5ldyBvU2NvcGVbbmFtZV0oKSA6IHsKCQkJQWN0aXZlOiB0cnVlLAoJCX0pOwoJCW8gPSAodHlwZW9mIGZpbHRlcnMgIT09ICJ1bmRlZmluZWQiICYmIGZpbHRlcnMgJiYgZmlsdGVyc1tuYW1lXSkgPyBmaWx0ZXJzW25hbWVdKG8pIDogbzsKCQlvID0gKHMgJiYgcy5vcHRpb25zICYmIHMub3B0aW9ucy5zb3VyY2UgPyBzLm9wdGlvbnMuc291cmNlKG8sIHRoaXMuZ2V0KCkpIDogbyk7CgkJbGV0IG5hbWVzID0gJC51bmlxdWVTb3J0KFtzLm9wdGlvbnMuc2VhcmNoRmllbGRdLmNvbmNhdCgkLm1hcCgkLmdyZXAocy5vcHRpb25zLmNvbHVtbnMgfHwgW10sIGMgPT4gYy5zZWFyY2gpLCBjID0+IGMuZmllbGQpLCBbIk5hbWUiXSkpOwoJCXZhciBmdW4gPSB0aGlzLmVGdW4ocy5vcHRpb25zKTsKCQlpZiAoIW9bbmFtZXNbMF1dKSBvW25hbWVzWzBdXSA9ICQoIiMiICsgcy5pZClbZnVuXSgnZ2V0VGV4dCcpOwoJCXZhciBkYXRhID0gbnVsbDsKCgkJbGV0IGxpYiA9ICcnOwoJCWlmIChuYW1lLmluZGV4T2YoJy4nKSA+IDApIHsKCQkJbGliID0gbmFtZS5zcGxpdCgnLicpWzBdICsgJy4nOwoJCQluYW1lID0gbmFtZS5zcGxpdCgnLicpWzFdOwoJCX0KCgkJaWYgKHMub3B0aW9ucy5sb2FkZXIpIHsKCQkJZGF0YSA9IGF3YWl0IHMub3B0aW9ucy5sb2FkZXIodGhpcy5nZXQoKSwgcy5vcHRpb25zLCBvKTsKCQl9IGVsc2UgaWYgKHR5cGVvZihjb21wYW55KSAhPT0gJ3VuZGVmaW5lZCcgJiYgY29tcGFueS5saWJyYXJ5KSB7CgkJCWRhdGEgPSBhd2FpdCB0aGlzLnNyKCkuXyhsaWIgKyBjb21wYW55LkNvZGUudG9Mb3dlckNhc2UoKSArIG5hbWUgKyAiRmluZGFsbCIsIG51bGwsIG8sIG51bGwsIHN0YXJ0LCBlbmQpOwoJCX0gZWxzZSBpZiAoX0ZyRU1ELmFwaVNlcnZlcikgewoJCQlkYXRhID0gYXdhaXQgX0ZyRU1ELmFwaVNlcnZlci5fbmV3KG5hbWUpLl9mcm9tRG9jdW1lbnQobykuZmluZEFsbCgpOwoJCX0gZWxzZSB7CgkJCS8vIGVtcwoJCQlkYXRhID0gYXdhaXQgby5maW5kQWxsKCk7CgkJCS8vZGF0YSA9IGF3YWl0IHdpbmRvdy5fRnJFTUQuX28obnVsbCwgbyk7CgkJfQoJCWlmIChzLm9wdGlvbnMucG9zdGxvYWQpIHsKCQkJYXdhaXQgcy5vcHRpb25zLnBvc3Rsb2FkKGRhdGEpOwoJCX0KCQkkLmVhY2goZGF0YSwgKGksIGQpID0+IHsKCQkJZC5fX09XTkVSID0gczsKCQkJJC5lYWNoKHMub3B0aW9ucy5jb2x1bW5zLCAoXywgYykgPT4gewoJCQkJaWYgKGMudmFsdWUpIHsKCQkJCQlkW2MuZmllbGRdID0gYy52YWx1ZShkLCBkYXRhLCBpKTsKCQkJCX0KCQkJfSk7CgkJfSk7CgkJaWYgKCFzLm9wdGlvbnMuY29sdW1ucyAmJiBmdW4uaW5kZXhPZigndHJlZScpID4gLTEpIHsKCQkJZGF0YSA9ICQubWFwKGRhdGEsIGQgPT4gewoJCQkJbGV0IHJldCA9IHsKCQkJCQlpZDogZFtzLm9wdGlvbnMuaWRGaWVsZC5maWVsZF0sCgkJCQkJdGV4dDogZFtzLm9wdGlvbnMudGV4dEZpZWxkLmZpZWxkXSwKCQkJCQlzdGF0ZTogZC5zdGF0ZSB8fCAocy5vcHRpb25zLmxvYWRlciA/ICJmaWxlIiA6ICJjbG9zZWQiKSwKCQkJCQlfc291cmNlOiBkLAoJCQkJfTsKCQkJCXJldC5jaGlsZHJlbiA9IChyZXQuc3RhdGUgPT0gImNsb3NlZCIpID8gW3sKCQkJCQl0ZXh0OiAnbG9hZGluZy4uLicKCQkJCX1dIDogbnVsbDsKCQkJCXJldHVybiByZXQ7CgkJCX0pOwoJCX0KCQlyZXR1cm4gZGF0YSB8fCBbXTsKCX0KCglhc3luYyBmaWxsRGF0YShnLCBvLCBzdGFydCwgZW5kKSB7CgkJdmFyIHMgPSBudWxsOwoJCWZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5zZWxlY3RzLmxlbmd0aDsgaSsrKSB7CgkJCWlmICh0aGlzLnNlbGVjdHNbaV0uaWQgPT0gZ1swXS5pZCkgcyA9IHRoaXMuc2VsZWN0c1tpXTsKCQl9CgkJaWYgKCFzKSByZXR1cm47CgkJdGhpcy5idXN5KHRydWUpOwoJCXRyeSB7CgkJCXZhciBmdW4gPSBnWzBdLmNsYXNzTGlzdFsiMCJdLnJlcGxhY2UoJ2Vhc3l1aS0nLCAnJyk7CgkJCXRyeSB7CgkJCQkkKCIjIiArIHMuaWQpW2Z1bl0oJ2dyaWQnKS5kYXRhZ3JpZCgnZ2V0UGFnZXInKS5wYWdpbmF0aW9uKCdsb2FkaW5nJyk7CgkJCX0gY2F0Y2ggKGV4KSB7fQoJCQlpZiAocy5vcHRpb25zLm5vbG9hZCkgewoJCQkJbGV0IF9kYXRhID0gbnVsbDsKCQkJCXRyeSB7CgkJCQkJX2RhdGEgPSAkKCIjIiArIHMuaWQpW2Z1bl0oJ2dyaWQnKS5kYXRhZ3JpZCgiZ2V0RGF0YSIpOwoJCQkJfSBjYXRjaCAoZXgpIHsKCQkJCQlfZGF0YSA9ICQoIiMiICsgcy5pZClbZnVuXSgndHJlZScpLnRyZWUoJ2dldFJvb3QnKTsKCQkJCX0KCQkJCWlmIChfZGF0YSkgewoJCQkJCXJldHVybiB0aGlzLmJ1c3koZmFsc2UpOwoJCQkJfQoJCQl9CgkJCXZhciBkYXRhID0gYXdhaXQgdGhpcy5fbG9hZERhdGEocywgbywgc3RhcnQsIGVuZCk7CgkJCXRyeSB7CgkJCQlpZiAoJCgiIyIgKyBzLmlkKVtmdW5dKCdncmlkJykpICQoIiMiICsgcy5pZClbZnVuXSgnZ3JpZCcpLmRhdGFncmlkKCdnZXRQYWdlcicpLnBhZ2luYXRpb24oJ2xvYWRlZCcpOwoJCQl9IGNhdGNoIChleCkge30KCQkJdHJ5IHsKCQkJCSQoIiMiICsgcy5pZClbZnVuXSgnZ3JpZCcpLmRhdGFncmlkKCdsb2FkRGF0YScsIHsKCQkJCQl0b3RhbDogZGF0YS5Db3VudCB8fCBkYXRhLmxlbmd0aCwKCQkJCQlyb3dzOiBkYXRhLAoJCQkJfSk7CgkJCX0gY2F0Y2ggKGV4KSB7CgkJCQkkKCIjIiArIHMuaWQpW2Z1bl0oJ3RyZWUnKS50cmVlKCdsb2FkRGF0YScsIGRhdGEpOwoJCQl9CgkJfSBjYXRjaCAoZXgpIHsKCQkJY29uc29sZS5sb2coZXgpOwoJCX0KCQl0aGlzLmJ1c3koZmFsc2UpOwoJfQoKCWV2ZW50SGFuZGxlcnMob3B0aW9ucykgewoJCWlmICghdGhpcy5ieU5hbWUob3B0aW9ucy5uYW1lKSkgcmV0dXJuOyAvLyBpZiBub3QgYW4gZWxlbWVudCwgZG8gbm90IHJ1biB0aGUgaGFuZGxlcnMKCgkJcmV0dXJuIHRoaXMuZXZlbnRzLmZpbHRlcihlID0+IGUudHlwZSA9PSBvcHRpb25zLnR5cGUgfHwgdHlwZW9mKGUudHlwZSkgPT09ICd1bmRlZmluZWQnKS5tYXAoZSA9PiBgJHtlLm5hbWV9OiAoJHtlLnBhcmFtcyB8fCAnJ30pID0+IHt0cnl7REZvcm0uJHtlLmhhbmRsZXJ9KERGb3JtLmJ5TmFtZSgiJHtvcHRpb25zLm5hbWV9IikgfHwgJHtfRnJFTUQuX3RvSlMob3B0aW9ucyl9IHx8IHtuYW1lOiAiJHtvcHRpb25zLm5hbWV9Iix0eXBlOiAiJHtvcHRpb25zLnR5cGV9In0sICR7ZS5wYXJhbXN9KX1jYXRjaChleCl7Y29uc29sZS5sb2coIkV2ZW50IEVycm9yOiAke29wdGlvbnMubmFtZX0vJHtvcHRpb25zLnR5cGV9LyR7ZS5uYW1lfSIsIGV4KTt9fWApLmpvaW4oJywnKTsKCX0KCglhc3luYyBQYW5lbE9wZW4oZSkgewoJCWlmIChlLmVkaXRvcikgcmV0dXJuIHRydWU7CgkJbGV0IGNvbnRlbnQgPSBlLnZhbHVlOwoJCWlmIChlLmxvYWRlcikgewoJCQljb250ZW50ID0gYXdhaXQgZS5sb2FkZXIodGhpcy5nZXQoKSk7CgkJfQoJCWlmIChjb250ZW50KSB7CgkJCXRyeSB7CgkJCQkkKCIjcG5sIiArIGUubmFtZSkucGFuZWwoJ2JvZHknKS5odG1sKGNvbnRlbnQpOwoJCQkJY29uc29sZS5sb2coInBubCIgKyBlLm5hbWUgKyAiOiBDb250ZW50IFZhbGlkIik7CgkJCX0gY2F0Y2ggKGV4KSB7CgkJCQkvL2NvbnNvbGUubG9nKGV4KTsKCQkJfQoJCX0KCQlyZXR1cm4gY29udGVudDsKCX0KCglhc3luYyBTZWxlY3RDaGFuZ2Uob3B0aW9ucywgdGFiKSB7CgkJdGhpcy5idXN5KHRydWUpOwoJCSQuZ3JlcCh0aGlzLmVsZW1lbnRzLCBlID0+IGUudHlwZSA9PSAiZ3JpZCIgJiYgZS5ncm91cCA9PSB0YWIpLmZvckVhY2goZSA9PiAkKCIjY21iIiArIGUubmFtZSkuZGF0YWdyaWQoKSk7CgkJdGhpcy5idXN5KGZhbHNlKTsKCX0KCglhc3luYyBGaWVsZENoYW5nZShvcHRpb25zLCB2YWx1ZSkgewoJCXRoaXMuYnVzeSh0cnVlKTsKCQlpZiAob3B0aW9ucyAmJiBvcHRpb25zLmNoYW5nZSkgewoJCQlhd2FpdCBvcHRpb25zLmNoYW5nZSh0aGlzLmdldCgpLCB2YWx1ZSk7CgkJfQoJCXRoaXMuYnVzeShmYWxzZSk7Cgl9CgoJYXN5bmMgVVJMQ2hhbmdlKHMsIG9wdGlvbnMpIHsKCQl0aGlzLmJ1c3kodHJ1ZSk7CgkJb3B0aW9ucy5kYXRhID0gYXdhaXQgJC5nZXQocy52YWx1ZSk7CgkJcmV0dXJuIGF3YWl0IHRoaXMuRmllbGRDaGFuZ2Uocywgb3B0aW9ucyk7Cgl9CgoJVXBsb2FkRmlsZShmLCBvcHRpb25zKSB7CgkJd2luZG93LkRGb3JtLmJ1c3kodHJ1ZSk7CgkJdmFyIGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKCk7CgkJdmFyIGZpbGVpZCA9IE1hdGgucmFuZG9tKCk7CgkJdmFyIG1ldGhvZCA9IG9wdGlvbnMubWV0aG9kIHx8ICJDb250ZW50TWFuYWdlci5jbXNVcGxvYWRGaWxlIjsKCQlmb3JtRGF0YS5hcHBlbmQoJ2ZpbGVpZCcsIGZpbGVpZCk7CgkJdmFyIGZpbGUgPSAkKCIjIiArIGYuZmlsZWJveElkKVswXS5maWxlc1swXTsKCQlmb3JtRGF0YS5hcHBlbmQoJ19fVUZJTEUnLCBmaWxlKTsKCQlpZiAob3B0aW9ucy5sb2NhbCkgewoJCQkvLyBoYW5kbGluZyB0aGUgZmlsZSBsb2NhbGx5CgkJCXZhciByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpOwoJCQlyZWFkZXIub25sb2FkID0gKGUpID0+IHsKCQkJCXZhciBkYXRhID0gZS50YXJnZXQucmVzdWx0OwoJCQkJcmV0ID0gZGF0YTsKCQkJCXdpbmRvdy5ERm9ybS5ieU5hbWUob3B0aW9ucy5uYW1lKS5kYXRhID0gcmV0OwoJCQkJaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy51cGxvYWQpIG9wdGlvbnMudXBsb2FkKHdpbmRvdy5ERm9ybS5nZXQoKSwgcmV0KTsKCQkJfTsKCQkJaWYgKG9wdGlvbnMuYmluYXJ5KSB7CgkJCQlyZWFkZXIucmVhZEFzQmluYXJ5U3RyaW5nKGZpbGUpOwoJCQl9IGVsc2UgaWYgKG9wdGlvbnMuZGF0YXVybCkgewoJCQkJcmVhZGVyLnJlYWRBc0RhdGFVUkwoZmlsZSk7CgkJCX0gZWxzZSB7CgkJCQlyZWFkZXIucmVhZEFzVGV4dChmaWxlKTsKCQkJfQoJCQl3aW5kb3cuREZvcm0uYnVzeShmYWxzZSk7CgkJfSBlbHNlIGlmIChtZXRob2QpIHsKCQkJJC5hamF4KHsKCQkJCXVybDogdGhpcy5zcigpLnNyVVJMICsgIiZtZXRob2Q9IiArIG1ldGhvZCArICImc0lucHV0PSIgKyBmaWxlaWQgKyAiJnByZVRhZz0mcG9zdFRhZz0iLAoJCQkJZGF0YTogZm9ybURhdGEsCgkJCQkvLyBUSElTIE1VU1QgQkUgRE9ORSBGT1IgRklMRSBVUExPQURJTkcKCQkJCWNhY2hlOiBmYWxzZSwKCQkJCWNvbnRlbnRUeXBlOiBmYWxzZSwKCQkJCXR5cGU6ICdQT1NUJywKCQkJCXByb2Nlc3NEYXRhOiBmYWxzZSwKCQkJCXN1Y2Nlc3M6IGRhdGEgPT4gewoJCQkJCXRoaXMuc3IoKS5ydW5TY3JpcHQoZGF0YSk7CgkJCQkJd2luZG93LkRGb3JtLmJ5TmFtZShvcHRpb25zLm5hbWUpLmRhdGEgPSByZXQ7CgkJCQkJaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy51cGxvYWQpIG9wdGlvbnMudXBsb2FkKHdpbmRvdy5ERm9ybS5nZXQoKSwgcmV0KTsKCQkJCQl3aW5kb3cuREZvcm0uYnVzeShmYWxzZSk7CgkJCQl9CgkJCX0pOwoJCX0KCX0KCgllRnVuKGUpIHsKCQl0cnkgewoJCQlpZiAoZS50eXBlID09ICJ0cmVlIikgewoJCQkJaWYgKGUuY29sdW1ucykgewoJCQkJCXJldHVybiAiY29tYm90cmVlZ3JpZCI7CgkJCQl9IGVsc2UgaWYgKHR5cGVvZihlLmNvbWJvKSAhPT0gJ3VuZGVmaW5lZCcgJiYgIWUuY29tYm8pIHsKCQkJCQlyZXR1cm4gJ3RyZWUnOwoJCQkJfSBlbHNlIHsKCQkJCQlyZXR1cm4gImNvbWJvdHJlZSI7CgkJCQl9CgkJCX0gZWxzZSBpZiAoZS50eXBlID09ICduYXZpZ2F0aW9uJykgewoJCQkJcmV0dXJuICd0cmVlJzsKCQkJfSBlbHNlIGlmIChlLnR5cGUgPT0gImNvbWJvdHJlZSIpIHsKCQkJCXJldHVybiAiY29tYm90cmVlZ3JpZCI7CgkJCX0gZWxzZSBpZiAoZS50eXBlID09ICJzZWxlY3QiICYmIGUub3B0aW9ucykgewoJCQkJcmV0dXJuICJjb21ib2JveCI7CgkJCX0KCQkJcmV0dXJuICJjb21ib2dyaWQiOwoJCX0gY2F0Y2ggKGV4KSB7CgkJCXJldHVybiAiY29tYm9ncmlkIjsKCQl9Cgl9CgoJX2ZpbGxXaW5kb3cod2luTmFtZSwgdiwgbWFwKSB7CgkJdiA9IHYgfHwge307CgkJbWFwID0gbWFwIHx8IHt9OwoJCWlmIChBcnJheS5pc0FycmF5KG1hcCkpIHsKCQkJbWFwID0gT2JqZWN0LmZyb21FbnRyaWVzKG5ldyBNYXAobWFwKSk7CgkJfQoKCQltYXAgPSAkLmV4dGVuZCh7fSwgbWFwLCBPYmplY3QuZnJvbUVudHJpZXMoT2JqZWN0LmtleXModikubWFwKGsgPT4gW3dpbk5hbWUgKyBrLCBrXSkpKTsKCgkJbGV0IHMgPSB7fTsKCQlmb3IgKHZhciBtIGluIG1hcCkgewoJCQlpZiAodHlwZW9mKHZbbWFwW21dXSkgPT09ICJ1bmRlZmluZWQiKSB7CgkJCQkvL2NvbnNvbGUubG9nKCdpc191bmRlZmluZWQnLCBtLCBtYXBbbV0sIHZbbWFwW21dXSk7CgkJCQlzW21dID0gbWFwW21dOwoJCQl9IGVsc2UgewoJCQkJLy9jb25zb2xlLmxvZygnaXNfbm90X3VuZGVmaW5lZCcsIG0sIG1hcFttXSwgdlttYXBbbV1dKTsKCQkJCXNbbV0gPSB2W21hcFttXV07CgkJCX0KCQl9CgkJdGhpcy5jbGVhcih3aW5OYW1lKTsKCQkvL2NvbnNvbGUubG9nKCJzIiwgcyk7CgkJdGhpcy5zZXQocyk7CgkJJCgiI3BubF8iICsgd2luTmFtZSkud2luZG93KCJvcGVuIik7Cgl9CgoJd2luZG93VG9FbnRpdHkobywgYkVtcHR5LCBncmlkLCBwcmVmaXgsIGZpbHRlcikgewoJCW8gPSBvIHx8IHRoaXMuZ2V0KCk7CgkJZmlsdGVyID0gZmlsdGVyIHx8ICh2ID0+IHYpOwoJCWxldCByZXQgPSBncmlkID8gKGdyaWQuc2VsZWN0ZWQgfHwgZ3JpZCkgOiBudWxsOwoJCWlmIChiRW1wdHkpIHsKCQkJcmV0ID0ge307CgkJCW8gPSB7fTsKCQl9IGVsc2UgewoJCQlyZXQgPSAocmV0ICYmIHJldC5JZCkgPyB7CgkJCQlJZDogcmV0LklkCgkJCX0gOiB7fTsKCQl9CgoJCXRoaXMuZWxlbWVudHMuZmlsdGVyKGUgPT4gKHByZWZpeCA/IGUuZ3JvdXAgPT0gcHJlZml4IDogdHJ1ZSkgJiYgZS50eXBlICE9ICdsaW5rJyAmJiBbJ18nXS5pbmRleE9mKGUubmFtZS5yZXBsYWNlKHByZWZpeCwgIiIpKSA8IDApLmZvckVhY2goZSA9PiB7CgkJCXJldFtlLm5hbWUucmVwbGFjZShwcmVmaXgsICIiKV0gPSBvW2UubmFtZV07CgkJCXJldHVybiB0cnVlOwoJCX0pOwoKCQlmaWx0ZXIocmV0KTsKCgkJcmV0dXJuIHJldDsKCX0KCgliaW5kKG9iaikgewoJCXZhciBvYmpCaW5kID0gKG8sIGUpID0+IHsKCQkJb1t0aGlzLmVGdW4oZSldKHsKCQkJCW9uU2hvd1BhbmVsOiAoKSA9PiB7CgkJCQkJdGhpcy5maWxsRGF0YSgkKCIjIiArIGUuaWQpLCBudWxsLCAwLCAxMCk7CgkJCQl9LAoJCQkJb25DbGlja1JvdzogKGluZGV4LCByb3cpID0+IHsKCQkJCQl2YXIgcyA9IHJvdyA/IHJvdy5fX09XTkVSIDogbnVsbDsKCQkJCQlpZiAocyAmJiBzLm9wdGlvbnMuc2VsZWN0KSB7CgkJCQkJCXMub3B0aW9ucy5zZWxlY3Qocm93KTsKCQkJCQl9CgkJCQl9CgkJCX0pOwoJCQl0cnkgewoJCQkJdmFyIGRnID0gb1t0aGlzLmVGdW4oZSldKCdncmlkJyk7CgkJCQkvLyBkZy5kYXRhZ3JpZCgnZW5hYmxlRmlsdGVyJykKCQkJCXZhciBzdGF0ZSA9IGRnLmRhdGEoJ2RhdGFncmlkJyk7CgkJCQl2YXIgb3B0cyA9IHN0YXRlLm9wdGlvbnM7CgkJCQl2YXIgb25CZWZvcmVMb2FkID0gb3B0cy5vbkJlZm9yZUxvYWQ7CgkJCQlvcHRzLm9uQmVmb3JlTG9hZCA9IChwYXJhbSkgPT4gewoJCQkJCXN0YXRlLmFsbFJvd3MgPSBudWxsOwoJCQkJCXJldHVybiBvbkJlZm9yZUxvYWQuY2FsbCh0aGlzLCBwYXJhbSk7CgkJCQl9OwoJCQkJdmFyIHBhZ2VyID0gZGcuZGF0YWdyaWQoJ2dldFBhZ2VyJyk7CgkJCQlkZy5kYXRhZ3JpZCgnZ2V0UGFuZWwnKS5wYW5lbCh7CgkJCQkJSUQ6IGkKCQkJCX0pOwoJCQkJcGFnZXIucGFnaW5hdGlvbih7CgkJCQkJb25TZWxlY3RQYWdlOiBmdW5jdGlvbihwYWdlTnVtLCBwYWdlU2l6ZSkgewoJCQkJCQl3aW5kb3cuREZvcm0uZmlsbERhdGEoJCgiIyIgKyB3aW5kb3cuREZvcm0uc2VsZWN0c1skKHRoaXMucGFyZW50Tm9kZSkucGFuZWwoJ29wdGlvbnMnKS5JRF0uaWQpLCBudWxsLCBwYWdlU2l6ZSAqIChwYWdlTnVtIC0gMSksIHBhZ2VTaXplICogcGFnZU51bSk7CgkJCQkJfQoJCQkJfSk7CgkJCQlkZy5kYXRhZ3JpZCgnbG9hZERhdGEnLCBzdGF0ZS5kYXRhKTsKCQkJfSBjYXRjaCAoZXgpIHt9CgkJfQoJCWlmIChvYmopIHsKCQkJb2JqQmluZChvYmopOwoJCX0gZWxzZSB7CgkJCWZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5zZWxlY3RzLmxlbmd0aDsgaSsrKSB7CgkJCQlpZiAodGhpcy5zZWxlY3RzW2ldLm9wdGlvbnMub3B0aW9ucykgewoJCQkJCS8vJCgiIyIgKyB0aGlzLnNlbGVjdHNbaV0uaWQpLmNvbWJvKCk7CgkJCQl9IGVsc2UgewoJCQkJCW9iakJpbmQoJCgiIyIgKyB0aGlzLnNlbGVjdHNbaV0uaWQpLCB0aGlzLnNlbGVjdHNbaV0pOwoJCQkJfQoJCQl9CgoJCQl0aGlzLmVsZW1lbnRzLmZpbHRlcihlID0+IGUud2luZG93KS5mb3JFYWNoKGUgPT4gewoJCQkJbGV0IHQgPSAkKCIjdGJjV2luZG93IikudGFicygiZ2V0VGFiIiwgZS5ncm91cCk7CgkJCQlpZiAodCkgewoJCQkJCXQucGFuZWwoJ29wdGlvbnMnKS50YWIuaGlkZSgpOwoJCQkJfQoJCQl9KTsKCQl9Cgl9CgoJZW5nbGlzaChzKSB7CgkJaWYgKCFzKSByZXR1cm4gIiI7CgkJdmFyIHJlc3VsdCA9IHMucmVwbGFjZSgvKFtBLVpdKS9nLCAiICQxIik7CgkJcmVzdWx0ID0gcmVzdWx0LnJlcGxhY2UoL18vZywgJycpOwoJCXJldHVybiByZXN1bHQuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyByZXN1bHQuc2xpY2UoMSk7Cgl9CgoJb25Ub2dnbGUoZSwgYlZhbHVlKSB7CgkJbGV0IHNUYWcgPSBgI2ZFbGVtZW50XyR7ZS5mb3IubmFtZX0gPiAuZWFzeXVpLSR7dGhpcy51aVR5cGVzW2UuZm9yLnR5cGVdfWA7CgkJbGV0IG9UYWcgPSAkKHNUYWcpOwoJCWUuZm9yLmVuYWJsZWQgPSB0eXBlb2YoYlZhbHVlKSA9PT0gInVuZGVmaW5lZCIgPyAhZS5mb3IuZW5hYmxlZCA6IGJWYWx1ZTsKCgkJb1RhZy5wcm9wKCJkaXNhYmxlZCIsICFlLmZvci5lbmFibGVkKTsKCQkvL29UYWdbdGhpcy51aVR5cGVzW2UuZm9yLnR5cGVdXShlLmZvci5lbmFibGVkID8gImVuYWJsZSIgOiAiZGlzYWJsZSIpOwoJCWNvbnNvbGUubG9nKHNUYWcsIG9UYWcsIHRoaXMudWlUeXBlc1tlLmZvci50eXBlXSwgZS5mb3IuZW5hYmxlZCk7Cgl9CgoJcmVuZGVyKG5hbWUsIHRpdGxlLCBlbGVtZW50cywgYnV0dG9ucywgYkZpeGVkKSB7CgkJdGhpcy5lbGVtZW50cyA9IChlbGVtZW50cyB8fCBbXSkuZmlsdGVyKGUgPT4gIWUuaWdub3JlKTsKCgkJdGhpcy5idXR0b25zID0gYnV0dG9ucyB8fCBbXTsKCQl0aGlzLnNlbGVjdHMgPSBbXTsKCQl0aGlzLmdyaWRzID0gW107CgoJCXRoaXMuZWxlbWVudHMuZmlsdGVyKGUgPT4gZS50eXBlID09ICJ3aW5kb3ciKS5mb3JFYWNoKHcgPT4gdGhpcy5lbGVtZW50cy5zcGxpY2UodGhpcy5lbGVtZW50cy5maW5kSW5kZXgoZSA9PiBlLm5hbWUgPT0gdy5uYW1lKSwgMCwgewoJCQluYW1lOiAiXyIgKyB3Lm5hbWUsCgkJCXR5cGU6ICJsaW5rIiwKCQkJdGl0bGU6IHcudGl0bGUgfHwgdy5uYW1lLAoJCQlncm91cDogdy5ncm91cCwKCQkJd2luZG93OiB3LndpbmRvdywKCQkJc2VjdGlvbjogdy5zZWN0aW9uLAoJCQlsaW5rczogW3sKCQkJCWxhYmVsOiAnT3BlbicsCgkJCQlpY29uOiAnZWRpdCcsCgkJCQlvbkNsaWNrOiBvID0+ICQoIiNwbmwiICsgdy5uYW1lKS53aW5kb3coJ29wZW4nKQoJCQl9XSwKCQl9KSk7CgoJCXRoaXMuc3IoKS5ncm91cEJ5KHRoaXMuZWxlbWVudHMuZmlsdGVyKGUgPT4gZS53aW5kb3cpLCAiZ3JvdXAiKS5mb3JFYWNoKGt2ID0+IHsKCQkJaWYgKCFrdi5rZXkpIHJldHVybjsKCgkJCWxldCBlID0gewoJCQkJbmFtZTogIl8iICsga3Yua2V5LAoJCQkJdGl0bGU6IGt2LmtleSwKCQkJCXR5cGU6ICJ3aW5kb3ciLAoJCQkJZ3JvdXA6IGt2LmtleSwKCQkJCXdpZHRoOiB0aGlzLndpZHRoICogMC45LAoJCQkJaGVpZ2h0OiB0aGlzLmhlaWdodCAqIDAuOSwKCQkJCWxvYWRlcjogbyA9PiB7CgkJCQkJa3YudmFsdWVzLmZpbHRlcih2ID0+IHYudHlwZSAhPT0gJ2xpbmsnIHx8ICh2LnR5cGUgPT0gJ2xpbmsnICYmIHYubmFtZS5zdGFydHNXaXRoKCdfJykpKS5mb3JFYWNoKHYgPT4gJCgiI3BubF8iICsgdi5ncm91cCArICctY2VudGVyJykuYXBwZW5kKCQoIiNmRWxlbWVudF8iICsgdi5uYW1lKSkpOwoJCQkJCXJldHVybiBudWxsOwoJCQkJfSwKCQkJCWJ1dHRvbnM6IFtdLmNvbmNhdC5hcHBseShbXSwga3YudmFsdWVzLmZpbHRlcih2ID0+IHYudHlwZSA9PSAnbGluaycgJiYgIXYubmFtZS5zdGFydHNXaXRoKCdfJykpLm1hcCh2ID0+IFsuLi52LmxpbmtzLm1hcChsID0+ICh7CgkJCQkJbmFtZTogbC5uYW1lIHx8IGwubGFiZWwsCgkJCQkJdGl0bGU6IGwudGl0bGUgfHwgbC5sYWJlbCwKCQkJCQlvbkNsaWNrOiBsLm9uQ2xpY2ssCgkJCQkJaWNvbjogbC5pY29uLAoJCQkJCXdpbmRvdzogdHJ1ZSwKCQkJCQlncm91cDoga3Yua2V5LAoJCQkJfSkpXSkpLAoJCQl9OwoJCQl0aGlzLmJ1dHRvbnMucHVzaCguLi5lLmJ1dHRvbnMpOwoKCQkJdGhpcy5lbGVtZW50cy5wdXNoKGUpOwoJCX0pOwoKCQl2YXIgcmV0ID0gIiI7CgkJLy8gY2hlY2sgdGhlIG9wdGlvbiBvZiB1c2luZyB3aW5kb3coKSBhcyBhIHJlbmRlcmVyIG9mIHRoZSBtYWluIHdpbmRvdy4uLgoJCWlmICh0cnVlKSB7CgkJCXRoaXMuZWxlbWVudHMuZmlsdGVyKGUgPT4gIWUuem9uZSkuZm9yRWFjaChlID0+IGUuem9uZSA9ICdjZW50ZXInKTsKCQkJbGV0IHdPcHRpb25zID0gewoJCQkJbmFtZTogbmFtZSB8fCB0aGlzLm5hbWUsCgkJCQl0aXRsZTogdGl0bGUgfHwgdGhpcy50aXRsZSwKCQkJCXR5cGU6ICd3aW5kb3cnLAoJCQkJdmlzaWJsZTogdHJ1ZSwKCQkJCXdpZHRoOiB0aGlzLndpZHRoLAoJCQkJaGVpZ2h0OiB0aGlzLmhlaWdodCwKCQkJCWZpeGVkOiBiRml4ZWQsCgkJCQlsaW5rczogW3sKCQkJCQlpY29uOiAiaGVscCIsCgkJCQkJYWN0aW9uOiBvID0+ICQoIiNwbmxfX0NvbnNvbGUiKS53aW5kb3coJ29wZW4nKQoJCQkJfV0sCgkJCQlidXR0b25zOiB0aGlzLmJ1dHRvbnMuZmlsdGVyKGIgPT4gIWIud2luZG93KSwKCQkJfTsKCQkJdGhpcy5zcigpLmdyb3VwQnkodGhpcy5lbGVtZW50cywgJ3pvbmUnKS5maWx0ZXIoemcgPT4gemcua2V5KS5mb3JFYWNoKHpnID0+IHsKCQkJCXdPcHRpb25zW3pnLmtleV0gPSB0aGlzLnJlbmRlckVsZW1lbnRzKHpnLnZhbHVlcyk7CgkJCX0pOwoKCQkJcmV0ID0gdGhpcy53aW5kb3cod09wdGlvbnMpOwoJCX0gZWxzZSB7CgkJCXJldCA9IHRoaXMuaGVhZGVyKG5hbWUsIHRpdGxlLCBiRml4ZWQsIFt7CgkJCQlpY29uOiAiaGVscCIsCgkJCQlhY3Rpb246IG8gPT4gJCgiI3BubF9fQ29uc29sZSIpLndpbmRvdygnb3BlbicpCgkJCX1dKTsKCgkJCXJldCArPSB0aGlzLnJlbmRlckVsZW1lbnRzKCk7CgoJCQlyZXQgKz0gdGhpcy5mb290ZXIoYkZpeGVkKTsKCgkJfQoJCS8vIGNvbnNvbGUubG9nKHJldCk7CgoJCXJldHVybiByZXQ7Cgl9CgoJY1dpZHRoKG9wdGlvbnMpIHsKCQlsZXQgcmV0ID0gTWF0aC5mbG9vcigoKG9wdGlvbnMgPyBvcHRpb25zLndpZHRoIDogbnVsbCkgfHwgKHRoaXMud2lkdGggLyAzKSkpOwoJCWlmIChvcHRpb25zLnpvbmUgPT0gJ2Vhc3QnIHx8IG9wdGlvbnMuem9uZSA9PSAnd2VzdCcpIHsKCQkJcmV0ID0gMC4yNSAqIHJldDsgLy8gOTAlIG9mIDMvMTAsIHRoZSB3aWR0aCBvZiB0aGUgbm9ybWFsIGVsZW1lbnQKCQl9IGVsc2UgaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5lZGl0b3IpIHsKCQkJcmV0ID0gd2luZG93LmlubmVyV2lkdGg7CgkJfSBlbHNlIGlmIChvcHRpb25zICYmIG9wdGlvbnMud2lkdGggJiYgdHlwZW9mKG9wdGlvbnMud2lkdGgpID09PSAnc3RyaW5nJykgewoJCQlyZXQgPSB0aGlzLndpZHRoOwoJCX0gZWxzZSBpZiAob3B0aW9ucyAmJiBvcHRpb25zLnR5cGUgPT0gJ3dpbmRvdycgJiYgIW9wdGlvbnMud2lkdGgpIHsKCQkJcmV0ID0gdGhpcy53aWR0aCAqIDAuOTsKCQl9CgoJCS8vIGNvbnNvbGUubG9nKG9wdGlvbnMubmFtZSArICI6IGNXaWR0aCA9ICIgKyByZXQsIG9wdGlvbnMuem9uZSk7CgkJcmV0dXJuIHJldDsKCX0KCgl3aW5kb3cob3B0aW9ucykgewoJCW9wdGlvbnMudGl0bGUgPSBvcHRpb25zLnRpdGxlIHx8IG9wdGlvbnMubmFtZTsKCQl2YXIgcmV0ID0gYAoJCTxkaXYgaWQgPSAicG5sJHtvcHRpb25zLm5hbWV9IiBjbGFzcz0iZWFzeXVpLXdpbmRvdyIgdGl0bGU9IiR7b3B0aW9ucy50aXRsZX0iIGRhdGEtb3B0aW9ucz0nJHt0aGlzLmV2ZW50SGFuZGxlcnMob3B0aW9ucyl9LCBjbG9zZWQ6JHshb3B0aW9ucy52aXNpYmxlfSxtaW5pbWl6YWJsZTokeyFvcHRpb25zLmZpeGVkfSxtYXhpbWl6YWJsZTokeyFvcHRpb25zLmZpeGVkfSxjbG9zYWJsZTokeyFvcHRpb25zLmZpeGVkfSxjb2xsYXBzaWJsZTokeyFvcHRpb25zLmZpeGVkfSxkcmFnZ2FibGU6JHshb3B0aW9ucy5maXhlZH0scmVzaXphYmxlOiR7IW9wdGlvbnMuZml4ZWR9LGljb25DbHM6Imljb24tJHtvcHRpb25zLmljb259IiwgdG9vbHM6IiMke29wdGlvbnMubmFtZX1fdG9vbHMiJyBzdHlsZT0id2lkdGg6JHt0aGlzLmNXaWR0aChvcHRpb25zKX1weDtoZWlnaHQ6JHt0aGlzLmNIZWlnaHQob3B0aW9ucyl9cHg7cGFkZGluZzoxMHB4OyI+CgkJICAgIDxkaXYgY2xhc3M9ImVhc3l1aS1sYXlvdXQiIGRhdGEtb3B0aW9ucz0iZml0OnRydWUiPgoJCWA7CgoJCWxldCBiWm9uZSA9IG9wdGlvbnMuc291dGggPyAnc291dGgnIDogKHRoaXMuem9uZXMuZmluZCh6ID0+IHogPT0gJ3NvdXRoJykgfHwgdGhpcy56b25lc1swXSk7CgkJb3B0aW9uc1tiWm9uZV0gPSBvcHRpb25zW2Jab25lXSB8fCBbXTsKCQlsZXQgeldpZHRoID0gTWF0aC5taW4oMTIwLCB0aGlzLndpZHRoICogMC45NSAvIChvcHRpb25zLmJ1dHRvbnMgPyBvcHRpb25zLmJ1dHRvbnMubGVuZ3RoIDogMSksIHRoaXMuY1dpZHRoKG9wdGlvbnMpKTsKCQlvcHRpb25zW2Jab25lXS5wdXNoKGA8ZGl2IGlkPSJwbmwke29wdGlvbnMubmFtZX0tYnV0dG9ucyIgZGF0YS1vcHRpb25zPSJyZWdpb246JyR7YlpvbmV9Jyxib3JkZXI6ZmFsc2UiIHN0eWxlPSJ0ZXh0LWFsaWduOnJpZ2h0O3BhZGRpbmc6NXB4IDAgMDsiPmAgKyAkLm1hcCgkLmdyZXAob3B0aW9ucy5idXR0b25zIHx8IFtdLCBiID0+ICFiLmlnbm9yZSksIGIgPT4gYDxhIGlkPScke2IubmFtZX0nIGhyZWY9ImphdmFzY3JpcHQ6dm9pZCgwKSIgY2xhc3M9ImVhc3l1aS1saW5rYnV0dG9uIGM2IiBpY29uQ2xzPSJpY29uLSR7Yi5pY29uIHx8ICdzYXZlJ30iIHN0eWxlPSJ3aWR0aDoke3pXaWR0aH1weCIgb25jbGljaz0nd2luZG93LkRGb3JtLmRvQ2xpY2soJHtfRnJFTUQuX3RvSlMoYil9KSc+JHtiLnRpdGxlIHx8IGIubmFtZX08L2E+Jm5ic3A7Jm5ic3A7YCkuam9pbignJykgKyBgPC9kaXY+YCk7CgoJCXRoaXMuem9uZXMuZmlsdGVyKHogPT4gb3B0aW9uc1t6XSkuZm9yRWFjaCh6ID0+IHsKCQkJcmV0ICs9IGAKCQkgICAgICAgIDxkaXYgZGF0YS1vcHRpb25zPSJyZWdpb246JyR7en0nIiB0aXRsZT0iJHsoej09J3dlc3QnIHx8IHo9PSdlYXN0Jyk/JyZuYnNwOyc6Jyd9IiBzdHlsZT0naGVpZ2h0OiR7KHo9PSdub3J0aCd8fHo9PSdzb3V0aCcpPzEwOjEwMH0lO3dpZHRoOiR7KCh6PT0nZWFzdCd8fHo9PSd3ZXN0Jyk/MC4xOjEpKnRoaXMuY1dpZHRoKG9wdGlvbnMpfXB4Jz4KICAgICAgICAJCSAgICAkeyhBcnJheS5pc0FycmF5KG9wdGlvbnNbel0pP29wdGlvbnNbel06W29wdGlvbnNbel1dKS5qb2luKCcnKX0KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICBgOwoJCX0pOwoKCQlyZXQgKz0gYDwvZGl2PjwvZGl2PmA7CgoJCS8vIGxpbmtzICh0b29scykKCQlsZXQgbGlua3MgPSAkLmdyZXAoW10uY29uY2F0KG9wdGlvbnMubGlua3MgfHwgW10pLCBsID0+ICFsLmlnbm9yZSk7CgkJcmV0ICs9IGA8ZGl2IGlkPSIke29wdGlvbnMubmFtZX1fdG9vbHMiPmAgKyAkLm1hcChsaW5rcy5yZXZlcnNlKCksIGwgPT4gYDxhIGhyZWY9ImphdmFzY3JpcHQ6dm9pZCgwKSIgc3R5bGU9ImNvbG9yOmJsYWNrIiBjbGFzcz0iZmFzIGZhLSR7bC5pY29uIHx8ICdhZGQnfSIgb25jbGljaz0nKGFzeW5jICgpID0+IHt2YXIgYSA9ICR7X0ZyRU1ELl90b0pTKGwpfTsgJCgiI3BubCR7b3B0aW9ucy5uYW1lfSIpLndpbmRvdygic2V0VGl0bGUiLCAiJHtvcHRpb25zLnRpdGxlfTogIiArIGEubmFtZSk7IGF3YWl0IGEuYWN0aW9uKERGb3JtLmdldCgpLCBhLCAke19GckVNRC5fdG9KUyhvcHRpb25zKX0pOyAkKCIjcG5sJHtvcHRpb25zLm5hbWV9Iikud2luZG93KCJzZXRUaXRsZSIsICIke29wdGlvbnMudGl0bGV9Iik7fSkoKSc+PC9hPmApLmpvaW4oJ1xuJykgKyBgPC9kaXY+YDsKCgkJcmV0dXJuIHJldDsKCX0KCglhc3luYyBfZW5kKCkgewoJCWxldCBvID0gdGhpcy5nZXQoKTsKCgkJLy8gZG8gbm90IHVzZSB0aGUgZmlyc3QgYnV0dG9uLCBiZWNhdXNlIG1hbnkgZm9ybXMgaGF2ZSBhIENhbmNlbCBidXR0b24gb25seQoJCWxldCBidXR0b24gPSB0aGlzLmJ1dHRvbnMuZmluZChiID0+IGIuYXV0b1N1Ym1pdCkgLyogfHwgdGhpcy5idXR0b25zWzBdKi8gOwoJCWlmIChidXR0b24gJiYgbyAmJiBPYmplY3QudmFsdWVzKG8pLmxlbmd0aCAmJiAodHlwZW9mKGJ1dHRvbi5hdXRvU3VibWl0KSA9PT0gInVuZGVmaW5lZCIgfHwgYnV0dG9uLmF1dG9TdWJtaXQpKSB7CgkJCWxldCB2ID0gT2JqZWN0LnZhbHVlcyhvKS5yZWR1Y2UoKHQsIHYpID0+IHsKCQkJCXJldHVybiAoKHR5cGVvZih2KSAhPT0gIm9iamVjdCIpID8gMSA6IDApICogKHYgPyAxIDogMCk7CgkJCX0pOwoJCQkvL2NvbnNvbGUubG9nKG8sIE9iamVjdC52YWx1ZXMobyksIHYpOwoJCQlpZiAodikgewoJCQkJLy8gYWxsIGZpZWxkcyBoYXZlIHZhbHVlcwoJCQkJYXdhaXQgdGhpcy5kb0NsaWNrKGJ1dHRvbik7CgoJCQl9CgkJfQoJfQoKCWZvb3RlcihiRml4ZWQpIHsKCQlyZXR1cm4gYDwvZm9ybT5gICsgYDxkaXYgaWQ9ImRsZy1idXR0b25zIj5gICsgdGhpcy5idXR0b25zLmZpbHRlcihiID0+ICFiLndpbmRvdykubWFwKGIgPT4gYDxhIGlkPScke2IubmFtZX0nIGhyZWY9ImphdmFzY3JpcHQ6dm9pZCgwKSIgY2xhc3M9ImVhc3l1aS1saW5rYnV0dG9uIGM2IiBpY29uQ2xzPSJpY29uLSR7Yi5pY29uIHx8ICdzYXZlJ30iIHN0eWxlPSJ3aWR0aDoke01hdGgubWluKDEyMCwgdGhpcy53aWR0aCAqIDAuOTUgLyB0aGlzLmJ1dHRvbnMubGVuZ3RoLCB0aGlzLmNXaWR0aCgpKX1weCIgb25jbGljaz0nd2luZG93LkRGb3JtLmRvQ2xpY2soJHtfRnJFTUQuX3RvSlMoYil9KSc+JHtiLnRpdGxlIHx8IGIubmFtZX08L2E+Jm5ic3A7Jm5ic3A7YCkuam9pbignJykgKyAiPC9kaXY+IiArIChiRml4ZWQgPyAiIiA6ICc8L2Rpdj4nKTsKCX0KCgloZWFkZXIobmFtZSwgdGl0bGUsIGJGaXhlZCwgbGlua3MpIHsKCQl0aGlzLnRpdGxlID0gdGl0bGUgfHwgdGhpcy50aXRsZTsKCQluYW1lID0gbmFtZSB8fCB0aGlzLm5hbWU7CgkJdmFyIHJldCA9ICcnOwoKCQlyZXQgKz0gdGhpcy53aW5kb3coewoJCQluYW1lOiAiX19Db25zb2xlIiwKCQkJdHlwZTogIndpbmRvdyIsCgkJCWVkaXRvcjogdHJ1ZSwKCQkJbG9hZGVyOiBvID0+IHdpbmRvdy5sb2dzLnNsaWNlKCkucmV2ZXJzZSgpLm1hcChsID0+IGwuZGF0ZS50b0lTT1N0cmluZygpICsgIjogIiArIGwuYXJncy5tYXAocyA9PiB0eXBlb2YocykgPT09ICdvYmplY3QnID8gKChvYmosIGluZGVudCA9IDIpID0+IHsKCQkJCWxldCBjYWNoZSA9IFtdOwoJCQkJY29uc3QgcmV0VmFsID0gSlNPTi5zdHJpbmdpZnkoCgkJCQkJb2JqLAoJCQkJCShrZXksIHZhbHVlKSA9PgoJCQkJCXR5cGVvZiB2YWx1ZSA9PT0gIm9iamVjdCIgJiYgdmFsdWUgIT09IG51bGwgPwoJCQkJCWNhY2hlLmluY2x1ZGVzKHZhbHVlKSA/CgkJCQkJdW5kZWZpbmVkIC8vIER1cGxpY2F0ZSByZWZlcmVuY2UgZm91bmQsIGRpc2NhcmQga2V5CgkJCQkJOgoJCQkJCWNhY2hlLnB1c2godmFsdWUpICYmIHZhbHVlIC8vIFN0b3JlIHZhbHVlIGluIG91ciBjb2xsZWN0aW9uCgkJCQkJOgoJCQkJCXZhbHVlLAoJCQkJCWluZGVudAoJCQkJKTsKCQkJCWNhY2hlID0gbnVsbDsKCQkJCXJldHVybiByZXRWYWw7CgkJCX0pKHMpIDogcykuam9pbignLCAnKSkuam9pbignXG4nKSwKCQl9KTsKCgkJaWYgKCFiRml4ZWQpIHsKCQkJbGlua3MgPSAobGlua3MgfHwgW10pLmZpbHRlcihsID0+ICFsLmlnbm9yZSk7CgkJCWxldCB0RGF0YSA9ICIiOwoJCQlpZiAobGlua3MubGVuZ3RoKSB7CgkJCQlyZXQgKz0gYDxkaXYgaWQ9IiR7dGhpcy5uYW1lfV90b29scyI+YCArIGxpbmtzLm1hcChsID0+IGA8YSBocmVmPSJqYXZhc2NyaXB0OnZvaWQoMCkiIGNsYXNzPSJpY29uLSR7bC5pY29ufSIgb25jbGljaz0nKGFzeW5jICgpID0+IHt2YXIgYSA9ICR7X0ZyRU1ELl90b0pTKGwpfTsgJCgiI3dpbiR7dGhpcy5uYW1lfSIpLndpbmRvdygic2V0VGl0bGUiLCAiJHt0aGlzLnRpdGxlfTogIiArIGEubmFtZSk7IGF3YWl0IGEuYWN0aW9uKERGb3JtLmdldCgpKTsgJCgiI3dpbiR7dGhpcy5uYW1lfSIpLndpbmRvdygic2V0VGl0bGUiLCAiJHt0aGlzLnRpdGxlfSIpO30pKCknPjwvYT5gKS5qb2luKCdcbicpICsgIjwvZGl2PiI7CgkJCQl0RGF0YSA9IGAsdG9vbHM6IiMke3RoaXMubmFtZX1fdG9vbHMiYDsKCQkJfQoJCQlyZXQgKz0gYDxkaXYgaWQ9J3dpbiR7dGhpcy5uYW1lfScgY2xhc3M9J2Vhc3l1aS13aW5kb3cnIHRpdGxlPScke3RoaXMudGl0bGV9JyBkYXRhLW9wdGlvbnM9J2ljb25DbHM6Imljb24tc2F2ZSIgJHt0RGF0YX0nIHN0eWxlPSd3aWR0aDoke3RoaXMud2lkdGh9cHg7aGVpZ2h0OiR7dGhpcy5oZWlnaHR9cHg7cGFkZGluZzoxMHB4Oyc+YDsKCQl9CgkJcmV0dXJuIHJldCArIGA8Zm9ybSBpZD0iZnJtJHt0aGlzLm5hbWV9IiBtZXRob2Q9InBvc3QiIG5vdmFsaWRhdGU+YDsKCX0KCglyZW5kZXJFbGVtZW50cyhlbGVtZW50cykgewoJCWVsZW1lbnRzID0gZWxlbWVudHMgfHwgdGhpcy5lbGVtZW50czsKCgkJdmFyIHRXaWR0aCA9IE1hdGguZmxvb3IodGhpcy53aWR0aCAqIDAuOTUpOwoJCXZhciB0SGVpZ2h0ID0gTWF0aC5mbG9vcih0aGlzLmhlaWdodCAqIDAuODUpOwoKCQlsZXQgcmV0ID0gJyc7CgkJdmFyIGdFbGVtZW50cyA9IHRoaXMuc3IoKS5ncm91cEJ5KGVsZW1lbnRzLCAiZ3JvdXAiKTsKCQlpZiAoZ0VsZW1lbnRzLmxlbmd0aCA+IDEpIHJldCArPSBgPGRpdiBpZD0idGJjV2luZG93IiBjbGFzcz0iZWFzeXVpLXRhYnMiIGRhdGEtb3B0aW9ucz0nJHt0aGlzLmV2ZW50SGFuZGxlcnMoe3R5cGU6ICd0YWJzJ30pfScgc3R5bGU9IndpZHRoOiR7dFdpZHRofXB4O2hlaWdodDoke3RIZWlnaHR9cHg7Ij5gOwoJCWZvciAodmFyIGcgPSAwOyBnIDwgZ0VsZW1lbnRzLmxlbmd0aDsgZysrKSB7CgkJCWlmIChnRWxlbWVudHMubGVuZ3RoID4gMSkgcmV0ICs9ICc8ZGl2IHRpdGxlPSInICsgKGdFbGVtZW50c1tnXS5rZXkgfHwgIk1haW4iKSArICciIHN0eWxlPSJwYWRkaW5nOjIwcHg7ZGlzcGxheTpub25lOyI+JzsKCQkJdmFyIHNFbGVtZW50cyA9IHRoaXMuc3IoKS5ncm91cEJ5KGdFbGVtZW50c1tnXS52YWx1ZXMsICJzZWN0aW9uIik7CgkJCWlmIChzRWxlbWVudHMubGVuZ3RoID4gMSkgcmV0ICs9ICc8ZGl2IGNsYXNzPSJlYXN5dWktYWNjb3JkaW9uIiBzdHlsZT0id2lkdGg6JyArIHRXaWR0aCArICdweDtoZWlnaHQ6JyArIC8qdEhlaWdodCovICIxMDAlIiArICdweDsiPic7CgkJCWZvciAodmFyIHMgPSAwOyBzIDwgc0VsZW1lbnRzLmxlbmd0aDsgcysrKSB7CgkJCQlyZXQgKz0gYDxkaXYgdGl0bGU9IiR7c0VsZW1lbnRzW3NdLmtleSB8fCAiIn0iIGRhdGEtb3B0aW9ucz0iaWNvbkNsczonaWNvbi1tb3JlJyIgc3R5bGU9InBhZGRpbmc6MTBweDsiPmA7CgkJCQlmb3IgKHZhciBpID0gMDsgaSA8IHNFbGVtZW50c1tzXS52YWx1ZXMubGVuZ3RoOyBpKyspIHsKCQkJCQl2YXIgZSA9IHNFbGVtZW50c1tzXS52YWx1ZXNbaV07CgkJCQkJaWYgKGUuaWdub3JlKSBjb250aW51ZTsKCQkJCQllLnZhbHVlID0gZS52YWx1ZSB8fCAodGhpcy5zcigpLiRfUkVRVUVTVCA/IHRoaXMuc3IoKS4kX1JFUVVFU1QoZS5uYW1lKSA6IG51bGwpOwoJCQkJCXJldCArPSBgPGRpdiBpZD0iZkVsZW1lbnRfJHtlLm5hbWV9IiBjbGFzcz0iZml0ZW0iIHN0eWxlPSJkaXNwbGF5OiAkeyhlLnR5cGU9PSd3aW5kb3cnIHx8IGUuaGlkZGVuKT8nbm9uZSc6Jyd9Ij5gOwoJCQkJCWlmIChlLnRvZ2dsZSkgewoJCQkJCQlyZXQgKz0gYDxhIGhyZWY9IiMiIGNsYXNzPSJlYXN5dWktbGlua2J1dHRvbiIgZGF0YS1vcHRpb25zPScke3RoaXMuZXZlbnRIYW5kbGVycyh7dHlwZTogJ3RvZ2dsZScsIGZvcjogZX0pfSxwbGFpbjp0cnVlLGljb25DbHM6Imljb24tJHtlLmljb24gfHwgJ3NlYXJjaCd9Iicgc3R5bGU9IndpZHRoOjEwMHB4O2hlaWdodDozMHB4Ij4ke2UudGl0bGUgfHwgdGhpcy5lbmdsaXNoKGUubmFtZSl9PC9hPmA7CgkJCQkJfSBlbHNlIHsKCQkJCQkJcmV0ICs9IGA8bGFiZWw+JHtlLnRpdGxlIHx8IHRoaXMuZW5nbGlzaChlLm5hbWUpfTo8L2xhYmVsPmA7CgkJCQkJfQoJCQkJCWlmIChlLnR5cGUgJiYgdGhpc1tlLnR5cGVdKSB7CgkJCQkJCXJldCArPSB0aGlzW2UudHlwZV0oZSk7CgkJCQkJfSBlbHNlIGlmIChlLnJlbmRlcikgewoJCQkJCQlyZXQgKz0gZS5yZW5kZXIoKTsKCQkJCQl9CgkJCQkJcmV0ICs9ICc8L2Rpdj4nOwoJCQkJfQoJCQkJcmV0ICs9ICc8L2Rpdj4nOwoJCQl9CgkJCWlmIChzRWxlbWVudHMubGVuZ3RoID4gMSkgcmV0ICs9ICc8L2Rpdj4nOwoJCQlpZiAoZ0VsZW1lbnRzLmxlbmd0aCA+IDEpIHJldCArPSAiPC9kaXY+IjsKCQl9CgkJaWYgKGdFbGVtZW50cy5sZW5ndGggPiAxKSByZXQgKz0gIjwvZGl2PiI7CgkJcmV0dXJuIHJldDsKCX0KCglpbmZvKG1zZykgewoJCWlmICgkLm1lc3NhZ2VyKSB7CgkJCSQubWVzc2FnZXIuYWxlcnQodGhpcy50aXRsZSwgbXNnLCAnaW5mbycpOwoJCX0gZWxzZSB7CgkJCXRoaXMuc3IoKS5TaG93TWVzc2FnZShtc2csIHRoaXMudGl0bGUpOwoJCX0KCX0KCgllcnJvcihtc2cpIHsKCQlpZiAoJC5tZXNzYWdlcikgewoJCQkkLm1lc3NhZ2VyLmFsZXJ0KHRoaXMudGl0bGUsIG1zZywgJ2Vycm9yJyk7CgkJfSBlbHNlIHsKCQkJdGhpcy5zcigpLlNob3dNZXNzYWdlKG1zZywgdGhpcy50aXRsZSk7CgkJfQoJfQoKCWJ5TmFtZShuYW1lKSB7CgkJcmV0dXJuIHRoaXMuZWxlbWVudHMuZmluZChlID0+IGUubmFtZSA9PT0gbmFtZSk7Cgl9Cn0=",
	"__keys": ["name"],
	"active": true,
	"enabled": true,
	"__trMap": []
}