{
	"Id": "5db83ac0e92066118af2d6b6df2c0db81b113269",
	"after": null,
	"async": null,
	"before": null,
	"date": "undefined",
	"name": "DynaForm",
	"order": null,
	"remark": "dW5kZWZpbmVk",
	"script": "d2luZG93LkR5bmFGb3JtID0gY2xhc3MgewoJY29uc3RydWN0b3IoKSB7CgkJdGhpcy50aXRsZSA9ICJGb3JtIFRpdGxlIjsKCQl0aGlzLm5hbWUgPSAiZnJtRm9ybSI7CgkJdGhpcy5lbGVtZW50cyA9IFtdOwoJCXRoaXMuc2VsZWN0cyA9IFtdOwoJCXRoaXMuZ3JpZHMgPSBbXTsKCQl0aGlzLmJ1dHRvbnMgPSBbXTsKCQl0aGlzLnpvbmVzID0gWydub3J0aCcsICdzb3V0aCcsICdlYXN0JywgJ3dlc3QnLCAnY2VudGVyJ107CgkJdGhpcy5zVGFibGUgPSBudWxsOwoJCXRoaXMuYkRlYnVnID0gZmFsc2U7CgkJdGhpcy51aVR5cGVzID0gewoJCQlpbnQ6ICJudW1iZXJzcGlubmVyIiwKCQkJbWVudTogInNwbGl0YnV0dG9uIiwKCQkJZGF0ZXRpbWU6ICJkYXRldGltZWJveCIsCgkJCWJvb2w6ICJzd2l0Y2hidXR0b24iLAoJCQlmaWxlOiAiZmlsZWJveCIsCgkJCXRleHQ6ICJ0ZXh0Ym94IiwKCQkJcGFzc3dvcmQ6ICJwYXNzd29yZGJveCIsCgkJCXN0cmluZzogInRleHRib3giLAoJCQlpbWFnZTogImRpYWxvZyIsCgkJCXByb2dyZXNzOiAicHJvZ3Jlc3NiYXIiLAoJCQlsaW5rOiAibGlua2J1dHRvbiIsCgkJCXRyZWU6ICJjb21ib3RyZWUiLAoJCQluYXZpZ2F0aW9uOiAidHJlZSIsCgkJCXNlYXJjaDogJ3NlYXJjaGJveCcsCgkJfTsKCQl0aGlzLmV2ZW50cyA9IFt7CgkJCW5hbWU6ICdvbkNsaWNrJywKCQkJaGFuZGxlcjogJ29uVG9nZ2xlJywKCQkJcGFyYW1zOiAnbj1ldmVudCcsCgkJCXR5cGU6ICd0b2dnbGUnLAoJCX0sIHsKCQkJbmFtZTogJ29uQ2xvc2UnLAoJCQloYW5kbGVyOiAnUGFuT25DbG9zZScsCgkJCXBhcmFtczogJ249ZXZlbnQnLAoJCQl0eXBlOiAnd2luZG93JywKCQl9LCB7CgkJCW5hbWU6ICdvblNlbGVjdCcsCgkJCWhhbmRsZXI6ICdTZWxlY3RDaGFuZ2UnLAoJCQlwYXJhbXM6ICduJywKCQkJdHlwZTogJ3RhYnMnLAoJCX0sIHsKCQkJbmFtZTogJ3NlYXJjaGVyJywKCQkJaGFuZGxlcjogJ0ZpZWxkQ2hhbmdlJywKCQkJcGFyYW1zOiAnbiwgbycsCgkJCXR5cGU6ICdzZWFyY2hib3gnLAoJCX0sIHsKCQkJbmFtZTogJ29uQmVmb3JlRXhwYW5kJywKCQkJaGFuZGxlcjogJ0V4cGFuZCcsCgkJCXBhcmFtczogJ24nLAoJCQl0eXBlOiAndHJlZScsCgkJfSwgewoJCQluYW1lOiAnb25DaGFuZ2UnLAoJCQloYW5kbGVyOiAnRmllbGRDaGFuZ2UnLAoJCQlwYXJhbXM6ICduLCBvJwoJCX0sIHsKCQkJbmFtZTogJ29uQmVmb3JlT3BlbicsCgkJCWhhbmRsZXI6ICdQYW5lbE9wZW4nLAoJCQlwYXJhbXM6ICcnLAoJCQl0eXBlOiAnd2luZG93JywKCQl9LCB7CgkJCW5hbWU6ICdvbk9wZW4nLAoJCQloYW5kbGVyOiAnUGVuZEFmdGVyT3BlbicsCgkJCXBhcmFtczogJycsCgkJCXR5cGU6ICd3aW5kb3cnLAoJCX0sIHsKCQkJbmFtZTogJ29uQ2xpY2snLAoJCQloYW5kbGVyOiAnZG9MaW5rJywKCQkJcGFyYW1zOiAnbj1ldmVudCwgbycsCgkJCXR5cGU6ICdsaW5rJywKCQl9LCB7CgkJCW5hbWU6ICdvbkNsaWNrUm93JywKCQkJaGFuZGxlcjogJ0ZpZWxkQ2hhbmdlJywKCQkJcGFyYW1zOiAnbiwgbycsCgkJCXR5cGU6ICdncmlkJywKCQl9XTsKCgkJaWYgKHR5cGVvZigkKSAhPT0gJ3VuZGVmaW5lZCcpICQod2luZG93KS5yZXNpemUodGhpcy53aW5kb3dSZXNpemVkKTsKCQl0aGlzLndpbmRvd1Jlc2l6ZWQoKTsKCX0KCglzcigpIHsKCQlyZXR1cm4gdHlwZW9mKF9GckVNRCkgIT09ICd1bmRlZmluZWQnID8gX0ZyRU1ELnNyKCkgOiB3aW5kb3cuc3I7Cgl9CgoJcGFyc2UoKSB7CgkJJC5wYXJzZXIucGFyc2UoKTsKCX0KCgl3aW5kb3dSZXNpemVkKCkgewoJCXRoaXMud2lkdGggPSB3aW5kb3cuaW5uZXJXaWR0aDsKCQl0aGlzLmhlaWdodCA9IHdpbmRvdy5pbm5lckhlaWdodCAqIDAuODsKCX0KCglpbml0KCkgewoJCXZhciBzZWxlY3QgPSB7CgkJCWluaXQ6IGZ1bmN0aW9uKGNvbnRhaW5lciwgb3B0aW9ucykgewoJCQkJdmFyIG9wID0gbnVsbDsKCQkJCXZhciBmb3AgPSBudWxsOwoJCQkJZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmdyaWRzLmxlbmd0aDsgaSsrKQoJCQkJCWlmICh0cnVlIHx8IHRoaXMuZ3JpZHNbaV0uaWQgPT0gb3B0aW9ucy5zb3VyY2UpIG9wID0gdGhpcy5ncmlkc1tpXS5vcHRpb25zOwoJCQkJZm9yIChpID0gMDsgaSA8IG9wLmNvbHVtbnMubGVuZ3RoOyBpKyspCgkJCQkJaWYgKG9wLmNvbHVtbnNbaV0ubmFtZSA9PSBvcHRpb25zLmZpZWxkKSBmb3AgPSBvcC5jb2x1bW5zW2ldOwoJCQkJZm9wLndpZHRoID0gKHRoaXMud2lkdGggLyAzKTsKCQkJCXZhciBlID0gJCh0aGlzLnNlbGVjdChmb3ApKTsKCQkJCXZhciBpbnB1dCA9IGUuYXBwZW5kVG8oY29udGFpbmVyKTsKCQkJCWlucHV0LmNvbWJvZ3JpZCgpOwoJCQkJdGhpcy5iaW5kKGlucHV0KTsKCQkJCXJldHVybiBpbnB1dDsKCQkJfSwKCQkJZGVzdHJveTogZnVuY3Rpb24odGFyZ2V0KSB7CgkJCQkkKHRhcmdldCkucmVtb3ZlKCk7CgkJCX0sCgkJCWdldFZhbHVlOiBmdW5jdGlvbih0YXJnZXQpIHsKCQkJCXJldHVybiAkKHRhcmdldCkudmFsKCk7CgkJCX0sCgkJCXNldFZhbHVlOiBmdW5jdGlvbih0YXJnZXQsIHZhbHVlKSB7CgkJCQkkKHRhcmdldCkudmFsKHZhbHVlKTsKCQkJfSwKCQkJcmVzaXplOiBmdW5jdGlvbih0YXJnZXQsIHdpZHRoKSB7CgkJCQkkKHRhcmdldCkuX291dGVyV2lkdGgod2lkdGgpOwoJCQl9CgkJfTsKCQkkLmV4dGVuZCgkLmZuLmRhdGFncmlkLmRlZmF1bHRzLmVkaXRvcnMsIHsKCQkJZGF0ZXRpbWU6IHsKCQkJCWluaXQ6IGZ1bmN0aW9uKGNvbnRhaW5lciwgb3B0aW9ucykgewoJCQkJCW9wdGlvbnMud2lkdGggPSB0aGlzLmNXaWR0aChvcHRpb25zKTsKCQkJCQl2YXIgaW5wdXQgPSAkKHRoaXMuZGF0ZXRpbWUob3B0aW9ucykpLmFwcGVuZFRvKGNvbnRhaW5lcik7CgkJCQkJaW5wdXQuZGF0ZXRpbWVib3goKTsKCQkJCQlyZXR1cm4gaW5wdXQ7CgkJCQl9LAoJCQkJZGVzdHJveTogZnVuY3Rpb24odGFyZ2V0KSB7CgkJCQkJJCh0YXJnZXQpLnJlbW92ZSgpOwoJCQkJfSwKCQkJCWdldFZhbHVlOiBmdW5jdGlvbih0YXJnZXQpIHsKCQkJCQlyZXR1cm4gJCh0YXJnZXQpLnZhbCgpOwoJCQkJfSwKCQkJCXNldFZhbHVlOiBmdW5jdGlvbih0YXJnZXQsIHZhbHVlKSB7CgkJCQkJJCh0YXJnZXQpLnZhbCh2YWx1ZSk7CgkJCQl9LAoJCQkJcmVzaXplOiBmdW5jdGlvbih0YXJnZXQsIHdpZHRoKSB7CgkJCQkJJCh0YXJnZXQpLl9vdXRlcldpZHRoKHdpZHRoKTsKCQkJCX0KCQkJfSwKCQkJY2hlY2tib3g6IHsKCQkJCWluaXQ6IGZ1bmN0aW9uKGNvbnRhaW5lciwgb3B0aW9ucykgewoJCQkJCXZhciBpbnB1dCA9ICQodGhpcy5ib29sKG9wdGlvbnMpKS5hcHBlbmRUbyhjb250YWluZXIpOwoJCQkJCWlucHV0LnN3aXRjaGJ1dHRvbigpOwoJCQkJCXJldHVybiBpbnB1dDsKCQkJCX0sCgkJCQlkZXN0cm95OiBmdW5jdGlvbih0YXJnZXQpIHsKCQkJCQkkKHRhcmdldCkucmVtb3ZlKCk7CgkJCQl9LAoJCQkJZ2V0VmFsdWU6IGZ1bmN0aW9uKHRhcmdldCkgewoJCQkJCXJldHVybiAkKHRhcmdldCkudmFsKCk7CgkJCQl9LAoJCQkJc2V0VmFsdWU6IGZ1bmN0aW9uKHRhcmdldCwgdmFsdWUpIHsKCQkJCQkkKHRhcmdldCkudmFsKHZhbHVlKTsKCQkJCX0sCgkJCQlyZXNpemU6IGZ1bmN0aW9uKHRhcmdldCwgd2lkdGgpIHsKCQkJCQkkKHRhcmdldCkuX291dGVyV2lkdGgod2lkdGgpOwoJCQkJfQoJCQl9LAoJCQljb21ib3RyZWVncmlkOiBzZWxlY3QsCgkJCXNlbGVjdDogc2VsZWN0LAoJCX0pOwoJfQoKCWFzayhxdWVzdGlvbiwgZkFuc3dlciA9IHYgPT4gdiwgb3B0aW9ucykgewoJCSQubWVzc2FnZXIuY29uZmlybSh0aGlzLnRpdGxlLCBxdWVzdGlvbiwgZnVuY3Rpb24ocikgewoJCQlpZiAob3B0aW9ucykgewoJCQkJZm9yICh2YXIgaSA9IDA7IGkgPCBvcHRpb25zLmxlbmd0aDsgaSsrKSB7CgkJCQkJaWYgKG9wdGlvbnNbaV0uYW5zd2VyID09IHIpIHsKCQkJCQkJcmV0dXJuIGZBbnN3ZXIob3B0aW9uc1tpXS52YWx1ZSk7CgkJCQkJfQoJCQkJfQoJCQl9IGVsc2UgewoJCQkJcmV0dXJuIGZBbnN3ZXIocik7CgkJCX0KCQl9KTsKCX0KCgl0b3BEYXRhKGFyLCBnRmllbGQsIHZGaWVsZCwgdG9wKSB7CgkJaWYgKCF0b3ApIHsKCQkJcmV0dXJuIGFyOwoJCX0KCQlyZXQgPSBbXTsKCQkkLmVhY2godGhpcy5zcigpLmdyb3VwQnkoYXIsIGdGaWVsZCksIGZ1bmN0aW9uKGtleSwgdmFsdWVzKSB7CgkJCXZhbHVlcy52YWx1ZXMuc29ydCgoYSwgYikgPT4gewoJCQkJaWYgKHBhcnNlRmxvYXQoYVt2RmllbGRdKSA8IHBhcnNlRmxvYXQoYlt2RmllbGRdKSkgewoJCQkJCXJldHVybiAxOwoJCQkJfSBlbHNlIGlmIChwYXJzZUZsb2F0KGFbdkZpZWxkXSkgPiBwYXJzZUZsb2F0KGJbdkZpZWxkXSkpIHsKCQkJCQlyZXR1cm4gLTE7CgkJCQl9IGVsc2UgewoJCQkJCXJldHVybiAwOwoJCQkJfQoJCQl9KTsKCQkJJC5lYWNoKHZhbHVlcy52YWx1ZXMsIGZ1bmN0aW9uKGksIHYpIHsKCQkJCWlmIChpIDwgdG9wKSB7CgkJCQkJcmV0LnB1c2godik7CgkJCQl9CgkJCX0pOwoJCX0pOwoJCXJldHVybiByZXQ7Cgl9CgoJYXN5bmMgZG9DbGljayhidXR0b24pIHsKCQlsZXQgX3RoaXMgPSB0eXBlb2YodGhpcy5kb0NsaWNrKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMgOiB3aW5kb3cuREZvcm07CgkJYnV0dG9uID0gX3RoaXMuYnV0dG9ucy5maW5kKGIgPT4gYi5uYW1lID09IGJ1dHRvbi5uYW1lICYmIGIuZ3JvdXAgPT0gYnV0dG9uLmdyb3VwKTsKCQlfdGhpcy5idXN5KHRydWUpOwoJCV90aGlzLnNldCh7CgkJCVdvcmtQcm9ncmVzc1ZhbHVlOiAyMAoJCX0pCgoJCXZhciBvID0gX3RoaXMuZ2V0KCk7CgkJdmFyIHNNaXNzaW5nID0gX3RoaXMuZWxlbWVudHMuZmlsdGVyKGUgPT4gKGJ1dHRvbi53aW5kb3cgPyBidXR0b24uZ3JvdXAgPT0gZS5ncm91cCA6IHRydWUpKS5maWx0ZXIoZSA9PiBlLnJlcXVpcmVkICYmICFvW2UubmFtZV0pLm1hcChlID0+ICI8bGk+IiArIChlLmxhYmVsIHx8IGUubmFtZSkgKyAiPC9saT4iKS5qb2luKCIiKTsKCQlpZiAoc01pc3NpbmcpIHsKCQkJd2luZG93Ll9GckVNRC5fZXJyb3IoIk1pc3NpbmcgbWFuZGF0b3J5IGZpZWxkczo8YnIvPjx1bD4iICsgc01pc3NpbmcgKyAiPC91bD4iLCA1MDAwKTsKCQkJX3RoaXMuYnVzeShmYWxzZSk7CgkJCXJldHVybjsKCQl9CgkJaWYgKGJ1dHRvbi5vbmNsaWNrKSBhd2FpdCBidXR0b24ub25jbGljayhvKTsKCQlpZiAoYnV0dG9uLm9uQ2xpY2spIGF3YWl0IGJ1dHRvbi5vbkNsaWNrKG8pOwoJCV90aGlzLmJ1c3koZmFsc2UpOwoJfQoKCWJ1c3koYkJ1c3kpIHsKCQlpZiAoIWJCdXN5KSB7CgkJCXZhciB0b3RhbCA9IDA7CgkJCWlmICh0eXBlb2YgbW9tZW50ICE9PSAndW5kZWZpbmVkJykgewoJCQkJdG90YWwgPSBtb21lbnQoKS5kaWZmKG1vbWVudCh0aGlzLmJ1c3lTdGFtcCksICdzZWNvbmRzJyk7CgkJCX0gZWxzZSB7CgkJCQkvLyBubyBtb21lbnQsIHVzZSBzdGFuZGFyZCBEYXRlCgkJCQl0b3RhbCA9IChuZXcgRGF0ZSgpLmdldFRpbWUoKSAtIHRoaXMuYnVzeVN0YW1wID8gdGhpcy5idXN5U3RhbXAuZ2V0VGltZSgpIDogMCkgLyAxMDAwIC8gMzYwMDsKCQkJfQoJCQlpZiAodGhpcy5iRGVidWcpIHsKCQkJCXdpbmRvdy5fRnJFTUQuX2FsZXJ0KCJFeGVjdXRpb24gVGltZTogIiArIHRvdGFsICsgIiBzZWNvbmRzLiIpOwoJCQl9CgkJCWRlbGV0ZSB0aGlzLmJ1c3lTdGFtcDsKCgkJCXNldEludGVydmFsKDEsICgpID0+IHRoaXMuU2V0KHsKCQkJCUxvYWRpbmc6IDEwCgkJCX0pKTsKCQl9IGVsc2UgewoJCQl0aGlzLmJ1c3lTdGFtcCA9IG5ldyBEYXRlKCk7CgkJfQoKCQkkLmVhY2goJC5tZXJnZSgkLm1hcCh0aGlzLmJ1dHRvbnMsIGIgPT4gYi5uYW1lKSwgJC5tYXAodGhpcy5lbGVtZW50cy5maWx0ZXIoZSA9PiBlLnR5cGUgPT0gJ2xpbmsnKSwgZSA9PiBlLm5hbWUpKSwgKF8sIGUpID0+ICQoJyMnICsgZSkubGlua2J1dHRvbihiQnVzeSA/ICdkaXNhYmxlJyA6ICdlbmFibGUnKSk7Cgl9CgoJcHJlZml4KGUpIHsKCQlzd2l0Y2ggKGUudHlwZSkgewoJCQljYXNlICdsYWJlbCc6CgkJCQlyZXR1cm4gJ2xibCc7CgkJCWNhc2UgJ3RleHQnOgoJCQljYXNlICdzdHJpbmcnOgoJCQljYXNlICdzZWFyY2gnOgoJCQljYXNlICdwYXNzd29yZCc6CgkJCQlyZXR1cm4gJ3R4dCc7CgkJCWNhc2UgIkRhdGVUaW1lIjoKCQkJY2FzZSAiZGF0ZXRpbWUiOgoJCQkJcmV0dXJuICdkdHAnOwoJCQljYXNlICJpbnQiOgoJCQljYXNlICJpbnRlZ2VyIjoKCQkJY2FzZSAibnVtYmVyIjoKCQkJY2FzZSAibG9uZyI6CgkJCWNhc2UgIkxvbmciOgoJCQkJcmV0dXJuICdudWQnOwoJCQljYXNlICdmaWxlJzoKCQkJCXJldHVybiAnZmlsJzsKCQkJY2FzZSAnaW1hZ2UnOgoJCQkJcmV0dXJuICdpbWcnOwoJCQljYXNlICJib29sIjoKCQkJCXJldHVybiAnY2hrJzsKCQkJY2FzZSAid2luZG93IjoKCQkJCXJldHVybiAncG5sJzsKCQkJY2FzZSAicHJvZ3Jlc3MiOgoJCQkJcmV0dXJuICdwcmcnOwoJCQljYXNlICJncmlkIjoKCQkJY2FzZSAidHJlZSI6CgkJCWNhc2UgInNlbGVjdCI6CgkJCQlyZXR1cm4gJ2NtYic7CgkJCWRlZmF1bHQ6CgkJCQlyZXR1cm4gJyc7CgkJfQoJfQoKCWNsZWFyKGdyb3VwKSB7CgkJdmFyIG8gPSB7fTsKCQkkLmVhY2godGhpcy5lbGVtZW50cy5maWx0ZXIoZSA9PiBncm91cCA/IGUuZ3JvdXAgPT0gZ3JvdXAgOiB0cnVlKSwgKF8sIGUpID0+IHsKCQkJdmFyIG5hbWUgPSAoZS5lbXNTb3VyY2UgPyAiXyIgOiAiIikgKyBlLm5hbWU7CgkJCXN3aXRjaCAoZS50eXBlKSB7CgkJCQljYXNlICd0ZXh0JzoKCQkJCWNhc2UgJ3N0cmluZyc6CgkJCQljYXNlICdzZWFyY2gnOgoJCQkJY2FzZSAncGFzc3dvcmQnOgoJCQkJY2FzZSAiRGF0ZVRpbWUiOgoJCQkJY2FzZSAiZGF0ZXRpbWUiOgoJCQkJCW9bbmFtZV0gPSAiIjsKCQkJCQlicmVhazsKCQkJCWNhc2UgImludCI6CgkJCQljYXNlICJudW1iZXIiOgoJCQkJY2FzZSAiaW50ZWdlciI6CgkJCQljYXNlICJsb25nIjoKCQkJCWNhc2UgIkxvbmciOgoJCQkJY2FzZSAicHJvZ3Jlc3MiOgoJCQkJCW9bbmFtZV0gPSAwOwoJCQkJCWJyZWFrOwoJCQkJY2FzZSAidHJlZSI6CgkJCQljYXNlICJzZWxlY3QiOgoJCQkJCW9bbmFtZV0gPSBudWxsOwoJCQkJCWJyZWFrOwoJCQkJY2FzZSAiZ3JpZCI6CgkJCQkJb1tuYW1lXSA/IG9bbmFtZV0uZGF0YSA9IFtdIDogbnVsbDsKCQkJCQlicmVhazsKCQkJCWNhc2UgImJvb2wiOgoJCQkJCW9bbmFtZV0gPSBmYWxzZTsKCQkJCQlicmVhazsKCQkJCWRlZmF1bHQ6CgkJCQkJYnJlYWs7CgkJCX0KCQl9KTsKCQkvL2NvbnNvbGUubG9nKCJjbGVhciIsIG8pOwoJCXRoaXMuc2V0KG8pOwoJCXRoaXMuYnVzeShmYWxzZSk7Cgl9CgoJc2V0KG8sIGVOYW1lKSB7CgkJaWYgKGVOYW1lKSB7CgkJCXZhciBvRWxlbWVudCA9IHRoaXMuYnlOYW1lKGVOYW1lKTsKCQkJaWYgKCFvRWxlbWVudCkgcmV0dXJuOwoJCQl2YXIgYXR0ID0gbnVsbDsKCQkJaWYgKG8gJiYgby5JZCAmJiBvLkVudGl0eUF0dHJpYnV0ZSkgewoJCQkJLy8gYW4gRW50aXR5VmFsdWUKCQkJCWZvciAodmFyIHAgaW4gbykKCQkJCQlpZiAocC5lbmRzV2l0aCgiVmFsdWUiKSkgYXR0ID0gcDsKCQkJCW9FbGVtZW50LmVtc1NvdXJjZSA9IG87CgkJCX0KCQkJdHJ5IHsKCQkJCXN3aXRjaCAob0VsZW1lbnQudHlwZSkgewoJCQkJCWNhc2UgJ2xhYmVsJzoKCQkJCQkJaWYgKGF0dCkgewoJCQkJCQkJJCgiIyIgKyB0aGlzLnByZWZpeChvRWxlbWVudCkgKyBvRWxlbWVudC5uYW1lKS5odG1sKG9bYXR0XSk7CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQkkKCIjIiArIHRoaXMucHJlZml4KG9FbGVtZW50KSArIG9FbGVtZW50Lm5hbWUpLmh0bWwoKG8gJiYgby5FbnRpdHlBdHRyaWJ1dGUpID8gIiIgOiBvKTsKCQkJCQkJfQoJCQkJCQlicmVhazsKCQkJCQljYXNlICd0ZXh0JzoKCQkJCQljYXNlICdzdHJpbmcnOgoJCQkJCWNhc2UgJ3Bhc3N3b3JkJzoKCQkJCQljYXNlICJpbnQiOgoJCQkJCWNhc2UgInNlYXJjaCI6CgkJCQkJY2FzZSAiaW50ZWdlciI6CgkJCQkJY2FzZSAibnVtYmVyIjoKCQkJCQljYXNlICJsb25nIjoKCQkJCQljYXNlICJMb25nIjoKCQkJCQkJaWYgKGF0dCkgewoJCQkJCQkJJCgiIyIgKyB0aGlzLnByZWZpeChvRWxlbWVudCkgKyBvRWxlbWVudC5uYW1lKVt0aGlzLnVpVHlwZXNbb0VsZW1lbnQudHlwZV1dKCJzZXRWYWx1ZSIsIG9bYXR0XSk7CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQkkKCIjIiArIHRoaXMucHJlZml4KG9FbGVtZW50KSArIG9FbGVtZW50Lm5hbWUpW3RoaXMudWlUeXBlc1tvRWxlbWVudC50eXBlXV0oInNldFZhbHVlIiwgKG8gJiYgby5FbnRpdHlBdHRyaWJ1dGUpID8gIiIgOiBvKTsKCQkJCQkJfQoJCQkJCQlicmVhazsKCQkJCQljYXNlICJEYXRlVGltZSI6CgkJCQkJY2FzZSAiZGF0ZXRpbWUiOgoJCQkJCQlpZiAoYXR0KSB7CgkJCQkJCQkkKCIjIiArIHRoaXMucHJlZml4KG9FbGVtZW50KSArIG9FbGVtZW50Lm5hbWUpW3RoaXMudWlUeXBlc1tvRWxlbWVudC50eXBlXV0oJ3NldFZhbHVlJywgKG9bYXR0XSA/IHRoaXMuc3IoKS50b0RhdGVUaW1lKG9bYXR0XSkgOiAiIikpOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJJCgiIyIgKyB0aGlzLnByZWZpeChvRWxlbWVudCkgKyBvRWxlbWVudC5uYW1lKVt0aGlzLnVpVHlwZXNbb0VsZW1lbnQudHlwZV1dKCdzZXRWYWx1ZScsIChvICYmIG8uRW50aXR5QXR0cmlidXRlKSA/ICIiIDogKG8gPyB0aGlzLnNyKCkudG9EYXRlVGltZShvKSA6ICIiKSk7CgkJCQkJCX0KCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAiYm9vbCI6CgkJCQkJCWlmIChhdHQpIHsKCQkJCQkJCSQoIiMiICsgdGhpcy5wcmVmaXgob0VsZW1lbnQpICsgb0VsZW1lbnQubmFtZSlbdGhpcy51aVR5cGVzW29FbGVtZW50LnR5cGVdXSgob1thdHRdID8gJycgOiAndW4nKSArICdjaGVjaycpOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJJCgiIyIgKyB0aGlzLnByZWZpeChvRWxlbWVudCkgKyBvRWxlbWVudC5uYW1lKVt0aGlzLnVpVHlwZXNbb0VsZW1lbnQudHlwZV1dKCgoKG8gJiYgby5FbnRpdHlBdHRyaWJ1dGUpID8gIiIgOiBvKSA/ICcnIDogJ3VuJykgKyAnY2hlY2snKTsKCQkJCQkJfQoJCQkJCQlicmVhazsKCQkJCQljYXNlICJ3aW5kb3ciOgoJCQkJCQlpZiAoYXR0KSB7CgkJCQkJCQlvRWxlbWVudC52YWx1ZSA9IG9bYXR0XTsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCW9FbGVtZW50LnZhbHVlID0gKG8gJiYgby5FbnRpdHlBdHRyaWJ1dGUpID8gIiIgOiBvOwoJCQkJCQl9CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgInByb2dyZXNzIjoKCQkJCQkJdmFyIHYgPSAwOwoJCQkJCQlpZiAoYXR0KSB7CgkJCQkJCQl2ID0gb1thdHRdOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJdiA9IChvICYmIG8uRW50aXR5QXR0cmlidXRlKSA/ICIiIDogbzsKCQkJCQkJfQoJCQkJCQljb25zb2xlLmxvZygiIyIgKyB0aGlzLnByZWZpeChvRWxlbWVudCkgKyBvRWxlbWVudC5uYW1lLCB0aGlzLnVpVHlwZXNbb0VsZW1lbnQudHlwZV0sIE1hdGgucm91bmQodiAqIDEwKSAvIDEwKTsKCQkJCQkJJCgiIyIgKyB0aGlzLnByZWZpeChvRWxlbWVudCkgKyBvRWxlbWVudC5uYW1lKVt0aGlzLnVpVHlwZXNbb0VsZW1lbnQudHlwZV1dKCdzZXRWYWx1ZScsIE1hdGgucm91bmQodiAqIDEwKSAvIDEwKTsKCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAiZ3JpZCI6CgkJCQkJCWxldCBjb2xzID0gSlNPTi5wYXJzZSgieyIgKyB0aGlzLm1hcENvbHVtbnMob0VsZW1lbnQsIHRydWUpICsgIn0iKTsKCQkJCQkJJC5lYWNoKGNvbHMuY29sdW1uc1swXSwgKF8sIGMpID0+IGMuZm9ybWF0dGVyID0gdGhpcy5zcigpLnJ1blNjcmlwdCh0aGlzLmZvcm1hdHRlcihvRWxlbWVudC5uYW1lLCBjKSkpOwoJCQkJCQkkKCIjIiArIHRoaXMucHJlZml4KG9FbGVtZW50KSArIG9FbGVtZW50Lm5hbWUpLmRhdGFncmlkKGNvbHMpOwoJCQkJCQlpZiAoYXR0KSB7CgkJCQkJCQkkKCIjIiArIHRoaXMucHJlZml4KG9FbGVtZW50KSArIG9FbGVtZW50Lm5hbWUpLmRhdGFncmlkKHsKCQkJCQkJCQlkYXRhOiBvW2F0dF0KCQkJCQkJCX0pOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJJCgiIyIgKyB0aGlzLnByZWZpeChvRWxlbWVudCkgKyBvRWxlbWVudC5uYW1lKS5kYXRhZ3JpZCh7CgkJCQkJCQkJZGF0YTogKG8gJiYgby5FbnRpdHlBdHRyaWJ1dGUpID8gIiIgOiBvCgkJCQkJCQl9KTsKCQkJCQkJfQoJCQkJCQkkKCIjIiArIHRoaXMucHJlZml4KG9FbGVtZW50KSArIG9FbGVtZW50Lm5hbWUpLmRhdGFncmlkKCJ1bnNlbGVjdEFsbCIpOwoJCQkJCQkkKCIjIiArIHRoaXMucHJlZml4KG9FbGVtZW50KSArIG9FbGVtZW50Lm5hbWUpLmRhdGFncmlkKCk7CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgInRyZWUiOgoJCQkJCQl2YXIgdiA9IGF0dCA/IG9bYXR0XSA6ICgobyAmJiBvLkVudGl0eUF0dHJpYnV0ZSkgPyAiIiA6IG8pOwoJCQkJCQlpZiAoQXJyYXkuaXNBcnJheSh2KSkgewoJCQkJCQkJJCgiIyIgKyB0aGlzLnByZWZpeChvRWxlbWVudCkgKyBvRWxlbWVudC5uYW1lKVt0aGlzLnVpVHlwZXNbb0VsZW1lbnQudHlwZV1dKCJ0cmVlIikudHJlZSgibG9hZERhdGEiLCB2KTsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCSQoIiMiICsgdGhpcy5wcmVmaXgob0VsZW1lbnQpICsgb0VsZW1lbnQubmFtZSlbdGhpcy51aVR5cGVzW29FbGVtZW50LnR5cGVdXSgnc2V0VmFsdWUnLCB2KTsKCQkJCQkJfQoJCQkJCQlicmVhazsKCQkJCQljYXNlICJzZWxlY3QiOgoJCQkJCQkvL2NvbnNvbGUubG9nKCJzZXQoKTogb0VsZW1lbnQ6ICIgKyBvRWxlbWVudC5uYW1lICsgIiwgdj0iLCB2KTsKCQkJCQkJaWYgKGF0dCkgewoJCQkJCQkJaWYgKG9FbGVtZW50Lm9wdGlvbnMpIHsKCQkJCQkJCQkkKCIjIiArIHRoaXMucHJlZml4KG9FbGVtZW50KSArIG9FbGVtZW50Lm5hbWUpLmNvbWJvKCdzZXRWYWx1ZScgKyAob0VsZW1lbnQubXVsdGlwbGUgPyAncycgOiAnJyksIChvW2F0dF0gPyBvW2F0dF0gOiAiIikpOwoJCQkJCQkJCSQoIiMiICsgdGhpcy5wcmVmaXgob0VsZW1lbnQpICsgb0VsZW1lbnQubmFtZSkuY29tYm8oJ3NldFZhbHVlJyArIChvRWxlbWVudC5tdWx0aXBsZSA/ICdzJyA6ICcnKSwgKG9bYXR0XSA/IG9bYXR0XSA6ICIiKSk7CgkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCSQoIiMiICsgdGhpcy5wcmVmaXgob0VsZW1lbnQpICsgb0VsZW1lbnQubmFtZSkuY29tYm9ncmlkKCdzZXRWYWx1ZScgKyAob0VsZW1lbnQubXVsdGlwbGUgPyAncycgOiAnJyksIChvW2F0dF0gPyBvW2F0dF0gOiAiIikpOwoJCQkJCQkJfQoJCQkJCQl9IGVsc2UgewoJCQkJCQkJdiA9IG51bGw7CgkJCQkJCQlpZiAobyA9PT0gbnVsbCkgewoKCQkJCQkJCX0gZWxzZSBpZiAoby5jb25zdHJ1Y3RvciA9PT0gQXJyYXkpIHsKCgkJCQkJCQl9IGVsc2UgaWYgKCFvLkVudGl0eUF0dHJpYnV0ZSkgewoJCQkJCQkJCXYgPSBvIHx8IHsKCQkJCQkJCQkJSWQ6IG8uSWQsCgkJCQkJCQkJCV9Ub1N0cmluZzogby5fVG9TdHJpbmcsCgkJCQkJCQkJCXRvU3RyaW5nOiBmdW5jdGlvbigpIHsKCQkJCQkJCQkJCXJldHVybiB0aGlzLl9Ub1N0cmluZzsKCQkJCQkJCQkJfQoJCQkJCQkJCX07CgkJCQkJCQl9CgkJCQkJCQlpZiAob0VsZW1lbnQub3B0aW9ucykgewoJCQkJCQkJCSQoIiMiICsgdGhpcy5wcmVmaXgob0VsZW1lbnQpICsgb0VsZW1lbnQubmFtZSkuY29tYm8oJ3NldFZhbHVlJyArIChvRWxlbWVudC5tdWx0aXBsZSA/ICdzJyA6ICcnKSwgdik7CgkJCQkJCQkJJCgiIyIgKyB0aGlzLnByZWZpeChvRWxlbWVudCkgKyBvRWxlbWVudC5uYW1lKS5jb21ibygnc2V0VGV4dCcgKyAob0VsZW1lbnQubXVsdGlwbGUgPyAncycgOiAnJyksIHYpOwoJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQkkKCIjIiArIHRoaXMucHJlZml4KG9FbGVtZW50KSArIG9FbGVtZW50Lm5hbWUpLmNvbWJvZ3JpZCgnc2V0VmFsdWUnICsgKG9FbGVtZW50Lm11bHRpcGxlID8gJ3MnIDogJycpLCB2KTsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCQlicmVhazsKCQkJCQlkZWZhdWx0OgoJCQkJCQlicmVhazsKCQkJCX0KCQkJfSBjYXRjaCAoZXgpIHsKCQkJCWNvbnNvbGUubG9nKGV4KTsKCQkJfQoJCX0gZWxzZSB7CgkJCWZvciAodmFyIHAgaW4gbykgewoJCQkJaWYgKHAuaW5kZXhPZignXycpID09PSAwKSBwID0gcC5zdWJzdHJpbmcoMSk7CgkJCQl2YXIgZSA9IHRoaXMuYnlOYW1lKHApOwoJCQkJaWYgKCFlIHx8ICFlLm5hbWUpIGNvbnRpbnVlOwoJCQkJdmFyIHZhbHVlID0gb1twXTsKCQkJCWlmIChlLm5hbWUgPT0gdGhpcy5zVGFibGUpIHsKCQkJCQl2YWx1ZSA9IG87CgkJCQkJdmFsdWUuRGF0ZSA9IG5ldyBEYXRlKCk7CgkJCQl9CgkJCQlpZiAocCA9PSAiRW50aXR5VmFsdWVzIikgewoJCQkJCS8vIGFuIGVtc0Zvcm1WYWx1ZXMgc291cmNlCgkJCQkJLy8gZmluZCB0aGUgRW50aXR5VmFsdWUgZm9yIHRoaXMgZWxlbWVudCBhbmQgc2V0IGl0CgkJCQkJZm9yICh2YXIgaiA9IDA7IGogPCBvLkVudGl0eVZhbHVlcy5sZW5ndGg7IGorKykgewoJCQkJCQlpZiAoby5FbnRpdHlWYWx1ZXNbal0uRW50aXR5QXR0cmlidXRlLk5hbWUgPT0gZS5uYW1lKSB7CgkJCQkJCQkvLyBmb3VuZCB0aGUgRW50aXR5VmFsdWUgZm9yIHRoaXMgZWxlbWVudAoJCQkJCQkJX3YgPSBvLkVudGl0eVZhbHVlc1tqXTsKCQkJCQkJCWZvciAodmFyIHEgaW4gX3YpIHsKCQkJCQkJCQlpZiAocS5lbmRzV2l0aCgiVmFsdWUiKSkgewoJCQkJCQkJCQlfdltxXSA9IHZhbHVlOwoJCQkJCQkJCX0KCQkJCQkJCX0KCQkJCQkJCWJyZWFrOwoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQkJdGhpcy5zZXQodmFsdWUsIGUubmFtZSk7CgkJCX0KCQl9Cgl9CgoJZ2V0KCkgewoJCXZhciBvID0ge307CgkJaWYgKHRoaXMuc1RhYmxlICYmIHdpbmRvd1t0aGlzLnNUYWJsZV0pIG8gPSBuZXcgd2luZG93W3RoaXMuc1RhYmxlXSgpOwoJCWZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5lbGVtZW50cy5sZW5ndGg7IGkrKykgewoJCQl2YXIgY24gPSBudWxsOwoJCQl2YXIgdiA9IG51bGw7CgkJCXRyeSB7CgkJCQlsZXQgZU5hbWUgPSAiIyIgKyB0aGlzLnByZWZpeCh0aGlzLmVsZW1lbnRzW2ldKSArIHRoaXMuZWxlbWVudHNbaV0ubmFtZTsKCQkJCXN3aXRjaCAodGhpcy5lbGVtZW50c1tpXS50eXBlKSB7CgkJCQkJY2FzZSAnbGFiZWwnOgoJCQkJCQljbiA9ICQoZU5hbWUpOwoJCQkJCQl2ID0gY24uaHRtbCgpOwoJCQkJCQlicmVhazsKCQkJCQljYXNlICd0ZXh0JzoKCQkJCQljYXNlICdzdHJpbmcnOgoJCQkJCWNhc2UgJ3NlYXJjaCc6CgkJCQkJY2FzZSAncGFzc3dvcmQnOgoJCQkJCQljbiA9ICQoZU5hbWUpOwoJCQkJCQl2ID0gY24udmFsKCk7CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgImZpbGUiOgoJCQkJCWNhc2UgImltYWdlIjoKCQkJCQkJY24gPSAkKGVOYW1lKTsKCQkJCQkJdiA9IHRoaXMuZWxlbWVudHNbaV0uZGF0YTsKCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAiRGF0ZVRpbWUiOgoJCQkJCWNhc2UgImRhdGV0aW1lIjoKCQkJCQkJdiA9IG5ldyBEYXRlKCQoZU5hbWUpLmRhdGV0aW1lYm94KCdnZXRWYWx1ZScpKTsKCQkJCQkJY24gPSAkKGVOYW1lKTsKCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAicHJvZ3Jlc3MiOgoJCQkJCQljbiA9ICQoZU5hbWUpOwoJCQkJCQl2ID0gY24ucHJvZ3Jlc3NiYXIoJ2dldFZhbHVlJyk7CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgImludCI6CgkJCQkJY2FzZSAiaW50ZWdlciI6CgkJCQkJY2FzZSAibnVtYmVyIjoKCQkJCQljYXNlICJsb25nIjoKCQkJCQljYXNlICJMb25nIjoKCQkJCQkJY24gPSAkKGVOYW1lKTsKCQkJCQkJdiA9IHBhcnNlRmxvYXQoY24udmFsKCkpOwoJCQkJCQlpZiAoaXNOYU4odikpIHYgPSAwOwoJCQkJCQlicmVhazsKCQkJCQljYXNlICJncmlkIjoKCQkJCQkJY24gPSAkKGVOYW1lKTsKCQkJCQkJdiA9IGNuLmRhdGFncmlkKCdnZXREYXRhJyk7CgkJCQkJCXYuc2VsZWN0ZWQgPSBjbi5kYXRhZ3JpZCgiZ2V0U2VsZWN0ZWQiKTsKCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAidHJlZSI6CgkJCQkJCWNuID0gJChlTmFtZSk7CgkJCQkJCXYgPSBjbi5jb21ib3RyZWUoInRyZWUiKS50cmVlKCJnZXRTZWxlY3RlZCIpOwoJCQkJCQlicmVhazsKCQkJCQljYXNlICJ3aW5kb3ciOgoJCQkJCQl2ID0gdGhpcy5lbGVtZW50c1tpXS52YWx1ZTsKCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAic2VsZWN0IjoKCQkJCQkJaWYgKHRoaXMuZWxlbWVudHNbaV0ub3B0aW9ucykgewoJCQkJCQkJdiA9ICQoZU5hbWUpLmNvbWJvZ3JpZCgnZ2V0VmFsdWUnICsgKHRoaXMuZWxlbWVudHNbaV0ubXVsdGlwbGUgPyAncycgOiAnJykpOwoJCQkJCQkJdiA9IHRoaXMuc3IoKS5ydW5TY3JpcHQodik7CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQl2ID0gJChlTmFtZSkuY29tYm9ncmlkKCdncmlkJykuZGF0YWdyaWQoJ2dldFNlbGVjdGlvbnMnKTsKCQkJCQkJCWlmICghdiB8fCAhdi5sZW5ndGgpIHsKCQkJCQkJCQl2ID0gJChlTmFtZSkuY29tYm9ncmlkKCdnZXRWYWx1ZScgKyAodGhpcy5lbGVtZW50c1tpXS5tdWx0aXBsZSA/ICdzJyA6ICcnKSk7CgkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCWlmICghdGhpcy5lbGVtZW50c1tpXS5tdWx0aXBsZSkgdiA9IHZbMF07CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQkJY24gPSAkKGVOYW1lKTsKCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAiYm9vbCI6CgkJCQkJCWNuID0gJChlTmFtZSk7CgkJCQkJCXYgPSBjbi5zd2l0Y2hidXR0b24oJ29wdGlvbnMnKS5jaGVja2VkOwoJCQkJCQlicmVhazsKCQkJCQlkZWZhdWx0OgoJCQkJCQlicmVhazsKCQkJCX0KCQkJCW9bdGhpcy5lbGVtZW50c1tpXS5uYW1lXSh2KTsKCQkJfSBjYXRjaCAoZSkgewoJCQkJLy9jb25zb2xlLmxvZyh0aGlzLmVsZW1lbnRzW2ldLm5hbWUsIGUpOwoJCQkJb1t0aGlzLmVsZW1lbnRzW2ldLm5hbWVdID0gdjsKCQkJfQoJCQlpZiAoY24pIHsKCQkJCWlmIChvLkVudGl0eVZhbHVlcykgewoJCQkJCWZvciAodmFyIGogPSAwOyBqIDwgby5FbnRpdHlWYWx1ZXMubGVuZ3RoOyBqKyspIHsKCQkJCQkJaWYgKHRoaXMuZWxlbWVudHNbaV0ubmFtZSA9PSB0aGlzLnNUYWJsZSAmJiB0aGlzLmVsZW1lbnRzW2ldLmVtc1NvdXJjZSkgby5JZCA9IHRoaXMuZWxlbWVudHNbaV0uZW1zU291cmNlLklkOwoJCQkJCQlpZiAoby5FbnRpdHlWYWx1ZXNbal0uRW50aXR5QXR0cmlidXRlLk5hbWUgPT0gdGhpcy5lbGVtZW50c1tpXS5uYW1lICYmIHRoaXMuZWxlbWVudHNbaV0uZW1zU291cmNlKSB7CgkJCQkJCQlvLkVudGl0eVZhbHVlc1tqXS5JZCA9IHRoaXMuZWxlbWVudHNbaV0uZW1zU291cmNlLklkOwoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQl9CgkJfQoJCXJldHVybiBvOwoJfQoKCWNIZWlnaHQob3B0aW9ucykgewoJCWlmIChvcHRpb25zICYmIG9wdGlvbnMuZWRpdG9yKSByZXR1cm4gd2luZG93LmlubmVySGVpZ2h0OwoJCWlmIChvcHRpb25zICYmIG9wdGlvbnMuaGVpZ2h0ICYmIHR5cGVvZihvcHRpb25zLmhlaWdodCkgPT09ICdzdHJpbmcnKSByZXR1cm4gdGhpcy5oZWlnaHQ7CgkJaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy50eXBlID09ICd3aW5kb3cnICYmICFvcHRpb25zLmhlaWdodCkgcmV0dXJuIHRoaXMuaGVpZ2h0ICogMC45OwoJCXJldHVybiBNYXRoLmZsb29yKCgob3B0aW9ucyA/IG9wdGlvbnMuaGVpZ2h0IDogbnVsbCkgfHwgKHRoaXMuaGVpZ2h0IC8gMykpKTsKCX0KCglzZWFyY2gob3B0aW9ucykgewoJCXJldHVybiB0aGlzLnN0cmluZyhvcHRpb25zKTsKCX0KCglzdHJpbmcob3B0aW9ucykgewoJCW9wdGlvbnMuaGVpZ2h0ID0gMjA7CgkJb3B0aW9ucy5zaW1wbGUgPSB0cnVlOwoJCXJldHVybiB0aGlzLnRleHQob3B0aW9ucyk7Cgl9CgoJZGF0ZXRpbWUob3B0aW9ucykgewoJCXJldHVybiBgPGlucHV0IGlkPSJkdHAke29wdGlvbnMubmFtZX0iIGNsYXNzPSJlYXN5dWktJHt0aGlzLnVpVHlwZXNbb3B0aW9ucy50eXBlXX0iIHJlcXVpcmVkPSIke29wdGlvbnMucmVxdWlyZWQgPyAndHJ1ZScgOiAnZmFsc2UnfSIgdmFsdWU9IiR7dGhpcy52YWx1ZShvcHRpb25zKX0iIHN0eWxlPSJ3aWR0aDoke3RoaXMuY1dpZHRoKG9wdGlvbnMpfXB4Ij5gOwoJfQoKCXF1ZXJ5KG9wdGlvbnMpIHsKCQlyZXR1cm4gIjxkaXYgaWQ9J3ZzIiArIG9wdGlvbnMubmFtZSArICInPjwvZGl2PiI7Cgl9CgoJRGF0ZVRpbWUob3B0aW9ucykgewoJCXJldHVybiB0aGlzLmRhdGV0aW1lKG9wdGlvbnMpOwoJfQoKCWxvbmcob3B0aW9ucykgewoJCXJldHVybiB0aGlzLmludChvcHRpb25zKTsKCX0KCglMb25nKG9wdGlvbnMpIHsKCQlyZXR1cm4gdGhpcy5sb25nKG9wdGlvbnMpOwoJfQoKCXZhbHVlKG9wdGlvbnMpIHsKCQlpZiAodHlwZW9mIG9wdGlvbnMudmFsdWUgPT09ICdmdW5jdGlvbicpIHsKCQkJdHJ5IHsKCQkJCXJldHVybiBvcHRpb25zLnZhbHVlKHRoaXMuZ2V0KCkpOwoJCQl9IGNhdGNoIChleCkgewoJCQkJY29uc29sZS5sb2coYERGb3JtLnZhbHVlKCR7b3B0aW9ucy5uYW1lfSk6ICR7ZXh9YCk7CgkJCQlyZXR1cm4gJyc7CgkJCX0KCQl9IGVsc2UgewoJCQlzd2l0Y2ggKG9wdGlvbnMudHlwZSkgewoJCQkJY2FzZSAnaW50JzoKCQkJCWNhc2UgJ3Byb2dyZXNzJzoKCQkJCQlyZXR1cm4gb3B0aW9ucy52YWx1ZSB8fCBvcHRpb25zLm1pbiB8fCAwOwoJCQkJY2FzZSAnc3RyaW5nJzoKCQkJCWNhc2UgJ3RleHQnOgoJCQkJY2FzZSAnZGF0ZXRpbWUnOgoJCQkJY2FzZSAnbGFiZWwnOgoJCQkJCXJldHVybiBvcHRpb25zLnZhbHVlIHx8ICIiOwoJCQkJZGVmYXVsdDoKCQkJCQlyZXR1cm4gb3B0aW9ucy52YWx1ZTsKCQkJfQoJCX0KCX0KCglpbnQob3B0aW9ucykgewoJCWxldCByZXQgPSBgPGlucHV0IGlkPSJudWQke29wdGlvbnMubmFtZX0iIGNsYXNzPSJlYXN5dWktJHt0aGlzLnVpVHlwZXNbb3B0aW9ucy50eXBlXX0iIHJlcXVpcmVkPSIke29wdGlvbnMucmVxdWlyZWQgPyAndHJ1ZScgOiAnZmFsc2UnfSIgdmFsdWU9IiR7dGhpcy52YWx1ZShvcHRpb25zKX0iIGRhdGEtb3B0aW9ucz0ibWluOiR7b3B0aW9ucy5taW4gfHwgMH0sbWF4OiR7b3B0aW9ucy5tYXggfHwgMTAwfSxpbmNyZW1lbnQ6JHtvcHRpb25zLmluY3JlbWVudCB8fCAxfSIgc3R5bGU9IndpZHRoOiR7dGhpcy5jV2lkdGgob3B0aW9ucyl9cHg7Ij48L2lucHV0PmA7CgkJLy9jb25zb2xlLmxvZyhyZXQpOwoJCXJldHVybiByZXQ7Cgl9CgoJbWVudShvcHRpb25zKSB7CgkJdmFyIHJldCA9ICIiOwoJCXJldCArPSAnPGRpdiBjbGFzcz0iZWFzeXVpLXBhbmVsIiBpZD0ibW51JyArIG9wdGlvbnMubmFtZSArICciIHN0eWxlPSJwYWRkaW5nOjVweDsiPlxuJzsKCQkkLmVhY2gob3B0aW9ucy5tZW51LCAoXywgbSkgPT4gcmV0ICs9IGA8YSBocmVmPSIjIiBjbGFzcz0iZWFzeXVpLSR7dGhpcy51aVR5cGVzW29wdGlvbnMudHlwZSB8fCAnbWVudSddfSIgZGF0YS1vcHRpb25zPSJtZW51OicjbW0ke20ubGFiZWwucmVwbGFjZSgvIC9nLCAnJyl9JyxpY29uQ2xzOidpY29uLSR7bS5pY29uIHx8ICdub25lJ30nIj4ke20ubGFiZWx9PC9hPlxuYCk7CgkJcmV0ICs9ICI8L2Rpdj5cbiI7CgkJbGV0IGR2ID0gbSA9PiB7CgkJCWxldCByZXQgPSAnPGRpdicgKyAobS5zdWJNZW51cyA/ICcnIDogYCBkYXRhLW9wdGlvbnM9Imljb25DbHM6J2ljb24tJHttLmljb24gfHwgJ25vbmUnfSciYCkgKyAnPlxuJzsKCQkJcmV0ICs9IG0uc3ViTWVudXMgPyAnPHNwYW4+JyArIChtLmxhYmVsIHx8IHRoaXMuZW5nbGlzaChtLmNvZGUpKSArICc8L3NwYW4+XG48ZGl2PicgOiAoYDxzcGFuIHdpZHRoPScxMDAlJyBvbmNsaWNrPScoYXN5bmMgKCkgPT4ge2xldCBtID0gJHtfRnJFTUQuX3RvSlMobSl9OyBpZihtLmFjdGlvbil7cmV0dXJuIGF3YWl0IG0uYWN0aW9uKERGb3JtLmdldCgpLCBtKTt9IGlmIChtLnN1Yk1lbnVzKSByZXR1cm47IGF3YWl0IF9GckVNRC5SZW5kZXJQYWdlKHtfY29kZTogbS5jb2RlIHx8IG0ubGFiZWwucmVwbGFjZSgvIC9nLCAiIikudG9Mb3dlckNhc2UoKX0sIG0uZGF0YSk7fSkoKSc+JHttLmxhYmVsIHx8IHRoaXMuZW5nbGlzaChtLmNvZGUpfTwvc3Bhbj5gKTsKCQkJJC5lYWNoKG0uc3ViTWVudXMsIChfLCBzKSA9PiByZXQgKz0gZHYocykpOwoJCQlyZXQgKz0gKG0uc3ViTWVudXMgPyAiPC9kaXY+XG4iIDogIiIpICsgYDwvZGl2PlxuYDsKCQkJcmV0dXJuIHJldDsKCQl9OwoJCWZvciAodmFyIGkgPSAwOyBpIDwgb3B0aW9ucy5tZW51Lmxlbmd0aDsgaSsrKSB7CgkJCXZhciBtID0gb3B0aW9ucy5tZW51W2ldOwoJCQlyZXQgKz0gJzxkaXYgaWQ9Im1tJyArIG0ubGFiZWwucmVwbGFjZSgvIC9nLCAnJykgKyAnIiBzdHlsZT0id2lkdGg6MTUwcHg7Ij4nOwoJCQlmb3IgKHZhciBqID0gMDsgaiA8IG0uc3ViTWVudXMubGVuZ3RoOyBqKyspIHsKCQkJCXZhciBzbSA9IG0uc3ViTWVudXNbal07CgkJCQlyZXQgKz0gZHYoc20pOwoJCQl9CgkJCXJldCArPSAnPC9kaXY+XG4nOwoJCX0KCQlyZXR1cm4gcmV0OwoJfQoKCWludGVnZXIob3B0aW9ucykgewoJCXJldHVybiB0aGlzLmludChvcHRpb25zKTsKCX0KCgludW1iZXIob3B0aW9ucykgewoJCXJldHVybiB0aGlzLmludChvcHRpb25zKTsKCX0KCglJbnRlZ2VyKG9wdGlvbnMpIHsKCQlyZXR1cm4gdGhpcy5pbnQob3B0aW9ucyk7Cgl9CgoJYm9vbChvcHRpb25zKSB7CgkJcmV0dXJuIGA8aW5wdXQgaWQ9IiR7dGhpcy5wcmVmaXgob3B0aW9ucyl9JHtvcHRpb25zLm5hbWV9IiBkYXRhLWRmb3JtPSJlbGVtZW50OiR7b3B0aW9ucy5uYW1lfSIgcmVxdWlyZWQ9IiR7b3B0aW9ucy5yZXF1aXJlZD8ndHJ1ZSc6J2ZhbHNlJ30iIGRhdGEtb3B0aW9ucz0nZGlzYWJsZWQ6JHtvcHRpb25zLmRpc2FibGVkPyd0cnVlJzonZmFsc2UnfSwke3RoaXMuZXZlbnRIYW5kbGVycyhvcHRpb25zKX0nIGNsYXNzPSJlYXN5dWktJHt0aGlzLnVpVHlwZXNbb3B0aW9ucy50eXBlXX0iICR7b3B0aW9ucy5jaGVja2VkPydjaGVja2VkJzonJ30gLz5gOwoJfQoKCWxhYmVsKG9wdGlvbnMpIHsKCQlyZXR1cm4gYDxzcGFuIGlkPSIke3RoaXMucHJlZml4KG9wdGlvbnMpfSR7b3B0aW9ucy5uYW1lfSIgc3R5bGU9IndpZHRoOiR7dGhpcy5jV2lkdGgob3B0aW9ucyl9cHgiIGRhdGEtb3B0aW9ucz0iZGlzYWJsZWQ6JHtvcHRpb25zLmRpc2FibGVkPyd0cnVlJzonZmFsc2UnfSI+JHt0aGlzLnZhbHVlKG9wdGlvbnMpfTwvc3Bhbj5gOwoJfQoKCXVybChvcHRpb25zKSB7CgkJcmV0dXJuIHRoaXMuc3RyaW5nKG9wdGlvbnMpLnJlcGxhY2UoIkZpZWxkQ2hhbmdlIiwgIlVSTENoYW5nZSIpOwoJfQoKCXRleHQob3B0aW9ucykgewoJCXJldHVybiBgPGlucHV0IGlkPSIke3RoaXMucHJlZml4KG9wdGlvbnMpfSR7b3B0aW9ucy5uYW1lfSIgY2xhc3M9ImVhc3l1aS0ke29wdGlvbnMuZWRpdG9yIHx8IHRoaXMudWlUeXBlc1tvcHRpb25zLnR5cGVdfSIgZGF0YS1vcHRpb25zPSdkaXNhYmxlZDoke29wdGlvbnMuZGlzYWJsZWQ/J3RydWUnOidmYWxzZSd9LCR7dGhpcy5ldmVudEhhbmRsZXJzKG9wdGlvbnMpfScgbXVsdGlsaW5lPSIke29wdGlvbnMuc2ltcGxlID8gJ2ZhbHNlJyA6ICd0cnVlJ30iIHN0eWxlPSJ3aGl0ZS1zcGFjZTpwcmUtd3JhcDt3aWR0aDoke3RoaXMuY1dpZHRoKG9wdGlvbnMpfXB4O2hlaWdodDoke3RoaXMuY0hlaWdodChvcHRpb25zKX1weCIgcmVxdWlyZWQ9IiR7b3B0aW9ucy5yZXF1aXJlZCA/ICd0cnVlJyA6ICdmYWxzZSd9IiB2YWx1ZT0iJHt0aGlzLnZhbHVlKG9wdGlvbnMpfSIgLz5gOwoJfQoKCXBhc3N3b3JkKG9wdGlvbnMpIHsKCQl2YXIgcmV0ID0gdGhpcy5zdHJpbmcob3B0aW9ucyk7CgkJcmV0ID0gcmV0LnJlcGxhY2UoJzxpbnB1dCAnLCAnPGlucHV0IHR5cGU9InBhc3N3b3JkIiAnKTsKCQlyZXR1cm4gcmV0OwoJfQoKCWZpbGUob3B0aW9ucykgewoJCXJldHVybiBgPGlucHV0IGlkPSIke3RoaXMucHJlZml4KG9wdGlvbnMpfSR7b3B0aW9ucy5uYW1lfSIgY2xhc3M9ImVhc3l1aS0ke3RoaXMudWlUeXBlc1tvcHRpb25zLnR5cGVdfSIgZGF0YS1vcHRpb25zPSJvbkNoYW5nZTpmdW5jdGlvbihuLG8pe3ZhciBzID0gJCgnIycgKyB0aGlzLmlkKS5maWxlYm94KCdvcHRpb25zJyk7IHRoaXMuVXBsb2FkRmlsZShzLCB0aGlzLmJ5TmFtZSgnJHtvcHRpb25zLm5hbWV9JykpO30iIHN0eWxlPSJ3aWR0aDoke3RoaXMuY1dpZHRoKG9wdGlvbnMpfXB4Ij5gOwoJfQoKCWltYWdlKG9wdGlvbnMpIHsKCQlyZXR1cm4gdGhpcy5maWxlKG9wdGlvbnMpICsgYDxkaXYgaWQ9ImRsZyR7b3B0aW9ucy5uYW1lfSIgY2xhc3M9ImVhc3l1aS0ke3RoaXMudWlUeXBlc1tvcHRpb25zLnR5cGVdfSIgdGl0bGU9IkltYWdlIFByZXZpZXciIGRhdGEtb3B0aW9ucz0iY2xvc2VkOnRydWUsaWNvbkNsczonaWNvbi1zYXZlJyxyZXNpemFibGU6ZmFsc2UsbW9kYWw6dHJ1ZSIgc3R5bGU9IndpZHRoOjQwMHB4O2hlaWdodDoyMDBweDtwYWRkaW5nOjEwcHgiPjxpbWcgaWQ9IiR7dGhpcy5wcmVmaXgob3B0aW9ucyl9JHtvcHRpb25zLm5hbWV9IiB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIi8+PC9kaXY+YDsKCX0KCglwcm9ncmVzcyhvcHRpb25zKSB7CgkJaWYgKCFvcHRpb25zLmhlaWdodCkgb3B0aW9ucy5oZWlnaHQgPSAyMDsgLy8gZml4IGJpZyBwcm9ncmVzcwoJCXJldHVybiBgPGRpdiBpZD0iJHt0aGlzLnByZWZpeChvcHRpb25zKX0ke29wdGlvbnMubmFtZX0iIGNsYXNzPSJlYXN5dWktJHt0aGlzLnVpVHlwZXNbb3B0aW9ucy50eXBlXX0iIGRhdGEtb3B0aW9ucz0idmFsdWU6JHt0aGlzLnZhbHVlKG9wdGlvbnMpfSIgc3R5bGU9IndpZHRoOiR7dGhpcy5jV2lkdGgob3B0aW9ucyl9cHg7aGVpZ2h0OiR7dGhpcy5jSGVpZ2h0KG9wdGlvbnMpfXB4Ij48L2Rpdj5gOwoJfQoKCWZsb3djaGFydChvcHRpb25zKSB7CgkJcmV0dXJuIGA8ZGl2IGlkPSJmbHcke29wdGlvbnMubmFtZX0iIHdpZHRoPSIke3RoaXMuY1dpZHRoKG9wdGlvbnMpfSIgaGVpZ2h0PSIke3RoaXMuY0hlaWdodChvcHRpb25zKX0iPjwvZGl2PmA7Cgl9CgoJY2hhcnQob3B0aW9ucykgewoJCXJldHVybiBgPGRpdiBpZD0iY2h0JHtvcHRpb25zLm5hbWV9IiB3aWR0aD0iJHt0aGlzLmNXaWR0aChvcHRpb25zKX0iIGhlaWdodD0iJHt0aGlzLmNIZWlnaHQob3B0aW9ucyl9Ij48L2Rpdj5gOwoJfQoKCWZvcm1hdHRlcihuYW1lLCBjLCBqc29uKSB7CgkJanNvbiA9IGpzb24gPyAnIicgOiAnJzsKCQlyZXR1cm4gYCR7anNvbn0odmFsdWUsIHJvdywgaW5kZXgpID0+IHt0cnl7dmFyIGMgPSAoREZvcm0uYnlOYW1lKFxgJHtuYW1lfVxgKS5jb2x1bW5zIHx8IFtdKS5maW5kKGMgPT4gYy5maWVsZD09XGAke2MuZmllbGR9XGApOyByZXR1cm4gYyYmYy5mb3JtYXQ/Yy5mb3JtYXQodmFsdWUscm93LGluZGV4KTp2YWx1ZTt9Y2F0Y2goZXgpe3JldHVybiB2YWx1ZTt9IH0ke2pzb259YDsKCX0KCgltYXBDb2x1bW5zKG9wdGlvbnMsIGpzb24pIHsKCQlsZXQgY1RpdGxlID0gYyA9PiBjLnRpdGxlIHx8IHRoaXMuZW5nbGlzaChjLmZpZWxkKTsKCgkJdmFyIGNvbHMgPSAkLmdyZXAob3B0aW9ucy5jb2x1bW5zIHx8IFtdLCBjID0+ICFjLmlnbm9yZSk7CgkJbGV0IHJldCA9ICIiOwoJCWlmIChvcHRpb25zLm11bHRpcGxlKSByZXQgKz0gYHsiZmllbGQiOidjaycsImNoZWNrYm94Ijp0cnVlfSxgOwoJCXJldCA9IGAiZnJvemVuQ29sdW1ucyI6IFtbYDsKCQlpZiAoIW9wdGlvbnMuZnJvemVuKSB7CgkJCXJldCArPSBgeyJmaWVsZCI6IiR7b3B0aW9ucy5pZEZpZWxkLmZpZWxkfSIsInRpdGxlIjogIiR7b3B0aW9ucy5pZEZpZWxkLnRpdGxlfSIsInNvcnRhYmxlIjogInRydWUiLCAiZm9ybWF0dGVyIjogJHt0aGlzLmZvcm1hdHRlcihvcHRpb25zLm5hbWUsIG9wdGlvbnMuaWRGaWVsZCwganNvbil9fSxgOwoJCQlpZiAob3B0aW9ucy50ZXh0RmllbGQuZmllbGQgIT0gb3B0aW9ucy5pZEZpZWxkLmZpZWxkKSByZXQgKz0gYHsiZmllbGQiOiIke29wdGlvbnMudGV4dEZpZWxkLmZpZWxkIHx8IG9wdGlvbnMudGV4dEZpZWxkLnRpdGxlfSIsInRpdGxlIjoiJHtvcHRpb25zLnRleHRGaWVsZC50aXRsZSB8fCBvcHRpb25zLnRleHRGaWVsZC5maWVsZH0iLCJ3aWR0aCI6IiR7b3B0aW9ucy50ZXh0RmllbGQud2lkdGh8fDEyMH0iLCAic29ydGFibGUiOiAidHJ1ZSIsICJmb3JtYXR0ZXIiOiAke3RoaXMuZm9ybWF0dGVyKG9wdGlvbnMubmFtZSwgb3B0aW9ucy50ZXh0RmllbGQsIGpzb24pfX1gOwoJCX0gZWxzZSB7CgkJCSQubWFwKCQuZ3JlcChjb2xzLCBjID0+IGMuZnJvemVuKSwgYyA9PiBgeyJmaWVsZCI6IiR7Yy5maWVsZCB8fCBjVGl0bGUoYyl9IiwidGl0bGUiOiIke2NUaXRsZShjKSB8fCBjLmZpZWxkfSIsIndpZHRoIjoiJHtjLndpZHRofHwxMjB9IiwiYWxpZ24iOidsZWZ0Jywic29ydGFibGUiOiJ0cnVlIiwgImZvcm1hdHRlciI6ICR7dGhpcy5mb3JtYXR0ZXIob3B0aW9ucy5uYW1lLCBjLCBqc29uKX19YCkuam9pbigiLCIpOwoJCX0KCQlyZXQgKz0gYF1dLCAiY29sdW1ucyI6IFtbYDsKCQlyZXQgKz0gJC5tYXAoJC5ncmVwKGNvbHMsIGMgPT4gIWMuZnJvemVuKSwgYyA9PiBgeyJmaWVsZCI6IiR7Yy5maWVsZCB8fCBjVGl0bGUoYyl9IiwidGl0bGUiOiIke2NUaXRsZShjKSB8fCBjLmZpZWxkfSIsImFsaWduIjoibGVmdCIsInNvcnRhYmxlIjoidHJ1ZSIsICJmb3JtYXR0ZXIiOiAke3RoaXMuZm9ybWF0dGVyKG9wdGlvbnMubmFtZSwgYywganNvbil9fWApLmpvaW4oIiwiKTsKCQlyZXQgKz0gJ11dJzsKCQlyZXR1cm4gcmV0OwoJfQoKCXNlbGVjdChvcHRpb25zLCB0YWcgPSBvcHRpb25zLnRhZywgdHlwZSkgewoJCXJldHVybiB0aGlzLmNvbWJvKG9wdGlvbnMsIHRhZywgdHlwZSk7Cgl9CgoJdHJlZShvcHRpb25zKSB7CgkJcmV0dXJuIHRoaXMuc2VsZWN0KG9wdGlvbnMsICJzZWxlY3QiKTsKCX0KCgluYXZpZ2F0aW9uKG9wdGlvbnMpIHsKCQlyZXR1cm4gdGhpcy5jb21ibyhvcHRpb25zLCAndWwnLCAndHJlZScpOwoJfQoKCWNvbWJvKG9wdGlvbnMsIHRhZywgdHlwZSkgewoJCXZhciBjb2xzID0gJC5ncmVwKG9wdGlvbnMuY29sdW1ucyB8fCBbXSwgYyA9PiAhYy5pZ25vcmUpOwoJCXRhZyA9IHRhZyB8fCAic2VsZWN0IjsKCgkJb3B0aW9ucy5pZEZpZWxkID0gJC51bmlxdWVTb3J0KFt7CgkJCWZpZWxkOiBvcHRpb25zLmlkRmllbGQsCgkJCXRpdGxlOiBvcHRpb25zLmlkRmllbGQKCQl9XS5jb25jYXQoJC5ncmVwKGNvbHMsIGMgPT4gYy5wcmltYXJ5KSwgW3sKCQkJZmllbGQ6ICdJZCcsCgkJCXRpdGxlOiAnSUQnCgkJfV0pKS5maW5kKHggPT4gdHlwZW9mKHguZmllbGQpICE9PSAidW5kZWZpbmVkIik7CgoJCW9wdGlvbnMudGV4dEZpZWxkID0gJC51bmlxdWVTb3J0KFt7CgkJCWZpZWxkOiBvcHRpb25zLnRleHRGaWVsZCwKCQkJdGl0bGU6IG9wdGlvbnMudGV4dEZpZWxkCgkJfV0uY29uY2F0KCQuZ3JlcChjb2xzLCBjID0+IGMuZGlzcGxheSksIFt7CgkJCWZpZWxkOiAnX1RvU3RyaW5nJywKCQkJdGl0bGU6IG9wdGlvbnMubmFtZSwKCQl9XSkpLmZpbmQoeCA9PiB0eXBlb2YoeC5maWVsZCkgIT09ICJ1bmRlZmluZWQiKTsKCgkJdmFyIGZ1biA9IHR5cGUgfHwgdGhpcy5lRnVuKG9wdGlvbnMpOwoKCQl2YXIgZHJvcGRvd24gPSBbJ2NvbWJvdHJlZWdyaWQnLCAnY29tYm90cmVlJywgJ2NvbWJvZ3JpZCcsICdzZWxlY3QnXS5pbmRleE9mKGZ1bikgPiAtMTsKCQlpZiAoZHJvcGRvd24pIHRoaXMuc2VsZWN0cy5wdXNoKHsKCQkJaWQ6ICJjbWIiICsgb3B0aW9ucy5uYW1lLAoJCQlvcHRpb25zOiB0aGlzLmJ5TmFtZShvcHRpb25zLm5hbWUpCgkJfSk7CgkJdGhpcy5zZWxlY3RzID0gJC51bmlxdWVTb3J0KHRoaXMuc2VsZWN0cyk7CgkJdmFyIHJldCA9IGA8JHt0YWd9IGlkPSJjbWIke29wdGlvbnMubmFtZX0iIGNsYXNzPSJlYXN5dWktJHtmdW59IiBzdHlsZT0ibWF4LXdpZHRoOiR7ZHJvcGRvd24/JzQwMHB4Jzp0aGlzLmNXaWR0aChvcHRpb25zKX07IHdpZHRoOiR7dGhpcy5jV2lkdGgob3B0aW9ucyl9cHgiIHJlcXVpcmVkPSIkeyhvcHRpb25zLnJlcXVpcmVkID8gJ3RydWUnIDogJ2ZhbHNlJyl9IiBkYXRhLW9wdGlvbnM9J2Rpc2FibGVkOiR7b3B0aW9ucy5kaXNhYmxlZD8ndHJ1ZSc6J2ZhbHNlJ30sJHt0aGlzLmV2ZW50SGFuZGxlcnMob3B0aW9ucyl9LCB2YWx1ZToiJHt0aGlzLnZhbHVlKG9wdGlvbnMpfSIsIHJvd251bWJlcnM6JHt0eXBlb2Yob3B0aW9ucy5yb3dOdW1iZXJzKSE9PSd1bmRlZmluZWQnP29wdGlvbnMucm93TnVtYmVyczooZnVuLmluZGV4T2YoJ3RyZWUnKTwtMT8nZmFsc2UnOid0cnVlJyl9LCBwYWdpbmF0aW9uOiR7dHlwZW9mKG9wdGlvbnMucGFnaW5hdGlvbikhPT0ndW5kZWZpbmVkJz9vcHRpb25zLnBhZ2luYXRpb246KGZ1bi5pbmRleE9mKCd0cmVlJyk8LTE/J2ZhbHNlJzondHJ1ZScpfSwgcGFuZWxXaWR0aDokezIqdGhpcy5jV2lkdGgob3B0aW9ucyl9LCBmaXRDb2x1bW5zOiB0cnVlLCBzaW5nbGVTZWxlY3Q6IHRydWUsIG11bHRpcGxlOiR7KG9wdGlvbnMubXVsdGlwbGUgfHwgJ2ZhbHNlJyl9LCBpZEZpZWxkOiAiJHtvcHRpb25zLmlkRmllbGQuZmllbGR9IiwgZW5hYmxlRmlsdGVyOiAke29wdGlvbnMuZmlsdGVyPyd0cnVlJzonZmFsc2UnfSwgbm93cmFwOiBmYWxzZSwgdGV4dEZpZWxkOiAiJHtvcHRpb25zLnRleHRGaWVsZC5maWVsZH0iLCB0cmVlRmllbGQ6ICIke29wdGlvbnMudGV4dEZpZWxkLmZpZWxkfSIsYDsKCQlpZiAoZnVuLmluZGV4T2YoJ3RyZWUnKSA9PSAtMSkgewoJCQlyZXQgKz0gJ2ZpdENvbHVtbnM6IGZhbHNlLCcgKyB0aGlzLm1hcENvbHVtbnMob3B0aW9ucyk7CgkJfQoJCWlmIChvcHRpb25zLmRhdGEpIHsKCQkJcmV0ICs9IGAsZGF0YTogJHtKU09OLnN0cmluZ2lmeShvcHRpb25zLmRhdGEpfWA7CgkJfQoJCXJldCArPSBgJz5gOwoJCWlmIChvcHRpb25zLm9wdGlvbnMpIHsKCQkJcmV0ICs9ICQubWFwKG9wdGlvbnMub3B0aW9ucywgbyA9PiBgPG9wdGlvbiB2YWx1ZT0nJHtfRnJFTUQuX3RvSlMobyl9Jz4ke28ubmFtZSB8fCBvfTwvb3B0aW9uPmApLmpvaW4oJ1xuJyk7CgkJfQoJCXJldCArPSBgPC8ke3RhZ30+YDsKCQkvLyBjb25zb2xlLmxvZyhyZXQpOwoJCXJldHVybiByZXQ7Cgl9CgoJZ3JpZChvcHRpb25zLCB0YWcsIHR5cGUpIHsKCQlyZXR1cm4gdGhpcy5jb21ibyhvcHRpb25zLCAidGFibGUiLCAiZGF0YWdyaWQiKTsKCX0KCgl0cmVlZ3JpZChvcHRpb25zKSB7CgkJcmV0dXJuIHRoaXMuY29tYm8ob3B0aW9ucywgJ3RhYmxlJywgJ3RyZWUnKTsKCX0KCglhc3luYyBkb0xpbmsoZSwgZXZlbnQpIHsKCQl0aGlzLmJ1c3kodHJ1ZSk7CgkJdHJ5IHsKCQkJYXdhaXQgZS5saW5rcy5maW5kKGwgPT4gbC5sYWJlbCA9PSBldmVudC50YXJnZXQuaW5uZXJUZXh0KS5vbkNsaWNrKHRoaXMuZ2V0KCkpOwoJCX0gY2F0Y2ggKGV4KSB7CgkJCWNvbnNvbGUubG9nKCJEeW5hRm9ybTo6ZG9MaW5rKCk6IEV4Y2VwdGlvbjogIiArIGV4KTsKCQl9CgkJdGhpcy5idXN5KGZhbHNlKTsKCX0KCglFZGl0ZWRWYWx1ZShlKSB7CgkJcmV0dXJuICh0eXBlb2YoYWNlKSAhPT0gInVuZGVmaW5lZCIpID8gYWNlLmVkaXQoJ3BubCcgKyBlLm5hbWUpLnNlc3Npb24uZ2V0VmFsdWUoKSA6ICcnOwoJfQoKCWFzeW5jIFBhbk9uQ2xvc2UoZSkgewoJCWlmIChlLmVkaXRvcikgewoJCQllLnZhbHVlID0gdGhpcy5FZGl0ZWRWYWx1ZShlKTsKCQl9CgkJaWYgKGUuY2xvc2UpIHsKCQkJYXdhaXQgZS5jbG9zZSh0aGlzLmdldCgpKTsKCQl9Cgl9CgoJYXN5bmMgUGVuZEFmdGVyT3BlbihlKSB7CgkJaWYgKGUuZWRpdG9yICYmIHR5cGVvZihhY2UpICE9PSAidW5kZWZpbmVkIikgewoJCQlhd2FpdCBfRnJFTUQuT3BlbkVkaXRvcigncG5sJyArIGUubmFtZSAvKisgJy1jZW50ZXInKi8gLCBlLmxhbmd1YWdlLCBlLmxvYWRlciB8fCAobyA9PiBlLnZhbHVlKSwgZS5zYXZlciwgdGhpcy5nZXQoKSwgZSk7CgkJfQoJCWlmIChlLm9wZW4pIHsKCQkJYXdhaXQgZS5vcGVuKHRoaXMuZ2V0KCkpOwoJCX0KCX0KCglsaW5rKG9wdGlvbnMpIHsKCQlyZXR1cm4gKG9wdGlvbnMubGlua3MgfHwgW10pLmZpbHRlcihsID0+ICFsLmlnbm9yZSkubWFwKGwgPT4gYDxhIGhyZWY9IiMiIGNsYXNzPSJlYXN5dWktJHt0aGlzLnVpVHlwZXNbb3B0aW9ucy50eXBlXX0iIGRhdGEtb3B0aW9ucz0nJHt0aGlzLmV2ZW50SGFuZGxlcnMob3B0aW9ucyl9LCBpY29uQ2xzOiJpY29uLSR7bC5pY29uIHx8ICdvayd9Iic+JHtsLmxhYmVsfTwvYT5gKS5qb2luKCdcbicpOwoJfQoKCWFzeW5jIFNldFRyZWVEYXRhKGUsIG4sIGRhdGEpIHsKCQkkLmVhY2goJCgiI2NtYiIgKyBlLm5hbWUpW3RoaXMuZUZ1bihlKV0oJ3RyZWUnKS50cmVlKCJnZXRDaGlsZHJlbiIsIG4udGFyZ2V0KSwgKF8sIGMpID0+ICQoIiNjbWIiICsgZS5uYW1lKVt0aGlzLmVGdW4oZSldKCd0cmVlJykudHJlZSgicmVtb3ZlIiwgYy50YXJnZXQpKTsKCQkkKCIjY21iIiArIGUubmFtZSlbdGhpcy5lRnVuKGUpXSgndHJlZScpLnRyZWUoImFwcGVuZCIsIHsKCQkJcGFyZW50OiBuLnRhcmdldCwKCQkJZGF0YTogZGF0YQoJCX0pOwoJCXJldHVybiB0cnVlOwoJfQoKCWFzeW5jIEV4cGFuZChlLCBuKSB7CgkJdGhpcy5TZXRUcmVlRGF0YShlLCBuLCBbewoJCQlpZDogbnVsbCwKCQkJdGV4dDogImxvYWRpbmcuLi4iCgkJfV0pOwoJCXZhciBvYmogPSB7fTsKCQl2YXIgcEZpZWxkID0gZS5wYXJlbnRGaWVsZCB8fCAkLm1hcCgkLmdyZXAoZS5jb2x1bW5zIHx8IFtdLCBjID0+IGMucGFyZW50KSwgYyA9PiBjLmZpZWxkKS5jb25jYXQoW251bGxdKVswXTsKCQl2YXIgaWRGaWVsZCA9ICQuZ3JlcChlLmNvbHVtbnMgfHwgW10sIGMgPT4gYy5wcmltYXJ5KS5jb25jYXQoZS5pZEZpZWxkKVswXS5maWVsZDsKCQlpZiAocEZpZWxkKSB7CgkJCW9ialtwRmllbGRdID0gewoJCQkJX3NvdXJjZTogbi5fc291cmNlCgkJCX07CgkJCWlmIChpZEZpZWxkKSB7CgkJCQlvYmpbcEZpZWxkXVtpZEZpZWxkXSA9IG4uaWQ7CgkJCX0gZWxzZSB7CgkJCQlvYmpbcEZpZWxkXSA9IG4uaWQ7CgkJCX0KCQl9CgkJbGV0IGRhdGEgPSBhd2FpdCB0aGlzLl9sb2FkRGF0YSh7CgkJCWlkOiAiY21iIiArIGUubmFtZSwKCQkJb3B0aW9uczogZQoJCX0sIG9iaik7CgkJdGhpcy5TZXRUcmVlRGF0YShlLCBuLCBkYXRhKTsKCX0KCglhc3luYyBfbG9hZERhdGEocywgbywgc3RhcnQsIGVuZCkgewoJCXZhciBuYW1lID0gKHMgJiYgcy5vcHRpb25zID8gKHMub3B0aW9ucy5DbGFzcyA/IHMub3B0aW9ucy5DbGFzcy5OYW1lLnJlcGxhY2UoJyAnLCAnXycpIDogKHMub3B0aW9ucy50YWJsZSB8fCBzLm9wdGlvbnMubmFtZSkpIDogcy5uYW1lKTsKCQluYW1lID0gbmFtZS50cmltKCk7IC8vLnNwbGl0KCcuJykuc2xpY2UoLTEpWzBdOwoKCQlsZXQgb1Njb3BlID0gKHR5cGVvZihjb21wYW55KSAhPT0gJ3VuZGVmaW5lZCcgJiYgY29tcGFueS5TY29wZSkgPyB3aW5kb3dbY29tcGFueS5TY29wZV0gOiB3aW5kb3c7CgkJbyA9IG8gfHwgKChvU2NvcGUgJiYgb1Njb3BlW25hbWVdKSA/IG5ldyBvU2NvcGVbbmFtZV0oKSA6IHsKCQkJQWN0aXZlOiB0cnVlLAoJCX0pOwoKCQlvID0gKHR5cGVvZiBmaWx0ZXJzICE9PSAidW5kZWZpbmVkIiAmJiBmaWx0ZXJzICYmIGZpbHRlcnNbbmFtZV0pID8gZmlsdGVyc1tuYW1lXShvKSA6IG87CgkJdmFyIGZ1biA9IHRoaXMuZUZ1bihzLm9wdGlvbnMpOwoJCWxldCBzVGV4dCA9ICQoIiMiICsgcy5pZClbZnVuXSgnZ2V0VGV4dCcpOwoKCQlvID0gKHMgJiYgcy5vcHRpb25zICYmIHMub3B0aW9ucy5zb3VyY2UpID8gcy5vcHRpb25zLnNvdXJjZShvLCB0aGlzLmdldCgpLCBzVGV4dCkgOiBvOwoJCWxldCBuYW1lcyA9ICQudW5pcXVlU29ydChbcy5vcHRpb25zLnNlYXJjaEZpZWxkXS5jb25jYXQoJC5tYXAoJC5ncmVwKHMub3B0aW9ucy5jb2x1bW5zIHx8IFtdLCBjID0+IGMuc2VhcmNoKSwgYyA9PiBjLmZpZWxkKSwgWyJOYW1lIl0pKS5maWx0ZXIodiA9PiB2KTsKCQlpZiAoIW9bbmFtZXNbMF1dKSBvW25hbWVzWzBdXSA9IHNUZXh0OwoJCWNvbnNvbGUubG9nKCJEeW5hRm9ybTo6X2xvYWREYXRhKCk6IG8iLCBvKTsKCQl2YXIgZGF0YSA9IG51bGw7CgoJCWxldCBsaWIgPSAnJzsKCQlpZiAobmFtZS5pbmRleE9mKCcuJykgPiAwKSB7CgkJCWxpYiA9IG5hbWUuc3BsaXQoJy4nKVswXSArICcuJzsKCQkJbmFtZSA9IG5hbWUuc3BsaXQoJy4nKVsxXTsKCQl9CgoJCWlmIChzLm9wdGlvbnMubG9hZGVyKSB7CgkJCWRhdGEgPSBhd2FpdCBzLm9wdGlvbnMubG9hZGVyKHRoaXMuZ2V0KCksIHMub3B0aW9ucywgbywgc1RleHQpOwoJCX0gZWxzZSBpZiAobyAmJiB0eXBlb2Yoby5maW5kQWxsKSA9PT0gJ2Z1bmN0aW9uJykgewoJCQlkYXRhID0gYXdhaXQgby5maW5kQWxsKCk7CgkJfSBlbHNlIGlmICh0eXBlb2YoY29tcGFueSkgIT09ICd1bmRlZmluZWQnICYmIGNvbXBhbnkubGlicmFyeSAmJiBjb21wYW55LkNvZGUgJiYgd2luZG93LmJMb2NhbCkgewoJCQkvL2NvbnNvbGUubG9nKCJERm9ybTo6X2xvYWREYXRhKCk6IHNyKCkuXygiICsgbGliICsgY29tcGFueS5Db2RlLnRvTG93ZXJDYXNlKCkgKyBuYW1lICsgIkZpbmRhbGwiICsgIikiLCBvKTsKCQkJZGF0YSA9IGF3YWl0IHRoaXMuc3IoKS5fKGxpYiArIGNvbXBhbnkuQ29kZS50b0xvd2VyQ2FzZSgpICsgbmFtZSArICJGaW5kYWxsIiwgbnVsbCwgbywgbnVsbCwgc3RhcnQsIGVuZCk7CgkJfSBlbHNlIGlmIChfRnJFTUQuYXBpU2VydmVyKSB7CgkJCW8gPSBPYmplY3QuYXNzaWduKC4uLk9iamVjdC5rZXlzKG8pLm1hcChrID0+ICh7CgkJCQlbU3RyaW5nKGspLmNoYXJBdCgwKS50b0xvd2VyQ2FzZSgpICsgU3RyaW5nKGspLnNsaWNlKDEpXTogb1trXQoJCQl9KSkpOwoJCQljb25zb2xlLmxvZygiREZvcm06Ol9sb2FkRGF0YSgpOiB1c2luZyBfRnJFTUQuYXBpU2VydmVyOiBvIiwgbyk7CgkJCWRhdGEgPSBhd2FpdCBfRnJFTUQuYXBpU2VydmVyLl9uZXcobmFtZSkuX2Zyb21Eb2N1bWVudChvKS5maW5kQWxsKCk7CgkJfQoKCQlpZiAocy5vcHRpb25zLnBvc3Rsb2FkKSB7CgkJCWF3YWl0IHMub3B0aW9ucy5wb3N0bG9hZChkYXRhKTsKCQl9CgkJJC5lYWNoKGRhdGEsIChpLCBkKSA9PiB7CgkJCWQuX19PV05FUiA9IHM7CgkJCSQuZWFjaChzLm9wdGlvbnMuY29sdW1ucywgKF8sIGMpID0+IHsKCQkJCWlmIChjLnZhbHVlKSB7CgkJCQkJZFtjLmZpZWxkXSA9IGMudmFsdWUoZCwgZGF0YSwgaSk7CgkJCQl9CgkJCX0pOwoJCX0pOwoJCWlmICghcy5vcHRpb25zLmNvbHVtbnMgJiYgZnVuLmluZGV4T2YoJ3RyZWUnKSA+IC0xKSB7CgkJCWRhdGEgPSAkLm1hcChkYXRhLCBkID0+IHsKCQkJCWxldCByZXQgPSB7CgkJCQkJaWQ6IGRbcy5vcHRpb25zLmlkRmllbGQuZmllbGRdLAoJCQkJCXRleHQ6IGRbcy5vcHRpb25zLnRleHRGaWVsZC5maWVsZF0sCgkJCQkJc3RhdGU6IGQuc3RhdGUgfHwgKHMub3B0aW9ucy5sb2FkZXIgPyAiZmlsZSIgOiAiY2xvc2VkIiksCgkJCQkJX3NvdXJjZTogZCwKCQkJCX07CgkJCQlyZXQuY2hpbGRyZW4gPSAocmV0LnN0YXRlID09ICJjbG9zZWQiKSA/IFt7CgkJCQkJdGV4dDogJ2xvYWRpbmcuLi4nCgkJCQl9XSA6IG51bGw7CgkJCQlyZXR1cm4gcmV0OwoJCQl9KTsKCQl9CgkJcmV0dXJuIGRhdGEgfHwgW107Cgl9CgoJYXN5bmMgZmlsbERhdGEoZywgbywgc3RhcnQsIGVuZCkgewoJCXZhciBzID0gbnVsbDsKCQlmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuc2VsZWN0cy5sZW5ndGg7IGkrKykgewoJCQlpZiAodGhpcy5zZWxlY3RzW2ldLmlkID09IGdbMF0uaWQpIHMgPSB0aGlzLnNlbGVjdHNbaV07CgkJfQoJCWlmICghcykgcmV0dXJuOwoJCXRoaXMuYnVzeSh0cnVlKTsKCQl0cnkgewoJCQl2YXIgZnVuID0gZ1swXS5jbGFzc0xpc3RbIjAiXS5yZXBsYWNlKCdlYXN5dWktJywgJycpOwoJCQl0cnkgewoJCQkJJCgiIyIgKyBzLmlkKVtmdW5dKCdncmlkJykuZGF0YWdyaWQoJ2dldFBhZ2VyJykucGFnaW5hdGlvbignbG9hZGluZycpOwoJCQl9IGNhdGNoIChleCkge30KCQkJaWYgKHMub3B0aW9ucy5ub2xvYWQpIHsKCQkJCWxldCBfZGF0YSA9IG51bGw7CgkJCQl0cnkgewoJCQkJCV9kYXRhID0gJCgiIyIgKyBzLmlkKVtmdW5dKCdncmlkJykuZGF0YWdyaWQoImdldERhdGEiKTsKCQkJCX0gY2F0Y2ggKGV4KSB7CgkJCQkJX2RhdGEgPSAkKCIjIiArIHMuaWQpW2Z1bl0oJ3RyZWUnKS50cmVlKCdnZXRSb290Jyk7CgkJCQl9CgkJCQlpZiAoX2RhdGEpIHsKCQkJCQlyZXR1cm4gdGhpcy5idXN5KGZhbHNlKTsKCQkJCX0KCQkJfQoJCQl2YXIgZGF0YSA9IGF3YWl0IHRoaXMuX2xvYWREYXRhKHMsIG8sIHN0YXJ0LCBlbmQpOwoJCQl0cnkgewoJCQkJaWYgKCQoIiMiICsgcy5pZClbZnVuXSgnZ3JpZCcpKSAkKCIjIiArIHMuaWQpW2Z1bl0oJ2dyaWQnKS5kYXRhZ3JpZCgnZ2V0UGFnZXInKS5wYWdpbmF0aW9uKCdsb2FkZWQnKTsKCQkJfSBjYXRjaCAoZXgpIHt9CgkJCXRyeSB7CgkJCQkkKCIjIiArIHMuaWQpW2Z1bl0oJ2dyaWQnKS5kYXRhZ3JpZCgnbG9hZERhdGEnLCB7CgkJCQkJdG90YWw6IGRhdGEuQ291bnQgfHwgZGF0YS5sZW5ndGgsCgkJCQkJcm93czogZGF0YSwKCQkJCX0pOwoJCQl9IGNhdGNoIChleCkgewoJCQkJJCgiIyIgKyBzLmlkKVtmdW5dKCd0cmVlJykudHJlZSgnbG9hZERhdGEnLCBkYXRhKTsKCQkJfQoJCX0gY2F0Y2ggKGV4KSB7CgkJCWNvbnNvbGUubG9nKGV4KTsKCQl9CgkJdGhpcy5idXN5KGZhbHNlKTsKCX0KCglldmVudEhhbmRsZXJzKG9wdGlvbnMpIHsKCQlpZiAoIXRoaXMuYnlOYW1lKG9wdGlvbnMubmFtZSkpIHJldHVybjsgLy8gaWYgbm90IGFuIGVsZW1lbnQsIGRvIG5vdCBydW4gdGhlIGhhbmRsZXJzCgoJCXJldHVybiB0aGlzLmV2ZW50cy5maWx0ZXIoZSA9PiBlLnR5cGUgPT0gb3B0aW9ucy50eXBlIHx8IHR5cGVvZihlLnR5cGUpID09PSAndW5kZWZpbmVkJykubWFwKGUgPT4gYCR7ZS5uYW1lfTogKCR7ZS5wYXJhbXMgfHwgJyd9KSA9PiB7dHJ5e0RGb3JtLiR7ZS5oYW5kbGVyfShERm9ybS5ieU5hbWUoIiR7b3B0aW9ucy5uYW1lfSIpIHx8ICR7X0ZyRU1ELl90b0pTKG9wdGlvbnMpfSB8fCB7bmFtZTogIiR7b3B0aW9ucy5uYW1lfSIsdHlwZTogIiR7b3B0aW9ucy50eXBlfSJ9LCAke2UucGFyYW1zfSl9Y2F0Y2goZXgpe2NvbnNvbGUubG9nKCJFdmVudCBFcnJvcjogJHtvcHRpb25zLm5hbWV9LyR7b3B0aW9ucy50eXBlfS8ke2UubmFtZX0iLCBleCk7fX1gKS5qb2luKCcsJyk7Cgl9CgoJYXN5bmMgUGFuZWxPcGVuKGUpIHsKCQlpZiAoZS5lZGl0b3IpIHJldHVybiB0cnVlOwoJCWxldCBjb250ZW50ID0gZS52YWx1ZTsKCQlpZiAoZS5sb2FkZXIpIHsKCQkJY29udGVudCA9IGF3YWl0IGUubG9hZGVyKHRoaXMuZ2V0KCkpOwoJCX0KCQlpZiAoY29udGVudCkgewoJCQl0cnkgewoJCQkJJCgiI3BubCIgKyBlLm5hbWUpLnBhbmVsKCdib2R5JykuaHRtbChjb250ZW50KTsKCQkJCWNvbnNvbGUubG9nKCJwbmwiICsgZS5uYW1lICsgIjogQ29udGVudCBWYWxpZCIpOwoJCQl9IGNhdGNoIChleCkgewoJCQkJLy9jb25zb2xlLmxvZyhleCk7CgkJCX0KCQl9CgkJcmV0dXJuIGNvbnRlbnQ7Cgl9CgoJYXN5bmMgU2VsZWN0Q2hhbmdlKG9wdGlvbnMsIHRhYikgewoJCXRoaXMuYnVzeSh0cnVlKTsKCQkkLmdyZXAodGhpcy5lbGVtZW50cywgZSA9PiBlLnR5cGUgPT0gImdyaWQiICYmIGUuZ3JvdXAgPT0gdGFiKS5mb3JFYWNoKGUgPT4gJCgiI2NtYiIgKyBlLm5hbWUpLmRhdGFncmlkKCkpOwoJCXRoaXMuYnVzeShmYWxzZSk7Cgl9CgoJYXN5bmMgRmllbGRDaGFuZ2Uob3B0aW9ucywgdmFsdWUpIHsKCQl0aGlzLmJ1c3kodHJ1ZSk7CgkJaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5jaGFuZ2UpIHsKCQkJYXdhaXQgb3B0aW9ucy5jaGFuZ2UodGhpcy5nZXQoKSwgdmFsdWUpOwoJCX0KCQl0aGlzLmJ1c3koZmFsc2UpOwoJfQoKCWFzeW5jIFVSTENoYW5nZShzLCBvcHRpb25zKSB7CgkJb3B0aW9ucy5kYXRhID0gYXdhaXQgJC5nZXQocy52YWx1ZSk7CgkJcmV0dXJuIGF3YWl0IHRoaXMuRmllbGRDaGFuZ2Uocywgb3B0aW9ucyk7Cgl9CgoJVXBsb2FkRmlsZShmLCBvcHRpb25zKSB7CgkJdGhpcy5idXN5KHRydWUpOwoJCXZhciBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSgpOwoJCXZhciBmaWxlaWQgPSBNYXRoLnJhbmRvbSgpOwoJCXZhciBtZXRob2QgPSBvcHRpb25zLm1ldGhvZCB8fCAiQ29udGVudE1hbmFnZXIuY21zVXBsb2FkRmlsZSI7CgkJZm9ybURhdGEuYXBwZW5kKCdmaWxlaWQnLCBmaWxlaWQpOwoJCXZhciBmaWxlID0gJCgiIyIgKyBmLmZpbGVib3hJZClbMF0uZmlsZXNbMF07CgkJZm9ybURhdGEuYXBwZW5kKCdfX1VGSUxFJywgZmlsZSk7CgkJaWYgKG9wdGlvbnMubG9jYWwpIHsKCQkJLy8gaGFuZGxpbmcgdGhlIGZpbGUgbG9jYWxseQoJCQl2YXIgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTsKCQkJcmVhZGVyLm9ubG9hZCA9IChlKSA9PiB7CgkJCQl2YXIgZGF0YSA9IGUudGFyZ2V0LnJlc3VsdDsKCQkJCXJldCA9IGRhdGE7CgkJCQl0aGlzLmJ5TmFtZShvcHRpb25zLm5hbWUpLmRhdGEgPSByZXQ7CgkJCQlpZiAob3B0aW9ucyAmJiBvcHRpb25zLnVwbG9hZCkgb3B0aW9ucy51cGxvYWQodGhpcy5nZXQoKSwgcmV0KTsKCQkJfTsKCQkJaWYgKG9wdGlvbnMuYmluYXJ5KSB7CgkJCQlyZWFkZXIucmVhZEFzQmluYXJ5U3RyaW5nKGZpbGUpOwoJCQl9IGVsc2UgaWYgKG9wdGlvbnMuZGF0YXVybCkgewoJCQkJcmVhZGVyLnJlYWRBc0RhdGFVUkwoZmlsZSk7CgkJCX0gZWxzZSB7CgkJCQlyZWFkZXIucmVhZEFzVGV4dChmaWxlKTsKCQkJfQoJCQl0aGlzLmJ1c3koZmFsc2UpOwoJCX0gZWxzZSBpZiAobWV0aG9kKSB7CgkJCSQuYWpheCh7CgkJCQl1cmw6IHRoaXMuc3IoKS5zclVSTCArICImbWV0aG9kPSIgKyBtZXRob2QgKyAiJnNJbnB1dD0iICsgZmlsZWlkICsgIiZwcmVUYWc9JnBvc3RUYWc9IiwKCQkJCWRhdGE6IGZvcm1EYXRhLAoJCQkJLy8gVEhJUyBNVVNUIEJFIERPTkUgRk9SIEZJTEUgVVBMT0FESU5HCgkJCQljYWNoZTogZmFsc2UsCgkJCQljb250ZW50VHlwZTogZmFsc2UsCgkJCQl0eXBlOiAnUE9TVCcsCgkJCQlwcm9jZXNzRGF0YTogZmFsc2UsCgkJCQlzdWNjZXNzOiBkYXRhID0+IHsKCQkJCQl0aGlzLnNyKCkucnVuU2NyaXB0KGRhdGEpOwoJCQkJCXRoaXMuYnlOYW1lKG9wdGlvbnMubmFtZSkuZGF0YSA9IHJldDsKCQkJCQlpZiAob3B0aW9ucyAmJiBvcHRpb25zLnVwbG9hZCkgb3B0aW9ucy51cGxvYWQodGhpcy5nZXQoKSwgcmV0KTsKCQkJCQl0aGlzLmJ1c3koZmFsc2UpOwoJCQkJfQoJCQl9KTsKCQl9Cgl9CgoJZUZ1bihlKSB7CgkJdHJ5IHsKCQkJaWYgKGUudHlwZSA9PSAidHJlZSIpIHsKCQkJCWlmIChlLmNvbHVtbnMpIHsKCQkJCQlyZXR1cm4gImNvbWJvdHJlZWdyaWQiOwoJCQkJfSBlbHNlIGlmICh0eXBlb2YoZS5jb21ibykgIT09ICd1bmRlZmluZWQnICYmICFlLmNvbWJvKSB7CgkJCQkJcmV0dXJuICd0cmVlJzsKCQkJCX0gZWxzZSB7CgkJCQkJcmV0dXJuICJjb21ib3RyZWUiOwoJCQkJfQoJCQl9IGVsc2UgaWYgKGUudHlwZSA9PSAnbmF2aWdhdGlvbicpIHsKCQkJCXJldHVybiAndHJlZSc7CgkJCX0gZWxzZSBpZiAoZS50eXBlID09ICJjb21ib3RyZWUiKSB7CgkJCQlyZXR1cm4gImNvbWJvdHJlZWdyaWQiOwoJCQl9IGVsc2UgaWYgKGUudHlwZSA9PSAic2VsZWN0IiAmJiBlLm9wdGlvbnMpIHsKCQkJCXJldHVybiAiY29tYm9ib3giOwoJCQl9CgkJCXJldHVybiAiY29tYm9ncmlkIjsKCQl9IGNhdGNoIChleCkgewoJCQlyZXR1cm4gImNvbWJvZ3JpZCI7CgkJfQoJfQoKCV9maWxsV2luZG93KHdpbk5hbWUsIHYsIG1hcCkgewoJCXYgPSB2IHx8IHt9OwoJCW1hcCA9IG1hcCB8fCB7fTsKCQlpZiAoQXJyYXkuaXNBcnJheShtYXApKSB7CgkJCW1hcCA9IE9iamVjdC5mcm9tRW50cmllcyhuZXcgTWFwKG1hcCkpOwoJCX0KCgkJbWFwID0gJC5leHRlbmQoe30sIG1hcCwgT2JqZWN0LmZyb21FbnRyaWVzKE9iamVjdC5rZXlzKHYpLm1hcChrID0+IFt3aW5OYW1lICsgaywga10pKSk7CgoJCWxldCBzID0ge307CgkJZm9yICh2YXIgbSBpbiBtYXApIHsKCQkJaWYgKHR5cGVvZih2W21hcFttXV0pID09PSAidW5kZWZpbmVkIikgewoJCQkJLy9jb25zb2xlLmxvZygnaXNfdW5kZWZpbmVkJywgbSwgbWFwW21dLCB2W21hcFttXV0pOwoJCQkJc1ttXSA9IG1hcFttXTsKCQkJfSBlbHNlIHsKCQkJCS8vY29uc29sZS5sb2coJ2lzX25vdF91bmRlZmluZWQnLCBtLCBtYXBbbV0sIHZbbWFwW21dXSk7CgkJCQlzW21dID0gdlttYXBbbV1dOwoJCQl9CgkJfQoJCXRoaXMuY2xlYXIod2luTmFtZSk7CgkJLy9jb25zb2xlLmxvZygicyIsIHMpOwoJCXRoaXMuc2V0KHMpOwoJCSQoIiNwbmxfIiArIHdpbk5hbWUpLndpbmRvdygib3BlbiIpOwoJfQoKCXdpbmRvd1RvRW50aXR5KG8sIGJFbXB0eSwgZ3JpZCwgcHJlZml4LCBmaWx0ZXIpIHsKCQlvID0gbyB8fCB0aGlzLmdldCgpOwoJCWZpbHRlciA9IGZpbHRlciB8fCAodiA9PiB2KTsKCQlsZXQgcmV0ID0gZ3JpZCA/IChncmlkLnNlbGVjdGVkIHx8IGdyaWQpIDogbnVsbDsKCQlpZiAoYkVtcHR5KSB7CgkJCXJldCA9IHt9OwoJCQlvID0ge307CgkJfSBlbHNlIHsKCQkJcmV0ID0gKHJldCAmJiByZXQuSWQpID8gewoJCQkJSWQ6IHJldC5JZAoJCQl9IDoge307CgkJfQoKCQl0aGlzLmVsZW1lbnRzLmZpbHRlcihlID0+IChwcmVmaXggPyBlLmdyb3VwID09IHByZWZpeCA6IHRydWUpICYmIGUudHlwZSAhPSAnbGluaycgJiYgWydfJ10uaW5kZXhPZihlLm5hbWUucmVwbGFjZShwcmVmaXgsICIiKSkgPCAwKS5mb3JFYWNoKGUgPT4gewoJCQlyZXRbZS5uYW1lLnJlcGxhY2UocHJlZml4LCAiIildID0gb1tlLm5hbWVdOwoJCQlyZXR1cm4gdHJ1ZTsKCQl9KTsKCgkJZmlsdGVyKHJldCk7CgoJCXJldHVybiByZXQ7Cgl9CgoJYmluZChvYmopIHsKCQl2YXIgb2JqQmluZCA9IChvLCBlKSA9PiB7CgkJCW9bdGhpcy5lRnVuKGUpXSh7CgkJCQlvblNob3dQYW5lbDogKCkgPT4gewoJCQkJCXRoaXMuZmlsbERhdGEoJCgiIyIgKyBlLmlkKSwgbnVsbCwgMCwgMTApOwoJCQkJfSwKCQkJCW9uQ2xpY2tSb3c6IChpbmRleCwgcm93KSA9PiB7CgkJCQkJdmFyIHMgPSByb3cgPyByb3cuX19PV05FUiA6IG51bGw7CgkJCQkJaWYgKHMgJiYgcy5vcHRpb25zLnNlbGVjdCkgewoJCQkJCQlzLm9wdGlvbnMuc2VsZWN0KHJvdywgdGhpcy5nZXQoKSk7CgkJCQkJfQoJCQkJfQoJCQl9KTsKCQkJdHJ5IHsKCQkJCXZhciBkZyA9IG9bdGhpcy5lRnVuKGUpXSgnZ3JpZCcpOwoJCQkJLy8gZGcuZGF0YWdyaWQoJ2VuYWJsZUZpbHRlcicpCgkJCQl2YXIgc3RhdGUgPSBkZy5kYXRhKCdkYXRhZ3JpZCcpOwoJCQkJdmFyIG9wdHMgPSBzdGF0ZS5vcHRpb25zOwoJCQkJdmFyIG9uQmVmb3JlTG9hZCA9IG9wdHMub25CZWZvcmVMb2FkOwoJCQkJb3B0cy5vbkJlZm9yZUxvYWQgPSAocGFyYW0pID0+IHsKCQkJCQlzdGF0ZS5hbGxSb3dzID0gbnVsbDsKCQkJCQlyZXR1cm4gb25CZWZvcmVMb2FkLmNhbGwodGhpcywgcGFyYW0pOwoJCQkJfTsKCQkJCXZhciBwYWdlciA9IGRnLmRhdGFncmlkKCdnZXRQYWdlcicpOwoJCQkJZGcuZGF0YWdyaWQoJ2dldFBhbmVsJykucGFuZWwoewoJCQkJCUlEOiBpCgkJCQl9KTsKCQkJCXBhZ2VyLnBhZ2luYXRpb24oewoJCQkJCW9uU2VsZWN0UGFnZTogZnVuY3Rpb24ocGFnZU51bSwgcGFnZVNpemUpIHsKCQkJCQkJdHJ5IHsKCQkJCQkJCURGb3JtLmZpbGxEYXRhKCQoIiMiICsgREZvcm0uc2VsZWN0c1skKHRoaXMucGFyZW50Tm9kZSkucGFuZWwoJ29wdGlvbnMnKS5JRF0uaWQpLCBudWxsLCBwYWdlU2l6ZSAqIChwYWdlTnVtIC0gMSksIHBhZ2VTaXplICogcGFnZU51bSk7CgkJCQkJCX0gY2F0Y2ggKF9leCkgewoJCQkJCQkJY29uc29sZS5sb2coIkR5bmFGb3JtOjpvblNlbGVjdFBhZ2UoKSAiLCBfZXgpCgkJCQkJCX0KCQkJCQl9CgkJCQl9KTsKCQkJCWRnLmRhdGFncmlkKCdsb2FkRGF0YScsIHN0YXRlLmRhdGEpOwoJCQl9IGNhdGNoIChleCkge30KCQl9OwoJCWlmIChvYmopIHsKCQkJb2JqQmluZChvYmopOwoJCX0gZWxzZSB7CgkJCWZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5zZWxlY3RzLmxlbmd0aDsgaSsrKSB7CgkJCQlpZiAodGhpcy5zZWxlY3RzW2ldLm9wdGlvbnMub3B0aW9ucykgewoJCQkJCS8vJCgiIyIgKyB0aGlzLnNlbGVjdHNbaV0uaWQpLmNvbWJvKCk7CgkJCQl9IGVsc2UgewoJCQkJCW9iakJpbmQoJCgiIyIgKyB0aGlzLnNlbGVjdHNbaV0uaWQpLCB0aGlzLnNlbGVjdHNbaV0pOwoJCQkJfQoJCQl9CgoJCQl0aGlzLmVsZW1lbnRzLmZpbHRlcihlID0+IGUud2luZG93ICYmIGUuZ3JvdXApLmZvckVhY2goZSA9PiB7CgkJCQlsZXQgdCA9ICQoIiN0YmNXaW5kb3ciKS50YWJzKCJnZXRUYWIiLCBlLmdyb3VwKTsKCQkJCWlmICh0KSB7CgkJCQkJdC5wYW5lbCgnb3B0aW9ucycpLnRhYi5oaWRlKCk7CgkJCQl9CgkJCX0pOwoJCX0KCX0KCgllbmdsaXNoKHMpIHsKCQlpZiAoIXMpIHJldHVybiAiIjsKCQl2YXIgcmVzdWx0ID0gcy5yZXBsYWNlKC8oW0EtWl0pL2csICIgJDEiKTsKCQlyZXN1bHQgPSByZXN1bHQucmVwbGFjZSgvXy9nLCAnJyk7CgkJcmV0dXJuIHJlc3VsdC5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHJlc3VsdC5zbGljZSgxKTsKCX0KCglvblRvZ2dsZShlLCBiVmFsdWUpIHsKCQlsZXQgc1RhZyA9IGAjZkVsZW1lbnRfJHtlLmZvci5uYW1lfSA+IC5lYXN5dWktJHt0aGlzLnVpVHlwZXNbZS5mb3IudHlwZV19YDsKCQlsZXQgb1RhZyA9ICQoc1RhZyk7CgkJZS5mb3IuZW5hYmxlZCA9IHR5cGVvZihiVmFsdWUpID09PSAidW5kZWZpbmVkIiA/ICFlLmZvci5lbmFibGVkIDogYlZhbHVlOwoKCQlvVGFnLnByb3AoImRpc2FibGVkIiwgIWUuZm9yLmVuYWJsZWQpOwoJCS8vb1RhZ1t0aGlzLnVpVHlwZXNbZS5mb3IudHlwZV1dKGUuZm9yLmVuYWJsZWQgPyAiZW5hYmxlIiA6ICJkaXNhYmxlIik7CgkJY29uc29sZS5sb2coc1RhZywgb1RhZywgdGhpcy51aVR5cGVzW2UuZm9yLnR5cGVdLCBlLmZvci5lbmFibGVkKTsKCX0KCglyZW5kZXIobmFtZSwgdGl0bGUsIGVsZW1lbnRzLCBidXR0b25zLCBiRml4ZWQpIHsKCQl0aGlzLmVsZW1lbnRzID0gKGVsZW1lbnRzIHx8IFtdKS5maWx0ZXIoZSA9PiAhZS5pZ25vcmUpOwoKCQl0aGlzLmJ1dHRvbnMgPSBidXR0b25zIHx8IFtdOwoJCXRoaXMuc2VsZWN0cyA9IFtdOwoJCXRoaXMuZ3JpZHMgPSBbXTsKCgkJdGhpcy5lbGVtZW50cy5maWx0ZXIoZSA9PiBlLnR5cGUgPT0gIndpbmRvdyIpLmZvckVhY2godyA9PiB0aGlzLmVsZW1lbnRzLnNwbGljZSh0aGlzLmVsZW1lbnRzLmZpbmRJbmRleChlID0+IGUubmFtZSA9PSB3Lm5hbWUpLCAwLCB7CgkJCW5hbWU6ICJfIiArIHcubmFtZSwKCQkJdHlwZTogImxpbmsiLAoJCQl0aXRsZTogdy50aXRsZSB8fCB3Lm5hbWUsCgkJCWdyb3VwOiB3Lmdyb3VwLAoJCQl3aW5kb3c6IHcud2luZG93LAoJCQlzZWN0aW9uOiB3LnNlY3Rpb24sCgkJCWxpbmtzOiBbewoJCQkJbGFiZWw6ICdPcGVuJywKCQkJCWljb246ICdlZGl0JywKCQkJCW9uQ2xpY2s6IG8gPT4gJCgiI3BubCIgKyB3Lm5hbWUpLndpbmRvdygnb3BlbicpCgkJCX1dLAoJCX0pKTsKCgkJdGhpcy5zcigpLmdyb3VwQnkodGhpcy5lbGVtZW50cy5maWx0ZXIoZSA9PiBlLndpbmRvdyksICJncm91cCIpLmZvckVhY2goa3YgPT4gewoJCQlpZiAoIWt2LmtleSkgcmV0dXJuOwoKCQkJbGV0IGUgPSB7CgkJCQluYW1lOiAiXyIgKyBrdi5rZXksCgkJCQl0aXRsZToga3Yua2V5LAoJCQkJdHlwZTogIndpbmRvdyIsCgkJCQlncm91cDoga3Yua2V5LAoJCQkJd2lkdGg6IHRoaXMud2lkdGggKiAwLjksCgkJCQloZWlnaHQ6IHRoaXMuaGVpZ2h0ICogMC45LAoJCQkJbG9hZGVyOiBvID0+IHsKCQkJCQlrdi52YWx1ZXMuZmlsdGVyKHYgPT4gdi50eXBlICE9PSAnbGluaycgfHwgKHYudHlwZSA9PSAnbGluaycgJiYgdi5uYW1lLnN0YXJ0c1dpdGgoJ18nKSkpLmZvckVhY2godiA9PiAkKCIjcG5sXyIgKyB2Lmdyb3VwICsgJy1jZW50ZXInKS5hcHBlbmQoJCgiI2ZFbGVtZW50XyIgKyB2Lm5hbWUpKSk7CgkJCQkJcmV0dXJuIG51bGw7CgkJCQl9LAoJCQkJYnV0dG9uczogW10uY29uY2F0LmFwcGx5KFtdLCBrdi52YWx1ZXMuZmlsdGVyKHYgPT4gdi50eXBlID09ICdsaW5rJyAmJiAhdi5uYW1lLnN0YXJ0c1dpdGgoJ18nKSkubWFwKHYgPT4gWy4uLnYubGlua3MubWFwKGwgPT4gKHsKCQkJCQluYW1lOiBsLm5hbWUgfHwgbC5sYWJlbCwKCQkJCQl0aXRsZTogbC50aXRsZSB8fCBsLmxhYmVsLAoJCQkJCW9uQ2xpY2s6IGwub25DbGljaywKCQkJCQlpY29uOiBsLmljb24sCgkJCQkJd2luZG93OiB0cnVlLAoJCQkJCWdyb3VwOiBrdi5rZXksCgkJCQl9KSldKSksCgkJCX07CgkJCXRoaXMuYnV0dG9ucy5wdXNoKC4uLmUuYnV0dG9ucyk7CgoJCQl0aGlzLmVsZW1lbnRzLnB1c2goZSk7CgkJfSk7CgoJCXZhciByZXQgPSAiIjsKCQkvLyBjaGVjayB0aGUgb3B0aW9uIG9mIHVzaW5nIHdpbmRvdygpIGFzIGEgcmVuZGVyZXIgb2YgdGhlIG1haW4gd2luZG93Li4uCgkJaWYgKHRydWUpIHsKCQkJdGhpcy5lbGVtZW50cy5maWx0ZXIoZSA9PiAhZS56b25lKS5mb3JFYWNoKGUgPT4gZS56b25lID0gJ2NlbnRlcicpOwoJCQlsZXQgd09wdGlvbnMgPSB7CgkJCQluYW1lOiBuYW1lIHx8IHRoaXMubmFtZSwKCQkJCXRpdGxlOiB0aXRsZSB8fCB0aGlzLnRpdGxlLAoJCQkJdHlwZTogJ3dpbmRvdycsCgkJCQl2aXNpYmxlOiB0cnVlLAoJCQkJd2lkdGg6IHRoaXMud2lkdGgsCgkJCQloZWlnaHQ6IHRoaXMuaGVpZ2h0LAoJCQkJZml4ZWQ6IGJGaXhlZCwKCQkJCWxpbmtzOiBbewoJCQkJCWljb246ICJoZWxwIiwKCQkJCQlhY3Rpb246IG8gPT4gJCgiI3BubF9fQ29uc29sZSIpLndpbmRvdygnb3BlbicpCgkJCQl9XSwKCQkJCWJ1dHRvbnM6IHRoaXMuYnV0dG9ucy5maWx0ZXIoYiA9PiAhYi53aW5kb3cpLAoJCQl9OwoJCQl0aGlzLnNyKCkuZ3JvdXBCeSh0aGlzLmVsZW1lbnRzLCAnem9uZScpLmZpbHRlcih6ZyA9PiB6Zy5rZXkpLmZvckVhY2goemcgPT4gewoJCQkJd09wdGlvbnNbemcua2V5XSA9IHRoaXMucmVuZGVyRWxlbWVudHMoemcudmFsdWVzKTsKCQkJfSk7CgoJCQlyZXQgPSB0aGlzLndpbmRvdyh3T3B0aW9ucyk7CgkJfSBlbHNlIHsKCQkJcmV0ID0gdGhpcy5oZWFkZXIobmFtZSwgdGl0bGUsIGJGaXhlZCwgW3sKCQkJCWljb246ICJoZWxwIiwKCQkJCWFjdGlvbjogbyA9PiAkKCIjcG5sX19Db25zb2xlIikud2luZG93KCdvcGVuJykKCQkJfV0pOwoKCQkJcmV0ICs9IHRoaXMucmVuZGVyRWxlbWVudHMoKTsKCgkJCXJldCArPSB0aGlzLmZvb3RlcihiRml4ZWQpOwoKCQl9CgkJLy8gY29uc29sZS5sb2cocmV0KTsKCgkJcmV0dXJuIHJldDsKCX0KCgljV2lkdGgob3B0aW9ucykgewoJCWxldCByZXQgPSBNYXRoLmZsb29yKCgob3B0aW9ucyA/IG9wdGlvbnMud2lkdGggOiBudWxsKSB8fCAodGhpcy53aWR0aCAvIDMpKSk7CgkJaWYgKG9wdGlvbnMuem9uZSA9PSAnZWFzdCcgfHwgb3B0aW9ucy56b25lID09ICd3ZXN0JykgewoJCQlyZXQgPSAwLjI1ICogcmV0OyAvLyA5MCUgb2YgMy8xMCwgdGhlIHdpZHRoIG9mIHRoZSBub3JtYWwgZWxlbWVudAoJCX0gZWxzZSBpZiAob3B0aW9ucyAmJiBvcHRpb25zLmVkaXRvcikgewoJCQlyZXQgPSB3aW5kb3cuaW5uZXJXaWR0aDsKCQl9IGVsc2UgaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy53aWR0aCAmJiB0eXBlb2Yob3B0aW9ucy53aWR0aCkgPT09ICdzdHJpbmcnKSB7CgkJCXJldCA9IHRoaXMud2lkdGg7CgkJfSBlbHNlIGlmIChvcHRpb25zICYmIG9wdGlvbnMudHlwZSA9PSAnd2luZG93JyAmJiAhb3B0aW9ucy53aWR0aCkgewoJCQlyZXQgPSB0aGlzLndpZHRoICogMC45OwoJCX0KCgkJLy8gY29uc29sZS5sb2cob3B0aW9ucy5uYW1lICsgIjogY1dpZHRoID0gIiArIHJldCwgb3B0aW9ucy56b25lKTsKCQlyZXR1cm4gcmV0OwoJfQoKCXdpbmRvdyhvcHRpb25zKSB7CgkJb3B0aW9ucy50aXRsZSA9IG9wdGlvbnMudGl0bGUgfHwgb3B0aW9ucy5uYW1lOwoJCXZhciByZXQgPSBgCgkJPGRpdiBpZCA9ICJwbmwke29wdGlvbnMubmFtZX0iIGNsYXNzPSJlYXN5dWktd2luZG93IiB0aXRsZT0iJHtvcHRpb25zLnRpdGxlIHx8IHRoaXMuZW5nbGlzaChvcHRpb25zLm5hbWUpfSIgZGF0YS1vcHRpb25zPScke3RoaXMuZXZlbnRIYW5kbGVycyhvcHRpb25zKX0sIGNsb3NlZDokeyFvcHRpb25zLnZpc2libGV9LG1pbmltaXphYmxlOiR7IW9wdGlvbnMuZml4ZWR9LG1heGltaXphYmxlOiR7IW9wdGlvbnMuZml4ZWR9LGNsb3NhYmxlOiR7IW9wdGlvbnMuZml4ZWR9LGNvbGxhcHNpYmxlOiR7IW9wdGlvbnMuZml4ZWR9LGRyYWdnYWJsZTokeyFvcHRpb25zLmZpeGVkfSxyZXNpemFibGU6JHshb3B0aW9ucy5maXhlZH0saWNvbkNsczoiaWNvbi0ke29wdGlvbnMuaWNvbn0iLCB0b29sczoiIyR7b3B0aW9ucy5uYW1lfV90b29scyInIHN0eWxlPSJ3aWR0aDoke3RoaXMuY1dpZHRoKG9wdGlvbnMpfXB4O2hlaWdodDoke3RoaXMuY0hlaWdodChvcHRpb25zKX1weDtwYWRkaW5nOjEwcHg7Ij4KCQkgICAgPGRpdiBjbGFzcz0iZWFzeXVpLWxheW91dCIgZGF0YS1vcHRpb25zPSJmaXQ6dHJ1ZSI+CgkJYDsKCgkJbGV0IGJab25lID0gb3B0aW9ucy5zb3V0aCA/ICdzb3V0aCcgOiAodGhpcy56b25lcy5maW5kKHogPT4geiA9PSAnc291dGgnKSB8fCB0aGlzLnpvbmVzWzBdKTsKCQlvcHRpb25zW2Jab25lXSA9IG9wdGlvbnNbYlpvbmVdIHx8IFtdOwoJCWxldCB6V2lkdGggPSBNYXRoLm1pbigxMjAsIHRoaXMud2lkdGggKiAwLjk1IC8gKG9wdGlvbnMuYnV0dG9ucyA/IG9wdGlvbnMuYnV0dG9ucy5sZW5ndGggOiAxKSwgdGhpcy5jV2lkdGgob3B0aW9ucykpOwoJCW9wdGlvbnNbYlpvbmVdLnB1c2goYDxkaXYgaWQ9InBubCR7b3B0aW9ucy5uYW1lfS1idXR0b25zIiBkYXRhLW9wdGlvbnM9InJlZ2lvbjonJHtiWm9uZX0nLGJvcmRlcjpmYWxzZSIgc3R5bGU9InRleHQtYWxpZ246cmlnaHQ7cGFkZGluZzo1cHggMCAwOyI+YCArICQubWFwKCQuZ3JlcChvcHRpb25zLmJ1dHRvbnMgfHwgW10sIGIgPT4gIWIuaWdub3JlKSwgYiA9PiBgPGEgaWQ9JyR7Yi5uYW1lfScgaHJlZj0iamF2YXNjcmlwdDp2b2lkKDApIiBjbGFzcz0iZWFzeXVpLWxpbmtidXR0b24gYzYiIGljb25DbHM9Imljb24tJHtiLmljb24gfHwgJ3NhdmUnfSIgc3R5bGU9IndpZHRoOiR7eldpZHRofXB4IiBvbmNsaWNrPSdERm9ybS5kb0NsaWNrKCR7X0ZyRU1ELl90b0pTKGIpfSknPiR7Yi50aXRsZSB8fCBiLm5hbWV9PC9hPiZuYnNwOyZuYnNwO2ApLmpvaW4oJycpICsgYDwvZGl2PmApOwoKCQl0aGlzLnpvbmVzLmZpbHRlcih6ID0+IG9wdGlvbnNbel0pLmZvckVhY2goeiA9PiB7CgkJCXJldCArPSBgCgkJICAgICAgICA8ZGl2IGRhdGEtb3B0aW9ucz0icmVnaW9uOicke3p9JyIgdGl0bGU9IiR7KHo9PSd3ZXN0JyB8fCB6PT0nZWFzdCcpPycmbmJzcDsnOicnfSIgc3R5bGU9J2hlaWdodDokeyh6PT0nbm9ydGgnfHx6PT0nc291dGgnKT8xMDoxMDB9JTt3aWR0aDokeygoej09J2Vhc3QnfHx6PT0nd2VzdCcpPzAuMToxKSp0aGlzLmNXaWR0aChvcHRpb25zKX1weCc+CiAgICAgICAgCQkgICAgJHsoQXJyYXkuaXNBcnJheShvcHRpb25zW3pdKT9vcHRpb25zW3pdOltvcHRpb25zW3pdXSkuam9pbignJyl9CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgYDsKCQl9KTsKCgkJcmV0ICs9IGA8L2Rpdj48L2Rpdj5gOwoKCQkvLyBsaW5rcyAodG9vbHMpCgkJbGV0IGxpbmtzID0gJC5ncmVwKFtdLmNvbmNhdChvcHRpb25zLmxpbmtzIHx8IFtdKSwgbCA9PiAhbC5pZ25vcmUpOwoJCXJldCArPSBgPGRpdiBpZD0iJHtvcHRpb25zLm5hbWV9X3Rvb2xzIj5gICsgJC5tYXAobGlua3MucmV2ZXJzZSgpLCBsID0+IGA8YSBocmVmPSJqYXZhc2NyaXB0OnZvaWQoMCkiIHN0eWxlPSJjb2xvcjpibGFjayIgY2xhc3M9ImZhcyBmYS0ke2wuaWNvbiB8fCAnYWRkJ30iIG9uY2xpY2s9Jyhhc3luYyAoKSA9PiB7dmFyIGEgPSAke19GckVNRC5fdG9KUyhsKX07ICQoIiNwbmwke29wdGlvbnMubmFtZX0iKS53aW5kb3coInNldFRpdGxlIiwgIiR7b3B0aW9ucy50aXRsZX06ICIgKyBhLm5hbWUpOyBhd2FpdCBhLmFjdGlvbihERm9ybS5nZXQoKSwgYSwgJHtfRnJFTUQuX3RvSlMob3B0aW9ucyl9KTsgJCgiI3BubCR7b3B0aW9ucy5uYW1lfSIpLndpbmRvdygic2V0VGl0bGUiLCAiJHtvcHRpb25zLnRpdGxlfSIpO30pKCknPjwvYT5gKS5qb2luKCdcbicpICsgYDwvZGl2PmA7CgoJCXJldHVybiByZXQ7Cgl9CgoJYXN5bmMgX2VuZCgpIHsKCQlsZXQgbyA9IHRoaXMuZ2V0KCk7CgoJCS8vIGRvIG5vdCB1c2UgdGhlIGZpcnN0IGJ1dHRvbiwgYmVjYXVzZSBtYW55IGZvcm1zIGhhdmUgYSBDYW5jZWwgYnV0dG9uIG9ubHkKCQlsZXQgYnV0dG9uID0gdGhpcy5idXR0b25zLmZpbmQoYiA9PiBiLmF1dG9TdWJtaXQpIC8qIHx8IHRoaXMuYnV0dG9uc1swXSovIDsKCQlpZiAoYnV0dG9uICYmIG8gJiYgT2JqZWN0LnZhbHVlcyhvKS5sZW5ndGggJiYgKHR5cGVvZihidXR0b24uYXV0b1N1Ym1pdCkgPT09ICJ1bmRlZmluZWQiIHx8IGJ1dHRvbi5hdXRvU3VibWl0KSkgewoJCQlsZXQgdiA9IE9iamVjdC52YWx1ZXMobykucmVkdWNlKCh0LCB2KSA9PiB7CgkJCQlyZXR1cm4gKCh0eXBlb2YodikgIT09ICJvYmplY3QiKSA/IDEgOiAwKSAqICh2ID8gMSA6IDApOwoJCQl9KTsKCQkJLy9jb25zb2xlLmxvZyhvLCBPYmplY3QudmFsdWVzKG8pLCB2KTsKCQkJaWYgKHYpIHsKCQkJCS8vIGFsbCBmaWVsZHMgaGF2ZSB2YWx1ZXMKCQkJCWF3YWl0IHRoaXMuZG9DbGljayhidXR0b24pOwoKCQkJfQoJCX0KCX0KCglmb290ZXIoYkZpeGVkKSB7CgkJcmV0dXJuIGA8L2Zvcm0+YCArIGA8ZGl2IGlkPSJkbGctYnV0dG9ucyI+YCArIHRoaXMuYnV0dG9ucy5maWx0ZXIoYiA9PiAhYi53aW5kb3cpLm1hcChiID0+IGA8YSBpZD0nJHtiLm5hbWV9JyBocmVmPSJqYXZhc2NyaXB0OnZvaWQoMCkiIGNsYXNzPSJlYXN5dWktbGlua2J1dHRvbiBjNiIgaWNvbkNscz0iaWNvbi0ke2IuaWNvbiB8fCAnc2F2ZSd9IiBzdHlsZT0id2lkdGg6JHtNYXRoLm1pbigxMjAsIHRoaXMud2lkdGggKiAwLjk1IC8gdGhpcy5idXR0b25zLmxlbmd0aCwgdGhpcy5jV2lkdGgoKSl9cHgiIG9uY2xpY2s9J0RGb3JtLmRvQ2xpY2soJHtfRnJFTUQuX3RvSlMoYil9KSc+JHtiLnRpdGxlIHx8IGIubmFtZX08L2E+Jm5ic3A7Jm5ic3A7YCkuam9pbignJykgKyAiPC9kaXY+IiArIChiRml4ZWQgPyAiIiA6ICc8L2Rpdj4nKTsKCX0KCgloZWFkZXIobmFtZSwgdGl0bGUsIGJGaXhlZCwgbGlua3MpIHsKCQl0aGlzLnRpdGxlID0gdGl0bGUgfHwgdGhpcy50aXRsZTsKCQluYW1lID0gbmFtZSB8fCB0aGlzLm5hbWU7CgkJdmFyIHJldCA9ICcnOwoKCQlyZXQgKz0gdGhpcy53aW5kb3coewoJCQluYW1lOiAiX19Db25zb2xlIiwKCQkJdHlwZTogIndpbmRvdyIsCgkJCWVkaXRvcjogdHJ1ZSwKCQkJbG9hZGVyOiBvID0+IHdpbmRvdy5sb2dzLnNsaWNlKCkucmV2ZXJzZSgpLm1hcChsID0+IGwuZGF0ZS50b0lTT1N0cmluZygpICsgIjogIiArIGwuYXJncy5tYXAocyA9PiB0eXBlb2YocykgPT09ICdvYmplY3QnID8gKChvYmosIGluZGVudCA9IDIpID0+IHsKCQkJCWxldCBjYWNoZSA9IFtdOwoJCQkJY29uc3QgcmV0VmFsID0gSlNPTi5zdHJpbmdpZnkoCgkJCQkJb2JqLAoJCQkJCShrZXksIHZhbHVlKSA9PgoJCQkJCXR5cGVvZiB2YWx1ZSA9PT0gIm9iamVjdCIgJiYgdmFsdWUgIT09IG51bGwgPwoJCQkJCWNhY2hlLmluY2x1ZGVzKHZhbHVlKSA/CgkJCQkJdW5kZWZpbmVkIC8vIER1cGxpY2F0ZSByZWZlcmVuY2UgZm91bmQsIGRpc2NhcmQga2V5CgkJCQkJOgoJCQkJCWNhY2hlLnB1c2godmFsdWUpICYmIHZhbHVlIC8vIFN0b3JlIHZhbHVlIGluIG91ciBjb2xsZWN0aW9uCgkJCQkJOgoJCQkJCXZhbHVlLAoJCQkJCWluZGVudAoJCQkJKTsKCQkJCWNhY2hlID0gbnVsbDsKCQkJCXJldHVybiByZXRWYWw7CgkJCX0pKHMpIDogcykuam9pbignLCAnKSkuam9pbignXG4nKSwKCQl9KTsKCgkJaWYgKCFiRml4ZWQpIHsKCQkJbGlua3MgPSAobGlua3MgfHwgW10pLmZpbHRlcihsID0+ICFsLmlnbm9yZSk7CgkJCWxldCB0RGF0YSA9ICIiOwoJCQlpZiAobGlua3MubGVuZ3RoKSB7CgkJCQlyZXQgKz0gYDxkaXYgaWQ9IiR7dGhpcy5uYW1lfV90b29scyI+YCArIGxpbmtzLm1hcChsID0+IGA8YSBocmVmPSJqYXZhc2NyaXB0OnZvaWQoMCkiIGNsYXNzPSJpY29uLSR7bC5pY29ufSIgb25jbGljaz0nKGFzeW5jICgpID0+IHt2YXIgYSA9ICR7X0ZyRU1ELl90b0pTKGwpfTsgJCgiI3dpbiR7dGhpcy5uYW1lfSIpLndpbmRvdygic2V0VGl0bGUiLCAiJHt0aGlzLnRpdGxlfTogIiArIGEubmFtZSk7IGF3YWl0IGEuYWN0aW9uKERGb3JtLmdldCgpKTsgJCgiI3dpbiR7dGhpcy5uYW1lfSIpLndpbmRvdygic2V0VGl0bGUiLCAiJHt0aGlzLnRpdGxlfSIpO30pKCknPjwvYT5gKS5qb2luKCdcbicpICsgIjwvZGl2PiI7CgkJCQl0RGF0YSA9IGAsdG9vbHM6IiMke3RoaXMubmFtZX1fdG9vbHMiYDsKCQkJfQoJCQlyZXQgKz0gYDxkaXYgaWQ9J3dpbiR7dGhpcy5uYW1lfScgY2xhc3M9J2Vhc3l1aS13aW5kb3cnIHRpdGxlPScke3RoaXMudGl0bGUgfHwgdGhpcy5lbmdsaXNoKHRoaXMubmFtZSl9JyBkYXRhLW9wdGlvbnM9J2ljb25DbHM6Imljb24tc2F2ZSIgJHt0RGF0YX0nIHN0eWxlPSd3aWR0aDoke3RoaXMud2lkdGh9cHg7aGVpZ2h0OiR7dGhpcy5oZWlnaHR9cHg7cGFkZGluZzoxMHB4Oyc+YDsKCQl9CgkJcmV0dXJuIHJldCArIGA8Zm9ybSBpZD0iZnJtJHt0aGlzLm5hbWV9IiBtZXRob2Q9InBvc3QiIG5vdmFsaWRhdGU+YDsKCX0KCglyZW5kZXJFbGVtZW50cyhlbGVtZW50cykgewoJCWVsZW1lbnRzID0gZWxlbWVudHMgfHwgdGhpcy5lbGVtZW50czsKCgkJdmFyIHRXaWR0aCA9IE1hdGguZmxvb3IodGhpcy53aWR0aCAqIDAuOTUpOwoJCXZhciB0SGVpZ2h0ID0gTWF0aC5mbG9vcih0aGlzLmhlaWdodCAqIDAuODUpOwoKCQlsZXQgcmV0ID0gJyc7CgkJdmFyIGdFbGVtZW50cyA9IHRoaXMuc3IoKS5ncm91cEJ5KGVsZW1lbnRzLCAiZ3JvdXAiKTsKCQlpZiAoZ0VsZW1lbnRzLmxlbmd0aCA+IDEpIHJldCArPSBgPGRpdiBpZD0idGJjV2luZG93IiBjbGFzcz0iZWFzeXVpLXRhYnMiIGRhdGEtb3B0aW9ucz0nJHt0aGlzLmV2ZW50SGFuZGxlcnMoe3R5cGU6ICd0YWJzJ30pfScgc3R5bGU9IndpZHRoOiR7dFdpZHRofXB4O2hlaWdodDoke3RIZWlnaHR9cHg7Ij5gOwoJCWZvciAodmFyIGcgPSAwOyBnIDwgZ0VsZW1lbnRzLmxlbmd0aDsgZysrKSB7CgkJCWlmIChnRWxlbWVudHMubGVuZ3RoID4gMSkgcmV0ICs9ICc8ZGl2IHRpdGxlPSInICsgKGdFbGVtZW50c1tnXS5rZXkgfHwgIk1haW4iKSArICciIHN0eWxlPSJwYWRkaW5nOjIwcHg7ZGlzcGxheTpub25lOyI+JzsKCQkJdmFyIHNFbGVtZW50cyA9IHRoaXMuc3IoKS5ncm91cEJ5KGdFbGVtZW50c1tnXS52YWx1ZXMsICJzZWN0aW9uIik7CgkJCWlmIChzRWxlbWVudHMubGVuZ3RoID4gMSkgcmV0ICs9ICc8ZGl2IGNsYXNzPSJlYXN5dWktYWNjb3JkaW9uIiBzdHlsZT0id2lkdGg6JyArIHRXaWR0aCArICdweDtoZWlnaHQ6JyArIC8qdEhlaWdodCovICIxMDAlIiArICdweDsiPic7CgkJCWZvciAodmFyIHMgPSAwOyBzIDwgc0VsZW1lbnRzLmxlbmd0aDsgcysrKSB7CgkJCQlyZXQgKz0gYDxkaXYgdGl0bGU9IiR7c0VsZW1lbnRzW3NdLmtleSB8fCAiIn0iIGRhdGEtb3B0aW9ucz0iaWNvbkNsczonaWNvbi1tb3JlJyIgc3R5bGU9InBhZGRpbmc6MTBweDsiPmA7CgkJCQlmb3IgKHZhciBpID0gMDsgaSA8IHNFbGVtZW50c1tzXS52YWx1ZXMubGVuZ3RoOyBpKyspIHsKCQkJCQl2YXIgZSA9IHNFbGVtZW50c1tzXS52YWx1ZXNbaV07CgkJCQkJaWYgKGUuaWdub3JlKSBjb250aW51ZTsKCQkJCQllLnZhbHVlID0gZS52YWx1ZSB8fCBfRnJFTUQuaGFzaFtlLm5hbWVdIHx8IChfRnJFTUQuYXBpU2VydmVyID8gX0ZyRU1ELmFwaVNlcnZlci5fX2NvbmZpZygndGVzdF8nICsgZS5uYW1lLCAnJykgOiAnJyk7CgkJCQkJcmV0ICs9IGA8ZGl2IGlkPSJmRWxlbWVudF8ke2UubmFtZX0iIGNsYXNzPSJmaXRlbSIgc3R5bGU9ImRpc3BsYXk6ICR7KGUudHlwZT09J3dpbmRvdycgfHwgZS5oaWRkZW4pPydub25lJzonJ30iPmA7CgkJCQkJaWYgKGUudG9nZ2xlKSB7CgkJCQkJCXJldCArPSBgPGEgaHJlZj0iIyIgY2xhc3M9ImVhc3l1aS1saW5rYnV0dG9uIiBkYXRhLW9wdGlvbnM9JyR7dGhpcy5ldmVudEhhbmRsZXJzKHt0eXBlOiAndG9nZ2xlJywgZm9yOiBlfSl9LHBsYWluOnRydWUsaWNvbkNsczoiaWNvbi0ke2UuaWNvbiB8fCAnc2VhcmNoJ30iJyBzdHlsZT0id2lkdGg6MTAwcHg7aGVpZ2h0OjMwcHgiPiR7ZS50aXRsZSB8fCB0aGlzLmVuZ2xpc2goZS5uYW1lKX08L2E+YDsKCQkJCQl9IGVsc2UgewoJCQkJCQlyZXQgKz0gYDxsYWJlbD4ke2UudGl0bGUgfHwgdGhpcy5lbmdsaXNoKGUubmFtZSl9OjwvbGFiZWw+YDsKCQkJCQl9CgkJCQkJaWYgKGUudHlwZSAmJiB0aGlzW2UudHlwZV0pIHsKCQkJCQkJcmV0ICs9IHRoaXNbZS50eXBlXShlKTsKCQkJCQl9IGVsc2UgaWYgKGUucmVuZGVyKSB7CgkJCQkJCXJldCArPSBlLnJlbmRlcigpOwoJCQkJCX0KCQkJCQlyZXQgKz0gJzwvZGl2Pic7CgkJCQl9CgkJCQlyZXQgKz0gJzwvZGl2Pic7CgkJCX0KCQkJaWYgKHNFbGVtZW50cy5sZW5ndGggPiAxKSByZXQgKz0gJzwvZGl2Pic7CgkJCWlmIChnRWxlbWVudHMubGVuZ3RoID4gMSkgcmV0ICs9ICI8L2Rpdj4iOwoJCX0KCQlpZiAoZ0VsZW1lbnRzLmxlbmd0aCA+IDEpIHJldCArPSAiPC9kaXY+IjsKCQlyZXR1cm4gcmV0OwoJfQoKCWluZm8obXNnKSB7CgkJaWYgKCQubWVzc2FnZXIpIHsKCQkJJC5tZXNzYWdlci5hbGVydCh0aGlzLnRpdGxlLCBtc2csICdpbmZvJyk7CgkJfSBlbHNlIHsKCQkJdGhpcy5zcigpLlNob3dNZXNzYWdlKG1zZywgdGhpcy50aXRsZSk7CgkJfQoJfQoKCWVycm9yKG1zZykgewoJCWlmICgkLm1lc3NhZ2VyKSB7CgkJCSQubWVzc2FnZXIuYWxlcnQodGhpcy50aXRsZSwgbXNnLCAnZXJyb3InKTsKCQl9IGVsc2UgewoJCQl0aGlzLnNyKCkuU2hvd01lc3NhZ2UobXNnLCB0aGlzLnRpdGxlKTsKCQl9Cgl9CgoJYnlOYW1lKG5hbWUpIHsKCQlyZXR1cm4gdGhpcy5lbGVtZW50cy5maW5kKGUgPT4gZS5uYW1lID09PSBuYW1lKTsKCX0KCgkvKiogQ29tcG9uZW50czo6U3RhcnQgKiovCglDb3JlQ29tcG9uZW50ID0gY2xhc3MgewoJCWNvbnN0cnVjdG9yKHBhZ2UsIGRGb3JtKSB7CgkJCXRoaXMucGFnZSA9IHBhZ2U7CgkJCXRoaXMuZEZvcm0gPSBkRm9ybTsKCQl9CgoJCWJ1c3koYkJ1c3kpIHsKCQkJcmV0dXJuIHRoaXMuZEZvcm0uYnVzeShiQnVzeSk7CgkJfQoKCQlfbWUodikgewoJCQlsZXQgbWVOYW1lID0gKHR5cGVvZihjb21wYW55KSAhPT0gJ3VuZGVmaW5lZCcpID8gKGNvbXBhbnkubG9nZ2VkSW5JZGVudGl0eSB8fCAibWUiKSA6ICJtZSI7CgkJCWlmICh2KSB7CgkJCQl3aW5kb3dbbWVOYW1lXSA9IHY7CgkJCX0KCgkJCXJldHVybiB3aW5kb3dbbWVOYW1lXTsKCQl9CgoJCV9jYW5WaWV3KCkgewoJCQlpZiAoIXRoaXMuX21lKCkpIHsKCQkJCXdpbmRvdy5fRnJFTUQuc2V0VVJMKHsKCQkJCQlwYWdlOiAnbG9naW4nLAoJCQkJCV9yZWRpcmVjdDogdGhpcy5wYWdlLl9jb2RlLAoJCQkJfSk7CgkJCQl0aHJvdyBgX2NhblZpZXc6ICR7dGhpcy5wYWdlLl9jb2RlfSBub3QgYWxsb3dlZCB3aXRob3V0IGxvZ2luIWA7CgkJCX0KCQl9CgoJCV9uYW1lKCkgewoJCQlpZiAoIXRoaXMuX21lKCkpIHJldHVybiAiIjsKCQkJcmV0dXJuIHRoaXMuX21lKCkubmFtZSA/IHRoaXMuX21lKCkubmFtZSgpIDogdGhpcy5fbWUoKS5Ub1N0cmluZzsKCQl9Cgl9CgoJSW5kZXhDb21wb25lbnQgPSBjbGFzcyBleHRlbmRzIHRoaXMuQ29yZUNvbXBvbmVudCB7CgkJYXN5bmMgbWFpbigpIHsKCQkJdGhpcy5fY2FuVmlldygpOwoKCQkJdGhpcy5wYWdlLmRhdGEgPSB7CgkJCQlmb3JtOiB0aGlzLmRGb3JtLnJlbmRlcignZnJtSW5kZXgnLCAiTWFpbiBQYWdlIiwgW3sKCQkJCQluYW1lOiAnV2VsY29tZScsCgkJCQkJcmVxdWlyZWQ6IHRydWUsCgkJCQkJdHlwZTogImxhYmVsIiwKCQkJCQl2YWx1ZTogdGhpcy5fbmFtZSgpLAoJCQkJfV0sIFtdKQoJCQl9OwoJCX0KCX0KCglMb2dpbkNvbXBvbmVudCA9IGNsYXNzIGV4dGVuZHMgdGhpcy5Db3JlQ29tcG9uZW50IHsKCQlhc3luYyBfYXV0aGVudGljYXRlKG8pIHsKCQkJcmV0dXJuIG51bGw7CgkJfQoKCQlhc3luYyBfbG9nZ2VkSW4oKSB7fQoKCQlhc3luYyBfbm90TG9nZ2VkSW4oKSB7fQoKCQlhc3luYyBtYWluKCkgewoJCQl0aGlzLnBhZ2UuZGF0YSA9IHsKCQkJCWZvcm06IHRoaXMuZEZvcm0ucmVuZGVyKCdmcm1Mb2dpbicsICJVc2VyIEF1dGhlbnRpY2F0aW9uIiwgW3sKCQkJCQkJbmFtZTogJ1VzZXJuYW1lJywKCQkJCQkJcmVxdWlyZWQ6IHRydWUsCgkJCQkJCXR5cGU6ICJzdHJpbmciCgkJCQkJfSwKCQkJCQl7CgkJCQkJCW5hbWU6ICdQYXNzd29yZCcsCgkJCQkJCXJlcXVpcmVkOiB0cnVlLAoJCQkJCQl0eXBlOiAicGFzc3dvcmQiCgkJCQkJfQoJCQkJXSwgW3sKCQkJCQluYW1lOiAnTG9naW4nLAoJCQkJCWF1dG9TdWJtaXQ6IHRydWUsCgkJCQkJb25jbGljazogYXN5bmMgbyA9PiB7CgkJCQkJCWxldCByZXQgPSBhd2FpdCB0aGlzLl9hdXRoZW50aWNhdGUobyk7CgoJCQkJCQlpZiAocmV0KSB7CgkJCQkJCQl0aGlzLl9tZShyZXQpOwoKCQkJCQkJCXRyeSB7CgkJCQkJCQkJYXdhaXQgdGhpcy5fbG9nZ2VkSW4oKTsKCQkJCQkJCX0gY2F0Y2ggKGV4KSB7fQoKCQkJCQkJCV9GckVNRC5zZXRVUkwoewoJCQkJCQkJCXBhZ2U6IF9GckVNRC5oYXNoLl9yZWRpcmVjdCB8fCAiaW5kZXgiCgkJCQkJCQl9KTsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCXRyeSB7CgkJCQkJCQkJYXdhaXQgdGhpcy5fbm90TG9nZ2VkSW4oKTsKCQkJCQkJCX0gY2F0Y2ggKGV4KSB7fQoKCQkJCQkJCXRoaXMuZEZvcm0uZXJyb3IoIkludmFsaWQgdXNlcm5hbWUgb3IgcGFzc3dvcmQiKTsKCQkJCQkJfQoKCQkJCQkJdGhpcy5kRm9ybS5idXN5KGZhbHNlKTsKCQkJCQl9CgkJCQl9XSkKCQkJfTsKCQl9Cgl9CgoJU3RvcmVDb21wb25lbnQgPSBjbGFzcyBleHRlbmRzIHRoaXMuQ29yZUNvbXBvbmVudCB7CgkJYXN5bmMgbWFpbigpIHt9Cgl9CgkvKiogQ29tcG9uZW50czo6RW5kICoqLwp9Ow==",
	"Name": "DynaForm",
	"Script": "d2luZG93LkR5bmFGb3JtID0gY2xhc3MgewoJY29uc3RydWN0b3IoKSB7CgkJdGhpcy50aXRsZSA9ICJGb3JtIFRpdGxlIjsKCQl0aGlzLm5hbWUgPSAiZnJtRm9ybSI7CgkJdGhpcy5lbGVtZW50cyA9IFtdOwoJCXRoaXMuc2VsZWN0cyA9IFtdOwoJCXRoaXMuZ3JpZHMgPSBbXTsKCQl0aGlzLmJ1dHRvbnMgPSBbXTsKCQl0aGlzLnpvbmVzID0gWydub3J0aCcsICdzb3V0aCcsICdlYXN0JywgJ3dlc3QnLCAnY2VudGVyJ107CgkJdGhpcy5zVGFibGUgPSBudWxsOwoJCXRoaXMuYkRlYnVnID0gZmFsc2U7CgkJdGhpcy51aVR5cGVzID0gewoJCQlpbnQ6ICJudW1iZXJzcGlubmVyIiwKCQkJbWVudTogInNwbGl0YnV0dG9uIiwKCQkJZGF0ZXRpbWU6ICJkYXRldGltZWJveCIsCgkJCWJvb2w6ICJzd2l0Y2hidXR0b24iLAoJCQlmaWxlOiAiZmlsZWJveCIsCgkJCXRleHQ6ICJ0ZXh0Ym94IiwKCQkJcGFzc3dvcmQ6ICJwYXNzd29yZGJveCIsCgkJCXN0cmluZzogInRleHRib3giLAoJCQlpbWFnZTogImRpYWxvZyIsCgkJCXByb2dyZXNzOiAicHJvZ3Jlc3NiYXIiLAoJCQlsaW5rOiAibGlua2J1dHRvbiIsCgkJCXRyZWU6ICJjb21ib3RyZWUiLAoJCQluYXZpZ2F0aW9uOiAidHJlZSIsCgkJCXNlYXJjaDogJ3NlYXJjaGJveCcsCgkJfTsKCQl0aGlzLmV2ZW50cyA9IFt7CgkJCW5hbWU6ICdvbkNsaWNrJywKCQkJaGFuZGxlcjogJ29uVG9nZ2xlJywKCQkJcGFyYW1zOiAnbj1ldmVudCcsCgkJCXR5cGU6ICd0b2dnbGUnLAoJCX0sIHsKCQkJbmFtZTogJ29uQ2xvc2UnLAoJCQloYW5kbGVyOiAnUGFuT25DbG9zZScsCgkJCXBhcmFtczogJ249ZXZlbnQnLAoJCQl0eXBlOiAnd2luZG93JywKCQl9LCB7CgkJCW5hbWU6ICdvblNlbGVjdCcsCgkJCWhhbmRsZXI6ICdTZWxlY3RDaGFuZ2UnLAoJCQlwYXJhbXM6ICduJywKCQkJdHlwZTogJ3RhYnMnLAoJCX0sIHsKCQkJbmFtZTogJ3NlYXJjaGVyJywKCQkJaGFuZGxlcjogJ0ZpZWxkQ2hhbmdlJywKCQkJcGFyYW1zOiAnbiwgbycsCgkJCXR5cGU6ICdzZWFyY2hib3gnLAoJCX0sIHsKCQkJbmFtZTogJ29uQmVmb3JlRXhwYW5kJywKCQkJaGFuZGxlcjogJ0V4cGFuZCcsCgkJCXBhcmFtczogJ24nLAoJCQl0eXBlOiAndHJlZScsCgkJfSwgewoJCQluYW1lOiAnb25DaGFuZ2UnLAoJCQloYW5kbGVyOiAnRmllbGRDaGFuZ2UnLAoJCQlwYXJhbXM6ICduLCBvJwoJCX0sIHsKCQkJbmFtZTogJ29uQmVmb3JlT3BlbicsCgkJCWhhbmRsZXI6ICdQYW5lbE9wZW4nLAoJCQlwYXJhbXM6ICcnLAoJCQl0eXBlOiAnd2luZG93JywKCQl9LCB7CgkJCW5hbWU6ICdvbk9wZW4nLAoJCQloYW5kbGVyOiAnUGVuZEFmdGVyT3BlbicsCgkJCXBhcmFtczogJycsCgkJCXR5cGU6ICd3aW5kb3cnLAoJCX0sIHsKCQkJbmFtZTogJ29uQ2xpY2snLAoJCQloYW5kbGVyOiAnZG9MaW5rJywKCQkJcGFyYW1zOiAnbj1ldmVudCwgbycsCgkJCXR5cGU6ICdsaW5rJywKCQl9LCB7CgkJCW5hbWU6ICdvbkNsaWNrUm93JywKCQkJaGFuZGxlcjogJ0ZpZWxkQ2hhbmdlJywKCQkJcGFyYW1zOiAnbiwgbycsCgkJCXR5cGU6ICdncmlkJywKCQl9XTsKCgkJaWYgKHR5cGVvZigkKSAhPT0gJ3VuZGVmaW5lZCcpICQod2luZG93KS5yZXNpemUodGhpcy53aW5kb3dSZXNpemVkKTsKCQl0aGlzLndpbmRvd1Jlc2l6ZWQoKTsKCX0KCglzcigpIHsKCQlyZXR1cm4gdHlwZW9mKF9GckVNRCkgIT09ICd1bmRlZmluZWQnID8gX0ZyRU1ELnNyKCkgOiB3aW5kb3cuc3I7Cgl9CgoJcGFyc2UoKSB7CgkJJC5wYXJzZXIucGFyc2UoKTsKCX0KCgl3aW5kb3dSZXNpemVkKCkgewoJCXRoaXMud2lkdGggPSB3aW5kb3cuaW5uZXJXaWR0aDsKCQl0aGlzLmhlaWdodCA9IHdpbmRvdy5pbm5lckhlaWdodCAqIDAuODsKCX0KCglpbml0KCkgewoJCXZhciBzZWxlY3QgPSB7CgkJCWluaXQ6IGZ1bmN0aW9uKGNvbnRhaW5lciwgb3B0aW9ucykgewoJCQkJdmFyIG9wID0gbnVsbDsKCQkJCXZhciBmb3AgPSBudWxsOwoJCQkJZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmdyaWRzLmxlbmd0aDsgaSsrKQoJCQkJCWlmICh0cnVlIHx8IHRoaXMuZ3JpZHNbaV0uaWQgPT0gb3B0aW9ucy5zb3VyY2UpIG9wID0gdGhpcy5ncmlkc1tpXS5vcHRpb25zOwoJCQkJZm9yIChpID0gMDsgaSA8IG9wLmNvbHVtbnMubGVuZ3RoOyBpKyspCgkJCQkJaWYgKG9wLmNvbHVtbnNbaV0ubmFtZSA9PSBvcHRpb25zLmZpZWxkKSBmb3AgPSBvcC5jb2x1bW5zW2ldOwoJCQkJZm9wLndpZHRoID0gKHRoaXMud2lkdGggLyAzKTsKCQkJCXZhciBlID0gJCh0aGlzLnNlbGVjdChmb3ApKTsKCQkJCXZhciBpbnB1dCA9IGUuYXBwZW5kVG8oY29udGFpbmVyKTsKCQkJCWlucHV0LmNvbWJvZ3JpZCgpOwoJCQkJdGhpcy5iaW5kKGlucHV0KTsKCQkJCXJldHVybiBpbnB1dDsKCQkJfSwKCQkJZGVzdHJveTogZnVuY3Rpb24odGFyZ2V0KSB7CgkJCQkkKHRhcmdldCkucmVtb3ZlKCk7CgkJCX0sCgkJCWdldFZhbHVlOiBmdW5jdGlvbih0YXJnZXQpIHsKCQkJCXJldHVybiAkKHRhcmdldCkudmFsKCk7CgkJCX0sCgkJCXNldFZhbHVlOiBmdW5jdGlvbih0YXJnZXQsIHZhbHVlKSB7CgkJCQkkKHRhcmdldCkudmFsKHZhbHVlKTsKCQkJfSwKCQkJcmVzaXplOiBmdW5jdGlvbih0YXJnZXQsIHdpZHRoKSB7CgkJCQkkKHRhcmdldCkuX291dGVyV2lkdGgod2lkdGgpOwoJCQl9CgkJfTsKCQkkLmV4dGVuZCgkLmZuLmRhdGFncmlkLmRlZmF1bHRzLmVkaXRvcnMsIHsKCQkJZGF0ZXRpbWU6IHsKCQkJCWluaXQ6IGZ1bmN0aW9uKGNvbnRhaW5lciwgb3B0aW9ucykgewoJCQkJCW9wdGlvbnMud2lkdGggPSB0aGlzLmNXaWR0aChvcHRpb25zKTsKCQkJCQl2YXIgaW5wdXQgPSAkKHRoaXMuZGF0ZXRpbWUob3B0aW9ucykpLmFwcGVuZFRvKGNvbnRhaW5lcik7CgkJCQkJaW5wdXQuZGF0ZXRpbWVib3goKTsKCQkJCQlyZXR1cm4gaW5wdXQ7CgkJCQl9LAoJCQkJZGVzdHJveTogZnVuY3Rpb24odGFyZ2V0KSB7CgkJCQkJJCh0YXJnZXQpLnJlbW92ZSgpOwoJCQkJfSwKCQkJCWdldFZhbHVlOiBmdW5jdGlvbih0YXJnZXQpIHsKCQkJCQlyZXR1cm4gJCh0YXJnZXQpLnZhbCgpOwoJCQkJfSwKCQkJCXNldFZhbHVlOiBmdW5jdGlvbih0YXJnZXQsIHZhbHVlKSB7CgkJCQkJJCh0YXJnZXQpLnZhbCh2YWx1ZSk7CgkJCQl9LAoJCQkJcmVzaXplOiBmdW5jdGlvbih0YXJnZXQsIHdpZHRoKSB7CgkJCQkJJCh0YXJnZXQpLl9vdXRlcldpZHRoKHdpZHRoKTsKCQkJCX0KCQkJfSwKCQkJY2hlY2tib3g6IHsKCQkJCWluaXQ6IGZ1bmN0aW9uKGNvbnRhaW5lciwgb3B0aW9ucykgewoJCQkJCXZhciBpbnB1dCA9ICQodGhpcy5ib29sKG9wdGlvbnMpKS5hcHBlbmRUbyhjb250YWluZXIpOwoJCQkJCWlucHV0LnN3aXRjaGJ1dHRvbigpOwoJCQkJCXJldHVybiBpbnB1dDsKCQkJCX0sCgkJCQlkZXN0cm95OiBmdW5jdGlvbih0YXJnZXQpIHsKCQkJCQkkKHRhcmdldCkucmVtb3ZlKCk7CgkJCQl9LAoJCQkJZ2V0VmFsdWU6IGZ1bmN0aW9uKHRhcmdldCkgewoJCQkJCXJldHVybiAkKHRhcmdldCkudmFsKCk7CgkJCQl9LAoJCQkJc2V0VmFsdWU6IGZ1bmN0aW9uKHRhcmdldCwgdmFsdWUpIHsKCQkJCQkkKHRhcmdldCkudmFsKHZhbHVlKTsKCQkJCX0sCgkJCQlyZXNpemU6IGZ1bmN0aW9uKHRhcmdldCwgd2lkdGgpIHsKCQkJCQkkKHRhcmdldCkuX291dGVyV2lkdGgod2lkdGgpOwoJCQkJfQoJCQl9LAoJCQljb21ib3RyZWVncmlkOiBzZWxlY3QsCgkJCXNlbGVjdDogc2VsZWN0LAoJCX0pOwoJfQoKCWFzayhxdWVzdGlvbiwgZkFuc3dlciA9IHYgPT4gdiwgb3B0aW9ucykgewoJCSQubWVzc2FnZXIuY29uZmlybSh0aGlzLnRpdGxlLCBxdWVzdGlvbiwgZnVuY3Rpb24ocikgewoJCQlpZiAob3B0aW9ucykgewoJCQkJZm9yICh2YXIgaSA9IDA7IGkgPCBvcHRpb25zLmxlbmd0aDsgaSsrKSB7CgkJCQkJaWYgKG9wdGlvbnNbaV0uYW5zd2VyID09IHIpIHsKCQkJCQkJcmV0dXJuIGZBbnN3ZXIob3B0aW9uc1tpXS52YWx1ZSk7CgkJCQkJfQoJCQkJfQoJCQl9IGVsc2UgewoJCQkJcmV0dXJuIGZBbnN3ZXIocik7CgkJCX0KCQl9KTsKCX0KCgl0b3BEYXRhKGFyLCBnRmllbGQsIHZGaWVsZCwgdG9wKSB7CgkJaWYgKCF0b3ApIHsKCQkJcmV0dXJuIGFyOwoJCX0KCQlyZXQgPSBbXTsKCQkkLmVhY2godGhpcy5zcigpLmdyb3VwQnkoYXIsIGdGaWVsZCksIGZ1bmN0aW9uKGtleSwgdmFsdWVzKSB7CgkJCXZhbHVlcy52YWx1ZXMuc29ydCgoYSwgYikgPT4gewoJCQkJaWYgKHBhcnNlRmxvYXQoYVt2RmllbGRdKSA8IHBhcnNlRmxvYXQoYlt2RmllbGRdKSkgewoJCQkJCXJldHVybiAxOwoJCQkJfSBlbHNlIGlmIChwYXJzZUZsb2F0KGFbdkZpZWxkXSkgPiBwYXJzZUZsb2F0KGJbdkZpZWxkXSkpIHsKCQkJCQlyZXR1cm4gLTE7CgkJCQl9IGVsc2UgewoJCQkJCXJldHVybiAwOwoJCQkJfQoJCQl9KTsKCQkJJC5lYWNoKHZhbHVlcy52YWx1ZXMsIGZ1bmN0aW9uKGksIHYpIHsKCQkJCWlmIChpIDwgdG9wKSB7CgkJCQkJcmV0LnB1c2godik7CgkJCQl9CgkJCX0pOwoJCX0pOwoJCXJldHVybiByZXQ7Cgl9CgoJYXN5bmMgZG9DbGljayhidXR0b24pIHsKCQlsZXQgX3RoaXMgPSB0eXBlb2YodGhpcy5kb0NsaWNrKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMgOiB3aW5kb3cuREZvcm07CgkJYnV0dG9uID0gX3RoaXMuYnV0dG9ucy5maW5kKGIgPT4gYi5uYW1lID09IGJ1dHRvbi5uYW1lICYmIGIuZ3JvdXAgPT0gYnV0dG9uLmdyb3VwKTsKCQlfdGhpcy5idXN5KHRydWUpOwoJCV90aGlzLnNldCh7CgkJCVdvcmtQcm9ncmVzc1ZhbHVlOiAyMAoJCX0pCgoJCXZhciBvID0gX3RoaXMuZ2V0KCk7CgkJdmFyIHNNaXNzaW5nID0gX3RoaXMuZWxlbWVudHMuZmlsdGVyKGUgPT4gKGJ1dHRvbi53aW5kb3cgPyBidXR0b24uZ3JvdXAgPT0gZS5ncm91cCA6IHRydWUpKS5maWx0ZXIoZSA9PiBlLnJlcXVpcmVkICYmICFvW2UubmFtZV0pLm1hcChlID0+ICI8bGk+IiArIChlLmxhYmVsIHx8IGUubmFtZSkgKyAiPC9saT4iKS5qb2luKCIiKTsKCQlpZiAoc01pc3NpbmcpIHsKCQkJd2luZG93Ll9GckVNRC5fZXJyb3IoIk1pc3NpbmcgbWFuZGF0b3J5IGZpZWxkczo8YnIvPjx1bD4iICsgc01pc3NpbmcgKyAiPC91bD4iLCA1MDAwKTsKCQkJX3RoaXMuYnVzeShmYWxzZSk7CgkJCXJldHVybjsKCQl9CgkJaWYgKGJ1dHRvbi5vbmNsaWNrKSBhd2FpdCBidXR0b24ub25jbGljayhvKTsKCQlpZiAoYnV0dG9uLm9uQ2xpY2spIGF3YWl0IGJ1dHRvbi5vbkNsaWNrKG8pOwoJCV90aGlzLmJ1c3koZmFsc2UpOwoJfQoKCWJ1c3koYkJ1c3kpIHsKCQlpZiAoIWJCdXN5KSB7CgkJCXZhciB0b3RhbCA9IDA7CgkJCWlmICh0eXBlb2YgbW9tZW50ICE9PSAndW5kZWZpbmVkJykgewoJCQkJdG90YWwgPSBtb21lbnQoKS5kaWZmKG1vbWVudCh0aGlzLmJ1c3lTdGFtcCksICdzZWNvbmRzJyk7CgkJCX0gZWxzZSB7CgkJCQkvLyBubyBtb21lbnQsIHVzZSBzdGFuZGFyZCBEYXRlCgkJCQl0b3RhbCA9IChuZXcgRGF0ZSgpLmdldFRpbWUoKSAtIHRoaXMuYnVzeVN0YW1wID8gdGhpcy5idXN5U3RhbXAuZ2V0VGltZSgpIDogMCkgLyAxMDAwIC8gMzYwMDsKCQkJfQoJCQlpZiAodGhpcy5iRGVidWcpIHsKCQkJCXdpbmRvdy5fRnJFTUQuX2FsZXJ0KCJFeGVjdXRpb24gVGltZTogIiArIHRvdGFsICsgIiBzZWNvbmRzLiIpOwoJCQl9CgkJCWRlbGV0ZSB0aGlzLmJ1c3lTdGFtcDsKCgkJCXNldEludGVydmFsKDEsICgpID0+IHRoaXMuU2V0KHsKCQkJCUxvYWRpbmc6IDEwCgkJCX0pKTsKCQl9IGVsc2UgewoJCQl0aGlzLmJ1c3lTdGFtcCA9IG5ldyBEYXRlKCk7CgkJfQoKCQkkLmVhY2goJC5tZXJnZSgkLm1hcCh0aGlzLmJ1dHRvbnMsIGIgPT4gYi5uYW1lKSwgJC5tYXAodGhpcy5lbGVtZW50cy5maWx0ZXIoZSA9PiBlLnR5cGUgPT0gJ2xpbmsnKSwgZSA9PiBlLm5hbWUpKSwgKF8sIGUpID0+ICQoJyMnICsgZSkubGlua2J1dHRvbihiQnVzeSA/ICdkaXNhYmxlJyA6ICdlbmFibGUnKSk7Cgl9CgoJcHJlZml4KGUpIHsKCQlzd2l0Y2ggKGUudHlwZSkgewoJCQljYXNlICdsYWJlbCc6CgkJCQlyZXR1cm4gJ2xibCc7CgkJCWNhc2UgJ3RleHQnOgoJCQljYXNlICdzdHJpbmcnOgoJCQljYXNlICdzZWFyY2gnOgoJCQljYXNlICdwYXNzd29yZCc6CgkJCQlyZXR1cm4gJ3R4dCc7CgkJCWNhc2UgIkRhdGVUaW1lIjoKCQkJY2FzZSAiZGF0ZXRpbWUiOgoJCQkJcmV0dXJuICdkdHAnOwoJCQljYXNlICJpbnQiOgoJCQljYXNlICJpbnRlZ2VyIjoKCQkJY2FzZSAibnVtYmVyIjoKCQkJY2FzZSAibG9uZyI6CgkJCWNhc2UgIkxvbmciOgoJCQkJcmV0dXJuICdudWQnOwoJCQljYXNlICdmaWxlJzoKCQkJCXJldHVybiAnZmlsJzsKCQkJY2FzZSAnaW1hZ2UnOgoJCQkJcmV0dXJuICdpbWcnOwoJCQljYXNlICJib29sIjoKCQkJCXJldHVybiAnY2hrJzsKCQkJY2FzZSAid2luZG93IjoKCQkJCXJldHVybiAncG5sJzsKCQkJY2FzZSAicHJvZ3Jlc3MiOgoJCQkJcmV0dXJuICdwcmcnOwoJCQljYXNlICJncmlkIjoKCQkJY2FzZSAidHJlZSI6CgkJCWNhc2UgInNlbGVjdCI6CgkJCQlyZXR1cm4gJ2NtYic7CgkJCWRlZmF1bHQ6CgkJCQlyZXR1cm4gJyc7CgkJfQoJfQoKCWNsZWFyKGdyb3VwKSB7CgkJdmFyIG8gPSB7fTsKCQkkLmVhY2godGhpcy5lbGVtZW50cy5maWx0ZXIoZSA9PiBncm91cCA/IGUuZ3JvdXAgPT0gZ3JvdXAgOiB0cnVlKSwgKF8sIGUpID0+IHsKCQkJdmFyIG5hbWUgPSAoZS5lbXNTb3VyY2UgPyAiXyIgOiAiIikgKyBlLm5hbWU7CgkJCXN3aXRjaCAoZS50eXBlKSB7CgkJCQljYXNlICd0ZXh0JzoKCQkJCWNhc2UgJ3N0cmluZyc6CgkJCQljYXNlICdzZWFyY2gnOgoJCQkJY2FzZSAncGFzc3dvcmQnOgoJCQkJY2FzZSAiRGF0ZVRpbWUiOgoJCQkJY2FzZSAiZGF0ZXRpbWUiOgoJCQkJCW9bbmFtZV0gPSAiIjsKCQkJCQlicmVhazsKCQkJCWNhc2UgImludCI6CgkJCQljYXNlICJudW1iZXIiOgoJCQkJY2FzZSAiaW50ZWdlciI6CgkJCQljYXNlICJsb25nIjoKCQkJCWNhc2UgIkxvbmciOgoJCQkJY2FzZSAicHJvZ3Jlc3MiOgoJCQkJCW9bbmFtZV0gPSAwOwoJCQkJCWJyZWFrOwoJCQkJY2FzZSAidHJlZSI6CgkJCQljYXNlICJzZWxlY3QiOgoJCQkJCW9bbmFtZV0gPSBudWxsOwoJCQkJCWJyZWFrOwoJCQkJY2FzZSAiZ3JpZCI6CgkJCQkJb1tuYW1lXSA/IG9bbmFtZV0uZGF0YSA9IFtdIDogbnVsbDsKCQkJCQlicmVhazsKCQkJCWNhc2UgImJvb2wiOgoJCQkJCW9bbmFtZV0gPSBmYWxzZTsKCQkJCQlicmVhazsKCQkJCWRlZmF1bHQ6CgkJCQkJYnJlYWs7CgkJCX0KCQl9KTsKCQkvL2NvbnNvbGUubG9nKCJjbGVhciIsIG8pOwoJCXRoaXMuc2V0KG8pOwoJCXRoaXMuYnVzeShmYWxzZSk7Cgl9CgoJc2V0KG8sIGVOYW1lKSB7CgkJaWYgKGVOYW1lKSB7CgkJCXZhciBvRWxlbWVudCA9IHRoaXMuYnlOYW1lKGVOYW1lKTsKCQkJaWYgKCFvRWxlbWVudCkgcmV0dXJuOwoJCQl2YXIgYXR0ID0gbnVsbDsKCQkJaWYgKG8gJiYgby5JZCAmJiBvLkVudGl0eUF0dHJpYnV0ZSkgewoJCQkJLy8gYW4gRW50aXR5VmFsdWUKCQkJCWZvciAodmFyIHAgaW4gbykKCQkJCQlpZiAocC5lbmRzV2l0aCgiVmFsdWUiKSkgYXR0ID0gcDsKCQkJCW9FbGVtZW50LmVtc1NvdXJjZSA9IG87CgkJCX0KCQkJdHJ5IHsKCQkJCXN3aXRjaCAob0VsZW1lbnQudHlwZSkgewoJCQkJCWNhc2UgJ2xhYmVsJzoKCQkJCQkJaWYgKGF0dCkgewoJCQkJCQkJJCgiIyIgKyB0aGlzLnByZWZpeChvRWxlbWVudCkgKyBvRWxlbWVudC5uYW1lKS5odG1sKG9bYXR0XSk7CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQkkKCIjIiArIHRoaXMucHJlZml4KG9FbGVtZW50KSArIG9FbGVtZW50Lm5hbWUpLmh0bWwoKG8gJiYgby5FbnRpdHlBdHRyaWJ1dGUpID8gIiIgOiBvKTsKCQkJCQkJfQoJCQkJCQlicmVhazsKCQkJCQljYXNlICd0ZXh0JzoKCQkJCQljYXNlICdzdHJpbmcnOgoJCQkJCWNhc2UgJ3Bhc3N3b3JkJzoKCQkJCQljYXNlICJpbnQiOgoJCQkJCWNhc2UgInNlYXJjaCI6CgkJCQkJY2FzZSAiaW50ZWdlciI6CgkJCQkJY2FzZSAibnVtYmVyIjoKCQkJCQljYXNlICJsb25nIjoKCQkJCQljYXNlICJMb25nIjoKCQkJCQkJaWYgKGF0dCkgewoJCQkJCQkJJCgiIyIgKyB0aGlzLnByZWZpeChvRWxlbWVudCkgKyBvRWxlbWVudC5uYW1lKVt0aGlzLnVpVHlwZXNbb0VsZW1lbnQudHlwZV1dKCJzZXRWYWx1ZSIsIG9bYXR0XSk7CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQkkKCIjIiArIHRoaXMucHJlZml4KG9FbGVtZW50KSArIG9FbGVtZW50Lm5hbWUpW3RoaXMudWlUeXBlc1tvRWxlbWVudC50eXBlXV0oInNldFZhbHVlIiwgKG8gJiYgby5FbnRpdHlBdHRyaWJ1dGUpID8gIiIgOiBvKTsKCQkJCQkJfQoJCQkJCQlicmVhazsKCQkJCQljYXNlICJEYXRlVGltZSI6CgkJCQkJY2FzZSAiZGF0ZXRpbWUiOgoJCQkJCQlpZiAoYXR0KSB7CgkJCQkJCQkkKCIjIiArIHRoaXMucHJlZml4KG9FbGVtZW50KSArIG9FbGVtZW50Lm5hbWUpW3RoaXMudWlUeXBlc1tvRWxlbWVudC50eXBlXV0oJ3NldFZhbHVlJywgKG9bYXR0XSA/IHRoaXMuc3IoKS50b0RhdGVUaW1lKG9bYXR0XSkgOiAiIikpOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJJCgiIyIgKyB0aGlzLnByZWZpeChvRWxlbWVudCkgKyBvRWxlbWVudC5uYW1lKVt0aGlzLnVpVHlwZXNbb0VsZW1lbnQudHlwZV1dKCdzZXRWYWx1ZScsIChvICYmIG8uRW50aXR5QXR0cmlidXRlKSA/ICIiIDogKG8gPyB0aGlzLnNyKCkudG9EYXRlVGltZShvKSA6ICIiKSk7CgkJCQkJCX0KCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAiYm9vbCI6CgkJCQkJCWlmIChhdHQpIHsKCQkJCQkJCSQoIiMiICsgdGhpcy5wcmVmaXgob0VsZW1lbnQpICsgb0VsZW1lbnQubmFtZSlbdGhpcy51aVR5cGVzW29FbGVtZW50LnR5cGVdXSgob1thdHRdID8gJycgOiAndW4nKSArICdjaGVjaycpOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJJCgiIyIgKyB0aGlzLnByZWZpeChvRWxlbWVudCkgKyBvRWxlbWVudC5uYW1lKVt0aGlzLnVpVHlwZXNbb0VsZW1lbnQudHlwZV1dKCgoKG8gJiYgby5FbnRpdHlBdHRyaWJ1dGUpID8gIiIgOiBvKSA/ICcnIDogJ3VuJykgKyAnY2hlY2snKTsKCQkJCQkJfQoJCQkJCQlicmVhazsKCQkJCQljYXNlICJ3aW5kb3ciOgoJCQkJCQlpZiAoYXR0KSB7CgkJCQkJCQlvRWxlbWVudC52YWx1ZSA9IG9bYXR0XTsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCW9FbGVtZW50LnZhbHVlID0gKG8gJiYgby5FbnRpdHlBdHRyaWJ1dGUpID8gIiIgOiBvOwoJCQkJCQl9CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgInByb2dyZXNzIjoKCQkJCQkJdmFyIHYgPSAwOwoJCQkJCQlpZiAoYXR0KSB7CgkJCQkJCQl2ID0gb1thdHRdOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJdiA9IChvICYmIG8uRW50aXR5QXR0cmlidXRlKSA/ICIiIDogbzsKCQkJCQkJfQoJCQkJCQljb25zb2xlLmxvZygiIyIgKyB0aGlzLnByZWZpeChvRWxlbWVudCkgKyBvRWxlbWVudC5uYW1lLCB0aGlzLnVpVHlwZXNbb0VsZW1lbnQudHlwZV0sIE1hdGgucm91bmQodiAqIDEwKSAvIDEwKTsKCQkJCQkJJCgiIyIgKyB0aGlzLnByZWZpeChvRWxlbWVudCkgKyBvRWxlbWVudC5uYW1lKVt0aGlzLnVpVHlwZXNbb0VsZW1lbnQudHlwZV1dKCdzZXRWYWx1ZScsIE1hdGgucm91bmQodiAqIDEwKSAvIDEwKTsKCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAiZ3JpZCI6CgkJCQkJCWxldCBjb2xzID0gSlNPTi5wYXJzZSgieyIgKyB0aGlzLm1hcENvbHVtbnMob0VsZW1lbnQsIHRydWUpICsgIn0iKTsKCQkJCQkJJC5lYWNoKGNvbHMuY29sdW1uc1swXSwgKF8sIGMpID0+IGMuZm9ybWF0dGVyID0gdGhpcy5zcigpLnJ1blNjcmlwdCh0aGlzLmZvcm1hdHRlcihvRWxlbWVudC5uYW1lLCBjKSkpOwoJCQkJCQkkKCIjIiArIHRoaXMucHJlZml4KG9FbGVtZW50KSArIG9FbGVtZW50Lm5hbWUpLmRhdGFncmlkKGNvbHMpOwoJCQkJCQlpZiAoYXR0KSB7CgkJCQkJCQkkKCIjIiArIHRoaXMucHJlZml4KG9FbGVtZW50KSArIG9FbGVtZW50Lm5hbWUpLmRhdGFncmlkKHsKCQkJCQkJCQlkYXRhOiBvW2F0dF0KCQkJCQkJCX0pOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJJCgiIyIgKyB0aGlzLnByZWZpeChvRWxlbWVudCkgKyBvRWxlbWVudC5uYW1lKS5kYXRhZ3JpZCh7CgkJCQkJCQkJZGF0YTogKG8gJiYgby5FbnRpdHlBdHRyaWJ1dGUpID8gIiIgOiBvCgkJCQkJCQl9KTsKCQkJCQkJfQoJCQkJCQkkKCIjIiArIHRoaXMucHJlZml4KG9FbGVtZW50KSArIG9FbGVtZW50Lm5hbWUpLmRhdGFncmlkKCJ1bnNlbGVjdEFsbCIpOwoJCQkJCQkkKCIjIiArIHRoaXMucHJlZml4KG9FbGVtZW50KSArIG9FbGVtZW50Lm5hbWUpLmRhdGFncmlkKCk7CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgInRyZWUiOgoJCQkJCQl2YXIgdiA9IGF0dCA/IG9bYXR0XSA6ICgobyAmJiBvLkVudGl0eUF0dHJpYnV0ZSkgPyAiIiA6IG8pOwoJCQkJCQlpZiAoQXJyYXkuaXNBcnJheSh2KSkgewoJCQkJCQkJJCgiIyIgKyB0aGlzLnByZWZpeChvRWxlbWVudCkgKyBvRWxlbWVudC5uYW1lKVt0aGlzLnVpVHlwZXNbb0VsZW1lbnQudHlwZV1dKCJ0cmVlIikudHJlZSgibG9hZERhdGEiLCB2KTsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCSQoIiMiICsgdGhpcy5wcmVmaXgob0VsZW1lbnQpICsgb0VsZW1lbnQubmFtZSlbdGhpcy51aVR5cGVzW29FbGVtZW50LnR5cGVdXSgnc2V0VmFsdWUnLCB2KTsKCQkJCQkJfQoJCQkJCQlicmVhazsKCQkJCQljYXNlICJzZWxlY3QiOgoJCQkJCQkvL2NvbnNvbGUubG9nKCJzZXQoKTogb0VsZW1lbnQ6ICIgKyBvRWxlbWVudC5uYW1lICsgIiwgdj0iLCB2KTsKCQkJCQkJaWYgKGF0dCkgewoJCQkJCQkJaWYgKG9FbGVtZW50Lm9wdGlvbnMpIHsKCQkJCQkJCQkkKCIjIiArIHRoaXMucHJlZml4KG9FbGVtZW50KSArIG9FbGVtZW50Lm5hbWUpLmNvbWJvKCdzZXRWYWx1ZScgKyAob0VsZW1lbnQubXVsdGlwbGUgPyAncycgOiAnJyksIChvW2F0dF0gPyBvW2F0dF0gOiAiIikpOwoJCQkJCQkJCSQoIiMiICsgdGhpcy5wcmVmaXgob0VsZW1lbnQpICsgb0VsZW1lbnQubmFtZSkuY29tYm8oJ3NldFZhbHVlJyArIChvRWxlbWVudC5tdWx0aXBsZSA/ICdzJyA6ICcnKSwgKG9bYXR0XSA/IG9bYXR0XSA6ICIiKSk7CgkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCSQoIiMiICsgdGhpcy5wcmVmaXgob0VsZW1lbnQpICsgb0VsZW1lbnQubmFtZSkuY29tYm9ncmlkKCdzZXRWYWx1ZScgKyAob0VsZW1lbnQubXVsdGlwbGUgPyAncycgOiAnJyksIChvW2F0dF0gPyBvW2F0dF0gOiAiIikpOwoJCQkJCQkJfQoJCQkJCQl9IGVsc2UgewoJCQkJCQkJdiA9IG51bGw7CgkJCQkJCQlpZiAobyA9PT0gbnVsbCkgewoKCQkJCQkJCX0gZWxzZSBpZiAoby5jb25zdHJ1Y3RvciA9PT0gQXJyYXkpIHsKCgkJCQkJCQl9IGVsc2UgaWYgKCFvLkVudGl0eUF0dHJpYnV0ZSkgewoJCQkJCQkJCXYgPSBvIHx8IHsKCQkJCQkJCQkJSWQ6IG8uSWQsCgkJCQkJCQkJCV9Ub1N0cmluZzogby5fVG9TdHJpbmcsCgkJCQkJCQkJCXRvU3RyaW5nOiBmdW5jdGlvbigpIHsKCQkJCQkJCQkJCXJldHVybiB0aGlzLl9Ub1N0cmluZzsKCQkJCQkJCQkJfQoJCQkJCQkJCX07CgkJCQkJCQl9CgkJCQkJCQlpZiAob0VsZW1lbnQub3B0aW9ucykgewoJCQkJCQkJCSQoIiMiICsgdGhpcy5wcmVmaXgob0VsZW1lbnQpICsgb0VsZW1lbnQubmFtZSkuY29tYm8oJ3NldFZhbHVlJyArIChvRWxlbWVudC5tdWx0aXBsZSA/ICdzJyA6ICcnKSwgdik7CgkJCQkJCQkJJCgiIyIgKyB0aGlzLnByZWZpeChvRWxlbWVudCkgKyBvRWxlbWVudC5uYW1lKS5jb21ibygnc2V0VGV4dCcgKyAob0VsZW1lbnQubXVsdGlwbGUgPyAncycgOiAnJyksIHYpOwoJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQkkKCIjIiArIHRoaXMucHJlZml4KG9FbGVtZW50KSArIG9FbGVtZW50Lm5hbWUpLmNvbWJvZ3JpZCgnc2V0VmFsdWUnICsgKG9FbGVtZW50Lm11bHRpcGxlID8gJ3MnIDogJycpLCB2KTsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCQlicmVhazsKCQkJCQlkZWZhdWx0OgoJCQkJCQlicmVhazsKCQkJCX0KCQkJfSBjYXRjaCAoZXgpIHsKCQkJCWNvbnNvbGUubG9nKGV4KTsKCQkJfQoJCX0gZWxzZSB7CgkJCWZvciAodmFyIHAgaW4gbykgewoJCQkJaWYgKHAuaW5kZXhPZignXycpID09PSAwKSBwID0gcC5zdWJzdHJpbmcoMSk7CgkJCQl2YXIgZSA9IHRoaXMuYnlOYW1lKHApOwoJCQkJaWYgKCFlIHx8ICFlLm5hbWUpIGNvbnRpbnVlOwoJCQkJdmFyIHZhbHVlID0gb1twXTsKCQkJCWlmIChlLm5hbWUgPT0gdGhpcy5zVGFibGUpIHsKCQkJCQl2YWx1ZSA9IG87CgkJCQkJdmFsdWUuRGF0ZSA9IG5ldyBEYXRlKCk7CgkJCQl9CgkJCQlpZiAocCA9PSAiRW50aXR5VmFsdWVzIikgewoJCQkJCS8vIGFuIGVtc0Zvcm1WYWx1ZXMgc291cmNlCgkJCQkJLy8gZmluZCB0aGUgRW50aXR5VmFsdWUgZm9yIHRoaXMgZWxlbWVudCBhbmQgc2V0IGl0CgkJCQkJZm9yICh2YXIgaiA9IDA7IGogPCBvLkVudGl0eVZhbHVlcy5sZW5ndGg7IGorKykgewoJCQkJCQlpZiAoby5FbnRpdHlWYWx1ZXNbal0uRW50aXR5QXR0cmlidXRlLk5hbWUgPT0gZS5uYW1lKSB7CgkJCQkJCQkvLyBmb3VuZCB0aGUgRW50aXR5VmFsdWUgZm9yIHRoaXMgZWxlbWVudAoJCQkJCQkJX3YgPSBvLkVudGl0eVZhbHVlc1tqXTsKCQkJCQkJCWZvciAodmFyIHEgaW4gX3YpIHsKCQkJCQkJCQlpZiAocS5lbmRzV2l0aCgiVmFsdWUiKSkgewoJCQkJCQkJCQlfdltxXSA9IHZhbHVlOwoJCQkJCQkJCX0KCQkJCQkJCX0KCQkJCQkJCWJyZWFrOwoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQkJdGhpcy5zZXQodmFsdWUsIGUubmFtZSk7CgkJCX0KCQl9Cgl9CgoJZ2V0KCkgewoJCXZhciBvID0ge307CgkJaWYgKHRoaXMuc1RhYmxlICYmIHdpbmRvd1t0aGlzLnNUYWJsZV0pIG8gPSBuZXcgd2luZG93W3RoaXMuc1RhYmxlXSgpOwoJCWZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5lbGVtZW50cy5sZW5ndGg7IGkrKykgewoJCQl2YXIgY24gPSBudWxsOwoJCQl2YXIgdiA9IG51bGw7CgkJCXRyeSB7CgkJCQlsZXQgZU5hbWUgPSAiIyIgKyB0aGlzLnByZWZpeCh0aGlzLmVsZW1lbnRzW2ldKSArIHRoaXMuZWxlbWVudHNbaV0ubmFtZTsKCQkJCXN3aXRjaCAodGhpcy5lbGVtZW50c1tpXS50eXBlKSB7CgkJCQkJY2FzZSAnbGFiZWwnOgoJCQkJCQljbiA9ICQoZU5hbWUpOwoJCQkJCQl2ID0gY24uaHRtbCgpOwoJCQkJCQlicmVhazsKCQkJCQljYXNlICd0ZXh0JzoKCQkJCQljYXNlICdzdHJpbmcnOgoJCQkJCWNhc2UgJ3NlYXJjaCc6CgkJCQkJY2FzZSAncGFzc3dvcmQnOgoJCQkJCQljbiA9ICQoZU5hbWUpOwoJCQkJCQl2ID0gY24udmFsKCk7CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgImZpbGUiOgoJCQkJCWNhc2UgImltYWdlIjoKCQkJCQkJY24gPSAkKGVOYW1lKTsKCQkJCQkJdiA9IHRoaXMuZWxlbWVudHNbaV0uZGF0YTsKCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAiRGF0ZVRpbWUiOgoJCQkJCWNhc2UgImRhdGV0aW1lIjoKCQkJCQkJdiA9IG5ldyBEYXRlKCQoZU5hbWUpLmRhdGV0aW1lYm94KCdnZXRWYWx1ZScpKTsKCQkJCQkJY24gPSAkKGVOYW1lKTsKCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAicHJvZ3Jlc3MiOgoJCQkJCQljbiA9ICQoZU5hbWUpOwoJCQkJCQl2ID0gY24ucHJvZ3Jlc3NiYXIoJ2dldFZhbHVlJyk7CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgImludCI6CgkJCQkJY2FzZSAiaW50ZWdlciI6CgkJCQkJY2FzZSAibnVtYmVyIjoKCQkJCQljYXNlICJsb25nIjoKCQkJCQljYXNlICJMb25nIjoKCQkJCQkJY24gPSAkKGVOYW1lKTsKCQkJCQkJdiA9IHBhcnNlRmxvYXQoY24udmFsKCkpOwoJCQkJCQlpZiAoaXNOYU4odikpIHYgPSAwOwoJCQkJCQlicmVhazsKCQkJCQljYXNlICJncmlkIjoKCQkJCQkJY24gPSAkKGVOYW1lKTsKCQkJCQkJdiA9IGNuLmRhdGFncmlkKCdnZXREYXRhJyk7CgkJCQkJCXYuc2VsZWN0ZWQgPSBjbi5kYXRhZ3JpZCgiZ2V0U2VsZWN0ZWQiKTsKCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAidHJlZSI6CgkJCQkJCWNuID0gJChlTmFtZSk7CgkJCQkJCXYgPSBjbi5jb21ib3RyZWUoInRyZWUiKS50cmVlKCJnZXRTZWxlY3RlZCIpOwoJCQkJCQlicmVhazsKCQkJCQljYXNlICJ3aW5kb3ciOgoJCQkJCQl2ID0gdGhpcy5lbGVtZW50c1tpXS52YWx1ZTsKCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAic2VsZWN0IjoKCQkJCQkJaWYgKHRoaXMuZWxlbWVudHNbaV0ub3B0aW9ucykgewoJCQkJCQkJdiA9ICQoZU5hbWUpLmNvbWJvZ3JpZCgnZ2V0VmFsdWUnICsgKHRoaXMuZWxlbWVudHNbaV0ubXVsdGlwbGUgPyAncycgOiAnJykpOwoJCQkJCQkJdiA9IHRoaXMuc3IoKS5ydW5TY3JpcHQodik7CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQl2ID0gJChlTmFtZSkuY29tYm9ncmlkKCdncmlkJykuZGF0YWdyaWQoJ2dldFNlbGVjdGlvbnMnKTsKCQkJCQkJCWlmICghdiB8fCAhdi5sZW5ndGgpIHsKCQkJCQkJCQl2ID0gJChlTmFtZSkuY29tYm9ncmlkKCdnZXRWYWx1ZScgKyAodGhpcy5lbGVtZW50c1tpXS5tdWx0aXBsZSA/ICdzJyA6ICcnKSk7CgkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCWlmICghdGhpcy5lbGVtZW50c1tpXS5tdWx0aXBsZSkgdiA9IHZbMF07CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQkJY24gPSAkKGVOYW1lKTsKCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAiYm9vbCI6CgkJCQkJCWNuID0gJChlTmFtZSk7CgkJCQkJCXYgPSBjbi5zd2l0Y2hidXR0b24oJ29wdGlvbnMnKS5jaGVja2VkOwoJCQkJCQlicmVhazsKCQkJCQlkZWZhdWx0OgoJCQkJCQlicmVhazsKCQkJCX0KCQkJCW9bdGhpcy5lbGVtZW50c1tpXS5uYW1lXSh2KTsKCQkJfSBjYXRjaCAoZSkgewoJCQkJLy9jb25zb2xlLmxvZyh0aGlzLmVsZW1lbnRzW2ldLm5hbWUsIGUpOwoJCQkJb1t0aGlzLmVsZW1lbnRzW2ldLm5hbWVdID0gdjsKCQkJfQoJCQlpZiAoY24pIHsKCQkJCWlmIChvLkVudGl0eVZhbHVlcykgewoJCQkJCWZvciAodmFyIGogPSAwOyBqIDwgby5FbnRpdHlWYWx1ZXMubGVuZ3RoOyBqKyspIHsKCQkJCQkJaWYgKHRoaXMuZWxlbWVudHNbaV0ubmFtZSA9PSB0aGlzLnNUYWJsZSAmJiB0aGlzLmVsZW1lbnRzW2ldLmVtc1NvdXJjZSkgby5JZCA9IHRoaXMuZWxlbWVudHNbaV0uZW1zU291cmNlLklkOwoJCQkJCQlpZiAoby5FbnRpdHlWYWx1ZXNbal0uRW50aXR5QXR0cmlidXRlLk5hbWUgPT0gdGhpcy5lbGVtZW50c1tpXS5uYW1lICYmIHRoaXMuZWxlbWVudHNbaV0uZW1zU291cmNlKSB7CgkJCQkJCQlvLkVudGl0eVZhbHVlc1tqXS5JZCA9IHRoaXMuZWxlbWVudHNbaV0uZW1zU291cmNlLklkOwoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQl9CgkJfQoJCXJldHVybiBvOwoJfQoKCWNIZWlnaHQob3B0aW9ucykgewoJCWlmIChvcHRpb25zICYmIG9wdGlvbnMuZWRpdG9yKSByZXR1cm4gd2luZG93LmlubmVySGVpZ2h0OwoJCWlmIChvcHRpb25zICYmIG9wdGlvbnMuaGVpZ2h0ICYmIHR5cGVvZihvcHRpb25zLmhlaWdodCkgPT09ICdzdHJpbmcnKSByZXR1cm4gdGhpcy5oZWlnaHQ7CgkJaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy50eXBlID09ICd3aW5kb3cnICYmICFvcHRpb25zLmhlaWdodCkgcmV0dXJuIHRoaXMuaGVpZ2h0ICogMC45OwoJCXJldHVybiBNYXRoLmZsb29yKCgob3B0aW9ucyA/IG9wdGlvbnMuaGVpZ2h0IDogbnVsbCkgfHwgKHRoaXMuaGVpZ2h0IC8gMykpKTsKCX0KCglzZWFyY2gob3B0aW9ucykgewoJCXJldHVybiB0aGlzLnN0cmluZyhvcHRpb25zKTsKCX0KCglzdHJpbmcob3B0aW9ucykgewoJCW9wdGlvbnMuaGVpZ2h0ID0gMjA7CgkJb3B0aW9ucy5zaW1wbGUgPSB0cnVlOwoJCXJldHVybiB0aGlzLnRleHQob3B0aW9ucyk7Cgl9CgoJZGF0ZXRpbWUob3B0aW9ucykgewoJCXJldHVybiBgPGlucHV0IGlkPSJkdHAke29wdGlvbnMubmFtZX0iIGNsYXNzPSJlYXN5dWktJHt0aGlzLnVpVHlwZXNbb3B0aW9ucy50eXBlXX0iIHJlcXVpcmVkPSIke29wdGlvbnMucmVxdWlyZWQgPyAndHJ1ZScgOiAnZmFsc2UnfSIgdmFsdWU9IiR7dGhpcy52YWx1ZShvcHRpb25zKX0iIHN0eWxlPSJ3aWR0aDoke3RoaXMuY1dpZHRoKG9wdGlvbnMpfXB4Ij5gOwoJfQoKCXF1ZXJ5KG9wdGlvbnMpIHsKCQlyZXR1cm4gIjxkaXYgaWQ9J3ZzIiArIG9wdGlvbnMubmFtZSArICInPjwvZGl2PiI7Cgl9CgoJRGF0ZVRpbWUob3B0aW9ucykgewoJCXJldHVybiB0aGlzLmRhdGV0aW1lKG9wdGlvbnMpOwoJfQoKCWxvbmcob3B0aW9ucykgewoJCXJldHVybiB0aGlzLmludChvcHRpb25zKTsKCX0KCglMb25nKG9wdGlvbnMpIHsKCQlyZXR1cm4gdGhpcy5sb25nKG9wdGlvbnMpOwoJfQoKCXZhbHVlKG9wdGlvbnMpIHsKCQlpZiAodHlwZW9mIG9wdGlvbnMudmFsdWUgPT09ICdmdW5jdGlvbicpIHsKCQkJdHJ5IHsKCQkJCXJldHVybiBvcHRpb25zLnZhbHVlKHRoaXMuZ2V0KCkpOwoJCQl9IGNhdGNoIChleCkgewoJCQkJY29uc29sZS5sb2coYERGb3JtLnZhbHVlKCR7b3B0aW9ucy5uYW1lfSk6ICR7ZXh9YCk7CgkJCQlyZXR1cm4gJyc7CgkJCX0KCQl9IGVsc2UgewoJCQlzd2l0Y2ggKG9wdGlvbnMudHlwZSkgewoJCQkJY2FzZSAnaW50JzoKCQkJCWNhc2UgJ3Byb2dyZXNzJzoKCQkJCQlyZXR1cm4gb3B0aW9ucy52YWx1ZSB8fCBvcHRpb25zLm1pbiB8fCAwOwoJCQkJY2FzZSAnc3RyaW5nJzoKCQkJCWNhc2UgJ3RleHQnOgoJCQkJY2FzZSAnZGF0ZXRpbWUnOgoJCQkJY2FzZSAnbGFiZWwnOgoJCQkJCXJldHVybiBvcHRpb25zLnZhbHVlIHx8ICIiOwoJCQkJZGVmYXVsdDoKCQkJCQlyZXR1cm4gb3B0aW9ucy52YWx1ZTsKCQkJfQoJCX0KCX0KCglpbnQob3B0aW9ucykgewoJCWxldCByZXQgPSBgPGlucHV0IGlkPSJudWQke29wdGlvbnMubmFtZX0iIGNsYXNzPSJlYXN5dWktJHt0aGlzLnVpVHlwZXNbb3B0aW9ucy50eXBlXX0iIHJlcXVpcmVkPSIke29wdGlvbnMucmVxdWlyZWQgPyAndHJ1ZScgOiAnZmFsc2UnfSIgdmFsdWU9IiR7dGhpcy52YWx1ZShvcHRpb25zKX0iIGRhdGEtb3B0aW9ucz0ibWluOiR7b3B0aW9ucy5taW4gfHwgMH0sbWF4OiR7b3B0aW9ucy5tYXggfHwgMTAwfSxpbmNyZW1lbnQ6JHtvcHRpb25zLmluY3JlbWVudCB8fCAxfSIgc3R5bGU9IndpZHRoOiR7dGhpcy5jV2lkdGgob3B0aW9ucyl9cHg7Ij48L2lucHV0PmA7CgkJLy9jb25zb2xlLmxvZyhyZXQpOwoJCXJldHVybiByZXQ7Cgl9CgoJbWVudShvcHRpb25zKSB7CgkJdmFyIHJldCA9ICIiOwoJCXJldCArPSAnPGRpdiBjbGFzcz0iZWFzeXVpLXBhbmVsIiBpZD0ibW51JyArIG9wdGlvbnMubmFtZSArICciIHN0eWxlPSJwYWRkaW5nOjVweDsiPlxuJzsKCQkkLmVhY2gob3B0aW9ucy5tZW51LCAoXywgbSkgPT4gcmV0ICs9IGA8YSBocmVmPSIjIiBjbGFzcz0iZWFzeXVpLSR7dGhpcy51aVR5cGVzW29wdGlvbnMudHlwZSB8fCAnbWVudSddfSIgZGF0YS1vcHRpb25zPSJtZW51OicjbW0ke20ubGFiZWwucmVwbGFjZSgvIC9nLCAnJyl9JyxpY29uQ2xzOidpY29uLSR7bS5pY29uIHx8ICdub25lJ30nIj4ke20ubGFiZWx9PC9hPlxuYCk7CgkJcmV0ICs9ICI8L2Rpdj5cbiI7CgkJbGV0IGR2ID0gbSA9PiB7CgkJCWxldCByZXQgPSAnPGRpdicgKyAobS5zdWJNZW51cyA/ICcnIDogYCBkYXRhLW9wdGlvbnM9Imljb25DbHM6J2ljb24tJHttLmljb24gfHwgJ25vbmUnfSciYCkgKyAnPlxuJzsKCQkJcmV0ICs9IG0uc3ViTWVudXMgPyAnPHNwYW4+JyArIChtLmxhYmVsIHx8IHRoaXMuZW5nbGlzaChtLmNvZGUpKSArICc8L3NwYW4+XG48ZGl2PicgOiAoYDxzcGFuIHdpZHRoPScxMDAlJyBvbmNsaWNrPScoYXN5bmMgKCkgPT4ge2xldCBtID0gJHtfRnJFTUQuX3RvSlMobSl9OyBpZihtLmFjdGlvbil7cmV0dXJuIGF3YWl0IG0uYWN0aW9uKERGb3JtLmdldCgpLCBtKTt9IGlmIChtLnN1Yk1lbnVzKSByZXR1cm47IGF3YWl0IF9GckVNRC5SZW5kZXJQYWdlKHtfY29kZTogbS5jb2RlIHx8IG0ubGFiZWwucmVwbGFjZSgvIC9nLCAiIikudG9Mb3dlckNhc2UoKX0sIG0uZGF0YSk7fSkoKSc+JHttLmxhYmVsIHx8IHRoaXMuZW5nbGlzaChtLmNvZGUpfTwvc3Bhbj5gKTsKCQkJJC5lYWNoKG0uc3ViTWVudXMsIChfLCBzKSA9PiByZXQgKz0gZHYocykpOwoJCQlyZXQgKz0gKG0uc3ViTWVudXMgPyAiPC9kaXY+XG4iIDogIiIpICsgYDwvZGl2PlxuYDsKCQkJcmV0dXJuIHJldDsKCQl9OwoJCWZvciAodmFyIGkgPSAwOyBpIDwgb3B0aW9ucy5tZW51Lmxlbmd0aDsgaSsrKSB7CgkJCXZhciBtID0gb3B0aW9ucy5tZW51W2ldOwoJCQlyZXQgKz0gJzxkaXYgaWQ9Im1tJyArIG0ubGFiZWwucmVwbGFjZSgvIC9nLCAnJykgKyAnIiBzdHlsZT0id2lkdGg6MTUwcHg7Ij4nOwoJCQlmb3IgKHZhciBqID0gMDsgaiA8IG0uc3ViTWVudXMubGVuZ3RoOyBqKyspIHsKCQkJCXZhciBzbSA9IG0uc3ViTWVudXNbal07CgkJCQlyZXQgKz0gZHYoc20pOwoJCQl9CgkJCXJldCArPSAnPC9kaXY+XG4nOwoJCX0KCQlyZXR1cm4gcmV0OwoJfQoKCWludGVnZXIob3B0aW9ucykgewoJCXJldHVybiB0aGlzLmludChvcHRpb25zKTsKCX0KCgludW1iZXIob3B0aW9ucykgewoJCXJldHVybiB0aGlzLmludChvcHRpb25zKTsKCX0KCglJbnRlZ2VyKG9wdGlvbnMpIHsKCQlyZXR1cm4gdGhpcy5pbnQob3B0aW9ucyk7Cgl9CgoJYm9vbChvcHRpb25zKSB7CgkJcmV0dXJuIGA8aW5wdXQgaWQ9IiR7dGhpcy5wcmVmaXgob3B0aW9ucyl9JHtvcHRpb25zLm5hbWV9IiBkYXRhLWRmb3JtPSJlbGVtZW50OiR7b3B0aW9ucy5uYW1lfSIgcmVxdWlyZWQ9IiR7b3B0aW9ucy5yZXF1aXJlZD8ndHJ1ZSc6J2ZhbHNlJ30iIGRhdGEtb3B0aW9ucz0nZGlzYWJsZWQ6JHtvcHRpb25zLmRpc2FibGVkPyd0cnVlJzonZmFsc2UnfSwke3RoaXMuZXZlbnRIYW5kbGVycyhvcHRpb25zKX0nIGNsYXNzPSJlYXN5dWktJHt0aGlzLnVpVHlwZXNbb3B0aW9ucy50eXBlXX0iICR7b3B0aW9ucy5jaGVja2VkPydjaGVja2VkJzonJ30gLz5gOwoJfQoKCWxhYmVsKG9wdGlvbnMpIHsKCQlyZXR1cm4gYDxzcGFuIGlkPSIke3RoaXMucHJlZml4KG9wdGlvbnMpfSR7b3B0aW9ucy5uYW1lfSIgc3R5bGU9IndpZHRoOiR7dGhpcy5jV2lkdGgob3B0aW9ucyl9cHgiIGRhdGEtb3B0aW9ucz0iZGlzYWJsZWQ6JHtvcHRpb25zLmRpc2FibGVkPyd0cnVlJzonZmFsc2UnfSI+JHt0aGlzLnZhbHVlKG9wdGlvbnMpfTwvc3Bhbj5gOwoJfQoKCXVybChvcHRpb25zKSB7CgkJcmV0dXJuIHRoaXMuc3RyaW5nKG9wdGlvbnMpLnJlcGxhY2UoIkZpZWxkQ2hhbmdlIiwgIlVSTENoYW5nZSIpOwoJfQoKCXRleHQob3B0aW9ucykgewoJCXJldHVybiBgPGlucHV0IGlkPSIke3RoaXMucHJlZml4KG9wdGlvbnMpfSR7b3B0aW9ucy5uYW1lfSIgY2xhc3M9ImVhc3l1aS0ke29wdGlvbnMuZWRpdG9yIHx8IHRoaXMudWlUeXBlc1tvcHRpb25zLnR5cGVdfSIgZGF0YS1vcHRpb25zPSdkaXNhYmxlZDoke29wdGlvbnMuZGlzYWJsZWQ/J3RydWUnOidmYWxzZSd9LCR7dGhpcy5ldmVudEhhbmRsZXJzKG9wdGlvbnMpfScgbXVsdGlsaW5lPSIke29wdGlvbnMuc2ltcGxlID8gJ2ZhbHNlJyA6ICd0cnVlJ30iIHN0eWxlPSJ3aGl0ZS1zcGFjZTpwcmUtd3JhcDt3aWR0aDoke3RoaXMuY1dpZHRoKG9wdGlvbnMpfXB4O2hlaWdodDoke3RoaXMuY0hlaWdodChvcHRpb25zKX1weCIgcmVxdWlyZWQ9IiR7b3B0aW9ucy5yZXF1aXJlZCA/ICd0cnVlJyA6ICdmYWxzZSd9IiB2YWx1ZT0iJHt0aGlzLnZhbHVlKG9wdGlvbnMpfSIgLz5gOwoJfQoKCXBhc3N3b3JkKG9wdGlvbnMpIHsKCQl2YXIgcmV0ID0gdGhpcy5zdHJpbmcob3B0aW9ucyk7CgkJcmV0ID0gcmV0LnJlcGxhY2UoJzxpbnB1dCAnLCAnPGlucHV0IHR5cGU9InBhc3N3b3JkIiAnKTsKCQlyZXR1cm4gcmV0OwoJfQoKCWZpbGUob3B0aW9ucykgewoJCXJldHVybiBgPGlucHV0IGlkPSIke3RoaXMucHJlZml4KG9wdGlvbnMpfSR7b3B0aW9ucy5uYW1lfSIgY2xhc3M9ImVhc3l1aS0ke3RoaXMudWlUeXBlc1tvcHRpb25zLnR5cGVdfSIgZGF0YS1vcHRpb25zPSJvbkNoYW5nZTpmdW5jdGlvbihuLG8pe3ZhciBzID0gJCgnIycgKyB0aGlzLmlkKS5maWxlYm94KCdvcHRpb25zJyk7IHRoaXMuVXBsb2FkRmlsZShzLCB0aGlzLmJ5TmFtZSgnJHtvcHRpb25zLm5hbWV9JykpO30iIHN0eWxlPSJ3aWR0aDoke3RoaXMuY1dpZHRoKG9wdGlvbnMpfXB4Ij5gOwoJfQoKCWltYWdlKG9wdGlvbnMpIHsKCQlyZXR1cm4gdGhpcy5maWxlKG9wdGlvbnMpICsgYDxkaXYgaWQ9ImRsZyR7b3B0aW9ucy5uYW1lfSIgY2xhc3M9ImVhc3l1aS0ke3RoaXMudWlUeXBlc1tvcHRpb25zLnR5cGVdfSIgdGl0bGU9IkltYWdlIFByZXZpZXciIGRhdGEtb3B0aW9ucz0iY2xvc2VkOnRydWUsaWNvbkNsczonaWNvbi1zYXZlJyxyZXNpemFibGU6ZmFsc2UsbW9kYWw6dHJ1ZSIgc3R5bGU9IndpZHRoOjQwMHB4O2hlaWdodDoyMDBweDtwYWRkaW5nOjEwcHgiPjxpbWcgaWQ9IiR7dGhpcy5wcmVmaXgob3B0aW9ucyl9JHtvcHRpb25zLm5hbWV9IiB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIi8+PC9kaXY+YDsKCX0KCglwcm9ncmVzcyhvcHRpb25zKSB7CgkJaWYgKCFvcHRpb25zLmhlaWdodCkgb3B0aW9ucy5oZWlnaHQgPSAyMDsgLy8gZml4IGJpZyBwcm9ncmVzcwoJCXJldHVybiBgPGRpdiBpZD0iJHt0aGlzLnByZWZpeChvcHRpb25zKX0ke29wdGlvbnMubmFtZX0iIGNsYXNzPSJlYXN5dWktJHt0aGlzLnVpVHlwZXNbb3B0aW9ucy50eXBlXX0iIGRhdGEtb3B0aW9ucz0idmFsdWU6JHt0aGlzLnZhbHVlKG9wdGlvbnMpfSIgc3R5bGU9IndpZHRoOiR7dGhpcy5jV2lkdGgob3B0aW9ucyl9cHg7aGVpZ2h0OiR7dGhpcy5jSGVpZ2h0KG9wdGlvbnMpfXB4Ij48L2Rpdj5gOwoJfQoKCWZsb3djaGFydChvcHRpb25zKSB7CgkJcmV0dXJuIGA8ZGl2IGlkPSJmbHcke29wdGlvbnMubmFtZX0iIHdpZHRoPSIke3RoaXMuY1dpZHRoKG9wdGlvbnMpfSIgaGVpZ2h0PSIke3RoaXMuY0hlaWdodChvcHRpb25zKX0iPjwvZGl2PmA7Cgl9CgoJY2hhcnQob3B0aW9ucykgewoJCXJldHVybiBgPGRpdiBpZD0iY2h0JHtvcHRpb25zLm5hbWV9IiB3aWR0aD0iJHt0aGlzLmNXaWR0aChvcHRpb25zKX0iIGhlaWdodD0iJHt0aGlzLmNIZWlnaHQob3B0aW9ucyl9Ij48L2Rpdj5gOwoJfQoKCWZvcm1hdHRlcihuYW1lLCBjLCBqc29uKSB7CgkJanNvbiA9IGpzb24gPyAnIicgOiAnJzsKCQlyZXR1cm4gYCR7anNvbn0odmFsdWUsIHJvdywgaW5kZXgpID0+IHt0cnl7dmFyIGMgPSAoREZvcm0uYnlOYW1lKFxgJHtuYW1lfVxgKS5jb2x1bW5zIHx8IFtdKS5maW5kKGMgPT4gYy5maWVsZD09XGAke2MuZmllbGR9XGApOyByZXR1cm4gYyYmYy5mb3JtYXQ/Yy5mb3JtYXQodmFsdWUscm93LGluZGV4KTp2YWx1ZTt9Y2F0Y2goZXgpe3JldHVybiB2YWx1ZTt9IH0ke2pzb259YDsKCX0KCgltYXBDb2x1bW5zKG9wdGlvbnMsIGpzb24pIHsKCQlsZXQgY1RpdGxlID0gYyA9PiBjLnRpdGxlIHx8IHRoaXMuZW5nbGlzaChjLmZpZWxkKTsKCgkJdmFyIGNvbHMgPSAkLmdyZXAob3B0aW9ucy5jb2x1bW5zIHx8IFtdLCBjID0+ICFjLmlnbm9yZSk7CgkJbGV0IHJldCA9ICIiOwoJCWlmIChvcHRpb25zLm11bHRpcGxlKSByZXQgKz0gYHsiZmllbGQiOidjaycsImNoZWNrYm94Ijp0cnVlfSxgOwoJCXJldCA9IGAiZnJvemVuQ29sdW1ucyI6IFtbYDsKCQlpZiAoIW9wdGlvbnMuZnJvemVuKSB7CgkJCXJldCArPSBgeyJmaWVsZCI6IiR7b3B0aW9ucy5pZEZpZWxkLmZpZWxkfSIsInRpdGxlIjogIiR7b3B0aW9ucy5pZEZpZWxkLnRpdGxlfSIsInNvcnRhYmxlIjogInRydWUiLCAiZm9ybWF0dGVyIjogJHt0aGlzLmZvcm1hdHRlcihvcHRpb25zLm5hbWUsIG9wdGlvbnMuaWRGaWVsZCwganNvbil9fSxgOwoJCQlpZiAob3B0aW9ucy50ZXh0RmllbGQuZmllbGQgIT0gb3B0aW9ucy5pZEZpZWxkLmZpZWxkKSByZXQgKz0gYHsiZmllbGQiOiIke29wdGlvbnMudGV4dEZpZWxkLmZpZWxkIHx8IG9wdGlvbnMudGV4dEZpZWxkLnRpdGxlfSIsInRpdGxlIjoiJHtvcHRpb25zLnRleHRGaWVsZC50aXRsZSB8fCBvcHRpb25zLnRleHRGaWVsZC5maWVsZH0iLCJ3aWR0aCI6IiR7b3B0aW9ucy50ZXh0RmllbGQud2lkdGh8fDEyMH0iLCAic29ydGFibGUiOiAidHJ1ZSIsICJmb3JtYXR0ZXIiOiAke3RoaXMuZm9ybWF0dGVyKG9wdGlvbnMubmFtZSwgb3B0aW9ucy50ZXh0RmllbGQsIGpzb24pfX1gOwoJCX0gZWxzZSB7CgkJCSQubWFwKCQuZ3JlcChjb2xzLCBjID0+IGMuZnJvemVuKSwgYyA9PiBgeyJmaWVsZCI6IiR7Yy5maWVsZCB8fCBjVGl0bGUoYyl9IiwidGl0bGUiOiIke2NUaXRsZShjKSB8fCBjLmZpZWxkfSIsIndpZHRoIjoiJHtjLndpZHRofHwxMjB9IiwiYWxpZ24iOidsZWZ0Jywic29ydGFibGUiOiJ0cnVlIiwgImZvcm1hdHRlciI6ICR7dGhpcy5mb3JtYXR0ZXIob3B0aW9ucy5uYW1lLCBjLCBqc29uKX19YCkuam9pbigiLCIpOwoJCX0KCQlyZXQgKz0gYF1dLCAiY29sdW1ucyI6IFtbYDsKCQlyZXQgKz0gJC5tYXAoJC5ncmVwKGNvbHMsIGMgPT4gIWMuZnJvemVuKSwgYyA9PiBgeyJmaWVsZCI6IiR7Yy5maWVsZCB8fCBjVGl0bGUoYyl9IiwidGl0bGUiOiIke2NUaXRsZShjKSB8fCBjLmZpZWxkfSIsImFsaWduIjoibGVmdCIsInNvcnRhYmxlIjoidHJ1ZSIsICJmb3JtYXR0ZXIiOiAke3RoaXMuZm9ybWF0dGVyKG9wdGlvbnMubmFtZSwgYywganNvbil9fWApLmpvaW4oIiwiKTsKCQlyZXQgKz0gJ11dJzsKCQlyZXR1cm4gcmV0OwoJfQoKCXNlbGVjdChvcHRpb25zLCB0YWcgPSBvcHRpb25zLnRhZywgdHlwZSkgewoJCXJldHVybiB0aGlzLmNvbWJvKG9wdGlvbnMsIHRhZywgdHlwZSk7Cgl9CgoJdHJlZShvcHRpb25zKSB7CgkJcmV0dXJuIHRoaXMuc2VsZWN0KG9wdGlvbnMsICJzZWxlY3QiKTsKCX0KCgluYXZpZ2F0aW9uKG9wdGlvbnMpIHsKCQlyZXR1cm4gdGhpcy5jb21ibyhvcHRpb25zLCAndWwnLCAndHJlZScpOwoJfQoKCWNvbWJvKG9wdGlvbnMsIHRhZywgdHlwZSkgewoJCXZhciBjb2xzID0gJC5ncmVwKG9wdGlvbnMuY29sdW1ucyB8fCBbXSwgYyA9PiAhYy5pZ25vcmUpOwoJCXRhZyA9IHRhZyB8fCAic2VsZWN0IjsKCgkJb3B0aW9ucy5pZEZpZWxkID0gJC51bmlxdWVTb3J0KFt7CgkJCWZpZWxkOiBvcHRpb25zLmlkRmllbGQsCgkJCXRpdGxlOiBvcHRpb25zLmlkRmllbGQKCQl9XS5jb25jYXQoJC5ncmVwKGNvbHMsIGMgPT4gYy5wcmltYXJ5KSwgW3sKCQkJZmllbGQ6ICdJZCcsCgkJCXRpdGxlOiAnSUQnCgkJfV0pKS5maW5kKHggPT4gdHlwZW9mKHguZmllbGQpICE9PSAidW5kZWZpbmVkIik7CgoJCW9wdGlvbnMudGV4dEZpZWxkID0gJC51bmlxdWVTb3J0KFt7CgkJCWZpZWxkOiBvcHRpb25zLnRleHRGaWVsZCwKCQkJdGl0bGU6IG9wdGlvbnMudGV4dEZpZWxkCgkJfV0uY29uY2F0KCQuZ3JlcChjb2xzLCBjID0+IGMuZGlzcGxheSksIFt7CgkJCWZpZWxkOiAnX1RvU3RyaW5nJywKCQkJdGl0bGU6IG9wdGlvbnMubmFtZSwKCQl9XSkpLmZpbmQoeCA9PiB0eXBlb2YoeC5maWVsZCkgIT09ICJ1bmRlZmluZWQiKTsKCgkJdmFyIGZ1biA9IHR5cGUgfHwgdGhpcy5lRnVuKG9wdGlvbnMpOwoKCQl2YXIgZHJvcGRvd24gPSBbJ2NvbWJvdHJlZWdyaWQnLCAnY29tYm90cmVlJywgJ2NvbWJvZ3JpZCcsICdzZWxlY3QnXS5pbmRleE9mKGZ1bikgPiAtMTsKCQlpZiAoZHJvcGRvd24pIHRoaXMuc2VsZWN0cy5wdXNoKHsKCQkJaWQ6ICJjbWIiICsgb3B0aW9ucy5uYW1lLAoJCQlvcHRpb25zOiB0aGlzLmJ5TmFtZShvcHRpb25zLm5hbWUpCgkJfSk7CgkJdGhpcy5zZWxlY3RzID0gJC51bmlxdWVTb3J0KHRoaXMuc2VsZWN0cyk7CgkJdmFyIHJldCA9IGA8JHt0YWd9IGlkPSJjbWIke29wdGlvbnMubmFtZX0iIGNsYXNzPSJlYXN5dWktJHtmdW59IiBzdHlsZT0ibWF4LXdpZHRoOiR7ZHJvcGRvd24/JzQwMHB4Jzp0aGlzLmNXaWR0aChvcHRpb25zKX07IHdpZHRoOiR7dGhpcy5jV2lkdGgob3B0aW9ucyl9cHgiIHJlcXVpcmVkPSIkeyhvcHRpb25zLnJlcXVpcmVkID8gJ3RydWUnIDogJ2ZhbHNlJyl9IiBkYXRhLW9wdGlvbnM9J2Rpc2FibGVkOiR7b3B0aW9ucy5kaXNhYmxlZD8ndHJ1ZSc6J2ZhbHNlJ30sJHt0aGlzLmV2ZW50SGFuZGxlcnMob3B0aW9ucyl9LCB2YWx1ZToiJHt0aGlzLnZhbHVlKG9wdGlvbnMpfSIsIHJvd251bWJlcnM6JHt0eXBlb2Yob3B0aW9ucy5yb3dOdW1iZXJzKSE9PSd1bmRlZmluZWQnP29wdGlvbnMucm93TnVtYmVyczooZnVuLmluZGV4T2YoJ3RyZWUnKTwtMT8nZmFsc2UnOid0cnVlJyl9LCBwYWdpbmF0aW9uOiR7dHlwZW9mKG9wdGlvbnMucGFnaW5hdGlvbikhPT0ndW5kZWZpbmVkJz9vcHRpb25zLnBhZ2luYXRpb246KGZ1bi5pbmRleE9mKCd0cmVlJyk8LTE/J2ZhbHNlJzondHJ1ZScpfSwgcGFuZWxXaWR0aDokezIqdGhpcy5jV2lkdGgob3B0aW9ucyl9LCBmaXRDb2x1bW5zOiB0cnVlLCBzaW5nbGVTZWxlY3Q6IHRydWUsIG11bHRpcGxlOiR7KG9wdGlvbnMubXVsdGlwbGUgfHwgJ2ZhbHNlJyl9LCBpZEZpZWxkOiAiJHtvcHRpb25zLmlkRmllbGQuZmllbGR9IiwgZW5hYmxlRmlsdGVyOiAke29wdGlvbnMuZmlsdGVyPyd0cnVlJzonZmFsc2UnfSwgbm93cmFwOiBmYWxzZSwgdGV4dEZpZWxkOiAiJHtvcHRpb25zLnRleHRGaWVsZC5maWVsZH0iLCB0cmVlRmllbGQ6ICIke29wdGlvbnMudGV4dEZpZWxkLmZpZWxkfSIsYDsKCQlpZiAoZnVuLmluZGV4T2YoJ3RyZWUnKSA9PSAtMSkgewoJCQlyZXQgKz0gJ2ZpdENvbHVtbnM6IGZhbHNlLCcgKyB0aGlzLm1hcENvbHVtbnMob3B0aW9ucyk7CgkJfQoJCWlmIChvcHRpb25zLmRhdGEpIHsKCQkJcmV0ICs9IGAsZGF0YTogJHtKU09OLnN0cmluZ2lmeShvcHRpb25zLmRhdGEpfWA7CgkJfQoJCXJldCArPSBgJz5gOwoJCWlmIChvcHRpb25zLm9wdGlvbnMpIHsKCQkJcmV0ICs9ICQubWFwKG9wdGlvbnMub3B0aW9ucywgbyA9PiBgPG9wdGlvbiB2YWx1ZT0nJHtfRnJFTUQuX3RvSlMobyl9Jz4ke28ubmFtZSB8fCBvfTwvb3B0aW9uPmApLmpvaW4oJ1xuJyk7CgkJfQoJCXJldCArPSBgPC8ke3RhZ30+YDsKCQkvLyBjb25zb2xlLmxvZyhyZXQpOwoJCXJldHVybiByZXQ7Cgl9CgoJZ3JpZChvcHRpb25zLCB0YWcsIHR5cGUpIHsKCQlyZXR1cm4gdGhpcy5jb21ibyhvcHRpb25zLCAidGFibGUiLCAiZGF0YWdyaWQiKTsKCX0KCgl0cmVlZ3JpZChvcHRpb25zKSB7CgkJcmV0dXJuIHRoaXMuY29tYm8ob3B0aW9ucywgJ3RhYmxlJywgJ3RyZWUnKTsKCX0KCglhc3luYyBkb0xpbmsoZSwgZXZlbnQpIHsKCQl0aGlzLmJ1c3kodHJ1ZSk7CgkJdHJ5IHsKCQkJYXdhaXQgZS5saW5rcy5maW5kKGwgPT4gbC5sYWJlbCA9PSBldmVudC50YXJnZXQuaW5uZXJUZXh0KS5vbkNsaWNrKHRoaXMuZ2V0KCkpOwoJCX0gY2F0Y2ggKGV4KSB7CgkJCWNvbnNvbGUubG9nKCJEeW5hRm9ybTo6ZG9MaW5rKCk6IEV4Y2VwdGlvbjogIiArIGV4KTsKCQl9CgkJdGhpcy5idXN5KGZhbHNlKTsKCX0KCglFZGl0ZWRWYWx1ZShlKSB7CgkJcmV0dXJuICh0eXBlb2YoYWNlKSAhPT0gInVuZGVmaW5lZCIpID8gYWNlLmVkaXQoJ3BubCcgKyBlLm5hbWUpLnNlc3Npb24uZ2V0VmFsdWUoKSA6ICcnOwoJfQoKCWFzeW5jIFBhbk9uQ2xvc2UoZSkgewoJCWlmIChlLmVkaXRvcikgewoJCQllLnZhbHVlID0gdGhpcy5FZGl0ZWRWYWx1ZShlKTsKCQl9CgkJaWYgKGUuY2xvc2UpIHsKCQkJYXdhaXQgZS5jbG9zZSh0aGlzLmdldCgpKTsKCQl9Cgl9CgoJYXN5bmMgUGVuZEFmdGVyT3BlbihlKSB7CgkJaWYgKGUuZWRpdG9yICYmIHR5cGVvZihhY2UpICE9PSAidW5kZWZpbmVkIikgewoJCQlhd2FpdCBfRnJFTUQuT3BlbkVkaXRvcigncG5sJyArIGUubmFtZSAvKisgJy1jZW50ZXInKi8gLCBlLmxhbmd1YWdlLCBlLmxvYWRlciB8fCAobyA9PiBlLnZhbHVlKSwgZS5zYXZlciwgdGhpcy5nZXQoKSwgZSk7CgkJfQoJCWlmIChlLm9wZW4pIHsKCQkJYXdhaXQgZS5vcGVuKHRoaXMuZ2V0KCkpOwoJCX0KCX0KCglsaW5rKG9wdGlvbnMpIHsKCQlyZXR1cm4gKG9wdGlvbnMubGlua3MgfHwgW10pLmZpbHRlcihsID0+ICFsLmlnbm9yZSkubWFwKGwgPT4gYDxhIGhyZWY9IiMiIGNsYXNzPSJlYXN5dWktJHt0aGlzLnVpVHlwZXNbb3B0aW9ucy50eXBlXX0iIGRhdGEtb3B0aW9ucz0nJHt0aGlzLmV2ZW50SGFuZGxlcnMob3B0aW9ucyl9LCBpY29uQ2xzOiJpY29uLSR7bC5pY29uIHx8ICdvayd9Iic+JHtsLmxhYmVsfTwvYT5gKS5qb2luKCdcbicpOwoJfQoKCWFzeW5jIFNldFRyZWVEYXRhKGUsIG4sIGRhdGEpIHsKCQkkLmVhY2goJCgiI2NtYiIgKyBlLm5hbWUpW3RoaXMuZUZ1bihlKV0oJ3RyZWUnKS50cmVlKCJnZXRDaGlsZHJlbiIsIG4udGFyZ2V0KSwgKF8sIGMpID0+ICQoIiNjbWIiICsgZS5uYW1lKVt0aGlzLmVGdW4oZSldKCd0cmVlJykudHJlZSgicmVtb3ZlIiwgYy50YXJnZXQpKTsKCQkkKCIjY21iIiArIGUubmFtZSlbdGhpcy5lRnVuKGUpXSgndHJlZScpLnRyZWUoImFwcGVuZCIsIHsKCQkJcGFyZW50OiBuLnRhcmdldCwKCQkJZGF0YTogZGF0YQoJCX0pOwoJCXJldHVybiB0cnVlOwoJfQoKCWFzeW5jIEV4cGFuZChlLCBuKSB7CgkJdGhpcy5TZXRUcmVlRGF0YShlLCBuLCBbewoJCQlpZDogbnVsbCwKCQkJdGV4dDogImxvYWRpbmcuLi4iCgkJfV0pOwoJCXZhciBvYmogPSB7fTsKCQl2YXIgcEZpZWxkID0gZS5wYXJlbnRGaWVsZCB8fCAkLm1hcCgkLmdyZXAoZS5jb2x1bW5zIHx8IFtdLCBjID0+IGMucGFyZW50KSwgYyA9PiBjLmZpZWxkKS5jb25jYXQoW251bGxdKVswXTsKCQl2YXIgaWRGaWVsZCA9ICQuZ3JlcChlLmNvbHVtbnMgfHwgW10sIGMgPT4gYy5wcmltYXJ5KS5jb25jYXQoZS5pZEZpZWxkKVswXS5maWVsZDsKCQlpZiAocEZpZWxkKSB7CgkJCW9ialtwRmllbGRdID0gewoJCQkJX3NvdXJjZTogbi5fc291cmNlCgkJCX07CgkJCWlmIChpZEZpZWxkKSB7CgkJCQlvYmpbcEZpZWxkXVtpZEZpZWxkXSA9IG4uaWQ7CgkJCX0gZWxzZSB7CgkJCQlvYmpbcEZpZWxkXSA9IG4uaWQ7CgkJCX0KCQl9CgkJbGV0IGRhdGEgPSBhd2FpdCB0aGlzLl9sb2FkRGF0YSh7CgkJCWlkOiAiY21iIiArIGUubmFtZSwKCQkJb3B0aW9uczogZQoJCX0sIG9iaik7CgkJdGhpcy5TZXRUcmVlRGF0YShlLCBuLCBkYXRhKTsKCX0KCglhc3luYyBfbG9hZERhdGEocywgbywgc3RhcnQsIGVuZCkgewoJCXZhciBuYW1lID0gKHMgJiYgcy5vcHRpb25zID8gKHMub3B0aW9ucy5DbGFzcyA/IHMub3B0aW9ucy5DbGFzcy5OYW1lLnJlcGxhY2UoJyAnLCAnXycpIDogKHMub3B0aW9ucy50YWJsZSB8fCBzLm9wdGlvbnMubmFtZSkpIDogcy5uYW1lKTsKCQluYW1lID0gbmFtZS50cmltKCk7IC8vLnNwbGl0KCcuJykuc2xpY2UoLTEpWzBdOwoKCQlsZXQgb1Njb3BlID0gKHR5cGVvZihjb21wYW55KSAhPT0gJ3VuZGVmaW5lZCcgJiYgY29tcGFueS5TY29wZSkgPyB3aW5kb3dbY29tcGFueS5TY29wZV0gOiB3aW5kb3c7CgkJbyA9IG8gfHwgKChvU2NvcGUgJiYgb1Njb3BlW25hbWVdKSA/IG5ldyBvU2NvcGVbbmFtZV0oKSA6IHsKCQkJQWN0aXZlOiB0cnVlLAoJCX0pOwoKCQlvID0gKHR5cGVvZiBmaWx0ZXJzICE9PSAidW5kZWZpbmVkIiAmJiBmaWx0ZXJzICYmIGZpbHRlcnNbbmFtZV0pID8gZmlsdGVyc1tuYW1lXShvKSA6IG87CgkJdmFyIGZ1biA9IHRoaXMuZUZ1bihzLm9wdGlvbnMpOwoJCWxldCBzVGV4dCA9ICQoIiMiICsgcy5pZClbZnVuXSgnZ2V0VGV4dCcpOwoKCQlvID0gKHMgJiYgcy5vcHRpb25zICYmIHMub3B0aW9ucy5zb3VyY2UpID8gcy5vcHRpb25zLnNvdXJjZShvLCB0aGlzLmdldCgpLCBzVGV4dCkgOiBvOwoJCWxldCBuYW1lcyA9ICQudW5pcXVlU29ydChbcy5vcHRpb25zLnNlYXJjaEZpZWxkXS5jb25jYXQoJC5tYXAoJC5ncmVwKHMub3B0aW9ucy5jb2x1bW5zIHx8IFtdLCBjID0+IGMuc2VhcmNoKSwgYyA9PiBjLmZpZWxkKSwgWyJOYW1lIl0pKS5maWx0ZXIodiA9PiB2KTsKCQlpZiAoIW9bbmFtZXNbMF1dKSBvW25hbWVzWzBdXSA9IHNUZXh0OwoJCWNvbnNvbGUubG9nKCJEeW5hRm9ybTo6X2xvYWREYXRhKCk6IG8iLCBvKTsKCQl2YXIgZGF0YSA9IG51bGw7CgoJCWxldCBsaWIgPSAnJzsKCQlpZiAobmFtZS5pbmRleE9mKCcuJykgPiAwKSB7CgkJCWxpYiA9IG5hbWUuc3BsaXQoJy4nKVswXSArICcuJzsKCQkJbmFtZSA9IG5hbWUuc3BsaXQoJy4nKVsxXTsKCQl9CgoJCWlmIChzLm9wdGlvbnMubG9hZGVyKSB7CgkJCWRhdGEgPSBhd2FpdCBzLm9wdGlvbnMubG9hZGVyKHRoaXMuZ2V0KCksIHMub3B0aW9ucywgbywgc1RleHQpOwoJCX0gZWxzZSBpZiAobyAmJiB0eXBlb2Yoby5maW5kQWxsKSA9PT0gJ2Z1bmN0aW9uJykgewoJCQlkYXRhID0gYXdhaXQgby5maW5kQWxsKCk7CgkJfSBlbHNlIGlmICh0eXBlb2YoY29tcGFueSkgIT09ICd1bmRlZmluZWQnICYmIGNvbXBhbnkubGlicmFyeSAmJiBjb21wYW55LkNvZGUgJiYgd2luZG93LmJMb2NhbCkgewoJCQkvL2NvbnNvbGUubG9nKCJERm9ybTo6X2xvYWREYXRhKCk6IHNyKCkuXygiICsgbGliICsgY29tcGFueS5Db2RlLnRvTG93ZXJDYXNlKCkgKyBuYW1lICsgIkZpbmRhbGwiICsgIikiLCBvKTsKCQkJZGF0YSA9IGF3YWl0IHRoaXMuc3IoKS5fKGxpYiArIGNvbXBhbnkuQ29kZS50b0xvd2VyQ2FzZSgpICsgbmFtZSArICJGaW5kYWxsIiwgbnVsbCwgbywgbnVsbCwgc3RhcnQsIGVuZCk7CgkJfSBlbHNlIGlmIChfRnJFTUQuYXBpU2VydmVyKSB7CgkJCW8gPSBPYmplY3QuYXNzaWduKC4uLk9iamVjdC5rZXlzKG8pLm1hcChrID0+ICh7CgkJCQlbU3RyaW5nKGspLmNoYXJBdCgwKS50b0xvd2VyQ2FzZSgpICsgU3RyaW5nKGspLnNsaWNlKDEpXTogb1trXQoJCQl9KSkpOwoJCQljb25zb2xlLmxvZygiREZvcm06Ol9sb2FkRGF0YSgpOiB1c2luZyBfRnJFTUQuYXBpU2VydmVyOiBvIiwgbyk7CgkJCWRhdGEgPSBhd2FpdCBfRnJFTUQuYXBpU2VydmVyLl9uZXcobmFtZSkuX2Zyb21Eb2N1bWVudChvKS5maW5kQWxsKCk7CgkJfQoKCQlpZiAocy5vcHRpb25zLnBvc3Rsb2FkKSB7CgkJCWF3YWl0IHMub3B0aW9ucy5wb3N0bG9hZChkYXRhKTsKCQl9CgkJJC5lYWNoKGRhdGEsIChpLCBkKSA9PiB7CgkJCWQuX19PV05FUiA9IHM7CgkJCSQuZWFjaChzLm9wdGlvbnMuY29sdW1ucywgKF8sIGMpID0+IHsKCQkJCWlmIChjLnZhbHVlKSB7CgkJCQkJZFtjLmZpZWxkXSA9IGMudmFsdWUoZCwgZGF0YSwgaSk7CgkJCQl9CgkJCX0pOwoJCX0pOwoJCWlmICghcy5vcHRpb25zLmNvbHVtbnMgJiYgZnVuLmluZGV4T2YoJ3RyZWUnKSA+IC0xKSB7CgkJCWRhdGEgPSAkLm1hcChkYXRhLCBkID0+IHsKCQkJCWxldCByZXQgPSB7CgkJCQkJaWQ6IGRbcy5vcHRpb25zLmlkRmllbGQuZmllbGRdLAoJCQkJCXRleHQ6IGRbcy5vcHRpb25zLnRleHRGaWVsZC5maWVsZF0sCgkJCQkJc3RhdGU6IGQuc3RhdGUgfHwgKHMub3B0aW9ucy5sb2FkZXIgPyAiZmlsZSIgOiAiY2xvc2VkIiksCgkJCQkJX3NvdXJjZTogZCwKCQkJCX07CgkJCQlyZXQuY2hpbGRyZW4gPSAocmV0LnN0YXRlID09ICJjbG9zZWQiKSA/IFt7CgkJCQkJdGV4dDogJ2xvYWRpbmcuLi4nCgkJCQl9XSA6IG51bGw7CgkJCQlyZXR1cm4gcmV0OwoJCQl9KTsKCQl9CgkJcmV0dXJuIGRhdGEgfHwgW107Cgl9CgoJYXN5bmMgZmlsbERhdGEoZywgbywgc3RhcnQsIGVuZCkgewoJCXZhciBzID0gbnVsbDsKCQlmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuc2VsZWN0cy5sZW5ndGg7IGkrKykgewoJCQlpZiAodGhpcy5zZWxlY3RzW2ldLmlkID09IGdbMF0uaWQpIHMgPSB0aGlzLnNlbGVjdHNbaV07CgkJfQoJCWlmICghcykgcmV0dXJuOwoJCXRoaXMuYnVzeSh0cnVlKTsKCQl0cnkgewoJCQl2YXIgZnVuID0gZ1swXS5jbGFzc0xpc3RbIjAiXS5yZXBsYWNlKCdlYXN5dWktJywgJycpOwoJCQl0cnkgewoJCQkJJCgiIyIgKyBzLmlkKVtmdW5dKCdncmlkJykuZGF0YWdyaWQoJ2dldFBhZ2VyJykucGFnaW5hdGlvbignbG9hZGluZycpOwoJCQl9IGNhdGNoIChleCkge30KCQkJaWYgKHMub3B0aW9ucy5ub2xvYWQpIHsKCQkJCWxldCBfZGF0YSA9IG51bGw7CgkJCQl0cnkgewoJCQkJCV9kYXRhID0gJCgiIyIgKyBzLmlkKVtmdW5dKCdncmlkJykuZGF0YWdyaWQoImdldERhdGEiKTsKCQkJCX0gY2F0Y2ggKGV4KSB7CgkJCQkJX2RhdGEgPSAkKCIjIiArIHMuaWQpW2Z1bl0oJ3RyZWUnKS50cmVlKCdnZXRSb290Jyk7CgkJCQl9CgkJCQlpZiAoX2RhdGEpIHsKCQkJCQlyZXR1cm4gdGhpcy5idXN5KGZhbHNlKTsKCQkJCX0KCQkJfQoJCQl2YXIgZGF0YSA9IGF3YWl0IHRoaXMuX2xvYWREYXRhKHMsIG8sIHN0YXJ0LCBlbmQpOwoJCQl0cnkgewoJCQkJaWYgKCQoIiMiICsgcy5pZClbZnVuXSgnZ3JpZCcpKSAkKCIjIiArIHMuaWQpW2Z1bl0oJ2dyaWQnKS5kYXRhZ3JpZCgnZ2V0UGFnZXInKS5wYWdpbmF0aW9uKCdsb2FkZWQnKTsKCQkJfSBjYXRjaCAoZXgpIHt9CgkJCXRyeSB7CgkJCQkkKCIjIiArIHMuaWQpW2Z1bl0oJ2dyaWQnKS5kYXRhZ3JpZCgnbG9hZERhdGEnLCB7CgkJCQkJdG90YWw6IGRhdGEuQ291bnQgfHwgZGF0YS5sZW5ndGgsCgkJCQkJcm93czogZGF0YSwKCQkJCX0pOwoJCQl9IGNhdGNoIChleCkgewoJCQkJJCgiIyIgKyBzLmlkKVtmdW5dKCd0cmVlJykudHJlZSgnbG9hZERhdGEnLCBkYXRhKTsKCQkJfQoJCX0gY2F0Y2ggKGV4KSB7CgkJCWNvbnNvbGUubG9nKGV4KTsKCQl9CgkJdGhpcy5idXN5KGZhbHNlKTsKCX0KCglldmVudEhhbmRsZXJzKG9wdGlvbnMpIHsKCQlpZiAoIXRoaXMuYnlOYW1lKG9wdGlvbnMubmFtZSkpIHJldHVybjsgLy8gaWYgbm90IGFuIGVsZW1lbnQsIGRvIG5vdCBydW4gdGhlIGhhbmRsZXJzCgoJCXJldHVybiB0aGlzLmV2ZW50cy5maWx0ZXIoZSA9PiBlLnR5cGUgPT0gb3B0aW9ucy50eXBlIHx8IHR5cGVvZihlLnR5cGUpID09PSAndW5kZWZpbmVkJykubWFwKGUgPT4gYCR7ZS5uYW1lfTogKCR7ZS5wYXJhbXMgfHwgJyd9KSA9PiB7dHJ5e0RGb3JtLiR7ZS5oYW5kbGVyfShERm9ybS5ieU5hbWUoIiR7b3B0aW9ucy5uYW1lfSIpIHx8ICR7X0ZyRU1ELl90b0pTKG9wdGlvbnMpfSB8fCB7bmFtZTogIiR7b3B0aW9ucy5uYW1lfSIsdHlwZTogIiR7b3B0aW9ucy50eXBlfSJ9LCAke2UucGFyYW1zfSl9Y2F0Y2goZXgpe2NvbnNvbGUubG9nKCJFdmVudCBFcnJvcjogJHtvcHRpb25zLm5hbWV9LyR7b3B0aW9ucy50eXBlfS8ke2UubmFtZX0iLCBleCk7fX1gKS5qb2luKCcsJyk7Cgl9CgoJYXN5bmMgUGFuZWxPcGVuKGUpIHsKCQlpZiAoZS5lZGl0b3IpIHJldHVybiB0cnVlOwoJCWxldCBjb250ZW50ID0gZS52YWx1ZTsKCQlpZiAoZS5sb2FkZXIpIHsKCQkJY29udGVudCA9IGF3YWl0IGUubG9hZGVyKHRoaXMuZ2V0KCkpOwoJCX0KCQlpZiAoY29udGVudCkgewoJCQl0cnkgewoJCQkJJCgiI3BubCIgKyBlLm5hbWUpLnBhbmVsKCdib2R5JykuaHRtbChjb250ZW50KTsKCQkJCWNvbnNvbGUubG9nKCJwbmwiICsgZS5uYW1lICsgIjogQ29udGVudCBWYWxpZCIpOwoJCQl9IGNhdGNoIChleCkgewoJCQkJLy9jb25zb2xlLmxvZyhleCk7CgkJCX0KCQl9CgkJcmV0dXJuIGNvbnRlbnQ7Cgl9CgoJYXN5bmMgU2VsZWN0Q2hhbmdlKG9wdGlvbnMsIHRhYikgewoJCXRoaXMuYnVzeSh0cnVlKTsKCQkkLmdyZXAodGhpcy5lbGVtZW50cywgZSA9PiBlLnR5cGUgPT0gImdyaWQiICYmIGUuZ3JvdXAgPT0gdGFiKS5mb3JFYWNoKGUgPT4gJCgiI2NtYiIgKyBlLm5hbWUpLmRhdGFncmlkKCkpOwoJCXRoaXMuYnVzeShmYWxzZSk7Cgl9CgoJYXN5bmMgRmllbGRDaGFuZ2Uob3B0aW9ucywgdmFsdWUpIHsKCQl0aGlzLmJ1c3kodHJ1ZSk7CgkJaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5jaGFuZ2UpIHsKCQkJYXdhaXQgb3B0aW9ucy5jaGFuZ2UodGhpcy5nZXQoKSwgdmFsdWUpOwoJCX0KCQl0aGlzLmJ1c3koZmFsc2UpOwoJfQoKCWFzeW5jIFVSTENoYW5nZShzLCBvcHRpb25zKSB7CgkJb3B0aW9ucy5kYXRhID0gYXdhaXQgJC5nZXQocy52YWx1ZSk7CgkJcmV0dXJuIGF3YWl0IHRoaXMuRmllbGRDaGFuZ2Uocywgb3B0aW9ucyk7Cgl9CgoJVXBsb2FkRmlsZShmLCBvcHRpb25zKSB7CgkJdGhpcy5idXN5KHRydWUpOwoJCXZhciBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSgpOwoJCXZhciBmaWxlaWQgPSBNYXRoLnJhbmRvbSgpOwoJCXZhciBtZXRob2QgPSBvcHRpb25zLm1ldGhvZCB8fCAiQ29udGVudE1hbmFnZXIuY21zVXBsb2FkRmlsZSI7CgkJZm9ybURhdGEuYXBwZW5kKCdmaWxlaWQnLCBmaWxlaWQpOwoJCXZhciBmaWxlID0gJCgiIyIgKyBmLmZpbGVib3hJZClbMF0uZmlsZXNbMF07CgkJZm9ybURhdGEuYXBwZW5kKCdfX1VGSUxFJywgZmlsZSk7CgkJaWYgKG9wdGlvbnMubG9jYWwpIHsKCQkJLy8gaGFuZGxpbmcgdGhlIGZpbGUgbG9jYWxseQoJCQl2YXIgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTsKCQkJcmVhZGVyLm9ubG9hZCA9IChlKSA9PiB7CgkJCQl2YXIgZGF0YSA9IGUudGFyZ2V0LnJlc3VsdDsKCQkJCXJldCA9IGRhdGE7CgkJCQl0aGlzLmJ5TmFtZShvcHRpb25zLm5hbWUpLmRhdGEgPSByZXQ7CgkJCQlpZiAob3B0aW9ucyAmJiBvcHRpb25zLnVwbG9hZCkgb3B0aW9ucy51cGxvYWQodGhpcy5nZXQoKSwgcmV0KTsKCQkJfTsKCQkJaWYgKG9wdGlvbnMuYmluYXJ5KSB7CgkJCQlyZWFkZXIucmVhZEFzQmluYXJ5U3RyaW5nKGZpbGUpOwoJCQl9IGVsc2UgaWYgKG9wdGlvbnMuZGF0YXVybCkgewoJCQkJcmVhZGVyLnJlYWRBc0RhdGFVUkwoZmlsZSk7CgkJCX0gZWxzZSB7CgkJCQlyZWFkZXIucmVhZEFzVGV4dChmaWxlKTsKCQkJfQoJCQl0aGlzLmJ1c3koZmFsc2UpOwoJCX0gZWxzZSBpZiAobWV0aG9kKSB7CgkJCSQuYWpheCh7CgkJCQl1cmw6IHRoaXMuc3IoKS5zclVSTCArICImbWV0aG9kPSIgKyBtZXRob2QgKyAiJnNJbnB1dD0iICsgZmlsZWlkICsgIiZwcmVUYWc9JnBvc3RUYWc9IiwKCQkJCWRhdGE6IGZvcm1EYXRhLAoJCQkJLy8gVEhJUyBNVVNUIEJFIERPTkUgRk9SIEZJTEUgVVBMT0FESU5HCgkJCQljYWNoZTogZmFsc2UsCgkJCQljb250ZW50VHlwZTogZmFsc2UsCgkJCQl0eXBlOiAnUE9TVCcsCgkJCQlwcm9jZXNzRGF0YTogZmFsc2UsCgkJCQlzdWNjZXNzOiBkYXRhID0+IHsKCQkJCQl0aGlzLnNyKCkucnVuU2NyaXB0KGRhdGEpOwoJCQkJCXRoaXMuYnlOYW1lKG9wdGlvbnMubmFtZSkuZGF0YSA9IHJldDsKCQkJCQlpZiAob3B0aW9ucyAmJiBvcHRpb25zLnVwbG9hZCkgb3B0aW9ucy51cGxvYWQodGhpcy5nZXQoKSwgcmV0KTsKCQkJCQl0aGlzLmJ1c3koZmFsc2UpOwoJCQkJfQoJCQl9KTsKCQl9Cgl9CgoJZUZ1bihlKSB7CgkJdHJ5IHsKCQkJaWYgKGUudHlwZSA9PSAidHJlZSIpIHsKCQkJCWlmIChlLmNvbHVtbnMpIHsKCQkJCQlyZXR1cm4gImNvbWJvdHJlZWdyaWQiOwoJCQkJfSBlbHNlIGlmICh0eXBlb2YoZS5jb21ibykgIT09ICd1bmRlZmluZWQnICYmICFlLmNvbWJvKSB7CgkJCQkJcmV0dXJuICd0cmVlJzsKCQkJCX0gZWxzZSB7CgkJCQkJcmV0dXJuICJjb21ib3RyZWUiOwoJCQkJfQoJCQl9IGVsc2UgaWYgKGUudHlwZSA9PSAnbmF2aWdhdGlvbicpIHsKCQkJCXJldHVybiAndHJlZSc7CgkJCX0gZWxzZSBpZiAoZS50eXBlID09ICJjb21ib3RyZWUiKSB7CgkJCQlyZXR1cm4gImNvbWJvdHJlZWdyaWQiOwoJCQl9IGVsc2UgaWYgKGUudHlwZSA9PSAic2VsZWN0IiAmJiBlLm9wdGlvbnMpIHsKCQkJCXJldHVybiAiY29tYm9ib3giOwoJCQl9CgkJCXJldHVybiAiY29tYm9ncmlkIjsKCQl9IGNhdGNoIChleCkgewoJCQlyZXR1cm4gImNvbWJvZ3JpZCI7CgkJfQoJfQoKCV9maWxsV2luZG93KHdpbk5hbWUsIHYsIG1hcCkgewoJCXYgPSB2IHx8IHt9OwoJCW1hcCA9IG1hcCB8fCB7fTsKCQlpZiAoQXJyYXkuaXNBcnJheShtYXApKSB7CgkJCW1hcCA9IE9iamVjdC5mcm9tRW50cmllcyhuZXcgTWFwKG1hcCkpOwoJCX0KCgkJbWFwID0gJC5leHRlbmQoe30sIG1hcCwgT2JqZWN0LmZyb21FbnRyaWVzKE9iamVjdC5rZXlzKHYpLm1hcChrID0+IFt3aW5OYW1lICsgaywga10pKSk7CgoJCWxldCBzID0ge307CgkJZm9yICh2YXIgbSBpbiBtYXApIHsKCQkJaWYgKHR5cGVvZih2W21hcFttXV0pID09PSAidW5kZWZpbmVkIikgewoJCQkJLy9jb25zb2xlLmxvZygnaXNfdW5kZWZpbmVkJywgbSwgbWFwW21dLCB2W21hcFttXV0pOwoJCQkJc1ttXSA9IG1hcFttXTsKCQkJfSBlbHNlIHsKCQkJCS8vY29uc29sZS5sb2coJ2lzX25vdF91bmRlZmluZWQnLCBtLCBtYXBbbV0sIHZbbWFwW21dXSk7CgkJCQlzW21dID0gdlttYXBbbV1dOwoJCQl9CgkJfQoJCXRoaXMuY2xlYXIod2luTmFtZSk7CgkJLy9jb25zb2xlLmxvZygicyIsIHMpOwoJCXRoaXMuc2V0KHMpOwoJCSQoIiNwbmxfIiArIHdpbk5hbWUpLndpbmRvdygib3BlbiIpOwoJfQoKCXdpbmRvd1RvRW50aXR5KG8sIGJFbXB0eSwgZ3JpZCwgcHJlZml4LCBmaWx0ZXIpIHsKCQlvID0gbyB8fCB0aGlzLmdldCgpOwoJCWZpbHRlciA9IGZpbHRlciB8fCAodiA9PiB2KTsKCQlsZXQgcmV0ID0gZ3JpZCA/IChncmlkLnNlbGVjdGVkIHx8IGdyaWQpIDogbnVsbDsKCQlpZiAoYkVtcHR5KSB7CgkJCXJldCA9IHt9OwoJCQlvID0ge307CgkJfSBlbHNlIHsKCQkJcmV0ID0gKHJldCAmJiByZXQuSWQpID8gewoJCQkJSWQ6IHJldC5JZAoJCQl9IDoge307CgkJfQoKCQl0aGlzLmVsZW1lbnRzLmZpbHRlcihlID0+IChwcmVmaXggPyBlLmdyb3VwID09IHByZWZpeCA6IHRydWUpICYmIGUudHlwZSAhPSAnbGluaycgJiYgWydfJ10uaW5kZXhPZihlLm5hbWUucmVwbGFjZShwcmVmaXgsICIiKSkgPCAwKS5mb3JFYWNoKGUgPT4gewoJCQlyZXRbZS5uYW1lLnJlcGxhY2UocHJlZml4LCAiIildID0gb1tlLm5hbWVdOwoJCQlyZXR1cm4gdHJ1ZTsKCQl9KTsKCgkJZmlsdGVyKHJldCk7CgoJCXJldHVybiByZXQ7Cgl9CgoJYmluZChvYmopIHsKCQl2YXIgb2JqQmluZCA9IChvLCBlKSA9PiB7CgkJCW9bdGhpcy5lRnVuKGUpXSh7CgkJCQlvblNob3dQYW5lbDogKCkgPT4gewoJCQkJCXRoaXMuZmlsbERhdGEoJCgiIyIgKyBlLmlkKSwgbnVsbCwgMCwgMTApOwoJCQkJfSwKCQkJCW9uQ2xpY2tSb3c6IChpbmRleCwgcm93KSA9PiB7CgkJCQkJdmFyIHMgPSByb3cgPyByb3cuX19PV05FUiA6IG51bGw7CgkJCQkJaWYgKHMgJiYgcy5vcHRpb25zLnNlbGVjdCkgewoJCQkJCQlzLm9wdGlvbnMuc2VsZWN0KHJvdywgdGhpcy5nZXQoKSk7CgkJCQkJfQoJCQkJfQoJCQl9KTsKCQkJdHJ5IHsKCQkJCXZhciBkZyA9IG9bdGhpcy5lRnVuKGUpXSgnZ3JpZCcpOwoJCQkJLy8gZGcuZGF0YWdyaWQoJ2VuYWJsZUZpbHRlcicpCgkJCQl2YXIgc3RhdGUgPSBkZy5kYXRhKCdkYXRhZ3JpZCcpOwoJCQkJdmFyIG9wdHMgPSBzdGF0ZS5vcHRpb25zOwoJCQkJdmFyIG9uQmVmb3JlTG9hZCA9IG9wdHMub25CZWZvcmVMb2FkOwoJCQkJb3B0cy5vbkJlZm9yZUxvYWQgPSAocGFyYW0pID0+IHsKCQkJCQlzdGF0ZS5hbGxSb3dzID0gbnVsbDsKCQkJCQlyZXR1cm4gb25CZWZvcmVMb2FkLmNhbGwodGhpcywgcGFyYW0pOwoJCQkJfTsKCQkJCXZhciBwYWdlciA9IGRnLmRhdGFncmlkKCdnZXRQYWdlcicpOwoJCQkJZGcuZGF0YWdyaWQoJ2dldFBhbmVsJykucGFuZWwoewoJCQkJCUlEOiBpCgkJCQl9KTsKCQkJCXBhZ2VyLnBhZ2luYXRpb24oewoJCQkJCW9uU2VsZWN0UGFnZTogZnVuY3Rpb24ocGFnZU51bSwgcGFnZVNpemUpIHsKCQkJCQkJdHJ5IHsKCQkJCQkJCURGb3JtLmZpbGxEYXRhKCQoIiMiICsgREZvcm0uc2VsZWN0c1skKHRoaXMucGFyZW50Tm9kZSkucGFuZWwoJ29wdGlvbnMnKS5JRF0uaWQpLCBudWxsLCBwYWdlU2l6ZSAqIChwYWdlTnVtIC0gMSksIHBhZ2VTaXplICogcGFnZU51bSk7CgkJCQkJCX0gY2F0Y2ggKF9leCkgewoJCQkJCQkJY29uc29sZS5sb2coIkR5bmFGb3JtOjpvblNlbGVjdFBhZ2UoKSAiLCBfZXgpCgkJCQkJCX0KCQkJCQl9CgkJCQl9KTsKCQkJCWRnLmRhdGFncmlkKCdsb2FkRGF0YScsIHN0YXRlLmRhdGEpOwoJCQl9IGNhdGNoIChleCkge30KCQl9OwoJCWlmIChvYmopIHsKCQkJb2JqQmluZChvYmopOwoJCX0gZWxzZSB7CgkJCWZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5zZWxlY3RzLmxlbmd0aDsgaSsrKSB7CgkJCQlpZiAodGhpcy5zZWxlY3RzW2ldLm9wdGlvbnMub3B0aW9ucykgewoJCQkJCS8vJCgiIyIgKyB0aGlzLnNlbGVjdHNbaV0uaWQpLmNvbWJvKCk7CgkJCQl9IGVsc2UgewoJCQkJCW9iakJpbmQoJCgiIyIgKyB0aGlzLnNlbGVjdHNbaV0uaWQpLCB0aGlzLnNlbGVjdHNbaV0pOwoJCQkJfQoJCQl9CgoJCQl0aGlzLmVsZW1lbnRzLmZpbHRlcihlID0+IGUud2luZG93ICYmIGUuZ3JvdXApLmZvckVhY2goZSA9PiB7CgkJCQlsZXQgdCA9ICQoIiN0YmNXaW5kb3ciKS50YWJzKCJnZXRUYWIiLCBlLmdyb3VwKTsKCQkJCWlmICh0KSB7CgkJCQkJdC5wYW5lbCgnb3B0aW9ucycpLnRhYi5oaWRlKCk7CgkJCQl9CgkJCX0pOwoJCX0KCX0KCgllbmdsaXNoKHMpIHsKCQlpZiAoIXMpIHJldHVybiAiIjsKCQl2YXIgcmVzdWx0ID0gcy5yZXBsYWNlKC8oW0EtWl0pL2csICIgJDEiKTsKCQlyZXN1bHQgPSByZXN1bHQucmVwbGFjZSgvXy9nLCAnJyk7CgkJcmV0dXJuIHJlc3VsdC5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHJlc3VsdC5zbGljZSgxKTsKCX0KCglvblRvZ2dsZShlLCBiVmFsdWUpIHsKCQlsZXQgc1RhZyA9IGAjZkVsZW1lbnRfJHtlLmZvci5uYW1lfSA+IC5lYXN5dWktJHt0aGlzLnVpVHlwZXNbZS5mb3IudHlwZV19YDsKCQlsZXQgb1RhZyA9ICQoc1RhZyk7CgkJZS5mb3IuZW5hYmxlZCA9IHR5cGVvZihiVmFsdWUpID09PSAidW5kZWZpbmVkIiA/ICFlLmZvci5lbmFibGVkIDogYlZhbHVlOwoKCQlvVGFnLnByb3AoImRpc2FibGVkIiwgIWUuZm9yLmVuYWJsZWQpOwoJCS8vb1RhZ1t0aGlzLnVpVHlwZXNbZS5mb3IudHlwZV1dKGUuZm9yLmVuYWJsZWQgPyAiZW5hYmxlIiA6ICJkaXNhYmxlIik7CgkJY29uc29sZS5sb2coc1RhZywgb1RhZywgdGhpcy51aVR5cGVzW2UuZm9yLnR5cGVdLCBlLmZvci5lbmFibGVkKTsKCX0KCglyZW5kZXIobmFtZSwgdGl0bGUsIGVsZW1lbnRzLCBidXR0b25zLCBiRml4ZWQpIHsKCQl0aGlzLmVsZW1lbnRzID0gKGVsZW1lbnRzIHx8IFtdKS5maWx0ZXIoZSA9PiAhZS5pZ25vcmUpOwoKCQl0aGlzLmJ1dHRvbnMgPSBidXR0b25zIHx8IFtdOwoJCXRoaXMuc2VsZWN0cyA9IFtdOwoJCXRoaXMuZ3JpZHMgPSBbXTsKCgkJdGhpcy5lbGVtZW50cy5maWx0ZXIoZSA9PiBlLnR5cGUgPT0gIndpbmRvdyIpLmZvckVhY2godyA9PiB0aGlzLmVsZW1lbnRzLnNwbGljZSh0aGlzLmVsZW1lbnRzLmZpbmRJbmRleChlID0+IGUubmFtZSA9PSB3Lm5hbWUpLCAwLCB7CgkJCW5hbWU6ICJfIiArIHcubmFtZSwKCQkJdHlwZTogImxpbmsiLAoJCQl0aXRsZTogdy50aXRsZSB8fCB3Lm5hbWUsCgkJCWdyb3VwOiB3Lmdyb3VwLAoJCQl3aW5kb3c6IHcud2luZG93LAoJCQlzZWN0aW9uOiB3LnNlY3Rpb24sCgkJCWxpbmtzOiBbewoJCQkJbGFiZWw6ICdPcGVuJywKCQkJCWljb246ICdlZGl0JywKCQkJCW9uQ2xpY2s6IG8gPT4gJCgiI3BubCIgKyB3Lm5hbWUpLndpbmRvdygnb3BlbicpCgkJCX1dLAoJCX0pKTsKCgkJdGhpcy5zcigpLmdyb3VwQnkodGhpcy5lbGVtZW50cy5maWx0ZXIoZSA9PiBlLndpbmRvdyksICJncm91cCIpLmZvckVhY2goa3YgPT4gewoJCQlpZiAoIWt2LmtleSkgcmV0dXJuOwoKCQkJbGV0IGUgPSB7CgkJCQluYW1lOiAiXyIgKyBrdi5rZXksCgkJCQl0aXRsZToga3Yua2V5LAoJCQkJdHlwZTogIndpbmRvdyIsCgkJCQlncm91cDoga3Yua2V5LAoJCQkJd2lkdGg6IHRoaXMud2lkdGggKiAwLjksCgkJCQloZWlnaHQ6IHRoaXMuaGVpZ2h0ICogMC45LAoJCQkJbG9hZGVyOiBvID0+IHsKCQkJCQlrdi52YWx1ZXMuZmlsdGVyKHYgPT4gdi50eXBlICE9PSAnbGluaycgfHwgKHYudHlwZSA9PSAnbGluaycgJiYgdi5uYW1lLnN0YXJ0c1dpdGgoJ18nKSkpLmZvckVhY2godiA9PiAkKCIjcG5sXyIgKyB2Lmdyb3VwICsgJy1jZW50ZXInKS5hcHBlbmQoJCgiI2ZFbGVtZW50XyIgKyB2Lm5hbWUpKSk7CgkJCQkJcmV0dXJuIG51bGw7CgkJCQl9LAoJCQkJYnV0dG9uczogW10uY29uY2F0LmFwcGx5KFtdLCBrdi52YWx1ZXMuZmlsdGVyKHYgPT4gdi50eXBlID09ICdsaW5rJyAmJiAhdi5uYW1lLnN0YXJ0c1dpdGgoJ18nKSkubWFwKHYgPT4gWy4uLnYubGlua3MubWFwKGwgPT4gKHsKCQkJCQluYW1lOiBsLm5hbWUgfHwgbC5sYWJlbCwKCQkJCQl0aXRsZTogbC50aXRsZSB8fCBsLmxhYmVsLAoJCQkJCW9uQ2xpY2s6IGwub25DbGljaywKCQkJCQlpY29uOiBsLmljb24sCgkJCQkJd2luZG93OiB0cnVlLAoJCQkJCWdyb3VwOiBrdi5rZXksCgkJCQl9KSldKSksCgkJCX07CgkJCXRoaXMuYnV0dG9ucy5wdXNoKC4uLmUuYnV0dG9ucyk7CgoJCQl0aGlzLmVsZW1lbnRzLnB1c2goZSk7CgkJfSk7CgoJCXZhciByZXQgPSAiIjsKCQkvLyBjaGVjayB0aGUgb3B0aW9uIG9mIHVzaW5nIHdpbmRvdygpIGFzIGEgcmVuZGVyZXIgb2YgdGhlIG1haW4gd2luZG93Li4uCgkJaWYgKHRydWUpIHsKCQkJdGhpcy5lbGVtZW50cy5maWx0ZXIoZSA9PiAhZS56b25lKS5mb3JFYWNoKGUgPT4gZS56b25lID0gJ2NlbnRlcicpOwoJCQlsZXQgd09wdGlvbnMgPSB7CgkJCQluYW1lOiBuYW1lIHx8IHRoaXMubmFtZSwKCQkJCXRpdGxlOiB0aXRsZSB8fCB0aGlzLnRpdGxlLAoJCQkJdHlwZTogJ3dpbmRvdycsCgkJCQl2aXNpYmxlOiB0cnVlLAoJCQkJd2lkdGg6IHRoaXMud2lkdGgsCgkJCQloZWlnaHQ6IHRoaXMuaGVpZ2h0LAoJCQkJZml4ZWQ6IGJGaXhlZCwKCQkJCWxpbmtzOiBbewoJCQkJCWljb246ICJoZWxwIiwKCQkJCQlhY3Rpb246IG8gPT4gJCgiI3BubF9fQ29uc29sZSIpLndpbmRvdygnb3BlbicpCgkJCQl9XSwKCQkJCWJ1dHRvbnM6IHRoaXMuYnV0dG9ucy5maWx0ZXIoYiA9PiAhYi53aW5kb3cpLAoJCQl9OwoJCQl0aGlzLnNyKCkuZ3JvdXBCeSh0aGlzLmVsZW1lbnRzLCAnem9uZScpLmZpbHRlcih6ZyA9PiB6Zy5rZXkpLmZvckVhY2goemcgPT4gewoJCQkJd09wdGlvbnNbemcua2V5XSA9IHRoaXMucmVuZGVyRWxlbWVudHMoemcudmFsdWVzKTsKCQkJfSk7CgoJCQlyZXQgPSB0aGlzLndpbmRvdyh3T3B0aW9ucyk7CgkJfSBlbHNlIHsKCQkJcmV0ID0gdGhpcy5oZWFkZXIobmFtZSwgdGl0bGUsIGJGaXhlZCwgW3sKCQkJCWljb246ICJoZWxwIiwKCQkJCWFjdGlvbjogbyA9PiAkKCIjcG5sX19Db25zb2xlIikud2luZG93KCdvcGVuJykKCQkJfV0pOwoKCQkJcmV0ICs9IHRoaXMucmVuZGVyRWxlbWVudHMoKTsKCgkJCXJldCArPSB0aGlzLmZvb3RlcihiRml4ZWQpOwoKCQl9CgkJLy8gY29uc29sZS5sb2cocmV0KTsKCgkJcmV0dXJuIHJldDsKCX0KCgljV2lkdGgob3B0aW9ucykgewoJCWxldCByZXQgPSBNYXRoLmZsb29yKCgob3B0aW9ucyA/IG9wdGlvbnMud2lkdGggOiBudWxsKSB8fCAodGhpcy53aWR0aCAvIDMpKSk7CgkJaWYgKG9wdGlvbnMuem9uZSA9PSAnZWFzdCcgfHwgb3B0aW9ucy56b25lID09ICd3ZXN0JykgewoJCQlyZXQgPSAwLjI1ICogcmV0OyAvLyA5MCUgb2YgMy8xMCwgdGhlIHdpZHRoIG9mIHRoZSBub3JtYWwgZWxlbWVudAoJCX0gZWxzZSBpZiAob3B0aW9ucyAmJiBvcHRpb25zLmVkaXRvcikgewoJCQlyZXQgPSB3aW5kb3cuaW5uZXJXaWR0aDsKCQl9IGVsc2UgaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy53aWR0aCAmJiB0eXBlb2Yob3B0aW9ucy53aWR0aCkgPT09ICdzdHJpbmcnKSB7CgkJCXJldCA9IHRoaXMud2lkdGg7CgkJfSBlbHNlIGlmIChvcHRpb25zICYmIG9wdGlvbnMudHlwZSA9PSAnd2luZG93JyAmJiAhb3B0aW9ucy53aWR0aCkgewoJCQlyZXQgPSB0aGlzLndpZHRoICogMC45OwoJCX0KCgkJLy8gY29uc29sZS5sb2cob3B0aW9ucy5uYW1lICsgIjogY1dpZHRoID0gIiArIHJldCwgb3B0aW9ucy56b25lKTsKCQlyZXR1cm4gcmV0OwoJfQoKCXdpbmRvdyhvcHRpb25zKSB7CgkJb3B0aW9ucy50aXRsZSA9IG9wdGlvbnMudGl0bGUgfHwgb3B0aW9ucy5uYW1lOwoJCXZhciByZXQgPSBgCgkJPGRpdiBpZCA9ICJwbmwke29wdGlvbnMubmFtZX0iIGNsYXNzPSJlYXN5dWktd2luZG93IiB0aXRsZT0iJHtvcHRpb25zLnRpdGxlIHx8IHRoaXMuZW5nbGlzaChvcHRpb25zLm5hbWUpfSIgZGF0YS1vcHRpb25zPScke3RoaXMuZXZlbnRIYW5kbGVycyhvcHRpb25zKX0sIGNsb3NlZDokeyFvcHRpb25zLnZpc2libGV9LG1pbmltaXphYmxlOiR7IW9wdGlvbnMuZml4ZWR9LG1heGltaXphYmxlOiR7IW9wdGlvbnMuZml4ZWR9LGNsb3NhYmxlOiR7IW9wdGlvbnMuZml4ZWR9LGNvbGxhcHNpYmxlOiR7IW9wdGlvbnMuZml4ZWR9LGRyYWdnYWJsZTokeyFvcHRpb25zLmZpeGVkfSxyZXNpemFibGU6JHshb3B0aW9ucy5maXhlZH0saWNvbkNsczoiaWNvbi0ke29wdGlvbnMuaWNvbn0iLCB0b29sczoiIyR7b3B0aW9ucy5uYW1lfV90b29scyInIHN0eWxlPSJ3aWR0aDoke3RoaXMuY1dpZHRoKG9wdGlvbnMpfXB4O2hlaWdodDoke3RoaXMuY0hlaWdodChvcHRpb25zKX1weDtwYWRkaW5nOjEwcHg7Ij4KCQkgICAgPGRpdiBjbGFzcz0iZWFzeXVpLWxheW91dCIgZGF0YS1vcHRpb25zPSJmaXQ6dHJ1ZSI+CgkJYDsKCgkJbGV0IGJab25lID0gb3B0aW9ucy5zb3V0aCA/ICdzb3V0aCcgOiAodGhpcy56b25lcy5maW5kKHogPT4geiA9PSAnc291dGgnKSB8fCB0aGlzLnpvbmVzWzBdKTsKCQlvcHRpb25zW2Jab25lXSA9IG9wdGlvbnNbYlpvbmVdIHx8IFtdOwoJCWxldCB6V2lkdGggPSBNYXRoLm1pbigxMjAsIHRoaXMud2lkdGggKiAwLjk1IC8gKG9wdGlvbnMuYnV0dG9ucyA/IG9wdGlvbnMuYnV0dG9ucy5sZW5ndGggOiAxKSwgdGhpcy5jV2lkdGgob3B0aW9ucykpOwoJCW9wdGlvbnNbYlpvbmVdLnB1c2goYDxkaXYgaWQ9InBubCR7b3B0aW9ucy5uYW1lfS1idXR0b25zIiBkYXRhLW9wdGlvbnM9InJlZ2lvbjonJHtiWm9uZX0nLGJvcmRlcjpmYWxzZSIgc3R5bGU9InRleHQtYWxpZ246cmlnaHQ7cGFkZGluZzo1cHggMCAwOyI+YCArICQubWFwKCQuZ3JlcChvcHRpb25zLmJ1dHRvbnMgfHwgW10sIGIgPT4gIWIuaWdub3JlKSwgYiA9PiBgPGEgaWQ9JyR7Yi5uYW1lfScgaHJlZj0iamF2YXNjcmlwdDp2b2lkKDApIiBjbGFzcz0iZWFzeXVpLWxpbmtidXR0b24gYzYiIGljb25DbHM9Imljb24tJHtiLmljb24gfHwgJ3NhdmUnfSIgc3R5bGU9IndpZHRoOiR7eldpZHRofXB4IiBvbmNsaWNrPSdERm9ybS5kb0NsaWNrKCR7X0ZyRU1ELl90b0pTKGIpfSknPiR7Yi50aXRsZSB8fCBiLm5hbWV9PC9hPiZuYnNwOyZuYnNwO2ApLmpvaW4oJycpICsgYDwvZGl2PmApOwoKCQl0aGlzLnpvbmVzLmZpbHRlcih6ID0+IG9wdGlvbnNbel0pLmZvckVhY2goeiA9PiB7CgkJCXJldCArPSBgCgkJICAgICAgICA8ZGl2IGRhdGEtb3B0aW9ucz0icmVnaW9uOicke3p9JyIgdGl0bGU9IiR7KHo9PSd3ZXN0JyB8fCB6PT0nZWFzdCcpPycmbmJzcDsnOicnfSIgc3R5bGU9J2hlaWdodDokeyh6PT0nbm9ydGgnfHx6PT0nc291dGgnKT8xMDoxMDB9JTt3aWR0aDokeygoej09J2Vhc3QnfHx6PT0nd2VzdCcpPzAuMToxKSp0aGlzLmNXaWR0aChvcHRpb25zKX1weCc+CiAgICAgICAgCQkgICAgJHsoQXJyYXkuaXNBcnJheShvcHRpb25zW3pdKT9vcHRpb25zW3pdOltvcHRpb25zW3pdXSkuam9pbignJyl9CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgYDsKCQl9KTsKCgkJcmV0ICs9IGA8L2Rpdj48L2Rpdj5gOwoKCQkvLyBsaW5rcyAodG9vbHMpCgkJbGV0IGxpbmtzID0gJC5ncmVwKFtdLmNvbmNhdChvcHRpb25zLmxpbmtzIHx8IFtdKSwgbCA9PiAhbC5pZ25vcmUpOwoJCXJldCArPSBgPGRpdiBpZD0iJHtvcHRpb25zLm5hbWV9X3Rvb2xzIj5gICsgJC5tYXAobGlua3MucmV2ZXJzZSgpLCBsID0+IGA8YSBocmVmPSJqYXZhc2NyaXB0OnZvaWQoMCkiIHN0eWxlPSJjb2xvcjpibGFjayIgY2xhc3M9ImZhcyBmYS0ke2wuaWNvbiB8fCAnYWRkJ30iIG9uY2xpY2s9Jyhhc3luYyAoKSA9PiB7dmFyIGEgPSAke19GckVNRC5fdG9KUyhsKX07ICQoIiNwbmwke29wdGlvbnMubmFtZX0iKS53aW5kb3coInNldFRpdGxlIiwgIiR7b3B0aW9ucy50aXRsZX06ICIgKyBhLm5hbWUpOyBhd2FpdCBhLmFjdGlvbihERm9ybS5nZXQoKSwgYSwgJHtfRnJFTUQuX3RvSlMob3B0aW9ucyl9KTsgJCgiI3BubCR7b3B0aW9ucy5uYW1lfSIpLndpbmRvdygic2V0VGl0bGUiLCAiJHtvcHRpb25zLnRpdGxlfSIpO30pKCknPjwvYT5gKS5qb2luKCdcbicpICsgYDwvZGl2PmA7CgoJCXJldHVybiByZXQ7Cgl9CgoJYXN5bmMgX2VuZCgpIHsKCQlsZXQgbyA9IHRoaXMuZ2V0KCk7CgoJCS8vIGRvIG5vdCB1c2UgdGhlIGZpcnN0IGJ1dHRvbiwgYmVjYXVzZSBtYW55IGZvcm1zIGhhdmUgYSBDYW5jZWwgYnV0dG9uIG9ubHkKCQlsZXQgYnV0dG9uID0gdGhpcy5idXR0b25zLmZpbmQoYiA9PiBiLmF1dG9TdWJtaXQpIC8qIHx8IHRoaXMuYnV0dG9uc1swXSovIDsKCQlpZiAoYnV0dG9uICYmIG8gJiYgT2JqZWN0LnZhbHVlcyhvKS5sZW5ndGggJiYgKHR5cGVvZihidXR0b24uYXV0b1N1Ym1pdCkgPT09ICJ1bmRlZmluZWQiIHx8IGJ1dHRvbi5hdXRvU3VibWl0KSkgewoJCQlsZXQgdiA9IE9iamVjdC52YWx1ZXMobykucmVkdWNlKCh0LCB2KSA9PiB7CgkJCQlyZXR1cm4gKCh0eXBlb2YodikgIT09ICJvYmplY3QiKSA/IDEgOiAwKSAqICh2ID8gMSA6IDApOwoJCQl9KTsKCQkJLy9jb25zb2xlLmxvZyhvLCBPYmplY3QudmFsdWVzKG8pLCB2KTsKCQkJaWYgKHYpIHsKCQkJCS8vIGFsbCBmaWVsZHMgaGF2ZSB2YWx1ZXMKCQkJCWF3YWl0IHRoaXMuZG9DbGljayhidXR0b24pOwoKCQkJfQoJCX0KCX0KCglmb290ZXIoYkZpeGVkKSB7CgkJcmV0dXJuIGA8L2Zvcm0+YCArIGA8ZGl2IGlkPSJkbGctYnV0dG9ucyI+YCArIHRoaXMuYnV0dG9ucy5maWx0ZXIoYiA9PiAhYi53aW5kb3cpLm1hcChiID0+IGA8YSBpZD0nJHtiLm5hbWV9JyBocmVmPSJqYXZhc2NyaXB0OnZvaWQoMCkiIGNsYXNzPSJlYXN5dWktbGlua2J1dHRvbiBjNiIgaWNvbkNscz0iaWNvbi0ke2IuaWNvbiB8fCAnc2F2ZSd9IiBzdHlsZT0id2lkdGg6JHtNYXRoLm1pbigxMjAsIHRoaXMud2lkdGggKiAwLjk1IC8gdGhpcy5idXR0b25zLmxlbmd0aCwgdGhpcy5jV2lkdGgoKSl9cHgiIG9uY2xpY2s9J0RGb3JtLmRvQ2xpY2soJHtfRnJFTUQuX3RvSlMoYil9KSc+JHtiLnRpdGxlIHx8IGIubmFtZX08L2E+Jm5ic3A7Jm5ic3A7YCkuam9pbignJykgKyAiPC9kaXY+IiArIChiRml4ZWQgPyAiIiA6ICc8L2Rpdj4nKTsKCX0KCgloZWFkZXIobmFtZSwgdGl0bGUsIGJGaXhlZCwgbGlua3MpIHsKCQl0aGlzLnRpdGxlID0gdGl0bGUgfHwgdGhpcy50aXRsZTsKCQluYW1lID0gbmFtZSB8fCB0aGlzLm5hbWU7CgkJdmFyIHJldCA9ICcnOwoKCQlyZXQgKz0gdGhpcy53aW5kb3coewoJCQluYW1lOiAiX19Db25zb2xlIiwKCQkJdHlwZTogIndpbmRvdyIsCgkJCWVkaXRvcjogdHJ1ZSwKCQkJbG9hZGVyOiBvID0+IHdpbmRvdy5sb2dzLnNsaWNlKCkucmV2ZXJzZSgpLm1hcChsID0+IGwuZGF0ZS50b0lTT1N0cmluZygpICsgIjogIiArIGwuYXJncy5tYXAocyA9PiB0eXBlb2YocykgPT09ICdvYmplY3QnID8gKChvYmosIGluZGVudCA9IDIpID0+IHsKCQkJCWxldCBjYWNoZSA9IFtdOwoJCQkJY29uc3QgcmV0VmFsID0gSlNPTi5zdHJpbmdpZnkoCgkJCQkJb2JqLAoJCQkJCShrZXksIHZhbHVlKSA9PgoJCQkJCXR5cGVvZiB2YWx1ZSA9PT0gIm9iamVjdCIgJiYgdmFsdWUgIT09IG51bGwgPwoJCQkJCWNhY2hlLmluY2x1ZGVzKHZhbHVlKSA/CgkJCQkJdW5kZWZpbmVkIC8vIER1cGxpY2F0ZSByZWZlcmVuY2UgZm91bmQsIGRpc2NhcmQga2V5CgkJCQkJOgoJCQkJCWNhY2hlLnB1c2godmFsdWUpICYmIHZhbHVlIC8vIFN0b3JlIHZhbHVlIGluIG91ciBjb2xsZWN0aW9uCgkJCQkJOgoJCQkJCXZhbHVlLAoJCQkJCWluZGVudAoJCQkJKTsKCQkJCWNhY2hlID0gbnVsbDsKCQkJCXJldHVybiByZXRWYWw7CgkJCX0pKHMpIDogcykuam9pbignLCAnKSkuam9pbignXG4nKSwKCQl9KTsKCgkJaWYgKCFiRml4ZWQpIHsKCQkJbGlua3MgPSAobGlua3MgfHwgW10pLmZpbHRlcihsID0+ICFsLmlnbm9yZSk7CgkJCWxldCB0RGF0YSA9ICIiOwoJCQlpZiAobGlua3MubGVuZ3RoKSB7CgkJCQlyZXQgKz0gYDxkaXYgaWQ9IiR7dGhpcy5uYW1lfV90b29scyI+YCArIGxpbmtzLm1hcChsID0+IGA8YSBocmVmPSJqYXZhc2NyaXB0OnZvaWQoMCkiIGNsYXNzPSJpY29uLSR7bC5pY29ufSIgb25jbGljaz0nKGFzeW5jICgpID0+IHt2YXIgYSA9ICR7X0ZyRU1ELl90b0pTKGwpfTsgJCgiI3dpbiR7dGhpcy5uYW1lfSIpLndpbmRvdygic2V0VGl0bGUiLCAiJHt0aGlzLnRpdGxlfTogIiArIGEubmFtZSk7IGF3YWl0IGEuYWN0aW9uKERGb3JtLmdldCgpKTsgJCgiI3dpbiR7dGhpcy5uYW1lfSIpLndpbmRvdygic2V0VGl0bGUiLCAiJHt0aGlzLnRpdGxlfSIpO30pKCknPjwvYT5gKS5qb2luKCdcbicpICsgIjwvZGl2PiI7CgkJCQl0RGF0YSA9IGAsdG9vbHM6IiMke3RoaXMubmFtZX1fdG9vbHMiYDsKCQkJfQoJCQlyZXQgKz0gYDxkaXYgaWQ9J3dpbiR7dGhpcy5uYW1lfScgY2xhc3M9J2Vhc3l1aS13aW5kb3cnIHRpdGxlPScke3RoaXMudGl0bGUgfHwgdGhpcy5lbmdsaXNoKHRoaXMubmFtZSl9JyBkYXRhLW9wdGlvbnM9J2ljb25DbHM6Imljb24tc2F2ZSIgJHt0RGF0YX0nIHN0eWxlPSd3aWR0aDoke3RoaXMud2lkdGh9cHg7aGVpZ2h0OiR7dGhpcy5oZWlnaHR9cHg7cGFkZGluZzoxMHB4Oyc+YDsKCQl9CgkJcmV0dXJuIHJldCArIGA8Zm9ybSBpZD0iZnJtJHt0aGlzLm5hbWV9IiBtZXRob2Q9InBvc3QiIG5vdmFsaWRhdGU+YDsKCX0KCglyZW5kZXJFbGVtZW50cyhlbGVtZW50cykgewoJCWVsZW1lbnRzID0gZWxlbWVudHMgfHwgdGhpcy5lbGVtZW50czsKCgkJdmFyIHRXaWR0aCA9IE1hdGguZmxvb3IodGhpcy53aWR0aCAqIDAuOTUpOwoJCXZhciB0SGVpZ2h0ID0gTWF0aC5mbG9vcih0aGlzLmhlaWdodCAqIDAuODUpOwoKCQlsZXQgcmV0ID0gJyc7CgkJdmFyIGdFbGVtZW50cyA9IHRoaXMuc3IoKS5ncm91cEJ5KGVsZW1lbnRzLCAiZ3JvdXAiKTsKCQlpZiAoZ0VsZW1lbnRzLmxlbmd0aCA+IDEpIHJldCArPSBgPGRpdiBpZD0idGJjV2luZG93IiBjbGFzcz0iZWFzeXVpLXRhYnMiIGRhdGEtb3B0aW9ucz0nJHt0aGlzLmV2ZW50SGFuZGxlcnMoe3R5cGU6ICd0YWJzJ30pfScgc3R5bGU9IndpZHRoOiR7dFdpZHRofXB4O2hlaWdodDoke3RIZWlnaHR9cHg7Ij5gOwoJCWZvciAodmFyIGcgPSAwOyBnIDwgZ0VsZW1lbnRzLmxlbmd0aDsgZysrKSB7CgkJCWlmIChnRWxlbWVudHMubGVuZ3RoID4gMSkgcmV0ICs9ICc8ZGl2IHRpdGxlPSInICsgKGdFbGVtZW50c1tnXS5rZXkgfHwgIk1haW4iKSArICciIHN0eWxlPSJwYWRkaW5nOjIwcHg7ZGlzcGxheTpub25lOyI+JzsKCQkJdmFyIHNFbGVtZW50cyA9IHRoaXMuc3IoKS5ncm91cEJ5KGdFbGVtZW50c1tnXS52YWx1ZXMsICJzZWN0aW9uIik7CgkJCWlmIChzRWxlbWVudHMubGVuZ3RoID4gMSkgcmV0ICs9ICc8ZGl2IGNsYXNzPSJlYXN5dWktYWNjb3JkaW9uIiBzdHlsZT0id2lkdGg6JyArIHRXaWR0aCArICdweDtoZWlnaHQ6JyArIC8qdEhlaWdodCovICIxMDAlIiArICdweDsiPic7CgkJCWZvciAodmFyIHMgPSAwOyBzIDwgc0VsZW1lbnRzLmxlbmd0aDsgcysrKSB7CgkJCQlyZXQgKz0gYDxkaXYgdGl0bGU9IiR7c0VsZW1lbnRzW3NdLmtleSB8fCAiIn0iIGRhdGEtb3B0aW9ucz0iaWNvbkNsczonaWNvbi1tb3JlJyIgc3R5bGU9InBhZGRpbmc6MTBweDsiPmA7CgkJCQlmb3IgKHZhciBpID0gMDsgaSA8IHNFbGVtZW50c1tzXS52YWx1ZXMubGVuZ3RoOyBpKyspIHsKCQkJCQl2YXIgZSA9IHNFbGVtZW50c1tzXS52YWx1ZXNbaV07CgkJCQkJaWYgKGUuaWdub3JlKSBjb250aW51ZTsKCQkJCQllLnZhbHVlID0gZS52YWx1ZSB8fCBfRnJFTUQuaGFzaFtlLm5hbWVdIHx8IChfRnJFTUQuYXBpU2VydmVyID8gX0ZyRU1ELmFwaVNlcnZlci5fX2NvbmZpZygndGVzdF8nICsgZS5uYW1lLCAnJykgOiAnJyk7CgkJCQkJcmV0ICs9IGA8ZGl2IGlkPSJmRWxlbWVudF8ke2UubmFtZX0iIGNsYXNzPSJmaXRlbSIgc3R5bGU9ImRpc3BsYXk6ICR7KGUudHlwZT09J3dpbmRvdycgfHwgZS5oaWRkZW4pPydub25lJzonJ30iPmA7CgkJCQkJaWYgKGUudG9nZ2xlKSB7CgkJCQkJCXJldCArPSBgPGEgaHJlZj0iIyIgY2xhc3M9ImVhc3l1aS1saW5rYnV0dG9uIiBkYXRhLW9wdGlvbnM9JyR7dGhpcy5ldmVudEhhbmRsZXJzKHt0eXBlOiAndG9nZ2xlJywgZm9yOiBlfSl9LHBsYWluOnRydWUsaWNvbkNsczoiaWNvbi0ke2UuaWNvbiB8fCAnc2VhcmNoJ30iJyBzdHlsZT0id2lkdGg6MTAwcHg7aGVpZ2h0OjMwcHgiPiR7ZS50aXRsZSB8fCB0aGlzLmVuZ2xpc2goZS5uYW1lKX08L2E+YDsKCQkJCQl9IGVsc2UgewoJCQkJCQlyZXQgKz0gYDxsYWJlbD4ke2UudGl0bGUgfHwgdGhpcy5lbmdsaXNoKGUubmFtZSl9OjwvbGFiZWw+YDsKCQkJCQl9CgkJCQkJaWYgKGUudHlwZSAmJiB0aGlzW2UudHlwZV0pIHsKCQkJCQkJcmV0ICs9IHRoaXNbZS50eXBlXShlKTsKCQkJCQl9IGVsc2UgaWYgKGUucmVuZGVyKSB7CgkJCQkJCXJldCArPSBlLnJlbmRlcigpOwoJCQkJCX0KCQkJCQlyZXQgKz0gJzwvZGl2Pic7CgkJCQl9CgkJCQlyZXQgKz0gJzwvZGl2Pic7CgkJCX0KCQkJaWYgKHNFbGVtZW50cy5sZW5ndGggPiAxKSByZXQgKz0gJzwvZGl2Pic7CgkJCWlmIChnRWxlbWVudHMubGVuZ3RoID4gMSkgcmV0ICs9ICI8L2Rpdj4iOwoJCX0KCQlpZiAoZ0VsZW1lbnRzLmxlbmd0aCA+IDEpIHJldCArPSAiPC9kaXY+IjsKCQlyZXR1cm4gcmV0OwoJfQoKCWluZm8obXNnKSB7CgkJaWYgKCQubWVzc2FnZXIpIHsKCQkJJC5tZXNzYWdlci5hbGVydCh0aGlzLnRpdGxlLCBtc2csICdpbmZvJyk7CgkJfSBlbHNlIHsKCQkJdGhpcy5zcigpLlNob3dNZXNzYWdlKG1zZywgdGhpcy50aXRsZSk7CgkJfQoJfQoKCWVycm9yKG1zZykgewoJCWlmICgkLm1lc3NhZ2VyKSB7CgkJCSQubWVzc2FnZXIuYWxlcnQodGhpcy50aXRsZSwgbXNnLCAnZXJyb3InKTsKCQl9IGVsc2UgewoJCQl0aGlzLnNyKCkuU2hvd01lc3NhZ2UobXNnLCB0aGlzLnRpdGxlKTsKCQl9Cgl9CgoJYnlOYW1lKG5hbWUpIHsKCQlyZXR1cm4gdGhpcy5lbGVtZW50cy5maW5kKGUgPT4gZS5uYW1lID09PSBuYW1lKTsKCX0KCgkvKiogQ29tcG9uZW50czo6U3RhcnQgKiovCglDb3JlQ29tcG9uZW50ID0gY2xhc3MgewoJCWNvbnN0cnVjdG9yKHBhZ2UsIGRGb3JtKSB7CgkJCXRoaXMucGFnZSA9IHBhZ2U7CgkJCXRoaXMuZEZvcm0gPSBkRm9ybTsKCQl9CgoJCWJ1c3koYkJ1c3kpIHsKCQkJcmV0dXJuIHRoaXMuZEZvcm0uYnVzeShiQnVzeSk7CgkJfQoKCQlfbWUodikgewoJCQlsZXQgbWVOYW1lID0gKHR5cGVvZihjb21wYW55KSAhPT0gJ3VuZGVmaW5lZCcpID8gKGNvbXBhbnkubG9nZ2VkSW5JZGVudGl0eSB8fCAibWUiKSA6ICJtZSI7CgkJCWlmICh2KSB7CgkJCQl3aW5kb3dbbWVOYW1lXSA9IHY7CgkJCX0KCgkJCXJldHVybiB3aW5kb3dbbWVOYW1lXTsKCQl9CgoJCV9jYW5WaWV3KCkgewoJCQlpZiAoIXRoaXMuX21lKCkpIHsKCQkJCXdpbmRvdy5fRnJFTUQuc2V0VVJMKHsKCQkJCQlwYWdlOiAnbG9naW4nLAoJCQkJCV9yZWRpcmVjdDogdGhpcy5wYWdlLl9jb2RlLAoJCQkJfSk7CgkJCQl0aHJvdyBgX2NhblZpZXc6ICR7dGhpcy5wYWdlLl9jb2RlfSBub3QgYWxsb3dlZCB3aXRob3V0IGxvZ2luIWA7CgkJCX0KCQl9CgoJCV9uYW1lKCkgewoJCQlpZiAoIXRoaXMuX21lKCkpIHJldHVybiAiIjsKCQkJcmV0dXJuIHRoaXMuX21lKCkubmFtZSA/IHRoaXMuX21lKCkubmFtZSgpIDogdGhpcy5fbWUoKS5Ub1N0cmluZzsKCQl9Cgl9CgoJSW5kZXhDb21wb25lbnQgPSBjbGFzcyBleHRlbmRzIHRoaXMuQ29yZUNvbXBvbmVudCB7CgkJYXN5bmMgbWFpbigpIHsKCQkJdGhpcy5fY2FuVmlldygpOwoKCQkJdGhpcy5wYWdlLmRhdGEgPSB7CgkJCQlmb3JtOiB0aGlzLmRGb3JtLnJlbmRlcignZnJtSW5kZXgnLCAiTWFpbiBQYWdlIiwgW3sKCQkJCQluYW1lOiAnV2VsY29tZScsCgkJCQkJcmVxdWlyZWQ6IHRydWUsCgkJCQkJdHlwZTogImxhYmVsIiwKCQkJCQl2YWx1ZTogdGhpcy5fbmFtZSgpLAoJCQkJfV0sIFtdKQoJCQl9OwoJCX0KCX0KCglMb2dpbkNvbXBvbmVudCA9IGNsYXNzIGV4dGVuZHMgdGhpcy5Db3JlQ29tcG9uZW50IHsKCQlhc3luYyBfYXV0aGVudGljYXRlKG8pIHsKCQkJcmV0dXJuIG51bGw7CgkJfQoKCQlhc3luYyBfbG9nZ2VkSW4oKSB7fQoKCQlhc3luYyBfbm90TG9nZ2VkSW4oKSB7fQoKCQlhc3luYyBtYWluKCkgewoJCQl0aGlzLnBhZ2UuZGF0YSA9IHsKCQkJCWZvcm06IHRoaXMuZEZvcm0ucmVuZGVyKCdmcm1Mb2dpbicsICJVc2VyIEF1dGhlbnRpY2F0aW9uIiwgW3sKCQkJCQkJbmFtZTogJ1VzZXJuYW1lJywKCQkJCQkJcmVxdWlyZWQ6IHRydWUsCgkJCQkJCXR5cGU6ICJzdHJpbmciCgkJCQkJfSwKCQkJCQl7CgkJCQkJCW5hbWU6ICdQYXNzd29yZCcsCgkJCQkJCXJlcXVpcmVkOiB0cnVlLAoJCQkJCQl0eXBlOiAicGFzc3dvcmQiCgkJCQkJfQoJCQkJXSwgW3sKCQkJCQluYW1lOiAnTG9naW4nLAoJCQkJCWF1dG9TdWJtaXQ6IHRydWUsCgkJCQkJb25jbGljazogYXN5bmMgbyA9PiB7CgkJCQkJCWxldCByZXQgPSBhd2FpdCB0aGlzLl9hdXRoZW50aWNhdGUobyk7CgoJCQkJCQlpZiAocmV0KSB7CgkJCQkJCQl0aGlzLl9tZShyZXQpOwoKCQkJCQkJCXRyeSB7CgkJCQkJCQkJYXdhaXQgdGhpcy5fbG9nZ2VkSW4oKTsKCQkJCQkJCX0gY2F0Y2ggKGV4KSB7fQoKCQkJCQkJCV9GckVNRC5zZXRVUkwoewoJCQkJCQkJCXBhZ2U6IF9GckVNRC5oYXNoLl9yZWRpcmVjdCB8fCAiaW5kZXgiCgkJCQkJCQl9KTsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCXRyeSB7CgkJCQkJCQkJYXdhaXQgdGhpcy5fbm90TG9nZ2VkSW4oKTsKCQkJCQkJCX0gY2F0Y2ggKGV4KSB7fQoKCQkJCQkJCXRoaXMuZEZvcm0uZXJyb3IoIkludmFsaWQgdXNlcm5hbWUgb3IgcGFzc3dvcmQiKTsKCQkJCQkJfQoKCQkJCQkJdGhpcy5kRm9ybS5idXN5KGZhbHNlKTsKCQkJCQl9CgkJCQl9XSkKCQkJfTsKCQl9Cgl9CgoJU3RvcmVDb21wb25lbnQgPSBjbGFzcyBleHRlbmRzIHRoaXMuQ29yZUNvbXBvbmVudCB7CgkJYXN5bmMgbWFpbigpIHt9Cgl9CgkvKiogQ29tcG9uZW50czo6RW5kICoqLwp9Ow==",
	"storedMethod": null,
	"__keys": ["name"],
	"active": true,
	"enabled": true,
	"__trMap": []
}