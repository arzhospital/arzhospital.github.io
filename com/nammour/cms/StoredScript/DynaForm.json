{
	"Id": "ba04c2d20779b4fa14c915ead9e3852d6247543f",
	"after": null,
	"async": null,
	"before": null,
	"date": "undefined",
	"name": "DynaForm",
	"order": null,
	"remark": "dW5kZWZpbmVk",
	"script": "d2luZG93LkR5bmFGb3JtID0gY2xhc3MgewoJY29uc3RydWN0b3IoKSB7CgkJdGhpcy50aXRsZSA9ICJGb3JtIFRpdGxlIjsKCQl0aGlzLm5hbWUgPSAiZnJtRm9ybSI7CgkJdGhpcy5lbGVtZW50cyA9IFtdOwoJCXRoaXMuc2VsZWN0cyA9IFtdOwoJCXRoaXMuZ3JpZHMgPSBbXTsKCQl0aGlzLmJ1dHRvbnMgPSBbXTsKCQl0aGlzLnpvbmVzID0gWydub3J0aCcsICdzb3V0aCcsICdlYXN0JywgJ3dlc3QnLCAnY2VudGVyJ107CgkJdGhpcy5zVGFibGUgPSBudWxsOwoJCXRoaXMuYkRlYnVnID0gZmFsc2U7CgkJdGhpcy51aVR5cGVzID0gewoJCQlpbnQ6ICJudW1iZXJzcGlubmVyIiwKCQkJbWVudTogInNwbGl0YnV0dG9uIiwKCQkJZGF0ZXRpbWU6ICJkYXRldGltZWJveCIsCgkJCWJvb2w6ICJzd2l0Y2hidXR0b24iLAoJCQlmaWxlOiAiZmlsZWJveCIsCgkJCXRleHQ6ICJ0ZXh0Ym94IiwKCQkJbGFiZWw6ICJodG1sIiwKCQkJcGFzc3dvcmQ6ICJwYXNzd29yZGJveCIsCgkJCXN0cmluZzogInRleHRib3giLAoJCQlpbWFnZTogImRpYWxvZyIsCgkJCXByb2dyZXNzOiAicHJvZ3Jlc3NiYXIiLAoJCQlsaW5rOiAibGlua2J1dHRvbiIsCgkJCXRyZWU6ICJjb21ib3RyZWUiLAoJCQluYXZpZ2F0aW9uOiAidHJlZSIsCgkJCXNlYXJjaDogJ3NlYXJjaGJveCcsCgkJfTsKCQl0aGlzLmV2ZW50cyA9IFt7CgkJCW5hbWU6ICdvbkNsaWNrJywKCQkJaGFuZGxlcjogJ29uVG9nZ2xlJywKCQkJcGFyYW1zOiAnbj1ldmVudCcsCgkJCXR5cGU6ICd0b2dnbGUnLAoJCX0sIHsKCQkJbmFtZTogJ29uQ2xvc2UnLAoJCQloYW5kbGVyOiAnUGFuT25DbG9zZScsCgkJCXBhcmFtczogJ249ZXZlbnQnLAoJCQl0eXBlOiAnd2luZG93JywKCQl9LCB7CgkJCW5hbWU6ICdvblNlbGVjdCcsCgkJCWhhbmRsZXI6ICdTZWxlY3RDaGFuZ2UnLAoJCQlwYXJhbXM6ICduJywKCQkJdHlwZTogJ3RhYnMnLAoJCX0sIHsKCQkJbmFtZTogJ3NlYXJjaGVyJywKCQkJaGFuZGxlcjogJ0ZpZWxkQ2hhbmdlJywKCQkJcGFyYW1zOiAnbiwgbycsCgkJCXR5cGU6ICdzZWFyY2hib3gnLAoJCX0sIHsKCQkJbmFtZTogJ29uQmVmb3JlRXhwYW5kJywKCQkJaGFuZGxlcjogJ0V4cGFuZCcsCgkJCXBhcmFtczogJ24nLAoJCQl0eXBlOiAndHJlZScsCgkJfSwgewoJCQluYW1lOiAnb25DaGFuZ2UnLAoJCQloYW5kbGVyOiAnRmllbGRDaGFuZ2UnLAoJCQlwYXJhbXM6ICduLCBvJywKCQl9LCB7CgkJCW5hbWU6ICdvbkJlZm9yZU9wZW4nLAoJCQloYW5kbGVyOiAnUGFuZWxPcGVuJywKCQkJcGFyYW1zOiAnJywKCQkJdHlwZTogJ3dpbmRvdycsCgkJfSwgewoJCQluYW1lOiAnb25PcGVuJywKCQkJaGFuZGxlcjogJ1BlbmRBZnRlck9wZW4nLAoJCQlwYXJhbXM6ICcnLAoJCQl0eXBlOiAnd2luZG93JywKCQl9LCB7CgkJCW5hbWU6ICdvbkNsaWNrJywKCQkJaGFuZGxlcjogJ2RvTGluaycsCgkJCXBhcmFtczogJ249ZXZlbnQsIG8nLAoJCQl0eXBlOiAnbGluaycsCgkJfSwgewoJCQluYW1lOiAnb25DbGlja1JvdycsCgkJCWhhbmRsZXI6ICdGaWVsZENoYW5nZScsCgkJCXBhcmFtczogJ24sIG8nLAoJCQl0eXBlOiAnZ3JpZCcsCgkJfV07CgoJCWlmICh0eXBlb2YoJCkgIT09ICd1bmRlZmluZWQnKSAkKHdpbmRvdykucmVzaXplKHRoaXMud2luZG93UmVzaXplZCk7CgkJdGhpcy53aW5kb3dSZXNpemVkKCk7Cgl9CgoJc3IoKSB7CgkJcmV0dXJuIHR5cGVvZihfRnJFTUQpICE9PSAndW5kZWZpbmVkJyA/IF9GckVNRC5zcigpIDogd2luZG93LnNyOwoJfQoKCXBhcnNlKCkgewoJCSQucGFyc2VyLnBhcnNlKCk7Cgl9CgoJd2luZG93UmVzaXplZCgpIHsKCQl0aGlzLndpZHRoID0gd2luZG93LmlubmVyV2lkdGg7CgkJdGhpcy5oZWlnaHQgPSB3aW5kb3cuaW5uZXJIZWlnaHQgKiAwLjg7Cgl9CgoJaW5pdCgpIHsKCQl2YXIgc2VsZWN0ID0gewoJCQlpbml0OiBmdW5jdGlvbihjb250YWluZXIsIG9wdGlvbnMpIHsKCQkJCXZhciBvcCA9IG51bGw7CgkJCQl2YXIgZm9wID0gbnVsbDsKCQkJCWZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5ncmlkcy5sZW5ndGg7IGkrKykKCQkJCQlpZiAodHJ1ZSB8fCB0aGlzLmdyaWRzW2ldLmlkID09IG9wdGlvbnMuc291cmNlKSBvcCA9IHRoaXMuZ3JpZHNbaV0ub3B0aW9uczsKCQkJCWZvciAoaSA9IDA7IGkgPCBvcC5jb2x1bW5zLmxlbmd0aDsgaSsrKQoJCQkJCWlmIChvcC5jb2x1bW5zW2ldLm5hbWUgPT0gb3B0aW9ucy5maWVsZCkgZm9wID0gb3AuY29sdW1uc1tpXTsKCQkJCWZvcC53aWR0aCA9ICh0aGlzLndpZHRoIC8gMyk7CgkJCQl2YXIgZSA9ICQodGhpcy5zZWxlY3QoZm9wKSk7CgkJCQl2YXIgaW5wdXQgPSBlLmFwcGVuZFRvKGNvbnRhaW5lcik7CgkJCQlpbnB1dC5jb21ib2dyaWQoKTsKCQkJCXRoaXMuYmluZChpbnB1dCk7CgkJCQlyZXR1cm4gaW5wdXQ7CgkJCX0sCgkJCWRlc3Ryb3k6IGZ1bmN0aW9uKHRhcmdldCkgewoJCQkJJCh0YXJnZXQpLnJlbW92ZSgpOwoJCQl9LAoJCQlnZXRWYWx1ZTogZnVuY3Rpb24odGFyZ2V0KSB7CgkJCQlyZXR1cm4gJCh0YXJnZXQpLnZhbCgpOwoJCQl9LAoJCQlzZXRWYWx1ZTogZnVuY3Rpb24odGFyZ2V0LCB2YWx1ZSkgewoJCQkJJCh0YXJnZXQpLnZhbCh2YWx1ZSk7CgkJCX0sCgkJCXJlc2l6ZTogZnVuY3Rpb24odGFyZ2V0LCB3aWR0aCkgewoJCQkJJCh0YXJnZXQpLl9vdXRlcldpZHRoKHdpZHRoKTsKCQkJfQoJCX07CgkJJC5leHRlbmQoJC5mbi5kYXRhZ3JpZC5kZWZhdWx0cy5lZGl0b3JzLCB7CgkJCWRhdGV0aW1lOiB7CgkJCQlpbml0OiBmdW5jdGlvbihjb250YWluZXIsIG9wdGlvbnMpIHsKCQkJCQlvcHRpb25zLndpZHRoID0gdGhpcy5jV2lkdGgob3B0aW9ucyk7CgkJCQkJdmFyIGlucHV0ID0gJCh0aGlzLmRhdGV0aW1lKG9wdGlvbnMpKS5hcHBlbmRUbyhjb250YWluZXIpOwoJCQkJCWlucHV0LmRhdGV0aW1lYm94KCk7CgkJCQkJcmV0dXJuIGlucHV0OwoJCQkJfSwKCQkJCWRlc3Ryb3k6IGZ1bmN0aW9uKHRhcmdldCkgewoJCQkJCSQodGFyZ2V0KS5yZW1vdmUoKTsKCQkJCX0sCgkJCQlnZXRWYWx1ZTogZnVuY3Rpb24odGFyZ2V0KSB7CgkJCQkJcmV0dXJuICQodGFyZ2V0KS52YWwoKTsKCQkJCX0sCgkJCQlzZXRWYWx1ZTogZnVuY3Rpb24odGFyZ2V0LCB2YWx1ZSkgewoJCQkJCSQodGFyZ2V0KS52YWwodmFsdWUpOwoJCQkJfSwKCQkJCXJlc2l6ZTogZnVuY3Rpb24odGFyZ2V0LCB3aWR0aCkgewoJCQkJCSQodGFyZ2V0KS5fb3V0ZXJXaWR0aCh3aWR0aCk7CgkJCQl9CgkJCX0sCgkJCWNoZWNrYm94OiB7CgkJCQlpbml0OiBmdW5jdGlvbihjb250YWluZXIsIG9wdGlvbnMpIHsKCQkJCQl2YXIgaW5wdXQgPSAkKHRoaXMuYm9vbChvcHRpb25zKSkuYXBwZW5kVG8oY29udGFpbmVyKTsKCQkJCQlpbnB1dC5zd2l0Y2hidXR0b24oKTsKCQkJCQlyZXR1cm4gaW5wdXQ7CgkJCQl9LAoJCQkJZGVzdHJveTogZnVuY3Rpb24odGFyZ2V0KSB7CgkJCQkJJCh0YXJnZXQpLnJlbW92ZSgpOwoJCQkJfSwKCQkJCWdldFZhbHVlOiBmdW5jdGlvbih0YXJnZXQpIHsKCQkJCQlyZXR1cm4gJCh0YXJnZXQpLnZhbCgpOwoJCQkJfSwKCQkJCXNldFZhbHVlOiBmdW5jdGlvbih0YXJnZXQsIHZhbHVlKSB7CgkJCQkJJCh0YXJnZXQpLnZhbCh2YWx1ZSk7CgkJCQl9LAoJCQkJcmVzaXplOiBmdW5jdGlvbih0YXJnZXQsIHdpZHRoKSB7CgkJCQkJJCh0YXJnZXQpLl9vdXRlcldpZHRoKHdpZHRoKTsKCQkJCX0KCQkJfSwKCQkJY29tYm90cmVlZ3JpZDogc2VsZWN0LAoJCQlzZWxlY3Q6IHNlbGVjdCwKCQl9KTsKCX0KCglhc2socXVlc3Rpb24sIGZBbnN3ZXIgPSB2ID0+IHYsIG9wdGlvbnMpIHsKCQkkLm1lc3NhZ2VyLmNvbmZpcm0odGhpcy50aXRsZSwgcXVlc3Rpb24sIGZ1bmN0aW9uKHIpIHsKCQkJaWYgKG9wdGlvbnMpIHsKCQkJCWZvciAodmFyIGkgPSAwOyBpIDwgb3B0aW9ucy5sZW5ndGg7IGkrKykgewoJCQkJCWlmIChvcHRpb25zW2ldLmFuc3dlciA9PSByKSB7CgkJCQkJCXJldHVybiBmQW5zd2VyKG9wdGlvbnNbaV0udmFsdWUpOwoJCQkJCX0KCQkJCX0KCQkJfSBlbHNlIHsKCQkJCXJldHVybiBmQW5zd2VyKHIpOwoJCQl9CgkJfSk7Cgl9CgoJdG9wRGF0YShhciwgZ0ZpZWxkLCB2RmllbGQsIHRvcCkgewoJCWlmICghdG9wKSB7CgkJCXJldHVybiBhcjsKCQl9CgkJcmV0ID0gW107CgkJJC5lYWNoKHRoaXMuc3IoKS5ncm91cEJ5KGFyLCBnRmllbGQpLCBmdW5jdGlvbihrZXksIHZhbHVlcykgewoJCQl2YWx1ZXMudmFsdWVzLnNvcnQoKGEsIGIpID0+IHsKCQkJCWlmIChwYXJzZUZsb2F0KGFbdkZpZWxkXSkgPCBwYXJzZUZsb2F0KGJbdkZpZWxkXSkpIHsKCQkJCQlyZXR1cm4gMTsKCQkJCX0gZWxzZSBpZiAocGFyc2VGbG9hdChhW3ZGaWVsZF0pID4gcGFyc2VGbG9hdChiW3ZGaWVsZF0pKSB7CgkJCQkJcmV0dXJuIC0xOwoJCQkJfSBlbHNlIHsKCQkJCQlyZXR1cm4gMDsKCQkJCX0KCQkJfSk7CgkJCSQuZWFjaCh2YWx1ZXMudmFsdWVzLCBmdW5jdGlvbihpLCB2KSB7CgkJCQlpZiAoaSA8IHRvcCkgewoJCQkJCXJldC5wdXNoKHYpOwoJCQkJfQoJCQl9KTsKCQl9KTsKCQlyZXR1cm4gcmV0OwoJfQoKCWFzeW5jIGRvQ2xpY2soYnV0dG9uKSB7CgkJbGV0IF90aGlzID0gdHlwZW9mKHRoaXMuZG9DbGljaykgPT09ICdmdW5jdGlvbicgPyB0aGlzIDogd2luZG93LkRGb3JtOwoJCWJ1dHRvbiA9IF90aGlzLmJ1dHRvbnMuZmluZChiID0+IGIubmFtZSA9PSBidXR0b24ubmFtZSAmJiBiLmdyb3VwID09IGJ1dHRvbi5ncm91cCk7CgkJX3RoaXMuYnVzeSh0cnVlKTsKCQlfdGhpcy5zZXQoewoJCQlXb3JrUHJvZ3Jlc3NWYWx1ZTogMjAKCQl9KQoKCQl2YXIgbyA9IF90aGlzLmdldCgpOwoJCXZhciBzTWlzc2luZyA9IF90aGlzLmVsZW1lbnRzLmZpbHRlcihlID0+IChidXR0b24ud2luZG93ID8gYnV0dG9uLmdyb3VwID09IGUuZ3JvdXAgOiB0cnVlKSkuZmlsdGVyKGUgPT4gZS5yZXF1aXJlZCAmJiAhb1tlLm5hbWVdKS5tYXAoZSA9PiAiPGxpPiIgKyAoZS5sYWJlbCB8fCBlLm5hbWUpICsgIjwvbGk+Iikuam9pbigiIik7CgkJaWYgKHNNaXNzaW5nKSB7CgkJCXdpbmRvdy5fRnJFTUQuX2Vycm9yKCJNaXNzaW5nIG1hbmRhdG9yeSBmaWVsZHM6PGJyLz48dWw+IiArIHNNaXNzaW5nICsgIjwvdWw+IiwgNTAwMCk7CgkJCV90aGlzLmJ1c3koZmFsc2UpOwoJCQlyZXR1cm47CgkJfQoJCWlmIChidXR0b24ub25jbGljaykgYXdhaXQgYnV0dG9uLm9uY2xpY2sobyk7CgkJaWYgKGJ1dHRvbi5vbkNsaWNrKSBhd2FpdCBidXR0b24ub25DbGljayhvKTsKCQlfdGhpcy5idXN5KGZhbHNlKTsKCX0KCglidXN5KGJCdXN5KSB7CgkJaWYgKCFiQnVzeSkgewoJCQl2YXIgdG90YWwgPSAwOwoJCQlpZiAodHlwZW9mIG1vbWVudCAhPT0gJ3VuZGVmaW5lZCcpIHsKCQkJCXRvdGFsID0gbW9tZW50KCkuZGlmZihtb21lbnQodGhpcy5idXN5U3RhbXApLCAnc2Vjb25kcycpOwoJCQl9IGVsc2UgewoJCQkJLy8gbm8gbW9tZW50LCB1c2Ugc3RhbmRhcmQgRGF0ZQoJCQkJdG90YWwgPSAobmV3IERhdGUoKS5nZXRUaW1lKCkgLSB0aGlzLmJ1c3lTdGFtcCA/IHRoaXMuYnVzeVN0YW1wLmdldFRpbWUoKSA6IDApIC8gMTAwMCAvIDM2MDA7CgkJCX0KCQkJaWYgKHRoaXMuYkRlYnVnKSB7CgkJCQl3aW5kb3cuX0ZyRU1ELl9hbGVydCgiRXhlY3V0aW9uIFRpbWU6ICIgKyB0b3RhbCArICIgc2Vjb25kcy4iKTsKCQkJfQoJCQlkZWxldGUgdGhpcy5idXN5U3RhbXA7CgoJCQlzZXRJbnRlcnZhbCgxLCAoKSA9PiB0aGlzLlNldCh7CgkJCQlMb2FkaW5nOiAxMAoJCQl9KSk7CgkJfSBlbHNlIHsKCQkJdGhpcy5idXN5U3RhbXAgPSBuZXcgRGF0ZSgpOwoJCX0KCgkJJC5lYWNoKCQubWVyZ2UoJC5tYXAodGhpcy5idXR0b25zLCBiID0+IGIubmFtZSksICQubWFwKHRoaXMuZWxlbWVudHMuZmlsdGVyKGUgPT4gZS50eXBlID09ICdsaW5rJyksIGUgPT4gZS5uYW1lKSksIChfLCBlKSA9PiAkKCcjJyArIGUpLmxpbmtidXR0b24oYkJ1c3kgPyAnZGlzYWJsZScgOiAnZW5hYmxlJykpOwoJfQoKCXByZWZpeChlKSB7CgkJc3dpdGNoIChlLnR5cGUpIHsKCQkJY2FzZSAnbGFiZWwnOgoJCQkJcmV0dXJuICdsYmwnOwoJCQljYXNlICd0ZXh0JzoKCQkJY2FzZSAnc3RyaW5nJzoKCQkJY2FzZSAnc2VhcmNoJzoKCQkJY2FzZSAncGFzc3dvcmQnOgoJCQkJcmV0dXJuICd0eHQnOwoJCQljYXNlICJEYXRlVGltZSI6CgkJCWNhc2UgImRhdGV0aW1lIjoKCQkJCXJldHVybiAnZHRwJzsKCQkJY2FzZSAiaW50IjoKCQkJY2FzZSAiaW50ZWdlciI6CgkJCWNhc2UgIm51bWJlciI6CgkJCWNhc2UgImxvbmciOgoJCQljYXNlICJMb25nIjoKCQkJCXJldHVybiAnbnVkJzsKCQkJY2FzZSAnZmlsZSc6CgkJCQlyZXR1cm4gJ2ZpbCc7CgkJCWNhc2UgJ2ltYWdlJzoKCQkJCXJldHVybiAnaW1nJzsKCQkJY2FzZSAiYm9vbCI6CgkJCQlyZXR1cm4gJ2Noayc7CgkJCWNhc2UgIndpbmRvdyI6CgkJCQlyZXR1cm4gJ3BubCc7CgkJCWNhc2UgInByb2dyZXNzIjoKCQkJCXJldHVybiAncHJnJzsKCQkJY2FzZSAiZ3JpZCI6CgkJCWNhc2UgInRyZWUiOgoJCQljYXNlICJzZWxlY3QiOgoJCQkJcmV0dXJuICdjbWInOwoJCQlkZWZhdWx0OgoJCQkJcmV0dXJuICcnOwoJCX0KCX0KCgljbGVhcihncm91cCkgewoJCXZhciBvID0ge307CgkJJC5lYWNoKHRoaXMuZWxlbWVudHMuZmlsdGVyKGUgPT4gZ3JvdXAgPyBlLmdyb3VwID09IGdyb3VwIDogdHJ1ZSksIChfLCBlKSA9PiB7CgkJCXZhciBuYW1lID0gKGUuZW1zU291cmNlID8gIl8iIDogIiIpICsgZS5uYW1lOwoJCQlzd2l0Y2ggKGUudHlwZSkgewoJCQkJY2FzZSAndGV4dCc6CgkJCQljYXNlICdzdHJpbmcnOgoJCQkJY2FzZSAnc2VhcmNoJzoKCQkJCWNhc2UgJ3Bhc3N3b3JkJzoKCQkJCWNhc2UgIkRhdGVUaW1lIjoKCQkJCWNhc2UgImRhdGV0aW1lIjoKCQkJCQlvW25hbWVdID0gIiI7CgkJCQkJYnJlYWs7CgkJCQljYXNlICJpbnQiOgoJCQkJY2FzZSAibnVtYmVyIjoKCQkJCWNhc2UgImludGVnZXIiOgoJCQkJY2FzZSAibG9uZyI6CgkJCQljYXNlICJMb25nIjoKCQkJCWNhc2UgInByb2dyZXNzIjoKCQkJCQlvW25hbWVdID0gMDsKCQkJCQlicmVhazsKCQkJCWNhc2UgInRyZWUiOgoJCQkJY2FzZSAic2VsZWN0IjoKCQkJCQlvW25hbWVdID0gbnVsbDsKCQkJCQlicmVhazsKCQkJCWNhc2UgImdyaWQiOgoJCQkJCW9bbmFtZV0gPyBvW25hbWVdLmRhdGEgPSBbXSA6IG51bGw7CgkJCQkJYnJlYWs7CgkJCQljYXNlICJib29sIjoKCQkJCQlvW25hbWVdID0gZmFsc2U7CgkJCQkJYnJlYWs7CgkJCQlkZWZhdWx0OgoJCQkJCWJyZWFrOwoJCQl9CgkJfSk7CgkJLy9jb25zb2xlLmxvZygiY2xlYXIiLCBvKTsKCQl0aGlzLnNldChvKTsKCQl0aGlzLmJ1c3koZmFsc2UpOwoJfQoKCXNldChvLCBlTmFtZSkgewoJCWlmIChlTmFtZSkgewoJCQl2YXIgb0VsZW1lbnQgPSB0aGlzLmJ5TmFtZShlTmFtZSk7CgkJCWlmICghb0VsZW1lbnQpIHJldHVybjsKCQkJdmFyIGF0dCA9IG51bGw7CgkJCWlmIChvICYmIG8uSWQgJiYgby5FbnRpdHlBdHRyaWJ1dGUpIHsKCQkJCS8vIGFuIEVudGl0eVZhbHVlCgkJCQlmb3IgKHZhciBwIGluIG8pCgkJCQkJaWYgKHAuZW5kc1dpdGgoIlZhbHVlIikpIGF0dCA9IHA7CgkJCQlvRWxlbWVudC5lbXNTb3VyY2UgPSBvOwoJCQl9CgkJCXRyeSB7CgkJCQlsZXQgZU5hbWUgPSAiIyIgKyB0aGlzLnByZWZpeChvRWxlbWVudCkgKyBvRWxlbWVudC5uYW1lOwoJCQkJbGV0IGVUeXBlID0gdGhpcy51aVR5cGVzW29FbGVtZW50LnR5cGVdOwoJCQkJLy8gY29uc29sZS5sb2coIkR5bmFGb3JtOjpzZXQoIiArIG9FbGVtZW50Lm5hbWUgKyAiKTogIiwgZU5hbWUsIGVUeXBlLCBvKTsKCQkJCXN3aXRjaCAob0VsZW1lbnQudHlwZSkgewoJCQkJCWNhc2UgJ2xhYmVsJzoKCQkJCQkJaWYgKGF0dCkgewoJCQkJCQkJJChlTmFtZSkuaHRtbChvW2F0dF0pOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJJChlTmFtZSkuaHRtbCgobyAmJiBvLkVudGl0eUF0dHJpYnV0ZSkgPyAiIiA6IG8pOwoJCQkJCQl9CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgJ3RleHQnOgoJCQkJCWNhc2UgJ3N0cmluZyc6CgkJCQkJY2FzZSAncGFzc3dvcmQnOgoJCQkJCWNhc2UgImludCI6CgkJCQkJY2FzZSAic2VhcmNoIjoKCQkJCQljYXNlICJpbnRlZ2VyIjoKCQkJCQljYXNlICJudW1iZXIiOgoJCQkJCWNhc2UgImxvbmciOgoJCQkJCWNhc2UgIkxvbmciOgoJCQkJCQlpZiAoYXR0KSB7CgkJCQkJCQkkKGVOYW1lKVtlVHlwZV0oInNldFZhbHVlIiwgb1thdHRdKTsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCSQoZU5hbWUpW2VUeXBlXSgic2V0VmFsdWUiLCAobyAmJiBvLkVudGl0eUF0dHJpYnV0ZSkgPyAiIiA6IG8pOwoJCQkJCQl9CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgIkRhdGVUaW1lIjoKCQkJCQljYXNlICJkYXRldGltZSI6CgkJCQkJCWlmIChhdHQpIHsKCQkJCQkJCSQoZU5hbWUpW2VUeXBlXSgnc2V0VmFsdWUnLCAob1thdHRdID8gdGhpcy5zcigpLnRvRGF0ZVRpbWUob1thdHRdKSA6ICIiKSk7CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQkkKGVOYW1lKVtlVHlwZV0oJ3NldFZhbHVlJywgKG8gJiYgby5FbnRpdHlBdHRyaWJ1dGUpID8gIiIgOiAobyA/IHRoaXMuc3IoKS50b0RhdGVUaW1lKG8pIDogIiIpKTsKCQkJCQkJfQoJCQkJCQlicmVhazsKCQkJCQljYXNlICJib29sIjoKCQkJCQkJaWYgKGF0dCkgewoJCQkJCQkJJChlTmFtZSlbZVR5cGVdKChvW2F0dF0gPyAnJyA6ICd1bicpICsgJ2NoZWNrJyk7CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQkkKGVOYW1lKVtlVHlwZV0oKCgobyAmJiBvLkVudGl0eUF0dHJpYnV0ZSkgPyAiIiA6IG8pID8gJycgOiAndW4nKSArICdjaGVjaycpOwoJCQkJCQl9CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgIndpbmRvdyI6CgkJCQkJCWlmIChhdHQpIHsKCQkJCQkJCW9FbGVtZW50LnZhbHVlID0gb1thdHRdOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJb0VsZW1lbnQudmFsdWUgPSAobyAmJiBvLkVudGl0eUF0dHJpYnV0ZSkgPyAiIiA6IG87CgkJCQkJCX0KCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAicHJvZ3Jlc3MiOgoJCQkJCQl2YXIgdiA9IDA7CgkJCQkJCWlmIChhdHQpIHsKCQkJCQkJCXYgPSBvW2F0dF07CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQl2ID0gKG8gJiYgby5FbnRpdHlBdHRyaWJ1dGUpID8gIiIgOiBvOwoJCQkJCQl9CgkJCQkJCS8vY29uc29sZS5sb2coIiMiICsgdGhpcy5wcmVmaXgob0VsZW1lbnQpICsgb0VsZW1lbnQubmFtZSwgdGhpcy51aVR5cGVzW29FbGVtZW50LnR5cGVdLCBNYXRoLnJvdW5kKHYgKiAxMCkgLyAxMCk7CgkJCQkJCSQoZU5hbWUpW2VUeXBlXSgnc2V0VmFsdWUnLCBNYXRoLnJvdW5kKHYgKiAxMCkgLyAxMCk7CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgImdyaWQiOgoJCQkJCQlsZXQgY29scyA9IEpTT04ucGFyc2UoInsiICsgdGhpcy5tYXBDb2x1bW5zKG9FbGVtZW50LCB0cnVlKSArICJ9Iik7CgkJCQkJCSQuZWFjaChjb2xzLmNvbHVtbnNbMF0sIChfLCBjKSA9PiBjLmZvcm1hdHRlciA9IHRoaXMuc3IoKS5ydW5TY3JpcHQodGhpcy5mb3JtYXR0ZXIob0VsZW1lbnQubmFtZSwgYykpKTsKCQkJCQkJJChlTmFtZSkuZGF0YWdyaWQoY29scyk7CgkJCQkJCWlmIChhdHQpIHsKCQkJCQkJCSQoZU5hbWUpLmRhdGFncmlkKHsKCQkJCQkJCQlkYXRhOiBvW2F0dF0KCQkJCQkJCX0pOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJJChlTmFtZSkuZGF0YWdyaWQoewoJCQkJCQkJCWRhdGE6IChvICYmIG8uRW50aXR5QXR0cmlidXRlKSA/ICIiIDogbwoJCQkJCQkJfSk7CgkJCQkJCX0KCQkJCQkJJChlTmFtZSkuZGF0YWdyaWQoInVuc2VsZWN0QWxsIik7CgkJCQkJCSQoZU5hbWUpLmRhdGFncmlkKCk7CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgInRyZWUiOgoJCQkJCQl2YXIgdiA9IGF0dCA/IG9bYXR0XSA6ICgobyAmJiBvLkVudGl0eUF0dHJpYnV0ZSkgPyAiIiA6IG8pOwoJCQkJCQlpZiAoQXJyYXkuaXNBcnJheSh2KSkgewoJCQkJCQkJJChlTmFtZSlbZVR5cGVdKCJ0cmVlIikudHJlZSgibG9hZERhdGEiLCB2KTsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCSQoZU5hbWUpW2VUeXBlXSgnc2V0VmFsdWUnLCB2KTsKCQkJCQkJfQoJCQkJCQlicmVhazsKCQkJCQljYXNlICJzZWxlY3QiOgoJCQkJCQlpZiAoYXR0KSB7CgkJCQkJCQlpZiAob0VsZW1lbnQub3B0aW9ucykgewoJCQkJCQkJCSQoZU5hbWUpLmNvbWJvKCdzZXRWYWx1ZScgKyAob0VsZW1lbnQubXVsdGlwbGUgPyAncycgOiAnJyksIChvW2F0dF0gPyBvW2F0dF0gOiAiIikpOwoJCQkJCQkJCSQoZU5hbWUpLmNvbWJvKCdzZXRWYWx1ZScgKyAob0VsZW1lbnQubXVsdGlwbGUgPyAncycgOiAnJyksIChvW2F0dF0gPyBvW2F0dF0gOiAiIikpOwoJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQkkKGVOYW1lKS5jb21ib2dyaWQoJ3NldFZhbHVlJyArIChvRWxlbWVudC5tdWx0aXBsZSA/ICdzJyA6ICcnKSwgKG9bYXR0XSA/IG9bYXR0XSA6ICIiKSk7CgkJCQkJCQl9CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQl2ID0gbnVsbDsKCQkJCQkJCWlmIChvID09PSBudWxsKSB7CgoJCQkJCQkJfSBlbHNlIGlmIChvLmNvbnN0cnVjdG9yID09PSBBcnJheSkgewoKCQkJCQkJCX0gZWxzZSBpZiAoIW8uRW50aXR5QXR0cmlidXRlKSB7CgkJCQkJCQkJdiA9IG8gfHwgewoJCQkJCQkJCQlJZDogby5JZCwKCQkJCQkJCQkJX1RvU3RyaW5nOiBvLl9Ub1N0cmluZywKCQkJCQkJCQkJdG9TdHJpbmc6IGZ1bmN0aW9uKCkgewoJCQkJCQkJCQkJcmV0dXJuIHRoaXMuX1RvU3RyaW5nOwoJCQkJCQkJCQl9CgkJCQkJCQkJfTsKCQkJCQkJCX0KCQkJCQkJCWlmIChvRWxlbWVudC5vcHRpb25zKSB7CgkJCQkJCQkJJChlTmFtZSkuY29tYm8oJ3NldFZhbHVlJyArIChvRWxlbWVudC5tdWx0aXBsZSA/ICdzJyA6ICcnKSwgdik7CgkJCQkJCQkJJChlTmFtZSkuY29tYm8oJ3NldFRleHQnICsgKG9FbGVtZW50Lm11bHRpcGxlID8gJ3MnIDogJycpLCB2KTsKCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJJChlTmFtZSkuY29tYm9ncmlkKCdzZXRWYWx1ZScgKyAob0VsZW1lbnQubXVsdGlwbGUgPyAncycgOiAnJyksIHYpOwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJCWJyZWFrOwoJCQkJCWRlZmF1bHQ6CgkJCQkJCWJyZWFrOwoJCQkJfQoJCQl9IGNhdGNoIChleCkgewoJCQkJY29uc29sZS5sb2coZXgpOwoJCQl9CgkJfSBlbHNlIHsKCQkJZm9yICh2YXIgcCBpbiBvKSB7CgkJCQlpZiAocC5pbmRleE9mKCdfJykgPT09IDApIHAgPSBwLnN1YnN0cmluZygxKTsKCQkJCXZhciBlID0gdGhpcy5ieU5hbWUocCk7CgkJCQlpZiAoIWUgfHwgIWUubmFtZSkgY29udGludWU7CgkJCQl2YXIgdmFsdWUgPSBvW3BdOwoJCQkJaWYgKGUubmFtZSA9PSB0aGlzLnNUYWJsZSkgewoJCQkJCXZhbHVlID0gbzsKCQkJCQl2YWx1ZS5EYXRlID0gbmV3IERhdGUoKTsKCQkJCX0KCQkJCWlmIChwID09ICJFbnRpdHlWYWx1ZXMiKSB7CgkJCQkJLy8gYW4gZW1zRm9ybVZhbHVlcyBzb3VyY2UKCQkJCQkvLyBmaW5kIHRoZSBFbnRpdHlWYWx1ZSBmb3IgdGhpcyBlbGVtZW50IGFuZCBzZXQgaXQKCQkJCQlmb3IgKHZhciBqID0gMDsgaiA8IG8uRW50aXR5VmFsdWVzLmxlbmd0aDsgaisrKSB7CgkJCQkJCWlmIChvLkVudGl0eVZhbHVlc1tqXS5FbnRpdHlBdHRyaWJ1dGUuTmFtZSA9PSBlLm5hbWUpIHsKCQkJCQkJCS8vIGZvdW5kIHRoZSBFbnRpdHlWYWx1ZSBmb3IgdGhpcyBlbGVtZW50CgkJCQkJCQlfdiA9IG8uRW50aXR5VmFsdWVzW2pdOwoJCQkJCQkJZm9yICh2YXIgcSBpbiBfdikgewoJCQkJCQkJCWlmIChxLmVuZHNXaXRoKCJWYWx1ZSIpKSB7CgkJCQkJCQkJCV92W3FdID0gdmFsdWU7CgkJCQkJCQkJfQoJCQkJCQkJfQoJCQkJCQkJYnJlYWs7CgkJCQkJCX0KCQkJCQl9CgkJCQl9CgkJCQl0aGlzLnNldCh2YWx1ZSwgZS5uYW1lKTsKCQkJfQoJCX0KCX0KCglnZXQoKSB7CgkJdmFyIG8gPSB7fTsKCQlpZiAodGhpcy5zVGFibGUgJiYgd2luZG93W3RoaXMuc1RhYmxlXSkgbyA9IG5ldyB3aW5kb3dbdGhpcy5zVGFibGVdKCk7CgkJZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7CgkJCXZhciBjbiA9IG51bGw7CgkJCXZhciB2ID0gbnVsbDsKCQkJdHJ5IHsKCQkJCWxldCBlTmFtZSA9ICIjIiArIHRoaXMucHJlZml4KHRoaXMuZWxlbWVudHNbaV0pICsgdGhpcy5lbGVtZW50c1tpXS5uYW1lOwoJCQkJc3dpdGNoICh0aGlzLmVsZW1lbnRzW2ldLnR5cGUpIHsKCQkJCQljYXNlICdsYWJlbCc6CgkJCQkJCWNuID0gJChlTmFtZSk7CgkJCQkJCXYgPSBjbi5odG1sKCk7CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgJ3RleHQnOgoJCQkJCWNhc2UgJ3N0cmluZyc6CgkJCQkJY2FzZSAnc2VhcmNoJzoKCQkJCQljYXNlICdwYXNzd29yZCc6CgkJCQkJCWNuID0gJChlTmFtZSk7CgkJCQkJCXYgPSBjbi52YWwoKTsKCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAiZmlsZSI6CgkJCQkJY2FzZSAiaW1hZ2UiOgoJCQkJCQljbiA9ICQoZU5hbWUpOwoJCQkJCQl2ID0gdGhpcy5lbGVtZW50c1tpXS5kYXRhOwoJCQkJCQlicmVhazsKCQkJCQljYXNlICJEYXRlVGltZSI6CgkJCQkJY2FzZSAiZGF0ZXRpbWUiOgoJCQkJCQl2ID0gbmV3IERhdGUoJChlTmFtZSkuZGF0ZXRpbWVib3goJ2dldFZhbHVlJykpOwoJCQkJCQljbiA9ICQoZU5hbWUpOwoJCQkJCQlicmVhazsKCQkJCQljYXNlICJwcm9ncmVzcyI6CgkJCQkJCWNuID0gJChlTmFtZSk7CgkJCQkJCXYgPSBjbi5wcm9ncmVzc2JhcignZ2V0VmFsdWUnKTsKCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAiaW50IjoKCQkJCQljYXNlICJpbnRlZ2VyIjoKCQkJCQljYXNlICJudW1iZXIiOgoJCQkJCWNhc2UgImxvbmciOgoJCQkJCWNhc2UgIkxvbmciOgoJCQkJCQljbiA9ICQoZU5hbWUpOwoJCQkJCQl2ID0gcGFyc2VGbG9hdChjbi52YWwoKSk7CgkJCQkJCWlmIChpc05hTih2KSkgdiA9IDA7CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgImdyaWQiOgoJCQkJCQljbiA9ICQoZU5hbWUpOwoJCQkJCQl2ID0gY24uZGF0YWdyaWQoJ2dldERhdGEnKTsKCQkJCQkJdi5zZWxlY3RlZCA9IGNuLmRhdGFncmlkKCJnZXRTZWxlY3RlZCIpOwoJCQkJCQlicmVhazsKCQkJCQljYXNlICJ0cmVlIjoKCQkJCQkJY24gPSAkKGVOYW1lKTsKCQkJCQkJdiA9IGNuLmNvbWJvdHJlZSgidHJlZSIpLnRyZWUoImdldFNlbGVjdGVkIik7CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgIndpbmRvdyI6CgkJCQkJCXYgPSB0aGlzLmVsZW1lbnRzW2ldLnZhbHVlOwoJCQkJCQlicmVhazsKCQkJCQljYXNlICJzZWxlY3QiOgoJCQkJCQlpZiAodGhpcy5lbGVtZW50c1tpXS5vcHRpb25zKSB7CgkJCQkJCQl2ID0gJChlTmFtZSkuY29tYm9ncmlkKCdnZXRWYWx1ZScgKyAodGhpcy5lbGVtZW50c1tpXS5tdWx0aXBsZSA/ICdzJyA6ICcnKSk7CgkJCQkJCQl2ID0gdGhpcy5zcigpLnJ1blNjcmlwdCh2KTsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCXYgPSAkKGVOYW1lKS5jb21ib2dyaWQoJ2dyaWQnKS5kYXRhZ3JpZCgnZ2V0U2VsZWN0aW9ucycpOwoJCQkJCQkJaWYgKCF2IHx8ICF2Lmxlbmd0aCkgewoJCQkJCQkJCXYgPSAkKGVOYW1lKS5jb21ib2dyaWQoJ2dldFZhbHVlJyArICh0aGlzLmVsZW1lbnRzW2ldLm11bHRpcGxlID8gJ3MnIDogJycpKTsKCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJaWYgKCF0aGlzLmVsZW1lbnRzW2ldLm11bHRpcGxlKSB2ID0gdlswXTsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCQljbiA9ICQoZU5hbWUpOwoJCQkJCQlicmVhazsKCQkJCQljYXNlICJib29sIjoKCQkJCQkJY24gPSAkKGVOYW1lKTsKCQkJCQkJdiA9IGNuLnN3aXRjaGJ1dHRvbignb3B0aW9ucycpLmNoZWNrZWQ7CgkJCQkJCWJyZWFrOwoJCQkJCWRlZmF1bHQ6CgkJCQkJCWJyZWFrOwoJCQkJfQoJCQkJb1t0aGlzLmVsZW1lbnRzW2ldLm5hbWVdKHYpOwoJCQl9IGNhdGNoIChlKSB7CgkJCQkvL2NvbnNvbGUubG9nKHRoaXMuZWxlbWVudHNbaV0ubmFtZSwgZSk7CgkJCQlvW3RoaXMuZWxlbWVudHNbaV0ubmFtZV0gPSB2OwoJCQl9CgkJCWlmIChjbikgewoJCQkJaWYgKG8uRW50aXR5VmFsdWVzKSB7CgkJCQkJZm9yICh2YXIgaiA9IDA7IGogPCBvLkVudGl0eVZhbHVlcy5sZW5ndGg7IGorKykgewoJCQkJCQlpZiAodGhpcy5lbGVtZW50c1tpXS5uYW1lID09IHRoaXMuc1RhYmxlICYmIHRoaXMuZWxlbWVudHNbaV0uZW1zU291cmNlKSBvLklkID0gdGhpcy5lbGVtZW50c1tpXS5lbXNTb3VyY2UuSWQ7CgkJCQkJCWlmIChvLkVudGl0eVZhbHVlc1tqXS5FbnRpdHlBdHRyaWJ1dGUuTmFtZSA9PSB0aGlzLmVsZW1lbnRzW2ldLm5hbWUgJiYgdGhpcy5lbGVtZW50c1tpXS5lbXNTb3VyY2UpIHsKCQkJCQkJCW8uRW50aXR5VmFsdWVzW2pdLklkID0gdGhpcy5lbGVtZW50c1tpXS5lbXNTb3VyY2UuSWQ7CgkJCQkJCX0KCQkJCQl9CgkJCQl9CgkJCX0KCQl9CgkJcmV0dXJuIG87Cgl9CgoJY0hlaWdodChvcHRpb25zKSB7CgkJaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5lZGl0b3IpIHJldHVybiB3aW5kb3cuaW5uZXJIZWlnaHQ7CgkJaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5oZWlnaHQgJiYgdHlwZW9mKG9wdGlvbnMuaGVpZ2h0KSA9PT0gJ3N0cmluZycpIHJldHVybiB0aGlzLmhlaWdodDsKCQlpZiAob3B0aW9ucyAmJiBvcHRpb25zLnR5cGUgPT0gJ3dpbmRvdycgJiYgIW9wdGlvbnMuaGVpZ2h0KSByZXR1cm4gdGhpcy5oZWlnaHQgKiAwLjk7CgkJcmV0dXJuIE1hdGguZmxvb3IoKChvcHRpb25zID8gb3B0aW9ucy5oZWlnaHQgOiBudWxsKSB8fCAodGhpcy5oZWlnaHQgLyAzKSkpOwoJfQoKCXNlYXJjaChvcHRpb25zKSB7CgkJcmV0dXJuIHRoaXMuc3RyaW5nKG9wdGlvbnMpOwoJfQoKCXN0cmluZyhvcHRpb25zKSB7CgkJb3B0aW9ucy5oZWlnaHQgPSAyMDsKCQlvcHRpb25zLnNpbXBsZSA9IHRydWU7CgkJcmV0dXJuIHRoaXMudGV4dChvcHRpb25zKTsKCX0KCglkYXRldGltZShvcHRpb25zKSB7CgkJcmV0dXJuIGA8aW5wdXQgaWQ9ImR0cCR7b3B0aW9ucy5uYW1lfSIgY2xhc3M9ImVhc3l1aS0ke3RoaXMudWlUeXBlc1tvcHRpb25zLnR5cGVdfSIgcmVxdWlyZWQ9IiR7b3B0aW9ucy5yZXF1aXJlZCA/ICd0cnVlJyA6ICdmYWxzZSd9IiB2YWx1ZT0iJHt0aGlzLnZhbHVlKG9wdGlvbnMpfSIgc3R5bGU9IndpZHRoOiR7dGhpcy5jV2lkdGgob3B0aW9ucyl9cHgiPmA7Cgl9CgoJcXVlcnkob3B0aW9ucykgewoJCXJldHVybiAiPGRpdiBpZD0ndnMiICsgb3B0aW9ucy5uYW1lICsgIic+PC9kaXY+IjsKCX0KCglEYXRlVGltZShvcHRpb25zKSB7CgkJcmV0dXJuIHRoaXMuZGF0ZXRpbWUob3B0aW9ucyk7Cgl9CgoJbG9uZyhvcHRpb25zKSB7CgkJcmV0dXJuIHRoaXMuaW50KG9wdGlvbnMpOwoJfQoKCUxvbmcob3B0aW9ucykgewoJCXJldHVybiB0aGlzLmxvbmcob3B0aW9ucyk7Cgl9CgoJdmFsdWUob3B0aW9ucykgewoJCWlmICh0eXBlb2Ygb3B0aW9ucy52YWx1ZSA9PT0gJ2Z1bmN0aW9uJykgewoJCQl0cnkgewoJCQkJcmV0dXJuIG9wdGlvbnMudmFsdWUodGhpcy5nZXQoKSk7CgkJCX0gY2F0Y2ggKGV4KSB7CgkJCQljb25zb2xlLmxvZyhgREZvcm0udmFsdWUoJHtvcHRpb25zLm5hbWV9KTogJHtleH1gKTsKCQkJCXJldHVybiAnJzsKCQkJfQoJCX0gZWxzZSB7CgkJCXN3aXRjaCAob3B0aW9ucy50eXBlKSB7CgkJCQljYXNlICdpbnQnOgoJCQkJY2FzZSAncHJvZ3Jlc3MnOgoJCQkJCXJldHVybiBvcHRpb25zLnZhbHVlIHx8IG9wdGlvbnMubWluIHx8IDA7CgkJCQljYXNlICdzdHJpbmcnOgoJCQkJY2FzZSAndGV4dCc6CgkJCQljYXNlICdkYXRldGltZSc6CgkJCQljYXNlICdsYWJlbCc6CgkJCQkJcmV0dXJuIG9wdGlvbnMudmFsdWUgfHwgIiI7CgkJCQlkZWZhdWx0OgoJCQkJCXJldHVybiBvcHRpb25zLnZhbHVlOwoJCQl9CgkJfQoJfQoKCWludChvcHRpb25zKSB7CgkJbGV0IHJldCA9IGA8aW5wdXQgaWQ9Im51ZCR7b3B0aW9ucy5uYW1lfSIgY2xhc3M9ImVhc3l1aS0ke3RoaXMudWlUeXBlc1tvcHRpb25zLnR5cGVdfSIgcmVxdWlyZWQ9IiR7b3B0aW9ucy5yZXF1aXJlZCA/ICd0cnVlJyA6ICdmYWxzZSd9IiB2YWx1ZT0iJHt0aGlzLnZhbHVlKG9wdGlvbnMpfSIgZGF0YS1vcHRpb25zPSJtaW46JHtvcHRpb25zLm1pbiB8fCAwfSxtYXg6JHtvcHRpb25zLm1heCB8fCAxMDB9LGluY3JlbWVudDoke29wdGlvbnMuaW5jcmVtZW50IHx8IDF9IiBzdHlsZT0id2lkdGg6JHt0aGlzLmNXaWR0aChvcHRpb25zKX1weDsiPjwvaW5wdXQ+YDsKCQkvL2NvbnNvbGUubG9nKHJldCk7CgkJcmV0dXJuIHJldDsKCX0KCgltZW51KG9wdGlvbnMpIHsKCQlvcHRpb25zLnR5cGUgPSBvcHRpb25zLnR5cGUgfHwgJ21lbnUnOwoJCXZhciByZXQgPSAiIjsKCQlyZXQgKz0gJzxkaXYgY2xhc3M9ImVhc3l1aS1wYW5lbCIgaWQ9Im1udScgKyBvcHRpb25zLm5hbWUgKyAnIiBzdHlsZT0icGFkZGluZzo1cHg7Ij5cbic7CgkJJC5lYWNoKG9wdGlvbnMubWVudSwgKF8sIG0pID0+IHJldCArPSBgPGEgaHJlZj0iIyIgY2xhc3M9ImVhc3l1aS0ke3RoaXMudWlUeXBlc1tvcHRpb25zLnR5cGVdfSIgZGF0YS1vcHRpb25zPSJtZW51OicjbW0ke20ubGFiZWwucmVwbGFjZSgvIC9nLCAnJyl9JyxpY29uQ2xzOidpY29uLSR7bS5pY29uIHx8ICdub25lJ30nIj4ke20ubGFiZWx9PC9hPlxuYCk7CgkJcmV0ICs9ICI8L2Rpdj5cbiI7CgoJCWxldCBkdiA9IG0gPT4gewoJCQlsZXQgcmV0ID0gJzxkaXYnICsgKG0uc3ViTWVudXMgPyAnJyA6IGAgZGF0YS1vcHRpb25zPSJpY29uQ2xzOidpY29uLSR7bS5pY29uIHx8ICdub25lJ30nImApICsgJz5cbic7CgkJCXJldCArPSBtLnN1Yk1lbnVzID8gJzxzcGFuPicgKyAobS5sYWJlbCB8fCB0aGlzLmVuZ2xpc2gobS5jb2RlKSkgKyAnPC9zcGFuPlxuPGRpdj4nIDogKGA8c3BhbiB3aWR0aD0nMTAwJScgb25jbGljaz0nKGFzeW5jICgpID0+IHtsZXQgbSA9ICR7X0ZyRU1ELl90b0pTKG0pfTsgaWYobS5hY3Rpb24pe3JldHVybiBhd2FpdCBtLmFjdGlvbihERm9ybS5nZXQoKSwgbSk7fSBpZiAobS5zdWJNZW51cykgcmV0dXJuOyBhd2FpdCBfRnJFTUQuUmVuZGVyUGFnZSh7X2NvZGU6IG0uY29kZSB8fCBtLmxhYmVsLnJlcGxhY2UoLyAvZywgIiIpLnRvTG93ZXJDYXNlKCl9LCBtLmRhdGEpO30pKCknPiR7bS5sYWJlbCB8fCB0aGlzLmVuZ2xpc2gobS5jb2RlKX08L3NwYW4+YCk7CgkJCSQuZWFjaChtLnN1Yk1lbnVzLCAoXywgcykgPT4gcmV0ICs9IGR2KHMpKTsKCQkJcmV0ICs9IChtLnN1Yk1lbnVzID8gIjwvZGl2PlxuIiA6ICIiKSArIGA8L2Rpdj5cbmA7CgkJCXJldHVybiByZXQ7CgkJfTsKCgkJcmV0ICs9IG9wdGlvbnMubWVudS5zb3J0KChhLCBiKSA9PiBhLm9yZGVyIC0gYi5vcmRlcikubWFwKG0gPT4gYDxkaXYgaWQ9Im1tJHttLmxhYmVsLnJlcGxhY2UoLyAvZywgJycpfSIgc3R5bGU9IndpZHRoOjE1MHB4OyI+JHttLnN1Yk1lbnVzLm1hcChzbSA9PiBkdihzbSkpLmpvaW4oJycpfTwvZGl2PmApLmpvaW4oJ1xuJyk7CgoJCS8qZm9yICh2YXIgaSA9IDA7IGkgPCBvcHRpb25zLm1lbnUubGVuZ3RoOyBpKyspIHsKCQkJdmFyIG0gPSBvcHRpb25zLm1lbnVbaV07CgkJCXJldCArPSAnPGRpdiBpZD0ibW0nICsgbS5sYWJlbC5yZXBsYWNlKC8gL2csICcnKSArICciIHN0eWxlPSJ3aWR0aDoxNTBweDsiPic7CgkJCWZvciAodmFyIGogPSAwOyBqIDwgbS5zdWJNZW51cy5sZW5ndGg7IGorKykgewoJCQkJdmFyIHNtID0gbS5zdWJNZW51c1tqXTsKCQkJCXJldCArPSBkdihzbSk7CgkJCX0KCQkJcmV0ICs9ICc8L2Rpdj5cbic7CgkJfSovCgoJCXJldHVybiByZXQ7Cgl9CgoJaW50ZWdlcihvcHRpb25zKSB7CgkJcmV0dXJuIHRoaXMuaW50KG9wdGlvbnMpOwoJfQoKCW51bWJlcihvcHRpb25zKSB7CgkJcmV0dXJuIHRoaXMuaW50KG9wdGlvbnMpOwoJfQoKCUludGVnZXIob3B0aW9ucykgewoJCXJldHVybiB0aGlzLmludChvcHRpb25zKTsKCX0KCglib29sKG9wdGlvbnMpIHsKCQlyZXR1cm4gYDxpbnB1dCBpZD0iJHt0aGlzLnByZWZpeChvcHRpb25zKX0ke29wdGlvbnMubmFtZX0iIGRhdGEtZGZvcm09ImVsZW1lbnQ6JHtvcHRpb25zLm5hbWV9IiByZXF1aXJlZD0iJHtvcHRpb25zLnJlcXVpcmVkPyd0cnVlJzonZmFsc2UnfSIgZGF0YS1vcHRpb25zPSdkaXNhYmxlZDoke29wdGlvbnMuZGlzYWJsZWQ/J3RydWUnOidmYWxzZSd9LCR7dGhpcy5ldmVudEhhbmRsZXJzKG9wdGlvbnMpfScgY2xhc3M9ImVhc3l1aS0ke3RoaXMudWlUeXBlc1tvcHRpb25zLnR5cGVdfSIgJHtvcHRpb25zLmNoZWNrZWQ/J2NoZWNrZWQnOicnfSAvPmA7Cgl9CgoJbGFiZWwob3B0aW9ucykgewoJCXJldHVybiBgPHNwYW4gaWQ9IiR7dGhpcy5wcmVmaXgob3B0aW9ucyl9JHtvcHRpb25zLm5hbWV9IiBzdHlsZT0id2lkdGg6JHt0aGlzLmNXaWR0aChvcHRpb25zKX1weCIgZGF0YS1vcHRpb25zPSJkaXNhYmxlZDoke29wdGlvbnMuZGlzYWJsZWQ/J3RydWUnOidmYWxzZSd9Ij4ke3RoaXMudmFsdWUob3B0aW9ucyl9PC9zcGFuPmA7Cgl9CgoJdXJsKG9wdGlvbnMpIHsKCQlyZXR1cm4gdGhpcy5zdHJpbmcob3B0aW9ucykucmVwbGFjZSgiRmllbGRDaGFuZ2UiLCAiVVJMQ2hhbmdlIik7Cgl9CgoJdGV4dChvcHRpb25zKSB7CgkJcmV0dXJuIGA8aW5wdXQgaWQ9IiR7dGhpcy5wcmVmaXgob3B0aW9ucyl9JHtvcHRpb25zLm5hbWV9IiBjbGFzcz0iZWFzeXVpLSR7b3B0aW9ucy5lZGl0b3IgfHwgdGhpcy51aVR5cGVzW29wdGlvbnMudHlwZV19IiBkYXRhLW9wdGlvbnM9J2Rpc2FibGVkOiR7b3B0aW9ucy5kaXNhYmxlZD8ndHJ1ZSc6J2ZhbHNlJ30sJHt0aGlzLmV2ZW50SGFuZGxlcnMob3B0aW9ucyl9JyBtdWx0aWxpbmU9IiR7b3B0aW9ucy5zaW1wbGUgPyAnZmFsc2UnIDogJ3RydWUnfSIgc3R5bGU9IndoaXRlLXNwYWNlOnByZS13cmFwO3dpZHRoOiR7dGhpcy5jV2lkdGgob3B0aW9ucyl9cHg7aGVpZ2h0OiR7dGhpcy5jSGVpZ2h0KG9wdGlvbnMpfXB4IiByZXF1aXJlZD0iJHtvcHRpb25zLnJlcXVpcmVkID8gJ3RydWUnIDogJ2ZhbHNlJ30iIHZhbHVlPSIke3RoaXMudmFsdWUob3B0aW9ucyl9IiAvPmA7Cgl9CgoJcGFzc3dvcmQob3B0aW9ucykgewoJCXZhciByZXQgPSB0aGlzLnN0cmluZyhvcHRpb25zKTsKCQlyZXQgPSByZXQucmVwbGFjZSgnPGlucHV0ICcsICc8aW5wdXQgdHlwZT0icGFzc3dvcmQiICcpOwoJCXJldHVybiByZXQ7Cgl9CgoJZmlsZShvcHRpb25zKSB7CgkJcmV0dXJuIGA8aW5wdXQgaWQ9IiR7dGhpcy5wcmVmaXgob3B0aW9ucyl9JHtvcHRpb25zLm5hbWV9IiBjbGFzcz0iZWFzeXVpLSR7dGhpcy51aVR5cGVzW29wdGlvbnMudHlwZV19IiBkYXRhLW9wdGlvbnM9Im9uQ2hhbmdlOmZ1bmN0aW9uKG4sbyl7dmFyIHMgPSAkKCcjJyArIHRoaXMuaWQpLmZpbGVib3goJ29wdGlvbnMnKTsgREZvcm0uVXBsb2FkRmlsZShzLCBERm9ybS5ieU5hbWUoJyR7b3B0aW9ucy5uYW1lfScpKTt9IiBzdHlsZT0id2lkdGg6JHt0aGlzLmNXaWR0aChvcHRpb25zKX1weCI+YDsKCX0KCglpbWFnZShvcHRpb25zKSB7CgkJcmV0dXJuIHRoaXMuZmlsZShvcHRpb25zKSArIGA8ZGl2IGlkPSJkbGcke29wdGlvbnMubmFtZX0iIGNsYXNzPSJlYXN5dWktJHt0aGlzLnVpVHlwZXNbb3B0aW9ucy50eXBlXX0iIHRpdGxlPSJJbWFnZSBQcmV2aWV3IiBkYXRhLW9wdGlvbnM9ImNsb3NlZDp0cnVlLGljb25DbHM6J2ljb24tc2F2ZScscmVzaXphYmxlOmZhbHNlLG1vZGFsOnRydWUiIHN0eWxlPSJ3aWR0aDo0MDBweDtoZWlnaHQ6MjAwcHg7cGFkZGluZzoxMHB4Ij48aW1nIGlkPSIke3RoaXMucHJlZml4KG9wdGlvbnMpfSR7b3B0aW9ucy5uYW1lfSIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIvPjwvZGl2PmA7Cgl9CgoJcHJvZ3Jlc3Mob3B0aW9ucykgewoJCWlmICghb3B0aW9ucy5oZWlnaHQpIG9wdGlvbnMuaGVpZ2h0ID0gMjA7IC8vIGZpeCBiaWcgcHJvZ3Jlc3MKCQlyZXR1cm4gYDxkaXYgaWQ9IiR7dGhpcy5wcmVmaXgob3B0aW9ucyl9JHtvcHRpb25zLm5hbWV9IiBjbGFzcz0iZWFzeXVpLSR7dGhpcy51aVR5cGVzW29wdGlvbnMudHlwZV19IiBkYXRhLW9wdGlvbnM9InZhbHVlOiR7dGhpcy52YWx1ZShvcHRpb25zKX0iIHN0eWxlPSJ3aWR0aDoke3RoaXMuY1dpZHRoKG9wdGlvbnMpfXB4O2hlaWdodDoke3RoaXMuY0hlaWdodChvcHRpb25zKX1weCI+PC9kaXY+YDsKCX0KCglmbG93Y2hhcnQob3B0aW9ucykgewoJCXJldHVybiBgPGRpdiBpZD0iZmx3JHtvcHRpb25zLm5hbWV9IiB3aWR0aD0iJHt0aGlzLmNXaWR0aChvcHRpb25zKX0iIGhlaWdodD0iJHt0aGlzLmNIZWlnaHQob3B0aW9ucyl9Ij48L2Rpdj5gOwoJfQoKCWNoYXJ0KG9wdGlvbnMpIHsKCQlyZXR1cm4gYDxkaXYgaWQ9ImNodCR7b3B0aW9ucy5uYW1lfSIgd2lkdGg9IiR7dGhpcy5jV2lkdGgob3B0aW9ucyl9IiBoZWlnaHQ9IiR7dGhpcy5jSGVpZ2h0KG9wdGlvbnMpfSI+PC9kaXY+YDsKCX0KCglmb3JtYXR0ZXIobmFtZSwgYywganNvbikgewoJCWpzb24gPSBqc29uID8gJyInIDogJyc7CgkJcmV0dXJuIGAke2pzb259KHZhbHVlLCByb3csIGluZGV4KSA9PiB7dHJ5e3ZhciBjID0gKERGb3JtLmJ5TmFtZShcYCR7bmFtZX1cYCkuY29sdW1ucyB8fCBbXSkuZmluZChjID0+IGMuZmllbGQ9PVxgJHtjLmZpZWxkfVxgKTsgcmV0dXJuIGMmJmMuZm9ybWF0P2MuZm9ybWF0KHZhbHVlLHJvdyxpbmRleCk6dmFsdWU7fWNhdGNoKGV4KXtyZXR1cm4gdmFsdWU7fSB9JHtqc29ufWA7Cgl9CgoJbWFwQ29sdW1ucyhvcHRpb25zLCBqc29uKSB7CgkJbGV0IGNUaXRsZSA9IGMgPT4gYy50aXRsZSB8fCB0aGlzLmVuZ2xpc2goYy5maWVsZCk7CgoJCXZhciBjb2xzID0gJC5ncmVwKG9wdGlvbnMuY29sdW1ucyB8fCBbXSwgYyA9PiAhYy5pZ25vcmUpOwoJCWxldCByZXQgPSAiIjsKCQlpZiAob3B0aW9ucy5tdWx0aXBsZSkgcmV0ICs9IGB7ImZpZWxkIjonY2snLCJjaGVja2JveCI6dHJ1ZX0sYDsKCQlyZXQgPSBgImZyb3plbkNvbHVtbnMiOiBbW2A7CgkJaWYgKCFvcHRpb25zLmZyb3plbikgewoJCQlyZXQgKz0gYHsiZmllbGQiOiIke29wdGlvbnMuaWRGaWVsZC5maWVsZH0iLCJ0aXRsZSI6ICIke29wdGlvbnMuaWRGaWVsZC50aXRsZX0iLCJzb3J0YWJsZSI6ICJ0cnVlIiwgImZvcm1hdHRlciI6ICR7dGhpcy5mb3JtYXR0ZXIob3B0aW9ucy5uYW1lLCBvcHRpb25zLmlkRmllbGQsIGpzb24pfX0sYDsKCQkJaWYgKG9wdGlvbnMudGV4dEZpZWxkLmZpZWxkICE9IG9wdGlvbnMuaWRGaWVsZC5maWVsZCkgcmV0ICs9IGB7ImZpZWxkIjoiJHtvcHRpb25zLnRleHRGaWVsZC5maWVsZCB8fCBvcHRpb25zLnRleHRGaWVsZC50aXRsZX0iLCJ0aXRsZSI6IiR7b3B0aW9ucy50ZXh0RmllbGQudGl0bGUgfHwgb3B0aW9ucy50ZXh0RmllbGQuZmllbGR9Iiwid2lkdGgiOiIke29wdGlvbnMudGV4dEZpZWxkLndpZHRofHwxMjB9IiwgInNvcnRhYmxlIjogInRydWUiLCAiZm9ybWF0dGVyIjogJHt0aGlzLmZvcm1hdHRlcihvcHRpb25zLm5hbWUsIG9wdGlvbnMudGV4dEZpZWxkLCBqc29uKX19YDsKCQl9IGVsc2UgewoJCQkkLm1hcCgkLmdyZXAoY29scywgYyA9PiBjLmZyb3plbiksIGMgPT4gYHsiZmllbGQiOiIke2MuZmllbGQgfHwgY1RpdGxlKGMpfSIsInRpdGxlIjoiJHtjVGl0bGUoYykgfHwgYy5maWVsZH0iLCJ3aWR0aCI6IiR7Yy53aWR0aHx8MTIwfSIsImFsaWduIjonbGVmdCcsInNvcnRhYmxlIjoidHJ1ZSIsICJmb3JtYXR0ZXIiOiAke3RoaXMuZm9ybWF0dGVyKG9wdGlvbnMubmFtZSwgYywganNvbil9fWApLmpvaW4oIiwiKTsKCQl9CgkJcmV0ICs9IGBdXSwgImNvbHVtbnMiOiBbW2A7CgkJcmV0ICs9ICQubWFwKCQuZ3JlcChjb2xzLCBjID0+ICFjLmZyb3plbiksIGMgPT4gYHsiZmllbGQiOiIke2MuZmllbGQgfHwgY1RpdGxlKGMpfSIsInRpdGxlIjoiJHtjVGl0bGUoYykgfHwgYy5maWVsZH0iLCJhbGlnbiI6ImxlZnQiLCJzb3J0YWJsZSI6InRydWUiLCAiZm9ybWF0dGVyIjogJHt0aGlzLmZvcm1hdHRlcihvcHRpb25zLm5hbWUsIGMsIGpzb24pfX1gKS5qb2luKCIsIik7CgkJcmV0ICs9ICddXSc7CgoJCS8vY29uc29sZS5sb2coIkR5bmFGb3JtOjptYXBDb2x1bW5zKCIgKyBvcHRpb25zLm5hbWUgKyAiKTogIiwgcmV0LCBqc29uKTsKCQlyZXR1cm4gcmV0OwoJfQoKCXNlbGVjdChvcHRpb25zLCB0YWcgPSBvcHRpb25zLnRhZywgdHlwZSkgewoJCXJldHVybiB0aGlzLmNvbWJvKG9wdGlvbnMsIHRhZywgdHlwZSk7Cgl9CgoJdHJlZShvcHRpb25zKSB7CgkJcmV0dXJuIHRoaXMuc2VsZWN0KG9wdGlvbnMsICJzZWxlY3QiKTsKCX0KCgluYXZpZ2F0aW9uKG9wdGlvbnMpIHsKCQlyZXR1cm4gdGhpcy5jb21ibyhvcHRpb25zLCAndWwnLCAndHJlZScpOwoJfQoKCWNvbWJvKG9wdGlvbnMsIHRhZywgdHlwZSkgewoJCXZhciBjb2xzID0gJC5ncmVwKG9wdGlvbnMuY29sdW1ucyB8fCBbXSwgYyA9PiAhYy5pZ25vcmUpOwoJCXRhZyA9IHRhZyB8fCAic2VsZWN0IjsKCgkJb3B0aW9ucy5pZEZpZWxkID0gJC51bmlxdWVTb3J0KFt7CgkJCWZpZWxkOiBvcHRpb25zLmlkRmllbGQsCgkJCXRpdGxlOiBvcHRpb25zLmlkRmllbGQKCQl9XS5jb25jYXQoJC5ncmVwKGNvbHMsIGMgPT4gYy5wcmltYXJ5KSwgW3sKCQkJZmllbGQ6ICdJZCcsCgkJCXRpdGxlOiAnSUQnCgkJfV0pKS5maW5kKHggPT4gdHlwZW9mKHguZmllbGQpICE9PSAidW5kZWZpbmVkIik7CgoJCW9wdGlvbnMudGV4dEZpZWxkID0gJC51bmlxdWVTb3J0KFt7CgkJCWZpZWxkOiBvcHRpb25zLnRleHRGaWVsZCwKCQkJdGl0bGU6IG9wdGlvbnMudGV4dEZpZWxkCgkJfV0uY29uY2F0KCQuZ3JlcChjb2xzLCBjID0+IGMuZGlzcGxheSksIFt7CgkJCWZpZWxkOiAnX1RvU3RyaW5nJywKCQkJdGl0bGU6IG9wdGlvbnMubmFtZSwKCQl9XSkpLmZpbmQoeCA9PiB0eXBlb2YoeC5maWVsZCkgIT09ICJ1bmRlZmluZWQiKTsKCgkJLy9jb25zb2xlLmxvZygiRHluYUZvcm06OmNvbWJvKCk6IG9wdGlvbnMiLCBvcHRpb25zKTsKCgkJdmFyIGZ1biA9IHR5cGUgfHwgdGhpcy5lRnVuKG9wdGlvbnMpOwoKCQl2YXIgZHJvcGRvd24gPSBbJ2NvbWJvdHJlZWdyaWQnLCAnY29tYm90cmVlJywgJ2NvbWJvZ3JpZCcsICdzZWxlY3QnXS5pbmRleE9mKGZ1bikgPiAtMTsKCQlpZiAoZHJvcGRvd24pIHRoaXMuc2VsZWN0cy5wdXNoKHsKCQkJaWQ6ICJjbWIiICsgb3B0aW9ucy5uYW1lLAoJCQlvcHRpb25zOiB0aGlzLmJ5TmFtZShvcHRpb25zLm5hbWUpCgkJfSk7CgkJdGhpcy5zZWxlY3RzID0gJC51bmlxdWVTb3J0KHRoaXMuc2VsZWN0cyk7CgkJdmFyIHJldCA9IGA8JHt0YWd9IGlkPSJjbWIke29wdGlvbnMubmFtZX0iIGNsYXNzPSJlYXN5dWktJHtmdW59IiBzdHlsZT0ibWF4LXdpZHRoOiR7ZHJvcGRvd24/JzQwMHB4Jzp0aGlzLmNXaWR0aChvcHRpb25zKX07IHdpZHRoOiR7dGhpcy5jV2lkdGgob3B0aW9ucyl9cHgiIHJlcXVpcmVkPSIkeyhvcHRpb25zLnJlcXVpcmVkID8gJ3RydWUnIDogJ2ZhbHNlJyl9IiBkYXRhLW9wdGlvbnM9J2Rpc2FibGVkOiR7b3B0aW9ucy5kaXNhYmxlZD8ndHJ1ZSc6J2ZhbHNlJ30sJHt0aGlzLmV2ZW50SGFuZGxlcnMob3B0aW9ucyl9LCB2YWx1ZToiJHt0aGlzLnZhbHVlKG9wdGlvbnMpfSIsIHJvd251bWJlcnM6JHt0eXBlb2Yob3B0aW9ucy5yb3dOdW1iZXJzKSE9PSd1bmRlZmluZWQnP29wdGlvbnMucm93TnVtYmVyczooZnVuLmluZGV4T2YoJ3RyZWUnKTwtMT8nZmFsc2UnOid0cnVlJyl9LCBwYWdpbmF0aW9uOiR7dHlwZW9mKG9wdGlvbnMucGFnaW5hdGlvbikhPT0ndW5kZWZpbmVkJz9vcHRpb25zLnBhZ2luYXRpb246KGZ1bi5pbmRleE9mKCd0cmVlJyk8LTE/J2ZhbHNlJzondHJ1ZScpfSwgcGFuZWxXaWR0aDokezIqdGhpcy5jV2lkdGgob3B0aW9ucyl9LCBmaXRDb2x1bW5zOiB0cnVlLCBzaW5nbGVTZWxlY3Q6IHRydWUsIG11bHRpcGxlOiR7KG9wdGlvbnMubXVsdGlwbGUgfHwgJ2ZhbHNlJyl9LCBpZEZpZWxkOiAiJHtvcHRpb25zLmlkRmllbGQuZmllbGR9IiwgZW5hYmxlRmlsdGVyOiAke29wdGlvbnMuZmlsdGVyPyd0cnVlJzonZmFsc2UnfSwgbm93cmFwOiBmYWxzZSwgdGV4dEZpZWxkOiAiJHtvcHRpb25zLnRleHRGaWVsZC5maWVsZH0iLCB0cmVlRmllbGQ6ICIke29wdGlvbnMudGV4dEZpZWxkLmZpZWxkfSIsYDsKCQlpZiAoZnVuLmluZGV4T2YoJ3RyZWUnKSA9PSAtMSkgewoJCQlyZXQgKz0gJ2ZpdENvbHVtbnM6IGZhbHNlLCcgKyB0aGlzLm1hcENvbHVtbnMob3B0aW9ucyk7CgkJfQoJCWlmIChvcHRpb25zLmRhdGEpIHsKCQkJcmV0ICs9IGAsZGF0YTogJHtKU09OLnN0cmluZ2lmeShvcHRpb25zLmRhdGEpfWA7CgkJfQoJCXJldCArPSBgJz5gOwoJCWlmIChvcHRpb25zLm9wdGlvbnMpIHsKCQkJcmV0ICs9ICQubWFwKG9wdGlvbnMub3B0aW9ucywgbyA9PiBgPG9wdGlvbiB2YWx1ZT0nJHtfRnJFTUQuX3RvSlMobyl9Jz4ke28ubmFtZSB8fCBvfTwvb3B0aW9uPmApLmpvaW4oJ1xuJyk7CgkJfQoJCXJldCArPSBgPC8ke3RhZ30+YDsKCQkvLyBjb25zb2xlLmxvZyhyZXQpOwoJCXJldHVybiByZXQ7Cgl9CgoJZ3JpZChvcHRpb25zLCB0YWcsIHR5cGUpIHsKCQlyZXR1cm4gdGhpcy5jb21ibyhvcHRpb25zLCAidGFibGUiLCAiZGF0YWdyaWQiKTsKCX0KCgl0cmVlZ3JpZChvcHRpb25zKSB7CgkJcmV0dXJuIHRoaXMuY29tYm8ob3B0aW9ucywgJ3RhYmxlJywgJ3RyZWUnKTsKCX0KCglhc3luYyBkb0xpbmsoZSwgZXZlbnQpIHsKCQl0aGlzLmJ1c3kodHJ1ZSk7CgkJdHJ5IHsKCQkJYXdhaXQgZS5saW5rcy5maW5kKGwgPT4gbC5sYWJlbCA9PSBldmVudC50YXJnZXQuaW5uZXJUZXh0KS5vbkNsaWNrKHRoaXMuZ2V0KCkpOwoJCX0gY2F0Y2ggKGV4KSB7CgkJCWNvbnNvbGUubG9nKCJEeW5hRm9ybTo6ZG9MaW5rKCk6IEV4Y2VwdGlvbjogIiArIGV4KTsKCQl9CgkJdGhpcy5idXN5KGZhbHNlKTsKCX0KCglFZGl0ZWRWYWx1ZShlKSB7CgkJcmV0dXJuICh0eXBlb2YoYWNlKSAhPT0gInVuZGVmaW5lZCIpID8gYWNlLmVkaXQoJ3BubCcgKyBlLm5hbWUpLnNlc3Npb24uZ2V0VmFsdWUoKSA6ICcnOwoJfQoKCWFzeW5jIFBhbk9uQ2xvc2UoZSkgewoJCWlmIChlLmVkaXRvcikgewoJCQllLnZhbHVlID0gdGhpcy5FZGl0ZWRWYWx1ZShlKTsKCQl9CgkJaWYgKGUuY2xvc2UpIHsKCQkJYXdhaXQgZS5jbG9zZSh0aGlzLmdldCgpKTsKCQl9Cgl9CgoJYXN5bmMgUGVuZEFmdGVyT3BlbihlKSB7CgkJaWYgKGUuZWRpdG9yICYmIHR5cGVvZihhY2UpICE9PSAidW5kZWZpbmVkIikgewoJCQlhd2FpdCBfRnJFTUQuT3BlbkVkaXRvcigncG5sJyArIGUubmFtZSAvKisgJy1jZW50ZXInKi8gLCBlLmxhbmd1YWdlLCBlLmxvYWRlciB8fCAobyA9PiBlLnZhbHVlKSwgZS5zYXZlciwgdGhpcy5nZXQoKSwgZSk7CgkJfQoJCWlmIChlLm9wZW4pIHsKCQkJYXdhaXQgZS5vcGVuKHRoaXMuZ2V0KCkpOwoJCX0KCX0KCglsaW5rKG9wdGlvbnMpIHsKCQlyZXR1cm4gKG9wdGlvbnMubGlua3MgfHwgW10pLmZpbHRlcihsID0+ICFsLmlnbm9yZSkubWFwKGwgPT4gYDxhIGhyZWY9IiMiIGNsYXNzPSJlYXN5dWktJHt0aGlzLnVpVHlwZXNbb3B0aW9ucy50eXBlXX0iIGRhdGEtb3B0aW9ucz0nJHt0aGlzLmV2ZW50SGFuZGxlcnMob3B0aW9ucyl9LCBpY29uQ2xzOiJpY29uLSR7bC5pY29uIHx8ICdvayd9Iic+JHtsLmxhYmVsfTwvYT5gKS5qb2luKCdcbicpOwoJfQoKCWFzeW5jIFNldFRyZWVEYXRhKGUsIG4sIGRhdGEpIHsKCQkkLmVhY2goJCgiI2NtYiIgKyBlLm5hbWUpW3RoaXMuZUZ1bihlKV0oJ3RyZWUnKS50cmVlKCJnZXRDaGlsZHJlbiIsIG4udGFyZ2V0KSwgKF8sIGMpID0+ICQoIiNjbWIiICsgZS5uYW1lKVt0aGlzLmVGdW4oZSldKCd0cmVlJykudHJlZSgicmVtb3ZlIiwgYy50YXJnZXQpKTsKCQkkKCIjY21iIiArIGUubmFtZSlbdGhpcy5lRnVuKGUpXSgndHJlZScpLnRyZWUoImFwcGVuZCIsIHsKCQkJcGFyZW50OiBuLnRhcmdldCwKCQkJZGF0YTogZGF0YQoJCX0pOwoJCXJldHVybiB0cnVlOwoJfQoKCWFzeW5jIEV4cGFuZChlLCBuKSB7CgkJdGhpcy5TZXRUcmVlRGF0YShlLCBuLCBbewoJCQlpZDogbnVsbCwKCQkJdGV4dDogImxvYWRpbmcuLi4iCgkJfV0pOwoJCXZhciBvYmogPSB7fTsKCQl2YXIgcEZpZWxkID0gZS5wYXJlbnRGaWVsZCB8fCAkLm1hcCgkLmdyZXAoZS5jb2x1bW5zIHx8IFtdLCBjID0+IGMucGFyZW50KSwgYyA9PiBjLmZpZWxkKS5jb25jYXQoW251bGxdKVswXTsKCQl2YXIgaWRGaWVsZCA9ICQuZ3JlcChlLmNvbHVtbnMgfHwgW10sIGMgPT4gYy5wcmltYXJ5KS5jb25jYXQoZS5pZEZpZWxkKVswXS5maWVsZDsKCQlpZiAocEZpZWxkKSB7CgkJCW9ialtwRmllbGRdID0gewoJCQkJX3NvdXJjZTogbi5fc291cmNlCgkJCX07CgkJCWlmIChpZEZpZWxkKSB7CgkJCQlvYmpbcEZpZWxkXVtpZEZpZWxkXSA9IG4uaWQ7CgkJCX0gZWxzZSB7CgkJCQlvYmpbcEZpZWxkXSA9IG4uaWQ7CgkJCX0KCQl9CgkJbGV0IGRhdGEgPSBhd2FpdCB0aGlzLl9sb2FkRGF0YSh7CgkJCWlkOiAiY21iIiArIGUubmFtZSwKCQkJb3B0aW9uczogZQoJCX0sIG9iaik7CgkJdGhpcy5TZXRUcmVlRGF0YShlLCBuLCBkYXRhKTsKCX0KCglhc3luYyBfbG9hZERhdGEocywgbywgc3RhcnQsIGVuZCkgewoJCXZhciBuYW1lID0gKHMgJiYgcy5vcHRpb25zID8gKHMub3B0aW9ucy5DbGFzcyA/IHMub3B0aW9ucy5DbGFzcy5OYW1lLnJlcGxhY2UoJyAnLCAnXycpIDogKHMub3B0aW9ucy50YWJsZSB8fCBzLm9wdGlvbnMubmFtZSkpIDogcy5uYW1lKTsKCQluYW1lID0gbmFtZS50cmltKCk7IC8vLnNwbGl0KCcuJykuc2xpY2UoLTEpWzBdOwoKCQlsZXQgb1Njb3BlID0gKHR5cGVvZihjb21wYW55KSAhPT0gJ3VuZGVmaW5lZCcgJiYgY29tcGFueS5TY29wZSkgPyB3aW5kb3dbY29tcGFueS5TY29wZV0gOiB3aW5kb3c7CgkJbyA9IG8gfHwgKChvU2NvcGUgJiYgb1Njb3BlW25hbWVdKSA/IG5ldyBvU2NvcGVbbmFtZV0oKSA6IHsKCQkJQWN0aXZlOiB0cnVlLAoJCX0pOwoKCQlvID0gKHR5cGVvZiBmaWx0ZXJzICE9PSAidW5kZWZpbmVkIiAmJiBmaWx0ZXJzICYmIGZpbHRlcnNbbmFtZV0pID8gZmlsdGVyc1tuYW1lXShvKSA6IG87CgkJdmFyIGZ1biA9IHRoaXMuZUZ1bihzLm9wdGlvbnMpOwoJCWxldCBzVGV4dCA9ICQoIiMiICsgcy5pZClbZnVuXSgnZ2V0VGV4dCcpOwoKCQlvID0gKHMgJiYgcy5vcHRpb25zICYmIHMub3B0aW9ucy5zb3VyY2UpID8gcy5vcHRpb25zLnNvdXJjZShvLCB0aGlzLmdldCgpLCBzVGV4dCkgOiBvOwoJCWxldCBuYW1lcyA9ICQudW5pcXVlU29ydChbcy5vcHRpb25zLnNlYXJjaEZpZWxkXS5jb25jYXQoJC5tYXAoJC5ncmVwKHMub3B0aW9ucy5jb2x1bW5zIHx8IFtdLCBjID0+IGMuc2VhcmNoKSwgYyA9PiBjLmZpZWxkKSwgWyJOYW1lIl0pKS5maWx0ZXIodiA9PiB2KTsKCQlpZiAoIW9bbmFtZXNbMF1dKSBvW25hbWVzWzBdXSA9IHNUZXh0OwoJCS8vY29uc29sZS5sb2coIkR5bmFGb3JtOjpfbG9hZERhdGEoKTogbyIsIG8pOwoJCXZhciBkYXRhID0gbnVsbDsKCgkJbGV0IGxpYiA9ICcnOwoJCWlmIChuYW1lLmluZGV4T2YoJy4nKSA+IDApIHsKCQkJbGliID0gbmFtZS5zcGxpdCgnLicpWzBdICsgJy4nOwoJCQluYW1lID0gbmFtZS5zcGxpdCgnLicpWzFdOwoJCX0KCgkJaWYgKHMub3B0aW9ucy5sb2FkZXIpIHsKCQkJZGF0YSA9IGF3YWl0IHMub3B0aW9ucy5sb2FkZXIodGhpcy5nZXQoKSwgcy5vcHRpb25zLCBvLCBzVGV4dCk7CgkJfSBlbHNlIGlmIChvICYmIHR5cGVvZihvLmZpbmRBbGwpID09PSAnZnVuY3Rpb24nKSB7CgkJCWRhdGEgPSBhd2FpdCBvLmZpbmRBbGwoKTsKCQl9IGVsc2UgaWYgKHR5cGVvZihjb21wYW55KSAhPT0gJ3VuZGVmaW5lZCcgJiYgY29tcGFueS5saWJyYXJ5ICYmIGNvbXBhbnkuQ29kZSAmJiB3aW5kb3cuYkxvY2FsKSB7CgkJCS8vY29uc29sZS5sb2coIkRGb3JtOjpfbG9hZERhdGEoKTogc3IoKS5fKCIgKyBsaWIgKyBjb21wYW55LkNvZGUudG9Mb3dlckNhc2UoKSArIG5hbWUgKyAiRmluZGFsbCIgKyAiKSIsIG8pOwoJCQlkYXRhID0gYXdhaXQgdGhpcy5zcigpLl8obGliICsgY29tcGFueS5Db2RlLnRvTG93ZXJDYXNlKCkgKyBuYW1lICsgIkZpbmRhbGwiLCBudWxsLCBvLCBudWxsLCBzdGFydCwgZW5kKTsKCQl9IGVsc2UgaWYgKF9GckVNRC5hcGlTZXJ2ZXIpIHsKCQkJbyA9IE9iamVjdC5hc3NpZ24oLi4uT2JqZWN0LmtleXMobykubWFwKGsgPT4gKHsKCQkJCVtTdHJpbmcoaykuY2hhckF0KDApLnRvTG93ZXJDYXNlKCkgKyBTdHJpbmcoaykuc2xpY2UoMSldOiBvW2tdCgkJCX0pKSk7CgkJCWNvbnNvbGUubG9nKCJERm9ybTo6X2xvYWREYXRhKCk6IHVzaW5nIF9GckVNRC5hcGlTZXJ2ZXI6IG8iLCBvKTsKCQkJZGF0YSA9IGF3YWl0IF9GckVNRC5hcGlTZXJ2ZXIuX25ldyhuYW1lKS5fZnJvbURvY3VtZW50KG8pLmZpbmRBbGwoKTsKCQkJLy9kYXRhLmZpbHRlcihkID0+IGQuSWQgIT0gZC5JZCkuZm9yRWFjaChkID0+IGQuSWQgPSBkLl91dWlkKG51bGwsIG51bGwsIHRydWUpKTsKCQl9CgoJCWlmIChzLm9wdGlvbnMucG9zdGxvYWQpIHsKCQkJYXdhaXQgcy5vcHRpb25zLnBvc3Rsb2FkKGRhdGEpOwoJCX0KCQkkLmVhY2goZGF0YSwgKGksIGQpID0+IHsKCQkJZC5fX09XTkVSID0gczsKCQkJJC5lYWNoKHMub3B0aW9ucy5jb2x1bW5zLCAoXywgYykgPT4gewoJCQkJaWYgKGMudmFsdWUpIHsKCQkJCQlkW2MuZmllbGRdID0gYy52YWx1ZShkLCBkYXRhLCBpKTsKCQkJCX0KCQkJfSk7CgkJfSk7CgkJaWYgKCFzLm9wdGlvbnMuY29sdW1ucyAmJiBmdW4uaW5kZXhPZigndHJlZScpID4gLTEpIHsKCQkJZGF0YSA9ICQubWFwKGRhdGEsIGQgPT4gewoJCQkJbGV0IHJldCA9IHsKCQkJCQlpZDogZFtzLm9wdGlvbnMuaWRGaWVsZC5maWVsZF0sCgkJCQkJdGV4dDogZFtzLm9wdGlvbnMudGV4dEZpZWxkLmZpZWxkXSwKCQkJCQlzdGF0ZTogZC5zdGF0ZSB8fCAocy5vcHRpb25zLmxvYWRlciA/ICJmaWxlIiA6ICJjbG9zZWQiKSwKCQkJCQlfc291cmNlOiBkLAoJCQkJfTsKCQkJCXJldC5jaGlsZHJlbiA9IChyZXQuc3RhdGUgPT0gImNsb3NlZCIpID8gW3sKCQkJCQl0ZXh0OiAnbG9hZGluZy4uLicKCQkJCX1dIDogbnVsbDsKCQkJCXJldHVybiByZXQ7CgkJCX0pOwoJCX0KCQlyZXR1cm4gZGF0YSB8fCBbXTsKCX0KCglhc3luYyBmaWxsRGF0YShnLCBvLCBzdGFydCwgZW5kKSB7CgkJdmFyIHMgPSBudWxsOwoJCWZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5zZWxlY3RzLmxlbmd0aDsgaSsrKSB7CgkJCWlmICh0aGlzLnNlbGVjdHNbaV0uaWQgPT0gZ1swXS5pZCkgcyA9IHRoaXMuc2VsZWN0c1tpXTsKCQl9CgkJaWYgKCFzKSByZXR1cm47CgkJdGhpcy5idXN5KHRydWUpOwoJCXRyeSB7CgkJCXZhciBmdW4gPSBnWzBdLmNsYXNzTGlzdFsiMCJdLnJlcGxhY2UoJ2Vhc3l1aS0nLCAnJyk7CgkJCXRyeSB7CgkJCQkkKCIjIiArIHMuaWQpW2Z1bl0oJ2dyaWQnKS5kYXRhZ3JpZCgnZ2V0UGFnZXInKS5wYWdpbmF0aW9uKCdsb2FkaW5nJyk7CgkJCX0gY2F0Y2ggKGV4KSB7fQoJCQlpZiAocy5vcHRpb25zLm5vbG9hZCkgewoJCQkJbGV0IF9kYXRhID0gbnVsbDsKCQkJCXRyeSB7CgkJCQkJX2RhdGEgPSAkKCIjIiArIHMuaWQpW2Z1bl0oJ2dyaWQnKS5kYXRhZ3JpZCgiZ2V0RGF0YSIpOwoJCQkJfSBjYXRjaCAoZXgpIHsKCQkJCQlfZGF0YSA9ICQoIiMiICsgcy5pZClbZnVuXSgndHJlZScpLnRyZWUoJ2dldFJvb3QnKTsKCQkJCX0KCQkJCWlmIChfZGF0YSkgewoJCQkJCXJldHVybiB0aGlzLmJ1c3koZmFsc2UpOwoJCQkJfQoJCQl9CgkJCXZhciBkYXRhID0gYXdhaXQgdGhpcy5fbG9hZERhdGEocywgbywgc3RhcnQsIGVuZCk7CgkJCXRyeSB7CgkJCQlpZiAoJCgiIyIgKyBzLmlkKVtmdW5dKCdncmlkJykpICQoIiMiICsgcy5pZClbZnVuXSgnZ3JpZCcpLmRhdGFncmlkKCdnZXRQYWdlcicpLnBhZ2luYXRpb24oJ2xvYWRlZCcpOwoJCQl9IGNhdGNoIChleCkge30KCQkJdHJ5IHsKCQkJCSQoIiMiICsgcy5pZClbZnVuXSgnZ3JpZCcpLmRhdGFncmlkKCdsb2FkRGF0YScsIHsKCQkJCQl0b3RhbDogZGF0YS5Db3VudCB8fCBkYXRhLmxlbmd0aCwKCQkJCQlyb3dzOiBkYXRhLAoJCQkJfSk7CgkJCX0gY2F0Y2ggKGV4KSB7CgkJCQkkKCIjIiArIHMuaWQpW2Z1bl0oJ3RyZWUnKS50cmVlKCdsb2FkRGF0YScsIGRhdGEpOwoJCQl9CgkJfSBjYXRjaCAoZXgpIHsKCQkJY29uc29sZS5sb2coZXgpOwoJCX0KCQl0aGlzLmJ1c3koZmFsc2UpOwoJfQoKCWV2ZW50SGFuZGxlcnMob3B0aW9ucykgewoJCS8vY29uc29sZS5sb2coIkR5bmFGb3JtOjpldmVudEhhbmRsZXJzKCk6IG9wdGlvbnMiLCBvcHRpb25zKTsKCQlpZiAoIXRoaXMuYnlOYW1lKG9wdGlvbnMubmFtZSkpIHJldHVybjsgLy8gaWYgbm90IGFuIGVsZW1lbnQsIGRvIG5vdCBydW4gdGhlIGhhbmRsZXJzCgoJCXJldHVybiB0aGlzLmV2ZW50cy5maWx0ZXIoZSA9PiBlLnR5cGUgPT0gb3B0aW9ucy50eXBlIHx8IHR5cGVvZihlLnR5cGUpID09PSAndW5kZWZpbmVkJykubWFwKGUgPT4gYCR7ZS5uYW1lfTogKCR7ZS5wYXJhbXMgfHwgJyd9KSA9PiB7dHJ5e0RGb3JtLiR7ZS5oYW5kbGVyfShERm9ybS5ieU5hbWUoIiR7b3B0aW9ucy5uYW1lfSIpIHx8ICR7X0ZyRU1ELl90b0pTKG9wdGlvbnMpfSB8fCB7bmFtZTogIiR7b3B0aW9ucy5uYW1lfSIsdHlwZTogIiR7b3B0aW9ucy50eXBlfSJ9LCAke2UucGFyYW1zfSl9Y2F0Y2goZXgpe2NvbnNvbGUubG9nKCJFdmVudCBFcnJvcjogJHtvcHRpb25zLm5hbWV9LyR7b3B0aW9ucy50eXBlfS8ke2UubmFtZX0iLCBleCk7fX1gKS5qb2luKCcsJyk7Cgl9CgoJYXN5bmMgUGFuZWxPcGVuKGUpIHsKCQlpZiAoZS5lZGl0b3IpIHJldHVybiB0cnVlOwoJCWxldCBjb250ZW50ID0gZS52YWx1ZTsKCQlpZiAoZS5sb2FkZXIpIHsKCQkJY29udGVudCA9IGF3YWl0IGUubG9hZGVyKHRoaXMuZ2V0KCkpOwoJCX0KCQlpZiAoY29udGVudCkgewoJCQl0cnkgewoJCQkJJCgiI3BubCIgKyBlLm5hbWUpLnBhbmVsKCdib2R5JykuaHRtbChjb250ZW50KTsKCQkJCWNvbnNvbGUubG9nKCJwbmwiICsgZS5uYW1lICsgIjogQ29udGVudCBWYWxpZCIpOwoJCQl9IGNhdGNoIChleCkgewoJCQkJLy9jb25zb2xlLmxvZyhleCk7CgkJCX0KCQl9CgkJcmV0dXJuIGNvbnRlbnQ7Cgl9CgoJYXN5bmMgU2VsZWN0Q2hhbmdlKG9wdGlvbnMsIHRhYikgewoJCXRoaXMuYnVzeSh0cnVlKTsKCQkkLmdyZXAodGhpcy5lbGVtZW50cywgZSA9PiBlLnR5cGUgPT0gImdyaWQiICYmIGUuZ3JvdXAgPT0gdGFiKS5mb3JFYWNoKGUgPT4gJCgiI2NtYiIgKyBlLm5hbWUpLmRhdGFncmlkKCkpOwoJCXRoaXMuYnVzeShmYWxzZSk7Cgl9CgoJYXN5bmMgRmllbGRDaGFuZ2Uob3B0aW9ucywgdmFsdWUpIHsKCQl0aGlzLmJ1c3kodHJ1ZSk7CgkJaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5jaGFuZ2UpIHsKCQkJYXdhaXQgb3B0aW9ucy5jaGFuZ2UodGhpcy5nZXQoKSwgdmFsdWUpOwoJCX0KCQl0aGlzLmJ1c3koZmFsc2UpOwoJfQoKCWFzeW5jIFVSTENoYW5nZShzLCBvcHRpb25zKSB7CgkJb3B0aW9ucy5kYXRhID0gYXdhaXQgJC5nZXQocy52YWx1ZSk7CgkJcmV0dXJuIGF3YWl0IHRoaXMuRmllbGRDaGFuZ2Uocywgb3B0aW9ucyk7Cgl9CgoJVXBsb2FkRmlsZShmLCBvcHRpb25zKSB7CgkJdGhpcy5idXN5KHRydWUpOwoJCXZhciBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSgpOwoJCXZhciBmaWxlaWQgPSBNYXRoLnJhbmRvbSgpOwoJCXZhciBtZXRob2QgPSBvcHRpb25zLm1ldGhvZCB8fCAiQ29udGVudE1hbmFnZXIuY21zVXBsb2FkRmlsZSI7CgkJZm9ybURhdGEuYXBwZW5kKCdmaWxlaWQnLCBmaWxlaWQpOwoJCXZhciBmaWxlID0gJCgiIyIgKyBmLmZpbGVib3hJZClbMF0uZmlsZXNbMF07CgkJZm9ybURhdGEuYXBwZW5kKCdfX1VGSUxFJywgZmlsZSk7CgkJaWYgKG9wdGlvbnMubG9jYWwpIHsKCQkJLy8gaGFuZGxpbmcgdGhlIGZpbGUgbG9jYWxseQoJCQl2YXIgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTsKCQkJcmVhZGVyLm9ubG9hZCA9IChlKSA9PiB7CgkJCQl2YXIgZGF0YSA9IGUudGFyZ2V0LnJlc3VsdDsKCQkJCXJldCA9IGRhdGE7CgkJCQlERm9ybS5ieU5hbWUob3B0aW9ucy5uYW1lKS5kYXRhID0gcmV0OwoJCQkJaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy51cGxvYWQpIG9wdGlvbnMudXBsb2FkKHRoaXMuZ2V0KCksIHJldCk7CgkJCX07CgkJCWlmIChvcHRpb25zLmJpbmFyeSkgewoJCQkJcmVhZGVyLnJlYWRBc0JpbmFyeVN0cmluZyhmaWxlKTsKCQkJfSBlbHNlIGlmIChvcHRpb25zLmRhdGF1cmwpIHsKCQkJCXJlYWRlci5yZWFkQXNEYXRhVVJMKGZpbGUpOwoJCQl9IGVsc2UgewoJCQkJcmVhZGVyLnJlYWRBc1RleHQoZmlsZSk7CgkJCX0KCQkJdGhpcy5idXN5KGZhbHNlKTsKCQl9IGVsc2UgaWYgKG1ldGhvZCkgewoJCQkkLmFqYXgoewoJCQkJdXJsOiB0aGlzLnNyKCkuc3JVUkwgKyAiJm1ldGhvZD0iICsgbWV0aG9kICsgIiZzSW5wdXQ9IiArIGZpbGVpZCArICImcHJlVGFnPSZwb3N0VGFnPSIsCgkJCQlkYXRhOiBmb3JtRGF0YSwKCQkJCS8vIFRISVMgTVVTVCBCRSBET05FIEZPUiBGSUxFIFVQTE9BRElORwoJCQkJY2FjaGU6IGZhbHNlLAoJCQkJY29udGVudFR5cGU6IGZhbHNlLAoJCQkJdHlwZTogJ1BPU1QnLAoJCQkJcHJvY2Vzc0RhdGE6IGZhbHNlLAoJCQkJc3VjY2VzczogZGF0YSA9PiB7CgkJCQkJdGhpcy5zcigpLnJ1blNjcmlwdChkYXRhKTsKCQkJCQl0aGlzLmJ5TmFtZShvcHRpb25zLm5hbWUpLmRhdGEgPSByZXQ7CgkJCQkJaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy51cGxvYWQpIG9wdGlvbnMudXBsb2FkKHRoaXMuZ2V0KCksIHJldCk7CgkJCQkJdGhpcy5idXN5KGZhbHNlKTsKCQkJCX0KCQkJfSk7CgkJfQoJfQoKCWVGdW4oZSkgewoJCXRyeSB7CgkJCWlmIChlLnR5cGUgPT0gInRyZWUiKSB7CgkJCQlpZiAoZS5jb2x1bW5zKSB7CgkJCQkJcmV0dXJuICJjb21ib3RyZWVncmlkIjsKCQkJCX0gZWxzZSBpZiAodHlwZW9mKGUuY29tYm8pICE9PSAndW5kZWZpbmVkJyAmJiAhZS5jb21ibykgewoJCQkJCXJldHVybiAndHJlZSc7CgkJCQl9IGVsc2UgewoJCQkJCXJldHVybiAiY29tYm90cmVlIjsKCQkJCX0KCQkJfSBlbHNlIGlmIChlLnR5cGUgPT0gJ25hdmlnYXRpb24nKSB7CgkJCQlyZXR1cm4gJ3RyZWUnOwoJCQl9IGVsc2UgaWYgKGUudHlwZSA9PSAiY29tYm90cmVlIikgewoJCQkJcmV0dXJuICJjb21ib3RyZWVncmlkIjsKCQkJfSBlbHNlIGlmIChlLnR5cGUgPT0gInNlbGVjdCIgJiYgZS5vcHRpb25zKSB7CgkJCQlyZXR1cm4gImNvbWJvYm94IjsKCQkJfQoJCQlyZXR1cm4gImNvbWJvZ3JpZCI7CgkJfSBjYXRjaCAoZXgpIHsKCQkJcmV0dXJuICJjb21ib2dyaWQiOwoJCX0KCX0KCglfZmlsbFdpbmRvdyh3aW5OYW1lLCB2LCBtYXApIHsKCQl2ID0gdiB8fCB7fTsKCQltYXAgPSBtYXAgfHwge307CgkJaWYgKEFycmF5LmlzQXJyYXkobWFwKSkgewoJCQltYXAgPSBPYmplY3QuZnJvbUVudHJpZXMobmV3IE1hcChtYXApKTsKCQl9CgoJCW1hcCA9ICQuZXh0ZW5kKHt9LCBtYXAsIE9iamVjdC5mcm9tRW50cmllcyhPYmplY3Qua2V5cyh2KS5tYXAoayA9PiBbd2luTmFtZSArIGssIGtdKSkpOwoKCQlsZXQgcyA9IHt9OwoJCWZvciAodmFyIG0gaW4gbWFwKSB7CgkJCWlmICh0eXBlb2YodlttYXBbbV1dKSA9PT0gInVuZGVmaW5lZCIpIHsKCQkJCS8vY29uc29sZS5sb2coJ2lzX3VuZGVmaW5lZCcsIG0sIG1hcFttXSwgdlttYXBbbV1dKTsKCQkJCXNbbV0gPSBtYXBbbV07CgkJCX0gZWxzZSB7CgkJCQkvL2NvbnNvbGUubG9nKCdpc19ub3RfdW5kZWZpbmVkJywgbSwgbWFwW21dLCB2W21hcFttXV0pOwoJCQkJc1ttXSA9IHZbbWFwW21dXTsKCQkJfQoJCX0KCQl0aGlzLmNsZWFyKHdpbk5hbWUpOwoJCS8vY29uc29sZS5sb2coInMiLCBzKTsKCQl0aGlzLnNldChzKTsKCQkkKCIjcG5sXyIgKyB3aW5OYW1lKS53aW5kb3coIm9wZW4iKTsKCX0KCgl3aW5kb3dUb0VudGl0eShvLCBiRW1wdHksIGdyaWQsIHByZWZpeCwgZmlsdGVyKSB7CgkJbyA9IG8gfHwgdGhpcy5nZXQoKTsKCQlmaWx0ZXIgPSBmaWx0ZXIgfHwgKHYgPT4gdik7CgkJbGV0IHJldCA9IGdyaWQgPyAoZ3JpZC5zZWxlY3RlZCB8fCBncmlkKSA6IG51bGw7CgkJaWYgKGJFbXB0eSkgewoJCQlyZXQgPSB7fTsKCQkJbyA9IHt9OwoJCX0gZWxzZSB7CgkJCXJldCA9IChyZXQgJiYgcmV0LklkKSA/IHsKCQkJCUlkOiByZXQuSWQKCQkJfSA6IHt9OwoJCX0KCgkJdGhpcy5lbGVtZW50cy5maWx0ZXIoZSA9PiAocHJlZml4ID8gZS5ncm91cCA9PSBwcmVmaXggOiB0cnVlKSAmJiBlLnR5cGUgIT0gJ2xpbmsnICYmIFsnXyddLmluZGV4T2YoZS5uYW1lLnJlcGxhY2UocHJlZml4LCAiIikpIDwgMCkuZm9yRWFjaChlID0+IHsKCQkJcmV0W2UubmFtZS5yZXBsYWNlKHByZWZpeCwgIiIpXSA9IG9bZS5uYW1lXTsKCQkJcmV0dXJuIHRydWU7CgkJfSk7CgoJCWZpbHRlcihyZXQpOwoKCQlyZXR1cm4gcmV0OwoJfQoKCWJpbmQob2JqKSB7CgkJdmFyIG9iakJpbmQgPSAobywgZSkgPT4gewoJCQlvW3RoaXMuZUZ1bihlKV0oewoJCQkJb25TaG93UGFuZWw6ICgpID0+IHsKCQkJCQl0aGlzLmZpbGxEYXRhKCQoIiMiICsgZS5pZCksIG51bGwsIDAsIDEwKTsKCQkJCX0sCgkJCQlvbkNsaWNrUm93OiAoaW5kZXgsIHJvdykgPT4gewoJCQkJCXZhciBzID0gcm93ID8gcm93Ll9fT1dORVIgOiBudWxsOwoJCQkJCS8vIGNvbnNvbGUubG9nKCJvbkNsaWNrUm93KCk6ICIsIGluZGV4LCByb3csIHMpOwoJCQkJCWlmIChzICYmIHMub3B0aW9ucy5zZWxlY3QpIHsKCQkJCQkJcy5vcHRpb25zLnNlbGVjdChyb3csIHRoaXMuZ2V0KCkpOwoJCQkJCX0KCQkJCX0KCQkJfSk7CgkJCXRyeSB7CgkJCQl2YXIgZGcgPSBvW3RoaXMuZUZ1bihlKV0oJ2dyaWQnKTsKCQkJCS8vIGRnLmRhdGFncmlkKCdlbmFibGVGaWx0ZXInKQoJCQkJdmFyIHN0YXRlID0gZGcuZGF0YSgnZGF0YWdyaWQnKTsKCQkJCXZhciBvcHRzID0gc3RhdGUub3B0aW9uczsKCQkJCXZhciBvbkJlZm9yZUxvYWQgPSBvcHRzLm9uQmVmb3JlTG9hZDsKCQkJCW9wdHMub25CZWZvcmVMb2FkID0gKHBhcmFtKSA9PiB7CgkJCQkJc3RhdGUuYWxsUm93cyA9IG51bGw7CgkJCQkJcmV0dXJuIG9uQmVmb3JlTG9hZC5jYWxsKHRoaXMsIHBhcmFtKTsKCQkJCX07CgkJCQl2YXIgcGFnZXIgPSBkZy5kYXRhZ3JpZCgnZ2V0UGFnZXInKTsKCQkJCWRnLmRhdGFncmlkKCdnZXRQYW5lbCcpLnBhbmVsKHsKCQkJCQlJRDogaQoJCQkJfSk7CgkJCQlwYWdlci5wYWdpbmF0aW9uKHsKCQkJCQlvblNlbGVjdFBhZ2U6IGZ1bmN0aW9uKHBhZ2VOdW0sIHBhZ2VTaXplKSB7CgkJCQkJCXRyeSB7CgkJCQkJCQlERm9ybS5maWxsRGF0YSgkKCIjIiArIERGb3JtLnNlbGVjdHNbJCh0aGlzLnBhcmVudE5vZGUpLnBhbmVsKCdvcHRpb25zJykuSURdLmlkKSwgbnVsbCwgcGFnZVNpemUgKiAocGFnZU51bSAtIDEpLCBwYWdlU2l6ZSAqIHBhZ2VOdW0pOwoJCQkJCQl9IGNhdGNoIChfZXgpIHsKCQkJCQkJCWNvbnNvbGUubG9nKCJEeW5hRm9ybTo6b25TZWxlY3RQYWdlKCkgIiwgX2V4KTsKCQkJCQkJfQoJCQkJCX0KCQkJCX0pOwoJCQkJZGcuZGF0YWdyaWQoJ2xvYWREYXRhJywgc3RhdGUuZGF0YSk7CgkJCX0gY2F0Y2ggKGV4KSB7fQoJCX07CgkJaWYgKG9iaikgewoJCQlvYmpCaW5kKG9iaik7CgkJfSBlbHNlIHsKCQkJZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnNlbGVjdHMubGVuZ3RoOyBpKyspIHsKCQkJCWlmICh0aGlzLnNlbGVjdHNbaV0ub3B0aW9ucy5vcHRpb25zKSB7CgkJCQkJLy8kKCIjIiArIHRoaXMuc2VsZWN0c1tpXS5pZCkuY29tYm8oKTsKCQkJCX0gZWxzZSB7CgkJCQkJb2JqQmluZCgkKCIjIiArIHRoaXMuc2VsZWN0c1tpXS5pZCksIHRoaXMuc2VsZWN0c1tpXSk7CgkJCQl9CgkJCX0KCgkJCXRoaXMuZWxlbWVudHMuZmlsdGVyKGUgPT4gZS53aW5kb3cgJiYgZS5ncm91cCkuZm9yRWFjaChlID0+IHsKCQkJCWxldCB0ID0gJCgiI3RiY1dpbmRvdyIpLnRhYnMoImdldFRhYiIsIGUuZ3JvdXApOwoJCQkJaWYgKHQpIHsKCQkJCQl0LnBhbmVsKCdvcHRpb25zJykudGFiLmhpZGUoKTsKCQkJCX0KCQkJfSk7CgkJfQoJfQoKCWVuZ2xpc2gocykgewoJCWlmICghcykgcmV0dXJuICIiOwoJCXZhciByZXN1bHQgPSBzLnJlcGxhY2UoLyhbQS1aXSkvZywgIiAkMSIpOwoJCXJlc3VsdCA9IHJlc3VsdC5yZXBsYWNlKC9fL2csICcnKTsKCQlyZXR1cm4gcmVzdWx0LmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgcmVzdWx0LnNsaWNlKDEpOwoJfQoKCW9uVG9nZ2xlKGUsIGJWYWx1ZSkgewoJCWxldCBzVGFnID0gYCNmRWxlbWVudF8ke2UuZm9yLm5hbWV9ID4gLmVhc3l1aS0ke3RoaXMudWlUeXBlc1tlLmZvci50eXBlXX1gOwoJCWxldCBvVGFnID0gJChzVGFnKTsKCQllLmZvci5lbmFibGVkID0gdHlwZW9mKGJWYWx1ZSkgPT09ICJ1bmRlZmluZWQiID8gIWUuZm9yLmVuYWJsZWQgOiBiVmFsdWU7CgoJCW9UYWcucHJvcCgiZGlzYWJsZWQiLCAhZS5mb3IuZW5hYmxlZCk7CgkJLy9vVGFnW3RoaXMudWlUeXBlc1tlLmZvci50eXBlXV0oZS5mb3IuZW5hYmxlZCA/ICJlbmFibGUiIDogImRpc2FibGUiKTsKCQljb25zb2xlLmxvZyhzVGFnLCBvVGFnLCB0aGlzLnVpVHlwZXNbZS5mb3IudHlwZV0sIGUuZm9yLmVuYWJsZWQpOwoJfQoKCXJlbmRlcihuYW1lLCB0aXRsZSwgZWxlbWVudHMsIGJ1dHRvbnMsIGJGaXhlZCkgewoJCXRoaXMuZWxlbWVudHMgPSAoZWxlbWVudHMgfHwgW10pLmZpbHRlcihlID0+ICFlLmlnbm9yZSk7CgoJCXRoaXMuYnV0dG9ucyA9IGJ1dHRvbnMgfHwgW107CgkJdGhpcy5zZWxlY3RzID0gW107CgkJdGhpcy5ncmlkcyA9IFtdOwoKCQl0aGlzLmVsZW1lbnRzLmZpbHRlcihlID0+IGUudHlwZSA9PSAid2luZG93IikuZm9yRWFjaCh3ID0+IHRoaXMuZWxlbWVudHMuc3BsaWNlKHRoaXMuZWxlbWVudHMuZmluZEluZGV4KGUgPT4gZS5uYW1lID09IHcubmFtZSksIDAsIHsKCQkJbmFtZTogIl8iICsgdy5uYW1lLAoJCQl0eXBlOiAibGluayIsCgkJCXRpdGxlOiB3LnRpdGxlIHx8IHRoaXMuZW5nbGlzaCh3Lm5hbWUpLAoJCQlncm91cDogdy5ncm91cCwKCQkJd2luZG93OiB3LndpbmRvdywKCQkJc2VjdGlvbjogdy5zZWN0aW9uLAoJCQlsaW5rczogW3sKCQkJCWxhYmVsOiAnT3BlbicsCgkJCQlpY29uOiAnZWRpdCcsCgkJCQlvbkNsaWNrOiBvID0+ICQoIiNwbmwiICsgdy5uYW1lKS53aW5kb3coJ29wZW4nKQoJCQl9XSwKCQl9KSk7CgoJCXRoaXMuc3IoKS5ncm91cEJ5KHRoaXMuZWxlbWVudHMuZmlsdGVyKGUgPT4gZS53aW5kb3cpLCAiZ3JvdXAiKS5mb3JFYWNoKGt2ID0+IHsKCQkJaWYgKCFrdi5rZXkpIHJldHVybjsKCgkJCWxldCBlID0gewoJCQkJbmFtZTogIl8iICsga3Yua2V5LAoJCQkJdGl0bGU6IGt2LmtleSwKCQkJCXR5cGU6ICJ3aW5kb3ciLAoJCQkJZ3JvdXA6IGt2LmtleSwKCQkJCXdpZHRoOiB0aGlzLndpZHRoICogMC45LAoJCQkJaGVpZ2h0OiB0aGlzLmhlaWdodCAqIDAuOSwKCQkJCWxvYWRlcjogbyA9PiB7CgkJCQkJa3YudmFsdWVzLmZpbHRlcih2ID0+IHYudHlwZSAhPT0gJ2xpbmsnIHx8ICh2LnR5cGUgPT0gJ2xpbmsnICYmIHYubmFtZS5zdGFydHNXaXRoKCdfJykpKS5mb3JFYWNoKHYgPT4gJCgiI3BubF8iICsgdi5ncm91cCArICctY2VudGVyJykuYXBwZW5kKCQoIiNmRWxlbWVudF8iICsgdi5uYW1lKSkpOwoJCQkJCXJldHVybiBudWxsOwoJCQkJfSwKCQkJCWJ1dHRvbnM6IFtdLmNvbmNhdC5hcHBseShbXSwga3YudmFsdWVzLmZpbHRlcih2ID0+IHYudHlwZSA9PSAnbGluaycgJiYgIXYubmFtZS5zdGFydHNXaXRoKCdfJykpLm1hcCh2ID0+IFsuLi52LmxpbmtzLm1hcChsID0+ICh7CgkJCQkJbmFtZTogbC5uYW1lIHx8IGwubGFiZWwsCgkJCQkJdGl0bGU6IGwudGl0bGUgfHwgbC5sYWJlbCwKCQkJCQlvbkNsaWNrOiBsLm9uQ2xpY2ssCgkJCQkJaWNvbjogbC5pY29uLAoJCQkJCXdpbmRvdzogdHJ1ZSwKCQkJCQlncm91cDoga3Yua2V5LAoJCQkJfSkpXSkpLAoJCQl9OwoJCQl0aGlzLmJ1dHRvbnMucHVzaCguLi5lLmJ1dHRvbnMpOwoKCQkJdGhpcy5lbGVtZW50cy5wdXNoKGUpOwoJCX0pOwoKCQl2YXIgcmV0ID0gIiI7CgkJLy8gY2hlY2sgdGhlIG9wdGlvbiBvZiB1c2luZyB3aW5kb3coKSBhcyBhIHJlbmRlcmVyIG9mIHRoZSBtYWluIHdpbmRvdy4uLgoJCWlmICh0cnVlKSB7CgkJCXRoaXMuZWxlbWVudHMuZmlsdGVyKGUgPT4gIWUuem9uZSkuZm9yRWFjaChlID0+IGUuem9uZSA9ICdjZW50ZXInKTsKCQkJbGV0IHdPcHRpb25zID0gewoJCQkJbmFtZTogbmFtZSB8fCB0aGlzLm5hbWUsCgkJCQl0aXRsZTogdGl0bGUgfHwgdGhpcy50aXRsZSwKCQkJCXR5cGU6ICd3aW5kb3cnLAoJCQkJdmlzaWJsZTogdHJ1ZSwKCQkJCXdpZHRoOiB0aGlzLndpZHRoLAoJCQkJaGVpZ2h0OiB0aGlzLmhlaWdodCwKCQkJCWZpeGVkOiBiRml4ZWQsCgkJCQlsaW5rczogW3sKCQkJCQlpY29uOiAiaGVscCIsCgkJCQkJYWN0aW9uOiBvID0+ICQoIiNwbmxfX0NvbnNvbGUiKS53aW5kb3coJ29wZW4nKQoJCQkJfV0sCgkJCQlidXR0b25zOiB0aGlzLmJ1dHRvbnMuZmlsdGVyKGIgPT4gIWIud2luZG93KSwKCQkJfTsKCQkJdGhpcy5zcigpLmdyb3VwQnkodGhpcy5lbGVtZW50cywgJ3pvbmUnKS5maWx0ZXIoemcgPT4gemcua2V5KS5mb3JFYWNoKHpnID0+IHsKCQkJCXdPcHRpb25zW3pnLmtleV0gPSB0aGlzLnJlbmRlckVsZW1lbnRzKHpnLnZhbHVlcyk7CgkJCX0pOwoKCQkJcmV0ID0gdGhpcy53aW5kb3cod09wdGlvbnMpOwoJCX0gZWxzZSB7CgkJCXJldCA9IHRoaXMuaGVhZGVyKG5hbWUsIHRpdGxlLCBiRml4ZWQsIFt7CgkJCQlpY29uOiAiaGVscCIsCgkJCQlhY3Rpb246IG8gPT4gJCgiI3BubF9fQ29uc29sZSIpLndpbmRvdygnb3BlbicpCgkJCX1dKTsKCgkJCXJldCArPSB0aGlzLnJlbmRlckVsZW1lbnRzKCk7CgoJCQlyZXQgKz0gdGhpcy5mb290ZXIoYkZpeGVkKTsKCgkJfQoJCS8vIGNvbnNvbGUubG9nKHJldCk7CgoJCXJldHVybiByZXQ7Cgl9CgoJY1dpZHRoKG9wdGlvbnMpIHsKCQlsZXQgcmV0ID0gTWF0aC5mbG9vcigoKG9wdGlvbnMgPyBvcHRpb25zLndpZHRoIDogbnVsbCkgfHwgKHRoaXMud2lkdGggLyAzKSkpOwoJCWlmIChvcHRpb25zLnpvbmUgPT0gJ2Vhc3QnIHx8IG9wdGlvbnMuem9uZSA9PSAnd2VzdCcpIHsKCQkJcmV0ID0gMC4yNSAqIHJldDsgLy8gOTAlIG9mIDMvMTAsIHRoZSB3aWR0aCBvZiB0aGUgbm9ybWFsIGVsZW1lbnQKCQl9IGVsc2UgaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5lZGl0b3IpIHsKCQkJcmV0ID0gd2luZG93LmlubmVyV2lkdGg7CgkJfSBlbHNlIGlmIChvcHRpb25zICYmIG9wdGlvbnMud2lkdGggJiYgdHlwZW9mKG9wdGlvbnMud2lkdGgpID09PSAnc3RyaW5nJykgewoJCQlyZXQgPSB0aGlzLndpZHRoOwoJCX0gZWxzZSBpZiAob3B0aW9ucyAmJiBvcHRpb25zLnR5cGUgPT0gJ3dpbmRvdycgJiYgIW9wdGlvbnMud2lkdGgpIHsKCQkJcmV0ID0gdGhpcy53aWR0aCAqIDAuOTsKCQl9CgoJCS8vIGNvbnNvbGUubG9nKG9wdGlvbnMubmFtZSArICI6IGNXaWR0aCA9ICIgKyByZXQsIG9wdGlvbnMuem9uZSk7CgkJcmV0dXJuIHJldDsKCX0KCgl3aW5kb3cob3B0aW9ucykgewoJCW9wdGlvbnMudGl0bGUgPSBvcHRpb25zLnRpdGxlIHx8IG9wdGlvbnMubmFtZTsKCQl2YXIgcmV0ID0gYAoJCTxkaXYgaWQgPSAicG5sJHtvcHRpb25zLm5hbWV9IiBjbGFzcz0iZWFzeXVpLXdpbmRvdyIgdGl0bGU9IiR7b3B0aW9ucy50aXRsZSB8fCB0aGlzLmVuZ2xpc2gob3B0aW9ucy5uYW1lKX0iIGRhdGEtb3B0aW9ucz0nJHt0aGlzLmV2ZW50SGFuZGxlcnMob3B0aW9ucyl9LCBjbG9zZWQ6JHshb3B0aW9ucy52aXNpYmxlfSxtaW5pbWl6YWJsZTokeyFvcHRpb25zLmZpeGVkfSxtYXhpbWl6YWJsZTokeyFvcHRpb25zLmZpeGVkfSxjbG9zYWJsZTokeyFvcHRpb25zLmZpeGVkfSxjb2xsYXBzaWJsZTokeyFvcHRpb25zLmZpeGVkfSxkcmFnZ2FibGU6JHshb3B0aW9ucy5maXhlZH0scmVzaXphYmxlOiR7IW9wdGlvbnMuZml4ZWR9LGljb25DbHM6Imljb24tJHtvcHRpb25zLmljb259IiwgdG9vbHM6IiMke29wdGlvbnMubmFtZX1fdG9vbHMiJyBzdHlsZT0id2lkdGg6JHt0aGlzLmNXaWR0aChvcHRpb25zKX1weDtoZWlnaHQ6JHt0aGlzLmNIZWlnaHQob3B0aW9ucyl9cHg7cGFkZGluZzoxMHB4OyI+CgkJICAgIDxkaXYgY2xhc3M9ImVhc3l1aS1sYXlvdXQiIGRhdGEtb3B0aW9ucz0iZml0OnRydWUiPgoJCWA7CgoJCWxldCBiWm9uZSA9IG9wdGlvbnMuc291dGggPyAnc291dGgnIDogKHRoaXMuem9uZXMuZmluZCh6ID0+IHogPT0gJ3NvdXRoJykgfHwgdGhpcy56b25lc1swXSk7CgkJb3B0aW9uc1tiWm9uZV0gPSBvcHRpb25zW2Jab25lXSB8fCBbXTsKCQlsZXQgeldpZHRoID0gTWF0aC5taW4oMTIwLCB0aGlzLndpZHRoICogMC45NSAvIChvcHRpb25zLmJ1dHRvbnMgPyBvcHRpb25zLmJ1dHRvbnMubGVuZ3RoIDogMSksIHRoaXMuY1dpZHRoKG9wdGlvbnMpKTsKCQlvcHRpb25zW2Jab25lXS5wdXNoKGA8ZGl2IGlkPSJwbmwke29wdGlvbnMubmFtZX0tYnV0dG9ucyIgZGF0YS1vcHRpb25zPSJyZWdpb246JyR7YlpvbmV9Jyxib3JkZXI6ZmFsc2UiIHN0eWxlPSJ0ZXh0LWFsaWduOnJpZ2h0O3BhZGRpbmc6NXB4IDAgMDsiPmAgKyAkLm1hcCgkLmdyZXAob3B0aW9ucy5idXR0b25zIHx8IFtdLCBiID0+ICFiLmlnbm9yZSksIGIgPT4gYDxhIGlkPScke2IubmFtZX0nIGhyZWY9ImphdmFzY3JpcHQ6dm9pZCgwKSIgY2xhc3M9ImVhc3l1aS1saW5rYnV0dG9uIGM2IiBpY29uQ2xzPSJpY29uLSR7Yi5pY29uIHx8ICdzYXZlJ30iIHN0eWxlPSJ3aWR0aDoke3pXaWR0aH1weCIgb25jbGljaz0nREZvcm0uZG9DbGljaygke19GckVNRC5fdG9KUyhiKX0pJz4ke2IudGl0bGUgfHwgYi5uYW1lfTwvYT4mbmJzcDsmbmJzcDtgKS5qb2luKCcnKSArIGA8L2Rpdj5gKTsKCgkJdGhpcy56b25lcy5maWx0ZXIoeiA9PiBvcHRpb25zW3pdKS5mb3JFYWNoKHogPT4gewoJCQlyZXQgKz0gYAoJCSAgICAgICAgPGRpdiBkYXRhLW9wdGlvbnM9InJlZ2lvbjonJHt6fSciIHRpdGxlPSIkeyh6PT0nd2VzdCcgfHwgej09J2Vhc3QnKT8nJm5ic3A7JzonJ30iIHN0eWxlPSdoZWlnaHQ6JHsoej09J25vcnRoJ3x8ej09J3NvdXRoJyk/MTA6MTAwfSU7d2lkdGg6JHsoKHo9PSdlYXN0J3x8ej09J3dlc3QnKT8wLjE6MSkqdGhpcy5jV2lkdGgob3B0aW9ucyl9cHgnPgogICAgICAgIAkJICAgICR7KEFycmF5LmlzQXJyYXkob3B0aW9uc1t6XSk/b3B0aW9uc1t6XTpbb3B0aW9uc1t6XV0pLmpvaW4oJycpfQogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIGA7CgkJfSk7CgoJCXJldCArPSBgPC9kaXY+PC9kaXY+YDsKCgkJLy8gbGlua3MgKHRvb2xzKQoJCWxldCBsaW5rcyA9ICQuZ3JlcChbXS5jb25jYXQob3B0aW9ucy5saW5rcyB8fCBbXSksIGwgPT4gIWwuaWdub3JlKTsKCQlyZXQgKz0gYDxkaXYgaWQ9IiR7b3B0aW9ucy5uYW1lfV90b29scyI+YCArICQubWFwKGxpbmtzLnJldmVyc2UoKSwgbCA9PiBgPGEgaHJlZj0iamF2YXNjcmlwdDp2b2lkKDApIiBzdHlsZT0iY29sb3I6YmxhY2siIGNsYXNzPSJmYXMgZmEtJHtsLmljb24gfHwgJ2FkZCd9IiBvbmNsaWNrPScoYXN5bmMgKCkgPT4ge3ZhciBhID0gJHtfRnJFTUQuX3RvSlMobCl9OyAkKCIjcG5sJHtvcHRpb25zLm5hbWV9Iikud2luZG93KCJzZXRUaXRsZSIsICIke29wdGlvbnMudGl0bGV9OiAiICsgYS5uYW1lKTsgYXdhaXQgYS5hY3Rpb24oREZvcm0uZ2V0KCksIGEsICR7X0ZyRU1ELl90b0pTKG9wdGlvbnMpfSk7ICQoIiNwbmwke29wdGlvbnMubmFtZX0iKS53aW5kb3coInNldFRpdGxlIiwgIiR7b3B0aW9ucy50aXRsZX0iKTt9KSgpJz48L2E+YCkuam9pbignXG4nKSArIGA8L2Rpdj5gOwoKCQlyZXR1cm4gcmV0OwoJfQoKCWFzeW5jIF9lbmQoKSB7CgkJbGV0IG8gPSB0aGlzLmdldCgpOwoKCQkvLyBkbyBub3QgdXNlIHRoZSBmaXJzdCBidXR0b24sIGJlY2F1c2UgbWFueSBmb3JtcyBoYXZlIGEgQ2FuY2VsIGJ1dHRvbiBvbmx5CgkJbGV0IGJ1dHRvbiA9IHRoaXMuYnV0dG9ucy5maW5kKGIgPT4gYi5hdXRvU3VibWl0KSAvKiB8fCB0aGlzLmJ1dHRvbnNbMF0qLyA7CgkJaWYgKGJ1dHRvbiAmJiBvICYmIE9iamVjdC52YWx1ZXMobykubGVuZ3RoICYmICh0eXBlb2YoYnV0dG9uLmF1dG9TdWJtaXQpID09PSAidW5kZWZpbmVkIiB8fCBidXR0b24uYXV0b1N1Ym1pdCkpIHsKCQkJbGV0IHYgPSBPYmplY3QudmFsdWVzKG8pLnJlZHVjZSgodCwgdikgPT4gewoJCQkJcmV0dXJuICgodHlwZW9mKHYpICE9PSAib2JqZWN0IikgPyAxIDogMCkgKiAodiA/IDEgOiAwKTsKCQkJfSk7CgkJCS8vY29uc29sZS5sb2cobywgT2JqZWN0LnZhbHVlcyhvKSwgdik7CgkJCWlmICh2KSB7CgkJCQkvLyBhbGwgZmllbGRzIGhhdmUgdmFsdWVzCgkJCQlhd2FpdCB0aGlzLmRvQ2xpY2soYnV0dG9uKTsKCgkJCX0KCQl9Cgl9CgoJZm9vdGVyKGJGaXhlZCkgewoJCXJldHVybiBgPC9mb3JtPmAgKyBgPGRpdiBpZD0iZGxnLWJ1dHRvbnMiPmAgKyB0aGlzLmJ1dHRvbnMuZmlsdGVyKGIgPT4gIWIud2luZG93KS5tYXAoYiA9PiBgPGEgaWQ9JyR7Yi5uYW1lfScgaHJlZj0iamF2YXNjcmlwdDp2b2lkKDApIiBjbGFzcz0iZWFzeXVpLWxpbmtidXR0b24gYzYiIGljb25DbHM9Imljb24tJHtiLmljb24gfHwgJ3NhdmUnfSIgc3R5bGU9IndpZHRoOiR7TWF0aC5taW4oMTIwLCB0aGlzLndpZHRoICogMC45NSAvIHRoaXMuYnV0dG9ucy5sZW5ndGgsIHRoaXMuY1dpZHRoKCkpfXB4IiBvbmNsaWNrPSdERm9ybS5kb0NsaWNrKCR7X0ZyRU1ELl90b0pTKGIpfSknPiR7Yi50aXRsZSB8fCBiLm5hbWV9PC9hPiZuYnNwOyZuYnNwO2ApLmpvaW4oJycpICsgIjwvZGl2PiIgKyAoYkZpeGVkID8gIiIgOiAnPC9kaXY+Jyk7Cgl9CgoJaGVhZGVyKG5hbWUsIHRpdGxlLCBiRml4ZWQsIGxpbmtzKSB7CgkJdGhpcy50aXRsZSA9IHRpdGxlIHx8IHRoaXMudGl0bGU7CgkJbmFtZSA9IG5hbWUgfHwgdGhpcy5uYW1lOwoJCXZhciByZXQgPSAnJzsKCgkJcmV0ICs9IHRoaXMud2luZG93KHsKCQkJbmFtZTogIl9fQ29uc29sZSIsCgkJCXR5cGU6ICJ3aW5kb3ciLAoJCQllZGl0b3I6IHRydWUsCgkJCWxvYWRlcjogbyA9PiB3aW5kb3cubG9ncy5zbGljZSgpLnJldmVyc2UoKS5tYXAobCA9PiBsLmRhdGUudG9JU09TdHJpbmcoKSArICI6ICIgKyBsLmFyZ3MubWFwKHMgPT4gdHlwZW9mKHMpID09PSAnb2JqZWN0JyA/ICgob2JqLCBpbmRlbnQgPSAyKSA9PiB7CgkJCQlsZXQgY2FjaGUgPSBbXTsKCQkJCWNvbnN0IHJldFZhbCA9IEpTT04uc3RyaW5naWZ5KAoJCQkJCW9iaiwKCQkJCQkoa2V5LCB2YWx1ZSkgPT4KCQkJCQl0eXBlb2YgdmFsdWUgPT09ICJvYmplY3QiICYmIHZhbHVlICE9PSBudWxsID8KCQkJCQljYWNoZS5pbmNsdWRlcyh2YWx1ZSkgPwoJCQkJCXVuZGVmaW5lZCAvLyBEdXBsaWNhdGUgcmVmZXJlbmNlIGZvdW5kLCBkaXNjYXJkIGtleQoJCQkJCToKCQkJCQljYWNoZS5wdXNoKHZhbHVlKSAmJiB2YWx1ZSAvLyBTdG9yZSB2YWx1ZSBpbiBvdXIgY29sbGVjdGlvbgoJCQkJCToKCQkJCQl2YWx1ZSwKCQkJCQlpbmRlbnQKCQkJCSk7CgkJCQljYWNoZSA9IG51bGw7CgkJCQlyZXR1cm4gcmV0VmFsOwoJCQl9KShzKSA6IHMpLmpvaW4oJywgJykpLmpvaW4oJ1xuJyksCgkJfSk7CgoJCWlmICghYkZpeGVkKSB7CgkJCWxpbmtzID0gKGxpbmtzIHx8IFtdKS5maWx0ZXIobCA9PiAhbC5pZ25vcmUpOwoJCQlsZXQgdERhdGEgPSAiIjsKCQkJaWYgKGxpbmtzLmxlbmd0aCkgewoJCQkJcmV0ICs9IGA8ZGl2IGlkPSIke3RoaXMubmFtZX1fdG9vbHMiPmAgKyBsaW5rcy5tYXAobCA9PiBgPGEgaHJlZj0iamF2YXNjcmlwdDp2b2lkKDApIiBjbGFzcz0iaWNvbi0ke2wuaWNvbn0iIG9uY2xpY2s9Jyhhc3luYyAoKSA9PiB7dmFyIGEgPSAke19GckVNRC5fdG9KUyhsKX07ICQoIiN3aW4ke3RoaXMubmFtZX0iKS53aW5kb3coInNldFRpdGxlIiwgIiR7dGhpcy50aXRsZX06ICIgKyBhLm5hbWUpOyBhd2FpdCBhLmFjdGlvbihERm9ybS5nZXQoKSk7ICQoIiN3aW4ke3RoaXMubmFtZX0iKS53aW5kb3coInNldFRpdGxlIiwgIiR7dGhpcy50aXRsZX0iKTt9KSgpJz48L2E+YCkuam9pbignXG4nKSArICI8L2Rpdj4iOwoJCQkJdERhdGEgPSBgLHRvb2xzOiIjJHt0aGlzLm5hbWV9X3Rvb2xzImA7CgkJCX0KCQkJcmV0ICs9IGA8ZGl2IGlkPSd3aW4ke3RoaXMubmFtZX0nIGNsYXNzPSdlYXN5dWktd2luZG93JyB0aXRsZT0nJHt0aGlzLnRpdGxlIHx8IHRoaXMuZW5nbGlzaCh0aGlzLm5hbWUpfScgZGF0YS1vcHRpb25zPSdpY29uQ2xzOiJpY29uLXNhdmUiICR7dERhdGF9JyBzdHlsZT0nd2lkdGg6JHt0aGlzLndpZHRofXB4O2hlaWdodDoke3RoaXMuaGVpZ2h0fXB4O3BhZGRpbmc6MTBweDsnPmA7CgkJfQoJCXJldHVybiByZXQgKyBgPGZvcm0gaWQ9ImZybSR7dGhpcy5uYW1lfSIgbWV0aG9kPSJwb3N0IiBub3ZhbGlkYXRlPmA7Cgl9CgoJcmVuZGVyRWxlbWVudHMoZWxlbWVudHMpIHsKCQllbGVtZW50cyA9IGVsZW1lbnRzIHx8IHRoaXMuZWxlbWVudHM7CgoJCXZhciB0V2lkdGggPSBNYXRoLmZsb29yKHRoaXMud2lkdGggKiAwLjk1KTsKCQl2YXIgdEhlaWdodCA9IE1hdGguZmxvb3IodGhpcy5oZWlnaHQgKiAwLjg1KTsKCgkJbGV0IHJldCA9ICcnOwoJCXZhciBnRWxlbWVudHMgPSB0aGlzLnNyKCkuZ3JvdXBCeShlbGVtZW50cywgImdyb3VwIik7CgkJaWYgKGdFbGVtZW50cy5sZW5ndGggPiAxKSByZXQgKz0gYDxkaXYgaWQ9InRiY1dpbmRvdyIgY2xhc3M9ImVhc3l1aS10YWJzIiBkYXRhLW9wdGlvbnM9JyR7dGhpcy5ldmVudEhhbmRsZXJzKHt0eXBlOiAndGFicyd9KX0nIHN0eWxlPSJ3aWR0aDoke3RXaWR0aH1weDtoZWlnaHQ6JHt0SGVpZ2h0fXB4OyI+YDsKCQlmb3IgKHZhciBnID0gMDsgZyA8IGdFbGVtZW50cy5sZW5ndGg7IGcrKykgewoJCQlpZiAoZ0VsZW1lbnRzLmxlbmd0aCA+IDEpIHJldCArPSAnPGRpdiB0aXRsZT0iJyArIChnRWxlbWVudHNbZ10ua2V5IHx8ICJNYWluIikgKyAnIiBzdHlsZT0icGFkZGluZzoyMHB4O2Rpc3BsYXk6bm9uZTsiPic7CgkJCXZhciBzRWxlbWVudHMgPSB0aGlzLnNyKCkuZ3JvdXBCeShnRWxlbWVudHNbZ10udmFsdWVzLCAic2VjdGlvbiIpOwoJCQlpZiAoc0VsZW1lbnRzLmxlbmd0aCA+IDEpIHJldCArPSAnPGRpdiBjbGFzcz0iZWFzeXVpLWFjY29yZGlvbiIgc3R5bGU9IndpZHRoOicgKyB0V2lkdGggKyAncHg7aGVpZ2h0OicgKyAvKnRIZWlnaHQqLyAiMTAwJSIgKyAncHg7Ij4nOwoJCQlmb3IgKHZhciBzID0gMDsgcyA8IHNFbGVtZW50cy5sZW5ndGg7IHMrKykgewoJCQkJcmV0ICs9IGA8ZGl2IHRpdGxlPSIke3NFbGVtZW50c1tzXS5rZXkgfHwgIiJ9IiBkYXRhLW9wdGlvbnM9Imljb25DbHM6J2ljb24tbW9yZSciIHN0eWxlPSJwYWRkaW5nOjEwcHg7Ij5gOwoJCQkJZm9yICh2YXIgaSA9IDA7IGkgPCBzRWxlbWVudHNbc10udmFsdWVzLmxlbmd0aDsgaSsrKSB7CgkJCQkJdmFyIGUgPSBzRWxlbWVudHNbc10udmFsdWVzW2ldOwoJCQkJCWlmIChlLmlnbm9yZSkgY29udGludWU7CgkJCQkJZS52YWx1ZSA9IGUudmFsdWUgfHwgX0ZyRU1ELmhhc2hbZS5uYW1lXSB8fCAoX0ZyRU1ELmFwaVNlcnZlciA/IF9GckVNRC5hcGlTZXJ2ZXIuX19jb25maWcoJ3Rlc3RfJyArIGUubmFtZSwgJycpIDogJycpOwoJCQkJCXJldCArPSBgPGRpdiBpZD0iZkVsZW1lbnRfJHtlLm5hbWV9IiBjbGFzcz0iZml0ZW0iIHN0eWxlPSJkaXNwbGF5OiAkeyhlLnR5cGU9PSd3aW5kb3cnIHx8IGUuaGlkZGVuKT8nbm9uZSc6Jyd9Ij5gOwoJCQkJCWlmIChlLnRvZ2dsZSkgewoJCQkJCQlyZXQgKz0gYDxhIGhyZWY9IiMiIGNsYXNzPSJlYXN5dWktbGlua2J1dHRvbiIgZGF0YS1vcHRpb25zPScke3RoaXMuZXZlbnRIYW5kbGVycyh7dHlwZTogJ3RvZ2dsZScsIGZvcjogZX0pfSxwbGFpbjp0cnVlLGljb25DbHM6Imljb24tJHtlLmljb24gfHwgJ3NlYXJjaCd9Iicgc3R5bGU9IndpZHRoOjEwMHB4O2hlaWdodDozMHB4Ij4ke2UudGl0bGUgfHwgdGhpcy5lbmdsaXNoKGUubmFtZSl9PC9hPmA7CgkJCQkJfSBlbHNlIHsKCQkJCQkJcmV0ICs9IGA8bGFiZWw+JHtlLnRpdGxlIHx8IHRoaXMuZW5nbGlzaChlLm5hbWUpfTo8L2xhYmVsPmA7CgkJCQkJfQoJCQkJCWlmIChlLnR5cGUgJiYgdGhpc1tlLnR5cGVdKSB7CgkJCQkJCXJldCArPSB0aGlzW2UudHlwZV0oZSk7CgkJCQkJfSBlbHNlIGlmIChlLnJlbmRlcikgewoJCQkJCQlyZXQgKz0gZS5yZW5kZXIoKTsKCQkJCQl9CgkJCQkJcmV0ICs9ICc8L2Rpdj4nOwoJCQkJfQoJCQkJcmV0ICs9ICc8L2Rpdj4nOwoJCQl9CgkJCWlmIChzRWxlbWVudHMubGVuZ3RoID4gMSkgcmV0ICs9ICc8L2Rpdj4nOwoJCQlpZiAoZ0VsZW1lbnRzLmxlbmd0aCA+IDEpIHJldCArPSAiPC9kaXY+IjsKCQl9CgkJaWYgKGdFbGVtZW50cy5sZW5ndGggPiAxKSByZXQgKz0gIjwvZGl2PiI7CgkJcmV0dXJuIHJldDsKCX0KCglpbmZvKG1zZykgewoJCWlmICgkLm1lc3NhZ2VyKSB7CgkJCSQubWVzc2FnZXIuYWxlcnQodGhpcy50aXRsZSwgbXNnLCAnaW5mbycpOwoJCX0gZWxzZSB7CgkJCXRoaXMuc3IoKS5TaG93TWVzc2FnZShtc2csIHRoaXMudGl0bGUpOwoJCX0KCX0KCgllcnJvcihtc2cpIHsKCQlpZiAoJC5tZXNzYWdlcikgewoJCQkkLm1lc3NhZ2VyLmFsZXJ0KHRoaXMudGl0bGUsIG1zZywgJ2Vycm9yJyk7CgkJfSBlbHNlIHsKCQkJdGhpcy5zcigpLlNob3dNZXNzYWdlKG1zZywgdGhpcy50aXRsZSk7CgkJfQoJfQoKCWJ5TmFtZShuYW1lKSB7CgkJcmV0dXJuIHRoaXMuZWxlbWVudHMuZmluZChlID0+IGUubmFtZSA9PT0gbmFtZSk7Cgl9CgoJLyoqIENvbXBvbmVudHM6OlN0YXJ0ICoqLwoJQ29yZUNvbXBvbmVudCA9IGNsYXNzIHsKCQljb25zdHJ1Y3RvcihwYWdlLCBkRm9ybSkgewoJCQl0aGlzLnBhZ2UgPSBwYWdlOwoJCQl0aGlzLmRGb3JtID0gZEZvcm07CgkJfQoKCQlidXN5KGJCdXN5KSB7CgkJCXJldHVybiB0aGlzLmRGb3JtLmJ1c3koYkJ1c3kpOwoJCX0KCgkJX21lKHYpIHsKCQkJbGV0IG1lTmFtZSA9ICh0eXBlb2YoY29tcGFueSkgIT09ICd1bmRlZmluZWQnKSA/IChjb21wYW55LmxvZ2dlZEluSWRlbnRpdHkgfHwgIm1lIikgOiAibWUiOwoJCQlpZiAodikgewoJCQkJd2luZG93W21lTmFtZV0gPSB2OwoJCQl9CgoJCQlyZXR1cm4gd2luZG93W21lTmFtZV07CgkJfQoKCQlfY2FuVmlldygpIHsKCQkJaWYgKCF0aGlzLl9tZSgpKSB7CgkJCQl3aW5kb3cuX0ZyRU1ELnNldFVSTCh7CgkJCQkJcGFnZTogJ2xvZ2luJywKCQkJCQlfcmVkaXJlY3Q6IHRoaXMucGFnZS5fY29kZSwKCQkJCX0pOwoJCQkJdGhyb3cgYF9jYW5WaWV3OiAke3RoaXMucGFnZS5fY29kZX0gbm90IGFsbG93ZWQgd2l0aG91dCBsb2dpbiFgOwoJCQl9CgkJfQoKCQlfbmFtZSgpIHsKCQkJaWYgKCF0aGlzLl9tZSgpKSByZXR1cm4gIiI7CgkJCXJldHVybiB0aGlzLl9tZSgpLm5hbWUgPyB0aGlzLl9tZSgpLm5hbWUoKSA6IHRoaXMuX21lKCkuVG9TdHJpbmc7CgkJfQoJfQoKCU1haW5Db21wb25lbnQgPSBjbGFzcyBleHRlbmRzIHRoaXMuQ29yZUNvbXBvbmVudCB7CgkJX2J1aWxkTWVudSgpIHsKCQkJcmV0dXJuIFt7CgkJCQlsYWJlbDogIk1haW4iLAoJCQkJb3JkZXI6IC0xLAoJCQkJc3ViTWVudXM6IFt7CgkJCQkJbGFiZWw6ICdJbmRleCcsCgkJCQl9LCB7CgkJCQkJbGFiZWw6ICJMb2dpbiIsCgkJCQl9LCB7CgkJCQkJbGFiZWw6ICJMb2dvdXQiCgkJCQl9XQoJCQl9LCB7CgkJCQlsYWJlbDogIlNldHVwIiwKCQkJCW9yZGVyOiA5OTk5OSwKCQkJCXN1Yk1lbnVzOiBfRnJFTUQuX21lbnVDbGFzc2VzKCkKCQkJfV07CgkJfQoJfQoKCUluZGV4Q29tcG9uZW50ID0gY2xhc3MgZXh0ZW5kcyB0aGlzLkNvcmVDb21wb25lbnQgewoJCWFzeW5jIG1haW4oKSB7CgkJCXRoaXMuX2NhblZpZXcoKTsKCgkJCXRoaXMucGFnZS5kYXRhID0gewoJCQkJZm9ybTogdGhpcy5kRm9ybS5yZW5kZXIoJ2ZybUluZGV4JywgIk1haW4gUGFnZSIsIFt7CgkJCQkJbmFtZTogJ1dlbGNvbWUnLAoJCQkJCXJlcXVpcmVkOiB0cnVlLAoJCQkJCXR5cGU6ICJsYWJlbCIsCgkJCQkJdmFsdWU6IHRoaXMuX25hbWUoKSwKCQkJCX1dLCBbXSkKCQkJfTsKCQl9Cgl9CgoJTG9naW5Db21wb25lbnQgPSBjbGFzcyBleHRlbmRzIHRoaXMuQ29yZUNvbXBvbmVudCB7CgkJYXN5bmMgX2F1dGhlbnRpY2F0ZShvKSB7CgkJCXJldHVybiBudWxsOwoJCX0KCgkJYXN5bmMgX2xvZ2dlZEluKCkge30KCgkJYXN5bmMgX25vdExvZ2dlZEluKCkge30KCgkJYXN5bmMgbWFpbigpIHsKCQkJdGhpcy5wYWdlLmRhdGEgPSB7CgkJCQlmb3JtOiB0aGlzLmRGb3JtLnJlbmRlcignZnJtTG9naW4nLCAiVXNlciBBdXRoZW50aWNhdGlvbiIsIFt7CgkJCQkJCW5hbWU6ICdVc2VybmFtZScsCgkJCQkJCXJlcXVpcmVkOiB0cnVlLAoJCQkJCQl0eXBlOiAic3RyaW5nIgoJCQkJCX0sCgkJCQkJewoJCQkJCQluYW1lOiAnUGFzc3dvcmQnLAoJCQkJCQlyZXF1aXJlZDogdHJ1ZSwKCQkJCQkJdHlwZTogInBhc3N3b3JkIgoJCQkJCX0KCQkJCV0sIFt7CgkJCQkJbmFtZTogJ0xvZ2luJywKCQkJCQlhdXRvU3VibWl0OiB0cnVlLAoJCQkJCW9uY2xpY2s6IGFzeW5jIG8gPT4gewoJCQkJCQlsZXQgcmV0ID0gYXdhaXQgdGhpcy5fYXV0aGVudGljYXRlKG8pOwoKCQkJCQkJaWYgKHJldCkgewoJCQkJCQkJdGhpcy5fbWUocmV0KTsKCgkJCQkJCQl0cnkgewoJCQkJCQkJCWF3YWl0IHRoaXMuX2xvZ2dlZEluKCk7CgkJCQkJCQl9IGNhdGNoIChleCkge30KCgkJCQkJCQlfRnJFTUQuc2V0VVJMKHsKCQkJCQkJCQlwYWdlOiBfRnJFTUQuaGFzaC5fcmVkaXJlY3QgfHwgImluZGV4IgoJCQkJCQkJfSk7CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQl0cnkgewoJCQkJCQkJCWF3YWl0IHRoaXMuX25vdExvZ2dlZEluKCk7CgkJCQkJCQl9IGNhdGNoIChleCkge30KCgkJCQkJCQl0aGlzLmRGb3JtLmVycm9yKCJJbnZhbGlkIHVzZXJuYW1lIG9yIHBhc3N3b3JkIik7CgkJCQkJCX0KCgkJCQkJCXRoaXMuZEZvcm0uYnVzeShmYWxzZSk7CgkJCQkJfQoJCQkJfV0pCgkJCX07CgkJfQoJfQoKCVN0b3JlQ29tcG9uZW50ID0gY2xhc3MgZXh0ZW5kcyB0aGlzLkNvcmVDb21wb25lbnQgewoJCWFzeW5jIG1haW4oKSB7CgkJCXRoaXMuX2NhblZpZXcoKTsKCgkJCXRoaXMuc1RhYmxlID0gdGhpcy5wYWdlLmRhdGE7CgkJCWNvbnNvbGUuY2xlYXIoKTsKCgkJCWxldCBlYyA9IF9GckVNRC5fX3Njb3BlKCkuRW50aXR5Q2xhc3Nlcy5maW5kKGMgPT4gYy5OYW1lLnJlcGxhY2UoL1wgL2csICdfJykgPT0gdGhpcy5wYWdlLmRhdGEpOwoKCQkJdGhpcy5wYWdlLmRhdGEgPSB7CgkJCQlmb3JtOiB0aGlzLmRGb3JtLnJlbmRlcih0aGlzLnBhZ2UuZGF0YSwgX0ZyRU1ELl90aXRsZUNhc2UodGhpcy5wYWdlLmRhdGEpLCBbewoJCQkJCW5hbWU6IHRoaXMucGFnZS5kYXRhLAoJCQkJCXRpdGxlOiBlYy5OYW1lLAoJCQkJCUNsYXNzOiB7CgkJCQkJCU5hbWU6IGVjLk5hbWUsCgkJCQkJCUlkOiBlYy5JZAoJCQkJCX0sCgkJCQkJem9uZTogJ25vcnRoJywKCQkJCQl0eXBlOiBlYy5FbnRpdHlBdHRyaWJ1dGVzLmZpbmQocGVhID0+ICFwZWEuRW50aXR5TWV0aG9kICYmIHBlYS5FbnRpdHlUeXBlID09IGVjKSA/ICd0cmVlJyA6ICdzZWxlY3QnLAoJCQkJCXBhcmVudEZpZWxkOiBlYy5FbnRpdHlBdHRyaWJ1dGVzLmZpbmQocGVhID0+ICFwZWEuRW50aXR5TWV0aG9kICYmIHBlYS5FbnRpdHlUeXBlID09IGVjKT8uTmFtZSwKCQkJCQkvL3NlYXJjaEZpZWxkOiBlYy5FbnRpdHlBdHRyaWJ1dGVzLmZpbmQoZWEgPT4gZWEuSXNTdHJpbmcpLk5hbWUsCgkJCQkJLy9pZEZpZWxkOiAnX1RvU3RyaW5nJywKCQkJCQlzb3VyY2U6IChvLCBmRGF0YSwgc1RleHQpID0+ICh7CgkJCQkJCU9QRVJBVE9SUzogewoJCQkJCQkJW2VjLkVudGl0eUF0dHJpYnV0ZXMuZmluZChlYSA9PiBlYS5Jc1N0cmluZykuTmFtZV06ICdsaWtlJwoJCQkJCQl9LAoJCQkJCQlbZWMuRW50aXR5QXR0cmlidXRlcy5maW5kKGVhID0+IGVhLklzU3RyaW5nKS5OYW1lXTogc1RleHQKCgkJCQkJfSksCgkJCQkJc2VsZWN0OiBhc3luYyBvID0+IHsKCQkJCQkJdGhpcy5kRm9ybS5jbGVhcigpOwoJCQkJCQl0aGlzLmRGb3JtLmJ1c3kodHJ1ZSk7CgoJCQkJCQlsZXQgciA9IGF3YWl0IG8uZmluZCgpOwoJCQkJCQl0aGlzLmRGb3JtLnNldChPYmplY3QuYXNzaWduKHsKCQkJCQkJCVt0aGlzLnNUYWJsZV06IHIKCQkJCQkJfSwgLi4uZWMuRW50aXR5QXR0cmlidXRlcy5maWx0ZXIoZWEgPT4gIWVhLkVudGl0eU1ldGhvZCkuZmlsdGVyKGVhID0+IHR5cGVvZihyW2VhLk5hbWVdKCkpICE9PSAndW5kZWZpbmVkJykubWFwKGVhID0+ICh7CgkJCQkJCQlbZWEuTmFtZV06IHJbZWEuTmFtZV0oKQoJCQkJCQl9KSkpKTsKCQkJCQkJdGhpcy5kRm9ybS5idXN5KGZhbHNlKTsKCQkJCQl9CgkJCQl9XS5jb25jYXQoLi4uZWMuRW50aXR5QXR0cmlidXRlcy5maWx0ZXIoZWEgPT4gIWVhLkVudGl0eU1ldGhvZCAmJiAhZWEuSXNUZXh0KS5tYXAoZWEgPT4gZWEuRW50aXR5VHlwZSA/ICh7CgkJCQkJZ3JvdXA6IGVhLkdyb3VwLk5hbWUsCgkJCQkJbmFtZTogZWEuTmFtZSwKCQkJCQlfdHlwZTogZWEuRW50aXR5VHlwZS5FbnRpdHlBdHRyaWJ1dGVzLmZpbmQocGVhID0+ICFwZWEuRW50aXR5TWV0aG9kICYmIHBlYS5FbnRpdHlUeXBlID09IGVhLkVudGl0eVR5cGUpID8gJ3RyZWUnIDogJ3NlbGVjdCcsCgkJCQkJdHlwZTogJ3NlbGVjdCcsCgkJCQkJcGFyZW50RmllbGQ6IGVhLkVudGl0eVR5cGUuRW50aXR5QXR0cmlidXRlcy5maW5kKHBlYSA9PiAhcGVhLkVudGl0eU1ldGhvZCAmJiBwZWEuRW50aXR5VHlwZSA9PSBlYS5FbnRpdHlUeXBlKT8uTmFtZSwKCQkJCQkvL2lkRmllbGQ6ICdfVG9TdHJpbmcnLAoJCQkJCXpvbmU6ICdjZW50ZXInLAoJCQkJCUNsYXNzOiB7CgkJCQkJCU5hbWU6IGVhLkVudGl0eVR5cGUuTmFtZSwKCQkJCQkJSWQ6IGVhLkVudGl0eVR5cGUuSWQKCQkJCQl9LAoJCQkJCXNvdXJjZTogKG8sIGZEYXRhLCBzVGV4dCkgPT4gKHsKCQkJCQkJT1BFUkFUT1JTOiB7CgkJCQkJCQlbZWEuRW50aXR5VHlwZS5FbnRpdHlBdHRyaWJ1dGVzLmZpbmQoZWEgPT4gZWEuSXNTdHJpbmcpLk5hbWVdOiAnbGlrZScKCQkJCQkJfSwKCQkJCQkJW2VhLkVudGl0eVR5cGUuRW50aXR5QXR0cmlidXRlcy5maW5kKGVhID0+IGVhLklzU3RyaW5nKS5OYW1lXTogc1RleHQKCgkJCQkJfSksCgkJCQl9KSA6ICh7CgkJCQkJZ3JvdXA6IGVhLkdyb3VwLk5hbWUsCgkJCQkJbmFtZTogZWEuTmFtZSwKCQkJCQl6b25lOiAnY2VudGVyJywKCQkJCQl0eXBlOiBPYmplY3QuZW50cmllcyh7CgkJCQkJCUJvb2w6ICdib29sJywKCQkJCQkJRGF0ZTogJ2RhdGV0aW1lJywKCQkJCQkJSW50OiAnaW50JywKCQkJCQkJTG9uZzogJ2xvbmcnLAoJCQkJCQlJbWFnZTogJ2ltYWdlJywKCQkJCQkJU3RyaW5nOiAnc3RyaW5nJwoJCQkJCX0pLmZpbmQoZSA9PiBlYVsnSXMnICsgZVswXV0pWzFdLAoJCQkJfSkpKS5jb25jYXQoLi4uZWMuRW50aXR5QXR0cmlidXRlcy5maWx0ZXIoZWEgPT4gIWVhLkVudGl0eU1ldGhvZCAmJiBlYS5Jc1RleHQpLm1hcChlYSA9PiAoewoJCQkJCWdyb3VwOiBlYS5Hcm91cC5OYW1lLAoJCQkJCW5hbWU6IGVhLk5hbWUsCgkJCQkJdHlwZTogJ3dpbmRvdycsCgkJCQkJem9uZTogJ2NlbnRlcicsCgkJCQkJZWRpdG9yOiB0cnVlLAoJCQkJCWxhbmd1YWdlOiBvID0+IGVhLk5hbWUgPT0gJ3NjcmlwdCcgPyAnamF2YXNjcmlwdCcgOiAidGV4dCIsCgkJCQl9KSkpLCBbewoJCQkJCW5hbWU6ICdSZXNldCcsCgkJCQkJb25jbGljazogbyA9PiB7CgkJCQkJCXRoaXMuZEZvcm0uY2xlYXIoKTsKCQkJCQl9LAoJCQkJCWljb246ICJjYW5jZWwiCgkJCQl9LCB7CgkJCQkJbmFtZTogJ1JlbG9hZCcsCgkJCQkJb25jbGljazogbyA9PiBfRnJFTUQuUmVuZGVyUGFnZSh7CgkJCQkJCV9jb2RlOiAnc3RvcmUnCgkJCQkJfSwgdGhpcy5zVGFibGUpLAoJCQkJCWljb246ICJyZWxvYWQiCgkJCQl9LCB7CgkJCQkJbmFtZTogJ1NhdmUnLAoJCQkJCW9uY2xpY2s6IGFzeW5jIG8gPT4gewoJCQkJCQlsZXQgb2JqID0gX0ZyRU1ELmFwaVNlcnZlci5fbmV3KHRoaXMuc1RhYmxlKTsKCQkJCQkJLy9jb25zb2xlLmxvZygib25jbGljaygpIiwgdGhpcy5zVGFibGUsIG9iaiwgbywgb1t0aGlzLnNUYWJsZV0pOwoJCQkJCQlpZiAob1t0aGlzLnNUYWJsZV0gJiYgdHlwZW9mKG9bdGhpcy5zVGFibGVdLl9fc3luY19vbikgPT09ICdmdW5jdGlvbicgJiYgb1t0aGlzLnNUYWJsZV0uX19zeW5jX29uKCkpIG9iai5JZCA9IG9bdGhpcy5zVGFibGVdLklkOwoKCQkJCQkJZWMuRW50aXR5QXR0cmlidXRlcy5maWx0ZXIoZWEgPT4gIWVhLkVudGl0eU1ldGhvZCkuZm9yRWFjaChlYSA9PiBvYmpbZWEuTmFtZV0ob1tlYS5OYW1lXSkpOwoJCQkJCQkvL3JldHVybiBjb25zb2xlLmxvZyhvYmouX3RvRmlsZU5hbWUoKSwgb2JqKTsKCQkJCQkJYXdhaXQgb2JqLnN0b3JlKCk7CgkJCQkJfQoJCQkJfV0pCgkJCX07CgkJfQoJfQoJLyoqIENvbXBvbmVudHM6OkVuZCAqKi8KfTs=",
	"Name": "DynaForm",
	"Script": "d2luZG93LkR5bmFGb3JtID0gY2xhc3MgewoJY29uc3RydWN0b3IoKSB7CgkJdGhpcy50aXRsZSA9ICJGb3JtIFRpdGxlIjsKCQl0aGlzLm5hbWUgPSAiZnJtRm9ybSI7CgkJdGhpcy5lbGVtZW50cyA9IFtdOwoJCXRoaXMuc2VsZWN0cyA9IFtdOwoJCXRoaXMuZ3JpZHMgPSBbXTsKCQl0aGlzLmJ1dHRvbnMgPSBbXTsKCQl0aGlzLnpvbmVzID0gWydub3J0aCcsICdzb3V0aCcsICdlYXN0JywgJ3dlc3QnLCAnY2VudGVyJ107CgkJdGhpcy5zVGFibGUgPSBudWxsOwoJCXRoaXMuYkRlYnVnID0gZmFsc2U7CgkJdGhpcy51aVR5cGVzID0gewoJCQlpbnQ6ICJudW1iZXJzcGlubmVyIiwKCQkJbWVudTogInNwbGl0YnV0dG9uIiwKCQkJZGF0ZXRpbWU6ICJkYXRldGltZWJveCIsCgkJCWJvb2w6ICJzd2l0Y2hidXR0b24iLAoJCQlmaWxlOiAiZmlsZWJveCIsCgkJCXRleHQ6ICJ0ZXh0Ym94IiwKCQkJbGFiZWw6ICJodG1sIiwKCQkJcGFzc3dvcmQ6ICJwYXNzd29yZGJveCIsCgkJCXN0cmluZzogInRleHRib3giLAoJCQlpbWFnZTogImRpYWxvZyIsCgkJCXByb2dyZXNzOiAicHJvZ3Jlc3NiYXIiLAoJCQlsaW5rOiAibGlua2J1dHRvbiIsCgkJCXRyZWU6ICJjb21ib3RyZWUiLAoJCQluYXZpZ2F0aW9uOiAidHJlZSIsCgkJCXNlYXJjaDogJ3NlYXJjaGJveCcsCgkJfTsKCQl0aGlzLmV2ZW50cyA9IFt7CgkJCW5hbWU6ICdvbkNsaWNrJywKCQkJaGFuZGxlcjogJ29uVG9nZ2xlJywKCQkJcGFyYW1zOiAnbj1ldmVudCcsCgkJCXR5cGU6ICd0b2dnbGUnLAoJCX0sIHsKCQkJbmFtZTogJ29uQ2xvc2UnLAoJCQloYW5kbGVyOiAnUGFuT25DbG9zZScsCgkJCXBhcmFtczogJ249ZXZlbnQnLAoJCQl0eXBlOiAnd2luZG93JywKCQl9LCB7CgkJCW5hbWU6ICdvblNlbGVjdCcsCgkJCWhhbmRsZXI6ICdTZWxlY3RDaGFuZ2UnLAoJCQlwYXJhbXM6ICduJywKCQkJdHlwZTogJ3RhYnMnLAoJCX0sIHsKCQkJbmFtZTogJ3NlYXJjaGVyJywKCQkJaGFuZGxlcjogJ0ZpZWxkQ2hhbmdlJywKCQkJcGFyYW1zOiAnbiwgbycsCgkJCXR5cGU6ICdzZWFyY2hib3gnLAoJCX0sIHsKCQkJbmFtZTogJ29uQmVmb3JlRXhwYW5kJywKCQkJaGFuZGxlcjogJ0V4cGFuZCcsCgkJCXBhcmFtczogJ24nLAoJCQl0eXBlOiAndHJlZScsCgkJfSwgewoJCQluYW1lOiAnb25DaGFuZ2UnLAoJCQloYW5kbGVyOiAnRmllbGRDaGFuZ2UnLAoJCQlwYXJhbXM6ICduLCBvJywKCQl9LCB7CgkJCW5hbWU6ICdvbkJlZm9yZU9wZW4nLAoJCQloYW5kbGVyOiAnUGFuZWxPcGVuJywKCQkJcGFyYW1zOiAnJywKCQkJdHlwZTogJ3dpbmRvdycsCgkJfSwgewoJCQluYW1lOiAnb25PcGVuJywKCQkJaGFuZGxlcjogJ1BlbmRBZnRlck9wZW4nLAoJCQlwYXJhbXM6ICcnLAoJCQl0eXBlOiAnd2luZG93JywKCQl9LCB7CgkJCW5hbWU6ICdvbkNsaWNrJywKCQkJaGFuZGxlcjogJ2RvTGluaycsCgkJCXBhcmFtczogJ249ZXZlbnQsIG8nLAoJCQl0eXBlOiAnbGluaycsCgkJfSwgewoJCQluYW1lOiAnb25DbGlja1JvdycsCgkJCWhhbmRsZXI6ICdGaWVsZENoYW5nZScsCgkJCXBhcmFtczogJ24sIG8nLAoJCQl0eXBlOiAnZ3JpZCcsCgkJfV07CgoJCWlmICh0eXBlb2YoJCkgIT09ICd1bmRlZmluZWQnKSAkKHdpbmRvdykucmVzaXplKHRoaXMud2luZG93UmVzaXplZCk7CgkJdGhpcy53aW5kb3dSZXNpemVkKCk7Cgl9CgoJc3IoKSB7CgkJcmV0dXJuIHR5cGVvZihfRnJFTUQpICE9PSAndW5kZWZpbmVkJyA/IF9GckVNRC5zcigpIDogd2luZG93LnNyOwoJfQoKCXBhcnNlKCkgewoJCSQucGFyc2VyLnBhcnNlKCk7Cgl9CgoJd2luZG93UmVzaXplZCgpIHsKCQl0aGlzLndpZHRoID0gd2luZG93LmlubmVyV2lkdGg7CgkJdGhpcy5oZWlnaHQgPSB3aW5kb3cuaW5uZXJIZWlnaHQgKiAwLjg7Cgl9CgoJaW5pdCgpIHsKCQl2YXIgc2VsZWN0ID0gewoJCQlpbml0OiBmdW5jdGlvbihjb250YWluZXIsIG9wdGlvbnMpIHsKCQkJCXZhciBvcCA9IG51bGw7CgkJCQl2YXIgZm9wID0gbnVsbDsKCQkJCWZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5ncmlkcy5sZW5ndGg7IGkrKykKCQkJCQlpZiAodHJ1ZSB8fCB0aGlzLmdyaWRzW2ldLmlkID09IG9wdGlvbnMuc291cmNlKSBvcCA9IHRoaXMuZ3JpZHNbaV0ub3B0aW9uczsKCQkJCWZvciAoaSA9IDA7IGkgPCBvcC5jb2x1bW5zLmxlbmd0aDsgaSsrKQoJCQkJCWlmIChvcC5jb2x1bW5zW2ldLm5hbWUgPT0gb3B0aW9ucy5maWVsZCkgZm9wID0gb3AuY29sdW1uc1tpXTsKCQkJCWZvcC53aWR0aCA9ICh0aGlzLndpZHRoIC8gMyk7CgkJCQl2YXIgZSA9ICQodGhpcy5zZWxlY3QoZm9wKSk7CgkJCQl2YXIgaW5wdXQgPSBlLmFwcGVuZFRvKGNvbnRhaW5lcik7CgkJCQlpbnB1dC5jb21ib2dyaWQoKTsKCQkJCXRoaXMuYmluZChpbnB1dCk7CgkJCQlyZXR1cm4gaW5wdXQ7CgkJCX0sCgkJCWRlc3Ryb3k6IGZ1bmN0aW9uKHRhcmdldCkgewoJCQkJJCh0YXJnZXQpLnJlbW92ZSgpOwoJCQl9LAoJCQlnZXRWYWx1ZTogZnVuY3Rpb24odGFyZ2V0KSB7CgkJCQlyZXR1cm4gJCh0YXJnZXQpLnZhbCgpOwoJCQl9LAoJCQlzZXRWYWx1ZTogZnVuY3Rpb24odGFyZ2V0LCB2YWx1ZSkgewoJCQkJJCh0YXJnZXQpLnZhbCh2YWx1ZSk7CgkJCX0sCgkJCXJlc2l6ZTogZnVuY3Rpb24odGFyZ2V0LCB3aWR0aCkgewoJCQkJJCh0YXJnZXQpLl9vdXRlcldpZHRoKHdpZHRoKTsKCQkJfQoJCX07CgkJJC5leHRlbmQoJC5mbi5kYXRhZ3JpZC5kZWZhdWx0cy5lZGl0b3JzLCB7CgkJCWRhdGV0aW1lOiB7CgkJCQlpbml0OiBmdW5jdGlvbihjb250YWluZXIsIG9wdGlvbnMpIHsKCQkJCQlvcHRpb25zLndpZHRoID0gdGhpcy5jV2lkdGgob3B0aW9ucyk7CgkJCQkJdmFyIGlucHV0ID0gJCh0aGlzLmRhdGV0aW1lKG9wdGlvbnMpKS5hcHBlbmRUbyhjb250YWluZXIpOwoJCQkJCWlucHV0LmRhdGV0aW1lYm94KCk7CgkJCQkJcmV0dXJuIGlucHV0OwoJCQkJfSwKCQkJCWRlc3Ryb3k6IGZ1bmN0aW9uKHRhcmdldCkgewoJCQkJCSQodGFyZ2V0KS5yZW1vdmUoKTsKCQkJCX0sCgkJCQlnZXRWYWx1ZTogZnVuY3Rpb24odGFyZ2V0KSB7CgkJCQkJcmV0dXJuICQodGFyZ2V0KS52YWwoKTsKCQkJCX0sCgkJCQlzZXRWYWx1ZTogZnVuY3Rpb24odGFyZ2V0LCB2YWx1ZSkgewoJCQkJCSQodGFyZ2V0KS52YWwodmFsdWUpOwoJCQkJfSwKCQkJCXJlc2l6ZTogZnVuY3Rpb24odGFyZ2V0LCB3aWR0aCkgewoJCQkJCSQodGFyZ2V0KS5fb3V0ZXJXaWR0aCh3aWR0aCk7CgkJCQl9CgkJCX0sCgkJCWNoZWNrYm94OiB7CgkJCQlpbml0OiBmdW5jdGlvbihjb250YWluZXIsIG9wdGlvbnMpIHsKCQkJCQl2YXIgaW5wdXQgPSAkKHRoaXMuYm9vbChvcHRpb25zKSkuYXBwZW5kVG8oY29udGFpbmVyKTsKCQkJCQlpbnB1dC5zd2l0Y2hidXR0b24oKTsKCQkJCQlyZXR1cm4gaW5wdXQ7CgkJCQl9LAoJCQkJZGVzdHJveTogZnVuY3Rpb24odGFyZ2V0KSB7CgkJCQkJJCh0YXJnZXQpLnJlbW92ZSgpOwoJCQkJfSwKCQkJCWdldFZhbHVlOiBmdW5jdGlvbih0YXJnZXQpIHsKCQkJCQlyZXR1cm4gJCh0YXJnZXQpLnZhbCgpOwoJCQkJfSwKCQkJCXNldFZhbHVlOiBmdW5jdGlvbih0YXJnZXQsIHZhbHVlKSB7CgkJCQkJJCh0YXJnZXQpLnZhbCh2YWx1ZSk7CgkJCQl9LAoJCQkJcmVzaXplOiBmdW5jdGlvbih0YXJnZXQsIHdpZHRoKSB7CgkJCQkJJCh0YXJnZXQpLl9vdXRlcldpZHRoKHdpZHRoKTsKCQkJCX0KCQkJfSwKCQkJY29tYm90cmVlZ3JpZDogc2VsZWN0LAoJCQlzZWxlY3Q6IHNlbGVjdCwKCQl9KTsKCX0KCglhc2socXVlc3Rpb24sIGZBbnN3ZXIgPSB2ID0+IHYsIG9wdGlvbnMpIHsKCQkkLm1lc3NhZ2VyLmNvbmZpcm0odGhpcy50aXRsZSwgcXVlc3Rpb24sIGZ1bmN0aW9uKHIpIHsKCQkJaWYgKG9wdGlvbnMpIHsKCQkJCWZvciAodmFyIGkgPSAwOyBpIDwgb3B0aW9ucy5sZW5ndGg7IGkrKykgewoJCQkJCWlmIChvcHRpb25zW2ldLmFuc3dlciA9PSByKSB7CgkJCQkJCXJldHVybiBmQW5zd2VyKG9wdGlvbnNbaV0udmFsdWUpOwoJCQkJCX0KCQkJCX0KCQkJfSBlbHNlIHsKCQkJCXJldHVybiBmQW5zd2VyKHIpOwoJCQl9CgkJfSk7Cgl9CgoJdG9wRGF0YShhciwgZ0ZpZWxkLCB2RmllbGQsIHRvcCkgewoJCWlmICghdG9wKSB7CgkJCXJldHVybiBhcjsKCQl9CgkJcmV0ID0gW107CgkJJC5lYWNoKHRoaXMuc3IoKS5ncm91cEJ5KGFyLCBnRmllbGQpLCBmdW5jdGlvbihrZXksIHZhbHVlcykgewoJCQl2YWx1ZXMudmFsdWVzLnNvcnQoKGEsIGIpID0+IHsKCQkJCWlmIChwYXJzZUZsb2F0KGFbdkZpZWxkXSkgPCBwYXJzZUZsb2F0KGJbdkZpZWxkXSkpIHsKCQkJCQlyZXR1cm4gMTsKCQkJCX0gZWxzZSBpZiAocGFyc2VGbG9hdChhW3ZGaWVsZF0pID4gcGFyc2VGbG9hdChiW3ZGaWVsZF0pKSB7CgkJCQkJcmV0dXJuIC0xOwoJCQkJfSBlbHNlIHsKCQkJCQlyZXR1cm4gMDsKCQkJCX0KCQkJfSk7CgkJCSQuZWFjaCh2YWx1ZXMudmFsdWVzLCBmdW5jdGlvbihpLCB2KSB7CgkJCQlpZiAoaSA8IHRvcCkgewoJCQkJCXJldC5wdXNoKHYpOwoJCQkJfQoJCQl9KTsKCQl9KTsKCQlyZXR1cm4gcmV0OwoJfQoKCWFzeW5jIGRvQ2xpY2soYnV0dG9uKSB7CgkJbGV0IF90aGlzID0gdHlwZW9mKHRoaXMuZG9DbGljaykgPT09ICdmdW5jdGlvbicgPyB0aGlzIDogd2luZG93LkRGb3JtOwoJCWJ1dHRvbiA9IF90aGlzLmJ1dHRvbnMuZmluZChiID0+IGIubmFtZSA9PSBidXR0b24ubmFtZSAmJiBiLmdyb3VwID09IGJ1dHRvbi5ncm91cCk7CgkJX3RoaXMuYnVzeSh0cnVlKTsKCQlfdGhpcy5zZXQoewoJCQlXb3JrUHJvZ3Jlc3NWYWx1ZTogMjAKCQl9KQoKCQl2YXIgbyA9IF90aGlzLmdldCgpOwoJCXZhciBzTWlzc2luZyA9IF90aGlzLmVsZW1lbnRzLmZpbHRlcihlID0+IChidXR0b24ud2luZG93ID8gYnV0dG9uLmdyb3VwID09IGUuZ3JvdXAgOiB0cnVlKSkuZmlsdGVyKGUgPT4gZS5yZXF1aXJlZCAmJiAhb1tlLm5hbWVdKS5tYXAoZSA9PiAiPGxpPiIgKyAoZS5sYWJlbCB8fCBlLm5hbWUpICsgIjwvbGk+Iikuam9pbigiIik7CgkJaWYgKHNNaXNzaW5nKSB7CgkJCXdpbmRvdy5fRnJFTUQuX2Vycm9yKCJNaXNzaW5nIG1hbmRhdG9yeSBmaWVsZHM6PGJyLz48dWw+IiArIHNNaXNzaW5nICsgIjwvdWw+IiwgNTAwMCk7CgkJCV90aGlzLmJ1c3koZmFsc2UpOwoJCQlyZXR1cm47CgkJfQoJCWlmIChidXR0b24ub25jbGljaykgYXdhaXQgYnV0dG9uLm9uY2xpY2sobyk7CgkJaWYgKGJ1dHRvbi5vbkNsaWNrKSBhd2FpdCBidXR0b24ub25DbGljayhvKTsKCQlfdGhpcy5idXN5KGZhbHNlKTsKCX0KCglidXN5KGJCdXN5KSB7CgkJaWYgKCFiQnVzeSkgewoJCQl2YXIgdG90YWwgPSAwOwoJCQlpZiAodHlwZW9mIG1vbWVudCAhPT0gJ3VuZGVmaW5lZCcpIHsKCQkJCXRvdGFsID0gbW9tZW50KCkuZGlmZihtb21lbnQodGhpcy5idXN5U3RhbXApLCAnc2Vjb25kcycpOwoJCQl9IGVsc2UgewoJCQkJLy8gbm8gbW9tZW50LCB1c2Ugc3RhbmRhcmQgRGF0ZQoJCQkJdG90YWwgPSAobmV3IERhdGUoKS5nZXRUaW1lKCkgLSB0aGlzLmJ1c3lTdGFtcCA/IHRoaXMuYnVzeVN0YW1wLmdldFRpbWUoKSA6IDApIC8gMTAwMCAvIDM2MDA7CgkJCX0KCQkJaWYgKHRoaXMuYkRlYnVnKSB7CgkJCQl3aW5kb3cuX0ZyRU1ELl9hbGVydCgiRXhlY3V0aW9uIFRpbWU6ICIgKyB0b3RhbCArICIgc2Vjb25kcy4iKTsKCQkJfQoJCQlkZWxldGUgdGhpcy5idXN5U3RhbXA7CgoJCQlzZXRJbnRlcnZhbCgxLCAoKSA9PiB0aGlzLlNldCh7CgkJCQlMb2FkaW5nOiAxMAoJCQl9KSk7CgkJfSBlbHNlIHsKCQkJdGhpcy5idXN5U3RhbXAgPSBuZXcgRGF0ZSgpOwoJCX0KCgkJJC5lYWNoKCQubWVyZ2UoJC5tYXAodGhpcy5idXR0b25zLCBiID0+IGIubmFtZSksICQubWFwKHRoaXMuZWxlbWVudHMuZmlsdGVyKGUgPT4gZS50eXBlID09ICdsaW5rJyksIGUgPT4gZS5uYW1lKSksIChfLCBlKSA9PiAkKCcjJyArIGUpLmxpbmtidXR0b24oYkJ1c3kgPyAnZGlzYWJsZScgOiAnZW5hYmxlJykpOwoJfQoKCXByZWZpeChlKSB7CgkJc3dpdGNoIChlLnR5cGUpIHsKCQkJY2FzZSAnbGFiZWwnOgoJCQkJcmV0dXJuICdsYmwnOwoJCQljYXNlICd0ZXh0JzoKCQkJY2FzZSAnc3RyaW5nJzoKCQkJY2FzZSAnc2VhcmNoJzoKCQkJY2FzZSAncGFzc3dvcmQnOgoJCQkJcmV0dXJuICd0eHQnOwoJCQljYXNlICJEYXRlVGltZSI6CgkJCWNhc2UgImRhdGV0aW1lIjoKCQkJCXJldHVybiAnZHRwJzsKCQkJY2FzZSAiaW50IjoKCQkJY2FzZSAiaW50ZWdlciI6CgkJCWNhc2UgIm51bWJlciI6CgkJCWNhc2UgImxvbmciOgoJCQljYXNlICJMb25nIjoKCQkJCXJldHVybiAnbnVkJzsKCQkJY2FzZSAnZmlsZSc6CgkJCQlyZXR1cm4gJ2ZpbCc7CgkJCWNhc2UgJ2ltYWdlJzoKCQkJCXJldHVybiAnaW1nJzsKCQkJY2FzZSAiYm9vbCI6CgkJCQlyZXR1cm4gJ2Noayc7CgkJCWNhc2UgIndpbmRvdyI6CgkJCQlyZXR1cm4gJ3BubCc7CgkJCWNhc2UgInByb2dyZXNzIjoKCQkJCXJldHVybiAncHJnJzsKCQkJY2FzZSAiZ3JpZCI6CgkJCWNhc2UgInRyZWUiOgoJCQljYXNlICJzZWxlY3QiOgoJCQkJcmV0dXJuICdjbWInOwoJCQlkZWZhdWx0OgoJCQkJcmV0dXJuICcnOwoJCX0KCX0KCgljbGVhcihncm91cCkgewoJCXZhciBvID0ge307CgkJJC5lYWNoKHRoaXMuZWxlbWVudHMuZmlsdGVyKGUgPT4gZ3JvdXAgPyBlLmdyb3VwID09IGdyb3VwIDogdHJ1ZSksIChfLCBlKSA9PiB7CgkJCXZhciBuYW1lID0gKGUuZW1zU291cmNlID8gIl8iIDogIiIpICsgZS5uYW1lOwoJCQlzd2l0Y2ggKGUudHlwZSkgewoJCQkJY2FzZSAndGV4dCc6CgkJCQljYXNlICdzdHJpbmcnOgoJCQkJY2FzZSAnc2VhcmNoJzoKCQkJCWNhc2UgJ3Bhc3N3b3JkJzoKCQkJCWNhc2UgIkRhdGVUaW1lIjoKCQkJCWNhc2UgImRhdGV0aW1lIjoKCQkJCQlvW25hbWVdID0gIiI7CgkJCQkJYnJlYWs7CgkJCQljYXNlICJpbnQiOgoJCQkJY2FzZSAibnVtYmVyIjoKCQkJCWNhc2UgImludGVnZXIiOgoJCQkJY2FzZSAibG9uZyI6CgkJCQljYXNlICJMb25nIjoKCQkJCWNhc2UgInByb2dyZXNzIjoKCQkJCQlvW25hbWVdID0gMDsKCQkJCQlicmVhazsKCQkJCWNhc2UgInRyZWUiOgoJCQkJY2FzZSAic2VsZWN0IjoKCQkJCQlvW25hbWVdID0gbnVsbDsKCQkJCQlicmVhazsKCQkJCWNhc2UgImdyaWQiOgoJCQkJCW9bbmFtZV0gPyBvW25hbWVdLmRhdGEgPSBbXSA6IG51bGw7CgkJCQkJYnJlYWs7CgkJCQljYXNlICJib29sIjoKCQkJCQlvW25hbWVdID0gZmFsc2U7CgkJCQkJYnJlYWs7CgkJCQlkZWZhdWx0OgoJCQkJCWJyZWFrOwoJCQl9CgkJfSk7CgkJLy9jb25zb2xlLmxvZygiY2xlYXIiLCBvKTsKCQl0aGlzLnNldChvKTsKCQl0aGlzLmJ1c3koZmFsc2UpOwoJfQoKCXNldChvLCBlTmFtZSkgewoJCWlmIChlTmFtZSkgewoJCQl2YXIgb0VsZW1lbnQgPSB0aGlzLmJ5TmFtZShlTmFtZSk7CgkJCWlmICghb0VsZW1lbnQpIHJldHVybjsKCQkJdmFyIGF0dCA9IG51bGw7CgkJCWlmIChvICYmIG8uSWQgJiYgby5FbnRpdHlBdHRyaWJ1dGUpIHsKCQkJCS8vIGFuIEVudGl0eVZhbHVlCgkJCQlmb3IgKHZhciBwIGluIG8pCgkJCQkJaWYgKHAuZW5kc1dpdGgoIlZhbHVlIikpIGF0dCA9IHA7CgkJCQlvRWxlbWVudC5lbXNTb3VyY2UgPSBvOwoJCQl9CgkJCXRyeSB7CgkJCQlsZXQgZU5hbWUgPSAiIyIgKyB0aGlzLnByZWZpeChvRWxlbWVudCkgKyBvRWxlbWVudC5uYW1lOwoJCQkJbGV0IGVUeXBlID0gdGhpcy51aVR5cGVzW29FbGVtZW50LnR5cGVdOwoJCQkJLy8gY29uc29sZS5sb2coIkR5bmFGb3JtOjpzZXQoIiArIG9FbGVtZW50Lm5hbWUgKyAiKTogIiwgZU5hbWUsIGVUeXBlLCBvKTsKCQkJCXN3aXRjaCAob0VsZW1lbnQudHlwZSkgewoJCQkJCWNhc2UgJ2xhYmVsJzoKCQkJCQkJaWYgKGF0dCkgewoJCQkJCQkJJChlTmFtZSkuaHRtbChvW2F0dF0pOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJJChlTmFtZSkuaHRtbCgobyAmJiBvLkVudGl0eUF0dHJpYnV0ZSkgPyAiIiA6IG8pOwoJCQkJCQl9CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgJ3RleHQnOgoJCQkJCWNhc2UgJ3N0cmluZyc6CgkJCQkJY2FzZSAncGFzc3dvcmQnOgoJCQkJCWNhc2UgImludCI6CgkJCQkJY2FzZSAic2VhcmNoIjoKCQkJCQljYXNlICJpbnRlZ2VyIjoKCQkJCQljYXNlICJudW1iZXIiOgoJCQkJCWNhc2UgImxvbmciOgoJCQkJCWNhc2UgIkxvbmciOgoJCQkJCQlpZiAoYXR0KSB7CgkJCQkJCQkkKGVOYW1lKVtlVHlwZV0oInNldFZhbHVlIiwgb1thdHRdKTsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCSQoZU5hbWUpW2VUeXBlXSgic2V0VmFsdWUiLCAobyAmJiBvLkVudGl0eUF0dHJpYnV0ZSkgPyAiIiA6IG8pOwoJCQkJCQl9CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgIkRhdGVUaW1lIjoKCQkJCQljYXNlICJkYXRldGltZSI6CgkJCQkJCWlmIChhdHQpIHsKCQkJCQkJCSQoZU5hbWUpW2VUeXBlXSgnc2V0VmFsdWUnLCAob1thdHRdID8gdGhpcy5zcigpLnRvRGF0ZVRpbWUob1thdHRdKSA6ICIiKSk7CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQkkKGVOYW1lKVtlVHlwZV0oJ3NldFZhbHVlJywgKG8gJiYgby5FbnRpdHlBdHRyaWJ1dGUpID8gIiIgOiAobyA/IHRoaXMuc3IoKS50b0RhdGVUaW1lKG8pIDogIiIpKTsKCQkJCQkJfQoJCQkJCQlicmVhazsKCQkJCQljYXNlICJib29sIjoKCQkJCQkJaWYgKGF0dCkgewoJCQkJCQkJJChlTmFtZSlbZVR5cGVdKChvW2F0dF0gPyAnJyA6ICd1bicpICsgJ2NoZWNrJyk7CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQkkKGVOYW1lKVtlVHlwZV0oKCgobyAmJiBvLkVudGl0eUF0dHJpYnV0ZSkgPyAiIiA6IG8pID8gJycgOiAndW4nKSArICdjaGVjaycpOwoJCQkJCQl9CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgIndpbmRvdyI6CgkJCQkJCWlmIChhdHQpIHsKCQkJCQkJCW9FbGVtZW50LnZhbHVlID0gb1thdHRdOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJb0VsZW1lbnQudmFsdWUgPSAobyAmJiBvLkVudGl0eUF0dHJpYnV0ZSkgPyAiIiA6IG87CgkJCQkJCX0KCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAicHJvZ3Jlc3MiOgoJCQkJCQl2YXIgdiA9IDA7CgkJCQkJCWlmIChhdHQpIHsKCQkJCQkJCXYgPSBvW2F0dF07CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQl2ID0gKG8gJiYgby5FbnRpdHlBdHRyaWJ1dGUpID8gIiIgOiBvOwoJCQkJCQl9CgkJCQkJCS8vY29uc29sZS5sb2coIiMiICsgdGhpcy5wcmVmaXgob0VsZW1lbnQpICsgb0VsZW1lbnQubmFtZSwgdGhpcy51aVR5cGVzW29FbGVtZW50LnR5cGVdLCBNYXRoLnJvdW5kKHYgKiAxMCkgLyAxMCk7CgkJCQkJCSQoZU5hbWUpW2VUeXBlXSgnc2V0VmFsdWUnLCBNYXRoLnJvdW5kKHYgKiAxMCkgLyAxMCk7CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgImdyaWQiOgoJCQkJCQlsZXQgY29scyA9IEpTT04ucGFyc2UoInsiICsgdGhpcy5tYXBDb2x1bW5zKG9FbGVtZW50LCB0cnVlKSArICJ9Iik7CgkJCQkJCSQuZWFjaChjb2xzLmNvbHVtbnNbMF0sIChfLCBjKSA9PiBjLmZvcm1hdHRlciA9IHRoaXMuc3IoKS5ydW5TY3JpcHQodGhpcy5mb3JtYXR0ZXIob0VsZW1lbnQubmFtZSwgYykpKTsKCQkJCQkJJChlTmFtZSkuZGF0YWdyaWQoY29scyk7CgkJCQkJCWlmIChhdHQpIHsKCQkJCQkJCSQoZU5hbWUpLmRhdGFncmlkKHsKCQkJCQkJCQlkYXRhOiBvW2F0dF0KCQkJCQkJCX0pOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJJChlTmFtZSkuZGF0YWdyaWQoewoJCQkJCQkJCWRhdGE6IChvICYmIG8uRW50aXR5QXR0cmlidXRlKSA/ICIiIDogbwoJCQkJCQkJfSk7CgkJCQkJCX0KCQkJCQkJJChlTmFtZSkuZGF0YWdyaWQoInVuc2VsZWN0QWxsIik7CgkJCQkJCSQoZU5hbWUpLmRhdGFncmlkKCk7CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgInRyZWUiOgoJCQkJCQl2YXIgdiA9IGF0dCA/IG9bYXR0XSA6ICgobyAmJiBvLkVudGl0eUF0dHJpYnV0ZSkgPyAiIiA6IG8pOwoJCQkJCQlpZiAoQXJyYXkuaXNBcnJheSh2KSkgewoJCQkJCQkJJChlTmFtZSlbZVR5cGVdKCJ0cmVlIikudHJlZSgibG9hZERhdGEiLCB2KTsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCSQoZU5hbWUpW2VUeXBlXSgnc2V0VmFsdWUnLCB2KTsKCQkJCQkJfQoJCQkJCQlicmVhazsKCQkJCQljYXNlICJzZWxlY3QiOgoJCQkJCQlpZiAoYXR0KSB7CgkJCQkJCQlpZiAob0VsZW1lbnQub3B0aW9ucykgewoJCQkJCQkJCSQoZU5hbWUpLmNvbWJvKCdzZXRWYWx1ZScgKyAob0VsZW1lbnQubXVsdGlwbGUgPyAncycgOiAnJyksIChvW2F0dF0gPyBvW2F0dF0gOiAiIikpOwoJCQkJCQkJCSQoZU5hbWUpLmNvbWJvKCdzZXRWYWx1ZScgKyAob0VsZW1lbnQubXVsdGlwbGUgPyAncycgOiAnJyksIChvW2F0dF0gPyBvW2F0dF0gOiAiIikpOwoJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQkkKGVOYW1lKS5jb21ib2dyaWQoJ3NldFZhbHVlJyArIChvRWxlbWVudC5tdWx0aXBsZSA/ICdzJyA6ICcnKSwgKG9bYXR0XSA/IG9bYXR0XSA6ICIiKSk7CgkJCQkJCQl9CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQl2ID0gbnVsbDsKCQkJCQkJCWlmIChvID09PSBudWxsKSB7CgoJCQkJCQkJfSBlbHNlIGlmIChvLmNvbnN0cnVjdG9yID09PSBBcnJheSkgewoKCQkJCQkJCX0gZWxzZSBpZiAoIW8uRW50aXR5QXR0cmlidXRlKSB7CgkJCQkJCQkJdiA9IG8gfHwgewoJCQkJCQkJCQlJZDogby5JZCwKCQkJCQkJCQkJX1RvU3RyaW5nOiBvLl9Ub1N0cmluZywKCQkJCQkJCQkJdG9TdHJpbmc6IGZ1bmN0aW9uKCkgewoJCQkJCQkJCQkJcmV0dXJuIHRoaXMuX1RvU3RyaW5nOwoJCQkJCQkJCQl9CgkJCQkJCQkJfTsKCQkJCQkJCX0KCQkJCQkJCWlmIChvRWxlbWVudC5vcHRpb25zKSB7CgkJCQkJCQkJJChlTmFtZSkuY29tYm8oJ3NldFZhbHVlJyArIChvRWxlbWVudC5tdWx0aXBsZSA/ICdzJyA6ICcnKSwgdik7CgkJCQkJCQkJJChlTmFtZSkuY29tYm8oJ3NldFRleHQnICsgKG9FbGVtZW50Lm11bHRpcGxlID8gJ3MnIDogJycpLCB2KTsKCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJJChlTmFtZSkuY29tYm9ncmlkKCdzZXRWYWx1ZScgKyAob0VsZW1lbnQubXVsdGlwbGUgPyAncycgOiAnJyksIHYpOwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJCWJyZWFrOwoJCQkJCWRlZmF1bHQ6CgkJCQkJCWJyZWFrOwoJCQkJfQoJCQl9IGNhdGNoIChleCkgewoJCQkJY29uc29sZS5sb2coZXgpOwoJCQl9CgkJfSBlbHNlIHsKCQkJZm9yICh2YXIgcCBpbiBvKSB7CgkJCQlpZiAocC5pbmRleE9mKCdfJykgPT09IDApIHAgPSBwLnN1YnN0cmluZygxKTsKCQkJCXZhciBlID0gdGhpcy5ieU5hbWUocCk7CgkJCQlpZiAoIWUgfHwgIWUubmFtZSkgY29udGludWU7CgkJCQl2YXIgdmFsdWUgPSBvW3BdOwoJCQkJaWYgKGUubmFtZSA9PSB0aGlzLnNUYWJsZSkgewoJCQkJCXZhbHVlID0gbzsKCQkJCQl2YWx1ZS5EYXRlID0gbmV3IERhdGUoKTsKCQkJCX0KCQkJCWlmIChwID09ICJFbnRpdHlWYWx1ZXMiKSB7CgkJCQkJLy8gYW4gZW1zRm9ybVZhbHVlcyBzb3VyY2UKCQkJCQkvLyBmaW5kIHRoZSBFbnRpdHlWYWx1ZSBmb3IgdGhpcyBlbGVtZW50IGFuZCBzZXQgaXQKCQkJCQlmb3IgKHZhciBqID0gMDsgaiA8IG8uRW50aXR5VmFsdWVzLmxlbmd0aDsgaisrKSB7CgkJCQkJCWlmIChvLkVudGl0eVZhbHVlc1tqXS5FbnRpdHlBdHRyaWJ1dGUuTmFtZSA9PSBlLm5hbWUpIHsKCQkJCQkJCS8vIGZvdW5kIHRoZSBFbnRpdHlWYWx1ZSBmb3IgdGhpcyBlbGVtZW50CgkJCQkJCQlfdiA9IG8uRW50aXR5VmFsdWVzW2pdOwoJCQkJCQkJZm9yICh2YXIgcSBpbiBfdikgewoJCQkJCQkJCWlmIChxLmVuZHNXaXRoKCJWYWx1ZSIpKSB7CgkJCQkJCQkJCV92W3FdID0gdmFsdWU7CgkJCQkJCQkJfQoJCQkJCQkJfQoJCQkJCQkJYnJlYWs7CgkJCQkJCX0KCQkJCQl9CgkJCQl9CgkJCQl0aGlzLnNldCh2YWx1ZSwgZS5uYW1lKTsKCQkJfQoJCX0KCX0KCglnZXQoKSB7CgkJdmFyIG8gPSB7fTsKCQlpZiAodGhpcy5zVGFibGUgJiYgd2luZG93W3RoaXMuc1RhYmxlXSkgbyA9IG5ldyB3aW5kb3dbdGhpcy5zVGFibGVdKCk7CgkJZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7CgkJCXZhciBjbiA9IG51bGw7CgkJCXZhciB2ID0gbnVsbDsKCQkJdHJ5IHsKCQkJCWxldCBlTmFtZSA9ICIjIiArIHRoaXMucHJlZml4KHRoaXMuZWxlbWVudHNbaV0pICsgdGhpcy5lbGVtZW50c1tpXS5uYW1lOwoJCQkJc3dpdGNoICh0aGlzLmVsZW1lbnRzW2ldLnR5cGUpIHsKCQkJCQljYXNlICdsYWJlbCc6CgkJCQkJCWNuID0gJChlTmFtZSk7CgkJCQkJCXYgPSBjbi5odG1sKCk7CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgJ3RleHQnOgoJCQkJCWNhc2UgJ3N0cmluZyc6CgkJCQkJY2FzZSAnc2VhcmNoJzoKCQkJCQljYXNlICdwYXNzd29yZCc6CgkJCQkJCWNuID0gJChlTmFtZSk7CgkJCQkJCXYgPSBjbi52YWwoKTsKCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAiZmlsZSI6CgkJCQkJY2FzZSAiaW1hZ2UiOgoJCQkJCQljbiA9ICQoZU5hbWUpOwoJCQkJCQl2ID0gdGhpcy5lbGVtZW50c1tpXS5kYXRhOwoJCQkJCQlicmVhazsKCQkJCQljYXNlICJEYXRlVGltZSI6CgkJCQkJY2FzZSAiZGF0ZXRpbWUiOgoJCQkJCQl2ID0gbmV3IERhdGUoJChlTmFtZSkuZGF0ZXRpbWVib3goJ2dldFZhbHVlJykpOwoJCQkJCQljbiA9ICQoZU5hbWUpOwoJCQkJCQlicmVhazsKCQkJCQljYXNlICJwcm9ncmVzcyI6CgkJCQkJCWNuID0gJChlTmFtZSk7CgkJCQkJCXYgPSBjbi5wcm9ncmVzc2JhcignZ2V0VmFsdWUnKTsKCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAiaW50IjoKCQkJCQljYXNlICJpbnRlZ2VyIjoKCQkJCQljYXNlICJudW1iZXIiOgoJCQkJCWNhc2UgImxvbmciOgoJCQkJCWNhc2UgIkxvbmciOgoJCQkJCQljbiA9ICQoZU5hbWUpOwoJCQkJCQl2ID0gcGFyc2VGbG9hdChjbi52YWwoKSk7CgkJCQkJCWlmIChpc05hTih2KSkgdiA9IDA7CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgImdyaWQiOgoJCQkJCQljbiA9ICQoZU5hbWUpOwoJCQkJCQl2ID0gY24uZGF0YWdyaWQoJ2dldERhdGEnKTsKCQkJCQkJdi5zZWxlY3RlZCA9IGNuLmRhdGFncmlkKCJnZXRTZWxlY3RlZCIpOwoJCQkJCQlicmVhazsKCQkJCQljYXNlICJ0cmVlIjoKCQkJCQkJY24gPSAkKGVOYW1lKTsKCQkJCQkJdiA9IGNuLmNvbWJvdHJlZSgidHJlZSIpLnRyZWUoImdldFNlbGVjdGVkIik7CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgIndpbmRvdyI6CgkJCQkJCXYgPSB0aGlzLmVsZW1lbnRzW2ldLnZhbHVlOwoJCQkJCQlicmVhazsKCQkJCQljYXNlICJzZWxlY3QiOgoJCQkJCQlpZiAodGhpcy5lbGVtZW50c1tpXS5vcHRpb25zKSB7CgkJCQkJCQl2ID0gJChlTmFtZSkuY29tYm9ncmlkKCdnZXRWYWx1ZScgKyAodGhpcy5lbGVtZW50c1tpXS5tdWx0aXBsZSA/ICdzJyA6ICcnKSk7CgkJCQkJCQl2ID0gdGhpcy5zcigpLnJ1blNjcmlwdCh2KTsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCXYgPSAkKGVOYW1lKS5jb21ib2dyaWQoJ2dyaWQnKS5kYXRhZ3JpZCgnZ2V0U2VsZWN0aW9ucycpOwoJCQkJCQkJaWYgKCF2IHx8ICF2Lmxlbmd0aCkgewoJCQkJCQkJCXYgPSAkKGVOYW1lKS5jb21ib2dyaWQoJ2dldFZhbHVlJyArICh0aGlzLmVsZW1lbnRzW2ldLm11bHRpcGxlID8gJ3MnIDogJycpKTsKCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJaWYgKCF0aGlzLmVsZW1lbnRzW2ldLm11bHRpcGxlKSB2ID0gdlswXTsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCQljbiA9ICQoZU5hbWUpOwoJCQkJCQlicmVhazsKCQkJCQljYXNlICJib29sIjoKCQkJCQkJY24gPSAkKGVOYW1lKTsKCQkJCQkJdiA9IGNuLnN3aXRjaGJ1dHRvbignb3B0aW9ucycpLmNoZWNrZWQ7CgkJCQkJCWJyZWFrOwoJCQkJCWRlZmF1bHQ6CgkJCQkJCWJyZWFrOwoJCQkJfQoJCQkJb1t0aGlzLmVsZW1lbnRzW2ldLm5hbWVdKHYpOwoJCQl9IGNhdGNoIChlKSB7CgkJCQkvL2NvbnNvbGUubG9nKHRoaXMuZWxlbWVudHNbaV0ubmFtZSwgZSk7CgkJCQlvW3RoaXMuZWxlbWVudHNbaV0ubmFtZV0gPSB2OwoJCQl9CgkJCWlmIChjbikgewoJCQkJaWYgKG8uRW50aXR5VmFsdWVzKSB7CgkJCQkJZm9yICh2YXIgaiA9IDA7IGogPCBvLkVudGl0eVZhbHVlcy5sZW5ndGg7IGorKykgewoJCQkJCQlpZiAodGhpcy5lbGVtZW50c1tpXS5uYW1lID09IHRoaXMuc1RhYmxlICYmIHRoaXMuZWxlbWVudHNbaV0uZW1zU291cmNlKSBvLklkID0gdGhpcy5lbGVtZW50c1tpXS5lbXNTb3VyY2UuSWQ7CgkJCQkJCWlmIChvLkVudGl0eVZhbHVlc1tqXS5FbnRpdHlBdHRyaWJ1dGUuTmFtZSA9PSB0aGlzLmVsZW1lbnRzW2ldLm5hbWUgJiYgdGhpcy5lbGVtZW50c1tpXS5lbXNTb3VyY2UpIHsKCQkJCQkJCW8uRW50aXR5VmFsdWVzW2pdLklkID0gdGhpcy5lbGVtZW50c1tpXS5lbXNTb3VyY2UuSWQ7CgkJCQkJCX0KCQkJCQl9CgkJCQl9CgkJCX0KCQl9CgkJcmV0dXJuIG87Cgl9CgoJY0hlaWdodChvcHRpb25zKSB7CgkJaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5lZGl0b3IpIHJldHVybiB3aW5kb3cuaW5uZXJIZWlnaHQ7CgkJaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5oZWlnaHQgJiYgdHlwZW9mKG9wdGlvbnMuaGVpZ2h0KSA9PT0gJ3N0cmluZycpIHJldHVybiB0aGlzLmhlaWdodDsKCQlpZiAob3B0aW9ucyAmJiBvcHRpb25zLnR5cGUgPT0gJ3dpbmRvdycgJiYgIW9wdGlvbnMuaGVpZ2h0KSByZXR1cm4gdGhpcy5oZWlnaHQgKiAwLjk7CgkJcmV0dXJuIE1hdGguZmxvb3IoKChvcHRpb25zID8gb3B0aW9ucy5oZWlnaHQgOiBudWxsKSB8fCAodGhpcy5oZWlnaHQgLyAzKSkpOwoJfQoKCXNlYXJjaChvcHRpb25zKSB7CgkJcmV0dXJuIHRoaXMuc3RyaW5nKG9wdGlvbnMpOwoJfQoKCXN0cmluZyhvcHRpb25zKSB7CgkJb3B0aW9ucy5oZWlnaHQgPSAyMDsKCQlvcHRpb25zLnNpbXBsZSA9IHRydWU7CgkJcmV0dXJuIHRoaXMudGV4dChvcHRpb25zKTsKCX0KCglkYXRldGltZShvcHRpb25zKSB7CgkJcmV0dXJuIGA8aW5wdXQgaWQ9ImR0cCR7b3B0aW9ucy5uYW1lfSIgY2xhc3M9ImVhc3l1aS0ke3RoaXMudWlUeXBlc1tvcHRpb25zLnR5cGVdfSIgcmVxdWlyZWQ9IiR7b3B0aW9ucy5yZXF1aXJlZCA/ICd0cnVlJyA6ICdmYWxzZSd9IiB2YWx1ZT0iJHt0aGlzLnZhbHVlKG9wdGlvbnMpfSIgc3R5bGU9IndpZHRoOiR7dGhpcy5jV2lkdGgob3B0aW9ucyl9cHgiPmA7Cgl9CgoJcXVlcnkob3B0aW9ucykgewoJCXJldHVybiAiPGRpdiBpZD0ndnMiICsgb3B0aW9ucy5uYW1lICsgIic+PC9kaXY+IjsKCX0KCglEYXRlVGltZShvcHRpb25zKSB7CgkJcmV0dXJuIHRoaXMuZGF0ZXRpbWUob3B0aW9ucyk7Cgl9CgoJbG9uZyhvcHRpb25zKSB7CgkJcmV0dXJuIHRoaXMuaW50KG9wdGlvbnMpOwoJfQoKCUxvbmcob3B0aW9ucykgewoJCXJldHVybiB0aGlzLmxvbmcob3B0aW9ucyk7Cgl9CgoJdmFsdWUob3B0aW9ucykgewoJCWlmICh0eXBlb2Ygb3B0aW9ucy52YWx1ZSA9PT0gJ2Z1bmN0aW9uJykgewoJCQl0cnkgewoJCQkJcmV0dXJuIG9wdGlvbnMudmFsdWUodGhpcy5nZXQoKSk7CgkJCX0gY2F0Y2ggKGV4KSB7CgkJCQljb25zb2xlLmxvZyhgREZvcm0udmFsdWUoJHtvcHRpb25zLm5hbWV9KTogJHtleH1gKTsKCQkJCXJldHVybiAnJzsKCQkJfQoJCX0gZWxzZSB7CgkJCXN3aXRjaCAob3B0aW9ucy50eXBlKSB7CgkJCQljYXNlICdpbnQnOgoJCQkJY2FzZSAncHJvZ3Jlc3MnOgoJCQkJCXJldHVybiBvcHRpb25zLnZhbHVlIHx8IG9wdGlvbnMubWluIHx8IDA7CgkJCQljYXNlICdzdHJpbmcnOgoJCQkJY2FzZSAndGV4dCc6CgkJCQljYXNlICdkYXRldGltZSc6CgkJCQljYXNlICdsYWJlbCc6CgkJCQkJcmV0dXJuIG9wdGlvbnMudmFsdWUgfHwgIiI7CgkJCQlkZWZhdWx0OgoJCQkJCXJldHVybiBvcHRpb25zLnZhbHVlOwoJCQl9CgkJfQoJfQoKCWludChvcHRpb25zKSB7CgkJbGV0IHJldCA9IGA8aW5wdXQgaWQ9Im51ZCR7b3B0aW9ucy5uYW1lfSIgY2xhc3M9ImVhc3l1aS0ke3RoaXMudWlUeXBlc1tvcHRpb25zLnR5cGVdfSIgcmVxdWlyZWQ9IiR7b3B0aW9ucy5yZXF1aXJlZCA/ICd0cnVlJyA6ICdmYWxzZSd9IiB2YWx1ZT0iJHt0aGlzLnZhbHVlKG9wdGlvbnMpfSIgZGF0YS1vcHRpb25zPSJtaW46JHtvcHRpb25zLm1pbiB8fCAwfSxtYXg6JHtvcHRpb25zLm1heCB8fCAxMDB9LGluY3JlbWVudDoke29wdGlvbnMuaW5jcmVtZW50IHx8IDF9IiBzdHlsZT0id2lkdGg6JHt0aGlzLmNXaWR0aChvcHRpb25zKX1weDsiPjwvaW5wdXQ+YDsKCQkvL2NvbnNvbGUubG9nKHJldCk7CgkJcmV0dXJuIHJldDsKCX0KCgltZW51KG9wdGlvbnMpIHsKCQlvcHRpb25zLnR5cGUgPSBvcHRpb25zLnR5cGUgfHwgJ21lbnUnOwoJCXZhciByZXQgPSAiIjsKCQlyZXQgKz0gJzxkaXYgY2xhc3M9ImVhc3l1aS1wYW5lbCIgaWQ9Im1udScgKyBvcHRpb25zLm5hbWUgKyAnIiBzdHlsZT0icGFkZGluZzo1cHg7Ij5cbic7CgkJJC5lYWNoKG9wdGlvbnMubWVudSwgKF8sIG0pID0+IHJldCArPSBgPGEgaHJlZj0iIyIgY2xhc3M9ImVhc3l1aS0ke3RoaXMudWlUeXBlc1tvcHRpb25zLnR5cGVdfSIgZGF0YS1vcHRpb25zPSJtZW51OicjbW0ke20ubGFiZWwucmVwbGFjZSgvIC9nLCAnJyl9JyxpY29uQ2xzOidpY29uLSR7bS5pY29uIHx8ICdub25lJ30nIj4ke20ubGFiZWx9PC9hPlxuYCk7CgkJcmV0ICs9ICI8L2Rpdj5cbiI7CgoJCWxldCBkdiA9IG0gPT4gewoJCQlsZXQgcmV0ID0gJzxkaXYnICsgKG0uc3ViTWVudXMgPyAnJyA6IGAgZGF0YS1vcHRpb25zPSJpY29uQ2xzOidpY29uLSR7bS5pY29uIHx8ICdub25lJ30nImApICsgJz5cbic7CgkJCXJldCArPSBtLnN1Yk1lbnVzID8gJzxzcGFuPicgKyAobS5sYWJlbCB8fCB0aGlzLmVuZ2xpc2gobS5jb2RlKSkgKyAnPC9zcGFuPlxuPGRpdj4nIDogKGA8c3BhbiB3aWR0aD0nMTAwJScgb25jbGljaz0nKGFzeW5jICgpID0+IHtsZXQgbSA9ICR7X0ZyRU1ELl90b0pTKG0pfTsgaWYobS5hY3Rpb24pe3JldHVybiBhd2FpdCBtLmFjdGlvbihERm9ybS5nZXQoKSwgbSk7fSBpZiAobS5zdWJNZW51cykgcmV0dXJuOyBhd2FpdCBfRnJFTUQuUmVuZGVyUGFnZSh7X2NvZGU6IG0uY29kZSB8fCBtLmxhYmVsLnJlcGxhY2UoLyAvZywgIiIpLnRvTG93ZXJDYXNlKCl9LCBtLmRhdGEpO30pKCknPiR7bS5sYWJlbCB8fCB0aGlzLmVuZ2xpc2gobS5jb2RlKX08L3NwYW4+YCk7CgkJCSQuZWFjaChtLnN1Yk1lbnVzLCAoXywgcykgPT4gcmV0ICs9IGR2KHMpKTsKCQkJcmV0ICs9IChtLnN1Yk1lbnVzID8gIjwvZGl2PlxuIiA6ICIiKSArIGA8L2Rpdj5cbmA7CgkJCXJldHVybiByZXQ7CgkJfTsKCgkJcmV0ICs9IG9wdGlvbnMubWVudS5zb3J0KChhLCBiKSA9PiBhLm9yZGVyIC0gYi5vcmRlcikubWFwKG0gPT4gYDxkaXYgaWQ9Im1tJHttLmxhYmVsLnJlcGxhY2UoLyAvZywgJycpfSIgc3R5bGU9IndpZHRoOjE1MHB4OyI+JHttLnN1Yk1lbnVzLm1hcChzbSA9PiBkdihzbSkpLmpvaW4oJycpfTwvZGl2PmApLmpvaW4oJ1xuJyk7CgoJCS8qZm9yICh2YXIgaSA9IDA7IGkgPCBvcHRpb25zLm1lbnUubGVuZ3RoOyBpKyspIHsKCQkJdmFyIG0gPSBvcHRpb25zLm1lbnVbaV07CgkJCXJldCArPSAnPGRpdiBpZD0ibW0nICsgbS5sYWJlbC5yZXBsYWNlKC8gL2csICcnKSArICciIHN0eWxlPSJ3aWR0aDoxNTBweDsiPic7CgkJCWZvciAodmFyIGogPSAwOyBqIDwgbS5zdWJNZW51cy5sZW5ndGg7IGorKykgewoJCQkJdmFyIHNtID0gbS5zdWJNZW51c1tqXTsKCQkJCXJldCArPSBkdihzbSk7CgkJCX0KCQkJcmV0ICs9ICc8L2Rpdj5cbic7CgkJfSovCgoJCXJldHVybiByZXQ7Cgl9CgoJaW50ZWdlcihvcHRpb25zKSB7CgkJcmV0dXJuIHRoaXMuaW50KG9wdGlvbnMpOwoJfQoKCW51bWJlcihvcHRpb25zKSB7CgkJcmV0dXJuIHRoaXMuaW50KG9wdGlvbnMpOwoJfQoKCUludGVnZXIob3B0aW9ucykgewoJCXJldHVybiB0aGlzLmludChvcHRpb25zKTsKCX0KCglib29sKG9wdGlvbnMpIHsKCQlyZXR1cm4gYDxpbnB1dCBpZD0iJHt0aGlzLnByZWZpeChvcHRpb25zKX0ke29wdGlvbnMubmFtZX0iIGRhdGEtZGZvcm09ImVsZW1lbnQ6JHtvcHRpb25zLm5hbWV9IiByZXF1aXJlZD0iJHtvcHRpb25zLnJlcXVpcmVkPyd0cnVlJzonZmFsc2UnfSIgZGF0YS1vcHRpb25zPSdkaXNhYmxlZDoke29wdGlvbnMuZGlzYWJsZWQ/J3RydWUnOidmYWxzZSd9LCR7dGhpcy5ldmVudEhhbmRsZXJzKG9wdGlvbnMpfScgY2xhc3M9ImVhc3l1aS0ke3RoaXMudWlUeXBlc1tvcHRpb25zLnR5cGVdfSIgJHtvcHRpb25zLmNoZWNrZWQ/J2NoZWNrZWQnOicnfSAvPmA7Cgl9CgoJbGFiZWwob3B0aW9ucykgewoJCXJldHVybiBgPHNwYW4gaWQ9IiR7dGhpcy5wcmVmaXgob3B0aW9ucyl9JHtvcHRpb25zLm5hbWV9IiBzdHlsZT0id2lkdGg6JHt0aGlzLmNXaWR0aChvcHRpb25zKX1weCIgZGF0YS1vcHRpb25zPSJkaXNhYmxlZDoke29wdGlvbnMuZGlzYWJsZWQ/J3RydWUnOidmYWxzZSd9Ij4ke3RoaXMudmFsdWUob3B0aW9ucyl9PC9zcGFuPmA7Cgl9CgoJdXJsKG9wdGlvbnMpIHsKCQlyZXR1cm4gdGhpcy5zdHJpbmcob3B0aW9ucykucmVwbGFjZSgiRmllbGRDaGFuZ2UiLCAiVVJMQ2hhbmdlIik7Cgl9CgoJdGV4dChvcHRpb25zKSB7CgkJcmV0dXJuIGA8aW5wdXQgaWQ9IiR7dGhpcy5wcmVmaXgob3B0aW9ucyl9JHtvcHRpb25zLm5hbWV9IiBjbGFzcz0iZWFzeXVpLSR7b3B0aW9ucy5lZGl0b3IgfHwgdGhpcy51aVR5cGVzW29wdGlvbnMudHlwZV19IiBkYXRhLW9wdGlvbnM9J2Rpc2FibGVkOiR7b3B0aW9ucy5kaXNhYmxlZD8ndHJ1ZSc6J2ZhbHNlJ30sJHt0aGlzLmV2ZW50SGFuZGxlcnMob3B0aW9ucyl9JyBtdWx0aWxpbmU9IiR7b3B0aW9ucy5zaW1wbGUgPyAnZmFsc2UnIDogJ3RydWUnfSIgc3R5bGU9IndoaXRlLXNwYWNlOnByZS13cmFwO3dpZHRoOiR7dGhpcy5jV2lkdGgob3B0aW9ucyl9cHg7aGVpZ2h0OiR7dGhpcy5jSGVpZ2h0KG9wdGlvbnMpfXB4IiByZXF1aXJlZD0iJHtvcHRpb25zLnJlcXVpcmVkID8gJ3RydWUnIDogJ2ZhbHNlJ30iIHZhbHVlPSIke3RoaXMudmFsdWUob3B0aW9ucyl9IiAvPmA7Cgl9CgoJcGFzc3dvcmQob3B0aW9ucykgewoJCXZhciByZXQgPSB0aGlzLnN0cmluZyhvcHRpb25zKTsKCQlyZXQgPSByZXQucmVwbGFjZSgnPGlucHV0ICcsICc8aW5wdXQgdHlwZT0icGFzc3dvcmQiICcpOwoJCXJldHVybiByZXQ7Cgl9CgoJZmlsZShvcHRpb25zKSB7CgkJcmV0dXJuIGA8aW5wdXQgaWQ9IiR7dGhpcy5wcmVmaXgob3B0aW9ucyl9JHtvcHRpb25zLm5hbWV9IiBjbGFzcz0iZWFzeXVpLSR7dGhpcy51aVR5cGVzW29wdGlvbnMudHlwZV19IiBkYXRhLW9wdGlvbnM9Im9uQ2hhbmdlOmZ1bmN0aW9uKG4sbyl7dmFyIHMgPSAkKCcjJyArIHRoaXMuaWQpLmZpbGVib3goJ29wdGlvbnMnKTsgREZvcm0uVXBsb2FkRmlsZShzLCBERm9ybS5ieU5hbWUoJyR7b3B0aW9ucy5uYW1lfScpKTt9IiBzdHlsZT0id2lkdGg6JHt0aGlzLmNXaWR0aChvcHRpb25zKX1weCI+YDsKCX0KCglpbWFnZShvcHRpb25zKSB7CgkJcmV0dXJuIHRoaXMuZmlsZShvcHRpb25zKSArIGA8ZGl2IGlkPSJkbGcke29wdGlvbnMubmFtZX0iIGNsYXNzPSJlYXN5dWktJHt0aGlzLnVpVHlwZXNbb3B0aW9ucy50eXBlXX0iIHRpdGxlPSJJbWFnZSBQcmV2aWV3IiBkYXRhLW9wdGlvbnM9ImNsb3NlZDp0cnVlLGljb25DbHM6J2ljb24tc2F2ZScscmVzaXphYmxlOmZhbHNlLG1vZGFsOnRydWUiIHN0eWxlPSJ3aWR0aDo0MDBweDtoZWlnaHQ6MjAwcHg7cGFkZGluZzoxMHB4Ij48aW1nIGlkPSIke3RoaXMucHJlZml4KG9wdGlvbnMpfSR7b3B0aW9ucy5uYW1lfSIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIvPjwvZGl2PmA7Cgl9CgoJcHJvZ3Jlc3Mob3B0aW9ucykgewoJCWlmICghb3B0aW9ucy5oZWlnaHQpIG9wdGlvbnMuaGVpZ2h0ID0gMjA7IC8vIGZpeCBiaWcgcHJvZ3Jlc3MKCQlyZXR1cm4gYDxkaXYgaWQ9IiR7dGhpcy5wcmVmaXgob3B0aW9ucyl9JHtvcHRpb25zLm5hbWV9IiBjbGFzcz0iZWFzeXVpLSR7dGhpcy51aVR5cGVzW29wdGlvbnMudHlwZV19IiBkYXRhLW9wdGlvbnM9InZhbHVlOiR7dGhpcy52YWx1ZShvcHRpb25zKX0iIHN0eWxlPSJ3aWR0aDoke3RoaXMuY1dpZHRoKG9wdGlvbnMpfXB4O2hlaWdodDoke3RoaXMuY0hlaWdodChvcHRpb25zKX1weCI+PC9kaXY+YDsKCX0KCglmbG93Y2hhcnQob3B0aW9ucykgewoJCXJldHVybiBgPGRpdiBpZD0iZmx3JHtvcHRpb25zLm5hbWV9IiB3aWR0aD0iJHt0aGlzLmNXaWR0aChvcHRpb25zKX0iIGhlaWdodD0iJHt0aGlzLmNIZWlnaHQob3B0aW9ucyl9Ij48L2Rpdj5gOwoJfQoKCWNoYXJ0KG9wdGlvbnMpIHsKCQlyZXR1cm4gYDxkaXYgaWQ9ImNodCR7b3B0aW9ucy5uYW1lfSIgd2lkdGg9IiR7dGhpcy5jV2lkdGgob3B0aW9ucyl9IiBoZWlnaHQ9IiR7dGhpcy5jSGVpZ2h0KG9wdGlvbnMpfSI+PC9kaXY+YDsKCX0KCglmb3JtYXR0ZXIobmFtZSwgYywganNvbikgewoJCWpzb24gPSBqc29uID8gJyInIDogJyc7CgkJcmV0dXJuIGAke2pzb259KHZhbHVlLCByb3csIGluZGV4KSA9PiB7dHJ5e3ZhciBjID0gKERGb3JtLmJ5TmFtZShcYCR7bmFtZX1cYCkuY29sdW1ucyB8fCBbXSkuZmluZChjID0+IGMuZmllbGQ9PVxgJHtjLmZpZWxkfVxgKTsgcmV0dXJuIGMmJmMuZm9ybWF0P2MuZm9ybWF0KHZhbHVlLHJvdyxpbmRleCk6dmFsdWU7fWNhdGNoKGV4KXtyZXR1cm4gdmFsdWU7fSB9JHtqc29ufWA7Cgl9CgoJbWFwQ29sdW1ucyhvcHRpb25zLCBqc29uKSB7CgkJbGV0IGNUaXRsZSA9IGMgPT4gYy50aXRsZSB8fCB0aGlzLmVuZ2xpc2goYy5maWVsZCk7CgoJCXZhciBjb2xzID0gJC5ncmVwKG9wdGlvbnMuY29sdW1ucyB8fCBbXSwgYyA9PiAhYy5pZ25vcmUpOwoJCWxldCByZXQgPSAiIjsKCQlpZiAob3B0aW9ucy5tdWx0aXBsZSkgcmV0ICs9IGB7ImZpZWxkIjonY2snLCJjaGVja2JveCI6dHJ1ZX0sYDsKCQlyZXQgPSBgImZyb3plbkNvbHVtbnMiOiBbW2A7CgkJaWYgKCFvcHRpb25zLmZyb3plbikgewoJCQlyZXQgKz0gYHsiZmllbGQiOiIke29wdGlvbnMuaWRGaWVsZC5maWVsZH0iLCJ0aXRsZSI6ICIke29wdGlvbnMuaWRGaWVsZC50aXRsZX0iLCJzb3J0YWJsZSI6ICJ0cnVlIiwgImZvcm1hdHRlciI6ICR7dGhpcy5mb3JtYXR0ZXIob3B0aW9ucy5uYW1lLCBvcHRpb25zLmlkRmllbGQsIGpzb24pfX0sYDsKCQkJaWYgKG9wdGlvbnMudGV4dEZpZWxkLmZpZWxkICE9IG9wdGlvbnMuaWRGaWVsZC5maWVsZCkgcmV0ICs9IGB7ImZpZWxkIjoiJHtvcHRpb25zLnRleHRGaWVsZC5maWVsZCB8fCBvcHRpb25zLnRleHRGaWVsZC50aXRsZX0iLCJ0aXRsZSI6IiR7b3B0aW9ucy50ZXh0RmllbGQudGl0bGUgfHwgb3B0aW9ucy50ZXh0RmllbGQuZmllbGR9Iiwid2lkdGgiOiIke29wdGlvbnMudGV4dEZpZWxkLndpZHRofHwxMjB9IiwgInNvcnRhYmxlIjogInRydWUiLCAiZm9ybWF0dGVyIjogJHt0aGlzLmZvcm1hdHRlcihvcHRpb25zLm5hbWUsIG9wdGlvbnMudGV4dEZpZWxkLCBqc29uKX19YDsKCQl9IGVsc2UgewoJCQkkLm1hcCgkLmdyZXAoY29scywgYyA9PiBjLmZyb3plbiksIGMgPT4gYHsiZmllbGQiOiIke2MuZmllbGQgfHwgY1RpdGxlKGMpfSIsInRpdGxlIjoiJHtjVGl0bGUoYykgfHwgYy5maWVsZH0iLCJ3aWR0aCI6IiR7Yy53aWR0aHx8MTIwfSIsImFsaWduIjonbGVmdCcsInNvcnRhYmxlIjoidHJ1ZSIsICJmb3JtYXR0ZXIiOiAke3RoaXMuZm9ybWF0dGVyKG9wdGlvbnMubmFtZSwgYywganNvbil9fWApLmpvaW4oIiwiKTsKCQl9CgkJcmV0ICs9IGBdXSwgImNvbHVtbnMiOiBbW2A7CgkJcmV0ICs9ICQubWFwKCQuZ3JlcChjb2xzLCBjID0+ICFjLmZyb3plbiksIGMgPT4gYHsiZmllbGQiOiIke2MuZmllbGQgfHwgY1RpdGxlKGMpfSIsInRpdGxlIjoiJHtjVGl0bGUoYykgfHwgYy5maWVsZH0iLCJhbGlnbiI6ImxlZnQiLCJzb3J0YWJsZSI6InRydWUiLCAiZm9ybWF0dGVyIjogJHt0aGlzLmZvcm1hdHRlcihvcHRpb25zLm5hbWUsIGMsIGpzb24pfX1gKS5qb2luKCIsIik7CgkJcmV0ICs9ICddXSc7CgoJCS8vY29uc29sZS5sb2coIkR5bmFGb3JtOjptYXBDb2x1bW5zKCIgKyBvcHRpb25zLm5hbWUgKyAiKTogIiwgcmV0LCBqc29uKTsKCQlyZXR1cm4gcmV0OwoJfQoKCXNlbGVjdChvcHRpb25zLCB0YWcgPSBvcHRpb25zLnRhZywgdHlwZSkgewoJCXJldHVybiB0aGlzLmNvbWJvKG9wdGlvbnMsIHRhZywgdHlwZSk7Cgl9CgoJdHJlZShvcHRpb25zKSB7CgkJcmV0dXJuIHRoaXMuc2VsZWN0KG9wdGlvbnMsICJzZWxlY3QiKTsKCX0KCgluYXZpZ2F0aW9uKG9wdGlvbnMpIHsKCQlyZXR1cm4gdGhpcy5jb21ibyhvcHRpb25zLCAndWwnLCAndHJlZScpOwoJfQoKCWNvbWJvKG9wdGlvbnMsIHRhZywgdHlwZSkgewoJCXZhciBjb2xzID0gJC5ncmVwKG9wdGlvbnMuY29sdW1ucyB8fCBbXSwgYyA9PiAhYy5pZ25vcmUpOwoJCXRhZyA9IHRhZyB8fCAic2VsZWN0IjsKCgkJb3B0aW9ucy5pZEZpZWxkID0gJC51bmlxdWVTb3J0KFt7CgkJCWZpZWxkOiBvcHRpb25zLmlkRmllbGQsCgkJCXRpdGxlOiBvcHRpb25zLmlkRmllbGQKCQl9XS5jb25jYXQoJC5ncmVwKGNvbHMsIGMgPT4gYy5wcmltYXJ5KSwgW3sKCQkJZmllbGQ6ICdJZCcsCgkJCXRpdGxlOiAnSUQnCgkJfV0pKS5maW5kKHggPT4gdHlwZW9mKHguZmllbGQpICE9PSAidW5kZWZpbmVkIik7CgoJCW9wdGlvbnMudGV4dEZpZWxkID0gJC51bmlxdWVTb3J0KFt7CgkJCWZpZWxkOiBvcHRpb25zLnRleHRGaWVsZCwKCQkJdGl0bGU6IG9wdGlvbnMudGV4dEZpZWxkCgkJfV0uY29uY2F0KCQuZ3JlcChjb2xzLCBjID0+IGMuZGlzcGxheSksIFt7CgkJCWZpZWxkOiAnX1RvU3RyaW5nJywKCQkJdGl0bGU6IG9wdGlvbnMubmFtZSwKCQl9XSkpLmZpbmQoeCA9PiB0eXBlb2YoeC5maWVsZCkgIT09ICJ1bmRlZmluZWQiKTsKCgkJLy9jb25zb2xlLmxvZygiRHluYUZvcm06OmNvbWJvKCk6IG9wdGlvbnMiLCBvcHRpb25zKTsKCgkJdmFyIGZ1biA9IHR5cGUgfHwgdGhpcy5lRnVuKG9wdGlvbnMpOwoKCQl2YXIgZHJvcGRvd24gPSBbJ2NvbWJvdHJlZWdyaWQnLCAnY29tYm90cmVlJywgJ2NvbWJvZ3JpZCcsICdzZWxlY3QnXS5pbmRleE9mKGZ1bikgPiAtMTsKCQlpZiAoZHJvcGRvd24pIHRoaXMuc2VsZWN0cy5wdXNoKHsKCQkJaWQ6ICJjbWIiICsgb3B0aW9ucy5uYW1lLAoJCQlvcHRpb25zOiB0aGlzLmJ5TmFtZShvcHRpb25zLm5hbWUpCgkJfSk7CgkJdGhpcy5zZWxlY3RzID0gJC51bmlxdWVTb3J0KHRoaXMuc2VsZWN0cyk7CgkJdmFyIHJldCA9IGA8JHt0YWd9IGlkPSJjbWIke29wdGlvbnMubmFtZX0iIGNsYXNzPSJlYXN5dWktJHtmdW59IiBzdHlsZT0ibWF4LXdpZHRoOiR7ZHJvcGRvd24/JzQwMHB4Jzp0aGlzLmNXaWR0aChvcHRpb25zKX07IHdpZHRoOiR7dGhpcy5jV2lkdGgob3B0aW9ucyl9cHgiIHJlcXVpcmVkPSIkeyhvcHRpb25zLnJlcXVpcmVkID8gJ3RydWUnIDogJ2ZhbHNlJyl9IiBkYXRhLW9wdGlvbnM9J2Rpc2FibGVkOiR7b3B0aW9ucy5kaXNhYmxlZD8ndHJ1ZSc6J2ZhbHNlJ30sJHt0aGlzLmV2ZW50SGFuZGxlcnMob3B0aW9ucyl9LCB2YWx1ZToiJHt0aGlzLnZhbHVlKG9wdGlvbnMpfSIsIHJvd251bWJlcnM6JHt0eXBlb2Yob3B0aW9ucy5yb3dOdW1iZXJzKSE9PSd1bmRlZmluZWQnP29wdGlvbnMucm93TnVtYmVyczooZnVuLmluZGV4T2YoJ3RyZWUnKTwtMT8nZmFsc2UnOid0cnVlJyl9LCBwYWdpbmF0aW9uOiR7dHlwZW9mKG9wdGlvbnMucGFnaW5hdGlvbikhPT0ndW5kZWZpbmVkJz9vcHRpb25zLnBhZ2luYXRpb246KGZ1bi5pbmRleE9mKCd0cmVlJyk8LTE/J2ZhbHNlJzondHJ1ZScpfSwgcGFuZWxXaWR0aDokezIqdGhpcy5jV2lkdGgob3B0aW9ucyl9LCBmaXRDb2x1bW5zOiB0cnVlLCBzaW5nbGVTZWxlY3Q6IHRydWUsIG11bHRpcGxlOiR7KG9wdGlvbnMubXVsdGlwbGUgfHwgJ2ZhbHNlJyl9LCBpZEZpZWxkOiAiJHtvcHRpb25zLmlkRmllbGQuZmllbGR9IiwgZW5hYmxlRmlsdGVyOiAke29wdGlvbnMuZmlsdGVyPyd0cnVlJzonZmFsc2UnfSwgbm93cmFwOiBmYWxzZSwgdGV4dEZpZWxkOiAiJHtvcHRpb25zLnRleHRGaWVsZC5maWVsZH0iLCB0cmVlRmllbGQ6ICIke29wdGlvbnMudGV4dEZpZWxkLmZpZWxkfSIsYDsKCQlpZiAoZnVuLmluZGV4T2YoJ3RyZWUnKSA9PSAtMSkgewoJCQlyZXQgKz0gJ2ZpdENvbHVtbnM6IGZhbHNlLCcgKyB0aGlzLm1hcENvbHVtbnMob3B0aW9ucyk7CgkJfQoJCWlmIChvcHRpb25zLmRhdGEpIHsKCQkJcmV0ICs9IGAsZGF0YTogJHtKU09OLnN0cmluZ2lmeShvcHRpb25zLmRhdGEpfWA7CgkJfQoJCXJldCArPSBgJz5gOwoJCWlmIChvcHRpb25zLm9wdGlvbnMpIHsKCQkJcmV0ICs9ICQubWFwKG9wdGlvbnMub3B0aW9ucywgbyA9PiBgPG9wdGlvbiB2YWx1ZT0nJHtfRnJFTUQuX3RvSlMobyl9Jz4ke28ubmFtZSB8fCBvfTwvb3B0aW9uPmApLmpvaW4oJ1xuJyk7CgkJfQoJCXJldCArPSBgPC8ke3RhZ30+YDsKCQkvLyBjb25zb2xlLmxvZyhyZXQpOwoJCXJldHVybiByZXQ7Cgl9CgoJZ3JpZChvcHRpb25zLCB0YWcsIHR5cGUpIHsKCQlyZXR1cm4gdGhpcy5jb21ibyhvcHRpb25zLCAidGFibGUiLCAiZGF0YWdyaWQiKTsKCX0KCgl0cmVlZ3JpZChvcHRpb25zKSB7CgkJcmV0dXJuIHRoaXMuY29tYm8ob3B0aW9ucywgJ3RhYmxlJywgJ3RyZWUnKTsKCX0KCglhc3luYyBkb0xpbmsoZSwgZXZlbnQpIHsKCQl0aGlzLmJ1c3kodHJ1ZSk7CgkJdHJ5IHsKCQkJYXdhaXQgZS5saW5rcy5maW5kKGwgPT4gbC5sYWJlbCA9PSBldmVudC50YXJnZXQuaW5uZXJUZXh0KS5vbkNsaWNrKHRoaXMuZ2V0KCkpOwoJCX0gY2F0Y2ggKGV4KSB7CgkJCWNvbnNvbGUubG9nKCJEeW5hRm9ybTo6ZG9MaW5rKCk6IEV4Y2VwdGlvbjogIiArIGV4KTsKCQl9CgkJdGhpcy5idXN5KGZhbHNlKTsKCX0KCglFZGl0ZWRWYWx1ZShlKSB7CgkJcmV0dXJuICh0eXBlb2YoYWNlKSAhPT0gInVuZGVmaW5lZCIpID8gYWNlLmVkaXQoJ3BubCcgKyBlLm5hbWUpLnNlc3Npb24uZ2V0VmFsdWUoKSA6ICcnOwoJfQoKCWFzeW5jIFBhbk9uQ2xvc2UoZSkgewoJCWlmIChlLmVkaXRvcikgewoJCQllLnZhbHVlID0gdGhpcy5FZGl0ZWRWYWx1ZShlKTsKCQl9CgkJaWYgKGUuY2xvc2UpIHsKCQkJYXdhaXQgZS5jbG9zZSh0aGlzLmdldCgpKTsKCQl9Cgl9CgoJYXN5bmMgUGVuZEFmdGVyT3BlbihlKSB7CgkJaWYgKGUuZWRpdG9yICYmIHR5cGVvZihhY2UpICE9PSAidW5kZWZpbmVkIikgewoJCQlhd2FpdCBfRnJFTUQuT3BlbkVkaXRvcigncG5sJyArIGUubmFtZSAvKisgJy1jZW50ZXInKi8gLCBlLmxhbmd1YWdlLCBlLmxvYWRlciB8fCAobyA9PiBlLnZhbHVlKSwgZS5zYXZlciwgdGhpcy5nZXQoKSwgZSk7CgkJfQoJCWlmIChlLm9wZW4pIHsKCQkJYXdhaXQgZS5vcGVuKHRoaXMuZ2V0KCkpOwoJCX0KCX0KCglsaW5rKG9wdGlvbnMpIHsKCQlyZXR1cm4gKG9wdGlvbnMubGlua3MgfHwgW10pLmZpbHRlcihsID0+ICFsLmlnbm9yZSkubWFwKGwgPT4gYDxhIGhyZWY9IiMiIGNsYXNzPSJlYXN5dWktJHt0aGlzLnVpVHlwZXNbb3B0aW9ucy50eXBlXX0iIGRhdGEtb3B0aW9ucz0nJHt0aGlzLmV2ZW50SGFuZGxlcnMob3B0aW9ucyl9LCBpY29uQ2xzOiJpY29uLSR7bC5pY29uIHx8ICdvayd9Iic+JHtsLmxhYmVsfTwvYT5gKS5qb2luKCdcbicpOwoJfQoKCWFzeW5jIFNldFRyZWVEYXRhKGUsIG4sIGRhdGEpIHsKCQkkLmVhY2goJCgiI2NtYiIgKyBlLm5hbWUpW3RoaXMuZUZ1bihlKV0oJ3RyZWUnKS50cmVlKCJnZXRDaGlsZHJlbiIsIG4udGFyZ2V0KSwgKF8sIGMpID0+ICQoIiNjbWIiICsgZS5uYW1lKVt0aGlzLmVGdW4oZSldKCd0cmVlJykudHJlZSgicmVtb3ZlIiwgYy50YXJnZXQpKTsKCQkkKCIjY21iIiArIGUubmFtZSlbdGhpcy5lRnVuKGUpXSgndHJlZScpLnRyZWUoImFwcGVuZCIsIHsKCQkJcGFyZW50OiBuLnRhcmdldCwKCQkJZGF0YTogZGF0YQoJCX0pOwoJCXJldHVybiB0cnVlOwoJfQoKCWFzeW5jIEV4cGFuZChlLCBuKSB7CgkJdGhpcy5TZXRUcmVlRGF0YShlLCBuLCBbewoJCQlpZDogbnVsbCwKCQkJdGV4dDogImxvYWRpbmcuLi4iCgkJfV0pOwoJCXZhciBvYmogPSB7fTsKCQl2YXIgcEZpZWxkID0gZS5wYXJlbnRGaWVsZCB8fCAkLm1hcCgkLmdyZXAoZS5jb2x1bW5zIHx8IFtdLCBjID0+IGMucGFyZW50KSwgYyA9PiBjLmZpZWxkKS5jb25jYXQoW251bGxdKVswXTsKCQl2YXIgaWRGaWVsZCA9ICQuZ3JlcChlLmNvbHVtbnMgfHwgW10sIGMgPT4gYy5wcmltYXJ5KS5jb25jYXQoZS5pZEZpZWxkKVswXS5maWVsZDsKCQlpZiAocEZpZWxkKSB7CgkJCW9ialtwRmllbGRdID0gewoJCQkJX3NvdXJjZTogbi5fc291cmNlCgkJCX07CgkJCWlmIChpZEZpZWxkKSB7CgkJCQlvYmpbcEZpZWxkXVtpZEZpZWxkXSA9IG4uaWQ7CgkJCX0gZWxzZSB7CgkJCQlvYmpbcEZpZWxkXSA9IG4uaWQ7CgkJCX0KCQl9CgkJbGV0IGRhdGEgPSBhd2FpdCB0aGlzLl9sb2FkRGF0YSh7CgkJCWlkOiAiY21iIiArIGUubmFtZSwKCQkJb3B0aW9uczogZQoJCX0sIG9iaik7CgkJdGhpcy5TZXRUcmVlRGF0YShlLCBuLCBkYXRhKTsKCX0KCglhc3luYyBfbG9hZERhdGEocywgbywgc3RhcnQsIGVuZCkgewoJCXZhciBuYW1lID0gKHMgJiYgcy5vcHRpb25zID8gKHMub3B0aW9ucy5DbGFzcyA/IHMub3B0aW9ucy5DbGFzcy5OYW1lLnJlcGxhY2UoJyAnLCAnXycpIDogKHMub3B0aW9ucy50YWJsZSB8fCBzLm9wdGlvbnMubmFtZSkpIDogcy5uYW1lKTsKCQluYW1lID0gbmFtZS50cmltKCk7IC8vLnNwbGl0KCcuJykuc2xpY2UoLTEpWzBdOwoKCQlsZXQgb1Njb3BlID0gKHR5cGVvZihjb21wYW55KSAhPT0gJ3VuZGVmaW5lZCcgJiYgY29tcGFueS5TY29wZSkgPyB3aW5kb3dbY29tcGFueS5TY29wZV0gOiB3aW5kb3c7CgkJbyA9IG8gfHwgKChvU2NvcGUgJiYgb1Njb3BlW25hbWVdKSA/IG5ldyBvU2NvcGVbbmFtZV0oKSA6IHsKCQkJQWN0aXZlOiB0cnVlLAoJCX0pOwoKCQlvID0gKHR5cGVvZiBmaWx0ZXJzICE9PSAidW5kZWZpbmVkIiAmJiBmaWx0ZXJzICYmIGZpbHRlcnNbbmFtZV0pID8gZmlsdGVyc1tuYW1lXShvKSA6IG87CgkJdmFyIGZ1biA9IHRoaXMuZUZ1bihzLm9wdGlvbnMpOwoJCWxldCBzVGV4dCA9ICQoIiMiICsgcy5pZClbZnVuXSgnZ2V0VGV4dCcpOwoKCQlvID0gKHMgJiYgcy5vcHRpb25zICYmIHMub3B0aW9ucy5zb3VyY2UpID8gcy5vcHRpb25zLnNvdXJjZShvLCB0aGlzLmdldCgpLCBzVGV4dCkgOiBvOwoJCWxldCBuYW1lcyA9ICQudW5pcXVlU29ydChbcy5vcHRpb25zLnNlYXJjaEZpZWxkXS5jb25jYXQoJC5tYXAoJC5ncmVwKHMub3B0aW9ucy5jb2x1bW5zIHx8IFtdLCBjID0+IGMuc2VhcmNoKSwgYyA9PiBjLmZpZWxkKSwgWyJOYW1lIl0pKS5maWx0ZXIodiA9PiB2KTsKCQlpZiAoIW9bbmFtZXNbMF1dKSBvW25hbWVzWzBdXSA9IHNUZXh0OwoJCS8vY29uc29sZS5sb2coIkR5bmFGb3JtOjpfbG9hZERhdGEoKTogbyIsIG8pOwoJCXZhciBkYXRhID0gbnVsbDsKCgkJbGV0IGxpYiA9ICcnOwoJCWlmIChuYW1lLmluZGV4T2YoJy4nKSA+IDApIHsKCQkJbGliID0gbmFtZS5zcGxpdCgnLicpWzBdICsgJy4nOwoJCQluYW1lID0gbmFtZS5zcGxpdCgnLicpWzFdOwoJCX0KCgkJaWYgKHMub3B0aW9ucy5sb2FkZXIpIHsKCQkJZGF0YSA9IGF3YWl0IHMub3B0aW9ucy5sb2FkZXIodGhpcy5nZXQoKSwgcy5vcHRpb25zLCBvLCBzVGV4dCk7CgkJfSBlbHNlIGlmIChvICYmIHR5cGVvZihvLmZpbmRBbGwpID09PSAnZnVuY3Rpb24nKSB7CgkJCWRhdGEgPSBhd2FpdCBvLmZpbmRBbGwoKTsKCQl9IGVsc2UgaWYgKHR5cGVvZihjb21wYW55KSAhPT0gJ3VuZGVmaW5lZCcgJiYgY29tcGFueS5saWJyYXJ5ICYmIGNvbXBhbnkuQ29kZSAmJiB3aW5kb3cuYkxvY2FsKSB7CgkJCS8vY29uc29sZS5sb2coIkRGb3JtOjpfbG9hZERhdGEoKTogc3IoKS5fKCIgKyBsaWIgKyBjb21wYW55LkNvZGUudG9Mb3dlckNhc2UoKSArIG5hbWUgKyAiRmluZGFsbCIgKyAiKSIsIG8pOwoJCQlkYXRhID0gYXdhaXQgdGhpcy5zcigpLl8obGliICsgY29tcGFueS5Db2RlLnRvTG93ZXJDYXNlKCkgKyBuYW1lICsgIkZpbmRhbGwiLCBudWxsLCBvLCBudWxsLCBzdGFydCwgZW5kKTsKCQl9IGVsc2UgaWYgKF9GckVNRC5hcGlTZXJ2ZXIpIHsKCQkJbyA9IE9iamVjdC5hc3NpZ24oLi4uT2JqZWN0LmtleXMobykubWFwKGsgPT4gKHsKCQkJCVtTdHJpbmcoaykuY2hhckF0KDApLnRvTG93ZXJDYXNlKCkgKyBTdHJpbmcoaykuc2xpY2UoMSldOiBvW2tdCgkJCX0pKSk7CgkJCWNvbnNvbGUubG9nKCJERm9ybTo6X2xvYWREYXRhKCk6IHVzaW5nIF9GckVNRC5hcGlTZXJ2ZXI6IG8iLCBvKTsKCQkJZGF0YSA9IGF3YWl0IF9GckVNRC5hcGlTZXJ2ZXIuX25ldyhuYW1lKS5fZnJvbURvY3VtZW50KG8pLmZpbmRBbGwoKTsKCQkJLy9kYXRhLmZpbHRlcihkID0+IGQuSWQgIT0gZC5JZCkuZm9yRWFjaChkID0+IGQuSWQgPSBkLl91dWlkKG51bGwsIG51bGwsIHRydWUpKTsKCQl9CgoJCWlmIChzLm9wdGlvbnMucG9zdGxvYWQpIHsKCQkJYXdhaXQgcy5vcHRpb25zLnBvc3Rsb2FkKGRhdGEpOwoJCX0KCQkkLmVhY2goZGF0YSwgKGksIGQpID0+IHsKCQkJZC5fX09XTkVSID0gczsKCQkJJC5lYWNoKHMub3B0aW9ucy5jb2x1bW5zLCAoXywgYykgPT4gewoJCQkJaWYgKGMudmFsdWUpIHsKCQkJCQlkW2MuZmllbGRdID0gYy52YWx1ZShkLCBkYXRhLCBpKTsKCQkJCX0KCQkJfSk7CgkJfSk7CgkJaWYgKCFzLm9wdGlvbnMuY29sdW1ucyAmJiBmdW4uaW5kZXhPZigndHJlZScpID4gLTEpIHsKCQkJZGF0YSA9ICQubWFwKGRhdGEsIGQgPT4gewoJCQkJbGV0IHJldCA9IHsKCQkJCQlpZDogZFtzLm9wdGlvbnMuaWRGaWVsZC5maWVsZF0sCgkJCQkJdGV4dDogZFtzLm9wdGlvbnMudGV4dEZpZWxkLmZpZWxkXSwKCQkJCQlzdGF0ZTogZC5zdGF0ZSB8fCAocy5vcHRpb25zLmxvYWRlciA/ICJmaWxlIiA6ICJjbG9zZWQiKSwKCQkJCQlfc291cmNlOiBkLAoJCQkJfTsKCQkJCXJldC5jaGlsZHJlbiA9IChyZXQuc3RhdGUgPT0gImNsb3NlZCIpID8gW3sKCQkJCQl0ZXh0OiAnbG9hZGluZy4uLicKCQkJCX1dIDogbnVsbDsKCQkJCXJldHVybiByZXQ7CgkJCX0pOwoJCX0KCQlyZXR1cm4gZGF0YSB8fCBbXTsKCX0KCglhc3luYyBmaWxsRGF0YShnLCBvLCBzdGFydCwgZW5kKSB7CgkJdmFyIHMgPSBudWxsOwoJCWZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5zZWxlY3RzLmxlbmd0aDsgaSsrKSB7CgkJCWlmICh0aGlzLnNlbGVjdHNbaV0uaWQgPT0gZ1swXS5pZCkgcyA9IHRoaXMuc2VsZWN0c1tpXTsKCQl9CgkJaWYgKCFzKSByZXR1cm47CgkJdGhpcy5idXN5KHRydWUpOwoJCXRyeSB7CgkJCXZhciBmdW4gPSBnWzBdLmNsYXNzTGlzdFsiMCJdLnJlcGxhY2UoJ2Vhc3l1aS0nLCAnJyk7CgkJCXRyeSB7CgkJCQkkKCIjIiArIHMuaWQpW2Z1bl0oJ2dyaWQnKS5kYXRhZ3JpZCgnZ2V0UGFnZXInKS5wYWdpbmF0aW9uKCdsb2FkaW5nJyk7CgkJCX0gY2F0Y2ggKGV4KSB7fQoJCQlpZiAocy5vcHRpb25zLm5vbG9hZCkgewoJCQkJbGV0IF9kYXRhID0gbnVsbDsKCQkJCXRyeSB7CgkJCQkJX2RhdGEgPSAkKCIjIiArIHMuaWQpW2Z1bl0oJ2dyaWQnKS5kYXRhZ3JpZCgiZ2V0RGF0YSIpOwoJCQkJfSBjYXRjaCAoZXgpIHsKCQkJCQlfZGF0YSA9ICQoIiMiICsgcy5pZClbZnVuXSgndHJlZScpLnRyZWUoJ2dldFJvb3QnKTsKCQkJCX0KCQkJCWlmIChfZGF0YSkgewoJCQkJCXJldHVybiB0aGlzLmJ1c3koZmFsc2UpOwoJCQkJfQoJCQl9CgkJCXZhciBkYXRhID0gYXdhaXQgdGhpcy5fbG9hZERhdGEocywgbywgc3RhcnQsIGVuZCk7CgkJCXRyeSB7CgkJCQlpZiAoJCgiIyIgKyBzLmlkKVtmdW5dKCdncmlkJykpICQoIiMiICsgcy5pZClbZnVuXSgnZ3JpZCcpLmRhdGFncmlkKCdnZXRQYWdlcicpLnBhZ2luYXRpb24oJ2xvYWRlZCcpOwoJCQl9IGNhdGNoIChleCkge30KCQkJdHJ5IHsKCQkJCSQoIiMiICsgcy5pZClbZnVuXSgnZ3JpZCcpLmRhdGFncmlkKCdsb2FkRGF0YScsIHsKCQkJCQl0b3RhbDogZGF0YS5Db3VudCB8fCBkYXRhLmxlbmd0aCwKCQkJCQlyb3dzOiBkYXRhLAoJCQkJfSk7CgkJCX0gY2F0Y2ggKGV4KSB7CgkJCQkkKCIjIiArIHMuaWQpW2Z1bl0oJ3RyZWUnKS50cmVlKCdsb2FkRGF0YScsIGRhdGEpOwoJCQl9CgkJfSBjYXRjaCAoZXgpIHsKCQkJY29uc29sZS5sb2coZXgpOwoJCX0KCQl0aGlzLmJ1c3koZmFsc2UpOwoJfQoKCWV2ZW50SGFuZGxlcnMob3B0aW9ucykgewoJCS8vY29uc29sZS5sb2coIkR5bmFGb3JtOjpldmVudEhhbmRsZXJzKCk6IG9wdGlvbnMiLCBvcHRpb25zKTsKCQlpZiAoIXRoaXMuYnlOYW1lKG9wdGlvbnMubmFtZSkpIHJldHVybjsgLy8gaWYgbm90IGFuIGVsZW1lbnQsIGRvIG5vdCBydW4gdGhlIGhhbmRsZXJzCgoJCXJldHVybiB0aGlzLmV2ZW50cy5maWx0ZXIoZSA9PiBlLnR5cGUgPT0gb3B0aW9ucy50eXBlIHx8IHR5cGVvZihlLnR5cGUpID09PSAndW5kZWZpbmVkJykubWFwKGUgPT4gYCR7ZS5uYW1lfTogKCR7ZS5wYXJhbXMgfHwgJyd9KSA9PiB7dHJ5e0RGb3JtLiR7ZS5oYW5kbGVyfShERm9ybS5ieU5hbWUoIiR7b3B0aW9ucy5uYW1lfSIpIHx8ICR7X0ZyRU1ELl90b0pTKG9wdGlvbnMpfSB8fCB7bmFtZTogIiR7b3B0aW9ucy5uYW1lfSIsdHlwZTogIiR7b3B0aW9ucy50eXBlfSJ9LCAke2UucGFyYW1zfSl9Y2F0Y2goZXgpe2NvbnNvbGUubG9nKCJFdmVudCBFcnJvcjogJHtvcHRpb25zLm5hbWV9LyR7b3B0aW9ucy50eXBlfS8ke2UubmFtZX0iLCBleCk7fX1gKS5qb2luKCcsJyk7Cgl9CgoJYXN5bmMgUGFuZWxPcGVuKGUpIHsKCQlpZiAoZS5lZGl0b3IpIHJldHVybiB0cnVlOwoJCWxldCBjb250ZW50ID0gZS52YWx1ZTsKCQlpZiAoZS5sb2FkZXIpIHsKCQkJY29udGVudCA9IGF3YWl0IGUubG9hZGVyKHRoaXMuZ2V0KCkpOwoJCX0KCQlpZiAoY29udGVudCkgewoJCQl0cnkgewoJCQkJJCgiI3BubCIgKyBlLm5hbWUpLnBhbmVsKCdib2R5JykuaHRtbChjb250ZW50KTsKCQkJCWNvbnNvbGUubG9nKCJwbmwiICsgZS5uYW1lICsgIjogQ29udGVudCBWYWxpZCIpOwoJCQl9IGNhdGNoIChleCkgewoJCQkJLy9jb25zb2xlLmxvZyhleCk7CgkJCX0KCQl9CgkJcmV0dXJuIGNvbnRlbnQ7Cgl9CgoJYXN5bmMgU2VsZWN0Q2hhbmdlKG9wdGlvbnMsIHRhYikgewoJCXRoaXMuYnVzeSh0cnVlKTsKCQkkLmdyZXAodGhpcy5lbGVtZW50cywgZSA9PiBlLnR5cGUgPT0gImdyaWQiICYmIGUuZ3JvdXAgPT0gdGFiKS5mb3JFYWNoKGUgPT4gJCgiI2NtYiIgKyBlLm5hbWUpLmRhdGFncmlkKCkpOwoJCXRoaXMuYnVzeShmYWxzZSk7Cgl9CgoJYXN5bmMgRmllbGRDaGFuZ2Uob3B0aW9ucywgdmFsdWUpIHsKCQl0aGlzLmJ1c3kodHJ1ZSk7CgkJaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5jaGFuZ2UpIHsKCQkJYXdhaXQgb3B0aW9ucy5jaGFuZ2UodGhpcy5nZXQoKSwgdmFsdWUpOwoJCX0KCQl0aGlzLmJ1c3koZmFsc2UpOwoJfQoKCWFzeW5jIFVSTENoYW5nZShzLCBvcHRpb25zKSB7CgkJb3B0aW9ucy5kYXRhID0gYXdhaXQgJC5nZXQocy52YWx1ZSk7CgkJcmV0dXJuIGF3YWl0IHRoaXMuRmllbGRDaGFuZ2Uocywgb3B0aW9ucyk7Cgl9CgoJVXBsb2FkRmlsZShmLCBvcHRpb25zKSB7CgkJdGhpcy5idXN5KHRydWUpOwoJCXZhciBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSgpOwoJCXZhciBmaWxlaWQgPSBNYXRoLnJhbmRvbSgpOwoJCXZhciBtZXRob2QgPSBvcHRpb25zLm1ldGhvZCB8fCAiQ29udGVudE1hbmFnZXIuY21zVXBsb2FkRmlsZSI7CgkJZm9ybURhdGEuYXBwZW5kKCdmaWxlaWQnLCBmaWxlaWQpOwoJCXZhciBmaWxlID0gJCgiIyIgKyBmLmZpbGVib3hJZClbMF0uZmlsZXNbMF07CgkJZm9ybURhdGEuYXBwZW5kKCdfX1VGSUxFJywgZmlsZSk7CgkJaWYgKG9wdGlvbnMubG9jYWwpIHsKCQkJLy8gaGFuZGxpbmcgdGhlIGZpbGUgbG9jYWxseQoJCQl2YXIgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTsKCQkJcmVhZGVyLm9ubG9hZCA9IChlKSA9PiB7CgkJCQl2YXIgZGF0YSA9IGUudGFyZ2V0LnJlc3VsdDsKCQkJCXJldCA9IGRhdGE7CgkJCQlERm9ybS5ieU5hbWUob3B0aW9ucy5uYW1lKS5kYXRhID0gcmV0OwoJCQkJaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy51cGxvYWQpIG9wdGlvbnMudXBsb2FkKHRoaXMuZ2V0KCksIHJldCk7CgkJCX07CgkJCWlmIChvcHRpb25zLmJpbmFyeSkgewoJCQkJcmVhZGVyLnJlYWRBc0JpbmFyeVN0cmluZyhmaWxlKTsKCQkJfSBlbHNlIGlmIChvcHRpb25zLmRhdGF1cmwpIHsKCQkJCXJlYWRlci5yZWFkQXNEYXRhVVJMKGZpbGUpOwoJCQl9IGVsc2UgewoJCQkJcmVhZGVyLnJlYWRBc1RleHQoZmlsZSk7CgkJCX0KCQkJdGhpcy5idXN5KGZhbHNlKTsKCQl9IGVsc2UgaWYgKG1ldGhvZCkgewoJCQkkLmFqYXgoewoJCQkJdXJsOiB0aGlzLnNyKCkuc3JVUkwgKyAiJm1ldGhvZD0iICsgbWV0aG9kICsgIiZzSW5wdXQ9IiArIGZpbGVpZCArICImcHJlVGFnPSZwb3N0VGFnPSIsCgkJCQlkYXRhOiBmb3JtRGF0YSwKCQkJCS8vIFRISVMgTVVTVCBCRSBET05FIEZPUiBGSUxFIFVQTE9BRElORwoJCQkJY2FjaGU6IGZhbHNlLAoJCQkJY29udGVudFR5cGU6IGZhbHNlLAoJCQkJdHlwZTogJ1BPU1QnLAoJCQkJcHJvY2Vzc0RhdGE6IGZhbHNlLAoJCQkJc3VjY2VzczogZGF0YSA9PiB7CgkJCQkJdGhpcy5zcigpLnJ1blNjcmlwdChkYXRhKTsKCQkJCQl0aGlzLmJ5TmFtZShvcHRpb25zLm5hbWUpLmRhdGEgPSByZXQ7CgkJCQkJaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy51cGxvYWQpIG9wdGlvbnMudXBsb2FkKHRoaXMuZ2V0KCksIHJldCk7CgkJCQkJdGhpcy5idXN5KGZhbHNlKTsKCQkJCX0KCQkJfSk7CgkJfQoJfQoKCWVGdW4oZSkgewoJCXRyeSB7CgkJCWlmIChlLnR5cGUgPT0gInRyZWUiKSB7CgkJCQlpZiAoZS5jb2x1bW5zKSB7CgkJCQkJcmV0dXJuICJjb21ib3RyZWVncmlkIjsKCQkJCX0gZWxzZSBpZiAodHlwZW9mKGUuY29tYm8pICE9PSAndW5kZWZpbmVkJyAmJiAhZS5jb21ibykgewoJCQkJCXJldHVybiAndHJlZSc7CgkJCQl9IGVsc2UgewoJCQkJCXJldHVybiAiY29tYm90cmVlIjsKCQkJCX0KCQkJfSBlbHNlIGlmIChlLnR5cGUgPT0gJ25hdmlnYXRpb24nKSB7CgkJCQlyZXR1cm4gJ3RyZWUnOwoJCQl9IGVsc2UgaWYgKGUudHlwZSA9PSAiY29tYm90cmVlIikgewoJCQkJcmV0dXJuICJjb21ib3RyZWVncmlkIjsKCQkJfSBlbHNlIGlmIChlLnR5cGUgPT0gInNlbGVjdCIgJiYgZS5vcHRpb25zKSB7CgkJCQlyZXR1cm4gImNvbWJvYm94IjsKCQkJfQoJCQlyZXR1cm4gImNvbWJvZ3JpZCI7CgkJfSBjYXRjaCAoZXgpIHsKCQkJcmV0dXJuICJjb21ib2dyaWQiOwoJCX0KCX0KCglfZmlsbFdpbmRvdyh3aW5OYW1lLCB2LCBtYXApIHsKCQl2ID0gdiB8fCB7fTsKCQltYXAgPSBtYXAgfHwge307CgkJaWYgKEFycmF5LmlzQXJyYXkobWFwKSkgewoJCQltYXAgPSBPYmplY3QuZnJvbUVudHJpZXMobmV3IE1hcChtYXApKTsKCQl9CgoJCW1hcCA9ICQuZXh0ZW5kKHt9LCBtYXAsIE9iamVjdC5mcm9tRW50cmllcyhPYmplY3Qua2V5cyh2KS5tYXAoayA9PiBbd2luTmFtZSArIGssIGtdKSkpOwoKCQlsZXQgcyA9IHt9OwoJCWZvciAodmFyIG0gaW4gbWFwKSB7CgkJCWlmICh0eXBlb2YodlttYXBbbV1dKSA9PT0gInVuZGVmaW5lZCIpIHsKCQkJCS8vY29uc29sZS5sb2coJ2lzX3VuZGVmaW5lZCcsIG0sIG1hcFttXSwgdlttYXBbbV1dKTsKCQkJCXNbbV0gPSBtYXBbbV07CgkJCX0gZWxzZSB7CgkJCQkvL2NvbnNvbGUubG9nKCdpc19ub3RfdW5kZWZpbmVkJywgbSwgbWFwW21dLCB2W21hcFttXV0pOwoJCQkJc1ttXSA9IHZbbWFwW21dXTsKCQkJfQoJCX0KCQl0aGlzLmNsZWFyKHdpbk5hbWUpOwoJCS8vY29uc29sZS5sb2coInMiLCBzKTsKCQl0aGlzLnNldChzKTsKCQkkKCIjcG5sXyIgKyB3aW5OYW1lKS53aW5kb3coIm9wZW4iKTsKCX0KCgl3aW5kb3dUb0VudGl0eShvLCBiRW1wdHksIGdyaWQsIHByZWZpeCwgZmlsdGVyKSB7CgkJbyA9IG8gfHwgdGhpcy5nZXQoKTsKCQlmaWx0ZXIgPSBmaWx0ZXIgfHwgKHYgPT4gdik7CgkJbGV0IHJldCA9IGdyaWQgPyAoZ3JpZC5zZWxlY3RlZCB8fCBncmlkKSA6IG51bGw7CgkJaWYgKGJFbXB0eSkgewoJCQlyZXQgPSB7fTsKCQkJbyA9IHt9OwoJCX0gZWxzZSB7CgkJCXJldCA9IChyZXQgJiYgcmV0LklkKSA/IHsKCQkJCUlkOiByZXQuSWQKCQkJfSA6IHt9OwoJCX0KCgkJdGhpcy5lbGVtZW50cy5maWx0ZXIoZSA9PiAocHJlZml4ID8gZS5ncm91cCA9PSBwcmVmaXggOiB0cnVlKSAmJiBlLnR5cGUgIT0gJ2xpbmsnICYmIFsnXyddLmluZGV4T2YoZS5uYW1lLnJlcGxhY2UocHJlZml4LCAiIikpIDwgMCkuZm9yRWFjaChlID0+IHsKCQkJcmV0W2UubmFtZS5yZXBsYWNlKHByZWZpeCwgIiIpXSA9IG9bZS5uYW1lXTsKCQkJcmV0dXJuIHRydWU7CgkJfSk7CgoJCWZpbHRlcihyZXQpOwoKCQlyZXR1cm4gcmV0OwoJfQoKCWJpbmQob2JqKSB7CgkJdmFyIG9iakJpbmQgPSAobywgZSkgPT4gewoJCQlvW3RoaXMuZUZ1bihlKV0oewoJCQkJb25TaG93UGFuZWw6ICgpID0+IHsKCQkJCQl0aGlzLmZpbGxEYXRhKCQoIiMiICsgZS5pZCksIG51bGwsIDAsIDEwKTsKCQkJCX0sCgkJCQlvbkNsaWNrUm93OiAoaW5kZXgsIHJvdykgPT4gewoJCQkJCXZhciBzID0gcm93ID8gcm93Ll9fT1dORVIgOiBudWxsOwoJCQkJCS8vIGNvbnNvbGUubG9nKCJvbkNsaWNrUm93KCk6ICIsIGluZGV4LCByb3csIHMpOwoJCQkJCWlmIChzICYmIHMub3B0aW9ucy5zZWxlY3QpIHsKCQkJCQkJcy5vcHRpb25zLnNlbGVjdChyb3csIHRoaXMuZ2V0KCkpOwoJCQkJCX0KCQkJCX0KCQkJfSk7CgkJCXRyeSB7CgkJCQl2YXIgZGcgPSBvW3RoaXMuZUZ1bihlKV0oJ2dyaWQnKTsKCQkJCS8vIGRnLmRhdGFncmlkKCdlbmFibGVGaWx0ZXInKQoJCQkJdmFyIHN0YXRlID0gZGcuZGF0YSgnZGF0YWdyaWQnKTsKCQkJCXZhciBvcHRzID0gc3RhdGUub3B0aW9uczsKCQkJCXZhciBvbkJlZm9yZUxvYWQgPSBvcHRzLm9uQmVmb3JlTG9hZDsKCQkJCW9wdHMub25CZWZvcmVMb2FkID0gKHBhcmFtKSA9PiB7CgkJCQkJc3RhdGUuYWxsUm93cyA9IG51bGw7CgkJCQkJcmV0dXJuIG9uQmVmb3JlTG9hZC5jYWxsKHRoaXMsIHBhcmFtKTsKCQkJCX07CgkJCQl2YXIgcGFnZXIgPSBkZy5kYXRhZ3JpZCgnZ2V0UGFnZXInKTsKCQkJCWRnLmRhdGFncmlkKCdnZXRQYW5lbCcpLnBhbmVsKHsKCQkJCQlJRDogaQoJCQkJfSk7CgkJCQlwYWdlci5wYWdpbmF0aW9uKHsKCQkJCQlvblNlbGVjdFBhZ2U6IGZ1bmN0aW9uKHBhZ2VOdW0sIHBhZ2VTaXplKSB7CgkJCQkJCXRyeSB7CgkJCQkJCQlERm9ybS5maWxsRGF0YSgkKCIjIiArIERGb3JtLnNlbGVjdHNbJCh0aGlzLnBhcmVudE5vZGUpLnBhbmVsKCdvcHRpb25zJykuSURdLmlkKSwgbnVsbCwgcGFnZVNpemUgKiAocGFnZU51bSAtIDEpLCBwYWdlU2l6ZSAqIHBhZ2VOdW0pOwoJCQkJCQl9IGNhdGNoIChfZXgpIHsKCQkJCQkJCWNvbnNvbGUubG9nKCJEeW5hRm9ybTo6b25TZWxlY3RQYWdlKCkgIiwgX2V4KTsKCQkJCQkJfQoJCQkJCX0KCQkJCX0pOwoJCQkJZGcuZGF0YWdyaWQoJ2xvYWREYXRhJywgc3RhdGUuZGF0YSk7CgkJCX0gY2F0Y2ggKGV4KSB7fQoJCX07CgkJaWYgKG9iaikgewoJCQlvYmpCaW5kKG9iaik7CgkJfSBlbHNlIHsKCQkJZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnNlbGVjdHMubGVuZ3RoOyBpKyspIHsKCQkJCWlmICh0aGlzLnNlbGVjdHNbaV0ub3B0aW9ucy5vcHRpb25zKSB7CgkJCQkJLy8kKCIjIiArIHRoaXMuc2VsZWN0c1tpXS5pZCkuY29tYm8oKTsKCQkJCX0gZWxzZSB7CgkJCQkJb2JqQmluZCgkKCIjIiArIHRoaXMuc2VsZWN0c1tpXS5pZCksIHRoaXMuc2VsZWN0c1tpXSk7CgkJCQl9CgkJCX0KCgkJCXRoaXMuZWxlbWVudHMuZmlsdGVyKGUgPT4gZS53aW5kb3cgJiYgZS5ncm91cCkuZm9yRWFjaChlID0+IHsKCQkJCWxldCB0ID0gJCgiI3RiY1dpbmRvdyIpLnRhYnMoImdldFRhYiIsIGUuZ3JvdXApOwoJCQkJaWYgKHQpIHsKCQkJCQl0LnBhbmVsKCdvcHRpb25zJykudGFiLmhpZGUoKTsKCQkJCX0KCQkJfSk7CgkJfQoJfQoKCWVuZ2xpc2gocykgewoJCWlmICghcykgcmV0dXJuICIiOwoJCXZhciByZXN1bHQgPSBzLnJlcGxhY2UoLyhbQS1aXSkvZywgIiAkMSIpOwoJCXJlc3VsdCA9IHJlc3VsdC5yZXBsYWNlKC9fL2csICcnKTsKCQlyZXR1cm4gcmVzdWx0LmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgcmVzdWx0LnNsaWNlKDEpOwoJfQoKCW9uVG9nZ2xlKGUsIGJWYWx1ZSkgewoJCWxldCBzVGFnID0gYCNmRWxlbWVudF8ke2UuZm9yLm5hbWV9ID4gLmVhc3l1aS0ke3RoaXMudWlUeXBlc1tlLmZvci50eXBlXX1gOwoJCWxldCBvVGFnID0gJChzVGFnKTsKCQllLmZvci5lbmFibGVkID0gdHlwZW9mKGJWYWx1ZSkgPT09ICJ1bmRlZmluZWQiID8gIWUuZm9yLmVuYWJsZWQgOiBiVmFsdWU7CgoJCW9UYWcucHJvcCgiZGlzYWJsZWQiLCAhZS5mb3IuZW5hYmxlZCk7CgkJLy9vVGFnW3RoaXMudWlUeXBlc1tlLmZvci50eXBlXV0oZS5mb3IuZW5hYmxlZCA/ICJlbmFibGUiIDogImRpc2FibGUiKTsKCQljb25zb2xlLmxvZyhzVGFnLCBvVGFnLCB0aGlzLnVpVHlwZXNbZS5mb3IudHlwZV0sIGUuZm9yLmVuYWJsZWQpOwoJfQoKCXJlbmRlcihuYW1lLCB0aXRsZSwgZWxlbWVudHMsIGJ1dHRvbnMsIGJGaXhlZCkgewoJCXRoaXMuZWxlbWVudHMgPSAoZWxlbWVudHMgfHwgW10pLmZpbHRlcihlID0+ICFlLmlnbm9yZSk7CgoJCXRoaXMuYnV0dG9ucyA9IGJ1dHRvbnMgfHwgW107CgkJdGhpcy5zZWxlY3RzID0gW107CgkJdGhpcy5ncmlkcyA9IFtdOwoKCQl0aGlzLmVsZW1lbnRzLmZpbHRlcihlID0+IGUudHlwZSA9PSAid2luZG93IikuZm9yRWFjaCh3ID0+IHRoaXMuZWxlbWVudHMuc3BsaWNlKHRoaXMuZWxlbWVudHMuZmluZEluZGV4KGUgPT4gZS5uYW1lID09IHcubmFtZSksIDAsIHsKCQkJbmFtZTogIl8iICsgdy5uYW1lLAoJCQl0eXBlOiAibGluayIsCgkJCXRpdGxlOiB3LnRpdGxlIHx8IHRoaXMuZW5nbGlzaCh3Lm5hbWUpLAoJCQlncm91cDogdy5ncm91cCwKCQkJd2luZG93OiB3LndpbmRvdywKCQkJc2VjdGlvbjogdy5zZWN0aW9uLAoJCQlsaW5rczogW3sKCQkJCWxhYmVsOiAnT3BlbicsCgkJCQlpY29uOiAnZWRpdCcsCgkJCQlvbkNsaWNrOiBvID0+ICQoIiNwbmwiICsgdy5uYW1lKS53aW5kb3coJ29wZW4nKQoJCQl9XSwKCQl9KSk7CgoJCXRoaXMuc3IoKS5ncm91cEJ5KHRoaXMuZWxlbWVudHMuZmlsdGVyKGUgPT4gZS53aW5kb3cpLCAiZ3JvdXAiKS5mb3JFYWNoKGt2ID0+IHsKCQkJaWYgKCFrdi5rZXkpIHJldHVybjsKCgkJCWxldCBlID0gewoJCQkJbmFtZTogIl8iICsga3Yua2V5LAoJCQkJdGl0bGU6IGt2LmtleSwKCQkJCXR5cGU6ICJ3aW5kb3ciLAoJCQkJZ3JvdXA6IGt2LmtleSwKCQkJCXdpZHRoOiB0aGlzLndpZHRoICogMC45LAoJCQkJaGVpZ2h0OiB0aGlzLmhlaWdodCAqIDAuOSwKCQkJCWxvYWRlcjogbyA9PiB7CgkJCQkJa3YudmFsdWVzLmZpbHRlcih2ID0+IHYudHlwZSAhPT0gJ2xpbmsnIHx8ICh2LnR5cGUgPT0gJ2xpbmsnICYmIHYubmFtZS5zdGFydHNXaXRoKCdfJykpKS5mb3JFYWNoKHYgPT4gJCgiI3BubF8iICsgdi5ncm91cCArICctY2VudGVyJykuYXBwZW5kKCQoIiNmRWxlbWVudF8iICsgdi5uYW1lKSkpOwoJCQkJCXJldHVybiBudWxsOwoJCQkJfSwKCQkJCWJ1dHRvbnM6IFtdLmNvbmNhdC5hcHBseShbXSwga3YudmFsdWVzLmZpbHRlcih2ID0+IHYudHlwZSA9PSAnbGluaycgJiYgIXYubmFtZS5zdGFydHNXaXRoKCdfJykpLm1hcCh2ID0+IFsuLi52LmxpbmtzLm1hcChsID0+ICh7CgkJCQkJbmFtZTogbC5uYW1lIHx8IGwubGFiZWwsCgkJCQkJdGl0bGU6IGwudGl0bGUgfHwgbC5sYWJlbCwKCQkJCQlvbkNsaWNrOiBsLm9uQ2xpY2ssCgkJCQkJaWNvbjogbC5pY29uLAoJCQkJCXdpbmRvdzogdHJ1ZSwKCQkJCQlncm91cDoga3Yua2V5LAoJCQkJfSkpXSkpLAoJCQl9OwoJCQl0aGlzLmJ1dHRvbnMucHVzaCguLi5lLmJ1dHRvbnMpOwoKCQkJdGhpcy5lbGVtZW50cy5wdXNoKGUpOwoJCX0pOwoKCQl2YXIgcmV0ID0gIiI7CgkJLy8gY2hlY2sgdGhlIG9wdGlvbiBvZiB1c2luZyB3aW5kb3coKSBhcyBhIHJlbmRlcmVyIG9mIHRoZSBtYWluIHdpbmRvdy4uLgoJCWlmICh0cnVlKSB7CgkJCXRoaXMuZWxlbWVudHMuZmlsdGVyKGUgPT4gIWUuem9uZSkuZm9yRWFjaChlID0+IGUuem9uZSA9ICdjZW50ZXInKTsKCQkJbGV0IHdPcHRpb25zID0gewoJCQkJbmFtZTogbmFtZSB8fCB0aGlzLm5hbWUsCgkJCQl0aXRsZTogdGl0bGUgfHwgdGhpcy50aXRsZSwKCQkJCXR5cGU6ICd3aW5kb3cnLAoJCQkJdmlzaWJsZTogdHJ1ZSwKCQkJCXdpZHRoOiB0aGlzLndpZHRoLAoJCQkJaGVpZ2h0OiB0aGlzLmhlaWdodCwKCQkJCWZpeGVkOiBiRml4ZWQsCgkJCQlsaW5rczogW3sKCQkJCQlpY29uOiAiaGVscCIsCgkJCQkJYWN0aW9uOiBvID0+ICQoIiNwbmxfX0NvbnNvbGUiKS53aW5kb3coJ29wZW4nKQoJCQkJfV0sCgkJCQlidXR0b25zOiB0aGlzLmJ1dHRvbnMuZmlsdGVyKGIgPT4gIWIud2luZG93KSwKCQkJfTsKCQkJdGhpcy5zcigpLmdyb3VwQnkodGhpcy5lbGVtZW50cywgJ3pvbmUnKS5maWx0ZXIoemcgPT4gemcua2V5KS5mb3JFYWNoKHpnID0+IHsKCQkJCXdPcHRpb25zW3pnLmtleV0gPSB0aGlzLnJlbmRlckVsZW1lbnRzKHpnLnZhbHVlcyk7CgkJCX0pOwoKCQkJcmV0ID0gdGhpcy53aW5kb3cod09wdGlvbnMpOwoJCX0gZWxzZSB7CgkJCXJldCA9IHRoaXMuaGVhZGVyKG5hbWUsIHRpdGxlLCBiRml4ZWQsIFt7CgkJCQlpY29uOiAiaGVscCIsCgkJCQlhY3Rpb246IG8gPT4gJCgiI3BubF9fQ29uc29sZSIpLndpbmRvdygnb3BlbicpCgkJCX1dKTsKCgkJCXJldCArPSB0aGlzLnJlbmRlckVsZW1lbnRzKCk7CgoJCQlyZXQgKz0gdGhpcy5mb290ZXIoYkZpeGVkKTsKCgkJfQoJCS8vIGNvbnNvbGUubG9nKHJldCk7CgoJCXJldHVybiByZXQ7Cgl9CgoJY1dpZHRoKG9wdGlvbnMpIHsKCQlsZXQgcmV0ID0gTWF0aC5mbG9vcigoKG9wdGlvbnMgPyBvcHRpb25zLndpZHRoIDogbnVsbCkgfHwgKHRoaXMud2lkdGggLyAzKSkpOwoJCWlmIChvcHRpb25zLnpvbmUgPT0gJ2Vhc3QnIHx8IG9wdGlvbnMuem9uZSA9PSAnd2VzdCcpIHsKCQkJcmV0ID0gMC4yNSAqIHJldDsgLy8gOTAlIG9mIDMvMTAsIHRoZSB3aWR0aCBvZiB0aGUgbm9ybWFsIGVsZW1lbnQKCQl9IGVsc2UgaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5lZGl0b3IpIHsKCQkJcmV0ID0gd2luZG93LmlubmVyV2lkdGg7CgkJfSBlbHNlIGlmIChvcHRpb25zICYmIG9wdGlvbnMud2lkdGggJiYgdHlwZW9mKG9wdGlvbnMud2lkdGgpID09PSAnc3RyaW5nJykgewoJCQlyZXQgPSB0aGlzLndpZHRoOwoJCX0gZWxzZSBpZiAob3B0aW9ucyAmJiBvcHRpb25zLnR5cGUgPT0gJ3dpbmRvdycgJiYgIW9wdGlvbnMud2lkdGgpIHsKCQkJcmV0ID0gdGhpcy53aWR0aCAqIDAuOTsKCQl9CgoJCS8vIGNvbnNvbGUubG9nKG9wdGlvbnMubmFtZSArICI6IGNXaWR0aCA9ICIgKyByZXQsIG9wdGlvbnMuem9uZSk7CgkJcmV0dXJuIHJldDsKCX0KCgl3aW5kb3cob3B0aW9ucykgewoJCW9wdGlvbnMudGl0bGUgPSBvcHRpb25zLnRpdGxlIHx8IG9wdGlvbnMubmFtZTsKCQl2YXIgcmV0ID0gYAoJCTxkaXYgaWQgPSAicG5sJHtvcHRpb25zLm5hbWV9IiBjbGFzcz0iZWFzeXVpLXdpbmRvdyIgdGl0bGU9IiR7b3B0aW9ucy50aXRsZSB8fCB0aGlzLmVuZ2xpc2gob3B0aW9ucy5uYW1lKX0iIGRhdGEtb3B0aW9ucz0nJHt0aGlzLmV2ZW50SGFuZGxlcnMob3B0aW9ucyl9LCBjbG9zZWQ6JHshb3B0aW9ucy52aXNpYmxlfSxtaW5pbWl6YWJsZTokeyFvcHRpb25zLmZpeGVkfSxtYXhpbWl6YWJsZTokeyFvcHRpb25zLmZpeGVkfSxjbG9zYWJsZTokeyFvcHRpb25zLmZpeGVkfSxjb2xsYXBzaWJsZTokeyFvcHRpb25zLmZpeGVkfSxkcmFnZ2FibGU6JHshb3B0aW9ucy5maXhlZH0scmVzaXphYmxlOiR7IW9wdGlvbnMuZml4ZWR9LGljb25DbHM6Imljb24tJHtvcHRpb25zLmljb259IiwgdG9vbHM6IiMke29wdGlvbnMubmFtZX1fdG9vbHMiJyBzdHlsZT0id2lkdGg6JHt0aGlzLmNXaWR0aChvcHRpb25zKX1weDtoZWlnaHQ6JHt0aGlzLmNIZWlnaHQob3B0aW9ucyl9cHg7cGFkZGluZzoxMHB4OyI+CgkJICAgIDxkaXYgY2xhc3M9ImVhc3l1aS1sYXlvdXQiIGRhdGEtb3B0aW9ucz0iZml0OnRydWUiPgoJCWA7CgoJCWxldCBiWm9uZSA9IG9wdGlvbnMuc291dGggPyAnc291dGgnIDogKHRoaXMuem9uZXMuZmluZCh6ID0+IHogPT0gJ3NvdXRoJykgfHwgdGhpcy56b25lc1swXSk7CgkJb3B0aW9uc1tiWm9uZV0gPSBvcHRpb25zW2Jab25lXSB8fCBbXTsKCQlsZXQgeldpZHRoID0gTWF0aC5taW4oMTIwLCB0aGlzLndpZHRoICogMC45NSAvIChvcHRpb25zLmJ1dHRvbnMgPyBvcHRpb25zLmJ1dHRvbnMubGVuZ3RoIDogMSksIHRoaXMuY1dpZHRoKG9wdGlvbnMpKTsKCQlvcHRpb25zW2Jab25lXS5wdXNoKGA8ZGl2IGlkPSJwbmwke29wdGlvbnMubmFtZX0tYnV0dG9ucyIgZGF0YS1vcHRpb25zPSJyZWdpb246JyR7YlpvbmV9Jyxib3JkZXI6ZmFsc2UiIHN0eWxlPSJ0ZXh0LWFsaWduOnJpZ2h0O3BhZGRpbmc6NXB4IDAgMDsiPmAgKyAkLm1hcCgkLmdyZXAob3B0aW9ucy5idXR0b25zIHx8IFtdLCBiID0+ICFiLmlnbm9yZSksIGIgPT4gYDxhIGlkPScke2IubmFtZX0nIGhyZWY9ImphdmFzY3JpcHQ6dm9pZCgwKSIgY2xhc3M9ImVhc3l1aS1saW5rYnV0dG9uIGM2IiBpY29uQ2xzPSJpY29uLSR7Yi5pY29uIHx8ICdzYXZlJ30iIHN0eWxlPSJ3aWR0aDoke3pXaWR0aH1weCIgb25jbGljaz0nREZvcm0uZG9DbGljaygke19GckVNRC5fdG9KUyhiKX0pJz4ke2IudGl0bGUgfHwgYi5uYW1lfTwvYT4mbmJzcDsmbmJzcDtgKS5qb2luKCcnKSArIGA8L2Rpdj5gKTsKCgkJdGhpcy56b25lcy5maWx0ZXIoeiA9PiBvcHRpb25zW3pdKS5mb3JFYWNoKHogPT4gewoJCQlyZXQgKz0gYAoJCSAgICAgICAgPGRpdiBkYXRhLW9wdGlvbnM9InJlZ2lvbjonJHt6fSciIHRpdGxlPSIkeyh6PT0nd2VzdCcgfHwgej09J2Vhc3QnKT8nJm5ic3A7JzonJ30iIHN0eWxlPSdoZWlnaHQ6JHsoej09J25vcnRoJ3x8ej09J3NvdXRoJyk/MTA6MTAwfSU7d2lkdGg6JHsoKHo9PSdlYXN0J3x8ej09J3dlc3QnKT8wLjE6MSkqdGhpcy5jV2lkdGgob3B0aW9ucyl9cHgnPgogICAgICAgIAkJICAgICR7KEFycmF5LmlzQXJyYXkob3B0aW9uc1t6XSk/b3B0aW9uc1t6XTpbb3B0aW9uc1t6XV0pLmpvaW4oJycpfQogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIGA7CgkJfSk7CgoJCXJldCArPSBgPC9kaXY+PC9kaXY+YDsKCgkJLy8gbGlua3MgKHRvb2xzKQoJCWxldCBsaW5rcyA9ICQuZ3JlcChbXS5jb25jYXQob3B0aW9ucy5saW5rcyB8fCBbXSksIGwgPT4gIWwuaWdub3JlKTsKCQlyZXQgKz0gYDxkaXYgaWQ9IiR7b3B0aW9ucy5uYW1lfV90b29scyI+YCArICQubWFwKGxpbmtzLnJldmVyc2UoKSwgbCA9PiBgPGEgaHJlZj0iamF2YXNjcmlwdDp2b2lkKDApIiBzdHlsZT0iY29sb3I6YmxhY2siIGNsYXNzPSJmYXMgZmEtJHtsLmljb24gfHwgJ2FkZCd9IiBvbmNsaWNrPScoYXN5bmMgKCkgPT4ge3ZhciBhID0gJHtfRnJFTUQuX3RvSlMobCl9OyAkKCIjcG5sJHtvcHRpb25zLm5hbWV9Iikud2luZG93KCJzZXRUaXRsZSIsICIke29wdGlvbnMudGl0bGV9OiAiICsgYS5uYW1lKTsgYXdhaXQgYS5hY3Rpb24oREZvcm0uZ2V0KCksIGEsICR7X0ZyRU1ELl90b0pTKG9wdGlvbnMpfSk7ICQoIiNwbmwke29wdGlvbnMubmFtZX0iKS53aW5kb3coInNldFRpdGxlIiwgIiR7b3B0aW9ucy50aXRsZX0iKTt9KSgpJz48L2E+YCkuam9pbignXG4nKSArIGA8L2Rpdj5gOwoKCQlyZXR1cm4gcmV0OwoJfQoKCWFzeW5jIF9lbmQoKSB7CgkJbGV0IG8gPSB0aGlzLmdldCgpOwoKCQkvLyBkbyBub3QgdXNlIHRoZSBmaXJzdCBidXR0b24sIGJlY2F1c2UgbWFueSBmb3JtcyBoYXZlIGEgQ2FuY2VsIGJ1dHRvbiBvbmx5CgkJbGV0IGJ1dHRvbiA9IHRoaXMuYnV0dG9ucy5maW5kKGIgPT4gYi5hdXRvU3VibWl0KSAvKiB8fCB0aGlzLmJ1dHRvbnNbMF0qLyA7CgkJaWYgKGJ1dHRvbiAmJiBvICYmIE9iamVjdC52YWx1ZXMobykubGVuZ3RoICYmICh0eXBlb2YoYnV0dG9uLmF1dG9TdWJtaXQpID09PSAidW5kZWZpbmVkIiB8fCBidXR0b24uYXV0b1N1Ym1pdCkpIHsKCQkJbGV0IHYgPSBPYmplY3QudmFsdWVzKG8pLnJlZHVjZSgodCwgdikgPT4gewoJCQkJcmV0dXJuICgodHlwZW9mKHYpICE9PSAib2JqZWN0IikgPyAxIDogMCkgKiAodiA/IDEgOiAwKTsKCQkJfSk7CgkJCS8vY29uc29sZS5sb2cobywgT2JqZWN0LnZhbHVlcyhvKSwgdik7CgkJCWlmICh2KSB7CgkJCQkvLyBhbGwgZmllbGRzIGhhdmUgdmFsdWVzCgkJCQlhd2FpdCB0aGlzLmRvQ2xpY2soYnV0dG9uKTsKCgkJCX0KCQl9Cgl9CgoJZm9vdGVyKGJGaXhlZCkgewoJCXJldHVybiBgPC9mb3JtPmAgKyBgPGRpdiBpZD0iZGxnLWJ1dHRvbnMiPmAgKyB0aGlzLmJ1dHRvbnMuZmlsdGVyKGIgPT4gIWIud2luZG93KS5tYXAoYiA9PiBgPGEgaWQ9JyR7Yi5uYW1lfScgaHJlZj0iamF2YXNjcmlwdDp2b2lkKDApIiBjbGFzcz0iZWFzeXVpLWxpbmtidXR0b24gYzYiIGljb25DbHM9Imljb24tJHtiLmljb24gfHwgJ3NhdmUnfSIgc3R5bGU9IndpZHRoOiR7TWF0aC5taW4oMTIwLCB0aGlzLndpZHRoICogMC45NSAvIHRoaXMuYnV0dG9ucy5sZW5ndGgsIHRoaXMuY1dpZHRoKCkpfXB4IiBvbmNsaWNrPSdERm9ybS5kb0NsaWNrKCR7X0ZyRU1ELl90b0pTKGIpfSknPiR7Yi50aXRsZSB8fCBiLm5hbWV9PC9hPiZuYnNwOyZuYnNwO2ApLmpvaW4oJycpICsgIjwvZGl2PiIgKyAoYkZpeGVkID8gIiIgOiAnPC9kaXY+Jyk7Cgl9CgoJaGVhZGVyKG5hbWUsIHRpdGxlLCBiRml4ZWQsIGxpbmtzKSB7CgkJdGhpcy50aXRsZSA9IHRpdGxlIHx8IHRoaXMudGl0bGU7CgkJbmFtZSA9IG5hbWUgfHwgdGhpcy5uYW1lOwoJCXZhciByZXQgPSAnJzsKCgkJcmV0ICs9IHRoaXMud2luZG93KHsKCQkJbmFtZTogIl9fQ29uc29sZSIsCgkJCXR5cGU6ICJ3aW5kb3ciLAoJCQllZGl0b3I6IHRydWUsCgkJCWxvYWRlcjogbyA9PiB3aW5kb3cubG9ncy5zbGljZSgpLnJldmVyc2UoKS5tYXAobCA9PiBsLmRhdGUudG9JU09TdHJpbmcoKSArICI6ICIgKyBsLmFyZ3MubWFwKHMgPT4gdHlwZW9mKHMpID09PSAnb2JqZWN0JyA/ICgob2JqLCBpbmRlbnQgPSAyKSA9PiB7CgkJCQlsZXQgY2FjaGUgPSBbXTsKCQkJCWNvbnN0IHJldFZhbCA9IEpTT04uc3RyaW5naWZ5KAoJCQkJCW9iaiwKCQkJCQkoa2V5LCB2YWx1ZSkgPT4KCQkJCQl0eXBlb2YgdmFsdWUgPT09ICJvYmplY3QiICYmIHZhbHVlICE9PSBudWxsID8KCQkJCQljYWNoZS5pbmNsdWRlcyh2YWx1ZSkgPwoJCQkJCXVuZGVmaW5lZCAvLyBEdXBsaWNhdGUgcmVmZXJlbmNlIGZvdW5kLCBkaXNjYXJkIGtleQoJCQkJCToKCQkJCQljYWNoZS5wdXNoKHZhbHVlKSAmJiB2YWx1ZSAvLyBTdG9yZSB2YWx1ZSBpbiBvdXIgY29sbGVjdGlvbgoJCQkJCToKCQkJCQl2YWx1ZSwKCQkJCQlpbmRlbnQKCQkJCSk7CgkJCQljYWNoZSA9IG51bGw7CgkJCQlyZXR1cm4gcmV0VmFsOwoJCQl9KShzKSA6IHMpLmpvaW4oJywgJykpLmpvaW4oJ1xuJyksCgkJfSk7CgoJCWlmICghYkZpeGVkKSB7CgkJCWxpbmtzID0gKGxpbmtzIHx8IFtdKS5maWx0ZXIobCA9PiAhbC5pZ25vcmUpOwoJCQlsZXQgdERhdGEgPSAiIjsKCQkJaWYgKGxpbmtzLmxlbmd0aCkgewoJCQkJcmV0ICs9IGA8ZGl2IGlkPSIke3RoaXMubmFtZX1fdG9vbHMiPmAgKyBsaW5rcy5tYXAobCA9PiBgPGEgaHJlZj0iamF2YXNjcmlwdDp2b2lkKDApIiBjbGFzcz0iaWNvbi0ke2wuaWNvbn0iIG9uY2xpY2s9Jyhhc3luYyAoKSA9PiB7dmFyIGEgPSAke19GckVNRC5fdG9KUyhsKX07ICQoIiN3aW4ke3RoaXMubmFtZX0iKS53aW5kb3coInNldFRpdGxlIiwgIiR7dGhpcy50aXRsZX06ICIgKyBhLm5hbWUpOyBhd2FpdCBhLmFjdGlvbihERm9ybS5nZXQoKSk7ICQoIiN3aW4ke3RoaXMubmFtZX0iKS53aW5kb3coInNldFRpdGxlIiwgIiR7dGhpcy50aXRsZX0iKTt9KSgpJz48L2E+YCkuam9pbignXG4nKSArICI8L2Rpdj4iOwoJCQkJdERhdGEgPSBgLHRvb2xzOiIjJHt0aGlzLm5hbWV9X3Rvb2xzImA7CgkJCX0KCQkJcmV0ICs9IGA8ZGl2IGlkPSd3aW4ke3RoaXMubmFtZX0nIGNsYXNzPSdlYXN5dWktd2luZG93JyB0aXRsZT0nJHt0aGlzLnRpdGxlIHx8IHRoaXMuZW5nbGlzaCh0aGlzLm5hbWUpfScgZGF0YS1vcHRpb25zPSdpY29uQ2xzOiJpY29uLXNhdmUiICR7dERhdGF9JyBzdHlsZT0nd2lkdGg6JHt0aGlzLndpZHRofXB4O2hlaWdodDoke3RoaXMuaGVpZ2h0fXB4O3BhZGRpbmc6MTBweDsnPmA7CgkJfQoJCXJldHVybiByZXQgKyBgPGZvcm0gaWQ9ImZybSR7dGhpcy5uYW1lfSIgbWV0aG9kPSJwb3N0IiBub3ZhbGlkYXRlPmA7Cgl9CgoJcmVuZGVyRWxlbWVudHMoZWxlbWVudHMpIHsKCQllbGVtZW50cyA9IGVsZW1lbnRzIHx8IHRoaXMuZWxlbWVudHM7CgoJCXZhciB0V2lkdGggPSBNYXRoLmZsb29yKHRoaXMud2lkdGggKiAwLjk1KTsKCQl2YXIgdEhlaWdodCA9IE1hdGguZmxvb3IodGhpcy5oZWlnaHQgKiAwLjg1KTsKCgkJbGV0IHJldCA9ICcnOwoJCXZhciBnRWxlbWVudHMgPSB0aGlzLnNyKCkuZ3JvdXBCeShlbGVtZW50cywgImdyb3VwIik7CgkJaWYgKGdFbGVtZW50cy5sZW5ndGggPiAxKSByZXQgKz0gYDxkaXYgaWQ9InRiY1dpbmRvdyIgY2xhc3M9ImVhc3l1aS10YWJzIiBkYXRhLW9wdGlvbnM9JyR7dGhpcy5ldmVudEhhbmRsZXJzKHt0eXBlOiAndGFicyd9KX0nIHN0eWxlPSJ3aWR0aDoke3RXaWR0aH1weDtoZWlnaHQ6JHt0SGVpZ2h0fXB4OyI+YDsKCQlmb3IgKHZhciBnID0gMDsgZyA8IGdFbGVtZW50cy5sZW5ndGg7IGcrKykgewoJCQlpZiAoZ0VsZW1lbnRzLmxlbmd0aCA+IDEpIHJldCArPSAnPGRpdiB0aXRsZT0iJyArIChnRWxlbWVudHNbZ10ua2V5IHx8ICJNYWluIikgKyAnIiBzdHlsZT0icGFkZGluZzoyMHB4O2Rpc3BsYXk6bm9uZTsiPic7CgkJCXZhciBzRWxlbWVudHMgPSB0aGlzLnNyKCkuZ3JvdXBCeShnRWxlbWVudHNbZ10udmFsdWVzLCAic2VjdGlvbiIpOwoJCQlpZiAoc0VsZW1lbnRzLmxlbmd0aCA+IDEpIHJldCArPSAnPGRpdiBjbGFzcz0iZWFzeXVpLWFjY29yZGlvbiIgc3R5bGU9IndpZHRoOicgKyB0V2lkdGggKyAncHg7aGVpZ2h0OicgKyAvKnRIZWlnaHQqLyAiMTAwJSIgKyAncHg7Ij4nOwoJCQlmb3IgKHZhciBzID0gMDsgcyA8IHNFbGVtZW50cy5sZW5ndGg7IHMrKykgewoJCQkJcmV0ICs9IGA8ZGl2IHRpdGxlPSIke3NFbGVtZW50c1tzXS5rZXkgfHwgIiJ9IiBkYXRhLW9wdGlvbnM9Imljb25DbHM6J2ljb24tbW9yZSciIHN0eWxlPSJwYWRkaW5nOjEwcHg7Ij5gOwoJCQkJZm9yICh2YXIgaSA9IDA7IGkgPCBzRWxlbWVudHNbc10udmFsdWVzLmxlbmd0aDsgaSsrKSB7CgkJCQkJdmFyIGUgPSBzRWxlbWVudHNbc10udmFsdWVzW2ldOwoJCQkJCWlmIChlLmlnbm9yZSkgY29udGludWU7CgkJCQkJZS52YWx1ZSA9IGUudmFsdWUgfHwgX0ZyRU1ELmhhc2hbZS5uYW1lXSB8fCAoX0ZyRU1ELmFwaVNlcnZlciA/IF9GckVNRC5hcGlTZXJ2ZXIuX19jb25maWcoJ3Rlc3RfJyArIGUubmFtZSwgJycpIDogJycpOwoJCQkJCXJldCArPSBgPGRpdiBpZD0iZkVsZW1lbnRfJHtlLm5hbWV9IiBjbGFzcz0iZml0ZW0iIHN0eWxlPSJkaXNwbGF5OiAkeyhlLnR5cGU9PSd3aW5kb3cnIHx8IGUuaGlkZGVuKT8nbm9uZSc6Jyd9Ij5gOwoJCQkJCWlmIChlLnRvZ2dsZSkgewoJCQkJCQlyZXQgKz0gYDxhIGhyZWY9IiMiIGNsYXNzPSJlYXN5dWktbGlua2J1dHRvbiIgZGF0YS1vcHRpb25zPScke3RoaXMuZXZlbnRIYW5kbGVycyh7dHlwZTogJ3RvZ2dsZScsIGZvcjogZX0pfSxwbGFpbjp0cnVlLGljb25DbHM6Imljb24tJHtlLmljb24gfHwgJ3NlYXJjaCd9Iicgc3R5bGU9IndpZHRoOjEwMHB4O2hlaWdodDozMHB4Ij4ke2UudGl0bGUgfHwgdGhpcy5lbmdsaXNoKGUubmFtZSl9PC9hPmA7CgkJCQkJfSBlbHNlIHsKCQkJCQkJcmV0ICs9IGA8bGFiZWw+JHtlLnRpdGxlIHx8IHRoaXMuZW5nbGlzaChlLm5hbWUpfTo8L2xhYmVsPmA7CgkJCQkJfQoJCQkJCWlmIChlLnR5cGUgJiYgdGhpc1tlLnR5cGVdKSB7CgkJCQkJCXJldCArPSB0aGlzW2UudHlwZV0oZSk7CgkJCQkJfSBlbHNlIGlmIChlLnJlbmRlcikgewoJCQkJCQlyZXQgKz0gZS5yZW5kZXIoKTsKCQkJCQl9CgkJCQkJcmV0ICs9ICc8L2Rpdj4nOwoJCQkJfQoJCQkJcmV0ICs9ICc8L2Rpdj4nOwoJCQl9CgkJCWlmIChzRWxlbWVudHMubGVuZ3RoID4gMSkgcmV0ICs9ICc8L2Rpdj4nOwoJCQlpZiAoZ0VsZW1lbnRzLmxlbmd0aCA+IDEpIHJldCArPSAiPC9kaXY+IjsKCQl9CgkJaWYgKGdFbGVtZW50cy5sZW5ndGggPiAxKSByZXQgKz0gIjwvZGl2PiI7CgkJcmV0dXJuIHJldDsKCX0KCglpbmZvKG1zZykgewoJCWlmICgkLm1lc3NhZ2VyKSB7CgkJCSQubWVzc2FnZXIuYWxlcnQodGhpcy50aXRsZSwgbXNnLCAnaW5mbycpOwoJCX0gZWxzZSB7CgkJCXRoaXMuc3IoKS5TaG93TWVzc2FnZShtc2csIHRoaXMudGl0bGUpOwoJCX0KCX0KCgllcnJvcihtc2cpIHsKCQlpZiAoJC5tZXNzYWdlcikgewoJCQkkLm1lc3NhZ2VyLmFsZXJ0KHRoaXMudGl0bGUsIG1zZywgJ2Vycm9yJyk7CgkJfSBlbHNlIHsKCQkJdGhpcy5zcigpLlNob3dNZXNzYWdlKG1zZywgdGhpcy50aXRsZSk7CgkJfQoJfQoKCWJ5TmFtZShuYW1lKSB7CgkJcmV0dXJuIHRoaXMuZWxlbWVudHMuZmluZChlID0+IGUubmFtZSA9PT0gbmFtZSk7Cgl9CgoJLyoqIENvbXBvbmVudHM6OlN0YXJ0ICoqLwoJQ29yZUNvbXBvbmVudCA9IGNsYXNzIHsKCQljb25zdHJ1Y3RvcihwYWdlLCBkRm9ybSkgewoJCQl0aGlzLnBhZ2UgPSBwYWdlOwoJCQl0aGlzLmRGb3JtID0gZEZvcm07CgkJfQoKCQlidXN5KGJCdXN5KSB7CgkJCXJldHVybiB0aGlzLmRGb3JtLmJ1c3koYkJ1c3kpOwoJCX0KCgkJX21lKHYpIHsKCQkJbGV0IG1lTmFtZSA9ICh0eXBlb2YoY29tcGFueSkgIT09ICd1bmRlZmluZWQnKSA/IChjb21wYW55LmxvZ2dlZEluSWRlbnRpdHkgfHwgIm1lIikgOiAibWUiOwoJCQlpZiAodikgewoJCQkJd2luZG93W21lTmFtZV0gPSB2OwoJCQl9CgoJCQlyZXR1cm4gd2luZG93W21lTmFtZV07CgkJfQoKCQlfY2FuVmlldygpIHsKCQkJaWYgKCF0aGlzLl9tZSgpKSB7CgkJCQl3aW5kb3cuX0ZyRU1ELnNldFVSTCh7CgkJCQkJcGFnZTogJ2xvZ2luJywKCQkJCQlfcmVkaXJlY3Q6IHRoaXMucGFnZS5fY29kZSwKCQkJCX0pOwoJCQkJdGhyb3cgYF9jYW5WaWV3OiAke3RoaXMucGFnZS5fY29kZX0gbm90IGFsbG93ZWQgd2l0aG91dCBsb2dpbiFgOwoJCQl9CgkJfQoKCQlfbmFtZSgpIHsKCQkJaWYgKCF0aGlzLl9tZSgpKSByZXR1cm4gIiI7CgkJCXJldHVybiB0aGlzLl9tZSgpLm5hbWUgPyB0aGlzLl9tZSgpLm5hbWUoKSA6IHRoaXMuX21lKCkuVG9TdHJpbmc7CgkJfQoJfQoKCU1haW5Db21wb25lbnQgPSBjbGFzcyBleHRlbmRzIHRoaXMuQ29yZUNvbXBvbmVudCB7CgkJX2J1aWxkTWVudSgpIHsKCQkJcmV0dXJuIFt7CgkJCQlsYWJlbDogIk1haW4iLAoJCQkJb3JkZXI6IC0xLAoJCQkJc3ViTWVudXM6IFt7CgkJCQkJbGFiZWw6ICdJbmRleCcsCgkJCQl9LCB7CgkJCQkJbGFiZWw6ICJMb2dpbiIsCgkJCQl9LCB7CgkJCQkJbGFiZWw6ICJMb2dvdXQiCgkJCQl9XQoJCQl9LCB7CgkJCQlsYWJlbDogIlNldHVwIiwKCQkJCW9yZGVyOiA5OTk5OSwKCQkJCXN1Yk1lbnVzOiBfRnJFTUQuX21lbnVDbGFzc2VzKCkKCQkJfV07CgkJfQoJfQoKCUluZGV4Q29tcG9uZW50ID0gY2xhc3MgZXh0ZW5kcyB0aGlzLkNvcmVDb21wb25lbnQgewoJCWFzeW5jIG1haW4oKSB7CgkJCXRoaXMuX2NhblZpZXcoKTsKCgkJCXRoaXMucGFnZS5kYXRhID0gewoJCQkJZm9ybTogdGhpcy5kRm9ybS5yZW5kZXIoJ2ZybUluZGV4JywgIk1haW4gUGFnZSIsIFt7CgkJCQkJbmFtZTogJ1dlbGNvbWUnLAoJCQkJCXJlcXVpcmVkOiB0cnVlLAoJCQkJCXR5cGU6ICJsYWJlbCIsCgkJCQkJdmFsdWU6IHRoaXMuX25hbWUoKSwKCQkJCX1dLCBbXSkKCQkJfTsKCQl9Cgl9CgoJTG9naW5Db21wb25lbnQgPSBjbGFzcyBleHRlbmRzIHRoaXMuQ29yZUNvbXBvbmVudCB7CgkJYXN5bmMgX2F1dGhlbnRpY2F0ZShvKSB7CgkJCXJldHVybiBudWxsOwoJCX0KCgkJYXN5bmMgX2xvZ2dlZEluKCkge30KCgkJYXN5bmMgX25vdExvZ2dlZEluKCkge30KCgkJYXN5bmMgbWFpbigpIHsKCQkJdGhpcy5wYWdlLmRhdGEgPSB7CgkJCQlmb3JtOiB0aGlzLmRGb3JtLnJlbmRlcignZnJtTG9naW4nLCAiVXNlciBBdXRoZW50aWNhdGlvbiIsIFt7CgkJCQkJCW5hbWU6ICdVc2VybmFtZScsCgkJCQkJCXJlcXVpcmVkOiB0cnVlLAoJCQkJCQl0eXBlOiAic3RyaW5nIgoJCQkJCX0sCgkJCQkJewoJCQkJCQluYW1lOiAnUGFzc3dvcmQnLAoJCQkJCQlyZXF1aXJlZDogdHJ1ZSwKCQkJCQkJdHlwZTogInBhc3N3b3JkIgoJCQkJCX0KCQkJCV0sIFt7CgkJCQkJbmFtZTogJ0xvZ2luJywKCQkJCQlhdXRvU3VibWl0OiB0cnVlLAoJCQkJCW9uY2xpY2s6IGFzeW5jIG8gPT4gewoJCQkJCQlsZXQgcmV0ID0gYXdhaXQgdGhpcy5fYXV0aGVudGljYXRlKG8pOwoKCQkJCQkJaWYgKHJldCkgewoJCQkJCQkJdGhpcy5fbWUocmV0KTsKCgkJCQkJCQl0cnkgewoJCQkJCQkJCWF3YWl0IHRoaXMuX2xvZ2dlZEluKCk7CgkJCQkJCQl9IGNhdGNoIChleCkge30KCgkJCQkJCQlfRnJFTUQuc2V0VVJMKHsKCQkJCQkJCQlwYWdlOiBfRnJFTUQuaGFzaC5fcmVkaXJlY3QgfHwgImluZGV4IgoJCQkJCQkJfSk7CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQl0cnkgewoJCQkJCQkJCWF3YWl0IHRoaXMuX25vdExvZ2dlZEluKCk7CgkJCQkJCQl9IGNhdGNoIChleCkge30KCgkJCQkJCQl0aGlzLmRGb3JtLmVycm9yKCJJbnZhbGlkIHVzZXJuYW1lIG9yIHBhc3N3b3JkIik7CgkJCQkJCX0KCgkJCQkJCXRoaXMuZEZvcm0uYnVzeShmYWxzZSk7CgkJCQkJfQoJCQkJfV0pCgkJCX07CgkJfQoJfQoKCVN0b3JlQ29tcG9uZW50ID0gY2xhc3MgZXh0ZW5kcyB0aGlzLkNvcmVDb21wb25lbnQgewoJCWFzeW5jIG1haW4oKSB7CgkJCXRoaXMuX2NhblZpZXcoKTsKCgkJCXRoaXMuc1RhYmxlID0gdGhpcy5wYWdlLmRhdGE7CgkJCWNvbnNvbGUuY2xlYXIoKTsKCgkJCWxldCBlYyA9IF9GckVNRC5fX3Njb3BlKCkuRW50aXR5Q2xhc3Nlcy5maW5kKGMgPT4gYy5OYW1lLnJlcGxhY2UoL1wgL2csICdfJykgPT0gdGhpcy5wYWdlLmRhdGEpOwoKCQkJdGhpcy5wYWdlLmRhdGEgPSB7CgkJCQlmb3JtOiB0aGlzLmRGb3JtLnJlbmRlcih0aGlzLnBhZ2UuZGF0YSwgX0ZyRU1ELl90aXRsZUNhc2UodGhpcy5wYWdlLmRhdGEpLCBbewoJCQkJCW5hbWU6IHRoaXMucGFnZS5kYXRhLAoJCQkJCXRpdGxlOiBlYy5OYW1lLAoJCQkJCUNsYXNzOiB7CgkJCQkJCU5hbWU6IGVjLk5hbWUsCgkJCQkJCUlkOiBlYy5JZAoJCQkJCX0sCgkJCQkJem9uZTogJ25vcnRoJywKCQkJCQl0eXBlOiBlYy5FbnRpdHlBdHRyaWJ1dGVzLmZpbmQocGVhID0+ICFwZWEuRW50aXR5TWV0aG9kICYmIHBlYS5FbnRpdHlUeXBlID09IGVjKSA/ICd0cmVlJyA6ICdzZWxlY3QnLAoJCQkJCXBhcmVudEZpZWxkOiBlYy5FbnRpdHlBdHRyaWJ1dGVzLmZpbmQocGVhID0+ICFwZWEuRW50aXR5TWV0aG9kICYmIHBlYS5FbnRpdHlUeXBlID09IGVjKT8uTmFtZSwKCQkJCQkvL3NlYXJjaEZpZWxkOiBlYy5FbnRpdHlBdHRyaWJ1dGVzLmZpbmQoZWEgPT4gZWEuSXNTdHJpbmcpLk5hbWUsCgkJCQkJLy9pZEZpZWxkOiAnX1RvU3RyaW5nJywKCQkJCQlzb3VyY2U6IChvLCBmRGF0YSwgc1RleHQpID0+ICh7CgkJCQkJCU9QRVJBVE9SUzogewoJCQkJCQkJW2VjLkVudGl0eUF0dHJpYnV0ZXMuZmluZChlYSA9PiBlYS5Jc1N0cmluZykuTmFtZV06ICdsaWtlJwoJCQkJCQl9LAoJCQkJCQlbZWMuRW50aXR5QXR0cmlidXRlcy5maW5kKGVhID0+IGVhLklzU3RyaW5nKS5OYW1lXTogc1RleHQKCgkJCQkJfSksCgkJCQkJc2VsZWN0OiBhc3luYyBvID0+IHsKCQkJCQkJdGhpcy5kRm9ybS5jbGVhcigpOwoJCQkJCQl0aGlzLmRGb3JtLmJ1c3kodHJ1ZSk7CgoJCQkJCQlsZXQgciA9IGF3YWl0IG8uZmluZCgpOwoJCQkJCQl0aGlzLmRGb3JtLnNldChPYmplY3QuYXNzaWduKHsKCQkJCQkJCVt0aGlzLnNUYWJsZV06IHIKCQkJCQkJfSwgLi4uZWMuRW50aXR5QXR0cmlidXRlcy5maWx0ZXIoZWEgPT4gIWVhLkVudGl0eU1ldGhvZCkuZmlsdGVyKGVhID0+IHR5cGVvZihyW2VhLk5hbWVdKCkpICE9PSAndW5kZWZpbmVkJykubWFwKGVhID0+ICh7CgkJCQkJCQlbZWEuTmFtZV06IHJbZWEuTmFtZV0oKQoJCQkJCQl9KSkpKTsKCQkJCQkJdGhpcy5kRm9ybS5idXN5KGZhbHNlKTsKCQkJCQl9CgkJCQl9XS5jb25jYXQoLi4uZWMuRW50aXR5QXR0cmlidXRlcy5maWx0ZXIoZWEgPT4gIWVhLkVudGl0eU1ldGhvZCAmJiAhZWEuSXNUZXh0KS5tYXAoZWEgPT4gZWEuRW50aXR5VHlwZSA/ICh7CgkJCQkJZ3JvdXA6IGVhLkdyb3VwLk5hbWUsCgkJCQkJbmFtZTogZWEuTmFtZSwKCQkJCQlfdHlwZTogZWEuRW50aXR5VHlwZS5FbnRpdHlBdHRyaWJ1dGVzLmZpbmQocGVhID0+ICFwZWEuRW50aXR5TWV0aG9kICYmIHBlYS5FbnRpdHlUeXBlID09IGVhLkVudGl0eVR5cGUpID8gJ3RyZWUnIDogJ3NlbGVjdCcsCgkJCQkJdHlwZTogJ3NlbGVjdCcsCgkJCQkJcGFyZW50RmllbGQ6IGVhLkVudGl0eVR5cGUuRW50aXR5QXR0cmlidXRlcy5maW5kKHBlYSA9PiAhcGVhLkVudGl0eU1ldGhvZCAmJiBwZWEuRW50aXR5VHlwZSA9PSBlYS5FbnRpdHlUeXBlKT8uTmFtZSwKCQkJCQkvL2lkRmllbGQ6ICdfVG9TdHJpbmcnLAoJCQkJCXpvbmU6ICdjZW50ZXInLAoJCQkJCUNsYXNzOiB7CgkJCQkJCU5hbWU6IGVhLkVudGl0eVR5cGUuTmFtZSwKCQkJCQkJSWQ6IGVhLkVudGl0eVR5cGUuSWQKCQkJCQl9LAoJCQkJCXNvdXJjZTogKG8sIGZEYXRhLCBzVGV4dCkgPT4gKHsKCQkJCQkJT1BFUkFUT1JTOiB7CgkJCQkJCQlbZWEuRW50aXR5VHlwZS5FbnRpdHlBdHRyaWJ1dGVzLmZpbmQoZWEgPT4gZWEuSXNTdHJpbmcpLk5hbWVdOiAnbGlrZScKCQkJCQkJfSwKCQkJCQkJW2VhLkVudGl0eVR5cGUuRW50aXR5QXR0cmlidXRlcy5maW5kKGVhID0+IGVhLklzU3RyaW5nKS5OYW1lXTogc1RleHQKCgkJCQkJfSksCgkJCQl9KSA6ICh7CgkJCQkJZ3JvdXA6IGVhLkdyb3VwLk5hbWUsCgkJCQkJbmFtZTogZWEuTmFtZSwKCQkJCQl6b25lOiAnY2VudGVyJywKCQkJCQl0eXBlOiBPYmplY3QuZW50cmllcyh7CgkJCQkJCUJvb2w6ICdib29sJywKCQkJCQkJRGF0ZTogJ2RhdGV0aW1lJywKCQkJCQkJSW50OiAnaW50JywKCQkJCQkJTG9uZzogJ2xvbmcnLAoJCQkJCQlJbWFnZTogJ2ltYWdlJywKCQkJCQkJU3RyaW5nOiAnc3RyaW5nJwoJCQkJCX0pLmZpbmQoZSA9PiBlYVsnSXMnICsgZVswXV0pWzFdLAoJCQkJfSkpKS5jb25jYXQoLi4uZWMuRW50aXR5QXR0cmlidXRlcy5maWx0ZXIoZWEgPT4gIWVhLkVudGl0eU1ldGhvZCAmJiBlYS5Jc1RleHQpLm1hcChlYSA9PiAoewoJCQkJCWdyb3VwOiBlYS5Hcm91cC5OYW1lLAoJCQkJCW5hbWU6IGVhLk5hbWUsCgkJCQkJdHlwZTogJ3dpbmRvdycsCgkJCQkJem9uZTogJ2NlbnRlcicsCgkJCQkJZWRpdG9yOiB0cnVlLAoJCQkJCWxhbmd1YWdlOiBvID0+IGVhLk5hbWUgPT0gJ3NjcmlwdCcgPyAnamF2YXNjcmlwdCcgOiAidGV4dCIsCgkJCQl9KSkpLCBbewoJCQkJCW5hbWU6ICdSZXNldCcsCgkJCQkJb25jbGljazogbyA9PiB7CgkJCQkJCXRoaXMuZEZvcm0uY2xlYXIoKTsKCQkJCQl9LAoJCQkJCWljb246ICJjYW5jZWwiCgkJCQl9LCB7CgkJCQkJbmFtZTogJ1JlbG9hZCcsCgkJCQkJb25jbGljazogbyA9PiBfRnJFTUQuUmVuZGVyUGFnZSh7CgkJCQkJCV9jb2RlOiAnc3RvcmUnCgkJCQkJfSwgdGhpcy5zVGFibGUpLAoJCQkJCWljb246ICJyZWxvYWQiCgkJCQl9LCB7CgkJCQkJbmFtZTogJ1NhdmUnLAoJCQkJCW9uY2xpY2s6IGFzeW5jIG8gPT4gewoJCQkJCQlsZXQgb2JqID0gX0ZyRU1ELmFwaVNlcnZlci5fbmV3KHRoaXMuc1RhYmxlKTsKCQkJCQkJLy9jb25zb2xlLmxvZygib25jbGljaygpIiwgdGhpcy5zVGFibGUsIG9iaiwgbywgb1t0aGlzLnNUYWJsZV0pOwoJCQkJCQlpZiAob1t0aGlzLnNUYWJsZV0gJiYgdHlwZW9mKG9bdGhpcy5zVGFibGVdLl9fc3luY19vbikgPT09ICdmdW5jdGlvbicgJiYgb1t0aGlzLnNUYWJsZV0uX19zeW5jX29uKCkpIG9iai5JZCA9IG9bdGhpcy5zVGFibGVdLklkOwoKCQkJCQkJZWMuRW50aXR5QXR0cmlidXRlcy5maWx0ZXIoZWEgPT4gIWVhLkVudGl0eU1ldGhvZCkuZm9yRWFjaChlYSA9PiBvYmpbZWEuTmFtZV0ob1tlYS5OYW1lXSkpOwoJCQkJCQkvL3JldHVybiBjb25zb2xlLmxvZyhvYmouX3RvRmlsZU5hbWUoKSwgb2JqKTsKCQkJCQkJYXdhaXQgb2JqLnN0b3JlKCk7CgkJCQkJfQoJCQkJfV0pCgkJCX07CgkJfQoJfQoJLyoqIENvbXBvbmVudHM6OkVuZCAqKi8KfTs=",
	"storedMethod": null,
	"__keys": ["name"],
	"active": true,
	"enabled": true,
	"__trMap": []
}