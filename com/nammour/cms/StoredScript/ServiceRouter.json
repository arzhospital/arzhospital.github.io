{
	"Id": "cc570617b71b1659a83466903bc757e6f1c8f7cf",
	"name": "ServiceRouter",
	"script": "d2luZG93LlNlcnZpY2VSb3V0ZXIgPSBmdW5jdGlvbiBTZXJ2aWNlUm91dGVyKCkgew0KCXZhciBzclVSTDsNCg0KCXZhciBTdG9yZTsNCg0KCXZhciBDUk5MOw0KCXZhciBiUG9zdDsNCgl2YXIgYkRlYnVnOw0KCXZhciBiQ2FjaGU7DQoJdmFyIGJMb2NhbDsNCgl2YXIgYkFzeW5jOw0KCXZhciBiQ2FjaGVSZXN1bHQ7DQoJdmFyIGJTaG93RXJyb3JzOw0KCXZhciBuTWF4VVJMTGVuZ3RoOw0KCXZhciBwcmVQcm9jZXNzSFRNTDsNCgl2YXIgc3lzdGVtTmFtZTsNCgl2YXIgZkxvYWRpbmdTdGFydDsNCgl2YXIgZkxvYWRpbmdFbmQ7DQoNCgl2YXIgdGltZURpZmZlcmVuY2UgPSAwOyAvLyB0aGlzIGlzIHRoZSB0aW1lIGRpZmZlcmVuY2UgYmV0d2VlbiBjbGllbnQgYW5kIHNlcnZlciwgdXBkYXRlZCB3aXRoIGV2ZXJ5IGNhbGwgKGluIHRpY2tzKQ0KDQoJdmFyIHNfRXJyb3JNZXNzYWdlczsNCg0KCXRoaXMuX19zY29wZSA9IGZ1bmN0aW9uKHNjb3BlKSB7DQoJCWxldCByZXQgPSBudWxsOw0KCQlpZiAodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnKSB7DQoJCQlyZXQgPSB3aW5kb3c7DQoJCX0gZWxzZSBpZiAodHlwZW9mKFdvcmtlckdsb2JhbFNjb3BlKSAhPT0gJ3VuZGVmaW5lZCcpIHsNCgkJCXJldCA9IHNlbGY7DQoJCX0gZWxzZSBpZiAodHlwZW9mKGdsb2JhbCkgIT09ICd1bmRlZmluZWQnKSB7DQoJCQlyZXQgPSBnbG9iYWw7DQoJCX0NCg0KCQlpZiAoc2NvcGUpIHJldCA9IHJldFtzY29wZV07DQoJCXJldHVybiByZXQ7DQoJfTsNCg0KCXRoaXMuYnVpbGRVUkwgPSBmdW5jdGlvbihzclVSTCkgew0KCQlpZiAoIXNyVVJMKSB7DQoJCQl0aGlzLnNyVVJMID0gdGhpcy4kX1JFUVVFU1QoJ3NyJyk7DQoJCQlpZiAoIXRoaXMuc3JVUkwpIHsNCgkJCQlpZiAodHlwZW9mKHdpbmRvdykgPT09ICJ1bmRlZmluZWQiKSB7DQoJCQkJCWxldCBpcCA9IHRoaXMuaXBBZGRyZXNzKCk7DQoJCQkJCWlmIChpcCAmJiAoaXAuc3RhcnRzV2l0aCgiMTgyLjE2OC4iKSB8fCBpcCA9PSAiMTkyLjE2OC4xLjI1MyIgfHwgaXAgPT0gJzE5NS4xMTIuMjE1LjIxOCcpKSB7DQoJCQkJCQl0aGlzLnNyVVJMID0gImh0dHA6Ly8xODIuMTY4LjcwLjgwIjsNCgkJCQkJfSBlbHNlIHsNCgkJCQkJCXRoaXMuc3JVUkwgPSAiaHR0cDovL2Fyei5uYW1tb3VyLmNvbTo3MDgwIjsNCgkJCQkJfQ0KCQkJCX0NCgkJCQl0aGlzLnNyVVJMICs9ICcvbWV0aG9kL1NlcnZpY2VSb3V0ZXIuYXNoeCc7DQoJCQl9DQoJCX0gZWxzZSB7DQoJCQl0aGlzLnNyVVJMID0gc3JVUkw7DQoJCX0NCgkJdGhpcy5zclVSTCArPSAnP3NydmVyc2lvbj0xJzsNCgkJaWYgKHRoaXMuJF9SRVFVRVNUKCdnemlwJykpIHsNCgkJCXRoaXMuc3JVUkwgKz0gJyZnemlwPScgKyB0aGlzLiRfUkVRVUVTVCgnZ3ppcCcpOw0KCQl9IGVsc2Ugew0KCQkJdGhpcy5zclVSTCArPSAnJmd6aXA9dHJ1ZSc7DQoJCX0NCgkJaWYgKHRoaXMuYkNhY2hlKSB7DQoJCQl0aGlzLnNyVVJMICs9ICcmY2FjaGU9JyArIHRoaXMuYkNhY2hlOw0KCQl9DQoJCWlmICghdGhpcy4kX1JFUVVFU1QoJ3JhbmQnLCB0aGlzLnNyVVJMKSkgew0KCQkJdGhpcy5zclVSTCArPSAnJnJhbmQ9JyArIE1hdGgucmFuZG9tKCk7DQoJCX0NCg0KCQlpZiAodGhpcy5iRGVidWcpIHsNCgkJCXRoaXMuc3JVUkwgKz0gJyZERUJVRz10cnVlJzsNCgkJfQ0KDQoJCWlmICgNCgkJCXRoaXMuYkFzeW5jICYmDQoJCQl0aGlzLmJMb2NhbCAmJg0KCQkJIXRoaXMuJF9SRVFVRVNUKCdhc3luYycsIHRoaXMuc3JVUkwpDQoJCSkgew0KCQkJdGhpcy5zclVSTCArPSAnJmFzeW5jPXRydWUnOw0KCQkJaWYgKHRoaXMucnVuQWZ0ZXIpIHsNCgkJCQl0aGlzLnNyVVJMICs9ICcmcnVuYWZ0ZXI9JyArIHRoaXMucnVuQWZ0ZXI7DQoJCQl9DQoJCQl0aGlzLmJBc3luYyA9IGZhbHNlOw0KCQl9DQoNCgkJLy90aGlzLlNob3dEZWJ1ZygndGhpcy5zclVSTD0nICsgdGhpcy5zclVSTCk7DQoNCgkJcmV0dXJuIHRoaXMuc3JVUkw7DQoJfTsNCg0KCXRoaXMuaW5pdCA9IGZ1bmN0aW9uKA0KCQlzclVSTCwNCgkJc3lzdGVtTmFtZSwNCgkJYlBvc3QsDQoJCWJEZWJ1ZywNCgkJYlNob3dFcnJvcnMsDQoJCXByZVByb2Nlc3NIVE1MDQoJKSB7DQoJCWlmICh0eXBlb2YgZG9jdW1lbnQgPT09ICd1bmRlZmluZWQnKSB7DQoJCQlkb2N1bWVudCA9IHt9Ow0KCQkJd2luZG93ID0ge307DQoJCX0NCgkJaWYgKCFiRGVidWcgJiYgZG9jdW1lbnQuVVJMICYmIGRvY3VtZW50LlVSTC5pbmRleE9mKCdkZWJ1Zz10cnVlJykgPiAwKQ0KCQkJYkRlYnVnID0gdHJ1ZTsNCg0KCQl0aGlzLmJMb2NhbCA9ICF0aGlzLlN0b3JlICYmDQoJCQlkb2N1bWVudC5VUkwgJiYNCgkJCSEoZG9jdW1lbnQuVVJMLmluZGV4T2YoJ2xvY2FsPWZhbHNlJykgPj0gMCk7DQoJCWlmICghZG9jdW1lbnQuVVJMKSB0aGlzLmJMb2NhbCA9IHRydWU7DQoNCgkJdGhpcy5iQ2FjaGUgPSB0aGlzLiRfUkVRVUVTVCgnY2FjaGUnKTsNCgkJdGhpcy5iQ2FjaGVSZXN1bHQgPSB0aGlzLiRfUkVRVUVTVCgnY2FjaGVSZXN1bHQnKTsNCg0KCQl0aGlzLnNyVVJMID0gdGhpcy5idWlsZFVSTChzclVSTCk7DQoNCgkJdGhpcy5DUk5MID0gJ1xuJzsNCgkJdGhpcy5uTWF4VVJMTGVuZ3RoID0gMTAwOw0KDQoJCXRoaXMuc3lzdGVtTmFtZSA9IHN5c3RlbU5hbWU7DQoNCgkJdGhpcy5iUG9zdCA9IGJQb3N0Ow0KCQl0aGlzLmJEZWJ1ZyA9IGJEZWJ1ZzsNCgkJdGhpcy5iU2hvd0Vycm9ycyA9IGJTaG93RXJyb3JzOw0KDQoJCXRoaXMuc19FcnJvck1lc3NhZ2VzID0gJyc7DQoNCgkJcmV0dXJuIHRoaXM7DQoJfTsNCg0KCXRoaXMucHJlUHJvY2Vzc0hUTUwgPSBmdW5jdGlvbihodG1sKSB7DQoJCWlmICghaHRtbCkgcmV0dXJuIGh0bWw7DQoNCgkJdHJ5IHsNCgkJCXZhciByZXQgPSAnJzsNCgkJCXZhciBwYXJ0cyA9IGh0bWwuc3BsaXQoJyQkJyk7DQoJCQlmb3IgKHZhciBpID0gMDsgaSA8IHBhcnRzLmxlbmd0aDsgaSsrKSB7DQoJCQkJaWYgKGkgJSAyID09IDApIHsNCgkJCQkJcmV0ICs9IHBhcnRzW2ldOw0KCQkJCQljb250aW51ZTsNCgkJCQl9DQoJCQkJdHJ5IHsNCgkJCQkJdmFyIG9WYWx1ZSA9IHRoaXMucnVuU2NyaXB0KHBhcnRzW2ldKTsNCgkJCQkJaWYgKG9WYWx1ZSkgew0KCQkJCQkJcmV0ICs9IG9WYWx1ZTsNCgkJCQkJfSBlbHNlIHsNCgkJCQkJCXJldCArPSAnJzsNCgkJCQkJfQ0KCQkJCX0gY2F0Y2ggKGUpIHsNCgkJCQkJcmV0ICs9ICcnOw0KCQkJCX0NCgkJCX0NCg0KCQkJaWYgKHByZVByb2Nlc3NIVE1MICE9IG51bGwpIHJldCA9IHByZVByb2Nlc3NIVE1MKHJldCk7DQoJCQlyZXR1cm4gcmV0Ow0KCQl9IGNhdGNoIChlKSB7DQoJCQlyZXR1cm4gJyc7DQoJCX0NCgl9Ow0KDQoJdGhpcy4kX1JFUVVFU1QgPSBmdW5jdGlvbihrZXksIHVybCkgew0KCQlpZiAodHlwZW9mKHdpbmRvdykgPT09ICJ1bmRlZmluZWQiKSByZXR1cm4gbnVsbDsNCg0KCQlsZXQgcmV0ID0gdW5kZWZpbmVkOw0KCQlpZiAodXJsKSB7DQoJCQl0cnkgew0KCQkJCXJldCA9IG5ldyBVUkwodXJsKS5zZWFyY2hQYXJhbXMuZ2V0KGtleSk7DQoJCQl9IGNhdGNoIChleCkgew0KCQkJCXZhciByZWdleCA9IG5ldyBSZWdFeHAoJ1tcXD98Jl0nICsga2V5ICsgJz0oW14mI10qKScpOw0KCQkJCXZhciByZXN1bHRzID0gcmVnZXguZXhlYygnPycgKyB1cmwuc3BsaXQoJz8nKVsxXSk7DQoJCQkJcmV0ID0gKHJlc3VsdHMgPT09IG51bGwpID8gJycgOiBkZWNvZGVVUklDb21wb25lbnQocmVzdWx0c1sxXS5yZXBsYWNlKC9cKy9nLCAnICcpKTsNCgkJCX0NCgkJfSBlbHNlIHsNCgkJCXJldCA9IG5ldyBVUkxTZWFyY2hQYXJhbXMod2luZG93LmxvY2F0aW9uLnNlYXJjaCkuZ2V0KGtleSk7DQoJCX0NCg0KCQlyZXR1cm4gcmV0ID09PSBudWxsID8gJycgOiByZXQ7DQoJfTsNCg0KCXRoaXMuZ3JvdXBCeSA9IGZ1bmN0aW9uKGFyLCBmaWVsZCkgew0KCQlpZiAoIWFyIHx8ICFmaWVsZCkgcmV0dXJuIG51bGw7DQoNCgkJdmFyIGtleXMgPSBbXTsNCgkJYXIuZm9yRWFjaChhID0+IHsNCgkJCXZhciBrZXkgPSBudWxsOw0KCQkJZmllbGQuc3BsaXQoJy4nKS5mb3JFYWNoKGYgPT4ga2V5ID0gKGtleSB8fCBhKVtmXSk7DQoJCQlsZXQgayA9IGtleXMuZmluZChrID0+IHRoaXMuRXF1YWxzKGsua2V5LCBrZXkpKTsNCgkJCWlmIChrKSB7DQoJCQkJay52YWx1ZXMucHVzaChhKTsNCgkJCX0gZWxzZSB7DQoJCQkJa2V5cy5wdXNoKHsNCgkJCQkJa2V5OiBrZXksDQoJCQkJCXZhbHVlczogW2FdLA0KCQkJCX0pOw0KCQkJfQ0KCQl9KTsNCgkJcmV0dXJuIGtleXM7DQoJfTsNCg0KCXRoaXMuY29tcGlsZSA9IGZ1bmN0aW9uKGFyTW9kdWxlcykgew0KCQl2YXIgY2FsbHMgPSBbXTsNCgkJJC5lYWNoKGFyTW9kdWxlcywgKGksIG0pID0+DQoJCQljYWxscy5wdXNoKA0KCQkJCXRoaXMuXygnQ29udGVudE1hbmFnZXIuY21zSFRNTFBhZ2VGaW5kYWxsJywgbnVsbCwgew0KCQkJCQlQYWdlOiBtLA0KCQkJCX0pDQoJCQkpDQoJCSk7DQoJCXJldHVybiAkLndoZW4oLi4uY2FsbHMpLnRoZW4oKC4uLmFyUmV0KSA9PiB7DQoJCQl2YXIgX3JldCA9IFtdOw0KCQkJJC5tYXAoYXJSZXQsIChwKSA9PiB7DQoJCQkJcmV0LnB1c2goXy50ZW1wbGF0ZShwLkhUTUwpKHNyLnJ1blNjcmlwdChwWzBdLlNjcmlwdCkpKTsNCgkJCX0pOw0KCQkJcmV0dXJuIF9yZXQ7DQoJCX0pOw0KCX07DQoNCgl0aGlzLmltcG9ydCA9IGFzeW5jIGZ1bmN0aW9uKGFyTW9kdWxlcykgew0KCQl2YXIgcmV0ID0gW107DQoJCWZvciAodmFyIGkgPSAwOyBpIDwgYXJNb2R1bGVzLmxlbmd0aDsgaSsrKSB7DQoJCQlsZXQgcCA9IGF3YWl0IHRoaXMuXygnQ29udGVudE1hbmFnZXIuY21zSFRNTFBhZ2VGaW5kJywgbnVsbCwgew0KCQkJCVBhZ2U6IGFyTW9kdWxlc1tpXSwNCgkJCX0pOw0KCQkJcmV0LnB1c2gocCk7DQoJCQlhd2FpdCB0aGlzLnJ1blNjcmlwdChwLlNjcmlwdCk7DQoJCX0NCgkJcmV0dXJuIHJldDsNCgl9Ow0KDQoJdGhpcy5nZXRPYmplY3QgPSBmdW5jdGlvbihzKSB7DQoJCXZhciBjb2RlID0gcyArICc7JzsNCgkJY29kZSA9ICcodHlwZW9mICcgKyBzICsgIiA9PT0gJ3VuZGVmaW5lZCcpP3NyLm5ld09iamVjdCgpOiIgKyBzOw0KCQkvL3JldHVybiB0aGlzLnJ1blNjcmlwdChzKyI7Iik7DQoJCXJldHVybiB0aGlzLnJ1blNjcmlwdChjb2RlKTsNCgl9Ow0KDQoJdGhpcy5ydW5TY3JpcHQgPSBmdW5jdGlvbihzKSB7DQoJCWlmICghcykgcmV0dXJuIG51bGw7DQoNCgkJbGV0IGNMaW5lcyA9IHMuc3BsaXQoJ1xuJyk7DQoJCXRyeSB7DQoJCQlpZiAodHlwZW9mKGVzcHJpbWEpICE9PSAndW5kZWZpbmVkJykgew0KCQkJCWVzcHJpbWEucGFyc2Uocywgew0KCQkJCQllczY6IHRydWUNCgkJCQl9KTsNCgkJCX0NCgkJfSBjYXRjaCAoZXgpIHsNCgkJCWlmIChjTGluZXNbZXgubGluZU51bWJlciAtIDFdLmluZGV4T2YoJ2ZvciBhd2FpdCcpIDwgMCkgew0KCQkJCWNvbnNvbGUubG9nKCJydW5TY3JpcHQoKSAiICsgZXguZGVzY3JpcHRpb24sIGV4LmxpbmVOdW1iZXIsIGNMaW5lc1tleC5saW5lTnVtYmVyIC0gMV0pOw0KCQkJCXJldHVybjsNCgkJCX0NCgkJfQ0KDQoJCWlmICh0eXBlb2Yod2luZG93KSAhPT0gInVuZGVmaW5lZCIpIHsNCgkJCXRyeSB7DQoJCQkJaWYgKHdpbmRvdy5fY29udGVudCAmJiB3aW5kb3cuX2NvbnRlbnQuZXZhbCkgew0KCQkJCQl2YXIgb3V0cHV0ID0gd2luZG93Ll9jb250ZW50LmV2YWwocyk7DQoJCQkJCXJldHVybiBvdXRwdXQ7DQoJCQkJfQ0KCQkJfSBjYXRjaCAoZSkgew0KCQkJCXRoaXMuU2hvd0Vycm9yKCdGRiBTQ1JJUFQ6IFxuJyArIGUubWVzc2FnZSArICdcbicgKyBzKTsNCgkJCX0NCgkJCXRyeSB7DQoJCQkJaWYgKHdpbmRvdy5leGVjU2NyaXB0KSB7DQoJCQkJCWlmIChzLmluZGV4T2YoJ1xyXG4nKSA+IDApIHsNCgkJCQkJCS8vIGEgbXVsdGktbGluZSBzdGF0ZW1lbnQNCgkJCQkJCXdpbmRvdy5leGVjU2NyaXB0KHMpOw0KCQkJCQkJcmV0dXJuIG51bGw7DQoJCQkJCX0gZWxzZSB7DQoJCQkJCQkvLyBhIHNpbmdsZS1saW5lIHN0YXRlbWVudA0KCQkJCQkJbmV3ViA9IG51bGw7DQoJCQkJCQl2YXIgbmV3UyA9ICduZXdWID0gJyArIHM7DQoJCQkJCQl3aW5kb3cuZXhlY1NjcmlwdChuZXdTKTsNCgkJCQkJCXJldHVybiBuZXdWOw0KCQkJCQl9DQoJCQkJfQ0KCQkJfSBjYXRjaCAoZSkgew0KCQkJCXRoaXMuU2hvd0Vycm9yKCdJRTYgU0NSSVBUOiBcbicgKyBlLm1lc3NhZ2UgKyAnXG4nICsgcyk7DQoJCQl9DQoNCgkJCXRyeSB7DQoJCQkJaWYgKHdpbmRvdy5leGVjU2NyaXB0KSB7DQoJCQkJCWlmIChzLmluZGV4T2YoJ1xyXG4nKSA+IDApIHsNCgkJCQkJCS8vIGEgbXVsdGktbGluZSBzdGF0ZW1lbnQNCgkJCQkJCXdpbmRvdy5leGVjU2NyaXB0KHMpOw0KCQkJCQkJcmV0dXJuIG51bGw7DQoJCQkJCX0gZWxzZSB7DQoJCQkJCQkvLyBhIHNpbmdsZS1saW5lIHN0YXRlbWVudA0KCQkJCQkJbmV3ViA9IG51bGw7DQoJCQkJCQl2YXIgbmV3UyA9ICduZXdWID0gJyArIHM7DQoJCQkJCQlldmFsKG5ld1MpOw0KCQkJCQkJcmV0dXJuIG5ld1Y7DQoJCQkJCX0NCgkJCQl9DQoJCQl9IGNhdGNoIChlKSB7DQoJCQkJdGhpcy5TaG93RXJyb3IoJ0lFNyBTQ1JJUFQ6IFxuJyArIGUubWVzc2FnZSArICdcbicgKyBzKTsNCgkJCX0NCg0KCQkJdHJ5IHsNCgkJCQl2YXIgZm4gPSBmdW5jdGlvbigpIHsNCgkJCQkJdmFyIHJldCA9IHdpbmRvdy5ldmFsLmNhbGwod2luZG93LCBzKTsNCgkJCQkJcmV0dXJuIHJldDsNCgkJCQl9Ow0KDQoJCQkJcmV0dXJuIGZuKCk7DQoJCQl9IGNhdGNoIChlKSB7DQoJCQkJdGhpcy5TaG93RXJyb3IoJ1RBRyBTQ1JJUFQ6IFxuJyArIGUubWVzc2FnZSArICdcbicgKyBzKTsNCgkJCX0NCgkJfQ0KDQoJCXRyeSB7DQoJCQlzID0gcy5yZXBsYWNlKC9uZXcgRGF0ZVwoMDAwMS9nLCAnbmV3IERhdGUoMScpOw0KCQkJcmV0dXJuIGV2YWwocyk7DQoJCX0gY2F0Y2ggKGUpIHsNCgkJCXRoaXMuU2hvd0Vycm9yKCdFVkFMIFNDUklQVDogXG4nICsgZS5tZXNzYWdlICsgJ1xuJyArIHMpOw0KCQl9DQoJfTsNCg0KCXRoaXMuU2hvd09iamVjdCA9IGZ1bmN0aW9uKG8sIGJJZ25vcmVEZWJ1Zykgew0KCQl2YXIgcmV0ID0gJ09iamVjdCBTdHJ1Y3R1cmU6XG4nOw0KCQlmb3IgKHMgaW4gbykgew0KCQkJdHJ5IHsNCgkJCQlyZXQgKz0gcyArICc6ICcgKyBvW3NdICsgJ1xuJzsNCgkJCX0gY2F0Y2ggKGUpIHsNCgkJCQlyZXQgKz0gcyArICc6IEV4Y2VwdGlvbiB3aXRoIHZhbHVlID0gJyArIGUubWVzc2FnZSArICdcbic7DQoJCQl9DQoJCX0NCg0KCQl0aGlzLlNob3dEZWJ1ZyhyZXQsIGJJZ25vcmVEZWJ1Zyk7DQoJfTsNCg0KCXRoaXMuU2hvd0Vycm9yID0gZnVuY3Rpb24ocykgew0KCQljb25zb2xlLmxvZyhzKTsNCgkJaWYgKHRoaXMuYlNob3dFcnJvcnMpIHRoaXMuU2hvd01lc3NhZ2Uocyk7DQoJfTsNCg0KCXRoaXMuY2NvcHkgPSBmdW5jdGlvbihzKSB7DQoJCWlmICh3aW5kb3cuY2xpcGJvYXJkRGF0YSkgY2xpcGJvYXJkRGF0YS5zZXREYXRhKCdUZXh0Jywgcyk7DQoJfTsNCg0KCXRoaXMuU2hvd01lc3NhZ2UgPSBmdW5jdGlvbihzKSB7DQoJCWlmICh0eXBlb2Ygbm90eSAhPT0gJ3VuZGVmaW5lZCcpIHsNCgkJCW5vdHkoew0KCQkJCXRleHQ6IHMsDQoJCQkJdHlwZTogJ3N1Y2Nlc3MnLA0KCQkJCXRpbWVvdXQ6IDIwMDAsDQoJCQl9KTsNCgkJfSBlbHNlIHsNCgkJCS8vIHRoZSBkZWZhdWx0DQoJCQl0cnkgew0KCQkJCSQoIjxkaXYgdGl0bGU9J0luZm9ybWF0aW9uJz48cD4iICsgcyArICc8L3A+PC9kaXY+JykuZGlhbG9nKCk7DQoJCQl9IGNhdGNoIChlKSB7DQoJCQkJY29uc29sZS5sb2cocyk7DQoJCQl9DQoJCX0NCgl9Ow0KDQoJdGhpcy5TaG93RGVidWcgPSBmdW5jdGlvbihzLCBiSWdub3JlRGVidWcpIHsNCgkJaWYgKHR5cGVvZih3aW5kb3cpID09PSAidW5kZWZpbmVkIikgew0KCQkJY29uc29sZS5sb2coIlNob3dEZWJ1ZzogIiArIHMpOw0KCQl9DQoJCWlmICh0aGlzLmJEZWJ1ZyB8fCBiSWdub3JlRGVidWcpIHRoaXMuU2hvd01lc3NhZ2Uocyk7DQoJfTsNCg0KCXRoaXMucGFyYW0gPSBmdW5jdGlvbihhcmdzKSB7DQoJCXRoaXMuQ1JOTCA9IHRoaXMuQ1JOTCB8fCAiXG4iOw0KCQl2YXIgcmV0ID0NCgkJCScvKicgKw0KCQkJdGhpcy5DUk5MICsNCgkJCSc8IVtDREFUQVsnICsNCgkJCXRoaXMuQ1JOTCArDQoJCQknUEFSQU1FVEVSUycgKw0KCQkJdGhpcy5DUk5MICsNCgkJCSddXT4nICsNCgkJCXRoaXMuQ1JOTCArDQoJCQknKi8nICsNCgkJCXRoaXMuQ1JOTCArDQoJCQl0aGlzLkNSTkwgKw0KCQkJJzxwPicgKw0KCQkJdGhpcy5DUk5MOw0KCQlmb3IgKHZhciBpID0gMDsgaSA8IGFyZ3MubGVuZ3RoOyBpKyspIHsNCgkJCXZhciB4bWwgPSB0aGlzLl90b1hNTChhcmdzW2ldKTsNCgkJCWlmIChmYWxzZSkgew0KCQkJCS8vIHhtbCBjb250YWlucyBjaGFyYWN0ZXJzIHRoYXQgd291bGQgbm90IGFycml2ZSBwcm9wZXJseSBhbmQgc2hvdWxkIGJlIGNvbnZlcnRlZCB0byBiYXNlNjQNCgkJCQl4bWwgPSBidG9hKHhtbCk7DQoJCQl9DQoJCQlyZXQgKz0gJzxwJyArIGkgKyAnPicgKyB0aGlzLkNSTkwgKyB4bWwgKyAnJyArIHRoaXMuQ1JOTDsNCgkJCXJldCArPSAnPC9wJyArIGkgKyAnPicgKyB0aGlzLkNSTkw7DQoJCX0NCgkJcmV0ICs9ICc8L3A+JyArIHRoaXMuQ1JOTDsNCgkJcmV0dXJuIHJldDsNCgl9Ow0KDQoJdGhpcy5yZXNldEN1cnNvciA9IGZ1bmN0aW9uKCkgew0KCQlpZiAoIWRvY3VtZW50LmJvZHkpIHJldHVybjsNCgkJZG9jdW1lbnQuYm9keS5zdHlsZS5jdXJzb3IgPSAnYXJyb3cnOw0KCQlkb2N1bWVudC5ib2R5LnN0eWxlLmN1cnNvciA9ICcnOw0KCX07DQoNCgl0aGlzLnNlcnZlckRhdGUgPSBmdW5jdGlvbihkKSB7DQoJCWxldCB0ZCA9IDA7DQoJCWlmICh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcpIHsNCgkJCXRkID0gd2luZG93LnRpbWVEaWZmZXJlbmNlOw0KCQl9IGVsc2UgaWYgKHR5cGVvZihnbG9iYWwpICE9PSAndW5kZWZpbmVkJykgew0KCQkJdGQgPSBnbG9iYWwudGltZURpZmZlcmVuY2U7DQoJCX0gZWxzZSBpZiAodHlwZW9mKFdvcmtlckdsb2JhbFNjb3BlKSAhPT0gJ3VuZGVmaW5lZCcpIHsNCgkJCXRkID0gc2VsZi50aW1lRGlmZmVyZW5jZTsNCgkJfQ0KCQlyZXR1cm4gdGhpcy5hZGRNU2Vjb25kcyhkIHx8IG5ldyBEYXRlKCksIC10ZCk7DQoJfTsNCg0KCXRoaXMucnVuU1JTY3JpcHQgPSBmdW5jdGlvbihzKSB7DQoJCXJldHVybiB0aGlzLnJ1blNjcmlwdCgNCgkJCScoKCkgPT4geyB2YXIgcmV0ID0gbnVsbDsgJyArDQoJCQlzICsNCgkJCScgaWYodHlwZW9mKHdpbmRvdykhPT0idW5kZWZpbmVkIil7d2luZG93Lm1ldGhvZF9uYW1lID0gbWV0aG9kX25hbWU7IHdpbmRvdy5zZXJ2ZXJfdGltZSA9IHNlcnZlcl90aW1lOyB3aW5kb3cuX2V4Y2VwdGlvbiA9IHR5cGVvZihfZXhjZXB0aW9uKT09PSJ1bmRlZmluZWQiP251bGw6X2V4Y2VwdGlvbjsgd2luZG93LmV4ZWN1dGlvbl90aW1lID0gZXhlY3V0aW9uX3RpbWU7fSByZXR1cm4ge19leGNlcHRpb246IHR5cGVvZihfZXhjZXB0aW9uKT09PSJ1bmRlZmluZWQiP251bGw6X2V4Y2VwdGlvbiwgbWV0aG9kX25hbWU6IG1ldGhvZF9uYW1lLCBzZXJ2ZXJfdGltZTogc2VydmVyX3RpbWUsIGV4ZWN1dGlvbl90aW1lOiBleGVjdXRpb25fdGltZSwgcmV0OiByZXR9O30pKCk7Jw0KCQkpOw0KCX07DQoNCgl0aGlzLnByb2Nlc3NSZXN1bHQgPSBhc3luYyBmdW5jdGlvbihyZXMpIHsNCgkJaWYgKCFyZXMgfHwgIXJlcy5Db2RlIHx8ICFyZXMuU3RvcmVkTWV0aG9kKSB7DQoJCQl0aGlzLkFjdGl2ZVJlcXVlc3QgPSBudWxsOw0KCQkJcmV0dXJuIHJlczsNCgkJfQ0KDQoJCS8vIGZvciBzdXJlIGEgbWV0aG9kIHJlc3VsdCBmcm9tIGFuIGFzeW5jIGNhbGwNCgkJaWYgKHJlcy5SZXN1bHQpIHsNCgkJCS8vIHdlIGdvdCBhIHJlc3VsdA0KCQkJdmFyIF9fcmV0ID0gbnVsbDsNCgkJCXRyeSB7DQoJCQkJX19yZXQgPSB0aGlzLnByb2Nlc3NSZXNwb25zZSg0LCBudWxsLCByZXMuUmVzdWx0LCBudWxsKTsNCgkJCX0gY2F0Y2ggKGUpIHsNCgkJCQlfX3JldCA9IHJlcy5SZXN1bHQ7DQoJCQl9DQoJCQl0aGlzLkFjdGl2ZVJlcXVlc3QgPSBudWxsOw0KCQkJcmV0dXJuIF9fcmV0Ow0KCQl9DQoNCgkJdmFyIHRpbWVvdXQgPSByZXMuUnVuQWZ0ZXIgLSByZXMuRGF0ZTsNCgkJaWYgKHRpbWVvdXQgPD0gMCkgew0KCQkJLy8gbmVnYXRpdmUgdGltZW91dCBtZWFucyB0aGF0IGl0IHdhcyBzdXBwb3NlZCB0byBiZSBydW4gYnV0IGRpZCBub3QgZm9yIHNvbWUgcmVhc29uIChkZWxheSwgZmFpbHVyZSwgZXRjLi4uKQ0KCQkJLy8gc2FtZSBkYXRlIGFzIHJ1bmFmdGVyIG1lYW5zIHRoYXQgd2UgYXJlIHVzaW5nIHRoZSBpbW1lZGlhdGUgYXN5bmMgZXhlY3V0aW9uLiBpLmUuIHRoZXJlIGlzIG5vIG5lZWQgZm9yIHRoZSBydW5uZXIgdGhyZWFkIHRhc2sNCgkJCXRpbWVvdXQgPSAzMDAwMDsNCgkJfSBlbHNlIGlmICh0aW1lb3V0ID4gNSAqIDYwICogMTAwMCkgew0KCQkJLy8gbW9yZSB0aGFuIHdlIGNhbiB3YWl0LCB3ZSByZXR1cm4gYSByZWZlcmVuY2UgdG8gdGhlIHJlc3VsdA0KCQkJY29uc29sZS5sb2coDQoJCQkJJ1dlIGNhbm5vdCB3YWl0ICcgKw0KCQkJCU1hdGguZmxvb3IodGltZW91dCAvIDEwMDApICsNCgkJCQknIHNlY29uZHMuIFJldHVybmluZyByZXN1bHQuJw0KCQkJKTsNCgkJCXJldHVybiByZXM7DQoJCX0NCgkJY29uc29sZS5sb2coDQoJCQknTWFraW5nIHRoZSBuZXh0IGNhbGwgaW4gJyArDQoJCQlNYXRoLmZsb29yKHRpbWVvdXQgLyAxMDAwKSArDQoJCQknIHNlY29uZHMuJw0KCQkpOw0KDQoJCWF3YWl0IG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIHRpbWVvdXQpKTsNCgkJaWYgKCF0aGlzLkFjdGl2ZVJlcXVlc3QpIHsNCgkJCWNvbnNvbGUubG9nKCdObyBBY3RpdmVSZXF1ZXN0LCBleGl0aW5nLi4uJyk7DQoJCQlyZXR1cm4gbnVsbDsNCgkJfQ0KCQl0cnkgew0KCQkJbGV0IHJldCA9IGF3YWl0ICQuYWpheCh7DQoJCQkJdXJsOiAnL21ldGhvZC9hLmFzaHg/bmFtZT1Db250ZW50TWFuYWdlci5jbXNNZXRob2RSZXN1bHRGaW5kJnAwPXtDb2RlfScgKw0KCQkJCQlyZXMuQ29kZSArDQoJCQkJCSd7L0NvZGV9e0lkfScgKw0KCQkJCQlyZXMuSWQgKw0KCQkJCQkney9JZH0mcmFuZD0nICsNCgkJCQkJTWF0aC5yYW5kb20oKSwNCgkJCX0pOw0KCQkJcmV0ID0gdGhpcy5wcm9jZXNzUmVzcG9uc2UoNCwgbnVsbCwgcmV0LCB0aGlzLkFjdGl2ZVJlcXVlc3QuVVJMKTsNCgkJCXJldCA9IGF3YWl0IHRoaXMucHJvY2Vzc1Jlc3VsdChyZXQpOw0KCQkJcmV0dXJuIHJldDsNCgkJfSBjYXRjaCAoZXgpIHsNCgkJCWNvbnNvbGUubG9nKCdwcm9jZXNzUmVzdWx0JywgZXgpOw0KCQkJcmV0dXJuIGF3YWl0IHRoaXMuXygnQ29udGVudE1hbmFnZXIuY21zTWV0aG9kUmVzdWx0RmluZCcsIG51bGwsIHsNCgkJCQlDb2RlOiByZXMuQ29kZSwNCgkJCQlJZDogcmVzLklkLA0KCQkJfSk7DQoJCX0NCgl9Ow0KDQoJdGhpcy5wcm9jZXNzUmVzcG9uc2UgPSBmdW5jdGlvbihyZWFkeVN0YXRlLCBjYWxsQmFjaywgcmVzcG9uc2VUZXh0LCB1cmwpIHsNCgkJaWYgKFs0LCA0NF0uaW5kZXhPZihyZWFkeVN0YXRlKSA9PSAtMSkgcmV0dXJuOw0KDQoJCXZhciBzTWV0aG9kTmFtZSA9IHRoaXMuJF9SRVFVRVNUKCduYW1lJywgdXJsKTsNCg0KCQl0cnkgew0KCQkJaWYgKHJlYWR5U3RhdGUgPT0gNCkgew0KCQkJCWxldCByZXMgPSAoYXN5bmMgKCkgPT4gew0KCQkJCQlyZXR1cm4gYXdhaXQgdGhpcy5jYWNoZVJlc3VsdChudWxsLCByZXNwb25zZVRleHQpOw0KCQkJCX0pKCk7DQoJCQl9DQoNCgkJCS8vcmV0ID0gbnVsbDsNCgkJCS8vc2VydmVyX3RpbWUgPSBudWxsOw0KCQkJLy9fZXhjZXB0aW9uID0gbnVsbDsNCgkJCXZhciBiU2NyaXB0RXJyb3IgPSBmYWxzZTsNCgkJCXZhciBfcmV0ID0gbnVsbDsNCgkJCXRyeSB7DQoJCQkJX3JldCA9IHRoaXMucnVuU1JTY3JpcHQocmVzcG9uc2VUZXh0KTsNCgkJCX0gY2F0Y2ggKGUpIHsNCgkJCQlpZiAodHlwZW9mKHdpbmRvdykgPT09ICJ1bmRlZmluZWQiKSB0aHJvdyBlOw0KCQkJCWJTY3JpcHRFcnJvciA9IHRydWU7DQoJCQl9DQoNCgkJCWlmIChfcmV0ICYmIF9yZXQuc2VydmVyX3RpbWUpIHsNCgkJCQlsZXQgdGQgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKSAtIF9yZXQuc2VydmVyX3RpbWUuZ2V0VGltZSgpOw0KDQoJCQkJdHJ5IHsNCgkJCQkJd2luZG93LnRpbWVEaWZmZXJlbmNlID0gdGQ7DQoJCQkJfSBjYXRjaCAoZXgpIHsNCgkJCQkJZ2xvYmFsLnRpbWVEaWZmZXJlbmNlID0gdGQ7DQoJCQkJfQ0KCQkJfQ0KDQoJCQlpZiAoX3JldCAmJiBfcmV0Ll9leGNlcHRpb24pIHsNCgkJCQl0aGlzLlNob3dEZWJ1ZyhfZXhjZXB0aW9uLk1lc3NhZ2UpOw0KCQkJfQ0KDQoJCQlpZiAoY2FsbEJhY2sgIT0gbnVsbCkgew0KCQkJCXZhciBjYWxsUmV0ID0gbnVsbDsNCgkJCQl0cnkgew0KCQkJCQljYWxsUmV0ID0gY2FsbEJhY2soX3JldC5yZXQsIF9yZXQuX2V4Y2VwdGlvbik7DQoJCQkJfSBjYXRjaCAoZSkgew0KCQkJCQl0aGlzLlNob3dFcnJvcigNCgkJCQkJCSdFcnJvciBpbiBDYWxsYmFjazpcblxuJyArIGNhbGxCYWNrICsgJ1xuXG4nICsgZS5tZXNzYWdlDQoJCQkJCSk7DQoJCQkJfQ0KCQkJCWlmICgNCgkJCQkJdHlwZW9mIF9yZXQubWV0aG9kX25hbWUgIT09ICd1bmRlZmluZWQnICYmDQoJCQkJCXR5cGVvZiBzTWV0aG9kTmFtZSAhPT0gJ3VuZGVmaW5lZCcgJiYNCgkJCQkJc01ldGhvZE5hbWUgIT0gX3JldC5tZXRob2RfbmFtZQ0KCQkJCSkgew0KCQkJCQl0aGlzLlNob3dFcnJvcigNCgkJCQkJCSdNaXNtYXRjaCBpbiBNZXRob2QgYmV0d2VlbiBzZXJ2ZXIgYW5kIGNsaWVudDpcblNlcnZlciBNZXRob2QgTmFtZTogJyArDQoJCQkJCQlfcmV0Lm1ldGhvZF9uYW1lICsNCgkJCQkJCSdcbkNsaWVudCBNZXRob2QgTmFtZTogJyArDQoJCQkJCQlzTWV0aG9kTmFtZQ0KCQkJCQkpOw0KCQkJCX0NCgkJCQkoDQoJCQkJCXRoaXMuZkxvYWRpbmdFbmQgfHwNCgkJCQkJZnVuY3Rpb24oKSB7DQoJCQkJCQl3aW5kb3cuc3IucmVzZXRDdXJzb3IoKTsNCgkJCQkJfQ0KCQkJCSkoKTsNCg0KCQkJCXJldHVybiAoDQoJCQkJCWNhbGxSZXQgfHwgX3JldC5yZXQgfHwgKGJTY3JpcHRFcnJvciA/IHJlc3BvbnNlVGV4dCA6IG51bGwpDQoJCQkJKTsNCgkJCX0gZWxzZSB7DQoJCQkJaWYgKHR5cGVvZih3aW5kb3cpICE9PSAidW5kZWZpbmVkIikgdGhpcy5yZXNldEN1cnNvcigpOw0KCQkJCXJldHVybiAoX3JldCA/IF9yZXQucmV0IDogbnVsbCkgfHwgKGJTY3JpcHRFcnJvciA/IHJlc3BvbnNlVGV4dCA6IG51bGwpOw0KCQkJfQ0KCQl9IGNhdGNoIChlKSB7DQoJCQlpZiAodHlwZW9mKHdpbmRvdykgPT09ICJ1bmRlZmluZWQiKSB7DQoJCQkJdGhyb3cgZTsNCgkJCX0NCgkJCXRoaXMucmVzZXRDdXJzb3IoKTsNCgkJCXRoaXMuU2hvd0Vycm9yKCdFcnJvciBpbiBjb2RlOiAnICsgZS5tZXNzYWdlICsgJ1xuJyArIHJlc3BvbnNlVGV4dCk7DQoJCX0NCg0KCQlyZXR1cm4gbnVsbDsNCgl9Ow0KDQoJdGhpcy5pc09iamVjdCA9IGZ1bmN0aW9uKG8pIHsNCgkJcmV0dXJuICgNCgkJCW8gIT0gbnVsbCAmJg0KCQkJdHlwZW9mIG8gPT0gJ29iamVjdCcgJiYNCgkJCSEoby5jb25zdHJ1Y3Rvci50b1N0cmluZygpLmluZGV4T2YoJ2Z1bmN0aW9uIERhdGUoKScpID4gLTEpICYmDQoJCQkhKG8uY29uc3RydWN0b3IudG9TdHJpbmcoKS5pbmRleE9mKCdBcnJheSgpJykgPiAtMSkNCgkJKTsNCgl9Ow0KDQoJdGhpcy5fdG9KUyA9IGZ1bmN0aW9uKG8pIHsNCgkJaWYgKG8gPT0gbnVsbCkgcmV0dXJuICdudWxsJzsNCg0KCQl2YXIgcyA9ICcnOw0KCQlzd2l0Y2ggKHR5cGVvZiBvKSB7DQoJCQljYXNlICdzdHJpbmcnOg0KCQkJCXMgKz0NCgkJCQkJJyInICsNCgkJCQkJdGhpcy5teVJlcGxhY2UoDQoJCQkJCQl0aGlzLmVzY2FwZVN0cmluZyhvKSwNCgkJCQkJCVsnIjogLCddLA0KCQkJCQkJWyciOiBudWxsLCddDQoJCQkJCSkgKw0KCQkJCQknIic7DQoJCQkJYnJlYWs7DQoJCQljYXNlICdudW1iZXInOg0KCQkJCXMgKz0gbzsNCgkJCQlicmVhazsNCgkJCWNhc2UgJ2Jvb2xlYW4nOg0KCQkJCXMgKz0gbyA/ICd0cnVlJyA6ICdmYWxzZSc7DQoJCQkJYnJlYWs7DQoJCQljYXNlICdvYmplY3QnOg0KCQkJCS8vIERhdGUNCgkJCQlpZiAoby5jb25zdHJ1Y3Rvci50b1N0cmluZygpLmluZGV4T2YoJ2Z1bmN0aW9uIERhdGUoKScpID4gLTEpIHsNCgkJCQkJdmFyIHllYXIgPSBvLmdldEZ1bGxZZWFyKCkudG9TdHJpbmcoKTsNCgkJCQkJLy92YXIgbW9udGggPSAoby5nZXRNb250aCgpICsgMSkudG9TdHJpbmcoKTsgbW9udGggPSAobW9udGgubGVuZ3RoID09IDEpID8gIjAiICsgbW9udGggOiBtb250aDsNCgkJCQkJdmFyIG1vbnRoID0gby5nZXRNb250aCgpLnRvU3RyaW5nKCk7DQoJCQkJCW1vbnRoID0gbW9udGgubGVuZ3RoID09IDEgPyAnMCcgKyBtb250aCA6IG1vbnRoOw0KCQkJCQl2YXIgZGF0ZSA9IG8uZ2V0RGF0ZSgpLnRvU3RyaW5nKCk7DQoJCQkJCWRhdGUgPSBkYXRlLmxlbmd0aCA9PSAxID8gJzAnICsgZGF0ZSA6IGRhdGU7DQoJCQkJCXZhciBob3VycyA9IG8uZ2V0SG91cnMoKS50b1N0cmluZygpOw0KCQkJCQlob3VycyA9IGhvdXJzLmxlbmd0aCA9PSAxID8gJzAnICsgaG91cnMgOiBob3VyczsNCgkJCQkJdmFyIG1pbnV0ZXMgPSBvLmdldE1pbnV0ZXMoKS50b1N0cmluZygpOw0KCQkJCQltaW51dGVzID0gbWludXRlcy5sZW5ndGggPT0gMSA/ICcwJyArIG1pbnV0ZXMgOiBtaW51dGVzOw0KCQkJCQl2YXIgc2Vjb25kcyA9IG8uZ2V0U2Vjb25kcygpLnRvU3RyaW5nKCk7DQoJCQkJCXNlY29uZHMgPSBzZWNvbmRzLmxlbmd0aCA9PSAxID8gJzAnICsgc2Vjb25kcyA6IHNlY29uZHM7DQoJCQkJCXZhciBtaWxsaXNlY29uZHMgPSBvLmdldE1pbGxpc2Vjb25kcygpLnRvU3RyaW5nKCk7DQoJCQkJCXZhciB0em1pbnV0ZXMgPSBNYXRoLmFicyhvLmdldFRpbWV6b25lT2Zmc2V0KCkpOw0KCQkJCQl2YXIgdHpob3VycyA9IDA7DQoJCQkJCXdoaWxlICh0em1pbnV0ZXMgPj0gNjApIHsNCgkJCQkJCXR6aG91cnMrKzsNCgkJCQkJCXR6bWludXRlcyAtPSA2MDsNCgkJCQkJfQ0KCQkJCQl0em1pbnV0ZXMgPQ0KCQkJCQkJdHptaW51dGVzLnRvU3RyaW5nKCkubGVuZ3RoID09IDEgPw0KCQkJCQkJJzAnICsgdHptaW51dGVzLnRvU3RyaW5nKCkgOg0KCQkJCQkJdHptaW51dGVzLnRvU3RyaW5nKCk7DQoJCQkJCXR6aG91cnMgPQ0KCQkJCQkJdHpob3Vycy50b1N0cmluZygpLmxlbmd0aCA9PSAxID8NCgkJCQkJCScwJyArIHR6aG91cnMudG9TdHJpbmcoKSA6DQoJCQkJCQl0emhvdXJzLnRvU3RyaW5nKCk7DQoJCQkJCXZhciB0aW1lem9uZSA9DQoJCQkJCQkoby5nZXRUaW1lem9uZU9mZnNldCgpIDwgMCA/ICcrJyA6ICctJykgKw0KCQkJCQkJdHpob3VycyArDQoJCQkJCQknOicgKw0KCQkJCQkJdHptaW51dGVzOw0KCQkJCQlzICs9DQoJCQkJCQknbmV3IERhdGUoJyArDQoJCQkJCQl5ZWFyICsNCgkJCQkJCScsJyArDQoJCQkJCQltb250aCArDQoJCQkJCQknLCcgKw0KCQkJCQkJZGF0ZSArDQoJCQkJCQknLCcgKw0KCQkJCQkJaG91cnMgKw0KCQkJCQkJJywnICsNCgkJCQkJCW1pbnV0ZXMgKw0KCQkJCQkJJywnICsNCgkJCQkJCXNlY29uZHMgKw0KCQkJCQkJJywnICsNCgkJCQkJCW1pbGxpc2Vjb25kcyArDQoJCQkJCQknKSc7DQoJCQkJfQ0KCQkJCS8vIEFycmF5DQoJCQkJZWxzZSBpZiAoby5jb25zdHJ1Y3Rvci50b1N0cmluZygpLmluZGV4T2YoJ0FycmF5KCknKSA+IC0xKSB7DQoJCQkJCXMgKz0gJ1snOw0KCQkJCQlmb3IgKHZhciBwIGluIG8pIHsNCgkJCQkJCXMgKz0gJyc7DQoJCQkJCQlpZiAoIWlzTmFOKHApKSB7DQoJCQkJCQkJLy8gbGluZWFyIGFycmF5DQoJCQkJCQkJcyArPSB0aGlzLl90b0pTKG9bcF0pOw0KCQkJCQkJfSBlbHNlIHsNCgkJCQkJCQkvLyBhc3NvY2lhdGl2ZSBhcnJheQ0KCQkJCQkJCXMgKz0gJ3siJyArIHAgKyAnIjogJyArIHRoaXMuX3RvSlMob1twXSkgKyAnfSc7DQoJCQkJCQl9DQoJCQkJCQlzICs9ICcsICc7DQoJCQkJCX0NCgkJCQkJcyArPSAnXSc7DQoJCQkJfQ0KCQkJCS8vIE9iamVjdCBvciBjdXN0b20gZnVuY3Rpb24NCgkJCQllbHNlIHsNCgkJCQkJcyArPSAneyc7DQoJCQkJCWZvciAodmFyIHAgaW4gbykgew0KCQkJCQkJcyArPSAnIicgKyBwICsgJyI6ICcgKyB0aGlzLl90b0pTKG9bcF0pICsgJywgJzsNCgkJCQkJfQ0KCQkJCQlpZiAocy5sYXN0SW5kZXhPZignLCAnKSA9PSBzLmxlbmd0aCAtIDIpDQoJCQkJCQlzID0gcy5zdWJzdHJpbmcoMCwgcy5sZW5ndGggLSAyKTsNCgkJCQkJcyArPSAnfSc7DQoJCQkJfQ0KCQkJCWJyZWFrOw0KCQkJY2FzZSAnZnVuY3Rpb24nOg0KCQkJCS8vIGZ1bmN0aW9ucyBhcmUgbm90IHdvcmtpbmcsIElMTEVHQUwgVE9LRU4uLi4uDQoJCQkJLy9zICs9ICJcIiIrdGhpcy5lc2NhcGVTdHJpbmcoby50b1N0cmluZygpKSsiXCIiOw0KCQkJCXMgKz0gJ251bGwnOw0KCQkJCWJyZWFrOw0KCQkJZGVmYXVsdDoNCgkJCQlzICs9ICdudWxsJzsNCgkJfQ0KCQlyZXR1cm4gczsNCgl9Ow0KDQoJdGhpcy5lc2NhcGVTdHJpbmcgPSBmdW5jdGlvbih0ZXh0KSB7DQoJCWlmICghYXJndW1lbnRzLmNhbGxlZS5zUkUpIHsNCgkJCXZhciBzcGVjaWFscyA9IFsNCgkJCQknXHInLA0KCQkJCSdcbicsDQoJCQkJJ1xmJywNCgkJCQknXGInLA0KCQkJCSdcdCcsDQoJCQkJIiciLA0KCQkJCScmJywNCgkJCQknLycsDQoJCQkJJy4nLA0KCQkJCScqJywNCgkJCQknKycsDQoJCQkJJz8nLA0KCQkJCSd8JywNCgkJCQknKCcsDQoJCQkJJyknLA0KCQkJCSdbJywNCgkJCQknXScsDQoJCQkJJ3snLA0KCQkJCSd9JywNCgkJCQknXFwnLA0KCQkJCSciJywNCgkJCV07DQoJCQlhcmd1bWVudHMuY2FsbGVlLnNSRSA9IG5ldyBSZWdFeHAoDQoJCQkJJyhcXCcgKyBzcGVjaWFscy5qb2luKCd8XFwnKSArICcpJywNCgkJCQknZycNCgkJCSk7DQoJCX0NCgkJdmFyIHJldCA9IHRleHQucmVwbGFjZShhcmd1bWVudHMuY2FsbGVlLnNSRSwgJ1xcJDEnKTsNCg0KCQlyZXQgPSB0aGlzLm15UmVwbGFjZShyZXQsIFsnPCcsICc+J10sIFsnJmx0OycsICcmZ3Q7J10pOw0KCQlyZXQgPSB0aGlzLm15UmVwbGFjZSgNCgkJCXJldCwNCgkJCVsnXHInLCAnXG4nLCAnXHQnXSwNCgkJCVsnXFwnICsgJ3InLCAnXFwnICsgJ24nLCAnXFwnICsgJ3QnXQ0KCQkpOw0KDQoJCXJldHVybiByZXQ7DQoJfTsNCg0KCXRoaXMuaXBBZGRyZXNzID0gZnVuY3Rpb24oKSB7DQoJCXRyeSB7DQoJCQlpZiAodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnKSByZXR1cm4gbnVsbDsNCgkJCWlmICh0eXBlb2YoZ2xvYmFsKSA9PT0gJ3VuZGVmaW5lZCcgfHwgdHlwZW9mKGdsb2JhbC5vcykgPT09ICd1bmRlZmluZWQnKSB7DQoJCQkJLy8gY29uc29sZS5sb2coImlwQWRkcmVzcygpOiBJbnZhbGlkIGdsb2JhbCBvciBnbG9iYWwub3Mgbm90IGRlZmluZWQiKTsNCgkJCQlyZXR1cm4gbnVsbDsNCgkJCX0NCgkJCXJldHVybiBbXS5jb25jYXQoLi4uT2JqZWN0LnZhbHVlcyhnbG9iYWwub3MubmV0d29ya0ludGVyZmFjZXMoKSkpLmZpbmQoKGRldGFpbHMpID0+IGRldGFpbHMuZmFtaWx5ID09PSAnSVB2NCcgJiYgIWRldGFpbHMuaW50ZXJuYWwpLmFkZHJlc3M7DQoJCX0gY2F0Y2ggKGV4KSB7DQoJCQljb25zb2xlLmxvZygiaXBBZGRyZXNzKCk6ICIgKyBleCk7DQoJCQlyZXR1cm4gbnVsbDsNCgkJfQ0KCX0NCg0KCXRoaXMuX3RvWE1MID0gZnVuY3Rpb24obywgbGV2ZWwpIHsNCgkJaWYgKCFsZXZlbCkgbGV2ZWwgPSAwOw0KCQl2YXIgcyA9ICcnOw0KCQlpZiAobyA9PSBudWxsKSByZXR1cm4gczsNCgkJc3dpdGNoICh0eXBlb2Ygbykgew0KCQkJY2FzZSAnc3RyaW5nJzoNCgkJCQlzICs9ICc8IVtDREFUQVsnICsgbyArICddXT4nOw0KCQkJCWJyZWFrOw0KCQkJY2FzZSAnbnVtYmVyJzoNCgkJCWNhc2UgJ2Jvb2xlYW4nOg0KCQkJCXMgKz0gby50b1N0cmluZygpOw0KCQkJCWJyZWFrOw0KCQkJY2FzZSAnb2JqZWN0JzoNCgkJCQkvLyBEYXRlDQoJCQkJaWYgKA0KCQkJCQlvLmNvbnN0cnVjdG9yICYmDQoJCQkJCW8uY29uc3RydWN0b3IudG9TdHJpbmcoKS5pbmRleE9mKCdmdW5jdGlvbiBEYXRlKCknKSA+IC0xICYmDQoJCQkJCW8uY29uc3RydWN0b3IubmFtZSA9PSAiRGF0ZSINCgkJCQkpIHsNCgkJCQkJdmFyIHllYXIgPSBvLmdldFVUQ0Z1bGxZZWFyKCkudG9TdHJpbmcoKTsNCgkJCQkJdmFyIG1vbnRoID0gKG8uZ2V0VVRDTW9udGgoKSArIDEpLnRvU3RyaW5nKCk7DQoJCQkJCW1vbnRoID0gbW9udGgubGVuZ3RoID09IDEgPyAnMCcgKyBtb250aCA6IG1vbnRoOw0KCQkJCQl2YXIgZGF0ZSA9IG8uZ2V0VVRDRGF0ZSgpLnRvU3RyaW5nKCk7DQoJCQkJCWRhdGUgPSBkYXRlLmxlbmd0aCA9PSAxID8gJzAnICsgZGF0ZSA6IGRhdGU7DQoJCQkJCXZhciBob3VycyA9IG8uZ2V0VVRDSG91cnMoKS50b1N0cmluZygpOw0KCQkJCQlob3VycyA9IGhvdXJzLmxlbmd0aCA9PSAxID8gJzAnICsgaG91cnMgOiBob3VyczsNCgkJCQkJdmFyIG1pbnV0ZXMgPSBvLmdldFVUQ01pbnV0ZXMoKS50b1N0cmluZygpOw0KCQkJCQltaW51dGVzID0gbWludXRlcy5sZW5ndGggPT0gMSA/ICcwJyArIG1pbnV0ZXMgOiBtaW51dGVzOw0KCQkJCQl2YXIgc2Vjb25kcyA9IG8uZ2V0VVRDU2Vjb25kcygpLnRvU3RyaW5nKCk7DQoJCQkJCXNlY29uZHMgPSBzZWNvbmRzLmxlbmd0aCA9PSAxID8gJzAnICsgc2Vjb25kcyA6IHNlY29uZHM7DQoJCQkJCXZhciBtaWxsaXNlY29uZHMgPSBvLmdldFVUQ01pbGxpc2Vjb25kcygpLnRvU3RyaW5nKCk7DQoJCQkJCXZhciB0em1pbnV0ZXMgPSBNYXRoLmFicyhvLmdldFRpbWV6b25lT2Zmc2V0KCkpOw0KCQkJCQl2YXIgdHpob3VycyA9IDA7DQoJCQkJCXdoaWxlICh0em1pbnV0ZXMgPj0gNjApIHsNCgkJCQkJCXR6aG91cnMrKzsNCgkJCQkJCXR6bWludXRlcyAtPSA2MDsNCgkJCQkJfQ0KCQkJCQl0em1pbnV0ZXMgPQ0KCQkJCQkJdHptaW51dGVzLnRvU3RyaW5nKCkubGVuZ3RoID09IDEgPw0KCQkJCQkJJzAnICsgdHptaW51dGVzLnRvU3RyaW5nKCkgOg0KCQkJCQkJdHptaW51dGVzLnRvU3RyaW5nKCk7DQoJCQkJCXR6aG91cnMgPQ0KCQkJCQkJdHpob3Vycy50b1N0cmluZygpLmxlbmd0aCA9PSAxID8NCgkJCQkJCScwJyArIHR6aG91cnMudG9TdHJpbmcoKSA6DQoJCQkJCQl0emhvdXJzLnRvU3RyaW5nKCk7DQoJCQkJCXZhciB0aW1lem9uZSA9DQoJCQkJCQkoby5nZXRUaW1lem9uZU9mZnNldCgpIDwgMCA/ICcrJyA6ICctJykgKw0KCQkJCQkJdHpob3VycyArDQoJCQkJCQknOicgKw0KCQkJCQkJdHptaW51dGVzOw0KCQkJCQkvL3MgKz0geWVhciArICItIiArIG1vbnRoICsgIi0iICsgZGF0ZSArICJUIiArIGhvdXJzICsgIjoiICsgbWludXRlcyArICI6IiArIHNlY29uZHMgKyAiLiIgKyBtaWxsaXNlY29uZHMgKyB0aW1lem9uZTsNCgkJCQkJcyArPQ0KCQkJCQkJbW9udGggKw0KCQkJCQkJJy8nICsNCgkJCQkJCWRhdGUgKw0KCQkJCQkJJy8nICsNCgkJCQkJCXllYXIgKw0KCQkJCQkJJyAnICsNCgkJCQkJCWhvdXJzICsNCgkJCQkJCSc6JyArDQoJCQkJCQltaW51dGVzICsNCgkJCQkJCSc6JyArDQoJCQkJCQlzZWNvbmRzOw0KCQkJCX0NCgkJCQkvLyBBcnJheQ0KCQkJCWVsc2UgaWYgKA0KCQkJCQlvLmNvbnN0cnVjdG9yICYmDQoJCQkJCW8uY29uc3RydWN0b3IudG9TdHJpbmcoKS5pbmRleE9mKCdBcnJheSgpJykgPiAtMQ0KCQkJCSkgew0KCQkJCQlmb3IgKHZhciBwIGluIG8pIHsNCgkJCQkJCWlmIChwID09ICdPUEVSQVRPUlMnIHx8IHAgPT0gJ09SUycpIGNvbnRpbnVlOw0KCQkJCQkJcyArPSAnPE9iamVjdD4nOw0KCQkJCQkJaWYgKCFpc05hTihwKSkgew0KCQkJCQkJCS8vIGxpbmVhciBhcnJheQ0KCQkJCQkJCWlmIChvW3BdID09IG51bGwpIHsNCgkJCQkJCQkJLy8gbnVsbCBlbnRyeSBpbiB0aGUgYXJyYXkNCgkJCQkJCQkJcyArPSAnPElkPjA8L0lkPic7DQoJCQkJCQkJfSBlbHNlIHsNCgkJCQkJCQkJL2Z1bmN0aW9uXHMrKFx3KilccypcKC9naS5leGVjKA0KCQkJCQkJCQkJb1twXS5jb25zdHJ1Y3Rvci50b1N0cmluZygpDQoJCQkJCQkJCSk7DQoJCQkJCQkJCXZhciB0eXBlID0gUmVnRXhwLiQxOw0KCQkJCQkJCQlzd2l0Y2ggKHR5cGUpIHsNCgkJCQkJCQkJCWNhc2UgJyc6DQoJCQkJCQkJCQkJdHlwZSA9IHR5cGVvZiBvW3BdOw0KCQkJCQkJCQkJY2FzZSAnU3RyaW5nJzoNCgkJCQkJCQkJCQl0eXBlID0gJ3N0cmluZyc7DQoJCQkJCQkJCQkJYnJlYWs7DQoJCQkJCQkJCQljYXNlICdOdW1iZXInOg0KCQkJCQkJCQkJCXR5cGUgPSAnaW50JzsNCgkJCQkJCQkJCQlicmVhazsNCgkJCQkJCQkJCWNhc2UgJ0Jvb2xlYW4nOg0KCQkJCQkJCQkJCXR5cGUgPSAnYm9vbCc7DQoJCQkJCQkJCQkJYnJlYWs7DQoJCQkJCQkJCQljYXNlICdEYXRlJzoNCgkJCQkJCQkJCQl0eXBlID0gJ0RhdGVUaW1lJzsNCgkJCQkJCQkJCQlicmVhazsNCgkJCQkJCQkJfQ0KCQkJCQkJCQlzICs9IHRoaXMuX3RvWE1MKG9bcF0sIGxldmVsKyspOw0KCQkJCQkJCX0NCgkJCQkJCX0gZWxzZSB7DQoJCQkJCQkJLy8gYXNzb2NpYXRpdmUgYXJyYXkNCgkJCQkJCQlzICs9DQoJCQkJCQkJCSc8JyArDQoJCQkJCQkJCXAgKw0KCQkJCQkJCQl0aGlzLmNvb3AobywgcCkgKw0KCQkJCQkJCQknPicgKw0KCQkJCQkJCQl0aGlzLl90b1hNTChvW3BdLCBsZXZlbCsrKSArDQoJCQkJCQkJCSc8LycgKw0KCQkJCQkJCQlwICsNCgkJCQkJCQkJJz4nOw0KCQkJCQkJfQ0KCQkJCQkJcyArPSAnPC9PYmplY3Q+JyArIHRoaXMuQ1JOTDsNCgkJCQkJfQ0KCQkJCX0NCgkJCQkvLyBPYmplY3Qgb3IgY3VzdG9tIGZ1bmN0aW9uDQoJCQkJZWxzZSB7DQoJCQkJCWlmIChvID09IG51bGwgfHwgby5JZCA9PSAwKSB7fSBlbHNlIGlmIChmYWxzZSAmJiBvLklkKSB7DQoJCQkJCQkvLyB0aGlzIGlzIGNyZWF0aW5nIGEgcHJvYmxlbSwgYmV0dGVyIHNlbmQgYWxsIHRoZSBvYmplY3QNCgkJCQkJCS8vIGRvIG5vdCBzZW5kIG90aGVyIGRhdGEgaWYgd2UgaGF2ZSBhIHZhbHVlIGZvciB0aGUgSWQNCgkJCQkJCXMgKz0gJzxJZD4nICsgdGhpcy5fdG9YTUwoby5JZCwgbGV2ZWwrKykgKyAnPC9JZD4nOw0KCQkJCQl9IGVsc2Ugew0KCQkJCQkJZm9yICh2YXIgcCBpbiBvKSB7DQoJCQkJCQkJaWYgKHAgPT0gJ09QRVJBVE9SUycgfHwgcCA9PSAnT1JTJykgY29udGludWU7DQoJCQkJCQkJcyArPQ0KCQkJCQkJCQknPCcgKw0KCQkJCQkJCQlwICsNCgkJCQkJCQkJdGhpcy5jb29wKG8sIHApICsNCgkJCQkJCQkJdGhpcy5PUihvLCBwKSArDQoJCQkJCQkJCSc+JyArDQoJCQkJCQkJCXRoaXMuX3RvWE1MKG9bcF0sIGxldmVsKyspICsNCgkJCQkJCQkJJzwvJyArDQoJCQkJCQkJCXAgKw0KCQkJCQkJCQknPic7DQoJCQkJCQl9DQoJCQkJCX0NCgkJCQl9DQoJCQkJYnJlYWs7DQoJCX0NCgkJcmV0dXJuIHM7DQoJfTsNCg0KCXRoaXMuT1IgPSBmdW5jdGlvbihvLCBwKSB7DQoJCXJldHVybiBvLk9SUyAmJiBvLk9SU1twXSA/DQoJCQkiIE9SPSciICsNCgkJCXRoaXMubXlSZXBsYWNlKG8uT1JTW3BdLCBbJzwnLCAnPiddLCBbJyZsdDsnLCAnJmd0OyddKSArDQoJCQkiJyIgOg0KCQkJJyc7DQoJfTsNCg0KCXRoaXMuY29vcCA9IGZ1bmN0aW9uKG8sIHApIHsNCgkJaWYgKCFvLk9QRVJBVE9SUyB8fCAhby5PUEVSQVRPUlNbcF0pIHsNCgkJCXJldHVybiAnJzsNCgkJfQ0KCQlyZXR1cm4gKA0KCQkJIiBjb29wPSciICsNCgkJCXRoaXMubXlSZXBsYWNlKG8uT1BFUkFUT1JTW3BdLCBbJzwnLCAnPiddLCBbJyZsdDsnLCAnJmd0OyddKSArDQoJCQkiJyINCgkJKTsNCgl9Ow0KDQoJdGhpcy5nZXRYbWxIVFRQID0gZnVuY3Rpb24oKSB7DQoJCXZhciB4ID0gbnVsbDsNCgkJdmFyIGFjdGl2ZXhtb2RlcyA9IFsnTXN4bWwyLlhNTEhUVFAnLCAnTWljcm9zb2Z0LlhNTEhUVFAnXTsgLy9hY3RpdmVYIHZlcnNpb25zIHRvIGNoZWNrIGZvciBpbiBJRQ0KCQlpZiAod2luZG93LkFjdGl2ZVhPYmplY3QpIHsNCgkJCS8vVGVzdCBmb3Igc3VwcG9ydCBmb3IgQWN0aXZlWE9iamVjdCBpbiBJRSBmaXJzdCAoYXMgWE1MSHR0cFJlcXVlc3QgaW4gSUU3IGlzIGJyb2tlbikNCgkJCWZvciAodmFyIGkgPSAwOyBpIDwgYWN0aXZleG1vZGVzLmxlbmd0aDsgaSsrKSB7DQoJCQkJdHJ5IHsNCgkJCQkJeCA9IG5ldyBBY3RpdmVYT2JqZWN0KGFjdGl2ZXhtb2Rlc1tpXSk7DQoJCQkJCWJyZWFrOw0KCQkJCX0gY2F0Y2ggKGUpIHsNCgkJCQkJLy9zdXBwcmVzcyBlcnJvcg0KCQkJCX0NCgkJCX0NCgkJfSBlbHNlIGlmICh3aW5kb3cuWE1MSHR0cFJlcXVlc3QpIHsNCgkJCS8vIGlmIE1vemlsbGEsIFNhZmFyaSBldGMNCgkJCXggPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTsNCgkJfSBlbHNlIHsNCgkJCXggPSBudWxsOw0KCQl9DQoNCgkJcmV0dXJuICh3aW5kb3cueG1sSFRUUCA9IHgpOw0KCX07DQoNCgl0aGlzLmNhY2hlUmVzdWx0ID0gYXN5bmMgZnVuY3Rpb24ocmVxdWVzdCwgdGV4dHJlc3BvbnNlKSB7DQoJCWlmICghdGhpcy5iQ2FjaGVSZXN1bHQpIHJldHVybjsNCgkJcmVxdWVzdCA9IHJlcXVlc3QgfHwgdGhpcy5BY3RpdmVSZXF1ZXN0Ow0KDQoJCWlmICghcmVxdWVzdCkgew0KCQkJcmV0dXJuOw0KCQl9DQoNCgkJaWYgKA0KCQkJdGV4dHJlc3BvbnNlICYmDQoJCQl0ZXh0cmVzcG9uc2UuaW5kZXhPZigncmV0LkNvZGUgPSAnKSA+IC0xICYmDQoJCQl0ZXh0cmVzcG9uc2UuaW5kZXhPZigncmV0LlJ1bkFmdGVyID0gJykgPiAtMSAmJg0KCQkJdGV4dHJlc3BvbnNlLmluZGV4T2YoJ3JldC5SZXN1bHQgPSAiIicpID4gLTENCgkJKSB7DQoJCQljb25zb2xlLmxvZygndGV4dHJlc3BvbnNlIGNvbnRpYW5zIGluY29tcGxldGUgbWV0aG9kIHJlc3VsdCcpOw0KCQkJcmV0dXJuIG51bGw7DQoJCX0NCg0KCQl2YXIgc01ldGhvZCA9IHRoaXMuJF9SRVFVRVNUKCduYW1lJywgcmVxdWVzdC5VUkwpOw0KCQlzTWV0aG9kID0gc01ldGhvZC5zdWJzdHJpbmcoc01ldGhvZC5sYXN0SW5kZXhPZignLicpICsgMSk7DQoJCXRyeSB7DQoJCQl2YXIgX3VzYWJsZSA9IChyKSA9PiB7DQoJCQkJdmFyIGl0ZW0gPQ0KCQkJCQkociAmJg0KCQkJCQkJci5oYXNoID09IHJlcXVlc3QuaGFzaCAmJg0KCQkJCQkJKHIuVVJMID09IHJlcXVlc3QuVVJMIHx8IHRoaXMuJF9SRVFVRVNUKCduYW1lJywgci5VUkwpID09IHNNZXRob2QpICYmDQoJCQkJCQlyLlRleHRSZXNwb25zZSAmJg0KCQkJCQkJKHR5cGVvZiByLkV4cGlyZXMgPT09ICd1bmRlZmluZWQnIHx8DQoJCQkJCQkJbmV3IERhdGUoci5FeHBpcmVzKSA+IG5ldyBEYXRlKCkpKSA/DQoJCQkJCXIgOg0KCQkJCQludWxsOw0KCQkJCWlmICh0ZXh0cmVzcG9uc2UpIHsNCgkJCQkJaXRlbSA9IGl0ZW0gfHwgcmVxdWVzdDsNCgkJCQkJaXRlbS5UZXh0UmVzcG9uc2UgPSB0ZXh0cmVzcG9uc2U7DQoJCQkJCWl0ZW0uRXhwaXJlcyA9IG5ldyBEYXRlKA0KCQkJCQkJbmV3IERhdGUoKS5nZXRUaW1lKCkgKw0KCQkJCQkJcGFyc2VGbG9hdCgNCgkJCQkJCQl0aGlzLm5DYWNoZUV4cGlyZUhvdXJzIHx8IHRoaXMuJF9SRVFVRVNUKCduQ2FjaGVFeHBpcmVIb3VycycpIHx8IDENCgkJCQkJCSkgKg0KCQkJCQkJNjAgKg0KCQkJCQkJNjAgKg0KCQkJCQkJMTAwMA0KCQkJCQkpOw0KCQkJCX0NCg0KCQkJCXJldHVybiBpdGVtOw0KCQkJfTsNCg0KCQkJaWYgKA0KCQkJCXRoaXMuYkNhY2hlUmVzdWx0ID09ICdrdnN0b3JlJyAmJg0KCQkJCXR5cGVvZiB3aW5kb3cuY29tcGFueS5yZXN0aW9kYlNldHRpbmdzICE9PSAndW5kZWZpbmVkJw0KCQkJKSB7DQoJCQkJdmFyIGFqYXggPSAoa2V5LCB2YWx1ZSwgaWQpID0+IHsNCgkJCQkJdmFyIHJldCA9IGNvbXBhbnkucmVzdGlvZGJTZXR0aW5ncygpOw0KCQkJCQlyZXQudXJsICs9ICdrdnN0b3JlJzsNCgkJCQkJaWYgKHZhbHVlKSB7DQoJCQkJCQlpZiAoaWQpIHsNCgkJCQkJCQkvLyB1cGRhdGUgcmVjb3JkDQoJCQkJCQkJcmV0LnVybCArPSAnLycgKyBpZDsNCgkJCQkJCQlyZXQubWV0aG9kID0gJ1BVVCc7DQoJCQkJCQl9IGVsc2Ugew0KCQkJCQkJCS8vIG5ldyByZWNvcmQNCgkJCQkJCQlyZXQubWV0aG9kID0gJ1BPU1QnOw0KCQkJCQkJfQ0KCQkJCQkJcmV0LmRhdGEgPSBKU09OLnN0cmluZ2lmeSh7DQoJCQkJCQkJa2V5OiBrZXksDQoJCQkJCQkJdmFsdWU6IEpTT04uc3RyaW5naWZ5KHZhbHVlLCBudWxsLCA0KSwNCgkJCQkJCX0pOw0KCQkJCQl9IGVsc2Ugew0KCQkJCQkJaWYgKGlkKSB7DQoJCQkJCQkJLy8gZGVsZXRlIHJlY29yZA0KCQkJCQkJCXJldC51cmwgKz0gJy8nICsgaWQ7DQoJCQkJCQkJcmV0Lm1ldGhvZCA9ICdERUxFVEUnOw0KCQkJCQkJfSBlbHNlIHsNCgkJCQkJCQlyZXQubWV0aG9kID0gJ0dFVCc7DQoJCQkJCQkJcmV0LnVybCArPSAnP3E9eyJrZXkiOicgKyBrZXkgKyAnfSc7DQoJCQkJCQl9DQoJCQkJCX0NCgkJCQkJLy9jb25zb2xlLmxvZygnbWV0aG9kJywgcmV0Lm1ldGhvZCk7DQoJCQkJCXJldHVybiByZXQ7DQoJCQkJfTsNCg0KCQkJCWxldCByZWNvcmQgPSBhd2FpdCAkLmFqYXgoYWpheChyZXF1ZXN0Lmhhc2gpKTsNCgkJCQlsZXQgciA9DQoJCQkJCXJlY29yZCAmJiByZWNvcmQubGVuZ3RoID8NCgkJCQkJSlNPTi5wYXJzZShyZWNvcmRbMF0udmFsdWUpIDoNCgkJCQkJbnVsbDsNCgkJCQlsZXQgaXRlbSA9IF91c2FibGUocik7DQoNCgkJCQlpZiAoIWl0ZW0pIHsNCgkJCQkJaWYgKHIpIHsNCgkJCQkJCWF3YWl0ICQuYWpheChhamF4KHJlcXVlc3QuaGFzaCwgbnVsbCwgcmVjb3JkWzBdLl9pZCkpOw0KCQkJCQl9DQoJCQkJCXJldHVybiBudWxsOw0KCQkJCX0NCg0KCQkJCWlmICghciB8fCBpdGVtLkV4cGlyZXMgPiByLkV4cGlyZXMpIHsNCgkJCQkJYXdhaXQgJC5hamF4KA0KCQkJCQkJYWpheChpdGVtLmhhc2gsIGl0ZW0sIHIgPyByZWNvcmRbMF0uX2lkIDogbnVsbCkNCgkJCQkJKTsNCgkJCQkJcmV0dXJuIGl0ZW07DQoJCQkJfQ0KDQoJCQkJcmV0dXJuIGl0ZW07DQoJCQl9IGVsc2UgaWYgKHRoaXMuYkNhY2hlUmVzdWx0ID09ICdzcicpIHsNCgkJCQl2YXIgYWpheCA9IChrZXksIHZhbHVlLCBpZCkgPT4gew0KCQkJCQl2YXIgbWV0aG9kID0gJ0ZpbmQnOw0KCQkJCQl2YXIgcmV0ID0gew0KCQkJCQkJdXJsOiAnL21ldGhvZC9hLmFzaHg/bmFtZT1Db250ZW50TWFuYWdlci5jbXNNZXRob2RSZXN1bHQnLA0KCQkJCQkJcHJvY2Vzc0RhdGE6IGZhbHNlLA0KCQkJCQkJdHlwZTogJ1BPU1QnLA0KCQkJCQl9Ow0KCQkJCQlpZiAodmFsdWUpIHsNCgkJCQkJCWlmIChpZCkgew0KCQkJCQkJCS8vIHVwZGF0ZSByZWNvcmQNCgkJCQkJCQltZXRob2QgPSAnVXBkYXRlJzsNCgkJCQkJCX0gZWxzZSB7DQoJCQkJCQkJLy8gbmV3IHJlY29yZA0KCQkJCQkJCW1ldGhvZCA9ICdJbnNlcnQnOw0KCQkJCQkJfQ0KCQkJCQkJcmV0LmJlZm9yZVNlbmQgPSAocmVxdWVzdCkgPT4gew0KCQkJCQkJCXJlcXVlc3Quc2V0UmVxdWVzdEhlYWRlcigNCgkJCQkJCQkJJ0NvbnRlbnQtVHlwZScsDQoJCQkJCQkJCSdtdWx0aXBhcnQvZm9ybS1kYXRhOyBib3VuZGFyeT0tLS0tLS0tLS0tLS0tLScNCgkJCQkJCQkpOw0KCQkJCQkJfTsNCgkJCQkJfSBlbHNlIHsNCgkJCQkJCXJldC50eXBlID0gJ0dFVCc7DQoJCQkJCQlpZiAoaWQpIHsNCgkJCQkJCQkvLyBkZWxldGUgcmVjb3JkDQoJCQkJCQkJbWV0aG9kID0gJ0RlbGV0ZSc7DQoJCQkJCQl9IGVsc2Ugew0KCQkJCQkJCS8vIGdldCByZWNvcmQNCgkJCQkJCQltZXRob2QgPSAnRmluZCc7DQoJCQkJCQl9DQoJCQkJCQltZXRob2QgKz0NCgkJCQkJCQknJnAwPXtDb2RlfScgKw0KCQkJCQkJCShjb21wYW55ID8gY29tcGFueS5Db2RlICsgJy0nIDogJycpICsNCgkJCQkJCQlrZXkgKw0KCQkJCQkJCSd7L0NvZGV9JzsNCgkJCQkJfQ0KCQkJCQlyZXQudXJsICs9IG1ldGhvZDsNCgkJCQkJaWYgKHJldC50eXBlICE9ICdHRVQnKSB7DQoJCQkJCQlkZWxldGUgaXRlbS5Qb3N0RGF0YTsgLy8gYmVjYXVzZSB3ZSBoYXZlIHRoZSBjYWNoZSBrZXkNCgkJCQkJCXZhciBwMCA9IHsNCgkJCQkJCQlDb2RlOiAoY29tcGFueSA/IGNvbXBhbnkuQ29kZSArICctJyA6ICcnKSArIGtleSwNCgkJCQkJCQlDb21wbGV0ZWQ6IG5ldyBEYXRlKCksDQoJCQkJCQkJRGF0ZTogdGhpcy5BY3RpdmVSZXF1ZXN0ID8NCgkJCQkJCQkJdGhpcy5BY3RpdmVSZXF1ZXN0LkRhdGUgOiBuZXcgRGF0ZSgpLA0KCQkJCQkJCVJlc3VsdDogYnRvYSh1bmVzY2FwZShlbmNvZGVVUklDb21wb25lbnQoSlNPTi5zdHJpbmdpZnkoaXRlbSkpKSksIC8vaXRlbS5UZXh0UmVzcG9uc2UsDQoJCQkJCQkJU3RvcmVkTWV0aG9kOiB7DQoJCQkJCQkJCU5hbWU6IHNNZXRob2QsDQoJCQkJCQkJfSwNCgkJCQkJCX07DQoJCQkJCQlpZiAoaWQpIHsNCgkJCQkJCQlwMC5JZCA9IGlkOw0KCQkJCQkJfQ0KCQkJCQkJcmV0LmRhdGEgPQ0KCQkJCQkJCSdQT1NUREFUQT1cclxuJyAvKisgIjw/eG1sIHZlcnNpb249XCIxLjBcIiBlbmNvZGluZz1cInV0Zi04XCIgc3RhbmRhbG9uZT1cInllc1wiPz5cclxuIiovICsNCgkJCQkJCQl0aGlzLnBhcmFtKFtwMF0pOw0KCQkJCQl9DQoJCQkJCXJldHVybiByZXQ7DQoJCQkJfTsNCg0KCQkJCWxldCByZWNvcmQgPSB0aGlzLnJ1blNjcmlwdCAvKnJ1blNSU2NyaXB0Ki8oDQoJCQkJCScoKCkgPT4geyB2YXIgcmV0ID0gbnVsbDsgJyArDQoJCQkJCShhd2FpdCAkLmFqYXgoYWpheChyZXF1ZXN0Lmhhc2gpKSkgKw0KCQkJCQkncmV0dXJuIHJldDt9KSgpOycNCgkJCQkpOw0KCQkJCWxldCByID0gcmVjb3JkID8gSlNPTi5wYXJzZShyZWNvcmQuUmVzdWx0KSA6IG51bGw7DQoJCQkJbGV0IGl0ZW0gPSBfdXNhYmxlKHIpOw0KDQoJCQkJaWYgKCFpdGVtKSB7DQoJCQkJCWlmIChyKSB7DQoJCQkJCQl0cnkgew0KCQkJCQkJCWF3YWl0ICQuYWpheChhamF4KHJlcXVlc3QuaGFzaCwgbnVsbCwgcmVjb3JkLklkKSk7DQoJCQkJCQl9IGNhdGNoIChleCkge30NCgkJCQkJfQ0KCQkJCQlyZXR1cm4gbnVsbDsNCgkJCQl9DQoNCgkJCQlpZiAoIXIgfHwgaXRlbS5FeHBpcmVzID4gci5FeHBpcmVzKSB7DQoJCQkJCWF3YWl0ICQuYWpheCgNCgkJCQkJCWFqYXgoaXRlbS5oYXNoLCBpdGVtLCByICYmIHJlY29yZCA/IHJlY29yZC5JZCA6IG51bGwpDQoJCQkJCSk7DQoJCQkJCXJldHVybiBpdGVtOw0KCQkJCX0NCg0KCQkJCXJldHVybiBpdGVtOw0KCQkJfSBlbHNlIGlmICh0aGlzLmJDYWNoZVJlc3VsdCA9PSAnZ2l0aHViJykgew0KCQkJCWlmIChyZXF1ZXN0LlVSTC5pbmRleE9mKCdjbXNNZXRob2RSZXN1bHQnKSA+PSAwKSByZXR1cm4gbnVsbDsNCgkJCQlsZXQgcmVzID0gbnVsbDsNCgkJCQl0cnkgew0KCQkJCQlyZXMgPSBhd2FpdCAkLmFqYXgoew0KCQkJCQkJdXJsOiAnaHR0cHM6Ly9hcnpob3NwaXRhbC5naXRodWIuaW8vJyArDQoJCQkJCQkJY29tcGFueS5TdG9yZSArDQoJCQkJCQkJJy8nICsNCgkJCQkJCQlyZXF1ZXN0Lmhhc2ggKw0KCQkJCQkJCScuanMnLA0KCQkJCQkJZGF0YVR5cGU6ICdqc29ucCcsDQoJCQkJCQlwcm9jZXNzUmVzdWx0OiBmYWxzZSwNCgkJCQkJfSk7DQoJCQkJCXJldHVybiB7DQoJCQkJCQlUZXh0UmVzcG9uc2U6IHJlcywNCgkJCQkJfTsNCgkJCQl9IGNhdGNoIChleCkgew0KCQkJCQljb25zb2xlLmxvZygnRVJST1JTOicsIGV4KTsNCgkJCQkJcmV0dXJuIG51bGw7DQoJCQkJfQ0KCQkJfSBlbHNlIGlmICh0aGlzLmJDYWNoZVJlc3VsdCA9PSAnbG9jYWwnKSB7DQoJCQkJdmFyIHNyQ2FjaGUgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnc3JDYWNoZScpOw0KCQkJCWlmIChzckNhY2hlID09IG51bGwpIHsNCgkJCQkJc3JDYWNoZSA9IHsNCgkJCQkJCVJlcXVlc3RzOiB7fSwNCgkJCQkJfTsNCgkJCQl9IGVsc2Ugew0KCQkJCQlzckNhY2hlID0gSlNPTi5wYXJzZShzckNhY2hlKTsNCgkJCQl9DQoNCgkJCQl2YXIgciA9IHNyQ2FjaGUuUmVxdWVzdHNbcmVxdWVzdC5oYXNoXTsNCgkJCQl2YXIgaXRlbSA9IF91c2FibGUocik7DQoNCgkJCQlpZiAoIWl0ZW0pIHsNCgkJCQkJZGVsZXRlIHNyQ2FjaGUuUmVxdWVzdHNbcmVxdWVzdC5oYXNoXTsNCgkJCQkJbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ3NyQ2FjaGUnLCBKU09OLnN0cmluZ2lmeShzckNhY2hlKSk7DQoJCQkJCXJldHVybiBudWxsOw0KCQkJCX0NCg0KCQkJCWlmICghciB8fCBpdGVtLkV4cGlyZXMgPiByLkV4cGlyZXMpIHsNCgkJCQkJc3JDYWNoZS5SZXF1ZXN0c1tpdGVtLmhhc2hdID0gaXRlbTsNCgkJCQkJbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ3NyQ2FjaGUnLCBKU09OLnN0cmluZ2lmeShzckNhY2hlKSk7DQoJCQkJCXJldHVybiBpdGVtOw0KCQkJCX0NCg0KCQkJCXJldHVybiBpdGVtOw0KCQkJfQ0KCQl9IGNhdGNoIChleCkgew0KCQkJY29uc29sZS5sb2coZXgpOw0KCQkJdGhyb3cgZXg7DQoJCX0NCgl9Ow0KDQoJdGhpcy5fID0gYXN5bmMgZnVuY3Rpb24oZnVuLCBjYWxsQmFjaykgew0KCQlpZiAodGhpcy5zX0Vycm9yTWVzc2FnZXMgJiYgdGhpcy5zX0Vycm9yTWVzc2FnZXMubGVuZ3RoID4gMCkgew0KCQkJYWxlcnQoDQoJCQkJJ1RoZSBmb2xsb3dpbmcgZXJyb3JzIHdlcmUgZm91bmQgaW4geW91ciBkYXRhOlxuJyArDQoJCQkJdGhpcy5zX0Vycm9yTWVzc2FnZXMNCgkJCSk7DQoJCQl0aGlzLnNfRXJyb3JNZXNzYWdlcyA9ICcnOw0KCQkJcmV0dXJuIG51bGw7DQoJCX0NCg0KCQl0aGlzLmJ1aWxkVVJMKCk7DQoNCgkJaWYgKHR5cGVvZihkb2N1bWVudCkgIT09ICJ1bmRlZmluZWQiKSgNCgkJCXRoaXMuZkxvYWRpbmdTdGFydCB8fA0KCQkJZnVuY3Rpb24oKSB7DQoJCQkJaWYgKGRvY3VtZW50LmJvZHkpIGRvY3VtZW50LmJvZHkuc3R5bGUuY3Vyc29yID0gJ3dhaXQnOw0KCQkJfQ0KCQkpKCk7DQoNCgkJdmFyIGFyZ3MgPSBBcnJheSgpOw0KCQlmb3IgKHZhciBpID0gMjsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgew0KCQkJYXJnc1tpIC0gMl0gPSBhcmd1bWVudHNbaV07DQoJCX0NCg0KCQlpZiAodGhpcy4kX1JFUVVFU1QoJ25vU1InKSkgew0KCQkJbGV0IGZQYXJ0cyA9IGZ1bi5zcGxpdCgnLicpOw0KCQkJbGV0IGxpYiA9IGZQYXJ0cy5sZW5ndGggPiAxID8gZlBhcnRzWzBdIDogJ0NvbnRlbnRNYW5hZ2VyJzsNCgkJCWxldCBmID0gZlBhcnRzLmxlbmd0aCA+IDEgPyBmUGFydHNbMV0gOiBmdW47DQoNCgkJCWZQYXJ0cyA9IGYucmVwbGFjZSgvKFthLXowLTldKShbQS1aXSkvZywgJyQxLiQyJykuc3BsaXQoJy4nKTsNCg0KCQkJbGV0IGVjID0gZlBhcnRzLnNsaWNlKDEsIC0xKS5qb2luKCcnKTsNCgkJCWxldCBmbmFtZSA9IGZQYXJ0cy5zbGljZSgtMSlbMF07DQoJCQlsZXQgc2NvcGUgPSBsaWIudG9Mb3dlckNhc2UoKTsNCg0KCQkJY29uc29sZS5sb2coImNhbGxpbmcuLi4gbmV3IFsiICsgbGliICsgJ10gJyArIGZQYXJ0c1swXSArICcuJyArIGVjICsgIigpLiIgKyBmbmFtZSArICIoKS4uLiAiIC8qICsgSlNPTi5zdHJpbmdpZnkoYXJncywgbnVsbCwgNCkqLyApOw0KDQoJCQlsZXQgb1Njb3BlID0gdGhpcy5fX3Njb3BlKHNjb3BlKTsNCgkJCWlmICghb1Njb3BlIHx8ICFvU2NvcGVbZWNdKSB7DQoJCQkJaWYgKGZuYW1lID09ICdGaW5kJykgew0KCQkJCQlsZXQgb3duZXIgPSB0aGlzLiRfUkVRVUVTVCgnb3duZXInKSB8fCAnYXJ6aG9zcGl0YWwnOw0KCQkJCQlsZXQgdXJsID0gYGh0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS8ke293bmVyfS8ke293bmVyfS5naXRodWIuaW8vbWFzdGVyL2NvbS9uYW1tb3VyLyR7ZlBhcnRzWzBdfS8ke2VjfS8ke2FyZ3NbMF1bT2JqZWN0LmtleXMoYXJnc1swXSlbMF1dfS5qc29uYDsNCgkJCQkJY29uc29sZS5sb2coIl8oKTogZmV0Y2hpbmcgIiArIHVybCk7DQoJCQkJCWxldCByZXQgPSBhd2FpdCBmZXRjaCh1cmwpOw0KCQkJCQlpZiAoIXJldC5vaykgcmV0dXJuIG51bGw7DQoJCQkJCWxldCBfb2JqID0gSlNPTi5wYXJzZShhd2FpdCByZXQudGV4dCgpKTsNCgkJCQkJcmV0dXJuIF9vYmoucmVtYXJrID8gYXRvYihfb2JqLnJlbWFyaykgOiBfb2JqOw0KCQkJCX0NCgkJCQlyZXR1cm4gZm5hbWUuZW5kc1dpdGgoJ2FsbCcpID8gW10gOiBudWxsOw0KCQkJfQ0KCQkJY29uc29sZS5sb2coc2NvcGUgKyAiLi4uIGNhbGxpbmcuLi4iLCBvU2NvcGUpOw0KDQoJCQlyZXR1cm4gYXdhaXQgbmV3KG9TY29wZVtlY10pKClbZm5hbWVdKGFyZ3MpOw0KCQl9DQoNCgkJdmFyIHBvc3REYXRhID0gdGhpcy5wYXJhbShhcmdzKTsNCgkJaWYgKGZ1bi5pbmRleE9mKCcuJykgPCAwKSB7DQoJCQlmdW4gPSB0aGlzLnN5c3RlbU5hbWUgKyAnLicgKyBmdW47DQoJCX0gZWxzZSBpZiAoZnVuLmluZGV4T2YoJy4nKSA9PSAwKSB7DQoJCQkvLyBhIG5vbi1sYXllciBtZXRob2QNCgkJCWZ1biA9IGZ1bi5zdWJzdHJpbmcoMSk7DQoJCX0NCg0KCQlpZiAoY2FsbEJhY2sgJiYgdGhpcy5BY3RpdmVSZXF1ZXN0KSB7DQoJCQl0aGlzLkFjdGl2ZVJlcXVlc3QgPSBudWxsOw0KCQkJLy9yZXR1cm4gZmFsc2U7DQoJCX0NCg0KCQl2YXIgaENvZGUgPSB0aGlzLmhhc2hDb2RlKA0KCQkJZnVuLnN1YnN0cmluZyhmdW4uaW5kZXhPZignLicpICsgMSkgKyBwb3N0RGF0YQ0KCQkpOw0KDQoJCXRoaXMuQ1JOTCA9IHRoaXMuQ1JOTCB8fCAiXG4iOw0KCQlwb3N0RGF0YSArPQ0KCQkJdGhpcy5DUk5MICsNCgkJCXRoaXMuQ1JOTCArDQoJCQknPCEtLTxwaWQ+JyArDQoJCQloQ29kZSArDQoJCQknPC9waWQ+LS0+JyArDQoJCQl0aGlzLkNSTkw7DQoNCgkJaWYgKGZ1bi5pbmRleE9mKCdjbXNNZXRob2RSZXN1bHRGaW5kJykgPCAwKSB7DQoJCQkvLyBhdm9pZCBvdmVyd3JpdGUgb2YgYXN5bmMgY2FsbHMNCgkJCXRoaXMuQWN0aXZlUmVxdWVzdCA9IHsNCgkJCQlVUkw6IHRoaXMuc3JVUkwgKyAnJm5hbWU9JyArIGZ1biwNCgkJCQlQb3N0RGF0YTogcG9zdERhdGEsDQoJCQkJRGF0ZTogbmV3IERhdGUoKSwNCgkJCQlDYWxsQmFjazogY2FsbEJhY2ssDQoJCQkJQ29tcGFueTogdHlwZW9mIGNvbXBhbnkgIT09ICd1bmRlZmluZWQnICYmIGNvbXBhbnkgPyB7DQoJCQkJCUNvZGU6IGNvbXBhbnkuQ29kZSwNCgkJCQl9IDogbnVsbCwNCgkJCQlUZXh0UmVzcG9uc2U6IG51bGwsDQoJCQkJaGFzaDogaENvZGUsDQoJCQl9Ow0KCQl9DQoNCgkJaWYgKHR5cGVvZih3aW5kb3cpICE9PSAidW5kZWZpbmVkIiAmJiAhdGhpcy5iTG9jYWwpIHsNCgkJCS8vIGxpdmUNCgkJCXRyeSB7DQoJCQkJdmFyIF90aGVVcmwgPQ0KCQkJCQkodGhpcy5TdG9yZSB8fA0KCQkJCQkJJy9zdG9yZS8nICsNCgkJCQkJCSh3aW5kb3cuY29tcGFueSAmJiB3aW5kb3cuY29tcGFueS5Db2RlID8NCgkJCQkJCQl3aW5kb3cuY29tcGFueS5Db2RlICsgJy8nIDoNCgkJCQkJCQknLycpKSArDQoJCQkJCWhDb2RlICsNCgkJCQkJJy5qcz9yYW5kPScgKw0KCQkJCQlNYXRoLnJhbmRvbSgpOw0KCQkJCWxldCByZXF1ZXN0ID0gYXdhaXQgdGhpcy5jYWNoZVJlc3VsdCgpOw0KCQkJCXZhciByZXNwb25zZVRleHQgPSBudWxsOw0KCQkJCWlmICghcmVxdWVzdCkgew0KCQkJCQl0cnkgew0KCQkJCQkJcmVzcG9uc2VUZXh0ID0gYXdhaXQgJC5nZXQoX3RoZVVybCk7DQoJCQkJCX0gY2F0Y2ggKGV4KSB7fQ0KCQkJCX0gZWxzZSB7DQoJCQkJCXJlc3BvbnNlVGV4dCA9IHJlcXVlc3QuVGV4dFJlc3BvbnNlOw0KCQkJCX0NCgkJCQlpZiAoIXJlc3BvbnNlVGV4dCkgew0KCQkJCQljb25zb2xlLmxvZygNCgkJCQkJCSdMaXZlIE1vZGUsIG5vIHJlc3BvbnNlIHRleHQgZm9yICcgKw0KCQkJCQkJdGhpcy5BY3RpdmVSZXF1ZXN0Lmhhc2ggKw0KCQkJCQkJJyAtICcgKw0KCQkJCQkJdGhpcy4kX1JFUVVFU1QoJ25hbWUnLCB0aGlzLkFjdGl2ZVJlcXVlc3QuVVJMKQ0KCQkJCQkpOw0KCQkJCQlyZXR1cm4gbnVsbDsNCgkJCQl9DQoNCgkJCQl2YXIgX3JldCA9IG51bGw7DQoJCQkJdmFyIF9leGNlcHRpb24gPSBudWxsOw0KCQkJCXRyeSB7DQoJCQkJCV9yZXQgPSB0aGlzLnJ1blNSU2NyaXB0KHJlc3BvbnNlVGV4dCk7DQoJCQkJCV9leGNlcHRpb24gPSBfcmV0Ll9leGNlcHRpb247DQoJCQkJCWlmIChfcmV0LnNlcnZlcl90aW1lKSB7DQoJCQkJCQlsZXQgdGQgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKSAtIF9yZXQuc2VydmVyX3RpbWUuZ2V0VGltZSgpOw0KCQkJCQkJdHJ5IHsNCgkJCQkJCQl3aW5kb3cudGltZURpZmZlcmVuY2UgPSB0ZDsNCgkJCQkJCX0gY2F0Y2ggKGV4KSB7DQoJCQkJCQkJZ2xvYmFsLnRpbWVEaWZmZXJlbmNlID0gdGQ7DQoJCQkJCQl9DQoJCQkJCX0NCgkJCQl9IGNhdGNoIChlKSB7DQoJCQkJCV9leGNlcHRpb24gPSBlOw0KCQkJCX0NCg0KCQkJCWlmICghX3JldCAmJiAhX2V4Y2VwdGlvbikgew0KCQkJCQlyZXR1cm4gYXdhaXQgbnVsbDsgLy90aGlzLmRvSGVhZGxlc3NDYWxsKGNhbGxCYWNrKTsNCgkJCQl9IGVsc2Ugew0KCQkJCQkvL3RoaXMuQWN0aXZlUmVxdWVzdCA9IG51bGw7DQoJCQkJCWlmIChjYWxsQmFjayAhPSBudWxsKSB7DQoJCQkJCQl0cnkgew0KCQkJCQkJCWNhbGxCYWNrKA0KCQkJCQkJCQlfcmV0LnJldCB8fCAoX2V4Y2VwdGlvbiA/IHJlc3BvbnNlVGV4dCA6IG51bGwpLA0KCQkJCQkJCQlfZXhjZXB0aW9uDQoJCQkJCQkJKTsNCgkJCQkJCX0gY2F0Y2ggKGUpIHsNCgkJCQkJCQl0aGlzLlNob3dFcnJvcigNCgkJCQkJCQkJJ0Vycm9yIGluIENhbGxiYWNrOlxuXG4nICsNCgkJCQkJCQkJY2FsbEJhY2sgKw0KCQkJCQkJCQknXG5cbicgKw0KCQkJCQkJCQllLm1lc3NhZ2UNCgkJCQkJCQkpOw0KCQkJCQkJfQ0KCQkJCQl9DQoJCQkJCSgNCgkJCQkJCXdpbmRvdy5zci5mTG9hZGluZ0VuZCB8fA0KCQkJCQkJKCgpID0+IHsNCgkJCQkJCQl0aGlzLnJlc2V0Q3Vyc29yKCk7DQoJCQkJCQl9KQ0KCQkJCQkpKCk7DQoJCQkJCXJldHVybiAoDQoJCQkJCQkoX3JldCA/IF9yZXQucmV0IDogbnVsbCkgfHwNCgkJCQkJCShfZXhjZXB0aW9uID8gcmVzcG9uc2VUZXh0IDogbnVsbCkNCgkJCQkJKTsNCgkJCQl9DQoJCQl9IGNhdGNoIChlKSB7DQoJCQkJY29uc29sZS5sb2coZSk7DQoJCQkJcmV0dXJuIGZhbHNlOw0KCQkJfQ0KCQl9IGVsc2Ugew0KCQkJcmV0dXJuIChhc3luYyAoKSA9PiB7DQoJCQkJcmV0dXJuIGF3YWl0IHRoaXMuc2VuZFhNTCgNCgkJCQkJdGhpcy5zclVSTCArICcmbmFtZT0nICsgZnVuLA0KCQkJCQlwb3N0RGF0YSwNCgkJCQkJY2FsbEJhY2sNCgkJCQkpOw0KCQkJfSkoKTsNCgkJfQ0KCX07DQoNCgl0aGlzLnByb21pc2UgPSBmdW5jdGlvbihkYXRhLCBjYWxsQmFjaykgew0KCQlpZiAoIWNhbGxCYWNrIHx8IHt9LnRvU3RyaW5nLmNhbGwoY2FsbEJhY2spICE9PSAnW29iamVjdCBGdW5jdGlvbl0nKSB7DQoJCQlyZXR1cm4gZGF0YTsNCgkJfQ0KDQoJCXZhciBwID0gJC5EZWZlcnJlZCgpOw0KDQoJCXNldFRpbWVvdXQoYXN5bmMgKCkgPT4gew0KCQkJdHJ5IHsNCgkJCQlsZXQgZCA9IGF3YWl0IGNhbGxCYWNrKGRhdGEpOw0KCQkJCXAucmVzb2x2ZShkKTsNCgkJCX0gY2F0Y2ggKGV4KSB7DQoJCQkJdHJ5IHsNCgkJCQkJcC5yZXNvbHZlKGNhbGxCYWNrKGRhdGEpKTsNCgkJCQl9IGNhdGNoIChfZXgpIHsNCgkJCQkJY29uc29sZS5sb2coJ3Byb21pc2UgZXhjZXB0aW9uJywgX2V4KTsNCgkJCQl9DQoJCQl9DQoJCX0sIDUwMCk7DQoNCgkJcmV0dXJuIHAgPyBwLnByb21pc2UoKSA6IGRhdGE7DQoJfTsNCg0KCXRoaXMuc2VuZFhNTCA9IGFzeW5jIGZ1bmN0aW9uKHVybCwgcG9zdERhdGEsIGNhbGxCYWNrKSB7DQoJCWlmICh0eXBlb2Yod2luZG93KSAhPT0gInVuZGVmaW5lZCIgJiYgIXdpbmRvdy5TUikgd2luZG93LlNSID0gdGhpczsNCg0KCQlpZiAoKHR5cGVvZih3aW5kb3cpICE9PSAidW5kZWZpbmVkIiAmJiB3aW5kb3cualF1ZXJ5KSB8fCAodHlwZW9mKHdpbmRvdykgPT09ICJ1bmRlZmluZWQiICYmIHR5cGVvZihheGlvcykgIT09ICJ1bmRlZmluZWQiKSkgew0KCQkJbGV0IHJlcXVlc3QgPSBhd2FpdCB0aGlzLmNhY2hlUmVzdWx0KG51bGwsIG51bGwsIGNhbGxCYWNrKTsNCgkJCWlmIChyZXF1ZXN0KSB7DQoJCQkJbGV0IHJlc3VsdCA9IGF3YWl0IHRoaXMucHJvY2Vzc1Jlc3BvbnNlKA0KCQkJCQk0NCwNCgkJCQkJY2FsbEJhY2ssDQoJCQkJCXJlcXVlc3QuVGV4dFJlc3BvbnNlLA0KCQkJCQl1cmwNCgkJCQkpOw0KCQkJCXJldHVybiBhd2FpdCB0aGlzLnByb2Nlc3NSZXN1bHQocmVzdWx0KTsNCgkJCX0gZWxzZSB7DQoJCQkJLy8ganF1ZXJ5IGNhbGwNCgkJCQl2YXIgYWpheCA9IHt9Ow0KCQkJCWlmICh0aGlzLmJQb3N0IHx8IHBvc3REYXRhLmxlbmd0aCA+ICh0aGlzLm5NYXhVUkxMZW5ndGggfHwgMTAwKSkgew0KCQkJCQlhamF4LnVybCA9IHVybDsNCgkJCQkJYWpheC50eXBlID0gJ1BPU1QnOw0KCQkJCQlhamF4LmJlZm9yZVNlbmQgPSAocmVxdWVzdCkgPT4gew0KCQkJCQkJcmVxdWVzdC5zZXRSZXF1ZXN0SGVhZGVyKA0KCQkJCQkJCSdDb250ZW50LVR5cGUnLA0KCQkJCQkJCSdtdWx0aXBhcnQvZm9ybS1kYXRhOyBib3VuZGFyeT0tLS0tLS0tLS0tLS0tLScNCgkJCQkJCSk7DQoJCQkJCX07DQoJCQkJCWFqYXguZGF0YSA9DQoJCQkJCQknUE9TVERBVEE9XHJcbicgLyorICI8P3htbCB2ZXJzaW9uPVwiMS4wXCIgZW5jb2Rpbmc9XCJ1dGYtOFwiIHN0YW5kYWxvbmU9XCJ5ZXNcIj8+XHJcbiIqLyArDQoJCQkJCQlwb3N0RGF0YTsNCgkJCQl9IGVsc2Ugew0KCQkJCQlhamF4LnVybCA9IHVybCArICcmUE9TVENPREU9JyArIHRoaXMudG9IZXgocG9zdERhdGEpOw0KCQkJCQlhamF4LnR5cGUgPSAnR0VUJzsNCgkJCQl9DQoNCgkJCQlsZXQgcmV0ID0gbnVsbDsNCgkJCQlpZiAodHlwZW9mKGpRdWVyeSkgIT09ICJ1bmRlZmluZWQiKSB7DQoJCQkJCXJldCA9IGF3YWl0ICQuYWpheChhamF4KTsNCgkJCQl9IGVsc2UgaWYgKHR5cGVvZihheGlvcykgIT09ICJ1bmRlZmluZWQiKSB7DQoJCQkJCXJldCA9IGF3YWl0IGF4aW9zKGFqYXgpOw0KCQkJCQlyZXQgPSByZXQuZGF0YTsNCgkJCQl9DQoJCQkJcmV0ID0gYXdhaXQgdGhpcy5wcm9jZXNzUmVzdWx0KA0KCQkJCQl0aGlzLnByb2Nlc3NSZXNwb25zZSg0LCBjYWxsQmFjaywgcmV0LCB1cmwpDQoJCQkJKTsNCgkJCQlyZXR1cm4gcmV0Ow0KCQkJfQ0KCQl9IGVsc2Ugew0KCQkJdmFyIHhtbEhUVFAgPSB0aGlzLmdldFhtbEhUVFAoKTsNCgkJCWlmICgheG1sSFRUUCkgcmV0dXJuIGZhbHNlOw0KCQkJaWYgKGNhbGxCYWNrICE9IG51bGwpIHsNCgkJCQl3aW5kb3cueG1sSFRUUC5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBmdW5jdGlvbigpIHsNCgkJCQkJaWYgKHdpbmRvdy54bWxIVFRQLnJlYWR5U3RhdGUgPT0gNCkgew0KCQkJCQkJaWYgKCQud2hlbikgew0KCQkJCQkJCSQud2hlbigNCgkJCQkJCQkJd2luZG93LlNSLnByb2Nlc3NSZXNwb25zZSgNCgkJCQkJCQkJCXdpbmRvdy54bWxIVFRQLnJlYWR5U3RhdGUsDQoJCQkJCQkJCQljYWxsQmFjaywNCgkJCQkJCQkJCXdpbmRvdy54bWxIVFRQLnJlc3BvbnNlVGV4dCwNCgkJCQkJCQkJCXVybA0KCQkJCQkJCQkpDQoJCQkJCQkJKS50aGVuKChyZXN1bHQpID0+IHdpbmRvdy5TUi5wcm9jZXNzUmVzdWx0KHJlc3VsdCkpOw0KCQkJCQkJfSBlbHNlIHsNCgkJCQkJCQl3aW5kb3cuU1IucHJvY2Vzc1Jlc3VsdCgNCgkJCQkJCQkJd2luZG93LlNSLnByb2Nlc3NSZXNwb25zZSgNCgkJCQkJCQkJCXdpbmRvdy54bWxIVFRQLnJlYWR5U3RhdGUsDQoJCQkJCQkJCQljYWxsQmFjaywNCgkJCQkJCQkJCXdpbmRvdy54bWxIVFRQLnJlc3BvbnNlVGV4dCwNCgkJCQkJCQkJCXVybA0KCQkJCQkJCQkpDQoJCQkJCQkJKTsNCgkJCQkJCX0NCgkJCQkJfQ0KCQkJCX07DQoJCQl9DQoNCgkJCWlmICh0aGlzLmJQb3N0IHx8IHBvc3REYXRhLmxlbmd0aCA+IHRoaXMubk1heFVSTExlbmd0aCkgew0KCQkJCXdpbmRvdy54bWxIVFRQLm9wZW4oJ1BPU1QnLCB1cmwsIGNhbGxCYWNrICE9IG51bGwpOw0KCQkJCXdpbmRvdy54bWxIVFRQLnNldFJlcXVlc3RIZWFkZXIoDQoJCQkJCSdDb250ZW50LVR5cGUnLA0KCQkJCQknbXVsdGlwYXJ0L2Zvcm0tZGF0YTsgYm91bmRhcnk9LS0tLS0tLS0tLS0tLS0nDQoJCQkJKTsgLy8gZm9vbCBjcm9zcy1kb21haW4gY2hlY2tpbmcgaW4gY2hyb21lDQoJCQkJd2luZG93LnhtbEhUVFAuc2VuZCgNCgkJCQkJJ1BPU1REQVRBPVxyXG4nIC8qKyAiPD94bWwgdmVyc2lvbj1cIjEuMFwiIGVuY29kaW5nPVwidXRmLThcIiBzdGFuZGFsb25lPVwieWVzXCI/PlxyXG4iKi8gKw0KCQkJCQlwb3N0RGF0YQ0KCQkJCSk7DQoJCQl9IGVsc2Ugew0KCQkJCXhtbEhUVFAub3BlbigNCgkJCQkJJ0dFVCcsDQoJCQkJCXVybCArICcmUE9TVENPREU9JyArIHRoaXMudG9IZXgocG9zdERhdGEpLA0KCQkJCQljYWxsQmFjayAhPSBudWxsDQoJCQkJKTsNCgkJCQl4bWxIVFRQLnNlbmQobnVsbCk7DQoJCQl9DQoNCgkJCWlmIChjYWxsQmFjayA9PSBudWxsICYmIHhtbEhUVFAucmVhZHlTdGF0ZSA9PSA0KSB7DQoJCQkJdmFyIF91cmwgPSB1cmwgKyAnJlBPU1RDT0RFPScgKyB0aGlzLnRvSGV4KHBvc3REYXRhKTsNCgkJCQlpZiAoJC53aGVuKSB7DQoJCQkJCXJldHVybiAkLndoZW4oDQoJCQkJCQl0aGlzLnByb2Nlc3NSZXNwb25zZSgNCgkJCQkJCQl4bWxIVFRQLnJlYWR5U3RhdGUsDQoJCQkJCQkJY2FsbEJhY2ssDQoJCQkJCQkJeG1sSFRUUC5yZXNwb25zZVRleHQsDQoJCQkJCQkJX3VybA0KCQkJCQkJKQ0KCQkJCQkpLnRoZW4oKHJlc3VsdCkgPT4gew0KCQkJCQkJcmV0dXJuIHRoaXMucHJvY2Vzc1Jlc3VsdChyZXN1bHQpOw0KCQkJCQl9KTsNCgkJCQl9IGVsc2Ugew0KCQkJCQl0aGlzLnByb2Nlc3NSZXN1bHQoDQoJCQkJCQl0aGlzLnByb2Nlc3NSZXNwb25zZSgNCgkJCQkJCQl4bWxIVFRQLnJlYWR5U3RhdGUsDQoJCQkJCQkJY2FsbEJhY2ssDQoJCQkJCQkJeG1sSFRUUC5yZXNwb25zZVRleHQsDQoJCQkJCQkJX3VybA0KCQkJCQkJKQ0KCQkJCQkpOw0KCQkJCX0NCgkJCX0NCgkJfQ0KCX07DQoNCgl0aGlzLl91cmwgPSBmdW5jdGlvbihmdW4sIGZpbGVuYW1lKSB7DQoJCXZhciBhcmdzID0gQXJyYXkoKTsNCgkJZm9yICh2YXIgaSA9IDI7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsNCgkJCWFyZ3NbaSAtIDJdID0gYXJndW1lbnRzW2ldOw0KCQl9DQoJCXZhciBwb3N0RGF0YSA9IHRoaXMucGFyYW0oYXJncyk7DQoNCgkJdmFyIF9hcmdzID0gJyc7DQoJCWZvciAodmFyIGkgPSAyOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7DQoJCQlfYXJncyArPSAnJnAnICsgKGkgLSAyKSArICc9JyArIGFyZ3VtZW50c1tpXTsNCgkJfQ0KDQoJCWlmIChmdW4uaW5kZXhPZignLicpIDwgMCkgew0KCQkJZnVuID0gdGhpcy5zeXN0ZW1OYW1lICsgJy4nICsgZnVuOw0KCQl9DQoNCgkJcmV0dXJuICgNCgkJCXRoaXMuc3JVUkwgKw0KCQkJJyZuYW1lPScgKw0KCQkJZnVuICsNCgkJCScmcmFuZD0nICsNCgkJCU1hdGgucmFuZG9tKCkgKw0KCQkJLy8rIF9hcmdzDQoJCQknJlBPU1RDT0RFPScgKw0KCQkJdGhpcy50b0hleChwb3N0RGF0YSkgKw0KCQkJKGZpbGVuYW1lID8gJyZmaWxlbmFtZT0nICsgZmlsZW5hbWUgOiAnJykNCgkJKTsNCgl9Ow0KDQoJdGhpcy5fanNvbiA9IGZ1bmN0aW9uKGZ1bikgew0KCQl2YXIgYXJncyA9IEFycmF5KCk7DQoJCWZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7DQoJCQlhcmdzW2kgLSAxXSA9IGFyZ3VtZW50c1tpXTsNCgkJfQ0KCQlpZiAoZnVuLmluZGV4T2YoJy4nKSA8IDApIHsNCgkJCWZ1biA9IHRoaXMuc3lzdGVtTmFtZSArICcuJyArIGZ1bjsNCgkJfQ0KCQlyZXR1cm4gKA0KCQkJdGhpcy5zclVSTCArDQoJCQknJm5hbWU9JyArDQoJCQlmdW4gKw0KCQkJJyZyYW5kPScgKw0KCQkJTWF0aC5yYW5kb20oKSArDQoJCQknJmpzb249Y2xlYW4mUE9TVENPREU9JyArDQoJCQl0aGlzLnRvSGV4KHRoaXMucGFyYW0oYXJncykpDQoJCSk7DQoJfTsNCg0KCXRoaXMubXlSZXBsYWNlID0gZnVuY3Rpb24ocywgZmMsIHJjKSB7DQoJCWlmICh0eXBlb2YgcyAhPT0gJ3N0cmluZycpIHJldHVybiBzOw0KDQoJCXZhciByZXQgPSAnJzsNCgkJZm9yICh2YXIgaSA9IDA7IGkgPCBzLmxlbmd0aDsgaSsrKSB7DQoJCQl2YXIgcnMgPSBzLmNoYXJBdChpKTsNCgkJCWZvciAodmFyIGogPSAwOyBqIDwgZmMubGVuZ3RoOyBqKyspIHsNCgkJCQlpZiAocy5jaGFyQXQoaSkgPT0gZmNbal0pIHsNCgkJCQkJcnMgPSBzLmNoYXJBdChpKS5yZXBsYWNlKGZjW2pdLCByY1tqXSk7DQoJCQkJfQ0KCQkJfQ0KCQkJcmV0ICs9IHJzOw0KCQl9DQoJCXJldHVybiByZXQ7DQoJfTsNCg0KCXRoaXMucnVuQ29kZSA9IGZ1bmN0aW9uKGNzQ29kZSwganNDb2RlLCBwWE1MLCBjYWxsQmFjaykgew0KCQkvLyBhdm9pZCB1c2luZyB0aGlzIHBsZWFzZQ0KCQl2YXIgcG9zdERhdGEgPSAnU3RvcmVkTWV0aG9kIG0gPSBuZXcgU3RvcmVkTWV0aG9kKCk7JyArIHRoaXMuQ1JOTDsNCgkJcG9zdERhdGEgKz0NCgkJCSdtLkJvZHlDb2RlID0gIicgKw0KCQkJdGhpcy5teVJlcGxhY2UoY3NDb2RlLCBbJyInLCAnXHInLCAnXG4nXSwgWydcXCInLCAnXFxyJywgJ1xcbiddKSArDQoJCQknIjsnICsNCgkJCXRoaXMuQ1JOTDsNCgkJcG9zdERhdGEgKz0NCgkJCSdtLlJldHVybkNvZGUgPSAiJyArDQoJCQl0aGlzLm15UmVwbGFjZShqc0NvZGUsIFsnIicsICdccicsICdcbiddLCBbJ1xcIicsICdcXHInLCAnXFxuJ10pICsNCgkJCSciOycgKw0KCQkJdGhpcy5DUk5MOw0KCQlwb3N0RGF0YSArPSAnbS5BY3RpdmUgPSB0cnVlOycgKyB0aGlzLkNSTkw7DQoJCXBvc3REYXRhICs9ICdtLk9iamVjdFJldHVybiA9IGZhbHNlOycgKyB0aGlzLkNSTkw7DQoJCXBvc3REYXRhICs9ICdtLlNpZ25hdHVyZSA9ICJzdHJpbmcgbmFtZSI7JyArIHRoaXMuQ1JOTDsNCgkJcG9zdERhdGEgKz0gJ3JldHVybiBuZXcgb2JqZWN0W117bSwgQCInICsgcFhNTCArICcifTsnICsgdGhpcy5DUk5MOw0KDQoJCXRoaXMuc2VuZFhNTCh0aGlzLnNyVVJMICsgJyZjb2RlPXRydWUnLCBwb3N0RGF0YSwgY2FsbEJhY2spOw0KCX07DQoNCgl0aGlzLkdldCA9IGZ1bmN0aW9uKHVybCwgY2FsbEJhY2spIHsNCgkJaWYgKCFjYWxsQmFjaykgew0KCQkJLy8gc3luY2hyb25vdXMgbW9kZQ0KCQkJaWYgKCF3aW5kb3cualF1ZXJ5KSB7DQoJCQkJLy8gbm8ganF1ZXJ5DQoJCQl9IGVsc2Ugew0KCQkJCXJldHVybiB0aGlzLnByb21pc2UoDQoJCQkJCW51bGwsDQoJCQkJCSQuYWpheCh7DQoJCQkJCQl0eXBlOiAnR0VUJywNCgkJCQkJCXVybDogdXJsLA0KCQkJCQkJYXN5bmM6IGZhbHNlLA0KCQkJCQkJcHJvY2Vzc0RhdGE6IGZhbHNlLA0KCQkJCQl9KQ0KCQkJCSk7DQoJCQl9DQoJCX0gZWxzZSB7DQoJCQkvLyBzeW5jaHJvbm91cyBtb2RlDQoJCQlpZiAoIXdpbmRvdy5qUXVlcnkpIHsNCgkJCQkvLyBubyBqcXVlcnkNCgkJCX0gZWxzZSB7DQoJCQkJJC5hamF4KHsNCgkJCQkJdHlwZTogJ0dFVCcsDQoJCQkJCXVybDogdXJsLA0KCQkJCQlwcm9jZXNzRGF0YTogZmFsc2UsDQoJCQkJCXN1Y2Nlc3M6IChkYXRhKSA9PiBjYWxsQmFjayhkYXRhKSwNCgkJCQkJZXJyb3I6IChlcnIpID0+IGNhbGxCYWNrKG51bGwpLA0KCQkJCX0pOw0KCQkJfQ0KCQl9DQoJfTsNCg0KCXRoaXMuUG9zdCA9IGZ1bmN0aW9uKA0KCQl1cmwsDQoJCWNhbGxCYWNrLA0KCQlwb3N0RGF0YSwNCgkJaGVhZGVycywNCgkJdXNlcm5hbWUsDQoJCXBhc3N3b3JkLA0KCQljb250ZW50VHlwZQ0KCSkgew0KCQl2YXIgeG1sSFRUUCA9IHRoaXMuZ2V0WG1sSFRUUCgpOw0KDQoJCWlmICh4bWxIVFRQKSB7DQoJCQl4bWxIVFRQLm9wZW4oJ1BPU1QnLCB1cmwsIHRydWUpOw0KCQkJeG1sSFRUUC53aXRoQ3JlZGVudGlhbHMgPSAndHJ1ZSc7DQoJCQlpZiAoY3Jvc3NEb21haW4pDQoJCQkJeG1sSFRUUC5zZXRSZXF1ZXN0SGVhZGVyKA0KCQkJCQknQWNjZXNzLUNvbnRyb2wtQWxsb3ctT3JpZ2luJywNCgkJCQkJbG9jYXRpb24ub3JpZ2luDQoJCQkJKTsNCgkJCWlmIChjb250ZW50VHlwZSkNCgkJCQl4bWxIVFRQLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsIGNvbnRlbnRUeXBlKTsNCgkJCWlmICh1c2VybmFtZSkNCgkJCQl4bWxIVFRQLnNldFJlcXVlc3RIZWFkZXIoDQoJCQkJCSdBdXRob3JpemF0aW9uJywNCgkJCQkJJ0Jhc2ljICcgKyBidG9hKCd1c2VybmFtZTpwYXNzd29yZCcpDQoJCQkJKTsNCg0KCQkJaWYgKGhlYWRlcnMpDQoJCQkJZm9yICh2YXIgaSA9IDA7IGkgPCBoZWFkZXJzLmxlbmd0aDsgaSsrKQ0KCQkJCQl4bWxIVFRQLnNldFJlcXVlc3RIZWFkZXIoaGVhZGVyc1tpXS5rZXksIGhlYWRlcnNbaV0udmFsdWUpOw0KDQoJCQl4bWxIVFRQLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uKCkgew0KCQkJCWlmICh3aW5kb3cueG1sSFRUUC5yZWFkeVN0YXRlID09IDQgJiYgY2FsbEJhY2spIHsNCgkJCQkJY2FsbEJhY2sod2luZG93LnhtbEhUVFAucmVzcG9uc2VUZXh0KTsNCgkJCQl9DQoJCQl9Ow0KCQkJeG1sSFRUUC5zZW5kKHBvc3REYXRhKTsNCgkJfQ0KCX07DQoNCgl0aGlzLmhhc2hDb2RlID0gZnVuY3Rpb24ocykgew0KCQl2YXIgaGFzaCA9IDAsDQoJCQlpLA0KCQkJY2hyLA0KCQkJbGVuOw0KCQlpZiAocy5sZW5ndGggPT0gMCkgcmV0dXJuIGhhc2g7DQoJCWZvciAoaSA9IDAsIGxlbiA9IHMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsNCgkJCWNociA9IHMuY2hhckNvZGVBdChpKTsNCgkJCWhhc2ggPSAoaGFzaCA8PCA1KSAtIGhhc2ggKyBjaHI7DQoJCQloYXNoIHw9IDA7IC8vIENvbnZlcnQgdG8gMzJiaXQgaW50ZWdlcg0KCQl9DQoJCXJldHVybiBoYXNoOw0KCX07DQoNCgl0aGlzLnRvSGV4ID0gZnVuY3Rpb24ocykgew0KCQlpZiAodHlwZW9mIHMgIT09ICdzdHJpbmcnKSByZXR1cm4gczsNCg0KCQlyZXR1cm4gcy5zcGxpdCgiIikubWFwKHggPT4gKDI1NiArIHguY2hhckNvZGVBdCgpKS50b1N0cmluZygxNikuc3Vic3RyKC0yKSkuam9pbigiIik7DQoJfTsNCg0KCXRoaXMuYXNjaWlfdmFsdWUgPSBmdW5jdGlvbihjKSB7DQoJCS8vIHJlc3RyaWN0IGlucHV0IHRvIGEgc2luZ2xlIGNoYXJhY3Rlcg0KCQljID0gYy5jaGFyQXQoMCk7DQoNCgkJLy8gbG9vcCB0aHJvdWdoIGFsbCBwb3NzaWJsZSBBU0NJSSB2YWx1ZXMNCgkJdmFyIGk7DQoJCWZvciAoaSA9IDA7IGkgPCAyNTY7ICsraSkgew0KCQkJLy8gY29udmVydCBpIGludG8gYSAyLWRpZ2l0IGhleCBzdHJpbmcNCgkJCXZhciBoID0gaS50b1N0cmluZygxNik7DQoJCQlpZiAoaC5sZW5ndGggPT0gMSkgaCA9ICcwJyArIGg7DQoNCgkJCS8vIGluc2VydCBhICUgY2hhcmFjdGVyIGludG8gdGhlIHN0cmluZw0KCQkJaCA9ICclJyArIGg7DQoNCgkJCS8vIGRldGVybWluZSB0aGUgY2hhcmFjdGVyIHJlcHJlc2VudGVkIGJ5IHRoZSBlc2NhcGUgY29kZQ0KCQkJaCA9IHVuZXNjYXBlKGgpOw0KDQoJCQkvLyBpZiB0aGUgY2hhcmFjdGVycyBtYXRjaCwgd2UndmUgZm91bmQgdGhlIEFTQ0lJIHZhbHVlDQoJCQlpZiAoaCA9PSBjKSBicmVhazsNCgkJfQ0KCQlyZXR1cm4gaTsNCgl9Ow0KDQoJLyoqDQoJICogRGF0ZSBGdW5jdGlvbnMNCgkgKi8NCgl0aGlzLmRheXNEaWZmID0gZnVuY3Rpb24oZDIsIGQxKSB7DQoJCXJldHVybiBNYXRoLmNlaWwoKGQyLmdldFRpbWUoKSAtIGQxLmdldFRpbWUoKSkgLyAoMTAwMCAqIDYwICogNjAgKiAyNCkpOw0KCX07DQoNCgl0aGlzLmFkZE1TZWNvbmRzID0gZnVuY3Rpb24obywgbXMpIHsNCgkJcmV0dXJuIG5ldyBEYXRlKG8uZ2V0VGltZSgpICsgbXMpOw0KCX07DQoNCgl0aGlzLmFkZFNlY29uZHMgPSBmdW5jdGlvbihvLCBzKSB7DQoJCXJldHVybiB0aGlzLmFkZE1TZWNvbmRzKG8sIHMgKiAxMDAwKTsNCgl9Ow0KDQoJdGhpcy5hZGRNaW51dGVzID0gZnVuY3Rpb24obywgbSkgew0KCQlyZXR1cm4gdGhpcy5hZGRTZWNvbmRzKG8sIG0gKiA2MCk7DQoJfTsNCg0KCXRoaXMuYWRkSG91cnMgPSBmdW5jdGlvbihvLCBoKSB7DQoJCXJldHVybiB0aGlzLmFkZE1pbnV0ZXMobywgaCAqIDYwKTsNCgl9Ow0KDQoJdGhpcy5hZGREYXlzID0gZnVuY3Rpb24obywgZCkgew0KCQlyZXR1cm4gdGhpcy5hZGRIb3VycyhvLCBkICogMjQpOw0KCX07DQoNCgl0aGlzLmFkZFllYXJzID0gZnVuY3Rpb24obywgeSkgew0KCQlyZXR1cm4gdGhpcy5hZGRNb250aHMobywgeSAqIDEyKTsNCgl9Ow0KDQoJdGhpcy5hZGRNb250aHMgPSBmdW5jdGlvbihvLCBtKSB7DQoJCXJldHVybiBuZXcgRGF0ZSgNCgkJCW8uZ2V0RnVsbFllYXIoKSwNCgkJCW8uZ2V0TW9udGgoKSArIG0sDQoJCQlvLmdldERhdGUoKSwNCgkJCW8uZ2V0SG91cnMoKSwNCgkJCW8uZ2V0TWludXRlcygpLA0KCQkJby5nZXRTZWNvbmRzKCkNCgkJKTsNCgl9Ow0KDQoJdGhpcy5pc0RhdGUgPSBmdW5jdGlvbihvKSB7DQoJCXJldHVybiAoDQoJCQlvICE9IG51bGwgJiYNCgkJCW8uY29uc3RydWN0b3IgIT0gbnVsbCAmJg0KCQkJby5jb25zdHJ1Y3Rvci50b1N0cmluZygpLmluZGV4T2YoJ2Z1bmN0aW9uIERhdGUoJykgPiAtMQ0KCQkpOw0KCX07DQoNCgl0aGlzLnRvU2hvcnREYXRlID0gZnVuY3Rpb24obykgew0KCQlpZiAoIXRoaXMuaXNEYXRlKG8pKSByZXR1cm4gJyc7IC8vIGF2b2lkIG51bGxzDQoJCXJldHVybiBvLmdldE1vbnRoKCkgKyAxICsgJy8nICsgby5nZXREYXRlKCkgKyAnLycgKyBvLmdldEZ1bGxZZWFyKCk7DQoJfTsNCg0KCXRoaXMudG9TaG9ydFRpbWUgPSBmdW5jdGlvbihvKSB7DQoJCWlmICghdGhpcy5pc0RhdGUobykpIHJldHVybiAnJzsgLy8gYXZvaWQgbnVsbHMNCgkJdmFyIGhvdXJzID0gJycgKyBvLmdldEhvdXJzKCk7IC8vby5nZXRIb3VycygpJTEyOw0KCQl2YXIgbWludXRlcyA9ICcnICsgby5nZXRNaW51dGVzKCk7DQoJCXZhciBzZWNvbmRzID0gJycgKyBvLmdldFNlY29uZHMoKTsNCgkJaWYgKGhvdXJzLmxlbmd0aCA8IDIpIGhvdXJzID0gJzAnICsgaG91cnM7DQoJCWlmIChtaW51dGVzLmxlbmd0aCA8IDIpIG1pbnV0ZXMgPSAnMCcgKyBtaW51dGVzOw0KCQlpZiAoc2Vjb25kcy5sZW5ndGggPCAyKSBzZWNvbmRzID0gJzAnICsgc2Vjb25kczsNCgkJcmV0dXJuIGhvdXJzICsgJzonICsgbWludXRlcyArICc6JyArIHNlY29uZHM7IC8vICsgIiAiICsgKG8uZ2V0SG91cnMoKT49MTI/IlBNIjoiQU0iKTsNCgl9Ow0KDQoJdGhpcy50b0RhdGVUaW1lID0gZnVuY3Rpb24obykgew0KCQlpZiAoIXRoaXMuaXNEYXRlKG8pKSByZXR1cm4gJyc7IC8vIGF2b2lkIG51bGxzDQoJCXJldHVybiB0aGlzLnRvU2hvcnREYXRlKG8pICsgJyAnICsgdGhpcy50b1Nob3J0VGltZShvKTsNCgl9Ow0KCS8qKg0KCSAqIEVORDogRGF0ZSBGdW5jdGlvbnMNCgkgKi8NCg0KCXRoaXMuc2V0UHJvcGVydHkgPSBmdW5jdGlvbihjaWQsIHMsIHByb3AsIGRlZikgew0KCQlpZiAoIWNpZCkgcmV0dXJuOw0KCQl2YXIgbyA9ICQoY2lkKTsNCgkJaWYgKCFvKSByZXR1cm47DQoNCgkJaWYgKCFwcm9wKSB7DQoJCQlpZiAoby50YWdOYW1lID09ICdJTlBVVCcpIHsNCgkJCQlwcm9wID0gJ3ZhbHVlJzsNCgkJCQlpZiAoby50eXBlID09ICd0ZXh0JykgcHJvcCA9ICd2YWx1ZSc7DQoJCQkJaWYgKG8udHlwZSA9PSAnY2hlY2tib3gnKSBwcm9wID0gJ2NoZWNrZWQnOw0KCQkJfSBlbHNlIHsNCgkJCQlwcm9wID0gJ2lubmVySFRNTCc7DQoJCQl9DQoJCX0NCgkJaWYgKCFkZWYpIGRlZiA9ICcnOw0KCQlpZiAodGhpcy5wcmVQcm9jZXNzSFRNTCkgZGVmID0gdGhpcy5wcmVQcm9jZXNzSFRNTChkZWYpOw0KDQoJCWlmICh0aGlzLmlzRGF0ZShzKSkgew0KCQkJLy8gYSBkYXRlIGZpZWxkDQoJCQlzID0gdGhpcy50b1Nob3J0RGF0ZShzKTsNCgkJfSBlbHNlIHsNCgkJCWlmICh0aGlzLnByZVByb2Nlc3NIVE1MKSBzID0gdGhpcy5wcmVQcm9jZXNzSFRNTChzKTsNCgkJfQ0KDQoJCXdpbmRvdy5wcm9wZXJ0eVZhbHVlID0gczsNCgkJdHJ5IHsNCgkJCXRoaXMucnVuU2NyaXB0KA0KCQkJCSIkKCciICsgby5pZCArICInKS4iICsgcHJvcCArICcgPSB3aW5kb3cucHJvcGVydHlWYWx1ZTsnDQoJCQkpOw0KCQl9IGNhdGNoIChlKSB7DQoJCQl0aGlzLlNob3dFcnJvcihlLm1lc3NhZ2UpOw0KCQkJdGhpcy5ydW5TY3JpcHQoIiQoJyIgKyBvLmlkICsgIicpLiIgKyBwcm9wICsgJyA9ICInICsgZGVmICsgJyI7Jyk7DQoJCX0NCgkJd2luZG93LnByb3BlcnR5VmFsdWUgPSBudWxsOw0KCX07DQoNCgkvKioNCgkgKiBWYWxpZGF0aW9uDQoJICovDQoJdGhpcy52YWxpZE5vdE51bGwgPSBmdW5jdGlvbihzKSB7DQoJCWlmICh0eXBlb2YgcyA9PSAnc3RyaW5nJykgew0KCQkJcmV0dXJuIHMgJiYgcy5sZW5ndGggPiAwOw0KCQl9IGVsc2Ugew0KCQkJcmV0dXJuIHMgIT0gbnVsbDsNCgkJfQ0KCX07DQoNCgl0aGlzLnZhbGlkT2JqZWN0ID0gZnVuY3Rpb24obykgew0KCQlyZXR1cm4gbyAhPSBudWxsOw0KCX07DQoNCgl0aGlzLnZhbGlkRW1haWwgPSBmdW5jdGlvbihzdHIpIHsNCgkJdmFyIGF0ID0gJ0AnOw0KCQl2YXIgZG90ID0gJy4nOw0KCQl2YXIgbGF0ID0gc3RyLmluZGV4T2YoYXQpOw0KCQl2YXIgbHN0ciA9IHN0ci5sZW5ndGg7DQoJCXZhciBsZG90ID0gc3RyLmluZGV4T2YoZG90KTsNCgkJaWYgKA0KCQkJc3RyLmluZGV4T2YoYXQpID09IC0xIHx8DQoJCQlzdHIuaW5kZXhPZihhdCkgPT0gLTEgfHwNCgkJCXN0ci5pbmRleE9mKGF0KSA9PSAwIHx8DQoJCQlzdHIuaW5kZXhPZihhdCkgPT0gbHN0ciB8fA0KCQkJc3RyLmluZGV4T2YoZG90KSA9PSAtMSB8fA0KCQkJc3RyLmluZGV4T2YoZG90KSA9PSAwIHx8DQoJCQlzdHIuaW5kZXhPZihkb3QpID09IGxzdHIgfHwNCgkJCXN0ci5pbmRleE9mKGF0LCBsYXQgKyAxKSAhPSAtMSB8fA0KCQkJc3RyLnN1YnN0cmluZyhsYXQgLSAxLCBsYXQpID09IGRvdCB8fA0KCQkJc3RyLnN1YnN0cmluZyhsYXQgKyAxLCBsYXQgKyAyKSA9PSBkb3QgfHwNCgkJCXN0ci5pbmRleE9mKGRvdCwgbGF0ICsgMikgPT0gLTEgfHwNCgkJCXN0ci5pbmRleE9mKCcgJykgIT0gLTENCgkJKSB7DQoJCQlyZXR1cm4gZmFsc2U7DQoJCX0gZWxzZSB7DQoJCQlyZXR1cm4gdHJ1ZTsNCgkJfQ0KCX07DQoNCgl0aGlzLnZhbGlkYXRlID0gZnVuY3Rpb24obywgdHlwZSwgY29uZmlnKSB7DQoJCWlmICh0eXBlb2YgbyA9PSAnc3RyaW5nJykgbyA9ICQobyk7DQoJCXZhciBiQWxlcnQgPSB0cnVlOw0KCQlpZiAoIW8pIHJldHVybjsNCg0KCQlpZiAoIWNvbmZpZykgY29uZmlnID0ge307DQoJCXZhciBvRXJyID0gJChvLmlkICsgJ19FcnJvcicpOw0KCQlpZiAoIW9FcnIgJiYgZG9jdW1lbnQuaW5zZXJ0QWRqYWNlbnRFbGVtZW50KSB7DQoJCQliQWxlcnQgPSBmYWxzZTsNCgkJCW9FcnIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdTUEFOJyk7DQoJCQlvRXJyLmlkID0gby5pZCArICdfRXJyb3InOw0KCQkJb0Vyci5jbGFzc05hbWUgPSAnZXJyb3InOw0KCQkJby5pbnNlcnRBZGphY2VudEVsZW1lbnQoJ2FmdGVyRW5kJywgb0Vycik7DQoJCX0NCg0KCQlpZiAoIWNvbmZpZ1snZmllbGQnXSkgew0KCQkJdmFyIHRhZyA9IG8udGFnTmFtZS50b0xvd2VyQ2FzZSgpOw0KCQkJaWYgKA0KCQkJCSh0YWcgPT0gJ3NwYW4nIHx8IHRhZyA9PSAnYScpICYmDQoJCQkJKG8uZ2V0QXR0cmlidXRlKCdmcm9tJykgfHwgby5nZXRBdHRyaWJ1dGUoJ2xvb2t1cCcpKQ0KCQkJKSB7DQoJCQkJY29uZmlnWydmaWVsZCddID0gJ1NlbGVjdGVkSXRlbSc7DQoJCQkJdHlwZSA9ICdPYmplY3QnOw0KCQkJfSBlbHNlIHsNCgkJCQljb25maWdbJ2ZpZWxkJ10gPSAndmFsdWUnOw0KCQkJfQ0KCQl9DQoJCWlmICghdHlwZSkgdHlwZSA9ICdOb3ROdWxsJzsNCg0KCQlpZiAoIWNvbmZpZ1snbGFiZWwnXSkgew0KCQkJdmFyIHRpdGxlID0gby5nZXRBdHRyaWJ1dGUoJ3RpdGxlJyk7DQoJCQlpZiAoIXRpdGxlKSB7DQoJCQkJdGl0bGUgPSBvLmlkLnNwbGl0KCdfJyk7DQoJCQkJdGl0bGUgPSB0aXRsZVsxXTsNCgkJCQl0aXRsZSA9IHRpdGxlLnN1YnN0cigzKTsNCgkJCQl0aXRsZSA9IHRoaXMuRW5nbGlzaE5hbWUodGl0bGUpOw0KCQkJfQ0KCQkJY29uZmlnWydsYWJlbCddID0gdGl0bGU7DQoJCX0NCgkJaWYgKCFjb25maWdbJ21lc3NhZ2UnXSkgY29uZmlnWydtZXNzYWdlJ10gPSAnSW52YWxpZCBWYWx1ZSc7DQoNCgkJdmFyIGJWYWxpZCA9IHRydWU7DQoJCXdpbmRvdy52YWxpZGF0aW9uVmFsdWUgPSB3aW5kb3cuY21zLnYobyk7IC8vW2NvbmZpZ1siZmllbGQiXV07Ly92YWx1ZQ0KCQliVmFsaWQgPQ0KCQkJYlZhbGlkICYmDQoJCQl0aGlzLnJ1blNjcmlwdCgNCgkJCQknd2luZG93LmNtcy5zci52YWxpZCcgKyB0eXBlICsgJyh3aW5kb3cudmFsaWRhdGlvblZhbHVlKScNCgkJCSk7DQoJCXdpbmRvdy52YWxpZGF0aW9uVmFsdWUgPSBudWxsOw0KDQoJCWlmICghYlZhbGlkKSB7DQoJCQkvL28udmFsdWUgPSAiIjsNCgkJCS8vby5mb2N1cygpOw0KCQkJc01lc3NhZ2UgPSBjb25maWdbJ21lc3NhZ2UnXTsNCgkJfSBlbHNlIHsNCgkJCXNNZXNzYWdlID0gJyc7DQoJCX0NCg0KCQlpZiAoIWJWYWxpZCkgew0KCQkJaWYgKGJBbGVydCkgew0KCQkJCXRoaXMuc19FcnJvck1lc3NhZ2VzICs9DQoJCQkJCSdcbicgKyBjb25maWdbJ2xhYmVsJ10gKyAnOiAnICsgc01lc3NhZ2U7DQoJCQl9IGVsc2Ugew0KCQkJCW9FcnIuaW5uZXJIVE1MID0gc01lc3NhZ2U7DQoJCQl9DQoJCX0NCgl9Ow0KCS8qKg0KCSAqIEVORDogVmFsaWRhdGlvbg0KCSAqLw0KDQoJdGhpcy5FbmdsaXNoTmFtZSA9IGZ1bmN0aW9uKHMpIHsNCgkJcmV0dXJuIHMucmVwbGFjZSgvXlthLXpdfFtBLVpdL2csICh2LCBpKSA9PiBpID09PSAwID8gdi50b1VwcGVyQ2FzZSgpIDogIiAiICsgdi50b0xvd2VyQ2FzZSgpKTsNCg0KCQl2YXIgcmV0ID0gJyc7DQoJCWZvciAodmFyIGkgPSAwOyBpIDwgcy5sZW5ndGg7IGkrKykgew0KCQkJaWYgKHNbaV0gPj0gJ0EnICYmIHNbaV0gPD0gJ1onKSB7DQoJCQkJcmV0ICs9IChyZXQubGVuZ3RoID09IDAgPyAnJyA6ICcgJykgKyBzW2ldOw0KCQkJfSBlbHNlIGlmIChyZXQubGVuZ3RoID09IDApIHsNCgkJCQlyZXQgKz0gKHNbaV0gKyAnJykudG9VcHBlckNhc2UoKTsNCgkJCX0gZWxzZSB7DQoJCQkJcmV0ICs9IHNbaV07DQoJCQl9DQoJCX0NCg0KCQlyZXR1cm4gcmV0Ow0KCX07DQoNCgkvKiogT2JqZWN0IENvbXBhcmlzb24gKiovDQoJdGhpcy5uZXdPYmplY3QgPSBmdW5jdGlvbigpIHsNCgkJdmFyIHJldCA9IG5ldyBPYmplY3QoKTsNCgkJcmV0Ll9fT0JKRUNUSUQgPSBNYXRoLnJhbmRvbSgpOw0KCQlyZXR1cm4gcmV0Ow0KCX07DQoNCgl0aGlzLkVxdWFscyA9IGZ1bmN0aW9uKG8xLCBvMikgew0KCQlpZiAobzEgPT0gbzIpIHJldHVybiB0cnVlOw0KDQoJCWlmICgNCgkJCW8xICYmDQoJCQlvMS5fX09CSkVDVElEICYmDQoJCQlvMiAmJg0KCQkJbzIuX19PQkpFQ1RJRCAmJg0KCQkJbzEuX19PQkpFQ1RJRCA9PSBvMi5fX09CSkVDVElEDQoJCSkNCgkJCXJldHVybiB0cnVlOw0KCQlpZiAobzEgJiYgbzEuX19ST1dJRCAmJiBvMiAmJiBvMi5fX1JPV0lEICYmIG8xLl9fUk9XSUQgPT0gbzIuX19ST1dJRCkNCgkJCXJldHVybiB0cnVlOw0KCQlpZiAobzEgJiYgbzEuSWQgJiYgbzIgJiYgbzIuSWQgJiYgbzEuSWQgPT0gbzIuSWQpIHJldHVybiB0cnVlOw0KDQoJCXJldHVybiBmYWxzZTsNCgl9Ow0KCS8qKiBPYmplY3QgQ29tcGFyaXNvbiAqKi8NCg0KCXRoaXMuc2VyaWFsaXplID0gZnVuY3Rpb24oX29iaikgew0KCQl0cnkgew0KCQkJLy8gTGV0IEdlY2tvIGJyb3dzZXJzIGRvIHRoaXMgdGhlIGVhc3kgd2F5DQoJCQlpZiAoDQoJCQkJdHlwZW9mIF9vYmoudG9Tb3VyY2UgIT09ICd1bmRlZmluZWQnICYmDQoJCQkJdHlwZW9mIF9vYmouY2FsbGVlID09PSAndW5kZWZpbmVkJw0KCQkJKSB7DQoJCQkJcmV0dXJuIF9vYmoudG9Tb3VyY2UoKTsNCgkJCX0NCgkJCS8vIE90aGVyIGJyb3dzZXJzIG11c3QgZG8gaXQgdGhlIGhhcmQgd2F5DQoJCQlzd2l0Y2ggKHR5cGVvZiBfb2JqKSB7DQoJCQkJLy8gbnVtYmVycywgYm9vbGVhbnMsIGFuZCBmdW5jdGlvbnMgYXJlIHRyaXZpYWw6DQoJCQkJLy8ganVzdCByZXR1cm4gdGhlIG9iamVjdCBpdHNlbGYgc2luY2UgaXRzIGRlZmF1bHQgLnRvU3RyaW5nKCkNCgkJCQkvLyBnaXZlcyB1cyBleGFjdGx5IHdoYXQgd2Ugd2FudA0KCQkJCWNhc2UgJ251bWJlcic6DQoJCQkJY2FzZSAnYm9vbGVhbic6DQoJCQkJY2FzZSAnZnVuY3Rpb24nOg0KCQkJCQlyZXR1cm4gX29iajsNCgkJCQkJYnJlYWs7DQoNCgkJCQkJLy8gZm9yIEpTT04gZm9ybWF0LCBzdHJpbmdzIG5lZWQgdG8gYmUgd3JhcHBlZCBpbiBxdW90ZXMNCgkJCQljYXNlICdzdHJpbmcnOg0KCQkJCQlyZXR1cm4gIiciICsgX29iaiArICInIjsNCgkJCQkJYnJlYWs7DQoNCgkJCQljYXNlICdvYmplY3QnOg0KCQkJCQl2YXIgc3RyOw0KCQkJCQlpZiAoDQoJCQkJCQlfb2JqLmNvbnN0cnVjdG9yID09PSBBcnJheSB8fA0KCQkJCQkJdHlwZW9mIF9vYmouY2FsbGVlICE9PSAndW5kZWZpbmVkJw0KCQkJCQkpIHsNCgkJCQkJCXN0ciA9ICdbJzsNCgkJCQkJCXZhciBpLA0KCQkJCQkJCWxlbiA9IF9vYmoubGVuZ3RoOw0KCQkJCQkJZm9yIChpID0gMDsgaSA8IGxlbiAtIDE7IGkrKykgew0KCQkJCQkJCXN0ciArPSB0aGlzLnNlcmlhbGl6ZShfb2JqW2ldKSArICcsJzsNCgkJCQkJCX0NCgkJCQkJCXN0ciArPSB0aGlzLnNlcmlhbGl6ZShfb2JqW2ldKSArICddJzsNCgkJCQkJfSBlbHNlIHsNCgkJCQkJCXN0ciA9ICd7JzsNCgkJCQkJCXZhciBrZXk7DQoJCQkJCQlmb3IgKGtleSBpbiBfb2JqKSB7DQoJCQkJCQkJc3RyICs9IGtleSArICc6JyArIHRoaXMuc2VyaWFsaXplKF9vYmpba2V5XSkgKyAnLCc7DQoJCQkJCQl9DQoJCQkJCQlzdHIgPSBzdHIucmVwbGFjZSgvXCwkLywgJycpICsgJ30nOw0KCQkJCQl9DQoJCQkJCXJldHVybiBzdHI7DQoJCQkJCWJyZWFrOw0KDQoJCQkJZGVmYXVsdDoNCgkJCQkJcmV0dXJuICdVTktOT1dOJzsNCgkJCQkJYnJlYWs7DQoJCQl9DQoJCX0gY2F0Y2ggKGUpIHsNCgkJCXRoaXMuU2hvd0RlYnVnKGUubWVzc2FnZSk7DQoJCX0NCgl9Ow0KfQ==",
	"__keys": ["name"],
	"active": true,
	"enabled": true,
	"__trMap": []
}