{
	"Id": "a495e79fc3316d772f0bfc6fdb9f861d7b0d0cb7",
	"name": "ServiceRouter",
	"script": "d2luZG93LlNlcnZpY2VSb3V0ZXIgPSBjbGFzcyB7CglfX3Njb3BlKHNjb3BlKSB7CgkJbGV0IHJldCA9IG51bGw7CgkJaWYgKHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJykgewoJCQlyZXQgPSB3aW5kb3c7CgkJfSBlbHNlIGlmICh0eXBlb2YoV29ya2VyR2xvYmFsU2NvcGUpICE9PSAndW5kZWZpbmVkJykgewoJCQlyZXQgPSBzZWxmOwoJCX0gZWxzZSBpZiAodHlwZW9mKGdsb2JhbCkgIT09ICd1bmRlZmluZWQnKSB7CgkJCXJldCA9IGdsb2JhbDsKCQl9CgoJCWlmIChzY29wZSkgcmV0ID0gcmV0W3Njb3BlXTsKCQlyZXR1cm4gcmV0OwoJfQoKCWJ1aWxkVVJMKHNyVVJMKSB7CgkJaWYgKCFzclVSTCkgewoJCQl0aGlzLnNyVVJMID0gdGhpcy4kX1JFUVVFU1QoJ3NyJyk7CgkJCWlmICghdGhpcy5zclVSTCkgewoJCQkJaWYgKHR5cGVvZih3aW5kb3cpID09PSAidW5kZWZpbmVkIikgewoJCQkJCWxldCBpcCA9IHRoaXMuaXBBZGRyZXNzKCk7CgkJCQkJaWYgKGlwICYmIChpcC5zdGFydHNXaXRoKCIxODIuMTY4LiIpIHx8IGlwID09ICIxOTIuMTY4LjEuMjUzIiB8fCBpcCA9PSAnMTk1LjExMi4yMTUuMjE4JykpIHsKCQkJCQkJdGhpcy5zclVSTCA9ICJodHRwOi8vMTgyLjE2OC43MC44MCI7CgkJCQkJfSBlbHNlIHsKCQkJCQkJdGhpcy5zclVSTCA9ICJodHRwOi8vYXJ6Lm5hbW1vdXIuY29tOjcwODAiOwoJCQkJCX0KCQkJCX0KCQkJCXRoaXMuc3JVUkwgKz0gJy9tZXRob2QvU2VydmljZVJvdXRlci5hc2h4JzsKCQkJfQoJCX0gZWxzZSB7CgkJCXRoaXMuc3JVUkwgPSBzclVSTDsKCQl9CgkJdGhpcy5zclVSTCArPSAnP3NydmVyc2lvbj0xJzsKCQlpZiAodGhpcy4kX1JFUVVFU1QoJ2d6aXAnKSkgewoJCQl0aGlzLnNyVVJMICs9ICcmZ3ppcD0nICsgdGhpcy4kX1JFUVVFU1QoJ2d6aXAnKTsKCQl9IGVsc2UgewoJCQl0aGlzLnNyVVJMICs9ICcmZ3ppcD10cnVlJzsKCQl9CgkJaWYgKHRoaXMuYkNhY2hlKSB7CgkJCXRoaXMuc3JVUkwgKz0gJyZjYWNoZT0nICsgdGhpcy5iQ2FjaGU7CgkJfQoJCWlmICghdGhpcy4kX1JFUVVFU1QoJ3JhbmQnLCB0aGlzLnNyVVJMKSkgewoJCQl0aGlzLnNyVVJMICs9ICcmcmFuZD0nICsgTWF0aC5yYW5kb20oKTsKCQl9CgoJCWlmICh0aGlzLmJEZWJ1ZykgewoJCQl0aGlzLnNyVVJMICs9ICcmREVCVUc9dHJ1ZSc7CgkJfQoKCQlpZiAoCgkJCXRoaXMuYkFzeW5jICYmCgkJCXRoaXMuYkxvY2FsICYmCgkJCSF0aGlzLiRfUkVRVUVTVCgnYXN5bmMnLCB0aGlzLnNyVVJMKQoJCSkgewoJCQl0aGlzLnNyVVJMICs9ICcmYXN5bmM9dHJ1ZSc7CgkJCWlmICh0aGlzLnJ1bkFmdGVyKSB7CgkJCQl0aGlzLnNyVVJMICs9ICcmcnVuYWZ0ZXI9JyArIHRoaXMucnVuQWZ0ZXI7CgkJCX0KCQkJdGhpcy5iQXN5bmMgPSBmYWxzZTsKCQl9CgoJCS8vdGhpcy5TaG93RGVidWcoJ3RoaXMuc3JVUkw9JyArIHRoaXMuc3JVUkwpOwoKCQlyZXR1cm4gdGhpcy5zclVSTDsKCX0KCglpbml0KAoJCXNyVVJMLAoJCXN5c3RlbU5hbWUsCgkJYlBvc3QsCgkJYkRlYnVnLAoJCWJTaG93RXJyb3JzLAoJCXByZVByb2Nlc3NIVE1MCgkpIHsKCQkvKmlmICh0eXBlb2YgZG9jdW1lbnQgPT09ICd1bmRlZmluZWQnKSB7CgkJCWRvY3VtZW50ID0ge307CgkJCXdpbmRvdyA9IHt9OwoJCX0qLwoJCWlmICghYkRlYnVnICYmIGRvY3VtZW50LlVSTCAmJiBkb2N1bWVudC5VUkwuaW5kZXhPZignZGVidWc9dHJ1ZScpID4gMCkgYkRlYnVnID0gdHJ1ZTsKCgkJdGhpcy5iTG9jYWwgPSAhdGhpcy5TdG9yZSAmJiBkb2N1bWVudC5VUkwgJiYgZG9jdW1lbnQuVVJMLmluZGV4T2YoJ2xvY2FsPWZhbHNlJykgPCAwICYmICF3aW5kb3cuZnJhbWVzLmxlbmd0aDsKCQlpZiAoIWRvY3VtZW50LlVSTCkgdGhpcy5iTG9jYWwgPSB0cnVlOwoKCQl0aGlzLmJDYWNoZSA9IHRoaXMuJF9SRVFVRVNUKCdjYWNoZScpOwoJCXRoaXMuYkNhY2hlUmVzdWx0ID0gdGhpcy4kX1JFUVVFU1QoJ2NhY2hlUmVzdWx0Jyk7CgoJCXRoaXMuc3JVUkwgPSB0aGlzLmJ1aWxkVVJMKHNyVVJMKTsKCgkJdGhpcy5DUk5MID0gJ1xuJzsKCQl0aGlzLm5NYXhVUkxMZW5ndGggPSAxMDA7CgoJCXRoaXMuc3lzdGVtTmFtZSA9IHN5c3RlbU5hbWU7CgoJCXRoaXMuYlBvc3QgPSBiUG9zdDsKCQl0aGlzLmJEZWJ1ZyA9IGJEZWJ1ZzsKCQl0aGlzLmJTaG93RXJyb3JzID0gYlNob3dFcnJvcnM7CgoJCXRoaXMuc19FcnJvck1lc3NhZ2VzID0gJyc7CgoJCXJldHVybiB0aGlzOwoJfQoKCXByZVByb2Nlc3NIVE1MKGh0bWwpIHsKCQlpZiAoIWh0bWwpIHJldHVybiBodG1sOwoKCQl0cnkgewoJCQl2YXIgcmV0ID0gJyc7CgkJCXZhciBwYXJ0cyA9IGh0bWwuc3BsaXQoJyQkJyk7CgkJCWZvciAodmFyIGkgPSAwOyBpIDwgcGFydHMubGVuZ3RoOyBpKyspIHsKCQkJCWlmIChpICUgMiA9PSAwKSB7CgkJCQkJcmV0ICs9IHBhcnRzW2ldOwoJCQkJCWNvbnRpbnVlOwoJCQkJfQoJCQkJdHJ5IHsKCQkJCQl2YXIgb1ZhbHVlID0gdGhpcy5ydW5TY3JpcHQocGFydHNbaV0pOwoJCQkJCWlmIChvVmFsdWUpIHsKCQkJCQkJcmV0ICs9IG9WYWx1ZTsKCQkJCQl9IGVsc2UgewoJCQkJCQlyZXQgKz0gJyc7CgkJCQkJfQoJCQkJfSBjYXRjaCAoZSkgewoJCQkJCXJldCArPSAnJzsKCQkJCX0KCQkJfQoKCQkJaWYgKHByZVByb2Nlc3NIVE1MICE9IG51bGwpIHJldCA9IHByZVByb2Nlc3NIVE1MKHJldCk7CgkJCXJldHVybiByZXQ7CgkJfSBjYXRjaCAoZSkgewoJCQlyZXR1cm4gJyc7CgkJfQoJfQoKCSRfUkVRVUVTVChrZXksIHVybCkgewoJCWlmICh0eXBlb2Yod2luZG93KSA9PT0gInVuZGVmaW5lZCIpIHJldHVybiBudWxsOwoKCQlsZXQgcmV0ID0gdW5kZWZpbmVkOwoJCWlmICh1cmwpIHsKCQkJdHJ5IHsKCQkJCXJldCA9IG5ldyBVUkwodXJsKS5zZWFyY2hQYXJhbXMuZ2V0KGtleSk7CgkJCX0gY2F0Y2ggKGV4KSB7CgkJCQl2YXIgcmVnZXggPSBuZXcgUmVnRXhwKCdbXFw/fCZdJyArIGtleSArICc9KFteJiNdKiknKTsKCQkJCXZhciByZXN1bHRzID0gcmVnZXguZXhlYygnPycgKyB1cmwuc3BsaXQoJz8nKVsxXSk7CgkJCQlyZXQgPSAocmVzdWx0cyA9PT0gbnVsbCkgPyAnJyA6IGRlY29kZVVSSUNvbXBvbmVudChyZXN1bHRzWzFdLnJlcGxhY2UoL1wrL2csICcgJykpOwoJCQl9CgkJfSBlbHNlIHsKCQkJcmV0ID0gbmV3IFVSTFNlYXJjaFBhcmFtcyh3aW5kb3cubG9jYXRpb24uc2VhcmNoKS5nZXQoa2V5KTsKCQl9CgoJCXJldHVybiByZXQgPT09IG51bGwgPyAnJyA6IHJldDsKCX0KCglncm91cEJ5KGFyLCBmaWVsZCkgewoJCWlmICghYXIgfHwgIWZpZWxkKSByZXR1cm4gbnVsbDsKCgkJdmFyIGtleXMgPSBbXTsKCQlhci5mb3JFYWNoKGEgPT4gewoJCQl2YXIga2V5ID0gbnVsbDsKCQkJZmllbGQuc3BsaXQoJy4nKS5mb3JFYWNoKGYgPT4ga2V5ID0gKGtleSB8fCBhKVtmXSk7CgkJCWxldCBrID0ga2V5cy5maW5kKGsgPT4gdGhpcy5FcXVhbHMoay5rZXksIGtleSkpOwoJCQlpZiAoaykgewoJCQkJay52YWx1ZXMucHVzaChhKTsKCQkJfSBlbHNlIHsKCQkJCWtleXMucHVzaCh7CgkJCQkJa2V5OiBrZXksCgkJCQkJdmFsdWVzOiBbYV0sCgkJCQl9KTsKCQkJfQoJCX0pOwoJCXJldHVybiBrZXlzOwoJfQoKCWNvbXBpbGUoYXJNb2R1bGVzKSB7CgkJdmFyIGNhbGxzID0gW107CgkJJC5lYWNoKGFyTW9kdWxlcywgKGksIG0pID0+CgkJCWNhbGxzLnB1c2goCgkJCQl0aGlzLl8oJ0NvbnRlbnRNYW5hZ2VyLmNtc0hUTUxQYWdlRmluZGFsbCcsIG51bGwsIHsKCQkJCQlQYWdlOiBtLAoJCQkJfSkKCQkJKQoJCSk7CgkJcmV0dXJuICQud2hlbiguLi5jYWxscykudGhlbigoLi4uYXJSZXQpID0+IHsKCQkJdmFyIF9yZXQgPSBbXTsKCQkJJC5tYXAoYXJSZXQsIChwKSA9PiB7CgkJCQlyZXQucHVzaChfLnRlbXBsYXRlKHAuSFRNTCkoc3IucnVuU2NyaXB0KHBbMF0uU2NyaXB0KSkpOwoJCQl9KTsKCQkJcmV0dXJuIF9yZXQ7CgkJfSk7Cgl9CgoJYXN5bmMgaW1wb3J0KGFyTW9kdWxlcykgewoJCXZhciByZXQgPSBbXTsKCQlmb3IgKHZhciBpID0gMDsgaSA8IGFyTW9kdWxlcy5sZW5ndGg7IGkrKykgewoJCQlsZXQgcCA9IGF3YWl0IHRoaXMuXygnQ29udGVudE1hbmFnZXIuY21zSFRNTFBhZ2VGaW5kJywgbnVsbCwgewoJCQkJUGFnZTogYXJNb2R1bGVzW2ldLAoJCQl9KTsKCQkJcmV0LnB1c2gocCk7CgkJCWF3YWl0IHRoaXMucnVuU2NyaXB0KHAuU2NyaXB0KTsKCQl9CgkJcmV0dXJuIHJldDsKCX0KCglnZXRPYmplY3QocykgewoJCXZhciBjb2RlID0gcyArICc7JzsKCQljb2RlID0gJyh0eXBlb2YgJyArIHMgKyAiID09PSAndW5kZWZpbmVkJyk/c3IubmV3T2JqZWN0KCk6IiArIHM7CgkJLy9yZXR1cm4gdGhpcy5ydW5TY3JpcHQocysiOyIpOwoJCXJldHVybiB0aGlzLnJ1blNjcmlwdChjb2RlKTsKCX0KCglydW5TY3JpcHQocykgewoJCWlmICghcykgcmV0dXJuIG51bGw7CgoJCWxldCBjTGluZXMgPSBzLnNwbGl0KCdcbicpOwoJCXRyeSB7CgkJCWlmICh0eXBlb2YoZXNwcmltYSkgIT09ICd1bmRlZmluZWQnKSB7CgkJCQllc3ByaW1hLnBhcnNlKHMsIHsKCQkJCQllczY6IHRydWUKCQkJCX0pOwoJCQl9CgkJfSBjYXRjaCAoZXgpIHsKCQkJaWYgKGNMaW5lc1tleC5saW5lTnVtYmVyIC0gMV0uaW5kZXhPZignZm9yIGF3YWl0JykgPCAwKSB7CgkJCQljb25zb2xlLmxvZygicnVuU2NyaXB0KCk6OmVzcHJpbWEgZXhjZXB0aW9uOiAiICsgZXguZGVzY3JpcHRpb24sIGV4LmxpbmVOdW1iZXIsIGNMaW5lc1tleC5saW5lTnVtYmVyIC0gMV0pOwoJCQkJLy9yZXR1cm47CgkJCX0KCQl9CgoJCWlmICh0eXBlb2Yod2luZG93KSAhPT0gInVuZGVmaW5lZCIpIHsKCQkJdHJ5IHsKCQkJCWlmICh3aW5kb3cuX2NvbnRlbnQgJiYgd2luZG93Ll9jb250ZW50LmV2YWwpIHsKCQkJCQl2YXIgb3V0cHV0ID0gd2luZG93Ll9jb250ZW50LmV2YWwocyk7CgkJCQkJcmV0dXJuIG91dHB1dDsKCQkJCX0KCQkJfSBjYXRjaCAoZSkgewoJCQkJdGhpcy5TaG93RXJyb3IoJ0ZGIFNDUklQVDogXG4nICsgZS5tZXNzYWdlICsgJ1xuJyArIHMpOwoJCQl9CgkJCXRyeSB7CgkJCQlpZiAod2luZG93LmV4ZWNTY3JpcHQpIHsKCQkJCQlpZiAocy5pbmRleE9mKCdcclxuJykgPiAwKSB7CgkJCQkJCS8vIGEgbXVsdGktbGluZSBzdGF0ZW1lbnQKCQkJCQkJd2luZG93LmV4ZWNTY3JpcHQocyk7CgkJCQkJCXJldHVybiBudWxsOwoJCQkJCX0gZWxzZSB7CgkJCQkJCS8vIGEgc2luZ2xlLWxpbmUgc3RhdGVtZW50CgkJCQkJCW5ld1YgPSBudWxsOwoJCQkJCQl2YXIgbmV3UyA9ICduZXdWID0gJyArIHM7CgkJCQkJCXdpbmRvdy5leGVjU2NyaXB0KG5ld1MpOwoJCQkJCQlyZXR1cm4gbmV3VjsKCQkJCQl9CgkJCQl9CgkJCX0gY2F0Y2ggKGUpIHsKCQkJCXRoaXMuU2hvd0Vycm9yKCdJRTYgU0NSSVBUOiBcbicgKyBlLm1lc3NhZ2UgKyAnXG4nICsgcyk7CgkJCX0KCgkJCXRyeSB7CgkJCQlpZiAod2luZG93LmV4ZWNTY3JpcHQpIHsKCQkJCQlpZiAocy5pbmRleE9mKCdcclxuJykgPiAwKSB7CgkJCQkJCS8vIGEgbXVsdGktbGluZSBzdGF0ZW1lbnQKCQkJCQkJd2luZG93LmV4ZWNTY3JpcHQocyk7CgkJCQkJCXJldHVybiBudWxsOwoJCQkJCX0gZWxzZSB7CgkJCQkJCS8vIGEgc2luZ2xlLWxpbmUgc3RhdGVtZW50CgkJCQkJCW5ld1YgPSBudWxsOwoJCQkJCQl2YXIgbmV3UyA9ICduZXdWID0gJyArIHM7CgkJCQkJCWV2YWwobmV3Uyk7CgkJCQkJCXJldHVybiBuZXdWOwoJCQkJCX0KCQkJCX0KCQkJfSBjYXRjaCAoZSkgewoJCQkJdGhpcy5TaG93RXJyb3IoJ0lFNyBTQ1JJUFQ6IFxuJyArIGUubWVzc2FnZSArICdcbicgKyBzKTsKCQkJfQoKCQkJdHJ5IHsKCQkJCXZhciBmbiA9IGZ1bmN0aW9uKCkgewoJCQkJCXZhciByZXQgPSB3aW5kb3cuZXZhbC5jYWxsKHdpbmRvdywgcyk7CgkJCQkJcmV0dXJuIHJldDsKCQkJCX07CgoJCQkJcmV0dXJuIGZuKCk7CgkJCX0gY2F0Y2ggKGUpIHsKCQkJCXRoaXMuU2hvd0Vycm9yKCdUQUcgU0NSSVBUOiBcbicgKyBlLm1lc3NhZ2UgKyAnXG4nICsgcyk7CgkJCX0KCQl9CgoJCXRyeSB7CgkJCXMgPSBzLnJlcGxhY2UoL25ldyBEYXRlXCgwMDAxL2csICduZXcgRGF0ZSgxJyk7CgkJCXJldHVybiBldmFsKHMpOwoJCX0gY2F0Y2ggKGUpIHsKCQkJdGhpcy5TaG93RXJyb3IoJ0VWQUwgU0NSSVBUOiBcbicgKyBlLm1lc3NhZ2UgKyAnXG4nICsgcyk7CgkJfQoJfQoKCVNob3dPYmplY3QobywgYklnbm9yZURlYnVnKSB7CgkJdmFyIHJldCA9ICdPYmplY3QgU3RydWN0dXJlOlxuJzsKCQlmb3IgKHMgaW4gbykgewoJCQl0cnkgewoJCQkJcmV0ICs9IHMgKyAnOiAnICsgb1tzXSArICdcbic7CgkJCX0gY2F0Y2ggKGUpIHsKCQkJCXJldCArPSBzICsgJzogRXhjZXB0aW9uIHdpdGggdmFsdWUgPSAnICsgZS5tZXNzYWdlICsgJ1xuJzsKCQkJfQoJCX0KCgkJdGhpcy5TaG93RGVidWcocmV0LCBiSWdub3JlRGVidWcpOwoJfQoKCVNob3dFcnJvcihzKSB7CgkJY29uc29sZS5sb2cocyk7CgkJaWYgKHRoaXMuYlNob3dFcnJvcnMpIHRoaXMuU2hvd01lc3NhZ2Uocyk7Cgl9CgoJY2NvcHkocykgewoJCWlmICh3aW5kb3cuY2xpcGJvYXJkRGF0YSkgY2xpcGJvYXJkRGF0YS5zZXREYXRhKCdUZXh0Jywgcyk7Cgl9CgoJU2hvd01lc3NhZ2UocykgewoJCWlmICh0eXBlb2Ygbm90eSAhPT0gJ3VuZGVmaW5lZCcpIHsKCQkJbm90eSh7CgkJCQl0ZXh0OiBzLAoJCQkJdHlwZTogJ3N1Y2Nlc3MnLAoJCQkJdGltZW91dDogMjAwMCwKCQkJfSk7CgkJfSBlbHNlIHsKCQkJLy8gdGhlIGRlZmF1bHQKCQkJdHJ5IHsKCQkJCSQoIjxkaXYgdGl0bGU9J0luZm9ybWF0aW9uJz48cD4iICsgcyArICc8L3A+PC9kaXY+JykuZGlhbG9nKCk7CgkJCX0gY2F0Y2ggKGUpIHsKCQkJCWNvbnNvbGUubG9nKHMpOwoJCQl9CgkJfQoJfQoKCVNob3dEZWJ1ZyhzLCBiSWdub3JlRGVidWcpIHsKCQlpZiAodHlwZW9mKHdpbmRvdykgPT09ICJ1bmRlZmluZWQiKSB7CgkJCWNvbnNvbGUubG9nKCJTaG93RGVidWc6ICIgKyBzKTsKCQl9CgkJaWYgKHRoaXMuYkRlYnVnIHx8IGJJZ25vcmVEZWJ1ZykgdGhpcy5TaG93TWVzc2FnZShzKTsKCX0KCglwYXJhbShhcmdzKSB7CgkJdGhpcy5DUk5MID0gdGhpcy5DUk5MIHx8ICJcbiI7CgkJdmFyIHJldCA9CgkJCScvKicgKwoJCQl0aGlzLkNSTkwgKwoJCQknPCFbQ0RBVEFbJyArCgkJCXRoaXMuQ1JOTCArCgkJCSdQQVJBTUVURVJTJyArCgkJCXRoaXMuQ1JOTCArCgkJCSddXT4nICsKCQkJdGhpcy5DUk5MICsKCQkJJyovJyArCgkJCXRoaXMuQ1JOTCArCgkJCXRoaXMuQ1JOTCArCgkJCSc8cD4nICsKCQkJdGhpcy5DUk5MOwoJCWZvciAodmFyIGkgPSAwOyBpIDwgYXJncy5sZW5ndGg7IGkrKykgewoJCQl2YXIgeG1sID0gdGhpcy5fdG9YTUwoYXJnc1tpXSk7CgkJCWlmIChmYWxzZSkgewoJCQkJLy8geG1sIGNvbnRhaW5zIGNoYXJhY3RlcnMgdGhhdCB3b3VsZCBub3QgYXJyaXZlIHByb3Blcmx5IGFuZCBzaG91bGQgYmUgY29udmVydGVkIHRvIGJhc2U2NAoJCQkJeG1sID0gYnRvYSh4bWwpOwoJCQl9CgkJCXJldCArPSAnPHAnICsgaSArICc+JyArIHRoaXMuQ1JOTCArIHhtbCArICcnICsgdGhpcy5DUk5MOwoJCQlyZXQgKz0gJzwvcCcgKyBpICsgJz4nICsgdGhpcy5DUk5MOwoJCX0KCQlyZXQgKz0gJzwvcD4nICsgdGhpcy5DUk5MOwoJCXJldHVybiByZXQ7Cgl9CgoJcmVzZXRDdXJzb3IoKSB7CgkJaWYgKCFkb2N1bWVudC5ib2R5KSByZXR1cm47CgkJZG9jdW1lbnQuYm9keS5zdHlsZS5jdXJzb3IgPSAnYXJyb3cnOwoJCWRvY3VtZW50LmJvZHkuc3R5bGUuY3Vyc29yID0gJyc7Cgl9CgoJc2VydmVyRGF0ZShkKSB7CgkJbGV0IHRkID0gMDsKCQlpZiAodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnKSB7CgkJCXRkID0gd2luZG93LnRpbWVEaWZmZXJlbmNlOwoJCX0gZWxzZSBpZiAodHlwZW9mKGdsb2JhbCkgIT09ICd1bmRlZmluZWQnKSB7CgkJCXRkID0gZ2xvYmFsLnRpbWVEaWZmZXJlbmNlOwoJCX0gZWxzZSBpZiAodHlwZW9mKFdvcmtlckdsb2JhbFNjb3BlKSAhPT0gJ3VuZGVmaW5lZCcpIHsKCQkJdGQgPSBzZWxmLnRpbWVEaWZmZXJlbmNlOwoJCX0KCQlyZXR1cm4gdGhpcy5hZGRNU2Vjb25kcyhkIHx8IG5ldyBEYXRlKCksIC10ZCk7Cgl9CgoJcnVuU1JTY3JpcHQocykgewoJCXJldHVybiB0aGlzLnJ1blNjcmlwdCgKCQkJJygoKSA9PiB7IHZhciByZXQgPSBudWxsOyAnICsKCQkJcyArCgkJCScgaWYodHlwZW9mKHdpbmRvdykhPT0idW5kZWZpbmVkIil7d2luZG93Lm1ldGhvZF9uYW1lID0gbWV0aG9kX25hbWU7IHdpbmRvdy5zZXJ2ZXJfdGltZSA9IHNlcnZlcl90aW1lOyB3aW5kb3cuX2V4Y2VwdGlvbiA9IHR5cGVvZihfZXhjZXB0aW9uKT09PSJ1bmRlZmluZWQiP251bGw6X2V4Y2VwdGlvbjsgd2luZG93LmV4ZWN1dGlvbl90aW1lID0gZXhlY3V0aW9uX3RpbWU7fSByZXR1cm4ge19leGNlcHRpb246IHR5cGVvZihfZXhjZXB0aW9uKT09PSJ1bmRlZmluZWQiP251bGw6X2V4Y2VwdGlvbiwgbWV0aG9kX25hbWU6IG1ldGhvZF9uYW1lLCBzZXJ2ZXJfdGltZTogc2VydmVyX3RpbWUsIGV4ZWN1dGlvbl90aW1lOiBleGVjdXRpb25fdGltZSwgcmV0OiByZXR9O30pKCk7JwoJCSk7Cgl9CgoJYXN5bmMgcHJvY2Vzc1Jlc3VsdChyZXMpIHsKCQlpZiAoIXJlcyB8fCAhcmVzLkNvZGUgfHwgIXJlcy5TdG9yZWRNZXRob2QpIHsKCQkJdGhpcy5BY3RpdmVSZXF1ZXN0ID0gbnVsbDsKCQkJcmV0dXJuIHJlczsKCQl9CgoJCS8vIGZvciBzdXJlIGEgbWV0aG9kIHJlc3VsdCBmcm9tIGFuIGFzeW5jIGNhbGwKCQlpZiAocmVzLlJlc3VsdCkgewoJCQkvLyB3ZSBnb3QgYSByZXN1bHQKCQkJdmFyIF9fcmV0ID0gbnVsbDsKCQkJdHJ5IHsKCQkJCV9fcmV0ID0gdGhpcy5wcm9jZXNzUmVzcG9uc2UoNCwgbnVsbCwgcmVzLlJlc3VsdCwgbnVsbCk7CgkJCX0gY2F0Y2ggKGUpIHsKCQkJCV9fcmV0ID0gcmVzLlJlc3VsdDsKCQkJfQoJCQl0aGlzLkFjdGl2ZVJlcXVlc3QgPSBudWxsOwoJCQlyZXR1cm4gX19yZXQ7CgkJfQoKCQl2YXIgdGltZW91dCA9IHJlcy5SdW5BZnRlciAtIHJlcy5EYXRlOwoJCWlmICh0aW1lb3V0IDw9IDApIHsKCQkJLy8gbmVnYXRpdmUgdGltZW91dCBtZWFucyB0aGF0IGl0IHdhcyBzdXBwb3NlZCB0byBiZSBydW4gYnV0IGRpZCBub3QgZm9yIHNvbWUgcmVhc29uIChkZWxheSwgZmFpbHVyZSwgZXRjLi4uKQoJCQkvLyBzYW1lIGRhdGUgYXMgcnVuYWZ0ZXIgbWVhbnMgdGhhdCB3ZSBhcmUgdXNpbmcgdGhlIGltbWVkaWF0ZSBhc3luYyBleGVjdXRpb24uIGkuZS4gdGhlcmUgaXMgbm8gbmVlZCBmb3IgdGhlIHJ1bm5lciB0aHJlYWQgdGFzawoJCQl0aW1lb3V0ID0gMzAwMDA7CgkJfSBlbHNlIGlmICh0aW1lb3V0ID4gNSAqIDYwICogMTAwMCkgewoJCQkvLyBtb3JlIHRoYW4gd2UgY2FuIHdhaXQsIHdlIHJldHVybiBhIHJlZmVyZW5jZSB0byB0aGUgcmVzdWx0CgkJCWNvbnNvbGUubG9nKAoJCQkJJ1dlIGNhbm5vdCB3YWl0ICcgKwoJCQkJTWF0aC5mbG9vcih0aW1lb3V0IC8gMTAwMCkgKwoJCQkJJyBzZWNvbmRzLiBSZXR1cm5pbmcgcmVzdWx0LicKCQkJKTsKCQkJcmV0dXJuIHJlczsKCQl9CgkJY29uc29sZS5sb2coCgkJCSdNYWtpbmcgdGhlIG5leHQgY2FsbCBpbiAnICsKCQkJTWF0aC5mbG9vcih0aW1lb3V0IC8gMTAwMCkgKwoJCQknIHNlY29uZHMuJwoJCSk7CgoJCWF3YWl0IG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIHRpbWVvdXQpKTsKCQlpZiAoIXRoaXMuQWN0aXZlUmVxdWVzdCkgewoJCQljb25zb2xlLmxvZygnTm8gQWN0aXZlUmVxdWVzdCwgZXhpdGluZy4uLicpOwoJCQlyZXR1cm4gbnVsbDsKCQl9CgkJdHJ5IHsKCQkJbGV0IHJldCA9IGF3YWl0ICQuYWpheCh7CgkJCQl1cmw6ICcvbWV0aG9kL2EuYXNoeD9uYW1lPUNvbnRlbnRNYW5hZ2VyLmNtc01ldGhvZFJlc3VsdEZpbmQmcDA9e0NvZGV9JyArCgkJCQkJcmVzLkNvZGUgKwoJCQkJCSd7L0NvZGV9e0lkfScgKwoJCQkJCXJlcy5JZCArCgkJCQkJJ3svSWR9JnJhbmQ9JyArCgkJCQkJTWF0aC5yYW5kb20oKSwKCQkJfSk7CgkJCXJldCA9IHRoaXMucHJvY2Vzc1Jlc3BvbnNlKDQsIG51bGwsIHJldCwgdGhpcy5BY3RpdmVSZXF1ZXN0LlVSTCk7CgkJCXJldCA9IGF3YWl0IHRoaXMucHJvY2Vzc1Jlc3VsdChyZXQpOwoJCQlyZXR1cm4gcmV0OwoJCX0gY2F0Y2ggKGV4KSB7CgkJCWNvbnNvbGUubG9nKCdwcm9jZXNzUmVzdWx0JywgZXgpOwoJCQlyZXR1cm4gYXdhaXQgdGhpcy5fKCdDb250ZW50TWFuYWdlci5jbXNNZXRob2RSZXN1bHRGaW5kJywgbnVsbCwgewoJCQkJQ29kZTogcmVzLkNvZGUsCgkJCQlJZDogcmVzLklkLAoJCQl9KTsKCQl9Cgl9CgoJcHJvY2Vzc1Jlc3BvbnNlKHJlYWR5U3RhdGUsIGNhbGxCYWNrLCByZXNwb25zZVRleHQsIHVybCkgewoJCWlmIChbNCwgNDRdLmluZGV4T2YocmVhZHlTdGF0ZSkgPT0gLTEpIHJldHVybjsKCgkJdmFyIHNNZXRob2ROYW1lID0gdGhpcy4kX1JFUVVFU1QoJ25hbWUnLCB1cmwpOwoKCQl0cnkgewoJCQlpZiAocmVhZHlTdGF0ZSA9PSA0KSB7CgkJCQlsZXQgcmVzID0gKGFzeW5jICgpID0+IHsKCQkJCQlyZXR1cm4gYXdhaXQgdGhpcy5jYWNoZVJlc3VsdChudWxsLCByZXNwb25zZVRleHQpOwoJCQkJfSkoKTsKCQkJfQoKCQkJLy9yZXQgPSBudWxsOwoJCQkvL3NlcnZlcl90aW1lID0gbnVsbDsKCQkJLy9fZXhjZXB0aW9uID0gbnVsbDsKCQkJdmFyIGJTY3JpcHRFcnJvciA9IGZhbHNlOwoJCQl2YXIgX3JldCA9IG51bGw7CgkJCXRyeSB7CgkJCQlfcmV0ID0gdGhpcy5ydW5TUlNjcmlwdChyZXNwb25zZVRleHQpOwoJCQl9IGNhdGNoIChlKSB7CgkJCQlpZiAodHlwZW9mKHdpbmRvdykgPT09ICJ1bmRlZmluZWQiKSB0aHJvdyBlOwoJCQkJYlNjcmlwdEVycm9yID0gdHJ1ZTsKCQkJfQoKCQkJaWYgKF9yZXQgJiYgX3JldC5zZXJ2ZXJfdGltZSkgewoJCQkJbGV0IHRkID0gbmV3IERhdGUoKS5nZXRUaW1lKCkgLSBfcmV0LnNlcnZlcl90aW1lLmdldFRpbWUoKTsKCgkJCQl0cnkgewoJCQkJCXdpbmRvdy50aW1lRGlmZmVyZW5jZSA9IHRkOwoJCQkJfSBjYXRjaCAoZXgpIHsKCQkJCQlnbG9iYWwudGltZURpZmZlcmVuY2UgPSB0ZDsKCQkJCX0KCQkJfQoKCQkJaWYgKF9yZXQgJiYgX3JldC5fZXhjZXB0aW9uKSB7CgkJCQl0aGlzLlNob3dEZWJ1ZyhfZXhjZXB0aW9uLk1lc3NhZ2UpOwoJCQl9CgoJCQlpZiAoY2FsbEJhY2sgIT0gbnVsbCkgewoJCQkJdmFyIGNhbGxSZXQgPSBudWxsOwoJCQkJdHJ5IHsKCQkJCQljYWxsUmV0ID0gY2FsbEJhY2soX3JldC5yZXQsIF9yZXQuX2V4Y2VwdGlvbik7CgkJCQl9IGNhdGNoIChlKSB7CgkJCQkJdGhpcy5TaG93RXJyb3IoCgkJCQkJCSdFcnJvciBpbiBDYWxsYmFjazpcblxuJyArIGNhbGxCYWNrICsgJ1xuXG4nICsgZS5tZXNzYWdlCgkJCQkJKTsKCQkJCX0KCQkJCWlmICgKCQkJCQl0eXBlb2YgX3JldC5tZXRob2RfbmFtZSAhPT0gJ3VuZGVmaW5lZCcgJiYKCQkJCQl0eXBlb2Ygc01ldGhvZE5hbWUgIT09ICd1bmRlZmluZWQnICYmCgkJCQkJc01ldGhvZE5hbWUgIT0gX3JldC5tZXRob2RfbmFtZQoJCQkJKSB7CgkJCQkJdGhpcy5TaG93RXJyb3IoCgkJCQkJCSdNaXNtYXRjaCBpbiBNZXRob2QgYmV0d2VlbiBzZXJ2ZXIgYW5kIGNsaWVudDpcblNlcnZlciBNZXRob2QgTmFtZTogJyArCgkJCQkJCV9yZXQubWV0aG9kX25hbWUgKwoJCQkJCQknXG5DbGllbnQgTWV0aG9kIE5hbWU6ICcgKwoJCQkJCQlzTWV0aG9kTmFtZQoJCQkJCSk7CgkJCQl9CgkJCQkoCgkJCQkJdGhpcy5mTG9hZGluZ0VuZCB8fAoJCQkJCWZ1bmN0aW9uKCkgewoJCQkJCQl3aW5kb3cuc3IucmVzZXRDdXJzb3IoKTsKCQkJCQl9CgkJCQkpKCk7CgoJCQkJcmV0dXJuICgKCQkJCQljYWxsUmV0IHx8IF9yZXQucmV0IHx8IChiU2NyaXB0RXJyb3IgPyByZXNwb25zZVRleHQgOiBudWxsKQoJCQkJKTsKCQkJfSBlbHNlIHsKCQkJCWlmICh0eXBlb2Yod2luZG93KSAhPT0gInVuZGVmaW5lZCIpIHRoaXMucmVzZXRDdXJzb3IoKTsKCQkJCXJldHVybiAoX3JldCA/IF9yZXQucmV0IDogbnVsbCkgfHwgKGJTY3JpcHRFcnJvciA/IHJlc3BvbnNlVGV4dCA6IG51bGwpOwoJCQl9CgkJfSBjYXRjaCAoZSkgewoJCQlpZiAodHlwZW9mKHdpbmRvdykgPT09ICJ1bmRlZmluZWQiKSB7CgkJCQl0aHJvdyBlOwoJCQl9CgkJCXRoaXMucmVzZXRDdXJzb3IoKTsKCQkJdGhpcy5TaG93RXJyb3IoJ0Vycm9yIGluIGNvZGU6ICcgKyBlLm1lc3NhZ2UgKyAnXG4nICsgcmVzcG9uc2VUZXh0KTsKCQl9CgoJCXJldHVybiBudWxsOwoJfQoKCWlzT2JqZWN0KG8pIHsKCQlyZXR1cm4gKAoJCQlvICE9IG51bGwgJiYKCQkJdHlwZW9mIG8gPT0gJ29iamVjdCcgJiYKCQkJIShvLmNvbnN0cnVjdG9yLnRvU3RyaW5nKCkuaW5kZXhPZignZnVuY3Rpb24gRGF0ZSgpJykgPiAtMSkgJiYKCQkJIShvLmNvbnN0cnVjdG9yLnRvU3RyaW5nKCkuaW5kZXhPZignQXJyYXkoKScpID4gLTEpCgkJKTsKCX0KCglfdG9KUyhvKSB7CgkJaWYgKG8gPT0gbnVsbCkgcmV0dXJuICdudWxsJzsKCgkJdmFyIHMgPSAnJzsKCQlzd2l0Y2ggKHR5cGVvZiBvKSB7CgkJCWNhc2UgJ3N0cmluZyc6CgkJCQlzICs9CgkJCQkJJyInICsKCQkJCQl0aGlzLm15UmVwbGFjZSgKCQkJCQkJdGhpcy5lc2NhcGVTdHJpbmcobyksCgkJCQkJCVsnIjogLCddLAoJCQkJCQlbJyI6IG51bGwsJ10KCQkJCQkpICsKCQkJCQknIic7CgkJCQlicmVhazsKCQkJY2FzZSAnbnVtYmVyJzoKCQkJCXMgKz0gbzsKCQkJCWJyZWFrOwoJCQljYXNlICdib29sZWFuJzoKCQkJCXMgKz0gbyA/ICd0cnVlJyA6ICdmYWxzZSc7CgkJCQlicmVhazsKCQkJY2FzZSAnb2JqZWN0JzoKCQkJCS8vIERhdGUKCQkJCWlmIChvLmNvbnN0cnVjdG9yLnRvU3RyaW5nKCkuaW5kZXhPZignZnVuY3Rpb24gRGF0ZSgpJykgPiAtMSkgewoJCQkJCXZhciB5ZWFyID0gby5nZXRGdWxsWWVhcigpLnRvU3RyaW5nKCk7CgkJCQkJLy92YXIgbW9udGggPSAoby5nZXRNb250aCgpICsgMSkudG9TdHJpbmcoKTsgbW9udGggPSAobW9udGgubGVuZ3RoID09IDEpID8gIjAiICsgbW9udGggOiBtb250aDsKCQkJCQl2YXIgbW9udGggPSBvLmdldE1vbnRoKCkudG9TdHJpbmcoKTsKCQkJCQltb250aCA9IG1vbnRoLmxlbmd0aCA9PSAxID8gJzAnICsgbW9udGggOiBtb250aDsKCQkJCQl2YXIgZGF0ZSA9IG8uZ2V0RGF0ZSgpLnRvU3RyaW5nKCk7CgkJCQkJZGF0ZSA9IGRhdGUubGVuZ3RoID09IDEgPyAnMCcgKyBkYXRlIDogZGF0ZTsKCQkJCQl2YXIgaG91cnMgPSBvLmdldEhvdXJzKCkudG9TdHJpbmcoKTsKCQkJCQlob3VycyA9IGhvdXJzLmxlbmd0aCA9PSAxID8gJzAnICsgaG91cnMgOiBob3VyczsKCQkJCQl2YXIgbWludXRlcyA9IG8uZ2V0TWludXRlcygpLnRvU3RyaW5nKCk7CgkJCQkJbWludXRlcyA9IG1pbnV0ZXMubGVuZ3RoID09IDEgPyAnMCcgKyBtaW51dGVzIDogbWludXRlczsKCQkJCQl2YXIgc2Vjb25kcyA9IG8uZ2V0U2Vjb25kcygpLnRvU3RyaW5nKCk7CgkJCQkJc2Vjb25kcyA9IHNlY29uZHMubGVuZ3RoID09IDEgPyAnMCcgKyBzZWNvbmRzIDogc2Vjb25kczsKCQkJCQl2YXIgbWlsbGlzZWNvbmRzID0gby5nZXRNaWxsaXNlY29uZHMoKS50b1N0cmluZygpOwoJCQkJCXZhciB0em1pbnV0ZXMgPSBNYXRoLmFicyhvLmdldFRpbWV6b25lT2Zmc2V0KCkpOwoJCQkJCXZhciB0emhvdXJzID0gMDsKCQkJCQl3aGlsZSAodHptaW51dGVzID49IDYwKSB7CgkJCQkJCXR6aG91cnMrKzsKCQkJCQkJdHptaW51dGVzIC09IDYwOwoJCQkJCX0KCQkJCQl0em1pbnV0ZXMgPQoJCQkJCQl0em1pbnV0ZXMudG9TdHJpbmcoKS5sZW5ndGggPT0gMSA/CgkJCQkJCScwJyArIHR6bWludXRlcy50b1N0cmluZygpIDoKCQkJCQkJdHptaW51dGVzLnRvU3RyaW5nKCk7CgkJCQkJdHpob3VycyA9CgkJCQkJCXR6aG91cnMudG9TdHJpbmcoKS5sZW5ndGggPT0gMSA/CgkJCQkJCScwJyArIHR6aG91cnMudG9TdHJpbmcoKSA6CgkJCQkJCXR6aG91cnMudG9TdHJpbmcoKTsKCQkJCQl2YXIgdGltZXpvbmUgPQoJCQkJCQkoby5nZXRUaW1lem9uZU9mZnNldCgpIDwgMCA/ICcrJyA6ICctJykgKwoJCQkJCQl0emhvdXJzICsKCQkJCQkJJzonICsKCQkJCQkJdHptaW51dGVzOwoJCQkJCXMgKz0KCQkJCQkJJ25ldyBEYXRlKCcgKwoJCQkJCQl5ZWFyICsKCQkJCQkJJywnICsKCQkJCQkJbW9udGggKwoJCQkJCQknLCcgKwoJCQkJCQlkYXRlICsKCQkJCQkJJywnICsKCQkJCQkJaG91cnMgKwoJCQkJCQknLCcgKwoJCQkJCQltaW51dGVzICsKCQkJCQkJJywnICsKCQkJCQkJc2Vjb25kcyArCgkJCQkJCScsJyArCgkJCQkJCW1pbGxpc2Vjb25kcyArCgkJCQkJCScpJzsKCQkJCX0KCQkJCS8vIEFycmF5CgkJCQllbHNlIGlmIChvLmNvbnN0cnVjdG9yLnRvU3RyaW5nKCkuaW5kZXhPZignQXJyYXkoKScpID4gLTEpIHsKCQkJCQlzICs9ICdbJzsKCQkJCQlmb3IgKHZhciBwIGluIG8pIHsKCQkJCQkJcyArPSAnJzsKCQkJCQkJaWYgKCFpc05hTihwKSkgewoJCQkJCQkJLy8gbGluZWFyIGFycmF5CgkJCQkJCQlzICs9IHRoaXMuX3RvSlMob1twXSk7CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQkvLyBhc3NvY2lhdGl2ZSBhcnJheQoJCQkJCQkJcyArPSAneyInICsgcCArICciOiAnICsgdGhpcy5fdG9KUyhvW3BdKSArICd9JzsKCQkJCQkJfQoJCQkJCQlzICs9ICcsICc7CgkJCQkJfQoJCQkJCXMgKz0gJ10nOwoJCQkJfQoJCQkJLy8gT2JqZWN0IG9yIGN1c3RvbSBmdW5jdGlvbgoJCQkJZWxzZSB7CgkJCQkJcyArPSAneyc7CgkJCQkJZm9yICh2YXIgcCBpbiBvKSB7CgkJCQkJCXMgKz0gJyInICsgcCArICciOiAnICsgdGhpcy5fdG9KUyhvW3BdKSArICcsICc7CgkJCQkJfQoJCQkJCWlmIChzLmxhc3RJbmRleE9mKCcsICcpID09IHMubGVuZ3RoIC0gMikKCQkJCQkJcyA9IHMuc3Vic3RyaW5nKDAsIHMubGVuZ3RoIC0gMik7CgkJCQkJcyArPSAnfSc7CgkJCQl9CgkJCQlicmVhazsKCQkJY2FzZSAnZnVuY3Rpb24nOgoJCQkJLy8gZnVuY3Rpb25zIGFyZSBub3Qgd29ya2luZywgSUxMRUdBTCBUT0tFTi4uLi4KCQkJCS8vcyArPSAiXCIiK3RoaXMuZXNjYXBlU3RyaW5nKG8udG9TdHJpbmcoKSkrIlwiIjsKCQkJCXMgKz0gJ251bGwnOwoJCQkJYnJlYWs7CgkJCWRlZmF1bHQ6CgkJCQlzICs9ICdudWxsJzsKCQl9CgkJcmV0dXJuIHM7Cgl9CgoJZXNjYXBlU3RyaW5nKHRleHQpIHsKCQlpZiAoIWFyZ3VtZW50cy5jYWxsZWUuc1JFKSB7CgkJCXZhciBzcGVjaWFscyA9IFsKCQkJCSdccicsCgkJCQknXG4nLAoJCQkJJ1xmJywKCQkJCSdcYicsCgkJCQknXHQnLAoJCQkJIiciLAoJCQkJJyYnLAoJCQkJJy8nLAoJCQkJJy4nLAoJCQkJJyonLAoJCQkJJysnLAoJCQkJJz8nLAoJCQkJJ3wnLAoJCQkJJygnLAoJCQkJJyknLAoJCQkJJ1snLAoJCQkJJ10nLAoJCQkJJ3snLAoJCQkJJ30nLAoJCQkJJ1xcJywKCQkJCSciJywKCQkJXTsKCQkJYXJndW1lbnRzLmNhbGxlZS5zUkUgPSBuZXcgUmVnRXhwKAoJCQkJJyhcXCcgKyBzcGVjaWFscy5qb2luKCd8XFwnKSArICcpJywKCQkJCSdnJwoJCQkpOwoJCX0KCQl2YXIgcmV0ID0gdGV4dC5yZXBsYWNlKGFyZ3VtZW50cy5jYWxsZWUuc1JFLCAnXFwkMScpOwoKCQlyZXQgPSB0aGlzLm15UmVwbGFjZShyZXQsIFsnPCcsICc+J10sIFsnJmx0OycsICcmZ3Q7J10pOwoJCXJldCA9IHRoaXMubXlSZXBsYWNlKAoJCQlyZXQsCgkJCVsnXHInLCAnXG4nLCAnXHQnXSwKCQkJWydcXCcgKyAncicsICdcXCcgKyAnbicsICdcXCcgKyAndCddCgkJKTsKCgkJcmV0dXJuIHJldDsKCX0KCglpcEFkZHJlc3MoKSB7CgkJdHJ5IHsKCQkJaWYgKHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJykgcmV0dXJuIG51bGw7CgkJCWlmICh0eXBlb2YoZ2xvYmFsKSA9PT0gJ3VuZGVmaW5lZCcgfHwgdHlwZW9mKGdsb2JhbC5vcykgPT09ICd1bmRlZmluZWQnKSB7CgkJCQkvLyBjb25zb2xlLmxvZygiaXBBZGRyZXNzKCk6IEludmFsaWQgZ2xvYmFsIG9yIGdsb2JhbC5vcyBub3QgZGVmaW5lZCIpOwoJCQkJcmV0dXJuIG51bGw7CgkJCX0KCQkJcmV0dXJuIFtdLmNvbmNhdCguLi5PYmplY3QudmFsdWVzKGdsb2JhbC5vcy5uZXR3b3JrSW50ZXJmYWNlcygpKSkuZmluZCgoZGV0YWlscykgPT4gZGV0YWlscy5mYW1pbHkgPT09ICdJUHY0JyAmJiAhZGV0YWlscy5pbnRlcm5hbCkuYWRkcmVzczsKCQl9IGNhdGNoIChleCkgewoJCQljb25zb2xlLmxvZygiaXBBZGRyZXNzKCk6ICIgKyBleCk7CgkJCXJldHVybiBudWxsOwoJCX0KCX0KCglfdG9YTUwobywgbGV2ZWwpIHsKCQlpZiAoIWxldmVsKSBsZXZlbCA9IDA7CgkJdmFyIHMgPSAnJzsKCQlpZiAobyA9PSBudWxsKSByZXR1cm4gczsKCQlzd2l0Y2ggKHR5cGVvZiBvKSB7CgkJCWNhc2UgJ3N0cmluZyc6CgkJCQlzICs9ICc8IVtDREFUQVsnICsgbyArICddXT4nOwoJCQkJYnJlYWs7CgkJCWNhc2UgJ251bWJlcic6CgkJCWNhc2UgJ2Jvb2xlYW4nOgoJCQkJcyArPSBvLnRvU3RyaW5nKCk7CgkJCQlicmVhazsKCQkJY2FzZSAnb2JqZWN0JzoKCQkJCS8vIERhdGUKCQkJCWlmICgKCQkJCQlvLmNvbnN0cnVjdG9yICYmCgkJCQkJby5jb25zdHJ1Y3Rvci50b1N0cmluZygpLmluZGV4T2YoJ2Z1bmN0aW9uIERhdGUoKScpID4gLTEgJiYKCQkJCQlvLmNvbnN0cnVjdG9yLm5hbWUgPT0gIkRhdGUiCgkJCQkpIHsKCQkJCQl2YXIgeWVhciA9IG8uZ2V0VVRDRnVsbFllYXIoKS50b1N0cmluZygpOwoJCQkJCXZhciBtb250aCA9IChvLmdldFVUQ01vbnRoKCkgKyAxKS50b1N0cmluZygpOwoJCQkJCW1vbnRoID0gbW9udGgubGVuZ3RoID09IDEgPyAnMCcgKyBtb250aCA6IG1vbnRoOwoJCQkJCXZhciBkYXRlID0gby5nZXRVVENEYXRlKCkudG9TdHJpbmcoKTsKCQkJCQlkYXRlID0gZGF0ZS5sZW5ndGggPT0gMSA/ICcwJyArIGRhdGUgOiBkYXRlOwoJCQkJCXZhciBob3VycyA9IG8uZ2V0VVRDSG91cnMoKS50b1N0cmluZygpOwoJCQkJCWhvdXJzID0gaG91cnMubGVuZ3RoID09IDEgPyAnMCcgKyBob3VycyA6IGhvdXJzOwoJCQkJCXZhciBtaW51dGVzID0gby5nZXRVVENNaW51dGVzKCkudG9TdHJpbmcoKTsKCQkJCQltaW51dGVzID0gbWludXRlcy5sZW5ndGggPT0gMSA/ICcwJyArIG1pbnV0ZXMgOiBtaW51dGVzOwoJCQkJCXZhciBzZWNvbmRzID0gby5nZXRVVENTZWNvbmRzKCkudG9TdHJpbmcoKTsKCQkJCQlzZWNvbmRzID0gc2Vjb25kcy5sZW5ndGggPT0gMSA/ICcwJyArIHNlY29uZHMgOiBzZWNvbmRzOwoJCQkJCXZhciBtaWxsaXNlY29uZHMgPSBvLmdldFVUQ01pbGxpc2Vjb25kcygpLnRvU3RyaW5nKCk7CgkJCQkJdmFyIHR6bWludXRlcyA9IE1hdGguYWJzKG8uZ2V0VGltZXpvbmVPZmZzZXQoKSk7CgkJCQkJdmFyIHR6aG91cnMgPSAwOwoJCQkJCXdoaWxlICh0em1pbnV0ZXMgPj0gNjApIHsKCQkJCQkJdHpob3VycysrOwoJCQkJCQl0em1pbnV0ZXMgLT0gNjA7CgkJCQkJfQoJCQkJCXR6bWludXRlcyA9CgkJCQkJCXR6bWludXRlcy50b1N0cmluZygpLmxlbmd0aCA9PSAxID8KCQkJCQkJJzAnICsgdHptaW51dGVzLnRvU3RyaW5nKCkgOgoJCQkJCQl0em1pbnV0ZXMudG9TdHJpbmcoKTsKCQkJCQl0emhvdXJzID0KCQkJCQkJdHpob3Vycy50b1N0cmluZygpLmxlbmd0aCA9PSAxID8KCQkJCQkJJzAnICsgdHpob3Vycy50b1N0cmluZygpIDoKCQkJCQkJdHpob3Vycy50b1N0cmluZygpOwoJCQkJCXZhciB0aW1lem9uZSA9CgkJCQkJCShvLmdldFRpbWV6b25lT2Zmc2V0KCkgPCAwID8gJysnIDogJy0nKSArCgkJCQkJCXR6aG91cnMgKwoJCQkJCQknOicgKwoJCQkJCQl0em1pbnV0ZXM7CgkJCQkJLy9zICs9IHllYXIgKyAiLSIgKyBtb250aCArICItIiArIGRhdGUgKyAiVCIgKyBob3VycyArICI6IiArIG1pbnV0ZXMgKyAiOiIgKyBzZWNvbmRzICsgIi4iICsgbWlsbGlzZWNvbmRzICsgdGltZXpvbmU7CgkJCQkJcyArPQoJCQkJCQltb250aCArCgkJCQkJCScvJyArCgkJCQkJCWRhdGUgKwoJCQkJCQknLycgKwoJCQkJCQl5ZWFyICsKCQkJCQkJJyAnICsKCQkJCQkJaG91cnMgKwoJCQkJCQknOicgKwoJCQkJCQltaW51dGVzICsKCQkJCQkJJzonICsKCQkJCQkJc2Vjb25kczsKCQkJCX0KCQkJCS8vIEFycmF5CgkJCQllbHNlIGlmICgKCQkJCQlvLmNvbnN0cnVjdG9yICYmCgkJCQkJby5jb25zdHJ1Y3Rvci50b1N0cmluZygpLmluZGV4T2YoJ0FycmF5KCknKSA+IC0xCgkJCQkpIHsKCQkJCQlmb3IgKHZhciBwIGluIG8pIHsKCQkJCQkJaWYgKHAgPT0gJ09QRVJBVE9SUycgfHwgcCA9PSAnT1JTJykgY29udGludWU7CgkJCQkJCXMgKz0gJzxPYmplY3Q+JzsKCQkJCQkJaWYgKCFpc05hTihwKSkgewoJCQkJCQkJLy8gbGluZWFyIGFycmF5CgkJCQkJCQlpZiAob1twXSA9PSBudWxsKSB7CgkJCQkJCQkJLy8gbnVsbCBlbnRyeSBpbiB0aGUgYXJyYXkKCQkJCQkJCQlzICs9ICc8SWQ+MDwvSWQ+JzsKCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJL2Z1bmN0aW9uXHMrKFx3KilccypcKC9naS5leGVjKAoJCQkJCQkJCQlvW3BdLmNvbnN0cnVjdG9yLnRvU3RyaW5nKCkKCQkJCQkJCQkpOwoJCQkJCQkJCXZhciB0eXBlID0gUmVnRXhwLiQxOwoJCQkJCQkJCXN3aXRjaCAodHlwZSkgewoJCQkJCQkJCQljYXNlICcnOgoJCQkJCQkJCQkJdHlwZSA9IHR5cGVvZiBvW3BdOwoJCQkJCQkJCQkJYnJlYWs7CgkJCQkJCQkJCWNhc2UgJ1N0cmluZyc6CgkJCQkJCQkJCQl0eXBlID0gJ3N0cmluZyc7CgkJCQkJCQkJCQlicmVhazsKCQkJCQkJCQkJY2FzZSAnTnVtYmVyJzoKCQkJCQkJCQkJCXR5cGUgPSAnaW50JzsKCQkJCQkJCQkJCWJyZWFrOwoJCQkJCQkJCQljYXNlICdCb29sZWFuJzoKCQkJCQkJCQkJCXR5cGUgPSAnYm9vbCc7CgkJCQkJCQkJCQlicmVhazsKCQkJCQkJCQkJY2FzZSAnRGF0ZSc6CgkJCQkJCQkJCQl0eXBlID0gJ0RhdGVUaW1lJzsKCQkJCQkJCQkJCWJyZWFrOwoJCQkJCQkJCX0KCQkJCQkJCQlzICs9IHRoaXMuX3RvWE1MKG9bcF0sIGxldmVsKyspOwoJCQkJCQkJfQoJCQkJCQl9IGVsc2UgewoJCQkJCQkJLy8gYXNzb2NpYXRpdmUgYXJyYXkKCQkJCQkJCXMgKz0KCQkJCQkJCQknPCcgKwoJCQkJCQkJCXAgKwoJCQkJCQkJCXRoaXMuY29vcChvLCBwKSArCgkJCQkJCQkJJz4nICsKCQkJCQkJCQl0aGlzLl90b1hNTChvW3BdLCBsZXZlbCsrKSArCgkJCQkJCQkJJzwvJyArCgkJCQkJCQkJcCArCgkJCQkJCQkJJz4nOwoJCQkJCQl9CgkJCQkJCXMgKz0gJzwvT2JqZWN0PicgKyB0aGlzLkNSTkw7CgkJCQkJfQoJCQkJfQoJCQkJLy8gT2JqZWN0IG9yIGN1c3RvbSBmdW5jdGlvbgoJCQkJZWxzZSB7CgkJCQkJaWYgKG8gPT0gbnVsbCB8fCBvLklkID09IDApIHt9IGVsc2UgaWYgKGZhbHNlICYmIG8uSWQpIHsKCQkJCQkJLy8gdGhpcyBpcyBjcmVhdGluZyBhIHByb2JsZW0sIGJldHRlciBzZW5kIGFsbCB0aGUgb2JqZWN0CgkJCQkJCS8vIGRvIG5vdCBzZW5kIG90aGVyIGRhdGEgaWYgd2UgaGF2ZSBhIHZhbHVlIGZvciB0aGUgSWQKCQkJCQkJcyArPSAnPElkPicgKyB0aGlzLl90b1hNTChvLklkLCBsZXZlbCsrKSArICc8L0lkPic7CgkJCQkJfSBlbHNlIHsKCQkJCQkJZm9yICh2YXIgcCBpbiBvKSB7CgkJCQkJCQlpZiAocCA9PSAnT1BFUkFUT1JTJyB8fCBwID09ICdPUlMnKSBjb250aW51ZTsKCQkJCQkJCXMgKz0KCQkJCQkJCQknPCcgKwoJCQkJCQkJCXAgKwoJCQkJCQkJCXRoaXMuY29vcChvLCBwKSArCgkJCQkJCQkJdGhpcy5PUihvLCBwKSArCgkJCQkJCQkJJz4nICsKCQkJCQkJCQl0aGlzLl90b1hNTChvW3BdLCBsZXZlbCsrKSArCgkJCQkJCQkJJzwvJyArCgkJCQkJCQkJcCArCgkJCQkJCQkJJz4nOwoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQkJYnJlYWs7CgkJfQoJCXJldHVybiBzOwoJfQoKCU9SKG8sIHApIHsKCQlyZXR1cm4gby5PUlMgJiYgby5PUlNbcF0gPwoJCQkiIE9SPSciICsKCQkJdGhpcy5teVJlcGxhY2Uoby5PUlNbcF0sIFsnPCcsICc+J10sIFsnJmx0OycsICcmZ3Q7J10pICsKCQkJIiciIDoKCQkJJyc7Cgl9CgoJY29vcChvLCBwKSB7CgkJaWYgKCFvLk9QRVJBVE9SUyB8fCAhby5PUEVSQVRPUlNbcF0pIHsKCQkJcmV0dXJuICcnOwoJCX0KCQlyZXR1cm4gKAoJCQkiIGNvb3A9JyIgKwoJCQl0aGlzLm15UmVwbGFjZShvLk9QRVJBVE9SU1twXSwgWyc8JywgJz4nXSwgWycmbHQ7JywgJyZndDsnXSkgKwoJCQkiJyIKCQkpOwoJfQoKCWdldFhtbEhUVFAoKSB7CgkJdmFyIHggPSBudWxsOwoJCXZhciBhY3RpdmV4bW9kZXMgPSBbJ01zeG1sMi5YTUxIVFRQJywgJ01pY3Jvc29mdC5YTUxIVFRQJ107IC8vYWN0aXZlWCB2ZXJzaW9ucyB0byBjaGVjayBmb3IgaW4gSUUKCQlpZiAod2luZG93LkFjdGl2ZVhPYmplY3QpIHsKCQkJLy9UZXN0IGZvciBzdXBwb3J0IGZvciBBY3RpdmVYT2JqZWN0IGluIElFIGZpcnN0IChhcyBYTUxIdHRwUmVxdWVzdCBpbiBJRTcgaXMgYnJva2VuKQoJCQlmb3IgKHZhciBpID0gMDsgaSA8IGFjdGl2ZXhtb2Rlcy5sZW5ndGg7IGkrKykgewoJCQkJdHJ5IHsKCQkJCQl4ID0gbmV3IEFjdGl2ZVhPYmplY3QoYWN0aXZleG1vZGVzW2ldKTsKCQkJCQlicmVhazsKCQkJCX0gY2F0Y2ggKGUpIHsKCQkJCQkvL3N1cHByZXNzIGVycm9yCgkJCQl9CgkJCX0KCQl9IGVsc2UgaWYgKHdpbmRvdy5YTUxIdHRwUmVxdWVzdCkgewoJCQkvLyBpZiBNb3ppbGxhLCBTYWZhcmkgZXRjCgkJCXggPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTsKCQl9IGVsc2UgewoJCQl4ID0gbnVsbDsKCQl9CgoJCXJldHVybiAod2luZG93LnhtbEhUVFAgPSB4KTsKCX0KCglhc3luYyBjYWNoZVJlc3VsdChyZXF1ZXN0LCB0ZXh0cmVzcG9uc2UpIHsKCQlpZiAoIXRoaXMuYkNhY2hlUmVzdWx0KSByZXR1cm47CgkJcmVxdWVzdCA9IHJlcXVlc3QgfHwgdGhpcy5BY3RpdmVSZXF1ZXN0OwoKCQlpZiAoIXJlcXVlc3QpIHsKCQkJcmV0dXJuOwoJCX0KCgkJaWYgKAoJCQl0ZXh0cmVzcG9uc2UgJiYKCQkJdGV4dHJlc3BvbnNlLmluZGV4T2YoJ3JldC5Db2RlID0gJykgPiAtMSAmJgoJCQl0ZXh0cmVzcG9uc2UuaW5kZXhPZigncmV0LlJ1bkFmdGVyID0gJykgPiAtMSAmJgoJCQl0ZXh0cmVzcG9uc2UuaW5kZXhPZigncmV0LlJlc3VsdCA9ICIiJykgPiAtMQoJCSkgewoJCQljb25zb2xlLmxvZygndGV4dHJlc3BvbnNlIGNvbnRpYW5zIGluY29tcGxldGUgbWV0aG9kIHJlc3VsdCcpOwoJCQlyZXR1cm4gbnVsbDsKCQl9CgoJCXZhciBzTWV0aG9kID0gdGhpcy4kX1JFUVVFU1QoJ25hbWUnLCByZXF1ZXN0LlVSTCk7CgkJc01ldGhvZCA9IHNNZXRob2Quc3Vic3RyaW5nKHNNZXRob2QubGFzdEluZGV4T2YoJy4nKSArIDEpOwoJCXRyeSB7CgkJCXZhciBfdXNhYmxlID0gKHIpID0+IHsKCQkJCXZhciBpdGVtID0KCQkJCQkociAmJgoJCQkJCQlyLmhhc2ggPT0gcmVxdWVzdC5oYXNoICYmCgkJCQkJCShyLlVSTCA9PSByZXF1ZXN0LlVSTCB8fCB0aGlzLiRfUkVRVUVTVCgnbmFtZScsIHIuVVJMKSA9PSBzTWV0aG9kKSAmJgoJCQkJCQlyLlRleHRSZXNwb25zZSAmJgoJCQkJCQkodHlwZW9mIHIuRXhwaXJlcyA9PT0gJ3VuZGVmaW5lZCcgfHwKCQkJCQkJCW5ldyBEYXRlKHIuRXhwaXJlcykgPiBuZXcgRGF0ZSgpKSkgPwoJCQkJCXIgOgoJCQkJCW51bGw7CgkJCQlpZiAodGV4dHJlc3BvbnNlKSB7CgkJCQkJaXRlbSA9IGl0ZW0gfHwgcmVxdWVzdDsKCQkJCQlpdGVtLlRleHRSZXNwb25zZSA9IHRleHRyZXNwb25zZTsKCQkJCQlpdGVtLkV4cGlyZXMgPSBuZXcgRGF0ZSgKCQkJCQkJbmV3IERhdGUoKS5nZXRUaW1lKCkgKwoJCQkJCQlwYXJzZUZsb2F0KAoJCQkJCQkJdGhpcy5uQ2FjaGVFeHBpcmVIb3VycyB8fCB0aGlzLiRfUkVRVUVTVCgnbkNhY2hlRXhwaXJlSG91cnMnKSB8fCAxCgkJCQkJCSkgKgoJCQkJCQk2MCAqCgkJCQkJCTYwICoKCQkJCQkJMTAwMAoJCQkJCSk7CgkJCQl9CgoJCQkJcmV0dXJuIGl0ZW07CgkJCX07CgoJCQlpZiAoCgkJCQl0aGlzLmJDYWNoZVJlc3VsdCA9PSAna3ZzdG9yZScgJiYKCQkJCXR5cGVvZiB3aW5kb3cuY29tcGFueS5yZXN0aW9kYlNldHRpbmdzICE9PSAndW5kZWZpbmVkJwoJCQkpIHsKCQkJCXZhciBhamF4ID0gKGtleSwgdmFsdWUsIGlkKSA9PiB7CgkJCQkJdmFyIHJldCA9IGNvbXBhbnkucmVzdGlvZGJTZXR0aW5ncygpOwoJCQkJCXJldC51cmwgKz0gJ2t2c3RvcmUnOwoJCQkJCWlmICh2YWx1ZSkgewoJCQkJCQlpZiAoaWQpIHsKCQkJCQkJCS8vIHVwZGF0ZSByZWNvcmQKCQkJCQkJCXJldC51cmwgKz0gJy8nICsgaWQ7CgkJCQkJCQlyZXQubWV0aG9kID0gJ1BVVCc7CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQkvLyBuZXcgcmVjb3JkCgkJCQkJCQlyZXQubWV0aG9kID0gJ1BPU1QnOwoJCQkJCQl9CgkJCQkJCXJldC5kYXRhID0gSlNPTi5zdHJpbmdpZnkoewoJCQkJCQkJa2V5OiBrZXksCgkJCQkJCQl2YWx1ZTogSlNPTi5zdHJpbmdpZnkodmFsdWUsIG51bGwsIDQpLAoJCQkJCQl9KTsKCQkJCQl9IGVsc2UgewoJCQkJCQlpZiAoaWQpIHsKCQkJCQkJCS8vIGRlbGV0ZSByZWNvcmQKCQkJCQkJCXJldC51cmwgKz0gJy8nICsgaWQ7CgkJCQkJCQlyZXQubWV0aG9kID0gJ0RFTEVURSc7CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQlyZXQubWV0aG9kID0gJ0dFVCc7CgkJCQkJCQlyZXQudXJsICs9ICc/cT17ImtleSI6JyArIGtleSArICd9JzsKCQkJCQkJfQoJCQkJCX0KCQkJCQkvL2NvbnNvbGUubG9nKCdtZXRob2QnLCByZXQubWV0aG9kKTsKCQkJCQlyZXR1cm4gcmV0OwoJCQkJfTsKCgkJCQlsZXQgcmVjb3JkID0gYXdhaXQgJC5hamF4KGFqYXgocmVxdWVzdC5oYXNoKSk7CgkJCQlsZXQgciA9CgkJCQkJcmVjb3JkICYmIHJlY29yZC5sZW5ndGggPwoJCQkJCUpTT04ucGFyc2UocmVjb3JkWzBdLnZhbHVlKSA6CgkJCQkJbnVsbDsKCQkJCWxldCBpdGVtID0gX3VzYWJsZShyKTsKCgkJCQlpZiAoIWl0ZW0pIHsKCQkJCQlpZiAocikgewoJCQkJCQlhd2FpdCAkLmFqYXgoYWpheChyZXF1ZXN0Lmhhc2gsIG51bGwsIHJlY29yZFswXS5faWQpKTsKCQkJCQl9CgkJCQkJcmV0dXJuIG51bGw7CgkJCQl9CgoJCQkJaWYgKCFyIHx8IGl0ZW0uRXhwaXJlcyA+IHIuRXhwaXJlcykgewoJCQkJCWF3YWl0ICQuYWpheCgKCQkJCQkJYWpheChpdGVtLmhhc2gsIGl0ZW0sIHIgPyByZWNvcmRbMF0uX2lkIDogbnVsbCkKCQkJCQkpOwoJCQkJCXJldHVybiBpdGVtOwoJCQkJfQoKCQkJCXJldHVybiBpdGVtOwoJCQl9IGVsc2UgaWYgKHRoaXMuYkNhY2hlUmVzdWx0ID09ICdzcicpIHsKCQkJCXZhciBhamF4ID0gKGtleSwgdmFsdWUsIGlkKSA9PiB7CgkJCQkJdmFyIG1ldGhvZCA9ICdGaW5kJzsKCQkJCQl2YXIgcmV0ID0gewoJCQkJCQl1cmw6ICcvbWV0aG9kL2EuYXNoeD9uYW1lPUNvbnRlbnRNYW5hZ2VyLmNtc01ldGhvZFJlc3VsdCcsCgkJCQkJCXByb2Nlc3NEYXRhOiBmYWxzZSwKCQkJCQkJdHlwZTogJ1BPU1QnLAoJCQkJCX07CgkJCQkJaWYgKHZhbHVlKSB7CgkJCQkJCWlmIChpZCkgewoJCQkJCQkJLy8gdXBkYXRlIHJlY29yZAoJCQkJCQkJbWV0aG9kID0gJ1VwZGF0ZSc7CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQkvLyBuZXcgcmVjb3JkCgkJCQkJCQltZXRob2QgPSAnSW5zZXJ0JzsKCQkJCQkJfQoJCQkJCQlyZXQuYmVmb3JlU2VuZCA9IChyZXF1ZXN0KSA9PiB7CgkJCQkJCQlyZXF1ZXN0LnNldFJlcXVlc3RIZWFkZXIoCgkJCQkJCQkJJ0NvbnRlbnQtVHlwZScsCgkJCQkJCQkJJ211bHRpcGFydC9mb3JtLWRhdGE7IGJvdW5kYXJ5PS0tLS0tLS0tLS0tLS0tJwoJCQkJCQkJKTsKCQkJCQkJfTsKCQkJCQl9IGVsc2UgewoJCQkJCQlyZXQudHlwZSA9ICdHRVQnOwoJCQkJCQlpZiAoaWQpIHsKCQkJCQkJCS8vIGRlbGV0ZSByZWNvcmQKCQkJCQkJCW1ldGhvZCA9ICdEZWxldGUnOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJLy8gZ2V0IHJlY29yZAoJCQkJCQkJbWV0aG9kID0gJ0ZpbmQnOwoJCQkJCQl9CgkJCQkJCW1ldGhvZCArPQoJCQkJCQkJJyZwMD17Q29kZX0nICsKCQkJCQkJCShjb21wYW55ID8gY29tcGFueS5Db2RlICsgJy0nIDogJycpICsKCQkJCQkJCWtleSArCgkJCQkJCQkney9Db2RlfSc7CgkJCQkJfQoJCQkJCXJldC51cmwgKz0gbWV0aG9kOwoJCQkJCWlmIChyZXQudHlwZSAhPSAnR0VUJykgewoJCQkJCQlkZWxldGUgaXRlbS5Qb3N0RGF0YTsgLy8gYmVjYXVzZSB3ZSBoYXZlIHRoZSBjYWNoZSBrZXkKCQkJCQkJdmFyIHAwID0gewoJCQkJCQkJQ29kZTogKGNvbXBhbnkgPyBjb21wYW55LkNvZGUgKyAnLScgOiAnJykgKyBrZXksCgkJCQkJCQlDb21wbGV0ZWQ6IG5ldyBEYXRlKCksCgkJCQkJCQlEYXRlOiB0aGlzLkFjdGl2ZVJlcXVlc3QgPwoJCQkJCQkJCXRoaXMuQWN0aXZlUmVxdWVzdC5EYXRlIDogbmV3IERhdGUoKSwKCQkJCQkJCVJlc3VsdDogYnRvYSh1bmVzY2FwZShlbmNvZGVVUklDb21wb25lbnQoSlNPTi5zdHJpbmdpZnkoaXRlbSkpKSksIC8vaXRlbS5UZXh0UmVzcG9uc2UsCgkJCQkJCQlTdG9yZWRNZXRob2Q6IHsKCQkJCQkJCQlOYW1lOiBzTWV0aG9kLAoJCQkJCQkJfSwKCQkJCQkJfTsKCQkJCQkJaWYgKGlkKSB7CgkJCQkJCQlwMC5JZCA9IGlkOwoJCQkJCQl9CgkJCQkJCXJldC5kYXRhID0KCQkJCQkJCSdQT1NUREFUQT1cclxuJyAvKisgIjw/eG1sIHZlcnNpb249XCIxLjBcIiBlbmNvZGluZz1cInV0Zi04XCIgc3RhbmRhbG9uZT1cInllc1wiPz5cclxuIiovICsKCQkJCQkJCXRoaXMucGFyYW0oW3AwXSk7CgkJCQkJfQoJCQkJCXJldHVybiByZXQ7CgkJCQl9OwoKCQkJCWxldCByZWNvcmQgPSB0aGlzLnJ1blNjcmlwdCAvKnJ1blNSU2NyaXB0Ki8oCgkJCQkJJygoKSA9PiB7IHZhciByZXQgPSBudWxsOyAnICsKCQkJCQkoYXdhaXQgJC5hamF4KGFqYXgocmVxdWVzdC5oYXNoKSkpICsKCQkJCQkncmV0dXJuIHJldDt9KSgpOycKCQkJCSk7CgkJCQlsZXQgciA9IHJlY29yZCA/IEpTT04ucGFyc2UocmVjb3JkLlJlc3VsdCkgOiBudWxsOwoJCQkJbGV0IGl0ZW0gPSBfdXNhYmxlKHIpOwoKCQkJCWlmICghaXRlbSkgewoJCQkJCWlmIChyKSB7CgkJCQkJCXRyeSB7CgkJCQkJCQlhd2FpdCAkLmFqYXgoYWpheChyZXF1ZXN0Lmhhc2gsIG51bGwsIHJlY29yZC5JZCkpOwoJCQkJCQl9IGNhdGNoIChleCkge30KCQkJCQl9CgkJCQkJcmV0dXJuIG51bGw7CgkJCQl9CgoJCQkJaWYgKCFyIHx8IGl0ZW0uRXhwaXJlcyA+IHIuRXhwaXJlcykgewoJCQkJCWF3YWl0ICQuYWpheCgKCQkJCQkJYWpheChpdGVtLmhhc2gsIGl0ZW0sIHIgJiYgcmVjb3JkID8gcmVjb3JkLklkIDogbnVsbCkKCQkJCQkpOwoJCQkJCXJldHVybiBpdGVtOwoJCQkJfQoKCQkJCXJldHVybiBpdGVtOwoJCQl9IGVsc2UgaWYgKHRoaXMuYkNhY2hlUmVzdWx0ID09ICdnaXRodWInKSB7CgkJCQlpZiAocmVxdWVzdC5VUkwuaW5kZXhPZignY21zTWV0aG9kUmVzdWx0JykgPj0gMCkgcmV0dXJuIG51bGw7CgkJCQlsZXQgcmVzID0gbnVsbDsKCQkJCXRyeSB7CgkJCQkJcmVzID0gYXdhaXQgJC5hamF4KHsKCQkJCQkJdXJsOiAnaHR0cHM6Ly9hcnpob3NwaXRhbC5naXRodWIuaW8vJyArCgkJCQkJCQljb21wYW55LlN0b3JlICsKCQkJCQkJCScvJyArCgkJCQkJCQlyZXF1ZXN0Lmhhc2ggKwoJCQkJCQkJJy5qcycsCgkJCQkJCWRhdGFUeXBlOiAnanNvbnAnLAoJCQkJCQlwcm9jZXNzUmVzdWx0OiBmYWxzZSwKCQkJCQl9KTsKCQkJCQlyZXR1cm4gewoJCQkJCQlUZXh0UmVzcG9uc2U6IHJlcywKCQkJCQl9OwoJCQkJfSBjYXRjaCAoZXgpIHsKCQkJCQljb25zb2xlLmxvZygnRVJST1JTOicsIGV4KTsKCQkJCQlyZXR1cm4gbnVsbDsKCQkJCX0KCQkJfSBlbHNlIGlmICh0aGlzLmJDYWNoZVJlc3VsdCA9PSAnbG9jYWwnKSB7CgkJCQl2YXIgc3JDYWNoZSA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdzckNhY2hlJyk7CgkJCQlpZiAoc3JDYWNoZSA9PSBudWxsKSB7CgkJCQkJc3JDYWNoZSA9IHsKCQkJCQkJUmVxdWVzdHM6IHt9LAoJCQkJCX07CgkJCQl9IGVsc2UgewoJCQkJCXNyQ2FjaGUgPSBKU09OLnBhcnNlKHNyQ2FjaGUpOwoJCQkJfQoKCQkJCXZhciByID0gc3JDYWNoZS5SZXF1ZXN0c1tyZXF1ZXN0Lmhhc2hdOwoJCQkJdmFyIGl0ZW0gPSBfdXNhYmxlKHIpOwoKCQkJCWlmICghaXRlbSkgewoJCQkJCWRlbGV0ZSBzckNhY2hlLlJlcXVlc3RzW3JlcXVlc3QuaGFzaF07CgkJCQkJbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ3NyQ2FjaGUnLCBKU09OLnN0cmluZ2lmeShzckNhY2hlKSk7CgkJCQkJcmV0dXJuIG51bGw7CgkJCQl9CgoJCQkJaWYgKCFyIHx8IGl0ZW0uRXhwaXJlcyA+IHIuRXhwaXJlcykgewoJCQkJCXNyQ2FjaGUuUmVxdWVzdHNbaXRlbS5oYXNoXSA9IGl0ZW07CgkJCQkJbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ3NyQ2FjaGUnLCBKU09OLnN0cmluZ2lmeShzckNhY2hlKSk7CgkJCQkJcmV0dXJuIGl0ZW07CgkJCQl9CgoJCQkJcmV0dXJuIGl0ZW07CgkJCX0KCQl9IGNhdGNoIChleCkgewoJCQljb25zb2xlLmxvZyhleCk7CgkJCXRocm93IGV4OwoJCX0KCX0KCglhc3luYyBfKGZ1biwgY2FsbEJhY2spIHsKCQlpZiAodGhpcy5zX0Vycm9yTWVzc2FnZXMgJiYgdGhpcy5zX0Vycm9yTWVzc2FnZXMubGVuZ3RoID4gMCkgewoJCQlhbGVydCgKCQkJCSdUaGUgZm9sbG93aW5nIGVycm9ycyB3ZXJlIGZvdW5kIGluIHlvdXIgZGF0YTpcbicgKwoJCQkJdGhpcy5zX0Vycm9yTWVzc2FnZXMKCQkJKTsKCQkJdGhpcy5zX0Vycm9yTWVzc2FnZXMgPSAnJzsKCQkJcmV0dXJuIG51bGw7CgkJfQoKCQl0aGlzLmJ1aWxkVVJMKCk7CgoJCWlmICh0eXBlb2YoZG9jdW1lbnQpICE9PSAidW5kZWZpbmVkIikoCgkJCXRoaXMuZkxvYWRpbmdTdGFydCB8fAoJCQlmdW5jdGlvbigpIHsKCQkJCWlmIChkb2N1bWVudC5ib2R5KSBkb2N1bWVudC5ib2R5LnN0eWxlLmN1cnNvciA9ICd3YWl0JzsKCQkJfQoJCSkoKTsKCgkJdmFyIGFyZ3MgPSBBcnJheSgpOwoJCWZvciAodmFyIGkgPSAyOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7CgkJCWFyZ3NbaSAtIDJdID0gYXJndW1lbnRzW2ldOwoJCX0KCgkJaWYgKHR5cGVvZihfRnJFTUQpICE9PSAndW5kZWZpbmVkJyAmJiBfRnJFTUQuYXBpU2VydmVyKSB7CgkJCWxldCBmUGFydHMgPSBmdW4uc3BsaXQoJy4nKTsKCQkJbGV0IGxpYiA9IGZQYXJ0cy5sZW5ndGggPiAxID8gZlBhcnRzWzBdIDogJ0NvbnRlbnRNYW5hZ2VyJzsKCQkJbGV0IGYgPSBmUGFydHMubGVuZ3RoID4gMSA/IGZQYXJ0c1sxXSA6IGZ1bjsKCgkJCWZQYXJ0cyA9IGYucmVwbGFjZSgvKFthLXowLTldKShbQS1aXSkvZywgJyQxLiQyJykuc3BsaXQoJy4nKTsKCgkJCWxldCBlYyA9IGZQYXJ0cy5zbGljZSgxLCAtMSkuam9pbignJyk7CgkJCWxldCBmbmFtZSA9IGZQYXJ0cy5zbGljZSgtMSlbMF07CgkJCWxldCBzY29wZSA9IGxpYi50b0xvd2VyQ2FzZSgpOwoKCQkJY29uc29sZS5sb2coImNhbGxpbmcuLi4gbmV3IFsiICsgbGliICsgJ10gJyArIGZQYXJ0c1swXSArICcuJyArIGVjICsgIigpLiIgKyBmbmFtZSArICIoKS4uLiAiIC8qICsgSlNPTi5zdHJpbmdpZnkoYXJncywgbnVsbCwgNCkqLyApOwoKCQkJbGV0IG9TY29wZSA9IHRoaXMuX19zY29wZShzY29wZSk7CgkJCWlmICghb1Njb3BlIHx8ICFvU2NvcGVbZWNdKSB7CgkJCQlpZiAoZm5hbWUgPT0gJ0ZpbmQnKSB7CgkJCQkJbGV0IG93bmVyID0gdGhpcy4kX1JFUVVFU1QoJ293bmVyJykgfHwgJ2Fyemhvc3BpdGFsJzsKCQkJCQlsZXQgdXJsID0gYGh0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS8ke293bmVyfS8ke293bmVyfS5naXRodWIuaW8vbWFzdGVyL2NvbS9uYW1tb3VyLyR7ZlBhcnRzWzBdfS8ke2VjfS8ke2FyZ3NbMF1bT2JqZWN0LmtleXMoYXJnc1swXSlbMF1dfS5qc29uYDsKCQkJCQljb25zb2xlLmxvZygiXygpOiBmZXRjaGluZyAiICsgdXJsKTsKCQkJCQlsZXQgcmV0ID0gYXdhaXQgZmV0Y2godXJsKTsKCQkJCQlpZiAoIXJldC5vaykgcmV0dXJuIG51bGw7CgkJCQkJbGV0IF9vYmogPSBKU09OLnBhcnNlKGF3YWl0IHJldC50ZXh0KCkpOwoJCQkJCXJldHVybiBfb2JqLnJlbWFyayA/IGF0b2IoX29iai5yZW1hcmspIDogX29iajsKCQkJCX0KCQkJCXJldHVybiBmbmFtZS5lbmRzV2l0aCgnYWxsJykgPyBbXSA6IG51bGw7CgkJCX0KCQkJY29uc29sZS5sb2coc2NvcGUgKyAiLi4uIGNhbGxpbmcuLi4iLCBvU2NvcGUpOwoKCQkJcmV0dXJuIGF3YWl0IG5ldyhvU2NvcGVbZWNdKSgpW2ZuYW1lXShhcmdzKTsKCQl9CgoJCXZhciBwb3N0RGF0YSA9IHRoaXMucGFyYW0oYXJncyk7CgkJaWYgKGZ1bi5pbmRleE9mKCcuJykgPCAwKSB7CgkJCWZ1biA9IHRoaXMuc3lzdGVtTmFtZSArICcuJyArIGZ1bjsKCQl9IGVsc2UgaWYgKGZ1bi5pbmRleE9mKCcuJykgPT0gMCkgewoJCQkvLyBhIG5vbi1sYXllciBtZXRob2QKCQkJZnVuID0gZnVuLnN1YnN0cmluZygxKTsKCQl9CgoJCWlmIChjYWxsQmFjayAmJiB0aGlzLkFjdGl2ZVJlcXVlc3QpIHsKCQkJdGhpcy5BY3RpdmVSZXF1ZXN0ID0gbnVsbDsKCQkJLy9yZXR1cm4gZmFsc2U7CgkJfQoKCQl2YXIgaENvZGUgPSB0aGlzLmhhc2hDb2RlKAoJCQlmdW4uc3Vic3RyaW5nKGZ1bi5pbmRleE9mKCcuJykgKyAxKSArIHBvc3REYXRhCgkJKTsKCgkJdGhpcy5DUk5MID0gdGhpcy5DUk5MIHx8ICJcbiI7CgkJcG9zdERhdGEgKz0KCQkJdGhpcy5DUk5MICsKCQkJdGhpcy5DUk5MICsKCQkJJzwhLS08cGlkPicgKwoJCQloQ29kZSArCgkJCSc8L3BpZD4tLT4nICsKCQkJdGhpcy5DUk5MOwoKCQlpZiAoZnVuLmluZGV4T2YoJ2Ntc01ldGhvZFJlc3VsdEZpbmQnKSA8IDApIHsKCQkJLy8gYXZvaWQgb3ZlcndyaXRlIG9mIGFzeW5jIGNhbGxzCgkJCXRoaXMuQWN0aXZlUmVxdWVzdCA9IHsKCQkJCVVSTDogdGhpcy5zclVSTCArICcmbmFtZT0nICsgZnVuLAoJCQkJUG9zdERhdGE6IHBvc3REYXRhLAoJCQkJRGF0ZTogbmV3IERhdGUoKSwKCQkJCUNhbGxCYWNrOiBjYWxsQmFjaywKCQkJCUNvbXBhbnk6IHR5cGVvZiBjb21wYW55ICE9PSAndW5kZWZpbmVkJyAmJiBjb21wYW55ID8gewoJCQkJCUNvZGU6IGNvbXBhbnkuQ29kZSwKCQkJCX0gOiBudWxsLAoJCQkJVGV4dFJlc3BvbnNlOiBudWxsLAoJCQkJaGFzaDogaENvZGUsCgkJCX07CgkJfQoKCQlpZiAodHlwZW9mKHdpbmRvdykgIT09ICJ1bmRlZmluZWQiICYmICF0aGlzLmJMb2NhbCkgewoJCQkvLyBsaXZlCgkJCXRyeSB7CgkJCQl2YXIgX3RoZVVybCA9CgkJCQkJKHRoaXMuU3RvcmUgfHwKCQkJCQkJJy9zdG9yZS8nICsKCQkJCQkJKHdpbmRvdy5jb21wYW55ICYmIHdpbmRvdy5jb21wYW55LkNvZGUgPwoJCQkJCQkJd2luZG93LmNvbXBhbnkuQ29kZSArICcvJyA6CgkJCQkJCQknLycpKSArCgkJCQkJaENvZGUgKwoJCQkJCScuanM/cmFuZD0nICsKCQkJCQlNYXRoLnJhbmRvbSgpOwoJCQkJbGV0IHJlcXVlc3QgPSBhd2FpdCB0aGlzLmNhY2hlUmVzdWx0KCk7CgkJCQl2YXIgcmVzcG9uc2VUZXh0ID0gbnVsbDsKCQkJCWlmICghcmVxdWVzdCkgewoJCQkJCXRyeSB7CgkJCQkJCXJlc3BvbnNlVGV4dCA9IGF3YWl0ICQuZ2V0KF90aGVVcmwpOwoJCQkJCX0gY2F0Y2ggKGV4KSB7fQoJCQkJfSBlbHNlIHsKCQkJCQlyZXNwb25zZVRleHQgPSByZXF1ZXN0LlRleHRSZXNwb25zZTsKCQkJCX0KCQkJCWlmICghcmVzcG9uc2VUZXh0KSB7CgkJCQkJY29uc29sZS5sb2coCgkJCQkJCSdMaXZlIE1vZGUsIG5vIHJlc3BvbnNlIHRleHQgZm9yICcgKwoJCQkJCQl0aGlzLkFjdGl2ZVJlcXVlc3QuaGFzaCArCgkJCQkJCScgLSAnICsKCQkJCQkJdGhpcy4kX1JFUVVFU1QoJ25hbWUnLCB0aGlzLkFjdGl2ZVJlcXVlc3QuVVJMKQoJCQkJCSk7CgkJCQkJcmV0dXJuIG51bGw7CgkJCQl9CgoJCQkJdmFyIF9yZXQgPSBudWxsOwoJCQkJdmFyIF9leGNlcHRpb24gPSBudWxsOwoJCQkJdHJ5IHsKCQkJCQlfcmV0ID0gdGhpcy5ydW5TUlNjcmlwdChyZXNwb25zZVRleHQpOwoJCQkJCV9leGNlcHRpb24gPSBfcmV0Ll9leGNlcHRpb247CgkJCQkJaWYgKF9yZXQuc2VydmVyX3RpbWUpIHsKCQkJCQkJbGV0IHRkID0gbmV3IERhdGUoKS5nZXRUaW1lKCkgLSBfcmV0LnNlcnZlcl90aW1lLmdldFRpbWUoKTsKCQkJCQkJdHJ5IHsKCQkJCQkJCXdpbmRvdy50aW1lRGlmZmVyZW5jZSA9IHRkOwoJCQkJCQl9IGNhdGNoIChleCkgewoJCQkJCQkJZ2xvYmFsLnRpbWVEaWZmZXJlbmNlID0gdGQ7CgkJCQkJCX0KCQkJCQl9CgkJCQl9IGNhdGNoIChlKSB7CgkJCQkJX2V4Y2VwdGlvbiA9IGU7CgkJCQl9CgoJCQkJaWYgKCFfcmV0ICYmICFfZXhjZXB0aW9uKSB7CgkJCQkJcmV0dXJuIGF3YWl0IG51bGw7IC8vdGhpcy5kb0hlYWRsZXNzQ2FsbChjYWxsQmFjayk7CgkJCQl9IGVsc2UgewoJCQkJCS8vdGhpcy5BY3RpdmVSZXF1ZXN0ID0gbnVsbDsKCQkJCQlpZiAoY2FsbEJhY2sgIT0gbnVsbCkgewoJCQkJCQl0cnkgewoJCQkJCQkJY2FsbEJhY2soCgkJCQkJCQkJX3JldC5yZXQgfHwgKF9leGNlcHRpb24gPyByZXNwb25zZVRleHQgOiBudWxsKSwKCQkJCQkJCQlfZXhjZXB0aW9uCgkJCQkJCQkpOwoJCQkJCQl9IGNhdGNoIChlKSB7CgkJCQkJCQl0aGlzLlNob3dFcnJvcigKCQkJCQkJCQknRXJyb3IgaW4gQ2FsbGJhY2s6XG5cbicgKwoJCQkJCQkJCWNhbGxCYWNrICsKCQkJCQkJCQknXG5cbicgKwoJCQkJCQkJCWUubWVzc2FnZQoJCQkJCQkJKTsKCQkJCQkJfQoJCQkJCX0KCQkJCQkoCgkJCQkJCXdpbmRvdy5zci5mTG9hZGluZ0VuZCB8fAoJCQkJCQkoKCkgPT4gewoJCQkJCQkJdGhpcy5yZXNldEN1cnNvcigpOwoJCQkJCQl9KQoJCQkJCSkoKTsKCQkJCQlyZXR1cm4gKAoJCQkJCQkoX3JldCA/IF9yZXQucmV0IDogbnVsbCkgfHwKCQkJCQkJKF9leGNlcHRpb24gPyByZXNwb25zZVRleHQgOiBudWxsKQoJCQkJCSk7CgkJCQl9CgkJCX0gY2F0Y2ggKGUpIHsKCQkJCWNvbnNvbGUubG9nKGUpOwoJCQkJcmV0dXJuIGZhbHNlOwoJCQl9CgkJfSBlbHNlIHsKCQkJcmV0dXJuIChhc3luYyAoKSA9PiB7CgkJCQlyZXR1cm4gYXdhaXQgdGhpcy5zZW5kWE1MKAoJCQkJCXRoaXMuc3JVUkwgKyAnJm5hbWU9JyArIGZ1biwKCQkJCQlwb3N0RGF0YSwKCQkJCQljYWxsQmFjawoJCQkJKTsKCQkJfSkoKTsKCQl9Cgl9CgoJcHJvbWlzZShkYXRhLCBjYWxsQmFjaykgewoJCWlmICghY2FsbEJhY2sgfHwge30udG9TdHJpbmcuY2FsbChjYWxsQmFjaykgIT09ICdbb2JqZWN0IEZ1bmN0aW9uXScpIHsKCQkJcmV0dXJuIGRhdGE7CgkJfQoKCQl2YXIgcCA9ICQuRGVmZXJyZWQoKTsKCgkJc2V0VGltZW91dChhc3luYyAoKSA9PiB7CgkJCXRyeSB7CgkJCQlsZXQgZCA9IGF3YWl0IGNhbGxCYWNrKGRhdGEpOwoJCQkJcC5yZXNvbHZlKGQpOwoJCQl9IGNhdGNoIChleCkgewoJCQkJdHJ5IHsKCQkJCQlwLnJlc29sdmUoY2FsbEJhY2soZGF0YSkpOwoJCQkJfSBjYXRjaCAoX2V4KSB7CgkJCQkJY29uc29sZS5sb2coJ3Byb21pc2UgZXhjZXB0aW9uJywgX2V4KTsKCQkJCX0KCQkJfQoJCX0sIDUwMCk7CgoJCXJldHVybiBwID8gcC5wcm9taXNlKCkgOiBkYXRhOwoJfQoKCWFzeW5jIHNlbmRYTUwodXJsLCBwb3N0RGF0YSwgY2FsbEJhY2spIHsKCQlpZiAodHlwZW9mKHdpbmRvdykgIT09ICJ1bmRlZmluZWQiICYmICF3aW5kb3cuU1IpIHdpbmRvdy5TUiA9IHRoaXM7CgoJCWlmICgodHlwZW9mKHdpbmRvdykgIT09ICJ1bmRlZmluZWQiICYmIHdpbmRvdy5qUXVlcnkpIHx8ICh0eXBlb2Yod2luZG93KSA9PT0gInVuZGVmaW5lZCIgJiYgdHlwZW9mKGF4aW9zKSAhPT0gInVuZGVmaW5lZCIpKSB7CgkJCWxldCByZXF1ZXN0ID0gYXdhaXQgdGhpcy5jYWNoZVJlc3VsdChudWxsLCBudWxsLCBjYWxsQmFjayk7CgkJCWlmIChyZXF1ZXN0KSB7CgkJCQlsZXQgcmVzdWx0ID0gYXdhaXQgdGhpcy5wcm9jZXNzUmVzcG9uc2UoCgkJCQkJNDQsCgkJCQkJY2FsbEJhY2ssCgkJCQkJcmVxdWVzdC5UZXh0UmVzcG9uc2UsCgkJCQkJdXJsCgkJCQkpOwoJCQkJcmV0dXJuIGF3YWl0IHRoaXMucHJvY2Vzc1Jlc3VsdChyZXN1bHQpOwoJCQl9IGVsc2UgewoJCQkJLy8ganF1ZXJ5IGNhbGwKCQkJCXZhciBhamF4ID0ge307CgkJCQlpZiAodGhpcy5iUG9zdCB8fCBwb3N0RGF0YS5sZW5ndGggPiAodGhpcy5uTWF4VVJMTGVuZ3RoIHx8IDEwMCkpIHsKCQkJCQlhamF4LnVybCA9IHVybDsKCQkJCQlhamF4LnR5cGUgPSAnUE9TVCc7CgkJCQkJYWpheC5iZWZvcmVTZW5kID0gKHJlcXVlc3QpID0+IHsKCQkJCQkJcmVxdWVzdC5zZXRSZXF1ZXN0SGVhZGVyKAoJCQkJCQkJJ0NvbnRlbnQtVHlwZScsCgkJCQkJCQknbXVsdGlwYXJ0L2Zvcm0tZGF0YTsgYm91bmRhcnk9LS0tLS0tLS0tLS0tLS0nCgkJCQkJCSk7CgkJCQkJfTsKCQkJCQlhamF4LmRhdGEgPQoJCQkJCQknUE9TVERBVEE9XHJcbicgLyorICI8P3htbCB2ZXJzaW9uPVwiMS4wXCIgZW5jb2Rpbmc9XCJ1dGYtOFwiIHN0YW5kYWxvbmU9XCJ5ZXNcIj8+XHJcbiIqLyArCgkJCQkJCXBvc3REYXRhOwoJCQkJfSBlbHNlIHsKCQkJCQlhamF4LnVybCA9IHVybCArICcmUE9TVENPREU9JyArIHRoaXMudG9IZXgocG9zdERhdGEpOwoJCQkJCWFqYXgudHlwZSA9ICdHRVQnOwoJCQkJfQoKCQkJCWxldCByZXQgPSBudWxsOwoJCQkJaWYgKHR5cGVvZihqUXVlcnkpICE9PSAidW5kZWZpbmVkIikgewoJCQkJCXJldCA9IGF3YWl0ICQuYWpheChhamF4KTsKCQkJCX0gZWxzZSBpZiAodHlwZW9mKGF4aW9zKSAhPT0gInVuZGVmaW5lZCIpIHsKCQkJCQlyZXQgPSBhd2FpdCBheGlvcyhhamF4KTsKCQkJCQlyZXQgPSByZXQuZGF0YTsKCQkJCX0KCQkJCXJldCA9IGF3YWl0IHRoaXMucHJvY2Vzc1Jlc3VsdCgKCQkJCQl0aGlzLnByb2Nlc3NSZXNwb25zZSg0LCBjYWxsQmFjaywgcmV0LCB1cmwpCgkJCQkpOwoJCQkJcmV0dXJuIHJldDsKCQkJfQoJCX0gZWxzZSB7CgkJCXZhciB4bWxIVFRQID0gdGhpcy5nZXRYbWxIVFRQKCk7CgkJCWlmICgheG1sSFRUUCkgcmV0dXJuIGZhbHNlOwoJCQlpZiAoY2FsbEJhY2sgIT0gbnVsbCkgewoJCQkJd2luZG93LnhtbEhUVFAub25yZWFkeXN0YXRlY2hhbmdlID0gZnVuY3Rpb24oKSB7CgkJCQkJaWYgKHdpbmRvdy54bWxIVFRQLnJlYWR5U3RhdGUgPT0gNCkgewoJCQkJCQlpZiAoJC53aGVuKSB7CgkJCQkJCQkkLndoZW4oCgkJCQkJCQkJd2luZG93LlNSLnByb2Nlc3NSZXNwb25zZSgKCQkJCQkJCQkJd2luZG93LnhtbEhUVFAucmVhZHlTdGF0ZSwKCQkJCQkJCQkJY2FsbEJhY2ssCgkJCQkJCQkJCXdpbmRvdy54bWxIVFRQLnJlc3BvbnNlVGV4dCwKCQkJCQkJCQkJdXJsCgkJCQkJCQkJKQoJCQkJCQkJKS50aGVuKChyZXN1bHQpID0+IHdpbmRvdy5TUi5wcm9jZXNzUmVzdWx0KHJlc3VsdCkpOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJd2luZG93LlNSLnByb2Nlc3NSZXN1bHQoCgkJCQkJCQkJd2luZG93LlNSLnByb2Nlc3NSZXNwb25zZSgKCQkJCQkJCQkJd2luZG93LnhtbEhUVFAucmVhZHlTdGF0ZSwKCQkJCQkJCQkJY2FsbEJhY2ssCgkJCQkJCQkJCXdpbmRvdy54bWxIVFRQLnJlc3BvbnNlVGV4dCwKCQkJCQkJCQkJdXJsCgkJCQkJCQkJKQoJCQkJCQkJKTsKCQkJCQkJfQoJCQkJCX0KCQkJCX07CgkJCX0KCgkJCWlmICh0aGlzLmJQb3N0IHx8IHBvc3REYXRhLmxlbmd0aCA+IHRoaXMubk1heFVSTExlbmd0aCkgewoJCQkJd2luZG93LnhtbEhUVFAub3BlbignUE9TVCcsIHVybCwgY2FsbEJhY2sgIT0gbnVsbCk7CgkJCQl3aW5kb3cueG1sSFRUUC5zZXRSZXF1ZXN0SGVhZGVyKAoJCQkJCSdDb250ZW50LVR5cGUnLAoJCQkJCSdtdWx0aXBhcnQvZm9ybS1kYXRhOyBib3VuZGFyeT0tLS0tLS0tLS0tLS0tLScKCQkJCSk7IC8vIGZvb2wgY3Jvc3MtZG9tYWluIGNoZWNraW5nIGluIGNocm9tZQoJCQkJd2luZG93LnhtbEhUVFAuc2VuZCgKCQkJCQknUE9TVERBVEE9XHJcbicgLyorICI8P3htbCB2ZXJzaW9uPVwiMS4wXCIgZW5jb2Rpbmc9XCJ1dGYtOFwiIHN0YW5kYWxvbmU9XCJ5ZXNcIj8+XHJcbiIqLyArCgkJCQkJcG9zdERhdGEKCQkJCSk7CgkJCX0gZWxzZSB7CgkJCQl4bWxIVFRQLm9wZW4oCgkJCQkJJ0dFVCcsCgkJCQkJdXJsICsgJyZQT1NUQ09ERT0nICsgdGhpcy50b0hleChwb3N0RGF0YSksCgkJCQkJY2FsbEJhY2sgIT0gbnVsbAoJCQkJKTsKCQkJCXhtbEhUVFAuc2VuZChudWxsKTsKCQkJfQoKCQkJaWYgKGNhbGxCYWNrID09IG51bGwgJiYgeG1sSFRUUC5yZWFkeVN0YXRlID09IDQpIHsKCQkJCXZhciBfdXJsID0gdXJsICsgJyZQT1NUQ09ERT0nICsgdGhpcy50b0hleChwb3N0RGF0YSk7CgkJCQlpZiAoJC53aGVuKSB7CgkJCQkJcmV0dXJuICQud2hlbigKCQkJCQkJdGhpcy5wcm9jZXNzUmVzcG9uc2UoCgkJCQkJCQl4bWxIVFRQLnJlYWR5U3RhdGUsCgkJCQkJCQljYWxsQmFjaywKCQkJCQkJCXhtbEhUVFAucmVzcG9uc2VUZXh0LAoJCQkJCQkJX3VybAoJCQkJCQkpCgkJCQkJKS50aGVuKChyZXN1bHQpID0+IHsKCQkJCQkJcmV0dXJuIHRoaXMucHJvY2Vzc1Jlc3VsdChyZXN1bHQpOwoJCQkJCX0pOwoJCQkJfSBlbHNlIHsKCQkJCQl0aGlzLnByb2Nlc3NSZXN1bHQoCgkJCQkJCXRoaXMucHJvY2Vzc1Jlc3BvbnNlKAoJCQkJCQkJeG1sSFRUUC5yZWFkeVN0YXRlLAoJCQkJCQkJY2FsbEJhY2ssCgkJCQkJCQl4bWxIVFRQLnJlc3BvbnNlVGV4dCwKCQkJCQkJCV91cmwKCQkJCQkJKQoJCQkJCSk7CgkJCQl9CgkJCX0KCQl9Cgl9CgoJX3VybChmdW4sIGZpbGVuYW1lKSB7CgkJdmFyIGFyZ3MgPSBBcnJheSgpOwoJCWZvciAodmFyIGkgPSAyOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7CgkJCWFyZ3NbaSAtIDJdID0gYXJndW1lbnRzW2ldOwoJCX0KCQl2YXIgcG9zdERhdGEgPSB0aGlzLnBhcmFtKGFyZ3MpOwoKCQl2YXIgX2FyZ3MgPSAnJzsKCQlmb3IgKHZhciBpID0gMjsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgewoJCQlfYXJncyArPSAnJnAnICsgKGkgLSAyKSArICc9JyArIGFyZ3VtZW50c1tpXTsKCQl9CgoJCWlmIChmdW4uaW5kZXhPZignLicpIDwgMCkgewoJCQlmdW4gPSB0aGlzLnN5c3RlbU5hbWUgKyAnLicgKyBmdW47CgkJfQoKCQlyZXR1cm4gKAoJCQl0aGlzLnNyVVJMICsKCQkJJyZuYW1lPScgKwoJCQlmdW4gKwoJCQknJnJhbmQ9JyArCgkJCU1hdGgucmFuZG9tKCkgKwoJCQkvLysgX2FyZ3MKCQkJJyZQT1NUQ09ERT0nICsKCQkJdGhpcy50b0hleChwb3N0RGF0YSkgKwoJCQkoZmlsZW5hbWUgPyAnJmZpbGVuYW1lPScgKyBmaWxlbmFtZSA6ICcnKQoJCSk7Cgl9CgoJX2pzb24oZnVuKSB7CgkJdmFyIGFyZ3MgPSBBcnJheSgpOwoJCWZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7CgkJCWFyZ3NbaSAtIDFdID0gYXJndW1lbnRzW2ldOwoJCX0KCQlpZiAoZnVuLmluZGV4T2YoJy4nKSA8IDApIHsKCQkJZnVuID0gdGhpcy5zeXN0ZW1OYW1lICsgJy4nICsgZnVuOwoJCX0KCQlyZXR1cm4gKAoJCQl0aGlzLnNyVVJMICsKCQkJJyZuYW1lPScgKwoJCQlmdW4gKwoJCQknJnJhbmQ9JyArCgkJCU1hdGgucmFuZG9tKCkgKwoJCQknJmpzb249Y2xlYW4mUE9TVENPREU9JyArCgkJCXRoaXMudG9IZXgodGhpcy5wYXJhbShhcmdzKSkKCQkpOwoJfQoKCW15UmVwbGFjZShzLCBmYywgcmMpIHsKCQlpZiAodHlwZW9mIHMgIT09ICdzdHJpbmcnKSByZXR1cm4gczsKCgkJdmFyIHJldCA9ICcnOwoJCWZvciAodmFyIGkgPSAwOyBpIDwgcy5sZW5ndGg7IGkrKykgewoJCQl2YXIgcnMgPSBzLmNoYXJBdChpKTsKCQkJZm9yICh2YXIgaiA9IDA7IGogPCBmYy5sZW5ndGg7IGorKykgewoJCQkJaWYgKHMuY2hhckF0KGkpID09IGZjW2pdKSB7CgkJCQkJcnMgPSBzLmNoYXJBdChpKS5yZXBsYWNlKGZjW2pdLCByY1tqXSk7CgkJCQl9CgkJCX0KCQkJcmV0ICs9IHJzOwoJCX0KCQlyZXR1cm4gcmV0OwoJfQoKCXJ1bkNvZGUoY3NDb2RlLCBqc0NvZGUsIHBYTUwsIGNhbGxCYWNrKSB7CgkJLy8gYXZvaWQgdXNpbmcgdGhpcyBwbGVhc2UKCQl2YXIgcG9zdERhdGEgPSAnU3RvcmVkTWV0aG9kIG0gPSBuZXcgU3RvcmVkTWV0aG9kKCk7JyArIHRoaXMuQ1JOTDsKCQlwb3N0RGF0YSArPQoJCQknbS5Cb2R5Q29kZSA9ICInICsKCQkJdGhpcy5teVJlcGxhY2UoY3NDb2RlLCBbJyInLCAnXHInLCAnXG4nXSwgWydcXCInLCAnXFxyJywgJ1xcbiddKSArCgkJCSciOycgKwoJCQl0aGlzLkNSTkw7CgkJcG9zdERhdGEgKz0KCQkJJ20uUmV0dXJuQ29kZSA9ICInICsKCQkJdGhpcy5teVJlcGxhY2UoanNDb2RlLCBbJyInLCAnXHInLCAnXG4nXSwgWydcXCInLCAnXFxyJywgJ1xcbiddKSArCgkJCSciOycgKwoJCQl0aGlzLkNSTkw7CgkJcG9zdERhdGEgKz0gJ20uQWN0aXZlID0gdHJ1ZTsnICsgdGhpcy5DUk5MOwoJCXBvc3REYXRhICs9ICdtLk9iamVjdFJldHVybiA9IGZhbHNlOycgKyB0aGlzLkNSTkw7CgkJcG9zdERhdGEgKz0gJ20uU2lnbmF0dXJlID0gInN0cmluZyBuYW1lIjsnICsgdGhpcy5DUk5MOwoJCXBvc3REYXRhICs9ICdyZXR1cm4gbmV3IG9iamVjdFtde20sIEAiJyArIHBYTUwgKyAnIn07JyArIHRoaXMuQ1JOTDsKCgkJdGhpcy5zZW5kWE1MKHRoaXMuc3JVUkwgKyAnJmNvZGU9dHJ1ZScsIHBvc3REYXRhLCBjYWxsQmFjayk7Cgl9CgoJR2V0KHVybCwgY2FsbEJhY2spIHsKCQlpZiAoIWNhbGxCYWNrKSB7CgkJCS8vIHN5bmNocm9ub3VzIG1vZGUKCQkJaWYgKCF3aW5kb3cualF1ZXJ5KSB7CgkJCQkvLyBubyBqcXVlcnkKCQkJfSBlbHNlIHsKCQkJCXJldHVybiB0aGlzLnByb21pc2UoCgkJCQkJbnVsbCwKCQkJCQkkLmFqYXgoewoJCQkJCQl0eXBlOiAnR0VUJywKCQkJCQkJdXJsOiB1cmwsCgkJCQkJCWFzeW5jOiBmYWxzZSwKCQkJCQkJcHJvY2Vzc0RhdGE6IGZhbHNlLAoJCQkJCX0pCgkJCQkpOwoJCQl9CgkJfSBlbHNlIHsKCQkJLy8gc3luY2hyb25vdXMgbW9kZQoJCQlpZiAoIXdpbmRvdy5qUXVlcnkpIHsKCQkJCS8vIG5vIGpxdWVyeQoJCQl9IGVsc2UgewoJCQkJJC5hamF4KHsKCQkJCQl0eXBlOiAnR0VUJywKCQkJCQl1cmw6IHVybCwKCQkJCQlwcm9jZXNzRGF0YTogZmFsc2UsCgkJCQkJc3VjY2VzczogKGRhdGEpID0+IGNhbGxCYWNrKGRhdGEpLAoJCQkJCWVycm9yOiAoZXJyKSA9PiBjYWxsQmFjayhudWxsKSwKCQkJCX0pOwoJCQl9CgkJfQoJfQoKCVBvc3QoCgkJdXJsLAoJCWNhbGxCYWNrLAoJCXBvc3REYXRhLAoJCWhlYWRlcnMsCgkJdXNlcm5hbWUsCgkJcGFzc3dvcmQsCgkJY29udGVudFR5cGUKCSkgewoJCXZhciB4bWxIVFRQID0gdGhpcy5nZXRYbWxIVFRQKCk7CgoJCWlmICh4bWxIVFRQKSB7CgkJCXhtbEhUVFAub3BlbignUE9TVCcsIHVybCwgdHJ1ZSk7CgkJCXhtbEhUVFAud2l0aENyZWRlbnRpYWxzID0gJ3RydWUnOwoJCQlpZiAoY3Jvc3NEb21haW4pCgkJCQl4bWxIVFRQLnNldFJlcXVlc3RIZWFkZXIoCgkJCQkJJ0FjY2Vzcy1Db250cm9sLUFsbG93LU9yaWdpbicsCgkJCQkJbG9jYXRpb24ub3JpZ2luCgkJCQkpOwoJCQlpZiAoY29udGVudFR5cGUpCgkJCQl4bWxIVFRQLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsIGNvbnRlbnRUeXBlKTsKCQkJaWYgKHVzZXJuYW1lKQoJCQkJeG1sSFRUUC5zZXRSZXF1ZXN0SGVhZGVyKAoJCQkJCSdBdXRob3JpemF0aW9uJywKCQkJCQknQmFzaWMgJyArIGJ0b2EoJ3VzZXJuYW1lOnBhc3N3b3JkJykKCQkJCSk7CgoJCQlpZiAoaGVhZGVycykKCQkJCWZvciAodmFyIGkgPSAwOyBpIDwgaGVhZGVycy5sZW5ndGg7IGkrKykKCQkJCQl4bWxIVFRQLnNldFJlcXVlc3RIZWFkZXIoaGVhZGVyc1tpXS5rZXksIGhlYWRlcnNbaV0udmFsdWUpOwoKCQkJeG1sSFRUUC5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBmdW5jdGlvbigpIHsKCQkJCWlmICh3aW5kb3cueG1sSFRUUC5yZWFkeVN0YXRlID09IDQgJiYgY2FsbEJhY2spIHsKCQkJCQljYWxsQmFjayh3aW5kb3cueG1sSFRUUC5yZXNwb25zZVRleHQpOwoJCQkJfQoJCQl9OwoJCQl4bWxIVFRQLnNlbmQocG9zdERhdGEpOwoJCX0KCX0KCgloYXNoQ29kZShzKSB7CgkJdmFyIGhhc2ggPSAwLAoJCQlpLAoJCQljaHIsCgkJCWxlbjsKCQlpZiAocy5sZW5ndGggPT0gMCkgcmV0dXJuIGhhc2g7CgkJZm9yIChpID0gMCwgbGVuID0gcy5sZW5ndGg7IGkgPCBsZW47IGkrKykgewoJCQljaHIgPSBzLmNoYXJDb2RlQXQoaSk7CgkJCWhhc2ggPSAoaGFzaCA8PCA1KSAtIGhhc2ggKyBjaHI7CgkJCWhhc2ggfD0gMDsgLy8gQ29udmVydCB0byAzMmJpdCBpbnRlZ2VyCgkJfQoJCXJldHVybiBoYXNoOwoJfQoKCXRvSGV4KHMpIHsKCQlpZiAodHlwZW9mIHMgIT09ICdzdHJpbmcnKSByZXR1cm4gczsKCgkJcmV0dXJuIHMuc3BsaXQoIiIpLm1hcCh4ID0+ICgyNTYgKyB4LmNoYXJDb2RlQXQoKSkudG9TdHJpbmcoMTYpLnN1YnN0cigtMikpLmpvaW4oIiIpOwoJfQoKCWFzY2lpX3ZhbHVlKGMpIHsKCQkvLyByZXN0cmljdCBpbnB1dCB0byBhIHNpbmdsZSBjaGFyYWN0ZXIKCQljID0gYy5jaGFyQXQoMCk7CgoJCS8vIGxvb3AgdGhyb3VnaCBhbGwgcG9zc2libGUgQVNDSUkgdmFsdWVzCgkJdmFyIGk7CgkJZm9yIChpID0gMDsgaSA8IDI1NjsgKytpKSB7CgkJCS8vIGNvbnZlcnQgaSBpbnRvIGEgMi1kaWdpdCBoZXggc3RyaW5nCgkJCXZhciBoID0gaS50b1N0cmluZygxNik7CgkJCWlmIChoLmxlbmd0aCA9PSAxKSBoID0gJzAnICsgaDsKCgkJCS8vIGluc2VydCBhICUgY2hhcmFjdGVyIGludG8gdGhlIHN0cmluZwoJCQloID0gJyUnICsgaDsKCgkJCS8vIGRldGVybWluZSB0aGUgY2hhcmFjdGVyIHJlcHJlc2VudGVkIGJ5IHRoZSBlc2NhcGUgY29kZQoJCQloID0gdW5lc2NhcGUoaCk7CgoJCQkvLyBpZiB0aGUgY2hhcmFjdGVycyBtYXRjaCwgd2UndmUgZm91bmQgdGhlIEFTQ0lJIHZhbHVlCgkJCWlmIChoID09IGMpIGJyZWFrOwoJCX0KCQlyZXR1cm4gaTsKCX0KCgkvKioKCSAqIERhdGUgRnVuY3Rpb25zCgkgKi8KCWRheXNEaWZmKGQyLCBkMSkgewoJCXJldHVybiBNYXRoLmNlaWwoKGQyLmdldFRpbWUoKSAtIGQxLmdldFRpbWUoKSkgLyAoMTAwMCAqIDYwICogNjAgKiAyNCkpOwoJfQoKCWFkZE1TZWNvbmRzKG8sIG1zKSB7CgkJcmV0dXJuIG5ldyBEYXRlKG8uZ2V0VGltZSgpICsgbXMpOwoJfQoKCWFkZFNlY29uZHMobywgcykgewoJCXJldHVybiB0aGlzLmFkZE1TZWNvbmRzKG8sIHMgKiAxMDAwKTsKCX0KCglhZGRNaW51dGVzKG8sIG0pIHsKCQlyZXR1cm4gdGhpcy5hZGRTZWNvbmRzKG8sIG0gKiA2MCk7Cgl9CgoJYWRkSG91cnMobywgaCkgewoJCXJldHVybiB0aGlzLmFkZE1pbnV0ZXMobywgaCAqIDYwKTsKCX0KCglhZGREYXlzKG8sIGQpIHsKCQlyZXR1cm4gdGhpcy5hZGRIb3VycyhvLCBkICogMjQpOwoJfQoKCWFkZFllYXJzKG8sIHkpIHsKCQlyZXR1cm4gdGhpcy5hZGRNb250aHMobywgeSAqIDEyKTsKCX0KCglhZGRNb250aHMobywgbSkgewoJCXJldHVybiBuZXcgRGF0ZSgKCQkJby5nZXRGdWxsWWVhcigpLAoJCQlvLmdldE1vbnRoKCkgKyBtLAoJCQlvLmdldERhdGUoKSwKCQkJby5nZXRIb3VycygpLAoJCQlvLmdldE1pbnV0ZXMoKSwKCQkJby5nZXRTZWNvbmRzKCkKCQkpOwoJfQoKCWlzRGF0ZShvKSB7CgkJcmV0dXJuICgKCQkJbyAhPSBudWxsICYmCgkJCW8uY29uc3RydWN0b3IgIT0gbnVsbCAmJgoJCQlvLmNvbnN0cnVjdG9yLnRvU3RyaW5nKCkuaW5kZXhPZignZnVuY3Rpb24gRGF0ZSgnKSA+IC0xCgkJKTsKCX0KCgl0b1Nob3J0RGF0ZShvKSB7CgkJaWYgKCF0aGlzLmlzRGF0ZShvKSkgcmV0dXJuICcnOyAvLyBhdm9pZCBudWxscwoJCXJldHVybiBvLmdldE1vbnRoKCkgKyAxICsgJy8nICsgby5nZXREYXRlKCkgKyAnLycgKyBvLmdldEZ1bGxZZWFyKCk7Cgl9CgoJdG9TaG9ydFRpbWUobykgewoJCWlmICghdGhpcy5pc0RhdGUobykpIHJldHVybiAnJzsgLy8gYXZvaWQgbnVsbHMKCQl2YXIgaG91cnMgPSAnJyArIG8uZ2V0SG91cnMoKTsgLy9vLmdldEhvdXJzKCklMTI7CgkJdmFyIG1pbnV0ZXMgPSAnJyArIG8uZ2V0TWludXRlcygpOwoJCXZhciBzZWNvbmRzID0gJycgKyBvLmdldFNlY29uZHMoKTsKCQlpZiAoaG91cnMubGVuZ3RoIDwgMikgaG91cnMgPSAnMCcgKyBob3VyczsKCQlpZiAobWludXRlcy5sZW5ndGggPCAyKSBtaW51dGVzID0gJzAnICsgbWludXRlczsKCQlpZiAoc2Vjb25kcy5sZW5ndGggPCAyKSBzZWNvbmRzID0gJzAnICsgc2Vjb25kczsKCQlyZXR1cm4gaG91cnMgKyAnOicgKyBtaW51dGVzICsgJzonICsgc2Vjb25kczsgLy8gKyAiICIgKyAoby5nZXRIb3VycygpPj0xMj8iUE0iOiJBTSIpOwoJfQoKCXRvRGF0ZVRpbWUobykgewoJCWlmICghdGhpcy5pc0RhdGUobykpIHJldHVybiAnJzsgLy8gYXZvaWQgbnVsbHMKCQlyZXR1cm4gdGhpcy50b1Nob3J0RGF0ZShvKSArICcgJyArIHRoaXMudG9TaG9ydFRpbWUobyk7Cgl9CgkvKioKCSAqIEVORDogRGF0ZSBGdW5jdGlvbnMKCSAqLwoKCXNldFByb3BlcnR5KGNpZCwgcywgcHJvcCwgZGVmKSB7CgkJaWYgKCFjaWQpIHJldHVybjsKCQl2YXIgbyA9ICQoY2lkKTsKCQlpZiAoIW8pIHJldHVybjsKCgkJaWYgKCFwcm9wKSB7CgkJCWlmIChvLnRhZ05hbWUgPT0gJ0lOUFVUJykgewoJCQkJcHJvcCA9ICd2YWx1ZSc7CgkJCQlpZiAoby50eXBlID09ICd0ZXh0JykgcHJvcCA9ICd2YWx1ZSc7CgkJCQlpZiAoby50eXBlID09ICdjaGVja2JveCcpIHByb3AgPSAnY2hlY2tlZCc7CgkJCX0gZWxzZSB7CgkJCQlwcm9wID0gJ2lubmVySFRNTCc7CgkJCX0KCQl9CgkJaWYgKCFkZWYpIGRlZiA9ICcnOwoJCWlmICh0aGlzLnByZVByb2Nlc3NIVE1MKSBkZWYgPSB0aGlzLnByZVByb2Nlc3NIVE1MKGRlZik7CgoJCWlmICh0aGlzLmlzRGF0ZShzKSkgewoJCQkvLyBhIGRhdGUgZmllbGQKCQkJcyA9IHRoaXMudG9TaG9ydERhdGUocyk7CgkJfSBlbHNlIHsKCQkJaWYgKHRoaXMucHJlUHJvY2Vzc0hUTUwpIHMgPSB0aGlzLnByZVByb2Nlc3NIVE1MKHMpOwoJCX0KCgkJd2luZG93LnByb3BlcnR5VmFsdWUgPSBzOwoJCXRyeSB7CgkJCXRoaXMucnVuU2NyaXB0KAoJCQkJIiQoJyIgKyBvLmlkICsgIicpLiIgKyBwcm9wICsgJyA9IHdpbmRvdy5wcm9wZXJ0eVZhbHVlOycKCQkJKTsKCQl9IGNhdGNoIChlKSB7CgkJCXRoaXMuU2hvd0Vycm9yKGUubWVzc2FnZSk7CgkJCXRoaXMucnVuU2NyaXB0KCIkKCciICsgby5pZCArICInKS4iICsgcHJvcCArICcgPSAiJyArIGRlZiArICciOycpOwoJCX0KCQl3aW5kb3cucHJvcGVydHlWYWx1ZSA9IG51bGw7Cgl9CgoJLyoqCgkgKiBWYWxpZGF0aW9uCgkgKi8KCXZhbGlkTm90TnVsbChzKSB7CgkJaWYgKHR5cGVvZiBzID09ICdzdHJpbmcnKSB7CgkJCXJldHVybiBzICYmIHMubGVuZ3RoID4gMDsKCQl9IGVsc2UgewoJCQlyZXR1cm4gcyAhPSBudWxsOwoJCX0KCX0KCgl2YWxpZE9iamVjdChvKSB7CgkJcmV0dXJuIG8gIT0gbnVsbDsKCX0KCgl2YWxpZEVtYWlsKHN0cikgewoJCXZhciBhdCA9ICdAJzsKCQl2YXIgZG90ID0gJy4nOwoJCXZhciBsYXQgPSBzdHIuaW5kZXhPZihhdCk7CgkJdmFyIGxzdHIgPSBzdHIubGVuZ3RoOwoJCXZhciBsZG90ID0gc3RyLmluZGV4T2YoZG90KTsKCQlpZiAoCgkJCXN0ci5pbmRleE9mKGF0KSA9PSAtMSB8fAoJCQlzdHIuaW5kZXhPZihhdCkgPT0gLTEgfHwKCQkJc3RyLmluZGV4T2YoYXQpID09IDAgfHwKCQkJc3RyLmluZGV4T2YoYXQpID09IGxzdHIgfHwKCQkJc3RyLmluZGV4T2YoZG90KSA9PSAtMSB8fAoJCQlzdHIuaW5kZXhPZihkb3QpID09IDAgfHwKCQkJc3RyLmluZGV4T2YoZG90KSA9PSBsc3RyIHx8CgkJCXN0ci5pbmRleE9mKGF0LCBsYXQgKyAxKSAhPSAtMSB8fAoJCQlzdHIuc3Vic3RyaW5nKGxhdCAtIDEsIGxhdCkgPT0gZG90IHx8CgkJCXN0ci5zdWJzdHJpbmcobGF0ICsgMSwgbGF0ICsgMikgPT0gZG90IHx8CgkJCXN0ci5pbmRleE9mKGRvdCwgbGF0ICsgMikgPT0gLTEgfHwKCQkJc3RyLmluZGV4T2YoJyAnKSAhPSAtMQoJCSkgewoJCQlyZXR1cm4gZmFsc2U7CgkJfSBlbHNlIHsKCQkJcmV0dXJuIHRydWU7CgkJfQoJfQoKCXZhbGlkYXRlKG8sIHR5cGUsIGNvbmZpZykgewoJCWlmICh0eXBlb2YgbyA9PSAnc3RyaW5nJykgbyA9ICQobyk7CgkJdmFyIGJBbGVydCA9IHRydWU7CgkJaWYgKCFvKSByZXR1cm47CgoJCWlmICghY29uZmlnKSBjb25maWcgPSB7fTsKCQl2YXIgb0VyciA9ICQoby5pZCArICdfRXJyb3InKTsKCQlpZiAoIW9FcnIgJiYgZG9jdW1lbnQuaW5zZXJ0QWRqYWNlbnRFbGVtZW50KSB7CgkJCWJBbGVydCA9IGZhbHNlOwoJCQlvRXJyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnU1BBTicpOwoJCQlvRXJyLmlkID0gby5pZCArICdfRXJyb3InOwoJCQlvRXJyLmNsYXNzTmFtZSA9ICdlcnJvcic7CgkJCW8uaW5zZXJ0QWRqYWNlbnRFbGVtZW50KCdhZnRlckVuZCcsIG9FcnIpOwoJCX0KCgkJaWYgKCFjb25maWdbJ2ZpZWxkJ10pIHsKCQkJdmFyIHRhZyA9IG8udGFnTmFtZS50b0xvd2VyQ2FzZSgpOwoJCQlpZiAoCgkJCQkodGFnID09ICdzcGFuJyB8fCB0YWcgPT0gJ2EnKSAmJgoJCQkJKG8uZ2V0QXR0cmlidXRlKCdmcm9tJykgfHwgby5nZXRBdHRyaWJ1dGUoJ2xvb2t1cCcpKQoJCQkpIHsKCQkJCWNvbmZpZ1snZmllbGQnXSA9ICdTZWxlY3RlZEl0ZW0nOwoJCQkJdHlwZSA9ICdPYmplY3QnOwoJCQl9IGVsc2UgewoJCQkJY29uZmlnWydmaWVsZCddID0gJ3ZhbHVlJzsKCQkJfQoJCX0KCQlpZiAoIXR5cGUpIHR5cGUgPSAnTm90TnVsbCc7CgoJCWlmICghY29uZmlnWydsYWJlbCddKSB7CgkJCXZhciB0aXRsZSA9IG8uZ2V0QXR0cmlidXRlKCd0aXRsZScpOwoJCQlpZiAoIXRpdGxlKSB7CgkJCQl0aXRsZSA9IG8uaWQuc3BsaXQoJ18nKTsKCQkJCXRpdGxlID0gdGl0bGVbMV07CgkJCQl0aXRsZSA9IHRpdGxlLnN1YnN0cigzKTsKCQkJCXRpdGxlID0gdGhpcy5FbmdsaXNoTmFtZSh0aXRsZSk7CgkJCX0KCQkJY29uZmlnWydsYWJlbCddID0gdGl0bGU7CgkJfQoJCWlmICghY29uZmlnWydtZXNzYWdlJ10pIGNvbmZpZ1snbWVzc2FnZSddID0gJ0ludmFsaWQgVmFsdWUnOwoKCQl2YXIgYlZhbGlkID0gdHJ1ZTsKCQl3aW5kb3cudmFsaWRhdGlvblZhbHVlID0gd2luZG93LmNtcy52KG8pOyAvL1tjb25maWdbImZpZWxkIl1dOy8vdmFsdWUKCQliVmFsaWQgPQoJCQliVmFsaWQgJiYKCQkJdGhpcy5ydW5TY3JpcHQoCgkJCQknd2luZG93LmNtcy5zci52YWxpZCcgKyB0eXBlICsgJyh3aW5kb3cudmFsaWRhdGlvblZhbHVlKScKCQkJKTsKCQl3aW5kb3cudmFsaWRhdGlvblZhbHVlID0gbnVsbDsKCgkJaWYgKCFiVmFsaWQpIHsKCQkJLy9vLnZhbHVlID0gIiI7CgkJCS8vby5mb2N1cygpOwoJCQlzTWVzc2FnZSA9IGNvbmZpZ1snbWVzc2FnZSddOwoJCX0gZWxzZSB7CgkJCXNNZXNzYWdlID0gJyc7CgkJfQoKCQlpZiAoIWJWYWxpZCkgewoJCQlpZiAoYkFsZXJ0KSB7CgkJCQl0aGlzLnNfRXJyb3JNZXNzYWdlcyArPQoJCQkJCSdcbicgKyBjb25maWdbJ2xhYmVsJ10gKyAnOiAnICsgc01lc3NhZ2U7CgkJCX0gZWxzZSB7CgkJCQlvRXJyLmlubmVySFRNTCA9IHNNZXNzYWdlOwoJCQl9CgkJfQoJfQoJLyoqCgkgKiBFTkQ6IFZhbGlkYXRpb24KCSAqLwoKCUVuZ2xpc2hOYW1lKHMpIHsKCQlyZXR1cm4gcy5yZXBsYWNlKC9eW2Etel18W0EtWl0vZywgKHYsIGkpID0+IGkgPT09IDAgPyB2LnRvVXBwZXJDYXNlKCkgOiAiICIgKyB2LnRvTG93ZXJDYXNlKCkpOwoKCQl2YXIgcmV0ID0gJyc7CgkJZm9yICh2YXIgaSA9IDA7IGkgPCBzLmxlbmd0aDsgaSsrKSB7CgkJCWlmIChzW2ldID49ICdBJyAmJiBzW2ldIDw9ICdaJykgewoJCQkJcmV0ICs9IChyZXQubGVuZ3RoID09IDAgPyAnJyA6ICcgJykgKyBzW2ldOwoJCQl9IGVsc2UgaWYgKHJldC5sZW5ndGggPT0gMCkgewoJCQkJcmV0ICs9IChzW2ldICsgJycpLnRvVXBwZXJDYXNlKCk7CgkJCX0gZWxzZSB7CgkJCQlyZXQgKz0gc1tpXTsKCQkJfQoJCX0KCgkJcmV0dXJuIHJldDsKCX0KCgkvKiogT2JqZWN0IENvbXBhcmlzb24gKiovCgluZXdPYmplY3QoKSB7CgkJdmFyIHJldCA9IG5ldyBPYmplY3QoKTsKCQlyZXQuX19PQkpFQ1RJRCA9IE1hdGgucmFuZG9tKCk7CgkJcmV0dXJuIHJldDsKCX0KCglFcXVhbHMobzEsIG8yKSB7CgkJaWYgKG8xID09IG8yKSByZXR1cm4gdHJ1ZTsKCgkJaWYgKAoJCQlvMSAmJgoJCQlvMS5fX09CSkVDVElEICYmCgkJCW8yICYmCgkJCW8yLl9fT0JKRUNUSUQgJiYKCQkJbzEuX19PQkpFQ1RJRCA9PSBvMi5fX09CSkVDVElECgkJKQoJCQlyZXR1cm4gdHJ1ZTsKCQlpZiAobzEgJiYgbzEuX19ST1dJRCAmJiBvMiAmJiBvMi5fX1JPV0lEICYmIG8xLl9fUk9XSUQgPT0gbzIuX19ST1dJRCkKCQkJcmV0dXJuIHRydWU7CgkJaWYgKG8xICYmIG8xLklkICYmIG8yICYmIG8yLklkICYmIG8xLklkID09IG8yLklkKSByZXR1cm4gdHJ1ZTsKCgkJcmV0dXJuIGZhbHNlOwoJfQoJLyoqIE9iamVjdCBDb21wYXJpc29uICoqLwoKCXNlcmlhbGl6ZShfb2JqKSB7CgkJdHJ5IHsKCQkJLy8gTGV0IEdlY2tvIGJyb3dzZXJzIGRvIHRoaXMgdGhlIGVhc3kgd2F5CgkJCWlmICgKCQkJCXR5cGVvZiBfb2JqLnRvU291cmNlICE9PSAndW5kZWZpbmVkJyAmJgoJCQkJdHlwZW9mIF9vYmouY2FsbGVlID09PSAndW5kZWZpbmVkJwoJCQkpIHsKCQkJCXJldHVybiBfb2JqLnRvU291cmNlKCk7CgkJCX0KCQkJLy8gT3RoZXIgYnJvd3NlcnMgbXVzdCBkbyBpdCB0aGUgaGFyZCB3YXkKCQkJc3dpdGNoICh0eXBlb2YgX29iaikgewoJCQkJLy8gbnVtYmVycywgYm9vbGVhbnMsIGFuZCBmdW5jdGlvbnMgYXJlIHRyaXZpYWw6CgkJCQkvLyBqdXN0IHJldHVybiB0aGUgb2JqZWN0IGl0c2VsZiBzaW5jZSBpdHMgZGVmYXVsdCAudG9TdHJpbmcoKQoJCQkJLy8gZ2l2ZXMgdXMgZXhhY3RseSB3aGF0IHdlIHdhbnQKCQkJCWNhc2UgJ251bWJlcic6CgkJCQljYXNlICdib29sZWFuJzoKCQkJCWNhc2UgJ2Z1bmN0aW9uJzoKCQkJCQlyZXR1cm4gX29iajsKCQkJCQkvLyBmb3IgSlNPTiBmb3JtYXQsIHN0cmluZ3MgbmVlZCB0byBiZSB3cmFwcGVkIGluIHF1b3RlcwoJCQkJY2FzZSAnc3RyaW5nJzoKCQkJCQlyZXR1cm4gIiciICsgX29iaiArICInIjsKCQkJCWNhc2UgJ29iamVjdCc6CgkJCQkJdmFyIHN0cjsKCQkJCQlpZiAoCgkJCQkJCV9vYmouY29uc3RydWN0b3IgPT09IEFycmF5IHx8CgkJCQkJCXR5cGVvZiBfb2JqLmNhbGxlZSAhPT0gJ3VuZGVmaW5lZCcKCQkJCQkpIHsKCQkJCQkJc3RyID0gJ1snOwoJCQkJCQl2YXIgaSwKCQkJCQkJCWxlbiA9IF9vYmoubGVuZ3RoOwoJCQkJCQlmb3IgKGkgPSAwOyBpIDwgbGVuIC0gMTsgaSsrKSB7CgkJCQkJCQlzdHIgKz0gdGhpcy5zZXJpYWxpemUoX29ialtpXSkgKyAnLCc7CgkJCQkJCX0KCQkJCQkJc3RyICs9IHRoaXMuc2VyaWFsaXplKF9vYmpbaV0pICsgJ10nOwoJCQkJCX0gZWxzZSB7CgkJCQkJCXN0ciA9ICd7JzsKCQkJCQkJdmFyIGtleTsKCQkJCQkJZm9yIChrZXkgaW4gX29iaikgewoJCQkJCQkJc3RyICs9IGtleSArICc6JyArIHRoaXMuc2VyaWFsaXplKF9vYmpba2V5XSkgKyAnLCc7CgkJCQkJCX0KCQkJCQkJc3RyID0gc3RyLnJlcGxhY2UoL1wsJC8sICcnKSArICd9JzsKCQkJCQl9CgkJCQkJcmV0dXJuIHN0cjsKCQkJCWRlZmF1bHQ6CgkJCQkJcmV0dXJuICdVTktOT1dOJzsKCQkJfQoJCX0gY2F0Y2ggKGUpIHsKCQkJdGhpcy5TaG93RGVidWcoZS5tZXNzYWdlKTsKCQl9Cgl9Cn0=",
	"__keys": ["name"],
	"active": true,
	"enabled": true,
	"__trMap": []
}