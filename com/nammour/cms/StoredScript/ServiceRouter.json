{
	"Id": "61bb5c0b5aae7dcbb9f0ac6b8fd113c411be8200",
	"name": "ServiceRouter",
	"script": "d2luZG93LlNlcnZpY2VSb3V0ZXIgPSBjbGFzcyB7CglfX3Njb3BlKHNjb3BlKSB7CgkJbGV0IHJldCA9IG51bGw7CgkJaWYgKHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJykgewoJCQlyZXQgPSB3aW5kb3c7CgkJfSBlbHNlIGlmICh0eXBlb2YoV29ya2VyR2xvYmFsU2NvcGUpICE9PSAndW5kZWZpbmVkJykgewoJCQlyZXQgPSBzZWxmOwoJCX0gZWxzZSBpZiAodHlwZW9mKGdsb2JhbCkgIT09ICd1bmRlZmluZWQnKSB7CgkJCXJldCA9IGdsb2JhbDsKCQl9CgoJCWlmIChzY29wZSkgcmV0ID0gcmV0W3Njb3BlXTsKCQlyZXR1cm4gcmV0OwoJfQoKCWJ1aWxkVVJMKHNyVVJMKSB7CgkJaWYgKCFzclVSTCkgewoJCQl0aGlzLnNyVVJMID0gdGhpcy4kX1JFUVVFU1QoJ3NyJyk7CgkJCWlmICghdGhpcy5zclVSTCkgewoJCQkJaWYgKHR5cGVvZih3aW5kb3cpID09PSAidW5kZWZpbmVkIikgewoJCQkJCWxldCBpcCA9IHRoaXMuaXBBZGRyZXNzKCk7CgkJCQkJaWYgKGlwICYmIChpcC5zdGFydHNXaXRoKCIxODIuMTY4LiIpIHx8IGlwID09ICIxOTIuMTY4LjEuMjUzIiB8fCBpcCA9PSAnMTk1LjExMi4yMTUuMjE4JykpIHsKCQkJCQkJdGhpcy5zclVSTCA9ICJodHRwOi8vMTgyLjE2OC43MC44MCI7CgkJCQkJfSBlbHNlIHsKCQkJCQkJdGhpcy5zclVSTCA9ICJodHRwOi8vYXJ6Lm5hbW1vdXIuY29tOjcwODAiOwoJCQkJCX0KCQkJCX0KCQkJCXRoaXMuc3JVUkwgKz0gJy9tZXRob2QvU2VydmljZVJvdXRlci5hc2h4JzsKCQkJfQoJCX0gZWxzZSB7CgkJCXRoaXMuc3JVUkwgPSBzclVSTDsKCQl9CgkJdGhpcy5zclVSTCArPSAnP3NydmVyc2lvbj0xJzsKCQlpZiAodGhpcy4kX1JFUVVFU1QoJ2d6aXAnKSkgewoJCQl0aGlzLnNyVVJMICs9ICcmZ3ppcD0nICsgdGhpcy4kX1JFUVVFU1QoJ2d6aXAnKTsKCQl9IGVsc2UgewoJCQl0aGlzLnNyVVJMICs9ICcmZ3ppcD10cnVlJzsKCQl9CgkJaWYgKHRoaXMuYkNhY2hlKSB7CgkJCXRoaXMuc3JVUkwgKz0gJyZjYWNoZT0nICsgdGhpcy5iQ2FjaGU7CgkJfQoJCWlmICghdGhpcy4kX1JFUVVFU1QoJ3JhbmQnLCB0aGlzLnNyVVJMKSkgewoJCQl0aGlzLnNyVVJMICs9ICcmcmFuZD0nICsgTWF0aC5yYW5kb20oKTsKCQl9CgoJCWlmICh0aGlzLmJEZWJ1ZykgewoJCQl0aGlzLnNyVVJMICs9ICcmREVCVUc9dHJ1ZSc7CgkJfQoKCQlpZiAoCgkJCXRoaXMuYkFzeW5jICYmCgkJCXRoaXMuYkxvY2FsICYmCgkJCSF0aGlzLiRfUkVRVUVTVCgnYXN5bmMnLCB0aGlzLnNyVVJMKQoJCSkgewoJCQl0aGlzLnNyVVJMICs9ICcmYXN5bmM9dHJ1ZSc7CgkJCWlmICh0aGlzLnJ1bkFmdGVyKSB7CgkJCQl0aGlzLnNyVVJMICs9ICcmcnVuYWZ0ZXI9JyArIHRoaXMucnVuQWZ0ZXI7CgkJCX0KCQkJdGhpcy5iQXN5bmMgPSBmYWxzZTsKCQl9CgoJCS8vdGhpcy5TaG93RGVidWcoJ3RoaXMuc3JVUkw9JyArIHRoaXMuc3JVUkwpOwoKCQlyZXR1cm4gdGhpcy5zclVSTDsKCX0KCglpbml0KAoJCXNyVVJMLAoJCXN5c3RlbU5hbWUsCgkJYlBvc3QsCgkJYkRlYnVnLAoJCWJTaG93RXJyb3JzLAoJCXByZVByb2Nlc3NIVE1MCgkpIHsKCQkvKmlmICh0eXBlb2YgZG9jdW1lbnQgPT09ICd1bmRlZmluZWQnKSB7CgkJCWRvY3VtZW50ID0ge307CgkJCXdpbmRvdyA9IHt9OwoJCX0qLwoJCWlmICghYkRlYnVnICYmIGRvY3VtZW50LlVSTCAmJiBkb2N1bWVudC5VUkwuaW5kZXhPZignZGVidWc9dHJ1ZScpID4gMCkgYkRlYnVnID0gdHJ1ZTsKCgkJdGhpcy5iTG9jYWwgPSAhdGhpcy5TdG9yZSAmJiBkb2N1bWVudC5VUkwgJiYgZG9jdW1lbnQuVVJMLmluZGV4T2YoJ2xvY2FsPWZhbHNlJykgPCAwICYmICF3aW5kb3cuZnJhbWVzLmxlbmd0aDsKCQlpZiAoIWRvY3VtZW50LlVSTCkgdGhpcy5iTG9jYWwgPSB0cnVlOwoKCQl0aGlzLmJDYWNoZSA9IHRoaXMuJF9SRVFVRVNUKCdjYWNoZScpOwoJCXRoaXMuYkNhY2hlUmVzdWx0ID0gdGhpcy4kX1JFUVVFU1QoJ2NhY2hlUmVzdWx0Jyk7CgoJCXRoaXMuc3JVUkwgPSB0aGlzLmJ1aWxkVVJMKHNyVVJMKTsKCgkJdGhpcy5DUk5MID0gJ1xuJzsKCQl0aGlzLm5NYXhVUkxMZW5ndGggPSAxMDA7CgoJCXRoaXMuc3lzdGVtTmFtZSA9IHN5c3RlbU5hbWU7CgoJCXRoaXMuYlBvc3QgPSBiUG9zdDsKCQl0aGlzLmJEZWJ1ZyA9IGJEZWJ1ZzsKCQl0aGlzLmJTaG93RXJyb3JzID0gYlNob3dFcnJvcnM7CgoJCXRoaXMuc19FcnJvck1lc3NhZ2VzID0gJyc7CgoJCXJldHVybiB0aGlzOwoJfQoKCXByZVByb2Nlc3NIVE1MKGh0bWwpIHsKCQlpZiAoIWh0bWwpIHJldHVybiBodG1sOwoKCQl0cnkgewoJCQl2YXIgcmV0ID0gJyc7CgkJCXZhciBwYXJ0cyA9IGh0bWwuc3BsaXQoJyQkJyk7CgkJCWZvciAodmFyIGkgPSAwOyBpIDwgcGFydHMubGVuZ3RoOyBpKyspIHsKCQkJCWlmIChpICUgMiA9PSAwKSB7CgkJCQkJcmV0ICs9IHBhcnRzW2ldOwoJCQkJCWNvbnRpbnVlOwoJCQkJfQoJCQkJdHJ5IHsKCQkJCQl2YXIgb1ZhbHVlID0gdGhpcy5ydW5TY3JpcHQocGFydHNbaV0pOwoJCQkJCWlmIChvVmFsdWUpIHsKCQkJCQkJcmV0ICs9IG9WYWx1ZTsKCQkJCQl9IGVsc2UgewoJCQkJCQlyZXQgKz0gJyc7CgkJCQkJfQoJCQkJfSBjYXRjaCAoZSkgewoJCQkJCXJldCArPSAnJzsKCQkJCX0KCQkJfQoKCQkJaWYgKHByZVByb2Nlc3NIVE1MICE9IG51bGwpIHJldCA9IHByZVByb2Nlc3NIVE1MKHJldCk7CgkJCXJldHVybiByZXQ7CgkJfSBjYXRjaCAoZSkgewoJCQlyZXR1cm4gJyc7CgkJfQoJfQoKCSRfUkVRVUVTVChrZXksIHVybCkgewoJCWlmICh0eXBlb2Yod2luZG93KSA9PT0gInVuZGVmaW5lZCIpIHJldHVybiBudWxsOwoKCQlsZXQgcmV0ID0gdW5kZWZpbmVkOwoJCWlmICh1cmwpIHsKCQkJdHJ5IHsKCQkJCXJldCA9IG5ldyBVUkwodXJsKS5zZWFyY2hQYXJhbXMuZ2V0KGtleSk7CgkJCX0gY2F0Y2ggKGV4KSB7CgkJCQl2YXIgcmVnZXggPSBuZXcgUmVnRXhwKCdbXFw/fCZdJyArIGtleSArICc9KFteJiNdKiknKTsKCQkJCXZhciByZXN1bHRzID0gcmVnZXguZXhlYygnPycgKyB1cmwuc3BsaXQoJz8nKVsxXSk7CgkJCQlyZXQgPSAocmVzdWx0cyA9PT0gbnVsbCkgPyAnJyA6IGRlY29kZVVSSUNvbXBvbmVudChyZXN1bHRzWzFdLnJlcGxhY2UoL1wrL2csICcgJykpOwoJCQl9CgkJfSBlbHNlIHsKCQkJcmV0ID0gbmV3IFVSTFNlYXJjaFBhcmFtcyh3aW5kb3cubG9jYXRpb24uc2VhcmNoKS5nZXQoa2V5KTsKCQl9CgoJCXJldHVybiByZXQgPT09IG51bGwgPyAnJyA6IHJldDsKCX0KCglncm91cEJ5KGFyLCBmaWVsZCkgewoJCWlmICghYXIgfHwgIWZpZWxkKSByZXR1cm4gbnVsbDsKCgkJdmFyIGtleXMgPSBbXTsKCQlhci5mb3JFYWNoKGEgPT4gewoJCQl2YXIga2V5ID0gbnVsbDsKCQkJZmllbGQuc3BsaXQoJy4nKS5mb3JFYWNoKGYgPT4ga2V5ID0gKGtleSB8fCBhKVtmXSk7CgkJCWxldCBrID0ga2V5cy5maW5kKGsgPT4gdGhpcy5FcXVhbHMoay5rZXksIGtleSkpOwoJCQlpZiAoaykgewoJCQkJay52YWx1ZXMucHVzaChhKTsKCQkJfSBlbHNlIHsKCQkJCWtleXMucHVzaCh7CgkJCQkJa2V5OiBrZXksCgkJCQkJdmFsdWVzOiBbYV0sCgkJCQl9KTsKCQkJfQoJCX0pOwoJCXJldHVybiBrZXlzOwoJfQoKCWNvbXBpbGUoYXJNb2R1bGVzKSB7CgkJdmFyIGNhbGxzID0gW107CgkJJC5lYWNoKGFyTW9kdWxlcywgKGksIG0pID0+CgkJCWNhbGxzLnB1c2goCgkJCQl0aGlzLl8oJ0NvbnRlbnRNYW5hZ2VyLmNtc0hUTUxQYWdlRmluZGFsbCcsIG51bGwsIHsKCQkJCQlQYWdlOiBtLAoJCQkJfSkKCQkJKQoJCSk7CgkJcmV0dXJuICQud2hlbiguLi5jYWxscykudGhlbigoLi4uYXJSZXQpID0+IHsKCQkJdmFyIF9yZXQgPSBbXTsKCQkJJC5tYXAoYXJSZXQsIChwKSA9PiB7CgkJCQlyZXQucHVzaChfLnRlbXBsYXRlKHAuSFRNTCkoc3IucnVuU2NyaXB0KHBbMF0uU2NyaXB0KSkpOwoJCQl9KTsKCQkJcmV0dXJuIF9yZXQ7CgkJfSk7Cgl9CgoJYXN5bmMgaW1wb3J0KGFyTW9kdWxlcykgewoJCXZhciByZXQgPSBbXTsKCQlmb3IgKHZhciBpID0gMDsgaSA8IGFyTW9kdWxlcy5sZW5ndGg7IGkrKykgewoJCQlsZXQgcCA9IGF3YWl0IHRoaXMuXygnQ29udGVudE1hbmFnZXIuY21zSFRNTFBhZ2VGaW5kJywgbnVsbCwgewoJCQkJUGFnZTogYXJNb2R1bGVzW2ldLAoJCQl9KTsKCQkJcmV0LnB1c2gocCk7CgkJCWF3YWl0IHRoaXMucnVuU2NyaXB0KHAuU2NyaXB0KTsKCQl9CgkJcmV0dXJuIHJldDsKCX0KCglnZXRPYmplY3QocykgewoJCXZhciBjb2RlID0gcyArICc7JzsKCQljb2RlID0gJyh0eXBlb2YgJyArIHMgKyAiID09PSAndW5kZWZpbmVkJyk/c3IubmV3T2JqZWN0KCk6IiArIHM7CgkJLy9yZXR1cm4gdGhpcy5ydW5TY3JpcHQocysiOyIpOwoJCXJldHVybiB0aGlzLnJ1blNjcmlwdChjb2RlKTsKCX0KCglydW5TY3JpcHQocykgewoJCWlmICghcykgcmV0dXJuIG51bGw7CgoJCWxldCBjTGluZXMgPSBzLnNwbGl0KCdcbicpOwoJCXRyeSB7CgkJCWlmICh0eXBlb2YoZXNwcmltYSkgIT09ICd1bmRlZmluZWQnKSB7CgkJCQllc3ByaW1hLnBhcnNlKHMsIHsKCQkJCQllczY6IHRydWUKCQkJCX0pOwoJCQl9CgkJfSBjYXRjaCAoZXgpIHsKCQkJaWYgKGNMaW5lc1tleC5saW5lTnVtYmVyIC0gMV0uaW5kZXhPZignZm9yIGF3YWl0JykgPCAwKSB7CgkJCQljb25zb2xlLmxvZygicnVuU2NyaXB0KCk6OmVzcHJpbWEgZXhjZXB0aW9uOiAiICsgZXguZGVzY3JpcHRpb24sIGV4LmxpbmVOdW1iZXIsIGNMaW5lc1tleC5saW5lTnVtYmVyIC0gMV0pOwoJCQkJLy9yZXR1cm47CgkJCX0KCQl9CgoJCWlmICh0eXBlb2Yod2luZG93KSAhPT0gInVuZGVmaW5lZCIpIHsKCQkJdHJ5IHsKCQkJCWlmICh3aW5kb3cuX2NvbnRlbnQgJiYgd2luZG93Ll9jb250ZW50LmV2YWwpIHsKCQkJCQl2YXIgb3V0cHV0ID0gd2luZG93Ll9jb250ZW50LmV2YWwocyk7CgkJCQkJcmV0dXJuIG91dHB1dDsKCQkJCX0KCQkJfSBjYXRjaCAoZSkgewoJCQkJdGhpcy5TaG93RXJyb3IoJ0ZGIFNDUklQVDogXG4nICsgZS5tZXNzYWdlICsgJ1xuJyArIHMpOwoJCQl9CgkJCXRyeSB7CgkJCQlpZiAod2luZG93LmV4ZWNTY3JpcHQpIHsKCQkJCQlpZiAocy5pbmRleE9mKCdcclxuJykgPiAwKSB7CgkJCQkJCS8vIGEgbXVsdGktbGluZSBzdGF0ZW1lbnQKCQkJCQkJd2luZG93LmV4ZWNTY3JpcHQocyk7CgkJCQkJCXJldHVybiBudWxsOwoJCQkJCX0gZWxzZSB7CgkJCQkJCS8vIGEgc2luZ2xlLWxpbmUgc3RhdGVtZW50CgkJCQkJCW5ld1YgPSBudWxsOwoJCQkJCQl2YXIgbmV3UyA9ICduZXdWID0gJyArIHM7CgkJCQkJCXdpbmRvdy5leGVjU2NyaXB0KG5ld1MpOwoJCQkJCQlyZXR1cm4gbmV3VjsKCQkJCQl9CgkJCQl9CgkJCX0gY2F0Y2ggKGUpIHsKCQkJCXRoaXMuU2hvd0Vycm9yKCdJRTYgU0NSSVBUOiBcbicgKyBlLm1lc3NhZ2UgKyAnXG4nICsgcyk7CgkJCX0KCgkJCXRyeSB7CgkJCQlpZiAod2luZG93LmV4ZWNTY3JpcHQpIHsKCQkJCQlpZiAocy5pbmRleE9mKCdcclxuJykgPiAwKSB7CgkJCQkJCS8vIGEgbXVsdGktbGluZSBzdGF0ZW1lbnQKCQkJCQkJd2luZG93LmV4ZWNTY3JpcHQocyk7CgkJCQkJCXJldHVybiBudWxsOwoJCQkJCX0gZWxzZSB7CgkJCQkJCS8vIGEgc2luZ2xlLWxpbmUgc3RhdGVtZW50CgkJCQkJCW5ld1YgPSBudWxsOwoJCQkJCQl2YXIgbmV3UyA9ICduZXdWID0gJyArIHM7CgkJCQkJCWV2YWwobmV3Uyk7CgkJCQkJCXJldHVybiBuZXdWOwoJCQkJCX0KCQkJCX0KCQkJfSBjYXRjaCAoZSkgewoJCQkJdGhpcy5TaG93RXJyb3IoJ0lFNyBTQ1JJUFQ6IFxuJyArIGUubWVzc2FnZSArICdcbicgKyBzKTsKCQkJfQoKCQkJdHJ5IHsKCQkJCXZhciBmbiA9IGZ1bmN0aW9uKCkgewoJCQkJCXZhciByZXQgPSB3aW5kb3cuZXZhbC5jYWxsKHdpbmRvdywgcyk7CgkJCQkJcmV0dXJuIHJldDsKCQkJCX07CgoJCQkJcmV0dXJuIGZuKCk7CgkJCX0gY2F0Y2ggKGUpIHsKCQkJCXRoaXMuU2hvd0Vycm9yKCdUQUcgU0NSSVBUOiBcbicgKyBlLm1lc3NhZ2UgKyAnXG4nICsgcyk7CgkJCX0KCQl9CgoJCXRyeSB7CgkJCXMgPSBzLnJlcGxhY2UoL25ldyBEYXRlXCgwMDAxL2csICduZXcgRGF0ZSgxJyk7CgkJCXJldHVybiBldmFsKHMpOwoJCX0gY2F0Y2ggKGUpIHsKCQkJdGhpcy5TaG93RXJyb3IoJ0VWQUwgU0NSSVBUOiBcbicgKyBlLm1lc3NhZ2UgKyAnXG4nICsgcyk7CgkJfQoJfQoKCVNob3dPYmplY3QobywgYklnbm9yZURlYnVnKSB7CgkJdmFyIHJldCA9ICdPYmplY3QgU3RydWN0dXJlOlxuJzsKCQlmb3IgKHMgaW4gbykgewoJCQl0cnkgewoJCQkJcmV0ICs9IHMgKyAnOiAnICsgb1tzXSArICdcbic7CgkJCX0gY2F0Y2ggKGUpIHsKCQkJCXJldCArPSBzICsgJzogRXhjZXB0aW9uIHdpdGggdmFsdWUgPSAnICsgZS5tZXNzYWdlICsgJ1xuJzsKCQkJfQoJCX0KCgkJdGhpcy5TaG93RGVidWcocmV0LCBiSWdub3JlRGVidWcpOwoJfQoKCVNob3dFcnJvcihzKSB7CgkJY29uc29sZS5sb2cocyk7CgkJaWYgKHRoaXMuYlNob3dFcnJvcnMpIHRoaXMuU2hvd01lc3NhZ2Uocyk7Cgl9CgoJY2NvcHkocykgewoJCWlmICh3aW5kb3cuY2xpcGJvYXJkRGF0YSkgY2xpcGJvYXJkRGF0YS5zZXREYXRhKCdUZXh0Jywgcyk7Cgl9CgoJU2hvd01lc3NhZ2UocykgewoJCWlmICh0eXBlb2Ygbm90eSAhPT0gJ3VuZGVmaW5lZCcpIHsKCQkJbm90eSh7CgkJCQl0ZXh0OiBzLAoJCQkJdHlwZTogJ3N1Y2Nlc3MnLAoJCQkJdGltZW91dDogMjAwMCwKCQkJfSk7CgkJfSBlbHNlIHsKCQkJLy8gdGhlIGRlZmF1bHQKCQkJdHJ5IHsKCQkJCSQoIjxkaXYgdGl0bGU9J0luZm9ybWF0aW9uJz48cD4iICsgcyArICc8L3A+PC9kaXY+JykuZGlhbG9nKCk7CgkJCX0gY2F0Y2ggKGUpIHsKCQkJCWNvbnNvbGUubG9nKHMpOwoJCQl9CgkJfQoJfQoKCVNob3dEZWJ1ZyhzLCBiSWdub3JlRGVidWcpIHsKCQlpZiAodHlwZW9mKHdpbmRvdykgPT09ICJ1bmRlZmluZWQiKSB7CgkJCWNvbnNvbGUubG9nKCJTaG93RGVidWc6ICIgKyBzKTsKCQl9CgkJaWYgKHRoaXMuYkRlYnVnIHx8IGJJZ25vcmVEZWJ1ZykgdGhpcy5TaG93TWVzc2FnZShzKTsKCX0KCglwYXJhbShhcmdzKSB7CgkJdGhpcy5DUk5MID0gdGhpcy5DUk5MIHx8ICJcbiI7CgkJdmFyIHJldCA9CgkJCScvKicgKwoJCQl0aGlzLkNSTkwgKwoJCQknPCFbQ0RBVEFbJyArCgkJCXRoaXMuQ1JOTCArCgkJCSdQQVJBTUVURVJTJyArCgkJCXRoaXMuQ1JOTCArCgkJCSddXT4nICsKCQkJdGhpcy5DUk5MICsKCQkJJyovJyArCgkJCXRoaXMuQ1JOTCArCgkJCXRoaXMuQ1JOTCArCgkJCSc8cD4nICsKCQkJdGhpcy5DUk5MOwoJCWZvciAodmFyIGkgPSAwOyBpIDwgYXJncy5sZW5ndGg7IGkrKykgewoJCQl2YXIgeG1sID0gdGhpcy5fdG9YTUwoYXJnc1tpXSk7CgkJCWlmIChmYWxzZSkgewoJCQkJLy8geG1sIGNvbnRhaW5zIGNoYXJhY3RlcnMgdGhhdCB3b3VsZCBub3QgYXJyaXZlIHByb3Blcmx5IGFuZCBzaG91bGQgYmUgY29udmVydGVkIHRvIGJhc2U2NAoJCQkJeG1sID0gYnRvYSh4bWwpOwoJCQl9CgkJCXJldCArPSAnPHAnICsgaSArICc+JyArIHRoaXMuQ1JOTCArIHhtbCArICcnICsgdGhpcy5DUk5MOwoJCQlyZXQgKz0gJzwvcCcgKyBpICsgJz4nICsgdGhpcy5DUk5MOwoJCX0KCQlyZXQgKz0gJzwvcD4nICsgdGhpcy5DUk5MOwoJCXJldHVybiByZXQ7Cgl9CgoJcmVzZXRDdXJzb3IoKSB7CgkJaWYgKCFkb2N1bWVudC5ib2R5KSByZXR1cm47CgkJZG9jdW1lbnQuYm9keS5zdHlsZS5jdXJzb3IgPSAnYXJyb3cnOwoJCWRvY3VtZW50LmJvZHkuc3R5bGUuY3Vyc29yID0gJyc7Cgl9CgoJc2VydmVyRGF0ZShkKSB7CgkJbGV0IHRkID0gMDsKCQlpZiAodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnKSB7CgkJCXRkID0gd2luZG93LnRpbWVEaWZmZXJlbmNlOwoJCX0gZWxzZSBpZiAodHlwZW9mKGdsb2JhbCkgIT09ICd1bmRlZmluZWQnKSB7CgkJCXRkID0gZ2xvYmFsLnRpbWVEaWZmZXJlbmNlOwoJCX0gZWxzZSBpZiAodHlwZW9mKFdvcmtlckdsb2JhbFNjb3BlKSAhPT0gJ3VuZGVmaW5lZCcpIHsKCQkJdGQgPSBzZWxmLnRpbWVEaWZmZXJlbmNlOwoJCX0KCQlyZXR1cm4gdGhpcy5hZGRNU2Vjb25kcyhkIHx8IG5ldyBEYXRlKCksIC10ZCk7Cgl9CgoJcnVuU1JTY3JpcHQocykgewoJCXJldHVybiB0aGlzLnJ1blNjcmlwdCgKCQkJJygoKSA9PiB7IHZhciByZXQgPSBudWxsOyAnICsKCQkJcyArCgkJCScgaWYodHlwZW9mKHdpbmRvdykhPT0idW5kZWZpbmVkIil7d2luZG93Lm1ldGhvZF9uYW1lID0gbWV0aG9kX25hbWU7IHdpbmRvdy5zZXJ2ZXJfdGltZSA9IHNlcnZlcl90aW1lOyB3aW5kb3cuX2V4Y2VwdGlvbiA9IHR5cGVvZihfZXhjZXB0aW9uKT09PSJ1bmRlZmluZWQiP251bGw6X2V4Y2VwdGlvbjsgd2luZG93LmV4ZWN1dGlvbl90aW1lID0gZXhlY3V0aW9uX3RpbWU7fSByZXR1cm4ge19leGNlcHRpb246IHR5cGVvZihfZXhjZXB0aW9uKT09PSJ1bmRlZmluZWQiP251bGw6X2V4Y2VwdGlvbiwgbWV0aG9kX25hbWU6IG1ldGhvZF9uYW1lLCBzZXJ2ZXJfdGltZTogc2VydmVyX3RpbWUsIGV4ZWN1dGlvbl90aW1lOiBleGVjdXRpb25fdGltZSwgcmV0OiByZXR9O30pKCk7JwoJCSk7Cgl9CgoJYXN5bmMgcHJvY2Vzc1Jlc3VsdChyZXMpIHsKCQlpZiAoIXJlcyB8fCAhcmVzLkNvZGUgfHwgIXJlcy5TdG9yZWRNZXRob2QpIHsKCQkJdGhpcy5BY3RpdmVSZXF1ZXN0ID0gbnVsbDsKCQkJcmV0dXJuIHJlczsKCQl9CgoJCS8vIGZvciBzdXJlIGEgbWV0aG9kIHJlc3VsdCBmcm9tIGFuIGFzeW5jIGNhbGwKCQlpZiAocmVzLlJlc3VsdCkgewoJCQkvLyB3ZSBnb3QgYSByZXN1bHQKCQkJdmFyIF9fcmV0ID0gbnVsbDsKCQkJdHJ5IHsKCQkJCV9fcmV0ID0gdGhpcy5wcm9jZXNzUmVzcG9uc2UoNCwgbnVsbCwgcmVzLlJlc3VsdCwgbnVsbCk7CgkJCX0gY2F0Y2ggKGUpIHsKCQkJCV9fcmV0ID0gcmVzLlJlc3VsdDsKCQkJfQoJCQl0aGlzLkFjdGl2ZVJlcXVlc3QgPSBudWxsOwoJCQlyZXR1cm4gX19yZXQ7CgkJfQoKCQl2YXIgdGltZW91dCA9IHJlcy5SdW5BZnRlciAtIHJlcy5EYXRlOwoJCWlmICh0aW1lb3V0IDw9IDApIHsKCQkJLy8gbmVnYXRpdmUgdGltZW91dCBtZWFucyB0aGF0IGl0IHdhcyBzdXBwb3NlZCB0byBiZSBydW4gYnV0IGRpZCBub3QgZm9yIHNvbWUgcmVhc29uIChkZWxheSwgZmFpbHVyZSwgZXRjLi4uKQoJCQkvLyBzYW1lIGRhdGUgYXMgcnVuYWZ0ZXIgbWVhbnMgdGhhdCB3ZSBhcmUgdXNpbmcgdGhlIGltbWVkaWF0ZSBhc3luYyBleGVjdXRpb24uIGkuZS4gdGhlcmUgaXMgbm8gbmVlZCBmb3IgdGhlIHJ1bm5lciB0aHJlYWQgdGFzawoJCQl0aW1lb3V0ID0gMzAwMDA7CgkJfSBlbHNlIGlmICh0aW1lb3V0ID4gNSAqIDYwICogMTAwMCkgewoJCQkvLyBtb3JlIHRoYW4gd2UgY2FuIHdhaXQsIHdlIHJldHVybiBhIHJlZmVyZW5jZSB0byB0aGUgcmVzdWx0CgkJCWNvbnNvbGUubG9nKAoJCQkJJ1dlIGNhbm5vdCB3YWl0ICcgKwoJCQkJTWF0aC5mbG9vcih0aW1lb3V0IC8gMTAwMCkgKwoJCQkJJyBzZWNvbmRzLiBSZXR1cm5pbmcgcmVzdWx0LicKCQkJKTsKCQkJcmV0dXJuIHJlczsKCQl9CgkJY29uc29sZS5sb2coCgkJCSdNYWtpbmcgdGhlIG5leHQgY2FsbCBpbiAnICsKCQkJTWF0aC5mbG9vcih0aW1lb3V0IC8gMTAwMCkgKwoJCQknIHNlY29uZHMuJwoJCSk7CgoJCWF3YWl0IG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIHRpbWVvdXQpKTsKCQlpZiAoIXRoaXMuQWN0aXZlUmVxdWVzdCkgewoJCQljb25zb2xlLmxvZygnTm8gQWN0aXZlUmVxdWVzdCwgZXhpdGluZy4uLicpOwoJCQlyZXR1cm4gbnVsbDsKCQl9CgkJdHJ5IHsKCQkJbGV0IHJldCA9IGF3YWl0ICQuYWpheCh7CgkJCQl1cmw6ICcvbWV0aG9kL2EuYXNoeD9uYW1lPUNvbnRlbnRNYW5hZ2VyLmNtc01ldGhvZFJlc3VsdEZpbmQmcDA9e0NvZGV9JyArCgkJCQkJcmVzLkNvZGUgKwoJCQkJCSd7L0NvZGV9e0lkfScgKwoJCQkJCXJlcy5JZCArCgkJCQkJJ3svSWR9JnJhbmQ9JyArCgkJCQkJTWF0aC5yYW5kb20oKSwKCQkJfSk7CgkJCXJldCA9IHRoaXMucHJvY2Vzc1Jlc3BvbnNlKDQsIG51bGwsIHJldCwgdGhpcy5BY3RpdmVSZXF1ZXN0LlVSTCk7CgkJCXJldCA9IGF3YWl0IHRoaXMucHJvY2Vzc1Jlc3VsdChyZXQpOwoJCQlyZXR1cm4gcmV0OwoJCX0gY2F0Y2ggKGV4KSB7CgkJCWNvbnNvbGUubG9nKCdwcm9jZXNzUmVzdWx0JywgZXgpOwoJCQlyZXR1cm4gYXdhaXQgdGhpcy5fKCdDb250ZW50TWFuYWdlci5jbXNNZXRob2RSZXN1bHRGaW5kJywgbnVsbCwgewoJCQkJQ29kZTogcmVzLkNvZGUsCgkJCQlJZDogcmVzLklkLAoJCQl9KTsKCQl9Cgl9CgoJcHJvY2Vzc1Jlc3BvbnNlKHJlYWR5U3RhdGUsIGNhbGxCYWNrLCByZXNwb25zZVRleHQsIHVybCkgewoJCWlmIChbNCwgNDRdLmluZGV4T2YocmVhZHlTdGF0ZSkgPT0gLTEpIHJldHVybjsKCgkJdmFyIHNNZXRob2ROYW1lID0gdGhpcy4kX1JFUVVFU1QoJ25hbWUnLCB1cmwpOwoKCQl0cnkgewoJCQlpZiAocmVhZHlTdGF0ZSA9PSA0KSB7CgkJCQlsZXQgcmVzID0gKGFzeW5jICgpID0+IHsKCQkJCQlyZXR1cm4gYXdhaXQgdGhpcy5jYWNoZVJlc3VsdChudWxsLCByZXNwb25zZVRleHQpOwoJCQkJfSkoKTsKCQkJfQoKCQkJLy9yZXQgPSBudWxsOwoJCQkvL3NlcnZlcl90aW1lID0gbnVsbDsKCQkJLy9fZXhjZXB0aW9uID0gbnVsbDsKCQkJdmFyIGJTY3JpcHRFcnJvciA9IGZhbHNlOwoJCQl2YXIgX3JldCA9IG51bGw7CgkJCXRyeSB7CgkJCQlfcmV0ID0gdGhpcy5ydW5TUlNjcmlwdChyZXNwb25zZVRleHQpOwoJCQl9IGNhdGNoIChlKSB7CgkJCQlpZiAodHlwZW9mKHdpbmRvdykgPT09ICJ1bmRlZmluZWQiKSB0aHJvdyBlOwoJCQkJYlNjcmlwdEVycm9yID0gdHJ1ZTsKCQkJfQoKCQkJaWYgKF9yZXQgJiYgX3JldC5zZXJ2ZXJfdGltZSkgewoJCQkJbGV0IHRkID0gbmV3IERhdGUoKS5nZXRUaW1lKCkgLSBfcmV0LnNlcnZlcl90aW1lLmdldFRpbWUoKTsKCgkJCQl0cnkgewoJCQkJCXdpbmRvdy50aW1lRGlmZmVyZW5jZSA9IHRkOwoJCQkJfSBjYXRjaCAoZXgpIHsKCQkJCQlnbG9iYWwudGltZURpZmZlcmVuY2UgPSB0ZDsKCQkJCX0KCQkJfQoKCQkJaWYgKF9yZXQgJiYgX3JldC5fZXhjZXB0aW9uKSB7CgkJCQl0aGlzLlNob3dEZWJ1ZyhfZXhjZXB0aW9uLk1lc3NhZ2UpOwoJCQl9CgoJCQlpZiAoY2FsbEJhY2sgIT0gbnVsbCkgewoJCQkJdmFyIGNhbGxSZXQgPSBudWxsOwoJCQkJdHJ5IHsKCQkJCQljYWxsUmV0ID0gY2FsbEJhY2soX3JldC5yZXQsIF9yZXQuX2V4Y2VwdGlvbik7CgkJCQl9IGNhdGNoIChlKSB7CgkJCQkJdGhpcy5TaG93RXJyb3IoCgkJCQkJCSdFcnJvciBpbiBDYWxsYmFjazpcblxuJyArIGNhbGxCYWNrICsgJ1xuXG4nICsgZS5tZXNzYWdlCgkJCQkJKTsKCQkJCX0KCQkJCWlmICgKCQkJCQl0eXBlb2YgX3JldC5tZXRob2RfbmFtZSAhPT0gJ3VuZGVmaW5lZCcgJiYKCQkJCQl0eXBlb2Ygc01ldGhvZE5hbWUgIT09ICd1bmRlZmluZWQnICYmCgkJCQkJc01ldGhvZE5hbWUgIT0gX3JldC5tZXRob2RfbmFtZQoJCQkJKSB7CgkJCQkJdGhpcy5TaG93RXJyb3IoCgkJCQkJCSdNaXNtYXRjaCBpbiBNZXRob2QgYmV0d2VlbiBzZXJ2ZXIgYW5kIGNsaWVudDpcblNlcnZlciBNZXRob2QgTmFtZTogJyArCgkJCQkJCV9yZXQubWV0aG9kX25hbWUgKwoJCQkJCQknXG5DbGllbnQgTWV0aG9kIE5hbWU6ICcgKwoJCQkJCQlzTWV0aG9kTmFtZQoJCQkJCSk7CgkJCQl9CgkJCQkoCgkJCQkJdGhpcy5mTG9hZGluZ0VuZCB8fAoJCQkJCWZ1bmN0aW9uKCkgewoJCQkJCQl3aW5kb3cuc3IucmVzZXRDdXJzb3IoKTsKCQkJCQl9CgkJCQkpKCk7CgoJCQkJcmV0dXJuICgKCQkJCQljYWxsUmV0IHx8IF9yZXQucmV0IHx8IChiU2NyaXB0RXJyb3IgPyByZXNwb25zZVRleHQgOiBudWxsKQoJCQkJKTsKCQkJfSBlbHNlIHsKCQkJCWlmICh0eXBlb2Yod2luZG93KSAhPT0gInVuZGVmaW5lZCIpIHRoaXMucmVzZXRDdXJzb3IoKTsKCQkJCXJldHVybiAoX3JldCA/IF9yZXQucmV0IDogbnVsbCkgfHwgKGJTY3JpcHRFcnJvciA/IHJlc3BvbnNlVGV4dCA6IG51bGwpOwoJCQl9CgkJfSBjYXRjaCAoZSkgewoJCQlpZiAodHlwZW9mKHdpbmRvdykgPT09ICJ1bmRlZmluZWQiKSB7CgkJCQl0aHJvdyBlOwoJCQl9CgkJCXRoaXMucmVzZXRDdXJzb3IoKTsKCQkJdGhpcy5TaG93RXJyb3IoJ0Vycm9yIGluIGNvZGU6ICcgKyBlLm1lc3NhZ2UgKyAnXG4nICsgcmVzcG9uc2VUZXh0KTsKCQl9CgoJCXJldHVybiBudWxsOwoJfQoKCWlzT2JqZWN0KG8pIHsKCQlyZXR1cm4gKAoJCQlvICE9IG51bGwgJiYKCQkJdHlwZW9mIG8gPT0gJ29iamVjdCcgJiYKCQkJIShvLmNvbnN0cnVjdG9yLnRvU3RyaW5nKCkuaW5kZXhPZignZnVuY3Rpb24gRGF0ZSgpJykgPiAtMSkgJiYKCQkJIShvLmNvbnN0cnVjdG9yLnRvU3RyaW5nKCkuaW5kZXhPZignQXJyYXkoKScpID4gLTEpCgkJKTsKCX0KCglfdG9KUyhvKSB7CgkJaWYgKG8gPT0gbnVsbCkgcmV0dXJuICdudWxsJzsKCgkJdmFyIHMgPSAnJzsKCQlzd2l0Y2ggKHR5cGVvZiBvKSB7CgkJCWNhc2UgJ3N0cmluZyc6CgkJCQlzICs9CgkJCQkJJyInICsKCQkJCQl0aGlzLm15UmVwbGFjZSgKCQkJCQkJdGhpcy5lc2NhcGVTdHJpbmcobyksCgkJCQkJCVsnIjogLCddLAoJCQkJCQlbJyI6IG51bGwsJ10KCQkJCQkpICsKCQkJCQknIic7CgkJCQlicmVhazsKCQkJY2FzZSAnbnVtYmVyJzoKCQkJCXMgKz0gbzsKCQkJCWJyZWFrOwoJCQljYXNlICdib29sZWFuJzoKCQkJCXMgKz0gbyA/ICd0cnVlJyA6ICdmYWxzZSc7CgkJCQlicmVhazsKCQkJY2FzZSAnb2JqZWN0JzoKCQkJCS8vIERhdGUKCQkJCWlmIChvLmNvbnN0cnVjdG9yLnRvU3RyaW5nKCkuaW5kZXhPZignZnVuY3Rpb24gRGF0ZSgpJykgPiAtMSkgewoJCQkJCXZhciB5ZWFyID0gby5nZXRGdWxsWWVhcigpLnRvU3RyaW5nKCk7CgkJCQkJLy92YXIgbW9udGggPSAoby5nZXRNb250aCgpICsgMSkudG9TdHJpbmcoKTsgbW9udGggPSAobW9udGgubGVuZ3RoID09IDEpID8gIjAiICsgbW9udGggOiBtb250aDsKCQkJCQl2YXIgbW9udGggPSBvLmdldE1vbnRoKCkudG9TdHJpbmcoKTsKCQkJCQltb250aCA9IG1vbnRoLmxlbmd0aCA9PSAxID8gJzAnICsgbW9udGggOiBtb250aDsKCQkJCQl2YXIgZGF0ZSA9IG8uZ2V0RGF0ZSgpLnRvU3RyaW5nKCk7CgkJCQkJZGF0ZSA9IGRhdGUubGVuZ3RoID09IDEgPyAnMCcgKyBkYXRlIDogZGF0ZTsKCQkJCQl2YXIgaG91cnMgPSBvLmdldEhvdXJzKCkudG9TdHJpbmcoKTsKCQkJCQlob3VycyA9IGhvdXJzLmxlbmd0aCA9PSAxID8gJzAnICsgaG91cnMgOiBob3VyczsKCQkJCQl2YXIgbWludXRlcyA9IG8uZ2V0TWludXRlcygpLnRvU3RyaW5nKCk7CgkJCQkJbWludXRlcyA9IG1pbnV0ZXMubGVuZ3RoID09IDEgPyAnMCcgKyBtaW51dGVzIDogbWludXRlczsKCQkJCQl2YXIgc2Vjb25kcyA9IG8uZ2V0U2Vjb25kcygpLnRvU3RyaW5nKCk7CgkJCQkJc2Vjb25kcyA9IHNlY29uZHMubGVuZ3RoID09IDEgPyAnMCcgKyBzZWNvbmRzIDogc2Vjb25kczsKCQkJCQl2YXIgbWlsbGlzZWNvbmRzID0gby5nZXRNaWxsaXNlY29uZHMoKS50b1N0cmluZygpOwoJCQkJCXZhciB0em1pbnV0ZXMgPSBNYXRoLmFicyhvLmdldFRpbWV6b25lT2Zmc2V0KCkpOwoJCQkJCXZhciB0emhvdXJzID0gMDsKCQkJCQl3aGlsZSAodHptaW51dGVzID49IDYwKSB7CgkJCQkJCXR6aG91cnMrKzsKCQkJCQkJdHptaW51dGVzIC09IDYwOwoJCQkJCX0KCQkJCQl0em1pbnV0ZXMgPQoJCQkJCQl0em1pbnV0ZXMudG9TdHJpbmcoKS5sZW5ndGggPT0gMSA/CgkJCQkJCScwJyArIHR6bWludXRlcy50b1N0cmluZygpIDoKCQkJCQkJdHptaW51dGVzLnRvU3RyaW5nKCk7CgkJCQkJdHpob3VycyA9CgkJCQkJCXR6aG91cnMudG9TdHJpbmcoKS5sZW5ndGggPT0gMSA/CgkJCQkJCScwJyArIHR6aG91cnMudG9TdHJpbmcoKSA6CgkJCQkJCXR6aG91cnMudG9TdHJpbmcoKTsKCQkJCQl2YXIgdGltZXpvbmUgPQoJCQkJCQkoby5nZXRUaW1lem9uZU9mZnNldCgpIDwgMCA/ICcrJyA6ICctJykgKwoJCQkJCQl0emhvdXJzICsKCQkJCQkJJzonICsKCQkJCQkJdHptaW51dGVzOwoJCQkJCXMgKz0KCQkJCQkJJ25ldyBEYXRlKCcgKwoJCQkJCQl5ZWFyICsKCQkJCQkJJywnICsKCQkJCQkJbW9udGggKwoJCQkJCQknLCcgKwoJCQkJCQlkYXRlICsKCQkJCQkJJywnICsKCQkJCQkJaG91cnMgKwoJCQkJCQknLCcgKwoJCQkJCQltaW51dGVzICsKCQkJCQkJJywnICsKCQkJCQkJc2Vjb25kcyArCgkJCQkJCScsJyArCgkJCQkJCW1pbGxpc2Vjb25kcyArCgkJCQkJCScpJzsKCQkJCX0KCQkJCS8vIEFycmF5CgkJCQllbHNlIGlmIChvLmNvbnN0cnVjdG9yLnRvU3RyaW5nKCkuaW5kZXhPZignQXJyYXkoKScpID4gLTEpIHsKCQkJCQlzICs9ICdbJzsKCQkJCQlmb3IgKHZhciBwIGluIG8pIHsKCQkJCQkJcyArPSAnJzsKCQkJCQkJaWYgKCFpc05hTihwKSkgewoJCQkJCQkJLy8gbGluZWFyIGFycmF5CgkJCQkJCQlzICs9IHRoaXMuX3RvSlMob1twXSk7CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQkvLyBhc3NvY2lhdGl2ZSBhcnJheQoJCQkJCQkJcyArPSAneyInICsgcCArICciOiAnICsgdGhpcy5fdG9KUyhvW3BdKSArICd9JzsKCQkJCQkJfQoJCQkJCQlzICs9ICcsICc7CgkJCQkJfQoJCQkJCXMgKz0gJ10nOwoJCQkJfQoJCQkJLy8gT2JqZWN0IG9yIGN1c3RvbSBmdW5jdGlvbgoJCQkJZWxzZSB7CgkJCQkJcyArPSAneyc7CgkJCQkJZm9yICh2YXIgcCBpbiBvKSB7CgkJCQkJCXMgKz0gJyInICsgcCArICciOiAnICsgdGhpcy5fdG9KUyhvW3BdKSArICcsICc7CgkJCQkJfQoJCQkJCWlmIChzLmxhc3RJbmRleE9mKCcsICcpID09IHMubGVuZ3RoIC0gMikKCQkJCQkJcyA9IHMuc3Vic3RyaW5nKDAsIHMubGVuZ3RoIC0gMik7CgkJCQkJcyArPSAnfSc7CgkJCQl9CgkJCQlicmVhazsKCQkJY2FzZSAnZnVuY3Rpb24nOgoJCQkJLy8gZnVuY3Rpb25zIGFyZSBub3Qgd29ya2luZywgSUxMRUdBTCBUT0tFTi4uLi4KCQkJCS8vcyArPSAiXCIiK3RoaXMuZXNjYXBlU3RyaW5nKG8udG9TdHJpbmcoKSkrIlwiIjsKCQkJCXMgKz0gJ251bGwnOwoJCQkJYnJlYWs7CgkJCWRlZmF1bHQ6CgkJCQlzICs9ICdudWxsJzsKCQl9CgkJcmV0dXJuIHM7Cgl9CgoJZXNjYXBlU3RyaW5nKHRleHQpIHsKCQlpZiAoIWFyZ3VtZW50cy5jYWxsZWUuc1JFKSB7CgkJCXZhciBzcGVjaWFscyA9IFsKCQkJCSdccicsCgkJCQknXG4nLAoJCQkJJ1xmJywKCQkJCSdcYicsCgkJCQknXHQnLAoJCQkJIiciLAoJCQkJJyYnLAoJCQkJJy8nLAoJCQkJJy4nLAoJCQkJJyonLAoJCQkJJysnLAoJCQkJJz8nLAoJCQkJJ3wnLAoJCQkJJygnLAoJCQkJJyknLAoJCQkJJ1snLAoJCQkJJ10nLAoJCQkJJ3snLAoJCQkJJ30nLAoJCQkJJ1xcJywKCQkJCSciJywKCQkJXTsKCQkJYXJndW1lbnRzLmNhbGxlZS5zUkUgPSBuZXcgUmVnRXhwKAoJCQkJJyhcXCcgKyBzcGVjaWFscy5qb2luKCd8XFwnKSArICcpJywKCQkJCSdnJwoJCQkpOwoJCX0KCQl2YXIgcmV0ID0gdGV4dC5yZXBsYWNlKGFyZ3VtZW50cy5jYWxsZWUuc1JFLCAnXFwkMScpOwoKCQlyZXQgPSB0aGlzLm15UmVwbGFjZShyZXQsIFsnPCcsICc+J10sIFsnJmx0OycsICcmZ3Q7J10pOwoJCXJldCA9IHRoaXMubXlSZXBsYWNlKAoJCQlyZXQsCgkJCVsnXHInLCAnXG4nLCAnXHQnXSwKCQkJWydcXCcgKyAncicsICdcXCcgKyAnbicsICdcXCcgKyAndCddCgkJKTsKCgkJcmV0dXJuIHJldDsKCX0KCglpcEFkZHJlc3MoKSB7CgkJdHJ5IHsKCQkJaWYgKHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJykgcmV0dXJuIG51bGw7CgkJCWlmICh0eXBlb2YoZ2xvYmFsKSA9PT0gJ3VuZGVmaW5lZCcgfHwgdHlwZW9mKGdsb2JhbC5vcykgPT09ICd1bmRlZmluZWQnKSB7CgkJCQkvLyBjb25zb2xlLmxvZygiaXBBZGRyZXNzKCk6IEludmFsaWQgZ2xvYmFsIG9yIGdsb2JhbC5vcyBub3QgZGVmaW5lZCIpOwoJCQkJcmV0dXJuIG51bGw7CgkJCX0KCQkJcmV0dXJuIFtdLmNvbmNhdCguLi5PYmplY3QudmFsdWVzKGdsb2JhbC5vcy5uZXR3b3JrSW50ZXJmYWNlcygpKSkuZmluZCgoZGV0YWlscykgPT4gZGV0YWlscy5mYW1pbHkgPT09ICdJUHY0JyAmJiAhZGV0YWlscy5pbnRlcm5hbCkuYWRkcmVzczsKCQl9IGNhdGNoIChleCkgewoJCQljb25zb2xlLmxvZygiaXBBZGRyZXNzKCk6ICIgKyBleCk7CgkJCXJldHVybiBudWxsOwoJCX0KCX0KCglfdG9YTUwobywgbGV2ZWwpIHsKCQlpZiAoIWxldmVsKSBsZXZlbCA9IDA7CgkJdmFyIHMgPSAnJzsKCQlpZiAobyA9PSBudWxsKSByZXR1cm4gczsKCQlzd2l0Y2ggKHR5cGVvZiBvKSB7CgkJCWNhc2UgJ3N0cmluZyc6CgkJCQlzICs9ICc8IVtDREFUQVsnICsgbyArICddXT4nOwoJCQkJYnJlYWs7CgkJCWNhc2UgJ251bWJlcic6CgkJCWNhc2UgJ2Jvb2xlYW4nOgoJCQkJcyArPSBvLnRvU3RyaW5nKCk7CgkJCQlicmVhazsKCQkJY2FzZSAnb2JqZWN0JzoKCQkJCS8vIERhdGUKCQkJCWlmICgKCQkJCQlvLmNvbnN0cnVjdG9yICYmCgkJCQkJby5jb25zdHJ1Y3Rvci50b1N0cmluZygpLmluZGV4T2YoJ2Z1bmN0aW9uIERhdGUoKScpID4gLTEgJiYKCQkJCQlvLmNvbnN0cnVjdG9yLm5hbWUgPT0gIkRhdGUiCgkJCQkpIHsKCQkJCQl2YXIgeWVhciA9IG8uZ2V0VVRDRnVsbFllYXIoKS50b1N0cmluZygpOwoJCQkJCXZhciBtb250aCA9IChvLmdldFVUQ01vbnRoKCkgKyAxKS50b1N0cmluZygpOwoJCQkJCW1vbnRoID0gbW9udGgubGVuZ3RoID09IDEgPyAnMCcgKyBtb250aCA6IG1vbnRoOwoJCQkJCXZhciBkYXRlID0gby5nZXRVVENEYXRlKCkudG9TdHJpbmcoKTsKCQkJCQlkYXRlID0gZGF0ZS5sZW5ndGggPT0gMSA/ICcwJyArIGRhdGUgOiBkYXRlOwoJCQkJCXZhciBob3VycyA9IG8uZ2V0VVRDSG91cnMoKS50b1N0cmluZygpOwoJCQkJCWhvdXJzID0gaG91cnMubGVuZ3RoID09IDEgPyAnMCcgKyBob3VycyA6IGhvdXJzOwoJCQkJCXZhciBtaW51dGVzID0gby5nZXRVVENNaW51dGVzKCkudG9TdHJpbmcoKTsKCQkJCQltaW51dGVzID0gbWludXRlcy5sZW5ndGggPT0gMSA/ICcwJyArIG1pbnV0ZXMgOiBtaW51dGVzOwoJCQkJCXZhciBzZWNvbmRzID0gby5nZXRVVENTZWNvbmRzKCkudG9TdHJpbmcoKTsKCQkJCQlzZWNvbmRzID0gc2Vjb25kcy5sZW5ndGggPT0gMSA/ICcwJyArIHNlY29uZHMgOiBzZWNvbmRzOwoJCQkJCXZhciBtaWxsaXNlY29uZHMgPSBvLmdldFVUQ01pbGxpc2Vjb25kcygpLnRvU3RyaW5nKCk7CgkJCQkJdmFyIHR6bWludXRlcyA9IE1hdGguYWJzKG8uZ2V0VGltZXpvbmVPZmZzZXQoKSk7CgkJCQkJdmFyIHR6aG91cnMgPSAwOwoJCQkJCXdoaWxlICh0em1pbnV0ZXMgPj0gNjApIHsKCQkJCQkJdHpob3VycysrOwoJCQkJCQl0em1pbnV0ZXMgLT0gNjA7CgkJCQkJfQoJCQkJCXR6bWludXRlcyA9CgkJCQkJCXR6bWludXRlcy50b1N0cmluZygpLmxlbmd0aCA9PSAxID8KCQkJCQkJJzAnICsgdHptaW51dGVzLnRvU3RyaW5nKCkgOgoJCQkJCQl0em1pbnV0ZXMudG9TdHJpbmcoKTsKCQkJCQl0emhvdXJzID0KCQkJCQkJdHpob3Vycy50b1N0cmluZygpLmxlbmd0aCA9PSAxID8KCQkJCQkJJzAnICsgdHpob3Vycy50b1N0cmluZygpIDoKCQkJCQkJdHpob3Vycy50b1N0cmluZygpOwoJCQkJCXZhciB0aW1lem9uZSA9CgkJCQkJCShvLmdldFRpbWV6b25lT2Zmc2V0KCkgPCAwID8gJysnIDogJy0nKSArCgkJCQkJCXR6aG91cnMgKwoJCQkJCQknOicgKwoJCQkJCQl0em1pbnV0ZXM7CgkJCQkJLy9zICs9IHllYXIgKyAiLSIgKyBtb250aCArICItIiArIGRhdGUgKyAiVCIgKyBob3VycyArICI6IiArIG1pbnV0ZXMgKyAiOiIgKyBzZWNvbmRzICsgIi4iICsgbWlsbGlzZWNvbmRzICsgdGltZXpvbmU7CgkJCQkJcyArPQoJCQkJCQltb250aCArCgkJCQkJCScvJyArCgkJCQkJCWRhdGUgKwoJCQkJCQknLycgKwoJCQkJCQl5ZWFyICsKCQkJCQkJJyAnICsKCQkJCQkJaG91cnMgKwoJCQkJCQknOicgKwoJCQkJCQltaW51dGVzICsKCQkJCQkJJzonICsKCQkJCQkJc2Vjb25kczsKCQkJCX0KCQkJCS8vIEFycmF5CgkJCQllbHNlIGlmICgKCQkJCQlvLmNvbnN0cnVjdG9yICYmCgkJCQkJby5jb25zdHJ1Y3Rvci50b1N0cmluZygpLmluZGV4T2YoJ0FycmF5KCknKSA+IC0xCgkJCQkpIHsKCQkJCQlmb3IgKHZhciBwIGluIG8pIHsKCQkJCQkJaWYgKHAgPT0gJ09QRVJBVE9SUycgfHwgcCA9PSAnT1JTJykgY29udGludWU7CgkJCQkJCXMgKz0gJzxPYmplY3Q+JzsKCQkJCQkJaWYgKCFpc05hTihwKSkgewoJCQkJCQkJLy8gbGluZWFyIGFycmF5CgkJCQkJCQlpZiAob1twXSA9PSBudWxsKSB7CgkJCQkJCQkJLy8gbnVsbCBlbnRyeSBpbiB0aGUgYXJyYXkKCQkJCQkJCQlzICs9ICc8SWQ+MDwvSWQ+JzsKCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJL2Z1bmN0aW9uXHMrKFx3KilccypcKC9naS5leGVjKAoJCQkJCQkJCQlvW3BdLmNvbnN0cnVjdG9yLnRvU3RyaW5nKCkKCQkJCQkJCQkpOwoJCQkJCQkJCXZhciB0eXBlID0gUmVnRXhwLiQxOwoJCQkJCQkJCXN3aXRjaCAodHlwZSkgewoJCQkJCQkJCQljYXNlICcnOgoJCQkJCQkJCQkJdHlwZSA9IHR5cGVvZiBvW3BdOwoJCQkJCQkJCQkJYnJlYWs7CgkJCQkJCQkJCWNhc2UgJ1N0cmluZyc6CgkJCQkJCQkJCQl0eXBlID0gJ3N0cmluZyc7CgkJCQkJCQkJCQlicmVhazsKCQkJCQkJCQkJY2FzZSAnTnVtYmVyJzoKCQkJCQkJCQkJCXR5cGUgPSAnaW50JzsKCQkJCQkJCQkJCWJyZWFrOwoJCQkJCQkJCQljYXNlICdCb29sZWFuJzoKCQkJCQkJCQkJCXR5cGUgPSAnYm9vbCc7CgkJCQkJCQkJCQlicmVhazsKCQkJCQkJCQkJY2FzZSAnRGF0ZSc6CgkJCQkJCQkJCQl0eXBlID0gJ0RhdGVUaW1lJzsKCQkJCQkJCQkJCWJyZWFrOwoJCQkJCQkJCX0KCQkJCQkJCQlzICs9IHRoaXMuX3RvWE1MKG9bcF0sIGxldmVsKyspOwoJCQkJCQkJfQoJCQkJCQl9IGVsc2UgewoJCQkJCQkJLy8gYXNzb2NpYXRpdmUgYXJyYXkKCQkJCQkJCXMgKz0KCQkJCQkJCQknPCcgKwoJCQkJCQkJCXAgKwoJCQkJCQkJCXRoaXMuY29vcChvLCBwKSArCgkJCQkJCQkJJz4nICsKCQkJCQkJCQl0aGlzLl90b1hNTChvW3BdLCBsZXZlbCsrKSArCgkJCQkJCQkJJzwvJyArCgkJCQkJCQkJcCArCgkJCQkJCQkJJz4nOwoJCQkJCQl9CgkJCQkJCXMgKz0gJzwvT2JqZWN0PicgKyB0aGlzLkNSTkw7CgkJCQkJfQoJCQkJfQoJCQkJLy8gT2JqZWN0IG9yIGN1c3RvbSBmdW5jdGlvbgoJCQkJZWxzZSB7CgkJCQkJaWYgKG8gPT0gbnVsbCB8fCBvLklkID09IDApIHt9IGVsc2UgaWYgKGZhbHNlICYmIG8uSWQpIHsKCQkJCQkJLy8gdGhpcyBpcyBjcmVhdGluZyBhIHByb2JsZW0sIGJldHRlciBzZW5kIGFsbCB0aGUgb2JqZWN0CgkJCQkJCS8vIGRvIG5vdCBzZW5kIG90aGVyIGRhdGEgaWYgd2UgaGF2ZSBhIHZhbHVlIGZvciB0aGUgSWQKCQkJCQkJcyArPSAnPElkPicgKyB0aGlzLl90b1hNTChvLklkLCBsZXZlbCsrKSArICc8L0lkPic7CgkJCQkJfSBlbHNlIHsKCQkJCQkJZm9yICh2YXIgcCBpbiBvKSB7CgkJCQkJCQlpZiAocCA9PSAnT1BFUkFUT1JTJyB8fCBwID09ICdPUlMnKSBjb250aW51ZTsKCQkJCQkJCXMgKz0KCQkJCQkJCQknPCcgKwoJCQkJCQkJCXAgKwoJCQkJCQkJCXRoaXMuY29vcChvLCBwKSArCgkJCQkJCQkJdGhpcy5PUihvLCBwKSArCgkJCQkJCQkJJz4nICsKCQkJCQkJCQl0aGlzLl90b1hNTChvW3BdLCBsZXZlbCsrKSArCgkJCQkJCQkJJzwvJyArCgkJCQkJCQkJcCArCgkJCQkJCQkJJz4nOwoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQkJYnJlYWs7CgkJfQoJCXJldHVybiBzOwoJfQoKCU9SKG8sIHApIHsKCQlyZXR1cm4gby5PUlMgJiYgby5PUlNbcF0gPwoJCQkiIE9SPSciICsKCQkJdGhpcy5teVJlcGxhY2Uoby5PUlNbcF0sIFsnPCcsICc+J10sIFsnJmx0OycsICcmZ3Q7J10pICsKCQkJIiciIDoKCQkJJyc7Cgl9CgoJY29vcChvLCBwKSB7CgkJaWYgKCFvLk9QRVJBVE9SUyB8fCAhby5PUEVSQVRPUlNbcF0pIHsKCQkJcmV0dXJuICcnOwoJCX0KCQlyZXR1cm4gKAoJCQkiIGNvb3A9JyIgKwoJCQl0aGlzLm15UmVwbGFjZShvLk9QRVJBVE9SU1twXSwgWyc8JywgJz4nXSwgWycmbHQ7JywgJyZndDsnXSkgKwoJCQkiJyIKCQkpOwoJfQoKCWdldFhtbEhUVFAoKSB7CgkJdmFyIHggPSBudWxsOwoJCXZhciBhY3RpdmV4bW9kZXMgPSBbJ01zeG1sMi5YTUxIVFRQJywgJ01pY3Jvc29mdC5YTUxIVFRQJ107IC8vYWN0aXZlWCB2ZXJzaW9ucyB0byBjaGVjayBmb3IgaW4gSUUKCQlpZiAod2luZG93LkFjdGl2ZVhPYmplY3QpIHsKCQkJLy9UZXN0IGZvciBzdXBwb3J0IGZvciBBY3RpdmVYT2JqZWN0IGluIElFIGZpcnN0IChhcyBYTUxIdHRwUmVxdWVzdCBpbiBJRTcgaXMgYnJva2VuKQoJCQlmb3IgKHZhciBpID0gMDsgaSA8IGFjdGl2ZXhtb2Rlcy5sZW5ndGg7IGkrKykgewoJCQkJdHJ5IHsKCQkJCQl4ID0gbmV3IEFjdGl2ZVhPYmplY3QoYWN0aXZleG1vZGVzW2ldKTsKCQkJCQlicmVhazsKCQkJCX0gY2F0Y2ggKGUpIHsKCQkJCQkvL3N1cHByZXNzIGVycm9yCgkJCQl9CgkJCX0KCQl9IGVsc2UgaWYgKHdpbmRvdy5YTUxIdHRwUmVxdWVzdCkgewoJCQkvLyBpZiBNb3ppbGxhLCBTYWZhcmkgZXRjCgkJCXggPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTsKCQl9IGVsc2UgewoJCQl4ID0gbnVsbDsKCQl9CgoJCXJldHVybiAod2luZG93LnhtbEhUVFAgPSB4KTsKCX0KCglhc3luYyBjYWNoZVJlc3VsdChyZXF1ZXN0LCB0ZXh0cmVzcG9uc2UpIHsKCQlpZiAoIXRoaXMuYkNhY2hlUmVzdWx0KSByZXR1cm47CgkJcmVxdWVzdCA9IHJlcXVlc3QgfHwgdGhpcy5BY3RpdmVSZXF1ZXN0OwoKCQlpZiAoIXJlcXVlc3QpIHsKCQkJcmV0dXJuOwoJCX0KCgkJaWYgKAoJCQl0ZXh0cmVzcG9uc2UgJiYKCQkJdGV4dHJlc3BvbnNlLmluZGV4T2YoJ3JldC5Db2RlID0gJykgPiAtMSAmJgoJCQl0ZXh0cmVzcG9uc2UuaW5kZXhPZigncmV0LlJ1bkFmdGVyID0gJykgPiAtMSAmJgoJCQl0ZXh0cmVzcG9uc2UuaW5kZXhPZigncmV0LlJlc3VsdCA9ICIiJykgPiAtMQoJCSkgewoJCQljb25zb2xlLmxvZygndGV4dHJlc3BvbnNlIGNvbnRpYW5zIGluY29tcGxldGUgbWV0aG9kIHJlc3VsdCcpOwoJCQlyZXR1cm4gbnVsbDsKCQl9CgoJCXZhciBzTWV0aG9kID0gdGhpcy4kX1JFUVVFU1QoJ25hbWUnLCByZXF1ZXN0LlVSTCk7CgkJc01ldGhvZCA9IHNNZXRob2Quc3Vic3RyaW5nKHNNZXRob2QubGFzdEluZGV4T2YoJy4nKSArIDEpOwoJCXRyeSB7CgkJCXZhciBfdXNhYmxlID0gKHIpID0+IHsKCQkJCXZhciBpdGVtID0KCQkJCQkociAmJgoJCQkJCQlyLmhhc2ggPT0gcmVxdWVzdC5oYXNoICYmCgkJCQkJCShyLlVSTCA9PSByZXF1ZXN0LlVSTCB8fCB0aGlzLiRfUkVRVUVTVCgnbmFtZScsIHIuVVJMKSA9PSBzTWV0aG9kKSAmJgoJCQkJCQlyLlRleHRSZXNwb25zZSAmJgoJCQkJCQkodHlwZW9mIHIuRXhwaXJlcyA9PT0gJ3VuZGVmaW5lZCcgfHwKCQkJCQkJCW5ldyBEYXRlKHIuRXhwaXJlcykgPiBuZXcgRGF0ZSgpKSkgPwoJCQkJCXIgOgoJCQkJCW51bGw7CgkJCQlpZiAodGV4dHJlc3BvbnNlKSB7CgkJCQkJaXRlbSA9IGl0ZW0gfHwgcmVxdWVzdDsKCQkJCQlpdGVtLlRleHRSZXNwb25zZSA9IHRleHRyZXNwb25zZTsKCQkJCQlpdGVtLkV4cGlyZXMgPSBuZXcgRGF0ZSgKCQkJCQkJbmV3IERhdGUoKS5nZXRUaW1lKCkgKwoJCQkJCQlwYXJzZUZsb2F0KAoJCQkJCQkJdGhpcy5uQ2FjaGVFeHBpcmVIb3VycyB8fCB0aGlzLiRfUkVRVUVTVCgnbkNhY2hlRXhwaXJlSG91cnMnKSB8fCAxCgkJCQkJCSkgKgoJCQkJCQk2MCAqCgkJCQkJCTYwICoKCQkJCQkJMTAwMAoJCQkJCSk7CgkJCQl9CgoJCQkJcmV0dXJuIGl0ZW07CgkJCX07CgoJCQlpZiAoCgkJCQl0aGlzLmJDYWNoZVJlc3VsdCA9PSAna3ZzdG9yZScgJiYKCQkJCXR5cGVvZiB3aW5kb3cuY29tcGFueS5yZXN0aW9kYlNldHRpbmdzICE9PSAndW5kZWZpbmVkJwoJCQkpIHsKCQkJCXZhciBhamF4ID0gKGtleSwgdmFsdWUsIGlkKSA9PiB7CgkJCQkJdmFyIHJldCA9IGNvbXBhbnkucmVzdGlvZGJTZXR0aW5ncygpOwoJCQkJCXJldC51cmwgKz0gJ2t2c3RvcmUnOwoJCQkJCWlmICh2YWx1ZSkgewoJCQkJCQlpZiAoaWQpIHsKCQkJCQkJCS8vIHVwZGF0ZSByZWNvcmQKCQkJCQkJCXJldC51cmwgKz0gJy8nICsgaWQ7CgkJCQkJCQlyZXQubWV0aG9kID0gJ1BVVCc7CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQkvLyBuZXcgcmVjb3JkCgkJCQkJCQlyZXQubWV0aG9kID0gJ1BPU1QnOwoJCQkJCQl9CgkJCQkJCXJldC5kYXRhID0gSlNPTi5zdHJpbmdpZnkoewoJCQkJCQkJa2V5OiBrZXksCgkJCQkJCQl2YWx1ZTogSlNPTi5zdHJpbmdpZnkodmFsdWUsIG51bGwsIDQpLAoJCQkJCQl9KTsKCQkJCQl9IGVsc2UgewoJCQkJCQlpZiAoaWQpIHsKCQkJCQkJCS8vIGRlbGV0ZSByZWNvcmQKCQkJCQkJCXJldC51cmwgKz0gJy8nICsgaWQ7CgkJCQkJCQlyZXQubWV0aG9kID0gJ0RFTEVURSc7CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQlyZXQubWV0aG9kID0gJ0dFVCc7CgkJCQkJCQlyZXQudXJsICs9ICc/cT17ImtleSI6JyArIGtleSArICd9JzsKCQkJCQkJfQoJCQkJCX0KCQkJCQkvL2NvbnNvbGUubG9nKCdtZXRob2QnLCByZXQubWV0aG9kKTsKCQkJCQlyZXR1cm4gcmV0OwoJCQkJfTsKCgkJCQlsZXQgcmVjb3JkID0gYXdhaXQgJC5hamF4KGFqYXgocmVxdWVzdC5oYXNoKSk7CgkJCQlsZXQgciA9CgkJCQkJcmVjb3JkICYmIHJlY29yZC5sZW5ndGggPwoJCQkJCUpTT04ucGFyc2UocmVjb3JkWzBdLnZhbHVlKSA6CgkJCQkJbnVsbDsKCQkJCWxldCBpdGVtID0gX3VzYWJsZShyKTsKCgkJCQlpZiAoIWl0ZW0pIHsKCQkJCQlpZiAocikgewoJCQkJCQlhd2FpdCAkLmFqYXgoYWpheChyZXF1ZXN0Lmhhc2gsIG51bGwsIHJlY29yZFswXS5faWQpKTsKCQkJCQl9CgkJCQkJcmV0dXJuIG51bGw7CgkJCQl9CgoJCQkJaWYgKCFyIHx8IGl0ZW0uRXhwaXJlcyA+IHIuRXhwaXJlcykgewoJCQkJCWF3YWl0ICQuYWpheCgKCQkJCQkJYWpheChpdGVtLmhhc2gsIGl0ZW0sIHIgPyByZWNvcmRbMF0uX2lkIDogbnVsbCkKCQkJCQkpOwoJCQkJCXJldHVybiBpdGVtOwoJCQkJfQoKCQkJCXJldHVybiBpdGVtOwoJCQl9IGVsc2UgaWYgKHRoaXMuYkNhY2hlUmVzdWx0ID09ICdzcicpIHsKCQkJCXZhciBhamF4ID0gKGtleSwgdmFsdWUsIGlkKSA9PiB7CgkJCQkJdmFyIG1ldGhvZCA9ICdGaW5kJzsKCQkJCQl2YXIgcmV0ID0gewoJCQkJCQl1cmw6ICcvbWV0aG9kL2EuYXNoeD9uYW1lPUNvbnRlbnRNYW5hZ2VyLmNtc01ldGhvZFJlc3VsdCcsCgkJCQkJCXByb2Nlc3NEYXRhOiBmYWxzZSwKCQkJCQkJdHlwZTogJ1BPU1QnLAoJCQkJCX07CgkJCQkJaWYgKHZhbHVlKSB7CgkJCQkJCWlmIChpZCkgewoJCQkJCQkJLy8gdXBkYXRlIHJlY29yZAoJCQkJCQkJbWV0aG9kID0gJ1VwZGF0ZSc7CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQkvLyBuZXcgcmVjb3JkCgkJCQkJCQltZXRob2QgPSAnSW5zZXJ0JzsKCQkJCQkJfQoJCQkJCQlyZXQuYmVmb3JlU2VuZCA9IChyZXF1ZXN0KSA9PiB7CgkJCQkJCQlyZXF1ZXN0LnNldFJlcXVlc3RIZWFkZXIoCgkJCQkJCQkJJ0NvbnRlbnQtVHlwZScsCgkJCQkJCQkJJ211bHRpcGFydC9mb3JtLWRhdGE7IGJvdW5kYXJ5PS0tLS0tLS0tLS0tLS0tJwoJCQkJCQkJKTsKCQkJCQkJfTsKCQkJCQl9IGVsc2UgewoJCQkJCQlyZXQudHlwZSA9ICdHRVQnOwoJCQkJCQlpZiAoaWQpIHsKCQkJCQkJCS8vIGRlbGV0ZSByZWNvcmQKCQkJCQkJCW1ldGhvZCA9ICdEZWxldGUnOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJLy8gZ2V0IHJlY29yZAoJCQkJCQkJbWV0aG9kID0gJ0ZpbmQnOwoJCQkJCQl9CgkJCQkJCW1ldGhvZCArPQoJCQkJCQkJJyZwMD17Q29kZX0nICsKCQkJCQkJCShjb21wYW55ID8gY29tcGFueS5Db2RlICsgJy0nIDogJycpICsKCQkJCQkJCWtleSArCgkJCQkJCQkney9Db2RlfSc7CgkJCQkJfQoJCQkJCXJldC51cmwgKz0gbWV0aG9kOwoJCQkJCWlmIChyZXQudHlwZSAhPSAnR0VUJykgewoJCQkJCQlkZWxldGUgaXRlbS5Qb3N0RGF0YTsgLy8gYmVjYXVzZSB3ZSBoYXZlIHRoZSBjYWNoZSBrZXkKCQkJCQkJdmFyIHAwID0gewoJCQkJCQkJQ29kZTogKGNvbXBhbnkgPyBjb21wYW55LkNvZGUgKyAnLScgOiAnJykgKyBrZXksCgkJCQkJCQlDb21wbGV0ZWQ6IG5ldyBEYXRlKCksCgkJCQkJCQlEYXRlOiB0aGlzLkFjdGl2ZVJlcXVlc3QgPwoJCQkJCQkJCXRoaXMuQWN0aXZlUmVxdWVzdC5EYXRlIDogbmV3IERhdGUoKSwKCQkJCQkJCVJlc3VsdDogYnRvYSh1bmVzY2FwZShlbmNvZGVVUklDb21wb25lbnQoSlNPTi5zdHJpbmdpZnkoaXRlbSkpKSksIC8vaXRlbS5UZXh0UmVzcG9uc2UsCgkJCQkJCQlTdG9yZWRNZXRob2Q6IHsKCQkJCQkJCQlOYW1lOiBzTWV0aG9kLAoJCQkJCQkJfSwKCQkJCQkJfTsKCQkJCQkJaWYgKGlkKSB7CgkJCQkJCQlwMC5JZCA9IGlkOwoJCQkJCQl9CgkJCQkJCXJldC5kYXRhID0KCQkJCQkJCSdQT1NUREFUQT1cclxuJyAvKisgIjw/eG1sIHZlcnNpb249XCIxLjBcIiBlbmNvZGluZz1cInV0Zi04XCIgc3RhbmRhbG9uZT1cInllc1wiPz5cclxuIiovICsKCQkJCQkJCXRoaXMucGFyYW0oW3AwXSk7CgkJCQkJfQoJCQkJCXJldHVybiByZXQ7CgkJCQl9OwoKCQkJCWxldCByZWNvcmQgPSB0aGlzLnJ1blNjcmlwdCAvKnJ1blNSU2NyaXB0Ki8oCgkJCQkJJygoKSA9PiB7IHZhciByZXQgPSBudWxsOyAnICsKCQkJCQkoYXdhaXQgJC5hamF4KGFqYXgocmVxdWVzdC5oYXNoKSkpICsKCQkJCQkncmV0dXJuIHJldDt9KSgpOycKCQkJCSk7CgkJCQlsZXQgciA9IHJlY29yZCA/IEpTT04ucGFyc2UocmVjb3JkLlJlc3VsdCkgOiBudWxsOwoJCQkJbGV0IGl0ZW0gPSBfdXNhYmxlKHIpOwoKCQkJCWlmICghaXRlbSkgewoJCQkJCWlmIChyKSB7CgkJCQkJCXRyeSB7CgkJCQkJCQlhd2FpdCAkLmFqYXgoYWpheChyZXF1ZXN0Lmhhc2gsIG51bGwsIHJlY29yZC5JZCkpOwoJCQkJCQl9IGNhdGNoIChleCkge30KCQkJCQl9CgkJCQkJcmV0dXJuIG51bGw7CgkJCQl9CgoJCQkJaWYgKCFyIHx8IGl0ZW0uRXhwaXJlcyA+IHIuRXhwaXJlcykgewoJCQkJCWF3YWl0ICQuYWpheCgKCQkJCQkJYWpheChpdGVtLmhhc2gsIGl0ZW0sIHIgJiYgcmVjb3JkID8gcmVjb3JkLklkIDogbnVsbCkKCQkJCQkpOwoJCQkJCXJldHVybiBpdGVtOwoJCQkJfQoKCQkJCXJldHVybiBpdGVtOwoJCQl9IGVsc2UgaWYgKHRoaXMuYkNhY2hlUmVzdWx0ID09ICdnaXRodWInKSB7CgkJCQlpZiAocmVxdWVzdC5VUkwuaW5kZXhPZignY21zTWV0aG9kUmVzdWx0JykgPj0gMCkgcmV0dXJuIG51bGw7CgkJCQlsZXQgcmVzID0gbnVsbDsKCQkJCXRyeSB7CgkJCQkJcmVzID0gYXdhaXQgJC5hamF4KHsKCQkJCQkJdXJsOiAnaHR0cHM6Ly9hcnpob3NwaXRhbC5naXRodWIuaW8vJyArCgkJCQkJCQljb21wYW55LlN0b3JlICsKCQkJCQkJCScvJyArCgkJCQkJCQlyZXF1ZXN0Lmhhc2ggKwoJCQkJCQkJJy5qcycsCgkJCQkJCWRhdGFUeXBlOiAnanNvbnAnLAoJCQkJCQlwcm9jZXNzUmVzdWx0OiBmYWxzZSwKCQkJCQl9KTsKCQkJCQlyZXR1cm4gewoJCQkJCQlUZXh0UmVzcG9uc2U6IHJlcywKCQkJCQl9OwoJCQkJfSBjYXRjaCAoZXgpIHsKCQkJCQljb25zb2xlLmxvZygnRVJST1JTOicsIGV4KTsKCQkJCQlyZXR1cm4gbnVsbDsKCQkJCX0KCQkJfSBlbHNlIGlmICh0aGlzLmJDYWNoZVJlc3VsdCA9PSAnbG9jYWwnKSB7CgkJCQl2YXIgc3JDYWNoZSA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdzckNhY2hlJyk7CgkJCQlpZiAoc3JDYWNoZSA9PSBudWxsKSB7CgkJCQkJc3JDYWNoZSA9IHsKCQkJCQkJUmVxdWVzdHM6IHt9LAoJCQkJCX07CgkJCQl9IGVsc2UgewoJCQkJCXNyQ2FjaGUgPSBKU09OLnBhcnNlKHNyQ2FjaGUpOwoJCQkJfQoKCQkJCXZhciByID0gc3JDYWNoZS5SZXF1ZXN0c1tyZXF1ZXN0Lmhhc2hdOwoJCQkJdmFyIGl0ZW0gPSBfdXNhYmxlKHIpOwoKCQkJCWlmICghaXRlbSkgewoJCQkJCWRlbGV0ZSBzckNhY2hlLlJlcXVlc3RzW3JlcXVlc3QuaGFzaF07CgkJCQkJbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ3NyQ2FjaGUnLCBKU09OLnN0cmluZ2lmeShzckNhY2hlKSk7CgkJCQkJcmV0dXJuIG51bGw7CgkJCQl9CgoJCQkJaWYgKCFyIHx8IGl0ZW0uRXhwaXJlcyA+IHIuRXhwaXJlcykgewoJCQkJCXNyQ2FjaGUuUmVxdWVzdHNbaXRlbS5oYXNoXSA9IGl0ZW07CgkJCQkJbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ3NyQ2FjaGUnLCBKU09OLnN0cmluZ2lmeShzckNhY2hlKSk7CgkJCQkJcmV0dXJuIGl0ZW07CgkJCQl9CgoJCQkJcmV0dXJuIGl0ZW07CgkJCX0KCQl9IGNhdGNoIChleCkgewoJCQljb25zb2xlLmxvZyhleCk7CgkJCXRocm93IGV4OwoJCX0KCX0KCglhc3luYyBfKGZ1biwgY2FsbEJhY2spIHsKCQlpZiAodGhpcy5zX0Vycm9yTWVzc2FnZXMgJiYgdGhpcy5zX0Vycm9yTWVzc2FnZXMubGVuZ3RoID4gMCkgewoJCQlhbGVydCgKCQkJCSdUaGUgZm9sbG93aW5nIGVycm9ycyB3ZXJlIGZvdW5kIGluIHlvdXIgZGF0YTpcbicgKwoJCQkJdGhpcy5zX0Vycm9yTWVzc2FnZXMKCQkJKTsKCQkJdGhpcy5zX0Vycm9yTWVzc2FnZXMgPSAnJzsKCQkJcmV0dXJuIG51bGw7CgkJfQoKCQl0aGlzLmJ1aWxkVVJMKCk7CgoJCWlmICh0eXBlb2YoZG9jdW1lbnQpICE9PSAidW5kZWZpbmVkIikoCgkJCXRoaXMuZkxvYWRpbmdTdGFydCB8fAoJCQlmdW5jdGlvbigpIHsKCQkJCWlmIChkb2N1bWVudC5ib2R5KSBkb2N1bWVudC5ib2R5LnN0eWxlLmN1cnNvciA9ICd3YWl0JzsKCQkJfQoJCSkoKTsKCgkJdmFyIGFyZ3MgPSBBcnJheSgpOwoJCWZvciAodmFyIGkgPSAyOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7CgkJCWFyZ3NbaSAtIDJdID0gYXJndW1lbnRzW2ldOwoJCX0KCgkJaWYgKHR5cGVvZihfRnJFTUQpICE9PSAndW5kZWZpbmVkJyAmJiBfRnJFTUQuYXBpU2VydmVyKSB7CgkJCWxldCBmUGFydHMgPSBmdW4uc3BsaXQoJy4nKTsKCQkJbGV0IGxpYiA9IGZQYXJ0cy5sZW5ndGggPiAxID8gZlBhcnRzWzBdIDogJ0NvbnRlbnRNYW5hZ2VyJzsKCQkJbGV0IGYgPSBmUGFydHMubGVuZ3RoID4gMSA/IGZQYXJ0c1sxXSA6IGZ1bjsKCgkJCWZQYXJ0cyA9IGYucmVwbGFjZSgvKFthLXowLTldKShbQS1aXSkvZywgJyQxLiQyJykuc3BsaXQoJy4nKTsKCgkJCWxldCBlYyA9IGZQYXJ0cy5zbGljZSgxLCAtMSkuam9pbignJyk7CgkJCWxldCBmbmFtZSA9IGZQYXJ0cy5zbGljZSgtMSlbMF07CgkJCWxldCBzY29wZSA9IGxpYi50b0xvd2VyQ2FzZSgpOwoKCQkJY29uc29sZS5sb2coImNhbGxpbmcuLi4gX0ZyRU1ELmFwaVNlcnZlci5fbmV3KCIgKyBlYyArICIpLiIgKyBmbmFtZSArICIoKS4uLiAiIC8qICsgSlNPTi5zdHJpbmdpZnkoYXJncywgbnVsbCwgNCkqLyApOwoKCQkJcmV0dXJuIGF3YWl0IF9GckVNRC5hcGlTZXJ2ZXIuX25ldyhlYylbZm5hbWVdKGFyZ3MpOwoJCX0KCgkJdmFyIHBvc3REYXRhID0gdGhpcy5wYXJhbShhcmdzKTsKCQlpZiAoZnVuLmluZGV4T2YoJy4nKSA8IDApIHsKCQkJZnVuID0gdGhpcy5zeXN0ZW1OYW1lICsgJy4nICsgZnVuOwoJCX0gZWxzZSBpZiAoZnVuLmluZGV4T2YoJy4nKSA9PSAwKSB7CgkJCS8vIGEgbm9uLWxheWVyIG1ldGhvZAoJCQlmdW4gPSBmdW4uc3Vic3RyaW5nKDEpOwoJCX0KCgkJaWYgKGNhbGxCYWNrICYmIHRoaXMuQWN0aXZlUmVxdWVzdCkgewoJCQl0aGlzLkFjdGl2ZVJlcXVlc3QgPSBudWxsOwoJCQkvL3JldHVybiBmYWxzZTsKCQl9CgoJCXZhciBoQ29kZSA9IHRoaXMuaGFzaENvZGUoCgkJCWZ1bi5zdWJzdHJpbmcoZnVuLmluZGV4T2YoJy4nKSArIDEpICsgcG9zdERhdGEKCQkpOwoKCQl0aGlzLkNSTkwgPSB0aGlzLkNSTkwgfHwgIlxuIjsKCQlwb3N0RGF0YSArPQoJCQl0aGlzLkNSTkwgKwoJCQl0aGlzLkNSTkwgKwoJCQknPCEtLTxwaWQ+JyArCgkJCWhDb2RlICsKCQkJJzwvcGlkPi0tPicgKwoJCQl0aGlzLkNSTkw7CgoJCWlmIChmdW4uaW5kZXhPZignY21zTWV0aG9kUmVzdWx0RmluZCcpIDwgMCkgewoJCQkvLyBhdm9pZCBvdmVyd3JpdGUgb2YgYXN5bmMgY2FsbHMKCQkJdGhpcy5BY3RpdmVSZXF1ZXN0ID0gewoJCQkJVVJMOiB0aGlzLnNyVVJMICsgJyZuYW1lPScgKyBmdW4sCgkJCQlQb3N0RGF0YTogcG9zdERhdGEsCgkJCQlEYXRlOiBuZXcgRGF0ZSgpLAoJCQkJQ2FsbEJhY2s6IGNhbGxCYWNrLAoJCQkJQ29tcGFueTogdHlwZW9mIGNvbXBhbnkgIT09ICd1bmRlZmluZWQnICYmIGNvbXBhbnkgPyB7CgkJCQkJQ29kZTogY29tcGFueS5Db2RlLAoJCQkJfSA6IG51bGwsCgkJCQlUZXh0UmVzcG9uc2U6IG51bGwsCgkJCQloYXNoOiBoQ29kZSwKCQkJfTsKCQl9CgoJCWlmICh0eXBlb2Yod2luZG93KSAhPT0gInVuZGVmaW5lZCIgJiYgIXRoaXMuYkxvY2FsKSB7CgkJCS8vIGxpdmUKCQkJdHJ5IHsKCQkJCXZhciBfdGhlVXJsID0KCQkJCQkodGhpcy5TdG9yZSB8fAoJCQkJCQknL3N0b3JlLycgKwoJCQkJCQkod2luZG93LmNvbXBhbnkgJiYgd2luZG93LmNvbXBhbnkuQ29kZSA/CgkJCQkJCQl3aW5kb3cuY29tcGFueS5Db2RlICsgJy8nIDoKCQkJCQkJCScvJykpICsKCQkJCQloQ29kZSArCgkJCQkJJy5qcz9yYW5kPScgKwoJCQkJCU1hdGgucmFuZG9tKCk7CgkJCQlsZXQgcmVxdWVzdCA9IGF3YWl0IHRoaXMuY2FjaGVSZXN1bHQoKTsKCQkJCXZhciByZXNwb25zZVRleHQgPSBudWxsOwoJCQkJaWYgKCFyZXF1ZXN0KSB7CgkJCQkJdHJ5IHsKCQkJCQkJcmVzcG9uc2VUZXh0ID0gYXdhaXQgJC5nZXQoX3RoZVVybCk7CgkJCQkJfSBjYXRjaCAoZXgpIHt9CgkJCQl9IGVsc2UgewoJCQkJCXJlc3BvbnNlVGV4dCA9IHJlcXVlc3QuVGV4dFJlc3BvbnNlOwoJCQkJfQoJCQkJaWYgKCFyZXNwb25zZVRleHQpIHsKCQkJCQljb25zb2xlLmxvZygKCQkJCQkJJ0xpdmUgTW9kZSwgbm8gcmVzcG9uc2UgdGV4dCBmb3IgJyArCgkJCQkJCXRoaXMuQWN0aXZlUmVxdWVzdC5oYXNoICsKCQkJCQkJJyAtICcgKwoJCQkJCQl0aGlzLiRfUkVRVUVTVCgnbmFtZScsIHRoaXMuQWN0aXZlUmVxdWVzdC5VUkwpCgkJCQkJKTsKCQkJCQlyZXR1cm4gbnVsbDsKCQkJCX0KCgkJCQl2YXIgX3JldCA9IG51bGw7CgkJCQl2YXIgX2V4Y2VwdGlvbiA9IG51bGw7CgkJCQl0cnkgewoJCQkJCV9yZXQgPSB0aGlzLnJ1blNSU2NyaXB0KHJlc3BvbnNlVGV4dCk7CgkJCQkJX2V4Y2VwdGlvbiA9IF9yZXQuX2V4Y2VwdGlvbjsKCQkJCQlpZiAoX3JldC5zZXJ2ZXJfdGltZSkgewoJCQkJCQlsZXQgdGQgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKSAtIF9yZXQuc2VydmVyX3RpbWUuZ2V0VGltZSgpOwoJCQkJCQl0cnkgewoJCQkJCQkJd2luZG93LnRpbWVEaWZmZXJlbmNlID0gdGQ7CgkJCQkJCX0gY2F0Y2ggKGV4KSB7CgkJCQkJCQlnbG9iYWwudGltZURpZmZlcmVuY2UgPSB0ZDsKCQkJCQkJfQoJCQkJCX0KCQkJCX0gY2F0Y2ggKGUpIHsKCQkJCQlfZXhjZXB0aW9uID0gZTsKCQkJCX0KCgkJCQlpZiAoIV9yZXQgJiYgIV9leGNlcHRpb24pIHsKCQkJCQlyZXR1cm4gYXdhaXQgbnVsbDsgLy90aGlzLmRvSGVhZGxlc3NDYWxsKGNhbGxCYWNrKTsKCQkJCX0gZWxzZSB7CgkJCQkJLy90aGlzLkFjdGl2ZVJlcXVlc3QgPSBudWxsOwoJCQkJCWlmIChjYWxsQmFjayAhPSBudWxsKSB7CgkJCQkJCXRyeSB7CgkJCQkJCQljYWxsQmFjaygKCQkJCQkJCQlfcmV0LnJldCB8fCAoX2V4Y2VwdGlvbiA/IHJlc3BvbnNlVGV4dCA6IG51bGwpLAoJCQkJCQkJCV9leGNlcHRpb24KCQkJCQkJCSk7CgkJCQkJCX0gY2F0Y2ggKGUpIHsKCQkJCQkJCXRoaXMuU2hvd0Vycm9yKAoJCQkJCQkJCSdFcnJvciBpbiBDYWxsYmFjazpcblxuJyArCgkJCQkJCQkJY2FsbEJhY2sgKwoJCQkJCQkJCSdcblxuJyArCgkJCQkJCQkJZS5tZXNzYWdlCgkJCQkJCQkpOwoJCQkJCQl9CgkJCQkJfQoJCQkJCSgKCQkJCQkJd2luZG93LnNyLmZMb2FkaW5nRW5kIHx8CgkJCQkJCSgoKSA9PiB7CgkJCQkJCQl0aGlzLnJlc2V0Q3Vyc29yKCk7CgkJCQkJCX0pCgkJCQkJKSgpOwoJCQkJCXJldHVybiAoCgkJCQkJCShfcmV0ID8gX3JldC5yZXQgOiBudWxsKSB8fAoJCQkJCQkoX2V4Y2VwdGlvbiA/IHJlc3BvbnNlVGV4dCA6IG51bGwpCgkJCQkJKTsKCQkJCX0KCQkJfSBjYXRjaCAoZSkgewoJCQkJY29uc29sZS5sb2coZSk7CgkJCQlyZXR1cm4gZmFsc2U7CgkJCX0KCQl9IGVsc2UgewoJCQlyZXR1cm4gKGFzeW5jICgpID0+IHsKCQkJCXJldHVybiBhd2FpdCB0aGlzLnNlbmRYTUwoCgkJCQkJdGhpcy5zclVSTCArICcmbmFtZT0nICsgZnVuLAoJCQkJCXBvc3REYXRhLAoJCQkJCWNhbGxCYWNrCgkJCQkpOwoJCQl9KSgpOwoJCX0KCX0KCglwcm9taXNlKGRhdGEsIGNhbGxCYWNrKSB7CgkJaWYgKCFjYWxsQmFjayB8fCB7fS50b1N0cmluZy5jYWxsKGNhbGxCYWNrKSAhPT0gJ1tvYmplY3QgRnVuY3Rpb25dJykgewoJCQlyZXR1cm4gZGF0YTsKCQl9CgoJCXZhciBwID0gJC5EZWZlcnJlZCgpOwoKCQlzZXRUaW1lb3V0KGFzeW5jICgpID0+IHsKCQkJdHJ5IHsKCQkJCWxldCBkID0gYXdhaXQgY2FsbEJhY2soZGF0YSk7CgkJCQlwLnJlc29sdmUoZCk7CgkJCX0gY2F0Y2ggKGV4KSB7CgkJCQl0cnkgewoJCQkJCXAucmVzb2x2ZShjYWxsQmFjayhkYXRhKSk7CgkJCQl9IGNhdGNoIChfZXgpIHsKCQkJCQljb25zb2xlLmxvZygncHJvbWlzZSBleGNlcHRpb24nLCBfZXgpOwoJCQkJfQoJCQl9CgkJfSwgNTAwKTsKCgkJcmV0dXJuIHAgPyBwLnByb21pc2UoKSA6IGRhdGE7Cgl9CgoJYXN5bmMgc2VuZFhNTCh1cmwsIHBvc3REYXRhLCBjYWxsQmFjaykgewoJCWlmICh0eXBlb2Yod2luZG93KSAhPT0gInVuZGVmaW5lZCIgJiYgIXdpbmRvdy5TUikgd2luZG93LlNSID0gdGhpczsKCgkJaWYgKCh0eXBlb2Yod2luZG93KSAhPT0gInVuZGVmaW5lZCIgJiYgd2luZG93LmpRdWVyeSkgfHwgKHR5cGVvZih3aW5kb3cpID09PSAidW5kZWZpbmVkIiAmJiB0eXBlb2YoYXhpb3MpICE9PSAidW5kZWZpbmVkIikpIHsKCQkJbGV0IHJlcXVlc3QgPSBhd2FpdCB0aGlzLmNhY2hlUmVzdWx0KG51bGwsIG51bGwsIGNhbGxCYWNrKTsKCQkJaWYgKHJlcXVlc3QpIHsKCQkJCWxldCByZXN1bHQgPSBhd2FpdCB0aGlzLnByb2Nlc3NSZXNwb25zZSgKCQkJCQk0NCwKCQkJCQljYWxsQmFjaywKCQkJCQlyZXF1ZXN0LlRleHRSZXNwb25zZSwKCQkJCQl1cmwKCQkJCSk7CgkJCQlyZXR1cm4gYXdhaXQgdGhpcy5wcm9jZXNzUmVzdWx0KHJlc3VsdCk7CgkJCX0gZWxzZSB7CgkJCQkvLyBqcXVlcnkgY2FsbAoJCQkJdmFyIGFqYXggPSB7fTsKCQkJCWlmICh0aGlzLmJQb3N0IHx8IHBvc3REYXRhLmxlbmd0aCA+ICh0aGlzLm5NYXhVUkxMZW5ndGggfHwgMTAwKSkgewoJCQkJCWFqYXgudXJsID0gdXJsOwoJCQkJCWFqYXgudHlwZSA9ICdQT1NUJzsKCQkJCQlhamF4LmJlZm9yZVNlbmQgPSAocmVxdWVzdCkgPT4gewoJCQkJCQlyZXF1ZXN0LnNldFJlcXVlc3RIZWFkZXIoCgkJCQkJCQknQ29udGVudC1UeXBlJywKCQkJCQkJCSdtdWx0aXBhcnQvZm9ybS1kYXRhOyBib3VuZGFyeT0tLS0tLS0tLS0tLS0tLScKCQkJCQkJKTsKCQkJCQl9OwoJCQkJCWFqYXguZGF0YSA9CgkJCQkJCSdQT1NUREFUQT1cclxuJyAvKisgIjw/eG1sIHZlcnNpb249XCIxLjBcIiBlbmNvZGluZz1cInV0Zi04XCIgc3RhbmRhbG9uZT1cInllc1wiPz5cclxuIiovICsKCQkJCQkJcG9zdERhdGE7CgkJCQl9IGVsc2UgewoJCQkJCWFqYXgudXJsID0gdXJsICsgJyZQT1NUQ09ERT0nICsgdGhpcy50b0hleChwb3N0RGF0YSk7CgkJCQkJYWpheC50eXBlID0gJ0dFVCc7CgkJCQl9CgoJCQkJbGV0IHJldCA9IG51bGw7CgkJCQlpZiAodHlwZW9mKGpRdWVyeSkgIT09ICJ1bmRlZmluZWQiKSB7CgkJCQkJcmV0ID0gYXdhaXQgJC5hamF4KGFqYXgpOwoJCQkJfSBlbHNlIGlmICh0eXBlb2YoYXhpb3MpICE9PSAidW5kZWZpbmVkIikgewoJCQkJCXJldCA9IGF3YWl0IGF4aW9zKGFqYXgpOwoJCQkJCXJldCA9IHJldC5kYXRhOwoJCQkJfQoJCQkJcmV0ID0gYXdhaXQgdGhpcy5wcm9jZXNzUmVzdWx0KAoJCQkJCXRoaXMucHJvY2Vzc1Jlc3BvbnNlKDQsIGNhbGxCYWNrLCByZXQsIHVybCkKCQkJCSk7CgkJCQlyZXR1cm4gcmV0OwoJCQl9CgkJfSBlbHNlIHsKCQkJdmFyIHhtbEhUVFAgPSB0aGlzLmdldFhtbEhUVFAoKTsKCQkJaWYgKCF4bWxIVFRQKSByZXR1cm4gZmFsc2U7CgkJCWlmIChjYWxsQmFjayAhPSBudWxsKSB7CgkJCQl3aW5kb3cueG1sSFRUUC5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBmdW5jdGlvbigpIHsKCQkJCQlpZiAod2luZG93LnhtbEhUVFAucmVhZHlTdGF0ZSA9PSA0KSB7CgkJCQkJCWlmICgkLndoZW4pIHsKCQkJCQkJCSQud2hlbigKCQkJCQkJCQl3aW5kb3cuU1IucHJvY2Vzc1Jlc3BvbnNlKAoJCQkJCQkJCQl3aW5kb3cueG1sSFRUUC5yZWFkeVN0YXRlLAoJCQkJCQkJCQljYWxsQmFjaywKCQkJCQkJCQkJd2luZG93LnhtbEhUVFAucmVzcG9uc2VUZXh0LAoJCQkJCQkJCQl1cmwKCQkJCQkJCQkpCgkJCQkJCQkpLnRoZW4oKHJlc3VsdCkgPT4gd2luZG93LlNSLnByb2Nlc3NSZXN1bHQocmVzdWx0KSk7CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQl3aW5kb3cuU1IucHJvY2Vzc1Jlc3VsdCgKCQkJCQkJCQl3aW5kb3cuU1IucHJvY2Vzc1Jlc3BvbnNlKAoJCQkJCQkJCQl3aW5kb3cueG1sSFRUUC5yZWFkeVN0YXRlLAoJCQkJCQkJCQljYWxsQmFjaywKCQkJCQkJCQkJd2luZG93LnhtbEhUVFAucmVzcG9uc2VUZXh0LAoJCQkJCQkJCQl1cmwKCQkJCQkJCQkpCgkJCQkJCQkpOwoJCQkJCQl9CgkJCQkJfQoJCQkJfTsKCQkJfQoKCQkJaWYgKHRoaXMuYlBvc3QgfHwgcG9zdERhdGEubGVuZ3RoID4gdGhpcy5uTWF4VVJMTGVuZ3RoKSB7CgkJCQl3aW5kb3cueG1sSFRUUC5vcGVuKCdQT1NUJywgdXJsLCBjYWxsQmFjayAhPSBudWxsKTsKCQkJCXdpbmRvdy54bWxIVFRQLnNldFJlcXVlc3RIZWFkZXIoCgkJCQkJJ0NvbnRlbnQtVHlwZScsCgkJCQkJJ211bHRpcGFydC9mb3JtLWRhdGE7IGJvdW5kYXJ5PS0tLS0tLS0tLS0tLS0tJwoJCQkJKTsgLy8gZm9vbCBjcm9zcy1kb21haW4gY2hlY2tpbmcgaW4gY2hyb21lCgkJCQl3aW5kb3cueG1sSFRUUC5zZW5kKAoJCQkJCSdQT1NUREFUQT1cclxuJyAvKisgIjw/eG1sIHZlcnNpb249XCIxLjBcIiBlbmNvZGluZz1cInV0Zi04XCIgc3RhbmRhbG9uZT1cInllc1wiPz5cclxuIiovICsKCQkJCQlwb3N0RGF0YQoJCQkJKTsKCQkJfSBlbHNlIHsKCQkJCXhtbEhUVFAub3BlbigKCQkJCQknR0VUJywKCQkJCQl1cmwgKyAnJlBPU1RDT0RFPScgKyB0aGlzLnRvSGV4KHBvc3REYXRhKSwKCQkJCQljYWxsQmFjayAhPSBudWxsCgkJCQkpOwoJCQkJeG1sSFRUUC5zZW5kKG51bGwpOwoJCQl9CgoJCQlpZiAoY2FsbEJhY2sgPT0gbnVsbCAmJiB4bWxIVFRQLnJlYWR5U3RhdGUgPT0gNCkgewoJCQkJdmFyIF91cmwgPSB1cmwgKyAnJlBPU1RDT0RFPScgKyB0aGlzLnRvSGV4KHBvc3REYXRhKTsKCQkJCWlmICgkLndoZW4pIHsKCQkJCQlyZXR1cm4gJC53aGVuKAoJCQkJCQl0aGlzLnByb2Nlc3NSZXNwb25zZSgKCQkJCQkJCXhtbEhUVFAucmVhZHlTdGF0ZSwKCQkJCQkJCWNhbGxCYWNrLAoJCQkJCQkJeG1sSFRUUC5yZXNwb25zZVRleHQsCgkJCQkJCQlfdXJsCgkJCQkJCSkKCQkJCQkpLnRoZW4oKHJlc3VsdCkgPT4gewoJCQkJCQlyZXR1cm4gdGhpcy5wcm9jZXNzUmVzdWx0KHJlc3VsdCk7CgkJCQkJfSk7CgkJCQl9IGVsc2UgewoJCQkJCXRoaXMucHJvY2Vzc1Jlc3VsdCgKCQkJCQkJdGhpcy5wcm9jZXNzUmVzcG9uc2UoCgkJCQkJCQl4bWxIVFRQLnJlYWR5U3RhdGUsCgkJCQkJCQljYWxsQmFjaywKCQkJCQkJCXhtbEhUVFAucmVzcG9uc2VUZXh0LAoJCQkJCQkJX3VybAoJCQkJCQkpCgkJCQkJKTsKCQkJCX0KCQkJfQoJCX0KCX0KCglfdXJsKGZ1biwgZmlsZW5hbWUpIHsKCQl2YXIgYXJncyA9IEFycmF5KCk7CgkJZm9yICh2YXIgaSA9IDI7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsKCQkJYXJnc1tpIC0gMl0gPSBhcmd1bWVudHNbaV07CgkJfQoJCXZhciBwb3N0RGF0YSA9IHRoaXMucGFyYW0oYXJncyk7CgoJCXZhciBfYXJncyA9ICcnOwoJCWZvciAodmFyIGkgPSAyOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7CgkJCV9hcmdzICs9ICcmcCcgKyAoaSAtIDIpICsgJz0nICsgYXJndW1lbnRzW2ldOwoJCX0KCgkJaWYgKGZ1bi5pbmRleE9mKCcuJykgPCAwKSB7CgkJCWZ1biA9IHRoaXMuc3lzdGVtTmFtZSArICcuJyArIGZ1bjsKCQl9CgoJCXJldHVybiAoCgkJCXRoaXMuc3JVUkwgKwoJCQknJm5hbWU9JyArCgkJCWZ1biArCgkJCScmcmFuZD0nICsKCQkJTWF0aC5yYW5kb20oKSArCgkJCS8vKyBfYXJncwoJCQknJlBPU1RDT0RFPScgKwoJCQl0aGlzLnRvSGV4KHBvc3REYXRhKSArCgkJCShmaWxlbmFtZSA/ICcmZmlsZW5hbWU9JyArIGZpbGVuYW1lIDogJycpCgkJKTsKCX0KCglfanNvbihmdW4pIHsKCQl2YXIgYXJncyA9IEFycmF5KCk7CgkJZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsKCQkJYXJnc1tpIC0gMV0gPSBhcmd1bWVudHNbaV07CgkJfQoJCWlmIChmdW4uaW5kZXhPZignLicpIDwgMCkgewoJCQlmdW4gPSB0aGlzLnN5c3RlbU5hbWUgKyAnLicgKyBmdW47CgkJfQoJCXJldHVybiAoCgkJCXRoaXMuc3JVUkwgKwoJCQknJm5hbWU9JyArCgkJCWZ1biArCgkJCScmcmFuZD0nICsKCQkJTWF0aC5yYW5kb20oKSArCgkJCScmanNvbj1jbGVhbiZQT1NUQ09ERT0nICsKCQkJdGhpcy50b0hleCh0aGlzLnBhcmFtKGFyZ3MpKQoJCSk7Cgl9CgoJbXlSZXBsYWNlKHMsIGZjLCByYykgewoJCWlmICh0eXBlb2YgcyAhPT0gJ3N0cmluZycpIHJldHVybiBzOwoKCQl2YXIgcmV0ID0gJyc7CgkJZm9yICh2YXIgaSA9IDA7IGkgPCBzLmxlbmd0aDsgaSsrKSB7CgkJCXZhciBycyA9IHMuY2hhckF0KGkpOwoJCQlmb3IgKHZhciBqID0gMDsgaiA8IGZjLmxlbmd0aDsgaisrKSB7CgkJCQlpZiAocy5jaGFyQXQoaSkgPT0gZmNbal0pIHsKCQkJCQlycyA9IHMuY2hhckF0KGkpLnJlcGxhY2UoZmNbal0sIHJjW2pdKTsKCQkJCX0KCQkJfQoJCQlyZXQgKz0gcnM7CgkJfQoJCXJldHVybiByZXQ7Cgl9CgoJcnVuQ29kZShjc0NvZGUsIGpzQ29kZSwgcFhNTCwgY2FsbEJhY2spIHsKCQkvLyBhdm9pZCB1c2luZyB0aGlzIHBsZWFzZQoJCXZhciBwb3N0RGF0YSA9ICdTdG9yZWRNZXRob2QgbSA9IG5ldyBTdG9yZWRNZXRob2QoKTsnICsgdGhpcy5DUk5MOwoJCXBvc3REYXRhICs9CgkJCSdtLkJvZHlDb2RlID0gIicgKwoJCQl0aGlzLm15UmVwbGFjZShjc0NvZGUsIFsnIicsICdccicsICdcbiddLCBbJ1xcIicsICdcXHInLCAnXFxuJ10pICsKCQkJJyI7JyArCgkJCXRoaXMuQ1JOTDsKCQlwb3N0RGF0YSArPQoJCQknbS5SZXR1cm5Db2RlID0gIicgKwoJCQl0aGlzLm15UmVwbGFjZShqc0NvZGUsIFsnIicsICdccicsICdcbiddLCBbJ1xcIicsICdcXHInLCAnXFxuJ10pICsKCQkJJyI7JyArCgkJCXRoaXMuQ1JOTDsKCQlwb3N0RGF0YSArPSAnbS5BY3RpdmUgPSB0cnVlOycgKyB0aGlzLkNSTkw7CgkJcG9zdERhdGEgKz0gJ20uT2JqZWN0UmV0dXJuID0gZmFsc2U7JyArIHRoaXMuQ1JOTDsKCQlwb3N0RGF0YSArPSAnbS5TaWduYXR1cmUgPSAic3RyaW5nIG5hbWUiOycgKyB0aGlzLkNSTkw7CgkJcG9zdERhdGEgKz0gJ3JldHVybiBuZXcgb2JqZWN0W117bSwgQCInICsgcFhNTCArICcifTsnICsgdGhpcy5DUk5MOwoKCQl0aGlzLnNlbmRYTUwodGhpcy5zclVSTCArICcmY29kZT10cnVlJywgcG9zdERhdGEsIGNhbGxCYWNrKTsKCX0KCglHZXQodXJsLCBjYWxsQmFjaykgewoJCWlmICghY2FsbEJhY2spIHsKCQkJLy8gc3luY2hyb25vdXMgbW9kZQoJCQlpZiAoIXdpbmRvdy5qUXVlcnkpIHsKCQkJCS8vIG5vIGpxdWVyeQoJCQl9IGVsc2UgewoJCQkJcmV0dXJuIHRoaXMucHJvbWlzZSgKCQkJCQludWxsLAoJCQkJCSQuYWpheCh7CgkJCQkJCXR5cGU6ICdHRVQnLAoJCQkJCQl1cmw6IHVybCwKCQkJCQkJYXN5bmM6IGZhbHNlLAoJCQkJCQlwcm9jZXNzRGF0YTogZmFsc2UsCgkJCQkJfSkKCQkJCSk7CgkJCX0KCQl9IGVsc2UgewoJCQkvLyBzeW5jaHJvbm91cyBtb2RlCgkJCWlmICghd2luZG93LmpRdWVyeSkgewoJCQkJLy8gbm8ganF1ZXJ5CgkJCX0gZWxzZSB7CgkJCQkkLmFqYXgoewoJCQkJCXR5cGU6ICdHRVQnLAoJCQkJCXVybDogdXJsLAoJCQkJCXByb2Nlc3NEYXRhOiBmYWxzZSwKCQkJCQlzdWNjZXNzOiAoZGF0YSkgPT4gY2FsbEJhY2soZGF0YSksCgkJCQkJZXJyb3I6IChlcnIpID0+IGNhbGxCYWNrKG51bGwpLAoJCQkJfSk7CgkJCX0KCQl9Cgl9CgoJUG9zdCgKCQl1cmwsCgkJY2FsbEJhY2ssCgkJcG9zdERhdGEsCgkJaGVhZGVycywKCQl1c2VybmFtZSwKCQlwYXNzd29yZCwKCQljb250ZW50VHlwZQoJKSB7CgkJdmFyIHhtbEhUVFAgPSB0aGlzLmdldFhtbEhUVFAoKTsKCgkJaWYgKHhtbEhUVFApIHsKCQkJeG1sSFRUUC5vcGVuKCdQT1NUJywgdXJsLCB0cnVlKTsKCQkJeG1sSFRUUC53aXRoQ3JlZGVudGlhbHMgPSAndHJ1ZSc7CgkJCWlmIChjcm9zc0RvbWFpbikKCQkJCXhtbEhUVFAuc2V0UmVxdWVzdEhlYWRlcigKCQkJCQknQWNjZXNzLUNvbnRyb2wtQWxsb3ctT3JpZ2luJywKCQkJCQlsb2NhdGlvbi5vcmlnaW4KCQkJCSk7CgkJCWlmIChjb250ZW50VHlwZSkKCQkJCXhtbEhUVFAuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgY29udGVudFR5cGUpOwoJCQlpZiAodXNlcm5hbWUpCgkJCQl4bWxIVFRQLnNldFJlcXVlc3RIZWFkZXIoCgkJCQkJJ0F1dGhvcml6YXRpb24nLAoJCQkJCSdCYXNpYyAnICsgYnRvYSgndXNlcm5hbWU6cGFzc3dvcmQnKQoJCQkJKTsKCgkJCWlmIChoZWFkZXJzKQoJCQkJZm9yICh2YXIgaSA9IDA7IGkgPCBoZWFkZXJzLmxlbmd0aDsgaSsrKQoJCQkJCXhtbEhUVFAuc2V0UmVxdWVzdEhlYWRlcihoZWFkZXJzW2ldLmtleSwgaGVhZGVyc1tpXS52YWx1ZSk7CgoJCQl4bWxIVFRQLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uKCkgewoJCQkJaWYgKHdpbmRvdy54bWxIVFRQLnJlYWR5U3RhdGUgPT0gNCAmJiBjYWxsQmFjaykgewoJCQkJCWNhbGxCYWNrKHdpbmRvdy54bWxIVFRQLnJlc3BvbnNlVGV4dCk7CgkJCQl9CgkJCX07CgkJCXhtbEhUVFAuc2VuZChwb3N0RGF0YSk7CgkJfQoJfQoKCWhhc2hDb2RlKHMpIHsKCQl2YXIgaGFzaCA9IDAsCgkJCWksCgkJCWNociwKCQkJbGVuOwoJCWlmIChzLmxlbmd0aCA9PSAwKSByZXR1cm4gaGFzaDsKCQlmb3IgKGkgPSAwLCBsZW4gPSBzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CgkJCWNociA9IHMuY2hhckNvZGVBdChpKTsKCQkJaGFzaCA9IChoYXNoIDw8IDUpIC0gaGFzaCArIGNocjsKCQkJaGFzaCB8PSAwOyAvLyBDb252ZXJ0IHRvIDMyYml0IGludGVnZXIKCQl9CgkJcmV0dXJuIGhhc2g7Cgl9CgoJdG9IZXgocykgewoJCWlmICh0eXBlb2YgcyAhPT0gJ3N0cmluZycpIHJldHVybiBzOwoKCQlyZXR1cm4gcy5zcGxpdCgiIikubWFwKHggPT4gKDI1NiArIHguY2hhckNvZGVBdCgpKS50b1N0cmluZygxNikuc3Vic3RyKC0yKSkuam9pbigiIik7Cgl9CgoJYXNjaWlfdmFsdWUoYykgewoJCS8vIHJlc3RyaWN0IGlucHV0IHRvIGEgc2luZ2xlIGNoYXJhY3RlcgoJCWMgPSBjLmNoYXJBdCgwKTsKCgkJLy8gbG9vcCB0aHJvdWdoIGFsbCBwb3NzaWJsZSBBU0NJSSB2YWx1ZXMKCQl2YXIgaTsKCQlmb3IgKGkgPSAwOyBpIDwgMjU2OyArK2kpIHsKCQkJLy8gY29udmVydCBpIGludG8gYSAyLWRpZ2l0IGhleCBzdHJpbmcKCQkJdmFyIGggPSBpLnRvU3RyaW5nKDE2KTsKCQkJaWYgKGgubGVuZ3RoID09IDEpIGggPSAnMCcgKyBoOwoKCQkJLy8gaW5zZXJ0IGEgJSBjaGFyYWN0ZXIgaW50byB0aGUgc3RyaW5nCgkJCWggPSAnJScgKyBoOwoKCQkJLy8gZGV0ZXJtaW5lIHRoZSBjaGFyYWN0ZXIgcmVwcmVzZW50ZWQgYnkgdGhlIGVzY2FwZSBjb2RlCgkJCWggPSB1bmVzY2FwZShoKTsKCgkJCS8vIGlmIHRoZSBjaGFyYWN0ZXJzIG1hdGNoLCB3ZSd2ZSBmb3VuZCB0aGUgQVNDSUkgdmFsdWUKCQkJaWYgKGggPT0gYykgYnJlYWs7CgkJfQoJCXJldHVybiBpOwoJfQoKCS8qKgoJICogRGF0ZSBGdW5jdGlvbnMKCSAqLwoJZGF5c0RpZmYoZDIsIGQxKSB7CgkJcmV0dXJuIE1hdGguY2VpbCgoZDIuZ2V0VGltZSgpIC0gZDEuZ2V0VGltZSgpKSAvICgxMDAwICogNjAgKiA2MCAqIDI0KSk7Cgl9CgoJYWRkTVNlY29uZHMobywgbXMpIHsKCQlyZXR1cm4gbmV3IERhdGUoby5nZXRUaW1lKCkgKyBtcyk7Cgl9CgoJYWRkU2Vjb25kcyhvLCBzKSB7CgkJcmV0dXJuIHRoaXMuYWRkTVNlY29uZHMobywgcyAqIDEwMDApOwoJfQoKCWFkZE1pbnV0ZXMobywgbSkgewoJCXJldHVybiB0aGlzLmFkZFNlY29uZHMobywgbSAqIDYwKTsKCX0KCglhZGRIb3VycyhvLCBoKSB7CgkJcmV0dXJuIHRoaXMuYWRkTWludXRlcyhvLCBoICogNjApOwoJfQoKCWFkZERheXMobywgZCkgewoJCXJldHVybiB0aGlzLmFkZEhvdXJzKG8sIGQgKiAyNCk7Cgl9CgoJYWRkWWVhcnMobywgeSkgewoJCXJldHVybiB0aGlzLmFkZE1vbnRocyhvLCB5ICogMTIpOwoJfQoKCWFkZE1vbnRocyhvLCBtKSB7CgkJcmV0dXJuIG5ldyBEYXRlKAoJCQlvLmdldEZ1bGxZZWFyKCksCgkJCW8uZ2V0TW9udGgoKSArIG0sCgkJCW8uZ2V0RGF0ZSgpLAoJCQlvLmdldEhvdXJzKCksCgkJCW8uZ2V0TWludXRlcygpLAoJCQlvLmdldFNlY29uZHMoKQoJCSk7Cgl9CgoJaXNEYXRlKG8pIHsKCQlyZXR1cm4gKAoJCQlvICE9IG51bGwgJiYKCQkJby5jb25zdHJ1Y3RvciAhPSBudWxsICYmCgkJCW8uY29uc3RydWN0b3IudG9TdHJpbmcoKS5pbmRleE9mKCdmdW5jdGlvbiBEYXRlKCcpID4gLTEKCQkpOwoJfQoKCXRvU2hvcnREYXRlKG8pIHsKCQlpZiAoIXRoaXMuaXNEYXRlKG8pKSByZXR1cm4gJyc7IC8vIGF2b2lkIG51bGxzCgkJcmV0dXJuIG8uZ2V0TW9udGgoKSArIDEgKyAnLycgKyBvLmdldERhdGUoKSArICcvJyArIG8uZ2V0RnVsbFllYXIoKTsKCX0KCgl0b1Nob3J0VGltZShvKSB7CgkJaWYgKCF0aGlzLmlzRGF0ZShvKSkgcmV0dXJuICcnOyAvLyBhdm9pZCBudWxscwoJCXZhciBob3VycyA9ICcnICsgby5nZXRIb3VycygpOyAvL28uZ2V0SG91cnMoKSUxMjsKCQl2YXIgbWludXRlcyA9ICcnICsgby5nZXRNaW51dGVzKCk7CgkJdmFyIHNlY29uZHMgPSAnJyArIG8uZ2V0U2Vjb25kcygpOwoJCWlmIChob3Vycy5sZW5ndGggPCAyKSBob3VycyA9ICcwJyArIGhvdXJzOwoJCWlmIChtaW51dGVzLmxlbmd0aCA8IDIpIG1pbnV0ZXMgPSAnMCcgKyBtaW51dGVzOwoJCWlmIChzZWNvbmRzLmxlbmd0aCA8IDIpIHNlY29uZHMgPSAnMCcgKyBzZWNvbmRzOwoJCXJldHVybiBob3VycyArICc6JyArIG1pbnV0ZXMgKyAnOicgKyBzZWNvbmRzOyAvLyArICIgIiArIChvLmdldEhvdXJzKCk+PTEyPyJQTSI6IkFNIik7Cgl9CgoJdG9EYXRlVGltZShvKSB7CgkJaWYgKCF0aGlzLmlzRGF0ZShvKSkgcmV0dXJuICcnOyAvLyBhdm9pZCBudWxscwoJCXJldHVybiB0aGlzLnRvU2hvcnREYXRlKG8pICsgJyAnICsgdGhpcy50b1Nob3J0VGltZShvKTsKCX0KCS8qKgoJICogRU5EOiBEYXRlIEZ1bmN0aW9ucwoJICovCgoJc2V0UHJvcGVydHkoY2lkLCBzLCBwcm9wLCBkZWYpIHsKCQlpZiAoIWNpZCkgcmV0dXJuOwoJCXZhciBvID0gJChjaWQpOwoJCWlmICghbykgcmV0dXJuOwoKCQlpZiAoIXByb3ApIHsKCQkJaWYgKG8udGFnTmFtZSA9PSAnSU5QVVQnKSB7CgkJCQlwcm9wID0gJ3ZhbHVlJzsKCQkJCWlmIChvLnR5cGUgPT0gJ3RleHQnKSBwcm9wID0gJ3ZhbHVlJzsKCQkJCWlmIChvLnR5cGUgPT0gJ2NoZWNrYm94JykgcHJvcCA9ICdjaGVja2VkJzsKCQkJfSBlbHNlIHsKCQkJCXByb3AgPSAnaW5uZXJIVE1MJzsKCQkJfQoJCX0KCQlpZiAoIWRlZikgZGVmID0gJyc7CgkJaWYgKHRoaXMucHJlUHJvY2Vzc0hUTUwpIGRlZiA9IHRoaXMucHJlUHJvY2Vzc0hUTUwoZGVmKTsKCgkJaWYgKHRoaXMuaXNEYXRlKHMpKSB7CgkJCS8vIGEgZGF0ZSBmaWVsZAoJCQlzID0gdGhpcy50b1Nob3J0RGF0ZShzKTsKCQl9IGVsc2UgewoJCQlpZiAodGhpcy5wcmVQcm9jZXNzSFRNTCkgcyA9IHRoaXMucHJlUHJvY2Vzc0hUTUwocyk7CgkJfQoKCQl3aW5kb3cucHJvcGVydHlWYWx1ZSA9IHM7CgkJdHJ5IHsKCQkJdGhpcy5ydW5TY3JpcHQoCgkJCQkiJCgnIiArIG8uaWQgKyAiJykuIiArIHByb3AgKyAnID0gd2luZG93LnByb3BlcnR5VmFsdWU7JwoJCQkpOwoJCX0gY2F0Y2ggKGUpIHsKCQkJdGhpcy5TaG93RXJyb3IoZS5tZXNzYWdlKTsKCQkJdGhpcy5ydW5TY3JpcHQoIiQoJyIgKyBvLmlkICsgIicpLiIgKyBwcm9wICsgJyA9ICInICsgZGVmICsgJyI7Jyk7CgkJfQoJCXdpbmRvdy5wcm9wZXJ0eVZhbHVlID0gbnVsbDsKCX0KCgkvKioKCSAqIFZhbGlkYXRpb24KCSAqLwoJdmFsaWROb3ROdWxsKHMpIHsKCQlpZiAodHlwZW9mIHMgPT0gJ3N0cmluZycpIHsKCQkJcmV0dXJuIHMgJiYgcy5sZW5ndGggPiAwOwoJCX0gZWxzZSB7CgkJCXJldHVybiBzICE9IG51bGw7CgkJfQoJfQoKCXZhbGlkT2JqZWN0KG8pIHsKCQlyZXR1cm4gbyAhPSBudWxsOwoJfQoKCXZhbGlkRW1haWwoc3RyKSB7CgkJdmFyIGF0ID0gJ0AnOwoJCXZhciBkb3QgPSAnLic7CgkJdmFyIGxhdCA9IHN0ci5pbmRleE9mKGF0KTsKCQl2YXIgbHN0ciA9IHN0ci5sZW5ndGg7CgkJdmFyIGxkb3QgPSBzdHIuaW5kZXhPZihkb3QpOwoJCWlmICgKCQkJc3RyLmluZGV4T2YoYXQpID09IC0xIHx8CgkJCXN0ci5pbmRleE9mKGF0KSA9PSAtMSB8fAoJCQlzdHIuaW5kZXhPZihhdCkgPT0gMCB8fAoJCQlzdHIuaW5kZXhPZihhdCkgPT0gbHN0ciB8fAoJCQlzdHIuaW5kZXhPZihkb3QpID09IC0xIHx8CgkJCXN0ci5pbmRleE9mKGRvdCkgPT0gMCB8fAoJCQlzdHIuaW5kZXhPZihkb3QpID09IGxzdHIgfHwKCQkJc3RyLmluZGV4T2YoYXQsIGxhdCArIDEpICE9IC0xIHx8CgkJCXN0ci5zdWJzdHJpbmcobGF0IC0gMSwgbGF0KSA9PSBkb3QgfHwKCQkJc3RyLnN1YnN0cmluZyhsYXQgKyAxLCBsYXQgKyAyKSA9PSBkb3QgfHwKCQkJc3RyLmluZGV4T2YoZG90LCBsYXQgKyAyKSA9PSAtMSB8fAoJCQlzdHIuaW5kZXhPZignICcpICE9IC0xCgkJKSB7CgkJCXJldHVybiBmYWxzZTsKCQl9IGVsc2UgewoJCQlyZXR1cm4gdHJ1ZTsKCQl9Cgl9CgoJdmFsaWRhdGUobywgdHlwZSwgY29uZmlnKSB7CgkJaWYgKHR5cGVvZiBvID09ICdzdHJpbmcnKSBvID0gJChvKTsKCQl2YXIgYkFsZXJ0ID0gdHJ1ZTsKCQlpZiAoIW8pIHJldHVybjsKCgkJaWYgKCFjb25maWcpIGNvbmZpZyA9IHt9OwoJCXZhciBvRXJyID0gJChvLmlkICsgJ19FcnJvcicpOwoJCWlmICghb0VyciAmJiBkb2N1bWVudC5pbnNlcnRBZGphY2VudEVsZW1lbnQpIHsKCQkJYkFsZXJ0ID0gZmFsc2U7CgkJCW9FcnIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdTUEFOJyk7CgkJCW9FcnIuaWQgPSBvLmlkICsgJ19FcnJvcic7CgkJCW9FcnIuY2xhc3NOYW1lID0gJ2Vycm9yJzsKCQkJby5pbnNlcnRBZGphY2VudEVsZW1lbnQoJ2FmdGVyRW5kJywgb0Vycik7CgkJfQoKCQlpZiAoIWNvbmZpZ1snZmllbGQnXSkgewoJCQl2YXIgdGFnID0gby50YWdOYW1lLnRvTG93ZXJDYXNlKCk7CgkJCWlmICgKCQkJCSh0YWcgPT0gJ3NwYW4nIHx8IHRhZyA9PSAnYScpICYmCgkJCQkoby5nZXRBdHRyaWJ1dGUoJ2Zyb20nKSB8fCBvLmdldEF0dHJpYnV0ZSgnbG9va3VwJykpCgkJCSkgewoJCQkJY29uZmlnWydmaWVsZCddID0gJ1NlbGVjdGVkSXRlbSc7CgkJCQl0eXBlID0gJ09iamVjdCc7CgkJCX0gZWxzZSB7CgkJCQljb25maWdbJ2ZpZWxkJ10gPSAndmFsdWUnOwoJCQl9CgkJfQoJCWlmICghdHlwZSkgdHlwZSA9ICdOb3ROdWxsJzsKCgkJaWYgKCFjb25maWdbJ2xhYmVsJ10pIHsKCQkJdmFyIHRpdGxlID0gby5nZXRBdHRyaWJ1dGUoJ3RpdGxlJyk7CgkJCWlmICghdGl0bGUpIHsKCQkJCXRpdGxlID0gby5pZC5zcGxpdCgnXycpOwoJCQkJdGl0bGUgPSB0aXRsZVsxXTsKCQkJCXRpdGxlID0gdGl0bGUuc3Vic3RyKDMpOwoJCQkJdGl0bGUgPSB0aGlzLkVuZ2xpc2hOYW1lKHRpdGxlKTsKCQkJfQoJCQljb25maWdbJ2xhYmVsJ10gPSB0aXRsZTsKCQl9CgkJaWYgKCFjb25maWdbJ21lc3NhZ2UnXSkgY29uZmlnWydtZXNzYWdlJ10gPSAnSW52YWxpZCBWYWx1ZSc7CgoJCXZhciBiVmFsaWQgPSB0cnVlOwoJCXdpbmRvdy52YWxpZGF0aW9uVmFsdWUgPSB3aW5kb3cuY21zLnYobyk7IC8vW2NvbmZpZ1siZmllbGQiXV07Ly92YWx1ZQoJCWJWYWxpZCA9CgkJCWJWYWxpZCAmJgoJCQl0aGlzLnJ1blNjcmlwdCgKCQkJCSd3aW5kb3cuY21zLnNyLnZhbGlkJyArIHR5cGUgKyAnKHdpbmRvdy52YWxpZGF0aW9uVmFsdWUpJwoJCQkpOwoJCXdpbmRvdy52YWxpZGF0aW9uVmFsdWUgPSBudWxsOwoKCQlpZiAoIWJWYWxpZCkgewoJCQkvL28udmFsdWUgPSAiIjsKCQkJLy9vLmZvY3VzKCk7CgkJCXNNZXNzYWdlID0gY29uZmlnWydtZXNzYWdlJ107CgkJfSBlbHNlIHsKCQkJc01lc3NhZ2UgPSAnJzsKCQl9CgoJCWlmICghYlZhbGlkKSB7CgkJCWlmIChiQWxlcnQpIHsKCQkJCXRoaXMuc19FcnJvck1lc3NhZ2VzICs9CgkJCQkJJ1xuJyArIGNvbmZpZ1snbGFiZWwnXSArICc6ICcgKyBzTWVzc2FnZTsKCQkJfSBlbHNlIHsKCQkJCW9FcnIuaW5uZXJIVE1MID0gc01lc3NhZ2U7CgkJCX0KCQl9Cgl9CgkvKioKCSAqIEVORDogVmFsaWRhdGlvbgoJICovCgoJRW5nbGlzaE5hbWUocykgewoJCXJldHVybiBzLnJlcGxhY2UoL15bYS16XXxbQS1aXS9nLCAodiwgaSkgPT4gaSA9PT0gMCA/IHYudG9VcHBlckNhc2UoKSA6ICIgIiArIHYudG9Mb3dlckNhc2UoKSk7CgoJCXZhciByZXQgPSAnJzsKCQlmb3IgKHZhciBpID0gMDsgaSA8IHMubGVuZ3RoOyBpKyspIHsKCQkJaWYgKHNbaV0gPj0gJ0EnICYmIHNbaV0gPD0gJ1onKSB7CgkJCQlyZXQgKz0gKHJldC5sZW5ndGggPT0gMCA/ICcnIDogJyAnKSArIHNbaV07CgkJCX0gZWxzZSBpZiAocmV0Lmxlbmd0aCA9PSAwKSB7CgkJCQlyZXQgKz0gKHNbaV0gKyAnJykudG9VcHBlckNhc2UoKTsKCQkJfSBlbHNlIHsKCQkJCXJldCArPSBzW2ldOwoJCQl9CgkJfQoKCQlyZXR1cm4gcmV0OwoJfQoKCS8qKiBPYmplY3QgQ29tcGFyaXNvbiAqKi8KCW5ld09iamVjdCgpIHsKCQl2YXIgcmV0ID0gbmV3IE9iamVjdCgpOwoJCXJldC5fX09CSkVDVElEID0gTWF0aC5yYW5kb20oKTsKCQlyZXR1cm4gcmV0OwoJfQoKCUVxdWFscyhvMSwgbzIpIHsKCQlpZiAobzEgPT0gbzIpIHJldHVybiB0cnVlOwoKCQlpZiAoCgkJCW8xICYmCgkJCW8xLl9fT0JKRUNUSUQgJiYKCQkJbzIgJiYKCQkJbzIuX19PQkpFQ1RJRCAmJgoJCQlvMS5fX09CSkVDVElEID09IG8yLl9fT0JKRUNUSUQKCQkpCgkJCXJldHVybiB0cnVlOwoJCWlmIChvMSAmJiBvMS5fX1JPV0lEICYmIG8yICYmIG8yLl9fUk9XSUQgJiYgbzEuX19ST1dJRCA9PSBvMi5fX1JPV0lEKQoJCQlyZXR1cm4gdHJ1ZTsKCQlpZiAobzEgJiYgbzEuSWQgJiYgbzIgJiYgbzIuSWQgJiYgbzEuSWQgPT0gbzIuSWQpIHJldHVybiB0cnVlOwoKCQlyZXR1cm4gZmFsc2U7Cgl9CgkvKiogT2JqZWN0IENvbXBhcmlzb24gKiovCgoJc2VyaWFsaXplKF9vYmopIHsKCQl0cnkgewoJCQkvLyBMZXQgR2Vja28gYnJvd3NlcnMgZG8gdGhpcyB0aGUgZWFzeSB3YXkKCQkJaWYgKAoJCQkJdHlwZW9mIF9vYmoudG9Tb3VyY2UgIT09ICd1bmRlZmluZWQnICYmCgkJCQl0eXBlb2YgX29iai5jYWxsZWUgPT09ICd1bmRlZmluZWQnCgkJCSkgewoJCQkJcmV0dXJuIF9vYmoudG9Tb3VyY2UoKTsKCQkJfQoJCQkvLyBPdGhlciBicm93c2VycyBtdXN0IGRvIGl0IHRoZSBoYXJkIHdheQoJCQlzd2l0Y2ggKHR5cGVvZiBfb2JqKSB7CgkJCQkvLyBudW1iZXJzLCBib29sZWFucywgYW5kIGZ1bmN0aW9ucyBhcmUgdHJpdmlhbDoKCQkJCS8vIGp1c3QgcmV0dXJuIHRoZSBvYmplY3QgaXRzZWxmIHNpbmNlIGl0cyBkZWZhdWx0IC50b1N0cmluZygpCgkJCQkvLyBnaXZlcyB1cyBleGFjdGx5IHdoYXQgd2Ugd2FudAoJCQkJY2FzZSAnbnVtYmVyJzoKCQkJCWNhc2UgJ2Jvb2xlYW4nOgoJCQkJY2FzZSAnZnVuY3Rpb24nOgoJCQkJCXJldHVybiBfb2JqOwoJCQkJCS8vIGZvciBKU09OIGZvcm1hdCwgc3RyaW5ncyBuZWVkIHRvIGJlIHdyYXBwZWQgaW4gcXVvdGVzCgkJCQljYXNlICdzdHJpbmcnOgoJCQkJCXJldHVybiAiJyIgKyBfb2JqICsgIiciOwoJCQkJY2FzZSAnb2JqZWN0JzoKCQkJCQl2YXIgc3RyOwoJCQkJCWlmICgKCQkJCQkJX29iai5jb25zdHJ1Y3RvciA9PT0gQXJyYXkgfHwKCQkJCQkJdHlwZW9mIF9vYmouY2FsbGVlICE9PSAndW5kZWZpbmVkJwoJCQkJCSkgewoJCQkJCQlzdHIgPSAnWyc7CgkJCQkJCXZhciBpLAoJCQkJCQkJbGVuID0gX29iai5sZW5ndGg7CgkJCQkJCWZvciAoaSA9IDA7IGkgPCBsZW4gLSAxOyBpKyspIHsKCQkJCQkJCXN0ciArPSB0aGlzLnNlcmlhbGl6ZShfb2JqW2ldKSArICcsJzsKCQkJCQkJfQoJCQkJCQlzdHIgKz0gdGhpcy5zZXJpYWxpemUoX29ialtpXSkgKyAnXSc7CgkJCQkJfSBlbHNlIHsKCQkJCQkJc3RyID0gJ3snOwoJCQkJCQl2YXIga2V5OwoJCQkJCQlmb3IgKGtleSBpbiBfb2JqKSB7CgkJCQkJCQlzdHIgKz0ga2V5ICsgJzonICsgdGhpcy5zZXJpYWxpemUoX29ialtrZXldKSArICcsJzsKCQkJCQkJfQoJCQkJCQlzdHIgPSBzdHIucmVwbGFjZSgvXCwkLywgJycpICsgJ30nOwoJCQkJCX0KCQkJCQlyZXR1cm4gc3RyOwoJCQkJZGVmYXVsdDoKCQkJCQlyZXR1cm4gJ1VOS05PV04nOwoJCQl9CgkJfSBjYXRjaCAoZSkgewoJCQl0aGlzLlNob3dEZWJ1ZyhlLm1lc3NhZ2UpOwoJCX0KCX0KfQ==",
	"__keys": ["name"],
	"active": true,
	"enabled": true,
	"__trMap": []
}