{
	"Id": "54a15352e459bc55e843ccf779415a6d6d5a389b",
	"name": "ServiceRouter",
	"script": "ZnVuY3Rpb24gU2VydmljZVJvdXRlcigpIHsNCgl2YXIgc3JVUkw7DQoNCgl2YXIgU3RvcmU7DQoNCgl2YXIgQ1JOTDsNCgl2YXIgYlBvc3Q7DQoJdmFyIGJEZWJ1ZzsNCgl2YXIgYkNhY2hlOw0KCXZhciBiTG9jYWw7DQoJdmFyIGJBc3luYzsNCgl2YXIgYkNhY2hlUmVzdWx0Ow0KCXZhciBiU2hvd0Vycm9yczsNCgl2YXIgbk1heFVSTExlbmd0aDsNCgl2YXIgcHJlUHJvY2Vzc0hUTUw7DQoJdmFyIHN5c3RlbU5hbWU7DQoJdmFyIGZMb2FkaW5nU3RhcnQ7DQoJdmFyIGZMb2FkaW5nRW5kOw0KDQoJdmFyIHRpbWVEaWZmZXJlbmNlID0gMDsgLy8gdGhpcyBpcyB0aGUgdGltZSBkaWZmZXJlbmNlIGJldHdlZW4gY2xpZW50IGFuZCBzZXJ2ZXIsIHVwZGF0ZWQgd2l0aCBldmVyeSBjYWxsIChpbiB0aWNrcykNCg0KCXZhciBzX0Vycm9yTWVzc2FnZXM7DQoNCgl0aGlzLl9fc2NvcGUgPSBmdW5jdGlvbihzY29wZSkgew0KCQlsZXQgcmV0ID0gbnVsbDsNCgkJaWYgKHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJykgew0KCQkJcmV0ID0gd2luZG93Ow0KCQl9IGVsc2UgaWYgKHR5cGVvZihXb3JrZXJHbG9iYWxTY29wZSkgIT09ICd1bmRlZmluZWQnKSB7DQoJCQlyZXQgPSBzZWxmOw0KCQl9IGVsc2UgaWYgKHR5cGVvZihnbG9iYWwpICE9PSAndW5kZWZpbmVkJykgew0KCQkJcmV0ID0gZ2xvYmFsOw0KCQl9DQoNCgkJaWYgKHNjb3BlKSByZXQgPSByZXRbc2NvcGVdOw0KCQlyZXR1cm4gcmV0Ow0KCX07DQoNCgl0aGlzLmJ1aWxkVVJMID0gZnVuY3Rpb24oc3JVUkwpIHsNCgkJaWYgKCFzclVSTCkgew0KCQkJdGhpcy5zclVSTCA9IHRoaXMuJF9SRVFVRVNUKCdzcicpOw0KCQkJaWYgKCF0aGlzLnNyVVJMKSB7DQoJCQkJaWYgKHR5cGVvZih3aW5kb3cpID09PSAidW5kZWZpbmVkIikgew0KCQkJCQlsZXQgaXAgPSB0aGlzLmlwQWRkcmVzcygpOw0KCQkJCQlpZiAoaXAgJiYgKGlwLnN0YXJ0c1dpdGgoIjE4Mi4xNjguIikgfHwgaXAgPT0gIjE5Mi4xNjguMS4yNTMiIHx8IGlwID09ICcxOTUuMTEyLjIxNS4yMTgnKSkgew0KCQkJCQkJdGhpcy5zclVSTCA9ICJodHRwOi8vMTgyLjE2OC43MC44MCI7DQoJCQkJCX0gZWxzZSB7DQoJCQkJCQl0aGlzLnNyVVJMID0gImh0dHA6Ly9hcnoubmFtbW91ci5jb206NzA4MCI7DQoJCQkJCX0NCgkJCQl9DQoJCQkJdGhpcy5zclVSTCArPSAnL21ldGhvZC9TZXJ2aWNlUm91dGVyLmFzaHgnOw0KCQkJfQ0KCQl9IGVsc2Ugew0KCQkJdGhpcy5zclVSTCA9IHNyVVJMOw0KCQl9DQoJCXRoaXMuc3JVUkwgKz0gJz9zcnZlcnNpb249MSc7DQoJCWlmICh0aGlzLiRfUkVRVUVTVCgnZ3ppcCcpKSB7DQoJCQl0aGlzLnNyVVJMICs9ICcmZ3ppcD0nICsgdGhpcy4kX1JFUVVFU1QoJ2d6aXAnKTsNCgkJfSBlbHNlIHsNCgkJCXRoaXMuc3JVUkwgKz0gJyZnemlwPXRydWUnOw0KCQl9DQoJCWlmICh0aGlzLmJDYWNoZSkgew0KCQkJdGhpcy5zclVSTCArPSAnJmNhY2hlPScgKyB0aGlzLmJDYWNoZTsNCgkJfQ0KCQlpZiAoIXRoaXMuJF9SRVFVRVNUKCdyYW5kJywgdGhpcy5zclVSTCkpIHsNCgkJCXRoaXMuc3JVUkwgKz0gJyZyYW5kPScgKyBNYXRoLnJhbmRvbSgpOw0KCQl9DQoNCgkJaWYgKHRoaXMuYkRlYnVnKSB7DQoJCQl0aGlzLnNyVVJMICs9ICcmREVCVUc9dHJ1ZSc7DQoJCX0NCg0KCQlpZiAoDQoJCQl0aGlzLmJBc3luYyAmJg0KCQkJdGhpcy5iTG9jYWwgJiYNCgkJCSF0aGlzLiRfUkVRVUVTVCgnYXN5bmMnLCB0aGlzLnNyVVJMKQ0KCQkpIHsNCgkJCXRoaXMuc3JVUkwgKz0gJyZhc3luYz10cnVlJzsNCgkJCWlmICh0aGlzLnJ1bkFmdGVyKSB7DQoJCQkJdGhpcy5zclVSTCArPSAnJnJ1bmFmdGVyPScgKyB0aGlzLnJ1bkFmdGVyOw0KCQkJfQ0KCQkJdGhpcy5iQXN5bmMgPSBmYWxzZTsNCgkJfQ0KDQoJCS8vdGhpcy5TaG93RGVidWcoJ3RoaXMuc3JVUkw9JyArIHRoaXMuc3JVUkwpOw0KDQoJCXJldHVybiB0aGlzLnNyVVJMOw0KCX07DQoNCgl0aGlzLmluaXQgPSBmdW5jdGlvbigNCgkJc3JVUkwsDQoJCXN5c3RlbU5hbWUsDQoJCWJQb3N0LA0KCQliRGVidWcsDQoJCWJTaG93RXJyb3JzLA0KCQlwcmVQcm9jZXNzSFRNTA0KCSkgew0KCQlpZiAodHlwZW9mIGRvY3VtZW50ID09PSAndW5kZWZpbmVkJykgew0KCQkJZG9jdW1lbnQgPSB7fTsNCgkJCXdpbmRvdyA9IHt9Ow0KCQl9DQoJCWlmICghYkRlYnVnICYmIGRvY3VtZW50LlVSTCAmJiBkb2N1bWVudC5VUkwuaW5kZXhPZignZGVidWc9dHJ1ZScpID4gMCkNCgkJCWJEZWJ1ZyA9IHRydWU7DQoNCgkJdGhpcy5iTG9jYWwgPSAhdGhpcy5TdG9yZSAmJg0KCQkJZG9jdW1lbnQuVVJMICYmDQoJCQkhKGRvY3VtZW50LlVSTC5pbmRleE9mKCdsb2NhbD1mYWxzZScpID49IDApOw0KCQlpZiAoIWRvY3VtZW50LlVSTCkgdGhpcy5iTG9jYWwgPSB0cnVlOw0KDQoJCXRoaXMuYkNhY2hlID0gdGhpcy4kX1JFUVVFU1QoJ2NhY2hlJyk7DQoJCXRoaXMuYkNhY2hlUmVzdWx0ID0gdGhpcy4kX1JFUVVFU1QoJ2NhY2hlUmVzdWx0Jyk7DQoNCgkJdGhpcy5zclVSTCA9IHRoaXMuYnVpbGRVUkwoc3JVUkwpOw0KDQoJCXRoaXMuQ1JOTCA9ICdcbic7DQoJCXRoaXMubk1heFVSTExlbmd0aCA9IDEwMDsNCg0KCQl0aGlzLnN5c3RlbU5hbWUgPSBzeXN0ZW1OYW1lOw0KDQoJCXRoaXMuYlBvc3QgPSBiUG9zdDsNCgkJdGhpcy5iRGVidWcgPSBiRGVidWc7DQoJCXRoaXMuYlNob3dFcnJvcnMgPSBiU2hvd0Vycm9yczsNCg0KCQl0aGlzLnNfRXJyb3JNZXNzYWdlcyA9ICcnOw0KDQoJCXJldHVybiB0aGlzOw0KCX07DQoNCgl0aGlzLnByZVByb2Nlc3NIVE1MID0gZnVuY3Rpb24oaHRtbCkgew0KCQlpZiAoIWh0bWwpIHJldHVybiBodG1sOw0KDQoJCXRyeSB7DQoJCQl2YXIgcmV0ID0gJyc7DQoJCQl2YXIgcGFydHMgPSBodG1sLnNwbGl0KCckJCcpOw0KCQkJZm9yICh2YXIgaSA9IDA7IGkgPCBwYXJ0cy5sZW5ndGg7IGkrKykgew0KCQkJCWlmIChpICUgMiA9PSAwKSB7DQoJCQkJCXJldCArPSBwYXJ0c1tpXTsNCgkJCQkJY29udGludWU7DQoJCQkJfQ0KCQkJCXRyeSB7DQoJCQkJCXZhciBvVmFsdWUgPSB0aGlzLnJ1blNjcmlwdChwYXJ0c1tpXSk7DQoJCQkJCWlmIChvVmFsdWUpIHsNCgkJCQkJCXJldCArPSBvVmFsdWU7DQoJCQkJCX0gZWxzZSB7DQoJCQkJCQlyZXQgKz0gJyc7DQoJCQkJCX0NCgkJCQl9IGNhdGNoIChlKSB7DQoJCQkJCXJldCArPSAnJzsNCgkJCQl9DQoJCQl9DQoNCgkJCWlmIChwcmVQcm9jZXNzSFRNTCAhPSBudWxsKSByZXQgPSBwcmVQcm9jZXNzSFRNTChyZXQpOw0KCQkJcmV0dXJuIHJldDsNCgkJfSBjYXRjaCAoZSkgew0KCQkJcmV0dXJuICcnOw0KCQl9DQoJfTsNCg0KCXRoaXMuJF9SRVFVRVNUID0gZnVuY3Rpb24oa2V5LCB1cmwpIHsNCgkJaWYgKHR5cGVvZih3aW5kb3cpID09PSAidW5kZWZpbmVkIikgcmV0dXJuIG51bGw7DQoNCgkJbGV0IHJldCA9IHVuZGVmaW5lZDsNCgkJaWYgKHVybCkgew0KCQkJdHJ5IHsNCgkJCQlyZXQgPSBuZXcgVVJMKHVybCkuc2VhcmNoUGFyYW1zLmdldChrZXkpOw0KCQkJfSBjYXRjaCAoZXgpIHsNCgkJCQl2YXIgcmVnZXggPSBuZXcgUmVnRXhwKCdbXFw/fCZdJyArIGtleSArICc9KFteJiNdKiknKTsNCgkJCQl2YXIgcmVzdWx0cyA9IHJlZ2V4LmV4ZWMoJz8nICsgdXJsLnNwbGl0KCc/JylbMV0pOw0KCQkJCXJldCA9IChyZXN1bHRzID09PSBudWxsKSA/ICcnIDogZGVjb2RlVVJJQ29tcG9uZW50KHJlc3VsdHNbMV0ucmVwbGFjZSgvXCsvZywgJyAnKSk7DQoJCQl9DQoJCX0gZWxzZSB7DQoJCQlyZXQgPSBuZXcgVVJMU2VhcmNoUGFyYW1zKHdpbmRvdy5sb2NhdGlvbi5zZWFyY2gpLmdldChrZXkpOw0KCQl9DQoNCgkJcmV0dXJuIHJldCA9PT0gbnVsbCA/ICcnIDogcmV0Ow0KCX07DQoNCgl0aGlzLmdyb3VwQnkgPSBmdW5jdGlvbihhciwgZmllbGQpIHsNCgkJaWYgKCFhciB8fCAhZmllbGQpIHJldHVybiBudWxsOw0KDQoJCXZhciBrZXlzID0gW107DQoJCWFyLmZvckVhY2goYSA9PiB7DQoJCQl2YXIga2V5ID0gbnVsbDsNCgkJCWZpZWxkLnNwbGl0KCcuJykuZm9yRWFjaChmID0+IGtleSA9IChrZXkgfHwgYSlbZl0pOw0KCQkJbGV0IGsgPSBrZXlzLmZpbmQoayA9PiB0aGlzLkVxdWFscyhrLmtleSwga2V5KSk7DQoJCQlpZiAoaykgew0KCQkJCWsudmFsdWVzLnB1c2goYSk7DQoJCQl9IGVsc2Ugew0KCQkJCWtleXMucHVzaCh7DQoJCQkJCWtleToga2V5LA0KCQkJCQl2YWx1ZXM6IFthXSwNCgkJCQl9KTsNCgkJCX0NCgkJfSk7DQoJCXJldHVybiBrZXlzOw0KCX07DQoNCgl0aGlzLmNvbXBpbGUgPSBmdW5jdGlvbihhck1vZHVsZXMpIHsNCgkJdmFyIGNhbGxzID0gW107DQoJCSQuZWFjaChhck1vZHVsZXMsIChpLCBtKSA9Pg0KCQkJY2FsbHMucHVzaCgNCgkJCQl0aGlzLl8oJ0NvbnRlbnRNYW5hZ2VyLmNtc0hUTUxQYWdlRmluZGFsbCcsIG51bGwsIHsNCgkJCQkJUGFnZTogbSwNCgkJCQl9KQ0KCQkJKQ0KCQkpOw0KCQlyZXR1cm4gJC53aGVuKC4uLmNhbGxzKS50aGVuKCguLi5hclJldCkgPT4gew0KCQkJdmFyIF9yZXQgPSBbXTsNCgkJCSQubWFwKGFyUmV0LCAocCkgPT4gew0KCQkJCXJldC5wdXNoKF8udGVtcGxhdGUocC5IVE1MKShzci5ydW5TY3JpcHQocFswXS5TY3JpcHQpKSk7DQoJCQl9KTsNCgkJCXJldHVybiBfcmV0Ow0KCQl9KTsNCgl9Ow0KDQoJdGhpcy5pbXBvcnQgPSBhc3luYyBmdW5jdGlvbihhck1vZHVsZXMpIHsNCgkJdmFyIHJldCA9IFtdOw0KCQlmb3IgKHZhciBpID0gMDsgaSA8IGFyTW9kdWxlcy5sZW5ndGg7IGkrKykgew0KCQkJbGV0IHAgPSBhd2FpdCB0aGlzLl8oJ0NvbnRlbnRNYW5hZ2VyLmNtc0hUTUxQYWdlRmluZCcsIG51bGwsIHsNCgkJCQlQYWdlOiBhck1vZHVsZXNbaV0sDQoJCQl9KTsNCgkJCXJldC5wdXNoKHApOw0KCQkJYXdhaXQgdGhpcy5ydW5TY3JpcHQocC5TY3JpcHQpOw0KCQl9DQoJCXJldHVybiByZXQ7DQoJfTsNCg0KCXRoaXMuZ2V0T2JqZWN0ID0gZnVuY3Rpb24ocykgew0KCQl2YXIgY29kZSA9IHMgKyAnOyc7DQoJCWNvZGUgPSAnKHR5cGVvZiAnICsgcyArICIgPT09ICd1bmRlZmluZWQnKT9zci5uZXdPYmplY3QoKToiICsgczsNCgkJLy9yZXR1cm4gdGhpcy5ydW5TY3JpcHQocysiOyIpOw0KCQlyZXR1cm4gdGhpcy5ydW5TY3JpcHQoY29kZSk7DQoJfTsNCg0KCXRoaXMucnVuU2NyaXB0ID0gZnVuY3Rpb24ocykgew0KCQlpZiAoIXMpIHJldHVybiBudWxsOw0KDQoJCWxldCBjTGluZXMgPSBzLnNwbGl0KCdcbicpOw0KCQl0cnkgew0KCQkJaWYgKHR5cGVvZihlc3ByaW1hKSAhPT0gJ3VuZGVmaW5lZCcpIHsNCgkJCQllc3ByaW1hLnBhcnNlKHMsIHsNCgkJCQkJZXM2OiB0cnVlDQoJCQkJfSk7DQoJCQl9DQoJCX0gY2F0Y2ggKGV4KSB7DQoJCQlpZiAoY0xpbmVzW2V4LmxpbmVOdW1iZXIgLSAxXS5pbmRleE9mKCdmb3IgYXdhaXQnKSA8IDApIHsNCgkJCQljb25zb2xlLmxvZygicnVuU2NyaXB0KCkgIiArIGV4LmRlc2NyaXB0aW9uLCBleC5saW5lTnVtYmVyLCBjTGluZXNbZXgubGluZU51bWJlciAtIDFdKTsNCgkJCQlyZXR1cm47DQoJCQl9DQoJCX0NCg0KCQlpZiAodHlwZW9mKHdpbmRvdykgIT09ICJ1bmRlZmluZWQiKSB7DQoJCQl0cnkgew0KCQkJCWlmICh3aW5kb3cuX2NvbnRlbnQgJiYgd2luZG93Ll9jb250ZW50LmV2YWwpIHsNCgkJCQkJdmFyIG91dHB1dCA9IHdpbmRvdy5fY29udGVudC5ldmFsKHMpOw0KCQkJCQlyZXR1cm4gb3V0cHV0Ow0KCQkJCX0NCgkJCX0gY2F0Y2ggKGUpIHsNCgkJCQl0aGlzLlNob3dFcnJvcignRkYgU0NSSVBUOiBcbicgKyBlLm1lc3NhZ2UgKyAnXG4nICsgcyk7DQoJCQl9DQoJCQl0cnkgew0KCQkJCWlmICh3aW5kb3cuZXhlY1NjcmlwdCkgew0KCQkJCQlpZiAocy5pbmRleE9mKCdcclxuJykgPiAwKSB7DQoJCQkJCQkvLyBhIG11bHRpLWxpbmUgc3RhdGVtZW50DQoJCQkJCQl3aW5kb3cuZXhlY1NjcmlwdChzKTsNCgkJCQkJCXJldHVybiBudWxsOw0KCQkJCQl9IGVsc2Ugew0KCQkJCQkJLy8gYSBzaW5nbGUtbGluZSBzdGF0ZW1lbnQNCgkJCQkJCW5ld1YgPSBudWxsOw0KCQkJCQkJdmFyIG5ld1MgPSAnbmV3ViA9ICcgKyBzOw0KCQkJCQkJd2luZG93LmV4ZWNTY3JpcHQobmV3Uyk7DQoJCQkJCQlyZXR1cm4gbmV3VjsNCgkJCQkJfQ0KCQkJCX0NCgkJCX0gY2F0Y2ggKGUpIHsNCgkJCQl0aGlzLlNob3dFcnJvcignSUU2IFNDUklQVDogXG4nICsgZS5tZXNzYWdlICsgJ1xuJyArIHMpOw0KCQkJfQ0KDQoJCQl0cnkgew0KCQkJCWlmICh3aW5kb3cuZXhlY1NjcmlwdCkgew0KCQkJCQlpZiAocy5pbmRleE9mKCdcclxuJykgPiAwKSB7DQoJCQkJCQkvLyBhIG11bHRpLWxpbmUgc3RhdGVtZW50DQoJCQkJCQl3aW5kb3cuZXhlY1NjcmlwdChzKTsNCgkJCQkJCXJldHVybiBudWxsOw0KCQkJCQl9IGVsc2Ugew0KCQkJCQkJLy8gYSBzaW5nbGUtbGluZSBzdGF0ZW1lbnQNCgkJCQkJCW5ld1YgPSBudWxsOw0KCQkJCQkJdmFyIG5ld1MgPSAnbmV3ViA9ICcgKyBzOw0KCQkJCQkJZXZhbChuZXdTKTsNCgkJCQkJCXJldHVybiBuZXdWOw0KCQkJCQl9DQoJCQkJfQ0KCQkJfSBjYXRjaCAoZSkgew0KCQkJCXRoaXMuU2hvd0Vycm9yKCdJRTcgU0NSSVBUOiBcbicgKyBlLm1lc3NhZ2UgKyAnXG4nICsgcyk7DQoJCQl9DQoNCgkJCXRyeSB7DQoJCQkJdmFyIGZuID0gZnVuY3Rpb24oKSB7DQoJCQkJCXZhciByZXQgPSB3aW5kb3cuZXZhbC5jYWxsKHdpbmRvdywgcyk7DQoJCQkJCXJldHVybiByZXQ7DQoJCQkJfTsNCg0KCQkJCXJldHVybiBmbigpOw0KCQkJfSBjYXRjaCAoZSkgew0KCQkJCXRoaXMuU2hvd0Vycm9yKCdUQUcgU0NSSVBUOiBcbicgKyBlLm1lc3NhZ2UgKyAnXG4nICsgcyk7DQoJCQl9DQoJCX0NCg0KCQl0cnkgew0KCQkJcyA9IHMucmVwbGFjZSgvbmV3IERhdGVcKDAwMDEvZywgJ25ldyBEYXRlKDEnKTsNCgkJCXJldHVybiBldmFsKHMpOw0KCQl9IGNhdGNoIChlKSB7DQoJCQl0aGlzLlNob3dFcnJvcignRVZBTCBTQ1JJUFQ6IFxuJyArIGUubWVzc2FnZSArICdcbicgKyBzKTsNCgkJfQ0KCX07DQoNCgl0aGlzLlNob3dPYmplY3QgPSBmdW5jdGlvbihvLCBiSWdub3JlRGVidWcpIHsNCgkJdmFyIHJldCA9ICdPYmplY3QgU3RydWN0dXJlOlxuJzsNCgkJZm9yIChzIGluIG8pIHsNCgkJCXRyeSB7DQoJCQkJcmV0ICs9IHMgKyAnOiAnICsgb1tzXSArICdcbic7DQoJCQl9IGNhdGNoIChlKSB7DQoJCQkJcmV0ICs9IHMgKyAnOiBFeGNlcHRpb24gd2l0aCB2YWx1ZSA9ICcgKyBlLm1lc3NhZ2UgKyAnXG4nOw0KCQkJfQ0KCQl9DQoNCgkJdGhpcy5TaG93RGVidWcocmV0LCBiSWdub3JlRGVidWcpOw0KCX07DQoNCgl0aGlzLlNob3dFcnJvciA9IGZ1bmN0aW9uKHMpIHsNCgkJY29uc29sZS5sb2cocyk7DQoJCWlmICh0aGlzLmJTaG93RXJyb3JzKSB0aGlzLlNob3dNZXNzYWdlKHMpOw0KCX07DQoNCgl0aGlzLmNjb3B5ID0gZnVuY3Rpb24ocykgew0KCQlpZiAod2luZG93LmNsaXBib2FyZERhdGEpIGNsaXBib2FyZERhdGEuc2V0RGF0YSgnVGV4dCcsIHMpOw0KCX07DQoNCgl0aGlzLlNob3dNZXNzYWdlID0gZnVuY3Rpb24ocykgew0KCQlpZiAodHlwZW9mIG5vdHkgIT09ICd1bmRlZmluZWQnKSB7DQoJCQlub3R5KHsNCgkJCQl0ZXh0OiBzLA0KCQkJCXR5cGU6ICdzdWNjZXNzJywNCgkJCQl0aW1lb3V0OiAyMDAwLA0KCQkJfSk7DQoJCX0gZWxzZSB7DQoJCQkvLyB0aGUgZGVmYXVsdA0KCQkJdHJ5IHsNCgkJCQkkKCI8ZGl2IHRpdGxlPSdJbmZvcm1hdGlvbic+PHA+IiArIHMgKyAnPC9wPjwvZGl2PicpLmRpYWxvZygpOw0KCQkJfSBjYXRjaCAoZSkgew0KCQkJCWNvbnNvbGUubG9nKHMpOw0KCQkJfQ0KCQl9DQoJfTsNCg0KCXRoaXMuU2hvd0RlYnVnID0gZnVuY3Rpb24ocywgYklnbm9yZURlYnVnKSB7DQoJCWlmICh0eXBlb2Yod2luZG93KSA9PT0gInVuZGVmaW5lZCIpIHsNCgkJCWNvbnNvbGUubG9nKCJTaG93RGVidWc6ICIgKyBzKTsNCgkJfQ0KCQlpZiAodGhpcy5iRGVidWcgfHwgYklnbm9yZURlYnVnKSB0aGlzLlNob3dNZXNzYWdlKHMpOw0KCX07DQoNCgl0aGlzLnBhcmFtID0gZnVuY3Rpb24oYXJncykgew0KCQl0aGlzLkNSTkwgPSB0aGlzLkNSTkwgfHwgIlxuIjsNCgkJdmFyIHJldCA9DQoJCQknLyonICsNCgkJCXRoaXMuQ1JOTCArDQoJCQknPCFbQ0RBVEFbJyArDQoJCQl0aGlzLkNSTkwgKw0KCQkJJ1BBUkFNRVRFUlMnICsNCgkJCXRoaXMuQ1JOTCArDQoJCQknXV0+JyArDQoJCQl0aGlzLkNSTkwgKw0KCQkJJyovJyArDQoJCQl0aGlzLkNSTkwgKw0KCQkJdGhpcy5DUk5MICsNCgkJCSc8cD4nICsNCgkJCXRoaXMuQ1JOTDsNCgkJZm9yICh2YXIgaSA9IDA7IGkgPCBhcmdzLmxlbmd0aDsgaSsrKSB7DQoJCQl2YXIgeG1sID0gdGhpcy5fdG9YTUwoYXJnc1tpXSk7DQoJCQlpZiAoZmFsc2UpIHsNCgkJCQkvLyB4bWwgY29udGFpbnMgY2hhcmFjdGVycyB0aGF0IHdvdWxkIG5vdCBhcnJpdmUgcHJvcGVybHkgYW5kIHNob3VsZCBiZSBjb252ZXJ0ZWQgdG8gYmFzZTY0DQoJCQkJeG1sID0gYnRvYSh4bWwpOw0KCQkJfQ0KCQkJcmV0ICs9ICc8cCcgKyBpICsgJz4nICsgdGhpcy5DUk5MICsgeG1sICsgJycgKyB0aGlzLkNSTkw7DQoJCQlyZXQgKz0gJzwvcCcgKyBpICsgJz4nICsgdGhpcy5DUk5MOw0KCQl9DQoJCXJldCArPSAnPC9wPicgKyB0aGlzLkNSTkw7DQoJCXJldHVybiByZXQ7DQoJfTsNCg0KCXRoaXMucmVzZXRDdXJzb3IgPSBmdW5jdGlvbigpIHsNCgkJaWYgKCFkb2N1bWVudC5ib2R5KSByZXR1cm47DQoJCWRvY3VtZW50LmJvZHkuc3R5bGUuY3Vyc29yID0gJ2Fycm93JzsNCgkJZG9jdW1lbnQuYm9keS5zdHlsZS5jdXJzb3IgPSAnJzsNCgl9Ow0KDQoJdGhpcy5zZXJ2ZXJEYXRlID0gZnVuY3Rpb24oZCkgew0KCQlsZXQgdGQgPSAwOw0KCQlpZiAodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnKSB7DQoJCQl0ZCA9IHdpbmRvdy50aW1lRGlmZmVyZW5jZTsNCgkJfSBlbHNlIGlmICh0eXBlb2YoZ2xvYmFsKSAhPT0gJ3VuZGVmaW5lZCcpIHsNCgkJCXRkID0gZ2xvYmFsLnRpbWVEaWZmZXJlbmNlOw0KCQl9IGVsc2UgaWYgKHR5cGVvZihXb3JrZXJHbG9iYWxTY29wZSkgIT09ICd1bmRlZmluZWQnKSB7DQoJCQl0ZCA9IHNlbGYudGltZURpZmZlcmVuY2U7DQoJCX0NCgkJcmV0dXJuIHRoaXMuYWRkTVNlY29uZHMoZCB8fCBuZXcgRGF0ZSgpLCAtdGQpOw0KCX07DQoNCgl0aGlzLnJ1blNSU2NyaXB0ID0gZnVuY3Rpb24ocykgew0KCQlyZXR1cm4gdGhpcy5ydW5TY3JpcHQoDQoJCQknKCgpID0+IHsgdmFyIHJldCA9IG51bGw7ICcgKw0KCQkJcyArDQoJCQknIGlmKHR5cGVvZih3aW5kb3cpIT09InVuZGVmaW5lZCIpe3dpbmRvdy5tZXRob2RfbmFtZSA9IG1ldGhvZF9uYW1lOyB3aW5kb3cuc2VydmVyX3RpbWUgPSBzZXJ2ZXJfdGltZTsgd2luZG93Ll9leGNlcHRpb24gPSB0eXBlb2YoX2V4Y2VwdGlvbik9PT0idW5kZWZpbmVkIj9udWxsOl9leGNlcHRpb247IHdpbmRvdy5leGVjdXRpb25fdGltZSA9IGV4ZWN1dGlvbl90aW1lO30gcmV0dXJuIHtfZXhjZXB0aW9uOiB0eXBlb2YoX2V4Y2VwdGlvbik9PT0idW5kZWZpbmVkIj9udWxsOl9leGNlcHRpb24sIG1ldGhvZF9uYW1lOiBtZXRob2RfbmFtZSwgc2VydmVyX3RpbWU6IHNlcnZlcl90aW1lLCBleGVjdXRpb25fdGltZTogZXhlY3V0aW9uX3RpbWUsIHJldDogcmV0fTt9KSgpOycNCgkJKTsNCgl9Ow0KDQoJdGhpcy5wcm9jZXNzUmVzdWx0ID0gYXN5bmMgZnVuY3Rpb24ocmVzKSB7DQoJCWlmICghcmVzIHx8ICFyZXMuQ29kZSB8fCAhcmVzLlN0b3JlZE1ldGhvZCkgew0KCQkJdGhpcy5BY3RpdmVSZXF1ZXN0ID0gbnVsbDsNCgkJCXJldHVybiByZXM7DQoJCX0NCg0KCQkvLyBmb3Igc3VyZSBhIG1ldGhvZCByZXN1bHQgZnJvbSBhbiBhc3luYyBjYWxsDQoJCWlmIChyZXMuUmVzdWx0KSB7DQoJCQkvLyB3ZSBnb3QgYSByZXN1bHQNCgkJCXZhciBfX3JldCA9IG51bGw7DQoJCQl0cnkgew0KCQkJCV9fcmV0ID0gdGhpcy5wcm9jZXNzUmVzcG9uc2UoNCwgbnVsbCwgcmVzLlJlc3VsdCwgbnVsbCk7DQoJCQl9IGNhdGNoIChlKSB7DQoJCQkJX19yZXQgPSByZXMuUmVzdWx0Ow0KCQkJfQ0KCQkJdGhpcy5BY3RpdmVSZXF1ZXN0ID0gbnVsbDsNCgkJCXJldHVybiBfX3JldDsNCgkJfQ0KDQoJCXZhciB0aW1lb3V0ID0gcmVzLlJ1bkFmdGVyIC0gcmVzLkRhdGU7DQoJCWlmICh0aW1lb3V0IDw9IDApIHsNCgkJCS8vIG5lZ2F0aXZlIHRpbWVvdXQgbWVhbnMgdGhhdCBpdCB3YXMgc3VwcG9zZWQgdG8gYmUgcnVuIGJ1dCBkaWQgbm90IGZvciBzb21lIHJlYXNvbiAoZGVsYXksIGZhaWx1cmUsIGV0Yy4uLikNCgkJCS8vIHNhbWUgZGF0ZSBhcyBydW5hZnRlciBtZWFucyB0aGF0IHdlIGFyZSB1c2luZyB0aGUgaW1tZWRpYXRlIGFzeW5jIGV4ZWN1dGlvbi4gaS5lLiB0aGVyZSBpcyBubyBuZWVkIGZvciB0aGUgcnVubmVyIHRocmVhZCB0YXNrDQoJCQl0aW1lb3V0ID0gMzAwMDA7DQoJCX0gZWxzZSBpZiAodGltZW91dCA+IDUgKiA2MCAqIDEwMDApIHsNCgkJCS8vIG1vcmUgdGhhbiB3ZSBjYW4gd2FpdCwgd2UgcmV0dXJuIGEgcmVmZXJlbmNlIHRvIHRoZSByZXN1bHQNCgkJCWNvbnNvbGUubG9nKA0KCQkJCSdXZSBjYW5ub3Qgd2FpdCAnICsNCgkJCQlNYXRoLmZsb29yKHRpbWVvdXQgLyAxMDAwKSArDQoJCQkJJyBzZWNvbmRzLiBSZXR1cm5pbmcgcmVzdWx0LicNCgkJCSk7DQoJCQlyZXR1cm4gcmVzOw0KCQl9DQoJCWNvbnNvbGUubG9nKA0KCQkJJ01ha2luZyB0aGUgbmV4dCBjYWxsIGluICcgKw0KCQkJTWF0aC5mbG9vcih0aW1lb3V0IC8gMTAwMCkgKw0KCQkJJyBzZWNvbmRzLicNCgkJKTsNCg0KCQlhd2FpdCBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gc2V0VGltZW91dChyZXNvbHZlLCB0aW1lb3V0KSk7DQoJCWlmICghdGhpcy5BY3RpdmVSZXF1ZXN0KSB7DQoJCQljb25zb2xlLmxvZygnTm8gQWN0aXZlUmVxdWVzdCwgZXhpdGluZy4uLicpOw0KCQkJcmV0dXJuIG51bGw7DQoJCX0NCgkJdHJ5IHsNCgkJCWxldCByZXQgPSBhd2FpdCAkLmFqYXgoew0KCQkJCXVybDogJy9tZXRob2QvYS5hc2h4P25hbWU9Q29udGVudE1hbmFnZXIuY21zTWV0aG9kUmVzdWx0RmluZCZwMD17Q29kZX0nICsNCgkJCQkJcmVzLkNvZGUgKw0KCQkJCQkney9Db2RlfXtJZH0nICsNCgkJCQkJcmVzLklkICsNCgkJCQkJJ3svSWR9JnJhbmQ9JyArDQoJCQkJCU1hdGgucmFuZG9tKCksDQoJCQl9KTsNCgkJCXJldCA9IHRoaXMucHJvY2Vzc1Jlc3BvbnNlKDQsIG51bGwsIHJldCwgdGhpcy5BY3RpdmVSZXF1ZXN0LlVSTCk7DQoJCQlyZXQgPSBhd2FpdCB0aGlzLnByb2Nlc3NSZXN1bHQocmV0KTsNCgkJCXJldHVybiByZXQ7DQoJCX0gY2F0Y2ggKGV4KSB7DQoJCQljb25zb2xlLmxvZygncHJvY2Vzc1Jlc3VsdCcsIGV4KTsNCgkJCXJldHVybiBhd2FpdCB0aGlzLl8oJ0NvbnRlbnRNYW5hZ2VyLmNtc01ldGhvZFJlc3VsdEZpbmQnLCBudWxsLCB7DQoJCQkJQ29kZTogcmVzLkNvZGUsDQoJCQkJSWQ6IHJlcy5JZCwNCgkJCX0pOw0KCQl9DQoJfTsNCg0KCXRoaXMucHJvY2Vzc1Jlc3BvbnNlID0gZnVuY3Rpb24ocmVhZHlTdGF0ZSwgY2FsbEJhY2ssIHJlc3BvbnNlVGV4dCwgdXJsKSB7DQoJCWlmIChbNCwgNDRdLmluZGV4T2YocmVhZHlTdGF0ZSkgPT0gLTEpIHJldHVybjsNCg0KCQl2YXIgc01ldGhvZE5hbWUgPSB0aGlzLiRfUkVRVUVTVCgnbmFtZScsIHVybCk7DQoNCgkJdHJ5IHsNCgkJCWlmIChyZWFkeVN0YXRlID09IDQpIHsNCgkJCQlsZXQgcmVzID0gKGFzeW5jICgpID0+IHsNCgkJCQkJcmV0dXJuIGF3YWl0IHRoaXMuY2FjaGVSZXN1bHQobnVsbCwgcmVzcG9uc2VUZXh0KTsNCgkJCQl9KSgpOw0KCQkJfQ0KDQoJCQkvL3JldCA9IG51bGw7DQoJCQkvL3NlcnZlcl90aW1lID0gbnVsbDsNCgkJCS8vX2V4Y2VwdGlvbiA9IG51bGw7DQoJCQl2YXIgYlNjcmlwdEVycm9yID0gZmFsc2U7DQoJCQl2YXIgX3JldCA9IG51bGw7DQoJCQl0cnkgew0KCQkJCV9yZXQgPSB0aGlzLnJ1blNSU2NyaXB0KHJlc3BvbnNlVGV4dCk7DQoJCQl9IGNhdGNoIChlKSB7DQoJCQkJaWYgKHR5cGVvZih3aW5kb3cpID09PSAidW5kZWZpbmVkIikgdGhyb3cgZTsNCgkJCQliU2NyaXB0RXJyb3IgPSB0cnVlOw0KCQkJfQ0KDQoJCQlpZiAoX3JldCAmJiBfcmV0LnNlcnZlcl90aW1lKSB7DQoJCQkJbGV0IHRkID0gbmV3IERhdGUoKS5nZXRUaW1lKCkgLSBfcmV0LnNlcnZlcl90aW1lLmdldFRpbWUoKTsNCg0KCQkJCXRyeSB7DQoJCQkJCXdpbmRvdy50aW1lRGlmZmVyZW5jZSA9IHRkOw0KCQkJCX0gY2F0Y2ggKGV4KSB7DQoJCQkJCWdsb2JhbC50aW1lRGlmZmVyZW5jZSA9IHRkOw0KCQkJCX0NCgkJCX0NCg0KCQkJaWYgKF9yZXQgJiYgX3JldC5fZXhjZXB0aW9uKSB7DQoJCQkJdGhpcy5TaG93RGVidWcoX2V4Y2VwdGlvbi5NZXNzYWdlKTsNCgkJCX0NCg0KCQkJaWYgKGNhbGxCYWNrICE9IG51bGwpIHsNCgkJCQl2YXIgY2FsbFJldCA9IG51bGw7DQoJCQkJdHJ5IHsNCgkJCQkJY2FsbFJldCA9IGNhbGxCYWNrKF9yZXQucmV0LCBfcmV0Ll9leGNlcHRpb24pOw0KCQkJCX0gY2F0Y2ggKGUpIHsNCgkJCQkJdGhpcy5TaG93RXJyb3IoDQoJCQkJCQknRXJyb3IgaW4gQ2FsbGJhY2s6XG5cbicgKyBjYWxsQmFjayArICdcblxuJyArIGUubWVzc2FnZQ0KCQkJCQkpOw0KCQkJCX0NCgkJCQlpZiAoDQoJCQkJCXR5cGVvZiBfcmV0Lm1ldGhvZF9uYW1lICE9PSAndW5kZWZpbmVkJyAmJg0KCQkJCQl0eXBlb2Ygc01ldGhvZE5hbWUgIT09ICd1bmRlZmluZWQnICYmDQoJCQkJCXNNZXRob2ROYW1lICE9IF9yZXQubWV0aG9kX25hbWUNCgkJCQkpIHsNCgkJCQkJdGhpcy5TaG93RXJyb3IoDQoJCQkJCQknTWlzbWF0Y2ggaW4gTWV0aG9kIGJldHdlZW4gc2VydmVyIGFuZCBjbGllbnQ6XG5TZXJ2ZXIgTWV0aG9kIE5hbWU6ICcgKw0KCQkJCQkJX3JldC5tZXRob2RfbmFtZSArDQoJCQkJCQknXG5DbGllbnQgTWV0aG9kIE5hbWU6ICcgKw0KCQkJCQkJc01ldGhvZE5hbWUNCgkJCQkJKTsNCgkJCQl9DQoJCQkJKA0KCQkJCQl0aGlzLmZMb2FkaW5nRW5kIHx8DQoJCQkJCWZ1bmN0aW9uKCkgew0KCQkJCQkJd2luZG93LnNyLnJlc2V0Q3Vyc29yKCk7DQoJCQkJCX0NCgkJCQkpKCk7DQoNCgkJCQlyZXR1cm4gKA0KCQkJCQljYWxsUmV0IHx8IF9yZXQucmV0IHx8IChiU2NyaXB0RXJyb3IgPyByZXNwb25zZVRleHQgOiBudWxsKQ0KCQkJCSk7DQoJCQl9IGVsc2Ugew0KCQkJCWlmICh0eXBlb2Yod2luZG93KSAhPT0gInVuZGVmaW5lZCIpIHRoaXMucmVzZXRDdXJzb3IoKTsNCgkJCQlyZXR1cm4gKF9yZXQgPyBfcmV0LnJldCA6IG51bGwpIHx8IChiU2NyaXB0RXJyb3IgPyByZXNwb25zZVRleHQgOiBudWxsKTsNCgkJCX0NCgkJfSBjYXRjaCAoZSkgew0KCQkJaWYgKHR5cGVvZih3aW5kb3cpID09PSAidW5kZWZpbmVkIikgew0KCQkJCXRocm93IGU7DQoJCQl9DQoJCQl0aGlzLnJlc2V0Q3Vyc29yKCk7DQoJCQl0aGlzLlNob3dFcnJvcignRXJyb3IgaW4gY29kZTogJyArIGUubWVzc2FnZSArICdcbicgKyByZXNwb25zZVRleHQpOw0KCQl9DQoNCgkJcmV0dXJuIG51bGw7DQoJfTsNCg0KCXRoaXMuaXNPYmplY3QgPSBmdW5jdGlvbihvKSB7DQoJCXJldHVybiAoDQoJCQlvICE9IG51bGwgJiYNCgkJCXR5cGVvZiBvID09ICdvYmplY3QnICYmDQoJCQkhKG8uY29uc3RydWN0b3IudG9TdHJpbmcoKS5pbmRleE9mKCdmdW5jdGlvbiBEYXRlKCknKSA+IC0xKSAmJg0KCQkJIShvLmNvbnN0cnVjdG9yLnRvU3RyaW5nKCkuaW5kZXhPZignQXJyYXkoKScpID4gLTEpDQoJCSk7DQoJfTsNCg0KCXRoaXMuX3RvSlMgPSBmdW5jdGlvbihvKSB7DQoJCWlmIChvID09IG51bGwpIHJldHVybiAnbnVsbCc7DQoNCgkJdmFyIHMgPSAnJzsNCgkJc3dpdGNoICh0eXBlb2Ygbykgew0KCQkJY2FzZSAnc3RyaW5nJzoNCgkJCQlzICs9DQoJCQkJCSciJyArDQoJCQkJCXRoaXMubXlSZXBsYWNlKA0KCQkJCQkJdGhpcy5lc2NhcGVTdHJpbmcobyksDQoJCQkJCQlbJyI6ICwnXSwNCgkJCQkJCVsnIjogbnVsbCwnXQ0KCQkJCQkpICsNCgkJCQkJJyInOw0KCQkJCWJyZWFrOw0KCQkJY2FzZSAnbnVtYmVyJzoNCgkJCQlzICs9IG87DQoJCQkJYnJlYWs7DQoJCQljYXNlICdib29sZWFuJzoNCgkJCQlzICs9IG8gPyAndHJ1ZScgOiAnZmFsc2UnOw0KCQkJCWJyZWFrOw0KCQkJY2FzZSAnb2JqZWN0JzoNCgkJCQkvLyBEYXRlDQoJCQkJaWYgKG8uY29uc3RydWN0b3IudG9TdHJpbmcoKS5pbmRleE9mKCdmdW5jdGlvbiBEYXRlKCknKSA+IC0xKSB7DQoJCQkJCXZhciB5ZWFyID0gby5nZXRGdWxsWWVhcigpLnRvU3RyaW5nKCk7DQoJCQkJCS8vdmFyIG1vbnRoID0gKG8uZ2V0TW9udGgoKSArIDEpLnRvU3RyaW5nKCk7IG1vbnRoID0gKG1vbnRoLmxlbmd0aCA9PSAxKSA/ICIwIiArIG1vbnRoIDogbW9udGg7DQoJCQkJCXZhciBtb250aCA9IG8uZ2V0TW9udGgoKS50b1N0cmluZygpOw0KCQkJCQltb250aCA9IG1vbnRoLmxlbmd0aCA9PSAxID8gJzAnICsgbW9udGggOiBtb250aDsNCgkJCQkJdmFyIGRhdGUgPSBvLmdldERhdGUoKS50b1N0cmluZygpOw0KCQkJCQlkYXRlID0gZGF0ZS5sZW5ndGggPT0gMSA/ICcwJyArIGRhdGUgOiBkYXRlOw0KCQkJCQl2YXIgaG91cnMgPSBvLmdldEhvdXJzKCkudG9TdHJpbmcoKTsNCgkJCQkJaG91cnMgPSBob3Vycy5sZW5ndGggPT0gMSA/ICcwJyArIGhvdXJzIDogaG91cnM7DQoJCQkJCXZhciBtaW51dGVzID0gby5nZXRNaW51dGVzKCkudG9TdHJpbmcoKTsNCgkJCQkJbWludXRlcyA9IG1pbnV0ZXMubGVuZ3RoID09IDEgPyAnMCcgKyBtaW51dGVzIDogbWludXRlczsNCgkJCQkJdmFyIHNlY29uZHMgPSBvLmdldFNlY29uZHMoKS50b1N0cmluZygpOw0KCQkJCQlzZWNvbmRzID0gc2Vjb25kcy5sZW5ndGggPT0gMSA/ICcwJyArIHNlY29uZHMgOiBzZWNvbmRzOw0KCQkJCQl2YXIgbWlsbGlzZWNvbmRzID0gby5nZXRNaWxsaXNlY29uZHMoKS50b1N0cmluZygpOw0KCQkJCQl2YXIgdHptaW51dGVzID0gTWF0aC5hYnMoby5nZXRUaW1lem9uZU9mZnNldCgpKTsNCgkJCQkJdmFyIHR6aG91cnMgPSAwOw0KCQkJCQl3aGlsZSAodHptaW51dGVzID49IDYwKSB7DQoJCQkJCQl0emhvdXJzKys7DQoJCQkJCQl0em1pbnV0ZXMgLT0gNjA7DQoJCQkJCX0NCgkJCQkJdHptaW51dGVzID0NCgkJCQkJCXR6bWludXRlcy50b1N0cmluZygpLmxlbmd0aCA9PSAxID8NCgkJCQkJCScwJyArIHR6bWludXRlcy50b1N0cmluZygpIDoNCgkJCQkJCXR6bWludXRlcy50b1N0cmluZygpOw0KCQkJCQl0emhvdXJzID0NCgkJCQkJCXR6aG91cnMudG9TdHJpbmcoKS5sZW5ndGggPT0gMSA/DQoJCQkJCQknMCcgKyB0emhvdXJzLnRvU3RyaW5nKCkgOg0KCQkJCQkJdHpob3Vycy50b1N0cmluZygpOw0KCQkJCQl2YXIgdGltZXpvbmUgPQ0KCQkJCQkJKG8uZ2V0VGltZXpvbmVPZmZzZXQoKSA8IDAgPyAnKycgOiAnLScpICsNCgkJCQkJCXR6aG91cnMgKw0KCQkJCQkJJzonICsNCgkJCQkJCXR6bWludXRlczsNCgkJCQkJcyArPQ0KCQkJCQkJJ25ldyBEYXRlKCcgKw0KCQkJCQkJeWVhciArDQoJCQkJCQknLCcgKw0KCQkJCQkJbW9udGggKw0KCQkJCQkJJywnICsNCgkJCQkJCWRhdGUgKw0KCQkJCQkJJywnICsNCgkJCQkJCWhvdXJzICsNCgkJCQkJCScsJyArDQoJCQkJCQltaW51dGVzICsNCgkJCQkJCScsJyArDQoJCQkJCQlzZWNvbmRzICsNCgkJCQkJCScsJyArDQoJCQkJCQltaWxsaXNlY29uZHMgKw0KCQkJCQkJJyknOw0KCQkJCX0NCgkJCQkvLyBBcnJheQ0KCQkJCWVsc2UgaWYgKG8uY29uc3RydWN0b3IudG9TdHJpbmcoKS5pbmRleE9mKCdBcnJheSgpJykgPiAtMSkgew0KCQkJCQlzICs9ICdbJzsNCgkJCQkJZm9yICh2YXIgcCBpbiBvKSB7DQoJCQkJCQlzICs9ICcnOw0KCQkJCQkJaWYgKCFpc05hTihwKSkgew0KCQkJCQkJCS8vIGxpbmVhciBhcnJheQ0KCQkJCQkJCXMgKz0gdGhpcy5fdG9KUyhvW3BdKTsNCgkJCQkJCX0gZWxzZSB7DQoJCQkJCQkJLy8gYXNzb2NpYXRpdmUgYXJyYXkNCgkJCQkJCQlzICs9ICd7IicgKyBwICsgJyI6ICcgKyB0aGlzLl90b0pTKG9bcF0pICsgJ30nOw0KCQkJCQkJfQ0KCQkJCQkJcyArPSAnLCAnOw0KCQkJCQl9DQoJCQkJCXMgKz0gJ10nOw0KCQkJCX0NCgkJCQkvLyBPYmplY3Qgb3IgY3VzdG9tIGZ1bmN0aW9uDQoJCQkJZWxzZSB7DQoJCQkJCXMgKz0gJ3snOw0KCQkJCQlmb3IgKHZhciBwIGluIG8pIHsNCgkJCQkJCXMgKz0gJyInICsgcCArICciOiAnICsgdGhpcy5fdG9KUyhvW3BdKSArICcsICc7DQoJCQkJCX0NCgkJCQkJaWYgKHMubGFzdEluZGV4T2YoJywgJykgPT0gcy5sZW5ndGggLSAyKQ0KCQkJCQkJcyA9IHMuc3Vic3RyaW5nKDAsIHMubGVuZ3RoIC0gMik7DQoJCQkJCXMgKz0gJ30nOw0KCQkJCX0NCgkJCQlicmVhazsNCgkJCWNhc2UgJ2Z1bmN0aW9uJzoNCgkJCQkvLyBmdW5jdGlvbnMgYXJlIG5vdCB3b3JraW5nLCBJTExFR0FMIFRPS0VOLi4uLg0KCQkJCS8vcyArPSAiXCIiK3RoaXMuZXNjYXBlU3RyaW5nKG8udG9TdHJpbmcoKSkrIlwiIjsNCgkJCQlzICs9ICdudWxsJzsNCgkJCQlicmVhazsNCgkJCWRlZmF1bHQ6DQoJCQkJcyArPSAnbnVsbCc7DQoJCX0NCgkJcmV0dXJuIHM7DQoJfTsNCg0KCXRoaXMuZXNjYXBlU3RyaW5nID0gZnVuY3Rpb24odGV4dCkgew0KCQlpZiAoIWFyZ3VtZW50cy5jYWxsZWUuc1JFKSB7DQoJCQl2YXIgc3BlY2lhbHMgPSBbDQoJCQkJJ1xyJywNCgkJCQknXG4nLA0KCQkJCSdcZicsDQoJCQkJJ1xiJywNCgkJCQknXHQnLA0KCQkJCSInIiwNCgkJCQknJicsDQoJCQkJJy8nLA0KCQkJCScuJywNCgkJCQknKicsDQoJCQkJJysnLA0KCQkJCSc/JywNCgkJCQknfCcsDQoJCQkJJygnLA0KCQkJCScpJywNCgkJCQknWycsDQoJCQkJJ10nLA0KCQkJCSd7JywNCgkJCQknfScsDQoJCQkJJ1xcJywNCgkJCQknIicsDQoJCQldOw0KCQkJYXJndW1lbnRzLmNhbGxlZS5zUkUgPSBuZXcgUmVnRXhwKA0KCQkJCScoXFwnICsgc3BlY2lhbHMuam9pbignfFxcJykgKyAnKScsDQoJCQkJJ2cnDQoJCQkpOw0KCQl9DQoJCXZhciByZXQgPSB0ZXh0LnJlcGxhY2UoYXJndW1lbnRzLmNhbGxlZS5zUkUsICdcXCQxJyk7DQoNCgkJcmV0ID0gdGhpcy5teVJlcGxhY2UocmV0LCBbJzwnLCAnPiddLCBbJyZsdDsnLCAnJmd0OyddKTsNCgkJcmV0ID0gdGhpcy5teVJlcGxhY2UoDQoJCQlyZXQsDQoJCQlbJ1xyJywgJ1xuJywgJ1x0J10sDQoJCQlbJ1xcJyArICdyJywgJ1xcJyArICduJywgJ1xcJyArICd0J10NCgkJKTsNCg0KCQlyZXR1cm4gcmV0Ow0KCX07DQoNCgl0aGlzLmlwQWRkcmVzcyA9IGZ1bmN0aW9uKCkgew0KCQl0cnkgew0KCQkJaWYgKHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJykgcmV0dXJuIG51bGw7DQoJCQlpZiAodHlwZW9mKGdsb2JhbCkgPT09ICd1bmRlZmluZWQnIHx8IHR5cGVvZihnbG9iYWwub3MpID09PSAndW5kZWZpbmVkJykgew0KCQkJCS8vIGNvbnNvbGUubG9nKCJpcEFkZHJlc3MoKTogSW52YWxpZCBnbG9iYWwgb3IgZ2xvYmFsLm9zIG5vdCBkZWZpbmVkIik7DQoJCQkJcmV0dXJuIG51bGw7DQoJCQl9DQoJCQlyZXR1cm4gW10uY29uY2F0KC4uLk9iamVjdC52YWx1ZXMoZ2xvYmFsLm9zLm5ldHdvcmtJbnRlcmZhY2VzKCkpKS5maW5kKChkZXRhaWxzKSA9PiBkZXRhaWxzLmZhbWlseSA9PT0gJ0lQdjQnICYmICFkZXRhaWxzLmludGVybmFsKS5hZGRyZXNzOw0KCQl9IGNhdGNoIChleCkgew0KCQkJY29uc29sZS5sb2coImlwQWRkcmVzcygpOiAiICsgZXgpOw0KCQkJcmV0dXJuIG51bGw7DQoJCX0NCgl9DQoNCgl0aGlzLl90b1hNTCA9IGZ1bmN0aW9uKG8sIGxldmVsKSB7DQoJCWlmICghbGV2ZWwpIGxldmVsID0gMDsNCgkJdmFyIHMgPSAnJzsNCgkJaWYgKG8gPT0gbnVsbCkgcmV0dXJuIHM7DQoJCXN3aXRjaCAodHlwZW9mIG8pIHsNCgkJCWNhc2UgJ3N0cmluZyc6DQoJCQkJcyArPSAnPCFbQ0RBVEFbJyArIG8gKyAnXV0+JzsNCgkJCQlicmVhazsNCgkJCWNhc2UgJ251bWJlcic6DQoJCQljYXNlICdib29sZWFuJzoNCgkJCQlzICs9IG8udG9TdHJpbmcoKTsNCgkJCQlicmVhazsNCgkJCWNhc2UgJ29iamVjdCc6DQoJCQkJLy8gRGF0ZQ0KCQkJCWlmICgNCgkJCQkJby5jb25zdHJ1Y3RvciAmJg0KCQkJCQlvLmNvbnN0cnVjdG9yLnRvU3RyaW5nKCkuaW5kZXhPZignZnVuY3Rpb24gRGF0ZSgpJykgPiAtMSAmJg0KCQkJCQlvLmNvbnN0cnVjdG9yLm5hbWUgPT0gIkRhdGUiDQoJCQkJKSB7DQoJCQkJCXZhciB5ZWFyID0gby5nZXRVVENGdWxsWWVhcigpLnRvU3RyaW5nKCk7DQoJCQkJCXZhciBtb250aCA9IChvLmdldFVUQ01vbnRoKCkgKyAxKS50b1N0cmluZygpOw0KCQkJCQltb250aCA9IG1vbnRoLmxlbmd0aCA9PSAxID8gJzAnICsgbW9udGggOiBtb250aDsNCgkJCQkJdmFyIGRhdGUgPSBvLmdldFVUQ0RhdGUoKS50b1N0cmluZygpOw0KCQkJCQlkYXRlID0gZGF0ZS5sZW5ndGggPT0gMSA/ICcwJyArIGRhdGUgOiBkYXRlOw0KCQkJCQl2YXIgaG91cnMgPSBvLmdldFVUQ0hvdXJzKCkudG9TdHJpbmcoKTsNCgkJCQkJaG91cnMgPSBob3Vycy5sZW5ndGggPT0gMSA/ICcwJyArIGhvdXJzIDogaG91cnM7DQoJCQkJCXZhciBtaW51dGVzID0gby5nZXRVVENNaW51dGVzKCkudG9TdHJpbmcoKTsNCgkJCQkJbWludXRlcyA9IG1pbnV0ZXMubGVuZ3RoID09IDEgPyAnMCcgKyBtaW51dGVzIDogbWludXRlczsNCgkJCQkJdmFyIHNlY29uZHMgPSBvLmdldFVUQ1NlY29uZHMoKS50b1N0cmluZygpOw0KCQkJCQlzZWNvbmRzID0gc2Vjb25kcy5sZW5ndGggPT0gMSA/ICcwJyArIHNlY29uZHMgOiBzZWNvbmRzOw0KCQkJCQl2YXIgbWlsbGlzZWNvbmRzID0gby5nZXRVVENNaWxsaXNlY29uZHMoKS50b1N0cmluZygpOw0KCQkJCQl2YXIgdHptaW51dGVzID0gTWF0aC5hYnMoby5nZXRUaW1lem9uZU9mZnNldCgpKTsNCgkJCQkJdmFyIHR6aG91cnMgPSAwOw0KCQkJCQl3aGlsZSAodHptaW51dGVzID49IDYwKSB7DQoJCQkJCQl0emhvdXJzKys7DQoJCQkJCQl0em1pbnV0ZXMgLT0gNjA7DQoJCQkJCX0NCgkJCQkJdHptaW51dGVzID0NCgkJCQkJCXR6bWludXRlcy50b1N0cmluZygpLmxlbmd0aCA9PSAxID8NCgkJCQkJCScwJyArIHR6bWludXRlcy50b1N0cmluZygpIDoNCgkJCQkJCXR6bWludXRlcy50b1N0cmluZygpOw0KCQkJCQl0emhvdXJzID0NCgkJCQkJCXR6aG91cnMudG9TdHJpbmcoKS5sZW5ndGggPT0gMSA/DQoJCQkJCQknMCcgKyB0emhvdXJzLnRvU3RyaW5nKCkgOg0KCQkJCQkJdHpob3Vycy50b1N0cmluZygpOw0KCQkJCQl2YXIgdGltZXpvbmUgPQ0KCQkJCQkJKG8uZ2V0VGltZXpvbmVPZmZzZXQoKSA8IDAgPyAnKycgOiAnLScpICsNCgkJCQkJCXR6aG91cnMgKw0KCQkJCQkJJzonICsNCgkJCQkJCXR6bWludXRlczsNCgkJCQkJLy9zICs9IHllYXIgKyAiLSIgKyBtb250aCArICItIiArIGRhdGUgKyAiVCIgKyBob3VycyArICI6IiArIG1pbnV0ZXMgKyAiOiIgKyBzZWNvbmRzICsgIi4iICsgbWlsbGlzZWNvbmRzICsgdGltZXpvbmU7DQoJCQkJCXMgKz0NCgkJCQkJCW1vbnRoICsNCgkJCQkJCScvJyArDQoJCQkJCQlkYXRlICsNCgkJCQkJCScvJyArDQoJCQkJCQl5ZWFyICsNCgkJCQkJCScgJyArDQoJCQkJCQlob3VycyArDQoJCQkJCQknOicgKw0KCQkJCQkJbWludXRlcyArDQoJCQkJCQknOicgKw0KCQkJCQkJc2Vjb25kczsNCgkJCQl9DQoJCQkJLy8gQXJyYXkNCgkJCQllbHNlIGlmICgNCgkJCQkJby5jb25zdHJ1Y3RvciAmJg0KCQkJCQlvLmNvbnN0cnVjdG9yLnRvU3RyaW5nKCkuaW5kZXhPZignQXJyYXkoKScpID4gLTENCgkJCQkpIHsNCgkJCQkJZm9yICh2YXIgcCBpbiBvKSB7DQoJCQkJCQlpZiAocCA9PSAnT1BFUkFUT1JTJyB8fCBwID09ICdPUlMnKSBjb250aW51ZTsNCgkJCQkJCXMgKz0gJzxPYmplY3Q+JzsNCgkJCQkJCWlmICghaXNOYU4ocCkpIHsNCgkJCQkJCQkvLyBsaW5lYXIgYXJyYXkNCgkJCQkJCQlpZiAob1twXSA9PSBudWxsKSB7DQoJCQkJCQkJCS8vIG51bGwgZW50cnkgaW4gdGhlIGFycmF5DQoJCQkJCQkJCXMgKz0gJzxJZD4wPC9JZD4nOw0KCQkJCQkJCX0gZWxzZSB7DQoJCQkJCQkJCS9mdW5jdGlvblxzKyhcdyopXHMqXCgvZ2kuZXhlYygNCgkJCQkJCQkJCW9bcF0uY29uc3RydWN0b3IudG9TdHJpbmcoKQ0KCQkJCQkJCQkpOw0KCQkJCQkJCQl2YXIgdHlwZSA9IFJlZ0V4cC4kMTsNCgkJCQkJCQkJc3dpdGNoICh0eXBlKSB7DQoJCQkJCQkJCQljYXNlICcnOg0KCQkJCQkJCQkJCXR5cGUgPSB0eXBlb2Ygb1twXTsNCgkJCQkJCQkJCWNhc2UgJ1N0cmluZyc6DQoJCQkJCQkJCQkJdHlwZSA9ICdzdHJpbmcnOw0KCQkJCQkJCQkJCWJyZWFrOw0KCQkJCQkJCQkJY2FzZSAnTnVtYmVyJzoNCgkJCQkJCQkJCQl0eXBlID0gJ2ludCc7DQoJCQkJCQkJCQkJYnJlYWs7DQoJCQkJCQkJCQljYXNlICdCb29sZWFuJzoNCgkJCQkJCQkJCQl0eXBlID0gJ2Jvb2wnOw0KCQkJCQkJCQkJCWJyZWFrOw0KCQkJCQkJCQkJY2FzZSAnRGF0ZSc6DQoJCQkJCQkJCQkJdHlwZSA9ICdEYXRlVGltZSc7DQoJCQkJCQkJCQkJYnJlYWs7DQoJCQkJCQkJCX0NCgkJCQkJCQkJcyArPSB0aGlzLl90b1hNTChvW3BdLCBsZXZlbCsrKTsNCgkJCQkJCQl9DQoJCQkJCQl9IGVsc2Ugew0KCQkJCQkJCS8vIGFzc29jaWF0aXZlIGFycmF5DQoJCQkJCQkJcyArPQ0KCQkJCQkJCQknPCcgKw0KCQkJCQkJCQlwICsNCgkJCQkJCQkJdGhpcy5jb29wKG8sIHApICsNCgkJCQkJCQkJJz4nICsNCgkJCQkJCQkJdGhpcy5fdG9YTUwob1twXSwgbGV2ZWwrKykgKw0KCQkJCQkJCQknPC8nICsNCgkJCQkJCQkJcCArDQoJCQkJCQkJCSc+JzsNCgkJCQkJCX0NCgkJCQkJCXMgKz0gJzwvT2JqZWN0PicgKyB0aGlzLkNSTkw7DQoJCQkJCX0NCgkJCQl9DQoJCQkJLy8gT2JqZWN0IG9yIGN1c3RvbSBmdW5jdGlvbg0KCQkJCWVsc2Ugew0KCQkJCQlpZiAobyA9PSBudWxsIHx8IG8uSWQgPT0gMCkge30gZWxzZSBpZiAoZmFsc2UgJiYgby5JZCkgew0KCQkJCQkJLy8gdGhpcyBpcyBjcmVhdGluZyBhIHByb2JsZW0sIGJldHRlciBzZW5kIGFsbCB0aGUgb2JqZWN0DQoJCQkJCQkvLyBkbyBub3Qgc2VuZCBvdGhlciBkYXRhIGlmIHdlIGhhdmUgYSB2YWx1ZSBmb3IgdGhlIElkDQoJCQkJCQlzICs9ICc8SWQ+JyArIHRoaXMuX3RvWE1MKG8uSWQsIGxldmVsKyspICsgJzwvSWQ+JzsNCgkJCQkJfSBlbHNlIHsNCgkJCQkJCWZvciAodmFyIHAgaW4gbykgew0KCQkJCQkJCWlmIChwID09ICdPUEVSQVRPUlMnIHx8IHAgPT0gJ09SUycpIGNvbnRpbnVlOw0KCQkJCQkJCXMgKz0NCgkJCQkJCQkJJzwnICsNCgkJCQkJCQkJcCArDQoJCQkJCQkJCXRoaXMuY29vcChvLCBwKSArDQoJCQkJCQkJCXRoaXMuT1IobywgcCkgKw0KCQkJCQkJCQknPicgKw0KCQkJCQkJCQl0aGlzLl90b1hNTChvW3BdLCBsZXZlbCsrKSArDQoJCQkJCQkJCSc8LycgKw0KCQkJCQkJCQlwICsNCgkJCQkJCQkJJz4nOw0KCQkJCQkJfQ0KCQkJCQl9DQoJCQkJfQ0KCQkJCWJyZWFrOw0KCQl9DQoJCXJldHVybiBzOw0KCX07DQoNCgl0aGlzLk9SID0gZnVuY3Rpb24obywgcCkgew0KCQlyZXR1cm4gby5PUlMgJiYgby5PUlNbcF0gPw0KCQkJIiBPUj0nIiArDQoJCQl0aGlzLm15UmVwbGFjZShvLk9SU1twXSwgWyc8JywgJz4nXSwgWycmbHQ7JywgJyZndDsnXSkgKw0KCQkJIiciIDoNCgkJCScnOw0KCX07DQoNCgl0aGlzLmNvb3AgPSBmdW5jdGlvbihvLCBwKSB7DQoJCWlmICghby5PUEVSQVRPUlMgfHwgIW8uT1BFUkFUT1JTW3BdKSB7DQoJCQlyZXR1cm4gJyc7DQoJCX0NCgkJcmV0dXJuICgNCgkJCSIgY29vcD0nIiArDQoJCQl0aGlzLm15UmVwbGFjZShvLk9QRVJBVE9SU1twXSwgWyc8JywgJz4nXSwgWycmbHQ7JywgJyZndDsnXSkgKw0KCQkJIiciDQoJCSk7DQoJfTsNCg0KCXRoaXMuZ2V0WG1sSFRUUCA9IGZ1bmN0aW9uKCkgew0KCQl2YXIgeCA9IG51bGw7DQoJCXZhciBhY3RpdmV4bW9kZXMgPSBbJ01zeG1sMi5YTUxIVFRQJywgJ01pY3Jvc29mdC5YTUxIVFRQJ107IC8vYWN0aXZlWCB2ZXJzaW9ucyB0byBjaGVjayBmb3IgaW4gSUUNCgkJaWYgKHdpbmRvdy5BY3RpdmVYT2JqZWN0KSB7DQoJCQkvL1Rlc3QgZm9yIHN1cHBvcnQgZm9yIEFjdGl2ZVhPYmplY3QgaW4gSUUgZmlyc3QgKGFzIFhNTEh0dHBSZXF1ZXN0IGluIElFNyBpcyBicm9rZW4pDQoJCQlmb3IgKHZhciBpID0gMDsgaSA8IGFjdGl2ZXhtb2Rlcy5sZW5ndGg7IGkrKykgew0KCQkJCXRyeSB7DQoJCQkJCXggPSBuZXcgQWN0aXZlWE9iamVjdChhY3RpdmV4bW9kZXNbaV0pOw0KCQkJCQlicmVhazsNCgkJCQl9IGNhdGNoIChlKSB7DQoJCQkJCS8vc3VwcHJlc3MgZXJyb3INCgkJCQl9DQoJCQl9DQoJCX0gZWxzZSBpZiAod2luZG93LlhNTEh0dHBSZXF1ZXN0KSB7DQoJCQkvLyBpZiBNb3ppbGxhLCBTYWZhcmkgZXRjDQoJCQl4ID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7DQoJCX0gZWxzZSB7DQoJCQl4ID0gbnVsbDsNCgkJfQ0KDQoJCXJldHVybiAod2luZG93LnhtbEhUVFAgPSB4KTsNCgl9Ow0KDQoJdGhpcy5jYWNoZVJlc3VsdCA9IGFzeW5jIGZ1bmN0aW9uKHJlcXVlc3QsIHRleHRyZXNwb25zZSkgew0KCQlpZiAoIXRoaXMuYkNhY2hlUmVzdWx0KSByZXR1cm47DQoJCXJlcXVlc3QgPSByZXF1ZXN0IHx8IHRoaXMuQWN0aXZlUmVxdWVzdDsNCg0KCQlpZiAoIXJlcXVlc3QpIHsNCgkJCXJldHVybjsNCgkJfQ0KDQoJCWlmICgNCgkJCXRleHRyZXNwb25zZSAmJg0KCQkJdGV4dHJlc3BvbnNlLmluZGV4T2YoJ3JldC5Db2RlID0gJykgPiAtMSAmJg0KCQkJdGV4dHJlc3BvbnNlLmluZGV4T2YoJ3JldC5SdW5BZnRlciA9ICcpID4gLTEgJiYNCgkJCXRleHRyZXNwb25zZS5pbmRleE9mKCdyZXQuUmVzdWx0ID0gIiInKSA+IC0xDQoJCSkgew0KCQkJY29uc29sZS5sb2coJ3RleHRyZXNwb25zZSBjb250aWFucyBpbmNvbXBsZXRlIG1ldGhvZCByZXN1bHQnKTsNCgkJCXJldHVybiBudWxsOw0KCQl9DQoNCgkJdmFyIHNNZXRob2QgPSB0aGlzLiRfUkVRVUVTVCgnbmFtZScsIHJlcXVlc3QuVVJMKTsNCgkJc01ldGhvZCA9IHNNZXRob2Quc3Vic3RyaW5nKHNNZXRob2QubGFzdEluZGV4T2YoJy4nKSArIDEpOw0KCQl0cnkgew0KCQkJdmFyIF91c2FibGUgPSAocikgPT4gew0KCQkJCXZhciBpdGVtID0NCgkJCQkJKHIgJiYNCgkJCQkJCXIuaGFzaCA9PSByZXF1ZXN0Lmhhc2ggJiYNCgkJCQkJCShyLlVSTCA9PSByZXF1ZXN0LlVSTCB8fCB0aGlzLiRfUkVRVUVTVCgnbmFtZScsIHIuVVJMKSA9PSBzTWV0aG9kKSAmJg0KCQkJCQkJci5UZXh0UmVzcG9uc2UgJiYNCgkJCQkJCSh0eXBlb2Ygci5FeHBpcmVzID09PSAndW5kZWZpbmVkJyB8fA0KCQkJCQkJCW5ldyBEYXRlKHIuRXhwaXJlcykgPiBuZXcgRGF0ZSgpKSkgPw0KCQkJCQlyIDoNCgkJCQkJbnVsbDsNCgkJCQlpZiAodGV4dHJlc3BvbnNlKSB7DQoJCQkJCWl0ZW0gPSBpdGVtIHx8IHJlcXVlc3Q7DQoJCQkJCWl0ZW0uVGV4dFJlc3BvbnNlID0gdGV4dHJlc3BvbnNlOw0KCQkJCQlpdGVtLkV4cGlyZXMgPSBuZXcgRGF0ZSgNCgkJCQkJCW5ldyBEYXRlKCkuZ2V0VGltZSgpICsNCgkJCQkJCXBhcnNlRmxvYXQoDQoJCQkJCQkJdGhpcy5uQ2FjaGVFeHBpcmVIb3VycyB8fCB0aGlzLiRfUkVRVUVTVCgnbkNhY2hlRXhwaXJlSG91cnMnKSB8fCAxDQoJCQkJCQkpICoNCgkJCQkJCTYwICoNCgkJCQkJCTYwICoNCgkJCQkJCTEwMDANCgkJCQkJKTsNCgkJCQl9DQoNCgkJCQlyZXR1cm4gaXRlbTsNCgkJCX07DQoNCgkJCWlmICgNCgkJCQl0aGlzLmJDYWNoZVJlc3VsdCA9PSAna3ZzdG9yZScgJiYNCgkJCQl0eXBlb2Ygd2luZG93LmNvbXBhbnkucmVzdGlvZGJTZXR0aW5ncyAhPT0gJ3VuZGVmaW5lZCcNCgkJCSkgew0KCQkJCXZhciBhamF4ID0gKGtleSwgdmFsdWUsIGlkKSA9PiB7DQoJCQkJCXZhciByZXQgPSBjb21wYW55LnJlc3Rpb2RiU2V0dGluZ3MoKTsNCgkJCQkJcmV0LnVybCArPSAna3ZzdG9yZSc7DQoJCQkJCWlmICh2YWx1ZSkgew0KCQkJCQkJaWYgKGlkKSB7DQoJCQkJCQkJLy8gdXBkYXRlIHJlY29yZA0KCQkJCQkJCXJldC51cmwgKz0gJy8nICsgaWQ7DQoJCQkJCQkJcmV0Lm1ldGhvZCA9ICdQVVQnOw0KCQkJCQkJfSBlbHNlIHsNCgkJCQkJCQkvLyBuZXcgcmVjb3JkDQoJCQkJCQkJcmV0Lm1ldGhvZCA9ICdQT1NUJzsNCgkJCQkJCX0NCgkJCQkJCXJldC5kYXRhID0gSlNPTi5zdHJpbmdpZnkoew0KCQkJCQkJCWtleToga2V5LA0KCQkJCQkJCXZhbHVlOiBKU09OLnN0cmluZ2lmeSh2YWx1ZSwgbnVsbCwgNCksDQoJCQkJCQl9KTsNCgkJCQkJfSBlbHNlIHsNCgkJCQkJCWlmIChpZCkgew0KCQkJCQkJCS8vIGRlbGV0ZSByZWNvcmQNCgkJCQkJCQlyZXQudXJsICs9ICcvJyArIGlkOw0KCQkJCQkJCXJldC5tZXRob2QgPSAnREVMRVRFJzsNCgkJCQkJCX0gZWxzZSB7DQoJCQkJCQkJcmV0Lm1ldGhvZCA9ICdHRVQnOw0KCQkJCQkJCXJldC51cmwgKz0gJz9xPXsia2V5IjonICsga2V5ICsgJ30nOw0KCQkJCQkJfQ0KCQkJCQl9DQoJCQkJCS8vY29uc29sZS5sb2coJ21ldGhvZCcsIHJldC5tZXRob2QpOw0KCQkJCQlyZXR1cm4gcmV0Ow0KCQkJCX07DQoNCgkJCQlsZXQgcmVjb3JkID0gYXdhaXQgJC5hamF4KGFqYXgocmVxdWVzdC5oYXNoKSk7DQoJCQkJbGV0IHIgPQ0KCQkJCQlyZWNvcmQgJiYgcmVjb3JkLmxlbmd0aCA/DQoJCQkJCUpTT04ucGFyc2UocmVjb3JkWzBdLnZhbHVlKSA6DQoJCQkJCW51bGw7DQoJCQkJbGV0IGl0ZW0gPSBfdXNhYmxlKHIpOw0KDQoJCQkJaWYgKCFpdGVtKSB7DQoJCQkJCWlmIChyKSB7DQoJCQkJCQlhd2FpdCAkLmFqYXgoYWpheChyZXF1ZXN0Lmhhc2gsIG51bGwsIHJlY29yZFswXS5faWQpKTsNCgkJCQkJfQ0KCQkJCQlyZXR1cm4gbnVsbDsNCgkJCQl9DQoNCgkJCQlpZiAoIXIgfHwgaXRlbS5FeHBpcmVzID4gci5FeHBpcmVzKSB7DQoJCQkJCWF3YWl0ICQuYWpheCgNCgkJCQkJCWFqYXgoaXRlbS5oYXNoLCBpdGVtLCByID8gcmVjb3JkWzBdLl9pZCA6IG51bGwpDQoJCQkJCSk7DQoJCQkJCXJldHVybiBpdGVtOw0KCQkJCX0NCg0KCQkJCXJldHVybiBpdGVtOw0KCQkJfSBlbHNlIGlmICh0aGlzLmJDYWNoZVJlc3VsdCA9PSAnc3InKSB7DQoJCQkJdmFyIGFqYXggPSAoa2V5LCB2YWx1ZSwgaWQpID0+IHsNCgkJCQkJdmFyIG1ldGhvZCA9ICdGaW5kJzsNCgkJCQkJdmFyIHJldCA9IHsNCgkJCQkJCXVybDogJy9tZXRob2QvYS5hc2h4P25hbWU9Q29udGVudE1hbmFnZXIuY21zTWV0aG9kUmVzdWx0JywNCgkJCQkJCXByb2Nlc3NEYXRhOiBmYWxzZSwNCgkJCQkJCXR5cGU6ICdQT1NUJywNCgkJCQkJfTsNCgkJCQkJaWYgKHZhbHVlKSB7DQoJCQkJCQlpZiAoaWQpIHsNCgkJCQkJCQkvLyB1cGRhdGUgcmVjb3JkDQoJCQkJCQkJbWV0aG9kID0gJ1VwZGF0ZSc7DQoJCQkJCQl9IGVsc2Ugew0KCQkJCQkJCS8vIG5ldyByZWNvcmQNCgkJCQkJCQltZXRob2QgPSAnSW5zZXJ0JzsNCgkJCQkJCX0NCgkJCQkJCXJldC5iZWZvcmVTZW5kID0gKHJlcXVlc3QpID0+IHsNCgkJCQkJCQlyZXF1ZXN0LnNldFJlcXVlc3RIZWFkZXIoDQoJCQkJCQkJCSdDb250ZW50LVR5cGUnLA0KCQkJCQkJCQknbXVsdGlwYXJ0L2Zvcm0tZGF0YTsgYm91bmRhcnk9LS0tLS0tLS0tLS0tLS0nDQoJCQkJCQkJKTsNCgkJCQkJCX07DQoJCQkJCX0gZWxzZSB7DQoJCQkJCQlyZXQudHlwZSA9ICdHRVQnOw0KCQkJCQkJaWYgKGlkKSB7DQoJCQkJCQkJLy8gZGVsZXRlIHJlY29yZA0KCQkJCQkJCW1ldGhvZCA9ICdEZWxldGUnOw0KCQkJCQkJfSBlbHNlIHsNCgkJCQkJCQkvLyBnZXQgcmVjb3JkDQoJCQkJCQkJbWV0aG9kID0gJ0ZpbmQnOw0KCQkJCQkJfQ0KCQkJCQkJbWV0aG9kICs9DQoJCQkJCQkJJyZwMD17Q29kZX0nICsNCgkJCQkJCQkoY29tcGFueSA/IGNvbXBhbnkuQ29kZSArICctJyA6ICcnKSArDQoJCQkJCQkJa2V5ICsNCgkJCQkJCQkney9Db2RlfSc7DQoJCQkJCX0NCgkJCQkJcmV0LnVybCArPSBtZXRob2Q7DQoJCQkJCWlmIChyZXQudHlwZSAhPSAnR0VUJykgew0KCQkJCQkJZGVsZXRlIGl0ZW0uUG9zdERhdGE7IC8vIGJlY2F1c2Ugd2UgaGF2ZSB0aGUgY2FjaGUga2V5DQoJCQkJCQl2YXIgcDAgPSB7DQoJCQkJCQkJQ29kZTogKGNvbXBhbnkgPyBjb21wYW55LkNvZGUgKyAnLScgOiAnJykgKyBrZXksDQoJCQkJCQkJQ29tcGxldGVkOiBuZXcgRGF0ZSgpLA0KCQkJCQkJCURhdGU6IHRoaXMuQWN0aXZlUmVxdWVzdCA/DQoJCQkJCQkJCXRoaXMuQWN0aXZlUmVxdWVzdC5EYXRlIDogbmV3IERhdGUoKSwNCgkJCQkJCQlSZXN1bHQ6IGJ0b2EodW5lc2NhcGUoZW5jb2RlVVJJQ29tcG9uZW50KEpTT04uc3RyaW5naWZ5KGl0ZW0pKSkpLCAvL2l0ZW0uVGV4dFJlc3BvbnNlLA0KCQkJCQkJCVN0b3JlZE1ldGhvZDogew0KCQkJCQkJCQlOYW1lOiBzTWV0aG9kLA0KCQkJCQkJCX0sDQoJCQkJCQl9Ow0KCQkJCQkJaWYgKGlkKSB7DQoJCQkJCQkJcDAuSWQgPSBpZDsNCgkJCQkJCX0NCgkJCQkJCXJldC5kYXRhID0NCgkJCQkJCQknUE9TVERBVEE9XHJcbicgLyorICI8P3htbCB2ZXJzaW9uPVwiMS4wXCIgZW5jb2Rpbmc9XCJ1dGYtOFwiIHN0YW5kYWxvbmU9XCJ5ZXNcIj8+XHJcbiIqLyArDQoJCQkJCQkJdGhpcy5wYXJhbShbcDBdKTsNCgkJCQkJfQ0KCQkJCQlyZXR1cm4gcmV0Ow0KCQkJCX07DQoNCgkJCQlsZXQgcmVjb3JkID0gdGhpcy5ydW5TY3JpcHQgLypydW5TUlNjcmlwdCovKA0KCQkJCQknKCgpID0+IHsgdmFyIHJldCA9IG51bGw7ICcgKw0KCQkJCQkoYXdhaXQgJC5hamF4KGFqYXgocmVxdWVzdC5oYXNoKSkpICsNCgkJCQkJJ3JldHVybiByZXQ7fSkoKTsnDQoJCQkJKTsNCgkJCQlsZXQgciA9IHJlY29yZCA/IEpTT04ucGFyc2UocmVjb3JkLlJlc3VsdCkgOiBudWxsOw0KCQkJCWxldCBpdGVtID0gX3VzYWJsZShyKTsNCg0KCQkJCWlmICghaXRlbSkgew0KCQkJCQlpZiAocikgew0KCQkJCQkJdHJ5IHsNCgkJCQkJCQlhd2FpdCAkLmFqYXgoYWpheChyZXF1ZXN0Lmhhc2gsIG51bGwsIHJlY29yZC5JZCkpOw0KCQkJCQkJfSBjYXRjaCAoZXgpIHt9DQoJCQkJCX0NCgkJCQkJcmV0dXJuIG51bGw7DQoJCQkJfQ0KDQoJCQkJaWYgKCFyIHx8IGl0ZW0uRXhwaXJlcyA+IHIuRXhwaXJlcykgew0KCQkJCQlhd2FpdCAkLmFqYXgoDQoJCQkJCQlhamF4KGl0ZW0uaGFzaCwgaXRlbSwgciAmJiByZWNvcmQgPyByZWNvcmQuSWQgOiBudWxsKQ0KCQkJCQkpOw0KCQkJCQlyZXR1cm4gaXRlbTsNCgkJCQl9DQoNCgkJCQlyZXR1cm4gaXRlbTsNCgkJCX0gZWxzZSBpZiAodGhpcy5iQ2FjaGVSZXN1bHQgPT0gJ2dpdGh1YicpIHsNCgkJCQlpZiAocmVxdWVzdC5VUkwuaW5kZXhPZignY21zTWV0aG9kUmVzdWx0JykgPj0gMCkgcmV0dXJuIG51bGw7DQoJCQkJbGV0IHJlcyA9IG51bGw7DQoJCQkJdHJ5IHsNCgkJCQkJcmVzID0gYXdhaXQgJC5hamF4KHsNCgkJCQkJCXVybDogJ2h0dHBzOi8vYXJ6aG9zcGl0YWwuZ2l0aHViLmlvLycgKw0KCQkJCQkJCWNvbXBhbnkuU3RvcmUgKw0KCQkJCQkJCScvJyArDQoJCQkJCQkJcmVxdWVzdC5oYXNoICsNCgkJCQkJCQknLmpzJywNCgkJCQkJCWRhdGFUeXBlOiAnanNvbnAnLA0KCQkJCQkJcHJvY2Vzc1Jlc3VsdDogZmFsc2UsDQoJCQkJCX0pOw0KCQkJCQlyZXR1cm4gew0KCQkJCQkJVGV4dFJlc3BvbnNlOiByZXMsDQoJCQkJCX07DQoJCQkJfSBjYXRjaCAoZXgpIHsNCgkJCQkJY29uc29sZS5sb2coJ0VSUk9SUzonLCBleCk7DQoJCQkJCXJldHVybiBudWxsOw0KCQkJCX0NCgkJCX0gZWxzZSBpZiAodGhpcy5iQ2FjaGVSZXN1bHQgPT0gJ2xvY2FsJykgew0KCQkJCXZhciBzckNhY2hlID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3NyQ2FjaGUnKTsNCgkJCQlpZiAoc3JDYWNoZSA9PSBudWxsKSB7DQoJCQkJCXNyQ2FjaGUgPSB7DQoJCQkJCQlSZXF1ZXN0czoge30sDQoJCQkJCX07DQoJCQkJfSBlbHNlIHsNCgkJCQkJc3JDYWNoZSA9IEpTT04ucGFyc2Uoc3JDYWNoZSk7DQoJCQkJfQ0KDQoJCQkJdmFyIHIgPSBzckNhY2hlLlJlcXVlc3RzW3JlcXVlc3QuaGFzaF07DQoJCQkJdmFyIGl0ZW0gPSBfdXNhYmxlKHIpOw0KDQoJCQkJaWYgKCFpdGVtKSB7DQoJCQkJCWRlbGV0ZSBzckNhY2hlLlJlcXVlc3RzW3JlcXVlc3QuaGFzaF07DQoJCQkJCWxvY2FsU3RvcmFnZS5zZXRJdGVtKCdzckNhY2hlJywgSlNPTi5zdHJpbmdpZnkoc3JDYWNoZSkpOw0KCQkJCQlyZXR1cm4gbnVsbDsNCgkJCQl9DQoNCgkJCQlpZiAoIXIgfHwgaXRlbS5FeHBpcmVzID4gci5FeHBpcmVzKSB7DQoJCQkJCXNyQ2FjaGUuUmVxdWVzdHNbaXRlbS5oYXNoXSA9IGl0ZW07DQoJCQkJCWxvY2FsU3RvcmFnZS5zZXRJdGVtKCdzckNhY2hlJywgSlNPTi5zdHJpbmdpZnkoc3JDYWNoZSkpOw0KCQkJCQlyZXR1cm4gaXRlbTsNCgkJCQl9DQoNCgkJCQlyZXR1cm4gaXRlbTsNCgkJCX0NCgkJfSBjYXRjaCAoZXgpIHsNCgkJCWNvbnNvbGUubG9nKGV4KTsNCgkJCXRocm93IGV4Ow0KCQl9DQoJfTsNCg0KCXRoaXMuXyA9IGFzeW5jIGZ1bmN0aW9uKGZ1biwgY2FsbEJhY2spIHsNCgkJaWYgKHRoaXMuc19FcnJvck1lc3NhZ2VzICYmIHRoaXMuc19FcnJvck1lc3NhZ2VzLmxlbmd0aCA+IDApIHsNCgkJCWFsZXJ0KA0KCQkJCSdUaGUgZm9sbG93aW5nIGVycm9ycyB3ZXJlIGZvdW5kIGluIHlvdXIgZGF0YTpcbicgKw0KCQkJCXRoaXMuc19FcnJvck1lc3NhZ2VzDQoJCQkpOw0KCQkJdGhpcy5zX0Vycm9yTWVzc2FnZXMgPSAnJzsNCgkJCXJldHVybiBudWxsOw0KCQl9DQoNCgkJdGhpcy5idWlsZFVSTCgpOw0KDQoJCWlmICh0eXBlb2YoZG9jdW1lbnQpICE9PSAidW5kZWZpbmVkIikoDQoJCQl0aGlzLmZMb2FkaW5nU3RhcnQgfHwNCgkJCWZ1bmN0aW9uKCkgew0KCQkJCWlmIChkb2N1bWVudC5ib2R5KSBkb2N1bWVudC5ib2R5LnN0eWxlLmN1cnNvciA9ICd3YWl0JzsNCgkJCX0NCgkJKSgpOw0KDQoJCXZhciBhcmdzID0gQXJyYXkoKTsNCgkJZm9yICh2YXIgaSA9IDI7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsNCgkJCWFyZ3NbaSAtIDJdID0gYXJndW1lbnRzW2ldOw0KCQl9DQoNCgkJaWYgKHRoaXMuJF9SRVFVRVNUKCdub1NSJykpIHsNCgkJCWxldCBmUGFydHMgPSBmdW4uc3BsaXQoJy4nKTsNCgkJCWxldCBsaWIgPSBmUGFydHMubGVuZ3RoID4gMSA/IGZQYXJ0c1swXSA6ICdDb250ZW50TWFuYWdlcic7DQoJCQlsZXQgZiA9IGZQYXJ0cy5sZW5ndGggPiAxID8gZlBhcnRzWzFdIDogZnVuOw0KDQoJCQlmUGFydHMgPSBmLnJlcGxhY2UoLyhbYS16MC05XSkoW0EtWl0pL2csICckMS4kMicpLnNwbGl0KCcuJyk7DQoNCgkJCWxldCBlYyA9IGZQYXJ0cy5zbGljZSgxLCAtMSkuam9pbignJyk7DQoJCQlsZXQgZm5hbWUgPSBmUGFydHMuc2xpY2UoLTEpWzBdOw0KCQkJbGV0IHNjb3BlID0gbGliLnRvTG93ZXJDYXNlKCk7DQoNCgkJCWNvbnNvbGUubG9nKCJjYWxsaW5nLi4uIG5ldyBbIiArIGxpYiArICddICcgKyBmUGFydHNbMF0gKyAnLicgKyBlYyArICIoKS4iICsgZm5hbWUgKyAiKCkuLi4gIiAvKiArIEpTT04uc3RyaW5naWZ5KGFyZ3MsIG51bGwsIDQpKi8gKTsNCg0KCQkJbGV0IG9TY29wZSA9IHRoaXMuX19zY29wZShzY29wZSk7DQoJCQlpZiAoIW9TY29wZSB8fCAhb1Njb3BlW2VjXSkgew0KCQkJCWlmIChmbmFtZSA9PSAnRmluZCcpIHsNCgkJCQkJbGV0IG93bmVyID0gdGhpcy4kX1JFUVVFU1QoJ293bmVyJykgfHwgJ2Fyemhvc3BpdGFsJzsNCgkJCQkJbGV0IHVybCA9IGBodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vJHtvd25lcn0vJHtvd25lcn0uZ2l0aHViLmlvL21hc3Rlci9jb20vbmFtbW91ci8ke2ZQYXJ0c1swXX0vJHtlY30vJHthcmdzWzBdW09iamVjdC5rZXlzKGFyZ3NbMF0pWzBdXX0uanNvbmA7DQoJCQkJCWNvbnNvbGUubG9nKCJfKCk6IGZldGNoaW5nICIgKyB1cmwpOw0KCQkJCQlsZXQgcmV0ID0gYXdhaXQgZmV0Y2godXJsKTsNCgkJCQkJaWYgKCFyZXQub2spIHJldHVybiBudWxsOw0KCQkJCQlsZXQgX29iaiA9IEpTT04ucGFyc2UoYXdhaXQgcmV0LnRleHQoKSk7DQoJCQkJCXJldHVybiBfb2JqLnJlbWFyayA/IGF0b2IoX29iai5yZW1hcmspIDogX29iajsNCgkJCQl9DQoJCQkJcmV0dXJuIGZuYW1lLmVuZHNXaXRoKCdhbGwnKSA/IFtdIDogbnVsbDsNCgkJCX0NCgkJCWNvbnNvbGUubG9nKHNjb3BlICsgIi4uLiBjYWxsaW5nLi4uIiwgb1Njb3BlKTsNCg0KCQkJcmV0dXJuIGF3YWl0IG5ldyhvU2NvcGVbZWNdKSgpW2ZuYW1lXShhcmdzKTsNCgkJfQ0KDQoJCXZhciBwb3N0RGF0YSA9IHRoaXMucGFyYW0oYXJncyk7DQoJCWlmIChmdW4uaW5kZXhPZignLicpIDwgMCkgew0KCQkJZnVuID0gdGhpcy5zeXN0ZW1OYW1lICsgJy4nICsgZnVuOw0KCQl9IGVsc2UgaWYgKGZ1bi5pbmRleE9mKCcuJykgPT0gMCkgew0KCQkJLy8gYSBub24tbGF5ZXIgbWV0aG9kDQoJCQlmdW4gPSBmdW4uc3Vic3RyaW5nKDEpOw0KCQl9DQoNCgkJaWYgKGNhbGxCYWNrICYmIHRoaXMuQWN0aXZlUmVxdWVzdCkgew0KCQkJdGhpcy5BY3RpdmVSZXF1ZXN0ID0gbnVsbDsNCgkJCS8vcmV0dXJuIGZhbHNlOw0KCQl9DQoNCgkJdmFyIGhDb2RlID0gdGhpcy5oYXNoQ29kZSgNCgkJCWZ1bi5zdWJzdHJpbmcoZnVuLmluZGV4T2YoJy4nKSArIDEpICsgcG9zdERhdGENCgkJKTsNCg0KCQl0aGlzLkNSTkwgPSB0aGlzLkNSTkwgfHwgIlxuIjsNCgkJcG9zdERhdGEgKz0NCgkJCXRoaXMuQ1JOTCArDQoJCQl0aGlzLkNSTkwgKw0KCQkJJzwhLS08cGlkPicgKw0KCQkJaENvZGUgKw0KCQkJJzwvcGlkPi0tPicgKw0KCQkJdGhpcy5DUk5MOw0KDQoJCWlmIChmdW4uaW5kZXhPZignY21zTWV0aG9kUmVzdWx0RmluZCcpIDwgMCkgew0KCQkJLy8gYXZvaWQgb3ZlcndyaXRlIG9mIGFzeW5jIGNhbGxzDQoJCQl0aGlzLkFjdGl2ZVJlcXVlc3QgPSB7DQoJCQkJVVJMOiB0aGlzLnNyVVJMICsgJyZuYW1lPScgKyBmdW4sDQoJCQkJUG9zdERhdGE6IHBvc3REYXRhLA0KCQkJCURhdGU6IG5ldyBEYXRlKCksDQoJCQkJQ2FsbEJhY2s6IGNhbGxCYWNrLA0KCQkJCUNvbXBhbnk6IHR5cGVvZiBjb21wYW55ICE9PSAndW5kZWZpbmVkJyAmJiBjb21wYW55ID8gew0KCQkJCQlDb2RlOiBjb21wYW55LkNvZGUsDQoJCQkJfSA6IG51bGwsDQoJCQkJVGV4dFJlc3BvbnNlOiBudWxsLA0KCQkJCWhhc2g6IGhDb2RlLA0KCQkJfTsNCgkJfQ0KDQoJCWlmICh0eXBlb2Yod2luZG93KSAhPT0gInVuZGVmaW5lZCIgJiYgIXRoaXMuYkxvY2FsKSB7DQoJCQkvLyBsaXZlDQoJCQl0cnkgew0KCQkJCXZhciBfdGhlVXJsID0NCgkJCQkJKHRoaXMuU3RvcmUgfHwNCgkJCQkJCScvc3RvcmUvJyArDQoJCQkJCQkod2luZG93LmNvbXBhbnkgJiYgd2luZG93LmNvbXBhbnkuQ29kZSA/DQoJCQkJCQkJd2luZG93LmNvbXBhbnkuQ29kZSArICcvJyA6DQoJCQkJCQkJJy8nKSkgKw0KCQkJCQloQ29kZSArDQoJCQkJCScuanM/cmFuZD0nICsNCgkJCQkJTWF0aC5yYW5kb20oKTsNCgkJCQlsZXQgcmVxdWVzdCA9IGF3YWl0IHRoaXMuY2FjaGVSZXN1bHQoKTsNCgkJCQl2YXIgcmVzcG9uc2VUZXh0ID0gbnVsbDsNCgkJCQlpZiAoIXJlcXVlc3QpIHsNCgkJCQkJdHJ5IHsNCgkJCQkJCXJlc3BvbnNlVGV4dCA9IGF3YWl0ICQuZ2V0KF90aGVVcmwpOw0KCQkJCQl9IGNhdGNoIChleCkge30NCgkJCQl9IGVsc2Ugew0KCQkJCQlyZXNwb25zZVRleHQgPSByZXF1ZXN0LlRleHRSZXNwb25zZTsNCgkJCQl9DQoJCQkJaWYgKCFyZXNwb25zZVRleHQpIHsNCgkJCQkJY29uc29sZS5sb2coDQoJCQkJCQknTGl2ZSBNb2RlLCBubyByZXNwb25zZSB0ZXh0IGZvciAnICsNCgkJCQkJCXRoaXMuQWN0aXZlUmVxdWVzdC5oYXNoICsNCgkJCQkJCScgLSAnICsNCgkJCQkJCXRoaXMuJF9SRVFVRVNUKCduYW1lJywgdGhpcy5BY3RpdmVSZXF1ZXN0LlVSTCkNCgkJCQkJKTsNCgkJCQkJcmV0dXJuIG51bGw7DQoJCQkJfQ0KDQoJCQkJdmFyIF9yZXQgPSBudWxsOw0KCQkJCXZhciBfZXhjZXB0aW9uID0gbnVsbDsNCgkJCQl0cnkgew0KCQkJCQlfcmV0ID0gdGhpcy5ydW5TUlNjcmlwdChyZXNwb25zZVRleHQpOw0KCQkJCQlfZXhjZXB0aW9uID0gX3JldC5fZXhjZXB0aW9uOw0KCQkJCQlpZiAoX3JldC5zZXJ2ZXJfdGltZSkgew0KCQkJCQkJbGV0IHRkID0gbmV3IERhdGUoKS5nZXRUaW1lKCkgLSBfcmV0LnNlcnZlcl90aW1lLmdldFRpbWUoKTsNCgkJCQkJCXRyeSB7DQoJCQkJCQkJd2luZG93LnRpbWVEaWZmZXJlbmNlID0gdGQ7DQoJCQkJCQl9IGNhdGNoIChleCkgew0KCQkJCQkJCWdsb2JhbC50aW1lRGlmZmVyZW5jZSA9IHRkOw0KCQkJCQkJfQ0KCQkJCQl9DQoJCQkJfSBjYXRjaCAoZSkgew0KCQkJCQlfZXhjZXB0aW9uID0gZTsNCgkJCQl9DQoNCgkJCQlpZiAoIV9yZXQgJiYgIV9leGNlcHRpb24pIHsNCgkJCQkJcmV0dXJuIGF3YWl0IG51bGw7IC8vdGhpcy5kb0hlYWRsZXNzQ2FsbChjYWxsQmFjayk7DQoJCQkJfSBlbHNlIHsNCgkJCQkJLy90aGlzLkFjdGl2ZVJlcXVlc3QgPSBudWxsOw0KCQkJCQlpZiAoY2FsbEJhY2sgIT0gbnVsbCkgew0KCQkJCQkJdHJ5IHsNCgkJCQkJCQljYWxsQmFjaygNCgkJCQkJCQkJX3JldC5yZXQgfHwgKF9leGNlcHRpb24gPyByZXNwb25zZVRleHQgOiBudWxsKSwNCgkJCQkJCQkJX2V4Y2VwdGlvbg0KCQkJCQkJCSk7DQoJCQkJCQl9IGNhdGNoIChlKSB7DQoJCQkJCQkJdGhpcy5TaG93RXJyb3IoDQoJCQkJCQkJCSdFcnJvciBpbiBDYWxsYmFjazpcblxuJyArDQoJCQkJCQkJCWNhbGxCYWNrICsNCgkJCQkJCQkJJ1xuXG4nICsNCgkJCQkJCQkJZS5tZXNzYWdlDQoJCQkJCQkJKTsNCgkJCQkJCX0NCgkJCQkJfQ0KCQkJCQkoDQoJCQkJCQl3aW5kb3cuc3IuZkxvYWRpbmdFbmQgfHwNCgkJCQkJCSgoKSA9PiB7DQoJCQkJCQkJdGhpcy5yZXNldEN1cnNvcigpOw0KCQkJCQkJfSkNCgkJCQkJKSgpOw0KCQkJCQlyZXR1cm4gKA0KCQkJCQkJKF9yZXQgPyBfcmV0LnJldCA6IG51bGwpIHx8DQoJCQkJCQkoX2V4Y2VwdGlvbiA/IHJlc3BvbnNlVGV4dCA6IG51bGwpDQoJCQkJCSk7DQoJCQkJfQ0KCQkJfSBjYXRjaCAoZSkgew0KCQkJCWNvbnNvbGUubG9nKGUpOw0KCQkJCXJldHVybiBmYWxzZTsNCgkJCX0NCgkJfSBlbHNlIHsNCgkJCXJldHVybiAoYXN5bmMgKCkgPT4gew0KCQkJCXJldHVybiBhd2FpdCB0aGlzLnNlbmRYTUwoDQoJCQkJCXRoaXMuc3JVUkwgKyAnJm5hbWU9JyArIGZ1biwNCgkJCQkJcG9zdERhdGEsDQoJCQkJCWNhbGxCYWNrDQoJCQkJKTsNCgkJCX0pKCk7DQoJCX0NCgl9Ow0KDQoJdGhpcy5wcm9taXNlID0gZnVuY3Rpb24oZGF0YSwgY2FsbEJhY2spIHsNCgkJaWYgKCFjYWxsQmFjayB8fCB7fS50b1N0cmluZy5jYWxsKGNhbGxCYWNrKSAhPT0gJ1tvYmplY3QgRnVuY3Rpb25dJykgew0KCQkJcmV0dXJuIGRhdGE7DQoJCX0NCg0KCQl2YXIgcCA9ICQuRGVmZXJyZWQoKTsNCg0KCQlzZXRUaW1lb3V0KGFzeW5jICgpID0+IHsNCgkJCXRyeSB7DQoJCQkJbGV0IGQgPSBhd2FpdCBjYWxsQmFjayhkYXRhKTsNCgkJCQlwLnJlc29sdmUoZCk7DQoJCQl9IGNhdGNoIChleCkgew0KCQkJCXRyeSB7DQoJCQkJCXAucmVzb2x2ZShjYWxsQmFjayhkYXRhKSk7DQoJCQkJfSBjYXRjaCAoX2V4KSB7DQoJCQkJCWNvbnNvbGUubG9nKCdwcm9taXNlIGV4Y2VwdGlvbicsIF9leCk7DQoJCQkJfQ0KCQkJfQ0KCQl9LCA1MDApOw0KDQoJCXJldHVybiBwID8gcC5wcm9taXNlKCkgOiBkYXRhOw0KCX07DQoNCgl0aGlzLnNlbmRYTUwgPSBhc3luYyBmdW5jdGlvbih1cmwsIHBvc3REYXRhLCBjYWxsQmFjaykgew0KCQlpZiAodHlwZW9mKHdpbmRvdykgIT09ICJ1bmRlZmluZWQiICYmICF3aW5kb3cuU1IpIHdpbmRvdy5TUiA9IHRoaXM7DQoNCgkJaWYgKCh0eXBlb2Yod2luZG93KSAhPT0gInVuZGVmaW5lZCIgJiYgd2luZG93LmpRdWVyeSkgfHwgKHR5cGVvZih3aW5kb3cpID09PSAidW5kZWZpbmVkIiAmJiB0eXBlb2YoYXhpb3MpICE9PSAidW5kZWZpbmVkIikpIHsNCgkJCWxldCByZXF1ZXN0ID0gYXdhaXQgdGhpcy5jYWNoZVJlc3VsdChudWxsLCBudWxsLCBjYWxsQmFjayk7DQoJCQlpZiAocmVxdWVzdCkgew0KCQkJCWxldCByZXN1bHQgPSBhd2FpdCB0aGlzLnByb2Nlc3NSZXNwb25zZSgNCgkJCQkJNDQsDQoJCQkJCWNhbGxCYWNrLA0KCQkJCQlyZXF1ZXN0LlRleHRSZXNwb25zZSwNCgkJCQkJdXJsDQoJCQkJKTsNCgkJCQlyZXR1cm4gYXdhaXQgdGhpcy5wcm9jZXNzUmVzdWx0KHJlc3VsdCk7DQoJCQl9IGVsc2Ugew0KCQkJCS8vIGpxdWVyeSBjYWxsDQoJCQkJdmFyIGFqYXggPSB7fTsNCgkJCQlpZiAodGhpcy5iUG9zdCB8fCBwb3N0RGF0YS5sZW5ndGggPiAodGhpcy5uTWF4VVJMTGVuZ3RoIHx8IDEwMCkpIHsNCgkJCQkJYWpheC51cmwgPSB1cmw7DQoJCQkJCWFqYXgudHlwZSA9ICdQT1NUJzsNCgkJCQkJYWpheC5iZWZvcmVTZW5kID0gKHJlcXVlc3QpID0+IHsNCgkJCQkJCXJlcXVlc3Quc2V0UmVxdWVzdEhlYWRlcigNCgkJCQkJCQknQ29udGVudC1UeXBlJywNCgkJCQkJCQknbXVsdGlwYXJ0L2Zvcm0tZGF0YTsgYm91bmRhcnk9LS0tLS0tLS0tLS0tLS0nDQoJCQkJCQkpOw0KCQkJCQl9Ow0KCQkJCQlhamF4LmRhdGEgPQ0KCQkJCQkJJ1BPU1REQVRBPVxyXG4nIC8qKyAiPD94bWwgdmVyc2lvbj1cIjEuMFwiIGVuY29kaW5nPVwidXRmLThcIiBzdGFuZGFsb25lPVwieWVzXCI/PlxyXG4iKi8gKw0KCQkJCQkJcG9zdERhdGE7DQoJCQkJfSBlbHNlIHsNCgkJCQkJYWpheC51cmwgPSB1cmwgKyAnJlBPU1RDT0RFPScgKyB0aGlzLnRvSGV4KHBvc3REYXRhKTsNCgkJCQkJYWpheC50eXBlID0gJ0dFVCc7DQoJCQkJfQ0KDQoJCQkJbGV0IHJldCA9IG51bGw7DQoJCQkJaWYgKHR5cGVvZihqUXVlcnkpICE9PSAidW5kZWZpbmVkIikgew0KCQkJCQlyZXQgPSBhd2FpdCAkLmFqYXgoYWpheCk7DQoJCQkJfSBlbHNlIGlmICh0eXBlb2YoYXhpb3MpICE9PSAidW5kZWZpbmVkIikgew0KCQkJCQlyZXQgPSBhd2FpdCBheGlvcyhhamF4KTsNCgkJCQkJcmV0ID0gcmV0LmRhdGE7DQoJCQkJfQ0KCQkJCXJldCA9IGF3YWl0IHRoaXMucHJvY2Vzc1Jlc3VsdCgNCgkJCQkJdGhpcy5wcm9jZXNzUmVzcG9uc2UoNCwgY2FsbEJhY2ssIHJldCwgdXJsKQ0KCQkJCSk7DQoJCQkJcmV0dXJuIHJldDsNCgkJCX0NCgkJfSBlbHNlIHsNCgkJCXZhciB4bWxIVFRQID0gdGhpcy5nZXRYbWxIVFRQKCk7DQoJCQlpZiAoIXhtbEhUVFApIHJldHVybiBmYWxzZTsNCgkJCWlmIChjYWxsQmFjayAhPSBudWxsKSB7DQoJCQkJd2luZG93LnhtbEhUVFAub25yZWFkeXN0YXRlY2hhbmdlID0gZnVuY3Rpb24oKSB7DQoJCQkJCWlmICh3aW5kb3cueG1sSFRUUC5yZWFkeVN0YXRlID09IDQpIHsNCgkJCQkJCWlmICgkLndoZW4pIHsNCgkJCQkJCQkkLndoZW4oDQoJCQkJCQkJCXdpbmRvdy5TUi5wcm9jZXNzUmVzcG9uc2UoDQoJCQkJCQkJCQl3aW5kb3cueG1sSFRUUC5yZWFkeVN0YXRlLA0KCQkJCQkJCQkJY2FsbEJhY2ssDQoJCQkJCQkJCQl3aW5kb3cueG1sSFRUUC5yZXNwb25zZVRleHQsDQoJCQkJCQkJCQl1cmwNCgkJCQkJCQkJKQ0KCQkJCQkJCSkudGhlbigocmVzdWx0KSA9PiB3aW5kb3cuU1IucHJvY2Vzc1Jlc3VsdChyZXN1bHQpKTsNCgkJCQkJCX0gZWxzZSB7DQoJCQkJCQkJd2luZG93LlNSLnByb2Nlc3NSZXN1bHQoDQoJCQkJCQkJCXdpbmRvdy5TUi5wcm9jZXNzUmVzcG9uc2UoDQoJCQkJCQkJCQl3aW5kb3cueG1sSFRUUC5yZWFkeVN0YXRlLA0KCQkJCQkJCQkJY2FsbEJhY2ssDQoJCQkJCQkJCQl3aW5kb3cueG1sSFRUUC5yZXNwb25zZVRleHQsDQoJCQkJCQkJCQl1cmwNCgkJCQkJCQkJKQ0KCQkJCQkJCSk7DQoJCQkJCQl9DQoJCQkJCX0NCgkJCQl9Ow0KCQkJfQ0KDQoJCQlpZiAodGhpcy5iUG9zdCB8fCBwb3N0RGF0YS5sZW5ndGggPiB0aGlzLm5NYXhVUkxMZW5ndGgpIHsNCgkJCQl3aW5kb3cueG1sSFRUUC5vcGVuKCdQT1NUJywgdXJsLCBjYWxsQmFjayAhPSBudWxsKTsNCgkJCQl3aW5kb3cueG1sSFRUUC5zZXRSZXF1ZXN0SGVhZGVyKA0KCQkJCQknQ29udGVudC1UeXBlJywNCgkJCQkJJ211bHRpcGFydC9mb3JtLWRhdGE7IGJvdW5kYXJ5PS0tLS0tLS0tLS0tLS0tJw0KCQkJCSk7IC8vIGZvb2wgY3Jvc3MtZG9tYWluIGNoZWNraW5nIGluIGNocm9tZQ0KCQkJCXdpbmRvdy54bWxIVFRQLnNlbmQoDQoJCQkJCSdQT1NUREFUQT1cclxuJyAvKisgIjw/eG1sIHZlcnNpb249XCIxLjBcIiBlbmNvZGluZz1cInV0Zi04XCIgc3RhbmRhbG9uZT1cInllc1wiPz5cclxuIiovICsNCgkJCQkJcG9zdERhdGENCgkJCQkpOw0KCQkJfSBlbHNlIHsNCgkJCQl4bWxIVFRQLm9wZW4oDQoJCQkJCSdHRVQnLA0KCQkJCQl1cmwgKyAnJlBPU1RDT0RFPScgKyB0aGlzLnRvSGV4KHBvc3REYXRhKSwNCgkJCQkJY2FsbEJhY2sgIT0gbnVsbA0KCQkJCSk7DQoJCQkJeG1sSFRUUC5zZW5kKG51bGwpOw0KCQkJfQ0KDQoJCQlpZiAoY2FsbEJhY2sgPT0gbnVsbCAmJiB4bWxIVFRQLnJlYWR5U3RhdGUgPT0gNCkgew0KCQkJCXZhciBfdXJsID0gdXJsICsgJyZQT1NUQ09ERT0nICsgdGhpcy50b0hleChwb3N0RGF0YSk7DQoJCQkJaWYgKCQud2hlbikgew0KCQkJCQlyZXR1cm4gJC53aGVuKA0KCQkJCQkJdGhpcy5wcm9jZXNzUmVzcG9uc2UoDQoJCQkJCQkJeG1sSFRUUC5yZWFkeVN0YXRlLA0KCQkJCQkJCWNhbGxCYWNrLA0KCQkJCQkJCXhtbEhUVFAucmVzcG9uc2VUZXh0LA0KCQkJCQkJCV91cmwNCgkJCQkJCSkNCgkJCQkJKS50aGVuKChyZXN1bHQpID0+IHsNCgkJCQkJCXJldHVybiB0aGlzLnByb2Nlc3NSZXN1bHQocmVzdWx0KTsNCgkJCQkJfSk7DQoJCQkJfSBlbHNlIHsNCgkJCQkJdGhpcy5wcm9jZXNzUmVzdWx0KA0KCQkJCQkJdGhpcy5wcm9jZXNzUmVzcG9uc2UoDQoJCQkJCQkJeG1sSFRUUC5yZWFkeVN0YXRlLA0KCQkJCQkJCWNhbGxCYWNrLA0KCQkJCQkJCXhtbEhUVFAucmVzcG9uc2VUZXh0LA0KCQkJCQkJCV91cmwNCgkJCQkJCSkNCgkJCQkJKTsNCgkJCQl9DQoJCQl9DQoJCX0NCgl9Ow0KDQoJdGhpcy5fdXJsID0gZnVuY3Rpb24oZnVuLCBmaWxlbmFtZSkgew0KCQl2YXIgYXJncyA9IEFycmF5KCk7DQoJCWZvciAodmFyIGkgPSAyOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7DQoJCQlhcmdzW2kgLSAyXSA9IGFyZ3VtZW50c1tpXTsNCgkJfQ0KCQl2YXIgcG9zdERhdGEgPSB0aGlzLnBhcmFtKGFyZ3MpOw0KDQoJCXZhciBfYXJncyA9ICcnOw0KCQlmb3IgKHZhciBpID0gMjsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgew0KCQkJX2FyZ3MgKz0gJyZwJyArIChpIC0gMikgKyAnPScgKyBhcmd1bWVudHNbaV07DQoJCX0NCg0KCQlpZiAoZnVuLmluZGV4T2YoJy4nKSA8IDApIHsNCgkJCWZ1biA9IHRoaXMuc3lzdGVtTmFtZSArICcuJyArIGZ1bjsNCgkJfQ0KDQoJCXJldHVybiAoDQoJCQl0aGlzLnNyVVJMICsNCgkJCScmbmFtZT0nICsNCgkJCWZ1biArDQoJCQknJnJhbmQ9JyArDQoJCQlNYXRoLnJhbmRvbSgpICsNCgkJCS8vKyBfYXJncw0KCQkJJyZQT1NUQ09ERT0nICsNCgkJCXRoaXMudG9IZXgocG9zdERhdGEpICsNCgkJCShmaWxlbmFtZSA/ICcmZmlsZW5hbWU9JyArIGZpbGVuYW1lIDogJycpDQoJCSk7DQoJfTsNCg0KCXRoaXMuX2pzb24gPSBmdW5jdGlvbihmdW4pIHsNCgkJdmFyIGFyZ3MgPSBBcnJheSgpOw0KCQlmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgew0KCQkJYXJnc1tpIC0gMV0gPSBhcmd1bWVudHNbaV07DQoJCX0NCgkJaWYgKGZ1bi5pbmRleE9mKCcuJykgPCAwKSB7DQoJCQlmdW4gPSB0aGlzLnN5c3RlbU5hbWUgKyAnLicgKyBmdW47DQoJCX0NCgkJcmV0dXJuICgNCgkJCXRoaXMuc3JVUkwgKw0KCQkJJyZuYW1lPScgKw0KCQkJZnVuICsNCgkJCScmcmFuZD0nICsNCgkJCU1hdGgucmFuZG9tKCkgKw0KCQkJJyZqc29uPWNsZWFuJlBPU1RDT0RFPScgKw0KCQkJdGhpcy50b0hleCh0aGlzLnBhcmFtKGFyZ3MpKQ0KCQkpOw0KCX07DQoNCgl0aGlzLm15UmVwbGFjZSA9IGZ1bmN0aW9uKHMsIGZjLCByYykgew0KCQlpZiAodHlwZW9mIHMgIT09ICdzdHJpbmcnKSByZXR1cm4gczsNCg0KCQl2YXIgcmV0ID0gJyc7DQoJCWZvciAodmFyIGkgPSAwOyBpIDwgcy5sZW5ndGg7IGkrKykgew0KCQkJdmFyIHJzID0gcy5jaGFyQXQoaSk7DQoJCQlmb3IgKHZhciBqID0gMDsgaiA8IGZjLmxlbmd0aDsgaisrKSB7DQoJCQkJaWYgKHMuY2hhckF0KGkpID09IGZjW2pdKSB7DQoJCQkJCXJzID0gcy5jaGFyQXQoaSkucmVwbGFjZShmY1tqXSwgcmNbal0pOw0KCQkJCX0NCgkJCX0NCgkJCXJldCArPSByczsNCgkJfQ0KCQlyZXR1cm4gcmV0Ow0KCX07DQoNCgl0aGlzLnJ1bkNvZGUgPSBmdW5jdGlvbihjc0NvZGUsIGpzQ29kZSwgcFhNTCwgY2FsbEJhY2spIHsNCgkJLy8gYXZvaWQgdXNpbmcgdGhpcyBwbGVhc2UNCgkJdmFyIHBvc3REYXRhID0gJ1N0b3JlZE1ldGhvZCBtID0gbmV3IFN0b3JlZE1ldGhvZCgpOycgKyB0aGlzLkNSTkw7DQoJCXBvc3REYXRhICs9DQoJCQknbS5Cb2R5Q29kZSA9ICInICsNCgkJCXRoaXMubXlSZXBsYWNlKGNzQ29kZSwgWyciJywgJ1xyJywgJ1xuJ10sIFsnXFwiJywgJ1xccicsICdcXG4nXSkgKw0KCQkJJyI7JyArDQoJCQl0aGlzLkNSTkw7DQoJCXBvc3REYXRhICs9DQoJCQknbS5SZXR1cm5Db2RlID0gIicgKw0KCQkJdGhpcy5teVJlcGxhY2UoanNDb2RlLCBbJyInLCAnXHInLCAnXG4nXSwgWydcXCInLCAnXFxyJywgJ1xcbiddKSArDQoJCQknIjsnICsNCgkJCXRoaXMuQ1JOTDsNCgkJcG9zdERhdGEgKz0gJ20uQWN0aXZlID0gdHJ1ZTsnICsgdGhpcy5DUk5MOw0KCQlwb3N0RGF0YSArPSAnbS5PYmplY3RSZXR1cm4gPSBmYWxzZTsnICsgdGhpcy5DUk5MOw0KCQlwb3N0RGF0YSArPSAnbS5TaWduYXR1cmUgPSAic3RyaW5nIG5hbWUiOycgKyB0aGlzLkNSTkw7DQoJCXBvc3REYXRhICs9ICdyZXR1cm4gbmV3IG9iamVjdFtde20sIEAiJyArIHBYTUwgKyAnIn07JyArIHRoaXMuQ1JOTDsNCg0KCQl0aGlzLnNlbmRYTUwodGhpcy5zclVSTCArICcmY29kZT10cnVlJywgcG9zdERhdGEsIGNhbGxCYWNrKTsNCgl9Ow0KDQoJdGhpcy5HZXQgPSBmdW5jdGlvbih1cmwsIGNhbGxCYWNrKSB7DQoJCWlmICghY2FsbEJhY2spIHsNCgkJCS8vIHN5bmNocm9ub3VzIG1vZGUNCgkJCWlmICghd2luZG93LmpRdWVyeSkgew0KCQkJCS8vIG5vIGpxdWVyeQ0KCQkJfSBlbHNlIHsNCgkJCQlyZXR1cm4gdGhpcy5wcm9taXNlKA0KCQkJCQludWxsLA0KCQkJCQkkLmFqYXgoew0KCQkJCQkJdHlwZTogJ0dFVCcsDQoJCQkJCQl1cmw6IHVybCwNCgkJCQkJCWFzeW5jOiBmYWxzZSwNCgkJCQkJCXByb2Nlc3NEYXRhOiBmYWxzZSwNCgkJCQkJfSkNCgkJCQkpOw0KCQkJfQ0KCQl9IGVsc2Ugew0KCQkJLy8gc3luY2hyb25vdXMgbW9kZQ0KCQkJaWYgKCF3aW5kb3cualF1ZXJ5KSB7DQoJCQkJLy8gbm8ganF1ZXJ5DQoJCQl9IGVsc2Ugew0KCQkJCSQuYWpheCh7DQoJCQkJCXR5cGU6ICdHRVQnLA0KCQkJCQl1cmw6IHVybCwNCgkJCQkJcHJvY2Vzc0RhdGE6IGZhbHNlLA0KCQkJCQlzdWNjZXNzOiAoZGF0YSkgPT4gY2FsbEJhY2soZGF0YSksDQoJCQkJCWVycm9yOiAoZXJyKSA9PiBjYWxsQmFjayhudWxsKSwNCgkJCQl9KTsNCgkJCX0NCgkJfQ0KCX07DQoNCgl0aGlzLlBvc3QgPSBmdW5jdGlvbigNCgkJdXJsLA0KCQljYWxsQmFjaywNCgkJcG9zdERhdGEsDQoJCWhlYWRlcnMsDQoJCXVzZXJuYW1lLA0KCQlwYXNzd29yZCwNCgkJY29udGVudFR5cGUNCgkpIHsNCgkJdmFyIHhtbEhUVFAgPSB0aGlzLmdldFhtbEhUVFAoKTsNCg0KCQlpZiAoeG1sSFRUUCkgew0KCQkJeG1sSFRUUC5vcGVuKCdQT1NUJywgdXJsLCB0cnVlKTsNCgkJCXhtbEhUVFAud2l0aENyZWRlbnRpYWxzID0gJ3RydWUnOw0KCQkJaWYgKGNyb3NzRG9tYWluKQ0KCQkJCXhtbEhUVFAuc2V0UmVxdWVzdEhlYWRlcigNCgkJCQkJJ0FjY2Vzcy1Db250cm9sLUFsbG93LU9yaWdpbicsDQoJCQkJCWxvY2F0aW9uLm9yaWdpbg0KCQkJCSk7DQoJCQlpZiAoY29udGVudFR5cGUpDQoJCQkJeG1sSFRUUC5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCBjb250ZW50VHlwZSk7DQoJCQlpZiAodXNlcm5hbWUpDQoJCQkJeG1sSFRUUC5zZXRSZXF1ZXN0SGVhZGVyKA0KCQkJCQknQXV0aG9yaXphdGlvbicsDQoJCQkJCSdCYXNpYyAnICsgYnRvYSgndXNlcm5hbWU6cGFzc3dvcmQnKQ0KCQkJCSk7DQoNCgkJCWlmIChoZWFkZXJzKQ0KCQkJCWZvciAodmFyIGkgPSAwOyBpIDwgaGVhZGVycy5sZW5ndGg7IGkrKykNCgkJCQkJeG1sSFRUUC5zZXRSZXF1ZXN0SGVhZGVyKGhlYWRlcnNbaV0ua2V5LCBoZWFkZXJzW2ldLnZhbHVlKTsNCg0KCQkJeG1sSFRUUC5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBmdW5jdGlvbigpIHsNCgkJCQlpZiAod2luZG93LnhtbEhUVFAucmVhZHlTdGF0ZSA9PSA0ICYmIGNhbGxCYWNrKSB7DQoJCQkJCWNhbGxCYWNrKHdpbmRvdy54bWxIVFRQLnJlc3BvbnNlVGV4dCk7DQoJCQkJfQ0KCQkJfTsNCgkJCXhtbEhUVFAuc2VuZChwb3N0RGF0YSk7DQoJCX0NCgl9Ow0KDQoJdGhpcy5oYXNoQ29kZSA9IGZ1bmN0aW9uKHMpIHsNCgkJdmFyIGhhc2ggPSAwLA0KCQkJaSwNCgkJCWNociwNCgkJCWxlbjsNCgkJaWYgKHMubGVuZ3RoID09IDApIHJldHVybiBoYXNoOw0KCQlmb3IgKGkgPSAwLCBsZW4gPSBzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7DQoJCQljaHIgPSBzLmNoYXJDb2RlQXQoaSk7DQoJCQloYXNoID0gKGhhc2ggPDwgNSkgLSBoYXNoICsgY2hyOw0KCQkJaGFzaCB8PSAwOyAvLyBDb252ZXJ0IHRvIDMyYml0IGludGVnZXINCgkJfQ0KCQlyZXR1cm4gaGFzaDsNCgl9Ow0KDQoJdGhpcy50b0hleCA9IGZ1bmN0aW9uKHMpIHsNCgkJaWYgKHR5cGVvZiBzICE9PSAnc3RyaW5nJykgcmV0dXJuIHM7DQoNCgkJcmV0dXJuIHMuc3BsaXQoIiIpLm1hcCh4ID0+ICgyNTYgKyB4LmNoYXJDb2RlQXQoKSkudG9TdHJpbmcoMTYpLnN1YnN0cigtMikpLmpvaW4oIiIpOw0KCX07DQoNCgl0aGlzLmFzY2lpX3ZhbHVlID0gZnVuY3Rpb24oYykgew0KCQkvLyByZXN0cmljdCBpbnB1dCB0byBhIHNpbmdsZSBjaGFyYWN0ZXINCgkJYyA9IGMuY2hhckF0KDApOw0KDQoJCS8vIGxvb3AgdGhyb3VnaCBhbGwgcG9zc2libGUgQVNDSUkgdmFsdWVzDQoJCXZhciBpOw0KCQlmb3IgKGkgPSAwOyBpIDwgMjU2OyArK2kpIHsNCgkJCS8vIGNvbnZlcnQgaSBpbnRvIGEgMi1kaWdpdCBoZXggc3RyaW5nDQoJCQl2YXIgaCA9IGkudG9TdHJpbmcoMTYpOw0KCQkJaWYgKGgubGVuZ3RoID09IDEpIGggPSAnMCcgKyBoOw0KDQoJCQkvLyBpbnNlcnQgYSAlIGNoYXJhY3RlciBpbnRvIHRoZSBzdHJpbmcNCgkJCWggPSAnJScgKyBoOw0KDQoJCQkvLyBkZXRlcm1pbmUgdGhlIGNoYXJhY3RlciByZXByZXNlbnRlZCBieSB0aGUgZXNjYXBlIGNvZGUNCgkJCWggPSB1bmVzY2FwZShoKTsNCg0KCQkJLy8gaWYgdGhlIGNoYXJhY3RlcnMgbWF0Y2gsIHdlJ3ZlIGZvdW5kIHRoZSBBU0NJSSB2YWx1ZQ0KCQkJaWYgKGggPT0gYykgYnJlYWs7DQoJCX0NCgkJcmV0dXJuIGk7DQoJfTsNCg0KCS8qKg0KCSAqIERhdGUgRnVuY3Rpb25zDQoJICovDQoJdGhpcy5kYXlzRGlmZiA9IGZ1bmN0aW9uKGQyLCBkMSkgew0KCQlyZXR1cm4gTWF0aC5jZWlsKChkMi5nZXRUaW1lKCkgLSBkMS5nZXRUaW1lKCkpIC8gKDEwMDAgKiA2MCAqIDYwICogMjQpKTsNCgl9Ow0KDQoJdGhpcy5hZGRNU2Vjb25kcyA9IGZ1bmN0aW9uKG8sIG1zKSB7DQoJCXJldHVybiBuZXcgRGF0ZShvLmdldFRpbWUoKSArIG1zKTsNCgl9Ow0KDQoJdGhpcy5hZGRTZWNvbmRzID0gZnVuY3Rpb24obywgcykgew0KCQlyZXR1cm4gdGhpcy5hZGRNU2Vjb25kcyhvLCBzICogMTAwMCk7DQoJfTsNCg0KCXRoaXMuYWRkTWludXRlcyA9IGZ1bmN0aW9uKG8sIG0pIHsNCgkJcmV0dXJuIHRoaXMuYWRkU2Vjb25kcyhvLCBtICogNjApOw0KCX07DQoNCgl0aGlzLmFkZEhvdXJzID0gZnVuY3Rpb24obywgaCkgew0KCQlyZXR1cm4gdGhpcy5hZGRNaW51dGVzKG8sIGggKiA2MCk7DQoJfTsNCg0KCXRoaXMuYWRkRGF5cyA9IGZ1bmN0aW9uKG8sIGQpIHsNCgkJcmV0dXJuIHRoaXMuYWRkSG91cnMobywgZCAqIDI0KTsNCgl9Ow0KDQoJdGhpcy5hZGRZZWFycyA9IGZ1bmN0aW9uKG8sIHkpIHsNCgkJcmV0dXJuIHRoaXMuYWRkTW9udGhzKG8sIHkgKiAxMik7DQoJfTsNCg0KCXRoaXMuYWRkTW9udGhzID0gZnVuY3Rpb24obywgbSkgew0KCQlyZXR1cm4gbmV3IERhdGUoDQoJCQlvLmdldEZ1bGxZZWFyKCksDQoJCQlvLmdldE1vbnRoKCkgKyBtLA0KCQkJby5nZXREYXRlKCksDQoJCQlvLmdldEhvdXJzKCksDQoJCQlvLmdldE1pbnV0ZXMoKSwNCgkJCW8uZ2V0U2Vjb25kcygpDQoJCSk7DQoJfTsNCg0KCXRoaXMuaXNEYXRlID0gZnVuY3Rpb24obykgew0KCQlyZXR1cm4gKA0KCQkJbyAhPSBudWxsICYmDQoJCQlvLmNvbnN0cnVjdG9yICE9IG51bGwgJiYNCgkJCW8uY29uc3RydWN0b3IudG9TdHJpbmcoKS5pbmRleE9mKCdmdW5jdGlvbiBEYXRlKCcpID4gLTENCgkJKTsNCgl9Ow0KDQoJdGhpcy50b1Nob3J0RGF0ZSA9IGZ1bmN0aW9uKG8pIHsNCgkJaWYgKCF0aGlzLmlzRGF0ZShvKSkgcmV0dXJuICcnOyAvLyBhdm9pZCBudWxscw0KCQlyZXR1cm4gby5nZXRNb250aCgpICsgMSArICcvJyArIG8uZ2V0RGF0ZSgpICsgJy8nICsgby5nZXRGdWxsWWVhcigpOw0KCX07DQoNCgl0aGlzLnRvU2hvcnRUaW1lID0gZnVuY3Rpb24obykgew0KCQlpZiAoIXRoaXMuaXNEYXRlKG8pKSByZXR1cm4gJyc7IC8vIGF2b2lkIG51bGxzDQoJCXZhciBob3VycyA9ICcnICsgby5nZXRIb3VycygpOyAvL28uZ2V0SG91cnMoKSUxMjsNCgkJdmFyIG1pbnV0ZXMgPSAnJyArIG8uZ2V0TWludXRlcygpOw0KCQl2YXIgc2Vjb25kcyA9ICcnICsgby5nZXRTZWNvbmRzKCk7DQoJCWlmIChob3Vycy5sZW5ndGggPCAyKSBob3VycyA9ICcwJyArIGhvdXJzOw0KCQlpZiAobWludXRlcy5sZW5ndGggPCAyKSBtaW51dGVzID0gJzAnICsgbWludXRlczsNCgkJaWYgKHNlY29uZHMubGVuZ3RoIDwgMikgc2Vjb25kcyA9ICcwJyArIHNlY29uZHM7DQoJCXJldHVybiBob3VycyArICc6JyArIG1pbnV0ZXMgKyAnOicgKyBzZWNvbmRzOyAvLyArICIgIiArIChvLmdldEhvdXJzKCk+PTEyPyJQTSI6IkFNIik7DQoJfTsNCg0KCXRoaXMudG9EYXRlVGltZSA9IGZ1bmN0aW9uKG8pIHsNCgkJaWYgKCF0aGlzLmlzRGF0ZShvKSkgcmV0dXJuICcnOyAvLyBhdm9pZCBudWxscw0KCQlyZXR1cm4gdGhpcy50b1Nob3J0RGF0ZShvKSArICcgJyArIHRoaXMudG9TaG9ydFRpbWUobyk7DQoJfTsNCgkvKioNCgkgKiBFTkQ6IERhdGUgRnVuY3Rpb25zDQoJICovDQoNCgl0aGlzLnNldFByb3BlcnR5ID0gZnVuY3Rpb24oY2lkLCBzLCBwcm9wLCBkZWYpIHsNCgkJaWYgKCFjaWQpIHJldHVybjsNCgkJdmFyIG8gPSAkKGNpZCk7DQoJCWlmICghbykgcmV0dXJuOw0KDQoJCWlmICghcHJvcCkgew0KCQkJaWYgKG8udGFnTmFtZSA9PSAnSU5QVVQnKSB7DQoJCQkJcHJvcCA9ICd2YWx1ZSc7DQoJCQkJaWYgKG8udHlwZSA9PSAndGV4dCcpIHByb3AgPSAndmFsdWUnOw0KCQkJCWlmIChvLnR5cGUgPT0gJ2NoZWNrYm94JykgcHJvcCA9ICdjaGVja2VkJzsNCgkJCX0gZWxzZSB7DQoJCQkJcHJvcCA9ICdpbm5lckhUTUwnOw0KCQkJfQ0KCQl9DQoJCWlmICghZGVmKSBkZWYgPSAnJzsNCgkJaWYgKHRoaXMucHJlUHJvY2Vzc0hUTUwpIGRlZiA9IHRoaXMucHJlUHJvY2Vzc0hUTUwoZGVmKTsNCg0KCQlpZiAodGhpcy5pc0RhdGUocykpIHsNCgkJCS8vIGEgZGF0ZSBmaWVsZA0KCQkJcyA9IHRoaXMudG9TaG9ydERhdGUocyk7DQoJCX0gZWxzZSB7DQoJCQlpZiAodGhpcy5wcmVQcm9jZXNzSFRNTCkgcyA9IHRoaXMucHJlUHJvY2Vzc0hUTUwocyk7DQoJCX0NCg0KCQl3aW5kb3cucHJvcGVydHlWYWx1ZSA9IHM7DQoJCXRyeSB7DQoJCQl0aGlzLnJ1blNjcmlwdCgNCgkJCQkiJCgnIiArIG8uaWQgKyAiJykuIiArIHByb3AgKyAnID0gd2luZG93LnByb3BlcnR5VmFsdWU7Jw0KCQkJKTsNCgkJfSBjYXRjaCAoZSkgew0KCQkJdGhpcy5TaG93RXJyb3IoZS5tZXNzYWdlKTsNCgkJCXRoaXMucnVuU2NyaXB0KCIkKCciICsgby5pZCArICInKS4iICsgcHJvcCArICcgPSAiJyArIGRlZiArICciOycpOw0KCQl9DQoJCXdpbmRvdy5wcm9wZXJ0eVZhbHVlID0gbnVsbDsNCgl9Ow0KDQoJLyoqDQoJICogVmFsaWRhdGlvbg0KCSAqLw0KCXRoaXMudmFsaWROb3ROdWxsID0gZnVuY3Rpb24ocykgew0KCQlpZiAodHlwZW9mIHMgPT0gJ3N0cmluZycpIHsNCgkJCXJldHVybiBzICYmIHMubGVuZ3RoID4gMDsNCgkJfSBlbHNlIHsNCgkJCXJldHVybiBzICE9IG51bGw7DQoJCX0NCgl9Ow0KDQoJdGhpcy52YWxpZE9iamVjdCA9IGZ1bmN0aW9uKG8pIHsNCgkJcmV0dXJuIG8gIT0gbnVsbDsNCgl9Ow0KDQoJdGhpcy52YWxpZEVtYWlsID0gZnVuY3Rpb24oc3RyKSB7DQoJCXZhciBhdCA9ICdAJzsNCgkJdmFyIGRvdCA9ICcuJzsNCgkJdmFyIGxhdCA9IHN0ci5pbmRleE9mKGF0KTsNCgkJdmFyIGxzdHIgPSBzdHIubGVuZ3RoOw0KCQl2YXIgbGRvdCA9IHN0ci5pbmRleE9mKGRvdCk7DQoJCWlmICgNCgkJCXN0ci5pbmRleE9mKGF0KSA9PSAtMSB8fA0KCQkJc3RyLmluZGV4T2YoYXQpID09IC0xIHx8DQoJCQlzdHIuaW5kZXhPZihhdCkgPT0gMCB8fA0KCQkJc3RyLmluZGV4T2YoYXQpID09IGxzdHIgfHwNCgkJCXN0ci5pbmRleE9mKGRvdCkgPT0gLTEgfHwNCgkJCXN0ci5pbmRleE9mKGRvdCkgPT0gMCB8fA0KCQkJc3RyLmluZGV4T2YoZG90KSA9PSBsc3RyIHx8DQoJCQlzdHIuaW5kZXhPZihhdCwgbGF0ICsgMSkgIT0gLTEgfHwNCgkJCXN0ci5zdWJzdHJpbmcobGF0IC0gMSwgbGF0KSA9PSBkb3QgfHwNCgkJCXN0ci5zdWJzdHJpbmcobGF0ICsgMSwgbGF0ICsgMikgPT0gZG90IHx8DQoJCQlzdHIuaW5kZXhPZihkb3QsIGxhdCArIDIpID09IC0xIHx8DQoJCQlzdHIuaW5kZXhPZignICcpICE9IC0xDQoJCSkgew0KCQkJcmV0dXJuIGZhbHNlOw0KCQl9IGVsc2Ugew0KCQkJcmV0dXJuIHRydWU7DQoJCX0NCgl9Ow0KDQoJdGhpcy52YWxpZGF0ZSA9IGZ1bmN0aW9uKG8sIHR5cGUsIGNvbmZpZykgew0KCQlpZiAodHlwZW9mIG8gPT0gJ3N0cmluZycpIG8gPSAkKG8pOw0KCQl2YXIgYkFsZXJ0ID0gdHJ1ZTsNCgkJaWYgKCFvKSByZXR1cm47DQoNCgkJaWYgKCFjb25maWcpIGNvbmZpZyA9IHt9Ow0KCQl2YXIgb0VyciA9ICQoby5pZCArICdfRXJyb3InKTsNCgkJaWYgKCFvRXJyICYmIGRvY3VtZW50Lmluc2VydEFkamFjZW50RWxlbWVudCkgew0KCQkJYkFsZXJ0ID0gZmFsc2U7DQoJCQlvRXJyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnU1BBTicpOw0KCQkJb0Vyci5pZCA9IG8uaWQgKyAnX0Vycm9yJzsNCgkJCW9FcnIuY2xhc3NOYW1lID0gJ2Vycm9yJzsNCgkJCW8uaW5zZXJ0QWRqYWNlbnRFbGVtZW50KCdhZnRlckVuZCcsIG9FcnIpOw0KCQl9DQoNCgkJaWYgKCFjb25maWdbJ2ZpZWxkJ10pIHsNCgkJCXZhciB0YWcgPSBvLnRhZ05hbWUudG9Mb3dlckNhc2UoKTsNCgkJCWlmICgNCgkJCQkodGFnID09ICdzcGFuJyB8fCB0YWcgPT0gJ2EnKSAmJg0KCQkJCShvLmdldEF0dHJpYnV0ZSgnZnJvbScpIHx8IG8uZ2V0QXR0cmlidXRlKCdsb29rdXAnKSkNCgkJCSkgew0KCQkJCWNvbmZpZ1snZmllbGQnXSA9ICdTZWxlY3RlZEl0ZW0nOw0KCQkJCXR5cGUgPSAnT2JqZWN0JzsNCgkJCX0gZWxzZSB7DQoJCQkJY29uZmlnWydmaWVsZCddID0gJ3ZhbHVlJzsNCgkJCX0NCgkJfQ0KCQlpZiAoIXR5cGUpIHR5cGUgPSAnTm90TnVsbCc7DQoNCgkJaWYgKCFjb25maWdbJ2xhYmVsJ10pIHsNCgkJCXZhciB0aXRsZSA9IG8uZ2V0QXR0cmlidXRlKCd0aXRsZScpOw0KCQkJaWYgKCF0aXRsZSkgew0KCQkJCXRpdGxlID0gby5pZC5zcGxpdCgnXycpOw0KCQkJCXRpdGxlID0gdGl0bGVbMV07DQoJCQkJdGl0bGUgPSB0aXRsZS5zdWJzdHIoMyk7DQoJCQkJdGl0bGUgPSB0aGlzLkVuZ2xpc2hOYW1lKHRpdGxlKTsNCgkJCX0NCgkJCWNvbmZpZ1snbGFiZWwnXSA9IHRpdGxlOw0KCQl9DQoJCWlmICghY29uZmlnWydtZXNzYWdlJ10pIGNvbmZpZ1snbWVzc2FnZSddID0gJ0ludmFsaWQgVmFsdWUnOw0KDQoJCXZhciBiVmFsaWQgPSB0cnVlOw0KCQl3aW5kb3cudmFsaWRhdGlvblZhbHVlID0gd2luZG93LmNtcy52KG8pOyAvL1tjb25maWdbImZpZWxkIl1dOy8vdmFsdWUNCgkJYlZhbGlkID0NCgkJCWJWYWxpZCAmJg0KCQkJdGhpcy5ydW5TY3JpcHQoDQoJCQkJJ3dpbmRvdy5jbXMuc3IudmFsaWQnICsgdHlwZSArICcod2luZG93LnZhbGlkYXRpb25WYWx1ZSknDQoJCQkpOw0KCQl3aW5kb3cudmFsaWRhdGlvblZhbHVlID0gbnVsbDsNCg0KCQlpZiAoIWJWYWxpZCkgew0KCQkJLy9vLnZhbHVlID0gIiI7DQoJCQkvL28uZm9jdXMoKTsNCgkJCXNNZXNzYWdlID0gY29uZmlnWydtZXNzYWdlJ107DQoJCX0gZWxzZSB7DQoJCQlzTWVzc2FnZSA9ICcnOw0KCQl9DQoNCgkJaWYgKCFiVmFsaWQpIHsNCgkJCWlmIChiQWxlcnQpIHsNCgkJCQl0aGlzLnNfRXJyb3JNZXNzYWdlcyArPQ0KCQkJCQknXG4nICsgY29uZmlnWydsYWJlbCddICsgJzogJyArIHNNZXNzYWdlOw0KCQkJfSBlbHNlIHsNCgkJCQlvRXJyLmlubmVySFRNTCA9IHNNZXNzYWdlOw0KCQkJfQ0KCQl9DQoJfTsNCgkvKioNCgkgKiBFTkQ6IFZhbGlkYXRpb24NCgkgKi8NCg0KCXRoaXMuRW5nbGlzaE5hbWUgPSBmdW5jdGlvbihzKSB7DQoJCXJldHVybiBzLnJlcGxhY2UoL15bYS16XXxbQS1aXS9nLCAodiwgaSkgPT4gaSA9PT0gMCA/IHYudG9VcHBlckNhc2UoKSA6ICIgIiArIHYudG9Mb3dlckNhc2UoKSk7DQoNCgkJdmFyIHJldCA9ICcnOw0KCQlmb3IgKHZhciBpID0gMDsgaSA8IHMubGVuZ3RoOyBpKyspIHsNCgkJCWlmIChzW2ldID49ICdBJyAmJiBzW2ldIDw9ICdaJykgew0KCQkJCXJldCArPSAocmV0Lmxlbmd0aCA9PSAwID8gJycgOiAnICcpICsgc1tpXTsNCgkJCX0gZWxzZSBpZiAocmV0Lmxlbmd0aCA9PSAwKSB7DQoJCQkJcmV0ICs9IChzW2ldICsgJycpLnRvVXBwZXJDYXNlKCk7DQoJCQl9IGVsc2Ugew0KCQkJCXJldCArPSBzW2ldOw0KCQkJfQ0KCQl9DQoNCgkJcmV0dXJuIHJldDsNCgl9Ow0KDQoJLyoqIE9iamVjdCBDb21wYXJpc29uICoqLw0KCXRoaXMubmV3T2JqZWN0ID0gZnVuY3Rpb24oKSB7DQoJCXZhciByZXQgPSBuZXcgT2JqZWN0KCk7DQoJCXJldC5fX09CSkVDVElEID0gTWF0aC5yYW5kb20oKTsNCgkJcmV0dXJuIHJldDsNCgl9Ow0KDQoJdGhpcy5FcXVhbHMgPSBmdW5jdGlvbihvMSwgbzIpIHsNCgkJaWYgKG8xID09IG8yKSByZXR1cm4gdHJ1ZTsNCg0KCQlpZiAoDQoJCQlvMSAmJg0KCQkJbzEuX19PQkpFQ1RJRCAmJg0KCQkJbzIgJiYNCgkJCW8yLl9fT0JKRUNUSUQgJiYNCgkJCW8xLl9fT0JKRUNUSUQgPT0gbzIuX19PQkpFQ1RJRA0KCQkpDQoJCQlyZXR1cm4gdHJ1ZTsNCgkJaWYgKG8xICYmIG8xLl9fUk9XSUQgJiYgbzIgJiYgbzIuX19ST1dJRCAmJiBvMS5fX1JPV0lEID09IG8yLl9fUk9XSUQpDQoJCQlyZXR1cm4gdHJ1ZTsNCgkJaWYgKG8xICYmIG8xLklkICYmIG8yICYmIG8yLklkICYmIG8xLklkID09IG8yLklkKSByZXR1cm4gdHJ1ZTsNCg0KCQlyZXR1cm4gZmFsc2U7DQoJfTsNCgkvKiogT2JqZWN0IENvbXBhcmlzb24gKiovDQoNCgl0aGlzLnNlcmlhbGl6ZSA9IGZ1bmN0aW9uKF9vYmopIHsNCgkJdHJ5IHsNCgkJCS8vIExldCBHZWNrbyBicm93c2VycyBkbyB0aGlzIHRoZSBlYXN5IHdheQ0KCQkJaWYgKA0KCQkJCXR5cGVvZiBfb2JqLnRvU291cmNlICE9PSAndW5kZWZpbmVkJyAmJg0KCQkJCXR5cGVvZiBfb2JqLmNhbGxlZSA9PT0gJ3VuZGVmaW5lZCcNCgkJCSkgew0KCQkJCXJldHVybiBfb2JqLnRvU291cmNlKCk7DQoJCQl9DQoJCQkvLyBPdGhlciBicm93c2VycyBtdXN0IGRvIGl0IHRoZSBoYXJkIHdheQ0KCQkJc3dpdGNoICh0eXBlb2YgX29iaikgew0KCQkJCS8vIG51bWJlcnMsIGJvb2xlYW5zLCBhbmQgZnVuY3Rpb25zIGFyZSB0cml2aWFsOg0KCQkJCS8vIGp1c3QgcmV0dXJuIHRoZSBvYmplY3QgaXRzZWxmIHNpbmNlIGl0cyBkZWZhdWx0IC50b1N0cmluZygpDQoJCQkJLy8gZ2l2ZXMgdXMgZXhhY3RseSB3aGF0IHdlIHdhbnQNCgkJCQljYXNlICdudW1iZXInOg0KCQkJCWNhc2UgJ2Jvb2xlYW4nOg0KCQkJCWNhc2UgJ2Z1bmN0aW9uJzoNCgkJCQkJcmV0dXJuIF9vYmo7DQoJCQkJCWJyZWFrOw0KDQoJCQkJCS8vIGZvciBKU09OIGZvcm1hdCwgc3RyaW5ncyBuZWVkIHRvIGJlIHdyYXBwZWQgaW4gcXVvdGVzDQoJCQkJY2FzZSAnc3RyaW5nJzoNCgkJCQkJcmV0dXJuICInIiArIF9vYmogKyAiJyI7DQoJCQkJCWJyZWFrOw0KDQoJCQkJY2FzZSAnb2JqZWN0JzoNCgkJCQkJdmFyIHN0cjsNCgkJCQkJaWYgKA0KCQkJCQkJX29iai5jb25zdHJ1Y3RvciA9PT0gQXJyYXkgfHwNCgkJCQkJCXR5cGVvZiBfb2JqLmNhbGxlZSAhPT0gJ3VuZGVmaW5lZCcNCgkJCQkJKSB7DQoJCQkJCQlzdHIgPSAnWyc7DQoJCQkJCQl2YXIgaSwNCgkJCQkJCQlsZW4gPSBfb2JqLmxlbmd0aDsNCgkJCQkJCWZvciAoaSA9IDA7IGkgPCBsZW4gLSAxOyBpKyspIHsNCgkJCQkJCQlzdHIgKz0gdGhpcy5zZXJpYWxpemUoX29ialtpXSkgKyAnLCc7DQoJCQkJCQl9DQoJCQkJCQlzdHIgKz0gdGhpcy5zZXJpYWxpemUoX29ialtpXSkgKyAnXSc7DQoJCQkJCX0gZWxzZSB7DQoJCQkJCQlzdHIgPSAneyc7DQoJCQkJCQl2YXIga2V5Ow0KCQkJCQkJZm9yIChrZXkgaW4gX29iaikgew0KCQkJCQkJCXN0ciArPSBrZXkgKyAnOicgKyB0aGlzLnNlcmlhbGl6ZShfb2JqW2tleV0pICsgJywnOw0KCQkJCQkJfQ0KCQkJCQkJc3RyID0gc3RyLnJlcGxhY2UoL1wsJC8sICcnKSArICd9JzsNCgkJCQkJfQ0KCQkJCQlyZXR1cm4gc3RyOw0KCQkJCQlicmVhazsNCg0KCQkJCWRlZmF1bHQ6DQoJCQkJCXJldHVybiAnVU5LTk9XTic7DQoJCQkJCWJyZWFrOw0KCQkJfQ0KCQl9IGNhdGNoIChlKSB7DQoJCQl0aGlzLlNob3dEZWJ1ZyhlLm1lc3NhZ2UpOw0KCQl9DQoJfTsNCn0=",
	"__keys": ["name"],
	"active": true,
	"enabled": true,
	"__trMap": []
}