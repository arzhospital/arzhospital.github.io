{
	"Id": "e0195e151e4168af425366568726ab4e9900eb04",
	"after": null,
	"async": null,
	"before": null,
	"date": "undefined",
	"name": "EntityClass",
	"order": null,
	"remark": "dW5kZWZpbmVk",
	"script": "PCUNCmxldCBhdXRoQ2xhc3MgPSBhckNsYXNzZXMuZmluZChfYyA9PiBfYy5FbnRpdHlNZXRob2RzLmZpbmQobSA9PiBtLk5hbWU9PSdhdXRob3JpemUnICYmIG0uSXNQdWJsaWMpKTsNCmxldCBlbXMgPSBhckNsYXNzZXMuZmluZChfYyA9PiBfYy5OYW1lPT0nRW50aXR5Q2xhc3MnKTsNCg0KLy8gdGhlIGRlZmF1bHQgU2V0X09uIGRhdGUgdG8gdXNlDQpsZXQgU2V0X09uID0gYG5ldyBEYXRlKClgOw0KDQpsZXQgX2I2NHRlc3QgPSBzID0+IGAodHlwZW9mKCR7c30pPT09J3N0cmluZyc/KC8qJHtzfS5sZW5ndGg+MTAwMCB8fCovIC9eKFswLTlhLXpBLVorXC9dezR9KSooKFswLTlhLXpBLVorXC9dezJ9PT0pfChbMC05YS16QS1aK1wvXXszfT0pKT8kLy50ZXN0KCR7c318fCcuJykpOmZhbHNlKWA7DQoNCmxldCBfZGVmID0gKHMsIHYpID0+ICU+PCU9cyU+ID0gdHlwZW9mKDwlPXMlPikhPT0ndW5kZWZpbmVkJz88JT1zJT46PCU9diU+OzwlDQoNCmxldCBfZGVmYXVsdHMgPSAob2JqPSd0aGlzJywgX2M9YykgPT4gX2MuRW50aXR5QXR0cmlidXRlcy5maWx0ZXIoZWEgPT4gIWVhLkVudGl0eU1ldGhvZCAmJiBlYS5EZWZhdWx0KS5mb3JFYWNoKGVhID0+IHslPg0KICAgICAgICAgICAgaWYoITwlPW9iaiU+Ll88JT1uTmFtZShlYSklPl9zZXQpew0KICAgICAgICAgICAgICAgIDwlPW9iaiU+LjwlPW5OYW1lKGVhKSU+KDwldmFsdWVPZihlYS5EZWZhdWx0KSU+KTsNCiAgICAgICAgICAgIH0NCjwlIH0pOw0KDQpsZXQgbG9nID0gKG4sIF90aGlzPSd0aGlzJykgPT4gYCR7X3RoaXN9LmxvZyhudWxsLCB1bmRlZmluZWQsICcke24gfHwgbU5hbWV9JywgJ0VudGl0eU9iamVjdCcsIDAsIGA7DQpsZXQgd2FybiA9IChuLCBfdGhpcz0ndGhpcycpID0+IGAke190aGlzfS5sb2cobnVsbCwgdW5kZWZpbmVkLCAnJHtuIHx8IG1OYW1lfScsICdFbnRpdHlPYmplY3QnLCAxLCBgOw0KbGV0IGVycm9yID0gKG4sIF90aGlzPSd0aGlzJykgPT4gYCR7X3RoaXN9LmxvZyhudWxsLCB1bmRlZmluZWQsICcke24gfHwgbU5hbWV9JywgJ0VudGl0eU9iamVjdCcsIDIsIGA7DQoNCmxldCBxbFR5cGUgPSAoZWEsIGJJbnB1dCkgPT4gew0KICAgIGlmKGVhLklzQm9vbCkgcmV0dXJuICdCb29sZWFuJzsNCiAgICAvL2lmKGVhLklzRGF0ZSkgcmV0dXJuICdEYXRlVGltZSc7DQogICAgaWYoZWEuSXNJbnQgfHwgZWEuSXNGbG9hdCkgcmV0dXJuICdJbnQnOw0KICAgIGlmKGVhLkVudGl0eVR5cGUpIHJldHVybiBuTmFtZShlYS5FbnRpdHlUeXBlKSsoYklucHV0PyJJbnB1dCI6IiIpOw0KICAgIHJldHVybiAnU3RyaW5nJzsNCn07DQoNCi8vIHdoeSBoYXJkIGNvZGVkPz8/DQpsZXQgX3Jlc3RUb29scyA9IFsnU2VydmljZU5vdycsICdTYWxlc0ZvcmNlJywgJ1Jlc3REQklPJywgJ0dpdEh1YicsICdGaWxlU3lzdGVtJ107DQpsZXQgX3NxbFRvb2xzID0gWydTcWxEQicsICdTYWxlc0ZvcmNlJywgJ1Nub3dGbGFrZSddOw0KbGV0IF9maWxlVG9vbHMgPSBbJ0dpdEh1YicsICdGaWxlU3lzdGVtJ107DQoNCmxldCBjbHNUb29scyA9IF9jID0+IF9jLlRvb2xzLm1hcCh0ID0+IHQudHlwZT90LnR5cGUubmFtZToodC5uYW1lIHx8IHQpKTsNCmxldCBtYWluQ2xhc3MgPSAoX2FyVG9vbHMsIF9jPWMpID0+IGFyQ2xhc3Nlcy5maW5kKF9fYyA9PiAoX2FyVG9vbHMgfHwgY2xzVG9vbHMoX2MpKS5maW5kKHQgPT4gY2xzVG9vbHMoX19jKS5pbmNsdWRlcyh0KSkpIHx8ICghKF9hclRvb2xzIHx8IGNsc1Rvb2xzKF9jKSkubGVuZ3RoICYmIGFyQ2xhc3Nlc1swXSk7DQoNCmxldCBfZWFUeXBlcyA9IChfYz1jLCBiQWxsKSA9PiBfRnJFTUQuX3RvSlMoT2JqZWN0LmFzc2lnbih7fSwgLi4uX2MuRW50aXR5QXR0cmlidXRlcy5maWx0ZXIoZWEgPT4gIWVhLkVudGl0eU1ldGhvZCAmJiBiQWxsP3RydWU6ZWEuRW50aXR5VHlwZSkubWFwKGVhID0+ICh7W25OYW1lKGVhKV06IG5OYW1lKGVhLkVudGl0eVR5cGUpIHx8IF9GckVNRC5fYXR0cihlYSl9KSkpKTsNCg0KbGV0IF9jRmllbGQgPSAoZWEsIF9jPWVhLkVudGl0eUNsYXNzKSA9PiAoKGVhLkVudGl0eVR5cGU/KGVhLkVudGl0eVR5cGUuVHlwZWRBdHRyaWJ1dGVzLmZpbmQodGEgPT4gdGEuRW50aXR5Q2xhc3M9PV9jKSB8fCBlYS5FbnRpdHlDbGFzcy5FbnRpdHlBdHRyaWJ1dGVzLmZpbmQoX2VhID0+IF9lYS5FbnRpdHlUeXBlPT1fYykpOm51bGwpIHx8IHtOYW1lOiAiIn0pLk5hbWU7DQoNCmxldCBfY05hbWUgPSAoY249Yy5OYW1lLCBiQWxpYXMpID0+IHsNCiAgICBpZihjbi5OYW1lKSBjbiA9IGNuLk5hbWU7DQogICAgbGV0IF9jID0gYXJDbGFzc2VzLmZpbmQoZWMgPT4gZWMuTmFtZT09Y24pOw0KICAgIGlmKCFfYykgcmV0dXJuICcnOw0KICAgIHJldHVybiBuTmFtZShfYywgYkFsaWFzKTsNCn07DQoNCmxldCBhbGlhcyA9IChjbiwgaj0nLicpID0+IChzY29wZSArICcuJyArIF9jTmFtZShjbiwgdHJ1ZSkucmVwbGFjZShfY05hbWUoY24pLCAnJykpLnNwbGl0KCcuJykuZmlsdGVyKG4gPT4gbikuam9pbihqKTsNCmxldCBuc2NvcGUgPSBhbGlhcygnTm9kZScpOw0KDQpsZXQgX3ZDb2RlID0gayA9PiB7JT4oPCV2YWx1ZU9mKGsuQ29kZSklPiB8fCAoIjwlPW5Db2RlKGspJT4iKSk8JX07DQpsZXQgX25Db2RlID0gKGVhLCBiVHlwZWQpID0+IGVhPygidGhpcy5fbkNvZGUoJyIgKyBuQ29kZShlYSkgKyAoYlR5cGVkPygnXycgKyBlYS5FbnRpdHlDbGFzcy5QbHVyYWwucmVwbGFjZSgvIC9nLCAnXycpKToiIikgICsgIicsICIgKyAoYlR5cGVkP251bGw6X0ZyRU1ELl90b0pTKGVhLkNvZGUpKSArICIpIik6InRoaXMuX25Db2RlKCkiOw0KbGV0IG1Sb3V0aW5nID0gKGMsIG0pID0+IHsNCiAgICBpZiAoIWMgJiYgbSkgYyA9IG0uRW50aXR5Q2xhc3M7DQogICAgaWYgKCFtICYmICFjKSByZXR1cm4gIiI7DQogICAgaWYgKCFtKSBtID0gYzsNCiAgICBpZiAoIW0uUm91dGluZyAmJiAhYy5Sb3V0aW5nKSByZXR1cm4gIiI7DQoNCiU+KF9ub2RlLCBtZXRob2QpID0+IHsNCiAgICAJbGV0IGxvZyA9IChvYmosIC4uLm1zZykgPT4gdGhpcy5sb2coIjwlPW5OYW1lKGMpJT4iLCBvYmosICI8JW0/bS5OYW1lOicnJT4iIHx8IG1ldGhvZCwgIlJvdXRlciIsIDAsIC4uLm1zZyk7DQogICAgCWxldCB3YXJuID0gKG9iaiwgLi4ubXNnKSA9PiB0aGlzLmxvZygiPCU9bk5hbWUoYyklPiIsIG9iaiwgIjwlbT9tLk5hbWU6JyclPiIgfHwgbWV0aG9kLCAiUm91dGVyIiwgMSwgLi4ubXNnKTsNCiAgICAJbGV0IGVycm9yID0gKG9iaiwgLi4ubXNnKSA9PiB0aGlzLmxvZygiPCU9bk5hbWUoYyklPiIsIG9iaiwgIjwlbT9tLk5hbWU6JyclPiIgfHwgbWV0aG9kLCAiUm91dGVyIiwgMiwgLi4ubXNnKTsNCiAgICAJbGV0IG9TY29wZSA9IDwlPWFsaWFzKCklPjsNCiAgICAJbGV0IHBTY29wZSA9IDwlPXNjb3BlJT47DQogICAgCWxldCBuU2NvcGUgPSA8JT1uc2NvcGUlPjsNCg0KICAgICAgICB0cnl7DQogICAgICAgIDwlZnVuY3Rpb25PZihtLlJvdXRpbmcpJT4NCiAgICAgICAgfWNhdGNoKGV4KXsNCiAgICAgICAgICAgIHdhcm4oZXgpOw0KICAgICAgICB9DQp9DQo8JX07DQoNCmxldCBtTmFtZSA9ICcnOw0KDQpsZXQgZnVuY3Rpb25PZiA9IChmdW4sIF90aGlzPSd0aGlzJykgPT4geyU+DQogICAgICAgIGxldCBfX3JldCA9IHVuZGVmaW5lZDsNCiAgICA8JSBpZihmdW4peyU+DQogICAgICAgIDwlIGlmKHR5cGVvZihmdW4pPT09J29iamVjdCcpeyU+DQogICAgICAgICAgICA8JSBjbHNUb29scyhjKS5mb3JFYWNoKHQgPT4geyU+DQogICAgICAgIGlmKDwlPV90aGlzJT4uVG9vbCAmJiA8JT1fdGhpcyU+LlRvb2wudHlwZS5uYW1lPT0iPCU9dCU+Iil7DQogICAgICAgICAgICAgICAgPCUgaWYodHlwZW9mKGZ1blt0XSk9PT0nZnVuY3Rpb24nKXslPg0KICAgICAgICAgICAgX19yZXQgPSA8JT1mdW5bdF0lPjsNCiAgICAgICAgICAgICAgICA8JSB9ZWxzZXslPg0KICAgICAgICAgICAgX19yZXQgPSA8JT0oSlNPTi5zdHJpbmdpZnkoZnVuW3RdKSB8fCAnIiInKSU+Ow0KICAgICAgICAgICAgICAgIDwlIH0lPg0KICAgICAgICB9DQogICAgICAgICAgICA8JSB9KSU+DQogICAgICAgIDwlIH1lbHNleyU+DQogICAgICAgICAgICBfX3JldCA9IDwlPWZ1biU+Ow0KICAgICAgICA8JSB9JT4NCiAgICA8JSB9JT4NCiAgICAgICAgaWYodHlwZW9mKF9fcmV0KT09PSdzdHJpbmcnICYmIF9fcmV0LnN0YXJ0c1dpdGgoInMoIikgJiYgX19yZXQuZW5kc1dpdGgoIikiKSl7DQogICAgICAgICAgICBfX3JldCA9IHRoaXMucnVuU2NyaXB0KF9fcmV0LnNsaWNlKDIsLTEpKTsNCiAgICAgICAgfQ0KICAgICAgICBpZih0eXBlb2YoX19yZXQpPT09ImZ1bmN0aW9uIil7DQogICAgICAgICAgICBfX3JldCA9IF9fcmV0KDwlPV90aGlzJT4pOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiBfX3JldDsNCjwlfTsNCg0KbGV0IHZhbHVlT2YgPSAoZnVuLCBfdGhpcz0ndGhpcycpID0+IHslPigoDQoob1Njb3BlKSA9PiB7DQogICAgdHJ5ew0KPCVmdW5jdGlvbk9mKGZ1biwgX3RoaXMpJT4NCiAgICB9Y2F0Y2goX3ZPZkV4KXsNCiAgICAgICAgPCU9d2FybigpJT4ndmFsdWVPZicsIF92T2ZFeCwgPCU9X0ZyRU1ELl90b0pTKGZ1biklPik7DQogICAgfQ0KfQ0KKSg8JT1hbGlhcygpJT4pKTwlfTsNCg0KbGV0IHVuUmVjdXJzZSA9IChvYmosIGZ1biwgZkFyZ3M9J2FyZ3VtZW50cycsIHNSZXQsIHZhbGlkaXR5PWB0aGlzLl9fY29uZmlnKCd1blJlY3Vyc2UudmFsaWRpdHknLCAwLjUpYCwgaWRmKSA9PiB7DQogICAgaWRmID0gaWRmIHx8IGAodGhpcz90aGlzLl9fY29uZmlnKCdpZEZpZWxkJywgJ0lkJyk6J0lkJylgOw0KICAgIGZ1biA9IGZ1biB8fCBgIiR7bU5hbWV9ImA7DQogICAgc1JldCA9IGANCiAgICAgICAgdHJ5ew0KICAgICAgICAgICAgaWYodil7DQogICAgICAgICAgICAgICAgdi5kYXRlID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7DQogICAgICAgICAgICAgICAgdi5yZXVzZWQrKzsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgJHtzUmV0fQ0KICAgICAgICB9Y2F0Y2goc1JldF9leCl7DQogICAgICAgICAgICB0aGlzLmxvZyhudWxsLCB1bmRlZmluZWQsICR7ZnVufSwgJyR7bU5hbWV9LnVuUmVjdXJzZScsIDEsICdzUmV0Jywgc1JldF9leCk7DQogICAgICAgIH1maW5hbGx5ew0KICAgICAgICAgICAgaWYodiAmJiB2LnJldXNlZD4xKSByZXR1cm4gdj92Lm9iajp2Ow0KICAgICAgICB9DQogICAgYDsNCiAgICBsZXQgYkRhbmdlciA9ICgpID0+ICU+KFsiX3RvSGFzaCJdLmluZGV4T2YoPCU9ZnVuJT4pPj0wKTwlOw0KJT4NCiAgICAgICAgbGV0IHYgPSB1bmRlZmluZWQ7DQogICAgICAgIHRyeXsNCiAgICAgICAgICAgIDwlPXNjb3BlJT4udW5SZWN1cnNlQWJvcnQgPSA8JT1zY29wZSU+LnVuUmVjdXJzZUFib3J0IHx8IHt9Ow0KICAgICAgICAgICAgaWYoPCU9c2NvcGUlPi51blJlY3Vyc2VBYm9ydFs8JT1mdW4lPl0pew0KICAgICAgICAgICAgICAgIDwlPXdhcm4oYCR7bU5hbWV9LnVuUmVjdXJzZWApJT5gQWJvcnRpbmcgYXMgcGVyIDwlPXNjb3BlJT4udW5SZWN1cnNlQWJvcnQuJHs8JT1mdW4lPn1gKTsNCiAgICAgICAgICAgICAgICA8JT1zUmV0JT4NCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgbGV0IF9pZCA9IG51bGw7DQogICAgICAgICAgICBpZih0eXBlb2YoPCU9b2JqJT4pPT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIDwlPXdhcm4oYCR7bU5hbWV9LnVuUmVjdXJzZWApJT4iTnVsbCBpbnB1dCIsIDwlPW9iaiU+LCA8JT1mdW4lPiwgPCU9ZkFyZ3MlPik7DQogICAgICAgICAgICAgICAgcmV0dXJuIDwlPW9iaiU+Ow0KICAgICAgICAgICAgfWVsc2UgaWYodHlwZW9mKDwlPW9iaiU+KT09PSdzdHJpbmcnKXsNCiAgICAgICAgICAgICAgICBfaWQgPSB0aGlzLmhhc2hDb2RlKDwlPW9iaiU+KTsNCiAgICAgICAgICAgIH1lbHNlIGlmKHR5cGVvZig8JT1vYmolPls8JT1pZGYlPl0pIT09J3VuZGVmaW5lZCcgJiYgPCU9b2JqJT5bPCU9aWRmJT5dPT08JT1vYmolPls8JT1pZGYlPl0pew0KICAgICAgICAgICAgICAgIF9pZCA9IDwlPW9iaiU+WzwlPWlkZiU+XTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKF9pZCk9PT0ndW5kZWZpbmVkJyB8fCAhX2lkKXsNCiAgICAgICAgICAgICAgICBpZig8JT1vYmolPi5JZCAmJiA8JT1vYmolPi5JZD09PCU9b2JqJT4uSWQpew0KICAgICAgICAgICAgICAgICAgICBfaWQgPSA8JT1vYmolPi5JZDsNCiAgICAgICAgICAgICAgICB9ZWxzZSBpZih0aGlzLklkPT10aGlzLklkKXsNCiAgICAgICAgICAgICAgICAgICAgX2lkID0gdGhpcy5JZDsNCiAgICAgICAgICAgICAgICB9ZWxzZSBpZih0aGlzLlNldF9Pbil7DQogICAgICAgICAgICAgICAgICAgIF9pZCA9IHRoaXMuX3RvSGFzaCg8JT1mQXJncyU+LCB7b25seVVuaXF1ZTogdHJ1ZX0sIDwlPWZ1biU+KTsNCiAgICAgICAgICAgICAgICAgICAgPCU9bG9nKGAke21OYW1lfS51blJlY3Vyc2VgKSU+InRoaXMuaGFzaGVkX2lkIiwgX2lkLCA8JT1mdW4lPiwgPCU9ZkFyZ3MlPik7DQogICAgICAgICAgICAgICAgfWVsc2UgaWYob2JqLlNldF9Pbil7DQogICAgICAgICAgICAgICAgICAgIF9pZCA9IG9iai5fdG9IYXNoKDwlPWZBcmdzJT4sIHtvbmx5VW5pcXVlOiB0cnVlfSwgPCU9ZnVuJT4pOw0KICAgICAgICAgICAgICAgICAgICA8JT1sb2coYCR7bU5hbWV9LnVuUmVjdXJzZWApJT4ib2JqLmhhc2hlZF9pZCIsIF9pZCwgPCU9ZnVuJT4sIDwlPWZBcmdzJT4pOw0KICAgICAgICAgICAgICAgIH1lbHNlIGlmKDwlPW9iaiU+LkVudGl0eUNsYXNzKXsNCiAgICAgICAgICAgICAgICAgICAgX2lkID0gPCU9b2JqJT4uRW50aXR5Q2xhc3MuSWQgfHwgPCU9b2JqJT4uRW50aXR5Q2xhc3MuTmFtZSB8fCB0aGlzLl90b0hhc2goPCU9ZkFyZ3MlPiwge2RlcHRoOiA8JWJEYW5nZXIoKSU+PzM6dW5kZWZpbmVkfSwgPCU9ZnVuJT4pOw0KICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICBfaWQgPSB0aGlzLkVudGl0eUNsYXNzLklkIHx8ICI8JT1jLklkJT4iIHx8IHRoaXMuX3RvSGFzaCg8JT1mQXJncyU+LCB7ZGVwdGg6IDwlYkRhbmdlcigpJT4/Mzp1bmRlZmluZWR9LCA8JT1mdW4lPikgfHwgIk5VTEwiOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAJPCU9c2NvcGUlPi5fdW5SZWN1cnNlID0gPCU9c2NvcGUlPi5fdW5SZWN1cnNlIHx8IHt9Ow0KICAgICAgICAJPCU9c2NvcGUlPi5fdW5SZWN1cnNlLjwlPW5OYW1lKGMpJT4gPSA8JT1zY29wZSU+Ll91blJlY3Vyc2UuPCU9bk5hbWUoYyklPiB8fCB7fTsNCiAgICAgICAgCTwlPXNjb3BlJT4uX3VuUmVjdXJzZS48JT1uTmFtZShjKSU+WzwlPWZ1biU+XSA9IDwlPXNjb3BlJT4uX3VuUmVjdXJzZS48JT1uTmFtZShjKSU+WzwlPWZ1biU+XSB8fCB7fTsNCiAgICAgICAgCTwlPXNjb3BlJT4uX3VuUmVjdXJzZS48JT1uTmFtZShjKSU+WzwlPWZ1biU+XVtfaWRdID0gPCU9c2NvcGUlPi5fdW5SZWN1cnNlLjwlPW5OYW1lKGMpJT5bPCU9ZnVuJT5dW19pZF0gfHwge307DQogICAgICAgIAkNCiAgICAgICAgICAgIHYgPSA8JT1zY29wZSU+Ll91blJlY3Vyc2UuPCU9bk5hbWUoYyklPls8JT1mdW4lPl1bX2lkXTsNCg0KICAgICAgICAgICAgaWYodiAmJiBNYXRoLmFicyhuZXcgRGF0ZSgpLmdldFRpbWUoKSAtIHYuZGF0ZSkgPCAoMTAwMCo8JT12YWxpZGl0eSU+KSl7DQogICAgICAgICAgICAgICAgaWYoKDwlYkRhbmdlcigpJT4/bmV3IERhdGUoMCk6KHRoaXMuU2V0X09uIHx8IG5ldyBEYXRlKDApKSkuZ2V0VGltZSgpID4gdi5kYXRlKXsNCiAgICAgICAgICAgICAgICAgICAgPCU9bG9nKGAke21OYW1lfS51blJlY3Vyc2VgKSU+YFNwYXduaW5nIGluICR7PCU9ZnVuJT59YCwgX2lkLCA8JT1mdW4lPiwgPCU9b2JqJT4sIHYucmV1c2VkLCA8JT12YWxpZGl0eSU+KTsNCiAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgPCU9bG9nKGAke21OYW1lfS51blJlY3Vyc2VgKSU+IlNlbGVjdGVkIGhhc2giLCBfaWQsIDwlPWZ1biU+LCA8JT1vYmolPiwgdi5yZXVzZWQsIDwlPXZhbGlkaXR5JT4pOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICA8JT1zUmV0JT4NCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgPCU9bG9nKGAke21OYW1lfS51blJlY3Vyc2VgKSU+IlB1c2hpbmcgaGFzaCIsIF9pZCwgPCU9ZnVuJT4sIDwlPW9iaiU+KTsNCiAgICAgICAgCXYgPSA8JT1zY29wZSU+Ll91blJlY3Vyc2UuPCU9bk5hbWUoYyklPls8JT1mdW4lPl1bX2lkXSA9IHsNCiAgICAgICAgICAgICAgICBkYXRlOiBuZXcgRGF0ZSgpLmdldFRpbWUoKSwNCiAgICAgICAgICAgICAgICBhcmdzOiBKU09OLnN0cmluZ2lmeSg8JT1mQXJncyU+KSwNCiAgICAgICAgICAgICAgICBvYmo6IDwlPW9iaiU+LA0KICAgICAgICAgICAgICAgIHJldXNlZDogMCwNCiAgICAgICAgICAgICAgICBwYXRoOiAnJywNCiAgICAgICAgICAgICAgICBfaWQsDQogICAgICAgICAgICB9Ow0KICAgICAgICAgICAgDQogICAgICAgICAgICA8JS8qZXhwZXJpbWVudGFsOiByZW1vdmUgdGhpcyBpZiBhbGwgZ29lcyB3cm9uZyovJT4NCiAgICAgICAgICAgIDwlPXNSZXQlPg0KICAgIAl9Y2F0Y2godW5SZWNFeCl7DQogICAgCSAgICBpZighdW5SZWNFeC50b1N0cmluZygpLmluZGV4T2YoJ1JhbmdlRXJyb3I6ICcpKXsNCiAgICAJICAgICAgICA8JT1zY29wZSU+LnVuUmVjdXJzZUFib3J0WzwlPWZ1biU+XSA9IHRydWU7DQogICAgCSAgICB9DQogICAgCSAgICA8JT1lcnJvcihgJHttTmFtZX0udW5SZWN1cnNlYCklPjwlPW9iaiU+LCA8JT1mdW4lPiwgPCU9ZkFyZ3MlPiwgdW5SZWNFeC50b1N0cmluZygpKTsNCiAgICAJICAgIDwlPXNSZXQlPg0KICAgIAl9DQo8JQ0KfTsNCg0KbGV0IGludm9rZVJ1bGUgPSByID0+IHsNCiU+DQphd2FpdCAoYXN5bmMgKGF1dGhPYmopID0+IHsNCiAgICBsZXQgX3J1bGUgPSA8JT1fRnJFTUQuX3RvSlMociklPjsNCiAgICBkZWxldGUgX3J1bGUuU2NyaXB0Ow0KICAgIC8vIHJ1bGVSdW5zLnB1c2goX3J1bGUpOw0KICAgIHRyeXsNCiAgICAgICAgPCU9ci5TY3JpcHQlPg0KICAgIH1jYXRjaChleCl7DQogICAgICAgIF9ydWxlLkV4Y2VwdGlvbiA9IGV4Ow0KICAgIH0NCn0pKGF1dGhPYmopOw0KPCUNCn0NCiU+DQoNCmNsYXNzIDwlPW5OYW1lKGMpJT4gew0KICAgIDwlPW1OYW1lPSdjb25zdHJ1Y3RvciclPihpZCwgdG9vbCkgew0KICAgICAgICAvL3N1cGVyKGlkLCB0b29sKTsNCg0KICAgICAgICB0aGlzLlNjb3BlID0gIjwlPXNjb3BlJT4iOw0KICAgICAgICB0aGlzLkRlYnVnID0gPCU9X0ZyRU1ELl90b0pTKGMuRGVidWcpJT47DQogICAgICAgIHRoaXMuQ29uZmlnID0gPCU9X0ZyRU1ELl90b0pTKGMuQ29uZmlnKSU+Ow0KICAgICAgICB0aGlzLlRlc3QgPSA8JT1fRnJFTUQuX3RvSlMoYy5UZXN0KSU+Ow0KICAgICAgICB0aGlzLlRvb2xzID0gPCU9X0ZyRU1ELl90b0pTKGMuVG9vbHMpJT47DQogICAgICAgIHRoaXMuTWFwcGluZ3MgPSA8JT1fRnJFTUQuX3RvSlMoYy5NYXBwaW5ncyklPjsNCg0KICAgICAgICAvLyBhdm9pZCBzdXBlciwga2VlcCB0aGlzIGhlcmUNCiAgICAgICAgdGhpcy5fX0lEID0gdGhpcy5fX0lEIHx8IHt9Ow0KICAgICAgICB0aGlzLlRvb2wgPSB0b29sOw0KICAgICAgICB0aGlzLklkID0gaWQ7DQoNCiAgICAgICAgdGhpcy5WYWx1ZUVudGl0aWVzID0gW107DQoNCiAgICAgICAgdGhpcy5EYXRlID0gbnVsbDsNCg0KICAgICAgICB0aGlzLmNsZWFyX1RISVMoKTsNCiAgICAgICAgdGhpcy5FbnRpdHlWYWx1ZXMgPSBbXTsNCjwlIGMuRW50aXR5QXR0cmlidXRlcy5maWx0ZXIoZWEgPT4gIWVhLkVudGl0eU1ldGhvZCkuZm9yRWFjaChlYSA9PiB7JT4NCiAgICAgICAgdGhpcy5FbnRpdHlWYWx1ZXMucHVzaCh7DQogICAgICAgICAgICBFbnRpdHlBdHRyaWJ1dGU6IHsNCjwlIGlmKE51bWJlcihlYS5JZCkpeyU+DQogICAgICAgICAgICAgICAgSWQ6ICI8JT1lYS5JZCU+IiwNCjwlIH0lPg0KICAgICAgICAgICAgICAgIE5hbWU6ICI8JT1lYS5OYW1lJT4iLA0KICAgICAgICAgICAgICAgIE9QRVJBVE9SUzoge05hbWU6ICI9In0sDQogICAgICAgICAgICAgICAgRW50aXR5Q2xhc3M6IHRoaXMuRW50aXR5Q2xhc3MsDQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgT1BFUkFUT1JTOiB7fQ0KICAgICAgICB9KTsNCiAgICAgICAgdGhpcy5jbGVhcl88JT1uTmFtZShlYSklPigpOw0KPCUgfSk7ICU+DQoNCjwlIGMuVHlwZWRBdHRyaWJ1dGVzLmZpbHRlcih0YSA9PiAhdGEuRW50aXR5TWV0aG9kKS5mb3JFYWNoKHRhID0+IHslPg0KICAgICAgICB0aGlzLmNsZWFyXzwlPW5OYW1lKHRhKSU+XzwlPXRhLkVudGl0eUNsYXNzLlBsdXJhbC5yZXBsYWNlKC8gL2csICdfJyklPigpOw0KPCUgfSk7ICU+DQogICAgfQ0KICAgIA0KICAgIDwlPW1OYW1lPSdfZGVmYXVsdHMnJT4oKXsNCjwlX2RlZmF1bHRzKCklPg0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICB9DQogICAgDQogICAgPCU9bU5hbWU9J2dldCBFbnRpdHlDbGFzcyclPigpew0KICAgICAgICBsZXQgZWMgPSB7DQo8JSBpZihOdW1iZXIoYy5JZCkpeyU+DQogICAgICAgICAgICBJZDogIjwlPWMuSWQlPiIsDQo8JSB9JT4NCiAgICAgICAgICAgIE5hbWU6ICI8JT1jLk5hbWUlPiIsDQogICAgICAgICAgICBPUEVSQVRPUlM6IHtOYW1lOiAiPSJ9LA0KICAgICAgICB9Ow0KDQo8JSBpZihjLkVudGl0eU1vZHVsZWlkKXsgJT4NCiAgICAgICAgZWMuRW50aXR5TW9kdWxlID0gew0KICAgICAgICAgICAgSWQ6IDwlPWMuRW50aXR5TW9kdWxlaWQlPg0KICAgICAgICB9Ow0KPCUgfSU+DQoNCiAgICAgICAgLy8gdGhhdCdzIHdoeSB3ZSBuZWVkIGl0IGFzIGEgZ2V0dGVyDQogICAgICAgIGlmKCFOdW1iZXIoZWMuSWQpICYmIDwlPXNjb3BlJT4uRW50aXR5Q2xhc3Nlcyl7DQogICAgICAgICAgICBsZXQgY2lkID0gPCU9c2NvcGUlPi5FbnRpdHlDbGFzc2VzLmZpbmQoYyA9PiBOdW1iZXIoYy5JZCkgJiYgYy5OYW1lPT1lYy5OYW1lKTsNCiAgICAgICAgICAgIGlmKGNpZCkgZWMuSWQgPSBjaWQuSWQ7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIGVjOw0KICAgIH0NCg0KCTwlPW1OYW1lPSdnZXQgSWQnJT4oKSB7DQoJCXJldHVybiB0aGlzLl9fSURbdGhpcy5Ub29sLm5hbWVdIHx8IHRoaXMuX3V1aWQoKSB8fCAoPCU9X0ZyRU1ELl90b0pTKF9maWxlVG9vbHMpJT4uaW5kZXhPZih0aGlzLlRvb2wudHlwZS5uYW1lKT49MD90aGlzLl91dWlkKG51bGwsIG51bGwsIHRydWUpOnRoaXMuX3V1aWQoKSk7DQoJfQ0KDQoJPCU9bU5hbWU9J3NldCBJZCclPihpZCkgew0KCQlpZiAoIXRoaXMuVG9vbCkgew0KCQkJPCU9bG9nKCklPiJFbXB0eSBUb29sIiwgdGhpcy5Ub29scy5sZW5ndGgsIDwlPXNjb3BlJT4uVG9vbHMubGVuZ3RoKTsNCgkJCXJldHVybjsNCgkJfQ0KCQlpZih0aGlzLl9fSURbdGhpcy5Ub29sLm5hbWVdPT1pZCkgcmV0dXJuOw0KCQl0aGlzLl9fSURbdGhpcy5Ub29sLm5hbWVdID0gaWQ7DQoJfQ0KDQogICAgPCU9bU5hbWU9J2dldCBUb29sJyU+KCkgew0KICAgICAgICBpZih0eXBlb2YodGhpcy5fX1Rvb2wpIT09J3VuZGVmaW5lZCcpIHJldHVybiB0aGlzLl9fVG9vbDsNCiAgICAgICAgbGV0IG5vVG9vbCA9IHsNCiAgICAgICAgICAgIG5hbWU6ICcnLA0KICAgICAgICAgICAgdHlwZToge25hbWU6ICcnfSwNCiAgICAgICAgfTsNCiAgICAgICAgaWYodHlwZW9mKDwlPXNjb3BlJT4uVG9vbHMpIT09InVuZGVmaW5lZCIgJiYgIUFycmF5LmlzQXJyYXkoPCU9c2NvcGUlPi5Ub29scykpew0KICAgICAgICAgICAgPCU9ZXJyb3IoKSU+IjwlPXNjb3BlJT4uVG9vbHMgaXMgbm90IGFuIGFycmF5OiAiLCA8JT1zY29wZSU+LlRvb2xzKTsNCiAgICAgICAgICAgIHJldHVybiBub1Rvb2w7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIGxldCByZXQgPSAoPCU9c2NvcGUlPi5fX2xhc3RUb29sP1s8JT1zY29wZSU+Ll9fbGFzdFRvb2xdOltdKS5jb25jYXQodGhpcy5Ub29scykuZmluZCh0ID0+ICg8JT1zY29wZSU+LlRvb2xzIHx8IFtdKS5maW5kKF90ID0+IHQgPT0gX3QubmFtZSB8fCB0Lm5hbWU9PV90Lm5hbWUpKTsNCiAgICAgICAgaWYodHlwZW9mKHJldCkhPT0ndW5kZWZpbmVkJykgcmV0ID0gKDwlPXNjb3BlJT4uVG9vbHMgfHwgW10pLmZpbmQodCA9PiB0Lm5hbWU9PXJldCB8fCB0Lm5hbWU9PXJldC5uYW1lKTsNCiAgICAgICAgaWYodHlwZW9mKHJldCk9PT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICBpZih0aGlzLlRvb2xzLmxlbmd0aCl7DQogICAgICAgICAgICAgICAgcmV0ID0gew0KICAgICAgICAgICAgICAgICAgICBuYW1lOiB0aGlzLlRvb2xzWzBdLA0KICAgICAgICAgICAgICAgICAgICB0eXBlOiB7DQogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiB0aGlzLlRvb2xzWzBdDQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgfWVsc2UgcmV0ID0gbm9Ub29sOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiByZXQ7DQogICAgfQ0KDQogICAgPCU9bU5hbWU9J3NldCBUb29sJyU+KHRvb2wpIHsNCiAgICAgICAgaWYgKHR5cGVvZih0b29sKT09PSd1bmRlZmluZWQnKSByZXR1cm47DQogICAgICAgIGlmKHR5cGVvZih0b29sKT09PSJzdHJpbmciKXsNCiAgICAgICAgICAgIHRvb2wgPSB7bmFtZTogdG9vbH07DQogICAgICAgIH0NCiAgICAgICAgaWYodG9vbC5FbnRpdHlDbGFzcyl7DQogICAgICAgICAgICB0b29sID0gdG9vbC5fdG9Eb2N1bWVudCgpOw0KICAgICAgICB9DQogICAgICAgIGlmKHR5cGVvZih0b29sLm5hbWUpPT09J3VuZGVmaW5lZCcgJiYgdHlwZW9mKHRvb2wudHlwZS5uYW1lKT09PSd1bmRlZmluZWQnKSByZXR1cm47DQogICAgICAgIHRvb2wudHlwZSA9IHRvb2wudHlwZSB8fCB7bmFtZTogdG9vbC5uYW1lfTsNCiAgICAgICAgDQogICAgICAgIGlmKCF0b29sLnR5cGUgJiYgIXRvb2wubmFtZSl7DQogICAgICAgICAgICA8JT13YXJuKCklPiJFbXB0eSBUb29sIG9iamVjdCIpOw0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQoNCiAgICAgICAgbGV0IHQgPSAoPCU9c2NvcGUlPi5Ub29scyB8fCBbXSkuZmlsdGVyKHQgPT4gdC5uYW1lICYmIHQudHlwZSkuZmluZCh0ID0+ICh0Lm5hbWUgPT0gdG9vbC5uYW1lKSB8fCAodC50eXBlLm5hbWUgPT0gdG9vbC50eXBlLm5hbWUpKTsNCiAgICAgICAgaWYgKCF0KSB7DQogICAgICAgICAgICA8JT1sb2coKSU+Im5vIG1hdGNoaW5nIHRvb2wiLCB0b29sLCA8JT1zY29wZSU+LlRvb2xzKTsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgPCU9c2NvcGUlPi5fX2xhc3RUb29sID0gdGhpcy5fX1Rvb2wgPSB0Ow0KICAgICAgICANCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgfQ0KDQogICAgPCU9bU5hbWU9J1RISVMnJT4odiwgY28pew0KICAgICAgICBpZih0eXBlb2Yodik9PT0ndW5kZWZpbmVkJykgcmV0dXJuIHRoaXMuX1RISVM7DQogICAgICAgIGlmKCF2KSByZXR1cm4gdGhpczsNCiAgICAgICAgdiA9IEFycmF5LmlzQXJyYXkodik/djpbdl07DQogICAgICAgIHRoaXMuX1RISVMgPSB2LmZpbHRlcihfdiA9PiB0eXBlb2YoX3YpPT09J29iamVjdCcgJiYgX3YuRW50aXR5Q2xhc3MgJiYgX3YuRW50aXR5Q2xhc3MuTmFtZT09dGhpcy5FbnRpdHlDbGFzcy5OYW1lICYmIF92LlNjb3BlPT10aGlzLlNjb3BlKTsNCiAgICAgICAgaWYgKGNvKSB0aGlzLl9USElTX2Nvb3AgPSBjbzsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgfQ0KICAgIA0KICAgIDwlPW1OYW1lPSdjbGVhcl9USElTJyU+KCkgew0KICAgICAgICB0aGlzLl9USElTID0gW107DQogICAgICAgIHRoaXMuX1RISVNfY29vcCA9ICcnOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICB9DQogICAgDQo8JSBjLkVudGl0eUF0dHJpYnV0ZXMuZmlsdGVyKGVhID0+ICFlYS5FbnRpdHlNZXRob2QpLmZvckVhY2goZWEgPT4geyU+DQogICAgLyoqIHN0YXJ0OiBzZXR0ZXJzIGFuZCBnZXR0ZXJzIGZvciA8JT1lYS5OYW1lJT4gKiovDQogICAgPCU9bU5hbWU9bk5hbWUoZWEpJT4odiwgY28sIGlkKSB7DQogICAgICAgIGlmIChjbykgdGhpcy5fPCU9bk5hbWUoZWEpJT5fY29vcCA9IGNvOw0KDQogICAgICAgIHZhciBldiA9IHRoaXMuRW50aXR5VmFsdWUoIjwlPWVhLk5hbWUlPiIpOw0KICAgICAgICBpZiAoIWV2KXsNCiAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKGlkKSBldi5JZCA9IGlkOw0KDQogICAgICAgIGlmICh0eXBlb2YodikhPT0ndW5kZWZpbmVkJykgew0KICAgICAgICAgICAgLy8gdmFsdWVzIHdlcmUgZ2l2ZW4sIHRoZXJlZm9yZSBhIHNldHRlcg0KDQogICAgPCUgaWYoZWEuSXNBcnJheSl7JT4NCiAgICAgICAgICAgIHYgPSBBcnJheS5pc0FycmF5KHYpP3Y6W3ZdOw0KICAgICAgICAgICAgdiA9IHYubWFwKF92ID0+IHsNCiAgICA8JSB9ZWxzZXslPg0KICAgICAgICAgICAgdiA9IChfdiA9PiB7DQogICAgPCUgfSU+DQoNCiAgICA8JSBpZihlYS5Jc0RhdGUpeyU+DQogICAgICAgICAgICAgICAgX3YgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX3YpID09PSAnW29iamVjdCBEYXRlXSc/X3Y6KG5ldyBEYXRlKF92KSk7DQogICAgICAgICAgICAgICAgaWYoaXNOYU4oX3YuZ2V0VGltZSgpKSkgX3YgPSBudWxsOw0KICAgIDwlIH0lPg0KICAgIDwlIGlmKGVhLklzQm9vbCl7JT4NCiAgICAgICAgICAgICAgICBfdiA9IFsidHJ1ZSIsICIxIiwgInllcyIsIHRydWUsIDFdLmluY2x1ZGVzKF92KTsNCiAgICA8JSB9JT4NCiAgICA8JSBpZihlYS5Jc0ludCB8fCBlYS5Jc0xvbmcgfHwgZWEuSXNGbG9hdCl7JT4NCiAgICAgICAgICAgICAgICBpZihpc05hTihfdikpIF92ID0gMDsNCiAgICA8JSB9JT4NCiAgICA8JSBpZihlYS5Jc1RleHQpeyU+DQogICAgICAgICAgICAgICAgaWYodHlwZW9mKF92KT09PSdvYmplY3QnKSBfdiA9IEpTT04uc3RyaW5naWZ5KF92KTsNCiAgICA8JSB9JT4NCg0KICAgIDwlIGlmKGVhLkVudGl0eVR5cGUpeyU+DQogICAgICAgICAgICAgICAgaWYoX3YgJiYgIV92LkVudGl0eUNsYXNzKXsNCiAgICAgICAgICAgICAgICAgICAgPCU9bG9nKCklPiJ1c2luZyBfdG9Eb2N1bWVudCBmb3IgaW52YWxpZCBzZXR0ZXIgdmFsdWUiLCBfdik7DQogICAgICAgICAgICAgICAgICAgIF92ID0gbmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKGVhLkVudGl0eVR5cGUsIHRydWUpJT4oKS5fZnJvbURvY3VtZW50KF92KTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICBpZihfdiAmJiBfdi5FbnRpdHlDbGFzcy5JZCE9PSc8JT1lYS5FbnRpdHlUeXBlLklkJT4nICYmIF92LkVudGl0eUNsYXNzLk5hbWUhPT0nPCU9ZWEuRW50aXR5VHlwZS5OYW1lJT4nKXsNCiAgICAgICAgICAgICAgICAgICAgPCU9d2FybigpJT4iSW52YWxpZCBTZXR0ZXIgdmFsdWUiLCBfdiwgIjwlPWVhLkVudGl0eVR5cGUuSWQlPiIsIF92LkVudGl0eUNsYXNzLk5hbWUsICI8JT1lYS5FbnRpdHlUeXBlLk5hbWUlPiIpOw0KICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICBfdiA9ICgoX3YgJiYgIXRoaXMuSWQpID8gX3YudG9FbnRpdHlPYmplY3QoKSA6IF92KTsNCiAgICAgICAgICAgICAgICB9DQogICAgPCUgfSU+DQoNCiAgICAgICAgICAgICAgICByZXR1cm4gX3Y7DQogICAgPCUgaWYoZWEuSXNBcnJheSl7JT4NCiAgICAgICAgICAgIH0pOw0KICAgIDwlIH1lbHNleyU+DQogICAgICAgICAgICB9KSh2KTsNCiAgICA8JSB9JT4NCiAgICANCiAgICA8JSBpZihlYS5FbnRpdHlUeXBlKXslPg0KICAgICAgICAgICAgZGVsZXRlIGV2Lk9iamVjdFZhbHVlaWQ7DQogICAgICAgICAgICBldi5PYmplY3RWYWx1ZSA9IHY7DQogICAgPCUgfWVsc2V7JT4NCiAgICAgICAgICAgIGV2LjwlPV9GckVNRC5fYXR0cihlYSklPlZhbHVlID0gdjsNCiAgICA8JSB9JT4NCg0KICAgICAgICAgICAgaWYodHJ1ZSB8fCB0aGlzLl88JT1uTmFtZShlYSklPiE9dil7DQogICAgICAgICAgICAgICAgdGhpcy5fPCU9bk5hbWUoZWEpJT5fc2V0ID0gPCU9U2V0X09uJT47IC8vIGEgY2hhbmdlIGluIHZhbHVlDQogICAgPCUgaWYoZWEuRW50aXR5VHlwZSl7JT4NCiAgICAgICAgICAgICAgICA8JT1sb2coKSU+IlNldCBhZnRlciIsIHRoaXMuXzwlPW5OYW1lKGVhKSU+P3RoaXMuXzwlPW5OYW1lKGVhKSU+LlNldF9PbjpudWxsLCB2P3YuU2V0X09uOm51bGwpOw0KICAgICAgICAgICAgICAgIC8qaWYodikgdGhpcy5fPCU9bk5hbWUoZWEpJT5fc2V0ID0gdi5TZXRfT247Ki8NCiAgICA8JSB9JT4NCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgdGhpcy5fPCU9bk5hbWUoZWEpJT4gPSB2Ow0KICAgICAgICAgICAgaWYgKGNvKSBldi5PUEVSQVRPUlMuPCU9X0ZyRU1ELl9hdHRyKGVhKSU+VmFsdWUgPSBjbzsNCg0KICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICByZXR1cm4gdGhpcy5pMThuKGV2LCA8JXZhbHVlT2YoZWEuVmFsdWUpJT4gfHwgdGhpcy5fPCU9bk5hbWUoZWEpJT4pOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgPCU9bU5hbWU9J2NsZWFyXycrbk5hbWUoZWEpJT4oKSB7DQogICAgICAgIGxldCByZXQgPSB0aGlzLl88JT1uTmFtZShlYSklPjsNCiAgICAgICAgLyoNCiAgICAgICAgdGhpcy5fPCU9bk5hbWUoZWEpJT5fc2V0ID0gbnVsbDsNCiAgICAgICAgdGhpcy5fPCU9bk5hbWUoZWEpJT4gPSBudWxsOw0KICAgICAgICB0aGlzLl88JT1uTmFtZShlYSklPl9jb29wID0gIiI7DQogICAgICAgICovDQogICAgICAgIA0KICAgICAgICBkZWxldGUgdGhpcy5fPCU9bk5hbWUoZWEpJT5fc2V0Ow0KICAgICAgICBkZWxldGUgdGhpcy5fPCU9bk5hbWUoZWEpJT47DQogICAgICAgIGRlbGV0ZSB0aGlzLl88JT1uTmFtZShlYSklPl9jb29wOw0KICAgICAgICByZXR1cm4gcmV0Ow0KICAgIH0NCg0KICAgIC8qKiBlbmQ6IHNldHRlcnMgYW5kIGdldHRlcnMgZm9yIDwlPWVhLk5hbWUlPiAqKi8NCjwlIH0pOyAlPg0KPCUgYy5UeXBlZEF0dHJpYnV0ZXMuZmlsdGVyKHRhID0+ICF0YS5FbnRpdHlNZXRob2QpLmZvckVhY2godGEgPT4geyBsZXQgdGFOYW1lID0gdGEuRW50aXR5Q2xhc3MuUGx1cmFsLnJlcGxhY2UoLyAvZywgJ18nKTslPg0KICAgIC8qKiBzdGFydDogc2V0dGVycyBhbmQgZ2V0dGVycyBmb3IgPCU9dGEuTmFtZSU+XzwlPXRhTmFtZSU+ICoqLw0KICAgIDwlPW1OYW1lPW5OYW1lKHRhKSsnXycrdGFOYW1lJT4odiwgY28sIGJDbGVhcikgew0KICAgICAgICBpZih0eXBlb2Yodik9PT0idW5kZWZpbmVkIikgcmV0dXJuIHRoaXMuXzwlPW5OYW1lKHRhKSU+XzwlPXRhTmFtZSU+Ow0KICAgICAgICANCiAgICAgICAgaWYodiAmJiB2LnRvRW50aXR5T2JqZWN0ICYmIHYuRW50aXR5Q2xhc3MuSWQhPT0nPCU9dGEuRW50aXR5Q2xhc3MuSWQlPicgJiYgdi5FbnRpdHlDbGFzcy5OYW1lIT09JzwlPXRhLkVudGl0eUNsYXNzLk5hbWUlPicpIHJldHVybiB0aGlzOw0KICAgICAgICANCiAgICAgICAgdiA9IEFycmF5LmlzQXJyYXkodik/djpbdl07DQogICAgICAgIA0KICAgICAgICB2ID0gdi5maWx0ZXIoX3YgPT4gIXYgfHwgX3YuXzwlPW5OYW1lKHRhKSU+X3NldCkuY29uY2F0KHYuZmlsdGVyKF92ID0+IF92ICYmICFfdi5fPCU9bk5hbWUodGEpJT5fc2V0KS5tYXAoX3YgPT4gew0KICAgICAgICAgICAgaWYoIV92LmNvbnN0cnVjdG9yKXsNCiAgICAgICAgICAgICAgICA8JT13YXJuKCklPiI8JT1uTmFtZSh0YSklPiBoYXMgbm8gY29uc3RydWN0b3IiLCBfdik7DQogICAgICAgICAgICB9ZWxzZSBpZihfdi5jb25zdHJ1Y3Rvci5uYW1lPT0iT2JqZWN0Iil7DQogICAgICAgICAgICAgICAgX3YgPSBuZXcgPCU9c2NvcGUlPi48JT1uTmFtZSh0YS5FbnRpdHlDbGFzcywgdHJ1ZSklPigpLl9mcm9tRG9jdW1lbnQoX3YpDQogICAgICAgICAgICAgICAgX3YuPCU9bk5hbWUodGEpJT4odGhpcyk7DQogICAgICAgICAgICAgICAgcmV0dXJuIF92Ow0KICAgICAgICAgICAgfWVsc2UgaWYoX3YuY29uc3RydWN0b3IubmFtZSE9IjwlPW5OYW1lKHRhLkVudGl0eUNsYXNzKSU+Iil7DQogICAgICAgICAgICAgICAgPCU9d2FybigpJT4iPCU9bk5hbWUodGEpJT4gbm90IHZhbGlkIiwgX3YsIF92LmNvbnN0cnVjdG9yLm5hbWUsICI8JT1uTmFtZSh0YS5FbnRpdHlDbGFzcyklPiIpOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgX3YuPCU9bk5hbWUodGEpJT4odGhpcyk7DQogICAgICAgICAgICAgICAgcmV0dXJuIF92Ow0KICAgICAgICAgICAgfQ0KICAgICAgICB9KS5maWx0ZXIoX3YgPT4gX3YpKTsNCiAgICAgICAgDQogICAgICAgIGlmKGJDbGVhcikgdGhpcy5jbGVhcl88JT1uTmFtZSh0YSklPl88JT10YU5hbWUlPigpOw0KICAgICAgICB0aGlzLl88JT1uTmFtZSh0YSklPl88JT10YU5hbWUlPi5wdXNoKC4uLnYpOw0KICAgICAgICB0aGlzLl88JT1uTmFtZSh0YSklPl88JT10YU5hbWUlPl9zZXQgPSA8JT1TZXRfT24lPjsNCiAgICAgICAgaWYgKGNvKSB0aGlzLl88JT1uTmFtZSh0YSklPl88JT10YU5hbWUlPl9jb29wID0gY287DQoNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgfQ0KICAgIGNsZWFyXzwlPW5OYW1lKHRhKSU+XzwlPXRhTmFtZSU+KCkgew0KICAgICAgICBsZXQgcmV0ID0gdGhpcy5fPCU9bk5hbWUodGEpJT5fPCU9dGFOYW1lJT47DQoNCiAgICAgICAgdGhpcy5fPCU9bk5hbWUodGEpJT5fPCU9dGFOYW1lJT5fc2V0ID0gbnVsbDsNCiAgICAgICAgdGhpcy5fPCU9bk5hbWUodGEpJT5fPCU9dGFOYW1lJT4gPSBuZXcgQXJyYXkoKTsNCiAgICAgICAgdGhpcy5fPCU9bk5hbWUodGEpJT5fPCU9dGFOYW1lJT5fY29vcCA9IG51bGw7DQogICAgICAgIHJldHVybiByZXQ7DQogICAgfQ0KICAgIC8qKiBlbmQ6IHNldHRlcnMgYW5kIGdldHRlcnMgZm9yIDwlPW5OYW1lKHRhKSU+XzwlPXRhTmFtZSU+ICoqLw0KDQo8JSB9KSAlPg0KPCUgYy5FbnRpdHlGaWVsZHMuZm9yRWFjaChlZiA9PiB7JT4NCiAgICAvKiogc3RhcnQ6IGdldHRlcnMgZm9yIDwlPWVmLk5hbWUlPiAqKi8NCiAgICA8JT1tTmFtZT0nZ2V0ICcrbk5hbWUoZWYpJT4oKXsNCiAgICAgICAgcmV0dXJuIDwldmFsdWVPZihlZi5WYWx1ZSklPjsNCiAgICB9DQogICAgLyoqIGVuZDogZ2V0dGVycyBmb3IgPCU9ZWYuTmFtZSU+ICoqLw0KPCUgfSklPg0KDQogICAgPCU9bU5hbWU9J2xvZyclPihjbGFzc05hbWUsIG9iaiwgbSwgdHlwZSwgbGV2ZWwsIC4uLm1zZyl7DQogICAgICAgIGNsYXNzTmFtZSA9IGNsYXNzTmFtZSB8fCAiPCU9bk5hbWUoYyklPiI7DQogICAgICAgIHR5cGUgPSB0eXBlIHx8ICJFbnRpdHlPYmplY3QiOw0KICAgICAgICANCjwlIGlmKG1haW5DbGFzcygpIT1jKXslPg0KICAgICAgICByZXR1cm4gbmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKG1haW5DbGFzcygpLCB0cnVlKSU+KCkuPCU9bU5hbWUlPihjbGFzc05hbWUsIG9iaiwgbSwgdHlwZSwgbGV2ZWwsIC4uLm1zZyk7DQo8JSB9ZWxzZXslPg0KICAgICAgICB0cnl7DQoJCQlsZXQgZGVidWcgPSB0aGlzLkRlYnVnOw0KCQkJbGV0IGxldmVscyA9IFsiaW5mbyIsICJ3YXJuIiwgImVycm9yIiwgImNyaXRpY2FsIl07DQoNCgkJCWRlYnVnID0gZGVidWcgfHwgT2JqZWN0LmZyb21FbnRyaWVzKG5ldyBNYXAobGV2ZWxzLm1hcChsID0+IFtsLCAnKiddKSkpOw0KDQoJCQlsZXQgZnVuY3Rpb25zID0gT2JqZWN0LmFzc2lnbih7fSwgLi4ubGV2ZWxzLm1hcChsID0+ICh7DQoJCQkJW2xdOiBkZWJ1Z1tsXSA/IGRlYnVnW2xdLnNwbGl0KCcsJykgOiBbXQ0KCQkJfSkpKTsNCg0KCQkJbGV0IGNzcyA9ICdiYWNrZ3JvdW5kOiAjMDBmZjk5OyBjb2xvcjogIzAwODAwMCc7DQoJCQlsZXQgZmcgPSAnXHgxYlszMm0nOw0KCQkJc3dpdGNoIChOdW1iZXIobGV2ZWwpKSB7DQoJCQkJY2FzZSAxOg0KCQkJCQljc3MgPSAnYmFja2dyb3VuZDogI2ZmZmYwMDsgY29sb3I6ICMwMDAwODAnOw0KCQkJCQlmZyA9ICdceDFiWzMzbSc7DQoJCQkJCWJyZWFrOw0KCQkJCWNhc2UgMjoNCgkJCQkJY3NzID0gJ2JhY2tncm91bmQ6ICNiMjIyMjI7IGNvbG9yOiAjZmZmZmZmJzsNCgkJCQkJZmcgPSAnXHgxYlszMW0nOw0KCQkJCQlicmVhazsNCgkJCQljYXNlIDM6DQoJCQkJCWNzcyA9ICdiYWNrZ3JvdW5kOiAjYjIyMjIyOyBjb2xvcjogI2ZmZmZmZic7DQoJCQkJCWZnID0gJ1x4MWJbMzFtW0NSSVRJQ0FMXSc7DQoJCQkJCWJyZWFrOw0KCQkJfQ0KDQoJCQlpZiAoZnVuY3Rpb25zW2xldmVsc1tOdW1iZXIobGV2ZWwpIHx8IDBdXS5ldmVyeShmID0+ICFbJyouKicsICcqLicgKyBtLCAnKicsIG0sIGNsYXNzTmFtZSArICcuJyArIG0sIGNsYXNzTmFtZSArICcuKiddLmluY2x1ZGVzKGYpKSkgew0KCQkJCXJldHVybjsNCgkJCX0NCg0KCQkJaWYgKHR5cGVvZihnbG9iYWwpICE9PSAndW5kZWZpbmVkJykgew0KCQkJCWNvbnNvbGUubG9nKGZnICsgIiVzXHgxYlswbSIsIGAke3R5cGUgfHwgJzx0eXBlPid9OiAke3RoaXMuU2NvcGV9LiR7Y2xhc3NOYW1lfS4ke20gfHwgJzxtZXRob2Q+J30oKWAsIC4uLih0eXBlb2Yob2JqKSA9PT0gJ3VuZGVmaW5lZCcgPyAobXNnIHx8IFtdKSA6IFtvYmpdLmNvbmNhdChtc2cgfHwgW10pKSk7DQoJCQl9IGVsc2Ugew0KCQkJCWNvbnNvbGUubG9nKGAlYyAke3R5cGUgfHwgJzx0eXBlPid9OiAke3RoaXMuU2NvcGV9LiR7Y2xhc3NOYW1lfS4ke20gfHwgJzxtZXRob2Q+J30oKWAsIGNzcywgLi4uKHR5cGVvZihvYmopID09PSAndW5kZWZpbmVkJyA/IChtc2cgfHwgW10pIDogW29ial0uY29uY2F0KG1zZyB8fCBbXSkpKTsNCgkJCX0NCgkJfSBjYXRjaCAoZXgpIHsNCgkJCWNvbnNvbGUubG9nKGV4KTsNCgkJfQ0KPCUgfSU+DQoJfQ0KDQogICAgYXN5bmMgPCU9bU5hbWU9J3NldEludGVydmFsJyU+KGNsYXNzTmFtZSwgZnVuLCBtaW51dGVzLCAuLi5hcmdzKXsNCiAgICAgICAgY2xhc3NOYW1lID0gY2xhc3NOYW1lIHx8ICI8JT1uTmFtZShjKSU+IjsNCjwlIGlmKG1haW5DbGFzcygpIT1jKXslPg0KICAgICAgICByZXR1cm4gYXdhaXQgbmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKG1haW5DbGFzcygpLCB0cnVlKSU+KCkuPCU9bU5hbWUlPihjbGFzc05hbWUsIGZ1biwgbWludXRlcywgLi4uYXJncyk7DQo8JSB9ZWxzZXslPg0KCQl0cnkgew0KICAgIAkJbGV0IGZOYW1lID0gZnVuLnRvU3RyaW5nKCkuc3BsaXQoJyknKVswXSArICcpJzsNCiAgICAJCXRyeSB7DQogICAgCQkJLy8gdGhpcy5fX3RpbWUoYCR7Zk5hbWV9Lkxvb3BgKTsNCiAgICANCiAgICAJCQl0aGlzLl9fdGltZShgJHtmTmFtZX0uQ2FsbGApOw0KICAgIAkJCWxldCByZXQgPSBhd2FpdCBmdW4oLi4uYXJncy5jb25jYXQoW25ldyBEYXRlKCldKSk7DQogICAgDQogICAgCQkJPCU9bG9nKCklPmB7Q2FsbDogYCArIHRoaXMuX190aW1lKGAke2ZOYW1lfS5DYWxsYCkgKyBgLCBMb29wOiBgICsgdGhpcy5fX3RpbWUoYCR7Zk5hbWV9Lkxvb3BgKSArICd9Jyk7DQogICAgCQkJaWYgKCFyZXQpIHsNCiAgICAJCQkJPCU9bG9nKCklPmBkaWQgbm90IHJldHVybiB0cnVlLCBleGl0aW5nIGxvb3BlciAoJHt0aGlzLl9fdGltZShmTmFtZSl9KWApOw0KICAgIAkJCQlyZXR1cm47DQogICAgCQkJfQ0KICAgIAkJfSBjYXRjaCAoZXgpIHsNCiAgICAJCQk8JT1lcnJvcigpJT50aGlzLl9fdGltZShmTmFtZSksIGV4KTsNCiAgICAJCQljb25zb2xlLnRyYWNlKCk7DQogICAgCQl9DQogICAgCQlpZiAoIU51bWJlcihtaW51dGVzKSkgew0KICAgIAkJCTwlPWxvZygpJT50aGlzLl9fdGltZShmTmFtZSksICJOb3QgcmVwZWF0aW5nLiBNaW51dGVzIGlzICIgKyBtaW51dGVzKTsNCiAgICAJCQlyZXR1cm47DQogICAgCQl9DQogICAgCQlhd2FpdCBuZXcgUHJvbWlzZShyID0+IHNldFRpbWVvdXQociwgbWludXRlcyAqIDYwICogMTAwMCkpOw0KICAgIAkJYXdhaXQgdGhpcy48JT1tTmFtZSU+KG51bGwsIGZ1biwgbWludXRlcywgLi4uYXJncyk7DQoJCX0gY2F0Y2ggKGV4KSB7DQoJCQk8JT1lcnJvcigpJT5leCk7DQoJCX0NCjwlIH0lPg0KCX0NCg0KICAgIGFzeW5jIDwlPW1OYW1lPSdfZXhlY3V0ZSclPihjbGFzc05hbWUsIHNjb3BlLCBtLCBmUm91dGVyLCBmU2NyaXB0LCBvUGFyYW1zID0ge30sIHNvdXJjZSl7DQoJCXRoaXMuX190aW1lKGA8JT1zY29wZSU+LjwlPV9jTmFtZShtYWluQ2xhc3MoKSwgdHJ1ZSklPi4ke219YCk7DQoJCWNsYXNzTmFtZSA9IGNsYXNzTmFtZSB8fCAiPCU9bk5hbWUoYyklPiI7DQoJCXNjb3BlID0gc2NvcGUgfHwgPCU9c2NvcGUlPjsNCgkJc291cmNlID0gc291cmNlIHx8IHRoaXM7DQoNCjwlIGlmKG1haW5DbGFzcygpIT1jKXslPg0KICAgICAgICByZXR1cm4gYXdhaXQgbmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKG1haW5DbGFzcygpLCB0cnVlKSU+KCkuPCU9bU5hbWUlPihjbGFzc05hbWUsIHNjb3BlLCBtLCBmUm91dGVyLCBmU2NyaXB0LCBvUGFyYW1zLCB0aGlzKTsNCjwlIH1lbHNleyU+DQoJCS8vZGVsZXRlIDwlPXNjb3BlJT4uX3VuUmVjdXJzZTsgLy8gZXhwZXJpbWVudGFsDQoJCQ0KICAgIAlsZXQgX19iZWZvcmVSdWxlcyA9IG9QYXJhbXMuX19iZWZvcmVSdWxlcyB8fCBbXTsNCiAgICAJbGV0IF9fYWZ0ZXJSdWxlcyA9IG9QYXJhbXMuX19hZnRlclJ1bGVzIHx8IFtdOw0KICAgIAlkZWxldGUgb1BhcmFtcy5fX2JlZm9yZVJ1bGVzOw0KICAgIAlkZWxldGUgb1BhcmFtcy5fX2FmdGVyUnVsZXM7DQoNCiAgICAgICAgbGV0IGxvZyA9ICguLi5zKSA9PiA8JT1sb2coKSU+Y2xhc3NOYW1lLCBtLCAuLi5zKTsNCiAgICAgICAgbGV0IHdhcm4gPSAoLi4ucykgPT4gPCU9d2FybigpJT5jbGFzc05hbWUsIG0sIC4uLnMpOw0KICAgICAgICBsZXQgZXJyb3IgPSAoLi4ucykgPT4gPCU9ZXJyb3IoKSU+Y2xhc3NOYW1lLCBtLCAuLi5zKTsNCiAgICAgICAgICAgIA0KICAgICAgICB0cnl7DQogICAgCQlsZXQgbFBhcmFtcyA9IE9iamVjdC5lbnRyaWVzKG9QYXJhbXMpLm1hcCh4ID0+IHhbMV0pOw0KICAgIAkJbGV0IHJlc3VsdHMgPSBbXTsNCiAgICANCiAgICAJCWxldCBub2RlcyA9IFtdOw0KICAgIAkJDQogICAgCQlpZiAoPCU9bnNjb3BlJT4uX25vZGUgJiYgYXdhaXQgZlJvdXRlcig8JT1uc2NvcGUlPi5fbm9kZSwgbSkpIHsNCiAgICAJCQlub2Rlcy5wdXNoKDwlPW5zY29wZSU+Ll9ub2RlKTsNCiAgICAJCX0NCiAgICANCiAgICAJCWlmICg8JT1uc2NvcGUlPi5fbm9kZSAmJiA8JT1uc2NvcGUlPi5fbm9kZS5fcGFyZW50ICYmIGF3YWl0IGZSb3V0ZXIoPCU9bnNjb3BlJT4uX25vZGUucGFyZW50KCksIG0pKSB7DQogICAgCQkJbm9kZXMucHVzaCg8JT1uc2NvcGUlPi5fbm9kZS5wYXJlbnQoKSk7DQogICAgCQl9DQogICAgDQogICAgCQlmb3IgYXdhaXQgKGNvbnN0IGNuIG9mICg8JT1uc2NvcGUlPi5fbm9kZT88JT1uc2NvcGUlPi5fbm9kZS5wYXJlbnRfTm9kZXMoKTpbXSkpIHsNCiAgICAgICAgICAgICAgICBpZiAoYXdhaXQgZlJvdXRlcihjbiwgbSkpIHsNCiAgICAgICAgICAgICAgICAJbG9nKCdhZGRpbmcgY2hpbGQgbm9kZScsIGNuKTsNCiAgICAgICAgICAgICAgICAJbm9kZXMucHVzaChjbik7DQogICAgICAgICAgICAgICAgfQ0KICAgIAkJfQ0KICAgIA0KICAgIAkJLy8gcmVtb3ZlIGFueSBudWxscw0KICAgIAkJbm9kZXMgPSBub2Rlcy5mbGF0KCkuZmlsdGVyKG4gPT4gbik7DQogICAgCQkNCiAgICAJCWlmICghbm9kZXMubGVuZ3RoKSB7DQogICAgCQkJbm9kZXMucHVzaCg8JT1uc2NvcGUlPi5fbm9kZSk7DQogICAgCQl9DQogICAgCQkNCiAgICAJCW5vZGVzID0gdGhpcy5fdW5pcXVlKG5vZGVzLCAnX2NvZGUnKTsNCiAgICAJCWxvZygnbm9kZXMubGVuZ3RoJywgbm9kZXMubGVuZ3RoKTsNCg0KICAgIAkJZm9yIGF3YWl0IChjb25zdCBuIG9mIG5vZGVzKSB7DQogICAgCQkJbGV0IG5SZXQgPSBudWxsOw0KICAgIAkJCWxvZyhgJHttfSBAICR7bj8uY29kZSgpIHx8ICdMT0NBTCd9YCk7DQogICAgCQkJaWYgKCFuIHx8IHRoaXMuX3NhbWVFbnRpdHkoPCU9bnNjb3BlJT4uX25vZGUsIG4pKSB7DQogICAgCQkJCS8vIGxvY2FsIHNjcmlwdA0KICAgIAkJCQlmb3IgYXdhaXQgKGNvbnN0IHIgb2YgX19iZWZvcmVSdWxlcykgew0KICAgICAgICAgICAgICAgICAgICAgICAgPCV2YWx1ZU9mKCJyLlNjcmlwdCIpJT4NCiAgICAJCQkJCS8vYXdhaXQgdGhpcy5fU2NyaXB0KGNsYXNzTmFtZSwgci5TY3JpcHQsIG0sIHIuTmFtZSB8fCAnQmVmb3JlUnVsZScsIHNjb3BlLCBudWxsLCAuLi5sUGFyYW1zKTsNCiAgICAJCQkJfQ0KDQogICAgCQkJCW5SZXQgPSBhd2FpdCBmU2NyaXB0KCk7DQoNCiAgICAJCQkJZm9yIGF3YWl0IChjb25zdCByIG9mIF9fYWZ0ZXJSdWxlcykgew0KICAgICAgICAgICAgICAgICAgICAgICAgPCV2YWx1ZU9mKCJyLlNjcmlwdCIpJT4NCiAgICAJCQkJCS8vYXdhaXQgdGhpcy5fU2NyaXB0KGNsYXNzTmFtZSwgci5TY3JpcHQsIG0sIHIuTmFtZSB8fCAnQWZ0ZXJSdWxlJywgc2NvcGUsIG51bGwsIC4uLmxQYXJhbXMpOw0KICAgIAkJCQl9DQogICAgCQkJfSBlbHNlIHsNCiAgICAJCQkJblJldCA9IGF3YWl0IHNvdXJjZS5faW52b2tlTm9kZShuLCBtLCBvUGFyYW1zKTsNCiAgICAJCQl9DQogICAgDQogICAgCQkJcmVzdWx0cy5wdXNoKHsNCiAgICAJCQkJbm9kZTogbiwNCiAgICAJCQkJcmV0OiBuUmV0DQogICAgCQkJfSk7DQogICAgCQl9DQogICAgCQlsb2cocmVzdWx0cywgIl9leGVjdXRlIiwgJ1Jlc3VsdHMnKTsNCiAgICANCiAgICAJCWxldCBlcnJvcnMgPSByZXN1bHRzLmZpbHRlcihyID0+IHIucmV0ICYmIHIucmV0Ll9fZXhjZXB0aW9uKS5tYXAociA9PiAoew0KICAgIAkJCW5vZGU6IHIubm9kZSA/IHsNCiAgICAJCQkJY29kZTogci5ub2RlLmNvZGUoKSwNCiAgICAJCQkJYWRkcmVzczogci5ub2RlLmFkZHJlc3MoKQ0KICAgIAkJCX0gOiBudWxsLA0KICAgIAkJCV9fZXhjZXB0aW9uOiByLnJldC5fX2V4Y2VwdGlvbg0KICAgIAkJfSkpOw0KDQogICAgCQlpZiAoZXJyb3JzLmxlbmd0aCkgew0KICAgIAkJCXdhcm4oImVycm9ycyIsIGVycm9ycyk7DQogICAgCQl9DQogICAgDQogICAgCQlyZXR1cm4gcmVzdWx0czsNCiAgICAgICAgfWNhdGNoKGV4KXsNCiAgICAgICAgICAgIGVycm9yKGV4KTsNCiAgICAgICAgfQ0KPCUgfSU+DQoJfQ0KDQogICAgYXN5bmMgPCU9bU5hbWU9J19TY3JpcHQnJT4oY2xhc3NOYW1lLCBzY3JpcHQsIG0sIHR5cGUsIHNjb3BlLCBfbm9kZSwgLi4uc2ZBcmdzKXsNCiAgICAgICAgY2xhc3NOYW1lID0gY2xhc3NOYW1lIHx8ICI8JT1uTmFtZShjKSU+IjsNCiAgICAgICAgc2NvcGUgPSBzY29wZSB8fCA8JT1zY29wZSU+Ow0KICAgICAgICANCjwlIGlmKG1haW5DbGFzcygpIT1jKXslPg0KICAgICAgICByZXR1cm4gYXdhaXQgbmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKG1haW5DbGFzcygpLCB0cnVlKSU+KCkuPCU9bU5hbWUlPihjbGFzc05hbWUsIHNjcmlwdCwgbSwgdHlwZSwgc2NvcGUsIF9ub2RlLCAuLi5zZkFyZ3MpOw0KPCUgfWVsc2V7JT4NCiAgICAJaWYgKHR5cGVvZihzY3JpcHQpID09PSAndW5kZWZpbmVkJykgcmV0dXJuOw0KICAgIAkNCiAgICAgICAgdHJ5ew0KICAgIAkJaWYgKHR5cGVvZihzY3JpcHQpID09PSAnc3RyaW5nJykgc2NyaXB0ID0gdGhpcy5ydW5TY3JpcHQoYCgpID0+IHske3NjcmlwdH19YCk7DQogICAgDQogICAgCQlsZXQgcmV0ID0gbnVsbDsNCiAgICAJCWlmICh0eXBlb2Yoc2NyaXB0KSA9PT0gJ2Z1bmN0aW9uJykgew0KICAgIAkJCXJldCA9IGF3YWl0IHNjcmlwdCgpOw0KICAgIAkJfQ0KICAgIA0KICAgIAkJcmV0dXJuIHJldDsNCiAgICAgICAgfWNhdGNoKGV4KXsNCiAgICAgICAgICAgIDwlPXdhcm4oKSU+Y2xhc3NOYW1lLCBtLCB0eXBlLCBzY3JpcHQsIGV4KTsNCiAgICAgICAgfQ0KPCUgfSU+DQoJfQ0KDQogICAgPCU9bU5hbWU9J19zYW1lRW50aXR5JyU+KC4uLmFyRW50aXRpZXMpew0KICAgICAgICBpZihhckVudGl0aWVzLmxlbmd0aD09MCkgcmV0dXJuIGZhbHNlOw0KICAgICAgICBpZihhckVudGl0aWVzLmxlbmd0aD09MSkgYXJFbnRpdGllcy5wdXNoKHRoaXMpOw0KPCUgaWYobWFpbkNsYXNzKCkhPWMpeyU+DQogICAgICAgIHJldHVybiBuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUobWFpbkNsYXNzKCksIHRydWUpJT4oKS48JT1tTmFtZSU+KC4uLmFyRW50aXRpZXMpOw0KPCUgfWVsc2V7JT4NCiAgICAgICAgdHJ5ew0KICAgICAgICAgICAgcmV0dXJuIGFyRW50aXRpZXMuc2xpY2UoMSkuZXZlcnkoZSA9PiB7DQogICAgICAgICAgICAgICAgbGV0IHYgPSBhckVudGl0aWVzWzBdOw0KICAgICAgICAgICAgICAgIGxldCBuZWdUZXN0ID0gew0KICAgICAgICAgICAgICAgICAgICB2TnVsbDogdj09bnVsbCwNCiAgICAgICAgICAgICAgICAgICAgZU51bGw6IGU9PW51bGwsDQogICAgICAgICAgICAgICAgICAgIHZPYmplY3Q6IHR5cGVvZih2KSE9PSdvYmplY3QnLA0KICAgICAgICAgICAgICAgICAgICBlT2JqZWN0OiB0eXBlb2YoZSkhPT0nb2JqZWN0JywNCiAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgIDwlPWxvZygpJT4xLCBuZWdUZXN0KTsNCiAgICAgICAgICAgICAgICBpZihPYmplY3Qua2V5cyhPYmplY3QuYXNzaWduKHt9LCAuLi5PYmplY3Qua2V5cyhuZWdUZXN0KS5maWx0ZXIoayA9PiBuZWdUZXN0W2tdKS5tYXAoayA9PiAoe3YsIGUsIFtrXTogdHJ1ZX0pKSkpLmxlbmd0aCkgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgICAgIC8vIHBhc3NlZCBpbml0aWFsIGNvbnNpc3RlbmN5IGNoZWNrDQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgaWYodj09ZSkgcmV0dXJuIHRydWU7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgbmVnVGVzdCA9IHsNCiAgICAgICAgICAgICAgICAgICAgZXZDb25zdHI6IHYuY29uc3RydWN0b3IubmFtZSE9ZS5jb25zdHJ1Y3Rvci5uYW1lLA0KICAgICAgICAgICAgICAgICAgICBlRW50aXR5OiAhZS5FbnRpdHlDbGFzcywNCiAgICAgICAgICAgICAgICAgICAgdkVudGl0eTogIXYuRW50aXR5Q2xhc3MsDQogICAgICAgICAgICAgICAgICAgIGV2RW50aXR5TmFtZXM6IHR5cGVvZihlLkVudGl0eUNsYXNzLk5hbWUpIT09J3VuZGVmaW5lZCcgJiYgZS5FbnRpdHlDbGFzcy5OYW1lIT12LkVudGl0eUNsYXNzLk5hbWUsDQogICAgICAgICAgICAgICAgICAgIGV2RW50aXR5SWRzOiB0eXBlb2YoZS5FbnRpdHlDbGFzcy5JZCkhPT0ndW5kZWZpbmVkJyAmJiBlLkVudGl0eUNsYXNzLklkIT12LkVudGl0eUNsYXNzLklkLA0KICAgICAgICAgICAgICAgICAgICBldklEczogdi5JZD09di5JZCAmJiBlLklkPT1lLklkICYmIHYuSWQhPWUuSWQsDQogICAgICAgICAgICAgICAgICAgIGV2SGFzaDogdi5fdG9IYXNoKG51bGwsIHtvbmx5VW5pcXVlOiB0cnVlfSwgJzwlPW1OYW1lJT4nKSE9ZS5fdG9IYXNoKG51bGwsIHtvbmx5VW5pcXVlOiB0cnVlfSwgJzwlPW1OYW1lJT4nKSwNCiAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgIDwlPWxvZygpJT4yLCBuZWdUZXN0KTsNCiAgICAgICAgICAgICAgICBuZWdUZXN0ID0gT2JqZWN0LmFzc2lnbih7fSwgLi4uT2JqZWN0LmtleXMobmVnVGVzdCkuZmlsdGVyKGsgPT4gbmVnVGVzdFtrXSkubWFwKGsgPT4gKHt2LCBlLCBba106IHRydWV9KSkpOw0KICAgICAgICAgICAgICAgIGlmKCFPYmplY3Qua2V5cyhuZWdUZXN0KS5sZW5ndGgpIHJldHVybiB0cnVlOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIDwlPWxvZygpJT4zLCBuZWdUZXN0KTsNCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfWNhdGNoKGV4KXsNCiAgICAgICAgICAgIDwlPWVycm9yKCklPmV4KTsNCiAgICAgICAgfQ0KPCUgfSU+DQogICAgfQ0KDQogICAgPCU9bU5hbWU9J2dldCBTZXRfT24nJT4oKSB7DQogICAgICAgIGxldCByZXQgPSBuZXcgRGF0ZShNYXRoLm1heCgNCjwlIGMuRW50aXR5QXR0cmlidXRlcy5maWx0ZXIoZWEgPT4gIWVhLkVudGl0eU1ldGhvZCkuZm9yRWFjaChlYSA9PiB7JT4NCiAgICAgICAgICAgIHRoaXMuXzwlPW5OYW1lKGVhKSU+X3NldCB8fCBudWxsLA0KPCUgfSklPiAgICAgICAgICAgIA0KPCUgYy5UeXBlZEF0dHJpYnV0ZXMuZm9yRWFjaCh0YSA9PiB7IGxldCB0YU5hbWUgPSBuTmFtZSh0YSkgKyAnXycgKyB0YS5FbnRpdHlDbGFzcy5QbHVyYWwucmVwbGFjZSgvIC9nLCAnXycpOyU+DQogICAgICAgICAgICB0aGlzLl88JT10YU5hbWUlPl9zZXQgfHwgbnVsbCwNCjwlIH0pJT4NCiAgICAgICAgKSk7DQogICAgICAgIA0KICAgICAgICA8JT1sb2coKSU+InJldCIsIHJldCk7DQogICAgICAgIA0KICAgICAgICBpZighcmV0IHx8ICEocmV0IGluc3RhbmNlb2YgRGF0ZSAmJiAhaXNOYU4ocmV0KSkpIHJldHVybiB1bmRlZmluZWQ7DQogICAgICAgIHJldHVybiByZXQ7DQogICAgfQ0KICAgIA0KICAgIDwlPW1OYW1lPSdnZXQgU2V0X0NvdW50JyU+KCkgew0KICAgICAgICByZXR1cm4gWw0KPCUgYy5FbnRpdHlBdHRyaWJ1dGVzLmZpbHRlcihlYSA9PiAhZWEuRW50aXR5TWV0aG9kKS5mb3JFYWNoKGVhID0+IHslPg0KICAgICAgICAgICAgdGhpcy5fPCU9bk5hbWUoZWEpJT5fc2V0LA0KPCUgfSklPiAgICAgICAgICAgIA0KPCUgYy5UeXBlZEF0dHJpYnV0ZXMuZm9yRWFjaCh0YSA9PiB7IGxldCB0YU5hbWUgPSBuTmFtZSh0YSkgKyAnXycgKyB0YS5FbnRpdHlDbGFzcy5QbHVyYWwucmVwbGFjZSgvIC9nLCAnXycpOyU+DQogICAgICAgICAgICB0aGlzLl88JT10YU5hbWUlPl9zZXQsDQo8JSB9KSU+DQogICAgICAgIF0uZmlsdGVyKHMgPT4gcykubGVuZ3RoOw0KICAgIH0NCiAgICANCiAgICA8JT1tTmFtZT0nX2ZsYXR0ZW4nJT4oZGVwdGgpew0KICAgICAgICA8JT13YXJuKCklPiJERVBSRUNBVEVEIik7DQogICAgICAgIGxldCByZXQgPSB7fTsNCiAgICAgICAgaWYoIWRlcHRoKSByZXR1cm4gcmV0Ow0KPCUgYy5FbnRpdHlBdHRyaWJ1dGVzLmZpbHRlcihlYSA9PiAhZWEuRW50aXR5TWV0aG9kKS5mb3JFYWNoKGVhID0+IHslPg0KICAgICAgICByZXQuXzwlPW5OYW1lKGVhKSU+X3NldCA9IHRoaXMuXzwlPW5OYW1lKGVhKSU+X3NldDsNCiAgICAgICAgcmV0Ll88JT1uTmFtZShlYSklPl9jb29wID0gdGhpcy5fPCU9bk5hbWUoZWEpJT5fY29vcDsNCiAgICAgICAgcmV0LjwlPW5OYW1lKGVhKSU+ID0gdGhpcy48JT1uTmFtZShlYSklPigpP3RoaXMuPCU9bk5hbWUoZWEpJT4oKTwlaWYoZWEuRW50aXR5VHlwZSl7JT4uPCU9bU5hbWUlPihkZXB0aC0xKTwlfSU+OnRoaXMuPCU9bk5hbWUoZWEpJT4oKTsNCjwlIH0pJT4NCjwlIGMuVHlwZWRBdHRyaWJ1dGVzLmZvckVhY2godGEgPT4geyBsZXQgdGFOYW1lID0gbk5hbWUodGEpICsgJ18nICsgdGEuRW50aXR5Q2xhc3MuUGx1cmFsLnJlcGxhY2UoLyAvZywgJ18nKTslPg0KICAgICAgICByZXQuPCU9dGFOYW1lJT4gPSB0aGlzLjwlPXRhTmFtZSU+KCkubWFwKHQgPT4gdD90LjwlPW1OYW1lJT4oZGVwdGgtMSk6dCk7DQo8JSB9KSU+DQogICAgICAgIHJldHVybiByZXQ7DQogICAgfQ0KICAgIA0KICAgIDwlPW1OYW1lPSdfdG9IYXNoJyU+KGFyZ3MsIG9wdGlvbnMsIGZTb3VyY2Upew0KICAgICAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTsNCiAgICAgICAgDQogICAgICAgIGxldCBvSGFzaCA9IHsNCiAgICAgICAgICAgIGNsYXNzOiAiPCU9bk5hbWUoYyklPiIsDQogICAgICAgICAgICBzb3VyY2U6IGZTb3VyY2UsDQogICAgICAgICAgICBhcmdzOiBhcmdzLA0KICAgICAgICAgICAgX3RoaXM6IHt9DQogICAgICAgIH07DQogICAgICAgIA0KICAgICAgICBpZighb3B0aW9ucy5ub1RoaXMgJiYgZlNvdXJjZSE9IjwlPW1OYW1lJT4iICYmICh0eXBlb2Yob3B0aW9ucy5kZXB0aCk9PT0ndW5kZWZpbmVkJyB8fCAtLW9wdGlvbnMuZGVwdGg+MCkpew0KICAgICAgICAgICAgdGhpcy5fX2V4cG9ydChvSGFzaC5fdGhpcywgew0KICAgICAgICAgICAgICAgIE9QRVJBVE9SUzogIW9wdGlvbnMubm9PcGVyYXRvcnMsDQogICAgICAgICAgICAgICAgX21hcDogb3B0aW9ucy5fbWFwLA0KICAgICAgICAgICAgICAgIFVuaXF1ZTogb3B0aW9ucy5vbmx5VW5pcXVlLA0KICAgICAgICAgICAgICAgIE51bGw6IHRydWUsDQogICAgICAgICAgICAgICAgSWQ6IChvYmosIGlkQ29kZSwgdikgPT4gb2JqW2lkQ29kZV0gPSB2LA0KPCUgYy5FbnRpdHlBdHRyaWJ1dGVzLmZpbHRlcihlYSA9PiAhZWEuRW50aXR5TWV0aG9kKS5mb3JFYWNoKGVhID0+IHslPg0KICAgICAgICAgICAgICAgIDwlPW5OYW1lKGVhKSU+OiAob2JqLCBlYUNvZGUsIHYpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgPCUgaWYoZWEuRW50aXR5VHlwZSl7JT5pZihvcHRpb25zLm5vVHlwZXMpIHJldHVybjs8JX0lPg0KICAgICAgICAgICAgICAgICAgICBvYmpbZWFDb2RlXSA9IDwlIGlmKGVhLkVudGl0eVR5cGUpeyU+dj92LjwlPW1OYW1lJT4obnVsbCwgb3B0aW9ucywgZlNvdXJjZSk6PCV9JT4oKG9wdGlvbnMub25seVVuaXF1ZSAmJiA8JXZhbHVlT2YoZWEuSXNVbmlxdWUpJT4pPyh2fHxudWxsKTp2KTsNCiAgICAgICAgICAgICAgICB9LA0KPCUgfSklPg0KPCUgYy5UeXBlZEF0dHJpYnV0ZXMuZm9yRWFjaCh0YSA9PiB7IGxldCB0YU5hbWUgPSBuTmFtZSh0YSkgKyAnXycgKyB0YS5FbnRpdHlDbGFzcy5QbHVyYWwucmVwbGFjZSgvIC9nLCAnXycpOyU+DQogICAgICAgICAgICAgICAgPCU9dGFOYW1lJT46IChvYmosIGVhQ29kZSwgdikgPT4gb2JqW2VhQ29kZV0gPSAodiB8fCBbXSkubWFwKF92ID0+IF92LjwlPW1OYW1lJT4obnVsbCwgb3B0aW9ucywgZlNvdXJjZSkpLA0KPCUgfSklPg0KPCUgYy5FbnRpdHlGaWVsZHMuZm9yRWFjaChlZiA9PiB7JT4NCiAgICAgICAgICAgICAgICBlZl88JT1uTmFtZShlZiklPjogKG9iaiwgZWZDb2RlLCB2KSA9PiBvYmpbZWZDb2RlXSA9IHYsDQo8JSB9KSU+DQogICAgICAgICAgICB9LCAiPCU9bU5hbWUlPiIpOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICBpZihvcHRpb25zLm5vQXJncykgb0hhc2ggPSBvSGFzaC5fdGhpczsNCiAgICAgICAgcmV0dXJuIG9wdGlvbnMubm9Db2RlP29IYXNoOnRoaXMuaGFzaENvZGUoSlNPTi5zdHJpbmdpZnkob0hhc2gpKTsNCiAgICB9DQoNCiAgICBhc3luYyA8JT1tTmFtZT0nX2F1dGhvcml6ZSclPih1c2VybmFtZSwgcGFzc3dvcmQsIGJTZXJ2ZXIpew0KPCUgaWYobWFpbkNsYXNzKCk9PWMpeyU+DQogICAgICAgIGlmKCF1c2VybmFtZSAmJiAhcGFzc3dvcmQgJiYgITwlPXNjb3BlJT4uX190b2tlbiAmJiB0aGlzLlRlc3RbJzwlPW1OYW1lJT4udXNlcm5hbWUnXSl7DQogICAgICAgICAgICB1c2VybmFtZSA9IHRoaXMuVGVzdFsnPCU9bU5hbWUlPi51c2VybmFtZSddOw0KICAgICAgICAgICAgcGFzc3dvcmQgPSB0aGlzLlRlc3RbJzwlPW1OYW1lJT4ucGFzc3dvcmQnXTsNCiAgICAgICAgfQ0KDQogICAgICAgIGlmKGJTZXJ2ZXIpew0KICAgICAgICAgICAgaWYodXNlcm5hbWUgJiYgITwlPXNjb3BlJT4uX3Rlc3RVc2VyICYmIHRoaXMuVGVzdFsnPCU9bU5hbWUlPi50ZXN0VXNlciddKXsNCiAgICAgICAgICAgICAgICA8JT1zY29wZSU+Ll90ZXN0VXNlciA9IGF3YWl0IG5ldyA8JT1zY29wZSU+LjwlPW5OYW1lKGMsIHRydWUpJT4oKS5fZnJvbURvY3VtZW50KHRoaXMuVGVzdFsnPCU9bU5hbWUlPi50ZXN0VXNlciddKS5hY3RpdmUodHJ1ZSkuZW5hYmxlZCh0cnVlKS51c2VybmFtZSh1c2VybmFtZSkucGFzc3dvcmQocGFzc3dvcmQpLnN0b3JlKCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBsZXQgcmV0ID0gYXdhaXQgdGhpcy51c2VybmFtZSh1c2VybmFtZSwgJz0nKS5wYXNzd29yZChwYXNzd29yZCwgJz0nKS5hY3RpdmUodHJ1ZSkuZW5hYmxlZCh0cnVlKS5maW5kKCk7DQogICAgICAgICAgICA8JT1sb2coKSU+IlNlcnZlcjogIiArIGJTZXJ2ZXIrIiwgT2JqOiIsIHJldCk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGlmKHJldCl7DQogICAgICAgICAgICAgICAgaWYodHlwZW9mKGpzb253ZWJ0b2tlbikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgICAgIHJldCA9IGpzb253ZWJ0b2tlbi5zaWduKHJldC5fdG9Eb2N1bWVudCgpLCB0aGlzLl9fY29uZmlnKCdzZWNyZXQnKSwgeyBleHBpcmVzSW46ICcxODAwcycgfSk7DQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIHJldCA9IHRoaXMuX2J0b2EoSlNPTi5zdHJpbmdpZnkocmV0Ll90b0RvY3VtZW50KCkpKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIHJldCA9IHsNCiAgICAgICAgICAgICAgICBhY2Nlc3NfdG9rZW46IHJldCwNCiAgICAgICAgICAgIH07DQogICAgICAgICAgICA8JT1sb2coKSU+IlNlcnZlcjogIiArIGJTZXJ2ZXIrIiwgdG9rZW46ICIsIHJldCk7DQogICAgICAgICAgICByZXR1cm4gcmV0Ow0KICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgIGxldCBjbGllbnRfaWQgPSB0aGlzLl9fY29uZmlnKCdjbGllbnRfaWQnKTsNCiAgICAgICAgICAgIGxldCBjbGllbnRfc2VjcmV0ID0gdGhpcy5fX2NvbmZpZygnc2VjcmV0Jyk7DQogICAgDQogICAgICAgICAgICBpZighdXNlcm5hbWUgJiYgIXBhc3N3b3JkICYmIDwlPXNjb3BlJT4uX190b2tlbil7DQogICAgICAgICAgICAgICAgPCU9bG9nKCklPiJObyB1c2VybmFtZS9wYXNzd29yZCBhbmQgdG9rZW4gYWxyZWFkeSBleGlzdHMiKTsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQoNCiAgICA8JWlmKF9jTmFtZSgnb0F1dGggVG9rZW4nKSl7JT4NCiAgICAgICAgICAgIGxldCBkYXRhID0gew0KICAgICAgICAgICAgICAgIGdyYW50X3R5cGU6ICdwYXNzd29yZCcsDQogICAgICAgICAgICAgICAgdXNlcm5hbWUsDQogICAgICAgICAgICAgICAgcGFzc3dvcmQsDQogICAgICAgICAgICAgICAgY2xpZW50X2lkLA0KICAgICAgICAgICAgICAgIGNsaWVudF9zZWNyZXQsDQogICAgICAgICAgICB9Ow0KICAgICAgICAgICAgDQogICAgICAgICAgICBsZXQgY29uZmlnID0gew0KICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsNCiAgICAgICAgICAgICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQnDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfTsNCiAgICAgICAgICAgIGlmKCF1c2VybmFtZSAmJiAhcGFzc3dvcmQgJiYgPCU9c2NvcGUlPi5fX3Rva2VuICYmIDwlPXNjb3BlJT4uX190b2tlbi5yZWZyZXNoX3Rva2VuKXsNCiAgICAgICAgICAgICAgICBkYXRhID0gew0KICAgICAgICAgICAgICAgICAgICBncmFudF90eXBlOiAicmVmcmVzaF90b2tlbiIsDQogICAgICAgICAgICAgICAgICAgIHJlZnJlc2hfdG9rZW46IDwlPXNjb3BlJT4uX190b2tlbi5yZWZyZXNoX3Rva2VuLA0KICAgICAgICAgICAgICAgICAgICBjbGllbnRfaWQsDQogICAgICAgICAgICAgICAgICAgIGNsaWVudF9zZWNyZXQsDQogICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICBjb25maWcuaGVhZGVycy5BdXRob3JpemF0aW9uID0gYCR7PCU9c2NvcGUlPi5fX3Rva2VuLnRva2VuX3R5cGV9ICR7PCU9c2NvcGUlPi5fX3Rva2VuLmFjY2Vzc190b2tlbn1gOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICBsZXQgcmV0ID0gYXdhaXQgYXhpb3MucG9zdChgaHR0cCR7PCU9bnNjb3BlJT4uX25vZGUucGFyZW50KCkuc2VjdXJlKCk/J3MnOicnfTovLyR7PCU9bnNjb3BlJT4uX25vZGUucGFyZW50KCkuYWRkcmVzcygpfTokezwlPW5zY29wZSU+Ll9ub2RlLnBhcmVudCgpLnBvcnQoKSB8fCAzMDAwfS9vYXV0aC90b2tlbmAsIE9iamVjdC5rZXlzKGRhdGEpLm1hcChrZXkgPT4ga2V5ICsgJz0nICsgZGF0YVtrZXldKS5qb2luKCcmJyksIGNvbmZpZyk7DQogICAgICAgICAgICBpZihyZXQuZGF0YS5hY2Nlc3NfdG9rZW4pew0KICAgICAgICAgICAgICAgIDwlPXNjb3BlJT4uX190b2tlbiA9IHJldC5kYXRhOw0KDQogICAgICAgICAgICAgICAgaWYoPCU9c2NvcGUlPi5fX3Rva2VuLnJlZnJlc2hfdG9rZW4pew0KICAgICAgICAgICAgICAgICAgICBpZihheGlvcy5pbnRlcmNlcHRvcnMucmVzcG9uc2UuY2xlYXIpIGF4aW9zLmludGVyY2VwdG9ycy5yZXNwb25zZS5jbGVhcigpOw0KICAgICAgICAgICAgICAgICAgICBheGlvcy5pbnRlcmNlcHRvcnMucmVzcG9uc2UudXNlKHJlc3BvbnNlID0+IHJlc3BvbnNlLCBhc3luYyBlcnJvciA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBvcmlnaW5hbFJlcXVlc3QgPSBlcnJvci5jb25maWc7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXJyb3IucmVzcG9uc2Uuc3RhdHVzID09PSA0MDEgJiYgIW9yaWdpbmFsUmVxdWVzdC5fcmV0cnkgJiYgb3JpZ2luYWxSZXF1ZXN0LmhlYWRlcnMuQXV0aG9yaXphdGlvbi5pbmRleE9mKDwlPXNjb3BlJT4uX190b2tlbi5hY2Nlc3NfdG9rZW4pPjApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcmlnaW5hbFJlcXVlc3QuX3JldHJ5ID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLl9hdXRob3JpemUoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcmlnaW5hbFJlcXVlc3QuaGVhZGVycy5BdXRob3JpemF0aW9uID0gJ0JlYXJlciAnICsgPCU9c2NvcGUlPi5fX3Rva2VuLmFjY2Vzc190b2tlbjsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYXhpb3Mob3JpZ2luYWxSZXF1ZXN0KTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChlcnJvcik7DQogICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICA8JSB9ZWxzZSBpZihhdXRoQ2xhc3MpeyU+DQogICAgCTwlPXNjb3BlJT4uX190b2tlbiA9IGF3YWl0IG5ldyA8JT1zY29wZSU+LjwlPW5OYW1lKGF1dGhDbGFzcyklPigpLnVzZXJuYW1lKHVzZXJuYW1lKS5wYXNzd29yZChwYXNzd29yZCkuPCU9bU5hbWUucmVwbGFjZSgnXycsICcnKSU+KCk7DQogICAgPCUgfWVsc2V7JT4NCiAgICAgICAgPCU9d2FybigpJT4iTm8gYXV0aG9yaXphdGlvbiBkZWZpbmVkIik7DQogICAgPCUgfSU+DQogICAgICAgIH0NCjwlIH1lbHNleyU+DQogICAgICAgIHJldHVybiBhd2FpdCBuZXcgPCU9c2NvcGUlPi48JT1uTmFtZShtYWluQ2xhc3MoKSklPigpLjwlPW1OYW1lJT4odXNlcm5hbWUsIHBhc3N3b3JkLCBiU2VydmVyKTsNCjwlfSU+DQogICAgfQ0KICAgIA0KPCUgaWYobWFpbkNsYXNzKCk9PWMpeyU+DQogICAgYXN5bmMgPCU9bU5hbWU9J19zZXJ2ZXInJT4ob3B0aW9ucz17fSkgew0KICAgICAgICB0cnl7DQogICAgICAgICAgICBpZihvcHRpb25zLmNsZWFyQ29uc29sZSkgY29uc29sZS5jbGVhcigpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBpZig8JT1zY29wZSU+Ll9fVG9vbHMpIDwlPXNjb3BlJT4uVG9vbHMgPSA8JT1zY29wZSU+Ll9fVG9vbHM7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZihnbG9iYWwpPT09J3VuZGVmaW5lZCcgJiYgdHlwZW9mKDwlPXNjb3BlJT4uaHJlZnMpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAJCWZvciBhd2FpdCAoY29uc3QgbCBvZiA8JT1zY29wZSU+LmhyZWZzKSB7DQogICAgICAgIAkJCWF3YWl0IHRoaXMucmVxdWlyZShsLmxpYiwgPCU9c2NvcGUlPi5ocmVmcywgYXN5bmMgX2wgPT4gew0KICAgIDwlIGlmKF9jTmFtZSgnU3RvcmVkU2NyaXB0JykpeyU+DQogICAgICAgICAgICAgICAgICAgIGlmKF9sLnNjcmlwdCAmJiA8JT1zY29wZSU+LlRvb2xzKSByZXR1cm4gYXdhaXQgbmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKCdTdG9yZWRTY3JpcHQnLCB0cnVlKSU+KCkuX2Zyb21Eb2N1bWVudChfbC5zY3JpcHQpLmxvYWRTY3JpcHQoKTsNCiAgICA8JSB9JT4NCiAgICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgbGV0IHNlY3VyZSA9IHRoaXMuX19jb25maWcoJ3NlY3VyZScpOw0KICAgICAgICAgICAgaWYodHlwZW9mKGdsb2JhbCkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgLy8gZ2xvYmFscw0KICAgICAgICAgICAgICAgIHZhciBnbG9iYWxNb2R1bGVzID0gew0KICAgICAgICAgICAgICAgICAgICBleHByZXNzOiAnZXhwcmVzcycsDQogICAgICAgICAgICAgICAgICAgIGh0dHBzOiAnaHR0cHMnLA0KICAgICAgICAgICAgICAgICAgICBodHRwOiAnaHR0cCcsDQogICAgICAgICAgICAgICAgICAgIHNlbGZzaWduZWQ6ICdzZWxmc2lnbmVkJywNCiAgICAgICAgICAgICAgICAgICAgdXRpbDogJ3V0aWwnLA0KICAgICAgICAgICAgICAgICAgICBjb3JzOiAnY29ycycsDQogICAgICAgICAgICAgICAgICAgIGJvZHlQYXJzZXI6ICdib2R5LXBhcnNlcicsDQogICAgICAgICAgICAgICAgICAgIGF4aW9zOiAnYXhpb3MnLA0KICAgICAgICAgICAgICAgICAgICAvL2NyeXB0bzogJ2NyeXB0bycsDQogICAgICAgICAgICAgICAgICAgIG9zOiAnb3MnLA0KICAgICAgICAgICAgICAgICAgICAvL2ptZXNwYXRoOiAnam1lc3BhdGgnLA0KICAgICAgICAgICAgICAgICAgICBqc29ucGF0aDogJ2pzb25wYXRoJywNCiAgICAgICAgICAgICAgICAgICAganNvbmF0YTogJ2pzb25hdGEnLA0KICAgICAgICAgICAgICAgICAgICBEb3RPYmplY3Q6ICdkb3Qtb2JqZWN0JywNCiAgICAgICAgICAgICAgICAgICAgbWFjaGluZWlkOiAnbm9kZS1tYWNoaW5lLWlkJywNCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIG1pbmltaXN0OiAnbWluaW1pc3QnLA0KICAgICAgICAgICAgICAgIA0KPCUgaWYoYy5Db25maWcgJiYgYy5Db25maWdbJ2dyYXBocWwnXSl7JT4NCiAgICAgICAgICAgICAgICAgICAgZ3JhcGhxbEhUVFA6ICdleHByZXNzLWdyYXBocWwnLA0KICAgICAgICAgICAgICAgICAgICBncmFwaHFsOiAnZ3JhcGhxbCcsDQogICAgICAgICAgICAgICAgICAgIHBsYXlncm91bmQ6ICdncmFwaHFsLXBsYXlncm91bmQtbWlkZGxld2FyZS1leHByZXNzJywNCjwlIH0lPg0KDQo8JSBpZihjLkNvbmZpZyAmJiBjLkNvbmZpZ1snZW1haWwuaG9zdCddKXslPg0KICAgICAgICAgICAgICAgICAgICBub2RlbWFpbGVyOiAnbm9kZW1haWxlcicsDQo8JSB9JT4NCg0KPCUgaWYoYy5Db25maWcgJiYgYy5Db25maWdbJ3RvdHAuc2VjcmV0J10peyU+DQogICAgICAgICAgICAgICAgICAgIG90cGF1dGg6ICdvdHBhdXRoJywNCjwlIH0lPg0KDQo8JSBpZihfY05hbWUoJ05vZGUnKSl7JT4NCiAgICAgICAgICAgICAgICAgICAgY2hpbGRfcHJvY2VzczogJ2NoaWxkX3Byb2Nlc3MnLA0KPCUgfSU+DQoNCjwlIGlmKF9jTmFtZSgnRXZlbnQnKSl7JT4NCiAgICAgICAgICAgICAgICAgICAgZXZlbnRzOiAnZXZlbnRzJywNCiAgICAgICAgICAgICAgICAgICAgc29ja2V0aW86ICdzb2NrZXQuaW8nLA0KICAgICAgICAgICAgICAgICAgICBtcXR0OiAnbXF0dCcsDQogICAgICAgICAgICAgICAgICAgIGFtcXBsaWI6ICdhbXFwbGliJywNCiAgICAgICAgICAgICAgICAgICAgcHJvdG9idWZqczogJ3Byb3RvYnVmanMnLA0KICAgICAgICAgICAgICAgICAgICBrYWZrYWpzOiAna2Fma2FqcycsDQo8JSB9JT4NCg0KPCUgaWYobWFpbkNsYXNzKFsnRmlsZVN5c3RlbSddKSl7JT4NCiAgICAgICAgICAgICAgICAgICAgZnM6ICdmcycsDQo8JSB9JT4NCg0KPCUgaWYobWFpbkNsYXNzKFsnTmVvNGonXSkpeyU+DQogICAgICAgICAgICAgICAgICAgIG5lbzRqOiAnbmVvNGotZHJpdmVyJywNCjwlIH0lPg0KDQo8JSBpZihfY05hbWUoJ29BdXRoIFRva2VuJykpeyU+DQogICAgICAgICAgICAgICAgICAgIE9BdXRoU2VydmVyOiAnZXhwcmVzcy1vYXV0aC1zZXJ2ZXInLA0KPCUgfWVsc2UgaWYoYXV0aENsYXNzKXslPg0KICAgICAgICAgICAgICAgICAgICBqc29ud2VidG9rZW46ICdqc29ud2VidG9rZW4nLA0KPCUgfSU+DQoNCg0KPCUgaWYobWFpbkNsYXNzKFsnU3FsREInXSkpeyU+DQogICAgICAgICAgICAgICAgICAgIHNxbGl0ZTogJ3NxbGl0ZTMnLA0KICAgICAgICAgICAgICAgICAgICBteXNxbDogJ215c3FsJywNCiAgICAgICAgICAgICAgICAgICAgcG9zdGdyZXM6ICdwZycsDQo8JSB9JT4NCjwlIGlmKG1haW5DbGFzcyhbJ1Nub3dGbGFrZSddKSl7JT4NCiAgICAgICAgICAgICAgICAgICAgc25vd2ZsYWtlOiAnc25vd2ZsYWtlLXNkaycsDQo8JSB9JT4NCjwlIGlmKG1haW5DbGFzcyhbJ01vbmdvREInXSkpeyU+DQogICAgICAgICAgICAgICAgICAgIG1vbmdvZGI6ICdtb25nb2RiJywNCjwlIH0lPg0KPCUgaWYobWFpbkNsYXNzKFsnUnhEQiddKSl7JT4NCiAgICAgICAgICAgICAgICAgICAgUnhEQjogJ3J4ZGInLA0KPCUgfSU+DQo8JSBpZihtYWluQ2xhc3MoWydFeGNlbCddKSl7JT4NCiAgICAgICAgICAgICAgICAgICAgWExTWDogJ3hsc3gnLA0KPCUgfSU+DQogICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIGxldCBtaXNzaW5nR2xvYmFsTW9kdWxlcyA9IE9iamVjdC5lbnRyaWVzKGdsb2JhbE1vZHVsZXMpLm1hcChlID0+IHsNCiAgICAgICAgICAgICAgICAgICAgdHJ5ew0KICAgICAgICAgICAgICAgICAgICAgICAgZ2xvYmFsW2VbMF1dID0gcmVxdWlyZShlWzFdKTsNCiAgICAgICAgICAgICAgICAgICAgfWNhdGNoKGV4KXsNCiAgICAgICAgICAgICAgICAgICAgICAgIDwlPXdhcm4oKSU+ZXgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVbMV07DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9KS5maWx0ZXIoZSA9PiBlKTsNCiAgICAgICAgICAgICAgICBpZihtaXNzaW5nR2xvYmFsTW9kdWxlcy5sZW5ndGgpIDwlPXdhcm4oKSU+Im5wbSBpbnN0YWxsICIgKyBtaXNzaW5nR2xvYmFsTW9kdWxlcy5qb2luKCcgJykpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgCQk8JT1sb2coKSU+YFN0YXJ0aW5nIFskezwlPW5zY29wZSU+Ll9ub2RlPzwlPW5zY29wZSU+Ll9ub2RlLmNvZGUoKTonJ31dLi4uYCk7DQoNCgkJCWlmIChvcHRpb25zLmxvYWRUb29scykgYXdhaXQgbmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKCdOb2RlJywgdHJ1ZSkgfHwgX2NOYW1lKCklPigpLl9sb2FkVG9vbHMob3B0aW9ucy5zYXZlVG9vbHMpOw0KDQo8JSBpZihfY05hbWUoJ05vZGUnKSl7ICAvKiBUb29scyBmaXJzdCBvciBOb2RlcyBmaXJzdD8/PyAqLyU+DQogICAgICAgICAgICBpZihvcHRpb25zLmluaXROb2RlKXsNCiAgICAgICAgICAgICAgICA8JT1uc2NvcGUlPi5fbm9kZSA9IGF3YWl0IG5ldyA8JT1zY29wZSU+LjwlPV9jTmFtZSgnTm9kZScsIHRydWUpJT4oKS5zZWN1cmUoc2VjdXJlKS5pbml0KHRoaXMuX19jb25maWcoJ2luaXQubG9vcCcsIDAuNSkpOw0KICAgICAgICAgICAgICAgIGlmKHR5cGVvZig8JT1uc2NvcGUlPi5fbm9kZSk9PT0ndW5kZWZpbmVkJykgcmV0dXJuIDwlPWVycm9yKCklPiI8JT1uc2NvcGUlPi5fbm9kZSBpcyB1bmRlZmluZWQhIik7DQogICAgICAgICAgICB9DQo8JSB9JT4NCg0KICAgIAkJaWYgKHR5cGVvZih0aGlzLmluaXQpPT09J2Z1bmN0aW9uJyAmJiBvcHRpb25zLmluaXRTZWxmKSB7DQogICAgCQkJYXdhaXQgdGhpcy5pbml0KCk7DQogICAgDQogICAgCQkJbGV0IHNxbFRvb2wgPSAoPCU9c2NvcGUlPi5Ub29scyB8fCBbXSkuZmluZCh0ID0+IHQuX19kbWxTdGF0ZW1lbnRzKTsNCiAgICAJCQlpZiAob3B0aW9ucy5jb3B5RE1MICYmIHNxbFRvb2wpIHsNCiAgICAJCQkJbGV0IGRtbHMgPSBzcWxUb29sLl9fZG1sU3RhdGVtZW50czsNCiAgICAJCQkJaWYgKHNxbFRvb2wudHlwZS5uYW1lID09ICdTcWxEQicpIGRtbHMgPSBbImRlbW8iXS5tYXAodCA9PiBgZHJvcCB0YWJsZSBpZiBleGlzdHMgJHt0fWApLmNvbmNhdChkbWxzKTsNCiAgICAJCQkJX0ZyRU1ELl9jb3B5VGV4dFRvQ2xpcGJvYXJkKGRtbHMuam9pbignO1xuJykpOw0KICAgIAkJCX0NCiAgICAJCX0NCg0KPCUgaWYoZmFsc2UgJiYgX2NOYW1lKCdOb2RlIFR5cGUnKSl7IC8qdG9kbzogcmVwbGFjZSB0aGlzIHdpdGggYW4gT1RBVXBkYXRlIGNvbmNlcHQgKi8lPg0KICAgICAgICAgICAgLy8gcmVmcmVzaCBzY3JpcHQNCiAgICAgICAgICAgIHRoaXMuc2V0SW50ZXJ2YWwobnVsbCwgYXN5bmMgKC8qdmVyc2lvbiovKSA9PiB7DQogICAgICAgICAgICAgICAgaWYodGhpcy5zcigpLmJMb2NhbCkgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIGxldCBzY3QgPSBuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUoJ05vZGUgVHlwZScsIHRydWUpJT4oKS5fZnJvbURvY3VtZW50KDwlPXNjb3BlJT4uX188JT1fY05hbWUoJ05vZGUgVHlwZScpJT4gfHwge25hbWU6ICdOb2RlSlMnfSk7DQogICAgICAgICAgICAgICAgbGV0IGN0ID0gYXdhaXQgc2N0LmZpbmQoKTsNCiAgICAgICAgICAgICAgICBpZighY3QgfHwgIWN0LmFjdGl2ZSgpIHx8ICFjdC5lbmFibGVkKCkpIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICBpZiggIXNjdC5kYXRlKCkgfHwgKChjdC5kYXRlKCkuZ2V0VGltZSgpIC0gc2N0LmRhdGUoKS5nZXRUaW1lKCkpLzEwMDApID4gNSApew0KICAgICAgICAgICAgICAgICAgICA8JT1sb2coKSU+YE5ld2VyIHZlcnNpb24gZm91bmQ6IFtkYXRlOiAke2N0LmRhdGUoKS50b0lTT1N0cmluZygpfSwgdG9vbDogJHtjdC5Ub29sLm5hbWV9XSwgc3RvcmluZy4uLmApOw0KICAgICAgICAgICAgICAgICAgICBpZih0eXBlb2YoZ2xvYmFsKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHdlIHdhbnQgdG8gc3RvcmUgdGhlIGNvbnRlbnQgZGlyZWN0bHkgdG8gdGhlIG5vZGVqcy5qcyBmaWxlDQogICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCBjdC5fZmlsZXN5c3RlbShjdC5jb2RlKCkgKyAnLmpzJywgdGhpcy5fYXRvYihjdC5yZW1hcmsoKSkpOw0KICAgICAgICAgICAgICAgICAgICB9ZWxzZSBpZih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeXsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZih3aW5kb3cuc2VsZiAhPT0gd2luZG93LnRvcCl7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwlPWxvZygpJT4iaUZyYW1lIHNob3VsZCBiZSByZXN0YXJ0ZWQuLi4iKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPCU9bG9nKCklPiJ3aW5kb3cgbG9jYXRpb24gcmVsb2FkaW5nLi4uIik7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vd2luZG93LmxvY2F0aW9uLnJlbG9hZCgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIH1jYXRjaChleCl7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPCU9ZXJyb3IoKSU+ImZyYW1lIGNoZWNrIiwgZXgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICAgICAgICAgIDwlPXNjb3BlJT4uX188JT1fY05hbWUoJ05vZGUgVHlwZScpJT4gPSBzY3QuZGF0ZShjdC5kYXRlKCkpLm5hbWUoY3QubmFtZSgpKS5jb2RlKGN0LmNvZGUoKSkuX3RvRG9jdW1lbnQoKTsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgICAgIH0sIDAuNSk7DQo8JSB9JT4NCiAgICAgICAgDQogICAgICAgICAgICBpZihvcHRpb25zLmxvYWRDb250ZW50ICYmIHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCcpIHdpbmRvdy5vbmhhc2hjaGFuZ2UgPSBhc3luYyAoKSA9PiBkb2N1bWVudC5ib2R5ID0gYXdhaXQgdGhpcy5fZXhwb3J0KHt0bXA6IGxvY2F0aW9uLmhhc2gucGFnZX0pOw0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKGdsb2JhbCkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgY29uc3QgYXBwID0gZXhwcmVzcygpOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIGFwcC51c2UoY29ycygpKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgYXBwLnVzZShleHByZXNzLnVybGVuY29kZWQoe2V4dGVuZGVkOiB0cnVlLCBsaW1pdDogJzUwbWInfSkpOw0KICAgICAgICAgICAgICAgIGFwcC51c2UoYm9keVBhcnNlci5qc29uKHsNCiAgICAgICAgICAgICAgICAgICAgdmVyaWZ5OiAocmVxLCByZXMsIGJ1ZikgPT4gcmVxLnJhd0JvZHkgPSBidWYNCiAgICAgICAgICAgICAgICB9KSk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGdsb2JhbC5hdXRoZW50aWNhdGUgPSBhc3luYyAocmVxLCByZXMsIG5leHQpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgY29uc3QgYXV0aEhlYWRlciA9IHJlcS5oZWFkZXJzWydhdXRob3JpemF0aW9uJ107DQogICAgICAgICAgICAgICAgICAgIGNvbnN0IHRva2VuID0gYXV0aEhlYWRlciAmJiBhdXRoSGVhZGVyLnNwbGl0KCcgJylbMV07DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBpZiAodG9rZW4gPT0gbnVsbCkgcmV0dXJuIHJlcy5zZW5kU3RhdHVzKDQwMSk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBqc29ud2VidG9rZW4udmVyaWZ5KHRva2VuLCB0aGlzLl9fY29uZmlnKCdzZWNyZXQnKSwgKGVyciwgb2JqKSA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXJyKSByZXR1cm4gcmVzLnNlbmRTdGF0dXMoNDAzKTsNCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICByZXEuX19hdXRob3JpemF0aW9uID0gb2JqOw0KICAgICAgICAgICAgICAgICAgICAgICAgbmV4dCgpOw0KICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICB9Ow0KICAgICAgICANCjwlIGlmKF9jTmFtZSgnb0F1dGggVG9rZW4nKSl7JT4NCiAgICAgICAgICAgICAgICBhcHAub2F1dGggPSBuZXcgT0F1dGhTZXJ2ZXIoew0KICAgICAgICAgICAgICAgICAgICBkZWJ1ZzogdHJ1ZSwNCiAgICAgICAgICAgICAgICAgICAgLy8gdXNlRXJyb3JIYW5kbGVyOiB0cnVlLA0KICAgICAgICAgICAgICAgICAgICAvLyBjb250aW51ZU1pZGRsZXdhcmU6IHRydWUsDQogICAgICAgICAgICAgICAgICAgIC8vIHJlcXVpcmVDbGllbnRBdXRoZW50aWNhdGlvbjogeyBwYXNzd29yZDogZmFsc2UgfSwNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIG1vZGVsOiAoKCkgPT4gKHsNCiAgICAgICAgICAgICAgICAJCWdldEFjY2Vzc1Rva2VuOiBiZWFyZXJUb2tlbiA9PiBuZXcgPCU9c2NvcGUlPi5PQXV0aF9Ub2tlbigpLmFjY2Vzc1Rva2VuKGJlYXJlclRva2VuKS5hY3RpdmUodHJ1ZSkuZW5hYmxlZCh0cnVlKS5maW5kKCkudGhlbih0ID0+IGFwcC5vYXV0aC5oYW5kbGVyKHQsICdnZXRBY2Nlc3NUb2tlbicpKS50aGVuKHQgPT4ge3QuYWNjZXNzVG9rZW5FeHBpcmVzQXQgPSBuZXcgRGF0ZSh0LmFjY2Vzc1Rva2VuRXhwaXJlc09uKTsgcmV0dXJuIHR9KSwNCiAgICAgICAgICAgICAgICAgICAgICAgIGdldENsaWVudDogKGNsaWVudElkLCBjbGllbnRTZWNyZXQpID0+IG5ldyA8JT1zY29wZSU+Lk9BdXRoX0NsaWVudCgpLmluaXQoKS5maW5hbGx5KCgpID0+IG5ldyA8JT1zY29wZSU+Lk9BdXRoX0NsaWVudCgpLmlkKGNsaWVudElkKS5zZWNyZXQoY2xpZW50U2VjcmV0KS5hY3RpdmUodHJ1ZSkuZW5hYmxlZCh0cnVlKS5maW5kKCkpLnRoZW4odCA9PiBhcHAub2F1dGguaGFuZGxlcih0LCAnZ2V0Q2xpZW50JykpLA0KICAgICAgICAgICAgICAgIAkgICAgZ2V0VXNlcjogKHVzZXJuYW1lLCBwYXNzd29yZCkgPT4gbmV3IDwlPXNjb3BlJT4uPCU9bk5hbWUoYXV0aENsYXNzKSU+KCkuYXV0aG9yaXplKHVzZXJuYW1lLCBwYXNzd29yZCkudGhlbih0ID0+IGFwcC5vYXV0aC5oYW5kbGVyKHQsICdnZXRVc2VyJykpLA0KICAgICAgICAgICAgICAgIAkgICAgc2F2ZVRva2VuOiAodG9rZW4sIGNsaWVudCwgdXNlcikgPT4gbmV3IDwlPXNjb3BlJT4uT0F1dGhfVG9rZW4oKS5fZnJvbURvY3VtZW50KHRva2VuKS5jbGllbnQobmV3IDwlPXNjb3BlJT4uT0F1dGhfQ2xpZW50KCkuX2Zyb21Eb2N1bWVudChjbGllbnQpKS51c2VyKHVzZXIpLmFjdGl2ZSh0cnVlKS5lbmFibGVkKHRydWUpLnN0b3JlKCkudGhlbih0ID0+IGFwcC5vYXV0aC5oYW5kbGVyKHQsICdzYXZlVG9rZW4nKSksDQogICAgICAgICAgICAgICAgCSAgICByZXZva2VUb2tlbjogdG9rZW4gPT4gbmV3IDwlPXNjb3BlJT4uT0F1dGhfVG9rZW4oKS5yZWZyZXNoVG9rZW4odG9rZW4ucmVmcmVzaFRva2VuKS5jbGllbnQobmV3IDwlPXNjb3BlJT4uT0F1dGhfQ2xpZW50KCkuaWQodG9rZW4uY2xpZW50LmlkKS5hY3RpdmUodHJ1ZSkuZW5hYmxlZCh0cnVlKSkuZmluZCgpLnRoZW4odCA9PiB0LmVuYWJsZWQoZmFsc2UpLmFjdGl2ZShmYWxzZSkuc3RvcmUoKSkudGhlbih0ID0+IGFwcC5vYXV0aC5oYW5kbGVyKHQsICdyZXZva2VUb2tlbicpKSwNCiAgICAgICAgICAgICAgICAJICAgIGdldFJlZnJlc2hUb2tlbjogcmVmcmVzaFRva2VuID0+IG5ldyA8JT1zY29wZSU+Lk9BdXRoX1Rva2VuKCkucmVmcmVzaFRva2VuKHJlZnJlc2hUb2tlbikuYWN0aXZlKHRydWUpLmVuYWJsZWQodHJ1ZSkuZmluZCgyLyp3aHkqLykudGhlbih0ID0+IHQuX3RvRG9jdW1lbnQoKSkudGhlbih0ID0+IHt0LnJlZnJlc2hUb2tlbkV4cGlyZXNBdCA9IG5ldyBEYXRlKHQucmVmcmVzaFRva2VuRXhwaXJlc09uKTsgcmV0dXJuIHR9KSwNCiAgICAgICAgCSAgICAgICAgfSkpKCkNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICBhcHAub2F1dGguaGFuZGxlciA9ICh0LCBtKSA9PiB7DQogICAgICAgICAgICAgICAgICAgIHRyeXsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmKG0pIDwlPWxvZygpJT5tLCB0Ll90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHQuX3RvRG9jdW1lbnQoKTsNCiAgICAgICAgICAgICAgICAgICAgfWNhdGNoKGV4KXsNCiAgICAgICAgICAgICAgICAgICAgICAgIDwlPXdhcm4oKSU+bSwgZXgudG9TdHJpbmcoKSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9Ow0KICAgICAgICANCiAgICAgICAgICAgICAgICBhcHAucG9zdCgnL29hdXRoL3Rva2VuJywgYXBwLm9hdXRoLnRva2VuKCkpOw0KICAgICAgICAgICAgICAgIGdsb2JhbC5hdXRoZW50aWNhdGUgPSBhcHAub2F1dGguYXV0aGVudGljYXRlKCk7DQo8JSB9JT4NCg0KPCUgYXJDbGFzc2VzLmZvckVhY2goX2MgPT4gX2MuRW50aXR5TWV0aG9kcy5maWx0ZXIobSA9PiBtLklzUHVibGljKS5mb3JFYWNoKG0gPT4geyU+DQogICAgICAgICAgICAgICAgYXBwLnBvc3QoJy9tZXRob2QvPCU9bk5hbWUoX2MpJT4vPCU9bk5hbWUobSklPicsIChyZXEsIHJlcykgPT4gdGhpcy5faW5ib3VuZENhbGwocmVxLCByZXMsICI8JT1uTmFtZShfYyklPiIsICI8JT1uTmFtZShtKSU+IikpOw0KICAgICAgICAgICAgICAgIGFwcC5nZXQoJy9tZXRob2QvPCU9bk5hbWUoX2MpJT4vPCU9bk5hbWUobSklPicsIChyZXEsIHJlcykgPT4gdGhpcy5faW5ib3VuZENhbGwocmVxLCByZXMsICI8JT1uTmFtZShfYyklPiIsICI8JT1uTmFtZShtKSU+IikpOw0KPCUgfSkpJT4NCg0KICAgICAgICAgICAgICAgIGFwcC5wb3N0KCcvbWV0aG9kLzpjbGFzcy86bWV0aG9kJywgZ2xvYmFsLmF1dGhlbnRpY2F0ZSwgKHJlcSwgcmVzKSA9PiB0aGlzLl9pbmJvdW5kQ2FsbChyZXEsIHJlcykpOw0KICAgICAgICAgICAgICAgIGFwcC5nZXQoJy9tZXRob2QvOmNsYXNzLzptZXRob2QnLCBnbG9iYWwuYXV0aGVudGljYXRlLCAocmVxLCByZXMpID0+IHRoaXMuX2luYm91bmRDYWxsKHJlcSwgcmVzKSk7DQogICAgICAgIA0KPCUgaWYoYy5Db25maWcgJiYgYy5Db25maWdbJ2dyYXBocWwnXSl7JT4NCiAgICAgICAgICAgICAgICBhcHAudXNlKCcvZ3JhcGhxbCcsIGdyYXBocWxIVFRQLmdyYXBocWxIVFRQKHsNCiAgICAgICAgICAgICAgICAgICAgc2NoZW1hOiBncmFwaHFsLmJ1aWxkU2NoZW1hKHRoaXMuX3RvR1FMU2NoZW1hKCkpLA0KICAgICAgICAgICAgICAgICAgICByb290VmFsdWU6IHRoaXMuX3FsUmVzb2x2ZXIoKSwNCiAgICAgICAgICAgICAgICAgICAgZ3JhcGhpcWw6IHRoaXMuX19jb25maWcoInBsYXlncm91bmQiKSwNCiAgICAgICAgICAgICAgICB9KSk7DQogICAgICAgICAgICAgICAgaWYodGhpcy5fX2NvbmZpZygicGxheWdyb3VuZCIpICYmIHR5cGVvZihwbGF5Z3JvdW5kKSE9PSJ1bmRlZmluZWQiKSBhcHAuZ2V0KCcvcGxheWdyb3VuZCcsIHBsYXlncm91bmQuZGVmYXVsdCh7IGVuZHBvaW50OiAnL2dyYXBocWwnIH0pKQ0KPCUgfSU+DQoNCiAgICAgICAgICAgICAgICBpZih0aGlzLl9fY29uZmlnKCdlbWFpbC5ob3N0Jykpew0KICAgICAgICAgICAgICAgICAgICA8JT1zY29wZSU+LnRyYW5zcG9ydGVyID0gbm9kZW1haWxlci5jcmVhdGVUcmFuc3BvcnQoew0KICAgICAgICAgICAgICAgICAgICAgICAgc2VydmljZTogdGhpcy5fX2NvbmZpZygnZW1haWwuaG9zdCcpLA0KICAgICAgICAgICAgICAgICAgICAgICAgYXV0aDogdGhpcy5fX2NvbmZpZygnZW1haWwudXNlcicpP3sNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VyOiB0aGlzLl9fY29uZmlnKCdlbWFpbC51c2VyJyksDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFzczogdGhpcy5fX2NvbmZpZygnZW1haWwucGFzc3dvcmQnKSwNCiAgICAgICAgICAgICAgICAgICAgICAgIH06dW5kZWZpbmVkLA0KICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIC8qDQogICAgICAgICAgICAgICAgICAgIGF3YWl0IDwlPXNjb3BlJT4udHJhbnNwb3J0ZXIuc2VuZE1haWwoew0KICAgICAgICAgICAgICAgICAgICAgICAgZnJvbTogdGhpcy5fX2NvbmZpZygnZW1haWwuc2VuZGVyJyksDQogICAgICAgICAgICAgICAgICAgICAgICB0bywNCiAgICAgICAgICAgICAgICAgICAgICAgIHN1YmplY3QsDQogICAgICAgICAgICAgICAgICAgICAgICB0ZXh0LA0KICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICAgICAgKi8NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgbGV0IHBvcnQgPSA8JT1uc2NvcGUlPi5fbm9kZT8oPCU9bnNjb3BlJT4uX25vZGUucG9ydCgpIHx8IDMwMDApOjMwMDA7DQogICAgICAgICAgICAgICAgbGV0IGFkZHJlc3MgPSAiMC4wLjAuMCI7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgbGV0IGxpc3RlbiA9IGFzeW5jICgpID0+IDwlPWxvZygpJT5gPCU9c2NvcGUlPlske3RoaXMuaXBBZGRyZXNzKCl9XSBsaXN0ZW5pbmcgYXQgaHR0cCR7c2VjdXJlPydzJzonJ306Ly8ke2FkZHJlc3N9OiR7cG9ydH1gKTsNCiAgICAgICAgICAgICAgICBpZihzZWN1cmUpew0KICAgICAgICAgICAgICAgICAgICBsZXQgY2VydCA9IG51bGw7DQogICAgICAgICAgICAgICAgICAgIGlmKHRoaXMuX19jb25maWcoJ3NlY3VyZS5wcml2YXRlJykpew0KICAgICAgICAgICAgICAgICAgICAgICAgY2VydCA9IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcml2YXRlOiAoYXdhaXQgZnMucHJvbWlzZXMucmVhZEZpbGUodGhpcy5fX2NvbmZpZygnc2VjdXJlLnByaXZhdGUnKSkpLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNlcnQ6IChhd2FpdCBmcy5wcm9taXNlcy5yZWFkRmlsZSh0aGlzLl9fY29uZmlnKCdzZWN1cmUuY2VydCcpKSksDQogICAgICAgICAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNlcnQgPSBzZWxmc2lnbmVkLmdlbmVyYXRlKFt7IG5hbWU6ICdjb21tb25OYW1lJywgdmFsdWU6ICduYW1tb3VyLmNvbScgfV0sIHsgZGF5czogMzY1IH0pOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGdsb2JhbC5leFNlcnZlciA9IGh0dHBzLmNyZWF0ZVNlcnZlcih7DQogICAgICAgICAgICAgICAgICAgICAgICBrZXk6IGNlcnQucHJpdmF0ZSwNCiAgICAgICAgICAgICAgICAgICAgICAgIGNlcnQ6IGNlcnQuY2VydA0KICAgICAgICAgICAgICAgICAgICB9LCBhcHApLmxpc3Rlbihwb3J0LCBhZGRyZXNzLCBsaXN0ZW4pOw0KICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICBnbG9iYWwuZXhTZXJ2ZXIgPSBodHRwLmNyZWF0ZVNlcnZlcihhcHApLmxpc3Rlbihwb3J0LCBhZGRyZXNzLCBsaXN0ZW4pOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfWNhdGNoKGV4KXsNCiAgICAgICAgICAgIDwlPWVycm9yKCklPmV4KTsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgfQ0KDQogICAgYXN5bmMgPCU9bU5hbWU9J19pbmJvdW5kQ2FsbCclPihyZXEsIHJlcywgY05hbWUsIG1OYW1lKXsNCiAgICAgICAgbGV0IHJldCA9IHt9Ow0KICAgICAgICB0cnl7DQogICAgICAgICAgICByZXQgPSBhd2FpdCBuZXcgPCU9c2NvcGUlPltyZXEucGFyYW1zLmNsYXNzIHx8IGNOYW1lXSgpLl9pbnZva2UocmVxLnBhcmFtcy5tZXRob2QgfHwgbU5hbWUsIHJlcS5ib2R5LCByZXEucXVlcnksIHJlcS5fX2F1dGhvcml6YXRpb24pOw0KICAgICAgICB9Y2F0Y2goZXgpew0KICAgICAgICAgICAgPCU9ZXJyb3IoKSU+ZXgpOw0KICAgICAgICAgICAgcmV0ID0gew0KICAgICAgICAgICAgICAgIEV4Y2VwdGlvbjogIkV4Y2VwdGlvbjogIiArIGV4LA0KICAgICAgICAgICAgfTsNCiAgICAgICAgfQ0KDQogICAgICAgIGlmKHJldCAmJiB0eXBlb2YocmV0KT09PSJudW1iZXIiKSByZXQgPSByZXQudG9TdHJpbmcoKTsNCiAgICAgICAgcmVzLnNlbmQocmV0KTsNCiAgICB9DQoNCjwlIGlmKGMuQ29uZmlnWydncmFwaHFsJ10peyU+DQogICAgPCU9bU5hbWU9J19xbFNlbGVjdGlvbnMnJT4oc1NldCl7DQogICAgICAgIGxldCByZXQgPSBbXTsNCiAgICAgICAgaWYoIXNTZXQgfHwgIXNTZXQuc2VsZWN0aW9ucykgcmV0dXJuIHJldDsNCiAgICAgICAgDQogICAgICAgIHNTZXQuc2VsZWN0aW9ucy5maWx0ZXIocyA9PiBzLnNlbGVjdGlvblNldCkuZm9yRWFjaChzID0+IHsNCjwlIGMuRW50aXR5QXR0cmlidXRlcy5maWx0ZXIoZWEgPT4gZWEuRW50aXR5VHlwZSAmJiAhZWEuRW50aXR5TWV0aG9kKS5mb3JFYWNoKGVhID0+IHslPg0KICAgICAgICAgICAgaWYocy5uYW1lLnZhbHVlPT0iPCU9bk5hbWUoZWEpJT4iKXsNCiAgICAgICAgICAgICAgICA8JT1sb2coKSU+J1JlZmVyZW5jZSBmb3IgPCU9bk5hbWUoZWEpJT4nLCBzKTsNCiAgICAgICAgICAgICAgICBsZXQgc09iaiA9IG5ldyA8JT1zY29wZSU+LjwlPW5OYW1lKGVhLkVudGl0eVR5cGUsIHRydWUpJT4oKS48JT1uTmFtZShlYSklPl88JT1jLlBsdXJhbC5yZXBsYWNlKC8gL2csICdfJyklPih0aGlzKTsNCiAgICAgICAgICAgICAgICByZXQucHVzaChzT2JqKTsNCiAgICAgICAgICAgICAgICByZXQucHVzaCguLi5zT2JqLl9xbFNlbGVjdGlvbnMocy5zZWxlY3Rpb25TZXQpKTsNCiAgICAgICAgICAgIH0NCjwlIH0pJT4NCiAgICAgICAgfSk7DQogICAgICAgIA0KICAgICAgICByZXR1cm4gcmV0Ow0KICAgIH0NCiAgICANCiAgICA8JT1tTmFtZT0nX3FsUmVzb2x2ZXInJT4oKXsNCiAgICAgICAgcmV0dXJuIHsNCjwlIGFyQ2xhc3Nlcy5mb3JFYWNoKF9jID0+IHslPg0KICAgICAgICAgICAgPCU9bk5hbWUoX2MpJT46IGFzeW5jIChwYXJlbnQsIGFyZ3MsIGNvbnRleHQsIGluZm8pID0+IHsNCiAgICAgICAgICAgICAgICBpZighcGFyZW50LmRhdGEpIHBhcmVudC5xdWVyeSA9IHBhcmVudC5xdWVyeSB8fCB7fTsNCiAgICAgICAgICAgICAgICBsZXQgb2JqID0gbmV3IDwlPXNjb3BlJT4uPCU9bk5hbWUoX2MpJT4oKS5fZnJvbURvY3VtZW50KHBhcmVudC5xdWVyeSB8fCBwYXJlbnQuZGF0YSk7DQogICAgICAgICAgICAgICAgbGV0IHJldCA9IG51bGw7DQogICAgICAgICAgICAgICAgaWYocGFyZW50LnF1ZXJ5KXsNCiAgICAgICAgICAgICAgICAgICAgbGV0IGZpZWxkcyA9IG51bGw7DQogICAgICAgICAgICAgICAgICAgIHJldCA9IGF3YWl0IG9iai5maW5kQWxsKG51bGwsIG9iai5fcWxTZWxlY3Rpb25zKGNvbnRleHQuZmllbGROb2Rlc1swXS5zZWxlY3Rpb25TZXQpLCBudWxsLCBudWxsLCBbdGhpcy5fX2NvbmZpZygnaWRGaWVsZCcsICdJZCcpXS5jb25jYXQoY29udGV4dC5maWVsZE5vZGVzWzBdLnNlbGVjdGlvblNldC5zZWxlY3Rpb25zLm1hcChzID0+IHMubmFtZS52YWx1ZSkpKTsNCiAgICAgICAgICAgICAgICB9ZWxzZSBpZihwYXJlbnQuZGF0YSl7DQogICAgICAgICAgICAgICAgICAgIHJldCA9IGF3YWl0IG9iai5zdG9yZSgpOw0KICAgICAgICAgICAgICAgICAgICBpZihvYmouX19hc3NlcnRFcnJvcikgdGhyb3cgb2JqLl9fYXNzZXJ0RXJyb3I7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmKEFycmF5LmlzQXJyYXkocmV0KSl7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiByZXQubWFwKHIgPT4gci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldD9yZXQuX3RvRG9jdW1lbnQoKTpyZXQ7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSwNCiAgICA8JSBfYy5FbnRpdHlNZXRob2RzLmZvckVhY2goX20gPT4geyU+DQogICAgICAgICAgICAvLyA8JT1uTmFtZShfbSklPjogKHBhcmVudCwgYXJncywgY29udGV4dCwgaW5mbykgPT4gbmV3IDwlPXNjb3BlJT4uPCU9bk5hbWUoX2MpJT4oKS48JT1uTmFtZShfbSklPigiPCU9bk5hbWUoX20pJT4iLCBwYXJlbnQsIGFyZ3MsIGNvbnRleHQsIGluZm8pLA0KICAgIDwlIH0pJT4NCjwlIH0pJT4NCiAgICAgICAgfTsNCiAgICB9DQogICAgDQogICAgPCU9bU5hbWU9J190b0dRTFNjaGVtYSclPigpew0KICAgICAgICBsZXQgcmV0ID0gYA0KdHlwZSBRdWVyeSB7DQo8JSBhckNsYXNzZXMuZm9yRWFjaChfYyA9PiB7JT4NCiAgICAiIiINCiAgICBGaW5kIGFsbCBtYXRjaGVzIGZvciA8JT1uTmFtZShfYyklPg0KICAgICIiIg0KICAgIDwlPW5OYW1lKF9jKSU+KHF1ZXJ5OiA8JT1uTmFtZShfYyklPklucHV0KTogWzwlPW5OYW1lKF9jKSU+XQ0KPCUgfSklPg0KfQ0KDQp0eXBlIE11dGF0aW9uIHsNCjwlIGFyQ2xhc3Nlcy5mb3JFYWNoKF9jID0+IHslPg0KICAgICIiIg0KICAgIFN0b3JlIGEgc2luZ2xlIDwlPW5OYW1lKF9jKSU+IG9iamVjdA0KICAgICIiIg0KICAgIDwlPW5OYW1lKF9jKSU+KGRhdGE6IDwlPW5OYW1lKF9jKSU+SW5wdXQpOiA8JT1uTmFtZShfYyklPg0KPCUgfSklPg0KfQ0KICAgIA0KICAgIDwlIGFyQ2xhc3Nlcy5mb3JFYWNoKF9jID0+IHslPg0KIiIiDQpJbnB1dCB0eXBlIGZvciA8JT1uTmFtZShfYyklPg0KIiIiDQppbnB1dCA8JT1uTmFtZShfYyklPklucHV0ew0KICAgIDwlIF9jLkVudGl0eUF0dHJpYnV0ZXMuZmlsdGVyKGVhID0+ICFlYS5FbnRpdHlNZXRob2QpLmZvckVhY2goZWEgPT4geyU+DQogICAgPCU9bk5hbWUoZWEpJT46IDwlPXFsVHlwZShlYSwgdHJ1ZSklPg0KICAgIDwlIH0pJT4NCiAgICA8JSBfYy5UeXBlZEF0dHJpYnV0ZXMuZmlsdGVyKHRhID0+ICF0YS5FbnRpdHlNZXRob2QgJiYgdGEuRW50aXR5VHlwZSkuZm9yRWFjaCh0YSA9PiB7IGxldCB0YU5hbWUgPSB0YS5FbnRpdHlDbGFzcy5QbHVyYWwucmVwbGFjZSgvIC9nLCAnXycpOyAlPg0KICAgIDwlPW5OYW1lKHRhKSU+XzwlPXRhTmFtZSU+OiBbPCU9bk5hbWUodGEuRW50aXR5Q2xhc3MpJT5JbnB1dF0NCiAgICA8JSB9KSU+DQogICAgT1BFUkFUT1JTOiA8JT1uTmFtZShfYyklPk9wZXJhdG9yDQp9DQoNCmlucHV0IDwlPW5OYW1lKF9jKSU+T3BlcmF0b3J7DQogICAgPCUgX2MuRW50aXR5QXR0cmlidXRlcy5maWx0ZXIoZWEgPT4gIWVhLkVudGl0eU1ldGhvZCkuZm9yRWFjaChlYSA9PiB7JT4NCiAgICA8JT1uTmFtZShlYSklPjogU3RyaW5nDQogICAgPCUgfSklPg0KfQ0KDQoiIiINCjwlPV9jLlJlbWFyayU+DQoiIiINCnR5cGUgPCU9bk5hbWUoX2MpJT57DQogICAgX2lkOiBJRCENCiAgICA8JSBfYy5FbnRpdHlBdHRyaWJ1dGVzLmZpbHRlcihlYSA9PiAhZWEuRW50aXR5TWV0aG9kKS5mb3JFYWNoKGVhID0+IHslPg0KICAgICIiIg0KICAgIDwlPWVhLlJlbWFyayU+DQogICAgIiIiDQogICAgPCU9bk5hbWUoZWEpJT46IDwlPXFsVHlwZShlYSklPjwlPWVhLklzUmVxdWlyZWQ/JyEnOicnJT4NCiAgICA8JSB9KSU+DQogICAgPCUgX2MuVHlwZWRBdHRyaWJ1dGVzLmZpbHRlcih0YSA9PiAhdGEuRW50aXR5TWV0aG9kICYmIHRhLkVudGl0eVR5cGUpLmZvckVhY2godGEgPT4geyBsZXQgdGFOYW1lID0gdGEuRW50aXR5Q2xhc3MuUGx1cmFsLnJlcGxhY2UoLyAvZywgJ18nKTsgJT4NCiAgICA8JT1uTmFtZSh0YSklPl88JT10YU5hbWUlPjogWzwlPW5OYW1lKHRhLkVudGl0eUNsYXNzKSU+XQ0KICAgIDwlIH0pJT4NCg0KICAgIDwlIF9jLkVudGl0eU1ldGhvZHMuZmlsdGVyKF9tID0+ICFfbS5NZXRob2RQYXJhbWV0ZXJzLmxlbmd0aCkuZm9yRWFjaChfbSA9PiB7JT4NCiAgICAiIiINCiAgICA8JT1fbS5SZW1hcmslPg0KICAgICIiIg0KICAgIDwlPW5OYW1lKF9tKSU+OiA8JT1xbFR5cGUoX20uUmVzcG9uc2VBdHRyaWJ1dGUsIHRydWUpJT4NCiAgICA8JSB9KSU+DQogICAgPCUgX2MuRW50aXR5TWV0aG9kcy5maWx0ZXIoX20gPT4gX20uTWV0aG9kUGFyYW1ldGVycy5sZW5ndGgpLmZvckVhY2goX20gPT4geyU+DQogICAgIiIiDQogICAgPCU9X20uUmVtYXJrJT4NCiAgICAiIiINCiAgICA8JT1uTmFtZShfbSklPig8JT1fbS5NZXRob2RQYXJhbWV0ZXJzLm1hcChwID0+IG5OYW1lKHApICsgJzogJyArIHFsVHlwZShwLCB0cnVlKSkuam9pbignLCAnKSU+KTogPCU9cWxUeXBlKF9tLlJlc3BvbnNlQXR0cmlidXRlKSU+DQogICAgPCUgfSklPg0KfQ0KICAgIDwlIH0pJT4NCiAgICAgICAgYDsNCiAgICAgICAgPCU9bG9nKCklPnJldCk7DQogICAgICAgIHJldHVybiByZXQ7DQogICAgfQ0KPCUgfSAvLyBncmFwaCU+DQoNCjwlIH0gLy8gSXNNYWluICU+DQoNCiAgICBhc3luYyA8JT1tTmFtZT0nX2ludm9rZU5vZGUnJT4obiwgbWV0aG9kLCBkYXRhLCBldmVudCwgYlJhdykgew0KICAgICAgICAvLyBpZighbikgcmV0dXJuIG51bGw7DQogICAgICAgIA0KICAgICAgICBpZih0eXBlb2YoPCU9bnNjb3BlJT4uX25vZGUpPT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgPCU9d2FybigpJT4iPCU9bnNjb3BlJT4uX25vZGUgbm90IGRlZmluZWQiKTsNCiAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICBpZihldmVudCl7DQo8JSBpZihfY05hbWUoJ0V2ZW50JykpeyU+DQogICAgICAgICAgICBpZihldmVudC5fY2xhc3NOYW1lX3NldCAmJiBldmVudC5jbGFzc05hbWUoKSAmJiBldmVudC5jbGFzc05hbWUoKSE9JzwlPW5OYW1lKGMpJT4nKXsNCiAgICAgICAgICAgICAgICBsZXQgb0NsYXNzID0gbnVsbDsNCiAgICAgICAgICAgICAgICBpZihmYWxzZSl7DQogICAgICAgICAgICAgICAgICAgIDwlPWxvZygpJT4iRGVsZWdhdGluZyBpbnZva2F0aW9uIHRvICIgKyBldmVudC5jbGFzc05hbWUoKSsnLicrbWV0aG9kKycgLi4uLicpOw0KICAgIDwlIHNyLmdyb3VwQnkoYXJDbGFzc2VzLCAnRW50aXR5TW9kdWxlJykuZm9yRWFjaChlbSA9PiB7JT4NCiAgICAgICAgICAgICAgICB9ZWxzZSBpZihbIjwlPWVtLnZhbHVlcy5tYXAobWMgPT4gbk5hbWUobWMpKS5qb2luKCciLCAiJyklPiJdLmluZGV4T2YoZXZlbnQuY2xhc3NOYW1lKCkpPj0wKXsNCiAgICAgICAgICAgICAgICAgICAgb0NsYXNzID0gbmV3IDwlPXNjb3BlJT48JT1lbS5rZXk/KCcuJytlbS5rZXkuQWxpYXMpOicnJT5bZXZlbnQuY2xhc3NOYW1lKCldKCk7DQogICAgPCUgfSklPg0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICByZXR1cm4gYXdhaXQgb0NsYXNzLjwlPW1OYW1lJT4obiwgbWV0aG9kLCBkYXRhLCBldmVudCwgYlJhdyk7DQogICAgICAgICAgICB9DQo8JSB9ZWxzZXslPg0KICAgICAgICAgICAgPCU9ZXJyb3IoKSU+IkV2ZW50IGNhbm5vdCBiZSBkZWZpbmVkIHdpdGhvdXQgdGhlIEV2ZW50IGNsYXNzIik7DQogICAgICAgICAgICByZXR1cm4gbnVsbDsNCjwlIH0lPg0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICBsZXQgcmV0ID0gbnVsbDsNCg0KICAgICAgICBkYXRhID0gZGF0YSB8fCB7fTsNCg0KICAgICAgICBpZih0eXBlb2YoZGF0YSk9PT0ib2JqZWN0Iil7DQogICAgICAgICAgICBkYXRhLl9fdGhpcyA9IGRhdGEuX190aGlzIHx8IHRoaXMuX3RvSlNPTih7cGFyc2U6IDF9KTsNCiAgICAgICAgICAgIHN3aXRjaChtZXRob2Qpew0KICAgIDwlIGMuRW50aXR5TWV0aG9kcy5mb3JFYWNoKG0gPT4geyU+DQogICAgICAgICAgICAgICAgY2FzZSAiPCU9bkNvZGUobSklPiI6IHsNCiAgICAgICAgPCUgbS5NZXRob2RQYXJhbWV0ZXJzLmZvckVhY2gocCA9PiB7JT4NCiAgICAgICAgICAgICAgICAgICAgZGF0YS48JT1uTmFtZShwKSU+ID0gZGF0YS48JT1uTmFtZShwKSU+P2RhdGEuPCU9bk5hbWUocCklPg0KICAgICAgICAgICAgPCVpZihwLklzQXJyYXkpeyU+Lm1hcChfcCA9PiBfcDwlfSU+DQogICAgICAgICAgICA8JSBpZihwLkVudGl0eVR5cGUpeyU+Ll90b0RvY3VtZW50KCkNCiAgICAgICAgICAgIDwlIH1lbHNlIGlmKHAuSXNEYXRlKXslPi50b0lTT1N0cmluZygpDQogICAgICAgICAgICA8JSB9JT4NCiAgICAgICAgICAgIDwlaWYocC5Jc0FycmF5KXslPik8JX0lPjp1bmRlZmluZWQ7DQogICAgICAgIDwlIH0pJT4NCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgfQ0KICAgIDwlIH0pJT4NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQo8JSBpZihfY05hbWUoJ05vZGUnKSl7JT4NCiAgICAgICAgaWYodHlwZW9mKG4pPT09J3N0cmluZycpIG4gPSBuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUoJ05vZGUnLCB0cnVlKSU+KCkuY29kZShuKTsNCjwlIH0lPg0KDQogICAgICAgIGlmKCFuIHx8IDwlPW5zY29wZSU+Ll9ub2RlLl9zYW1lRW50aXR5KG4pKXsNCiAgICAgICAgICAgIHJldCA9IGF3YWl0IHRoaXMuX2ludm9rZShtZXRob2QsIGRhdGEpOw0KICAgICAgICAgICAgPCU9bG9nKCklPiJMb2NhbCBub2RlIiwgcmV0KTsNCg0KICAgICAgICB9ZWxzZSBpZihuLmFkZHJlc3MoKSl7DQogICAgICAgICAgICB0cnl7DQogICAgICAgICAgICAgICAgPCU9bG9nKCklPm4uYWRkcmVzcygpLCBuLnBvcnQoKSwgbWV0aG9kKTsNCiAgICAgICAgICAgICAgICByZXQgPSBhd2FpdCB0aGlzLl9yZXN0KHVuZGVmaW5lZCwgZGF0YSwgbnVsbCwgbnVsbCwge3BhdGg6IGBodHRwJHtuLnNlY3VyZSgpPydzJzonJ306Ly8ke24uYWRkcmVzcygpfToke24ucG9ydCgpIHx8IDMwMDB9L21ldGhvZC88JT1uTmFtZShjKSU+LyR7bWV0aG9kfWAsIGhlYWRlcnM6IHt9fSk7DQogICAgICAgICAgICB9Y2F0Y2goZXgpew0KICAgICAgICAgICAgICAgIDwlPWVycm9yKCklPmV4KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfWVsc2V7DQo8JSBpZihfY05hbWUoJ0V2ZW50JykgJiYgYy5OYW1lIT09J0V2ZW50Jyl7JT4NCiAgICAgICAgICAgIGlmKHR5cGVvZihkYXRhKT09PSJvYmplY3QiKXsNCiAgICAgICAgICAgICAgICBkZWxldGUgZGF0YS5fX3RoaXMuX19nZW5lcmF0ZWQ7DQogICAgICAgICAgICAgICAgZGVsZXRlIGRhdGEuX190aGlzLm9ubGluZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgLy93aHkgZG8gd2UgbmVlZCB0aGlzPz8/DQogICAgICAgICAgICA8JSAvKnVuUmVjdXJzZSgnZGF0YScsICdtZXRob2QnLCAne30nLCAnJywgNSwgJ19fdGhpcy5jb2RlJykqLyAlPg0KICAgICAgICAgICAgDQogICAgICAgICAgICBsZXQgZXYgPSBuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUoJ0V2ZW50JywgdHJ1ZSklPigpLmFjdGl2ZSh0cnVlKS5lbmFibGVkKHRydWUpLmNvZGUodGhpcy5fdXVpZCgpKS5uYW1lKHRoaXMuX19jb25maWcoJ2V2ZW50JykgfHwgJzwlPXNjb3BlJT4uRXZlbnQnKS5kYXRlKHRoaXMuc2VydmVyRGF0ZSgpKS5yZWNpcGllbnQobikubWV0aG9kKG1ldGhvZCkuY2xhc3NOYW1lKCc8JT1uTmFtZShjKSU+Jykuc2VuZGVyKDwlPW5zY29wZSU+Ll9ub2RlKS5jYXJyaWVyKDwlPW5zY29wZSU+Ll9ub2RlKS5wYXlsb2FkKHRoaXMuX2J0b2EoSlNPTi5zdHJpbmdpZnkoZGF0YSkpKTsNCiAgICAgICAgICAgIGlmKGV2ZW50KXsNCiAgICAgICAgICAgICAgICBpZihldmVudC5fcmVzcG9uc2VUb19zZXQpIGV2LnJlc3BvbnNlVG8oZXZlbnQucmVzcG9uc2VUbygpKTsNCiAgICAgICAgICAgICAgICBpZihldmVudC5fc2VuZGVyX3NldCkgZXYuc2VuZGVyKGV2ZW50LnNlbmRlcigpKTsNCiAgICAgICAgICAgICAgICBpZihldmVudC5fY2xhc3NOYW1lX3NldCkgZXYuY2xhc3NOYW1lKGV2ZW50LmNsYXNzTmFtZSgpKTsNCiAgICAgICAgICAgICAgICBpZihldmVudC5fY2Fycmllcl9zZXQgfHwgZXZlbnQuX3NlbmRlcl9zZXQpIGV2LmNhcnJpZXIoZXZlbnQuY2FycmllcigpIHx8IGV2ZW50LnNlbmRlcigpKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldCA9IGF3YWl0IGV2LnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKHJldCk9PT0ic3RyaW5nIil7DQogICAgICAgICAgICAgICAgdHJ5ew0KICAgICAgICAgICAgICAgICAgICByZXQgPSBKU09OLnBhcnNlKHJldCk7DQogICAgICAgICAgICAgICAgfWNhdGNoKGV4KXsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9ZWxzZSBpZihyZXQgJiYgdHlwZW9mKHJldC5wYXlsb2FkKT09PSdmdW5jdGlvbicpew0KICAgICAgICAgICAgICAgIC8vIHJldCBpcyBhbiBldmVudA0KICAgICAgICAgICAgICAgIHJldCA9IHJldC5wYXlsb2FkKCk7DQogICAgICAgICAgICB9ZWxzZSBpZihBcnJheS5pc0FycmF5KHJldCkgJiYgcmV0WzBdICYmIHR5cGVvZihyZXRbMF0ucGF5bG9hZCk9PT0nZnVuY3Rpb24nKXsNCiAgICAgICAgICAgICAgICByZXQgPSByZXQubWFwKHIgPT4gci5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgICAgIGlmKHJldC5sZW5ndGg9PTEpIHJldCA9IHJldFswXTsNCiAgICAgICAgICAgIH0NCjwlIH0lPg0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICBpZighcmV0KSByZXR1cm4gbnVsbDsNCiAgICAgICAgcmV0ID0gcmV0LmRhdGEgfHwgcmV0Ow0KDQogICAgICAgIGlmKHJldC5fX2V4Y2VwdGlvbil7DQogICAgICAgICAgICAvLyBhbiBleGNlcHRpb24gb2NjdXJyZWQgYXQgdGhlIHNlcnZlcg0KICAgICAgICAgICAgPCU9ZXJyb3IoKSU+YEV4Y2VwdGlvbiBhdCAke24uX2FkZHJlc3N9YCwgcmV0Ll9fZXhjZXB0aW9uKTsNCiAgICAgICAgICAgIHJldHVybiByZXQ7DQogICAgICAgIH0NCg0KICAgICAgICBzd2l0Y2gobWV0aG9kKXsNCjwlIGMuRW50aXR5TWV0aG9kcy5mb3JFYWNoKG0gPT4geyU+DQogICAgICAgICAgICBjYXNlICI8JT1uQ29kZShtKSU+Ijogew0KICAgIDwlIGlmKG0uUmVzcG9uc2VBdHRyaWJ1dGUuRW50aXR5VHlwZSl7ICU+DQogICAgICAgICAgICAgICAgaWYoIWJSYXcpIHJldCA9IG5ldyA8JT1zY29wZSU+LjwlPV9jTmFtZShtLlJlc3BvbnNlQXR0cmlidXRlLkVudGl0eVR5cGUsIHRydWUpJT4oKS5fZnJvbURvY3VtZW50KHJldCk7DQogICAgPCUgfSAlPg0KICAgIDwlIGlmKG0uTmFtZT09J2F1dGhvcml6ZScpeyU+DQogICAgICAgICAgICAgICAgPCU9c2NvcGUlPi5fX3Rva2VuID0ge3Rva2VuX3R5cGU6ICJCZWFyZXIiLCBhY2Nlc3NfdG9rZW46IHJldH07DQogICAgPCUgfSAlPg0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgfQ0KPCUgfSk7ICU+DQoNCiAgICAgICAgICAgIGNhc2UgImluc2VydCI6DQogICAgICAgICAgICBjYXNlICJ1cGRhdGUiOg0KICAgICAgICAgICAgY2FzZSAic3RvcmUiOg0KICAgICAgICAgICAgY2FzZSAiZGVsZXRlIjoNCiAgICAgICAgICAgIGNhc2UgImZpbmQiOiANCiAgICAgICAgICAgIGNhc2UgImZpbmRBbGwiOiB7DQogICAgICAgICAgICAgICAgaWYoIWJSYXcpIHJldCA9IG5ldyA8JT1zY29wZSU+LjwlPW5OYW1lKGMsIHRydWUpJT4oKS5fZnJvbURvY3VtZW50KHJldCk7DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGRlZmF1bHQ6IHsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHJldHVybiByZXQ7DQogICAgfQ0KDQo8JSBpZihtYWluQ2xhc3MoKSl7JT4NCiAgICBhc3luYyA8JT1tTmFtZT0nX2ludm9rZSclPihtZXRob2QsIGJvZHksIHF1ZXJ5LCBhdXRoT2JqKXsNCiAgICAgICAgdGhpcy5fX3RpbWUoJzwlPXNjb3BlJT4uPCU9bk5hbWUoYyklPi4nICsgbWV0aG9kKTsNCiAgICAgICAgPCU9bG9nKCklPm1ldGhvZCwgcXVlcnksIGJvZHkpOw0KICAgICAgICANCiAgICAgICAgaWYodHlwZW9mKGJvZHkpPT09J3N0cmluZycpew0KICAgICAgICAgICAgaWYoPCU9X2I2NHRlc3QoJ2JvZHknKSU+KXsgLy8gYmFzZTY0Pw0KICAgICAgICAgICAgICAgIGJvZHkgPSB0aGlzLl9hdG9iKGJvZHkpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZigvW14sOnt9XFtcXTAtOS5cLStFYWVmbG5yLXUgXG5cclx0XS8udGVzdChib2R5KSl7IC8vIGpzb24NCiAgICAgICAgICAgICAgICB0cnl7DQogICAgICAgICAgICAgICAgICAgIGJvZHkgPSBKU09OLnBhcnNlKGJvZHkudG9TdHJpbmcoKSk7DQogICAgICAgICAgICAgICAgfWNhdGNoKGV4KXsNCiAgICAgICAgICAgICAgICAgICAgPCU9d2FybigpJT4iQm9keSBpcyBub3QgYSB2YWxpZCBKU09OIiwgYm9keSk7DQogICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBsZXQgX3BhcmFtcyA9IHF1ZXJ5P09iamVjdC5hc3NpZ24ocXVlcnksIGJvZHkpOmJvZHk7DQogICAgICAgIGlmKHR5cGVvZihfcGFyYW1zKT09PSdzdHJpbmcnKSBfcGFyYW1zID0gSlNPTi5wYXJzZShfcGFyYW1zKTsNCiAgICAgICAgDQogICAgICAgIGlmKF9wYXJhbXMpew0KICAgICAgICAgICAgX3BhcmFtcyA9IERvdE9iamVjdC5vYmplY3QoX3BhcmFtcyk7DQogICAgICAgIH1lbHNlew0KICAgICAgICAgICAgX3BhcmFtcyA9IHt9Ow0KICAgICAgICB9DQoNCiAgICAgICAgPCU9bG9nKCklPiJfcGFyYW1zIiwgX3BhcmFtcyk7DQoNCiAgICA8JSBpZihfY05hbWUoJ05vZGUnKSAmJiBjLk5hbWUhPSdOb2RlJyl7JT4NCiAgICAgICAgaWYoX3BhcmFtcy5fX25vZGUpew0KICAgICAgICAgICAgLy8gcHJvYmFibHkgc2hvdWxkIG5vdCBiZSBwcm9jZXNzZWQgaGVyZSwgYnV0IHJhdGhlciBjb25zdW1lZCBhcyBwYXJ0IG9mIHRoZSBleGVjdXRlKCkgbG9naWMsIHB1c2hpbmcgX19ub2RlIHRvIHRoZSBsaXN0IG9mIG15IG5vZGVzIHRvIGRlbGVnYXRlIHRvIT8NCiAgICAgICAgICAgIGxldCB0biA9IG5ldyA8JT1zY29wZSU+LjwlPV9jTmFtZSgnTm9kZScsIHRydWUpJT4oKS5fZnJvbURvY3VtZW50KF9wYXJhbXMuX19ub2RlKS8qLl9kZVJlZmVyZW5jZSgpKi87DQogICAgICAgICAgICBkZWxldGUgX3BhcmFtcy5fX25vZGU7DQogICAgICAgICAgICByZXR1cm4gYXdhaXQgbmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKGMsIHRydWUpJT4oKS5faW52b2tlTm9kZSh0biwgbWV0aG9kLCBfcGFyYW1zKTsNCiAgICAgICAgfQ0KICAgIDwlIH0lPg0KDQogICAgICAgIGlmKF9wYXJhbXMuX190aGlzKSB7DQogICAgICAgICAgICBfcGFyYW1zLl9fdGhpcyA9IERvdE9iamVjdC5vYmplY3QoX3BhcmFtcy5fX3RoaXMpOw0KICAgICAgICAgICAgbGV0IF9fdGhpcyA9IG5ldyA8JT1zY29wZSU+LjwlPV9jTmFtZShjLCB0cnVlKSU+KCkuX2Zyb21Eb2N1bWVudChfcGFyYW1zLl9fdGhpcykvKi5fZGVSZWZlcmVuY2UoKSovOw0KICAgICAgICAgICAgZGVsZXRlIF9wYXJhbXMuX190aGlzOw0KICAgICAgICAgICAgcmV0dXJuIGF3YWl0IF9fdGhpcy48JT1tTmFtZSU+KG1ldGhvZCwgX3BhcmFtcywgbnVsbCwgYXV0aE9iaik7DQogICAgICAgIH0NCg0KICAgICAgICBsZXQgYXJBcmdzID0gW107DQogICAgICAgIHN3aXRjaChtZXRob2Qpew0KPCUgYy5FbnRpdHlNZXRob2RzLmZvckVhY2gobSA9PiB7JT4NCiAgICAgICAgICAgIGNhc2UgIjwlPW5Db2RlKG0pJT4iOiB7DQo8JSBpZihfY05hbWUoJ1RyYW5zYWN0aW9uJykgJiYgX2NOYW1lKCdDb250ZW50JykgJiYgYy5OYW1lIT0nVHJhbnNhY3Rpb24nICYmICFtLklzU3luYyl7JT4NCiAgICAgICAgaWYoIV9wYXJhbXMuU3luYyl7DQogICAgICAgICAgICByZXR1cm4gbmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKCdDb250ZW50JywgdHJ1ZSklPigoYXdhaXQgbmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKCdDb250ZW50JywgdHJ1ZSklPigpLmFjdGl2ZSh0cnVlKS5lbmFibGVkKHRydWUpLnNjb3BlKCI8JT1zY29wZSU+IikuY2xhc3MoIjwlPWMuTmFtZSU+IikubWV0aG9kKG1ldGhvZCkuYXV0aG9yaXphdGlvbihhdXRoT2JqKS5kYXRlKHRoaXMuc2VydmVyRGF0ZSgpKS5wYXlsb2FkKHRoaXMuX2J0b2EoX3BhcmFtcykpLnRyYW5zYWN0aW9uX1RyYW5zYWN0aW9uTG9ncyhbbmV3IDwlPXNjb3BlJT4uVHJhbnNhY3Rpb25Mb2coKS5kYXRlKHRoaXMuc2VydmVyRGF0ZSgpKS5zdGF0ZShuZXcgPCU9c2NvcGUlPi5UcmFuc2FjdGlvblN0YXRlKCkuYWN0aXZlKHRydWUpLmVuYWJsZWQodHJ1ZSkubmFtZSgibG9hZGVkIikpXSkuc3RvcmUoKSkuSWQpLl90b0RvY3VtZW50KCk7DQogICAgICAgIH0NCjwlIH0lPg0KDQogICAgPCUgbS5NZXRob2RQYXJhbWV0ZXJzLmZvckVhY2gocCA9PiB7JT4NCiAgICAgICAgPCUgaWYocC5FbnRpdHlUeXBlICYmIHAuSXNBcnJheSl7JT4NCiAgICAgICAgICAgICAgICBfcGFyYW1zLjwlPW5Db2RlKHApJT4gPSBfcGFyYW1zLjwlPW5Db2RlKHApJT4ubWFwKHAgPT4gbmV3IDwlPXNjb3BlJT4uPCU9bk5hbWUocC5FbnRpdHlUeXBlKSU+KCkuX2Zyb21Eb2N1bWVudChwKS5fZGVSZWZlcmVuY2UoKSk7DQogICAgICAgIDwlIH1lbHNlIGlmKHAuRW50aXR5VHlwZSl7ICU+DQogICAgICAgICAgICAgICAgX3BhcmFtcy48JT1uQ29kZShwKSU+ID0gbmV3IDwlPXNjb3BlJT4uPCU9bk5hbWUocC5FbnRpdHlUeXBlKSU+KCkuX2Zyb21Eb2N1bWVudChfcGFyYW1zLjwlPW5Db2RlKHApJT4pLl9kZVJlZmVyZW5jZSgpOw0KICAgICAgICA8JSB9ICU+DQogICAgICAgICAgICAgICAgYXJBcmdzLnB1c2goX3BhcmFtcy48JT1uQ29kZShwKSU+KTsNCiAgICA8JSB9KTslPg0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgfQ0KPCUgfSk7JT4NCg0KICAgICAgICAgICAgY2FzZSAiZmluZEFsbCI6ew0KICAgICAgICAgICAgICAgIGFyQXJncy5wdXNoKF9wYXJhbXMuZGVwdGgpOw0KICAgICAgICAgICAgICAgIGFyQXJncy5wdXNoKF9wYXJhbXMub2Jqcyk7DQogICAgICAgICAgICAgICAgYXJBcmdzLnB1c2goX3BhcmFtcy5zdGFydCk7DQogICAgICAgICAgICAgICAgYXJBcmdzLnB1c2goX3BhcmFtcy5lbmQpOw0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2FzZSAiZmluZCI6IHsNCiAgICAgICAgICAgICAgICBhckFyZ3MucHVzaChfcGFyYW1zLmRlcHRoKTsNCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgZGVmYXVsdDogew0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICBsZXQgb2JqID0gdGhpczsNCiAgICAgICAgDQogICAgICAgIGxldCByZXQgPSBudWxsOw0KICAgICAgICBpZighb2JqKXsNCiAgICAgICAgICAgIHJldCA9IHsNCiAgICAgICAgICAgICAgICBfX2V4Y2VwdGlvbjogew0KICAgICAgICAgICAgICAgICAgICAnLTEnOiBgPCU9bk5hbWUoYyklPi48JT1tTmFtZSU+OiBvYmogaXMgdW5kZWZpbmVkYA0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH07DQogICAgICAgIH1lbHNlIGlmKCFvYmpbbWV0aG9kXSl7DQogICAgICAgICAgICByZXQgPSB7DQogICAgICAgICAgICAgICAgX19leGNlcHRpb246IHsNCiAgICAgICAgICAgICAgICAgICAgJy0yJzogYDwlPW5OYW1lKGMpJT4uPCU9bU5hbWUlPjogbWV0aG9kICR7b2JqLmNvbnN0cnVjdG9yLm5hbWV9KCR7bWV0aG9kfSkgaXMgbm90IGZvdW5kYCwNCiAgICAgICAgICAgICAgICAgICAgJ29iaic6IG9iag0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH07DQogICAgICAgIH1lbHNlew0KICAgICAgICAgICAgcmV0ID0gYXdhaXQgb2JqW21ldGhvZF0oLi4uYXJBcmdzKTsNCiAgICAgICAgfQ0KICAgICAgICANCjwlIGNsc1Rvb2xzKGMpLmZvckVhY2godCA9PiB7JT4NCiAgICAgICAgaWYodGhpcy5Ub29sLnR5cGUubmFtZT09IjwlPXQlPiIpew0KICAgIDwlIGlmKHQ9PSJTcWxEQiIpeyAlPg0KICAgICAgICAgICAgaWYoZmFsc2UgJiYgPCU9c2NvcGUlPi5fX3NxbFRyYW5zYWN0aW9uICYmICE8JT1zY29wZSU+Ll9fc3FsVHJhbnNhY3Rpb24uZW5kKXsNCiAgICAgICAgICAgICAgICByZXQgPSB7DQogICAgICAgICAgICAgICAgICAgIF9fZXhjZXB0aW9uOiB7DQogICAgICAgICAgICAgICAgICAgICAgICAnLTQnOiAiVW5jb21taXR0ZWQgdHJhbnNhY3Rpb25zOiAiICsgPCU9c2NvcGUlPi5fX3NxbFRyYW5zYWN0aW9uLnNxbHMubGVuZ3RoLA0KICAgICAgICAgICAgICAgICAgICAgICAgJ29iaic6IG9iag0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgIDwlIH0lPg0KICAgICAgICB9DQo8JSB9KSU+DQoNCiAgICAgICAgaWYocmV0ICYmICFyZXQuX19leGNlcHRpb24pew0KICAgICAgICAgICAgPCU9c2NvcGUlPi5fdW5SZWN1cnNlID0ge307DQogICAgICAgICAgICBpZihBcnJheS5pc0FycmF5KHJldCkpew0KICAgICAgICAgICAgICAgIGxldCBfcmV0ID0gW107DQogICAgICAgICAgICAgICAgZm9yIGF3YWl0KGNvbnN0IHIgb2YgcmV0KXsNCiAgICAgICAgICAgICAgICAgICAgaWYociAmJiByLl90b0RvY3VtZW50KXsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmKDwlPXNjb3BlJT4uX3VuUmVjdXJzZS48JT1uTmFtZShjKSU+KSBkZWxldGUgPCU9c2NvcGUlPi5fdW5SZWN1cnNlLjwlPW5OYW1lKGMpJT4uX3RvRG9jdW1lbnQ7DQogICAgICAgICAgICAgICAgICAgICAgICBfcmV0LnB1c2goYXdhaXQgci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgICAgICAgICAgfWVsc2UgX3JldC5wdXNoKHIpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICByZXQgPSBfcmV0Ow0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0ID0gKHJldCAmJiByZXQuX3RvRG9jdW1lbnQpP2F3YWl0IHJldC5fdG9Eb2N1bWVudCgpOnJldDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgPCU9bG9nKCklPidyZXQnLCByZXQpOw0KICAgICAgICA8JT1sb2coKSU+YCR7bWV0aG9kfTogJHt0aGlzLl9fdGltZSgnPCU9c2NvcGUlPi48JT1uTmFtZShjKSU+LicgKyBtZXRob2QpfWApOw0KICAgICAgICByZXR1cm4gcmV0Ow0KICAgIH0NCg0KPCUgaWYoX2NOYW1lKCdOb2RlJykpeyU+DQogICAgPCU9bU5hbWU9J19wYXJzZUNvZGVTdGF0ZSclPih0KXsNCiAgICA8JSBpZihtYWluQ2xhc3MoKT09Yyl7JT4NCiAgICAgICAgbGV0IHN0YXRlID0gdGhpcy5fX2NvbmZpZyh0aGlzLl9fY29uZmlnKCdvYXV0aC5yZWRpcmVjdC5zdGF0ZScsIG51bGwsIHt0b29sOiB0fSkpOw0KICAgICAgICBsZXQgY29kZSA9IHRoaXMuX19jb25maWcodGhpcy5fX2NvbmZpZygnb2F1dGgucmVkaXJlY3QuY29kZScsIG51bGwsIHt0b29sOiB0fSkpOw0KICAgICAgICBpZighc3RhdGUgfHwgIWNvZGUpIHJldHVybjsNCiAgICAgICAgc3RhdGUgPSBKU09OLnBhcnNlKHRoaXMuX2F0b2Ioc3RhdGUpKTsNCiAgICAgICAgaWYoc3RhdGUudG9vbCE9PXQubmFtZSkgcmV0dXJuOw0KDQogICAgICAgIDwlPWxvZygpJT4iR09UIENPREUgIiArIGNvZGUgKyAiIGZvciBub2RlICIgKyBzdGF0ZS5uY29kZSArICIgd2l0aCB0b29sICIgKyBzdGF0ZS50b29sKTsNCiAgICAgICAgaWYoITwlPW5zY29wZSU+Ll9ub2RlLnBhcmVudCgpIHx8ICE8JT1uc2NvcGUlPi5fbm9kZS5fcGFyZW50Ll9zYW1lRW50aXR5KDwlPW5zY29wZSU+Ll9ub2RlLnBhcmVudCgpKSl7DQogICAgICAgICAgICA8JT1sb2coKSU+J25ldyBwYXJlbnQnLCBzdGF0ZS5uY29kZSk7DQogICAgICAgICAgICA8JT1uc2NvcGUlPi5fbm9kZS5wYXJlbnQobmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKCdOb2RlJywgdHJ1ZSklPigpLmNvZGUoc3RhdGUubmNvZGUpKTsNCiAgICAgICAgfQ0KICAgICAgICA8JT1uc2NvcGUlPi5fbm9kZS5hdXRoQ29kZShjb2RlLCBuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUoJ1Rvb2wnLCB0cnVlKSU+KCkubmFtZShzdGF0ZS50b29sKSk7DQogICAgICAgIHdpbmRvdy5jbG9zZSgpOw0KICAgIDwlIH1lbHNleyU+DQogICAgICAgIHJldHVybiBuZXcgPCU9c2NvcGUlPi48JT1uTmFtZShtYWluQ2xhc3MoKSklPigpLjwlPW1OYW1lJT4odCk7DQogICAgPCUgfSU+DQogICAgfQ0KPCUgfSU+DQoNCiAgICBhc3luYyA8JT1tTmFtZT0nX2xvYWRUb29scyclPihiU3RvcmUpew0KICAgICAgICBpZig8JT1zY29wZSU+LlRvb2xzICYmIDwlPXNjb3BlJT4uVG9vbHMubGVuZ3RoKXsNCiAgICAgICAgICAgIDwlPWxvZygpJT5gVG9vbHMgYWxyZWFkeSBsb2FkZWRgKTsNCiAgICAgICAgICAgIHJldHVybiA8JT1zY29wZSU+LlRvb2xzOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICA8JT1sb2coKSU+YExvYWRpbmcgdG9vbHMuLi5gKTsNCiAgICAgICAgDQogICAgICAgIGxldCB0b29scyA9IFtdOw0KICAgICAgICB0b29scyA9IDwlPXNjb3BlJT4uX19Ub29scyB8fCB0b29sczsNCiAgICAgICAgZGVsZXRlIDwlPXNjb3BlJT4uX19Ub29sczsNCg0KICAgICAgICBsZXQgYXJUb29scyA9IDwlPV9GckVNRC5fdG9KUyhbLi4ubmV3IFNldChhckNsYXNzZXMubWFwKF9jID0+IF9jLlRvb2xzKS5mbGF0KCkpXSklPjsNCiAgICAgICAgbGV0IHRvb2xOYW1lcyA9IGFyVG9vbHMubWFwKHQgPT4gdC5uYW1lIHx8ICh0LnR5cGU/dC50eXBlLm5hbWU6dCkpOw0KICAgICAgICB0cnl7DQogICAgICAgICAgICBpZih0b29scy5sZW5ndGghPT10b29sTmFtZXMubGVuZ3RoKXsNCiAgICAgICAgICAgICAgICAvLyBjYW5ub3QgdXNlIHJlcXVpcmUgeWV0LCBubyB0b29scyBwcm9wZXJseSBsb2FkZWQgdG8gdXNlIGEgbG9hZGVyIGZ1bmN0aW9uDQogICAgICAgICAgICAgICAgdG9vbHMgPSBhd2FpdCB0aGlzLl9nZXRTdG9yZWRTY3JpcHQoe05hbWU6ICdBUElTRVJWRVI8JT1tTmFtZSU+JywgQWN0aXZlOiB0cnVlLCBFbmFibGVkOiB0cnVlfSkgfHwgdG9vbHM7DQogICAgICAgICAgICB9DQoNCjwlIGlmKF9jTmFtZSgnVG9vbCcpKXslPg0KICAgICAgICAgICAgaWYoIXRvb2xzLmxlbmd0aCkgdG9vbHMgPSAoYXdhaXQgbmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKCdUb29sJywgdHJ1ZSklPigpLlRISVModG9vbE5hbWVzLm1hcCh0ID0+IG5ldyA8JT1zY29wZSU+LjwlPV9jTmFtZSgnVG9vbCcsIHRydWUpJT4oKS5uYW1lKHQpKSkuZmluZEFsbCgyKSkubWFwKHQgPT4gdC5fdG9KU09OKHtwYXJzZTogMX0pKSB8fCB0b29sczsNCjwlIH0lPg0KICAgICAgICB9Y2F0Y2goZXgpew0KICAgICAgICAgICAgPCU9d2FybigpJT5leCk7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIGxldCBmaXhUb29scyA9IHRvb2xzID0+IHsNCiAgICAgICAgICAgIHRvb2xzLmZpbHRlcih0ID0+IHR5cGVvZih0KT09PSdvYmplY3QnICYmIHQpLmZvckVhY2godCA9PiB7DQogICAgICAgICAgICAgICAgPCVfZGVmKCd0LklkJywgJ3RoaXMuX3V1aWQoKScpJT4NCiAgICAgICAgICAgICAgICA8JV9kZWYoJ3QubmFtZScsICd0LnR5cGUubmFtZScpJT4NCiAgICAgICAgICAgICAgICA8JV9kZWYoJ3QuYWN0aXZlJywgdHJ1ZSklPg0KICAgICAgICAgICAgICAgIDwlX2RlZigndC5lbmFibGVkJywgdHJ1ZSklPg0KICAgICAgICAgICAgICAgIDwlX2RlZigndC50eXBlLmFjdGl2ZScsIHRydWUpJT4NCiAgICAgICAgICAgICAgICA8JV9kZWYoJ3QudHlwZS5lbmFibGVkJywgdHJ1ZSklPg0KDQogICAgICAgICAgICAgICAgPCVfZGVmKCd0LnRvb2xfQ29uZmlncycsICdbXScpJT47DQogICAgICAgICAgICAgICAgPCVfZGVmKCd0LnR5cGUudHlwZV9Db25maWdzJywgJ1tdJyklPjsNCiAgICAgICAgICAgICAgICA8JV9kZWYoJ3QudHlwZS50eXBlX01hcHBpbmdzJywgJ1tdJyklPjsNCiAgICAgICAgICAgICAgICA8JV9kZWYoJ3QudG9vbF9NYXBwaW5ncycsICdbXScpJT47DQogICAgDQogICAgICAgICAgICAgICAgW10uY29uY2F0KHQudG9vbF9Db25maWdzLCB0LnR5cGUudHlwZV9Db25maWdzLCB0LnR5cGUudHlwZV9NYXBwaW5ncywgdC50b29sX01hcHBpbmdzKS5mb3JFYWNoKGMgPT4gew0KICAgICAgICAgICAgICAgICAgICA8JV9kZWYoJ2MuYWN0aXZlJywgdHJ1ZSklPg0KICAgICAgICAgICAgICAgICAgICA8JV9kZWYoJ2MuZW5hYmxlZCcsIHRydWUpJT4NCiAgICAgICAgICAgICAgICAgICAgPCVfZGVmKCdjLklkJywgJ3RoaXMuX3V1aWQoKScpJT4NCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIH0pOw0KICAgIA0KICAgICAgICAgICAgdG9vbHMuZmlsdGVyKHQgPT4gdHlwZW9mKHQpPT09J29iamVjdCcgJiYgdCkuZm9yRWFjaCh0ID0+IFsndG9vbF9Db25maWdzJywgJ3R5cGUudHlwZV9Db25maWdzJ10uZm9yRWFjaChzQ29uZmlnID0+IHsNCiAgICAgICAgICAgICAgICAgICAgRG90T2JqZWN0LnNldChzQ29uZmlnLCBEb3RPYmplY3QucGljayhzQ29uZmlnLCB0KS5maWx0ZXIoYyA9PiB0eXBlb2YoYy52YWx1ZSkhPT0ib2JqZWN0IikuY29uY2F0KERvdE9iamVjdC5waWNrKHNDb25maWcsIHQpLmZpbHRlcihjID0+IHR5cGVvZihjLnZhbHVlKT09PSJvYmplY3QiICYmIGMudmFsdWUpLm1hcChjID0+IE9iamVjdC5rZXlzKGMudmFsdWUpLm1hcChuY29kZSA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICBsZXQgX2MgPSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogYy5uYW1lLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBjLnZhbHVlW25jb2RlXSwNCiAgICAgICAgICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgICAgICAgICBpZihuY29kZSE9ImRlZmF1bHQiKXsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfYy5ub2RlID0gew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2RlOiBuY29kZSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aXZlOiB0cnVlLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmFibGVkOiBmYWxzZSwgPCUvLyBvdGhlcndpc2UgaXQgc3RhcnRzIGdldHRpbmcgZXZlbnRzJT4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIk5vZGVKUyIsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jOw0KICAgICAgICAgICAgICAgICAgICB9KS5mbGF0KCkpLmZsYXQoKSksIHQpOw0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgLy9Eb3RPYmplY3QucGljayhzQ29uZmlnLCB0KS5mb3JFYWNoKGMgPT4gYy52YWx1ZSA9IEpTT04uc3RyaW5naWZ5KGMudmFsdWUpKTsgLy8/Pw0KICAgICAgICAgICAgICAgIH0pDQogICAgICAgICAgICApOw0KICAgICAgICB9Ow0KDQoNCiAgICAgICAgZml4VG9vbHModG9vbHMpOw0KICAgICAgICB0b29scyA9IHRvb2xzLmZpbHRlcih0ID0+IHQuYWN0aXZlKTsNCiAgICAgICAgdG9vbHMgPSB0b29scy5maWx0ZXIodCA9PiB0b29sTmFtZXMuZmluZChfdCA9PiAodHlwZW9mKF90KT09PSdzdHJpbmcnP190Ol90Lm5hbWUpPT10Lm5hbWUpKTsNCg0KICAgICAgICA8JT1sb2coKSU+YFRvb2xzIGFyZSAke3Rvb2xzLmxlbmd0aH1gKTsNCg0KICAgICAgICA8JT1zY29wZSU+LlRvb2xzID0gdG9vbHM7DQoNCiAgICAgICAgPCU9c2NvcGUlPi5Ub29scy5maWx0ZXIodCA9PiAhdC5heGlvcyAmJiA8JT1KU09OLnN0cmluZ2lmeShfcmVzdFRvb2xzKSU+LmluZGV4T2YodC50eXBlLm5hbWUpPj0wKS5mb3JFYWNoKHQgPT4gew0KICAgICAgICAgICAgdC5heGlvcyA9IHR5cGVvZihheGlvcy5jcmVhdGUpPT09J2Z1bmN0aW9uJz9heGlvcy5jcmVhdGUoKTpheGlvczsNCiAgICAgICAgICAgIHQuYXhpb3MuaW50ZXJjZXB0b3JzLnJlcXVlc3QudXNlKHJlcXVlc3QgPT4gdGhpcy5fcmVxdWVzdEludGVyY2VwdG9yKHJlcXVlc3QsIHQpLCBlcnJvciA9PiB7fSk7DQogICAgICAgICAgICB0LmF4aW9zLmludGVyY2VwdG9ycy5yZXNwb25zZS51c2UocmVzcG9uc2UgPT4gcmVzcG9uc2UsIGVycm9yID0+IHRoaXMuX3Jlc3BvbnNlSW50ZXJjZXB0b3IoZXJyb3IsIHQpKTsNCiAgICAgICAgfSk7DQogICAgICAgIA0KICAgICAgICAvLyBjb25uZWN0IHRvIHRoZSBsb2FkZWQgdG9vbHMhISENCiAgICAgICAgbGV0IHRvb2wgPSB0aGlzLlRvb2w7DQogICAgICAgIGZvciBhd2FpdCAoY29uc3QgdCBvZiA8JT1zY29wZSU+LlRvb2xzKXsNCjwlIHNyLmdyb3VwQnkoYXJDbGFzc2VzLCAnRW50aXR5TW9kdWxlJykuZm9yRWFjaChlbSA9PiB7ZW0udmFsdWVzID0gZW0udmFsdWVzLnNvcnQoKGEsIGIpID0+IGIuUmFuayAtIGEuUmFuayk7ICU+DQogICAgICAgICAgICBhd2FpdCBuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUoZW0udmFsdWVzW2VtLnZhbHVlcy5sZW5ndGgtMV0sIHRydWUpJT4odW5kZWZpbmVkLCB0KS5fc3RvcmVFbnRpdHlDbGFzcygpOw0KPCUgfSklPg0KICAgICAgICB9DQogICAgICAgIHRoaXMuVG9vbCA9IHRvb2w7DQogICAgICAgIA0KICAgICAgICBhclRvb2xzID0gYXJUb29scy5maWx0ZXIoX3QgPT4gIXRvb2xzLmZpbmQodCA9PiAodHlwZW9mKF90KT09PSdzdHJpbmcnP190Ol90Lm5hbWUpPT10Lm5hbWUpKTsNCiAgICAgICAgZml4VG9vbHMoYXJUb29scyk7DQoNCjwlIGlmKF9jTmFtZSgnVG9vbCcpKXslPg0KICAgICAgICA8JT1zY29wZSU+Lm9Ub29scyA9IDwlPXNjb3BlJT4uVG9vbHMuY29uY2F0KGFyVG9vbHMpLmZpbHRlcih0ID0+IHQuYWN0aXZlKS5tYXAodCA9PiB7DQogICAgICAgICAgICB0LnRvb2xfTWFwcGluZ3MuZm9yRWFjaChtID0+IGRlbGV0ZSBtLnRvb2wpOw0KICAgICAgICAgICAgdC50eXBlLnR5cGVfTWFwcGluZ3MuZm9yRWFjaChtID0+IGRlbGV0ZSBtLnR5cGUpOw0KICAgIA0KICAgICAgICAgICAgcmV0dXJuIG5ldyA8JT1zY29wZSU+LjwlPV9jTmFtZSgnVG9vbCcsIHRydWUpJT4oKS5fZnJvbURvY3VtZW50KHQpOw0KICAgICAgICB9KTsNCiAgICAgICAgaWYoYlN0b3JlKXsNCiAgICAgICAgICAgIDwlPWxvZygpJT5gU2F2aW5nIHRvb2xzLi4uYCk7DQogICAgICAgICAgICBmb3IgYXdhaXQgKGNvbnN0IHQgb2YgPCU9c2NvcGUlPi5vVG9vbHMpew0KICAgICAgICAgICAgICAgIGF3YWl0IHQuc3RvcmUoKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KPCUgfSU+DQoNCiAgICAgICAgPCU9bG9nKCklPmBFeGl0aW5nYCk7DQogICAgICAgIHJldHVybiB0b29sczsNCiAgICB9DQogICAgDQo8JSB9IC8vIG1haW5DbGFzcyAlPg0KDQoJPCU9bU5hbWU9J19wYXJhbWV0cml6ZSclPihzdHIsIGZ1biwgb3B0aW9ucz17fSwgcHJlZml4PSd7eycsIHBvc3RmaXg9J319Jykgew0KPCUgaWYobWFpbkNsYXNzKCk9PWMpeyU+DQogICAgICAgIHRyeXsNCiAgICAgICAgICAgIGlmKHR5cGVvZihzdHIpIT09J3N0cmluZycpIHJldHVybiBzdHI7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGxldCByZXggPSBgJHtwcmVmaXh9KFteJHtwb3N0Zml4fV0rKSR7cG9zdGZpeH1gOw0KICAgICAgICAgICAgKHN0ci5tYXRjaChuZXcgUmVnRXhwKHJleCwgImciKSkgfHwgW10pLmZvckVhY2gobSA9PiBzdHIgPSBzdHIucmVwbGFjZShtLCBtID0+IGZ1bihtLnJlcGxhY2UocHJlZml4LCAnJykucmVwbGFjZShwb3N0Zml4LCAnJykpKSk7DQoNCiAgICAgICAgICAgIHJldHVybiBzdHI7DQogICAgICAgIH1jYXRjaChleCl7DQogICAgICAgICAgICA8JT1lcnJvcigpJT5leCk7DQogICAgICAgIH0NCjwlIH1lbHNleyU+DQogICAgICAgIHJldHVybiBuZXcgPCU9c2NvcGUlPi48JT1uTmFtZShtYWluQ2xhc3MoKSklPigpLjwlPW1OYW1lJT4oc3RyLCBmdW4sIG9wdGlvbnMsIHByZWZpeCwgcG9zdGZpeCk7DQo8JSB9JT4NCgl9DQoNCiAgICA8JT1tTmFtZT0nX19zeW5jX29uJyU+KGQpew0KICAgICAgICB0aGlzLl88JT1tTmFtZSU+ID0gdGhpcy5fPCU9bU5hbWUlPiB8fCB7fTsNCiAgICANCiAgICAgICAgaWYoZCl7IC8vIHNldCB0aGUgdmFsdWUNCiAgICAgICAgICAgIHRoaXMuXzwlPW1OYW1lJT5bdGhpcy5Ub29sLm5hbWVdID0gZDsNCg0KICAgICAgICAgICAgcmV0dXJuIHRoaXMuX19pbXBvcnQodGhpcywgew0KICAgICAgICAgICAgICAgIEN5Y2xpYzogdHJ1ZSwNCjwlIGMuRW50aXR5QXR0cmlidXRlcy5maWx0ZXIoZWEgPT4gIWVhLkVudGl0eU1ldGhvZCAmJiBlYS5FbnRpdHlUeXBlKS5mb3JFYWNoKGVhID0+IHslPg0KICAgICAgICAgICAgICAgIDwlPW5OYW1lKGVhKSU+OiAob2JqLCBlYUNvZGUpID0+IHRoaXMuPCU9bk5hbWUoZWEpJT4oKT90aGlzLjwlPW5OYW1lKGVhKSU+KCkuPCU9bU5hbWUlPihkKTp1bmRlZmluZWQsDQo8JSB9KSU+DQoNCjwlIGMuVHlwZWRBdHRyaWJ1dGVzLmZvckVhY2godGEgPT4geyBsZXQgdGFOYW1lID0gbk5hbWUodGEpICsgJ18nICsgdGEuRW50aXR5Q2xhc3MuUGx1cmFsLnJlcGxhY2UoLyAvZywgJ18nKTslPg0KICAgICAgICAgICAgICAgIC8vPCU9dGFOYW1lJT46IHRoaXMuPCU9dGFOYW1lJT4oKS5mb3JFYWNoKHQgPT4gdC48JT1tTmFtZSU+KGQpKSwNCjwlIH0pJT4NCiAgICAgICAgICAgIH0sICI8JT1tTmFtZSU+IiwgZCk7DQoNCg0KPCUgYy5FbnRpdHlBdHRyaWJ1dGVzLmZpbHRlcihlYSA9PiAhZWEuRW50aXR5TWV0aG9kICYmIGVhLkVudGl0eVR5cGUpLmZvckVhY2goZWEgPT4geyU+DQogICAgICAgICAgICBpZih0aGlzLl88JT1uTmFtZShlYSklPl9zZXQgJiYgdGhpcy48JT1uTmFtZShlYSklPigpKSB0aGlzLjwlPW5OYW1lKGVhKSU+KCkuPCU9bU5hbWUlPihkKTsNCjwlIH0pJT4NCg0KPCUgYy5UeXBlZEF0dHJpYnV0ZXMuZm9yRWFjaCh0YSA9PiB7IGxldCB0YU5hbWUgPSBuTmFtZSh0YSkgKyAnXycgKyB0YS5FbnRpdHlDbGFzcy5QbHVyYWwucmVwbGFjZSgvIC9nLCAnXycpOyU+DQogICAgICAgICAgICAvLyB0aGlzLjwlPXRhTmFtZSU+KCkuZm9yRWFjaCh0ID0+IHQuPCU9bU5hbWUlPihkKSk7DQo8JSB9KSU+DQogICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgfQ0KDQogICAgICAgIHJldHVybiB0aGlzLl88JT1tTmFtZSU+W3RoaXMuVG9vbC5uYW1lXTsgLy8gZ2V0IHRoZSB2YWx1ZQ0KICAgIH0NCiAgICANCiAgICA8JT1tTmFtZT0nX2Nsb25lJyU+KGJUeXBlQXR0cmlidXRlcyl7DQogICAgICAgIDwlPXdhcm4oKSU+IkRFUFJFQ0FURUQ6IHVzZSBuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUoYy5OYW1lLCB0cnVlKSU+KCkuX2Zyb21Eb2N1bWVudCh0aGlzLl90b0pTT04oKSkiKTsNCg0KICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgDQogICAgICAgIHRyeXsNCiAgICAgICAgICAgIHJldHVybiB0aGlzLl9fZXhwb3J0KG5ldyA8JT1zY29wZSU+LjwlPV9jTmFtZShjLk5hbWUsIHRydWUpJT4oKSwgew0KPCUgYy5FbnRpdHlBdHRyaWJ1dGVzLmZpbHRlcihlYSA9PiAhZWEuRW50aXR5TWV0aG9kKS5mb3JFYWNoKGVhID0+IHslPg0KICAgICAgICAgICAgICAgIDwlPW5OYW1lKGVhKSU+OiAob2JqLCBlYUNvZGUsIHYpID0+IG9iai48JT1uTmFtZShlYSklPih2PCVpZihlYS5FbnRpdHlUeXBlKXslPi48JT1tTmFtZSU+KGJUeXBlQXR0cmlidXRlcyk8JX0lPiksDQo8JSB9KTslPg0KPCUgYy5UeXBlZEF0dHJpYnV0ZXMuZm9yRWFjaCh0YSA9PiB7IGxldCB0YU5hbWUgPSBuTmFtZSh0YSkgKyAnXycgKyB0YS5FbnRpdHlDbGFzcy5QbHVyYWwucmVwbGFjZSgvIC9nLCAnXycpOyU+DQogICAgICAgICAgICAgICAgPCU9dGFOYW1lJT46IChvYmosIGVhQ29kZSwgdikgPT4gYlR5cGVBdHRyaWJ1dGVzP29iai48JT10YU5hbWUlPih2Lm1hcChfdiA9PiBfdi48JT1tTmFtZSU+KGJUeXBlQXR0cmlidXRlcykpKTpudWxsLA0KPCUgfSk7JT4NCiAgICAgICAgICAgIH0sICI8JT1tTmFtZSU+Iik7DQogICAgICAgIH1jYXRjaChleCl7DQogICAgICAgICAgICA8JT1lcnJvcigpJT5leCk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICA8JT1tTmFtZT0nX21hcCclPihjb2RlLCBiUmV2ZXJzZSwgY29udGV4dCwgb2JqRnJvbSwgb2JqVG8sIGVhQ29kZSwgY2xhc3NOYW1lLCB0b29sLCBjb2RlVHlwZSwgX3RoaXMsIG1vZHVsZU5hbWUpew0KICAgICAgICBfdGhpcyA9IF90aGlzIHx8IHRoaXM7DQogICAgICAgIGNvbnRleHQgPSBjb250ZXh0IHx8ICdFbnRpdHlBdHRyaWJ1dGUnOw0KICAgICAgICB0b29sID0gdG9vbCB8fCBfdGhpcy5Ub29sOw0KICAgICAgICBjb2RlVHlwZSA9IGNvZGVUeXBlIHx8IDwlPV9lYVR5cGVzKCklPltjb2RlXTsNCiAgICAgICAgY2xhc3NOYW1lID0gY2xhc3NOYW1lIHx8ICI8JT1uTmFtZShjKSU+IjsNCiAgICAgICAgbW9kdWxlTmFtZSA9IG1vZHVsZU5hbWUgfHwgIjwlPWMuRW50aXR5TW9kdWxlP2MuRW50aXR5TW9kdWxlLk5hbWU6JyclPiI7DQoNCjwlIGlmKG1haW5DbGFzcygpIT1jKXslPg0KICAgICAgICByZXR1cm4gbmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKG1haW5DbGFzcygpLCB0cnVlKSU+KCkuPCU9bU5hbWUlPihjb2RlLCBiUmV2ZXJzZSwgY29udGV4dCwgb2JqRnJvbSwgb2JqVG8sIGVhQ29kZSwgY2xhc3NOYW1lLCB0b29sLCBjb2RlVHlwZSwgX3RoaXMsIG1vZHVsZU5hbWUpOw0KPCUgfWVsc2V7JT4NCiAgICAgICAgdHJ5ew0KICAgICAgICAgICAgbGV0IF9sb2cgPSBgJHttb2R1bGVOYW1lfS4ke2NsYXNzTmFtZX0uJHtjb250ZXh0fSR7YlJldmVyc2U/Jzw9JzonPT4nfSR7Y29kZX1gOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAvL2lmKEFycmF5LmlzQXJyYXkob2JqRnJvbSkpIHJldHVybiBvYmpGcm9tLm1hcChvID0+IHRoaXMuPCU9bU5hbWUlPihjb2RlLCBiUmV2ZXJzZSwgY29udGV4dCwgbywgb2JqVG8sIGVhQ29kZSwgY2xhc3NOYW1lLCB0b29sLCBjb2RlVHlwZSwgX3RoaXMsIG1vZHVsZU5hbWUpKTsNCiAgICAgICAgDQogICAgICAgICAgICA8JSAvKiB0ZW1wdGVkIHRvIHVzZSBqc29uYXRhIGluIFF1ZXJ5IGZpZWxkcywgZG9lcyBub3Qgd29yayBiZWNhdXNlIGpzb25hdGEuZXZhbHVhdGUgcmV0dXJuIGEgcHJvbWlzZSEhISAqLyU+DQogICAgICAgICAgICBsZXQgc0ZpZWxkID0gYlJldmVyc2U/J3RhcmdldCc6J3NvdXJjZSc7DQogICAgICAgICAgICBsZXQgc1NjcmlwdCA9IChiUmV2ZXJzZT8nb3V0JzonaW4nKSsnU2NyaXB0JzsNCiAgICAgICAgICAgIGxldCBzQ29uZCA9IChiUmV2ZXJzZT8nb3V0JzonaW4nKSsnQ29uZGl0aW9uJzsNCiAgICAgICAgICAgIGxldCBzUGF0aCA9IChiUmV2ZXJzZT8nb3V0JzonaW4nKSsnUGF0aCc7DQogICAgICAgICAgICBsZXQgdEZpZWxkID0gYlJldmVyc2U/J3NvdXJjZSc6J3RhcmdldCc7DQogICAgICAgICAgICBsZXQgdFNjcmlwdCA9IChiUmV2ZXJzZT8naW4nOidvdXQnKSsnU2NyaXB0JzsNCiAgICAgICAgICAgIGxldCB0UGF0aCA9IChiUmV2ZXJzZT8naW4nOidvdXQnKSsnUGF0aCc7DQogICAgICAgICAgICBsZXQgdENvbmQgPSAoYlJldmVyc2U/J2luJzonb3V0JykrJ0NvbmRpdGlvbic7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGxldCBsb2cgPSAoLi4ucykgPT4gPCU9bG9nKCklPmNsYXNzTmFtZSwgX2xvZywgLi4ucyk7DQogICAgICAgICAgICBsZXQgd2FybiA9ICguLi5zKSA9PiA8JT13YXJuKCklPmNsYXNzTmFtZSwgX2xvZywgLi4ucyk7DQogICAgICAgICAgICBsZXQgZXJyb3IgPSAoLi4ucykgPT4gPCU9ZXJyb3IoKSU+Y2xhc3NOYW1lLCBfbG9nLCAuLi5zKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgbGV0IG9wdGlvbnMgPSB7X2NsYXNzOiBjbGFzc05hbWUsIF90aGlzOiBfdGhpcywgdG9vbDogdG9vbH07DQogICAgICAgICAgICANCiAgICAgICAgICAgIGxldCBfc2NyaXB0ID0gKHMsIG0pID0+IHsNCiAgICAgICAgICAgICAgICB0cnl7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnJ1blNjcmlwdChgKG9TY29wZSwgbSwgb2JqRnJvbSwgb2JqVG8sIGNvZGUsIF90aGlzLCBjbGFzc05hbWUsIHRvb2wsIGNvZGVUeXBlLCBlYUNvZGUsIGJSZXZlcnNlLCBjb250ZXh0LCBsb2csIHdhcm4sIGVycm9yKSA9PiAke3N9YCkoPCU9c2NvcGUlPiwgbSwgb2JqRnJvbSwgb2JqVG8sIGNvZGUsIF90aGlzLCBjbGFzc05hbWUsIHRvb2wsIGNvZGVUeXBlLCBlYUNvZGUsIGJSZXZlcnNlLCBjb250ZXh0LCBsb2csIHdhcm4sIGVycm9yKTsNCiAgICAgICAgICAgICAgICB9Y2F0Y2goZXgpew0KICAgICAgICAgICAgICAgICAgICB3YXJuKG0udGVzdHMubG9nLCBleCk7IA0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH07DQogICAgICAgICAgICANCiAgICAgICAgICAgIGxldCBfbWF0Y2ggPSAocywgcikgPT4gew0KICAgICAgICAgICAgICAgIGlmKHR5cGVvZihzKT09PSd1bmRlZmluZWQnIHx8IHM9PT1udWxsIHx8IHR5cGVvZihzLm1hdGNoKSE9PSdmdW5jdGlvbicpIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgICAgICBsZXQgYW5zd2VyID0gcy5tYXRjaChuZXcgUmVnRXhwKHIsICdnJykpOw0KICAgICAgICAgICAgICAgIHJldHVybiBzPT1yIHx8ICgoYW5zd2VyICYmIGFuc3dlci5sZW5ndGgpP3RydWU6ZmFsc2UpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBjb25zdCBjbG9uZSA9IGl0ZW1zID0+IGl0ZW1zLm1hcChpdGVtID0+IEFycmF5LmlzQXJyYXkoaXRlbSkgPyBjbG9uZShpdGVtKSA6IGl0ZW0pOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBsZXQgbXMgPSBjbG9uZSggWy4uLih0b29sLnRvb2xfTWFwcGluZ3MgfHwgW10pLmNvbmNhdCh0b29sLnR5cGUudHlwZV9NYXBwaW5ncyB8fCBbXSldICk7IC8vIGRvIG5vdCB0YW1wZXIgd2l0aCB0aGUgbWFwcGluZ3MsIGRlZXAgY2xvbmUNCiAgICAgICAgICAgIG1zLmZvckVhY2gobSA9PiBPYmplY3Qua2V5cyhtKS5mb3JFYWNoKGsgPT4gbVtrXSA9IHRoaXMuX3BhcmFtZXRyaXplKG1ba10sIHAgPT4gdGhpcy5fX2NvbmZpZyhwKSB8fCBEb3RPYmplY3QucGljayhwLCBvcHRpb25zKSwgb3B0aW9ucykpKTsNCiAgICAgICAgICAgIG1zLmZvckVhY2gobSA9PiBtLnRlc3RzID0gew0KICAgICAgICAgICAgICAgIGFjdGl2ZTogPCV2YWx1ZU9mKCJtLmFjdGl2ZSIpJT4sIC8vX3NjcmlwdChtLmFjdGl2ZSwgbSksDQogICAgICAgICAgICAgICAgZW5hYmxlZDogPCV2YWx1ZU9mKCJtLmVuYWJsZWQiKSU+LCAvL19zY3JpcHQobS5lbmFibGVkLCBtKSwNCiAgICAgICAgICAgICAgICBjb250ZXh0OiBfbWF0Y2goY29udGV4dCwgbS5jb250ZXh0KSwNCiAgICAgICAgICAgICAgICBjbGFzczogX21hdGNoKGNsYXNzTmFtZSwgbS5jbGFzc05hbWUpLA0KICAgICAgICAgICAgICAgIG1vZHVsZTogX21hdGNoKG1vZHVsZU5hbWUsIG0ubW9kdWxlTmFtZSksDQogICAgICAgICAgICAgICAgc0ZpZWxkOiB0eXBlb2YoY29kZSk9PT0ndW5kZWZpbmVkJyB8fCBfbWF0Y2goY29kZSwgbVtzRmllbGRdKSwNCiAgICAgICAgICAgICAgICBzU2NyaXB0OiB0eXBlb2YoY29kZSk9PT0ndW5kZWZpbmVkJyB8fCB0eXBlb2YobVtzU2NyaXB0XSkhPT0ndW5kZWZpbmVkJywNCiAgICAgICAgICAgICAgICBzUGF0aDogdHlwZW9mKG1bc1BhdGhdKSE9PSd1bmRlZmluZWQnLA0KICAgICAgICAgICAgICAgIHRhcmdldDogdHlwZW9mKG1bdEZpZWxkXSB8fCBtW3RTY3JpcHRdIHx8IG1bdFBhdGhdKSE9PSd1bmRlZmluZWQnLA0KICAgICAgICAgICAgICAgIHRleHQ6IGAke2NvZGV9OiR7c0ZpZWxkfT09PiR7dEZpZWxkfWAsDQogICAgICAgICAgICAgICAgbG9nOiBgJHtfbG9nfVske20uY29udGV4dH0vJHttLmNsYXNzTmFtZX1dYCwNCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgbXMgPSBtcy5maWx0ZXIobSA9PiBtLnRlc3RzLmFjdGl2ZSAmJiBtLnRlc3RzLmVuYWJsZWQgJiYgbS50ZXN0cy5jb250ZXh0ICYmIG0udGVzdHMuY2xhc3MgJiYgbS50ZXN0cy5tb2R1bGUgJiYgKG0udGVzdHMuc0ZpZWxkIHx8IG0udGVzdHMuc1NjcmlwdCB8fCBtLnRlc3RzLnNQYXRoKSAmJiBtLnRlc3RzLnRhcmdldCkuc29ydCgoYSwgYikgPT4gYS5vcmRlciAtIGIub3JkZXIpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICA8JSAvKiB3ZSBtaWdodCBub3Qgd29yayB3aXRoIGFsbCBtcyBlbnRyaWVzLiBsb2cgaGVyZSBpcyBvbmx5IGEgcHJldmlldyBvZiB3aGF0IG1pZ2h0IHdvcmshICovICU+DQogICAgICAgICAgICAvL2lmKG1zLmZpbHRlcihtID0+IG0uZGVidWcpLmxlbmd0aCkgbG9nKHRoaXMuX2JlYXV0aWZ5KG1zLmZpbHRlcihtID0+IG0uZGVidWcpLCAnamF2YXNjcmlwdCcpKTsNCg0KICAgICAgICAgICAgbXMuZm9yRWFjaChtID0+IHsNCiAgICAgICAgICAgICAgICBpZihtW3RTY3JpcHRdKXsNCiAgICAgICAgICAgICAgICAgICAgaWYodHlwZW9mKG1bdENvbmRdKT09PSd1bmRlZmluZWQnIHx8IDwldmFsdWVPZigibVt0Q29uZF0iLCAnX3RoaXMnKSU+KXsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmKG0uZGVidWcpIGxvZyhtLnRlc3RzLmxvZyArICc6ICcgKyB0U2NyaXB0LCAnPCU9bU5hbWUlPicsIG1bdFNjcmlwdF0pOw0KICAgICAgICAgICAgICAgICAgICAgICAgY29kZSA9IDwldmFsdWVPZigibVt0U2NyaXB0XSIsICdfdGhpcycpJT4NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICBpZihtW3NQYXRoXSAmJiB0eXBlb2Yoam1lc3BhdGgpIT09J3VuZGVmaW5lZCcpIGNvZGUgPSBqbWVzcGF0aC5zZWFyY2gob2JqRnJvbSwgbVtzUGF0aF0pOw0KICAgICAgICAgICAgICAgIGlmKG1bc1BhdGhdICYmIHR5cGVvZihqc29ucGF0aCkhPT0ndW5kZWZpbmVkJykgY29kZSA9IGpzb25wYXRoLnF1ZXJ5KG9iakZyb20sIG1bc1BhdGhdKTsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICBpZihtW3RGaWVsZF0pew0KICAgICAgICAgICAgICAgICAgICBsZXQgZFBhdGggPSAnJzsNCiAgICAgICAgICAgICAgICAgICAgaWYodHlwZW9mKG1bdEZpZWxkXSk9PT0nZnVuY3Rpb24nKXsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmKHR5cGVvZihjb2RlKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkUGF0aCA9IGAke2NvZGV9LnJlcGxhY2VgOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvZGUgPSBjb2RlLnJlcGxhY2UobmV3IFJlZ0V4cChtW3NGaWVsZF0sICdnJyksIG1bdEZpZWxkXSk7DQogICAgICAgICAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL2NvZGUgPSBEb3RPYmplY3QuY29weShtW3NGaWVsZF0sIG1bdEZpZWxkXSwgb2JqRnJvbSwgb2JqVG8pOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmKHR5cGVvZihjb2RlKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihfbWF0Y2goY29kZSwgbVtzRmllbGRdKSl7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRQYXRoID0gYCR7Y29kZX0uY29kZWA7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvZGUgPSBtW3RGaWVsZF07DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZFBhdGggPSBgZG90Y29weWA7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29kZSA9IERvdE9iamVjdC5jb3B5KG1bc0ZpZWxkXSwgbVt0RmllbGRdLCBvYmpGcm9tLCBvYmpUbyk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIGlmKG0uZGVidWcgJiYgZFBhdGgpIGxvZyhgJHttLnRlc3RzLmxvZ30vJHtkUGF0aH1bY29kZT0ke2NvZGV9XTogJHttW3NGaWVsZF19ID0+ICR7bVt0RmllbGRdfWApOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICBpZihtW3RQYXRoXSAmJiB0eXBlb2Yoam1lc3BhdGgpIT09J3VuZGVmaW5lZCcgJiYgKCFtW3RDb25kXSB8fCBqbWVzcGF0aC5zZWFyY2gob2JqVG8sIG1bdENvbmRdKSkpIG9ialRvW21bdEZpZWxkXV0gPSBqbWVzcGF0aC5zZWFyY2gob2JqVG8sIG1bdFBhdGhdKTsNCiAgICAgICAgICAgICAgICBpZihtW3RQYXRoXSAmJiB0eXBlb2YoanNvbnBhdGgpIT09J3VuZGVmaW5lZCcgJiYgKCFtW3RDb25kXSB8fCBqc29ucGF0aC5xdWVyeShvYmpUbywgbVt0Q29uZF0pKSkgb2JqVG9bbVt0RmllbGRdXSA9IGpzb25wYXRoLnF1ZXJ5KG9ialRvLCBtW3RQYXRoXSk7DQogICAgICAgICAgICB9KTsNCg0KICAgICAgICAgICAgbXMuZm9yRWFjaChtID0+IGRlbGV0ZSBtLnRlc3RzKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKGNvZGUpPT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHJldHVybiBvYmpUbzsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgLy9pZihjb250ZXh0PT0nRW50aXR5Q2xhc3MnICYmIGNsYXNzTmFtZT09J1VzZXInKSA8JT13YXJuKCklPiJHT1QgSEVSRSIsIGNvZGUsIGNvbnRleHQsIG9wdGlvbnMpOw0KICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3BhcmFtZXRyaXplKGNvZGUsIHAgPT4gdGhpcy5fX2NvbmZpZyhwKSB8fCBEb3RPYmplY3QucGljayhwLCBvcHRpb25zKSwgb3B0aW9ucyk7DQogICAgICAgIH1jYXRjaChleCl7DQogICAgICAgICAgICA8JT1lcnJvcigpJT5leCk7DQogICAgICAgIH0NCjwlIH0lPg0KICAgIH0NCiAgICANCiAgICA8JT1tTmFtZT0nX25Db2RlJyU+KGNvZGUsIG9Db2RlKXsNCiAgICAgICAgdHJ5ew0KICAgICAgICAgICAgbGV0IGNvbnRleHQgPSAnRW50aXR5QXR0cmlidXRlJzsNCiAgICAgICAgICAgIGlmKCFjb2RlICYmICFvQ29kZSl7DQogICAgICAgICAgICAgICAgY29udGV4dCA9ICdFbnRpdHlDbGFzcyc7DQogICAgICAgICAgICAgICAgY29kZSA9ICI8JT1uQ29kZShjKSU+IjsNCiAgICAgICAgICAgICAgICBvQ29kZSA9IDwlPV9GckVNRC5fdG9KUyhjLkNvZGUpJT47DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGxldCByZXQgPSBjb2RlOw0KICAgICAgICAgICAgaWYob0NvZGUgJiYgdHlwZW9mKG9Db2RlKT09PSdvYmplY3QnKXsNCiAgICAgICAgICAgICAgICByZXQgPSBvQ29kZVt0aGlzLlRvb2wubmFtZV0gfHwgb0NvZGVbdGhpcy5Ub29sLnR5cGUubmFtZV0gfHwgcmV0Ow0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICByZXR1cm4gdGhpcy5fbWFwKHJldCwgZmFsc2UsIGNvbnRleHQpIHx8IHJldDsNCiAgICAgICAgfWNhdGNoKGV4KXsNCiAgICAgICAgICAgIDwlPXdhcm4oKSU+ZXgpOw0KICAgICAgICAgICAgcmV0dXJuIGNvZGU7DQogICAgICAgIH0NCiAgICB9DQogICAgDQogICAgPCU9bU5hbWU9J19fY29uZmlnJyU+KG4sIG51bGxWYWx1ZSwgb3B0aW9ucyl7DQogICAgICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9Ow0KICAgICAgICBvcHRpb25zLl90aGlzID0gb3B0aW9ucy5fdGhpcyB8fCB0aGlzOw0KICAgICAgICBvcHRpb25zLl9jbGFzcyA9IG9wdGlvbnMuX2NsYXNzIHx8ICc8JT1uTmFtZShjKSU+JzsNCiAgICAgICAgb3B0aW9ucy50b29sID0gb3B0aW9ucy50b29sIHx8IG9wdGlvbnMuX3RoaXMuVG9vbCB8fCB0aGlzLlRvb2w7DQogICAgICAgIGlmKHR5cGVvZihvcHRpb25zLnRvb2wpPT09J29iamVjdCcgJiYgb3B0aW9ucy50b29sLmNvbnN0cnVjdG9yLm5hbWU9PSdUb29sJykgb3B0aW9ucy50b29sID0gKDwlPXNjb3BlJT4uVG9vbHMgfHwgW10pLmZpbmQodCA9PiB0Lm5hbWU9PW9wdGlvbnMudG9vbC5uYW1lKCkpOw0KICAgICAgICANCiAgICAgICAgaWYodHlwZW9mKG9wdGlvbnMudG9vbCk9PT0nc3RyaW5nJykgb3B0aW9ucy50b29sID0gKDwlPXNjb3BlJT4uVG9vbHMgfHwgW10pLmZpbmQodCA9PiB0Lm5hbWU9PW9wdGlvbnMudG9vbCB8fCB0LnR5cGUubmFtZT09b3B0aW9ucy50b29sKTsNCg0KPCUgaWYobWFpbkNsYXNzKCkhPWMpeyU+DQogICAgICAgIHJldHVybiBuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUobWFpbkNsYXNzKCksIHRydWUpJT4oKS48JT1tTmFtZSU+KG4sIG51bGxWYWx1ZSwgT2JqZWN0LmFzc2lnbih7X3RoaXM6IHRoaXMsIHRvb2w6IHRoaXMuVG9vbCwgX2NsYXNzOiAnPCU9bk5hbWUoYyklPid9LCBvcHRpb25zIHx8IHt9KSk7DQo8JSB9ZWxzZXslPg0KICAgICAgICB0cnl7DQogICAgICAgICAgICBpZih0eXBlb2Yob3B0aW9ucy50b29sKSE9PSdvYmplY3QnKSA8JT13YXJuKCklPm9wdGlvbnMudG9vbCk7DQogICAgICAgICAgICBpZighb3B0aW9ucy50b29sKSA8JT13YXJuKCklPiJ0b29sIG5vdCBkZWZpbmVkIiwgb3B0aW9ucy5fdGhpcy5Ub29sLCA8JT1zY29wZSU+LlRvb2xzLCBvcHRpb25zLl90aGlzLlRvb2xzKTsNCiAgICAgICAgICAgIC8vb3B0aW9ucy5ub0NhY2hlID0gdHJ1ZTsNCiAgICAgICAgICAgIGlmKCFvcHRpb25zLm5vQ2FjaGUpIDwlPXNjb3BlJT4uPCU9bU5hbWUlPiA9IDwlPXNjb3BlJT4uPCU9bU5hbWUlPiB8fCB7fTsNCg0KICAgICAgICAgICAgbGV0IG5JRCA9IDwlPW5zY29wZSU+Ll9ub2RlPzwlPW5zY29wZSU+Ll9ub2RlLmNvZGUoKTonZGVmYXVsdCc7DQoNCiAgICAgICAgICAgIGlmKHR5cGVvZihvcHRpb25zW25dKSE9PSd1bmRlZmluZWQnKSBudWxsVmFsdWUgPSBudWxsVmFsdWUgfHwgb3B0aW9uc1tuXTsNCiAgICAgICAgICAgIGxldCByZXQgPSBudWxsVmFsdWU7DQogICAgICAgICAgICBpZih0eXBlb2YocmV0KT09PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICByZXQgPSBudWxsOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIHVzZSBzY29wZSBjYWNoZSAoaW1wcm92ZXMgcGVyZm9ybWFuY2U/Pz8pDQogICAgICAgICAgICAgICAgaWYoIW9wdGlvbnMubm9DYWNoZSAmJiBPYmplY3QuaGFzT3duKDwlPXNjb3BlJT4uPCU9bU5hbWUlPiwgYCR7b3B0aW9ucy5fY2xhc3N9LiR7b3B0aW9ucy50b29sLm5hbWV9LiR7bklEfS4ke259YCkpIHJldHVybiA8JT1zY29wZSU+LjwlPW1OYW1lJT5bYCR7b3B0aW9ucy5fY2xhc3N9LiR7b3B0aW9ucy50b29sLm5hbWV9LiR7bklEfS4ke259YF07DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC8vIHRvb2xfQ29uZmlncywgdHlwZV9Db25maWdzOiBhbGxvdyBjbGFzcy1sZXZlbCBhbmQgbm9kZS1sZXZlbCAtIGRvbmUNCiAgICAgICAgICAgIGxldCB0Y29uZiA9IFtdLmNvbmNhdChvcHRpb25zLnRvb2wudHlwZS50eXBlX0NvbmZpZ3MgfHwgW10sIG9wdGlvbnMudG9vbC50b29sX0NvbmZpZ3MgfHwgW10pLmZpbHRlcihjID0+IGMgJiYgYy5uYW1lPT1uICYmICghYy5ub2RlIHx8IGMubm9kZS5jb2RlPT1uSUQpKS5zb3J0KGMgPT4gYy5ub2RlPyhjLm5vZGUuY29kZT09J2RlZmF1bHQnPzA6LTEpOjEpOw0KICAgICAgICAgICAgaWYodGNvbmYubGVuZ3RoKXsNCiAgICAgICAgICAgICAgICBpZih0Y29uZlswXS5zY3JpcHQpew0KICAgICAgICAgICAgICAgICAgICByZXQgPSB0Y29uZlswXS5zY3JpcHQ7DQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBsZXQgX3NjID0gdGhpcy5fcGFyYW1ldHJpemUodGNvbmZbMF0uc2NyaXB0LCBwID0+IHRoaXMuPCU9bU5hbWUlPihwLCBudWxsLCBvcHRpb25zKSB8fCBEb3RPYmplY3QucGljayhwLCBvcHRpb25zKSwgb3B0aW9ucyk7DQogICAgICAgICAgICAgICAgICAgIHJldCA9IDwldmFsdWVPZigiX3NjIiklPjsNCiAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgcmV0ID0gdGNvbmZbMF0udmFsdWU7DQogICAgICAgICAgICAgICAgICAgIHRyeXsNCiAgICAgICAgICAgICAgICAgICAgICAgIFsxLDIsM10uZm9yRWFjaChhID0+IHJldCA9IEpTT04ucGFyc2UocmV0KSk7DQogICAgICAgICAgICAgICAgICAgIH1jYXRjaChqZXgpe30NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZihvcHRpb25zLm5ld1ZhbHVlKXsNCiAgICAgICAgICAgICAgICBsZXQgdGMgPSB0Y29uZi5sZW5ndGg/dGNvbmZbMF06e307DQogICAgICAgICAgICAgICAgaWYob3B0aW9ucy5ub2RlKSB0Yy5ub2RlID0ge2NvZGU6IG9wdGlvbnMubm9kZS5jb2RlKCl9Ow0KICAgICAgICAgICAgICAgIHRjLnZhbHVlID0gb3B0aW9ucy5uZXdWYWx1ZTsNCiAgICAgICAgICAgICAgICB0Yy5uYW1lID0gbjsNCiAgICAgICAgICAgICAgICBpZighdGNvbmYubGVuZ3RoKXsNCiAgICAgICAgICAgICAgICAgICAgKG9wdGlvbnMudG9vbC50b29sX0NvbmZpZ3MgfHwgb3B0aW9ucy50b29sLnR5cGUudHlwZV9Db25maWdzKS5wdXNoKHRjKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgcmV0ID0gb3B0aW9ucy5uZXdWYWx1ZTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgLy8gbW9kZWwgQ29uZmlnOiBDb25maWcgaXMgY2xhc3MgbGV2ZWwsIG5vZGUgbm90IHBvc3NpYmxlIC0gcGVuZGluZw0KICAgICAgICAgICAgbGV0IG1jb25mID0gb3B0aW9ucy5fdGhpcy5Db25maWc/b3B0aW9ucy5fdGhpcy5Db25maWdbbl06dW5kZWZpbmVkOw0KICAgICAgICAgICAgbWNvbmYgPSB0aGlzLl9wYXJhbWV0cml6ZShtY29uZiwgcCA9PiB0aGlzLjwlPW1OYW1lJT4ocCwgbnVsbCwgb3B0aW9ucykgfHwgRG90T2JqZWN0LnBpY2socCwgb3B0aW9ucyksIG9wdGlvbnMpOw0KICAgICAgICAgICAgbWNvbmYgPSA8JXZhbHVlT2YoIm1jb25mIiklPjsNCiAgICAgICAgICAgIGlmKHR5cGVvZihtY29uZikhPT0idW5kZWZpbmVkIikgcmV0ID0gbWNvbmY7DQoNCiAgICAgICAgICAgIC8vIGNvbW1hbmQgbGluZTogYWxsb3cgY2xhc3MtbGV2ZWwgYW5kIG5vZGUtbGV2ZWwgLSBwZW5kaW5nDQogICAgICAgICAgICBpZih0eXBlb2YoZ2xvYmFsKSE9PSd1bmRlZmluZWQnICYmIGdsb2JhbC5taW5pbWlzdCl7DQogICAgICAgICAgICAgICAgcmV0ID0gRG90T2JqZWN0LnBpY2sobiwgZ2xvYmFsLm1pbmltaXN0KHByb2Nlc3MuYXJndi5zbGljZSgyKSkpIHx8IHJldDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgLy8gcmVxdWVzdDogYWxsb3cgY2xhc3MtbGV2ZWwgYW5kIG5vZGUtbGV2ZWwgLSBwZW5kaW5nDQogICAgICAgICAgICBpZih0aGlzLiRfUkVRVUVTVCkgcmV0ID0gdGhpcy4kX1JFUVVFU1QobikgfHwgcmV0Ow0KICAgICAgICAgICAgDQogICAgICAgICAgICAvLyBjb25maWcgcmVwbGFjZW1lbnQNCiAgICAgICAgICAgIHJldCA9IHRoaXMuX3BhcmFtZXRyaXplKHJldCwgcCA9PiB0aGlzLjwlPW1OYW1lJT4ocCwgbnVsbCwgb3B0aW9ucykgfHwgRG90T2JqZWN0LnBpY2socCwgb3B0aW9ucyksIG9wdGlvbnMpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBpZighb3B0aW9ucy5ub0NhY2hlKSA8JT1zY29wZSU+LjwlPW1OYW1lJT5bYCR7b3B0aW9ucy5fY2xhc3N9LiR7b3B0aW9ucy50b29sLm5hbWV9LiR7bklEfS4ke259YF0gPSByZXQ7DQogICAgICAgICAgICANCiAgICAgICAgICAgIHJldCA9IDwldmFsdWVPZigicmV0IiklPjsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgcmV0dXJuIHJldDsNCiAgICAgICAgfWNhdGNoKGV4KXsNCiAgICAgICAgICAgIDwlPXdhcm4oKSU+biwgbnVsbFZhbHVlLCBvcHRpb25zLl9jbGFzcywgb3B0aW9ucy50b29sLnRvb2xfQ29uZmlncywgZXgpOw0KICAgICAgICB9DQo8JSB9JT4NCiAgICB9DQoNCg0KPCUgYy5FbnRpdHlNZXRob2RzLmZvckVhY2gobSA9PiB7JT4NCiAgICAvKioNCiAgICAgKiBTdW1tYXJ5LiA8JT1tLk5hbWUlPi4NCiAgICAgKg0KICAgICAqIERlc2NyaXB0aW9uLiA8JT1tLlJlbWFyayU+Lg0KICAgICAqDQogICAgICogQHNpbmNlICAgICAgeC54LngNCiAgICAgKiBAZGVwcmVjYXRlZCB4LngueCBVc2UgbmV3X2Z1bmN0aW9uX25hbWUoKSBpbnN0ZWFkLg0KICAgICAqIEBhY2Nlc3MgICAgIHB1YmxpYw0KICAgICAqDQogICAgICogQGNsYXNzDQogICAgICogQGF1Z21lbnRzIHBhcmVudA0KICAgICAqIEBtaXhlcyAgICBtaXhpbg0KICAgICAqDQogICAgICogQGFsaWFzICAgIHJlYWxOYW1lDQogICAgICogQG1lbWJlcm9mIG5hbWVzcGFjZQ0KICAgICAqDQogICAgICogQHNlZSAgRnVuY3Rpb24vY2xhc3MgcmVsaWVkIG9uDQogICAgICogQGxpbmsgVVJMDQogICAgICogQGdsb2JhbA0KICAgICAqDQogICAgICogQGZpcmVzICAgZXZlbnROYW1lDQogICAgICogQGZpcmVzICAgY2xhc3NOYW1lI2V2ZW50TmFtZQ0KICAgICAqIEBsaXN0ZW5zIGV2ZW50OmV2ZW50TmFtZQ0KICAgICAqIEBsaXN0ZW5zIGNsYXNzTmFtZX5ldmVudDpldmVudE5hbWUNCiAgICAgKiBAcGFyYW0ge3R5cGV9ICAgdmFyICAgICAgICAgICBEZXNjcmlwdGlvbi4NCiAgICAgKiBAcGFyYW0ge3R5cGV9ICAgW3Zhcl0gICAgICAgICBEZXNjcmlwdGlvbiBvZiBvcHRpb25hbCB2YXJpYWJsZS4NCiAgICAgKiBAcGFyYW0ge3R5cGV9ICAgW3Zhcj1kZWZhdWx0XSBEZXNjcmlwdGlvbiBvZiBvcHRpb25hbCB2YXJpYWJsZSB3aXRoIGRlZmF1bHQgdmFyaWFibGUuDQogICAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdFZhciAgICAgRGVzY3JpcHRpb24uDQogICAgICogQHBhcmFtIHt0eXBlfSAgIG9iamVjdFZhci5rZXkgRGVzY3JpcHRpb24gb2YgYSBrZXkgaW4gdGhlIG9iamVjdFZhciBwYXJhbWV0ZXIuDQogICAgICoNCiAgICAgKiBAeWllbGQge3R5cGV9IFlpZWxkZWQgdmFsdWUgZGVzY3JpcHRpb24uDQogICAgICoNCiAgICAgKiBAcmV0dXJuIHt0eXBlfSBSZXR1cm4gdmFsdWUgZGVzY3JpcHRpb24uDQogICAgICovDQogICAgPCUgaWYoIW0uSXNTeW5jKXslPmFzeW5jIDwlfSU+PCU9bU5hbWU9bkNvZGUobSklPig8JT1tLk1ldGhvZFBhcmFtZXRlcnMubWFwKHAgPT4gbkNvZGUocCkpLmpvaW4oJywgJyklPil7DQoNCiAgICAJbGV0IGxvZyA9IChvYmosIC4uLm1zZykgPT4gdGhpcy5sb2coIjwlPW5OYW1lKGMpJT4iLCBvYmosICI8JT1uQ29kZShtKSU+IiwgbnVsbCwgMCwgLi4ubXNnKTsNCiAgICAJbGV0IHdhcm4gPSAob2JqLCAuLi5tc2cpID0+IHRoaXMubG9nKCI8JT1uTmFtZShjKSU+Iiwgb2JqLCAiPCU9bkNvZGUobSklPiIsIG51bGwsIDEsIC4uLm1zZyk7DQogICAgCWxldCBlcnJvciA9IChvYmosIC4uLm1zZykgPT4gdGhpcy5sb2coIjwlPW5OYW1lKGMpJT4iLCBvYmosICI8JT1uQ29kZShtKSU+IiwgbnVsbCwgMiwgLi4ubXNnKTsNCiAgICAJbGV0IG9TY29wZSA9IDwlPWFsaWFzKCklPjsNCiAgICAJbGV0IHBTY29wZSA9IDwlPXNjb3BlJT47DQogICAgICAgIA0KICAgIA0KPCUgaWYoIW0uSXNTeW5jKXslPg0KICAgIDwlIGlmKCFtLlJlc3BvbnNlQXR0cmlidXRlKXsgJT4NCiAgICAgICAgbGV0IGFuc3dlciA9IG51bGw7DQogICAgPCUgfWVsc2UgaWYobS5SZXNwb25zZUF0dHJpYnV0ZS5FbnRpdHlUeXBlKXsgJT4NCiAgICAgICAgbGV0IGFuc3dlciA9IG5ldyA8JT1zY29wZSU+LjwlPV9jTmFtZShtLlJlc3BvbnNlQXR0cmlidXRlLkVudGl0eVR5cGUsIHRydWUpJT4oKTsNCiAgICA8JSB9ZWxzZSBpZihtLlJlc3BvbnNlQXR0cmlidXRlLklzQm9vbCl7ICU+DQogICAgICAgIGxldCBhbnN3ZXIgPSBmYWxzZTsNCiAgICA8JSB9ZWxzZSBpZihtLklzQXJyYXkpeyAlPg0KICAgICAgICBsZXQgYW5zd2VyID0gW107DQogICAgPCUgfWVsc2V7ICU+DQogICAgICAgIGxldCBhbnN3ZXIgPSBudWxsOw0KICAgIDwlIH0gJT4NCiAgICANCiAgICAgICAgbGV0IHJlc3VsdHMgPSBhd2FpdCB0aGlzLl9leGVjdXRlKG51bGwsIDwlPWFsaWFzKCklPiwgIjwlPW5Db2RlKG0pJT4iLCA8JW1Sb3V0aW5nKGMsIG0pJT4sIGFzeW5jICgpID0+IHsNCiAgICAgICAgDQo8JSB9JT4NCjwlIG0uTWV0aG9kUGFyYW1ldGVycy5maWx0ZXIocCA9PiBwLkRlZmF1bHQpLmZvckVhY2gocCA9PiB7JT4NCiAgICAgICAgaWYodHlwZW9mKDwlPW5OYW1lKHApJT4pPT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgPCU9bk5hbWUocCklPiA9IDwldmFsdWVPZihwLkRlZmF1bHQpJT47DQogICAgICAgIH0NCjwlIH0pJT4NCg0KICAgICAgICB2YXIgZXJyb3JzID0gew0KICAgICAgICA8JSAgW10uY29uY2F0KG0uTWV0aG9kUGFyYW1ldGVycy5maWx0ZXIocCA9PiBwLlJlcXVpcmVkKS5tYXAocCA9PiAoew0KICAgICAgICAgICAgICAgIENvZGU6IGAke25OYW1lKHApfS1yZXF1aXJlZGAsDQogICAgICAgICAgICAgICAgRXJyb3I6IGAke25OYW1lKHApfSBpcyBhIHJlcXVpcmVkIFBhcmFtZXRlcmAsDQogICAgICAgICAgICAgICAgU2NyaXB0OiBgdHlwZW9mKCR7bk5hbWUocCl9KT09PSd1bmRlZmluZWQnYCwNCiAgICAgICAgICAgIH0pKSkuY29uY2F0KG0uTWV0aG9kUGFyYW1ldGVycy5maWx0ZXIocCA9PiBwLkVudGl0eVR5cGUpLm1hcChwID0+ICh7DQogICAgICAgICAgICAgICAgQ29kZTogYCR7bk5hbWUocCl9YCwNCiAgICAgICAgICAgICAgICBFcnJvcjogYCR7bk5hbWUocCl9IGlzIG5vdCBvZiB0eXBlICR7bk5hbWUocC5FbnRpdHlUeXBlKX1gLA0KICAgICAgICAgICAgICAgIFNjcmlwdDogYCghJHtuTmFtZShwKX0gJiYgJHtwLlJlcXVpcmVkPyd0cnVlJzonZmFsc2UnfSkgfHwgKCR7bk5hbWUocCl9ICYmICgke25OYW1lKHApfS5jb25zdHJ1Y3Rvci5uYW1lIT0nJHtuTmFtZShwLkVudGl0eVR5cGUpfScgfHwgJHtuTmFtZShwKX0uRW50aXR5Q2xhc3MuTmFtZSE9JyR7bk5hbWUocC5FbnRpdHlUeXBlKX0nKSlgLA0KICAgICAgICAgICAgfSkpKS5jb25jYXQobS5WYWxpZGF0b3JzIHx8IFtdKS5maWx0ZXIodiA9PiAhdi5JZ25vcmUpLmZvckVhY2godiA9PiB7ICU+DQogICAgICAgICAgICAiPCU9di5Db2RlJT4iOiAoKDwlPW0uTWV0aG9kUGFyYW1ldGVycy5tYXAocCA9PiBwLk5hbWUpLmpvaW4oJywgJyklPikgPT4gew0KICAgICAgICAgICAgICAgIHRyeXsNCg0KICAgICAgICAgICAgICAgIDwlIGlmKHYuU2NyaXB0LmluZGV4T2YoJ3JldHVybiAnKTwwKXslPg0KICAgICAgICAgICAgICAgICAgICBsZXQgYW5zd2VyID0gDQogICAgICAgICAgICAgICAgPCV9JT4NCiAgICAgICAgICAgICAgICAgICAgPCU9di5TY3JpcHQlPg0KICAgICAgICAgICAgICAgICAgICAvLzwlPWxvZygpJT4iYW5zd2VyIiwgIjwlPXYuQ29kZSU+IiwgYW5zd2VyKTsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFuc3dlcjsNCiAgICAgICAgICAgICAgICB9Y2F0Y2goZXgpew0KICAgICAgICAgICAgICAgICAgICA8JT13YXJuKCklPiJ2YWxpZGF0b3IiLCAiPCU9di5Db2RlJT4iLCBleCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSkoPCU9bS5NZXRob2RQYXJhbWV0ZXJzLm1hcChwID0+IHAuTmFtZSkuam9pbignLCAnKSU+KT8oJzwlPXYuRXJyb3IlPicgfHwgJ1ZhbGlkYXRpb24gRXJyb3InKTonJywNCiAgICAgICAgPCUgfSkgJT4NCiAgICAgICAgfTsNCiAgICAgICAgT2JqZWN0LmtleXMoZXJyb3JzKS5maWx0ZXIoayA9PiAhZXJyb3JzW2tdKS5mb3JFYWNoKGsgPT4gZGVsZXRlIGVycm9yc1trXSk7DQogICAgICAgIGlmKE9iamVjdC5rZXlzKGVycm9ycykubGVuZ3RoKXsNCiAgICAgICAgICAgIE9iamVjdC5rZXlzKGVycm9ycykuZmlsdGVyKGsgPT4gay5zdGFydHNXaXRoKCctJykpLmZvckVhY2goayA9PiB7DQogICAgICAgICAgICAgICAgPCU9bG9nKCklPntba106IGVycm9yc1trXX0pOw0KICAgICAgICAgICAgICAgIGRlbGV0ZSBlcnJvcnNba107DQogICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIGlmKE9iamVjdC52YWx1ZXMoZXJyb3JzKS5sZW5ndGgpew0KICAgICAgICAgICAgICAgIHJldHVybiB7DQogICAgICAgICAgICAgICAgICAgIF9fZXhjZXB0aW9uOiBlcnJvcnMsDQogICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KDQogICAgICAgIDwlPW0uU2NyaXB0JT4NCiAgICAgICAgDQo8JSBpZighbS5Jc1N5bmMpeyU+DQogICAgICAgIH0sIHtfX2JlZm9yZVJ1bGVzOiBbPCUobS5NZXRob2RSdWxlcyB8fCBbXSkuZmlsdGVyKHIgPT4gci5CZWZvcmUpLm1hcChyID0+IHslPjwlPV9GckVNRC5fdG9KUyhyKSU+PCUgfSkuam9pbignLCAnKSU+XSwgX19hZnRlclJ1bGVzOiBbPCUobS5NZXRob2RSdWxlcyB8fCBbXSkuZmlsdGVyKHIgPT4gci5BZnRlcikubWFwKHIgPT4geyU+PCU9X0ZyRU1ELl90b0pTKHIpJT48JSB9KS5qb2luKCcsICcpJT5dLCA8JT1tLk1ldGhvZFBhcmFtZXRlcnMubWFwKHAgPT4gbkNvZGUocCkgKyAiOiAiICsgbkNvZGUocCkpLmpvaW4oJywgJyklPn0pOw0KICAgICAgICANCiAgICAgICAgDQogICAgICAgIC8vIHRha2Ugb3V0IHRoZSBpbnZhbGlkIG5vZGUgcmVzdWx0cw0KICAgICAgICByZXN1bHRzID0gcmVzdWx0cy5maWx0ZXIociA9PiByICYmIHIucmV0KTsNCg0KICAgICAgICAvLyBoYXMgYW55IG5vZGUgZ2VuZXJhdGVkIGEgdmFsaWRhdGlvbiBleGNlcHRpb24/DQogICAgICAgIGxldCBfX2V4ID0gcmVzdWx0cy5maW5kKHIgPT4gci5yZXQuX19leGNlcHRpb24pOw0KICAgICAgICBpZihfX2V4KSByZXR1cm4gX19leC5yZXQ7DQoNCiAgICAgICAgPCU9bS5SZWR1Y2UlPg0KDQogICAgICAgIDwlIGlmKG0uSXNBcnJheSB8fCBtLlJlc3BvbnNlQXR0cmlidXRlLklzQXJyYXkpeyU+DQogICAgICAgIHJldHVybiByZXN1bHRzLm1hcChyID0+IHIucmV0KS5mbGF0KCk7DQogICAgICAgIDwlIH1lbHNlIGlmKG0uUmVzcG9uc2VBdHRyaWJ1dGUuRW50aXR5VHlwZSl7ICU+DQogICAgICAgIHJldHVybiByZXN1bHRzLmxlbmd0aD9yZXN1bHRzWzBdLnJldDpudWxsOw0KICAgICAgICA8JSB9ZWxzZXsgJT4NCiAgICAgICAgcmV0dXJuIHJlc3VsdHMubGVuZ3RoP3Jlc3VsdHNbMF0ucmV0Om51bGw7DQogICAgICAgIDwlIH0lPg0KPCUgfSU+DQogICAgfQ0KPCUgfSk7JT4NCg0KPCUgaWYobWFpbkNsYXNzKF9yZXN0VG9vbHMpKXslPg0KICAgIGFzeW5jIDwlPW1OYW1lPSdfcmVzcG9uc2VJbnRlcmNlcHRvciclPihlcnJvciwgdCl7DQogICAgPCUgaWYobWFpbkNsYXNzKF9yZXN0VG9vbHMpIT1jKXslPg0KICAgICAgICByZXR1cm4gYXdhaXQgbmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKG1haW5DbGFzcyhfcmVzdFRvb2xzKSklPigpLjwlPW1OYW1lJT4oZXJyb3IsIHQpOw0KICAgIDwlIH1lbHNleyU+DQogICAgICAgIHRyeXsNCiAgICAgICAgICAgIHQgPSB0IHx8IHRoaXMuVG9vbDsNCiAgICAgICAgICAgIGNvbnN0IG9yaWdpbmFsUmVxdWVzdCA9IGVycm9yLmNvbmZpZzsNCiAgICAgICAgICAgIGlmICh0aGlzLl9fY29uZmlnKCJvYXV0aC5hY2Nlc3NfdG9rZW4iLCBudWxsLCB7dG9vbDogdH0pICYmIGVycm9yLnJlc3BvbnNlICYmIGVycm9yLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDAxICYmICFvcmlnaW5hbFJlcXVlc3QuX3JldHJ5ICYmIG9yaWdpbmFsUmVxdWVzdC5oZWFkZXJzLkF1dGhvcml6YXRpb24uaW5kZXhPZih0aGlzLl9fY29uZmlnKCJvYXV0aC5hY2Nlc3NfdG9rZW4iLCBudWxsLCB7dG9vbDogdH0pKT4wKSB7DQogICAgICAgICAgICAgICAgb3JpZ2luYWxSZXF1ZXN0Ll9yZXRyeSA9IHRydWU7DQogICAgICAgICAgICAgICAgLy8gYXdhaXQgKGdldCB0aGUgdG9rZW4gb3IgcmVmcmVzaCBpdCkNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICBvcmlnaW5hbFJlcXVlc3QuaGVhZGVycy5BdXRob3JpemF0aW9uID0gdGhpcy5fX2NvbmZpZygib2F1dGguYWNjZXNzX3R5cGUiLCAiQmVhcmVyIiwge3Rvb2w6IHR9KSArICIgIiArIHRoaXMuX19jb25maWcoIm9hdXRoLmFjY2Vzc190b2tlbiIsIG51bGwsIHt0b29sOiB0fSk7DQogICAgICAgICAgICAgICAgcmV0dXJuIHQuYXhpb3Mob3JpZ2luYWxSZXF1ZXN0KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChlcnJvcik7DQogICAgICAgIH1jYXRjaChleCl7DQogICAgICAgICAgICA8JT1lcnJvcigpJT5leCk7DQogICAgICAgIH0NCiAgICAgICAgPCU9bG9nKCklPmNvbmZpZyk7DQogICAgICAgIHJldHVybiBjb25maWc7DQogICAgPCUgfSU+DQogICAgfQ0KDQogICAgYXN5bmMgPCU9bU5hbWU9J19yZXF1ZXN0SW50ZXJjZXB0b3InJT4oY29uZmlnLCB0KXsNCiAgICA8JSBpZihtYWluQ2xhc3MoX3Jlc3RUb29scykhPWMpeyU+DQogICAgICAgIHJldHVybiBhd2FpdCBuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUobWFpbkNsYXNzKF9yZXN0VG9vbHMpKSU+KCkuPCU9bU5hbWUlPihjb25maWcsIHQpOw0KICAgIDwlIH1lbHNleyU+DQogICAgICAgIHRyeXsNCiAgICAgICAgICAgIHQgPSB0IHx8IHRoaXMuVG9vbDsNCiAgICAgICAgICAgIGNvbmZpZyA9IGNvbmZpZyB8fCB7aGVhZGVyczoge319Ow0KICAgICAgICAgICAgY29uZmlnLm1ldGEgPSBjb25maWcubWV0YSB8fCB7fTsNCiAgICAgICAgICAgIGNvbmZpZy5tZXRhLmNvdW50ZXIgPSA0Ow0KICAgICAgICAgICAgDQogICAgICAgICAgICBsZXQgdG9rZW5VcmkgPSB0aGlzLl9fY29uZmlnKCJvYXV0aC50b2tlbi51cmkiLCBudWxsLCB7dG9vbDogdH0pOw0KICAgICAgICAgICAgbGV0IHJlZnJlc2hVcmkgPSB0aGlzLl9fY29uZmlnKCJvYXV0aC5yZWZyZXNoLnVyaSIsIG51bGwsIHt0b29sOiB0fSk7DQogICAgICAgICAgICBsZXQgYXV0aFVyaSA9IHRoaXMuX19jb25maWcoIm9hdXRoLmF1dGhvcml6ZS51cmkiLCBudWxsLCB7dG9vbDogdH0pOw0KICAgICAgICAgICAgbGV0IGF1dGhUeXBlID0gdGhpcy5fX2NvbmZpZygib2F1dGguYXV0aF90eXBlIiwgIkJlYXJlciIsIHt0b29sOiB0fSk7DQogICAgICAgICAgICBsZXQgdG9rZW4gPSB0aGlzLl9fY29uZmlnKCJvYXV0aC5hY2Nlc3NfdG9rZW4uIitjb25maWcubWV0aG9kLCB0aGlzLl9fY29uZmlnKCJvYXV0aC5hY2Nlc3NfdG9rZW4iLCBudWxsLCB7dG9vbDogdCwgbm9kZTogPCU9bnNjb3BlJT4uX25vZGV9KSwge3Rvb2w6IHQsIG5vZGU6IDwlPW5zY29wZSU+Ll9ub2RlfSk7DQogICAgICAgICAgICBpZighY29uZmlnLmhlYWRlcnMuQXV0aG9yaXphdGlvbiAmJiBbdG9rZW5VcmksIHJlZnJlc2hVcmksIGF1dGhVcmldLmluZGV4T2YoY29uZmlnLnVybCk8MCl7DQogICAgICAgICAgICAgICAgaWYoIXRva2VuKXsNCiAgICAgICAgICAgICAgICAgICAgbGV0IGF1dGhDb2RlID0gdGhpcy5fX2NvbmZpZygnb2F1dGguYXV0aG9yaXplLmNvZGUnLCBudWxsLCB7dG9vbDogdH0pOw0KICAgICAgICAgICAgICAgICAgICBsZXQgYXV0aE1ldGhvZCA9IHRoaXMuX19jb25maWcoJ29hdXRoLmF1dGhvcml6ZS5tZXRob2QnLCBudWxsLCB7dG9vbDogdH0pOw0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgaWYoIXRva2VuVXJpICYmICFhdXRoQ29kZSAmJiAhYXV0aE1ldGhvZCAmJiB0aGlzLl9fY29uZmlnKCd1c2VybmFtZScsIG51bGwsIHt0b29sOiB0fSkpew0KICAgICAgICAgICAgICAgICAgICAgICAgYXV0aFR5cGUgPSAnQmFzaWMnOw0KICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW4gPSB0aGlzLl9idG9hKHRoaXMuX19jb25maWcoJ3VzZXJuYW1lJywgbnVsbCwge3Rvb2w6IHR9KSArICI6IiArIHRoaXMuX19jb25maWcoJ3Bhc3N3b3JkJywgbnVsbCwge3Rvb2w6IHR9KSk7DQogICAgICAgICAgICAgICAgICAgICAgICBjb25maWcuaGVhZGVycy5BdXRob3JpemF0aW9uID0gYXV0aFR5cGUgKyAiICIgKyB0b2tlbjsgLy8/DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgDQo8JWlmKF9jTmFtZSgnTm9kZScpKXslPg0KICAgICAgICAgICAgICAgICAgICBpZig8JT1uc2NvcGUlPi5fbm9kZSAmJiAhYXV0aENvZGUgJiYgYXV0aE1ldGhvZD09ImdldCIpew0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gY3JlYXRlIG9yIGxvYWQgYSBuZXcgb2F1dGggc3RhdGUNCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX19jb25maWcoIm9hdXRoLmF1dGhvcml6ZS5zdGF0ZSIsIG51bGwsIHt0b29sOiB0LCBub2RlOiA8JT1uc2NvcGUlPi5fbm9kZSwgbmV3VmFsdWU6IHRoaXMuX2J0b2EoSlNPTi5zdHJpbmdpZnkoe3Rvb2w6IHQubmFtZSwgbmNvZGU6IDwlPW5zY29wZSU+Ll9ub2RlLmNvZGUoKX0pKX0pOw0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gYXV0aG9yaXplIGFuZCBnZXQgdGhlIGF1dGggY29kZQ0KICAgICAgICAgICAgICAgICAgICAgICAgYXV0aFVyaSA9IHRoaXMuX19jb25maWcoIm9hdXRoLmF1dGhvcml6ZS51cmkiLCBudWxsLCB7dG9vbDogdH0pOw0KICAgICAgICAgICAgICAgICAgICAgICAgPCU9bG9nKCklPmAke2F1dGhVcml9YCk7DQogICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cub3BlbihhdXRoVXJpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuc2V0SW50ZXJ2YWwobnVsbCwgdG9vbCA9PiA8JT1uc2NvcGUlPi5fbm9kZSAmJiBjb25maWcubWV0YS5jb3VudGVyLS0gJiYgIShhdXRoQ29kZSA9IHRoaXMuX19jb25maWcoJ29hdXRoLmF1dGhvcml6ZS5jb2RlJywgbnVsbCwge3Rvb2w6IHR9KSksIDAuMSwgdCk7DQogICAgICAgICAgICAgICAgICAgICAgICA8JT1sb2coKSU+YERvbmUgTG9vcGluZzogJHthdXRoQ29kZX1gKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCFhdXRoQ29kZSkgYXV0aE1ldGhvZD11bmRlZmluZWQ7DQogICAgICAgICAgICAgICAgICAgIH0NCjwlfSU+DQoNCiAgICAgICAgICAgICAgICAgICAgaWYoYXV0aE1ldGhvZCl7DQogICAgICAgICAgICAgICAgICAgICAgICBsZXQgZmxvdyA9ICghYXV0aENvZGUgJiYgYXV0aE1ldGhvZD09J3Bvc3QnKT8nYXV0aG9yaXplJzondG9rZW4nOw0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gZ2V0IHRoZSB0b2tlbg0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhlIHRva2VuVXJpIG1pZ2h0IGhhdmUgYSBkZXBlbmRlbmN5IG9uIHRoZSBhdXRob3JpemF0aW9uIGNvZGUNCiAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuVXJpID0gdGhpcy5fX2NvbmZpZyhgb2F1dGguJHtmbG93fS51cmlgLCBudWxsLCB7dG9vbDogdH0pOw0KICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHRjb25maWcgPSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiB0b2tlblVyaSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRob2Q6IHRoaXMuX19jb25maWcoYG9hdXRoLiR7Zmxvd30ubWV0aG9kYCwgJ3Bvc3QnLCB7dG9vbDogdH0pLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlYWRlcnM6IE9iamVjdC5hc3NpZ24oew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiQ29udGVudC1UeXBlIjogdGhpcy5fX2NvbmZpZyhgb2F1dGguJHtmbG93fS5jb250ZW50X3R5cGVgLCAidGV4dC9qc29uIiwge3Rvb2w6IHR9KSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIkF1dGhvcml6YXRpb24iOiAiQmFzaWMgIit0aGlzLl9idG9hKHRoaXMuX19jb25maWcoIm9hdXRoLmxvZ2luIiwgbnVsbCwge3Rvb2w6IHR9KSArICI6IiArIHRoaXMuX19jb25maWcoIm9hdXRoLnBhc3N3b3JkIiwgbnVsbCwge3Rvb2w6IHR9KSksDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgdGhpcy5fX2NvbmZpZyhgb2F1dGguJHtmbG93fS5oZWFkZXJzYCwgInt9Iiwge3Rvb2w6IHR9KSksDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogdGhpcy5fX2NvbmZpZyhgb2F1dGguJHtmbG93fS5ib2R5YCwgbnVsbCwge3Rvb2w6IHR9KSwNCiAgICAgICAgICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgICAgICAgICBsZXQgdHJlcyA9IGF3YWl0IHQuYXhpb3ModGNvbmZpZyk7DQogICAgICAgICAgICAgICAgICAgICAgICA8JT1sb2coKSU+YFRva2VuIGZldGNoZWQgLSAke2Zsb3d9YCwgdGNvbmZpZywgdHJlcy5kYXRhKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIFsnYWNjZXNzX3Rva2VuJywgJ3Rva2VuX3R5cGUnLCAnZXhwaXJlc19pbicsICdyZWZyZXNoX3Rva2VuJ10uZm9yRWFjaCh0YSA9PiB0aGlzLl9fY29uZmlnKGBvYXV0aC4ke3RhfWAsIG51bGwsIHt0b29sOiB0LCBub2RlOiA8JT1uc2NvcGUlPi5fbm9kZSwgbmV3VmFsdWU6IHRyZXMuZGF0YVt0aGlzLl9fY29uZmlnKGBvYXV0aC50b2tlbi5yZXNwb25zZS4ke3RhfWAsIHRhLCB7dG9vbDogdH0pXX0pKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuID0gdGhpcy5fX2NvbmZpZygib2F1dGguYWNjZXNzX3Rva2VuIiwgbnVsbCwge3Rvb2w6IHQsIG5vZGU6IDwlPW5zY29wZSU+Ll9ub2RlfSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgY29uZmlnLmhlYWRlcnMuQXV0aG9yaXphdGlvbiA9IGF1dGhUeXBlICsgIiAiICsgdG9rZW47DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9Y2F0Y2goZXgpew0KICAgICAgICAgICAgPCU9ZXJyb3IoKSU+ZXgpOw0KICAgICAgICB9DQogICAgICAgIDwlPWxvZygpJT5jb25maWcpOw0KICAgICAgICByZXR1cm4gY29uZmlnOw0KICAgIDwlIH0lPg0KICAgIH0NCiAgICANCiAgICBhc3luYyA8JT1tTmFtZT0nX3Jlc3QnJT4odE5hbWUsIHBhcmFtcywgZGF0YSwgbWV0aG9kLCBvcHRpb25zKXsNCiAgICAgICAgLyogdE5hbWUgbm8gbG9uZ2VyIHJlcXVpcmVkISEgKi8NCiAgICAgICAgdE5hbWUgPSB0TmFtZSB8fCA8JT1fbkNvZGUoKSU+Ow0KICAgICAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7X3RoaXM6IHRoaXN9Ow0KICAgICAgICBvcHRpb25zLnROYW1lID0gb3B0aW9ucy50TmFtZSB8fCB0TmFtZTsNCiAgICAgICAgDQogICAgICAgIHBhcmFtcyA9IHBhcmFtcyB8fCB7fTsNCiAgICAgICAgbWV0aG9kID0gbWV0aG9kIHx8IChkYXRhPyJwb3N0IjoiZ2V0Iik7DQogICAgICAgIA0KICAgIDwlIGlmKG1haW5DbGFzcyhfcmVzdFRvb2xzKSE9Yyl7JT4NCiAgICAgICAgcmV0dXJuIGF3YWl0IG5ldyA8JT1zY29wZSU+LjwlPV9jTmFtZShtYWluQ2xhc3MoX3Jlc3RUb29scykpJT4oLypudWxsLCB0aGlzLlRvb2wqLykuPCU9bU5hbWUlPih0TmFtZSwgcGFyYW1zLCBkYXRhLCBtZXRob2QsIG9wdGlvbnMpOw0KICAgIDwlIH1lbHNleyU+DQogICAgICAgIHRyeXsNCiAgICAgICAgICAgIGlmKG9wdGlvbnMuZm9ybSl7DQogICAgICAgICAgICAgICAgbGV0IGZkID0gbmV3IEZvcm1EYXRhKCk7DQogICAgICAgICAgICAgICAgT2JqZWN0LmtleXMoZGF0YSkuZm9yRWFjaChrID0+IGZkLmFwcGVuZChrLCBkYXRhW2tdKSk7DQogICAgICAgICAgICAgICAgZGF0YSA9IGZkOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICBsZXQgY29uZmlnID0gew0KICAgICAgICAgICAgICAgIHVybDogdGhpcy5fX2NvbmZpZyhvcHRpb25zLnVybCB8fCBgcmVzdGFwaS51cmwuJHttZXRob2R9YCwgdGhpcy5fX2NvbmZpZyhvcHRpb25zLnVybCB8fCAncmVzdGFwaS51cmwnLCAob3B0aW9ucy5wYXRofHwnJykgKyBvcHRpb25zLmZpbGUsIG9wdGlvbnMpLCBvcHRpb25zKSwNCiAgICAgICAgICAgICAgICBtZXRob2Q6IG1ldGhvZCwNCiAgICAgICAgICAgICAgICBwYXJhbXM6IHBhcmFtcywNCiAgICAgICAgICAgICAgICBoZWFkZXJzOiBPYmplY3QuYXNzaWduKHRoaXMuX19jb25maWcoJ3Jlc3RhcGkuaGVhZGVycy4nK21ldGhvZCwgdGhpcy5fX2NvbmZpZygncmVzdGFwaS5oZWFkZXJzJywge30sIG9wdGlvbnMpLCBvcHRpb25zKSwgb3B0aW9ucy5oZWFkZXJzIHx8IHt9KSwNCiAgICAgICAgICAgICAgICBkYXRhOiBkYXRhLA0KICAgICAgICAgICAgICAgIHZhbGlkYXRlU3RhdHVzOiBzdGF0dXMgPT4gc3RhdHVzPDQwMCwNCiAgICAgICAgICAgIH07DQogICAgICAgICAgICANCiAgICAgICAgICAgIGxldCByZXQgPSBbXTsNCiAgICAgICAgICAgIDwlPWxvZygpJT5gW0xJVkU6JHt0aGlzLl9fY29uZmlnKCdsaXZlJywgdHJ1ZSl9XWAsIGNvbmZpZywgb3B0aW9ucyk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGlmKHRoaXMuX19jb25maWcoJ2xpdmUnLCB0cnVlKSl7DQogICAgICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMuVG9vbC5heGlvcykhPT0ndW5kZWZpbmVkJyB8fCB0eXBlb2YoYXhpb3MpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgICAgICByZXQgPSAoYXdhaXQgKCh0aGlzLlRvb2wuYXhpb3MgfHwgYXhpb3MpKShjb25maWcpKS5kYXRhOw0KICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICByZXQgPSBhd2FpdCAoYXdhaXQgZmV0Y2goY29uZmlnLnVybCwgY29uZmlnKSkuanNvbigpOw0KICAgICAgICAgICAgICAgICAgICA8JT13YXJuKCklPiJheGlvcyBub3QgZGVmaW5lZCEsIHVzaW5nIGZldGNoIiwgcmV0KTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICA8JT1sb2coKSU+InJldCIsIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpOw0KICAgICAgICAgICAgcmV0dXJuIHJldDsNCiAgICAgICAgfWNhdGNoKGV4KXsNCiAgICAgICAgICAgIDwlPWVycm9yKCklPmV4KTsNCiAgICAgICAgfQ0KICAgIDwlIH0lPg0KICAgIH0NCjwlIH0gLy8gbWFpbkNsYXNzKF9yZXN0VG9vbHMpICU+DQoNCjwlIGlmKG1haW5DbGFzcyhfc3FsVG9vbHMpKXslPg0KICAgIDwlPW1OYW1lPSdfdG9TUUxUYWJsZSclPihvcHRpb25zPXt9LCBzUGF0aD0iIil7DQogICAgICAgIHJldHVybiB0aGlzLl9fZXhwb3J0KHtJZDogIjwlPXNjb3BlJT4uPCU9X2NOYW1lKGMsIHRydWUpJT4iLCBzUGF0aDogc1BhdGgsIGRlcHM6IHt9LCBzcWw6IGAvKjwlPWMuTmFtZSU+OiBTUUwqL1xuXG5gLCBmaWVsZHM6IGBgfSwgew0KICAgICAgICAgICAgLy9fbWFwOiB0cnVlLA0KICAgICAgICAgICAgTnVsbDogdHJ1ZSwNCiAgICAgICAgICAgIEZ1bGw6IHRydWUsDQogICAgICAgICAgICBfX2hlYWRlcjogb2JqID0+IG9iai5zcWwgKz0gYENSRUFURSBUQUJMRSBJRiBOT1QgRVhJU1RTICR7dGhpcy5fUSgpfSR7PCU9X25Db2RlKCklPn0ke3RoaXMuX1EoKX0gKCR7b2JqLmZpZWxkc31cbi8qPCU9bk5hbWUoYyklPjogJHtzUGF0aH0qLyk7XG5gLA0KICAgICAgICAgICAgZXhwb3J0ZXI6IHYgPT4gdi5vYmouc3FsICs9ICh0eXBlb2Yob3B0aW9ucy5yZXVzZWQpPT09J3VuZGVmaW5lZCcgfHwgb3B0aW9ucy5yZXVzZWQ+PXYucmV1c2VkKT8nJzpgLyo8JT1uTmFtZShjKSU+OiByZXVzZWQ6ICR7di5yZXVzZWR9Ki9cblxuYCwNCiAgICAgICAgICAgIGV4cG9ydGVyOiB2ID0+IHYub2JqID0gKHR5cGVvZihvcHRpb25zLnJldXNlZCk9PT0ndW5kZWZpbmVkJyB8fCBvcHRpb25zLnJldXNlZD49di5yZXVzZWQpP3Yub2JqOntzcWw6IHYub2JqLnNxbCArPSBgLyo8JT1uTmFtZShjKSU+OiByZXVzZWQ6ICR7di5yZXVzZWR9Ki9cblxuYCwgSWQ6IHYub2JqLklkfSwNCiAgICAgICAgICAgIElkOiAob2JqLCBpZENvZGUsIHYpID0+IG9iai5maWVsZHMgKz0gYCR7dGhpcy5fUSgpfSR7dGhpcy5fX2NvbmZpZygnaWRGaWVsZCcsICdJZCcpfSR7dGhpcy5fUSgpfSBDSEFSKDI1KSBQUklNQVJZIEtFWWAsDQogICAgPCUgYy5FbnRpdHlBdHRyaWJ1dGVzLmZpbHRlcihlYSA9PiAhZWEuRW50aXR5TWV0aG9kICYmICFlYS5FbnRpdHlUeXBlKS5mb3JFYWNoKGVhID0+IHslPg0KICAgICAgICAgICAgPCU9bk5hbWUoZWEpJT46IChvYmosIGVhQ29kZSwgdikgPT4gb2JqLmZpZWxkcyArPSBgLCR7dGhpcy5fUSgpfSR7PCU9X25Db2RlKGVhKSU+fSR7dGhpcy5fUSgpfSAke3RoaXMuX3NxbFR5cGUoIjwlPV9GckVNRC5fYXR0cihlYSklPiIsIHRoaXMuX19jb25maWcoJ3R5cGUnKSl9YCwNCiAgICA8JSB9KTsgJT4NCiAgICA8JSBjLkVudGl0eUF0dHJpYnV0ZXMuZmlsdGVyKGVhID0+ICFlYS5FbnRpdHlNZXRob2QgJiYgZWEuRW50aXR5VHlwZSkuZm9yRWFjaChlYSA9PiB7JT4NCiAgICAgICAgICAgIDwlPW5OYW1lKGVhKSU+OiAob2JqLCBlYUNvZGUsIHYpID0+IHsNCiAgICAgICAgICAgICAgICBvYmouZmllbGRzICs9IGAsJHt0aGlzLl9RKCl9JHtlYUNvZGV9aWQke3RoaXMuX1EoKX0gJHt0aGlzLl9zcWxUeXBlKCI8JT1fRnJFTUQuX2F0dHIoZWEpJT4iLCB0aGlzLl9fY29uZmlnKCd0eXBlJykpfWA7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgb2JqLnNxbCA9ICh2IHx8IG5ldyA8JT1zY29wZSU+LjwlPV9jTmFtZShlYS5FbnRpdHlUeXBlLCB0cnVlKSU+KCI8JT1zY29wZSU+LjwlPV9jTmFtZShjLCB0cnVlKSU+IikpLjwlPW1OYW1lJT4ob3B0aW9ucywgYCR7c1BhdGh9LiR7ZWFDb2RlfWApLnNxbCArICJcblxuIiArIG9iai5zcWw7DQogICAgICAgICAgICB9LA0KICAgIDwlIH0pOyAlPg0KICAgIDwlIGMuVHlwZWRBdHRyaWJ1dGVzLmZvckVhY2godGEgPT4geyBsZXQgdGFOYW1lID0gbk5hbWUodGEpICsgJ18nICsgdGEuRW50aXR5Q2xhc3MuUGx1cmFsLnJlcGxhY2UoLyAvZywgJ18nKTslPg0KICAgICAgICAgICAgPCU9dGFOYW1lJT46IChvYmosIGVhQ29kZSwgdikgPT4gb2JqLnNxbCA9ICh2ICYmIHYubGVuZ3RoKT92WzBdOm5ldyA8JT1zY29wZSU+LjwlPV9jTmFtZSh0YS5FbnRpdHlDbGFzcywgdHJ1ZSklPigiPCU9c2NvcGUlPi48JT1fY05hbWUoYywgdHJ1ZSklPiIpLjwlPW1OYW1lJT4ob3B0aW9ucywgYCR7c1BhdGh9LiR7ZWFDb2RlfVswXWApLnNxbCArICJcblxuIiArIG9iai5zcWwsDQogICAgPCUgfSklPg0KICAgICAgICB9LCAiPCU9bU5hbWUlPiIsIG9wdGlvbnMsIHNQYXRoKTsNCiAgICB9DQogICAgDQogICAgPCU9bU5hbWU9J19mcm9tU1FMVGFibGUnJT4odGFibGUsIGZpZWxkcyl7DQogICAgICAgIC8vIHRhYmxlIGlzIGEganNvbiBhcnJheQ0KPCUgYy5FbnRpdHlBdHRyaWJ1dGVzLmZpbHRlcihlYSA9PiAhZWEuRW50aXR5TWV0aG9kKS5mb3JFYWNoKGVhID0+IHsgJT4NCiAgICAgICAgaWYoKGZpZWxkcyAmJiBmaWVsZHMuaW5kZXhPZigiPCU9bk5hbWUoZWEpJT4iKSkgfHwgIWZpZWxkcyl7DQogICAgICAgICAgICB0aGlzLjwlPW5OYW1lKGVhKSU+KHRhYmxlWyI8JT1uQ29kZShlYSklPiJdKTsNCiAgICAgICAgfQ0KPCUgfSk7ICU+DQogICAgICAgIA0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICB9DQoNCiAgICBhc3luYyA8JT1tTmFtZT0nX3NxbCclPihzcWwsIF90aGlzKXsNCiAgICAgICAgX3RoaXMgPSBfdGhpcyB8fCB0aGlzOw0KICAgIDwlIGlmKG1haW5DbGFzcyhfc3FsVG9vbHMpIT1jKXslPg0KICAgICAgICByZXR1cm4gYXdhaXQgbmV3IDwlPXNjb3BlJT4uPCU9bk5hbWUobWFpbkNsYXNzKF9zcWxUb29scykpJT4oKS48JT1tTmFtZSU+KHNxbCwgX3RoaXMpOw0KICAgIDwlIH1lbHNleyU+DQogICAgICAgIGlmKCF0aGlzLlRvb2wuZGIgfHwgIXNxbCB8fCAhc3FsLnRyaW0oKSl7DQogICAgICAgICAgICBpZighdGhpcy5Ub29sLmRiKSA8JT1sb2coKSU+c3FsLCAiIDw9PVNLSVBQRUQ9PT4iKTsNCiAgICAgICAgICAgIHJldHVybiBbXTsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgaWYoc3FsLmluZGV4T2YoJztcbicpPjApew0KICAgICAgICAgICAgZm9yIGF3YWl0IChjb25zdCBzcWxTIG9mIHNxbC5zcGxpdCgnO1xuJykpew0KICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuPCU9bU5hbWUlPihzcWxTLnRyaW0oKSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIGxldCByZXQgPSBudWxsOw0KDQogICAgICAgIGlmKChzcWwubWF0Y2goL1woL2cpIHx8IFtdKS5sZW5ndGghPShzcWwubWF0Y2goL1wpL2cpIHx8IFtdKS5sZW5ndGgpew0KICAgICAgICAgICAgPCU9bG9nKCklPiJpbmNvcnJlY3Qgc3FsIiwgc3FsKTsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgLy88JT1sb2coKSU+YHNxbGAsIHNxbCk7DQogICAgICAgIA0KICAgICAgICB0cnl7DQogICAgICAgICAgICByZXQgPSBhd2FpdCBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7DQogICAgICAgICAgICAgICAgbGV0IF9vayA9IChfcmV0LCBfc3FsKSA9PiB7DQogICAgICAgICAgICAgICAgICAgIGlmKF9zcWwgJiYgX3NxbC5pbmRleE9mKCdzZWxlY3QnKSkgdGhpcy5Ub29sLl9fZG1sU3RhdGVtZW50cy5wdXNoKF9zcWwpOw0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzb2x2ZShfcmV0KTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBsZXQgZGIgPSB0aGlzLlRvb2wuZGI7DQogICAgICAgICAgICAgICAgbGV0IHR5cGUgPSB0aGlzLl9fY29uZmlnKCd0eXBlJyk7DQogICAgDQogICAgICAgICAgICAgICAgbGV0IGZ1biA9ICIiOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIFF1ZXJ5IGxpc3Qgb2Ygc3RhdGVtZW50IHN0YXJ0aW5nIGtleXdvcmRzICAgICAgICANCiAgICAgICAgICAgICAgICBsZXQgcUxpc3QgPSBbInNlbGVjdCIsICJpbnNlcnQiLCAidXBkYXRlIiwgImRlbGV0ZSJdOw0KICAgICAgICAgICAgICAgIGlmKHRoaXMuX19jb25maWcoJ2RhdGFiYXNlLnRyYW5zYWN0aW9ucycsIHRydWUpKXsNCiAgICAgICAgICAgICAgICAgICAgcUxpc3QgPSBxTGlzdC5jb25jYXQoWyJiZWdpbiIsICJzdGFydCIsICJjb21taXQiXSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGxldCBiUXVlcnkgPSBxTGlzdC5pbmRleE9mKHNxbC5zdWJzdHJpbmcoMCwgc3FsLmluZGV4T2YoJyAnKSkudHJpbSgpLnRvTG93ZXJDYXNlKCkpPj0wOw0KDQogICAgICAgICAgICAgICAgaWYoYlF1ZXJ5KXsNCiAgICAgICAgICAgICAgICAgICAgLy8gcXVlcnkNCiAgICAgICAgICAgICAgICAgICAgaWYoWydteXNxbCcsICdwb3N0Z3JlcyddLmluZGV4T2YodHlwZSk+PTApIGZ1biA9ICdxdWVyeSc7DQogICAgICAgICAgICAgICAgICAgIGlmKHR5cGU9PSdzcWxpdGUnKSBmdW4gPSAnYWxsJzsNCiAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgLy8gRE1MDQogICAgICAgICAgICAgICAgICAgIGlmKFsnbXlzcWwnLCAncG9zdGdyZXMnXS5pbmRleE9mKHR5cGUpPj0wKSBmdW4gPSAncXVlcnknOw0KICAgICAgICAgICAgICAgICAgICBpZih0eXBlPT0nc3FsaXRlJykgZnVuID0gJ3J1bic7DQoNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5Ub29sLmRtbENhY2hlID0gdGhpcy5Ub29sLmRtbENhY2hlIHx8IHt9Ow0KICAgICAgICAgICAgICAgICAgICBpZih0aGlzLlRvb2wuZG1sQ2FjaGVbdGhpcy5oYXNoQ29kZShzcWwpXSkgcmV0dXJuIF9vaygwKTsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5Ub29sLmRtbENhY2hlW3RoaXMuaGFzaENvZGUoc3FsKV0gPSBzcWw7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmKHR5cGU9PSdzcWxpdGUnICYmIHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCcpIGZ1biA9ICIiOw0KICAgICAgICAgICAgICAgIGlmKGZ1biAmJiAhZGJbZnVuXSkgZnVuID0gIiI7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgc3FsID0gdHlwZW9mKHNxbEZvcm1hdHRlcikhPT0ndW5kZWZpbmVkJz9zcWxGb3JtYXR0ZXIuZm9ybWF0KHNxbCk6c3FsOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIDwlPWxvZygpJT5gJHt0eXBlfS4ke2Z1bn1gLCBzcWwpOw0KICAgICAgICAgICAgICAgIGlmKDwlPXNjb3BlJT4uX19zcWxUcmFuc2FjdGlvbikgPCU9c2NvcGUlPi5fX3NxbFRyYW5zYWN0aW9uLnNxbHMucHVzaChzcWwpOw0KDQogICAgICAgICAgICAgICAgaWYgKGZ1bikgew0KICAgICAgICAgICAgICAgICAgICBsZXQgcmV0ID0gW107DQogICAgICAgICAgICAgICAgICAgIGlmKHR5cGU9PSJwb3N0Z3JlcyIpew0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0ID0gZGJbZnVuXShzcWwpLnRoZW4ocm93cyA9PiBfb2socm93cywgc3FsKSkuY2F0Y2gocmV0RXggPT4gcmVqZWN0KHJldEV4KSk7DQogICAgICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0ID0gZGJbZnVuXShzcWwsIFtdLCAoZXJyb3IsIHJvd3MpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihlcnJvcil7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnJvcik7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9vayhyb3dzLCBzcWwpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlPT0nc25vd2ZsYWtlJykgew0KICAgICAgICAgICAgICAgICAgICB0aGlzLlRvb2wuZGIuZXhlY3V0ZSh7DQogICAgICAgICAgICAgICAgICAgICAgICBzcWxUZXh0OiBzcWwsDQogICAgICAgICAgICAgICAgICAgICAgICBjb21wbGV0ZTogZnVuY3Rpb24oZXJyLCBzdG10LCByb3dzKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoZXJyKXsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9vayhyb3dzLCBzcWwpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlPT0nc3FsaXRlJykgew0KICAgICAgICAgICAgICAgICAgICAvLyBzcWxpdGUgaW4gdGhlIGJyb3dzZXINCiAgICAgICAgICAgICAgICAgICAgdHJ5ew0KICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHJldCA9IG51bGw7DQogICAgICAgICAgICAgICAgICAgICAgICByZXQgPSBkYi5leGVjKHNxbCk7DQogICAgICAgICAgICAgICAgICAgICAgICBpZighcmV0IHx8ICFyZXQubGVuZ3RoKSByZXR1cm4gX29rKHJldCwgc3FsKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0ID0gcmV0WzBdLnZhbHVlcy5tYXAociA9PiBPYmplY3QuZnJvbUVudHJpZXMobmV3IE1hcChyZXRbMF0uY29sdW1ucy5tYXAoKGMsIGkpID0+IFtjLCByW2ldXSkpKSk7DQogICAgICAgICAgICAgICAgICAgICAgICAvLyA8JT1sb2coKSU+cmV0KTsNCiAgICAgICAgICAgICAgICAgICAgICAgIF9vayhyZXQsIHNxbCk7DQogICAgICAgICAgICAgICAgICAgIH1jYXRjaChleCl7DQogICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXgpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSBlbHNlIGlmKHR5cGU9PSdxdWVzdGRiJyl7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuX3Jlc3QobnVsbCwge3F1ZXJ5OiBzcWx9KS50aGVuKHIgPT4gX29rKHIsIHNxbCkpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9Y2F0Y2goZXgpew0KICAgICAgICAgICAgPCU9ZXJyb3IoKSU+YA0KRVJST1I6DQoke2V4fQ0KDQpXaGlsZSBTZW5kaW5nIFF1ZXJ5IA0KJHtzcWx9DQpgKTsNCiAgICAgICAgfQ0KDQogICAgICAgIGlmKHJldCAmJiByZXQucm93cykgcmV0ID0gcmV0LnJvd3M7ICAgICAgICANCiAgICAgICAgaWYoQXJyYXkuaXNBcnJheShyZXQpKSByZXQgPSByZXQubWFwKHIgPT4gRG90T2JqZWN0Lm9iamVjdChyKSk7DQogICAgICAgIHJldHVybiByZXQ7DQogICAgPCUgfSU+DQogICAgfQ0KPCUgfSU+DQoNCjwlIGlmKG1haW5DbGFzcyhbJ0FpclRhYmxlJ10pKXslPg0KPCUNCmxldCBfdG9UeXBlQVQgPSBlYSA9PiB7DQogICAgbGV0IHJldCA9IHtuYW1lOiBuTmFtZShlYSksIGRlc2NyaXB0aW9uOiBlYS5OYW1lLCB0eXBlOiAic2luZ2xlTGluZVRleHQifTsNCiAgICBpZihlYS5Jc0Jvb2wpew0KICAgICAgICByZXQudHlwZSA9ICJjaGVja2JveCI7DQogICAgICAgIHJldC5vcHRpb25zID0gew0KICAgICAgICAgICAgY29sb3I6ICJncmVlbkJyaWdodCIsDQogICAgICAgICAgICBpY29uOiAiY2hlY2siDQogICAgICAgIH07DQogICAgfQ0KICAgIGlmKGVhLklzRGF0ZSl7DQogICAgICAgIHJldC50eXBlID0gImRhdGVUaW1lIjsNCiAgICAgICAgcmV0Lm9wdGlvbnMgPSB7DQogICAgICAgICAgICBkYXRlRm9ybWF0OiB7DQogICAgICAgICAgICAgICAgbmFtZTogJ2lzbycNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICB0aW1lRm9ybWF0OiB7DQogICAgICAgICAgICAgICAgbmFtZTogJzI0aG91cicsDQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgdGltZVpvbmU6ICd1dGMnLA0KICAgICAgICB9Ow0KICAgIH0NCiAgICANCiAgICByZXR1cm4gcmV0Ow0KfTsNCiU+DQogICAgPCU9bU5hbWU9J190b0FUVGFibGUnJT4obGV2ZWwpew0KICAgICAgICBsZXQgcmV0ID0gW3sNCiAgICAgICAgICAgIG5hbWU6ICc8JT1uTmFtZShjKSU+JywNCiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAnJywNCiAgICAgICAgICAgIGZpZWxkczogWw0KICAgICAgICAgICAgICAgIHtuYW1lOiB0aGlzLl9fY29uZmlnKCdpZEZpZWxkJywgJ0lkJyksIGRlc2NyaXB0aW9uOiAnSUQnLCB0eXBlOiAnc2luZ2xlTGluZVRleHQnfSwNCiAgICA8JSBjLkVudGl0eUF0dHJpYnV0ZXMuZmlsdGVyKGVhID0+ICFlYS5FbnRpdHlNZXRob2QpLmZvckVhY2goZWEgPT4geyU+PCU9X0ZyRU1ELl90b0pTKF90b1R5cGVBVChlYSkpJT4sPCUgfSklPl0sDQogICAgICAgIH1dOw0KDQogICAgICAgIHJldCA9IHRoaXMuX19leHBvcnQocmV0LCB7DQogICAgICAgICAgICBGdWxsOiB0cnVlLA0KICAgICAgICAgICAgTnVsbDogdHJ1ZSwNCiAgICA8JSBjLkVudGl0eUF0dHJpYnV0ZXMuZmlsdGVyKGVhID0+ICFlYS5FbnRpdHlNZXRob2QgJiYgZWEuRW50aXR5VHlwZSkuZm9yRWFjaChlYSA9PiB7ICU+DQogICAgICAgICAgICAiPCU9bk5hbWUoZWEpJT4iOiAob2JqLCBlYUNvZGUsIHYpID0+IHJldC5wdXNoKG5ldyA8JT1zY29wZSU+LjwlPW5OYW1lKGVhLkVudGl0eVR5cGUsIHRydWUpJT4oKS48JT1tTmFtZSU+KCkpLA0KICAgIDwlIH0pOyAlPg0KICAgIDwlIGMuVHlwZWRBdHRyaWJ1dGVzLmZvckVhY2godGEgPT4geyBsZXQgdGFOYW1lID0gbk5hbWUodGEpICsgJ18nICsgdGEuRW50aXR5Q2xhc3MuUGx1cmFsLnJlcGxhY2UoLyAvZywgJ18nKTslPg0KICAgICAgICAgICAgPCU9dGFOYW1lJT46IChvYmosIGVhQ29kZSwgdikgPT4gcmV0LnB1c2gobmV3IDwlPXNjb3BlJT4uPCU9bk5hbWUodGEuRW50aXR5Q2xhc3MsIHRydWUpJT4oKS48JT1tTmFtZSU+KCkpLA0KICAgIDwlIH0pJT4NCiAgICAgICAgfSwgIjwlPW1OYW1lJT4iKTsNCg0KICAgICAgICA8JT1sb2coKSU+cmV0LnNxbCk7DQogICAgICAgIHJldHVybiByZXQuc3FsOw0KDQogICAgICAgIHJldCA9IHJldC5maWx0ZXIoKHRhZywgaW5kZXgsIGFycmF5KSA9PiBhcnJheS5maW5kSW5kZXgodCA9PiB0Lm5hbWUgPT0gdGFnLm5hbWUpID09IGluZGV4KTsNCiAgICAgICAgPCU9bG9nKCklPnJldCwgbGV2ZWwpOw0KICAgICAgICByZXR1cm4gcmV0Ow0KICAgIH0NCiAgICANCiAgICA8JT1tTmFtZT0nX3RvQVRGdW5jdGlvbiclPigpew0KICAgICAgICBsZXQgdFByZWYgPSBgJHt0aGlzLl9RKCl9JHs8JT1fbkNvZGUoKSU+fSR7dGhpcy5fUSgpfS5gOw0KICAgICAgICBsZXQgcmV0ID0gdGhpcy5fX2V4cG9ydCh7ZnVuOiAiIn0sIHsNCiAgICAgICAgICAgIF9maWVsZHM6ICh0aGlzLl9fc3luY19vbigpIHx8IHRoaXMuSWQ9PXRoaXMuSWQpP1snSWQnXTp1bmRlZmluZWQsDQogICAgICAgICAgICBfVEhJUzogb2JqID0+IG9iai5mdW4gKz0gYCBhbmQgJHt0UHJlZn0ke3RoaXMuX1EoKX0ke3RoaXMuX19jb25maWcoJ2lkRmllbGQnLCAnSWQnKX0ke3RoaXMuX1EoKX0gYCArICh0aGlzLl9USElTX2Nvb3AgfHwgIklOIikgKyAiICgiICsgdGhpcy5fVEhJUy5tYXAodCA9PiB0LjwlPW1OYW1lJT4odC5fX2NvbmZpZygnaWRGaWVsZCcsICdJZCcpKSkuam9pbignIFVOSU9OIEFMTCAnKSArICIpIiwNCiAgICAgICAgICAgIElkOiBvYmogPT4gb2JqLmZ1biArPSBgIGFuZCAke3RQcmVmfSR7dGhpcy5fUSgpfSR7dGhpcy5fX2NvbmZpZygnaWRGaWVsZCcsICdJZCcpfSR7dGhpcy5fUSgpfT0nJHt0aGlzLklkfSdgLA0KICAgIDwlIGMuRW50aXR5QXR0cmlidXRlcy5maWx0ZXIoZWEgPT4gIWVhLkVudGl0eU1ldGhvZCkuZm9yRWFjaChlYSA9PiB7ICU+DQogICAgICAgICAgICA8JT1uTmFtZShlYSklPjogKG9iaiwgZWFDb2RlLCB2KSA9PiB7DQogICAgICAgIDwlIGlmKGVhLkVudGl0eVR5cGUpeyU+DQogICAgICAgICAgICAgICAgbGV0IGNvb3AgPSB0aGlzLl88JT1uTmFtZShlYSklPl9jb29wOw0KICAgICAgICAgICAgICAgIHN3aXRjaChjb29wKXsNCiAgICAgICAgICAgICAgICAgICAgY2FzZSAiIT0iOg0KICAgICAgICAgICAgICAgICAgICAgICAgY29vcCA9ICJOT1QgSU4iOw0KICAgICAgICAgICAgICAgICAgICBjYXNlICI9IjoNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvb3AgPSAiSU4iOw0KICAgICAgICAgICAgICAgICAgICBjYXNlICIiOg0KICAgICAgICAgICAgICAgICAgICAgICAgY29vcCA9ICJJTiI7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIGlmKHYpew0KICAgICAgICAgICAgICAgICAgICBvYmouZnVuICs9IGAgYW5kICR7dFByZWZ9JHt0aGlzLl9RKCl9JHtlYUNvZGV9aWQke3RoaXMuX1EoKX0gJHtjb29wfSAoJHt2LjwlPW1OYW1lJT4odi5fX2NvbmZpZygnaWRGaWVsZCcsICdJZCcpKX0pYDsNCiAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgb2JqLmZ1biArPSBgIGFuZCAoJHt0UHJlZn0ke3RoaXMuX1EoKX0ke2VhQ29kZX1pZCR7dGhpcy5fUSgpfSAke2Nvb3B9ICgwKSBPUiAke3RQcmVmfSR7dGhpcy5fUSgpfSR7ZWFDb2RlfWlkJHt0aGlzLl9RKCl9IElTIE5VTEwpYDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICA8JSB9ZWxzZSBpZihlYS5Jc1RleHQgfHwgZWEuSXNJbWFnZSB8fCBlYS5Jc0ZpbGUpeyU+DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICA8JSB9ZWxzZXslPg0KICAgICAgICAgICAgICAgIG9iai5mdW4gKz0gYCBhbmQgJHt0UHJlZn0ke3RoaXMuX1EoKX0ke2VhQ29kZX0ke3RoaXMuX1EoKX0gYCArIDwlaWYoZWEuSXNCb29sKXslPiI9IjwlfWVsc2V7JT4odGhpcy5fPCU9bk5hbWUoZWEpJT5fY29vcCB8fCAiTElLRSIpPCV9JT4gKyAiICI7DQogICAgICAgIDwlIH0lPg0KICAgICAgICANCiAgICAgICAgPCUgaWYoZWEuSXNEYXRlKXsgJT4NCiAgICAgICAgICAgICAgICBpZih2ICYmIHYudG9JU09TdHJpbmcpew0KICAgICAgICAgICAgICAgICAgICBvYmouZnVuICs9ICInIiArIHYudG9JU09TdHJpbmcoKSArICInIjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIDwlIH1lbHNlIGlmKGVhLklzU3RyaW5nKXsgJT4NCiAgICAgICAgICAgICAgICBpZih0eXBlb2Yodik9PT0ic3RyaW5nIil7DQogICAgICAgICAgICAgICAgICAgIG9iai5mdW4gKz0gIiciICsgKCh0aGlzLl88JT1uTmFtZShlYSklPl9jb29wPT0iTElLRSIgfHwgIXRoaXMuXzwlPW5OYW1lKGVhKSU+X2Nvb3ApPyIlIjoiIikgKyB2ICsgKCh0aGlzLl88JT1uTmFtZShlYSklPl9jb29wPT0iTElLRSIgfHwgIXRoaXMuXzwlPW5OYW1lKGVhKSU+X2Nvb3ApPyIlIjoiIikgKyAiJyI7DQogICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIDwlIH1lbHNlIGlmKGVhLklzQm9vbCl7ICU+DQogICAgICAgICAgICAgICAgaWYodHlwZW9mKHYpPT09ImJvb2xlYW4iKXsNCiAgICAgICAgICAgICAgICAgICAgb2JqLmZ1biArPSAiJyIgKyAodj8iMSI6IjAiKSArICInIjsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgPCUgfSAlPg0KICAgICAgICAgICAgICAgIGlmKHYgJiYgdi5FbnRpdHlDbGFzcyl7DQogICAgICAgICAgICAgICAgICAgIG9iai5mdW4gKz0gIigiICsgdi48JT1tTmFtZSU+KCkgKyAiKSI7DQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIG9iai5mdW4gKz0gIiciICsgdiArICInIjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9LA0KICAgIDwlIH0pOyAlPg0KICAgIDwlIGMuVHlwZWRBdHRyaWJ1dGVzLmZvckVhY2godGEgPT4geyBsZXQgdGFOYW1lID0gbk5hbWUodGEpICsgJ18nICsgdGEuRW50aXR5Q2xhc3MuUGx1cmFsLnJlcGxhY2UoLyAvZywgJ18nKTslPg0KICAgICAgICAgICAgPCU9dGFOYW1lJT46IChvYmosIGVhQ29kZSwgdikgPT4gew0KICAgICAgICAgICAgICAgIG9iai5zcWwgKz0gIiBhbmQgLyo8JT10YU5hbWUlPiovICI7DQogICAgICAgICAgICAgICAgaWYodGhpcy5fPCU9dGFOYW1lJT5fY29vcD09JyE9Jyl7DQogICAgICAgICAgICAgICAgICAgIG9iai5mdW4gKz0gIk5PVCBFWElTVFMiOw0KICAgICAgICAgICAgICAgIH1lbHNlIGlmKHRoaXMuXzwlPXRhTmFtZSU+X2Nvb3A9PSc9Jyl7DQogICAgICAgICAgICAgICAgICAgIG9iai5mdW4gKz0gIkVYSVNUUyI7DQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIG9iai5mdW4gKz0gYCR7dFByZWZ9JHt0aGlzLl9RKCl9JHt0aGlzLl9fY29uZmlnKCdpZEZpZWxkJywgJ0lkJyl9JHt0aGlzLl9RKCl9ICR7dGhpcy5fPCU9dGFOYW1lJT5fY29vcCB8fCAiSU4ifWA7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIG9iai5mdW4gKz0gIiAoIiArICh2IHx8IFtdKS5tYXAodCA9PiAodCAmJiB0LjwlPW1OYW1lJT4pP3QuPCU9bU5hbWUlPigiPCU9bk5hbWUodGEpJT4uaWQiKToodCB8fCAnTlVMTCcpKS5qb2luKCcgVU5JT04gQUxMLypNMk0qLyAnKSArICIpIjsNCiAgICAgICAgICAgIH0sDQogICAgPCUgfSklPg0KICAgICAgICB9LCAiPCU9bU5hbWUlPiIpOw0KDQogICAgICAgIDwlPWxvZygpJT5yZXQpOw0KICAgICAgICByZXR1cm4gcmV0Ow0KICAgIH0NCg0KICAgIGFzeW5jIDwlPW1OYW1lPSdfYWlydGFibGUnJT4odE5hbWUsIHBhcmFtcywgZGF0YSwgbWV0aG9kKXsNCiAgICA8JSBpZihtYWluQ2xhc3MoWydBaXJUYWJsZSddKSE9Yyl7JT4NCiAgICAgICAgcmV0dXJuIGF3YWl0IG5ldyA8JT1zY29wZSU+LjwlPW5OYW1lKG1haW5DbGFzcyhbJ0FpclRhYmxlJ10pKSU+KCkuPCU9bU5hbWUlPih0TmFtZSwgcGFyYW1zLCBkYXRhLCBtZXRob2QpOw0KICAgIDwlIH1lbHNleyU+DQogICAgICAgIHRyeXsNCiAgICAgICAgICAgIHROYW1lID0gdE5hbWUgfHwgPCU9X25Db2RlKCklPjsNCiAgICAgICAgICAgIGxldCByZXQgPSAoYXdhaXQgYXhpb3MucmVxdWVzdCh7DQogICAgICAgICAgICAgICAgdXJsOiBgJHt0aGlzLl9fY29uZmlnKCdlbmRwb2ludFVybCcpfSR7dE5hbWV9YCwNCiAgICAgICAgICAgICAgICBtZXRob2Q6IG1ldGhvZD9tZXRob2Q6KGRhdGE/InBvc3QiOiJnZXQiKSwNCiAgICAgICAgICAgICAgICBwYXJhbXM6IHsNCiAgICAgICAgICAgICAgICAgICAgZmlsdGVyQnlGb3JtdWxhOiBwYXJhbXMsDQogICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICBkYXRhOiBkYXRhLA0KICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsNCiAgICAgICAgICAgICAgICAgICAgImNvbnRlbnQtdHlwZSI6ICJhcHBsaWNhdGlvbi9qc29uIiwNCiAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgfSkpLmRhdGE7DQogICAgICAgICAgICA8JT1sb2coKSU+cmV0KTsNCiAgICAgICAgICAgIHJldHVybiByZXQ7DQogICAgICAgIH1jYXRjaChleCl7DQogICAgICAgICAgICA8JT1lcnJvcigpJT5KU09OLnN0cmluZ2lmeShleC5yZXNwb25zZS5kYXRhLCBudWxsLCA0KSk7DQogICAgICAgIH0NCiAgICA8JSB9JT4NCiAgICB9DQo8JSB9JT4NCg0KPCUgaWYobWFpbkNsYXNzKFsnRmlsZVN5c3RlbSddKSl7JT4NCiAgICBhc3luYyA8JT1tTmFtZT0nX2ZpbGVzeXN0ZW0nJT4oZmlsZSwgY29udGVudCwgaWQsIG9iaj10aGlzKXsNCiAgICA8JSBpZihtYWluQ2xhc3MoWydGaWxlU3lzdGVtJ10pIT1jKXslPg0KICAgICAgICByZXR1cm4gYXdhaXQgbmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKG1haW5DbGFzcyhbJ0ZpbGVTeXN0ZW0nXSksIHRydWUpJT4oKS48JT1tTmFtZSU+KGZpbGUsIGNvbnRlbnQsIGlkLCBvYmopOw0KICAgIDwlIH1lbHNleyU+DQogICAgICAgIHRyeXsNCiAgICAgICAgICAgIGlmKCFmaWxlKSByZXR1cm4gbnVsbDsNCg0KICAgICAgICAgICAgbGV0IHJldCA9IHt9Ow0KICAgICAgICAgICAgbGV0IHBhdGggPSBvYmouX19jb25maWcoYHBhdGguJHtjb250ZW50Pyd3cml0ZSc6J3JlYWQnfWAsICh0eXBlb2YoZ2xvYmFsKSE9PSd1bmRlZmluZWQnPycuL2RiLyc6J2h0dHBzOi8ve3tvd25lcn19LmdpdGh1Yi5pby8nKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGlmKG9iai5fX2NvbmZpZygnbGl2ZScsIHRydWUpKXsNCiAgICAgICAgICAgICAgICBpZih0eXBlb2YoY29udGVudCkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgICAgIC8vIHdyaXRlDQogICAgICAgICAgICAgICAgICAgIGlmKHR5cGVvZihnbG9iYWwpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgZnMucHJvbWlzZXMubWtkaXIoKHBhdGggKyBmaWxlKS5yZXBsYWNlKC8oLipcLykuKi9nLCAnJDEnKSwgeyByZWN1cnNpdmU6IHRydWUgfSk7DQogICAgICAgICAgICAgICAgICAgICAgICByZXQgPSBnbG9iYWwuZnMud3JpdGVGaWxlU3luYyhwYXRoICsgZmlsZSwgdHlwZW9mKGNvbnRlbnQpPT09J29iamVjdCc/Lyp0aGlzLl9idG9hKCovSlNPTi5zdHJpbmdpZnkoY29udGVudCwgbnVsbCwgJ1x0JykvKikqLzpjb250ZW50KTsNCiAgICAgICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgICAgICA8JT13YXJuKCklPiJDYW5ub3Qgd3JpdGUgdG8gZmlsZSBzeXN0ZW0iKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICAvLyByZWFkDQogICAgICAgICAgICAgICAgICAgIGlmKHBhdGguc3RhcnRzV2l0aCgnaHR0cCcpICYmIHBhdGguaW5kZXhPZignOi8vJyk+MCl7DQogICAgICAgICAgICAgICAgICAgICAgICByZXQgPSBhd2FpdCB0aGlzLl9yZXN0KHVuZGVmaW5lZCwgbnVsbCwgbnVsbCwgbnVsbCwge3VybDogJ3BhdGgucmVhZCcsIGZpbGU6IGZpbGUgKyAnP3JhbmQ9JyArIE1hdGgucmFuZG9tKCksIHBhdGh9KTsNCiAgICAgICAgICAgICAgICAgICAgfWVsc2UgaWYodHlwZW9mKGdsb2JhbCkhPT0ndW5kZWZpbmVkJyAmJiBnbG9iYWwuZnMuZXhpc3RzU3luYyhwYXRoICsgZmlsZSkpew0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0ID0gZ2xvYmFsLmZzLnJlYWRGaWxlU3luYyhwYXRoICsgZmlsZSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIHJldCA9IHJldD8ocmV0LmRhdGEgfHwgcmV0KTpyZXQ7DQogICAgICAgICAgICA8JT1sb2coKSU+YFske29iai5fX2NvbmZpZygnbGl2ZScsIHRydWUpPycnOidOT1QgJ31MSVZFfCR7dHlwZW9mKGNvbnRlbnQpIT09J3VuZGVmaW5lZCc/J3dyaXRlJzoncmVhZCd9XSR7cGF0aCArIGZpbGV9OiAkeyhyZXQgfHwgJycpLmxlbmd0aH1gKTsNCiAgICAgICAgICAgIHJldHVybiByZXQ7DQogICAgICAgIH1jYXRjaChleCl7DQogICAgICAgICAgICA8JT1lcnJvcigpJT5leCk7DQogICAgICAgIH0NCiAgICA8JSB9JT4NCiAgICB9DQo8JSB9JT4NCg0KPCUgaWYobWFpbkNsYXNzKFsnR2l0SHViJ10pKXslPg0KICAgIGFzeW5jIDwlPW1OYW1lPSdfZ2l0aHViJyU+KGZpbGUsIGNvbnRlbnQsIGlkLCBvYmo9dGhpcyl7DQogICAgPCUgaWYobWFpbkNsYXNzKFsnR2l0SHViJ10pIT1jKXslPg0KICAgICAgICByZXR1cm4gYXdhaXQgbmV3IDwlPXNjb3BlJT4uPCU9bk5hbWUobWFpbkNsYXNzKFsnR2l0SHViJ10pKSU+KG51bGwsIHRoaXMuVG9vbCkuPCU9bU5hbWUlPihmaWxlLCBjb250ZW50LCBpZCwgb2JqKTsNCiAgICA8JSB9ZWxzZXslPg0KICAgICAgICB0cnl7DQogICAgICAgICAgICBpZighZmlsZSkgcmV0dXJuIG51bGw7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGxldCBzaGExID0gYXN5bmMgc3RyID0+IHR5cGVvZihjcnlwdG8uc3VidGxlKSE9PSd1bmRlZmluZWQnP0FycmF5LmZyb20obmV3IFVpbnQ4QXJyYXkoYXdhaXQgY3J5cHRvLnN1YnRsZS5kaWdlc3QoJ1NIQS0xJywgbmV3IFRleHRFbmNvZGVyKCkuZW5jb2RlKCdibG9iICcgKyBuZXcgQmxvYihbc3RyXSkuc2l6ZSArICdceDAwJyArIHN0cikpKSkubWFwKHYgPT4gdi50b1N0cmluZygxNikucGFkU3RhcnQoMiwgJzAnKSkuam9pbignJyk6c3RyLnN1YnN0cmluZygwLCAxMCk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIDwlPWxvZygpJT4iZmlsZSIsIGZpbGUsIGNvbnRlbnQ/J3B1dCc6J2dldCcpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBsZXQgcmV0ID0gYXdhaXQgdGhpcy5fcmVzdCh1bmRlZmluZWQsIG51bGwsIGNvbnRlbnQ/SlNPTi5zdHJpbmdpZnkoew0KICAgIAkJCW1lc3NhZ2U6ICJkZXBsb3llZCBieSA8JT1tTmFtZSU+KCkiLA0KICAgIAkJCXNoYTogaWQgfHwgY29udGVudFt0aGlzLl9fY29uZmlnKCdpZEZpZWxkJywgJ0lkJyldLA0KICAgIAkJCWNvbnRlbnQ6IHRoaXMuX2J0b2EodHlwZW9mKGNvbnRlbnQpPT09J29iamVjdCc/SlNPTi5zdHJpbmdpZnkoY29udGVudCwgbnVsbCwgJ1x0Jyk6Y29udGVudCksDQogICAgCQl9KTpudWxsLCBjb250ZW50PydwdXQnOm51bGwsIHsNCiAgICAJCSAgICBmaWxlOiAoZmlsZSArICgoY29udGVudCB8fCBmaWxlLmVuZHNXaXRoKCcvJykpPycnOignP3JhbmQ9JytNYXRoLnJhbmRvbSgpKSkpLA0KICAgIAkJfSk7DQogICAgCQkNCiAgICAJCWlmKCFyZXQpIHJldHVybiByZXQ7DQogICAgCQkNCiAgICAJCXJldCA9IGNvbnRlbnQ/cmV0LmNvbnRlbnQ6cmV0Ow0KDQogICAgICAgICAgICBsZXQgaWR4RmlsZSA9ICdpbmRleC5odG0nOw0KICAgICAgICAgICAgLy8gPCU9bG9nKCklPiJyZXQiLCByZXQpOw0KICAgIAkJaWYoQXJyYXkuaXNBcnJheShyZXQpKXsNCiAgICAJCSAgICAvLyBpbiBjYXNlIHdlIGFyZSBsaXN0aW5nIHRoZSBjb250ZW50cyBvZiBhIGZvbGRlciByZXNvdXJjZQ0KICAgIAkJICAgIHJldHVybiByZXQuZmlsdGVyKHIgPT4gKHR5cGVvZihyLnR5cGUpPT09J3VuZGVmaW5lZCcgfHwgci50eXBlPT0nZmlsZScpICYmIHIubmFtZSE9aWR4RmlsZSkubWFwKHIgPT4gKHtbdGhpcy5fX2NvbmZpZygnaWRGaWVsZCcsICdJZCcpXTogci5zaGEgfHwgclt0aGlzLl9fY29uZmlnKCdpZEZpZWxkJywgJ0lkJyldLCBuYW1lOiByLm5hbWUucmVwbGFjZSgnLmpzb24nLCAnJyl9KSk7DQogICAgCQl9DQogICAgCQkNCiAgICAJCWxldCBfdGhpcyA9IHt9Ow0KICAgIAkJaWYocmV0LnNoYSl7DQogICAgCQkgICAgdHJ5ew0KICAgICAgICAgICAgICAgICAgICBfdGhpcyA9IHJldC5jb250ZW50P0pTT04ucGFyc2UodGhpcy5fYXRvYihyZXQuY29udGVudCkpOnt9Ow0KICAgICAgICAgICAgICAgIH1jYXRjaChfZXgpew0KICAgICAgICAgICAgICAgICAgICA8JT13YXJuKCklPiJub3QgYSB2YWxpZCBKU09OIG9iamVjdCIsIGZpbGUpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAJCSAgDQogICAgCQkgICAgX3RoaXNbb2JqLl9fY29uZmlnKCdpZEZpZWxkJywgJ0lkJyldID0gcmV0LnNoYTsgLy8/Pw0KICAgIAkJfWVsc2UgaWYocmV0W3RoaXMuX19jb25maWcoJ2lkRmllbGQnLCAnSWQnKV0pew0KICAgIAkJICAgIC8vPCU9d2FybigpJT4nc2hhMScsIGZpbGUsIGF3YWl0IHNoYTEoSlNPTi5zdHJpbmdpZnkocmV0KSkpOw0KICAgIAkJICAgIF90aGlzID0gcmV0Ow0KICAgIAkJfQ0KICAgIAkJDQogICAgCQk8JT1sb2coKSU+ZmlsZSwgY29udGVudD8ncHV0JzonZ2V0JywgX3RoaXMpOw0KICAgIAkJDQogICAgICAgICAgICBsZXQgZlJvb3QgPSBmaWxlLnNwbGl0KCcvJykuc2xpY2UoMCwgLTEpLmpvaW4oJy8nKTsNCiAgICAgICAgICAgIGlmKGZpbGUuaW5kZXhPZihpZHhGaWxlKT49MCkgcmV0dXJuIHJldDsNCiAgICAgICAgICAgIGlkeEZpbGUgPSBmUm9vdCArICcvJyArIGlkeEZpbGU7DQogICAgCQkNCiAgICAJCWlmKC8qIW9iai5fX3N5bmNfb24oKSAmJiAqL2NvbnRlbnQpew0KICAgIAkJICAgIC8vIG5ldyBjb250ZW50IHN0b3JlZA0KICAgIAkJICAgIGxldCBpZHhSZXQgPSBhd2FpdCBvYmouPCU9bU5hbWUlPihpZHhGaWxlKTsNCiAgICAJCSAgICBsZXQgaWR4TGlzdCA9IGF3YWl0IG9iai48JT1tTmFtZSU+KGZSb290KTsNCiAgICAJCSAgICBhd2FpdCBvYmouPCU9bU5hbWUlPihpZHhGaWxlLCBpZHhMaXN0LCBpZHhSZXQ/aWR4UmV0LnNoYTpudWxsKTsNCiAgICAJCSAgICA8JT1sb2coKSU+ImZpbGUgY29udGVudCIsIGZpbGUsIGlkeEZpbGUsIHJldCwgaWR4TGlzdCk7DQogICAgCQl9DQogICAgCQkNCiAgICAgICAgICAgIHJldHVybiBfdGhpczsNCiAgICAgICAgfWNhdGNoKGV4KXsNCiAgICAgICAgICAgIDwlPWVycm9yKCklPmV4KTsNCiAgICAgICAgfQ0KICAgIDwlIH0lPg0KICAgIH0NCjwlIH0lPg0KDQo8JSBpZihtYWluQ2xhc3MoWydTYWxlc0ZvcmNlJ10pKXslPg0KICAgIDwlPW1OYW1lPSdfdG9TRlF1ZXJ5JyU+KGZpZWxkcywgb2JqcywgYlN0cmluZyl7DQogICAgICAgIGxldCByZXQgPSB0aGlzLl9fZXhwb3J0KHtbPCU9X25Db2RlKCklPl06IHtwYXJhbXM6IHt3aGVyZToge2FuZDogW10sIG9yOiBbXX19LCBlZGdlczoge25vZGU6IHt9fX19LCB7DQogICAgICAgICAgICAvL09QRVJBVE9SUzogdHJ1ZSwNCiAgICAgICAgICAgIElkOiAob2JqLCBlYUNvZGUsIHYpID0+IG9ials8JT1fbkNvZGUoKSU+XS5wYXJhbXMud2hlcmUuYW5kLnB1c2goe0lkOiB7ZXE6IHZ9fSksDQogICAgPCUgYy5FbnRpdHlBdHRyaWJ1dGVzLmZpbHRlcihlYSA9PiAhZWEuRW50aXR5TWV0aG9kKS5mb3JFYWNoKGVhID0+IHsgJT4NCiAgICAgICAgICAgIDwlPW5OYW1lKGVhKSU+OiAob2JqLCBlYUNvZGUsIHYpID0+IHsNCiAgICAgICAgICAgICAgICBsZXQgb3AgPSAnZXEnOw0KICAgICAgICAgICAgICAgIGxldCBjb25kID0ge1tlYUNvZGVdOiB7W29wXTogDQogICAgICAgIDwlIGlmKGVhLkVudGl0eVR5cGUpeyU+DQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlucTogew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFwaU5hbWU6ICdJZCcsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgWzwlPV9uQ29kZShlYS5FbnRpdHlUeXBlKSU+XTogdj92LjwlPW1OYW1lJT4oKVs8JT1fbkNvZGUoZWEuRW50aXR5VHlwZSklPl0ucGFyYW1zLndoZXJlLmFuZDpbXSwNCiAgICAgICAgICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgPCUgfWVsc2UgaWYoZWEuSXNEYXRlKXslPg0KICAgICAgICAgICAgICAgICAgICAodj92LnRvSVNPU3RyaW5nKCk6bnVsbCkNCiAgICAgICAgPCUgfWVsc2V7JT4NCiAgICAgICAgICAgICAgICAgICAgdg0KICAgICAgICA8JSB9JT4NCiAgICAgICAgICAgICAgICB9fTsNCiAgICAgICAgICAgICAgICBvYmpbPCU9X25Db2RlKCklPl0ucGFyYW1zLndoZXJlLmFuZC5wdXNoKGNvbmQpOw0KICAgICAgICAgICAgfSwNCiAgICA8JSB9KTsgJT4NCiAgICAgICAgfSwgIjwlPW1OYW1lJT4iKTsNCiAgICAgICAgDQogICAgICAgIC8vT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoayA9PiAhU3RyaW5nKHJldFtrXSkubGVuZ3RoKS5mb3JFYWNoKGsgPT4gZGVsZXRlIHJldFtrXSk7DQogICAgICAgIA0KICAgICAgICBpZihiU3RyaW5nKXsNCiAgICAgICAgICAgIHJldCA9IHtxdWVyeToge1s8JT1fbkNvZGUoKSU+ICsgJ1F1ZXJ5J106IHt1aWFwaToge3F1ZXJ5OiByZXR9fX19Ow0KICAgICAgICAgICAgcmV0ID0gSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KTsNCiAgICAgICAgfQ0KDQogICAgICAgIDwlPWxvZygpJT5yZXQpOw0KICAgICAgICByZXR1cm4gcmV0Ow0KICAgIH0NCjwlIH0lPg0KDQo8JSBpZihtYWluQ2xhc3MoWydTZXJ2aWNlTm93J10pKXslPg0KICAgIDwlDQogICAgbGV0IF9pZCA9IHMgPT4gLypzP3M6Ki9gdGhpcy5fdXVpZCgke3N8fHVuZGVmaW5lZH0pLnJlcGxhY2UoLy0vZywgJycpYDsNCiAgICBsZXQgX3RpZCA9IF9jID0+IF9pZCgiJyIrc2NvcGUrIi4iKyAoX2MgfHwgYykuTmFtZSArICInIik7DQogICAgbGV0IGFwcCA9ICgpID0+IHslPmFwcGxpY2F0aW9uKG5ldyA8JT1zY29wZSU+LjwlPV9jTmFtZSgnQXBwbGljYXRpb24nLCB0cnVlKSU+KCkuY29kZSh0aGlzLl9fY29uZmlnKCdzY29wZScsICc8JT1zY29wZSU+JykpKTwlfTsNCiAgICANCiAgICBsZXQgbGFiZWwgPSAodCwgbiwgYywgcCkgPT4ge249c3IuRW5nbGlzaE5hbWUobik7ICU+LjwlPXQlPl9GaWVsZF9MYWJlbHMoW25ldyA8JT1zY29wZSU+LjwlPV9jTmFtZSgnRmllbGQgTGFiZWwnLCB0cnVlKSU+KDwlPV9pZCgpJT4pLnJlbWFyaygnPCU9biU+JykubmFtZSgnPCU9biU+JykuY29kZSg8JT1jJT4pLmxhbmd1YWdlKCdlbicpLnBsdXJhbCgnPCU9KHAgfHwgKG4gKyAncycpKSU+JykuPCVhcHAoKSU+XSk8JX07JT4NCg0KICAgIDwlPW1OYW1lPSdfdG9TTlRhYmxlJyU+KCl7DQogICAgICAgIC8vdGhpcy5fZGVmYXVsdHMoKTsNCg0KICAgICAgICB0cnl7DQogICAgPCUgaWYoX2NOYW1lKCdBcHBsaWNhdGlvbicpICYmIF9jTmFtZSgnQ29sdW1uJykpeyU+DQogICAgICAgICAgICBsZXQgcmV0ID0gdGhpcy5fX2V4cG9ydChuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUoJ1RhYmxlJywgdHJ1ZSklPig8JT1fdGlkKCklPikuY29kZSg8JT1fbkNvZGUoKSU+KS48JWFwcCgpJT4ubmFtZSgnPCU9Yy5OYW1lJT4nKS5yZW1hcmsoYDwlPWMuUmVtYXJrJT5gKS5hY3RpdmUodHJ1ZSkuZW5hYmxlZCh0cnVlKSwgew0KICAgICAgICAgICAgICAgIEZ1bGw6IHRydWUsDQogICAgICAgICAgICAgICAgTnVsbDogdHJ1ZSwNCiAgICAgICAgPCUgYy5FbnRpdHlBdHRyaWJ1dGVzLmZpbHRlcihlYSA9PiAhZWEuRW50aXR5TWV0aG9kKS5mb3JFYWNoKGVhID0+IHsgJT4NCiAgICAgICAgICAgICAgICA8JT1uTmFtZShlYSklPjogKG9iaiwgZWFDb2RlLCB2KSA9PiBvYmoudGFibGVfQ29sdW1ucyhuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUoJ0NvbHVtbicsIHRydWUpJT4oPCU9X2lkKCInIitzY29wZSsiLiIrYy5OYW1lKyInK2VhQ29kZSIpJT4pLmFjdGl2ZSh0cnVlKS5lbmFibGVkKHRydWUpLm5hbWUoIjwlPXNyLkVuZ2xpc2hOYW1lKGVhLk5hbWUpJT4iKS5jb2RlKGVhQ29kZSkudHlwZSgnPCU9X0ZyRU1ELl9hdHRyKGVhKSU+JykucmVmZXJlbmNlKDwlaWYoZWEuRW50aXR5VHlwZSl7JT4odiB8fCBuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUoZWEuRW50aXR5VHlwZSwgdHJ1ZSklPigpKS48JT1tTmFtZSU+KCk8JX1lbHNleyU+bnVsbDwlfSU+KS8qPCVsYWJlbCgnY29sdW1uJywgZWEuTmFtZSwgJ2VhQ29kZScsIGVhLlBsdXJhbCklPiovKSwNCiAgICAgICAgPCUgfSklPg0KICAgICAgICA8JSBjLlR5cGVkQXR0cmlidXRlcy5maWx0ZXIodGEgPT4gIXRhLkVudGl0eU1ldGhvZCkuZm9yRWFjaCh0YSA9PiB7bGV0IHRhTmFtZSA9IG5OYW1lKHRhKSArICdfJyArIHRhLkVudGl0eUNsYXNzLlBsdXJhbC5yZXBsYWNlKC8gL2csICdfJyk7JT4NCiAgICAgICAgICAgICAgICA8JT10YU5hbWUlPjogKG9iaiwgZWFDb2RlLCB2KSA9PiBvYmoucmVmZXJlbmNlX0NvbHVtbnMobmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKCdDb2x1bW4nLCB0cnVlKSU+KCkuYWN0aXZlKGZhbHNlKS5lbmFibGVkKHRydWUpLmNvZGUoZWFDb2RlKS50eXBlKCdMaXN0JykubmFtZSgiPCU9bk5hbWUodGEpJT4gPCU9dGEuRW50aXR5Q2xhc3MuUGx1cmFsJT4iKS5yZWZlcmVuY2UobmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKHRhLkVudGl0eUNsYXNzLCB0cnVlKSU+KCkuPCU9bU5hbWUlPigpKS8qPCVsYWJlbCgnY29sdW1uJywgdGEuTmFtZSsnICcrdGEuRW50aXR5Q2xhc3MuUGx1cmFsLCAnZWFDb2RlJywgdGEuRW50aXR5Q2xhc3MuUGx1cmFsKSU+Ki8pLA0KICAgICAgICA8JSB9KSU+DQogICAgICAgICAgICB9LCAiPCU9bU5hbWUlPiIpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICByZXR1cm4gcmV0Ow0KICAgIDwlIH1lbHNleyU+DQogICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICA8JSB9JT4NCiAgICAgICAgfWNhdGNoKGV4KXsNCiAgICAgICAgICAgIDwlPWVycm9yKCklPmV4KTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICANCiAgICA8JT1tTmFtZT0nX3RvU05GbG93JyU+KGJEcmFmdCwgYkhlYWRlcil7DQogICAgICAgIHRyeXsNCiAgICA8JSBpZihfY05hbWUoJ0FwcGxpY2F0aW9uJykgJiYgX2NOYW1lKCdGbG93JykpeyU+DQogICAgICAgIDwlIGxldCBiT3JkZXIgPSAxOyBsZXQgX2ZpZCA9IF9jID0+IF9pZCgiJyIrc2NvcGUrIi4nICsgKGJEcmFmdD8nZCc6J3MnKSArICdsIisgKF9jIHx8IGMpLk5hbWUgKyAiJyIpOw0KICAgICAgICBsZXQgbG9naWMgPSAobiwgdCwgbWFwPVtdKSA9PiB7JT4NCiAgICAgICAgICAgIG5ldyA8JT1zY29wZSU+LjwlPV9jTmFtZSgnRmxvdyBMb2dpYycsIHRydWUpJT4oPCU9X2lkKCklPikub3JkZXIoPCU9Yk9yZGVyKyslPikuY29kZSh0aGlzLl91dWlkKCkpLm5hbWUoJzwlPW4lPicpLnJlbWFyaygnPCU9biU+JykNCiAgICAgICAgICAgICAgICAuYmxvY2sobmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKCdGbG93IEJsb2NrJywgdHJ1ZSklPig8JT1faWQoKSU+KS5jb2RlKDwlPV9pZCgpJT4pLm5hbWUoJzwlPW4lPicpDQogICAgICAgICAgICAgICAgICAgIC5ibG9ja19FbGVtZW50X01hcHBpbmdzKFs8JSBtYXAuZmlsdGVyKG0gPT4gbSkuZm9yRWFjaChtID0+IHslPg0KICAgICAgICAgICAgICAgICAgICAgICAgbmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKCdFbGVtZW50IE1hcHBpbmcnLCB0cnVlKSU+KDwlPV9pZCgpJT4pLm5hbWUoIjwlPW4lPiAtICIgKyA8JT1tLmNkJT4pLmNvZGUoPCU9bS5jZCU+KS52YWx1ZSg8JT1tLnYlPik8JXBDb21wb3VuZChtLnYsIG0udHJuKSU+LA0KICAgICAgICAgICAgICAgICAgICA8JX0pJT5dKQ0KICAgICAgICAgICAgICAgICkuZGVmaW5pdGlvbihuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUoJ0xvZ2ljIERlZmluaXRpb24nLCB0cnVlKSU+KCc8JT10JT4gPCU9biU+JykuY29kZSgnPCU9dCU+JykubmFtZSgnPCU9dCU+JykpLjwlYXBwKCklPg0KICAgICAgICA8JX0NCiAgICAgICAgbGV0IGFjdGlvbiA9IChhQ29kZSwgcGFyYW1zPXt9KSA9PiB7ICU+DQogICAgICAgICAgICBuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUoJ0FjdGlvbiBJbnN0YW5jZScsIHRydWUpJT4oPCU9X2lkKCklPikuY29kZSh0aGlzLl91dWlkKCkpLmFjdGlvbihuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUoJ0FjdGlvbiBUeXBlJywgdHJ1ZSklPig8JT1faWQoKSU+KS5jb2RlKCc8JT1hQ29kZSU+JykpLm9yZGVyKDwlPWJPcmRlcisrJT4pLjwlYXBwKCklPg0KICAgICAgICAgICAgLmFjdGlvbl9WYXJpYWJsZV9WYWx1ZXMoWw0KICAgICAgICAgICAgPCUgT2JqZWN0LmtleXMocGFyYW1zKS5mb3JFYWNoKHAgPT4geyU+DQogICAgICAgICAgICAgICAgbmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKCdWYXJpYWJsZSBWYWx1ZScsIHRydWUpJT4oKS5jb2RlKCc8JT1wJT4nKS52YWx1ZSg8JT1wYXJhbXNbcF0lPikuYWN0aW9uSW5wdXQoDQogICAgICAgICAgICAgICAgICAgIG5ldyA8JT1zY29wZSU+LjwlPV9jTmFtZSgnQWN0aW9uIElucHV0JywgdHJ1ZSklPigpLmNvZGUoJzwlPXAlPicpDQogICAgICAgICAgICAgICAgKS5tYXBwaW5nKG5ldyA8JT1zY29wZSU+LjwlPV9jTmFtZSgnRWxlbWVudCBNYXBwaW5nJywgdHJ1ZSklPigpLmNvZGUoJzwlPXAlPicpLnZhbHVlKCIiKSksDQogICAgICAgICAgICA8JSB9KSU+DQogICAgICAgICAgICBdKQ0KICAgICAgICA8JX0NCiAgICAgICAgbGV0IHN1YmZsb3cgPSAoZmxvdywgcGFyYW1zPXt9LCBiTm9XYWl0KSA9PiB7ICU+DQogICAgICAgICAgICBuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUoJ0Zsb3cgSW5zdGFuY2UnLCB0cnVlKSU+KDwlPV9pZCgpJT4pLmNvZGUodGhpcy5fdXVpZCgpKS5zdWJmbG93KDwlPWZsb3clPikub3JkZXIoPCU9Yk9yZGVyKyslPikuPCVhcHAoKSU+DQogICAgICAgICAgICA8JSBpZighYk5vV2FpdCl7JT4NCiAgICAgICAgICAgIC5pbnN0YW5jZV9GbG93X0luc3RhbmNlX0lucHV0cyhbbmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKCdGbG93IEluc3RhbmNlIElucHV0JywgdHJ1ZSklPig8JT1faWQoKSU+KS5jb2RlKCd3YWl0X2Zvcl9jb21wbGV0aW9uJykubmFtZSgnV2FpdCBmb3IgQ29tcGxldGlvbicpLnR5cGUoJ0Jvb2wnKV0pDQogICAgICAgICAgICAuaW5zdGFuY2VfVmFyaWFibGVfVmFsdWVzKFsNCiAgICAgICAgICAgICAgICAgICAgbmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKCdWYXJpYWJsZSBWYWx1ZScsIHRydWUpJT4oKS5jb2RlKCd3YWl0X2Zvcl9jb21wbGV0aW9uJykudmFsdWUoJzEnKQ0KICAgICAgICAgICAgICAgICAgICAubWFwcGluZyhuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUoJ0VsZW1lbnQgTWFwcGluZycsIHRydWUpJT4oKS5jb2RlKCd3YWl0X2Zvcl9jb21wbGV0aW9uJykpDQogICAgICAgICAgICBdKQ0KICAgICAgICAgICAgPCV9JT4NCiAgICAgICAgICAgIC5pbnN0YW5jZV9WYXJpYWJsZV9WYWx1ZXMoWw0KICAgICAgICAgICAgPCUgT2JqZWN0LmtleXMocGFyYW1zKS5mb3JFYWNoKHAgPT4geyU+DQogICAgICAgICAgICAgICAgbmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKCdWYXJpYWJsZSBWYWx1ZScsIHRydWUpJT4oKS5jb2RlKCc8JT1wJT4nKS52YWx1ZSg8JT1wYXJhbXNbcF0lPikuZmxvd0lucHV0KA0KICAgICAgICAgICAgICAgICAgICBuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUoJ0Zsb3cgSW5wdXQnLCB0cnVlKSU+KCkuY29kZSgnPCU9cCU+JykNCiAgICAgICAgICAgICAgICApLm1hcHBpbmcobmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKCdFbGVtZW50IE1hcHBpbmcnLCB0cnVlKSU+KCkuY29kZSgnPCU9cCU+JykudmFsdWUoPCU9cGFyYW1zW3BdJT4pKQ0KICAgICAgICAgICAgPCUgfSklPg0KICAgICAgICAgICAgXSkNCiAgICAgICAgPCV9DQogICAgICAgIGxldCBwQ29tcG91bmQgPSAodiwgdHJuKSA9PiB7aWYoIXRybikgcmV0dXJuOyAlPi5lbGVtZW50TWFwcGluZ19QaWxsX0NvbXBvdW5kcyhbbmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKCdQaWxsIENvbXBvdW5kJywgdHJ1ZSklPih0aGlzLl91dWlkKCkpLmNvZGUoJycpLm5hbWUoPCU9diU+KS5vcmRlcigwKS8qLnJlbWFyayh0aGlzLl9idG9hKGA8JT1KU09OLnN0cmluZ2lmeShbXSklPmApKSovLjwlYXBwKCklPg0KICAgICAgICAgICAgLnBhcmVudF9QaWxsX0NvbXBvdW5kcyhbDQogICAgICAgICAgICA8JSBPYmplY3Qua2V5cyh0cm4pLmZvckVhY2goKHQsIGkpID0+IHslPiBuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUoJ1BpbGwgQ29tcG91bmQnLCB0cnVlKSU+KHRoaXMuX3V1aWQoKSkuY29kZSgiPCU9dCU+Iikub3JkZXIoPCU9aSsxJT4pLm5hbWUoPCU9diU+KS5yZW1hcmsodGhpcy5fYnRvYShgPCU9SlNPTi5zdHJpbmdpZnkodHJuW3RdKSU+YCkpLjwlYXBwKCklPi8qLnRyYW5zZm9ybShuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUoJ1RyYW5zZm9ybScsIHRydWUpJT4oPCU9X2lkKCklPikuY29kZSgnPCU9dCU+JykudHJhbnNmb3JtX1RyYW5zZm9ybV9Db21wb3NpdGlvbnMoW25ldyA8JT1zY29wZSU+LjwlPV9jTmFtZSgnVHJhbnNmb3JtIENvbXBvc2l0aW9uJywgdHJ1ZSklPigpLmNvZGUoJycpXSkpKi8sDQogICAgICAgICAgICA8JSB9KSU+DQogICAgICAgICAgICBdKV0pDQogICAgICAgIDwlIH0lPg0KICAgICAgICAgICAgDQogICAgICAgICAgICANCiAgICAgICAgICAgIC8qDQogICAgICAgICAgICAgKiBPT0IgRW5kcG9pbnQ6IGh0dHBzOi8vZGV2MTYyNTcwLnNlcnZpY2Utbm93LmNvbS9hcGkvbm93L3Byb2Nlc3NmbG93L2Zsb3dvYmplY3Qvc3RhcnQvc3ViZmxvdw0KICAgICAgICAgICAgICogUGF5bG9hZDogeyJuYW1lIjoieF83ODYxMV9zY2hvb2xfbWFuLlVzZXJfbG9va3VwIiwiaW5wdXRzIjp7Impzb24iOnsibmFtZSI6InRlc3QiLCJnZW5kZXIiOnsiY29kZSI6Ik0iLCAiT1BFUkFUT1JTIjogeyJjb2RlIjogIiE9In19LCJ1c2VyX1N0dWRlbnRzIjpbeyJuYW1lIjoiU1RBIiwiZ2VuZGVyIjp7ImNvZGUiOiJNIn19XX19fQ0KICAgICAgICAgICAgKi8NCg0KICAgICAgICAgICAgbGV0IGZsb3cgPSBuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUoJ0Zsb3cnLCB0cnVlKSU+KDwlPV9maWQoKSU+KS5uYW1lKCc8JT1jLk5hbWUlPiBMb29rdXAnKS5jb2RlKDwlPV9uQ29kZSgpJT4gKyAnX2xvb2t1cCcpLjwlYXBwKCklPi5hY3RpdmUodHJ1ZSkuZW5hYmxlZCh0cnVlKTsNCiAgICAgICAgICAgIGlmKGJIZWFkZXIpIHJldHVybiBmbG93Ow0KICAgICAgICAgICAgDQogICAgICAgICAgICByZXR1cm4gdGhpcy5fX2V4cG9ydChmbG93LyouX2RlZmF1bHRzKCkqLw0KICAgICAgICAgICAgICAgIC5mbG93X0Zsb3dfU2V0dGluZ3MoW25ldyA8JT1zY29wZSU+LjwlPV9jTmFtZSgnRmxvdyBTZXR0aW5nJywgdHJ1ZSklPig8JT1faWQoKSU+KS5jb2RlKCdBQ1RJT04nKV0pDQogICAgICAgICAgICAgICAgLmZsb3dfRmxvd19JbnB1dHMoWw0KICAgICAgICAgICAgICAgICAgICBuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUoJ0Zsb3cgSW5wdXQnLCB0cnVlKSU+KDwlPV9pZCgpJT4pLmFjdGl2ZSh0cnVlKS5jb2RlKCdqc29uJykubmFtZSgnSlNPTicpLnR5cGUoJ0pTT04nKTwlbGFiZWwoJ2lucHV0JywgJ0pTT04nLCAiJ2pzb24nIiklPg0KICAgICAgICAgICAgICAgIF0pLmZsb3dfRmxvd19PdXRwdXRzKFsNCiAgICAgICAgICAgICAgICAgICAgbmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKCdGbG93IE91dHB1dCcsIHRydWUpJT4oPCU9X2lkKCklPikuYWN0aXZlKHRydWUpLmNvZGUoPCU9X25Db2RlKCklPiArICdfbGlzdCcpLm5hbWUoJzwlPW5OYW1lKGMpJT4gTGlzdCcpLnR5cGUoJ0xpc3QnKS5yZWZlcmVuY2UobmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKCdUYWJsZScsIHRydWUpJT4oIjwlPW5OYW1lKGMpJT4iKS5uYW1lKCc8JT1jLk5hbWUlPicpLmNvZGUoPCU9X25Db2RlKCklPikuPCVhcHAoKSU+KQ0KICAgICAgICAgICAgICAgICAgICA8JWxhYmVsKCdvdXRwdXQnLCBjLk5hbWUgKyAnIExpc3QnLCBfbkNvZGUoKSArICIrICdfbGlzdCciKSU+DQogICAgICAgICAgICAgICAgXSkuZmxvd19GbG93X1ZhcmlhYmxlcyhbDQogICAgICAgICAgICAgICAgICAgIG5ldyA8JT1zY29wZSU+LjwlPV9jTmFtZSgnRmxvdyBWYXJpYWJsZScsIHRydWUpJT4oPCU9X2lkKCklPikuYWN0aXZlKHRydWUpLmNvZGUoJ2pzb24nKS5uYW1lKCdKU09OJykudHlwZSgnSlNPTicpPCVsYWJlbCgndmFyaWFibGUnLCAnSlNPTicsICcianNvbiInKSU+LA0KICAgICAgICAgICAgICAgICAgICBuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUoJ0Zsb3cgVmFyaWFibGUnLCB0cnVlKSU+KDwlPV9pZCgpJT4pLmFjdGl2ZSh0cnVlKS5jb2RlKCdlcXVlcnknKS5uYW1lKCdFUXVlcnknKS50eXBlKCdTdHJpbmcnKTwlbGFiZWwoJ3ZhcmlhYmxlJywgJ0VRdWVyeScsICciZXF1ZXJ5IicpJT4sDQogICAgICAgICAgICAgICAgXSkuZmxvd19GbG93X0xvZ2ljcyhbDQogICAgICAgICAgICAgICAgICAgIDwlbG9naWMoJ1NldCAnICsgYy5OYW1lICsgJyBKU09OJywgJ1NldCBGbG93IFZhcmlhYmxlcycsIFt7Y2Q6ICInanNvbiciLCB2OiAiJ3t7c3ViZmxvdy5qc29ufX0nIn1dKSU+LA0KICAgICAgICAgICAgICAgICAgICA8JSAvLyAsIHRybjoge3JlcGxhY2Vfc3RyaW5nOiB7cmVnZXg6ICIvL2ciLCByZXBsYWNlX3N0cmluZzogIiJ9fSU+DQogICAgICAgICAgICAgICAgXSkuc2VjdXJpdHlDb250cm9sKG5ldyA8JT1zY29wZSU+LjwlPV9jTmFtZSgnU2VjdXJpdHkgQ29udHJvbCcsIHRydWUpJT4oPCU9X2lkKCklPikuY29kZSgnc3lzX2h1Yl9mbG93JykubmFtZShgc3lzX3Njb3BlLnNjb3BlPSR7dGhpcy5fX2NvbmZpZygnc2NvcGUnLCAnPCU9c2NvcGUlPicpfWApLnR5cGUobmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKCdTZWN1cml0eSBUeXBlJywgdHJ1ZSklPigpLmNvZGUoJ2NsaWVudF9jYWxsYWJsZV9mbG93X29iamVjdCcpKS5vcGVyYXRpb24obmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKCdTZWN1cml0eSBPcGVyYXRpb24nLCB0cnVlKSU+KCkuY29kZSgnZXhlY3V0ZScpKS48JWFwcCgpJT4pLCB7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgLy9leHBvcnRlcjogdiA9PiB2Lm9iaiA9IHYucmV1c2VkP25ldyA8JT1zY29wZSU+LjwlPV9jTmFtZSgnRmxvdycsIHRydWUpJT4odi5vYmouSWQpOnYub2JqLCAvKmluZm9ybWF0aW9uIGxvc3MqLw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIE51bGw6ICFiSGVhZGVyLA0KICAgICAgICAgICAgICAgIEZ1bGw6IHRydWUsDQogICAgICAgICAgICAgICAgDQogICAgICAgIDwlIGMuRW50aXR5QXR0cmlidXRlcy5maWx0ZXIoZWEgPT4gIWVhLkVudGl0eU1ldGhvZCkuZm9yRWFjaChlYSA9PiB7ICU+DQogICAgICAgICAgICAgICAgPCU9bk5hbWUoZWEpJT46IChvYmosIGVhQ29kZSwgdikgPT4gb2JqPCVpZigwIHx8IChbJ25hbWUnLCAncmVtYXJrJywgJ2RhdGUnLCAnb3JkZXInLCAnYWN0aXZlJywgJ2VuYWJsZWQnXS5pbmRleE9mKGVhLk5hbWUpPDApKXslPi5mbG93X0Zsb3dfVmFyaWFibGVzKFsNCiAgICAgICAgICAgICAgICAgICAgbmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKCdGbG93IFZhcmlhYmxlJywgdHJ1ZSklPig8JT1faWQoKSU+KS5jb2RlKGVhQ29kZSkubmFtZSgnPCU9c3IuRW5nbGlzaE5hbWUoZWEuTmFtZSklPicpLnR5cGUoPCUgaWYoZWEuRW50aXR5VHlwZSl7JT4nSlNPTic8JSB9ZWxzZXslPic8JT1fRnJFTUQuX2F0dHIoZWEpJT4nPCV9JT4pPCVsYWJlbCgndmFyaWFibGUnLCBlYS5OYW1lLCAiZWFDb2RlIiklPiwNCiAgICAgICAgICAgICAgICAgICAgbmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKCdGbG93IFZhcmlhYmxlJywgdHJ1ZSklPig8JT1faWQoKSU+KS5uYW1lKCc8JT1uTmFtZShjKSU+LjwlPWVhLk5hbWUlPi5TZXQnKS5jb2RlKGVhQ29kZSArICdfc2V0JykubmFtZSgnPCU9c3IuRW5nbGlzaE5hbWUoZWEuTmFtZSklPiBTZXQnKS50eXBlKCdCb29sJyk8JWxhYmVsKCd2YXJpYWJsZScsIGVhLk5hbWUgKyAnIFNldCcsICJlYUNvZGUgKyAnX3NldCciKSU+LA0KICAgICAgICAgICAgICAgICAgICBuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUoJ0Zsb3cgVmFyaWFibGUnLCB0cnVlKSU+KDwlPV9pZCgpJT4pLmNvZGUoZWFDb2RlICsgJ19vcCcpLm5hbWUoJzwlPXNyLkVuZ2xpc2hOYW1lKGVhLk5hbWUpJT4gT3BlcmF0b3InKS50eXBlKCdTdHJpbmcnKTwlbGFiZWwoJ3ZhcmlhYmxlJywgZWEuTmFtZSArICcgT3BlcmF0b3InLCAiZWFDb2RlICsgJ19vcCciKSU+LA0KICAgICAgICAgICAgICAgICAgICBdKS5mbG93X0Zsb3dfTG9naWNzKFsNCiAgICAgICAgICAgICAgICAgICAgPCVsb2dpYygnU2V0ICcrZWEuTmFtZSwgJ1NldCBGbG93IFZhcmlhYmxlcycsIFsNCiAgICAgICAgICAgICAgICAgICAgICAgIGVhLkVudGl0eVR5cGU/bnVsbDp7Y2Q6ICJlYUNvZGUiLCB2OiAiJ3t7Zmxvd192YXJpYWJsZS5qc29ufX0nIiwgdHJuOiBPYmplY3QuYXNzaWduKHt9LCB7dmFsdWVfbWFwOiB7a2V5OiAiJHtlYUNvZGV9IiwgZGVmYXVsdDogIiJ9fSwgZWEuX0lzRGF0ZT97c3RyaW5nX3RvX2RhdGU6IHtkYXRlX2Zvcm1hdDogInl5eXktTU0tZGRcJ1RcJ0hIOm1tOnNzXCdaXCciLCBjdXN0b21fZm9ybWF0OiAiIn19Ont9KX0sDQogICAgICAgICAgICAgICAgICAgICAgICAvL3tjZDogImVhQ29kZSsnX3NldCciLCB2OiAiJ3t7Zmxvd192YXJpYWJsZS4nK2VhQ29kZSsnfX19JyIsIHRybjoge2lzX251bGw6IHt9fX0sDQogICAgICAgICAgICAgICAgICAgICAgICAvL3tjZDogImVhQ29kZSsnX29wJyIsIHY6ICIne3tmbG93X3ZhcmlhYmxlLm9wZXJhdG9yc319JyIsIHRybjoge3ZhbHVlX21hcDoge2tleTogIiR7ZWFDb2RlfSJ9fX0sDQogICAgICAgICAgICAgICAgICAgIF0pJT4ubG9naWNfRmxvd19JbnB1dF9TY3JpcHRzKFsNCiAgICAgICAgICAgICAgICAgICAgICAgIDwlaWYoZWEuRW50aXR5VHlwZSl7JT5uZXcgPCU9c2NvcGUlPi48JT1fY05hbWUoJ0Zsb3cgSW5wdXQgU2NyaXB0JywgdHJ1ZSklPig8JT1faWQoKSU+KS5uYW1lKCdTZXQgPCU9ZWEuTmFtZSU+JykuYWN0aXZlKHRydWUpLmNvZGUoZWFDb2RlKS5yZW1hcmsoYHJldHVybiBmZF9kYXRhLmZsb3dfdmFyLmpzb24uJHtlYUNvZGV9O2ApLDwlfSU+DQogICAgICAgICAgICAgICAgICAgICAgICBuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUoJ0Zsb3cgSW5wdXQgU2NyaXB0JywgdHJ1ZSklPig8JT1faWQoKSU+KS5uYW1lKCdTZXQgPCU9ZWEuTmFtZSU+IFNldCcpLmFjdGl2ZSh0cnVlKS5jb2RlKGVhQ29kZSArICdfc2V0JykucmVtYXJrKGByZXR1cm4gdHlwZW9mKGZkX2RhdGEuZmxvd192YXIuanNvbi4ke2VhQ29kZX0pIVx1MDAzZFx1MDAzZFx1MDAyN3VuZGVmaW5lZFx1MDAyNztgKSwNCiAgICAgICAgICAgICAgICAgICAgICAgIG5ldyA8JT1zY29wZSU+LjwlPV9jTmFtZSgnRmxvdyBJbnB1dCBTY3JpcHQnLCB0cnVlKSU+KDwlPV9pZCgpJT4pLm5hbWUoJ1NldCA8JT1lYS5OYW1lJT4gT3BlcmF0b3InKS5hY3RpdmUodHJ1ZSkuY29kZShlYUNvZGUgKyAnX29wJykucmVtYXJrKGByZXR1cm4gKGZkX2RhdGEuZmxvd192YXIuanNvbi5PUEVSQVRPUlMgfHwge30pLiR7ZWFDb2RlfTtgKSwNCiAgICAgICAgICAgICAgICAgICAgXSksDQoNCiAgICAgICAgICAgICAgICAgICAgPCVsb2dpYygnSWYgJyArIGMuTmFtZSArICcgJytlYS5OYW1lKycgU2V0JywgJ0lmJywgW3tjZDogIidjb25kaXRpb24nIiwgdjogIid7e2Zsb3dfdmFyaWFibGUuJyArIGVhQ29kZSArICdfc2V0fX09dHJ1ZScifV0pJT4NCiAgICAgICAgICAgICAgICAgICAgPCVpZihlYS5FbnRpdHlUeXBlKXslPi5wYXJlbnRfRmxvd19JbnN0YW5jZXMoPCVzdWJmbG93KCduZXcgJytzY29wZSsnLicrX2NOYW1lKGVhLkVudGl0eVR5cGUsIHRydWUpKycoKS4nK21OYW1lKycoZmFsc2UsIHRydWUpJywge2pzb246ICIne3tmbG93X3ZhcmlhYmxlLicrZWFDb2RlKyd9fScifSklPik8JX0lPg0KICAgICAgICAgICAgICAgICAgICAucGFyZW50X0Zsb3dfTG9naWNzKFsNCiAgICAgICAgICAgICAgICAgICAgICAgIDwlbG9naWMoJ0FkZCAnK2VhLk5hbWUrJyB0byAnICsgYy5OYW1lICsgJyBFUXVlcnknLCAnU2V0IEZsb3cgVmFyaWFibGVzJywgW3tjZDogIidlcXVlcnknIiwgdjogIid7e2Zsb3dfdmFyaWFibGUuZXF1ZXJ5fX1eJytlYUNvZGUifV0pJT4sDQogICAgICAgICAgICAgICAgICAgICAgICA8JWxvZ2ljKCdJZiAnICsgYy5OYW1lICsgJyAnK2VhLk5hbWUrJyBPcGVyYXRvciBpcyBub3QgZW1wdHknLCAnSWYnLCBbe2NkOiAiJ2NvbmRpdGlvbiciLCB2OiAiJ3t7Zmxvd192YXJpYWJsZS4nK2VhQ29kZSsnX29wfX0hPScifV0pJT4ucGFyZW50X0Zsb3dfTG9naWNzKFsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8JWxvZ2ljKCdBcHBlbmQgJytlYS5OYW1lKycgT3BlcmF0b3IgdG8gJyArIGMuTmFtZSArICcgRVF1ZXJ5JywgJ1NldCBGbG93IFZhcmlhYmxlcycsIFt7Y2Q6ICInZXF1ZXJ5JyIsIHY6ICIne3tmbG93X3ZhcmlhYmxlLmVxdWVyeX19e3tmbG93X3ZhcmlhYmxlLicrZWFDb2RlKydfb3B9fScifV0pJT4NCiAgICAgICAgICAgICAgICAgICAgICAgIF0pLA0KICAgICAgICAgICAgICAgICAgICAgICAgPCVsb2dpYygnRWxzZSAnICsgYy5OYW1lICsgJyAnK2VhLk5hbWUrJyBub3QgU2V0JywgJ0Vsc2UnKSU+LnBhcmVudF9GbG93X0xvZ2ljcyhbDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPCVsb2dpYygnQXBwZW5kID0gdG8gJyArIGMuTmFtZSArICcgRVF1ZXJ5IGZvciAnK2VhLk5hbWUsICdTZXQgRmxvdyBWYXJpYWJsZXMnLCBbe2NkOiAiJ2VxdWVyeSciLCB2OiAiJ3t7Zmxvd192YXJpYWJsZS5lcXVlcnl9fT0nIn1dKSU+DQogICAgICAgICAgICAgICAgICAgICAgICBdKSwNCiAgICAgICAgICAgICAgICAgICAgICAgIDwlaWYoZWEuRW50aXR5VHlwZSl7JT48JWxvZ2ljKCdGb3IgZWFjaCAnK2MuTmFtZSsnICcrZWEuTmFtZSwgJ0ZvciBFYWNoJywgW3tjZDogIidpdGVtcyciLCB2OiAiJ3t7PDwqKiMkZltpbnRlcm5hbF9uYW1lPVxcJyIrYy5OYW1lKyJfbG9va3VwXFwnIGFuZCAkbm90KCRleGlzdHMoZmxvd19GbG93X1NuYXBzaG90cykpXS5zbmFwc2hvdF9GbG93X0xvZ2ljcy4qKi5wYXJlbnRfRmxvd19JbnN0YW5jZXMjJGZpWyRudW1iZXIob3JkZXIpPD0iK2JPcmRlcisiIGFuZCBzdWJmbG93LmludGVybmFsX25hbWU9XFwnIitlYS5FbnRpdHlUeXBlLk5hbWUrIl9sb29rdXBcXCddLnVpX2lkPj4uIitlYS5FbnRpdHlUeXBlLk5hbWUrIl9saXN0fX0nIn1dKSU+LnBhcmVudF9GbG93X0xvZ2ljcyhbPCV9JT4NCiAgICAgICAgICAgICAgICAgICAgICAgIDwlbG9naWMoJ0FwcGVuZCAnK2VhLk5hbWUrJyB0byAnICsgYy5OYW1lICsgJyBFUXVlcnknLCAnU2V0IEZsb3cgVmFyaWFibGVzJywgW3tjZDogIidlcXVlcnknIiwgdjogIid7e2Zsb3dfdmFyaWFibGUuZXF1ZXJ5fX17e2Zsb3dfdmFyaWFibGUuJytlYUNvZGUrJ319JyJ9XSklPiwNCiAgICAgICAgICAgICAgICAgICAgICAgIDwlaWYoZWEuRW50aXR5VHlwZSl7JT5dKTwlfSU+LA0KICAgICAgICAgICAgICAgICAgICBdKSwNCiAgICAgICAgICAgICAgICBdKTwlfSU+DQogICAgICAgICAgICAgICAgLA0KICAgICAgICA8JSB9KSU+DQogICAgICAgIDwlIGMuVHlwZWRBdHRyaWJ1dGVzLmZpbHRlcih0YSA9PiAhdGEuRW50aXR5TWV0aG9kKS5mb3JFYWNoKHRhID0+IHtsZXQgdGFOYW1lID0gbk5hbWUodGEpICsgJ18nICsgdGEuRW50aXR5Q2xhc3MuUGx1cmFsLnJlcGxhY2UoLyAvZywgJ18nKTslPg0KICAgICAgICAgICAgICAgIDwlPXRhTmFtZSU+OiAob2JqLCBlYUNvZGUsIHYpID0+IG9iajwlaWYoMCB8fCBbJ1VzZXInLCAnR2VuZGVyJywgJ19TdHVkZW50JywgJ19UZWFjaGVyJ10uaW5kZXhPZih0YS5FbnRpdHlDbGFzcy5OYW1lKT49MCl7JT4uZmxvd19GbG93X0xvZ2ljcyhbPCVsb2dpYygnSWYgJyt0YU5hbWUrJyBub3QgZW1wdHknLCAnSWYnKSU+LnBhcmVudF9GbG93X0luc3RhbmNlcyg8JXN1YmZsb3coJ25ldyAnK3Njb3BlKycuJytfY05hbWUodGEuRW50aXR5Q2xhc3MsIHRydWUpKycoKS4nK21OYW1lKycoYkRyYWZ0LCB0cnVlKScsIHtqc29uOiAiJ3Rlc3QnIn0pJT4pXSk8JX0lPiwNCiAgICAgICAgPCUgfSklPg0KICAgICAgICAgICAgICAgIF9sb29rdXA6IG9iaiA9PiBvYmouZmxvd19GbG93X0xvZ2ljcyhbPCVsb2dpYygnSWYgRVF1ZXJ5IG5vdCBlbXB0eScsICdJZicsIFt7Y2Q6ICInY29uZGl0aW9uJyIsIHY6ICIne3tmbG93X3ZhcmlhYmxlLmVxdWVyeX19IT0nIn1dKSU+DQogICAgICAgICAgICAgICAgICAgIC5wYXJlbnRfQWN0aW9uX0luc3RhbmNlcyhbDQogICAgICAgICAgICAgICAgICAgICAgICA8JWFjdGlvbignbG9va191cF9yZWNvcmRzJywge3RhYmxlOiAnIjw8JC5zeXNfc2NvcGUuc2NvcGU+Pl8iKygnK19uQ29kZSgpKycpLnRvTG93ZXJDYXNlKCknfSklPiwNCiAgICAgICAgICAgICAgICAgICAgXSkubG9naWNfRmxvd19JbnB1dF9TY3JpcHRzKFsNCiAgICAgICAgICAgICAgICAgICAgICAgIG5ldyA8JT1zY29wZSU+LjwlPV9jTmFtZSgnRmxvdyBJbnB1dCBTY3JpcHQnLCB0cnVlKSU+KCkubmFtZSgnU2V0IENvbmRpdGlvbicpLmFjdGl2ZSh0cnVlKS5jb2RlKCdjb25kaXRpb25zJykucmVtYXJrKGByZXR1cm4gZmRfZGF0YS5mbG93X3Zhci5lcXVlcnk7YCksDQogICAgICAgICAgICAgICAgICAgIF0pDQogICAgICAgICAgICAgICAgXSksDQogICAgICAgICAgICAgICAgX3NuYXBzaG90OiBvYmogPT4gYkRyYWZ0P251bGw6b2JqLmZsb3dfRmxvd19TbmFwc2hvdHMobmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKCdGbG93IFNuYXBzaG90JywgdHJ1ZSklPig8JT1fZmlkKCklPikuc25hcHNob3RfRmxvd19QbGFucyhbDQogICAgICAgICAgICAgICAgICAgIG5ldyA8JT1zY29wZSU+LjwlPV9jTmFtZSgnRmxvdyBQbGFuJywgdHJ1ZSklPig8JT1faWQoKSU+KS5jb2RlKCc8JT1jLk5hbWUlPl9QbGFuJykubmFtZSgnPCU9Yy5OYW1lJT4gUGxhbicpDQogICAgICAgICAgICAgICAgICAgIF0pLmZyb21GbG93KHRoaXMuPCU9bU5hbWUlPih0cnVlKSkpLA0KICAgICAgICAgICAgfSwgIjwlPW1OYW1lJT4iLCBiRHJhZnQsIGJIZWFkZXIpOw0KICAgIDwlIH1lbHNleyU+DQogICAgICAgICAgICByZXR1cm4gW107DQogICAgPCUgfSU+DQogICAgICAgIH1jYXRjaChleCl7DQogICAgICAgICAgICA8JT1lcnJvcigpJT5leCk7DQogICAgICAgIH0NCiAgICB9DQogICAgDQogICAgYXN5bmMgPCU9bU5hbWU9J190b1NOU2NyaXB0JyU+KG9wdGlvbnM9e30pew0KICAgICAgICBvcHRpb25zLl90aGlzID0gb3B0aW9ucy5fdGhpcyB8fCB0aGlzOw0KPCUgaWYobWFpbkNsYXNzKCkhPWMpeyU+DQogICAgICAgIHJldHVybiBhd2FpdCBuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUobWFpbkNsYXNzKCksIHRydWUpJT4oKS48JT1tTmFtZSU+KG9wdGlvbnMpOw0KPCUgfWVsc2V7JT4NCiAgICAgICAgdHJ5ew0KICAgIDwlIGlmKF9jTmFtZSgnQXBwbGljYXRpb24nKSAmJiBfY05hbWUoJ1JvbGxiYWNrIENvbnRleHQnKSl7JT4NCiAgICAgICAgICAgIGxldCBleHAgPSBvcHRpb25zLnJhdz8iX3RvSlNPTiI6Il90b0RvY3VtZW50IjsNCiAgICAgICAgICAgIGxldCByb2xsYmFjayA9IChvcHRpb25zLmFwcCAmJiBvcHRpb25zLnJvbGxiYWNrKT9hd2FpdCBuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUoJ1JvbGxiYWNrIENvbnRleHQnLCB0cnVlKSU+KCkuY29kZSgnbGFzdCcpW2V4cF0oT2JqZWN0LmFzc2lnbih7YkpTT046IHRydWV9LCBvcHRpb25zKSk6IiI7DQogICAgICAgICAgICBsZXQgZGIgPSBvcHRpb25zLmRiP2F3YWl0IG9wdGlvbnMuX3RoaXMuX3RvU05UYWJsZSgpW2V4cF0oT2JqZWN0LmFzc2lnbih7YkpTT046IHRydWV9LCBvcHRpb25zKSk6IiI7DQogICAgICAgICAgICBsZXQgZmxvdyA9IG9wdGlvbnMuZmxvdz9hd2FpdCBvcHRpb25zLl90aGlzLl90b1NORmxvdyhvcHRpb25zLmRyYWZ0KVtleHBdKE9iamVjdC5hc3NpZ24oe2JKU09OOiB0cnVlfSwgb3B0aW9ucykpOiIiOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBpZihvcHRpb25zLmd6aXApew0KICAgICAgICAgICAgICAgIGlmKGZsb3cpIGZsb3cgPSB0aGlzLlV0ZjhBcnJheVRvU3RyKGF3YWl0IHRoaXMuX2NvbXByZXNzKGZsb3cpKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgbGV0IHRlc3QgPSAob3B0aW9ucy50ZXN0ICYmIG9wdGlvbnMuZmxvdyAmJiAhb3B0aW9ucy5kcmFmdCk/YFxuLypncy5jYWNoZUZsdXNoKCk7ICovZ3MuaW5mbyhzbl9mZC5GbG93QVBJLmdldFJ1bm5lcigpLnN1YmZsb3coJyR7dGhpcy5fX2NvbmZpZygnc2NvcGUnLCAnPCU9c2NvcGUlPicpfS5Vc2VyX2xvb2t1cCcpLmluRm9yZWdyb3VuZCgpLndpdGhJbnB1dHMoe2pzb246IHtjb2RlOiJ0ZXN0IixkYXRlOicyMDI0LTA1LTAzVDE4OjQ0OjAzLjE3N1onLGdlbmRlcjp7Y29kZToiTSIsIE9QRVJBVE9SUzoge2NvZGU6ICIhPSJ9fSx1c2VyX1N0dWRlbnRzOlt7Y29kZToiU1RBIixnZW5kZXI6e2NvZGU6Ik0ifX1dLCBPUEVSQVRPUlM6IHtkYXRlOiAnPCd9fX0pLnJ1bigpLmdldE91dHB1dHMoKVsiVXNlcl9saXN0Il0pO1xuYDonJzsNCiAgICAgICAgICAgIGxldCBhcHAgPSBvcHRpb25zLmFwcD8obmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKCdBcHBsaWNhdGlvbicsIHRydWUpJT4oKS5fdG9TTlNhdmUob3B0aW9ucykgKyBgXG4gdmFyIGNvbmZpZyA9IHtBcHBsaWNhdGlvbjoge3JlYWRPbmx5OiB0cnVlfSwgVGFibGU6IHtpZEtleTogJ25hbWUnLCBMb2dTZXQ6IDB9LCBDb2x1bW46IHtMb2dTZXQ6IDB9LCBFbGVtZW50X01hcHBpbmc6IHtMb2dTZXQ6IDB9LCBBY3Rpb25fSW5wdXQ6IHtyZWFkT25seTogdHJ1ZX0sIEFjdGlvbl9UeXBlOiB7cmVhZE9ubHk6IHRydWUsIGlkS2V5OiAnbWFzdGVyX3NuYXBzaG90J30sIEFjdGlvbl9JbnN0YW5jZToge0xvZ1NldDogMH0sIFNlY3VyaXR5X1R5cGU6IHtyZWFkT25seTogdHJ1ZSwgaWRLZXk6ICduYW1lJ30sIFNlY3VyaXR5X09wZXJhdGlvbjoge3JlYWRPbmx5OiB0cnVlLCBpZEtleTogJ25hbWUnfSwgTG9naWNfRGVmaW5pdGlvbjoge3JlYWRPbmx5OiB0cnVlfSwgRmxvdzoge0xvZ1NldDogMH0sIFRyYW5zZm9ybToge3JlYWRPbmx5OiB0cnVlfSwgVHJhbnNmb3JtX0NvbXBvc2l0aW9uOiB7cmVhZE9ubHk6IHRydWV9LCBSb2xsYmFja19Db250ZXh0OiB7cmVhZE9ubHk6IHRydWV9fTsgXG5gICsgKG9wdGlvbnMucm9sbGJhY2s/KCJ2YXIgY2lkID0gc2F2ZVJvbGxiYWNrX0NvbnRleHQoIityb2xsYmFjaytgKTsgaWYoY2lkKXt2YXIgcncgPSBuZXcgR2xpZGVSb2xsYmFja1dvcmtlcigpOyBydy5zZXRSb2xsYmFja0NvbnRleHRJRChjaWQuc3lzX2lkKTsgcncuc3RhcnQoKTt9IFxuYCk6IiIpKyAob3B0aW9ucy5kYj8oInNhdmVUYWJsZSgiK2RiKyIpOyBcbiIpOiIiKSArIChvcHRpb25zLmZsb3c/KCJzYXZlRmxvdygiK2Zsb3crIik7IFxuIik6IiIpICsgdGVzdCk6KHJvbGxiYWNrICsgZGIgKyBmbG93KTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgbGV0IHNjcmlwdCA9IHRoaXMuX2JlYXV0aWZ5KGFwcCwgJ2phdmFzY3JpcHQnKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgaWYoIW9wdGlvbnMuZGVwbG95KSByZXR1cm4gc2NyaXB0Ow0KICAgIDwlIH0lPg0KICAgICAgICB9Y2F0Y2goZXgpew0KICAgICAgICAgICAgPCU9ZXJyb3IoKSU+ZXgpOw0KICAgICAgICB9DQo8JSB9JT4NCiAgICB9DQoNCiAgICA8JT1tTmFtZT0nX3RvU05TYXZlJyU+KG9wdGlvbnMpew0KICAgICAgICB0cnl7DQogICAgICAgICAgICA8JSB2YXIgX2ZSZWdFeHAgPSAvX2Z7W159XSt9L2dtOyAlPg0KICAgICAgICAgICAgbGV0IF9mID0gKHYsIGVhQ29kZSkgPT4gew0KICAgICAgICAgICAgICAgIGlmKHR5cGVvZih2KT09PSJzdHJpbmciKXsNCiAgICAgICAgICAgICAgICAgICAgbGV0IHJldCA9IHY7DQogICAgICAgICAgICAgICAgICAgIC8vaWYodi5zdGFydHNXaXRoKCJmKCIpICYmIHYuZW5kc1dpdGgoIikiKSkgcmV0ID0gJygnK3Yuc2xpY2UoMiwtMSkrJyknOw0KICAgICAgICAgICAgICAgICAgICBpZih2LnN0YXJ0c1dpdGgoInMoIikgJiYgdi5lbmRzV2l0aCgiKSIpKXsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldCA9IGAoZnVuY3Rpb24gKG9iaiwgJHtlYUNvZGV9KXtgK3Yuc2xpY2UoMiwtMSkrYH0pKG9iaiwgJHtlYUNvZGV9KWA7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIGlmKHJldCAmJiByZXQubWF0Y2ggJiYgcmV0Lm1hdGNoKDwlPV9mUmVnRXhwJT4pKSByZXQgPSBgKGZ1bmN0aW9uIChvYmosICR7ZWFDb2RlfSl7JHtyZXQuaW5kZXhPZigicmV0dXJuIik8MD8icmV0dXJuICI6IiJ9ICdgK3JldC5yZXBsYWNlKDwlPV9mUmVnRXhwJT4sIG0gPT4gYCcgKyAke20uc2xpY2UoMywgLTEpfSArICdgKStgJzt9KShvYmosICR7ZWFDb2RlfSlgOw0KICAgICAgICAgICAgICAgICAgICBpZihyZXQgJiYgcmV0Lm1hdGNoICYmIHJldC5tYXRjaCgvPDxbXj4+XSs+Pi9nbSkpIHJldCA9ICciIic7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBgKGZ1bmN0aW9uKHYpeyB0cnl7IHJldHVybiAodiAmJiB2LnJlcGxhY2UpP3YucmVwbGFjZSg8JT1fZlJlZ0V4cCU+LCBmdW5jdGlvbihtKXtyZXR1cm4gZXZhbChtLnNsaWNlKDMsIC0xKSk7fSk6djsgIH1jYXRjaChleCl7Z3MuaW5mbygnX2Z7RXhjZXB0aW9ufTogJHtlYUNvZGV9OiAnICsgZXgpOyByZXR1cm4gdjt9IH0pKCR7cmV0fSB8fCAke2VhQ29kZX0pYDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgcmV0dXJuIGVhQ29kZTsNCiAgICAgICAgICAgIH07DQoNCiAgICAgICAgICAgIGxldCByZXQgPSB0aGlzLl9fZXhwb3J0KHtJZDogIjwlPXNjb3BlJT4uPCU9X2NOYW1lKGMsIHRydWUpJT4iLCB2YXJzOiBgYCwgY29kZTogYGAsIHF1ZXJ5OiBgYCwgc2V0OiBgYCwgZXNldDogYGAsIGRzZXQ6IGBgLCB0YXM6IGBgLCBkZXBzOiB7fX0sIHsNCiAgICAgICAgICAgICAgICBleHBvcnRlcjogdiA9PiB2Lm9iaiA9ICh0eXBlb2Yob3B0aW9ucy5yZXVzZWQpPT09J3VuZGVmaW5lZCcgfHwgb3B0aW9ucy5yZXVzZWQ+PXYucmV1c2VkKT92Lm9iajp7Y29kZTogdi5vYmouY29kZSArIGBcblxuLyoqIHJldXNlZDogdi5vYmouSWQqKi9cblxuYCwgZGVwczogJycsIElkOiB2Lm9iai5JZH0sDQoNCiAgICAgICAgICAgICAgICBGdWxsOiB0cnVlLA0KICAgICAgICAgICAgICAgIE51bGw6IHRydWUsDQogICAgICAgICAgICAgICAgSWQ6IChvYmosIGlkQ29kZSwgdikgPT4gew0KICAgICAgICAgICAgICAgICAgICBvYmouSWQgPSBgaWYob2JqLiR7aWRDb2RlfSAmJiBvYmouJHtpZENvZGV9LnJlcGxhY2UoLy0vZywgJycpLmxlbmd0aD09MzIpe190b1N0cmluZys9J18nK29iai4ke2lkQ29kZX0ucmVwbGFjZSgvLS9nLCAnJyk7IGdyLmdldCgnc3lzX2lkJywgb2JqLiR7aWRDb2RlfS5yZXBsYWNlKC8tL2csICcnKSk7fVxuYDsNCiAgICAgICAgICAgICAgICAgICAgb2JqLmlkVG9TdHJpbmcgPSBgX3RvU3RyaW5nICs9IChvYmo/b2JqLiR7aWRDb2RlfTooJ2dyXycrZ3Iuc3lzX2lkKSkgKyAnOiAnOyBgOw0KICAgICAgICAgICAgICAgICAgICBvYmoubmV3VVVJRCA9IGBpZighb2JqLiR7aWRDb2RlfSB8fCBvYmouJHtpZENvZGV9LnJlcGxhY2UoLy0vZywgJycpLmxlbmd0aCE9MzIpe29iai4ke2lkQ29kZX0gPSBnci5zZXROZXdHdWlkKCk7fWVsc2V7Z3Iuc2V0TmV3R3VpZFZhbHVlKG9iai4ke2lkQ29kZX0ucmVwbGFjZSgvLS9nLCAnJykpO319XG5gOw0KICAgICAgICAgICAgICAgIH0sDQogICAgPCUgYy5FbnRpdHlBdHRyaWJ1dGVzLmZpbHRlcihlYSA9PiAhZWEuRW50aXR5TWV0aG9kKS5mb3JFYWNoKGVhID0+IHsgJT4NCiAgICAgICAgICAgICAgICA8JT1uTmFtZShlYSklPjogKG9iaiwgZWFDb2RlLCB2KSA9PiB7DQogICAgICAgIDwlIGlmKGVhLkVudGl0eVR5cGUgJiYgZWEuRW50aXR5VHlwZSE9Yyl7JT4NCiAgICAgICAgICAgICAgICAgICAgb2JqLmRlcHMuPCU9bk5hbWUoZWEuRW50aXR5VHlwZSklPiA9ICh2IHx8IG5ldyA8JT1zY29wZSU+LjwlPV9jTmFtZShlYS5FbnRpdHlUeXBlLCB0cnVlKSU+KCkpLjwlPW1OYW1lJT4ob3B0aW9ucyk7DQogICAgICAgIDwlIH0lPg0KDQogICAgICAgICAgICAgICAgICAgIG9iai52YXJzICs9IGB2YXIgJHtlYUNvZGV9ID0gPCVpZihlYS5FbnRpdHlUeXBlKXslPigoKHJlZnMuPCU9bk5hbWUoZWEpJT4gPSAodHlwZW9mKG9iai4ke2VhQ29kZX0pIT09J3VuZGVmaW5lZCc/Lyp0aGlzLiovc2F2ZTwlPW5OYW1lKGVhLkVudGl0eVR5cGUpJT4ob2JqLiR7ZWFDb2RlfSwgezwlPW5OYW1lKGMpJT46IG9iaiwgPCU9bk5hbWUoYy8qZWEqLyklPlJlZnM6IHJlZnMsIDwlPW5OYW1lKGMpLnRvTG93ZXJDYXNlKCklPjogZ3J9LCAiPCU9bk5hbWUoYyklPiIsIHJlZnMuPCU9bk5hbWUoZWEpJT4gfHwgLypFWFA6IHJlZnMuPCU9bk5hbWUoZWEuRW50aXR5VHlwZSkudG9Mb3dlckNhc2UoKSU+IHx8ICovKCR7X2YoPCV2YWx1ZU9mKGVhLkRlZmF1bHQpJT4sIGVhQ29kZSl9KSk6cmVmcy48JT1uTmFtZShlYSklPikpIHx8IHtzeXNfaWQ6ICcnfSlbLyp0aGlzLiovY29uZmlnLjwlPW5OYW1lKGVhLkVudGl0eVR5cGUpJT4uaWRLZXkgfHwgInN5c19pZCJdKS50b1N0cmluZygpPCV9ZWxzZXslPm9iai4ke2VhQ29kZX08JX0lPjtgOw0KICAgICAgICA8JSBpZihlYS5Jc1VuaXF1ZSl7JT4NCiAgICAgICAgICAgICAgICAgICAgb2JqLnF1ZXJ5ICs9IGBfdG9TdHJpbmcrPSdfJyske2VhQ29kZX07IF90b1F1ZXJ5LiR7ZWFDb2RlfSA9ICR7X2YodiwgZWFDb2RlKX07IGA7DQogICAgICAgIDwlIH0lPg0KICAgICAgICAgICAgICAgICAgICBvYmouc2V0ICs9IGBpZih0eXBlb2YoX3RvU2V0LiR7ZWFDb2RlfSA9ICR7X2YodiwgZWFDb2RlKX0pIT09J3VuZGVmaW5lZCc8JWlmKGVhLkVudGl0eVR5cGUpeyU+JiYgX3RvU2V0LiR7ZWFDb2RlfTwlfSU+KSBnci5zZXRWYWx1ZSgnJHtlYUNvZGV9JywgX3RvU2V0LiR7ZWFDb2RlfSk7YDsNCiAgICAgICAgICAgICAgICB9LA0KICAgIDwlIH0pJT4NCiAgICA8JSBjLkVudGl0eUZpZWxkcy5mb3JFYWNoKGVmID0+IHslPg0KICAgICAgICAgICAgICAgIGVmXzwlPW5OYW1lKGVmKSU+OiAob2JqLCBlZkNvZGUsIHYpID0+IG9iai5lc2V0ICs9IGBpZih0eXBlb2YoX3RvU2V0LiR7ZWZDb2RlfSA9ICR7X2YoSlNPTi5zdHJpbmdpZnkodiksICdvYmouJytlZkNvZGUpfSkhPT0ndW5kZWZpbmVkJykgZ3Iuc2V0VmFsdWUoJyR7ZWZDb2RlfScsIF90b1NldC4ke2VmQ29kZX0pO2AsDQogICAgPCUgfSklPg0KICAgIDwlIGMuVHlwZWRBdHRyaWJ1dGVzLmZpbHRlcih0YSA9PiAhdGEuRW50aXR5TWV0aG9kKS5mb3JFYWNoKHRhID0+IHtsZXQgdGFOYW1lID0gbk5hbWUodGEpICsgJ18nICsgdGEuRW50aXR5Q2xhc3MuUGx1cmFsLnJlcGxhY2UoLyAvZywgJ18nKTslPg0KICAgICAgICAgICAgICAgIDwlPXRhTmFtZSU+OiAob2JqLCBlYUNvZGUsIHYpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgb2JqLnRhcyArPSBgcmVmcy48JT10YU5hbWUlPiA9ICgob2JqP29iai4ke2VhQ29kZX06W10pIHx8IFtdKS5tYXAoZnVuY3Rpb24obyl7Z3MuaW5mbyhfdG9TdHJpbmcgKyAnID0+IHNhdmU8JT1uTmFtZSh0YS5FbnRpdHlDbGFzcyklPigke2VhQ29kZX1bXSknKTsgcmV0dXJuIC8qdGhpcy4qL3NhdmU8JT1uTmFtZSh0YS5FbnRpdHlDbGFzcyklPihvLCB7PCU9bk5hbWUoYyklPjogb2JqLCA8JT1uTmFtZShjKS50b0xvd2VyQ2FzZSgpJT46IGdyLCBtYW55UmVmczogcmVmc30sICI8JT1uTmFtZShjKSU+Iik7fSk7YA0KICAgICAgICAgICAgICAgICAgICBvYmouZGVwcy48JT1uTmFtZSh0YS5FbnRpdHlDbGFzcyklPiA9ICh2ICYmIHYubGVuZ3RoKT92WzBdOm5ldyA8JT1zY29wZSU+LjwlPV9jTmFtZSh0YS5FbnRpdHlDbGFzcywgdHJ1ZSklPigpLjwlPW1OYW1lJT4ob3B0aW9ucyk7DQogICAgICAgICAgICAgICAgfSwNCiAgICA8JSB9KSU+DQogICAgICAgICAgICB9LCAiPCU9bU5hbWUlPiIpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBpZighcmV0LmRzZXQpIHJldC5kc2V0ICs9IGBcbmlmKHR5cGVvZihvYmopPT09Im9iamVjdCIpIE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspe3JldHVybiAhay5zdGFydHNXaXRoKCdfXycpICYmIFsnc3lzX2lkJywgJ0lkJywgJ09QRVJBVE9SUyddLmluZGV4T2Yoayk8MCAmJiB0eXBlb2YoX3RvU2V0W2tdKT09PSd1bmRlZmluZWQnICYmICFBcnJheS5pc0FycmF5KG9ialtrXSk7fSkuZm9yRWFjaChmdW5jdGlvbihrKXtfdG9TZXRba10gPSAke19mKCJvYmpba10iLCAibnVsbCIpfTsgaWYoX3RvU2V0W2tdICYmIF90b1NldFtrXS5fX2NsYXNzKXtfdG9TZXRba10gPSBfdG9TZXRba11bY29uZmlnW190b1NldFtrXS5fX2NsYXNzXS5pZEZpZWxkIHx8ICdJZCddOyB9IGdyLnNldFZhbHVlKGssIF90b1NldFtrXSApOyB9KVxuYDsNCg0KICAgICAgICAgICAgcmV0LmNvZGUgKz0gYCR7T2JqZWN0LnZhbHVlcyhyZXQuZGVwcykuam9pbignXG4nKX1mdW5jdGlvbiBzYXZlPCU9bk5hbWUoYyklPihvYmosIHJlZnMsIHNvdXJjZSwgZ3Ipe3JlZnMgPSByZWZzIHx8IHt9OyAvKnRoaXMuKi9jb25maWcuc2F2ZV8kezwlPV9uQ29kZSgpJT59ID0gc2F2ZTwlPW5OYW1lKGMpJT47IC8qdGhpcy4qL2NvbmZpZy48JT1uTmFtZShjKSU+ID0gLyp0aGlzLiovY29uZmlnLjwlPW5OYW1lKGMpJT4gfHwge307IC8qdGhpcy4qL2NvbmZpZy5faWRNYXAgPSAvKnRoaXMuKi9jb25maWcuX2lkTWFwIHx8IFtdOyB2YXIgX3RvU3RyaW5nID0gc291cmNlICsgJ1snICsgKHJlZnNbc291cmNlXS5zeXNfaWQpICsgJ109PiBzYXZlPCU9bk5hbWUoYyklPignOyBpZih0eXBlb2Yob2JqKT09PSdzdHJpbmcnICYmIG9iai5sZW5ndGg+PTMyKXt2YXIgcmV0ID0ge307IHJldFsvKnRoaXMuKi9jb25maWcuPCU9bk5hbWUoYyklPi5pZEtleSB8fCAic3lzX2lkIl09b2JqOyBncy5pbmZvKF90b1N0cmluZyArICcpOiBvYmogaXMgdXVpZCwgcmV0dXJuaW5nIHsnK29iaisnfScpOyByZXR1cm4gcmV0O30gaWYoIW9iaiAmJiAhZ3Ipe2dzLmluZm8oX3RvU3RyaW5nICsgJyk6IG9iaiBpcyBudWxsJyk7IHJldHVybiBudWxsO30gJHtyZXQuaWRUb1N0cmluZ30gdmFyIGJTYXZlID0gIS8qdGhpcy4qL2NvbmZpZy48JT1uTmFtZShjKSU+LnJlYWRPbmx5OyBpZighZ3IpeyBnciA9IG5ldyBHbGlkZVJlY29yZCgnJHs8JT1fbkNvZGUoKSU+fScpO1xuJHtyZXQuSWR9XG4ke3JldC52YXJzfVxuaWYoIWdyLmlzVmFsaWRSZWNvcmQoKSl7Z3IgPSBuZXcgR2xpZGVSZWNvcmQoJyR7PCU9X25Db2RlKCklPn0nKTsgdmFyIF90b1F1ZXJ5PXt9OyAke3JldC5xdWVyeX0gXG5fdG9TdHJpbmcgKz0gJyk6ICc7IGlmKG9iai5fX2tleXMgJiYgKGJTYXZlIHx8IGNvbmZpZy48JT1uTmFtZShjKSU+LnJlYWRPbmx5KSl7aWYoX3RvUXVlcnkuX19lbmNvZGVkUXVlcnkpe2dyLmFkZEVuY29kZWRRdWVyeShfdG9RdWVyeS5fX2VuY29kZWRRdWVyeSk7fWVsc2V7b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspe2dyLmFkZFF1ZXJ5KGssIF90b1F1ZXJ5W2tdIHx8IG9ialtrXSk7fSk7fSBnci5zZXRMaW1pdCgxKTsgaWYoIWdyLmdldEVuY29kZWRRdWVyeSgpKSBnci5hZGRRdWVyeSgnc3lzX2lkJywgJy0xJyk7IGdzLmluZm8oX3RvU3RyaW5nICsgJ0VuY29kZWQgUXVlcnk6ICcgKyBnci5nZXRFbmNvZGVkUXVlcnkoKSk7IGdyLnF1ZXJ5KCk7aWYoIWdyLm5leHQoKSl7Z3MuaW5mbyhfdG9TdHJpbmcgKyAnbm90IGZvdW5kJyk7fWVsc2V7Z3MuaW5mbyhfdG9TdHJpbmcgKyAnZm91bmQgWyR7PCU9X25Db2RlKCklPn0vJyArIGdyLnN5c19pZCArICddIC0gaXMgdmFsaWQ6ICcgKyBnci5pc1ZhbGlkUmVjb3JkKCkpOyBvYmouSWQgPSBnci5zeXNfaWQudG9TdHJpbmcoKTsgaWYob2JqLl9fcmV1c2VkKXsvKmdzLmluZm8oX3RvU3RyaW5nICsgJzogX19yZXVzZWQ6IFskezwlPV9uQ29kZSgpJT59LycgKyBnci5zeXNfaWQgKyAnXSAtIGlzIHZhbGlkOiAnICsgZ3IuaXNWYWxpZFJlY29yZCgpKTsgKi9yZXR1cm4gZ3I7fSB9fX19ZWxzZXtiU2F2ZT1mYWxzZTt9IGlmKGJTYXZlICYmICFnci5pc1ZhbGlkUmVjb3JkKCkpe2dzLmluZm8oX3RvU3RyaW5nICsgJ2luc2VydGluZy4uLicpOyBnciA9IG5ldyBHbGlkZVJlY29yZCgnJHs8JT1fbkNvZGUoKSU+fScpOyBnci5pbml0aWFsaXplKCk7ICR7cmV0Lm5ld1VVSUR9IGlmKGJTYXZlICYmIG9iail7dmFyIF90b1NldCA9IHt9OyAvKnNldCovJHtyZXQuc2V0fSAvKmVzZXQqLyR7cmV0LmVzZXR9ICAke3JldC5kc2V0fSBpZigvKnRoaXMuKi9jb25maWcuPCU9bk5hbWUoYyklPi5Ob1dvcmtmbG93KSBnci5zZXRXb3JrZmxvdyhmYWxzZSk7IGlmKC8qdGhpcy4qL2NvbmZpZy48JT1uTmFtZShjKSU+LkxvZ1NldCkgZ3MuaW5mbyhfdG9TdHJpbmcgKyAnX3RvU2V0OiAnICsgSlNPTi5zdHJpbmdpZnkoX3RvU2V0KSk7IH1lbHNlIGlmKCFnci5pc1ZhbGlkUmVjb3JkKCkpe2dzLmluZm8oX3RvU3RyaW5nICsgJ1tiU2F2ZT0nICsgYlNhdmUgKyAnXSAtIHJldHVybmluZyBudWxsLicpOyByZXR1cm4gbnVsbDt9XG5pZighYlNhdmUgfHwgZ3IudXBkYXRlKCkpeyBpZihmYWxzZSAmJiBiU2F2ZSl7Y29uZmlnLl9pZE1hcC5wdXNoKHt0YWJsZTogJyR7PCU9X25Db2RlKCklPn0nLCBzeXNfaWQ6IGdyLnN5c19pZC50b1N0cmluZygpLCBrZXlzOiBvYmouX19rZXlzLm1hcChmdW5jdGlvbihrKXtyZXR1cm4ge2s6IGssIHY6IF90b1F1ZXJ5W2tdIHx8IG9ialtrXX07fSl9KTt9ICR7cmV0LnRhc31cbmdzLmluZm8oX3RvU3RyaW5nICsgJ1tiU2F2ZT0nICsgYlNhdmUgKyAnXSAtIHJldHVybmluZyAnICsgZ3Iuc3lzX2lkKTsgcmV0dXJuIGdyO319XG5gOw0KDQogICAgICAgICAgICAvKnJldHVybiBPYmplY3QudmFsdWVzKE9iamVjdC5hc3NpZ24oe30sIC4uLnJldC5jb2RlLnNwbGl0KCdmdW5jdGlvbiBzYXZlJykuZmlsdGVyKHMgPT4gcykuc29ydCgoYSwgYikgPT4gYS5sZW5ndGggLSBiLmxlbmd0aCkubWFwKHMgPT4gKHtbcy5zcGxpdCgnKG9iaiwgcmVmcywgc291cmNlLCBnciknKVswXV06ICdmdW5jdGlvbiBzYXZlJytzfSkpKSkuam9pbignXG4nKTsgKi8NCiAgICAgICAgICAgIHJldHVybiByZXQuY29kZTsNCiAgICAgICAgfWNhdGNoKGV4KXsNCiAgICAgICAgICAgIDwlPWVycm9yKCklPmV4KTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICANCiAgICA8JT1tTmFtZT0nX3RvU05RdWVyeSclPihmaWVsZHMsIG9ianMsIGJVUkwpew0KICAgICAgICBsZXQgcmV0ID0gdGhpcy5fX2V4cG9ydCh7fSwgew0KICAgICAgICAgICAgT1BFUkFUT1JTOiB0cnVlLA0KICAgICAgICAgICAgLy9fbWFwOiB0cnVlLA0KICAgICAgICAgICAgSWQ6IChvYmosIGlkQ29kZSwgdikgPT4gb2JqW2lkQ29kZV0gPSB2LA0KICAgIDwlIGMuRW50aXR5QXR0cmlidXRlcy5maWx0ZXIoZWEgPT4gIWVhLkVudGl0eU1ldGhvZCkuZm9yRWFjaChlYSA9PiB7ICU+DQogICAgICAgICAgICA8JT1uTmFtZShlYSklPjogKG9iaiwgZWFDb2RlLCB2KSA9PiB7DQogICAgICAgIDwlIGlmKGVhLkVudGl0eVR5cGUpeyU+DQogICAgICAgICAgICAgICAgb2JqW2VhQ29kZV0gPSB2P3YuPCU9bU5hbWUlPigpOm51bGw7DQogICAgICAgIDwlIH1lbHNlIGlmKGVhLklzRGF0ZSl7JT4NCiAgICAgICAgICAgICAgICBsZXQgZCA9IGAke3YuZ2V0RnVsbFllYXIoKX0tJHsoJzAnKyh2LmdldE1vbnRoKCkrMSkpLnNsaWNlKC0yKX0tJHt2LmdldERhdGUoKX1gOw0KICAgICAgICAgICAgICAgIGxldCB0ID0gYCR7di5nZXRIb3VycygpfToke3YuZ2V0TWludXRlcygpfToke3YuZ2V0U2Vjb25kcygpfWA7DQogICAgICAgICAgICAgICAgaWYoKHYuZ2V0SG91cnMoKT09MCAmJiB2LmdldE1pbnV0ZXMoKT09MCAmJiB2LmdldFNlY29uZHMoKT09MCkgfHwgdGhpcy5fPCU9bk5hbWUoZWEpJT5fY29vcD09Jz0nIHx8ICF0aGlzLl88JT1uTmFtZShlYSklPl9jb29wKXsNCiAgICAgICAgICAgICAgICAgICAgb2JqW2VhQ29kZV0gPSBgT04ke2R9QGphdmFzY3JpcHQ6Z3MuZGF0ZUdlbmVyYXRlKCcke2R9Jywnc3RhcnQnKUBqYXZhc2NyaXB0OmdzLmRhdGVHZW5lcmF0ZSgnJHtkfScsJ2VuZCcpYDsNCiAgICAgICAgICAgICAgICB9ZWxzZSBpZih0aGlzLl88JT1uTmFtZShlYSklPl9jb29wIT09J0JFVFdFRU4nKXsNCiAgICAgICAgICAgICAgICAgICAgb2JqW2VhQ29kZV0gPSBgamF2YXNjcmlwdDpncy5kYXRlR2VuZXJhdGUoJyR7ZH0nLCAnJHt0fScpYDsNCiAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgb2JqW2VhQ29kZV0gPSBgamF2YXNjcmlwdDpncy5kYXRlR2VuZXJhdGUoJyR7ZH0nLCAnJHt0fScpQGphdmFzY3JpcHQ6Z3MuZGF0ZUdlbmVyYXRlKCcke2R9JywgJyR7dH0nKWA7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICA8JSB9ZWxzZSBpZihlYS5Jc0Jvb2wpeyU+DQogICAgICAgICAgICAgICAgb2JqLk9QRVJBVE9SUy48JT1uTmFtZShlYSklPiA9ICc9JzsNCiAgICAgICAgICAgICAgICBvYmpbZWFDb2RlXSA9IHY7DQogICAgICAgIDwlIH1lbHNleyU+DQogICAgICAgICAgICAgICAgb2JqW2VhQ29kZV0gPSB2Ow0KICAgICAgICA8JSB9JT4NCiAgICAgICAgICAgIH0sDQogICAgPCUgfSk7ICU+DQogICAgICAgIH0sICI8JT1tTmFtZSU+Iik7DQogICAgICAgIA0KICAgICAgICBPYmplY3Qua2V5cyhyZXQuT1BFUkFUT1JTIHx8IHt9KS5maWx0ZXIoayA9PiB0eXBlb2YocmV0W2tdKSE9PSd1bmRlZmluZWQnICYmIHR5cGVvZihyZXRba10pIT09J29iamVjdCcpLmZvckVhY2goayA9PiByZXRba10gPSByZXQuT1BFUkFUT1JTW2tdICsgcmV0W2tdKTsNCg0KICAgICAgICBkZWxldGUgcmV0Lk9QRVJBVE9SUzsNCiAgICAgICAgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoayA9PiAhU3RyaW5nKHJldFtrXSkubGVuZ3RoKS5mb3JFYWNoKGsgPT4gZGVsZXRlIHJldFtrXSk7DQoNCiAgICAgICAgcmV0ID0gRG90T2JqZWN0LmRvdChyZXQpOw0KDQogICAgICAgIC8vIGF2b2lkIHNlbmRpbmcgd2l0aCBubyBjb21wYXJpc29uIG9wZXJhdG9ycw0KICAgICAgICBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihrID0+ICFbJz4nLCAnPCcsICdCRVRXRUVOJywgJ09OJywgJyEnLCAnPScsICdTVEFSVFNXSVRIJywgJ0xJS0UnXS5zb21lKHMgPT4gU3RyaW5nKHJldFtrXSkuc3RhcnRzV2l0aChzKSkpLmZvckVhY2goayA9PiByZXRba10gPSAodGhpc1tgXyR7a31fY29vcGBdIHx8ICdTVEFSVFNXSVRIJykgKyByZXRba10pOw0KICAgICAgICANCiAgICAgICAgPCU9bG9nKCklPnJldCk7DQoNCiAgICAgICAgaWYoYlVSTCkgcmV0ID0gT2JqZWN0LmVudHJpZXMocmV0IHx8IHt9KS5tYXAocCA9PiBgJHtwWzBdfSR7cFsxXX1gKS5qb2luKCJeIik7DQogICAgICAgIA0KICAgICAgICByZXR1cm4gcmV0Ow0KICAgIH0NCjwlIH0lPg0KDQoJPCU9bU5hbWU9J19fZXhwb3J0JyU+KG9iaiwgb3B0aW9ucywgZnVuLCAuLi5mQXJncykgew0KCSAgICB0cnl7DQogICAgCSAgICBpZighb2JqKSByZXR1cm4gdGhpczsNCiAgICAJICAgIA0KICAgIAkgICAgaWYob3B0aW9ucy5PUEVSQVRPUlMpIG9iai5PUEVSQVRPUlMgPSBvYmouT1BFUkFUT1JTIHx8IHt9Ow0KICAgIAkgICAgDQogICAgCSAgICA8JSAvKiBJTVBPUlRBTlQ6IHRoaXMuSWQ9PXRoaXMuSWQgbWFrZXMgc3VyZSB0aGUgSWQgaXMgZml4ZWQgZm9yIHRoZSB0b29sLCBub3QgZ2V0dGluZyBnZW5lcmF0ZWQgZXZlcnkgdGltZSB3ZSBjYWxsIGl0ICovICU+DQogICAgCSAgICANCiAgICAJICAgIGxldCBlYUNvZGVzID0gew0KICAgIAkgICAgICAgIGV4cG9ydGVyOiAiIiwNCiAgICAJICAgICAgICBJZDogIiIsDQogICAgCSAgICB9Ow0KICAgIAkgICAgDQogICAgCQlpZiAoIW9wdGlvbnMuVW5pcXVlICYmIChvcHRpb25zLkZ1bGwgfHwgdGhpcy5fX3N5bmNfb24oKSB8fCB0aGlzLklkPT10aGlzLklkKSkgdGhpcy5fX29wdGlvbnMoIklkIiwgb2JqLCBlYUNvZGVzLklkID0gKG9wdGlvbnMuX21hcD90aGlzLl9uQ29kZSgnSWQnKTonSWQnKSwgdGhpcy5JZCwgdGhpcywgb3B0aW9ucywgZnVuKTsNCiAgICAJCQ0KPCUgYy5FbnRpdHlBdHRyaWJ1dGVzLmZpbHRlcihlYSA9PiAhZWEuRW50aXR5TWV0aG9kICYmICFlYS5FbnRpdHlUeXBlKS5mb3JFYWNoKGVhID0+IHslPg0KICAgICAgICAgICAgaWYoIW9wdGlvbnMuVW5pcXVlIHx8IChvcHRpb25zLlVuaXF1ZSAmJiA8JXZhbHVlT2YoZWEuSXNVbmlxdWUpJT4pKSB0aGlzLl9fb3B0aW9ucygiPCU9bk5hbWUoZWEpJT4iLCBvYmosIGVhQ29kZXMuPCU9bk5hbWUoZWEpJT4gPSAob3B0aW9ucy5fbWFwPzwlPV9uQ29kZShlYSklPjo8JV92Q29kZShlYSklPiksIHRoaXMuPCU9bk5hbWUoZWEpJT4oKSwgdGhpcywgb3B0aW9ucywgZnVuLCAiPCU9X2NGaWVsZChlYSklPiIpOw0KPCUgfSklPg0KDQo8JSBjLkVudGl0eUF0dHJpYnV0ZXMuZmlsdGVyKGVhID0+ICFlYS5FbnRpdHlNZXRob2QgJiYgZWEuRW50aXR5VHlwZSAmJiBlYS5Jc1VuaXF1ZSkuZm9yRWFjaChlYSA9PiB7JT4NCiAgICAgICAgICAgIGlmICghb3B0aW9ucy5VbmlxdWUgfHwgKG9wdGlvbnMuVW5pcXVlICYmIDwldmFsdWVPZihlYS5Jc1VuaXF1ZSklPikpIHRoaXMuX19vcHRpb25zKCI8JT1uTmFtZShlYSklPiIsIG9iaiwgZWFDb2Rlcy48JT1uTmFtZShlYSklPiA9IChvcHRpb25zLl9tYXA/PCU9X25Db2RlKGVhKSU+OjwlX3ZDb2RlKGVhKSU+KSwgdGhpcy48JT1uTmFtZShlYSklPigpLCB0aGlzLCBvcHRpb25zLCBmdW4sICI8JT1fY0ZpZWxkKGVhKSU+Iik7DQo8JSB9KSU+DQoNCjwlIGMuRW50aXR5RmllbGRzLmZvckVhY2goZWYgPT4geyU+DQogICAgICAgICAgICBpZiAoIW9wdGlvbnMuVW5pcXVlIHx8IChvcHRpb25zLlVuaXF1ZSAmJiA8JXZhbHVlT2YoZWYuSXNVbmlxdWUpJT4pKSB0aGlzLl9fb3B0aW9ucygiZWZfPCU9bk5hbWUoZWYpJT4iLCBvYmosIGVhQ29kZXMuZWZfPCU9bk5hbWUoZWYpJT4gPSAob3B0aW9ucy5fbWFwPzwlPV9uQ29kZShlZiklPjo8JV92Q29kZShlZiklPiksIDwldmFsdWVPZihlZi5WYWx1ZSklPiwgdGhpcywgb3B0aW9ucywgZnVuKTsNCjwlIH0pJT4NCg0KCQkgICAgPCUgdW5SZWN1cnNlKCdvYmonLCAnZnVuJywgJ2ZBcmdzJywgJ2lmKHR5cGVvZihvcHRpb25zLmV4cG9ydGVyKT09PSJmdW5jdGlvbiIpIG9wdGlvbnMuZXhwb3J0ZXIodiknKSU+DQoNCjwlIGMuRW50aXR5QXR0cmlidXRlcy5maWx0ZXIoZWEgPT4gIWVhLkVudGl0eU1ldGhvZCAmJiBlYS5FbnRpdHlUeXBlICYmICFlYS5Jc1VuaXF1ZSkuZm9yRWFjaChlYSA9PiB7JT4NCiAgICAgICAgICAgIGlmICghb3B0aW9ucy5VbmlxdWUpIHRoaXMuX19vcHRpb25zKCI8JT1uTmFtZShlYSklPiIsIG9iaiwgZWFDb2Rlcy48JT1uTmFtZShlYSklPiA9IChvcHRpb25zLl9tYXA/PCU9X25Db2RlKGVhKSU+OjwlX3ZDb2RlKGVhKSU+KSwgdGhpcy48JT1uTmFtZShlYSklPigpLCB0aGlzLCBvcHRpb25zLCBmdW4sICI8JT1fY0ZpZWxkKGVhKSU+Iik7DQo8JSB9KSU+DQoNCiAgICAgICAgICAgIGlmICghb3B0aW9ucy5VbmlxdWUpIHRoaXMuX19vcHRpb25zKCJfVEhJUyIsIG9iaiwgZWFDb2Rlcy5fVEhJUyA9IChvcHRpb25zLl9tYXA/dGhpcy5fbkNvZGUoJ19USElTJyk6Il9USElTIiksIHRoaXMuX1RISVMsIHRoaXMsIG9wdGlvbnMsIGZ1bik7DQoNCjwlIGMuVHlwZWRBdHRyaWJ1dGVzLmZpbHRlcih0YSA9PiAhdGEuRW50aXR5TWV0aG9kKS5mb3JFYWNoKHRhID0+IHtsZXQgdGFOYW1lID0gbk5hbWUodGEpICsgJ18nICsgdGEuRW50aXR5Q2xhc3MuUGx1cmFsLnJlcGxhY2UoLyAvZywgJ18nKTslPg0KICAgICAgICAgICAgaWYgKCFvcHRpb25zLlVuaXF1ZSkgdGhpcy5fX29wdGlvbnMoIjwlPXRhTmFtZSU+Iiwgb2JqLCBlYUNvZGVzLjwlPXRhTmFtZSU+ID0gKG9wdGlvbnMuX21hcD88JT1fbkNvZGUodGEsIHRydWUpJT46IjwlPXRhTmFtZSU+IiksIHRoaXMuPCU9dGFOYW1lJT4oKSwgdGhpcywgb3B0aW9ucywgZnVuLCAiPCU9X2NGaWVsZCh0YSklPiIpOw0KPCUgfSklPg0KDQogICAgICAgICAgICBpZiAoIW9wdGlvbnMuVW5pcXVlKSBPYmplY3Qua2V5cyhvcHRpb25zKS5maWx0ZXIoayA9PiB0eXBlb2Yob3B0aW9uc1trXSk9PT0nZnVuY3Rpb24nICYmICFPYmplY3Qua2V5cyhlYUNvZGVzKS5pbmNsdWRlcyhrKSkuZm9yRWFjaChrID0+IHRoaXMuX19vcHRpb25zKGssIG9iaiwgaywgdW5kZWZpbmVkLCB0aGlzLCBvcHRpb25zLCBmdW4pKTsNCiAgICAgICAgDQogICAgICAgICAgICA8JT1zY29wZSU+Ll91blJlY3Vyc2UuPCU9bk5hbWUoYyklPltmdW5dID0gPCU9c2NvcGUlPi5fdW5SZWN1cnNlLjwlPW5OYW1lKGMpJT5bZnVuXSB8fCB7fTsNCiAgICAgICAgICAgICg8JT1zY29wZSU+Ll91blJlY3Vyc2UuPCU9bk5hbWUoYyklPltmdW5dLkN5Y2xpYyB8fCBbXSkuZm9yRWFjaChuID0+IG4uX2Nbbi5lYUZpZWxkXShuLl9jW24uZWFGaWVsZF0oKS5fdG9IYXNoKG51bGwsIHtub0NvZGU6IHRydWUsIG9ubHlVbmlxdWU6IHRydWUsIG5vQXJnczogdHJ1ZSwgX21hcDogb3B0aW9ucy5fbWFwfSwgZnVuKSkpOw0KICAgICAgICAgICAgPCU9c2NvcGUlPi5fdW5SZWN1cnNlLjwlPW5OYW1lKGMpJT5bZnVuXS5DeWNsaWMgPSBbXTsgLy8/Pw0KICAgICAgICAgICAgDQogICAgCQlyZXR1cm4gb2JqOw0KICAgIAl9Y2F0Y2goZXgpew0KICAgIAkgICAgPCU9ZXJyb3IoKSU+ZXgpOw0KICAgIAl9DQoJfQ0KCQ0KCTwlPW1OYW1lPSdfX29wdGlvbnMnJT4oZmllbGQsIG9iaiwgZWFDb2RlLCBlYU9iaiwgX3RoaXM9dGhpcywgb3B0aW9ucz17fSwgZnVuLCBlYUZpZWxkKXsNCjwlIGlmKG1haW5DbGFzcygpIT1jKXslPg0KICAgICAgICByZXR1cm4gbmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKG1haW5DbGFzcygpLCB0cnVlKSU+KCkuPCU9bU5hbWUlPihmaWVsZCwgb2JqLCBlYUNvZGUsIGVhT2JqLCBfdGhpcywgb3B0aW9ucywgZnVuLCBlYUZpZWxkKTsNCjwlIH1lbHNleyU+DQogICAgICAgIHRyeXsNCiAgICAgICAgICAgIGlmKG9wdGlvbnMuX2ZpZWxkcyAmJiAhb3B0aW9ucy5fZmllbGRzLmluY2x1ZGVzKGZpZWxkKSkgcmV0dXJuOw0KICAgICAgICAgICAgaWYoIW9iaikgcmV0dXJuOw0KICAgICAgICAgICAgaWYodHlwZW9mKG9wdGlvbnNbZmllbGRdKSE9PSJmdW5jdGlvbiIpew0KICAgICAgICAgICAgICAgIDwlPWxvZygpJT5gJHtmdW59Lm9wdGlvbnMuJHtmaWVsZH0gaXMgbm90IGEgZnVuY3Rpb25gKTsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZihlYU9iaikhPT0ndW5kZWZpbmVkJyAmJiAhb3B0aW9ucy5OdWxsKXsNCiAgICAgICAgICAgICAgICBpZihmaWVsZCE9J0lkJyAmJiB0eXBlb2YoX3RoaXNbZmllbGRdKT09PSdmdW5jdGlvbicgJiYgIV90aGlzWydfJytmaWVsZCsnX3NldCddKSByZXR1cm47DQogICAgICAgICAgICAgICAgaWYoQXJyYXkuaXNBcnJheShlYU9iaikgJiYgdHlwZW9mKGVhT2JqLmxlbmd0aCkhPT0ndW5kZWZpbmVkJykgZWFPYmogPSBlYU9iai5maWx0ZXIodiA9PiB2KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgaWYoIW9wdGlvbnMuTnVsbCAmJiBBcnJheS5pc0FycmF5KGVhT2JqKSAmJiAhZWFPYmoubGVuZ3RoKSByZXR1cm47DQoNCiAgICAgICAgICAgIGxldCBfcmV0ID0gb3B0aW9uc1tmaWVsZF0ob2JqLCBlYUNvZGUsIGVhT2JqLCBfdGhpcyk7DQogICAgICAgICAgICBpZihvcHRpb25zLk9QRVJBVE9SUyAmJiBfdGhpc1snXycgKyBmaWVsZCArICdfY29vcCddKSBvYmouT1BFUkFUT1JTID0gT2JqZWN0LmFzc2lnbihvYmouT1BFUkFUT1JTIHx8IHt9LCB7W2ZpZWxkXTogX3RoaXNbJ18nICsgZmllbGQgKyAnX2Nvb3AnXX0pOw0KDQogICAgICAgICAgICBpZighb3B0aW9ucy5DeWNsaWMgJiYgZWFGaWVsZCAmJiBvYmogJiYgb2JqLkVudGl0eUNsYXNzICYmIHR5cGVvZihvYmpbZmllbGRdKT09PSdmdW5jdGlvbicpew0KICAgICAgICAgICAgICAgIDwlPXNjb3BlJT4uX3VuUmVjdXJzZS48JT1uTmFtZShjKSU+W2Z1bl0gPSA8JT1zY29wZSU+Ll91blJlY3Vyc2UuPCU9bk5hbWUoYyklPltmdW5dIHx8IHt9Ow0KICAgICAgICAgICAgICAgIDwlPXNjb3BlJT4uX3VuUmVjdXJzZS48JT1uTmFtZShjKSU+W2Z1bl0uQ3ljbGljID0gPCU9c2NvcGUlPi5fdW5SZWN1cnNlLjwlPW5OYW1lKGMpJT5bZnVuXS5DeWNsaWMgfHwgW107DQogICAgICAgICAgICAgICAgbGV0IF9jeWNsZXMgPSBvYmpbZmllbGRdKCk7DQogICAgICAgICAgICAgICAgaWYoIUFycmF5LmlzQXJyYXkoX2N5Y2xlcykpIF9jeWNsZXMgPSBbX2N5Y2xlc107DQogICAgICAgICAgICAgICAgX2N5Y2xlcyA9IF9jeWNsZXMuZmlsdGVyKF9jID0+IF9jICYmIHR5cGVvZihfY1tlYUZpZWxkXSk9PT0nZnVuY3Rpb24nICYmIF9jWydfJyArIGVhRmllbGQgKyAnX3NldCddICYmIG9iai5fc2FtZUVudGl0eShfY1tlYUZpZWxkXSgpKSkubWFwKF9jID0+ICh7DQogICAgICAgICAgICAgICAgICAgIC8qbWFyayBfY1tlYUZpZWxkXV9zZXQgdG8gbnVsbCBpbnN0ZWFkKi8NCiAgICAgICAgICAgICAgICAgICAgX2MsDQogICAgICAgICAgICAgICAgICAgIGVhRmllbGQsDQogICAgICAgICAgICAgICAgfSkpOw0KICAgICAgICAgICAgICAgIGlmKF9jeWNsZXMubGVuZ3RoKSA8JT13YXJuKCklPmZ1biArICIvX2N5Y2xlcyIsIF9jeWNsZXMpOw0KICAgICAgICAgICAgICAgIDwlPXNjb3BlJT4uX3VuUmVjdXJzZS48JT1uTmFtZShjKSU+W2Z1bl0uQ3ljbGljLnB1c2goLi4uX2N5Y2xlcyk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKG9wdGlvbnMuX21hcCkgX3RoaXMuX21hcChmaWVsZCwgdHlwZW9mKGVhT2JqKT09PSd1bmRlZmluZWQnLCBmdW4sIHR5cGVvZihlYU9iaik9PT0ndW5kZWZpbmVkJz9vYmo6ZWFPYmosIHR5cGVvZihlYU9iaik9PT0ndW5kZWZpbmVkJz9fdGhpczpvYmosIGVhQ29kZSk7DQoNCiAgICAgICAgICAgIHJldHVybiBfcmV0Ow0KICAgICAgICB9Y2F0Y2goZXgpew0KICAgICAgICAgICAgPCU9ZXJyb3IoKSU+ZnVuLCBmaWVsZCwgZXgpOw0KICAgICAgICB9DQo8JSB9JT4NCgl9DQoJDQoJPCU9bU5hbWU9J19faW1wb3J0JyU+KG9iaiwgb3B0aW9ucywgZnVuLCAuLi5mQXJncykgew0KICAgICAgICBpZih0eXBlb2Yob2JqKSE9PSdvYmplY3QnKXsNCiAgICAgICAgICAgIDwlPXdhcm4oKSU+YCR7ZnVufTogTm90IGFuIG9iamVjdDogJHt0eXBlb2Yob2JqKX1gLCBvYmopOw0KICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgIH0NCgkgICAgDQogICAgICAgIGxldCBlYUNvZGVzID0ge307DQoNCgkJaWYgKCFvcHRpb25zLlVuaXF1ZSkgdGhpcy5fX29wdGlvbnMoIklkIiwgb2JqLCBlYUNvZGVzLklkID0gKG9wdGlvbnMuX21hcD90aGlzLl9uQ29kZSgnSWQnKTonSWQnKSwgdW5kZWZpbmVkLCB0aGlzLCBvcHRpb25zLCBmdW4pOw0KCQkNCjwlIGMuRW50aXR5QXR0cmlidXRlcy5maWx0ZXIoZWEgPT4gIWVhLkVudGl0eU1ldGhvZCAmJiAhZWEuRW50aXR5VHlwZSkuZm9yRWFjaChlYSA9PiB7JT4NCiAgICAgICAgaWYoIW9wdGlvbnMuVW5pcXVlIHx8IChvcHRpb25zLlVuaXF1ZSAmJiA8JXZhbHVlT2YoZWEuSXNVbmlxdWUpJT4pKSB0aGlzLl9fb3B0aW9ucygiPCU9bk5hbWUoZWEpJT4iLCBvYmosIGVhQ29kZXMuPCU9bk5hbWUoZWEpJT4gPSAob3B0aW9ucy5fbWFwPzwlPV9uQ29kZShlYSklPjo8JV92Q29kZShlYSklPiksIHVuZGVmaW5lZCwgdGhpcywgb3B0aW9ucywgZnVuLCAiPCU9X2NGaWVsZChlYSklPiIpOw0KPCUgfSklPg0KDQo8JSBjLkVudGl0eUF0dHJpYnV0ZXMuZmlsdGVyKGVhID0+ICFlYS5FbnRpdHlNZXRob2QgJiYgZWEuRW50aXR5VHlwZSAmJiBlYS5Jc1VuaXF1ZSkuZm9yRWFjaChlYSA9PiB7JT4NCiAgICAgICAgaWYoIW9wdGlvbnMuVW5pcXVlIHx8IChvcHRpb25zLlVuaXF1ZSAmJiA8JXZhbHVlT2YoZWEuSXNVbmlxdWUpJT4pKSB0aGlzLl9fb3B0aW9ucygiPCU9bk5hbWUoZWEpJT4iLCBvYmosIGVhQ29kZXMuPCU9bk5hbWUoZWEpJT4gPSAob3B0aW9ucy5fbWFwPzwlPV9uQ29kZShlYSklPjo8JV92Q29kZShlYSklPiksIHVuZGVmaW5lZCwgdGhpcywgb3B0aW9ucywgZnVuLCAiPCU9X2NGaWVsZChlYSklPiIpOw0KPCUgfSklPg0KDQoJCTwlIHVuUmVjdXJzZSgndGhpcycsICdmdW4nLCAnZkFyZ3MnLCAnaWYodHlwZW9mKG9wdGlvbnMuaW1wb3J0ZXIpPT09ImZ1bmN0aW9uIikgb3B0aW9ucy5pbXBvcnRlcih2KScpJT4NCg0KPCUgYy5FbnRpdHlBdHRyaWJ1dGVzLmZpbHRlcihlYSA9PiAhZWEuRW50aXR5TWV0aG9kICYmIGVhLkVudGl0eVR5cGUgJiYgIWVhLklzVW5pcXVlKS5mb3JFYWNoKGVhID0+IHslPg0KICAgICAgICBpZiAoIW9wdGlvbnMuVW5pcXVlKSAgdGhpcy5fX29wdGlvbnMoIjwlPW5OYW1lKGVhKSU+Iiwgb2JqLCBlYUNvZGVzLjwlPW5OYW1lKGVhKSU+ID0gKG9wdGlvbnMuX21hcD88JT1fbkNvZGUoZWEpJT46PCVfdkNvZGUoZWEpJT4pLCB1bmRlZmluZWQsIHRoaXMsIG9wdGlvbnMsIGZ1biwgIjwlPV9jRmllbGQoZWEpJT4iKTsNCjwlIH0pJT4NCg0KCQlpZiAoIW9wdGlvbnMuVW5pcXVlKSB0aGlzLl9fb3B0aW9ucygiX1RISVMiLCBvYmosIGVhQ29kZXMuX1RISVMgPSAob3B0aW9ucy5fbWFwP3RoaXMuX25Db2RlKCdfVEhJUycpOidfVEhJUycpLCB1bmRlZmluZWQsIHRoaXMsIG9wdGlvbnMsIGZ1bik7DQoNCjwlIGMuVHlwZWRBdHRyaWJ1dGVzLmZpbHRlcih0YSA9PiAhdGEuRW50aXR5TWV0aG9kKS5mb3JFYWNoKHRhID0+IHsNCiAgICBsZXQgdGFOYW1lID0gbk5hbWUodGEpICsgJ18nICsgdGEuRW50aXR5Q2xhc3MuUGx1cmFsLnJlcGxhY2UoLyAvZywgJ18nKTsNCiU+DQogICAgICAgIGlmICghb3B0aW9ucy5VbmlxdWUpIHRoaXMuX19vcHRpb25zKCI8JT10YU5hbWUlPiIsIG9iaiwgZWFDb2Rlcy48JT10YU5hbWUlPiA9IChvcHRpb25zLl9tYXA/PCU9X25Db2RlKHRhLCB0cnVlKSU+OiI8JT10YU5hbWUlPiIpLCB1bmRlZmluZWQsIHRoaXMsIG9wdGlvbnMsIGZ1biwgIjwlPV9jRmllbGQodGEpJT4iKTsNCjwlIH0pJT4NCg0KICAgICAgICBpZiAoIW9wdGlvbnMuVW5pcXVlKSBPYmplY3Qua2V5cyhvcHRpb25zKS5maWx0ZXIoayA9PiB0eXBlb2Yob3B0aW9uc1trXSk9PT0nZnVuY3Rpb24nICYmICFPYmplY3Qua2V5cyhlYUNvZGVzKS5pbmNsdWRlcyhrKSkuZm9yRWFjaChrID0+IHRoaXMuX19vcHRpb25zKGssIG9iaiwgaywgdW5kZWZpbmVkLCB0aGlzLCBvcHRpb25zLCBmdW4pKTsNCg0KCQlyZXR1cm4gdGhpczsNCgl9DQoNCjwlIGlmKG1haW5DbGFzcyhbJ05lbzRqJ10pKXslPg0KICAgIDwlPW1OYW1lPSdfdG9DeVRhYmxlJyU+KCl7DQogICAgICAgIGxldCByZXQgPSB0aGlzLl9fZXhwb3J0KHtjcWw6IGANCkNSRUFURSBDT05TVFJBSU5UIElGIE5PVCBFWElTVFMgRk9SIChvOiR7PCU9X25Db2RlKCklPn0pIFJFUVVJUkUgby4ke3RoaXMuX19jb25maWcoJ2lkRmllbGQnLCAnSWQnKX0gSVMgVU5JUVVFOw0KQ1JFQVRFIENPTlNUUkFJTlQgSUYgTk9UIEVYSVNUUyBGT1IgKG86JHs8JT1fbkNvZGUoKSU+fSkgUkVRVUlSRSBvLiR7dGhpcy5fX2NvbmZpZygnaWRGaWVsZCcsICdJZCcpfSBJUyBOT1QgTlVMTDsNCiAgICAgICAgYH0sIHsNCiAgICAgICAgICAgIEZ1bGw6IHRydWUsDQogICAgICAgICAgICBOdWxsOiB0cnVlLA0KICAgIDwlIGMuRW50aXR5QXR0cmlidXRlcy5maWx0ZXIoZWEgPT4gIWVhLkVudGl0eU1ldGhvZCkuZm9yRWFjaChlYSA9PiB7JT4NCiAgICAgICAgICAgICI8JT1uTmFtZShlYSklPiI6IChvYmosIGVhQ29kZSwgdikgPT4gew0KICAgICAgICA8JSBpZihlYS5FbnRpdHlUeXBlKXslPg0KICAgICAgICAgICAgICAgIG9iai5jcWwgKz0gdj92LjwlPW1OYW1lJT4oKTonJzsNCiAgICAgICAgPCUgfWVsc2UgaWYoZWEuSXNVbmlxdWUpeyU+DQogICAgICAgICAgICAgICAgb2JqLmNxbCArPSBgQ1JFQVRFIENPTlNUUkFJTlQgSUYgTk9UIEVYSVNUUyBGT1IgKG86JHs8JT1fbkNvZGUoKSU+fSkgUkVRVUlSRSBvLiR7ZWFDb2RlfSBJUyBVTklRVUU7DQpgDQogICAgICAgIDwlIH0lPg0KICAgICAgICAgICAgfSwNCiAgICA8JSB9KTsgJT4NCiAgICA8JSBjLlR5cGVkQXR0cmlidXRlcy5mb3JFYWNoKHRhID0+IHsgbGV0IHRhTmFtZSA9IG5OYW1lKHRhKSArICdfJyArIHRhLkVudGl0eUNsYXNzLlBsdXJhbC5yZXBsYWNlKC8gL2csICdfJyk7JT4NCiAgICAgICAgICAgIDwlPXRhTmFtZSU+OiAob2JqLCBlYUNvZGUsIHYpID0+IG9iai5jcWwgKz0gdi5tYXAoX3YgPT4gX3YuPCU9bU5hbWUlPigpKS5qb2luKCdcbicpLA0KICAgIDwlIH0pJT4NCiAgICAgICAgfSwgIjwlPW1OYW1lJT4iKTsNCg0KICAgICAgICA8JT1sb2coKSU+cmV0LmNxbCk7DQogICAgICAgIHJldHVybiByZXQuY3FsOw0KICAgIH0NCiAgICANCiAgICA8JT1tTmFtZT0nX3RvQ3lNZXJnZSclPihmaWVsZHMsIGJSYXcpew0KICAgICAgICBsZXQgb2JqID0gdGhpcy5fdG9EQk9iamVjdChmaWVsZHMsIHRydWUpOw0KICAgICAgICBsZXQgdWtleXMgPSBbXTsNCiAgICA8JSBjLkVudGl0eUF0dHJpYnV0ZXMuZmlsdGVyKGVhID0+ICFlYS5FbnRpdHlNZXRob2QgJiYgZWEuSXNVbmlxdWUpLmZvckVhY2goZWEgPT4geyU+DQogICAgICAgIGlmKDwldmFsdWVPZihlYS5Jc1VuaXF1ZSklPikgdWtleXMucHVzaCg8JT1fbkNvZGUoZWEpJT4pOw0KICAgIDwlIH0pJT4NCiAgICAgICAgbGV0IGNxbCA9IGA6JHs8JT1fbkNvZGUoKSU+fSB7YCArIE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGsgPT4gdWtleXMuaW5jbHVkZXMoaykpLm1hcChrID0+IGsgKyAiOiAiICsgb2JqW2tdKS5qb2luKCcsICcpICsgYH0pYDsNCiAgICAgICAgDQogICAgICAgIGlmKCFiUmF3KXsNCiAgICAgICAgICAgIGxldCBtYXRjaCA9ICdcbk1BVENIIChvJyArIGNxbDsNCiAgICAgICAgICAgIGNxbCA9ICdNRVJHRSAobycgKyBjcWw7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGxldCBvblNldCA9IE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGsgPT4gIXVrZXlzLmluY2x1ZGVzKGspKS5tYXAoayA9PiAiby4iICsgayArICI9IiArIG9ialtrXSkuam9pbignLCAnKQ0KICAgICAgICAgICAgY3FsICs9ICdcbk9OIENSRUFURSBTRVQgJyArIG9uU2V0ICsgJ1xuT04gTUFUQ0ggU0VUICcgKyBvblNldDsNCiAgICAgICAgICAgIGNxbCArPSAnXG5SRVRVUk4gbzsnOw0KDQogICAgPCUgYy5FbnRpdHlBdHRyaWJ1dGVzLmZpbHRlcihlYSA9PiAhZWEuRW50aXR5TWV0aG9kICYmIGVhLkVudGl0eVR5cGUpLmZvckVhY2goZWEgPT4geyU+DQogICAgICAgICAgICBpZih0aGlzLl88JT1uTmFtZShlYSklPl9zZXQpIGNxbCArPSBtYXRjaCArICcsICcgKyB0aGlzLjwlPW5OYW1lKGVhKSU+KCkuPCU9bU5hbWUlPihudWxsLCB0cnVlKS5yZXBsYWNlKCcoOicsICcoPCU9bk5hbWUoZWEpJT46JykgKyAnIE1FUkdFIChvKS1bOjwlPW5OYW1lKGMpJT5fPCU9bk5hbWUoZWEpJT5dLT4oPCU9bk5hbWUoZWEpJT4pOyc7DQogICAgPCUgfSklPg0KICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgIGNxbCA9ICcoJyArIGNxbDsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgPCU9bG9nKCklPmNxbCk7DQogICAgICAgIHJldHVybiBjcWw7DQogICAgfQ0KDQogICAgPCU9bU5hbWU9J190b0N5UXVlcnknJT4oZmllbGRzLCBvYmpzKXsNCiAgICAgICAgbGV0IHNxbCA9ICJNQVRDSCAiOw0KICAgICAgICANCiAgICAgICAgbGV0IHRQcmVmID0gYCR7dGhpcy5fUSgpfSR7PCU9X25Db2RlKCklPi50b0xvd2VyQ2FzZSgpfSR7dGhpcy5fUSgpfWA7DQoNCiAgICAgICAgbGV0IGhlYWRlciA9IHRoaXMuX3RvU2VsZWN0SGVhZGVyKGZpZWxkcyk7DQoNCiAgICAgICAgc3FsICs9IGAgKCR7dFByZWZ9OiR7dGhpcy5fUSgpfSR7PCU9X25Db2RlKCklPn0ke3RoaXMuX1EoKX0pYDsNCiAgICAgICAgDQogICAgICAgIE9iamVjdC5rZXlzKGhlYWRlci5qb2lucykuZm9yRWFjaChrID0+IHNxbCArPSBgIE9QVElPTkFMIE1BVENIICgke3RoaXMuX1EoKX0ke2t9JHt0aGlzLl9RKCl9OiR7dGhpcy5fUSgpfSR7aGVhZGVyLmpvaW5zW2tdLnRhYmxlfSR7dGhpcy5fUSgpfSkgT1BUSU9OQUwgTUFUQ0ggKCR7dGhpcy5fUSgpfSR7PCU9X25Db2RlKCklPi50b0xvd2VyQ2FzZSgpfSR7dGhpcy5fUSgpfSktWzoke3RoaXMuX1EoKX0ke2hlYWRlci5qb2luc1trXS50YWJsZX1fJHtrfSR7dGhpcy5fUSgpfV0tPigke3RoaXMuX1EoKX0ke2t9JHt0aGlzLl9RKCl9KWApOw0KICAgICAgICANCg0KICAgICAgICAvL3NxbCArPSBPYmplY3QudmFsdWVzKGhlYWRlci5maWVsZHMpLm1hcChmID0+IGAke3RQcmVmfS4ke2Z9YCkuam9pbignLCAnKTsNCiAgICAgICAgLy9PYmplY3Qua2V5cyhoZWFkZXIuam9pbnMpLmZvckVhY2goayA9PiBzcWwgKz0gIiwgIiArIE9iamVjdC52YWx1ZXMoaGVhZGVyLmpvaW5zW2tdLmZpZWxkcykubWFwKGYgPT4gYCR7dGhpcy5fUSgpfSR7aGVhZGVyLmpvaW5zW2tdLnRhYmxlfV8ke2t9JHt0aGlzLl9RKCl9LiR7Zn0gYXMgJHt0aGlzLl9RKCl9JHtrfS4ke2YucmVwbGFjZSh0aGlzLl9RKCksICcnKX1gKS5qb2luKCcsICcpKTsNCiAgICAgICAgDQogICAgICAgIGlmKHRoaXMuX19maWVsZEFnZ3JlZ2F0ZXMpew0KICAgICAgICAgICAgLy8ge2ZpZWxkOiBmdW5jdGlvbn0NCiAgICA8JSBjLkVudGl0eUF0dHJpYnV0ZXMuZmlsdGVyKGVhID0+ICFlYS5FbnRpdHlNZXRob2QgJiYgIWVhLklzVGV4dCAmJiAhZWEuSXNJbWFnZSAmJiAhZWEuSXNGaWxlKS5mb3JFYWNoKGVhID0+IHsgJT4NCiAgICAgICAgICAgIGlmKHRoaXMuX19maWVsZEFnZ3JlZ2F0ZXMuPCU9bk5hbWUoZWEpJT4pIHNxbCArPSBgJHtzcWw9PSgnc2VsZWN0ICcpPycnOicsJ30gJHt0aGlzLl9fZmllbGRBZ2dyZWdhdGVzLjwlPW5OYW1lKGVhKSU+fSgke3RoaXMuX1EoKX0kezwlPV9uQ29kZShlYSklPn0ke3RoaXMuX1EoKX0pYDsNCiAgICA8JSB9KSU+DQogICAgICAgIH0NCg0KICAgICAgICBzcWwgKz0gYCB3aGVyZSAxPTFgOw0KDQogICAgICAgIHNxbCA9IHRoaXMuX19leHBvcnQoe3NxbDogc3FsfSwgew0KICAgICAgICAgICAgX2ZpZWxkczogKHRoaXMuX19zeW5jX29uKCkgfHwgdGhpcy5JZD09dGhpcy5JZCk/WydJZCddOnVuZGVmaW5lZCwNCiAgICAgICAgICAgIE51bGw6IHRydWUsDQogICAgICAgICAgICBfVEhJUzogb2JqID0+IHsNCiAgICAgICAgICAgICAgICBpZighdGhpcy5fVEhJUyB8fCAhdGhpcy5fVEhJUy5sZW5ndGgpIHJldHVybjsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICBvYmouc3FsICs9IGAgYW5kICR7dFByZWZ9LiR7dGhpcy5fUSgpfSR7dGhpcy5fX2NvbmZpZygnaWRGaWVsZCcsICdJZCcpfSR7dGhpcy5fUSgpfSBgICsgKHRoaXMuX1RISVNfY29vcCB8fCAiSU4iKSArICIgKCIgKyB0aGlzLl9USElTLm1hcCh0ID0+IHQuPCU9bU5hbWUlPih0Ll9fY29uZmlnKCdpZEZpZWxkJywgJ0lkJykpKS5qb2luKCcgVU5JT04gQUxMICcpICsgIikiOw0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIElkOiBvYmogPT4gb2JqLnNxbCArPSBgIGFuZCAke3RQcmVmfS4ke3RoaXMuX1EoKX0ke3RoaXMuX19jb25maWcoJ2lkRmllbGQnLCAnSWQnKX0ke3RoaXMuX1EoKX09JyR7dGhpcy5JZH0nYCwNCiAgICA8JSBjLkVudGl0eUF0dHJpYnV0ZXMuZmlsdGVyKGVhID0+ICFlYS5FbnRpdHlNZXRob2QpLmZvckVhY2goZWEgPT4geyAlPg0KICAgICAgICAgICAgPCU9bk5hbWUoZWEpJT46IChvYmosIGVhQ29kZSwgdikgPT4gew0KICAgICAgICAgICAgICAgIGlmKCF0aGlzLl88JT1uTmFtZShlYSklPl9zZXQpIHJldHVybjsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgPCUgaWYoZWEuRW50aXR5VHlwZSl7JT4NCiAgICAgICAgICAgICAgICBsZXQgY29vcCA9IHRoaXMuXzwlPW5OYW1lKGVhKSU+X2Nvb3A7DQogICAgICAgICAgICAgICAgc3dpdGNoKGNvb3Apew0KICAgICAgICAgICAgICAgICAgICBjYXNlICIhPSI6DQogICAgICAgICAgICAgICAgICAgICAgICBjb29wID0gIk5PVCAiOw0KICAgICAgICAgICAgICAgICAgICBjYXNlICI9IjoNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvb3AgPSAiIjsNCiAgICAgICAgICAgICAgICAgICAgY2FzZSAiIjoNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvb3AgPSAiIjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgaWYodil7DQogICAgICAgICAgICAgICAgICAgIG9iai5zcWwgKz0gYCBhbmQgJHtjb29wfSBFWElTVFMgeyR7di48JT1tTmFtZSU+KCl9fWA7DQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIG9iai5zcWwgKz0gYCBhbmQgKCR7dFByZWZ9LiR7dGhpcy5fUSgpfSR7ZWFDb2RlfWlkJHt0aGlzLl9RKCl9ICR7Y29vcH0gKDApIE9SICR7dFByZWZ9LiR7dGhpcy5fUSgpfSR7ZWFDb2RlfWlkJHt0aGlzLl9RKCl9IElTIE5VTEwpYDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICA8JSB9ZWxzZSBpZihlYS5Jc1RleHQgfHwgZWEuSXNJbWFnZSB8fCBlYS5Jc0ZpbGUpeyU+DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICA8JSB9ZWxzZXslPg0KICAgICAgICAgICAgICAgIG9iai5zcWwgKz0gYCBhbmQgJHt0UHJlZn0uJHt0aGlzLl9RKCl9JHtlYUNvZGV9JHt0aGlzLl9RKCl9IGAgKyA8JWlmKGVhLklzQm9vbCl7JT4iPSI8JX1lbHNleyU+KHRoaXMuXzwlPW5OYW1lKGVhKSU+X2Nvb3AgfHwgIkNPTlRBSU5TIik8JX0lPiArICIgIjsNCiAgICAgICAgPCUgfSU+DQogICAgICAgIA0KICAgICAgICA8JSBpZihlYS5Jc0RhdGUpeyAlPg0KICAgICAgICAgICAgICAgIGlmKHYgJiYgdi50b0lTT1N0cmluZyl7DQogICAgICAgICAgICAgICAgICAgIGlmKHRoaXMuX19jb25maWcoJ3R5cGUnKT09J3NxbGl0ZScpew0KICAgICAgICAgICAgICAgICAgICAgICAgb2JqLnNxbCArPSAic3RyZnRpbWUoJyVzJywgJyIgKyB2LnRvSVNPU3RyaW5nKCkgKyAiJykiOw0KICAgICAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgICAgIG9iai5zcWwgKz0gIiciICsgdi50b0lTT1N0cmluZygpICsgIiciOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIDwlIH1lbHNlIGlmKGVhLklzU3RyaW5nKXsgJT4NCiAgICAgICAgICAgICAgICBpZih0eXBlb2Yodik9PT0ic3RyaW5nIil7DQogICAgICAgICAgICAgICAgICAgIG9iai5zcWwgKz0gIiciICsgKCh0aGlzLl88JT1uTmFtZShlYSklPl9jb29wPT0iTElLRSIgfHwgIXRoaXMuXzwlPW5OYW1lKGVhKSU+X2Nvb3ApPyIlIjoiIikgKyB2ICsgKCh0aGlzLl88JT1uTmFtZShlYSklPl9jb29wPT0iTElLRSIgfHwgIXRoaXMuXzwlPW5OYW1lKGVhKSU+X2Nvb3ApPyIlIjoiIikgKyAiJyI7DQogICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIDwlIH1lbHNlIGlmKGVhLklzQm9vbCl7ICU+DQogICAgICAgICAgICAgICAgaWYodHlwZW9mKHYpPT09ImJvb2xlYW4iKXsNCiAgICAgICAgICAgICAgICAgICAgb2JqLnNxbCArPSAiJyIgKyAodj8iMSI6IjAiKSArICInIjsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgPCUgfSAlPg0KICAgICAgICAgICAgICAgIGlmKHYgJiYgdi5FbnRpdHlDbGFzcyl7DQogICAgICAgICAgICAgICAgICAgIG9iai5zcWwgKz0gIigiICsgdi48JT1tTmFtZSU+KCkgKyAiKSI7DQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIG9iai5zcWwgKz0gIiciICsgdiArICInIjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9LA0KICAgIDwlIH0pOyAlPg0KICAgIDwlIGMuVHlwZWRBdHRyaWJ1dGVzLmZvckVhY2godGEgPT4geyBsZXQgdGFOYW1lID0gbk5hbWUodGEpICsgJ18nICsgdGEuRW50aXR5Q2xhc3MuUGx1cmFsLnJlcGxhY2UoLyAvZywgJ18nKTslPg0KICAgICAgICAgICAgPCU9dGFOYW1lJT46IChvYmosIGVhQ29kZSwgdikgPT4gew0KICAgICAgICAgICAgICAgIGlmKCF0aGlzLl88JT10YU5hbWUlPl9zZXQpIHJldHVybjsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICBsZXQgc3F1ZXJpZXMgPSAodiB8fCBbXSkuZmlsdGVyKHQgPT4gdCkubWFwKHQgPT4gdC48JT1tTmFtZSU+KCI8JT1uTmFtZSh0YSklPi5pZCIpKTsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICBsZXQgak9QID0gJ1VOSU9OIEFMTCc7DQogICAgICAgICAgICAgICAgbGV0IGluT1AgPSAnSU4nOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIG9iai5zcWwgKz0gYGA7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgaWYodGhpcy5fPCU9dGFOYW1lJT5fY29vcD09JyE9JyB8fCB0aGlzLl88JT10YU5hbWUlPl9jb29wPT0nTk9UIElOJyl7DQogICAgICAgICAgICAgICAgICAgIGluT1AgPSAnTk9UIElOJzsNCiAgICAgICAgICAgICAgICB9ZWxzZSBpZih0aGlzLl88JT10YU5hbWUlPl9jb29wPT0nPScgfHwgdGhpcy5fPCU9dGFOYW1lJT5fY29vcD09J0lOJyl7DQogICAgICAgICAgICAgICAgfWVsc2UgaWYodGhpcy5fPCU9dGFOYW1lJT5fY29vcD09Jz09Jyl7DQogICAgICAgICAgICAgICAgICAgIGpPUCA9ICdJTlRFUlNFQ1QnOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICBvYmouc3FsICs9IGBhbmQgLyo8JT10YU5hbWUlPiovICR7dFByZWZ9LiR7dGhpcy5fUSgpfSR7dGhpcy5fX2NvbmZpZygnaWRGaWVsZCcsICdJZCcpfSR7dGhpcy5fUSgpfSAke2luT1B9IChgICsgc3F1ZXJpZXMuam9pbihgICR7ak9QfS8qTTJNKi8gYCkgKyAnKSc7DQogICAgICAgICAgICB9LA0KICAgIDwlIH0pJT4NCiAgICAgICAgfSwgIjwlPW1OYW1lJT4iLCBmaWVsZHMpLnNxbDsNCg0KICAgICAgICBpZih0aGlzLl9fZmllbGRHcm91cHMpew0KICAgICAgICAgICAgaWYoT2JqZWN0LmtleXModGhpcy5fX2ZpZWxkR3JvdXBzKS5sZW5ndGgpIHNxbCArPSAiIGdyb3VwIGJ5ICI7DQogICAgPCUgYy5FbnRpdHlBdHRyaWJ1dGVzLmZpbHRlcihlYSA9PiAhZWEuRW50aXR5TWV0aG9kICYmICFlYS5Jc1RleHQgJiYgIWVhLklzSW1hZ2UgJiYgIWVhLklzRmlsZSkuZm9yRWFjaChlYSA9PiB7ICU+DQogICAgICAgICAgICBpZih0aGlzLl9fZmllbGRHcm91cHMuPCU9bk5hbWUoZWEpJT4pIHNxbCArPSBgJHt0aGlzLl9RKCl9JHs8JT1fbkNvZGUoZWEpJT48JT0oZWEuRW50aXR5VHlwZT8nKyJpZCInOicnKSU+fSR7dGhpcy5fUSgpfSAke3RoaXMuX19maWVsZEdyb3Vwcy48JT1uTmFtZShlYSklPn1gOw0KICAgIDwlIH0pJT4NCiAgICAgICAgfQ0KDQogICAgICAgIGlmKHNxbC5lbmRzV2l0aCgid2hlcmUgMT0xIikpew0KICAgICAgICAgICAgLy8gc3FsID0gc3FsLnJlcGxhY2UoIndoZXJlIDE9MSIsICJ3aGVyZSAxPTAiKTsNCiAgICAgICAgfWVsc2V7DQogICAgICAgICAgICBzcWwgPSBzcWwucmVwbGFjZSgid2hlcmUgMT0xIGFuZCAiLCAid2hlcmUgIik7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIHNxbCArPSAnIHJldHVybiAnICsgW3RQcmVmXS5jb25jYXQoT2JqZWN0LmtleXMoaGVhZGVyLmpvaW5zKS5tYXAoayA9PiBgJHt0aGlzLl9RKCl9JHtrfSR7dGhpcy5fUSgpfWApKS5qb2luKCcsICcpOw0KICAgICAgICANCiAgICAgICAgPCU9bG9nKCklPnNxbCk7DQogICAgICAgIA0KICAgICAgICByZXR1cm4gc3FsOw0KICAgIH0NCg0KICAgIGFzeW5jIDwlPW1OYW1lPSdfbmVvNGonJT4oY3FsKXsNCiAgICA8JSBpZihtYWluQ2xhc3MoWydOZW80aiddKT09Yyl7JT4NCiAgICAgICAgbGV0IHNlc3Npb24gPSBudWxsOw0KICAgICAgICBsZXQgcmV0ID0gW107DQogICAgICAgIHRyeXsNCiAgICAgICAgICAgIGlmKCF0aGlzLlRvb2wuZGIgfHwgIWNxbCB8fCAhY3FsLnRyaW0oKSl7DQogICAgICAgICAgICAgICAgaWYoIXRoaXMuVG9vbC5kYikgPCU9bG9nKCklPmNxbCwgIiA8PT1TS0lQUEVEPT0+Iik7DQogICAgICAgICAgICAgICAgcmV0dXJuIFtdOw0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYoY3FsLmluZGV4T2YoJztcbicpPjApew0KICAgICAgICAgICAgICAgIGZvciBhd2FpdCAoY29uc3Qgc3FsUyBvZiBjcWwuc3BsaXQoJztcbicpKXsNCiAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy48JT1tTmFtZSU+KHNxbFMudHJpbSgpKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICBsZXQgYlN0b3JlID0gWyJNRVJHRSIsICJDUkVBVEUiLCAiVVBEQVRFIl0uZmlsdGVyKG4gPT4gY3FsLmluZGV4T2Yobik+PTApLmZpbmQobiA9PiBuKTsNCiAgICAgICAgICAgIGxldCBiRE1MID0gWyJDT05TVFJBSU5UIl0uZmlsdGVyKG4gPT4gY3FsLmluZGV4T2Yobik+PTApLmZpbmQobiA9PiBuKTsNCg0KICAgICAgICAgICAgaWYoYkRNTCl7DQogICAgICAgICAgICAgICAgdGhpcy5Ub29sLmRtbENhY2hlID0gdGhpcy5Ub29sLmRtbENhY2hlIHx8IHt9Ow0KICAgICAgICAgICAgICAgIGlmKHRoaXMuVG9vbC5kbWxDYWNoZVt0aGlzLmhhc2hDb2RlKGNxbCldKSByZXR1cm47DQogICAgICAgICAgICAgICAgdGhpcy5Ub29sLmRtbENhY2hlW3RoaXMuaGFzaENvZGUoY3FsKV0gPSBjcWw7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHNlc3Npb24gPSB0aGlzLlRvb2wuZGIuc2Vzc2lvbih7IGRhdGFiYXNlOiB0aGlzLl9fY29uZmlnKCdkYXRhYmFzZScpIH0pOw0KICAgICAgICAgICAgbGV0IGZ1biA9ICdSZWFkJzsNCiAgICAgICAgICAgIGlmKGJTdG9yZSB8fCBiRE1MKSBmdW4gPSAnV3JpdGUnOw0KICAgICAgICAgICAgaWYoZnVuPT0nV3JpdGUnKSB0aGlzLlRvb2wuX19kbWxTdGF0ZW1lbnRzLnB1c2goY3FsKTsNCiAgICAgICAgICAgIDwlPWxvZygpJT5jcWwpOw0KICAgICAgICAgICAgLy9yZXQgPSAoYXdhaXQgc2Vzc2lvblsnZXhlY3V0ZScrZnVuXSh0eCA9PiB0eC5ydW4oY3FsKSkpLnJlY29yZHM7DQogICAgICAgICAgICAvLzwlPWxvZygpJT5yZXQpOw0KICAgICAgICB9Y2F0Y2goZXgpew0KICAgICAgICAgICAgPCU9ZXJyb3IoKSU+ZXgpOw0KICAgICAgICB9DQogICAgICAgIGlmKHNlc3Npb24pIGF3YWl0IHNlc3Npb24uY2xvc2UoKTsNCiAgICAgICAgcmV0dXJuIHJldDsNCiAgICA8JSB9ZWxzZXslPg0KICAgICAgICByZXR1cm4gYXdhaXQgbmV3IDwlPXNjb3BlJT4uPCU9bk5hbWUobWFpbkNsYXNzKFsnTmVvNGonXSkpJT4oKS48JT1tTmFtZSU+KGNxbCk7DQogICAgPCUgfSU+DQogICAgfQ0KPCUgfSU+DQoNCjwlIGlmKG1haW5DbGFzcyhbJ1J4REInLCAnTW9uZ29EQiddKSl7JT4NCiAgICA8JT1tTmFtZT0nX3RvSlNPTlNjaGVtYSclPigpew0KICAgICAgICB0cnl7DQogICAgICAgICAgICBsZXQgdHlwZSA9IHRoaXMuX19jb25maWcoJ2pzb24udHlwZScsICd0eXBlJyk7DQogICAgICAgICAgICBsZXQgc2NoZW1hID0gew0KICAgICAgICAgICAgICAgICRpZDogJzwlPWMuSWQlPicsDQogICAgICAgICAgICAgICAgJHNjaGVtYTogImh0dHBzOi8vanNvbi1zY2hlbWEub3JnL2RyYWZ0LzIwMjAtMTIvc2NoZW1hIiwNCiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogJzwlPWMuUmVtYXJrJT4nLA0KICAgICAgICAgICAgICAgIHRpdGxlOiA8JT1fbkNvZGUoKSU+LA0KICAgICAgICAgICAgICAgIFt0eXBlXTogJ29iamVjdCcsDQogICAgICAgICAgICAgICAgdmVyc2lvbjogMCwNCiAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzOiB7DQogICAgICAgIDwlIGMuRW50aXR5QXR0cmlidXRlcy5maWx0ZXIoZWEgPT4gIWVhLkVudGl0eU1ldGhvZCkuZm9yRWFjaChlYSA9PiB7JT4NCiAgICAgICAgICAgICAgICAgICAgWzwlPV9uQ29kZShlYSklPl06IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAiPCU9ZWEuUmVtYXJrJT4iLA0KICAgICAgICAgICAgPCUgaWYoZWEuSXNBcnJheSl7JT4NCiAgICAgICAgICAgICAgICAgICAgICAgIFt0eXBlXTogdGhpcy5fX2NvbmZpZygnanNvbi50eXBlLmFycmF5JywgJ2FycmF5JyksDQogICAgICAgICAgICAgICAgICAgICAgICBpdGVtczogew0KICAgICAgICAgICAgPCUgfSU+DQogICAgICAgICAgICA8JSBpZihlYS5FbnRpdHlUeXBlKXslPg0KICAgICAgICAgICAgICAgICAgICAgICAgJHJlZjogJzwlPWVhLkVudGl0eUNsYXNzLklkJT4nLA0KICAgICAgICAgICAgPCUgfWVsc2UgaWYoZWEuSXNTdHJpbmcpeyU+DQogICAgICAgICAgICAgICAgICAgICAgICBbdHlwZV06IHRoaXMuX19jb25maWcoJ2pzb24udHlwZS5zdHJpbmcnLCAnc3RyaW5nJyksDQogICAgICAgICAgICA8JSB9ZWxzZSBpZihlYS5Jc1RleHQpeyU+DQogICAgICAgICAgICAgICAgICAgICAgICBbdHlwZV06IHRoaXMuX19jb25maWcoJ2pzb24udHlwZS50ZXh0JywgJ3N0cmluZycpLA0KICAgICAgICAgICAgPCUgfWVsc2UgaWYoZWEuSXNCb29sKXslPg0KICAgICAgICAgICAgICAgICAgICAgICAgW3R5cGVdOiB0aGlzLl9fY29uZmlnKCdqc29uLnR5cGUuYm9vbCcsICdib29sZWFuJyksDQogICAgICAgICAgICA8JSB9ZWxzZSBpZihlYS5Jc0ludCl7JT4NCiAgICAgICAgICAgICAgICAgICAgICAgIFt0eXBlXTogdGhpcy5fX2NvbmZpZygnanNvbi50eXBlLmludCcsICdpbnRlZ2VyJyksDQogICAgICAgICAgICA8JSB9ZWxzZSBpZihlYS5Jc0Zsb2F0KXslPg0KICAgICAgICAgICAgICAgICAgICAgICAgW3R5cGVdOiB0aGlzLl9fY29uZmlnKCdqc29uLnR5cGUuZmxvYXQnLCAnbnVtYmVyJyksDQogICAgICAgICAgICA8JSB9ZWxzZSBpZihlYS5Jc0ltYWdlKXslPg0KICAgICAgICAgICAgICAgICAgICAgICAgW3R5cGVdOiB0aGlzLl9fY29uZmlnKCdqc29uLnR5cGUuaW1hZ2UnLCAnb2JqZWN0JyksDQogICAgICAgICAgICA8JSB9ZWxzZSBpZihlYS5Jc0ZpbGUpeyU+DQogICAgICAgICAgICAgICAgICAgICAgICBbdHlwZV06IHRoaXMuX19jb25maWcoJ2pzb24udHlwZS5maWxlJywgJ29iamVjdCcpLA0KICAgICAgICAgICAgPCUgfSU+DQogICAgICAgICAgICA8JSBpZihlYS5Jc0FycmF5KXslPg0KICAgICAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIDwlIH0lPg0KICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICA8JSB9KSU+DQogICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICByZXF1aXJlZDogWzwlYy5FbnRpdHlBdHRyaWJ1dGVzLmZpbHRlcihlYSA9PiAhZWEuRW50aXR5TWV0aG9kICYmIGVhLlJlcXVpcmVkKS5tYXAoZWEgPT4geyU+PCU9X25Db2RlKGVhKSU+PCV9KS5qb2luKCcsJyklPl0sDQogICAgICAgICAgICB9Ow0KDQogICAgICAgICAgICA8JT1sb2coKSU+c2NoZW1hKTsNCiAgICAgICAgICAgIHJldHVybiBzY2hlbWE7DQogICAgICAgIH1jYXRjaChleCl7DQogICAgICAgICAgICA8JT1lcnJvcigpJT5leCk7DQogICAgICAgIH0NCiAgICB9DQo8JSB9JT4NCg0KPCUgaWYobWFpbkNsYXNzKFsnTW9uZ29EQicsICdSeERCJywgJ1phbmdvREInXSkpeyU+DQogICAgPCU9bU5hbWU9J190b1NlbGVjdE1kYiclPigpew0KICAgICAgICByZXR1cm4gdGhpcy5fX2V4cG9ydCh7fSwgew0KICAgICAgICAgICAgX1RISVM6IG9iaiA9PiBvYmouX2lkID0geyRpbjogdGhpcy5fVEhJUy5tYXAodCA9PiB0LjwlPW1OYW1lJT4oKSl9LA0KICAgICAgICAgICAgSWQ6IG9iaiA9PiBvYmouX2lkID0gdGhpcy5JZCwNCiAgICA8JSBjLkVudGl0eUF0dHJpYnV0ZXMuZmlsdGVyKGVhID0+ICFlYS5FbnRpdHlNZXRob2QgJiYgIWVhLklzVGV4dCAmJiAhZWEuSXNJbWFnZSAmJiAhZWEuSXNGaWxlKS5mb3JFYWNoKGVhID0+IHsgJT4NCiAgICAgICAgICAgIDwlPW5OYW1lKGVhKSU+OiAob2JqLCBlYUNvZGUsIHYpID0+IHsNCiAgICAgICAgPCUgaWYoZWEuRW50aXR5VHlwZSl7JT4NCiAgICAgICAgICAgICAgICBpZighdi48JT1tTmFtZSU+KSByZXR1cm47DQogICAgICAgIDwlIH0lPg0KICAgICAgICAgICAgICAgIG9ialtlYUNvZGVdID0ge307DQogICAgICAgICAgICAgICAgbGV0IG9wID0gIiRlIjsNCiAgICAgICAgICAgICAgICBzd2l0Y2godGhpcy5fPCU9bk5hbWUoZWEpJT5fY29vcCl7DQogICAgICAgICAgICAgICAgICAgIGNhc2UgIj0iOg0KICAgICAgICAgICAgICAgICAgICAgICAgb3AgPSAiJGUiOw0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgICAgIGNhc2UgIj4iOg0KICAgICAgICAgICAgICAgICAgICAgICAgb3AgPSAiJGd0IjsNCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICBjYXNlICI8IjoNCiAgICAgICAgICAgICAgICAgICAgICAgIG9wID0gIiRsdCI7DQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgY2FzZSAiPj0iOg0KICAgICAgICAgICAgICAgICAgICAgICAgb3AgPSAiJGd0ZSI7DQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgY2FzZSAiPD0iOg0KICAgICAgICAgICAgICAgICAgICAgICAgb3AgPSAiJGx0ZSI7DQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgY2FzZSAiIT0iOg0KICAgICAgICAgICAgICAgICAgICAgICAgb3AgPSAiJG5lIjsNCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICBjYXNlICJJTiI6DQogICAgICAgICAgICAgICAgICAgICAgICBvcCA9ICIkaW4iOw0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIDwlIGlmKGVhLklzRGF0ZSl7ICU+DQogICAgICAgICAgICAgICAgb2JqW2VhQ29kZV1bb3BdID0gdi48JT1tTmFtZSU+KCkudG9JU09TdHJpbmcoKTsNCiAgICAgICAgPCUgfWVsc2UgaWYoZWEuRW50aXR5VHlwZSl7JT4NCiAgICAgICAgICAgICAgICBvYmpbZWFDb2RlXSA9IHYuPCU9bU5hbWUlPigpOw0KICAgICAgICA8JSB9ZWxzZXslPg0KICAgICAgICAgICAgICAgIG9ialtlYUNvZGVdID0gdjsNCiAgICAgICAgPCUgfSAlPg0KICAgICAgICAgICAgfSwNCiAgICA8JSB9KTsgJT4NCiAgICA8JSBjLlR5cGVkQXR0cmlidXRlcy5mb3JFYWNoKHRhID0+IHsgbGV0IHRhTmFtZSA9IG5OYW1lKHRhKSArICdfJyArIHRhLkVudGl0eUNsYXNzLlBsdXJhbC5yZXBsYWNlKC8gL2csICdfJyk7JT4NCiAgICAgICAgICAgIDwlPXRhTmFtZSU+OiAob2JqLCBlYUNvZGUsIHYpID0+IG9ialtlYUNvZGVdID0geyRpbjogdi5tYXAodCA9PiB0LjwlPW1OYW1lJT4oKSl9LA0KICAgIDwlIH0pJT4NCiAgICAgICAgfSwgIjwlPW1OYW1lJT4iKTsNCiAgICB9DQo8JSB9JT4NCg0KPCUgaWYobWFpbkNsYXNzKF9zcWxUb29scykpeyU+DQogICAgPCU9bU5hbWU9J190b0RCT2JqZWN0JyU+KGZpZWxkcywgYk5vUmVmKXsNCiAgICAgICAgaWYoIXRoaXMuSWQpew0KICAgICAgICAgICAgPCU9ZXJyb3IoKSU+IkludmFsaWQgSUQiLCB0aGlzLkVudGl0eUNsYXNzLk5hbWUsIHRoaXMuVG9vbCk7DQogICAgICAgIH0NCiAgICAgICAgbGV0IHJldCA9IHsNCiAgICAgICAgICAgIFt0aGlzLl9fY29uZmlnKCdpZEZpZWxkJywgJ0lkJyldOiAiJyIgKyB0aGlzLklkICsgIiciDQogICAgICAgIH07DQogICAgPCUgYy5FbnRpdHlBdHRyaWJ1dGVzLmZpbHRlcihlYSA9PiAhZWEuRW50aXR5TWV0aG9kKS5mb3JFYWNoKGVhID0+IHsgJT4NCiAgICAgICAgaWYoKChmaWVsZHMgJiYgZmllbGRzLmluZGV4T2YoIjwlPWVhLk5hbWUlPiIpKSB8fCAhZmllbGRzKSAmJiB0aGlzLl88JT1uTmFtZShlYSklPl9zZXQgJiYgKCFiTm9SZWYgfHwgPCU9ZWEuRW50aXR5VHlwZT8nZmFsc2UnOid0cnVlJyU+KSl7DQogICAgICAgICAgICBsZXQgZlZhbHVlID0gbnVsbDsNCiAgICAgICAgICAgIGxldCB2ID0gdGhpcy48JT1uTmFtZShlYSklPigpOw0KICAgICAgICA8JSBpZihlYS5FbnRpdHlUeXBlKXslPg0KICAgICAgICAgICAgaWYodiAmJiAodi5fX3N5bmNfb24oKSB8fCB2LklkPT12LklkKSl7DQogICAgICAgICAgICAgICAgZlZhbHVlID0gIiciICsgdi5JZCArICInIjsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIGZWYWx1ZSA9ICJOVUxMIjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgPCUgfWVsc2UgaWYoZWEuSXNCb29sKXslPg0KICAgICAgICAgICAgZlZhbHVlID0gdj8xOjA7DQogICAgICAgICAgICBpZih0aGlzLlRvb2wudHlwZS5uYW1lPT0nTmVvNGonKSBmVmFsdWUgPSBmVmFsdWU/J1RydWUnOidGYWxzZSc7DQogICAgICAgICAgICBpZih0aGlzLlRvb2wudHlwZS5uYW1lPT0nU3FsREInKSBmVmFsdWUgPSAiJyIgKyBmVmFsdWUgKyAiJyI7DQogICAgICAgIDwlIH1lbHNlIGlmKGVhLklzSW50IHx8IGVhLklzTG9uZyB8fCBlYS5Jc0Zsb2F0KXslPg0KICAgICAgICAgICAgZlZhbHVlID0gdiB8fCAnMCc7DQogICAgICAgIDwlIH1lbHNlIGlmKGVhLklzRGF0ZSl7JT4NCiAgICAgICAgICAgIHRyeXsNCiAgICAgICAgICAgICAgICBmVmFsdWUgPSAiJyIgKyAodj92LnRvSVNPU3RyaW5nKCk6IjE5NzAtMS0xIikgKyAiJyI7DQogICAgICAgICAgICAgICAgaWYodGhpcy5fX2NvbmZpZygndHlwZScpPT0nbXlzcWwnKXsNCiAgICAgICAgICAgICAgICAgICAgZlZhbHVlID0gYFNUUl9UT19EQVRFKCR7ZlZhbHVlfSwgJyVZLSVtLSVkVCVULiVmWicpYDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9Y2F0Y2goZXgpew0KICAgICAgICAgICAgICAgIGZWYWx1ZSA9ICInIiArIHYgKyAiJyI7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZih0aGlzLlRvb2wudHlwZS5uYW1lPT0nTmVvNGonKSBmVmFsdWUgPSAnZGF0ZXRpbWUoJyArIGZWYWx1ZSArICcpJzsNCiAgICAgICAgPCUgfWVsc2UgaWYoZWEuSXNPYmplY3QpeyU+DQogICAgICAgICAgICBmVmFsdWUgPSAiJyIgKyBKU09OLnN0cmluZ2lmeSh2LCBudWxsLCAnXHQnKSArICInIjsNCiAgICAgICAgPCUgfWVsc2UgaWYoZWEuSXNTdHJpbmcpeyU+DQogICAgICAgICAgICBmVmFsdWUgPSB2PT09bnVsbD8iTlVMTCI6KCInIiArICgoZmFsc2UgJiYgdiAmJiB2LnJlcGxhY2UpP3YucmVwbGFjZSgvXFxuL2csICJcXFxcbiIpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKC9cXCcvZywgIlxcXFwnIikNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLnJlcGxhY2UoL1xcIi9nLCAnXFxcXCInKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAucmVwbGFjZSgvXFwmL2csICJcXFxcJiIpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKC9cXHIvZywgIlxcXFxyIikNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLnJlcGxhY2UoL1xcdC9nLCAiXFxcXHQiKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAucmVwbGFjZSgvXFxiL2csICJcXFxcYiIpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKC9cXGYvZywgIlxcXFxmIikgIDp2KSArICInIik7DQogICAgICAgIDwlIH1lbHNlIGlmKGVhLklzVGV4dCl7JT4NCiAgICAgICAgICAgIGlmKHY9PT1udWxsKXsNCiAgICAgICAgICAgICAgICBmVmFsdWUgPSAiTlVMTCI7DQogICAgICAgICAgICB9ZWxzZSBpZih0aGlzLlRvb2wudHlwZS5uYW1lPT0nU3FsREInKXsNCiAgICAgICAgICAgICAgICBpZih0aGlzLl9fY29uZmlnKCd0eXBlJyk9PSdteXNxbCcpew0KICAgICAgICAgICAgICAgICAgICBmVmFsdWUgPSBgRlJPTV9CQVNFNjQoJyR7dGhpcy5fYnRvYSh2KX0nKWA7DQogICAgICAgICAgICAgICAgfWVsc2UgaWYodGhpcy5fX2NvbmZpZygndHlwZScpPT0nc3FsaXRlJyl7DQogICAgICAgICAgICAgICAgICAgIGZWYWx1ZSA9IGBjYXN0KHVuaGV4KCcke3Yuc3BsaXQoIiIpLm1hcCh4ID0+ICgyNTYgKyB4LmNoYXJDb2RlQXQoKSkudG9TdHJpbmcoMTYpLnN1YnN0cigtMikpLmpvaW4oIiIpfScpIGFzIHZhcmNoYXIpYDsNCiAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgZlZhbHVlID0gdjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICBmVmFsdWUgPSAiJyIgKyB2ICsgIiciOw0KICAgICAgICAgICAgfQ0KICAgICAgICA8JSB9ZWxzZXsgJT4NCiAgICAgICAgICAgIGZWYWx1ZSA9ICInIiArIHYgKyAiJyI7DQogICAgICAgIDwlIH0gJT4NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgcmV0WzwlPV9uQ29kZShlYSklPiArICI8JT0oZWEuRW50aXR5VHlwZT8naWQnOicnKSU+Il0gPSBmVmFsdWU7DQogICAgICAgIH0NCiAgICA8JSB9KTsgJT4NCiAgICANCiAgICAgICAgPCU9bG9nKCklPnJldCk7DQogICAgICAgIHJldHVybiByZXQ7DQogICAgfQ0KPCUgfSU+DQoNCjwlIGlmKG1haW5DbGFzcyhbJ0JJU2VydmVyJ10pKXslPg0KICAgIGFzeW5jIDwlPW1OYW1lPSdnZXQnJT4obmFtZSkgew0KICAgICAgICBpZiAoIXRoaXMuSWQpIHJldHVybiBudWxsOw0KICAgICAgICB2YXIgdCA9IG51bGw7DQogICAgICAgICQuZWFjaChuYW1lLnNwbGl0KCcuJyksIChfLCBmKSA9PiB7DQogICAgICAgICAgICB0ID0gew0KICAgICAgICAgICAgICAgIEVudGl0eU9iamVjdDogdCA/IHsNCiAgICAgICAgICAgICAgICAgICAgQWN0aXZlOiB0cnVlLA0KICAgICAgICAgICAgICAgICAgICBWYWx1ZUVudGl0aWVzOiBbdF0NCiAgICAgICAgICAgICAgICB9IDogew0KICAgICAgICAgICAgICAgICAgICBBY3RpdmU6IHRydWUsDQogICAgICAgICAgICAgICAgICAgIElkOiB0aGlzLklkDQogICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICBFbnRpdHlBdHRyaWJ1dGU6IHsNCiAgICAgICAgICAgICAgICAgICAgTmFtZTogZiwNCiAgICAgICAgICAgICAgICAgICAgT1BFUkFUT1JTOiB7DQogICAgICAgICAgICAgICAgICAgICAgICBOYW1lOiAiPSINCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH07DQogICAgICAgIH0pOw0KICAgICAgICByZXR1cm4gJC53aGVuKHRoaXMuc3IoKS5fKCJFbnRlcnByaXNlTWFuYWdlci5lbXNFbnRpdHlWYWx1ZUZpbmQiLCBudWxsLCB0KSkudGhlbihldiA9PiB7DQogICAgICAgICAgICA8JT1sb2coKSU+ZXYpOw0KICAgICAgICAgICAgaWYgKGV2ID09PSBudWxsKSByZXR1cm4gbnVsbDsNCiAgICAgICAgICAgIGlmIChldi5FbnRpdHlBdHRyaWJ1dGUuSXNTdHJpbmcpIHJldHVybiBldi5TdHJpbmdWYWx1ZTsNCiAgICAgICAgICAgIGlmIChldi5FbnRpdHlBdHRyaWJ1dGUuSXNGbG9hdCkgcmV0dXJuIGV2LkZsb2F0VmFsdWU7DQogICAgICAgICAgICBpZiAoZXYuRW50aXR5QXR0cmlidXRlLklzSW50KSByZXR1cm4gZXYuSW50VmFsdWU7DQogICAgICAgICAgICBpZiAoZXYuRW50aXR5QXR0cmlidXRlLklzTG9uZykgcmV0dXJuIGV2LkxvbmdWYWx1ZTsNCiAgICAgICAgICAgIGlmIChldi5FbnRpdHlBdHRyaWJ1dGUuSXNUZXh0KSByZXR1cm4gZXYuVGV4dFZhbHVlOw0KICAgICAgICAgICAgaWYgKGV2LkVudGl0eUF0dHJpYnV0ZS5Jc0Jvb2wpIHJldHVybiBldi5Cb29sVmFsdWU7DQoNCiAgICAgICAgICAgIGlmICghZXYuT2JqZWN0VmFsdWUpIHJldHVybiBudWxsOw0KDQogICAgICAgICAgICByZXR1cm4gbmV3IDwlPXNjb3BlJT5bJC5ncmVwKDwlPXNjb3BlJT4uRW50aXR5Q2xhc3NlcywgYyA9PiBjLklkID09IGV2LkVudGl0eUF0dHJpYnV0ZS5FbnRpdHlUeXBlaWQpWzBdLk5hbWUucmVwbGFjZSgvIC9nLCAnXycpXShldi5PYmplY3RWYWx1ZS5JZCk7DQogICAgICAgIH0pOw0KICAgIH0NCjwlIH0lPg0KDQo8JSBpZihtYWluQ2xhc3MoX3NxbFRvb2xzKSl7JT4NCiAgICA8JT1tTmFtZT0nX1EnJT4oKXsNCiAgICAgICAgbGV0IF9vID0gJyInOw0KICAgICAgICBsZXQgX3EgPSBfbzsNCg0KICAgICAgICBpZihbJ1NhbGVzRm9yY2UnXS5pbmRleE9mKHRoaXMuVG9vbC50eXBlLm5hbWUpPT0wKXsNCiAgICAgICAgICAgIF9vID0gX3EgPSAiIjsNCiAgICAgICAgfWVsc2UgaWYodGhpcy5fX2NvbmZpZygndHlwZScpPT0nbXlzcWwnIHx8IHRoaXMuVG9vbC50eXBlLm5hbWU9PSdOZW80aicpew0KICAgICAgICAgICAgX28gPSBfcSA9ICdgJzsNCiAgICAgICAgfWVsc2UgaWYoWydTYWxlc0ZvcmNlJ10uaW5kZXhPZih0aGlzLlRvb2wudHlwZS5uYW1lKT09MCl7DQogICAgICAgICAgICBfbyA9IF9xID0gYCdgOw0KICAgICAgICB9ZWxzZSBpZih0aGlzLl9fY29uZmlnKCd0eXBlJyk9PSdzcWxzZXJ2ZXInKXsNCiAgICAgICAgICAgIF9vID0gJ1snOw0KICAgICAgICAgICAgX3EgPSAnXSc7DQogICAgICAgIH1lbHNlIGlmKHRoaXMuX19jb25maWcoJ2FwaUtleScpPT0nYWlydGFibGUnKXsNCiAgICAgICAgICAgIF9vID0gJ3snOw0KICAgICAgICAgICAgX3EgPSAnfSc7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIF9vP19xOl9vOw0KICAgIH0NCiAgICANCiAgICA8JT1tTmFtZT0nX2ZpZWxkR3JvdXBzJyU+KGZncyA9IHt9KXsNCiAgICAgICAgdGhpcy5fX2ZpZWxkR3JvdXBzID0gZmdzOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICB9DQogICAgDQogICAgPCU9bU5hbWU9J19maWVsZEFnZ3JlZ2F0ZXMnJT4oZmFzID0ge30pew0KICAgICAgICB0aGlzLl9fZmllbGRBZ2dyZWdhdGVzID0gZmFzOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICB9DQogICAgDQogICAgPCU9bU5hbWU9J190b0ZpZWxkc1NRTCclPihmaWVsZHMpew0KICAgICAgICANCiAgICAgICAgZmllbGRzID0gZmllbGRzIHx8IFt0aGlzLl9fY29uZmlnKCdpZEZpZWxkJywgJ0lkJyksIDwlPWMuRW50aXR5QXR0cmlidXRlcy5maWx0ZXIoZWEgPT4gIWVhLkVudGl0eU1ldGhvZCkubWFwKGVhID0+IF9uQ29kZShlYSkgKyAoZWEuRW50aXR5VHlwZT8nKyIuaWQiJzonJykpLmpvaW4oJywnKSU+XTsNCiAgICAgICAgZmllbGRzID0gQXJyYXkuaXNBcnJheShmaWVsZHMpP2ZpZWxkczpbZmllbGRzXTsNCg0KICAgICAgICBpZih0aGlzLl9fZmllbGRHcm91cHMpew0KICAgICAgICAgICAgLy8ge2ZpZWxkOiBvcmRlcn0NCiAgICAgICAgICAgIGZpZWxkcyA9IFtdOw0KICAgIDwlIGMuRW50aXR5QXR0cmlidXRlcy5maWx0ZXIoZWEgPT4gIWVhLkVudGl0eU1ldGhvZCAmJiAhZWEuSXNUZXh0ICYmICFlYS5Jc0ltYWdlICYmICFlYS5Jc0ZpbGUpLmZvckVhY2goZWEgPT4geyAlPg0KICAgICAgICAgICAgaWYodGhpcy5fX2ZpZWxkR3JvdXBzLjwlPW5OYW1lKGVhKSU+KSBmaWVsZHMucHVzaChgJHs8JT1fbkNvZGUoZWEpJT48JT0oZWEuRW50aXR5VHlwZT8nKyJpZCInOicnKSU+fWApOw0KICAgIDwlIH0pJT4NCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gZmllbGRzOw0KICAgIH0NCiAgICANCiAgICA8JT1tTmFtZT0nX2Zyb21EQk9iamVjdCclPihyPXt9KXsNCiAgICAgICAgdHJ5ew0KICAgICAgICAgICAgcmV0dXJuIHRoaXMuX19pbXBvcnQociwgew0KICAgICAgICAgICAgICAgIElkOiBvYmogPT4gdGhpcy5JZCA9IG9ialt0aGlzLl9fY29uZmlnKCdpZEZpZWxkJywgJ0lkJyldLA0KICAgIDwlIGMuRW50aXR5QXR0cmlidXRlcy5maWx0ZXIoZWEgPT4gIWVhLkVudGl0eU1ldGhvZCkuZm9yRWFjaChlYSA9PiB7ICU+DQogICAgICAgICAgICAgICAgPCU9bk5hbWUoZWEpJT46IChvYmosIGVhQ29kZSkgPT4gew0KICAgICAgICAgICAgICAgICAgICB0aGlzLjwlPW5OYW1lKGVhKSU+KG9ialtlYUNvZGVdKTsNCiAgICAgICAgICAgICAgICB9LA0KICAgIDwlIH0pJT4NCiAgICAgICAgICAgIH0sICI8JT1tTmFtZSU+Iik7DQogICAgICAgIH1jYXRjaChleCl7DQogICAgICAgICAgICA8JT1lcnJvcigpJT5leCk7DQogICAgICAgIH0NCiAgICB9DQogICAgDQogICAgPCU9bU5hbWU9J190b1NlbGVjdEhlYWRlciclPihmaWVsZHMpew0KICAgICAgICB0cnl7DQogICAgICAgICAgICBsZXQgcmV0ID0gew0KICAgICAgICAgICAgICAgIHRhYmxlOiA8JT1fbkNvZGUoKSU+LA0KICAgICAgICAgICAgICAgIGZpZWxkczogRG90T2JqZWN0Lm9iamVjdChPYmplY3QuZnJvbUVudHJpZXModGhpcy5fdG9GaWVsZHNTUUwoZmllbGRzKS5tYXAoZiA9PiB0aGlzLl9RKCkgKyBmLnJlcGxhY2UoL1wuL2csICcnKSArIHRoaXMuX1EoKSkubWFwKGYgPT4gW2YsIGZdKSkpLA0KICAgICAgICAgICAgICAgIGpvaW5zOiB7fSwNCiAgICAgICAgICAgIH07DQogICAgICAgICAgICANCiAgICAgICAgICAgIGlmKGZpZWxkcykgcmV0dXJuIHJldDsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgcmV0LmpvaW5zID0gdGhpcy5fX2V4cG9ydCh7fSwgew0KICAgICAgICAgICAgICAgIE51bGw6IHRydWUsDQogICAgPCUgYy5FbnRpdHlBdHRyaWJ1dGVzLmZpbHRlcihlYSA9PiAhZWEuRW50aXR5TWV0aG9kICYmIGVhLkVudGl0eVR5cGUpLmZvckVhY2goZWEgPT4geyU+DQogICAgICAgICAgICAgICAgPCU9bk5hbWUoZWEpJT46IChvYmosIGVhQ29kZSwgdikgPT4gb2JqW2VhQ29kZV0gPSBuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUoZWEuRW50aXR5VHlwZSwgdHJ1ZSklPigpLjwlPW1OYW1lJT4oKSwNCiAgICA8JSB9KSU+DQogICAgICAgICAgICB9LCAiPCU9bU5hbWUlPiIpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICA8JT1sb2coKSU+cmV0KTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgcmV0dXJuIHJldDsNCiAgICAgICAgfWNhdGNoKGV4KXsNCiAgICAgICAgICAgIDwlPWVycm9yKCklPmV4KTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIDwlPW1OYW1lPSdfdG9TZWxlY3RTUUwnJT4oZmllbGRzKXsNCiAgICAgICAgdHJ5ew0KICAgICAgICAgICAgbGV0IHNxbCA9ICJzZWxlY3QgIjsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgbGV0IHRQcmVmID0gYCR7dGhpcy5fUSgpfSR7PCU9X25Db2RlKCklPn0ke3RoaXMuX1EoKX1gOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBsZXQgaGVhZGVyID0gdGhpcy5fdG9TZWxlY3RIZWFkZXIoZmllbGRzKTsNCg0KICAgICAgICAgICAgc3FsICs9IE9iamVjdC52YWx1ZXMoaGVhZGVyLmZpZWxkcykubWFwKGYgPT4gYCR7dFByZWZ9LiR7Zn1gKS5qb2luKCcsICcpOw0KICAgICAgICAgICAgT2JqZWN0LmtleXMoaGVhZGVyLmpvaW5zKS5mb3JFYWNoKGsgPT4gc3FsICs9ICIsICIgKyBPYmplY3QudmFsdWVzKGhlYWRlci5qb2luc1trXS5maWVsZHMpLm1hcChmID0+IGAke3RoaXMuX1EoKX0ke2hlYWRlci5qb2luc1trXS50YWJsZX1fJHtrfSR7dGhpcy5fUSgpfS4ke2Z9IGFzICR7dGhpcy5fUSgpfSR7a30uJHtmLnJlcGxhY2UodGhpcy5fUSgpLCAnJyl9YCkuam9pbignLCAnKSk7DQogICAgDQogICAgICAgICAgICBpZih0aGlzLl9fZmllbGRBZ2dyZWdhdGVzKXsNCiAgICAgICAgICAgICAgICAvLyB7ZmllbGQ6IGZ1bmN0aW9ufQ0KICAgIDwlIGMuRW50aXR5QXR0cmlidXRlcy5maWx0ZXIoZWEgPT4gIWVhLkVudGl0eU1ldGhvZCAmJiAhZWEuSXNUZXh0ICYmICFlYS5Jc0ltYWdlICYmICFlYS5Jc0ZpbGUpLmZvckVhY2goZWEgPT4geyAlPg0KICAgICAgICAgICAgICAgIGlmKHRoaXMuX19maWVsZEFnZ3JlZ2F0ZXMuPCU9bk5hbWUoZWEpJT4pIHNxbCArPSBgJHtzcWw9PSgnc2VsZWN0ICcpPycnOicsJ30gJHt0aGlzLl9fZmllbGRBZ2dyZWdhdGVzLjwlPW5OYW1lKGVhKSU+fSgke3RoaXMuX1EoKX0kezwlPV9uQ29kZShlYSklPn0ke3RoaXMuX1EoKX0pYDsNCiAgICA8JSB9KSU+DQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBzcWwgKz0gYCBmcm9tICR7dFByZWZ9IGA7DQogICAgICAgICAgICANCiAgICAgICAgICAgIE9iamVjdC5rZXlzKGhlYWRlci5qb2lucykuZm9yRWFjaChrID0+IHNxbCArPSBgbGVmdCBqb2luICR7dGhpcy5fUSgpfSR7aGVhZGVyLmpvaW5zW2tdLnRhYmxlfSR7dGhpcy5fUSgpfSBhcyAke3RoaXMuX1EoKX0ke2hlYWRlci5qb2luc1trXS50YWJsZX1fJHtrfSR7dGhpcy5fUSgpfSBvbiAke3RQcmVmfS4ke3RoaXMuX1EoKX0ke2t9aWQke3RoaXMuX1EoKX09JHt0aGlzLl9RKCl9JHtoZWFkZXIuam9pbnNba10udGFibGV9XyR7a30ke3RoaXMuX1EoKX0uJHt0aGlzLl9RKCl9JHt0aGlzLl9fY29uZmlnKCdpZEZpZWxkJywgJ0lkJyl9JHt0aGlzLl9RKCl9IGApOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBzcWwgKz0gYCB3aGVyZSAxPTFgOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBzcWwgPSB0aGlzLl9fZXhwb3J0KHtzcWw6IHNxbH0sIHsNCiAgICAgICAgICAgICAgICBOdWxsOiB0cnVlLA0KICAgICAgICAgICAgICAgIF9maWVsZHM6ICh0aGlzLl9fc3luY19vbigpIHx8IHRoaXMuSWQ9PXRoaXMuSWQpP1snSWQnXTp1bmRlZmluZWQsDQogICAgICAgICAgICAgICAgZXhwb3J0ZXI6IHYgPT4gew0KICAgICAgICAgICAgICAgICAgICBpZih2LnJldXNlZD4yKXsNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIDwlPXdhcm4oKSU+IlJldXNlZDogIiwgdik7DQogICAgICAgICAgICAgICAgICAgICAgICB2Lm9iai5zcWwgPSBgLypSRVNVRUQ6ICR7di5yZXVzZWR9Ki9gOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICBfVEhJUzogb2JqID0+IHsNCiAgICAgICAgICAgICAgICAgICAgaWYoIXRoaXMuX1RISVMgfHwgIXRoaXMuX1RISVMubGVuZ3RoKSByZXR1cm47DQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBvYmouc3FsICs9IGAgLyphbmQgKi8ke3RQcmVmfS4ke3RoaXMuX1EoKX0ke3RoaXMuX19jb25maWcoJ2lkRmllbGQnLCAnSWQnKX0ke3RoaXMuX1EoKX0gYCArICh0aGlzLl9USElTX2Nvb3AgfHwgIklOIikgKyAiICgiICsgdGhpcy5fVEhJUy5tYXAodCA9PiB0LjwlPW1OYW1lJT4odC5fX2NvbmZpZygnaWRGaWVsZCcpfHwnSWQnKS50aGlzKS5qb2luKCcgVU5JT04gQUxMICcpICsgIikiOw0KICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgSWQ6IChvYmosIGlkQ29kZSwgdikgPT4gb2JqLnNxbCArPSAodGhpcy5JZD09dGhpcy5JZCk/YCBhbmQgJHt0UHJlZn0uJHt0aGlzLl9RKCl9JHt0aGlzLl9fY29uZmlnKCdpZEZpZWxkJywgJ0lkJyl9JHt0aGlzLl9RKCl9PScke3RoaXMuSWR9J2A6JycsDQogICAgPCUgYy5FbnRpdHlBdHRyaWJ1dGVzLmZpbHRlcihlYSA9PiAhZWEuRW50aXR5TWV0aG9kKS5mb3JFYWNoKGVhID0+IHsgJT4NCiAgICAgICAgICAgICAgICA8JT1uTmFtZShlYSklPjogKG9iaiwgZWFDb2RlLCB2KSA9PiB7DQogICAgICAgICAgICAgICAgICAgIGlmKCF0aGlzLl88JT1uTmFtZShlYSklPl9zZXQpIHJldHVybjsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgPCUgaWYoZWEuRW50aXR5VHlwZSl7JT4NCiAgICAgICAgICAgICAgICBsZXQgY29vcCA9IHRoaXMuXzwlPW5OYW1lKGVhKSU+X2Nvb3A7DQogICAgICAgICAgICAgICAgICAgIHN3aXRjaChjb29wKXsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgIiE9IjoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb29wID0gIk5PVCBJTiI7DQogICAgICAgICAgICAgICAgICAgICAgICBjYXNlICI9IjoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb29wID0gIklOIjsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgIiI6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29vcCA9ICJJTiI7DQogICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvb3AgPSAiSU4iOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBpZih2KXsNCiAgICAgICAgICAgICAgICAgICAgICAgIG9iai5zcWwgKz0gYCBhbmQgJHt0UHJlZn0uJHt0aGlzLl9RKCl9JHtlYUNvZGV9aWQke3RoaXMuX1EoKX0gJHtjb29wfSAoJHt2LjwlPW1OYW1lJT4odi5fX2NvbmZpZygnaWRGaWVsZCcsICdJZCcpKX0pYDsNCiAgICAgICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgICAgICBvYmouc3FsICs9IGAgYW5kICgke3RQcmVmfS4ke3RoaXMuX1EoKX0ke2VhQ29kZX1pZCR7dGhpcy5fUSgpfSAke2Nvb3B9ICgwKSBPUiAke3RQcmVmfS4ke3RoaXMuX1EoKX0ke2VhQ29kZX1pZCR7dGhpcy5fUSgpfSBJUyBOVUxMKWA7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICA8JSB9ZWxzZSBpZihlYS5Jc1RleHQgfHwgZWEuSXNJbWFnZSB8fCBlYS5Jc0ZpbGUpeyU+DQogICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgPCUgfWVsc2V7JT4NCiAgICAgICAgICAgICAgICAgICAgb2JqLnNxbCArPSBgIGFuZCAke3RQcmVmfS4ke3RoaXMuX1EoKX0ke2VhQ29kZX0ke3RoaXMuX1EoKX0gYCArIDwlaWYoZWEuSXNCb29sKXslPiI9IjwlfWVsc2V7JT4odGhpcy5fPCU9bk5hbWUoZWEpJT5fY29vcCB8fCAiTElLRSIpPCV9JT4gKyAiICI7DQogICAgICAgIDwlIH0lPg0KICAgICAgICANCiAgICAgICAgPCUgaWYoZWEuSXNEYXRlKXsgJT4NCiAgICAgICAgICAgICAgICAgICAgaWYodiAmJiB2LnRvSVNPU3RyaW5nKXsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmKHRoaXMuX19jb25maWcoJ3R5cGUnKT09J3NxbGl0ZScpew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iai5zcWwgKz0gInN0cmZ0aW1lKCclcycsICciICsgdi50b0lTT1N0cmluZygpICsgIicpIjsNCiAgICAgICAgICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iai5zcWwgKz0gIiciICsgdi50b0lTT1N0cmluZygpICsgIiciOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgIDwlIH1lbHNlIGlmKGVhLklzU3RyaW5nKXsgJT4NCiAgICAgICAgICAgICAgICAgICAgaWYodHlwZW9mKHYpPT09InN0cmluZyIpew0KICAgICAgICAgICAgICAgICAgICAgICAgb2JqLnNxbCArPSAiJyIgKyAoKHRoaXMuXzwlPW5OYW1lKGVhKSU+X2Nvb3A9PSJMSUtFIiB8fCAhdGhpcy5fPCU9bk5hbWUoZWEpJT5fY29vcCk/IiUiOiIiKSArIHYgKyAoKHRoaXMuXzwlPW5OYW1lKGVhKSU+X2Nvb3A9PSJMSUtFIiB8fCAhdGhpcy5fPCU9bk5hbWUoZWEpJT5fY29vcCk/IiUiOiIiKSArICInIjsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICA8JSB9ZWxzZSBpZihlYS5Jc0Jvb2wpeyAlPg0KICAgICAgICAgICAgICAgICAgICBpZih0eXBlb2Yodik9PT0iYm9vbGVhbiIpew0KICAgICAgICAgICAgICAgICAgICAgICAgb2JqLnNxbCArPSAiJyIgKyAodj8iMSI6IjAiKSArICInIjsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICA8JSB9ICU+DQogICAgICAgICAgICAgICAgICAgIGlmKHYgJiYgdi5FbnRpdHlDbGFzcyl7DQogICAgICAgICAgICAgICAgICAgICAgICBvYmouc3FsICs9ICIoIiArIHYuPCU9bU5hbWUlPigpICsgIikiOw0KICAgICAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgICAgIG9iai5zcWwgKz0gIiciICsgdiArICInIjsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0sDQogICAgPCUgfSk7ICU+DQogICAgPCUgYy5UeXBlZEF0dHJpYnV0ZXMuZm9yRWFjaCh0YSA9PiB7IGxldCB0YU5hbWUgPSBuTmFtZSh0YSkgKyAnXycgKyB0YS5FbnRpdHlDbGFzcy5QbHVyYWwucmVwbGFjZSgvIC9nLCAnXycpOyU+DQogICAgICAgICAgICAgICAgPCU9dGFOYW1lJT46IChvYmosIGVhQ29kZSwgdikgPT4gew0KICAgICAgICAgICAgICAgICAgICBpZighdGhpcy5fPCU9dGFOYW1lJT5fc2V0KSByZXR1cm47DQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBsZXQgak9QID0gJ1VOSU9OIEFMTCc7DQogICAgICAgICAgICAgICAgICAgIGxldCBpbk9QID0gJ0lOJzsNCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIGlmKHRoaXMuXzwlPXRhTmFtZSU+X2Nvb3A9PSchPScgfHwgdGhpcy5fPCU9dGFOYW1lJT5fY29vcD09J05PVCBJTicpew0KICAgICAgICAgICAgICAgICAgICAgICAgaW5PUCA9ICdOT1QgSU4nOw0KICAgICAgICAgICAgICAgICAgICB9ZWxzZSBpZih0aGlzLl88JT10YU5hbWUlPl9jb29wPT0nPScgfHwgdGhpcy5fPCU9dGFOYW1lJT5fY29vcD09J0lOJyl7DQogICAgICAgICAgICAgICAgICAgIH1lbHNlIGlmKHRoaXMuXzwlPXRhTmFtZSU+X2Nvb3A9PSc9PScpew0KICAgICAgICAgICAgICAgICAgICAgICAgak9QID0gJ0lOVEVSU0VDVCc7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIG9iai5zcWwgKz0gYGFuZCAvKjwlPXRhTmFtZSU+Ki8gJHt0UHJlZn0uJHt0aGlzLl9RKCl9JHt0aGlzLl9fY29uZmlnKCdpZEZpZWxkJywgJ0lkJyl9JHt0aGlzLl9RKCl9ICR7aW5PUH0gKGAgKyAodiB8fCBbXSkuZmlsdGVyKHQgPT4gdCkubWFwKHQgPT4gdC48JT1tTmFtZSU+KCI8JT1uTmFtZSh0YSklPi5pZCIpKS5qb2luKGAgJHtqT1B9LypNMk0qLyBgKSArICcpJzsNCiAgICAgICAgICAgICAgICB9LA0KICAgIDwlIH0pJT4NCiAgICAgICAgICAgIH0sICI8JT1tTmFtZSU+IiwgZmllbGRzKS5zcWw7DQoNCiAgICAgICAgICAgIGlmKHRoaXMuX19maWVsZEdyb3Vwcyl7DQogICAgICAgICAgICAgICAgaWYoT2JqZWN0LmtleXModGhpcy5fX2ZpZWxkR3JvdXBzKS5sZW5ndGgpIHNxbCArPSAiIGdyb3VwIGJ5ICI7DQogICAgPCUgYy5FbnRpdHlBdHRyaWJ1dGVzLmZpbHRlcihlYSA9PiAhZWEuRW50aXR5TWV0aG9kICYmICFlYS5Jc1RleHQgJiYgIWVhLklzSW1hZ2UgJiYgIWVhLklzRmlsZSkuZm9yRWFjaChlYSA9PiB7ICU+DQogICAgICAgICAgICAgICAgaWYodGhpcy5fX2ZpZWxkR3JvdXBzLjwlPW5OYW1lKGVhKSU+KSBzcWwgKz0gYCR7dGhpcy5fUSgpfSR7PCU9X25Db2RlKGVhKSU+PCU9KGVhLkVudGl0eVR5cGU/JysiaWQiJzonJyklPn0ke3RoaXMuX1EoKX0gJHt0aGlzLl9fZmllbGRHcm91cHMuPCU9bk5hbWUoZWEpJT59YDsNCiAgICA8JSB9KSU+DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKCFzcWwuZW5kc1dpdGgoIndoZXJlIDE9MSIpKXsNCiAgICAgICAgICAgICAgICBzcWwgPSBzcWwucmVwbGFjZSgid2hlcmUgMT0xIGFuZCAiLCAid2hlcmUgIik7DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIHNxbCA9IHR5cGVvZihzcWxGb3JtYXR0ZXIpIT09J3VuZGVmaW5lZCc/c3FsRm9ybWF0dGVyLmZvcm1hdChzcWwpOnNxbDsNCiAgICAgICAgICAgIDwlPWxvZygpJT5zcWwpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICByZXR1cm4gc3FsOw0KICAgICAgICB9Y2F0Y2goZXgpew0KICAgICAgICAgICAgPCU9ZXJyb3IoKSU+ZXgpOw0KICAgICAgICB9DQogICAgfQ0KICAgIA0KICAgIDwlPW1OYW1lPSdfdG9QYXRocyclPigpew0KICAgICAgICBsZXQgcmV0ID0gdGhpcy5fX2V4cG9ydCh7fSwgew0KICAgICAgICAgICAgX1RISVM6IG9iaiA9PiB7fSwNCiAgICA8JSBjLkVudGl0eUF0dHJpYnV0ZXMuZmlsdGVyKGVhID0+ICFlYS5FbnRpdHlNZXRob2QgJiYgZWEuRW50aXR5VHlwZSkuZm9yRWFjaChlYSA9PiB7ICU+DQogICAgICAgICAgICA8JT1uTmFtZShlYSklPjogKG9iaiwgZWFDb2RlLCB2KSA9PiBvYmouPCU9bk5hbWUoZWEpJT4gPSB2LjwlPW1OYW1lJT4oKSwNCiAgICA8JSB9KTsgJT4NCiAgICA8JSBjLlR5cGVkQXR0cmlidXRlcy5mb3JFYWNoKHRhID0+IHsgbGV0IHRhTmFtZSA9IG5OYW1lKHRhKSArICdfJyArIHRhLkVudGl0eUNsYXNzLlBsdXJhbC5yZXBsYWNlKC8gL2csICdfJyk7JT4NCiAgICAgICAgICAgIDwlPXRhTmFtZSU+OiAob2JqLCBlYUNvZGUsIHYpID0+IG9iai48JT10YU5hbWUlPiA9IHYubWFwKF92ID0+IF92LjwlPW1OYW1lJT4oKSksDQogICAgPCUgfSklPg0KICAgICAgICB9LCAiPCU9bU5hbWUlPiIpOw0KICAgICAgICAvLyByZXR1cm4gcmV0Ow0KICAgICAgICByZXR1cm4gT2JqZWN0LmtleXMocmV0KS5tYXAoayA9PiAoe1trXTogcmV0W2tdfSkpOw0KICAgIH0NCg0KICAgIDwlPW1OYW1lPSdfdG9VcGRhdGVTUUwnJT4oZmllbGRzKXsNCiAgICAgICAgbGV0IHJldEZpZWxkcyA9IHRoaXMuX3RvRmllbGRzU1FMKGZpZWxkcykubWFwKGYgPT4gdGhpcy5fUSgpICsgZi5yZXBsYWNlKC9cLi9nLCAnJykgKyB0aGlzLl9RKCkpLmpvaW4oJywgJyk7DQogICAgICAgIGxldCBzcWwgPSBgdXBkYXRlICR7dGhpcy5fUSgpfSR7PCU9X25Db2RlKCklPn0ke3RoaXMuX1EoKX0gc2V0IGAgKyBPYmplY3QuZW50cmllcyh0aGlzLl90b0RCT2JqZWN0KGZpZWxkcykpLm1hcCh2ID0+IHRoaXMuX1EoKSArIHZbMF0gKyB0aGlzLl9RKCkgKyAiPSIgKyB2WzFdKSArIGAgd2hlcmUgJHt0aGlzLl9RKCl9JHt0aGlzLl9fY29uZmlnKCdpZEZpZWxkJywgJ0lkJyl9JHt0aGlzLl9RKCl9PScke3RoaXMuSWR9J2A7IC8vYCByZXR1cm5pbmcgJHtyZXRGaWVsZHN9YDsNCiAgICAgICAgPCU9bG9nKCklPnNxbCk7DQogICAgICAgIHJldHVybiBzcWw7DQogICAgfQ0KDQogICAgPCU9bU5hbWU9J190b0luc2VydFNRTCclPihmaWVsZHMpew0KICAgICAgICBsZXQgb2JqID0gdGhpcy5fdG9EQk9iamVjdChmaWVsZHMpOw0KICAgICAgICBsZXQgc3FsID0gYGluc2VydCBpbnRvICR7dGhpcy5fUSgpfSR7PCU9X25Db2RlKCklPn0ke3RoaXMuX1EoKX0gKGAgKyBPYmplY3Qua2V5cyhvYmopLm1hcChrID0+IHRoaXMuX1EoKSArIGsgKyB0aGlzLl9RKCkpICsgIikgdmFsdWVzICgiICsgT2JqZWN0LnZhbHVlcyhvYmopICsgYClgOw0KICAgICAgICA8JT1sb2coKSU+c3FsKTsNCiAgICAgICAgcmV0dXJuIHNxbDsNCiAgICB9DQo8JSB9ICU+DQogICAgDQogICAgPCU9bU5hbWU9J19jb3B5RnJvbSclPihvYmopew0KICAgICAgICBpZighb2JqKSByZXR1cm4gbnVsbDsNCiAgICAgICAgcmV0dXJuIHRoaXMuX3JldmVydChvYmopOw0KICAgIH0NCiAgICANCiAgICA8JT1tTmFtZT0nX3RvT2JqVHJlZSclPihiQ3ljbGljKXsNCiAgICAgICAgPCU9d2FybigpJT4iZGVwcmVjYXRlZCIpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgDQogICAgICAgIHRoaXMuX2RlZmF1bHRzKCk7DQoNCiAgICAgICAgcmV0dXJuIHRoaXMuX19leHBvcnQobmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKGMuTmFtZSwgdHJ1ZSklPignPCU9Yy5OYW1lJT4nKSwgew0KICAgICAgICAgICAgTnVsbDogdHJ1ZSwNCiAgICAgICAgICAgIEN5Y2xpYzogYkN5Y2xpYywNCiAgICAgICAgICAgIC8vZXhwb3J0ZXI6IHYgPT4gPCU9d2FybigpJT52LnJldXNlZCksDQogICAgPCUgYy5FbnRpdHlBdHRyaWJ1dGVzLmZpbHRlcihlYSA9PiAhZWEuRW50aXR5TWV0aG9kKS5mb3JFYWNoKGVhID0+IHslPg0KICAgICAgICAgICAgPCU9bk5hbWUoZWEpJT46IChvYmosIGVhQ29kZSwgdikgPT4gb2JqLjwlPW5OYW1lKGVhKSU+KDwlaWYoZWEuRW50aXR5VHlwZSl7JT5uZXcgPCU9c2NvcGUlPi48JT1fY05hbWUoZWEuRW50aXR5VHlwZSwgdHJ1ZSklPigpLjwlPW1OYW1lJT4oYkN5Y2xpYyk8JX1lbHNleyU+djwlfSU+KSwNCiAgICA8JSB9KTslPg0KICAgIDwlIGMuVHlwZWRBdHRyaWJ1dGVzLmZvckVhY2godGEgPT4geyBsZXQgdGFOYW1lID0gbk5hbWUodGEpICsgJ18nICsgdGEuRW50aXR5Q2xhc3MuUGx1cmFsLnJlcGxhY2UoLyAvZywgJ18nKTslPg0KICAgICAgICAgICAgPCU9dGFOYW1lJT46IChvYmosIGVhQ29kZSwgdikgPT4gb2JqLjwlPXRhTmFtZSU+KG5ldyA8JT1zY29wZSU+LjwlPV9jTmFtZSh0YS5FbnRpdHlDbGFzcywgdHJ1ZSklPigpLjwlPW1OYW1lJT4oYkN5Y2xpYykpLA0KICAgIDwlIH0pOyU+DQogICAgICAgIH0sICI8JT1tTmFtZSU+Iik7DQogICAgfQ0KICAgIA0KICAgIDwlPW1OYW1lPSdfdW5DeWNsZSclPihzb3VyY2U9dGhpcyl7DQogICAgICAgIHJldHVybiB0aGlzLl9fZXhwb3J0KHRoaXMsIHsNCiAgICAgICAgICAgIE51bGw6IHRydWUsDQogICAgPCUgYy5FbnRpdHlBdHRyaWJ1dGVzLmZpbHRlcihlYSA9PiAhZWEuRW50aXR5TWV0aG9kICYmIGVhLkVudGl0eVR5cGUpLmZvckVhY2goZWEgPT4geyU+DQogICAgICAgICAgICA8JT1uTmFtZShlYSklPjogKG9iaiwgZWFDb2RlLCB2KSA9PiBvYmouPCU9bk5hbWUoZWEpJT4oc291cmNlPT1vYmouPCU9bk5hbWUoZWEpJT4oKT9udWxsOnVuZGVmaW5lZCksDQogICAgPCUgfSk7JT4NCiAgICA8JSBjLlR5cGVkQXR0cmlidXRlcy5mb3JFYWNoKHRhID0+IHsgbGV0IHRhTmFtZSA9IG5OYW1lKHRhKSArICdfJyArIHRhLkVudGl0eUNsYXNzLlBsdXJhbC5yZXBsYWNlKC8gL2csICdfJyk7JT4NCiAgICAgICAgICAgIDwlPXRhTmFtZSU+OiAob2JqLCBlYUNvZGUsIHYpID0+IHRydWUsDQogICAgPCUgfSk7JT4NCiAgICAgICAgfSwgIjwlPW1OYW1lJT4iKTsNCiAgICB9DQogICAgDQogICAgYXN5bmMgPCU9bU5hbWU9J19zdG9yZUVudGl0eUNsYXNzJyU+KGRlcHRoKXsNCiAgICAgICAgdHJ5ew0KICAgICAgICAgICAgaWYodHlwZW9mKGRlcHRoKT09PSJ1bmRlZmluZWQiKSBkZXB0aCA9IE1hdGgubWF4KHRoaXMuX19jb25maWcoImNyZWF0ZSIpLCA8JT1jLlJhbmslPik7DQogICAgICAgICAgICBpZighZGVwdGgpIHJldHVybjsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgdGhpcy5Ub29sLjwlPW1OYW1lJT4gPSB0aGlzLlRvb2wuPCU9bU5hbWUlPiB8fCB7fTsNCiAgICAgICAgICAgIGlmKHRoaXMuVG9vbC48JT1tTmFtZSU+LjwlPW5OYW1lKGMpJT4pIHJldHVybjsNCiAgICAgICAgICAgIHRoaXMuVG9vbC48JT1tTmFtZSU+LjwlPW5OYW1lKGMpJT4gPSB0cnVlOw0KICAgICAgICAgICAgDQogICAgICAgICAgICA8JT1sb2coKSU+YHN0b3JpbmcgJyR7dGhpcy5Ub29sLnR5cGUubmFtZX0nIG1vZGVsIHdpdGggZGVwdGggJHtkZXB0aH1gKTsNCiAgICAgICAgICAgIA0KPCUgY2xzVG9vbHMoYykuZm9yRWFjaCh0ID0+IHslPg0KICAgICAgICAgICAgYXdhaXQgdGhpcy5EU0Nvbm5lY3QoKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgaWYodGhpcy5Ub29sLnR5cGUubmFtZT09IjwlPXQlPiIpew0KICAgIDwlIGlmKHQ9PSJOZW80aiIpeyU+DQogICAgICAgICAgICAgICAgbGV0IGNxbCA9IHRoaXMuX3RvQ3lUYWJsZShkZXB0aCk7DQogICAgICAgICAgICAgICAgPCU9bG9nKCklPmNxbCk7DQogICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5fbmVvNGooY3FsKTsNCiAgICA8JSB9ZWxzZSBpZih0PT0iQWlyVGFibGUiKXslPg0KICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuX2FpcnRhYmxlKCdtZXRhL2Jhc2VzJywgbnVsbCwge25hbWU6ICc8JT1zY29wZSU+Jywgd29ya3NwYWNlSWQ6IHRoaXMuVG9vbC5kYi53b3Jrc3BhY2VJZCwgdGFibGVzOiB0aGlzLl90b0FUVGFibGUoZGVwdGgpfSk7DQogICAgPCUgfWVsc2UgaWYoX3NxbFRvb2xzLmluZGV4T2YodCk+PTApeyU+DQogICAgICAgICAgICAgICAgbGV0IHNxbCA9IHRoaXMuX3RvU1FMVGFibGUoe3JldXNlZDogZGVwdGh9KS5zcWw7IDwlLypkZXB0aDogY2hhbGxlbmdlIC0gdG9vIGxvdyBkb2VzIG5vdCBjb3ZlciBhbGwgdGFibGVzLCB0b28gaGlnaCAobWF4IGRlcHRoKSByZXN1bHRzIGluIG91dC1vZi1tZW1vcnkgb24gYnJvd3NlciovJT4NCiAgICAgICAgICAgICAgICA8JT1sb2coKSU+c3FsKTsNCiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLl9zcWwoc3FsKTsNCiAgICA8JSB9ZWxzZSBpZih0PT0iU2VydmljZU5vdyIpeyU+DQogICAgICAgICAgICAgICAgLy88JT1sb2coKSU+dGhpcy5fdG9TTlRhYmxlKCkpOw0KICAgIDwlIH1lbHNlIGlmKHQ9PSJFTVMiKXslPg0KICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuX3RvRU1TQ2xhc3MoZGVwdGgpLnN0b3JlKCk7DQogICAgPCUgfWVsc2UgaWYodD09IkJJU2VydmVyIil7JT4NCiAgICAgICAgICAgICAgICAvLyBvbmx5IGRvIHRoaXMgaWYgdGhlIG1vZHVsZSBpcyBub3QgbG9hZGVkIGZyb20gDQogICAgICAgICAgICAgICAgKGF3YWl0IHRoaXMuc3IoKS5fKCJFbnRlcnByaXNlTWFuYWdlci5lbXNFbnRpdHlBdHRyaWJ1dGVGaW5kYWxsIiwgbnVsbCwgew0KICAgICAgICAgICAgICAgICAgICBBY3RpdmU6IHRydWUsDQogICAgICAgICAgICAgICAgICAgIEVudGl0eUNsYXNzOiB7DQogICAgICAgICAgICAgICAgICAgICAgICBBY3RpdmU6IHRydWUsDQogICAgICAgICAgICAgICAgICAgICAgICBDb21wYW55OiB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgQWN0aXZlOiB0cnVlLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIENvZGU6IHRoaXMuX19jb25maWcoJ2NvbXBhbnknLCAnPCU9c2NvcGUlPicpLA0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgIH0pKS5mb3JFYWNoKGVhID0+IC8qIHRyeWUgX2VhVHlwZXMgKi88JT1zY29wZSU+LkVudGl0eUF0dHJpYnV0ZXMuZm9yRWFjaChzZWEgPT4gew0KICAgICAgICAgICAgICAgICAgICBpZihzZWEuSWQhPT1lYS5JZCAmJiBzZWEuTmFtZT09ZWEuTmFtZSAmJiAoc2VhLkVudGl0eUNsYXNzLklkPT1lYS5FbnRpdHlDbGFzcy5JZCB8fCBzZWEuRW50aXR5Q2xhc3MuTmFtZT09ZWEuRW50aXR5Q2xhc3MuTmFtZSkpew0KICAgICAgICAgICAgICAgICAgICAgICAgc2VhLklkID09IGVhLklkOw0KICAgICAgICAgICAgICAgICAgICAgICAgc2VhLkVudGl0eUNsYXNzLklkID0gZWEuRW50aXR5Q2xhc3MuSWQ7DQogICAgICAgICAgICAgICAgICAgICAgICA8JT1zY29wZSU+LkVudGl0eUNsYXNzZXMuZmluZChjID0+IGMuTmFtZT09c2VhLkVudGl0eUNsYXNzLk5hbWUpLkVudGl0eUF0dHJpYnV0ZXMuZmluZChzY2VhID0+IHNjZWEuTmFtZT09ZWEuTmFtZSkuSWQgPSBlYS5JZDsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0pKTsNCiAgICA8JSB9ZWxzZSBpZih0PT0iTW9uZ29EQiIgfHwgdD09IlphbmdvREIiKXslPg0KICAgICAgICAgICAgICAgIGlmKHRoaXMuVG9vbC5kYikgYXdhaXQgdGhpcy5Ub29sLmRiLmNyZWF0ZUNvbGxlY3Rpb24oPCU9X25Db2RlKCklPiwge3ZhbGlkYXRvcjogeyRqc29uU2NoZW1hOiB0aGlzLl90b0pTT05TY2hlbWEoKX19KTsNCiAgICA8JSB9ZWxzZSBpZih0PT0iUnhEQiIpeyU+DQogICAgICAgICAgICAgICAgaWYodGhpcy5Ub29sLmRiKSBhd2FpdCB0aGlzLlRvb2wuZGIuYWRkQ29sbGVjdGlvbnMoe1s8JT1fbkNvZGUoKSU+XToge3NjaGVtYTogdGhpcy5fdG9KU09OU2NoZW1hKCl9fSk7DQogICAgPCUgfSU+DQogICAgICAgICAgICB9DQo8JSB9KSU+DQogICAgICAgIH1jYXRjaChleCl7DQogICAgICAgICAgICA8JT1lcnJvcigpJT5leCk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgfQ0KDQogICAgPCU9bU5hbWU9J19sb2cnJT4ob2JqPXRoaXMpew0KPCUgaWYobWFpbkNsYXNzKCkhPWMpeyU+DQogICAgICAgIHJldHVybiBuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUobWFpbkNsYXNzKCksIHRydWUpJT4oKS48JT1tTmFtZSU+KG9iaik7DQo8JSB9ZWxzZXslPg0KICAgICAgICB0cnl7DQogICAgICAgICAgICBpZihBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKG8gPT4gdGhpcy5fbG9nKG8pKTsNCiAgICAgICAgICAgIGlmKG9iai5FbnRpdHlDbGFzcykgb2JqID0gb2JqLl90b0pTT04oe2JNYXA6IHRydWV9KTsNCiAgICAgICAgICAgIDwlPWxvZygpJT5vYmopOw0KICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgIH1jYXRjaChleCl7DQogICAgICAgICAgICA8JT1lcnJvcigpJT5leCk7DQogICAgICAgIH0NCjwlIH0lPg0KICAgIH0NCg0KICAgIGFzeW5jIDwlPW1OYW1lPSdEU0Nvbm5lY3QnJT4odG9vbD10aGlzLlRvb2wpew0KPCUgaWYobWFpbkNsYXNzKCkhPWMpeyU+DQogICAgICAgIHJldHVybiBhd2FpdCBuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUobWFpbkNsYXNzKCksIHRydWUpJT4oKS48JT1tTmFtZSU+KHRvb2wpOw0KPCUgfWVsc2V7JT4NCiAgICAgICAgdHJ5ew0KICAgICAgICAgICAgaWYoIXRvb2wpew0KICAgICAgICAgICAgICAgIDwlPWVycm9yKCklPiJUb29sIGlzIG51bGwiLCB0aGlzLlRvb2xzLmxlbmd0aCwgPCU9c2NvcGUlPi5Ub29scy5sZW5ndGgpOw0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH1lbHNlIGlmKCF0b29sLnR5cGUpew0KICAgICAgICAgICAgICAgIDwlPWVycm9yKCklPiJUb29sLnR5cGUgaXMgbnVsbCIsIHRvb2wsIHRoaXMuVG9vbHMubGVuZ3RoLCA8JT1zY29wZSU+LlRvb2xzLmxlbmd0aCk7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfWVsc2UgaWYodHlwZW9mKHRvb2wuZGIpIT09InVuZGVmaW5lZCIpew0KICAgICAgICAgICAgICAgIDwlPWxvZygpJT4iVG9vbCBhbHJlYWR5IGNvbm5lY3RlZCEiKTsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9ZWxzZSBpZig8JT1uc2NvcGUlPi5fbm9kZSAmJiAvKjwlPW5zY29wZSU+Ll9ub2RlLl9wYXJlbnRfc2V0ICYmICovPCU9bnNjb3BlJT4uX25vZGUucGFyZW50KCkuX3NhbWVFbnRpdHkoPCU9bnNjb3BlJT4uX25vZGUucGFyZW50KCkpKXsNCiAgICAgICAgICAgICAgICA8JT1sb2coKSU+Ik5vZGUgaGFzIGEgdmFsaWQgcGFyZW50LCBubyBsb2NhbCBTUUwgcG9zc2libGUiKTsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIHRvb2wuX19kbWxTdGF0ZW1lbnRzID0gdG9vbC5fX2RtbFN0YXRlbWVudHMgfHwgW107DQo8JSBjbHNUb29scyhjKS5mb3JFYWNoKHQgPT4geyU+DQogICAgICAgICAgICA8JT1sb2coKSU+Ils8JT10JT5dOiBDb25uZWN0aW5nLi4uIik7DQoNCiAgICAgICAgICAgIGlmKHRvb2wudHlwZS5uYW1lPT0iPCU9dCU+Iil7DQogICAgPCUgaWYodD09IkVNUyIpeyU+DQogICAgPCUgfWVsc2UgaWYodD09Ik1vbmdvREIiKXslPg0KICAgICAgICAgICAgICAgIC8vPCU9bG9nKCklPnRoaXMuX19jb25maWcoJ3VyaScsIG51bGwsIHt0b29sOiB0b29sfSksIHRoaXMuX19jb25maWcoJ2NvbmZpZycsIG51bGwsIHt0b29sOiB0b29sfSkpOw0KICAgICAgICAgICAgICAgIGlmKHR5cGVvZihtb25nb2RiKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICAgICAgdG9vbC5kYiA9IChhd2FpdCBuZXcgbW9uZ29kYi5Nb25nb0NsaWVudCh0aGlzLl9fY29uZmlnKCd1cmknLCBudWxsLCB7dG9vbDogdG9vbH0pLCB0aGlzLl9fY29uZmlnKCdjb25maWcnLCBudWxsLCB7dG9vbDogdG9vbH0pKS5jb25uZWN0KCkpLmRiKHRoaXMuX19jb25maWcoJ2RhdGFiYXNlJywgIjwlPXNjb3BlJT4iLCB7dG9vbDogdG9vbH0pKTsNCiAgICAgICAgICAgICAgICB9DQogICAgPCUgfWVsc2UgaWYodD09J1J4REInKXslPg0KICAgICAgICAgICAgICAgIHRvb2wuZGIgPSBhd2FpdCBSeERCLmNyZWF0ZVJ4RGF0YWJhc2Uoe25hbWU6IHRoaXMuX19jb25maWcoJ2RhdGFiYXNlJywgIjwlPXNjb3BlJT4iLCB7dG9vbDogdG9vbH0pLCBzdG9yYWdlOiBudWxsfSk7DQogICAgPCUgfWVsc2UgaWYodD09J1phbmdvREInKXslPg0KICAgICAgICAgICAgICAgIHRvb2wuZGIgPSBuZXcgemFuZ28uRGIodGhpcy5fX2NvbmZpZygnZGF0YWJhc2UnLCAiPCU9c2NvcGUlPiIsIHt0b29sOiB0b29sfSksIHsNCiAgICAgICAgPCUgYXJDbGFzc2VzLmZvckVhY2goZWMgPT4geyU+DQogICAgICAgICAgICAgICAgICAgIDwlPW5OYW1lKGVjKSU+OiBbIjwlPWVjLkVudGl0eUF0dHJpYnV0ZXMuZmlsdGVyKGVhID0+ICFlYS5FbnRpdHlNZXRob2QpLm1hcChlYSA9PiBuTmFtZShlYSkpLmpvaW4oJ1wiLCBcIicpJT4iXSwNCiAgICAgICAgPCUgfSkgJT4NCiAgICAgICAgICAgICAgICB9KTsNCiAgICA8JX1lbHNlIGlmKHQ9PSdNZW1vcnknKXslPg0KICAgICAgICAgICAgICAgIHRvb2wuZGIgPSB7DQogICAgICAgIDwlIGFyQ2xhc3Nlcy5mb3JFYWNoKGVjID0+IHslPg0KICAgICAgICAgICAgICAgICAgICAnPCU9bk5hbWUoZWMpJT4nOiBbXSwNCiAgICAgICAgPCUgfSk7ICU+DQogICAgICAgICAgICAgICAgfTsNCiAgICA8JX1lbHNlIGlmKHQ9PSJFeGNlbCIpeyU+DQogICAgICAgICAgICAgICAgaWYodHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgICAgIDwlPXNjb3BlJT4uZGIgPSA8JT1zY29wZSU+Lnhsc3hEYXRhP1hMU1gucmVhZCg8JT1zY29wZSU+Lnhsc3hEYXRhKTpYTFNYLnV0aWxzLmJvb2tfbmV3KCk7DQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIDwlPXNjb3BlJT4uZGIgPSBYTFNYLnJlYWQoYXdhaXQgZnMucHJvbWlzZXMucmVhZEZpbGUodGhpcy5fX2NvbmZpZygnZmlsZW5hbWUnLCBudWxsLCB7dG9vbDogdG9vbH0pKSk7DQogICAgICAgICAgICAgICAgfQ0KICAgIDwlfWVsc2UgaWYodD09IlNub3dGbGFrZSIpeyU+DQogICAgICAgICAgICAgICAgaWYodHlwZW9mKGdsb2JhbCkhPT0ndW5kZWZpbmVkJyAmJiBnbG9iYWwuc25vd2ZsYWtlKXsNCiAgICAgICAgICAgICAgICAgICAgdG9vbC5kYiA9IGdsb2JhbC5zbm93Zmxha2UuY3JlYXRlQ29ubmVjdGlvbih7DQogICAgICAgICAgICAgICAgICAgICAgICBhY2NvdW50OiB0aGlzLl9fY29uZmlnKCJhY2NvdW50IiwgbnVsbCwge3Rvb2w6IHRvb2x9KSwNCiAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJuYW1lOiB0aGlzLl9fY29uZmlnKCJ1c2VybmFtZSIsIG51bGwsIHt0b29sOiB0b29sfSksDQogICAgICAgICAgICAgICAgICAgICAgICBwYXNzd29yZDogdGhpcy5fX2NvbmZpZygicGFzc3dvcmQiLCBudWxsLCB7dG9vbDogdG9vbH0pLA0KICAgICAgICAgICAgICAgICAgICAgICAgYXBwbGljYXRpb246IHRoaXMuX19jb25maWcoInNjb3BlIiwgbnVsbCwge3Rvb2w6IHRvb2x9KSB8fCAiPCU9c2NvcGUlPiIsDQogICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgICAgICBhd2FpdCBuZXcgUHJvbWlzZSgocmVzLCByZWopID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRvb2wuZGIuY29ubmVjdCgoZXJyLCBjb25uKT0+ew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlcnIpew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8JT1lcnJvcigpJT4nVW5hYmxlIHRvIGNvbm5lY3Q6ICcgKyBlcnIubWVzc2FnZSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlaihlcnIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvb2wuZGIuY29ubmVjdGlvbl9JRCA9IGNvbm4uZ2V0SWQoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzKCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgIH0NCiAgICA8JX1lbHNlIGlmKHQ9PSJOZW80aiIpeyU+DQogICAgICAgICAgICAgICAgdG9vbC5kYiA9IG5lbzRqLmRyaXZlcigNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5fX2NvbmZpZygndXJsJywgbnVsbCwge3Rvb2w6IHRvb2x9KSwNCiAgICAgICAgICAgICAgICAgICAgbmVvNGouYXV0aC5iYXNpYyh0aGlzLl9fY29uZmlnKCd1c2VybmFtZScsIG51bGwsIHt0b29sOiB0b29sfSksIHRoaXMuX19jb25maWcoJ3Bhc3N3b3JkJywgbnVsbCwge3Rvb2w6IHRvb2x9KSkNCiAgICAgICAgICAgICAgICApOw0KICAgIDwlfWVsc2UgaWYodD09IkFpclRhYmxlIil7JT4NCiAgICAgICAgICAgICAgICB0b29sLmRiID0gew0KICAgICAgICAgICAgICAgICAgICBiYXNlSWQ6ICcnLA0KICAgICAgICAgICAgICAgICAgICB3b3Jrc3BhY2VJZDogdGhpcy5fX2NvbmZpZygnd29ya3NwYWNlSWQnLCBudWxsLCB7dG9vbDogdG9vbH0pLA0KICAgICAgICAgICAgICAgICAgICBuYW1lOiAnJywNCiAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246ICcnLA0KICAgICAgICAgICAgICAgICAgICB1c2VySWQ6IChhd2FpdCB0aGlzLl9haXJ0YWJsZSgnbWV0YS93aG9hbWknKSkuaWQsDQogICAgICAgICAgICAgICAgfTsNCg0KICAgICAgICAgICAgICAgIGxldCBiYXNlcyA9IChhd2FpdCB0aGlzLl9haXJ0YWJsZSgnbWV0YS9iYXNlcycpKS5iYXNlczsNCiAgICAgICAgICAgICAgICBpZihiYXNlcy5sZW5ndGgpew0KICAgICAgICAgICAgICAgICAgICB0b29sLmRiLmJhc2VJZCA9IGJhc2VzLmZpbHRlcihiID0+IGIubmFtZT09JzwlPXNjb3BlJT4nKS5pZDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYoIXRoaXMuVG9vbC5kYi5iYXNlSWQpIHRvb2wuZGIuYmFzZUlkID0gJ2FwcCcgKyB0aGlzLl91dWlkKCkuc3BsaXQoJy0nKS5zbGljZSgtMSlbMF07DQogICAgPCV9ZWxzZSBpZih0PT0iU3FsREIiKXslPg0KICAgICAgICAgICAgICAgIGlmKHR5cGVvZihnbG9iYWwpIT09J3VuZGVmaW5lZCcgJiYgZ2xvYmFsW3RoaXMuX19jb25maWcoJ3R5cGUnLCBudWxsLCB7dG9vbDogdG9vbH0pXSl7DQogICAgICAgICAgICAgICAgICAgIGlmKGdsb2JhbFt0aGlzLl9fY29uZmlnKCd0eXBlJywgbnVsbCwge3Rvb2w6IHRvb2x9KV0uRGF0YWJhc2Upew0KICAgICAgICAgICAgICAgICAgICAgICAgdG9vbC5kYiA9IG5ldyBnbG9iYWxbdGhpcy5fX2NvbmZpZygndHlwZScsIG51bGwsIHRvb2wpXS5EYXRhYmFzZSh0aGlzLl9fY29uZmlnKCdkYXRhYmFzZScsIG51bGwsIHt0b29sOiB0b29sfSkgfHwgIi4vPCU9c2NvcGUlPi5kYiIpOw0KICAgICAgICAgICAgICAgICAgICB9ZWxzZSBpZihnbG9iYWxbdGhpcy5fX2NvbmZpZygndHlwZScsIG51bGwsIHt0b29sOiB0b29sfSldLmNyZWF0ZUNvbm5lY3Rpb24pew0KICAgICAgICAgICAgICAgICAgICAgICAgdG9vbC5kYiA9IGdsb2JhbFt0aGlzLl9fY29uZmlnKCd0eXBlJywgbnVsbCwge3Rvb2w6IHRvb2x9KV0uY3JlYXRlQ29ubmVjdGlvbih7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaG9zdDogdGhpcy5fX2NvbmZpZygnc2VydmVyJywgbnVsbCwge3Rvb2w6IHRvb2x9KSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VyOiB0aGlzLl9fY29uZmlnKCd1c2VybmFtZScsIG51bGwsIHt0b29sOiB0b29sfSksDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFzc3dvcmQ6IHRoaXMuX19jb25maWcoJ3Bhc3N3b3JkJywgbnVsbCwge3Rvb2w6IHRvb2x9KSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhYmFzZTogdGhpcy5fX2NvbmZpZygnZGF0YWJhc2UnLCBudWxsLCB7dG9vbDogdG9vbH0pIHx8ICI8JT1zY29wZSU+IiwNCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgICAgICB9ZWxzZSBpZihnbG9iYWxbdGhpcy5fX2NvbmZpZygndHlwZScsIG51bGwsIHt0b29sOiB0b29sfSldLkNsaWVudCl7DQogICAgICAgICAgICAgICAgICAgICAgICB0b29sLmRiID0gbmV3IGdsb2JhbFt0aGlzLl9fY29uZmlnKCd0eXBlJywgbnVsbCwge3Rvb2w6IHRvb2x9KV0uQ2xpZW50KHtjb25uZWN0aW9uU3RyaW5nOiB0aGlzLl9fY29uZmlnKCdjb25uc3RyJywgbnVsbCwge3Rvb2w6IHRvb2x9KX0pOw0KICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgdG9vbC5kYi5jb25uZWN0KCk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9ZWxzZSBpZih0eXBlb2YoZ2xvYmFsKT09PSd1bmRlZmluZWQnICYmIHRoaXMuX19jb25maWcoJ3R5cGUnLCBudWxsLCB7dG9vbDogdG9vbH0pPT09J3NxbGl0ZScpew0KICAgICAgICAgICAgICAgICAgICAvLyBzcWxpdGUgaW4gYnJvd3Nlcg0KICAgICAgICAgICAgICAgICAgICB0b29sLmRiID0gbmV3IFNRTC5EYXRhYmFzZSgpOw0KICAgICAgICAgICAgICAgIH0NCiAgICA8JX1lbHNlIGlmKHQ9PSJTZXJ2aWNlTm93Iil7JT4NCiAgICAgICAgICAgICAgICBpZih0eXBlb2YodG9vbC5zeXNfc2NvcGUpPT09InVuZGVmaW5lZCIpew0KICAgICAgICAgICAgICAgICAgICAvLyB0b29sLnN5c19zY29wZSA9IChhd2FpdCB0aGlzLl9yZXN0KCJzeXNfYXBwIiwge3N5c19zY29wZTogdGhpcy5fX2NvbmZpZygic2NvcGUiLCBudWxsLCB7dG9vbDogdG9vbH0pIHx8ICJnbG9iYWwifSkpWzBdLnN5c19pZDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYodHlwZW9mKHRvb2wuc3lzX3Byb3BlcnRpZXMpPT09InVuZGVmaW5lZCIpew0KICAgICAgICAgICAgICAgICAgICAvLyBsb2FkaW5nIHNvbWUgcGxhdGZvcm0gc3R1ZmYNCiAgICAgICAgICAgICAgICAgICAgdG9vbC5zeXNfcHJvcGVydGllcyA9IHt9Ow0KICAgICAgICAgICAgICAgICAgICBsZXQgY29uZGl0aW9uID0gT2JqZWN0LmtleXModG9vbC5zeXNfcHJvcGVydGllcykuZmlsdGVyKGsgPT4gIXRvb2wuc3lzX3Byb3BlcnRpZXNba10pLmpvaW4oJywnKTsNCiAgICAgICAgICAgICAgICAgICAgaWYoY29uZGl0aW9uKXsNCiAgICAgICAgICAgICAgICAgICAgICAgIChhd2FpdCB0aGlzLl9yZXN0KCJzeXNfcHJvcGVydGllcyIsIHtuYW1lOiAiSU4iK2NvbmRpdGlvbn0pKS5mb3JFYWNoKHIgPT4gdG9vbC5zeXNfcHJvcGVydGllc1tyLm5hbWVdID0gci52YWx1ZSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgPCV9JT4NCiAgICAgICAgICAgIH0NCjwlIH0pJT4NCiAgICAgICAgfWNhdGNoKGV4KXsNCiAgICAgICAgICAgIDwlPWVycm9yKCklPmV4KTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gdGhpczsNCjwlIH0lPg0KICAgIH0NCiAgICAvKiBFbmQ6IFV0aWwgZnVuY3Rpb25zICovDQogICAgDQogICAgPCU9bU5hbWU9J19tYXRjaGVzJyU+KHF1ZXJ5LCBvcHRpb25zKXsNCiAgICAgICAgdHJ5ew0KICAgICAgICAgICAgaWYoIW9wdGlvbnMpIG9wdGlvbnMgPSB7fTsNCiAgICAgICAgICAgIGlmKCFxdWVyeSB8fCAhcXVlcnkuRW50aXR5Q2xhc3MgfHwgcXVlcnkuRW50aXR5Q2xhc3MuTmFtZSE9IjwlPWMuTmFtZSU+IikgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBpZih0eXBlb2YobWljcm9kaWZmKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICBsZXQgdEhhc2ggPSB0aGlzLl90b0hhc2gobnVsbCwge25vQ29kZTogdHJ1ZSwgb25seVVuaXF1ZTogb3B0aW9ucy5vbmx5VW5pcXVlfSwgJzwlPW1OYW1lJT4nKS5fdGhpczsNCiAgICAgICAgICAgICAgICBsZXQgcUhhc2ggPSBxdWVyeS5fdG9IYXNoKG51bGwsIHtub0NvZGU6IHRydWUsIG9ubHlVbmlxdWU6IG9wdGlvbnMub25seVVuaXF1ZX0sICc8JT1tTmFtZSU+JykuX3RoaXM7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgbGV0IGRpZmYgPSBtaWNyb2RpZmYocUhhc2gsIHRIYXNoKS5maWx0ZXIoZCA9PiBkLnR5cGUhPSdDUkVBVEUnICYmIFsnT1BFUkFUT1JTJywgJ0lkJ10uaW5kZXhPZihkLnBhdGhbMF0pPDApOw0KICAgICAgICAgICAgICAgIDwlPWxvZygpJT4nW3QvcV0nLCB0SGFzaCwgcUhhc2gsIGRpZmYpOw0KICAgICAgICAgICAgICAgIGxldCByZXQgPSBkaWZmLmZpbHRlcihkID0+IGQudHlwZT09J0NIQU5HRScpLnJlZHVjZSgodiwgZCkgPT4gew0KICAgICAgICAgICAgICAgICAgICBsZXQgY29vcCA9IHF1ZXJ5WydfJyArIGQucGF0aFswXSArICdfY29vcCddIHx8ICh0eXBlb2YoZC52YWx1ZSk9PT0nc3RyaW5nJz8nTElLRSc6Jz0nKTsNCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIGxldCBvbGRWYWx1ZSA9IHR5cGVvZihkLm9sZFZhbHVlKT09PSdzdHJpbmcnP2Qub2xkVmFsdWUuc3BsaXQoJy8nKS5zbGljZSgtMSlbMF06ZC5vbGRWYWx1ZTsNCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIDwlPWxvZygpJT5kLnBhdGhbMF0sIGQub2xkVmFsdWUsIGQudmFsdWUsIGNvb3AsIG9sZFZhbHVlLCBkKTsNCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIHN3aXRjaChjb29wKXsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ0xJS0UnOiByZXR1cm4gdiAmJiAob2xkVmFsdWU9PT1udWxsIHx8IGQudmFsdWUuaW5kZXhPZihvbGRWYWx1ZSk+PTApOw0KICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnPSc6IHJldHVybiB2ICYmIChvbGRWYWx1ZT09PW51bGwgfHwgIWQudmFsdWUgfHwgZC52YWx1ZT09b2xkVmFsdWUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnIT0nOiByZXR1cm4gdiAmJiBkLnZhbHVlIT1vbGRWYWx1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJz49JzogcmV0dXJuIHYgJiYgZC52YWx1ZT49b2xkVmFsdWU7DQogICAgICAgICAgICAgICAgICAgICAgICBjYXNlICc8PSc6IHJldHVybiB2ICYmIGQudmFsdWU8PW9sZFZhbHVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnPic6IHJldHVybiB2ICYmIGQudmFsdWU+b2xkVmFsdWU7DQogICAgICAgICAgICAgICAgICAgICAgICBjYXNlICc8JzogcmV0dXJuIHYgJiYgZC52YWx1ZTxvbGRWYWx1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6IHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0sIHRydWUpOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIDwlPWxvZygpJT4nW3QvcV0nLCByZXQsIGRpZmYpOw0KICAgICAgICAgICAgICAgIHJldHVybiByZXQ7DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIGxldCBvTWF0Y2ggPSB0aGlzLl9fZXhwb3J0KHt9LCB7DQogICAgICAgICAgICAgICAgLy9GdWxsOiB0cnVlLA0KICAgICAgICAgICAgICAgIC8vTnVsbDogdHJ1ZSwNCiAgICAgICAgICAgICAgICBJZDogKG9iaiwgZWFDb2RlLCB2KSA9PiBvYmouX2lkID0gdGhpcy5JZD09cXVlcnkuSWQsDQogICAgICAgIDwlIGMuRW50aXR5QXR0cmlidXRlcy5maWx0ZXIoZWEgPT4gIWVhLkVudGl0eU1ldGhvZCkuZm9yRWFjaChlYSA9PiB7JT4NCiAgICAgICAgICAgICAgICA8JT1uTmFtZShlYSklPjogKG9iaiwgZWFDb2RlLCB2KSA9PiB7DQogICAgICAgICAgICA8JSBpZihlYS5FbnRpdHlUeXBlKXslPg0KICAgICAgICAgICAgICAgICAgICBvYmouPCU9bk5hbWUoZWEpJT4gPSB2P3YuPCU9bU5hbWUlPihxdWVyeT9xdWVyeS48JT1uTmFtZShlYSklPigpOm51bGwpOnRydWU7DQogICAgICAgICAgICA8JSB9ZWxzZXslPg0KICAgICAgICAgICAgICAgICAgICBvYmouPCU9bk5hbWUoZWEpJT4gPSB2PT1xdWVyeS48JT1uTmFtZShlYSklPigpOw0KICAgICAgICAgICAgPCUgfSU+DQogICAgICAgICAgICAgICAgICAgIGlmKA0KICAgICAgICAgICAgICAgICAgICAgICAgKHRoaXMuXzwlPW5OYW1lKGVhKSU+X3NldCAmJiAhcXVlcnkuXzwlPW5OYW1lKGVhKSU+X3NldCkgfHwNCiAgICAgICAgICAgICAgICAgICAgICAgIGZhbHNlDQogICAgICAgICAgICAgICAgICAgICkgb2JqLjwlPW5OYW1lKGVhKSU+ID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIGlmKA0KICAgICAgICAgICAgICAgICAgICAgICAgKCF0aGlzLl88JT1uTmFtZShlYSklPl9zZXQgJiYgcXVlcnkuXzwlPW5OYW1lKGVhKSU+X3NldCkgfHwNCiAgICAgICAgICAgIDwlIGlmKGVhLkVudGl0eVR5cGUpeyU+DQogICAgICAgICAgICAgICAgICAgICAgICAodGhpcy48JT1uTmFtZShlYSklPigpICYmICF0aGlzLjwlPW5OYW1lKGVhKSU+KCkuPCU9bU5hbWUlPihxdWVyeS48JT1uTmFtZShlYSklPigpKSkgfHwNCiAgICAgICAgICAgIDwlIH0lPg0KICAgICAgICAgICAgICAgICAgICAgICAgZmFsc2UNCiAgICAgICAgICAgICAgICAgICAgKSBvYmouPCU9bk5hbWUoZWEpJT4gPSBmYWxzZTsNCiAgICAgICAgICAgICAgICB9LA0KICAgICAgICA8JSB9KTsgJT4NCiAgICAgICAgPCUgYy5UeXBlZEF0dHJpYnV0ZXMuZm9yRWFjaCh0YSA9PiB7IGxldCB0YU5hbWUgPSBuTmFtZSh0YSkgKyAnXycgKyB0YS5FbnRpdHlDbGFzcy5QbHVyYWwucmVwbGFjZSgvIC9nLCAnXycpOyU+DQogICAgICAgICAgICAgICAgPCU9dGFOYW1lJT46IChvYmosIGVhQ29kZSwgdikgPT4gew0KICAgICAgICAgICAgICAgICAgICBvYmouPCU9dGFOYW1lJT4gPSB2Lm1hcChfdiA9PiBxdWVyeS48JT10YU5hbWUlPigpLmFueShxID0+IF92LjwlPW1OYW1lJT4ocSkpKTsNCiAgICAgICAgICAgICAgICB9LA0KICAgICAgICA8JSB9KSU+DQogICAgICAgICAgICB9LCAiPCU9bU5hbWUlPiIpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICA8JT1sb2coKSU+b01hdGNoKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgcmV0dXJuIE9iamVjdC5rZXlzKG9NYXRjaCkuZXZlcnkoayA9PiBvTWF0Y2hba10pOw0KICAgICAgICB9Y2F0Y2goZXgpew0KICAgICAgICAgICAgPCU9ZXJyb3IoKSU+ZXgpOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgPCU9bU5hbWU9J19tYXRjaGluZyclPihxdWVyeSl7DQogICAgICAgIHRyeXsNCiAgICAgICAgICAgIGxldCByZXQgPSBbXTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgbGV0IG1hdGNoZXMgPSB0aGlzLl9fZXhwb3J0KHt9LCB7DQogICAgICAgIDwlIGMuRW50aXR5QXR0cmlidXRlcy5maWx0ZXIoZWEgPT4gIWVhLkVudGl0eU1ldGhvZCAmJiBlYS5FbnRpdHlUeXBlKS5mb3JFYWNoKGVhID0+IHslPg0KICAgICAgICAgICAgICAgIDwlPW5OYW1lKGVhKSU+OiAob2JqLCBlYUNvZGUsIHYpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgPCU9bG9nKCklPiJGb3IgPCU9bk5hbWUoZWEpJT4iKTsNCiAgICAgICAgICAgICAgICAgICAgb2JqLjwlPW5OYW1lKGVhKSU+ID0gdj9bdi48JT1tTmFtZSU+KHF1ZXJ5KT92Om51bGxdLmNvbmNhdCh2LjwlPW1OYW1lJT4ocXVlcnkpKS5maWx0ZXIobSA9PiBtKTpbXTsNCiAgICAgICAgICAgICAgICB9LA0KICAgICAgICA8JSB9KSU+DQogICAgICAgIDwlIGMuVHlwZWRBdHRyaWJ1dGVzLmZvckVhY2godGEgPT4geyBsZXQgdGFOYW1lID0gbk5hbWUodGEpICsgJ18nICsgdGEuRW50aXR5Q2xhc3MuUGx1cmFsLnJlcGxhY2UoLyAvZywgJ18nKTslPg0KICAgICAgICAgICAgICAgIDwlPXRhTmFtZSU+OiAob2JqLCBlYUNvZGUsIHYpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgb2JqLjwlPXRhTmFtZSU+ID0gdi5tYXAoX3YgPT4gX3YuPCU9bU5hbWUlPihxdWVyeSkpLmZsYXQoKTsNCiAgICAgICAgICAgICAgICB9LA0KICAgICAgICA8JSB9KSU+DQogICAgICAgICAgICB9LCAiPCU9bU5hbWUlPiIpOw0KDQogICAgICAgICAgICA8JT1sb2coKSU+Im1hdGNoZXMiLCBtYXRjaGVzKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgcmV0ID0gWy4uLm5ldyBTZXQoT2JqZWN0LmtleXMobWF0Y2hlcykubWFwKGsgPT4gbWF0Y2hlc1trXSkuZmxhdCgpKV0uZmlsdGVyKG0gPT4gbSE9cXVlcnkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICA8JT1sb2coKSU+InJldCIsIHJldCk7DQogICAgICAgICAgICByZXR1cm4gcmV0Ow0KICAgICAgICB9Y2F0Y2goZXgpew0KICAgICAgICAgICAgPCU9ZXJyb3IoKSU+ZXgpOw0KICAgICAgICB9DQogICAgfQ0KICAgIA0KICAgIDwlPW1OYW1lPSdfZGVSZWZlcmVuY2UnJT4ocm9vdCl7DQogICAgICAgIHRyeXsNCiAgICAgICAgICAgIGlmKCFyb290KSByb290PXRoaXM7DQoNCiAgICAgICAgICAgIGlmKHJvb3QhPXRoaXMgJiYgdGhpcy5TZXRfT24pIHsNCiAgICAgICAgICAgICAgICBsZXQgbXlNYXRjaGVzID0gcm9vdC5fbWF0Y2hpbmcodGhpcyk7DQogICAgICAgICAgICAgICAgaWYoIW15TWF0Y2hlcy5sZW5ndGgpIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgICAgIDwlPWxvZygpJT4iUXVlcnkiLCBteU1hdGNoZXMubGVndGgpOw0KICAgICAgICAgICAgICAgIHJldHVybiBteU1hdGNoZXNbMF07DQogICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICB0aGlzLl9fZXhwb3J0KHt9LCB7DQogICAgICAgIDwlIGMuRW50aXR5QXR0cmlidXRlcy5maWx0ZXIoZWEgPT4gIWVhLkVudGl0eU1ldGhvZCAmJiBlYS5FbnRpdHlUeXBlKS5mb3JFYWNoKGVhID0+IHslPg0KICAgICAgICAgICAgICAgIDwlPW5OYW1lKGVhKSU+OiAob2JqLCBlYUNvZGUsIHYpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgaWYodil7DQogICAgICAgICAgICAgICAgICAgICAgICBsZXQgcmV0ID0gdi48JT1tTmFtZSU+KHJvb3QpOw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYocmV0IT12KSB0aGlzLjwlPW5OYW1lKGVhKSU+KHJldCk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9LA0KICAgICAgICA8JSB9KTsgJT4NCiAgICAgICAgDQogICAgICAgIDwlIGMuVHlwZWRBdHRyaWJ1dGVzLmZvckVhY2godGEgPT4geyBsZXQgdGFOYW1lID0gbk5hbWUodGEpICsgJ18nICsgdGEuRW50aXR5Q2xhc3MuUGx1cmFsLnJlcGxhY2UoLyAvZywgJ18nKTslPg0KICAgICAgICAgICAgICAgIDwlPXRhTmFtZSU+OiAob2JqLCBlYUNvZGUsIHYpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgdi5maWx0ZXIodGEgPT4gdGEpLmZvckVhY2goKHRhLCBpKSA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICBsZXQgcmV0ID0gdGEuPCU9bU5hbWUlPihyb290KTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmKHJldCE9dGEpIHRoaXMuPCU9dGFOYW1lJT4oKVtpXSA9IHJldDsNCiAgICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgfSwNCiAgICAgICAgPCUgfSklPg0KICAgICAgICAgICAgfSwgIjwlPW1OYW1lJT4iKTsNCg0KICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgIH1jYXRjaChleCl7DQogICAgICAgICAgICA8JT1lcnJvcigpJT5leCk7DQogICAgICAgIH0NCiAgICB9DQogICAgDQogICAgPCU9bU5hbWU9J19mcm9tRG9jdW1lbnQnJT4ob2JqLCBiVG9vbCl7DQogICAgICAgIGlmKCFvYmopIHJldHVybiB0aGlzOw0KICAgICAgICBpZihvYmouPCU9bU5hbWUlPikgcmV0dXJuIG9iajsNCiAgICAgICAgDQogICAgICAgIGlmKHR5cGVvZihvYmopPT09J3N0cmluZycpew0KICAgICAgICAgICAgdHJ5ew0KICAgICAgICAgICAgICAgIGlmKG9iai5tYXRjaCgvXlswLTlhLWZdezh9WzAtOWEtZl17NH1bMC05YS1mXXs0fVswLTlhLWZdezR9WzAtOWEtZl17MTJ9JC9nKSl7DQogICAgICAgICAgICAgICAgICAgIG9iaiA9IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIFt0aGlzLl9fY29uZmlnKCdpZEZpZWxkJywgJ0lkJywge3Rvb2w6IG9iai5fX3Rvb2x9KV06IG9iag0KICAgICAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZnJvbVN0cmluZyhvYmopOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH1jYXRjaChleCl7DQogICAgICAgICAgICAgICAgPCU9d2FybigpJT4iSW52YWxpZCBzdHJpbmcgKG5hbWUsIEpTT04gb3IgVVVJRCkiLCBvYmopOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9ZWxzZSBpZihBcnJheS5pc0FycmF5KG9iaikpew0KICAgICAgICAgICAgcmV0dXJuIG9iai5tYXAobyA9PiB0aGlzLjwlPW1OYW1lJT4obywgYlRvb2wpKTsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgaWYob2JqLl9fdG9vbCkgdGhpcy5Ub29sID0gb2JqLl9fdG9vbDsNCiAgICAgICAgDQogICAgICAgIGlmKCFPYmplY3Qua2V5cyhvYmopLmZpbHRlcihrID0+IHR5cGVvZihvYmpba10pIT09J3VuZGVmaW5lZCcgJiYgb2JqW2tdIT09bnVsbCkubGVuZ3RoKXsNCiAgICAgICAgICAgIDwlPWxvZygpJT4iRW1wdHkgb2JqZWN0IG9yIG9iamVjdCBvZiBudWxscyIsIG9iaik7DQogICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgfQ0KDQogICAgICAgIDwlPWxvZygpJT5vYmopOw0KICAgICAgICByZXR1cm4gdGhpcy5fX2ltcG9ydChvYmosIHsNCiAgICAgICAgICAgIF9tYXA6IGJUb29sLA0KICAgICAgICAgICAgaW1wb3J0ZXI6IHYgPT4gdi5vYmogPSAodi5vYmomJnYub2JqLlNldF9Db3VudDx0aGlzLlNldF9Db3VudCk/dGhpczp2Lm9iaiwNCiAgICAgICAgICAgIF9USElTOiBvYmogPT4gdGhpcy5USElTKG9iai5USElTLCBvYmouT1BFUkFUT1JTP29iai5PUEVSQVRPUlMuVEhJUzp1bmRlZmluZWQpLA0KICAgICAgICAgICAgSWQ6IChvYmosIGlkQ29kZSkgPT4gew0KICAgICAgICAgICAgICAgIGlmKGlkQ29kZT09J0lkJykgaWRDb2RlID0gdGhpcy5fX2NvbmZpZygnaWRGaWVsZCcsICdJZCcpOw0KICAgICAgICAgICAgICAgIGlmKG9ialtpZENvZGVdKSB0aGlzLklkID0gb2JqW2lkQ29kZV07DQogICAgICAgICAgICB9LA0KICAgIDwlIGMuRW50aXR5QXR0cmlidXRlcy5maWx0ZXIoZWEgPT4gIWVhLkVudGl0eU1ldGhvZCkuZm9yRWFjaChlYSA9PiB7ICU+DQogICAgICAgICAgICA8JT1uTmFtZShlYSklPjogKG9iaiwgZWFDb2RlKSA9PiB7DQogICAgICAgICAgICAgICAgaWYob2JqLk9QRVJBVE9SUyAmJiBvYmouT1BFUkFUT1JTW2VhQ29kZV0pew0KICAgICAgICAgICAgICAgICAgICB0aGlzLl88JT1uTmFtZShlYSklPl9jb29wID0gb2JqLk9QRVJBVE9SU1tlYUNvZGVdOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICBsZXQgcmVmID0gb2JqW2VhQ29kZV07DQogICAgICAgICAgICAgICAgaWYodHlwZW9mKHJlZik9PT0ndW5kZWZpbmVkJykgcmV0dXJuOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgPCUgaWYoZWEuRW50aXR5VHlwZSl7ICU+DQogICAgICAgICAgICAgICAgPCUgaWYoIWVhLklzQXJyYXkpeyAlPg0KICAgICAgICAgICAgICAgIGlmKHRoaXMuVG9vbC50eXBlLm5hbWU9PSJSZXN0REJJTyIpIHJlZiA9IHJlZlswXTsNCiAgICAgICAgICAgICAgICBpZighcmVmKSByZXR1cm47DQogICAgICAgICAgICAgICAgPCUgfSAlPg0KDQogICAgICAgICAgICAgICAgdGhpcy48JT1uTmFtZShlYSklPigodGhpcy48JT1uTmFtZShlYSklPigpIHx8IG5ldyA8JT1zY29wZSU+LjwlPV9jTmFtZShlYS5FbnRpdHlUeXBlLCB0cnVlKSU+KCkpLjwlPW1OYW1lJT4ocmVmLCBiVG9vbCkpOw0KICAgICAgICAgICAgPCUgfWVsc2UgaWYoZWEuSXNEYXRlKXsgJT4NCiAgICAgICAgICAgICAgICBpZih0aGlzLlRvb2wudHlwZS5uYW1lPT0iU3FsREIiKXsNCiAgICAgICAgICAgICAgICAgICAgaWYodHlwZW9mKG1vbWVudCkhPT0idW5kZWZpbmVkIiAmJiB0eXBlb2YodGhpcy5Ub29sLnN5c19wcm9wZXJ0aWVzKSE9PSJ1bmRlZmluZWQiKXsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJlZiA9IG1vbWVudC5wYXJzZVpvbmUocmVmLCB0aGlzLlRvb2wuc3lzX3Byb3BlcnRpZXNbImdsaWRlLnN5cy5kYXRlX2Zvcm1hdCJdICsgIiAiICsgdGhpcy5Ub29sLnN5c19wcm9wZXJ0aWVzWyJnbGlkZS5zeXMudGltZV9mb3JtYXQiXSwgdGhpcy5Ub29sLnN5c19wcm9wZXJ0aWVzWyJnbGlkZS5zeXMuZGVmYXVsdC50eiJdKS50b0RhdGUoKTsNCiAgICAgICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgICAgICByZWYgPSBuZXcgRGF0ZShyZWYpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIGlmKHR5cGVvZihyZWYpPT09J3N0cmluZycpew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYocmVmLmluZGV4T2YoJ1QnKT4wKXsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWYgPSBEYXRlLnBhcnNlKHJlZik7DQogICAgICAgICAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWYgPSBEYXRlLnBhcnNlKHJlZiArICIgR01UIik7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgcmVmID0gbmV3IERhdGUocmVmKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgdGhpcy48JT1uTmFtZShlYSklPihyZWYpOw0KICAgICAgICAgICAgPCUgfWVsc2UgaWYoZWEuSXNUZXh0KXslPg0KICAgICAgICAgICAgICAgIHRoaXMuPCU9bk5hbWUoZWEpJT4oKDwlPV9iNjR0ZXN0KCdyZWYnKSU+KT90aGlzLl9hdG9iKHJlZik6KHJlZiB8fCAnJykpOw0KICAgICAgICAgICAgPCUgfWVsc2V7ICU+DQogICAgICAgICAgICAgICAgdGhpcy48JT1uTmFtZShlYSklPihyZWYpOw0KICAgICAgICAgICAgPCUgfSAlPg0KICAgICAgICAgICAgfSwNCiAgICA8JSB9KTsgJT4NCiAgICA8JSBjLlR5cGVkQXR0cmlidXRlcy5mb3JFYWNoKHRhID0+IHsgbGV0IHRhTmFtZSA9IG5OYW1lKHRhKSArICdfJyArIHRhLkVudGl0eUNsYXNzLlBsdXJhbC5yZXBsYWNlKC8gL2csICdfJyk7JT4NCiAgICAgICAgICAgIDwlPXRhTmFtZSU+OiAob2JqLCBlYUNvZGUpID0+IG9ialtlYUNvZGVdP3RoaXMuPCU9dGFOYW1lJT4ob2JqW2VhQ29kZV0ubWFwKF92ID0+IG5ldyA8JT1zY29wZSU+LjwlPW5OYW1lKHRhLkVudGl0eUNsYXNzLCB0cnVlKSU+KCkuPCU9bU5hbWUlPihfdiwgYlRvb2wpKSwgb2JqLk9QRVJBVE9SUz9vYmouT1BFUkFUT1JTW2VhQ29kZV06dW5kZWZpbmVkLCB0cnVlKTp1bmRlZmluZWQsDQogICAgPCUgfSklPg0KICAgICAgICB9LCAiPCU9bU5hbWUlPiIpOw0KICAgIH0NCiAgICANCjwlIGlmKHRydWUgfHwgX2NOYW1lKCdFdmVudCcpKXslPg0KICAgIDwlPW1OYW1lPSdfdG9Qcm90byclPihvcHRpb25zPXt9LCBzUGF0aCl7DQogICAgICAgIHRyeXsNCiAgICAgICAgICAgIGxldCByZXQgPSB0aGlzLl9fZXhwb3J0KHtJZDogPCU9X25Db2RlKCklPiwgcHJvdG86IGBcblxubWVzc2FnZSAkezwlPV9uQ29kZSgpJT59IHtgLCBpbmRleDogMX0sIHsNCiAgICAgICAgICAgICAgICBfbWFwOiBvcHRpb25zLmJNYXAsDQogICAgICAgICAgICAgICAgRnVsbDogdHJ1ZSwNCiAgICAgICAgICAgICAgICBOdWxsOiB0cnVlLA0KICAgICAgICAgICAgICAgIGV4cG9ydGVyOiB2ID0+IHYub2JqPSh2LnJldXNlZD4xKT97cHJvdG86IGBcblxuLy8gcmV1c2VkWyR7di5yZXVzZWR9XTogJHs8JT1fbkNvZGUoKSU+fVxuXG5gfTp2Lm9iaiwNCiAgICAgICAgICAgICAgICBfVEhJUzogKG9iaiwgZWFDb2RlLCB2KSA9PiBvYmoucHJvdG8gKz0gYFxuXHRyZXBlYXRlZCAkezwlPV9uQ29kZSgpJT59ICR7ZWFDb2RlfSA9ICR7b2JqLmluZGV4Kyt9O2AsDQogICAgICAgICAgICAgICAgSWQ6IChvYmosIGlkQ29kZSwgdikgPT4gb2JqLnByb3RvICs9IGBcblx0c3RyaW5nICR7aWRDb2RlfSA9ICR7b2JqLmluZGV4Kyt9O2AsDQogICAgPCUgYy5FbnRpdHlBdHRyaWJ1dGVzLmZpbHRlcihlYSA9PiAhZWEuRW50aXR5TWV0aG9kKS5mb3JFYWNoKGVhID0+IHsgJT4NCiAgICAgICAgICAgICAgICA8JT1uTmFtZShlYSklPjogKG9iaiwgZWFDb2RlLCB2KSA9PiB7DQogICAgICAgIDwlIGlmKGVhLkVudGl0eVR5cGUpeyU+DQogICAgICAgICAgICAgICAgICAgIG9iai5wcm90byArPSBgXG5cdGAgKyBuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUoZWEuRW50aXR5VHlwZSwgdHJ1ZSklPigpLjwlPW1OYW1lJT4ob3B0aW9ucywgYCR7c1BhdGh9LiR7ZWFDb2RlfWApOw0KICAgICAgICA8JSB9JT4NCiAgICAgICAgICAgICAgICAgICAgb2JqLnByb3RvICs9IGBcblx0YDsNCiAgICAgICAgPCUgaWYoZmFsc2UgJiYgZWEuUmVxdWlyZWQpeyU+DQogICAgICAgICAgICAgICAgICAgIGlmKDwldmFsdWVPZihlYS5SZXF1aXJlZCklPikgb2JqLnByb3RvICs9ICdyZXF1aXJlZCAnOw0KICAgICAgICA8JSB9JT4NCiAgICAgICAgPCUgaWYoZWEuSXNBcnJheSl7JT4NCiAgICAgICAgICAgICAgICAgICAgb2JqLnByb3RvICs9ICdyZXBlYXRlZCAnOw0KICAgICAgICA8JSB9JT4NCiAgICAgICAgPCUgaWYoZWEuSXNTdHJpbmcgfHwgZWEuSXNUZXh0KXslPg0KICAgICAgICAgICAgICAgICAgICBvYmoucHJvdG8gKz0gInN0cmluZyI7DQogICAgICAgIDwlIH1lbHNlIGlmKGVhLklzQm9vbCl7JT4NCiAgICAgICAgICAgICAgICAgICAgb2JqLnByb3RvICs9ICJib29sIjsNCiAgICAgICAgPCUgfWVsc2UgaWYoZWEuSXNJbnQpeyU+DQogICAgICAgICAgICAgICAgICAgIG9iai5wcm90byArPSAiaW50MzIiOw0KICAgICAgICA8JSB9ZWxzZSBpZihlYS5Jc0xvbmcpeyU+DQogICAgICAgICAgICAgICAgICAgIG9iai5wcm90byArPSAiaW50NjQiOw0KICAgICAgICA8JSB9ZWxzZSBpZihlYS5Jc0Zsb3QpeyU+DQogICAgICAgICAgICAgICAgICAgIG9iai5wcm90byArPSAiZmxvYXQiOw0KICAgICAgICA8JSB9ZWxzZSBpZihlYS5Jc0RvdWJsZSl7JT4NCiAgICAgICAgICAgICAgICAgICAgb2JqLnByb3RvICs9ICJkb3VibGUiOw0KICAgICAgICA8JSB9ZWxzZSBpZihlYS5Jc0RhdGUpeyU+DQogICAgICAgICAgICAgICAgICAgIG9iai5wcm90byArPSAic3RyaW5nIjsNCiAgICAgICAgPCUgfWVsc2UgaWYoZWEuRW50aXR5VHlwZSl7JT4NCiAgICAgICAgICAgICAgICAgICAgb2JqLnByb3RvICs9IDwlPV9uQ29kZShlYS5FbnRpdHlUeXBlKSU+Ow0KICAgICAgICA8JSB9JT4NCiAgICAgICAgICAgICAgICAgICAgb2JqLnByb3RvICs9IGAgJHtlYUNvZGV9ID0gJHtvYmouaW5kZXgrK307YDsNCiAgICAgICAgICAgICAgICB9LA0KICAgIDwlIH0pJT4NCg0KICAgIDwlIGMuVHlwZWRBdHRyaWJ1dGVzLmZpbHRlcih0YSA9PiAhdGEuRW50aXR5TWV0aG9kKS5mb3JFYWNoKHRhID0+IHtsZXQgdGFOYW1lID0gbk5hbWUodGEpICsgJ18nICsgdGEuRW50aXR5Q2xhc3MuUGx1cmFsLnJlcGxhY2UoLyAvZywgJ18nKTslPg0KICAgICAgICAgICAgICAgIDwlPXRhTmFtZSU+OiAob2JqLCBlYUNvZGUsIHYpID0+IG9iai5wcm90byArPSBgXG5cdGAgKyBuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUodGEuRW50aXR5Q2xhc3MsIHRydWUpJT4oKS48JT1tTmFtZSU+KG9wdGlvbnMsIGAke3NQYXRofS4ke2VhQ29kZX1bXWApICsgYFxuXHRyZXBlYXRlZCAkezwlPV9uQ29kZSh0YS5FbnRpdHlDbGFzcyklPn0gJHtlYUNvZGV9ID0gJHtvYmouaW5kZXgrK307YCwNCiAgICA8JSB9KSU+DQogICAgPCUgYy5FbnRpdHlGaWVsZHMuZm9yRWFjaChlZiA9PiB7JT4NCiAgICAgICAgICAgICAgICBlZl88JT1uTmFtZShlZiklPjogKG9iaiwgZWZDb2RlLCB2KSA9PiBvYmoucHJvdG8gKz0gYFxuXHRzdHJpbmcgJHtlZkNvZGV9ID0gJHtvYmouaW5kZXgrK307YCwNCiAgICA8JSB9KSU+DQogICAgICAgICAgICAgICAgX19jbG9zZTogb2JqID0+IG9iai5wcm90byArPSAnXG59XG5cbicsDQoNCiAgICAgICAgICAgICAgICBfX3NlcnZpY2U6IG9iaiA9PiBvYmoucHJvdG8gKz0gYHNlcnZpY2UgPCU9bk5hbWUoYyklPlNlcnZpY2Uge2ANCiAgICA8JSBjLkVudGl0eU1ldGhvZHMuZmlsdGVyKG0gPT4gIW0uSXNQcml2YXRlKS5mb3JFYWNoKG0gPT4geyU+DQogICAgICAgICAgICAgICAgICAgICsgYFxuXHRycGMgPCU9bk5hbWUobSklPig8JT1uTmFtZShjKSU+XzwlPW5OYW1lKG0pJT5fUmVxdWVzdCkgcmV0dXJucyg8JT1uTmFtZShjKSU+XzwlPW5OYW1lKG0pJT5fUmVzcG9uc2UpO2ANCiAgICA8JSB9KSU+DQogICAgICAgICAgICAgICAgKyBgXG59YCwNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3JlcXVlc3Q6IG9iaiA9PiBvYmoucHJvdG8gKz0gYGANCiAgICA8JSBjLkVudGl0eU1ldGhvZHMuZmlsdGVyKG0gPT4gIW0uSXNQcml2YXRlKS5mb3JFYWNoKG0gPT4geyU+DQogICAgICAgICAgICAgICAgICAgICsgYFxubWVzc2FnZSA8JT1uTmFtZShjKSU+XzwlPW5OYW1lKG0pJT5fUmVxdWVzdCB7YA0KICAgICAgICA8JSBtLk1ldGhvZFBhcmFtZXRlcnMuZm9yRWFjaCgocCwgcEluZGV4KSA9PiB7JT4NCiAgICAgICAgICAgICAgICAgICAgKyBgXG5cdFx0YA0KICAgICAgICA8JSBpZihwLklzU3RyaW5nIHx8IHAuSXNUZXh0KXslPg0KICAgICAgICAgICAgICAgICAgICArIGBzdHJpbmdgDQogICAgICAgIDwlIH1lbHNlIGlmKHAuSXNCb29sKXslPg0KICAgICAgICAgICAgICAgICAgICArIGBib29sYA0KICAgICAgICA8JSB9ZWxzZSBpZihwLklzSW50KXslPg0KICAgICAgICAgICAgICAgICAgICArIGBpbnQzMmANCiAgICAgICAgPCUgfWVsc2UgaWYocC5Jc0xvbmcpeyU+DQogICAgICAgICAgICAgICAgICAgICsgYGludDY0YA0KICAgICAgICA8JSB9ZWxzZSBpZihwLklzRmxvdCl7JT4NCiAgICAgICAgICAgICAgICAgICAgKyBgZmxvYXRgDQogICAgICAgIDwlIH1lbHNlIGlmKHAuSXNEb3VibGUpeyU+DQogICAgICAgICAgICAgICAgICAgICsgYGRvdWJsZWANCiAgICAgICAgPCUgfWVsc2UgaWYocC5Jc0RhdGUpeyU+DQogICAgICAgICAgICAgICAgICAgICsgYHN0cmluZ2ANCiAgICAgICAgPCUgfWVsc2UgaWYocC5FbnRpdHlUeXBlKXslPg0KICAgICAgICAgICAgICAgICAgICArIGAkezwlPV9uQ29kZShwLkVudGl0eVR5cGUpJT59YA0KICAgICAgICA8JSB9JT4NCiAgICAgICAgICAgICAgICAgICAgKyBgIDwlPW5OYW1lKHApJT4gPSA8JT1wSW5kZXgrMSU+O2ANCiAgICAgICAgPCUgfSklPg0KICAgICAgICAgICAgICAgICAgICArIGBcbn1gDQogICAgPCUgfSklPg0KICAgICAgICAgICAgICAgICAgICAsDQoNCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlOiBvYmogPT4gb2JqLnByb3RvICs9IGBgDQogICAgPCUgYy5FbnRpdHlNZXRob2RzLmZpbHRlcihtID0+ICFtLklzUHJpdmF0ZSkuZm9yRWFjaChtID0+IHslPg0KICAgICAgICAgICAgICAgICAgICArIGBcbm1lc3NhZ2UgPCU9bk5hbWUoYyklPl88JT1uTmFtZShtKSU+X1Jlc3BvbnNlIHtgDQogICAgICAgICAgICAgICAgICAgICsgYFxuXHRcdGANCiAgICAgICAgPCUgaWYobS5SZXNwb25zZUF0dHJpYnV0ZS5Jc1N0cmluZyB8fCBtLlJlc3BvbnNlQXR0cmlidXRlLklzVGV4dCl7JT4NCiAgICAgICAgICAgICAgICAgICAgKyBgc3RyaW5nYA0KICAgICAgICA8JSB9ZWxzZSBpZihtLlJlc3BvbnNlQXR0cmlidXRlLklzQm9vbCl7JT4NCiAgICAgICAgICAgICAgICAgICAgKyBgYm9vbGANCiAgICAgICAgPCUgfWVsc2UgaWYobS5SZXNwb25zZUF0dHJpYnV0ZS5Jc0ludCl7JT4NCiAgICAgICAgICAgICAgICAgICAgKyBgaW50MzJgDQogICAgICAgIDwlIH1lbHNlIGlmKG0uUmVzcG9uc2VBdHRyaWJ1dGUuSXNMb25nKXslPg0KICAgICAgICAgICAgICAgICAgICArIGBpbnQ2NGANCiAgICAgICAgPCUgfWVsc2UgaWYobS5SZXNwb25zZUF0dHJpYnV0ZS5Jc0Zsb3QpeyU+DQogICAgICAgICAgICAgICAgICAgICsgYGZsb2F0YA0KICAgICAgICA8JSB9ZWxzZSBpZihtLlJlc3BvbnNlQXR0cmlidXRlLklzRG91YmxlKXslPg0KICAgICAgICAgICAgICAgICAgICArIGBkb3VibGVgDQogICAgICAgIDwlIH1lbHNlIGlmKG0uUmVzcG9uc2VBdHRyaWJ1dGUuSXNEYXRlKXslPg0KICAgICAgICAgICAgICAgICAgICArIGBzdHJpbmdgDQogICAgICAgIDwlIH1lbHNlIGlmKG0uUmVzcG9uc2VBdHRyaWJ1dGUuRW50aXR5VHlwZSl7JT4NCiAgICAgICAgICAgICAgICAgICAgKyBgJHs8JT1fbkNvZGUobS5SZXNwb25zZUF0dHJpYnV0ZS5FbnRpdHlUeXBlKSU+fWANCiAgICAgICAgPCUgfWVsc2V7JT4NCiAgICAgICAgICAgICAgICAgICAgKyBgc3RyaW5nYA0KICAgICAgICA8JSB9JT4NCiAgICAgICAgICAgICAgICAgICAgKyBgIDwlPW5OYW1lKG0uUmVzcG9uc2VBdHRyaWJ1dGUpJT4gPSAxO2ANCg0KICAgICAgICAgICAgICAgICAgICArIGBcbn1gDQogICAgPCUgfSklPg0KICAgICAgICAgICAgICAgICAgICAsDQogICAgICAgICAgICB9LCAiPCU9bU5hbWUlPiIsIG9wdGlvbnMsIHNQYXRoKS5wcm90bzsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgaWYocmV0ICYmICFzUGF0aCl7DQogICAgICAgICAgICAgICAgcmV0ID0gYHN5bnRheCA9ICJwcm90bzMiO1xuXG5wYWNrYWdlIDwlPXNjb3BlJT47XG5cbmAgKyByZXQ7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gcmV0Ow0KICAgICAgICB9Y2F0Y2goZXgpew0KICAgICAgICAgICAgPCU9ZXJyb3IoKSU+ZXgpOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgPCU9bU5hbWU9J190b0F2cm8nJT4ob3B0aW9ucz17fSwgc1BhdGgpew0KICAgICAgICB0cnl7DQogICAgICAgICAgICBsZXQgcmV0ID0gdGhpcy5fX2V4cG9ydCh7SWQ6IDwlPV9uQ29kZSgpJT4sIGF2cm86IHt0eXBlOiAicmVjb3JkIiwgbmFtZTogPCU9X25Db2RlKCklPiwgbmFtZXNwY2U6ICI8JT1hbGlhcygpJT4iLCBkb2M6IGA8JT1jLlJlbWFyayU+YCwgZmllbGRzOiBbXX19LCB7DQogICAgICAgICAgICAgICAgX21hcDogb3B0aW9ucy5iTWFwLA0KICAgICAgICAgICAgICAgIEZ1bGw6IHRydWUsDQogICAgICAgICAgICAgICAgTnVsbDogdHJ1ZSwNCiAgICAgICAgICAgICAgICBleHBvcnRlcjogdiA9PiB2Lm9iaiA9ICh2LnJldXNlZD4xKT92Lm9iajp7SWQ6IHYub2JqLklkLCBhdnJvOiBgJHs8JT1fbkNvZGUoKSU+fWB9LA0KICAgICAgICAgICAgICAgIC8vX1RISVM6IChvYmosIGVhQ29kZSwgdikgPT4gb2JqLmF2cm8gKz0gYFxuXHRyZXBlYXRlZCAkezwlPV9uQ29kZShjKSU+fSAke2VhQ29kZX0gPSAke29iai5pbmRleCsrfTtgLA0KICAgICAgICAgICAgICAgIElkOiAob2JqLCBpZENvZGUsIHYpID0+IG9iai5hdnJvLmZpZWxkcy5wdXNoKHt0eXBlOiAnbG9uZycsIG5hbWU6IGlkQ29kZX0pLA0KICAgIDwlIGMuRW50aXR5QXR0cmlidXRlcy5maWx0ZXIoZWEgPT4gIWVhLkVudGl0eU1ldGhvZCkuZm9yRWFjaChlYSA9PiB7ICU+DQogICAgICAgICAgICAgICAgPCU9bk5hbWUoZWEpJT46IChvYmosIGVhQ29kZSwgdikgPT4gew0KICAgICAgICAgICAgICAgICAgICBsZXQgZmllbGQgPSB7bmFtZTogZWFDb2RlLCBkb2M6IGA8JT1lYS5SZW1hcmslPmAsIHR5cGU6IFtudWxsLCAibnVsbCJdfTsNCiAgICAgICAgPCUgaWYoZWEuRW50aXR5VHlwZSl7JT4NCiAgICAgICAgICAgICAgICAgICAgZmllbGQudHlwZVswXSA9IG5ldyA8JT1zY29wZSU+LjwlPV9jTmFtZShlYS5FbnRpdHlUeXBlLCB0cnVlKSU+KCkuPCU9bU5hbWUlPihvcHRpb25zLCBgJHtzUGF0aH0uJHtlYUNvZGV9YCk7DQogICAgICAgIDwlIH1lbHNlIGlmKGVhLklzU3RyaW5nIHx8IGVhLklzVGV4dCl7JT4NCiAgICAgICAgICAgICAgICAgICAgZmllbGQudHlwZVswXSA9ICJzdHJpbmciOw0KICAgICAgICA8JSB9ZWxzZSBpZihlYS5Jc0Jvb2wpeyU+DQogICAgICAgICAgICAgICAgICAgIGZpZWxkLnR5cGVbMF0gPSAiYm9vbGVhbiI7DQogICAgICAgIDwlIH1lbHNlIGlmKGVhLklzSW50KXslPg0KICAgICAgICAgICAgICAgICAgICBmaWVsZC50eXBlWzBdID0gImludCI7DQogICAgICAgIDwlIH1lbHNlIGlmKGVhLklzTG9uZyl7JT4NCiAgICAgICAgICAgICAgICAgICAgZmllbGQudHlwZVswXSA9ICJsb25nIjsNCiAgICAgICAgPCUgfWVsc2UgaWYoZWEuSXNGbG90KXslPg0KICAgICAgICAgICAgICAgICAgICBmaWVsZC50eXBlWzBdID0gImZsb2F0IjsNCiAgICAgICAgPCUgfWVsc2UgaWYoZWEuSXNEb3VibGUpeyU+DQogICAgICAgICAgICAgICAgICAgIGZpZWxkLnR5cGVbMF0gPSAiZG91YmxlIjsNCiAgICAgICAgPCUgfWVsc2UgaWYoZWEuSXNEYXRlKXslPg0KICAgICAgICAgICAgICAgICAgICBmaWVsZC50eXBlWzBdID0ge3R5cGU6ICJpbnQiLCBsb2dpY2FsVHlwZTogInRpbWVzdGFtcC1taWxsaXMifTsNCiAgICAgICAgPCUgfSU+DQoNCiAgICAgICAgICAgICAgICAgICAgaWYoPCV2YWx1ZU9mKGVhLlJlcXVpcmVkKSU+KSBmaWVsZC50eXBlID0gZmllbGQudHlwZVswXTsNCg0KICAgICAgICA8JSBpZihlYS5Jc0FycmF5KXslPg0KICAgICAgICAgICAgICAgICAgICBmaWVsZC50eXBlID0ge3R5cGU6ICJhcnJheSIsIGl0ZW1zOiBmaWVsZC50eXBlfTsNCiAgICAgICAgPCUgfSU+DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBvYmouYXZyby5maWVsZHMucHVzaChmaWVsZCk7DQogICAgICAgICAgICAgICAgfSwNCiAgICA8JSB9KSU+DQogICAgPCUgYy5UeXBlZEF0dHJpYnV0ZXMuZmlsdGVyKHRhID0+ICF0YS5FbnRpdHlNZXRob2QpLmZvckVhY2godGEgPT4ge2xldCB0YU5hbWUgPSBuTmFtZSh0YSkgKyAnXycgKyB0YS5FbnRpdHlDbGFzcy5QbHVyYWwucmVwbGFjZSgvIC9nLCAnXycpOyU+DQogICAgICAgICAgICAgICAgLy88JT10YU5hbWUlPjogKG9iaiwgZWFDb2RlLCB2KSA9PiBvYmouYXZyby5maWVsZHMucHVzaCh7dHlwZTogImFycmF5IiwgbmFtZTogZWFDb2RlLCBpdGVtczogbmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKHRhLkVudGl0eUNsYXNzLCB0cnVlKSU+KCkuPCU9bU5hbWUlPihvcHRpb25zLCBgJHtzUGF0aH0uJHtlYUNvZGV9W11gKX0pLA0KICAgIDwlIH0pJT4NCiAgICA8JSBjLkVudGl0eUZpZWxkcy5mb3JFYWNoKGVmID0+IHslPg0KICAgICAgICAgICAgICAgIC8vZWZfPCU9bk5hbWUoZWYpJT46IChvYmosIGVmQ29kZSwgdikgPT4gb2JqLmF2cm8uZmllbGRzLnB1c2goKSwNCiAgICA8JSB9KSU+DQogICAgICAgICAgICB9LCAiPCU9bU5hbWUlPiIsIG9wdGlvbnMsIHNQYXRoKS5hdnJvOw0KICAgICAgICAgICAgDQogICAgICAgICAgICByZXR1cm4gcmV0Ow0KICAgICAgICB9Y2F0Y2goZXgpew0KICAgICAgICAgICAgPCU9ZXJyb3IoKSU+ZXgpOw0KICAgICAgICB9DQogICAgfQ0KPCV9JT4NCg0KICAgIDwlPW1OYW1lPSdfZnJvbVN0cmluZyclPihzdHIsIHNQYXRoPSIiKXsNCiAgICAgICAgaWYodHlwZW9mKHN0cikhPT0nc3RyaW5nJyl7DQogICAgICAgICAgICA8JT13YXJuKCklPiJzdHIgbm90IGEgc3RyaW5nIiwgc3RyLCBzUGF0aCk7DQogICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgIGlmKCFzUGF0aCl7DQogICAgICAgICAgICB0cnl7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChKU09OLnBhcnNlKHRoaXMuX2F0b2Ioc3RyKSkpOw0KICAgICAgICAgICAgfWNhdGNoKGV4KXsNCiAgICAgICAgICAgICAgICAvLyBub3QgYSBiYXNlNjQgSlNPTiwgcHJvY2VlZA0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgdHJ5ew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoSlNPTi5wYXJzZShzdHIpKTsNCiAgICAgICAgICAgIH1jYXRjaChleCl7DQogICAgICAgICAgICAgICAgLy8gbm90IGEgSlNPTiwgcHJvY2VlZA0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgdHJ5ew0KICAgICAgICAgICAgcmV0dXJuIHRoaXMuX19pbXBvcnQoe25hbWU6IHN0cn0sIHsNCiAgICAgICAgICAgICAgICBVbmlxdWU6IHRydWUsDQogICAgPCUgYy5FbnRpdHlBdHRyaWJ1dGVzLmZpbHRlcihlYSA9PiAhZWEuRW50aXR5TWV0aG9kICYmICFlYS5FbnRpdHlUeXBlKS5mb3JFYWNoKGVhID0+IHsgJT4NCiAgICAgICAgICAgICAgICA8JT1uTmFtZShlYSklPjogKG9iaiwgZWFDb2RlKSA9PiB7DQogICAgICAgICAgICAgICAgICAgIGxldCB2ID0gb2JqLm5hbWUuc3BsaXQoJ19fJylbMF07DQogICAgICAgICAgICAgICAgICAgIG9iai5uYW1lID0gb2JqLm5hbWUuc3BsaXQoJ19fJykuc2xpY2UoMSkuam9pbignX18nKTsNCiAgICAgICAgICAgICAgICAgICAgPCU9bG9nKCklPmVhQ29kZSwgdiwgb2JqLm5hbWUsIHNQYXRoKTsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy48JT1uTmFtZShlYSklPih2LCAnPScpOw0KICAgICAgICAgICAgICAgIH0sDQogICAgPCUgfSklPg0KICAgIDwlIGMuRW50aXR5QXR0cmlidXRlcy5maWx0ZXIoZWEgPT4gIWVhLkVudGl0eU1ldGhvZCAmJiBlYS5FbnRpdHlUeXBlKS5mb3JFYWNoKGVhID0+IHsgJT4NCiAgICAgICAgICAgICAgICA8JT1uTmFtZShlYSklPjogKG9iaiwgZWFDb2RlKSA9PiB7DQogICAgICAgICAgICAgICAgICAgIDwlPWxvZygpJT5lYUNvZGUsIG9iai5uYW1lLnNsaWNlKDEsIC0xKSwgc1BhdGgpOw0KICAgICAgICAgICAgICAgICAgICBpZihvYmoubmFtZT09J251bGwnIHx8ICFvYmoubmFtZSkgcmV0dXJuOw0KICAgICAgICAgICAgICAgICAgICB0aGlzLjwlPW5OYW1lKGVhKSU+KG5ldyA8JT1zY29wZSU+LjwlPV9jTmFtZShlYS5FbnRpdHlUeXBlLCB0cnVlKSU+KCkuPCU9bU5hbWUlPihvYmoubmFtZS5zbGljZSgxLCAtMSksIGAke3NQYXRofS4ke2VhQ29kZX1gKSk7DQogICAgICAgICAgICAgICAgfSwNCiAgICA8JSB9KSU+DQogICAgICAgICAgICB9LCAiPCU9bU5hbWUlPiIsIHN0ciwgc1BhdGgpOw0KICAgICAgICB9Y2F0Y2goZXgpew0KICAgICAgICAgICAgPCU9ZXJyb3IoKSU+ZXgpOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgPCU9bU5hbWU9J190b1N0cmluZyclPihzUGF0aD0iIil7DQogICAgICAgIHRyeXsNCiAgICAgICAgICAgIGxldCBmTmFtZSA9IHRoaXMuX19leHBvcnQoW10sIHsNCiAgICAgICAgICAgICAgICBOdWxsOiB0cnVlLA0KICAgICAgICAgICAgICAgIFVuaXF1ZTogdHJ1ZSwNCgk8JSBjLkVudGl0eUF0dHJpYnV0ZXMuZmlsdGVyKGVhID0+ICFlYS5FbnRpdHlNZXRob2QpLmZvckVhY2goZWEgPT4geyU+DQogICAgICAgICAgICAgICAgPCU9bk5hbWUoZWEpJT46IChvYmosIGVhQ29kZSwgdikgPT4gb2JqLnB1c2godj92PCVpZihlYS5FbnRpdHlUeXBlKXslPi48JT1tTmFtZSU+KGAke3NQYXRofS4ke2VhQ29kZX1gKTwlfSU+OidudWxsJyksDQoJPCUgfSklPg0KCSAgICAgICAgfSwgIjwlPW1OYW1lJT4iKS5qb2luKCdfXycpOw0KCSAgICAgICAgDQoJICAgICAgICBpZihzUGF0aCl7DQogICAgICAgICAgICAgICAgZk5hbWUgPSAnWycgKyBmTmFtZSArICddJzsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcmV0dXJuIGZOYW1lOw0KICAgICAgICB9Y2F0Y2goZXgpew0KICAgICAgICAgICAgPCU9ZXJyb3IoKSU+ZXgpOw0KICAgICAgICB9DQogICAgfQ0KICAgIA0KDQogICAgPCU9bU5hbWU9J2dldCBfVG9TdHJpbmcnJT4oKXsgPCUgLypCYWNrd2FyZCBjb21wYXRpYmlsaXR5IHdpdGggQklTZXJ2ZXIgKi8gJT4NCiAgICAgICAgcmV0dXJuIHRoaXMuX3RvU3RyaW5nKCk7DQogICAgfQ0KICAgIA0KICAgIGFzeW5jIDwlPW1OYW1lPSdfdG9UYWJ1bGFyJyU+KCl7DQogICAgICAgIHJldHVybiB7DQoJCQluYW1lOiAiPCU9Yy5OYW1lJT4iLA0KCQkJY29sdW1uczogWw0KCTwlIGMuRW50aXR5QXR0cmlidXRlcy5maWx0ZXIoZWEgPT4gIWVhLkVudGl0eU1ldGhvZCkuZm9yRWFjaChlYSA9PiB7JT4NCgkgICAgICAgICAgICB7DQoJCQkJICAgIG5hbWU6ICI8JT1uTmFtZShlYSklPiIsDQoJCQkJICAgIC8vZmlsdGVyQnV0dG9uOiB0cnVlDQoJCQkgICAgfSwNCiAgICA8JSB9KSU+XSwNCiAgICAgICAgICAgIHJvd3M6IChhd2FpdCB0aGlzLmZpbmRBbGwoKSkubWFwKHIgPT4gci5fdG9KU09OKHtwYXJzZTogdHJ1ZSwgdG9TdHJpbmc6IHRydWV9KSkubWFwKHIgPT4gKFsNCgk8JSBjLkVudGl0eUF0dHJpYnV0ZXMuZmlsdGVyKGVhID0+ICFlYS5FbnRpdHlNZXRob2QpLmZvckVhY2goZWEgPT4geyU+DQoJICAgIHIuPCU9bk5hbWUoZWEpJT4sDQogICAgPCUgfSklPl0pKSwNCiAgICAgICAgfTsNCiAgICB9DQoNCiAgICA8JT1tTmFtZT0nX3RvSlNPTiclPihvcHRpb25zPXt9LCBzUGF0aCl7DQogICAgICAgIHRyeXsNCiAgICAgICAgICAgIHNQYXRoID0gc1BhdGggfHwgIiI7DQogICAgICAgICAgICBsZXQgcmV0ID0ge307DQogICAgICAgICAgICByZXQuX19rZXlzID0gW107IC8vISENCiAgICAgICAgICAgIA0KICAgICAgICAgICAgaWYoIW9wdGlvbnMuYk1hcCl7DQogICAgICAgICAgICAgICAgcmV0Ll9fZ2VuZXJhdGVkID0gJyInICsgbmV3IERhdGUoKS50b0lTT1N0cmluZygpICsgJyInOw0KICAgICAgICAgICAgICAgIGlmKHRoaXMuVG9vbC5uYW1lKXsNCiAgICAgICAgICAgICAgICAgICAgcmV0Ll9fdG9vbCA9IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IHRoaXMuVG9vbC5uYW1lLA0KICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IHRoaXMuVG9vbC50eXBlLm5hbWUsDQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgICAgIHJldC5fX2NsYXNzID0gJyI8JT1uTmFtZShjKSU+Iic7DQogICAgICAgICAgICAgICAgICAgIHJldC5fX3R5cGUgPSAnIicrPCU9X25Db2RlKCklPisnIic7DQogICAgICAgICAgICAgICAgICAgIC8vcmV0Ll9fcGF0aCA9ICciJytzUGF0aCsnIic7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmKDwlPW5zY29wZSU+Ll9ub2RlKXsNCiAgICAgICAgICAgICAgICAgICAgcmV0Ll9fbm9kZSA9IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvZGU6IDwlPW5zY29wZSU+Ll9ub2RlLmNvZGUoKQ0KICAgICAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHRoaXMuX2RlZmF1bHRzKCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIGxldCB0ck1hcCA9IChvYmosIGVhQ29kZSwgdiwgc1BhdGgpID0+ICh2ICYmIHR5cGVvZih2KT09PSdzdHJpbmcnICYmIHYucmVwbGFjZSk/di5yZXBsYWNlKC88PFtePj5dKz4+L2dtLCBtID0+IHsNCiAgICAgICAgICAgICAgICA8JT1zY29wZSU+Ll9fdHJNYXAgPSA8JT1zY29wZSU+Ll9fdHJNYXAgfHwgW107DQoNCiAgICAgICAgICAgICAgICBsZXQgdHJpZCA9IHRoaXMuX3V1aWQoKTsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICBsZXQgcFBhdGggPSAnLicrKHNQYXRoLnNwbGl0KCcuJykuc2xpY2UoMSwgLTEpLmpvaW4oJy4nKSk7DQogICAgICAgICAgICAgICAgaWYocFBhdGg9PSIuIikgcFBhdGggPSAiIjsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICBsZXQgdHIgPSBtLnJlcGxhY2UoJzw8JywgJycpLnJlcGxhY2UoJz4+JywgJycpLnJlcGxhY2UoL3t7bnJ9fS9nbSwgJyRub3QoJGV4aXN0cyhfX3JldXNlZCkpJykucmVwbGFjZSgve3t2Zn19L2csIG9ialtlYUNvZGVdKTsNCiAgICAgICAgICAgICAgICBpZih0ci5zdGFydHNXaXRoKCdzKCcpICYmIHRyLmVuZHNXaXRoKCcpJykpew0KICAgICAgICAgICAgICAgICAgICB0ciA9IHRyLnJlcGxhY2UoL3t7X199fS9nbSwgJ29KU09OJytzUGF0aCkucmVwbGFjZSgve3twcGF0aH19L2dtLCAnb0pTT04nK3BQYXRoKTsNCiAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgdHIgPSB0ci5yZXBsYWNlKC97e19ffX0vZ20sIGAqKltJZD0ke29iai5JZH1dWzBdYCk7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgLy8gPCU9d2FybigpJT5lYUNvZGUsIHRyaWQsIHRyKTsNCg0KICAgICAgICAgICAgICAgIHRyID0gdGhpcy5fYnRvYSh0cik7DQogICAgICAgICAgICAgICAgbGV0IG1hcCA9IDwlPXNjb3BlJT4uX190ck1hcC5maW5kKG8gPT4gby50cmFuc2Zvcm09PXRyKTsNCiAgICAgICAgICAgICAgICByZXR1cm4gKG1hcD9tYXAuaWQ6PCU9c2NvcGUlPi5fX3RyTWFwWzwlPXNjb3BlJT4uX190ck1hcC5wdXNoKHtpZDogdHJpZCwgdHJhbnNmb3JtOiB0cn0pLTFdLmlkKTsNCiAgICAgICAgICAgIH0pOnY7DQogICAgICAgICAgICANCiAgICAgICAgICAgIHJldCA9IHRoaXMuX19leHBvcnQocmV0LCB7DQogICAgICAgICAgICAgICAgX21hcDogb3B0aW9ucy5iTWFwLA0KICAgICAgICAgICAgICAgIEZ1bGw6IG9wdGlvbnMuYkZ1bGwsDQogICAgICAgICAgICAgICAgTnVsbDogb3B0aW9ucy5iTnVsbCwNCiAgICAgICAgICAgICAgICBleHBvcnRlcjogdiA9PiB7DQogICAgICAgICAgICAgICAgICAgIGlmKHR5cGVvZihvcHRpb25zLnJldXNlZCk9PT0ndW5kZWZpbmVkJyB8fCBvcHRpb25zLnJldXNlZD49di5yZXVzZWQpIHJldHVybjsNCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIGlmKHYgJiYgdi5vYmogJiYgdHlwZW9mKHYub2JqLl9yZXR1cm4pPT09J3N0cmluZycgJiYgdi5vYmouX3JldHVybi5pbmRleE9mKCdfX3JldXNlZDogMScpPjApIHJldHVybjsNCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIGxldCBvSGFzaCA9IG9wdGlvbnMuYkhhc2g/W3RoaXMuX3RvSGFzaChudWxsLCB7bm9Db2RlOiB0cnVlLCBvbmx5VW5pcXVlOiB0cnVlLCBub0FyZ3M6IHRydWUsIF9tYXA6IG9wdGlvbnMuYk1hcCwgbm9UeXBlczogZmFsc2V9LCAiPCU9bU5hbWUlPiIpXTpPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihrID0+IGs9PSdJZCcgfHwgay5pbmRleE9mKCdfXycpPT0wKS5tYXAoayA9PiB7dHJ5e3JldHVybiB7IFtrXTogSlNPTi5wYXJzZShyZXRba10pIH07IH1jYXRjaChleCl7cmV0dXJuIHtba106IHJldFtrXX07IH0gfSk7DQogICAgICAgICAgICAgICAgICAgIGxldCBlUmV0ID0gT2JqZWN0LmFzc2lnbiguLi5vSGFzaCwge19fcmV1c2VkOiB2LnJldXNlZH0gKTsNCiAgICAgICAgICAgICAgICAgICAgaWYoQXJyYXkuaXNBcnJheShlUmV0Ll9fa2V5cykpIGVSZXQuX19rZXlzLmZvckVhY2goZWsgPT4ge3RyeXsgZVJldFtla10gPSBKU09OLnBhcnNlKHJldFtla10pO31jYXRjaChleCl7ZVJldFtla10gPSByZXRbZWtdOyB9IH0pOw0KDQogICAgICAgICAgICAgICAgICAgIHYub2JqID0ge19yZXR1cm46IEpTT04uc3RyaW5naWZ5KGVSZXQpfTsNCiAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgIF9USElTOiAob2JqLCBlYUNvZGUsIHYpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgaWYob3B0aW9ucy5iTWFwKSByZXR1cm47DQogICAgICAgICAgICAgICAgICAgIG9iai5USElTID0gdGhpcy5fVEhJUy5tYXAodCA9PiB0LjwlPW1OYW1lJT4ob3B0aW9ucywgYCR7c1BhdGh9LiR7ZWFDb2RlfWApKTsNCiAgICAgICAgICAgICAgICAgICAgb2JqLk9QRVJBVE9SUyA9IG9iai5PUEVSQVRPUlMgfHwge307DQogICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICBJZDogKG9iaiwgaWRDb2RlLCB2KSA9PiBvYmpbaWRDb2RlXSA9IGAiJHt2fSJgLA0KICAgIDwlIGMuRW50aXR5QXR0cmlidXRlcy5maWx0ZXIoZWEgPT4gIWVhLkVudGl0eU1ldGhvZCkuZm9yRWFjaChlYSA9PiB7ICU+DQogICAgICAgICAgICAgICAgPCU9bk5hbWUoZWEpJT46IChvYmosIGVhQ29kZSwgdikgPT4gew0KICAgICAgICA8JSBpZihlYS5Jc1VuaXF1ZSl7JT4NCiAgICAgICAgICAgICAgICAgICAgaWYob2JqLl9fa2V5cykgb2JqLl9fa2V5cy5wdXNoKGVhQ29kZSk7DQogICAgICAgIDwlIH0lPg0KICAgICAgICANCiAgICAgICAgPCUgaWYoZWEuSXNUZXh0KXslPg0KICAgICAgICAgICAgICAgICAgICBpZighPCU9X2I2NHRlc3QoJ3YnKSU+KXsgLy8gaXMgbm90IGJhc2U2ND8NCiAgICAgICAgICAgICAgICAgICAgICAgIHYgPSB0aGlzLl9idG9hKHYpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgIDwlIH1lbHNlIGlmKGVhLklzRGF0ZSl7JT4NCiAgICAgICAgICAgICAgICAgICAgdiA9IHYmJnYudG9JU09TdHJpbmc/di50b0lTT1N0cmluZygpOnY7DQogICAgICAgIDwlIH0lPg0KICAgICAgICANCiAgICAgICAgPCUgaWYoZWEuRW50aXR5VHlwZSl7JT4NCiAgICAgICAgICAgICAgICAgICAgb2JqW2VhQ29kZV0gPSB2PyhvcHRpb25zLl90b1N0cmluZz8oJyInICsgdi5fdG9TdHJpbmcoKSsnIicpOnYuPCU9bU5hbWUlPihvcHRpb25zLCBgJHtzUGF0aH0uJHtlYUNvZGV9YCkpOidudWxsJzsNCiAgICAgICAgPCUgfWVsc2UgaWYoZWEuSXNCb29sIHx8IGVhLklzSW50IHx8IGVhLklzTG9uZyB8fCBlYS5Jc0Zsb2F0IHx8IGVhLklzRG91YmxlKXslPg0KICAgICAgICAgICAgICAgICAgICBvYmpbZWFDb2RlXSA9IHRyTWFwKG9iaiwgZWFDb2RlLCB2LCBzUGF0aCkgfHwgJ251bGwnOw0KICAgICAgICA8JSB9ZWxzZXslPg0KICAgICAgICAgICAgICAgICAgICBvYmpbZWFDb2RlXSA9ICciJyArIHRyTWFwKG9iaiwgZWFDb2RlLCB2LCBzUGF0aCkgKyAnIic7DQogICAgICAgIDwlIH0lPg0KICAgICAgICAgICAgICAgIH0sDQogICAgPCUgfSklPg0KICAgIDwlIGMuVHlwZWRBdHRyaWJ1dGVzLmZpbHRlcih0YSA9PiAhdGEuRW50aXR5TWV0aG9kKS5mb3JFYWNoKHRhID0+IHtsZXQgdGFOYW1lID0gbk5hbWUodGEpICsgJ18nICsgdGEuRW50aXR5Q2xhc3MuUGx1cmFsLnJlcGxhY2UoLyAvZywgJ18nKTslPg0KICAgICAgICAgICAgICAgIDwlPXRhTmFtZSU+OiAob2JqLCBlYUNvZGUsIHYpID0+IG9ialtlYUNvZGVdID0gJ1snICsgKHYgfHwgW10pLm1hcCgoX3YsIF9pKSA9PiBfdi48JT1tTmFtZSU+KG9wdGlvbnMsIGAke3NQYXRofS4ke2VhQ29kZX1bJHtfaX1dYCkpLmZpbHRlcihfdiA9PiBfdikuam9pbigpICsgJ10nLA0KICAgIDwlIH0pJT4NCiAgICA8JSBjLkVudGl0eUZpZWxkcy5mb3JFYWNoKGVmID0+IHslPg0KICAgICAgICAgICAgICAgIGVmXzwlPW5OYW1lKGVmKSU+OiAob2JqLCBlZkNvZGUsIHYpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgaWYoQXJyYXkuaXNBcnJheSh2KSl7DQogICAgICAgICAgICAgICAgICAgICAgICBvYmpbZWZDb2RlXSA9IEpTT04uc3RyaW5naWZ5KHYpOw0KICAgICAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgICAgIHYgPSB0ck1hcChvYmosIGVmQ29kZSwgdiwgc1BhdGgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYodHlwZW9mKHYpPT09J3VuZGVmaW5lZCcpIHJldHVybjsNCiAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICA8JSBpZihlZi5Jc1RleHQpeyU+DQogICAgICAgICAgICAgICAgICAgICAgICBpZighPCU9X2I2NHRlc3QoJ3YnKSU+KXsgLy8gaXMgbm90IGJhc2U2ND8NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2ID0gdGhpcy5fYnRvYSh2KTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgPCUgfWVsc2UgaWYoZWYuSXNEYXRlKXslPg0KICAgICAgICAgICAgICAgICAgICAgICAgdiA9IHYmJnYudG9JU09TdHJpbmc/di50b0lTT1N0cmluZygpOnY7DQogICAgICAgIDwlIH0lPg0KDQogICAgICAgICAgICAgICAgICAgICAgICBvYmpbZWZDb2RlXSA9IHY7DQogICAgICAgIDwlIGlmKCFlZi5Jc0Jvb2wgJiYgIWVmLklzSW50ICYmICFlZi5Jc0xvbmcgJiYgIWVmLklzRmxvYXQgJiYgIWVmLklzRG91YmxlKXslPg0KICAgICAgICAgICAgICAgICAgICAgICAgb2JqW2VmQ29kZV0gPSAnIicgKyBvYmpbZWZDb2RlXSArICciJzsNCiAgICAgICAgPCUgfSU+DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9LA0KICAgIDwlIH0pJT4NCg0KICAgICAgICAgICAgICAgIF9fdHJNYXA6IG9iaiA9PiB7DQogICAgICAgICAgICAgICAgICAgIGlmKCFzUGF0aCl7DQogICAgICAgICAgICAgICAgICAgICAgICBvYmouX190ck1hcCA9IDwlPXNjb3BlJT4uX190ck1hcCB8fCBbXTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSA8JT1zY29wZSU+Ll9fdHJNYXA7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9LA0KDQogICAgICAgICAgICAgICAgX3JldHVybjogb2JqID0+IHsNCiAgICAgICAgICAgICAgICAgICAgaWYob2JqKSBvYmouX3JldHVybiA9IChPYmplY3Qua2V5cyhvYmp8fHt9KS5sZW5ndGgpPygneycgKyBPYmplY3Qua2V5cyhvYmopLmZpbHRlcihrID0+IHR5cGVvZihvYmpba10pPT09InN0cmluZyIpLm1hcChrID0+IGAiJHtrfSI6ICR7b2JqW2tdfWApLmNvbmNhdChPYmplY3Qua2V5cyhvYmopLmZpbHRlcihrID0+IHR5cGVvZihvYmpba10pIT09InN0cmluZyIpLm1hcChrID0+IGAiJHtrfSI6ICR7SlNPTi5zdHJpbmdpZnkob2JqW2tdKX1gKSkuam9pbigpICsgJ30nKTonbnVsbCc7DQogICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIH0sICI8JT1tTmFtZSU+Iiwgb3B0aW9ucywgc1BhdGgpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICByZXQgPSByZXQ/cmV0Ll9yZXR1cm46cmV0Ow0KICAgICAgICAgICAgcmV0ID0gdHlwZW9mKHJldCk9PT0ndW5kZWZpbmVkJz9udWxsOnJldDsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgaWYoIXNQYXRoICYmIHJldCl7DQogICAgICAgICAgICAgICAgcmV0ID0gdGhpcy5fYmVhdXRpZnkocmV0LCAnamF2YXNjcmlwdCcpOw0KICAgICAgICAgICAgICAgIDwlPWxvZygpJT5yZXQpOw0KICAgICAgICAgICAgICAgIGlmKG9wdGlvbnMucGFyc2UpIHJldHVybiBKU09OLnBhcnNlKHJldCk7DQogICAgICAgICAgICAgICAgaWYob3B0aW9ucy5nemlwKSByZXR1cm4gdGhpcy5VdGY4QXJyYXlUb1N0cih0aGlzLl9jb21wcmVzcyhyZXQpKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgcmV0dXJuIHJldDsNCiAgICAgICAgfWNhdGNoKGV4KXsNCiAgICAgICAgICAgIDwlPWVycm9yKCklPmV4KTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIGFzeW5jIDwlPW1OYW1lPSdfdG9Eb2N1bWVudCclPihvcHRpb25zPXt9KXsNCiAgICAgICAgdHJ5ew0KICAgICAgICAgICAgbGV0IGpzb24gPSB0aGlzLl90b0pTT04ob3B0aW9ucyk7DQogICAgICAgICAgICBsZXQgb0pTT04gPSBKU09OLnBhcnNlKGpzb24pOw0KICAgICAgICAgICAgbGV0IHRyTWFwID0gb0pTT04uX190ck1hcCB8fCBbXTsNCiAgICAgICAgICAgIGRlbGV0ZSBvSlNPTi5fX3RyTWFwOw0KICAgICAgICAgICAganNvbiA9IEpTT04uc3RyaW5naWZ5KG9KU09OKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgbGV0IGxvZyA9ICguLi5zKSA9PiA8JT1sb2coKSU+Li4ucyk7DQogICAgICAgICAgICBsZXQgd2FybiA9ICguLi5zKSA9PiA8JT13YXJuKCklPi4uLnMpOw0KICAgICAgICAgICAgbGV0IGVycm9yID0gKC4uLnMpID0+IDwlPWVycm9yKCklPi4uLnMpOw0KDQogICAgICAgICAgICBmb3IgYXdhaXQgKGNvbnN0IHQgb2YgdHJNYXApew0KICAgICAgICAgICAgICAgIGlmKCFuZXcgUmVnRXhwKHQuaWQpLnRlc3QoanNvbikpIGNvbnRpbnVlOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIGxldCB0cm4gPSB0aGlzLl9hdG9iKHQudHJhbnNmb3JtKTsNCiAgICAgICAgICAgICAgICB0cnl7DQogICAgICAgICAgICAgICAgICAgIG9KU09OID0gSlNPTi5wYXJzZShqc29uKTsNCiAgICAgICAgICAgICAgICAgICAgbGV0IHJlcyA9IHVuZGVmaW5lZDsNCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIGlmKHRybi5zdGFydHNXaXRoKCJzKCIpICYmIHRybi5lbmRzV2l0aCgiKSIpKXsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJlcyA9IGF3YWl0IHRoaXMucnVuU2NyaXB0KGAob0pTT04sIG9TY29wZSwgbG9nLCB3YXJuLCBlcnJvcikgPT4gJHt0cm4uc3Vic3RyaW5nKDIsIHRybi5sZW5ndGgtMSl9YCkob0pTT04sIDwlPXNjb3BlJT4sIGxvZywgd2FybiwgZXJyb3IpOw0KICAgICAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vcmVzID0gYXdhaXQganNvbmF0YSh0cm4pLmV2YWx1YXRlKG9KU09OKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgLy88JT13YXJuKCklPnQuaWQsIHJlcywgdHJuKTsNCiAgICAgICAgICAgICAgICAgICAganNvbiA9IGpzb24ucmVwbGFjZShuZXcgUmVnRXhwKHQuaWQsICJnIiksICghQXJyYXkuaXNBcnJheShyZXMpICYmIHR5cGVvZihyZXMpIT09J29iamVjdCcpP3Jlczp0aGlzLl9idG9hKEpTT04uc3RyaW5naWZ5KHJlcykpKTsNCiAgICAgICAgICAgICAgICB9Y2F0Y2goZXgpew0KICAgICAgICAgICAgICAgICAgICA8JT13YXJuKCklPnQuaWQsIHRybiwgZXgpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgLy8ganNvbiA9IGpzb24ucmVwbGFjZSgvIl9fdHJNYXAiOlxzXFtce1tePj5dK1x9XF0vZ20sICciX190ck1hcCI6ICIiJyk7DQoNCiAgICAgICAgICAgIHJldHVybiBvcHRpb25zLmJKU09OP3RoaXMuX2JlYXV0aWZ5KGpzb24sICdqYXZhc2NyaXB0Jyk6SlNPTi5wYXJzZShqc29uKTsNCiAgICAgICAgfWNhdGNoKGV4KXsNCiAgICAgICAgICAgIDwlPWVycm9yKCklPmV4KTsNCiAgICAgICAgfQ0KICAgIH0NCg0KPCUNCl9jbG9uZUZ1bmN0aW9uID0gKG8sIGYsIHNjb3BlLCBjKSA9PiB7DQoNCiAgICBsZXQgb2JqID0gbnVsbDsNCiAgICBpZihvPT0nc3InICYmIHR5cGVvZihzcikhPT0ndW5kZWZpbmVkJykgb2JqID0gc3I7DQogICAgaWYobz09J19GckVNRCcgJiYgdHlwZW9mKF9GckVNRCkhPT0ndW5kZWZpbmVkJykgb2JqID0gX0ZyRU1EOw0KICAgIA0KICAgIGxldCBjb2RlID0gb2JqW2ZdID8gb2JqW2ZdLnRvU3RyaW5nKCkgOiBgICAgJHtmfSgpew0KICAgICAgICBjb25zb2xlLmxvZygnRXJyb3IgaW4gX2Nsb25lRnVuY3Rpb24oJHtvfSwgJHtmfSk6IEludmFsaWQgRnVuY3Rpb24gTmFtZScpOw0KICAgIH1gOw0KICAgIGxldCBzID0gY29kZS5yZXBsYWNlKCcpJywgJykgPT4gJyk7DQogICAgaWYgKHMuaW5kZXhPZignZnVuY3Rpb24nKSA9PSAwIHx8IHMuaW5kZXhPZignYXN5bmMgZnVuY3Rpb24nKSA9PSAwKSB7DQogICAgCXMgPSBzLnJlcGxhY2UoJ2Z1bmN0aW9uJywgJyAnKTsNCiAgICB9IGVsc2Ugew0KICAgIAlzID0gcy5yZXBsYWNlKGYsICcnKTsNCiAgICB9DQoNCiAgICBpZiAoYy5Jc01haW4gJiYgIW9ialtmXSkgew0KICAgIAljb25zb2xlLmxvZygnRXJyb3IgaW4gX2Nsb25lRnVuY3Rpb24oKTogSW52YWxpZCBGdW5jdGlvbiBOYW1lICcgKyBmKTsNCiAgICB9DQoNCiAgICByZXR1cm4gYA0KICAgICR7Zn0oLi4ucGFyYW1zKXsNCiAgICAgICAgaWYodHlwZW9mKHdpbmRvdykhPT0idW5kZWZpbmVkIiAmJiB0eXBlb2Yod2luZG93LiR7b30pIT09InVuZGVmaW5lZCIpew0KICAgICAgICAgICAgcmV0dXJuIHdpbmRvdy4ke299LiR7Zn0oLi4ucGFyYW1zKTsNCiAgICAgICAgfWVsc2V7DQogICAgICAgICAgICBgICsgKGMuSXNNYWluID8gYHJldHVybiAoJHtzfSkoLi4ucGFyYW1zKTtgIDogYHJldHVybiBuZXcgJHtzY29wZX0uJHtuTmFtZShtYWluQ2xhc3MoKSl9KCkuJHtmfSguLi5wYXJhbXMpO2ApICsgYA0KICAgICAgICB9DQoJfQ0KICAgIGA7DQp9Ow0KDQoNClt7DQogICAgd09iajogJ3NyJywNCiAgICBmdW5jdGlvbnM6IFsnaGFzaENvZGUnLCAnRXF1YWxzJywgJ3NlcnZlckRhdGUnLCAnX19zY29wZScsICdhZGRNU2Vjb25kcycsICdpcEFkZHJlc3MnXS5jb25jYXQobWFpbkNsYXNzKFsnQklTZXJ2ZXInXSk/WydfJywgJ2J1aWxkVVJMJywgJyRfUkVRVUVTVCcsICdwYXJhbScsICdfdG9YTUwnLCAnY29vcCcsICdPUicsICdteVJlcGxhY2UnLCAnc2VuZFhNTCcsICdwcm9jZXNzUmVzcG9uc2UnLCAncHJvY2Vzc1Jlc3VsdCcsICdydW5TUlNjcmlwdCcsICdncm91cEJ5JywgJ1Nob3dEZWJ1ZycsICdjYWNoZVJlc3VsdCcsICd0b0hleCcsICdTaG93RXJyb3InXTpbXSksDQp9LCB7DQogICAgd09iajogJ19GckVNRCcsDQogICAgZnVuY3Rpb25zOiBbJ19hdHRyJywgJ3J1blNjcmlwdCcsICdfdW5pcXVlJywgJ3NyJywgJ19hdG9iJywgJ19nZXRTdG9yZWRTY3JpcHQnLCAnX2J0b2EnLCAnX190aW1lJywgJ193YWl0JywgJ19zcWxUeXBlJywgJ191dWlkJywgJ3JlcXVpcmUnLCAnX2luY2x1ZGUnLCAnX2JlYXV0aWZ5JywgJ19pbmplY3QnLCAnX2NvbXByZXNzJywgJ19kZWNvbXByZXNzJywgJ1V0ZjhBcnJheVRvU3RyJywgJ3JhbmRVUkwnLCAncGF0aFRvTmFtZSddLA0KfV0uZm9yRWFjaChjYyA9PiB7ICU+DQovKiBTVEFSVDogPCU9Y2Mud09iaiU+IGZ1bmN0aW9uIGNvcGllcyAqLw0KPCUgY2MuZnVuY3Rpb25zLmZvckVhY2goZiA9PiB7JT4NCg0KLyogQ0xPTkU6OlNUQVJUOiA8JT1jYy53T2JqJT4uPCU9ZiU+KCkgKi88JT1fY2xvbmVGdW5jdGlvbihjYy53T2JqLCBmLCBzY29wZSwgYykgJT4vKiBDTE9ORTo6RU5EICA6IDwlPWNjLndPYmolPi48JT1mJT4oKSAqLw0KPCUgfSklPg0KLyogRU5EOiA8JT1jYy53T2JqJT4gZnVuY3Rpb24gY29waWVzICovDQo8JSB9KTsgJT4NCiAgICANCiAgICA8JT1tTmFtZT0naTE4biclPihldiwgdil7DQogICAgICAgIGlmKHR5cGVvZih3aW5kb3cpPT09InVuZGVmaW5lZCIgfHwgdHlwZW9mKHdpbmRvdy5pMThuX3N0b3JlKT09PSJ1bmRlZmluZWQiKSByZXR1cm4gdjsNCiAgICAgICAgDQogICAgICAgIGlmKCFldi5FbnRpdHlBdHRyaWJ1dGUuSXNUZXh0ICYmICFldi5FbnRpdHlBdHRyaWJ1dGUuSXNTdHJpbmcpew0KICAgICAgICAgICAgcmV0dXJuIHY7DQogICAgICAgIH1lbHNlew0KICAgICAgICAgICAgcmV0dXJuIHdpbmRvdy5pMThuX3N0b3JlW3RoaXMuaGFzaENvZGUodildID0gd2luZG93LmkxOG5fc3RvcmVbdGhpcy5oYXNoQ29kZSh2KV0gfHwgdjsNCiAgICAgICAgfQ0KICAgIH0NCg0KPCUgYy5FbnRpdHlBdHRyaWJ1dGVzLmZpbHRlcihlYSA9PiAhZWEuRW50aXR5TWV0aG9kICYmIGVhLkVudGl0eVR5cGUpLmZvckVhY2goZWEgPT4geyU+DQogICAgPCU9bU5hbWU9J2J5JyArIG5OYW1lKGVhLkVudGl0eVR5cGUpJT4oYXIpIHsNCiAgICAgICAgdmFyIHJldCA9IFtdOw0KICAgICAgICBhci5mb3JFYWNoKGEgPT4gew0KICAgICAgICAgICAgcmV0LmZvckVhY2gociA9PiB7DQogICAgICAgICAgICAgICAgaWYgKGFbIl88JT1uTmFtZShlYSklPiJdICYmIChhWyJfPCU9bk5hbWUoZWEpJT4iXS5FcXVhbHM/YVsiXzwlPW5OYW1lKGVhKSU+Il0uRXF1YWxzKHIpOnNyLkVxdWFscyhhWyJfPCU9bk5hbWUoZWEpJT4iXSwgcikpKSB7DQogICAgICAgICAgICAgICAgICAgIHIuXzwlPW5OYW1lKGVhKSU+XzwlPWMuUGx1cmFsLnJlcGxhY2UoLyAvZywgJ18nKSU+LnB1c2goYSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0pOw0KICAgICAgICByZXR1cm4gcmV0Ow0KICAgIH0NCjwlIH0pJT4NCg0KICAgIDwlPW1OYW1lPSdFbnRpdHlWYWx1ZSclPihhTmFtZSkgew0KICAgICAgICBsZXQgcmV0ID0gW10uY29uY2F0KHRoaXMuRW50aXR5VmFsdWVzLCB0aGlzLlZhbHVlRW50aXRpZXMpLmZpbmQoZXYgPT4gZXYuRW50aXR5QXR0cmlidXRlICYmIGV2LkVudGl0eUF0dHJpYnV0ZS5OYW1lID09IGFOYW1lKTsNCiAgICAgICAgDQogICAgICAgIGlmKCFyZXQpew0KICAgICAgICAgICAgLy8gYW4gYXR0cmlidXRlIHRoYXQgaGFzIHlldCBubyBrbm93biBlbnRpdHkgdmFsdWUNCiAgICAgICAgICAgIHJldCA9IHtBY3RpdmU6IHRydWUsIE9QRVJBVE9SUzoge30sIEVudGl0eUF0dHJpYnV0ZToge05hbWU6IGFOYW1lLCBBY3RpdmU6IHRydWUsIEVudGl0eUNsYXNzOiB7SWQ6IHRoaXMuRW50aXR5Q2xhc3MuSWR9fX07DQogICAgICAgICAgICB0aGlzLkVudGl0eVZhbHVlcy5wdXNoKHJldCk7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIHJldHVybiByZXQ7DQogICAgfQ0KDQogICAgPCU9bU5hbWU9J19fYXNzZXJ0VmFsaWQnJT4oYlN5bmMsIGJSZXF1aXJlZCl7DQo8JSBpZighYy5Ub29scy5sZW5ndGgpeyU+DQogICAgICAgIHJldHVybiB0cnVlOw0KPCUgfWVsc2V7JT4NCiAgICAgICAgbGV0IGVycm9yID0ge307DQoNCiAgICA8JSBjLkVudGl0eUF0dHJpYnV0ZXMuZmlsdGVyKGVhID0+ICFlYS5FbnRpdHlNZXRob2QgJiYgZWEuUmVxdWlyZWQpLmZvckVhY2goZWEgPT4geyU+DQogICAgICAgIGlmKGJSZXF1aXJlZCAmJiA8JXZhbHVlT2YoZWEuUmVxdWlyZWQpJT4pew0KICAgICAgICAgICAgZXJyb3IuPCU9bk5hbWUoZWEpJT4gPSB7fTsNCiAgICAgICAgICAgIGlmKCF0aGlzLl88JT1uTmFtZShlYSklPl9zZXQpIGVycm9yLjwlPW5OYW1lKGVhKSU+WyIwMSJdID0gIk5vdCBTZXQiOw0KICAgICAgICA8JSBpZihlYS5FbnRpdHlUeXBlKXslPg0KICAgICAgICAgICAgaWYoIXRoaXMuPCU9bk5hbWUoZWEpJT4oKSkgZXJyb3IuPCU9bk5hbWUoZWEpJT5bIjAyIl0gPSAiRW1wdHkgVmFsdWUiOw0KICAgICAgICAgICAgaWYodGhpcy48JT1uTmFtZShlYSklPigpICYmIGJTeW5jICYmICF0aGlzLjwlPW5OYW1lKGVhKSU+KCkuX19zeW5jX29uKCkpIGVycm9yLjwlPW5OYW1lKGVhKSU+WyIwMyJdID0gIk5vdCBpbiBTeW5jIjsNCiAgICAgICAgPCUgfSU+DQogICAgICAgICAgICBpZighT2JqZWN0LmtleXMoZXJyb3IuPCU9bk5hbWUoZWEpJT4pLmxlbmd0aCkgZGVsZXRlIGVycm9yLjwlPW5OYW1lKGVhKSU+Ow0KICAgICAgICB9DQogICAgPCUgfSklPg0KDQogICAgICAgIGlmKE9iamVjdC5rZXlzKGVycm9yKS5sZW5ndGgpew0KICAgICAgICAgICAgdGhpcy5fX2Fzc2VydEVycm9yID0gZXJyb3I7DQogICAgICAgICAgICA8JT1lcnJvcigpJT5KU09OLnN0cmluZ2lmeShlcnJvcixudWxsLDQpLCB0aGlzKTsNCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfWVsc2V7DQogICAgICAgICAgICBkZWxldGUgdGhpcy5fX2Fzc2VydEVycm9yOw0KICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgIH0NCjwlIH0lPg0KICAgIH0NCg0KICAgIDwlPW1OYW1lPSdfcmFuayclPihfPCU9bU5hbWUlPj0wKXsNCgkJdHJ5IHsNCiAgICAgICAgICAgIHJldHVybiB0aGlzLl9fZXhwb3J0KHtfPCU9bU5hbWUlPjogXzwlPW1OYW1lJT59LCB7DQogICAgICAgICAgICAgICAgTnVsbDogdHJ1ZSwNCiAgICAgICAgICAgICAgICBleHBvcnRlcjogdiA9PiB2LnJldXNlZD92Lm9iai5fX3JldXNlZCA9IHYucmV1c2VkOjAsDQogICAgICAgICAgICAgICAgSWQ6IChvYmosIGlkQ29kZSwgdikgPT4gb2JqW2lkQ29kZV0gPSAiPCU9X2NOYW1lKGMsIHRydWUpJT4iLA0KCTwlIGMuRW50aXR5QXR0cmlidXRlcy5maWx0ZXIoZWEgPT4gIWVhLkVudGl0eU1ldGhvZCAmJiBlYS5FbnRpdHlUeXBlKS5mb3JFYWNoKGVhID0+IHslPg0KICAgICAgICAgICAgICAgIDwlPW5OYW1lKGVhKSU+OiAob2JqLCBlYUNvZGUsIHYpID0+IG9iai5fPCU9bU5hbWUlPiArPSAob2JqW2VhQ29kZV0gPSAodiB8fCBuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUoZWEuRW50aXR5VHlwZSwgdHJ1ZSklPigpKS48JT1tTmFtZSU+KF88JT1tTmFtZSU+KzEpKS5fPCU9bU5hbWUlPiwNCgk8JSB9KSU+DQogICAgPCUgYy5UeXBlZEF0dHJpYnV0ZXMuZmlsdGVyKHRhID0+ICF0YS5FbnRpdHlNZXRob2QpLmZvckVhY2godGEgPT4ge2xldCB0YU5hbWUgPSBuTmFtZSh0YSkgKyAnXycgKyB0YS5FbnRpdHlDbGFzcy5QbHVyYWwucmVwbGFjZSgvIC9nLCAnXycpOyU+DQogICAgICAgICAgICAgICAgPCU9dGFOYW1lJT46IChvYmosIHRhQ29kZSwgdikgPT4gKG9ialt0YUNvZGVdID0gW25ldyA8JT1zY29wZSU+LjwlPV9jTmFtZSh0YS5FbnRpdHlUeXBlLCB0cnVlKSU+KCldLm1hcChfdiA9PiBfdi48JT1tTmFtZSU+KF88JT1tTmFtZSU+KzEpKSkuZm9yRWFjaCh2ID0+IHYuXzwlPW1OYW1lJT4pLA0KICAgIDwlIH0pJT4NCgkgICAgICAgIH0sICI8JT1tTmFtZSU+Iik7DQoJCX0gY2F0Y2ggKGV4KSB7DQoJCQk8JT1lcnJvcigpJT5leCk7DQoJCX0NCgl9DQoNCiAgICA8JT1tTmFtZT0nX2lzUXVlcnknJT4oKXsNCiAgICAgICAgbGV0IHJldCA9IHRoaXMuX19leHBvcnQoLypfX3R5cGUqL3tJZDogIjwlPW5OYW1lKGMpJT4iLCA8JT1tTmFtZSU+Q291bnQ6IDB9LCB7DQogICAgICAgICAgICBOdWxsOiB0cnVlLA0KICAgIDwlIGMuRW50aXR5QXR0cmlidXRlcy5maWx0ZXIoZWEgPT4gIWVhLkVudGl0eU1ldGhvZCkuZm9yRWFjaChlYSA9PiB7ICU+DQogICAgICAgICAgICA8JT1uTmFtZShlYSklPjogKG9iaiwgZWFDb2RlLCB2KSA9PiB7DQogICAgICAgICAgICAgICAgb2JqW2VhQ29kZV0gPSB7X2Nvb3A6IHRoaXMuXzwlPW5OYW1lKGVhKSU+X2Nvb3AgfHwgdW5kZWZpbmVkfTsNCiAgICAgICAgICAgICAgICBvYmouPCU9bU5hbWUlPkNvdW50ICs9IHR5cGVvZihvYmpbZWFDb2RlXS5fY29vcCk9PT0idW5kZWZpbmVkIj8wOjE7DQogICAgICAgICAgICAgICAgaWYodiAmJiB2LjwlPW1OYW1lJT4pew0KICAgICAgICAgICAgICAgICAgICBvYmpbZWFDb2RlXS5fb2JqZWN0ID0gdi48JT1tTmFtZSU+KCk7DQogICAgICAgICAgICAgICAgICAgIG9iai48JT1tTmFtZSU+Q291bnQgKz0gb2JqW2VhQ29kZV0uX29iamVjdC48JT1tTmFtZSU+Q291bnQ7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSwNCiAgICA8JSB9KTsgJT4NCiAgICA8JSBjLlR5cGVkQXR0cmlidXRlcy5maWx0ZXIodGEgPT4gIXRhLkVudGl0eU1ldGhvZCkuZm9yRWFjaCh0YSA9PiB7bGV0IHRhTmFtZSA9IG5OYW1lKHRhKSArICdfJyArIHRhLkVudGl0eUNsYXNzLlBsdXJhbC5yZXBsYWNlKC8gL2csICdfJyk7JT4NCiAgICAgICAgICAgIDwlPXRhTmFtZSU+OiAob2JqLCB0YUNvZGUsIHYpID0+IHsNCiAgICAgICAgICAgICAgICBvYmpbdGFDb2RlXSA9IHtfY29vcDogdGhpcy5fPCU9dGFOYW1lJT5fY29vcCB8fCB1bmRlZmluZWQsIF9vYmplY3RzOiAodnx8W10pLm1hcChfdiA9PiBfdi48JT1tTmFtZSU+KCkpfTsNCiAgICAgICAgICAgICAgICBpZihvYmpbdGFDb2RlXS5fb2JqZWN0cy5sZW5ndGgpIG9ialt0YUNvZGVdLjwlPW1OYW1lJT5Db3VudCArPSBvYmpbdGFDb2RlXS5fb2JqZWN0cy5yZWR1Y2UoKHYsIG8pID0+IHYgKz0gby48JT1tTmFtZSU+Q291bnQpOw0KICAgICAgICAgICAgfSwNCiAgICA8JSB9KSU+DQogICAgICAgIH0sICI8JT1tTmFtZSU+Iik7DQogICAgICAgIA0KICAgICAgICByZXR1cm4gcmV0Ow0KICAgIH0NCiAgICANCiAgICA8JT1tTmFtZT0nX25ldyclPihjbE5hbWUsIHRvb2wpew0KPCUgaWYobWFpbkNsYXNzKCkhPWMpeyU+DQogICAgICAgIHJldHVybiBuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUobWFpbkNsYXNzKCksIHRydWUpJT4oKS48JT1tTmFtZSU+KGNsTmFtZSwgdG9vbCk7DQo8JSB9ZWxzZXslPg0KICAgICAgICB0cnl7DQogICAgICAgICAgICBzd2l0Y2goY2xOYW1lKXsNCiAgICA8JSBhckNsYXNzZXMuZm9yRWFjaChfYyA9PiB7JT4NCiAgICAgICAgICAgICAgICBjYXNlICI8JT1uTmFtZShfYyklPiI6DQogICAgICAgICAgICAgICAgY2FzZSAiPCU9X2MuTmFtZSU+IjoNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyA8JT1zY29wZSU+LjwlPV9jTmFtZShfYywgdHJ1ZSklPih1bmRlZmluZWQsIHRvb2wpOw0KICAgIDwlIH0pJT4NCiAgICAgICAgICAgIH0NCiAgICAgICAgfWNhdGNoKGV4KXsNCiAgICAgICAgICAgIDwlPWVycm9yKCklPmV4KTsNCiAgICAgICAgfQ0KPCUgfSU+DQogICAgfQ0KICAgIA0KICAgIGFzeW5jIDwlPW1OYW1lPSdzdG9yZSclPigpIHsNCiAgICAgICAgbGV0IHJlc3VsdHMgPSBhd2FpdCB0aGlzLl9leGVjdXRlKG51bGwsIDwlPWFsaWFzKCklPiwgIjwlPW1OYW1lJT4iLCA8JW1Sb3V0aW5nKGMpJT4sIGFzeW5jICgpID0+IHsNCiAgICAgICAgICAgIC8qKiogU1RBUlQgTE9DQUwgPCU9bU5hbWUlPigpICoqKi8NCiAgICAgICAgICAgIA0KICAgICAgICBsZXQgYlVwZGF0ZSA9IGZhbHNlOw0KICAgICAgICBsZXQgYkluc2VydCA9IGZhbHNlOw0KDQogICAgICAgIGlmKHRoaXMuX19jb25maWcoJ3N0b3JlLmRpc2FibGVkJykpew0KICAgICAgICAgICAgPCU9d2FybigpJT4ic3RvcmluZyBkaXNhYmxlZCIpOw0KICAgICAgICB9ZWxzZSBpZihmYWxzZSAmJiB0aGlzLl9pc1F1ZXJ5KCkuX2lzUXVlcnlDb3VudCl7DQogICAgICAgICAgICA8JT13YXJuKCklPiJDYW5ub3Qgc3RvcmUgYSBxdWVyeSEiKTsNCiAgICAgICAgfWVsc2UgaWYoIXRoaXMuX19zeW5jX29uKCkgfHwgPCU9X0ZyRU1ELl90b0pTKF9maWxlVG9vbHMpJT4uaW5kZXhPZih0aGlzLlRvb2wudHlwZS5uYW1lKT49MCl7DQogICAgICAgIA0KICAgICAgICAgICAgbGV0IF90aGlzID0gbmV3IDwlPXNjb3BlJT4uPCU9bk5hbWUoYywgdHJ1ZSklPih1bmRlZmluZWQsIHRoaXMuVG9vbCk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGxldCBiRmluZCA9IGZhbHNlOw0KICAgICAgICAgICAgaWYodGhpcy5JZD09dGhpcy5JZCl7DQogICAgICAgICAgICAgICAgYkZpbmQgPSB0cnVlOw0KICAgICAgICAgICAgICAgIF90aGlzLklkID0gdGhpcy5JZDsNCiAgICAgICAgICAgIH0NCjwlIGMuRW50aXR5QXR0cmlidXRlcy5maWx0ZXIoZWEgPT4gZWEuSXNVbmlxdWUpLmZvckVhY2goZWEgPT4geyU+DQogICAgICAgICAgICBpZig8JXZhbHVlT2YoZWEuSXNVbmlxdWUpJT4pew0KICAgICAgICAgICAgICAgIGJGaW5kID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICBfdGhpcy48JT1uTmFtZShlYSklPih0aGlzLjwlPW5OYW1lKGVhKSU+KCksICc9Jyk7DQogICAgICAgICAgICB9DQo8JSB9KTsgJT4NCg0KICAgICAgICAgICAgaWYoYkZpbmQpew0KICAgICAgICAgICAgICAgIF90aGlzID0gYXdhaXQgX3RoaXMuZmluZCgpOw0KICAgICAgICAgICAgfWVsc2UgX3RoaXMgPSBudWxsOw0KICAgICAgICAgICAgaWYoX3RoaXMpew0KICAgICAgICAgICAgICAgIHRoaXMuSWQgPSBfdGhpcy5JZDsNCiAgICAgICAgICAgICAgICB0aGlzLl9fc3luY19vbihfdGhpcy5fX3N5bmNfb24oKSk7DQogICAgICAgICAgICAgICAgPCU9bG9nKCklPiJfdGhpcy5JZCIsIF90aGlzLklkLCB0aGlzLklkLCBfdGhpcy5Ub29sLm5hbWUsIHRoaXMuVG9vbC5uYW1lKTsNCiAgICAgICAgICAgICAgICBiVXBkYXRlID0gdHJ1ZTsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHRoaXMuSWQgPSB0aGlzLklkOyAvLyB0byBlbmZvcmNlIHRoZSBJZCBhbmQgbm90IGdldCBhIG5ldyBvbmUgZXZlcnkgdGltZQ0KICAgICAgICAgICAgICAgIGJJbnNlcnQgPSB0cnVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9ZWxzZSBpZihNYXRoLmFicygodGhpcy5TZXRfT24uZ2V0VGltZSgpIC0gdGhpcy5fX3N5bmNfb24oKS5nZXRUaW1lKCkpIC8gMTAwMCkgPCB0aGlzLl9fY29uZmlnKCdzdG9yZS5zZW5zaXRpdml0eScsIDUpKXsNCiAgICAgICAgICAgIDwlPWxvZygpJT4iQWxyZWFkeSBzdG9yZWQiLCBNYXRoLmFicygodGhpcy5TZXRfT24uZ2V0VGltZSgpIC0gdGhpcy5fX3N5bmNfb24oKS5nZXRUaW1lKCkpIC8gMTAwMCkgKyI8Iit0aGlzLl9fY29uZmlnKCdzdG9yZS5zZW5zaXRpdml0eScsIDUpKTsNCiAgICAgICAgfWVsc2V7DQogICAgICAgICAgICBiVXBkYXRlID0gdHJ1ZTsNCiAgICAgICAgfQ0KDQogICAgICAgIGlmKCFiVXBkYXRlICYmICFiSW5zZXJ0KXsNCiAgICAgICAgICAgIDwlPWxvZygpJT4iTm8gZGF0YSBjaGFuZ2VzIik7DQogICAgICAgIH1lbHNlew0KPCUgY2xzVG9vbHMoYykuZm9yRWFjaCh0ID0+IHslPg0KICAgICAgICAgICAgaWYodGhpcy5Ub29sLnR5cGUubmFtZT09IjwlPXQlPiIpew0KICAgIDwlIGlmKHQ9PSJTcWxEQiIpeyAlPg0KICAgICAgICAgICAgICAgIGlmKHR5cGVvZig8JT1zY29wZSU+Ll9fc3FsVHJhbnNhY3Rpb24pPT09InVuZGVmaW5lZCIgfHwgPCU9c2NvcGUlPi5fX3NxbFRyYW5zYWN0aW9uLmVuZCl7DQogICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuX3NxbChgJHt0aGlzLl9fY29uZmlnKCd0eXBlJyk9PSdzcWxpdGUnPydCRUdJTic6J1NUQVJUJ30gVFJBTlNBQ1RJT05gKTsNCiAgICAgICAgICAgICAgICAgICAgPCU9c2NvcGUlPi5fX3NxbFRyYW5zYWN0aW9uID0ge093bmVyOiB0aGlzLCBzcWxzOiBbXSwgc3RhcnQ6IG5ldyBEYXRlKCksIGVuZDogbnVsbH07DQogICAgICAgICAgICAgICAgfQ0KICAgIDwlIH0lPg0KICAgICAgICAgICAgfQ0KPCUgfSklPg0KDQogICAgICAgICAgICB0aGlzLl9kZWZhdWx0cygpOw0KDQogICAgICAgICAgICBpZih0aGlzLl9fY29uZmlnKCJTeW5jRW50aXR5QXR0cmlidXRlcyIpKXsNCjwlIGMuRW50aXR5QXR0cmlidXRlcy5maWx0ZXIoZWEgPT4gIWVhLkVudGl0eU1ldGhvZCAmJiBlYS5FbnRpdHlUeXBlKS5mb3JFYWNoKGVhID0+IHslPg0KICAgICAgICAgICAgICAgIDwlPWxvZygpJT4iPCU9ZWEuTmFtZSU+IiwgdGhpcy48JT1uTmFtZShlYSklPigpKTsNCiAgICAgICAgICAgICAgICBpZih0aGlzLjwlPW5OYW1lKGVhKSU+KCkgJiYgIShhd2FpdCB0aGlzLjwlPW5OYW1lKGVhKSU+KCkuPCU9bU5hbWUlPigpKSkgdGhpcy5jbGVhcl88JT1uTmFtZShlYSklPigpOw0KPCUgfSk7ICU+DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKCF0aGlzLl9fYXNzZXJ0VmFsaWQodHJ1ZSwgYkluc2VydCkpIHJldHVybiBudWxsOw0KICAgICAgICAgICAgDQogICAgICAgICAgICA8JT1sb2coKSU+YD09PT4gSW5zZXJ0OiR7Ykluc2VydH0sIFVwZGF0ZToke2JVcGRhdGV9LCBJZDpbJHt0aGlzLklkfV1gLCB0aGlzKTsNCiAgICAgICAgICAgIGlmKGJVcGRhdGUpIGF3YWl0IHRoaXMudXBkYXRlKCk7DQogICAgICAgICAgICBpZihiSW5zZXJ0KSBhd2FpdCB0aGlzLmluc2VydCgpOw0KICAgICAgICAgICAgPCU9bG9nKCklPmA8PT09IEluc2VydDoke2JJbnNlcnR9LCBVcGRhdGU6JHtiVXBkYXRlfSwgSWQ6WyR7dGhpcy5JZH1dYCk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGlmKHRoaXMuX19jb25maWcoIlN5bmNUeXBlZEF0dHJpYnV0ZXMiKSl7DQo8JSBjLlR5cGVkQXR0cmlidXRlcy5mb3JFYWNoKHRhID0+IHsgbGV0IHRhTmFtZSA9IG5OYW1lKHRhKSArICdfJyArIHRhLkVudGl0eUNsYXNzLlBsdXJhbC5yZXBsYWNlKC8gL2csICdfJyk7JT4NCiAgICAgICAgICAgICAgICBmb3IgYXdhaXQgKGNvbnN0IHRhIG9mIHRoaXMuPCU9dGFOYW1lJT4oKSl7DQogICAgICAgICAgICAgICAgICAgIDwlPWxvZygpJT4iU3luY2luZy4uLjwlPXRhTmFtZSU+IiwgdGEpOw0KICAgICAgICAgICAgICAgICAgICBhd2FpdCB0YS48JT1tTmFtZSU+KCk7DQogICAgICAgICAgICAgICAgfQ0KPCUgfSk7ICU+DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKGJVcGRhdGUgfHwgYkluc2VydCl7DQo8JSBjbHNUb29scyhjKS5mb3JFYWNoKHQgPT4geyU+DQogICAgICAgICAgICAgICAgaWYodGhpcy5Ub29sLnR5cGUubmFtZT09IjwlPXQlPiIpew0KICAgIDwlIGlmKHQ9PSJTcWxEQiIpeyAlPg0KICAgICAgICAgICAgICAgICAgICBpZig8JT1zY29wZSU+Ll9fc3FsVHJhbnNhY3Rpb24gJiYgITwlPXNjb3BlJT4uX19zcWxUcmFuc2FjdGlvbi5lbmQgJiYgPCU9c2NvcGUlPi5fX3NxbFRyYW5zYWN0aW9uLk93bmVyPT10aGlzKXsNCiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuX3NxbChgQ09NTUlUJHt0aGlzLl9fY29uZmlnKCd0eXBlJyk9PSdzcWxpdGUnPycgVFJBTlNBQ1RJT04nOicnfWApOw0KICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIDwlPXNjb3BlJT4uX3VuUmVjdXJzZTsNCiAgICAgICAgICAgICAgICAgICAgICAgIDwlPXNjb3BlJT4uX19zcWxUcmFuc2FjdGlvbi5lbmQgPSBuZXcgRGF0ZSgpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgPCUgfSU+DQogICAgICAgICAgICAgICAgfQ0KPCUgfSklPg0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgIH0sIHtfX2JlZm9yZVJ1bGVzOiBbPCUoYy5FbnRpdHlSdWxlcyB8fCBbXSkuZmlsdGVyKHIgPT4gclttTmFtZV0gJiYgci5CZWZvcmUpLm1hcChyID0+IHslPjwlPV9GckVNRC5fdG9KUyhyKSU+PCUgfSkuam9pbignLCAnKSU+XSwgX19hZnRlclJ1bGVzOiBbPCUoYy5FbnRpdHlSdWxlcyB8fCBbXSkuZmlsdGVyKHIgPT4gclttTmFtZV0gJiYgci5BZnRlcikubWFwKHIgPT4geyU+PCU9X0ZyRU1ELl90b0pTKHIpJT48JSB9KS5qb2luKCcsICcpJT5dfSk7DQogICAgICAgIA0KICAgICAgICByZXR1cm4gKHJlc3VsdHMuZmluZChyID0+IHIucmV0KSB8fCB7cmV0OiBudWxsfSkucmV0OyAvLyBmaXJzdCBvbmUgdG8gZXhlY3V0ZSBjb3JyZWN0bHkNCiAgICB9DQoNCiAgICBhc3luYyA8JT1tTmFtZT0naW5zZXJ0JyU+KCl7DQogICAgICAgIGxldCByZXN1bHRzID0gYXdhaXQgdGhpcy5fZXhlY3V0ZShudWxsLCA8JT1hbGlhcygpJT4sICI8JT1tTmFtZSU+IiwgPCVtUm91dGluZyhjKSU+LCBhc3luYyAoKSA9PiB7DQogICAgICAgICAgICAvKioqIFNUQVJUIExPQ0FMIDwlPW1OYW1lJT4oKSAqKiovDQoNCjwlIGNsc1Rvb2xzKGMpLmZvckVhY2godCA9PiB7JT4NCiAgICAgICAgaWYodGhpcy5Ub29sLnR5cGUubmFtZT09IjwlPXQlPiIpew0KICAgIDwlIGlmKHQ9PSJNb25nb0RCIiB8fCB0PT0iWmFuZ29EQiIpeyAlPg0KICAgICAgICAgICAgYXdhaXQgdGhpcy5Ub29sLmRiLmdldENvbGxlY3Rpb24oPCU9X25Db2RlKGMpJT4pLmluc2VydE9uZSh0aGlzLl90b0RvY3VtZW50KHtiTWFwOiB0cnVlfSkpOw0KICAgICAgICAgICAgdGhpcy5Ub29sLl9fZG1sU3RhdGVtZW50cy5wdXNoKGBkYi5nZXRDb2xsZWN0aW9uKCckezwlPV9uQ29kZSgpJT59JykuaW5zZXJ0T25lKCR7dGhpcy5fdG9KU09OKHtiTWFwOiB0cnVlfSl9KWApOw0KICAgIDwlIH0gZWxzZSBpZih0ID09ICJSeERCIikgeyU+DQogICAgICAgICAgICBhd2FpdCB0aGlzLlRvb2wuZGJbPCU9X25Db2RlKGMpJT5dLjwlPW1OYW1lJT4odGhpcy5fdG9Eb2N1bWVudCh7Yk1hcDogdHJ1ZX0pKTsNCiAgICA8JSB9IGVsc2UgaWYodCA9PSAiTWVtb3J5IikgeyU+DQogICAgICAgICAgICB0aGlzLlRvb2wuZGIuPCU9bk5hbWUoYyklPi5wdXNoKHRoaXMpOw0KICAgIDwlIH0gZWxzZSBpZih0ID09ICJOZW80aiIpIHslPg0KICAgICAgICAgICAgbGV0IHJldCA9IGF3YWl0IHRoaXMuX25lbzRqKHRoaXMuX3RvQ3lNZXJnZSgpKTsNCiAgICA8JSB9IGVsc2UgaWYodCA9PSAiU2FsZXNGb3JjZSIpIHslPg0KICAgICAgICAgICAgbGV0IG9iaiA9IHt9Ow0KICAgICAgICAgICAgPCUgJC5lYWNoKGMuRW50aXR5QXR0cmlidXRlcy5maWx0ZXIoZWEgPT4gIWVhLkVudGl0eU1ldGhvZCksIChfLCBlYSkgPT4geyU+DQogICAgICAgICAgICBpZih0aGlzLl88JT1uTmFtZShlYSklPl9zZXQpew0KICAgICAgICAgICAgICAgIDwlIGlmKGVhLkVudGl0eVR5cGUpeyAlPg0KICAgICAgICAgICAgICAgIG9iai48JT1uTmFtZShlYSklPiA9IHRoaXMuXzwlPW5OYW1lKGVhKSU+LklkOw0KICAgICAgICAgICAgICAgIDwlIH1lbHNleyAlPg0KICAgICAgICAgICAgICAgIG9iai48JT1uTmFtZShlYSklPiA9IHRoaXMuPCU9bk5hbWUoZWEpJT4oKTsNCiAgICAgICAgICAgICAgICA8JSB9ICU+DQogICAgICAgICAgICB9DQogICAgICAgICAgICA8JSB9KTsgJT4NCiAgICANCiAgICAgICAgICAgIGxvZygiU2VuZGluZyB0byBTRiIsIG9iaik7DQogICAgDQogICAgICAgICAgICBsZXQgcmVzID0gYXdhaXQgdGhpcy5Ub29sLmRiLnNvYmplY3QoIjwlPW5OYW1lKGMpJT4iKS5jcmVhdGUob2JqKTsNCiAgICAgICAgICAgIHRoaXMuSWQgPSByZXMuaWQ7DQogICAgPCUgfSBlbHNlIGlmKF9zcWxUb29scy5pbmRleE9mKHQpPj0wKSB7JT4NCiAgICAgICAgICAgIGxldCByZXQgPSBhd2FpdCB0aGlzLl9zcWwodGhpcy5fdG9JbnNlcnRTUUwoKSk7DQogICAgICAgICAgICA8JT1sb2coKSU+InJlc3VsdCIsIHJldCk7DQogICAgPCUgfSBlbHNlIGlmKHQgPT0gIlNlcnZpY2VOb3ciKSB7JT4NCiAgICAgICAgICAgIHRoaXMuX2Zyb21Eb2N1bWVudChhd2FpdCB0aGlzLl9yZXN0KG51bGwsIG51bGwsIGF3YWl0IHRoaXMuX3RvRG9jdW1lbnQoe2JNYXA6IHRydWUsIHJldXNlZDogMX0pKSk7DQogICAgPCUgfSBlbHNlIGlmKF9maWxlVG9vbHMuaW5kZXhPZih0KT4tMSl7ICU+DQogICAgICAgICAgICBhd2FpdCB0aGlzLl88JT10LnRvTG93ZXJDYXNlKCklPignPCU9YWxpYXMoKS5zcGxpdCgnLicpLnNsaWNlKDEpLmpvaW4oJy8nKSU+LzwlPW5OYW1lKGMpJT4vJyArIHRoaXMuX3RvU3RyaW5nKCkgKyAnLmpzb24nLCB0aGlzLl90b0pTT04oe2JNYXA6IHRydWUsIHJldXNlZDogMX0pLCB0aGlzLklkKTsNCiAgICA8JSB9IGVsc2UgaWYodCA9PSAiRU1TIikgeyU+DQogICAgICAgICAgICB0aGlzLklkID0gKGF3YWl0IHRoaXMuX3RvRU1TT2JqZWN0KCkuc3RvcmUoKSkuSWQ7DQogICAgPCUgfSBlbHNlIGlmKHQgPT0gIlJlc3REQklPIikgeyU+DQogICAgICAgICAgICBsZXQgb2JqID0ge307DQogICAgICAgICAgICA8JSAkLmVhY2goYy5FbnRpdHlBdHRyaWJ1dGVzLmZpbHRlcihlYSA9PiAhZWEuRW50aXR5TWV0aG9kKSwgKF8sIGVhKSA9PiB7JT4NCiAgICAgICAgICAgIGlmKHRoaXMuXzwlPW5OYW1lKGVhKSU+X3NldCl7DQogICAgICAgICAgICAgICAgPCUgaWYoZWEuRW50aXR5VHlwZSl7ICU+DQogICAgICAgICAgICAgICAgb2JqLjwlPW5Db2RlKGVhKSU+ID0gdGhpcy48JT1uTmFtZShlYSklPigpLklkLypfaWQoKSovOw0KICAgICAgICAgICAgICAgIDwlIH1lbHNleyAlPg0KICAgICAgICAgICAgICAgIG9iai48JT1uQ29kZShlYSklPiA9IHRoaXMuPCU9bk5hbWUoZWEpJT4oKTsNCiAgICAgICAgICAgICAgICA8JSB9ICU+DQogICAgICAgICAgICB9DQogICAgICAgICAgICA8JSB9KTsgJT4NCiAgICANCiAgICAgICAgICAgIGxldCB1cmwgPSAiaHR0cHM6Ly8iICsgdGhpcy5fX2NvbmZpZygnZGF0YWJhc2UnKSArICIucmVzdGRiLmlvL3Jlc3QvIiArIDwlPV9uQ29kZSgpJT4udG9Mb3dlckNhc2UoKTsNCiAgICAgICAgICAgIGxvZygiPCU9dCU+IFVSTCIsIHVybCk7DQogICAgICAgICAgICBsZXQgcmVzID0gYXdhaXQgYXhpb3MucG9zdCh1cmwsIG9iaiwgew0KICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsNCiAgICAgICAgICAgICAgICAgICAgImNhY2hlLWNvbnRyb2wiOiAibm8tY2FjaGUiLA0KICAgICAgICAgICAgICAgICAgICAieC1hcGlrZXkiOiB0aGlzLl9fY29uZmlnKCdhcGlrZXknKSwNCiAgICAgICAgICAgICAgICAgICAgImNvbnRlbnQtdHlwZSI6ICJhcHBsaWNhdGlvbi9qc29uIiwNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9KTsNCiAgICANCiAgICAgICAgICAgIGxvZygicmVzdWx0IiwgcmVzLmRhdGEpOw0KICAgICAgICAgICAgdGhpcy5fZnJvbURvY3VtZW50KHJlcy5kYXRhKTsNCiAgICA8JSB9IGVsc2UgaWYodCA9PSAiQklTZXJ2ZXIiKSB7JT4NCiAgICAgICAgICAgIC8vIHdlIG5lZWQgZGVwdGggMiB0byBnZXQgdGhlIEVudGl0eVZhbHVlcyBib3VuZCB0byB0aGUgb25lcyB3ZSBzZW50DQogICAgICAgICAgICBsZXQgaW5zT2JqID0gYXdhaXQgdGhpcy5zcigpLl8oIkVudGVycHJpc2VNYW5hZ2VyLmVtc0VudGl0eU9iamVjdEluc2VydCIsIG51bGwsIHRoaXMudG9FbnRpdHlPYmplY3QoKSwgbnVsbCwgMik7DQogICAgICAgICAgICBpZighaW5zT2JqKSByZXR1cm4gbnVsbDsNCiAgICAgICAgICAgIHRoaXMuSWQgPSBpbnNPYmouSWQ7DQogICAgICAgICAgICB0aGlzLkVudGl0eVZhbHVlcyA9IGluc09iai5FbnRpdHlWYWx1ZXM7DQogICAgICAgICAgICB0aGlzLl9yZXZlcnQoKTsNCiAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgIDwlIH0gJT4NCiAgICAgICAgfQ0KPCUgfSkgJT4NCg0KICAgICAgICB0aGlzLl9fc3luY19vbihuZXcgRGF0ZSgpKTsNCg0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgfSwge19fYmVmb3JlUnVsZXM6IFs8JShjLkVudGl0eVJ1bGVzIHx8IFtdKS5maWx0ZXIociA9PiByW21OYW1lXSAmJiByLkJlZm9yZSkubWFwKHIgPT4geyU+PCU9X0ZyRU1ELl90b0pTKHIpJT48JSB9KS5qb2luKCcsICcpJT5dLCBfX2FmdGVyUnVsZXM6IFs8JShjLkVudGl0eVJ1bGVzIHx8IFtdKS5maWx0ZXIociA9PiByW21OYW1lXSAmJiByLkFmdGVyKS5tYXAociA9PiB7JT48JT1fRnJFTUQuX3RvSlMociklPjwlIH0pLmpvaW4oJywgJyklPl19KTsNCiAgICAgICAgDQogICAgICAgIHJldHVybiAocmVzdWx0cy5maW5kKHIgPT4gci5yZXQpIHx8IHtyZXQ6IG51bGx9KS5yZXQ7IC8vIGZpcnN0IG9uZSB0byBleGVjdXRlIGNvcnJlY3RseQ0KICAgIH0NCiAgICANCiAgICBhc3luYyA8JT1tTmFtZT0ndXBkYXRlJyU+KCkgew0KICAgICAgICBsZXQgcmVzdWx0cyA9IGF3YWl0IHRoaXMuX2V4ZWN1dGUobnVsbCwgPCU9YWxpYXMoKSU+LCAiPCU9bU5hbWUlPiIsIDwlbVJvdXRpbmcoYyklPiwgYXN5bmMgKCkgPT4gew0KICAgICAgICAvKioqIFNUQVJUIExPQ0FMIDwlPW1OYW1lJT4oKSAqKiovDQoNCiAgICAgICAgbGV0IHJldCA9IG51bGw7DQo8JSBjbHNUb29scyhjKS5mb3JFYWNoKHQgPT4geyU+DQogICAgICAgIGlmKHRoaXMuVG9vbC50eXBlLm5hbWU9PSI8JT10JT4iKXsNCg0KICAgIDwlIGlmKHQgPT0gIk1vbmdvREIiKSB7JT4NCiAgICAgICAgICAgIHJldCA9IGF3YWl0IHRoaXMuVG9vbC5kYi5jb2xsZWN0aW9uKDwlPV9uQ29kZShjKSU+KS51cGRhdGVPbmUoe19pZDogdGhpcy5JZH0sIHskc2V0OiB0aGlzLl90b0RvY3VtZW50KHtiTWFwOiB0cnVlfSl9KTsNCiAgICAgICAgICAgIHRoaXMuVG9vbC5fX2RtbFN0YXRlbWVudHMucHVzaChgZGIuZ2V0Q29sbGVjdGlvbignJHs8JT1fbkNvZGUoKSU+fScpLnVwZGF0ZU9uZSh7X2lkOiAnJHtyZXQuX2lkfSd9LCB7JHNldDogJHt0aGlzLl90b0RvY3VtZW50KHtiTWFwOiB0cnVlfSl9KWApOw0KICAgIDwlIH1lbHNlIGlmKHQgPT0gIk1lbW9yeSIpIHslPg0KICAgICAgICAgICAgdGhpcy5Ub29sLmRiLjwlPW5OYW1lKGMpJT5bdGhpcy5Ub29sLmRiLjwlPW5OYW1lKGMpJT4uZmluZEluZGV4KG8gPT4gby5JZD09dGhpcy5JZCldID0gdGhpczsNCiAgICA8JSB9IGVsc2UgaWYodCA9PSAiTmVvNGoiKSB7JT4NCiAgICAgICAgICAgIGF3YWl0IHRoaXMuX25lbzRqKHRoaXMuX3RvQ3lNZXJnZSgpKTsNCiAgICA8JSB9ZWxzZSBpZihfc3FsVG9vbHMuaW5kZXhPZih0KT49MCkgeyU+DQogICAgICAgICAgICBhd2FpdCB0aGlzLl9zcWwodGhpcy5fdG9VcGRhdGVTUUwoKSk7DQogICAgICAgICAgICByZXQgPSBhd2FpdCB0aGlzLl9zcWwodGhpcy5fdG9TZWxlY3RTUUwoKSk7DQogICAgICAgICAgICBpZihBcnJheS5pc0FycmF5KHJldCkpIHJldCA9IHJldFswXTsNCiAgICA8JSB9ZWxzZSBpZih0ID09ICJTZXJ2aWNlTm93IikgeyU+DQogICAgICAgICAgICByZXQgPSAoYXdhaXQgdGhpcy5fcmVzdChudWxsLCBudWxsLCBhd2FpdCB0aGlzLl90b0RvY3VtZW50KHtiTWFwOiB0cnVlLCByZXVzZWQ6IDF9KSwgJ3B1dCcpKS5yZXN1bHQ7DQogICAgPCUgfWVsc2UgaWYoX2ZpbGVUb29scy5pbmRleE9mKHQpPi0xKXsgJT4NCiAgICAgICAgICAgIGF3YWl0IHRoaXMuXzwlPXQudG9Mb3dlckNhc2UoKSU+KCc8JT1hbGlhcygpLnNwbGl0KCcuJykuc2xpY2UoMSkuam9pbignLycpJT4vPCU9bk5hbWUoYyklPi8nICsgdGhpcy5fdG9TdHJpbmcoKSArICcuanNvbicsIHRoaXMuX3RvSlNPTih7Yk1hcDogdHJ1ZSwgcmV1c2VkOiAxfSksIHRoaXMuSWQpOw0KICAgIDwlIH0gZWxzZSBpZih0ID09ICJFTVMiKSB7JT4NCiAgICAgICAgICAgIGF3YWl0IHRoaXMuX3RvRU1TT2JqZWN0KCkuc3RvcmUoKTsNCiAgICA8JSB9ZWxzZSBpZih0ID09ICJSZXN0REJJTyIpIHslPg0KICAgICAgICAgICAgPCU9bG9nKCklPiJTZW5kaW5nIHVwZGF0ZSB0byBSRVNUREJJTyB0byBzYXZlIik7DQoNCiAgICAgICAgICAgIGxldCB1cmwgPSAiaHR0cHM6Ly8iICsgdGhpcy5fX2NvbmZpZygnZGF0YWJhc2UnKSArICIucmVzdGRiLmlvL3Jlc3QvIiArIDwlPV9uQ29kZSgpJT4udG9Mb3dlckNhc2UoKSArICIvIiArIHRoaXMuSWQ7DQogICAgICAgICAgICAvLyA8JT1sb2coKSU+IlVwZGF0ZSB0byBSRVNUREJJTyIsIHVybCk7DQogICAgICAgICAgICByZXQgPSAoYXdhaXQgYXhpb3MucHV0KHVybCwgb2JqLCB7DQogICAgICAgICAgICAgICAgaGVhZGVyczogew0KICAgICAgICAgICAgICAgICAgICAiY2FjaGUtY29udHJvbCI6ICJuby1jYWNoZSIsDQogICAgICAgICAgICAgICAgICAgICJ4LWFwaWtleSI6IHRoaXMuX19jb25maWcoJ2FwaWtleScpLA0KICAgICAgICAgICAgICAgICAgICAiY29udGVudC10eXBlIjogImFwcGxpY2F0aW9uL2pzb24iLA0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0pKS5kYXRhOw0KICAgIDwlIH1lbHNlIGlmKHQgPT0gIkJJU2VydmVyIikgeyU+DQogICAgICAgICAgICAvLyB3ZSBuZWVkIGRlcHRoIDIgdG8gZ2V0IHRoZSBFbnRpdHlWYWx1ZXMgYm91bmQgdG8gdGhlIG9uZXMgd2Ugc2VudA0KICAgICAgICAgICAgbGV0IHVwZE9iaiA9IGF3YWl0IHRoaXMuc3IoKS5fKCJFbnRlcnByaXNlTWFuYWdlci5lbXNFbnRpdHlPYmplY3RVcGRhdGUiLCBudWxsLCB0aGlzLnRvRW50aXR5T2JqZWN0KCksIDIpOw0KICAgICAgICAgICAgaWYoIXVwZE9iaikgcmV0dXJuIG51bGw7DQogICAgICAgICAgICB0aGlzLl9fc3luY19vbihuZXcgRGF0ZSgpKTsNCiAgICAgICAgICAgIHJldHVybiB0aGlzLl9jb3B5RnJvbSh1cGRPYmopOw0KICAgIDwlIH0gJT4NCiAgICAgICAgfQ0KPCUgfSklPg0KDQogICAgICAgICAgICA8JT1sb2coKSU+InJlc3VsdCIsIHJldCk7DQogICAgICAgICAgICB0aGlzLl9fc3luY19vbihuZXcgRGF0ZSgpKTsNCiAgICAgICAgICAgIHRoaXMuX2Zyb21Eb2N1bWVudChyZXQsIHRydWUpOw0KDQogICAgICAgICAgICByZXR1cm4gcmV0Ow0KDQogICAgICAgICAgICAvKioqIEVORCBMT0NBTCA8JT1tTmFtZSU+KCkgKioqLw0KICAgICAgICB9LCB7X19iZWZvcmVSdWxlczogWzwlKGMuRW50aXR5UnVsZXMgfHwgW10pLmZpbHRlcihyID0+IHJbbU5hbWVdICYmIHIuQmVmb3JlKS5tYXAociA9PiB7JT48JT1fRnJFTUQuX3RvSlMociklPjwlIH0pLmpvaW4oJywgJyklPl0sIF9fYWZ0ZXJSdWxlczogWzwlKGMuRW50aXR5UnVsZXMgfHwgW10pLmZpbHRlcihyID0+IHJbbU5hbWVdICYmIHIuQWZ0ZXIpLm1hcChyID0+IHslPjwlPV9GckVNRC5fdG9KUyhyKSU+PCUgfSkuam9pbignLCAnKSU+XX0pOw0KICAgICAgICANCiAgICAgICAgcmV0dXJuIChyZXN1bHRzLmZpbmQociA9PiByLnJldCkgfHwge3JldDogbnVsbH0pLnJldDsgLy8gZmlyc3Qgb25lIHRvIGV4ZWN1dGUgY29ycmVjdGx5DQogICAgfQ0KICAgIA0KICAgIGFzeW5jIDwlPW1OYW1lPSdmaW5kJyU+KGRlcHRoID0gMSwgb2JqcywgZmllbGRzKSB7DQogICAgICAgIHJldHVybiAoYXdhaXQgdGhpcy5maW5kQWxsKGRlcHRoLCBvYmpzLCBudWxsLCBudWxsLCBmaWVsZHMpKVswXTsNCiAgICB9DQoNCiAgICBhc3luYyA8JT1tTmFtZT0nZmluZEFsbCclPihkZXB0aCA9IDEsIG9ianM9W10sIHN0YXJ0LCBlbmQsIGZpZWxkcykgew0KICAgICAgICBsZXQgcmVzdWx0cyA9IGF3YWl0IHRoaXMuX2V4ZWN1dGUobnVsbCwgPCU9YWxpYXMoKSU+LCAiPCU9bU5hbWUlPiIsIDwlbVJvdXRpbmcoYyklPiwgYXN5bmMgKCkgPT4gew0KICAgICAgICAgICAgICAgIC8qKiogU1RBUlQgTE9DQUwgPCU9bU5hbWUlPigpICoqKi8NCiAgICAgICAgDQogICAgICAgIGxldCByZXQgPSBbXTsgLy8gYSBqc29uIGFycmF5DQoNCjwlIGNsc1Rvb2xzKGMpLmZvckVhY2godCA9PiB7JT4NCiAgICAgICAgaWYodGhpcy5Ub29sLnR5cGUubmFtZT09IjwlPXQlPiIpew0KICAgIDwlIGlmKHQ9PSJNb25nb0RCIil7ICU+DQogICAgICAgICAgICBpZih0aGlzLlRvb2wuZGIpIHJldCA9IGF3YWl0IHRoaXMuVG9vbC5kYi5jb2xsZWN0aW9uKDwlPV9uQ29kZShjKSU+KS5maW5kKHRoaXMuX3RvU2VsZWN0TW9uZ29EQihmaWVsZHMsIG9ianMpKS50b0FycmF5KCk7DQogICAgPCUgfSBlbHNlIGlmKHQgPT0gIlJ4REIiKSB7JT4NCiAgICAgICAgICAgIGF3YWl0IHRoaXMuVG9vbC5kYls8JT1fbkNvZGUoYyklPl0uZmluZCh0aGlzLl90b1NlbGVjdFJ4REIoZmllbGRzLCBvYmpzKSkuZXhlYygpOw0KICAgIDwlIH1lbHNlIGlmKF9zcWxUb29scy5pbmRleE9mKHQpPj0wKXsgJT4NCiAgICAgICAgICAgIHJldCA9IGF3YWl0IHRoaXMuX3NxbCh0aGlzLl90b1NlbGVjdFNRTChmaWVsZHMsIG9ianMpKTsNCiAgICA8JSB9ZWxzZSBpZih0PT0iRU1TIil7ICU+DQogICAgICAgICAgICBsZXQgbyA9IHRoaXMuX3RvRU1TT2JqZWN0KHRydWUsIHRydWUpOw0KICAgICAgICAgICAgaWYodGhpcy5fX2NvbmZpZygnZW1zLmRlZXAucXVlcnknKSkgbyA9IG5ldyA8JT1zY29wZSU+LkVudGl0eU9iamVjdCgpLlRISVMoW29dLmNvbmNhdChvYmpzLm1hcChfbyA9PiBfby5fdG9FTVNPYmplY3QodHJ1ZSwgdHJ1ZSkpKSk7DQogICAgICAgICAgICByZXQgPSBhd2FpdCB0aGlzLl9mcm9tRU1TVmFsdWVzKGF3YWl0IG5ldyA8JT1zY29wZSU+LkVudGl0eVZhbHVlKCkuYWN0aXZlKHRydWUpLmVudGl0eU9iamVjdChvKS48JT1tTmFtZSU+KCkpOw0KICAgICAgICAgICAgaWYodGhpcy5fX2NvbmZpZygnZW1zLmRlZXAucXVlcnknKSkgcmV0dXJuIHJldDsNCiAgICA8JSB9ZWxzZSBpZih0PT0iTWVtb3J5Iil7ICU+DQogICAgICAgICAgICByZXR1cm4gdGhpcy5Ub29sLmRiWzwlPV9uQ29kZSgpJT5dLmZpbHRlcihvID0+IG8gJiYgdGhpcy5fc2FtZUVudGl0eShvKSk7DQogICAgPCUgfWVsc2UgaWYodD09Ikh1YlNwb3QiKXsgJT4NCiAgICA8JSB9ZWxzZSBpZih0PT0iU2VydmljZU5vdyIpeyAlPg0KICAgICAgICAgICAgcmV0ID0gKGF3YWl0IHRoaXMuX3Jlc3QobnVsbCwge3N5c3Bhcm1fcXVlcnk6IHRoaXMuX3RvU05RdWVyeShmaWVsZHMsIG9ianMsIHRydWUpfSkpLnJlc3VsdDsNCiAgICA8JSB9ZWxzZSBpZih0PT0iU2FsZXNGb3JjZSIpeyAlPg0KICAgICAgICAgICAgcmV0ID0gYXdhaXQgdGhpcy5fcmVzdChudWxsLCBudWxsLCB0aGlzLl90b1NGUXVlcnkoZmllbGRzLCBvYmpzLCB0cnVlKSwgbnVsbCwge3VybDogJ3Jlc3QudXJsLmdxbCd9KTsNCiAgICA8JSB9ZWxzZSBpZihfZmlsZVRvb2xzLmluZGV4T2YodCk+LTEpeyAlPg0KICAgICAgICAgICAgbGV0IGROYW1lID0gJzwlPWFsaWFzKCkuc3BsaXQoJy4nKS5zbGljZSgxKS5qb2luKCcvJyklPi88JT1uTmFtZShjKSU+JzsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgbGV0IGRMaXN0ID0gYXdhaXQgdGhpcy5fPCU9dC50b0xvd2VyQ2FzZSgpJT4oZE5hbWUpOw0KDQogICAgICAgICAgICA8JT1sb2coKSU+ImROYW1lIiwgZE5hbWUsIHRoaXMuX3RvU3RyaW5nKCkgKyAnLmpzb24nLCAiZExpc3QiLCBkTGlzdCk7DQogICAgICAgICAgICBsZXQgaWR4TGlzdCA9IChkTGlzdCB8fCBbXSkuZmlsdGVyKHIgPT4gdHlwZW9mKHIubmFtZSkhPT0ndW5kZWZpbmVkJykubWFwKHIgPT4gbmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKGMsIHRydWUpJT4oKS5fZnJvbVN0cmluZyhyLm5hbWUucmVwbGFjZSgnLmpzb24nLCAnJykpKTsNCiAgICAgICAgICAgIDwlPWxvZygpJT4iaWR4TGlzdCIsIGlkeExpc3QsIGlkeExpc3QubWFwKHIgPT4gci5fdG9TdHJpbmcoKSArICcuanNvbicpKTsNCiAgICAgICAgICAgIGlkeExpc3QgPSBpZHhMaXN0LmZpbHRlcihyID0+IHIuX21hdGNoZXModGhpcywge29ubHlVbmlxdWU6IHRydWV9KSk7DQogICAgICAgICAgICA8JT1sb2coKSU+ImlkeExpc3QgZmlsdGVyZWQiLCBpZHhMaXN0KTsgDQoNCiAgICAgICAgICAgIGlmKGlkeExpc3QubGVuZ3RoPT0xKXsNCiAgICAgICAgICAgICAgICByZXQucHVzaChhd2FpdCB0aGlzLl88JT10LnRvTG93ZXJDYXNlKCklPihkTmFtZSArICcvJyArIChpZHhMaXN0WzBdLl90b1N0cmluZygpLnNwbGl0KCcvJykuc2xpY2UoLTEpLmpvaW4oJy8nKSArICcuanNvbicpKSk7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXQgPSBpZHhMaXN0Ow0KICAgICAgICAgICAgfQ0KICAgIDwlIH1lbHNlIGlmKHQ9PSJOZW80aiIpeyAlPg0KICAgICAgICAgICAgcmV0ID0gYXdhaXQgdGhpcy5fbmVvNGoodGhpcy5fdG9DeVF1ZXJ5KGZpZWxkcywgb2JqcykpOw0KICAgIDwlIH1lbHNlIGlmKHQ9PSJSZXN0REJJTyIpeyAlPg0KICAgICAgICAgICAgbGV0IHRoaXNEb2MgPSB0aGlzLl90b0RvY3VtZW50KHtiTWFwOiB0cnVlfSk7DQogICAgICAgICAgICBsZXQgZWFDb2RlID0gIiI7DQogICAgICAgIDwlICQuZWFjaChjLkVudGl0eUF0dHJpYnV0ZXMuZmlsdGVyKGVhID0+ICFlYS5FbnRpdHlNZXRob2QpLCAoXywgZWEpID0+IHslPg0KICAgICAgICAgICAgZWFDb2RlID0gPCU9X25Db2RlKGVhKSU+Ow0KICAgICAgICAgICAgaWYodGhpcy5fPCU9bk5hbWUoZWEpJT5fc2V0KXsNCiAgICAgICAgICAgIDwlIGlmKGVhLkVudGl0eVR5cGUpeyAlPg0KICAgICAgICAgICAgPCUgfWVsc2UgaWYoZWEuSXNBcnJheSl7ICU+DQogICAgICAgICAgICAgICAgaWYodGhpcy5fPCU9bk5hbWUoZWEpJT5fY29vcD09IiE9Iil7DQogICAgICAgICAgICAgICAgICAgIHRoaXNEb2NbZWFDb2RlXSA9IHsiJG5pbiI6IHRoaXNEb2NbZWFDb2RlXX07DQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIHRoaXNEb2NbZWFDb2RlXSA9IHsiJGluIjogdGhpc0RvY1tlYUNvZGVdfTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICA8JSB9ZWxzZSBpZihlYS5Jc1N0cmluZyB8fCBlYS5Jc1RleHQpeyAlPg0KICAgICAgICAgICAgICAgIGlmKFtudWxsLCAnJScsICdMSUtFJ10uaW5kZXhPZih0aGlzLl88JT1uTmFtZShlYSklPl9jb29wKT4tMSl7DQogICAgICAgICAgICAgICAgICAgIHRoaXNEb2NbZWFDb2RlXSA9IHsiJHJlZ2V4IjogdGhpc0RvY1tlYUNvZGVdIHx8ICIuKiJ9Ow0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIDwlIH0gJT4NCiAgICAgICAgICAgIH0NCiAgICAgICAgPCUgfSk7ICU+DQoNCiAgICAgICAgICAgIGxldCB1cmwgPSAiaHR0cHM6Ly8iICsgdGhpcy5fX2NvbmZpZygnZGF0YWJhc2UnKSArICIucmVzdGRiLmlvL3Jlc3QvIiArIDwlPV9uQ29kZSgpJT4udG9Mb3dlckNhc2UoKSArICI/cT0iICsgSlNPTi5zdHJpbmdpZnkoY29uZGl0aW9ucyk7DQogICAgICAgICAgICByZXQgPSAoYXdhaXQgYXhpb3MuZ2V0KHVybCwgew0KICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsNCiAgICAgICAgICAgICAgICAgICAgImNhY2hlLWNvbnRyb2wiOiAibm8tY2FjaGUiLA0KICAgICAgICAgICAgICAgICAgICAieC1hcGlrZXkiOiB0aGlzLl9fY29uZmlnKCdhcGlrZXknKSwNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9KSkuZGF0YTsNCiAgICA8JSB9ZWxzZSBpZih0PT0iQklTZXJ2ZXIiKXsgJT4NCiAgICAgICAgICAgIGxldCBxID0gew0KICAgICAgICAgICAgICAgIFRISVM6IHRoaXMuX2J1aWxkVGhpcyhkZXB0aCkuY29uY2F0KChvYmpzIHx8IFtdKS5tYXAob2JqID0+IG9iai50b0VudGl0eU9iamVjdD97DQogICAgICAgICAgICAgICAgICAgIEFjdGl2ZTogdHJ1ZSwNCiAgICAgICAgICAgICAgICAgICAgRW50aXR5T2JqZWN0OiBvYmoudG9FbnRpdHlPYmplY3QodHJ1ZSksDQogICAgICAgICAgICAgICAgfTpvYmopKSwNCiAgICAgICAgICAgICAgICBBY3RpdmU6IHRydWUsDQogICAgICAgICAgICAgICAgRW50aXR5T2JqZWN0OiB7IC8vIGFic29sdXRlbHkgcmVxdWlyZWQgZm9yIGluZGV4aW5nDQogICAgICAgICAgICAgICAgICAgIEFjdGl2ZTogdHJ1ZSwNCiAgICAgICAgICAgICAgICAgICAgRW50aXR5Q2xhc3M6IHRoaXMuX3ZhbHVlQ2xhc3MoKSwNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9Ow0KICAgICAgICAgICAgPCU9bG9nKCklPnEpOw0KICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2FzT2JqZWN0cygoYXdhaXQgdGhpcy5zcigpLl8oIkVudGVycHJpc2VNYW5hZ2VyLmVtc0VudGl0eVZhbHVlRmluZGFsbCIsIG51bGwsIHEpKSk7DQogICAgPCUgfSAlPg0KICAgICAgICB9DQo8JSB9KSU+DQoNCiAgICAgICAgPCU9bG9nKCklPiJCZWZvcmUgX2Zyb21Eb2N1bWVudCgpIiwgZGVwdGgsIHJldCk7DQogICAgICAgIA0KICAgICAgICBpZighQXJyYXkuaXNBcnJheShyZXQpKSByZXQgPSBbcmV0XTsNCiAgICAgICAgcmV0ID0gcmV0LmZpbHRlcihyID0+IHIpLm1hcChyID0+IG5ldyA8JT1zY29wZSU+LjwlPW5OYW1lKGMsIHRydWUpJT4oKS5fZnJvbURvY3VtZW50KHIsIHRydWUpKS5maWx0ZXIociA9PiByKS5tYXAociA9PiByLl9fc3luY19vbihuZXcgRGF0ZSgpKSk7DQoNCiAgICAgICAgaWYoZGVwdGg+MSl7DQogICAgICAgICAgICBmb3IgYXdhaXQgKGNvbnN0IHIgb2YgcmV0KXsNCjwlIGMuRW50aXR5QXR0cmlidXRlcy5maWx0ZXIoZWEgPT4gZWEuRW50aXR5VHlwZSAmJiAhZWEuRW50aXR5TWV0aG9kKS5mb3JFYWNoKGVhID0+IHslPg0KICAgICAgICAgICAgICAgIGlmKHIuXzwlPW5OYW1lKGVhKSU+X3NldCl7DQogICAgICAgICAgICAgICAgICAgIC8vIDwlPWxvZygpJT4iPCU9bk5hbWUoZWEpJT4iLCByLjwlPW5OYW1lKGVhKSU+KCkuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICAgICAgICAgIHIuPCU9bk5hbWUoZWEpJT4oYXdhaXQgci5fPCU9bk5hbWUoZWEpJT4uZmluZChkZXB0aC0xKSk7DQogICAgICAgICAgICAgICAgfQ0KPCUgfSklPg0KICAgIA0KPCUgYy5UeXBlZEF0dHJpYnV0ZXMuZm9yRWFjaCh0YSA9PiB7IGxldCB0YU5hbWUgPSBuTmFtZSh0YSkgKyAnXycgKyB0YS5FbnRpdHlDbGFzcy5QbHVyYWwucmVwbGFjZSgvIC9nLCAnXycpOyAlPg0KICAgIDwlIGNsc1Rvb2xzKGMpLmZvckVhY2godCA9PiB7JT4NCiAgICAgICAgICAgICAgICBpZih0aGlzLlRvb2wudHlwZS5uYW1lPT0iPCU9dCU+Iil7DQogICAgICAgIDwlIGlmKF9maWxlVG9vbHMuaW5kZXhPZih0KT49MCl7ICU+DQogICAgICAgICAgICAgICAgICAgIGxldCByXzwlPXRhTmFtZSU+ID0gW107DQogICAgICAgICAgICAgICAgICAgIGZvciBhd2FpdCAoY29uc3QgX3RhIG9mIHIuPCU9dGFOYW1lJT4oKSl7DQogICAgICAgICAgICAgICAgICAgICAgICA8JT1sb2coKSU+IjwlPXRhTmFtZSU+IiwgX3RhKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJfPCU9dGFOYW1lJT4ucHVzaChhd2FpdCBfdGEuZmluZChkZXB0aC0xKSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgci5jbGVhcl88JT10YU5hbWUlPigpOw0KICAgICAgICAgICAgICAgICAgICByLjwlPXRhTmFtZSU+KHJfPCU9dGFOYW1lJT4pOw0KICAgICAgICA8JSB9ZWxzZXsgJT4NCiAgICAgICAgICAgICAgICAgICAgLy8gPCU9bG9nKCklPiI8JT10YU5hbWUlPiIsIHIuPCU9dGFOYW1lJT4oKSk7DQogICAgICAgICAgICAgICAgICAgIHIuPCU9dGFOYW1lJT4oYXdhaXQgbmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKHRhLkVudGl0eUNsYXNzLCB0cnVlKSU+KCkuPCU9bk5hbWUodGEpJT4ocikNCiAgICAgICAgICAgIDwlIGlmKGZhbHNlICYmIFsnU3FsREInXS5pbmRleE9mKHQpPj0wKXsgLy8gc3FsIHN0YXRlbWVudHMgZG8gbm90IGluY2x1ZGUgbGVmdCBqb2lucyB3aXRob3V0IGV4cGxpY2l0IHJlZmVyZW5jZXMgJT4NCiAgICAgICAgICAgICAgICAgICAgICAgIDwldGEuRW50aXR5Q2xhc3MuRW50aXR5QXR0cmlidXRlcy5maWx0ZXIoZWEgPT4gIWVhLkVudGl0eU1ldGhvZCAmJiBlYS5FbnRpdHlUeXBlICYmIGVhIT10YSkuZm9yRWFjaChlYSA9PiB7JT4uPCU9bk5hbWUoZWEpJT4obmV3IDwlPXNjb3BlJT4uPCU9bk5hbWUoZWEuRW50aXR5VHlwZSwgdHJ1ZSklPigpKTwlfSklPg0KICAgICAgICAgICAgPCUgfSU+DQogICAgICAgICAgICAgICAgICAgICAgICAuPCU9bU5hbWUlPihkZXB0aC0xKSk7DQogICAgICAgIDwlIH0lPg0KICAgICAgICAgICAgICAgIH0NCiAgICA8JSB9KSU+DQo8JSB9KSU+DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBsZXQgcmVmcyA9IHJldC5maWx0ZXIociA9PiByLkVudGl0eUNsYXNzKTsNCiAgICAgICAgZm9yIGF3YWl0IChjb25zdCBvIG9mIChvYmpzIHx8IFtdKS5maWx0ZXIoX28gPT4gIV9vLl9fc3luY19vbigpKSl7DQogICAgICAgICAgICBpZihvLl90b0VNU09iamVjdCl7DQogICAgICAgICAgICAgICAgcmVmcy5wdXNoKC4uLihhd2FpdCB0aGlzLl9mcm9tRU1TVmFsdWVzKGF3YWl0IG8uX3RvRU1TT2JqZWN0KHRydWUsIHRydWUpLjwlPW1OYW1lJT4oZGVwdGgpKSkpOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmVmcy5wdXNoKC4uLihhd2FpdCBvLjwlPW1OYW1lJT4oZGVwdGgpKSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgcmVmcyA9IHJlZnMuZmlsdGVyKHIgPT4gcik7DQogICAgICAgIA0KICAgICAgICByZWZzLmZvckVhY2gociA9PiByLl9yZXNvbHZlKHJlZnMpKTsNCg0KICAgICAgICA8JT1sb2coKSU+Ik91dHB1dCIsIHJldCk7DQoNCiAgICAgICAgcmV0dXJuIHJldDsNCiAgICAgICAgICAgICAgICAvKioqIEVORCBMT0NBTCA8JT1tTmFtZSU+KCkgKioqLw0KICAgICAgICB9LCB7ZGVwdGgsIG9ianMsIHN0YXJ0LCBlbmQsIGZpZWxkcywgX19iZWZvcmVSdWxlczogWzwlKGMuRW50aXR5UnVsZXMgfHwgW10pLmZpbHRlcihyID0+IHJbbU5hbWVdICYmIHIuQmVmb3JlKS5tYXAociA9PiB7JT48JT1fRnJFTUQuX3RvSlMociklPjwlIH0pLmpvaW4oJywgJyklPl0sIF9fYWZ0ZXJSdWxlczogWzwlKGMuRW50aXR5UnVsZXMgfHwgW10pLmZpbHRlcihyID0+IHJbbU5hbWVdICYmIHIuQWZ0ZXIpLm1hcChyID0+IHslPjwlPV9GckVNRC5fdG9KUyhyKSU+PCUgfSkuam9pbignLCAnKSU+XX0pOw0KDQogICAgICAgIHJldHVybiAocmVzdWx0cy5maW5kKHIgPT4gci5yZXQpIHx8IHtyZXQ6IFtdfSkucmV0IHx8IFtdOyAvLyBmaXJzdCBvbmUgdG8gZXhlY3V0ZSBjb3JyZWN0bHkNCiAgICB9DQogICAgDQogICAgPCU9bU5hbWU9J19yZXNvbHZlJyU+KHJlZnMpew0KICAgICAgICB0cnl7DQogICAgICAgICAgICBpZighcmVmcy5sZW5ndGgpIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgDQogICAgICAgICAgICB0aGlzLl9faW1wb3J0KHt9LCB7DQogICAgPCUgYy5FbnRpdHlBdHRyaWJ1dGVzLmZpbHRlcihlYSA9PiAhZWEuRW50aXR5TWV0aG9kICYmIGVhLkVudGl0eVR5cGUpLmZvckVhY2goZWEgPT4geyAlPg0KICAgICAgICAgICAgICAgIDwlPW5OYW1lKGVhKSU+OiAoKSA9PiB7DQogICAgICAgICAgICAgICAgICAgIGlmKHRoaXMuPCU9bk5hbWUoZWEpJT4oKSl7DQogICAgICAgICAgICAgICAgICAgICAgICAvLyA8JT1sb2coKSU+IjwlPW5OYW1lKGVhKSU+IiwgdGhpcy48JT1uTmFtZShlYSklPigpLklkLCByZWZzLm1hcChyID0+ICh7aWQ6IHIuSWQsIGNvZGU6IHIuY29kZSgpfSkpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuPCU9bk5hbWUoZWEpJT4ocmVmcy5maW5kKG8gPT4gby5JZD09dGhpcy48JT1uTmFtZShlYSklPigpLklkKSB8fCB0aGlzLjwlPW5OYW1lKGVhKSU+KCkuPCU9bU5hbWUlPihyZWZzKSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9LA0KICAgIDwlIH0pJT4NCiAgICA8JSBjLlR5cGVkQXR0cmlidXRlcy5mb3JFYWNoKHRhID0+IHsgbGV0IHRhTmFtZSA9IG5OYW1lKHRhKSArICdfJyArIHRhLkVudGl0eUNsYXNzLlBsdXJhbC5yZXBsYWNlKC8gL2csICdfJyk7JT4NCiAgICAgICAgICAgICAgICA8JT10YU5hbWUlPjogKCkgPT4gew0KICAgICAgICAgICAgICAgICAgICBpZih0aGlzLjwlPXRhTmFtZSU+KCkubGVuZ3RoKSB0aGlzLjwlPXRhTmFtZSU+KHRoaXMuPCU9dGFOYW1lJT4oKS5tYXAodGEgPT4gcmVmcy5maW5kKG8gPT4gby5JZD09dGEuSWQpIHx8IHRhLjwlPW1OYW1lJT4ocmVmcykpLCBudWxsLCB0cnVlKTsNCiAgICAgICAgICAgICAgICB9LA0KICAgIDwlIH0pJT4NCiAgICAgICAgICAgIH0sICI8JT1tTmFtZSU+Iik7DQoNCiAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICB9Y2F0Y2goZXgpew0KICAgICAgICAgICAgPCU9ZXJyb3IoKSU+ZXgpOw0KICAgICAgICB9DQogICAgfQ0KICAgIA0KPCUgaWYobWFpbkNsYXNzKFsnRU1TJ10pKXslPg0KICAgIGFzeW5jIDwlPW1OYW1lPSdfZnJvbUVNU1ZhbHVlcyclPihldnMpew0KICAgIDwlIGlmKG1haW5DbGFzcyhbJ0VNUyddKT09Yyl7JT4NCiAgICAgICAgdHJ5ew0KICAgICAgICAgICAgYXdhaXQgdGhpcy5fZmluZFJlZmVyZW5jZXMoZXZzLCBbLi4ubmV3IFNldChldnMubWFwKHYgPT4gdi5lbnRpdHlBdHRyaWJ1dGUoKS5JZCkuZmxhdCgpKV0ubWFwKGlkID0+IG5ldyA8JT1zY29wZSU+LkVudGl0eUF0dHJpYnV0ZShpZCkpKTsNCiAgICAgICAgICAgIDwlPWxvZygpJT5ldnMpOw0KICAgICAgICANCiAgICAgICAgICAgIGxldCBvYmpzID0gW107DQogICAgICAgICAgICB0aGlzLmdyb3VwQnkoZXZzLCAiX2VudGl0eU9iamVjdCIpLmZvckVhY2goZXZnID0+IHsNCiAgICAgICAgICAgICAgICBldmcua2V5LmVudGl0eU9iamVjdF9FbnRpdHlWYWx1ZXMoZXZnLnZhbHVlcyk7DQogICAgICAgICAgICAgICAgb2Jqcy5wdXNoKGV2Zy5rZXkpOw0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIG9ianMuZm9yRWFjaChyID0+IHIuZW50aXR5Q2xhc3Moci5lbnRpdHlPYmplY3RfRW50aXR5VmFsdWVzKClbMF0uZW50aXR5QXR0cmlidXRlKCkuZW50aXR5Q2xhc3MoKSkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBsZXQgcmV0ID0gW107DQogICAgICAgICAgICBmb3IgYXdhaXQgKGNvbnN0IHIgb2Ygb2Jqcyl7DQogICAgICAgICAgICAgICAgcmV0LnB1c2goYXdhaXQgbmV3IDwlPXNjb3BlJT5bci5lbnRpdHlDbGFzcygpLm5hbWUoKV0oKS5fZnJvbUVNU09iamVjdChyKSk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIDwlPWxvZygpJT5yZXQpOw0KICAgICAgICAgICAgcmV0dXJuIHJldDsNCiAgICAgICAgfWNhdGNoKGV4KXsNCiAgICAgICAgICAgIDwlPWVycm9yKCklPmV4KTsNCiAgICAgICAgfQ0KICAgIDwlfWVsc2V7JT4NCiAgICAgICAgcmV0dXJuIGF3YWl0IG5ldyA8JT1zY29wZSU+LjwlPW5OYW1lKG1haW5DbGFzcyhbJ0VNUyddLGMpKSU+KCkuPCU9bU5hbWUlPihldnMpOw0KICAgIDwlfSU+DQogICAgfQ0KICAgIA0KICAgIDwlPW1OYW1lPSdfdG9FTVNDbGFzcyclPihkZXB0aCl7DQogICAgICAgIC8vIHdoeSBub3QgX19leHBvcnQgPw0KICAgICAgICB0cnl7DQogICAgICAgICAgICBsZXQgcmV0ID0gbmV3IDwlPXNjb3BlJT4uRW50aXR5Q2xhc3MoJzwlPWMuSWQlPicpLm5hbWUoIjwlPWMuTmFtZSU+IikuY29kZSgiPCU9bk5hbWUoYyklPiIpLmFjdGl2ZSh0cnVlKS5lbmFibGVkKHRydWUpLmRhdGUobmV3IERhdGUoKSkuY29tcGFueShuZXcgPCU9c2NvcGUlPi5Db21wYW55KCkubmFtZSgiPCU9c2NvcGUlPiIpLmNvZGUoIjwlPXNjb3BlJT4iKSkuZW50aXR5TW9kdWxlKG5ldyA8JT1zY29wZSU+LkVudGl0eU1vZHVsZSgpLmNvZGUoIjwlPXNjb3BlJT4iKS5uYW1lKCI8JT1zY29wZSU+IikpOw0KICAgICAgICAgICAgaWYoIWRlcHRoKSByZXR1cm4gcmV0Ow0KICAgICAgICAgICAgDQogICAgICAgICAgICByZXQuZW50aXR5Q2xhc3NfRW50aXR5TWV0aG9kcyhbDQogICAgPCUgYy5FbnRpdHlNZXRob2RzLmZvckVhY2gobSA9PiB7JT4NCiAgICAgICAgICAgICAgICBuZXcgPCU9c2NvcGUlPi5FbnRpdHlNZXRob2QoJzwlPW0uSWQlPicpLmFjdGl2ZSh0cnVlKS5lbmFibGVkKHRydWUpLm5hbWUoIjwlPW0uTmFtZSU+IikuY29kZSgiPCU9bk5hbWUobSklPiIpLmVudGl0eU1ldGhvZF9FbnRpdHlBdHRyaWJ1dGVzKFsNCiAgICAgICAgPCUgbS5NZXRob2RQYXJhbWV0ZXJzLmZvckVhY2gocCA9PiB7JT4NCiAgICAgICAgICAgICAgICAgICAgbmV3IDwlPXNjb3BlJT4uRW50aXR5QXR0cmlidXRlKCc8JT1wLklkJT4nKS5hY3RpdmUodHJ1ZSkuZW5hYmxlZCh0cnVlKS5uYW1lKCI8JT1wLk5hbWUlPiIpLmNvZGUoIjwlPW5OYW1lKHApJT4iKS5pc0FycmF5KDwlPXAuSXNBcnJheT8ndHJ1ZSc6J2ZhbHNlJyU+KS5yZW1hcmsoIjwlPWMuTmFtZSU+LjwlPW0uTmFtZSU+KCkiKS5lbnRpdHlDbGFzcyhuZXcgPCU9c2NvcGUlPi48JT1uTmFtZShjLCB0cnVlKSU+KCkuPCU9bU5hbWUlPigpKQ0KICAgICAgICAgICAgPCUgaWYocC5FbnRpdHlUeXBlKXslPg0KICAgICAgICAgICAgICAgICAgICAuZW50aXR5VHlwZShuZXcgPCU9c2NvcGUlPi48JT1uTmFtZShwLkVudGl0eVR5cGUpJT4oKS48JT1tTmFtZSU+KGRlcHRoLTEpKQ0KICAgICAgICAgICAgPCUgfWVsc2V7JT4NCiAgICAgICAgICAgICAgICAgICAgLmlzPCU9X0ZyRU1ELl9hdHRyKHApJT4odHJ1ZSkNCiAgICAgICAgICAgIDwlIH0lPiwNCiAgICAgICAgPCUgfSklPg0KICAgICAgICAgICAgICAgIF0pLnJlc3BvbnNlQXR0cmlidXRlKG5ldyA8JT1zY29wZSU+LkVudGl0eUF0dHJpYnV0ZSgnPCU9bS5SZXNwb25zZUF0dHJpYnV0ZS5JZCU+JykuYWN0aXZlKHRydWUpLmVuYWJsZWQodHJ1ZSkubmFtZSgiPCU9bS5SZXNwb25zZUF0dHJpYnV0ZS5OYW1lJT4iKS5jb2RlKCI8JT1uTmFtZShtLlJlc3BvbnNlQXR0cmlidXRlKSU+IikuZW50aXR5Q2xhc3MobmV3IDwlPXNjb3BlJT4uPCU9bk5hbWUoYywgdHJ1ZSklPigpLjwlPW1OYW1lJT4oKSkNCiAgICAgICAgPCUgaWYobS5SZXNwb25zZUF0dHJpYnV0ZS5FbnRpdHlUeXBlKXslPg0KICAgICAgICAgICAgICAgIC5lbnRpdHlUeXBlKG5ldyA8JT1zY29wZSU+LjwlPW5OYW1lKG0uUmVzcG9uc2VBdHRyaWJ1dGUuRW50aXR5VHlwZSklPigpLjwlPW1OYW1lJT4oZGVwdGgtMSkpDQogICAgICAgIDwlIH1lbHNleyU+DQogICAgICAgICAgICAgICAgLmlzPCU9X0ZyRU1ELl9hdHRyKG0uUmVzcG9uc2VBdHRyaWJ1dGUpJT4odHJ1ZSkNCiAgICAgICAgPCUgfSU+DQogICAgICAgICAgICAgICAgKSwNCiAgICA8JSB9KSU+DQogICAgICAgICAgICBdKS5lbnRpdHlDbGFzc19FbnRpdHlBdHRyaWJ1dGVzKFsNCiAgICA8JSBjLkVudGl0eUF0dHJpYnV0ZXMuZmlsdGVyKGVhID0+ICFlYS5FbnRpdHlNZXRob2QpLmZvckVhY2goZWEgPT4geyU+DQogICAgICAgICAgICAgICAgbmV3IDwlPXNjb3BlJT4uRW50aXR5QXR0cmlidXRlKCc8JT1lYS5JZCU+JykuYWN0aXZlKHRydWUpLmVuYWJsZWQodHJ1ZSkubmFtZSgiPCU9ZWEuTmFtZSU+IikuY29kZSgiPCU9bk5hbWUoZWEpJT4iKS5yZW1hcmsoJzwlPWMuTmFtZSU+LjwlPWVhLk5hbWUlPicpDQogICAgICAgIDwlIGlmKGVhLkVudGl0eVR5cGUpeyU+DQogICAgICAgICAgICAgICAgLmVudGl0eVR5cGUobmV3IDwlPXNjb3BlJT4uPCU9bk5hbWUoZWEuRW50aXR5VHlwZSwgdHJ1ZSklPigpLjwlPW1OYW1lJT4oZGVwdGgtMSkpDQogICAgICAgIDwlIH1lbHNleyU+DQogICAgICAgICAgICAgICAgLmlzPCU9X0ZyRU1ELl9hdHRyKGVhKSU+KHRydWUpDQogICAgICAgIDwlIH0lPiwNCiAgICA8JSB9KSU+DQogICAgICAgICAgICBdKTsNCiAgICAgICAgICAgIDwlPWxvZygpJT5yZXQpOw0KICAgICAgICAgICAgcmV0dXJuIHJldDsNCiAgICAgICAgfWNhdGNoKGV4KXsNCiAgICAgICAgICAgIDwlPWVycm9yKCklPmV4KTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIGFzeW5jIDwlPW1OYW1lPSdfZnJvbUVNU09iamVjdCclPihvYmopew0KICAgICAgICB0cnl7DQogICAgICAgICAgICB0aGlzLklkID0gb2JqLklkOw0KICAgICAgICAgICAgbGV0IGV2ID0gbnVsbDsNCiAgICA8JSBjLkVudGl0eUF0dHJpYnV0ZXMuZmlsdGVyKGVhID0+ICFlYS5FbnRpdHlNZXRob2QpLmZvckVhY2goZWEgPT4geyU+DQogICAgICAgICAgICBldiA9IG9iai5lbnRpdHlPYmplY3RfRW50aXR5VmFsdWVzKCkuZmluZChldiA9PiBldi5lbnRpdHlBdHRyaWJ1dGUoKS5jb2RlKCk9PTwlPV9uQ29kZShlYSklPik7DQogICAgICAgIDwlIGlmKGVhLkVudGl0eVR5cGUpeyU+DQogICAgICAgICAgICBpZihldikgdGhpcy48JT1uTmFtZShlYSklPihhd2FpdCBuZXcgPCU9c2NvcGUlPi48JT1uTmFtZShlYS5FbnRpdHlUeXBlLCB0cnVlKSU+KCkuPCU9bU5hbWUlPihldi5vYmplY3RWYWx1ZSgpKSk7DQogICAgICAgIDwlIH1lbHNleyU+DQogICAgICAgICAgICBpZihldikgdGhpcy48JT1uTmFtZShlYSklPihldi48JT1fRnJFTUQuX2F0dHIoZWEpLnRvTG93ZXJDYXNlKCklPlZhbHVlKCkpOw0KICAgICAgICA8JSB9JT4NCiAgICA8JSB9KSU+DQogICAgPCUgYy5UeXBlZEF0dHJpYnV0ZXMuZm9yRWFjaCh0YSA9PiB7IGxldCB0YU5hbWUgPSBuTmFtZSh0YSkgKyAnXycgKyB0YS5FbnRpdHlDbGFzcy5QbHVyYWwucmVwbGFjZSgvIC9nLCAnXycpOyU+DQogICAgPCUgfSklPg0KICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgIH1jYXRjaChleCl7DQogICAgICAgICAgICA8JT1lcnJvcigpJT5leCk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICA8JT1tTmFtZT0nX3RvRU1TT2JqZWN0JyU+KGJRdWVyeSwgYlR5cGVkQXR0cmlidXRlcyl7DQogICAgICAgIGxldCByZXQgPSBuZXcgPCU9c2NvcGUlPi5FbnRpdHlPYmplY3QoKS5hY3RpdmUodHJ1ZSkuZW50aXR5Q2xhc3ModGhpcy5fdG9FTVNDbGFzcygpKTsNCg0KICAgICAgICByZXQgPSB0aGlzLl9fZXhwb3J0KHJldCwgew0KICAgICAgICAgICAgRnVsbDogIWJRdWVyeSwNCiAgICAgICAgICAgIC8vTnVsbDogIWJRdWVyeSwNCiAgICAgICAgICAgIElkOiAob2JqLCBlYUNvZGUsIHYpID0+IG9iai5JZCA9IHYsDQogICAgPCUgYy5FbnRpdHlBdHRyaWJ1dGVzLmZpbHRlcihlYSA9PiAhZWEuRW50aXR5TWV0aG9kKS5mb3JFYWNoKGVhID0+IHsgJT4NCiAgICAgICAgICAgICI8JT1uTmFtZShlYSklPiI6IChvYmosIGVhQ29kZSwgdikgPT4gew0KICAgICAgICAgICAgICAgIGxldCBldiA9IG5ldyA8JT1zY29wZSU+LkVudGl0eVZhbHVlKCkuYWN0aXZlKHRydWUpLmVudGl0eUF0dHJpYnV0ZShuZXcgPCU9c2NvcGUlPi5FbnRpdHlBdHRyaWJ1dGUoJzwlPWVhLklkJT4nKS5hY3RpdmUodHJ1ZSkuZW5hYmxlZCh0cnVlKS5uYW1lKCI8JT1lYS5OYW1lJT4iKS5jb2RlKCI8JT1uTmFtZShlYSklPiIpLmVudGl0eUNsYXNzKHRoaXMuX3RvRU1TQ2xhc3MoKSkpOw0KICAgICAgICA8JSBpZihlYS5FbnRpdHlUeXBlKXslPg0KICAgICAgICAgICAgICAgIGV2Lm9iamVjdFZhbHVlKHY/di48JT1tTmFtZSU+KGJRdWVyeSwgYlR5cGVkQXR0cmlidXRlcyk6bnVsbCwgdGhpcy5fPCU9bk5hbWUoZWEpJT5fY29vcCk7DQogICAgICAgIDwlIH1lbHNleyU+DQogICAgICAgICAgICAgICAgZXYuPCU9X0ZyRU1ELl9hdHRyKGVhKS50b0xvd2VyQ2FzZSgpJT5WYWx1ZSh2LCB0aGlzLl88JT1uTmFtZShlYSklPl9jb29wKTsNCiAgICAgICAgPCUgfSU+DQogICAgICAgICAgICAgICAgb2JqLmVudGl0eU9iamVjdF9FbnRpdHlWYWx1ZXMoZXYsICc9PScpOw0KICAgICAgICAgICAgfSwNCiAgICA8JSB9KTsgJT4NCiAgICA8JSBjLlR5cGVkQXR0cmlidXRlcy5mb3JFYWNoKHRhID0+IHsgbGV0IHRhTmFtZSA9IG5OYW1lKHRhKSArICdfJyArIHRhLkVudGl0eUNsYXNzLlBsdXJhbC5yZXBsYWNlKC8gL2csICdfJyk7JT4NCiAgICAgICAgICAgIDwlPXRhTmFtZSU+OiAob2JqLCBlYUNvZGUsIHYpID0+IHsNCiAgICAgICAgICAgICAgICBpZih2ICYmIGJUeXBlZEF0dHJpYnV0ZXMpIG9iai5vYmplY3RWYWx1ZV9FbnRpdHlWYWx1ZXModi5tYXAoX3YgPT4gbmV3IDwlPXNjb3BlJT4uRW50aXR5VmFsdWUoKS5hY3RpdmUodHJ1ZSkuZW50aXR5QXR0cmlidXRlKG5ldyA8JT1zY29wZSU+LkVudGl0eUF0dHJpYnV0ZSgnPCU9dGEuSWQlPicpLmFjdGl2ZSh0cnVlKS5lbmFibGVkKHRydWUpLmNvZGUoIjwlPW5OYW1lKHRhKSU+IikubmFtZSgiPCU9dGEuTmFtZSU+IikuZW50aXR5Q2xhc3MobmV3IDwlPXNjb3BlJT4uPCU9bk5hbWUodGEuRW50aXR5Q2xhc3MsIHRydWUpJT4oKS5fdG9FTVNDbGFzcygpKSkub2JqZWN0VmFsdWUoX3YuPCU9bU5hbWUlPihiUXVlcnksIGJUeXBlZEF0dHJpYnV0ZXMpKSksICc9PScpOw0KICAgICAgICAgICAgfSwNCiAgICA8JSB9KSU+DQogICAgICAgIH0sICI8JT1tTmFtZSU+Iik7DQoNCiAgICAgICAgPCU9bG9nKCklPnJldCk7DQogICAgICAgIHJldHVybiByZXQ7DQogICAgfQ0KPCUgfSAlPg0KDQo8JSBpZihtYWluQ2xhc3MoWydCSVNlcnZlciddKSl7JT4NCiAgICA8JT1tTmFtZT0nX2FzT2JqZWN0cyclPihldnMpew0KICAgIDwlIGlmKG1haW5DbGFzcyhbJ0JJU2VydmVyJ10pIT1jKXslPg0KICAgICAgICAgICAgcmV0dXJuIG5ldyA8JT1zY29wZSU+LjwlPW5OYW1lKG1haW5DbGFzcyhbJ0JJU2VydmVyJ10sYykpJT4oKS48JT1tTmFtZSU+KGV2cyk7DQogICAgPCV9ZWxzZXslPg0KICAgICAgICB0cnl7DQogICAgICAgICAgICBpZih0eXBlb2YoZXZzKT09PSJ1bmRlZmluZWQiIHx8ICFldnMgfHwgIUFycmF5LmlzQXJyYXkoZXZzKSB8fCAhZXZzLmxlbmd0aCkgcmV0dXJuIFtdOw0KDQogICAgICAgICAgICBldnMuZm9yRWFjaChldiA9PiB7DQogICAgICAgICAgICAgICAgZXYuRW50aXR5QXR0cmlidXRlID0gPCU9c2NvcGUlPi5FbnRpdHlBdHRyaWJ1dGVzLmZpbmQoZWEgPT4gZWEuSWQ9PWV2LkVudGl0eUF0dHJpYnV0ZWlkKTsNCiAgICAgICAgICAgICAgICBldi5FbnRpdHlPYmplY3QuRW50aXR5Q2xhc3MgPSBldi5FbnRpdHlBdHRyaWJ1dGUuRW50aXR5Q2xhc3M7DQogICAgICAgICAgICAgICAgaWYoZXYuT2JqZWN0VmFsdWUpew0KICAgICAgICAgICAgICAgICAgICBldi5PYmplY3RWYWx1ZS5FbnRpdHlDbGFzcyA9IDwlPXNjb3BlJT4uRW50aXR5Q2xhc3Nlcy5maW5kKGVjID0+IGVjLklkPT1ldi5PYmplY3RWYWx1ZS5FbnRpdHlDbGFzcy5JZCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSk7DQogICAgDQogICAgICAgICAgICBsZXQgb2JqID0gW107DQogICAgICAgICAgICB0aGlzLmdyb3VwQnkoZXZzLCAiRW50aXR5T2JqZWN0IikuZm9yRWFjaChldmcgPT4gew0KICAgICAgICAgICAgICAgIGxldCBjID0gbmV3IDwlPXNjb3BlJT5bZXZnLmtleS5FbnRpdHlDbGFzcy5OYW1lLnJlcGxhY2UoLyAvZywgJ18nKV0oKTsNCiAgICAgICAgICAgICAgICBjLkVudGl0eVZhbHVlcyA9IGV2Zy52YWx1ZXM7DQogICAgICAgICAgICAgICAgYy5WYWx1ZUVudGl0aWVzID0gW107DQogICAgICAgICAgICAgICAgLy8gYy5FbnRpdHlDbGFzcyA9IGV2Zy5rZXkuRW50aXR5Q2xhc3M7DQogICAgICAgICAgICAgICAgYy5JZCA9IGV2Zy5rZXkuSWQ7DQogICAgICAgICAgICAgICAgZXZnLnZhbHVlcy5mb3JFYWNoKHYgPT4gdi5FbnRpdHlPYmplY3QgPSBjKTsNCiAgICAgICAgICAgICAgICBvYmoucHVzaChjKTsNCiAgICAgICAgICAgIH0pOw0KDQogICAgICAgICAgICBldnMuZmlsdGVyKGV2ID0+IGV2Lk9iamVjdFZhbHVlKS5mb3JFYWNoKGV2ID0+IHsNCiAgICAgICAgICAgICAgICB2YXIgX2YgPSBvYmouZmluZChvID0+IG8uSWQgPT0gZXYuT2JqZWN0VmFsdWUuSWQpOw0KICAgICAgICAgICAgICAgIGlmKF9mKSBfZi5WYWx1ZUVudGl0aWVzLnB1c2goZXYpOw0KICAgICAgICAgICAgICAgIGV2Lk9iamVjdFZhbHVlID0gX2Y7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgDQogICAgICAgICAgICBsZXQgcmV0ID0gW107DQogICAgICAgICAgICBvYmouZm9yRWFjaChvID0+IHsNCiAgICAgICAgICAgICAgICBpZihvLkVudGl0eUNsYXNzICYmIG8uRW50aXR5Q2xhc3MuSWQhPXRoaXMuRW50aXR5Q2xhc3MuSWQpIHJldHVybiB0cnVlOw0KICAgICAgICAgICAgICAgIHJldC5wdXNoKG8pOw0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIHJldHVybiByZXQubWFwKG8gPT4gby5fcmV2ZXJ0KCkpOw0KICAgICAgICB9Y2F0Y2goZXgpew0KICAgICAgICAgICAgPCU9ZXJyb3IoKSU+ZXgpOw0KICAgICAgICB9DQogICAgPCV9JT4NCiAgICB9DQogICAgDQogICAgPCU9bU5hbWU9J19yZXZlcnQnJT4oZW8pIHsNCiAgICAgICAgaWYgKGVvKSB7DQogICAgICAgICAgICAvLyByZXZlcnQgZnJvbSBzb3VyY2UgZGF0YQ0KICAgICAgICAgICAgaWYoZW8uRW50aXR5Q2xhc3MgJiYgKCh0aGlzLkVudGl0eUNsYXNzLklkICYmIGVvLkVudGl0eUNsYXNzLklkIT10aGlzLkVudGl0eUNsYXNzLklkKSB8fCAodGhpcy5FbnRpdHlDbGFzcy5OYW1lICYmIGVvLkVudGl0eUNsYXNzLk5hbWUhPXRoaXMuRW50aXR5Q2xhc3MuTmFtZSkpKXsNCiAgICAgICAgICAgICAgICA8JT1lcnJvcigpJT4iQ2Fubm90IHJldmVydCAiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5FbnRpdHlDbGFzcykgKyAiIGZyb20gIiArIGVvLkVudGl0eUNsYXNzLk5hbWUsIGVvKTsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHRoaXMuSWQgPSBlby5JZDsNCiAgICAgICAgICAgIHRoaXMuRW50aXR5VmFsdWVzID0gZW8uRW50aXR5VmFsdWVzIHx8IFtdOw0KICAgICAgICAgICAgdGhpcy5WYWx1ZUVudGl0aWVzID0gZW8uVmFsdWVFbnRpdGllcyB8fCBbXTsNCiAgICAgICAgICAgIHJldHVybiB0aGlzLjwlPW1OYW1lJT4oKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIGlmKHRoaXMuX19zeW5jX29uKCkgJiYgTWF0aC5hYnMoKG5ldyBEYXRlKCkuZ2V0VGltZSgpIC0gdGhpcy5fX3N5bmNfb24oKS5nZXRUaW1lKCkpIC8gMTAwMCkgPCA1KXsNCiAgICAgICAgICAgICAgICA8JT13YXJuKCklPiJPYmplY3QgYWxyZWFkeSByZXZlcnRlZCIsIHRoaXMuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9DQogICAgICAgICAgICB0aGlzLl9fc3luY19vbihuZXcgRGF0ZSgpKTsNCiAgICAgICAgDQogICAgICAgICAgICAvLyB1c2UgRW50aXR5VmFsdWVzIGFuZCBWYWx1ZUVudGl0aWVzIHRvIHJldmVydCB0aGUgYXR0cmlidXRlIHZhbHVlcw0KICAgICAgICAgICAgdGhpcy5FbnRpdHlWYWx1ZXMuZm9yRWFjaChldiA9PiB7DQogICAgICAgICAgICAgICAgbGV0IGVhID0gbnVsbDsNCiAgICAgICAgICAgICAgICB0cnl7DQogICAgICAgICAgICAgICAgICAgIGVhID0gPCU9c2NvcGUlPi5FbnRpdHlBdHRyaWJ1dGVzLmZpbHRlcihfZWEgPT4gX2VhLkVudGl0eUNsYXNzLk5hbWU9PSc8JT1jLk5hbWUlPicpLmZpbmQoX2VhID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmKGV2LkVudGl0eUF0dHJpYnV0ZWlkPT1fZWEuSWQpIHJldHVybiBfZWE7DQogICAgICAgICAgICAgICAgICAgICAgICBpZihldi5FbnRpdHlBdHRyaWJ1dGUpew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKGV2LkVudGl0eUF0dHJpYnV0ZS5JZD09X2VhLklkKSByZXR1cm4gX2VhOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKGV2LkVudGl0eUF0dHJpYnV0ZS5OYW1lPT1fZWEuTmFtZSkgcmV0dXJuIF9lYTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgICAgICBpZighZWEpew0KICAgICAgICAgICAgICAgICAgICAgICAgPCU9d2FybigpJT4idW5hYmxlIHRvIGRldGVjdCBhdHRyaWJ1dGUgZnJvbSB2YWx1ZSIsIGV2KTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfWNhdGNoKGV4KXsNCiAgICAgICAgICAgICAgICAgICAgPCU9ZXJyb3IoKSU+ZXYsIGV4KTsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGxldCB2ID0gZXZbKHRoaXNbIl9hdHRyIl0/dGhpczpfRnJFTUQpLl9hdHRyKGVhKSArICJWYWx1ZSJdOw0KICAgICAgICAgICAgICAgIGxldCBwID0gZWEuTmFtZS5yZXBsYWNlKC8gL2csICdfJyk7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgaWYodHlwZW9mKHRoaXNbcF0pIT09J2Z1bmN0aW9uJyl7DQogICAgICAgICAgICAgICAgICAgIDwlPXdhcm4oKSU+ImludmFsaWQgdHlwZSIsIGVhLCBwLCB2KTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICBpZih2ICYmIGVhLkVudGl0eVR5cGUgJiYgdHlwZW9mKHYpPT09J29iamVjdCcpew0KICAgICAgICAgICAgICAgICAgICA8JT1sb2coKSU+InJldmVydGluZyAiICsgZWEuTmFtZSwgdiwgbmV3IDwlPXNjb3BlJT5bZWEuRW50aXR5VHlwZS5OYW1lLnJlcGxhY2UoLyAvZywgJ18nKV0oKS48JT1tTmFtZSU+KHYpKTsNCiAgICAgICAgICAgICAgICAgICAgaWYoIXYuRW50aXR5VmFsdWVzKXsNCiAgICAgICAgICAgICAgICAgICAgICAgIDwlPXdhcm4oKSU+ImVtcHR5IHZhbHVlcyBmb3IgIiArIGVhLk5hbWUsIHYpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIHYgPSB2LjwlPW1OYW1lJT4/di48JT1tTmFtZSU+KCk6bmV3IDwlPXNjb3BlJT5bZWEuRW50aXR5VHlwZS5OYW1lLnJlcGxhY2UoLyAvZywgJ18nKV0oKS48JT1tTmFtZSU+KHYpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB0aGlzW3BdKHYpOw0KICAgICAgICAgICAgfSk7DQoNCiAgICAgICAgICAgIHRoaXMuVmFsdWVFbnRpdGllcy5maWx0ZXIodmUgPT4gdmUuRW50aXR5QXR0cmlidXRlKS5mb3JFYWNoKHZlID0+IHsNCiAgICAgICAgICAgICAgICB2YXIgdGEgPSA8JT1zY29wZSU+LkVudGl0eUF0dHJpYnV0ZXMuZmluZChlYSA9PiBlYS5JZD09dmUuRW50aXR5QXR0cmlidXRlLklkKTsNCiAgICAgICAgICAgICAgICBpZighdGEpIHJldHVybiBudWxsOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIHZhciB0YU5hbWUgPSB0YS5FbnRpdHlDbGFzcy5QbHVyYWwucmVwbGFjZSgvIC9nLCAnXycpOw0KDQogICAgICAgICAgICAgICAgbGV0IHYgPSB2ZS5FbnRpdHlPYmplY3Q7DQogICAgICAgICAgICAgICAgaWYodil7DQogICAgICAgICAgICAgICAgICAgIHYgPSB2LjwlPW1OYW1lJT4/di48JT1tTmFtZSU+KCk6bmV3IDwlPXNjb3BlJT5bdGEuRW50aXR5VHlwZS5OYW1lLnJlcGxhY2UoLyAvZywgJ18nKV0oKS48JT1tTmFtZSU+KHYpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB0aGlzW3RhLk5hbWUucmVwbGFjZSgvIC9nLCAiXyIpICsgIl8iICsgdGFOYW1lXSh2KTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgIH0NCiAgICANCiAgICA8JT1tTmFtZT0nX3ZhbHVlQ2xhc3MnJT4oKXsNCiAgICAgICAgbGV0IF9jbGFzcyA9IHtBY3RpdmU6IHRydWV9Ow0KICAgICAgICBpZih0aGlzLkVudGl0eUNsYXNzLkVudGl0eU1vZHVsZSl7DQogICAgICAgICAgICBfY2xhc3MuRW50aXR5TW9kdWxlID0gdGhpcy5FbnRpdHlDbGFzcy5FbnRpdHlNb2R1bGU7DQogICAgICAgIH1lbHNlew0KICAgICAgICAgICAgX2NsYXNzID0gew0KICAgICAgICAgICAgICAgIEFjdGl2ZTogdHJ1ZSwNCiAgICAgICAgICAgICAgICBDb21wYW55OiB7QWN0aXZlOiB0cnVlLCBFbmFibGVkOiB0cnVlLCBFbnRpdHlDbGFzc2VzOiBbdGhpcy5FbnRpdHlDbGFzc119DQogICAgICAgICAgICB9Ow0KICAgICAgICB9DQogICAgICAgIHJldHVybiBfY2xhc3M7DQogICAgfQ0KDQogICAgPCU9bU5hbWU9J190b1hNTCclPigpew0KICAgICAgICAvLyBhbiBvdmVybG9hZCBvZiB0aGUgc3IuX3RvWE1MDQogICAgICAgIGxldCByZXQgPSB7eG1sOiBgYH07DQogICAgICAgIHJldCA9IHRoaXMuX19leHBvcnQocmV0LCB7DQogICAgICAgICAgICBJZDogKG9iaiwgZWFDb2RlLCB2KSA9PiByZXQueG1sICs9IGA8JHt0aGlzLl9fY29uZmlnKCdpZEZpZWxkJyl8fCdJZCd9PiR7dn08LyR7dGhpcy5fX2NvbmZpZygnaWRGaWVsZCcpfHwnSWQnfT5gLA0KICAgIDwlIGMuRW50aXR5QXR0cmlidXRlcy5maWx0ZXIoZWEgPT4gIWVhLkVudGl0eU1ldGhvZCkuZm9yRWFjaChlYSA9PiB7ICU+DQogICAgICAgICAgICAiPCU9bk5hbWUoZWEpJT4iOiAob2JqLCBlYUNvZGUsIHYpID0+IHsNCiAgICAgICAgICAgICAgICByZXQueG1sICs9IGA8JHtlYUNvZGV9PmA7DQogICAgICAgIDwlIGlmKGVhLkVudGl0eVR5cGUpeyU+DQogICAgICAgICAgICAgICAgcmV0LnhtbCArPSB2P3YuPCU9bU5hbWUlPigpOm51bGw7DQogICAgICAgIDwlIH1lbHNleyU+DQogICAgICAgICAgICAgICAgcmV0LnhtbCArPSBgPCFbQ0RBVEFbJHt2fV1dPmA7DQogICAgICAgIDwlIH0lPg0KICAgICAgICAgICAgICAgIHJldC54bWwgKz0gYDwvJHtlYUNvZGV9PmA7DQogICAgICAgICAgICB9LA0KICAgIDwlIH0pOyAlPg0KICAgIDwlIGMuVHlwZWRBdHRyaWJ1dGVzLmZvckVhY2godGEgPT4geyBsZXQgdGFOYW1lID0gbk5hbWUodGEpICsgJ18nICsgdGEuRW50aXR5Q2xhc3MuUGx1cmFsLnJlcGxhY2UoLyAvZywgJ18nKTslPg0KICAgICAgICAgICAgPCU9dGFOYW1lJT46IChvYmosIGVhQ29kZSwgdikgPT4gew0KICAgICAgICAgICAgICAgIHJldC54bWwgKz0gYDwke2VhQ29kZX0+YCArIHYubWFwKF92ID0+ICc8T2JqZWN0PicgKyBfdi48JT1tTmFtZSU+KCkgKyAiPC9PYmplY3Q+Iikuam9pbignJykgKyBgPC8ke2VhQ29kZX0+YDsNCiAgICAgICAgICAgIH0sDQogICAgPCUgfSklPg0KICAgICAgICB9LCAiPCU9bU5hbWUlPiIpOw0KDQogICAgICAgIDwlPWxvZygpJT5yZXQpOw0KICAgICAgICByZXR1cm4gcmV0LnhtbDsNCiAgICB9DQoNCiAgICA8JT1tTmFtZT0nX2J1aWxkVGhpcyclPihkZXB0aD0xKXsNCiAgICAgICAgLy8gY2FuZGlkYXRlIGZvciBfX2V4cG9ydA0KICAgICAgICB2YXIgcmV0ID0gW3sNCiAgICAgICAgICAgIEFjdGl2ZTogdHJ1ZSwNCiAgICAgICAgICAgIEVudGl0eUF0dHJpYnV0ZToge0FjdGl2ZTogdHJ1ZSwgRW50aXR5Q2xhc3M6IHRoaXMuX3ZhbHVlQ2xhc3MoKX0sDQogICAgICAgICAgICBFbnRpdHlPYmplY3Q6IHRoaXMudG9FbnRpdHlPYmplY3QodHJ1ZSksDQogICAgICAgIH1dOw0KICAgICAgICBmb3IgKHZhciBpID0gMTsgaSA8PSBkZXB0aDsgaSsrKSB7DQogICAgICAgICAgICByZXQucHVzaCh7DQogICAgICAgICAgICAgICAgQWN0aXZlOiB0cnVlLA0KICAgICAgICAgICAgICAgIEVudGl0eU9iamVjdDogew0KICAgICAgICAgICAgICAgICAgICBBY3RpdmU6IHRydWUsDQogICAgICAgICAgICAgICAgICAgIFZhbHVlRW50aXRpZXM6IFtyZXRbaSAtIDFdXQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9DQogICAgICAgIA0KPCUgYy5UeXBlZEF0dHJpYnV0ZXMuZmlsdGVyKHRhID0+ICF0YS5FbnRpdHlNZXRob2QpLmZvckVhY2godGEgPT4geyU+DQogICAgICAgIGlmKGRlcHRoPjEpew0KICAgICAgICAgICAgbGV0IHYgPSBuZXcgPCU9c2NvcGUlPi48JT1uTmFtZSh0YS5FbnRpdHlDbGFzcywgdHJ1ZSklPigpLjwlPW5OYW1lKHRhKSU+KHRoaXMpOw0KICAgICAgICAgICAgcmV0LnB1c2goew0KICAgICAgICAgICAgICAgIEFjdGl2ZTogdHJ1ZSwNCiAgICAgICAgICAgICAgICBFbnRpdHlPYmplY3Q6IHY/di50b0VudGl0eU9iamVjdCh0cnVlKTpudWxsLA0KICAgICAgICAgICAgfSk7DQogICAgDQogICAgICAgICAgICByZXQucHVzaCh7DQogICAgICAgICAgICAgICAgRW50aXR5T2JqZWN0OiB7DQogICAgICAgICAgICAgICAgICAgIEFjdGl2ZTogdHJ1ZSwNCiAgICAgICAgICAgICAgICAgICAgVmFsdWVFbnRpdGllczogW3sNCiAgICAgICAgICAgICAgICAgICAgICAgIEFjdGl2ZTogdHJ1ZSwNCiAgICAgICAgICAgICAgICAgICAgICAgIEVudGl0eU9iamVjdDogdj92LnRvRW50aXR5T2JqZWN0KHRydWUpOm51bGwsDQogICAgICAgICAgICAgICAgICAgIH1dDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0NCjwlIH0pJT4NCiAgICAgICAgDQogICAgICAgIHJldHVybiByZXQ7DQogICAgfQ0KICAgIA0KICAgIDwlPW1OYW1lPSd0b0VudGl0eU9iamVjdCclPihiUXVlcnksIGJUeXBlZEF0dHJpYnV0ZXMpIHsNCiAgICAgICAgbGV0IHJldCA9IHtBY3RpdmU6IHRydWUsIEVudGl0eUNsYXNzOiB0aGlzLl92YWx1ZUNsYXNzKCksIEVudGl0eVZhbHVlczogW10sIFZhbHVlRW50aXRpZXM6IFtdfTsNCiAgICAgICAgaWYoIWJRdWVyeSkgcmV0LkRhdGUgPSB0aGlzLnNlcnZlckRhdGUoKTsgDQoNCiAgICAgICAgcmV0ID0gdGhpcy5fX2V4cG9ydChyZXQsIHsNCiAgICAgICAgICAgIEZ1bGw6ICFiUXVlcnksDQogICAgICAgICAgICBJZDogKG9iaiwgZWFDb2RlLCB2KSA9PiBvYmouSWQgPSB2LA0KICAgIDwlIGMuRW50aXR5QXR0cmlidXRlcy5maWx0ZXIoZWEgPT4gIWVhLkVudGl0eU1ldGhvZCkuZm9yRWFjaChlYSA9PiB7ICU+DQogICAgICAgICAgICAiPCU9bk5hbWUoZWEpJT4iOiAob2JqLCBlYUNvZGUsIHYpID0+IHsNCiAgICAgICAgICAgICAgICBsZXQgZXYgPSB7DQogICAgICAgICAgICAgICAgICAgIEFjdGl2ZTogdHJ1ZSwNCiAgICAgICAgICAgICAgICAgICAgRW50aXR5QXR0cmlidXRlOiB7DQogICAgICAgICAgICAgICAgICAgICAgICBJZDogPCU9c2NvcGUlPi5FbnRpdHlDbGFzc2VzLmZpbmQoYyA9PiBjLklkID0gdGhpcy5FbnRpdHlDbGFzcy5JZCkuRW50aXR5QXR0cmlidXRlcy5maW5kKGVhID0+IGVhLk5hbWU9PSc8JT1lYS5OYW1lJT4nKS5JZCwNCiAgICAgICAgICAgICAgICAgICAgICAgIEFjdGl2ZTogdHJ1ZSwNCiAgICAgICAgICAgICAgICAgICAgICAgIE5hbWU6ICI8JT1lYS5OYW1lJT4iLA0KICAgICAgICAgICAgICAgICAgICAgICAgRW50aXR5Q2xhc3M6IHRoaXMuX3ZhbHVlQ2xhc3MoKSwNCiAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAgICAgT1BFUkFUT1JTOiB7fSwNCiAgICAgICAgICAgICAgICB9Ow0KICAgICAgICA8JSBpZihlYS5FbnRpdHlUeXBlKXslPg0KICAgICAgICAgICAgICAgIGlmKHYpew0KICAgICAgICAgICAgICAgICAgICBldi5PYmplY3RWYWx1ZSA9IHYuPCU9bU5hbWUlPihiUXVlcnksIGJUeXBlZEF0dHJpYnV0ZXMpOw0KICAgICAgICAgICAgICAgICAgICBldi5PUEVSQVRPUlMuT2JqZWN0VmFsdWUgPSB0aGlzLl88JT1uTmFtZShlYSklPl9jb29wOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgPCUgfWVsc2V7JT4NCiAgICAgICAgICAgICAgICBldi48JT1fRnJFTUQuX2F0dHIoZWEpJT5WYWx1ZSA9IHY7DQogICAgICAgICAgICAgICAgZXYuT1BFUkFUT1JTLjwlPV9GckVNRC5fYXR0cihlYSklPlZhbHVlID0gdGhpcy5fPCU9bk5hbWUoZWEpJT5fY29vcDsNCiAgICAgICAgPCUgfSU+DQogICAgICAgICAgICAgICAgb2JqLlZhbHVlRW50aXRpZXMucHVzaChldik7DQogICAgICAgICAgICB9LA0KICAgIDwlIH0pOyAlPg0KICAgIDwlIGMuVHlwZWRBdHRyaWJ1dGVzLmZvckVhY2godGEgPT4geyBsZXQgdGFOYW1lID0gbk5hbWUodGEpICsgJ18nICsgdGEuRW50aXR5Q2xhc3MuUGx1cmFsLnJlcGxhY2UoLyAvZywgJ18nKTslPg0KICAgICAgICAgICAgPCU9dGFOYW1lJT46IChvYmosIGVhQ29kZSwgdikgPT4gew0KICAgICAgICAgICAgICAgIGlmKHYgJiYgYlR5cGVkQXR0cmlidXRlcykgb2JqLkVudGl0eVZhbHVlcy5wdXNoKHYubWFwKF92ID0+ICh7DQogICAgICAgICAgICAgICAgICAgIEFjdGl2ZTogdHJ1ZSwNCiAgICAgICAgICAgICAgICAgICAgRW50aXR5QXR0cmlidXRlOiB7DQogICAgICAgICAgICAgICAgICAgICAgICBJZDogJzwlPXRhLklkJT4nLA0KICAgICAgICAgICAgICAgICAgICAgICAgQWN0aXZlOiB0cnVlLA0KICAgICAgICAgICAgICAgICAgICAgICAgTmFtZTogIjwlPXRhLk5hbWUlPiIsDQogICAgICAgICAgICAgICAgICAgICAgICBFbnRpdHlDbGFzczogbmV3IDwlPXNjb3BlJT4uPCU9bk5hbWUodGEuRW50aXR5Q2xhc3MsIHRydWUpJT4oKS5fdmFsdWVDbGFzcygpLA0KICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICAgICBPYmplY3RWYWx1ZTogX3YuPCU9bU5hbWUlPihiUXVlcnksIGJUeXBlZEF0dHJpYnV0ZXMpLA0KICAgICAgICAgICAgICAgIH0pKSk7DQogICAgICAgICAgICB9LA0KICAgIDwlIH0pJT4NCiAgICAgICAgfSwgIjwlPW1OYW1lJT4iKTsNCg0KICAgICAgICA8JT1sb2coKSU+cmV0KTsNCiAgICAgICAgcmV0dXJuIHJldDsNCiAgICB9DQo8JSB9ICU+DQp9DQo=",
	"storedMethod": null,
	"__keys": ["name"],
	"active": true,
	"enabled": true,
	"__trMap": []
}