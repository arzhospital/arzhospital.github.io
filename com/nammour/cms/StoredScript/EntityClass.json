{
	"Id": "632a26045b1c638cce5ae0fd6f6e3004bb20d01f",
	"name": "EntityClass",
	"script": "PCUNCmxldCBhdXRoQ2xhc3MgPSBhckNsYXNzZXMuZmluZChfYyA9PiBfYy5FbnRpdHlNZXRob2RzLmZpbmQobSA9PiBtLk5hbWU9PSdhdXRob3JpemUnICYmIG0uSXNQdWJsaWMpKTsNCmxldCBlbXMgPSBhckNsYXNzZXMuZmluZChfYyA9PiBfYy5OYW1lPT0nRW50aXR5Q2xhc3MnKTsNCg0KLy8gdGhlIGRlZmF1bHQgU2V0X09uIGRhdGUgdG8gdXNlDQpsZXQgU2V0X09uID0gYG5ldyBEYXRlKClgOw0KDQpsZXQgX2I2NHRlc3QgPSBzID0+IHR5cGVvZihzKT09PSd1bmRlZmluZWQnPycnOmAvXihbMC05YS16QS1aK1wvXXs0fSkqKChbMC05YS16QS1aK1wvXXsyfT09KXwoWzAtOWEtekEtWitcL117M309KSk/JC8udGVzdCh0eXBlb2YoKCR7c318fCcnKS5zdWJzdHJpbmcpIT09J3VuZGVmaW5lZCc/JHtzfTonJylgOw0KDQpsZXQgX2RlZiA9IChzLCB2KSA9PiAlPjwlPXMlPiA9IHR5cGVvZig8JT1zJT4pIT09J3VuZGVmaW5lZCc/PCU9cyU+OjwlPXYlPjs8JQ0KDQpsZXQgX2RlZmF1bHRzID0gKG9iaj0ndGhpcycsIF9jPWMpID0+IF9jLkVudGl0eUF0dHJpYnV0ZXMuZmlsdGVyKGVhID0+ICFlYS5FbnRpdHlNZXRob2QgJiYgZWEuRGVmYXVsdCkuZm9yRWFjaChlYSA9PiB7JT4NCiAgICAgICAgICAgIGlmKCE8JT1vYmolPi5fPCU9bk5hbWUoZWEpJT5fc2V0KXsNCiAgICAgICAgICAgICAgICA8JT1vYmolPi48JT1uTmFtZShlYSklPig8JXZhbHVlT2YoZWEuRGVmYXVsdCklPik7DQogICAgICAgICAgICB9DQo8JSB9KTsNCg0KbGV0IGxvZyA9IChuLCBfdGhpcz0ndGhpcycpID0+IGAke190aGlzfS5sb2cobnVsbCwgdW5kZWZpbmVkLCAnJHtuIHx8IG1OYW1lfScsICdFbnRpdHlPYmplY3QnLCAwLCBgOw0KbGV0IHdhcm4gPSAobiwgX3RoaXM9J3RoaXMnKSA9PiBgJHtfdGhpc30ubG9nKG51bGwsIHVuZGVmaW5lZCwgJyR7biB8fCBtTmFtZX0nLCAnRW50aXR5T2JqZWN0JywgMSwgYDsNCmxldCBlcnJvciA9IChuLCBfdGhpcz0ndGhpcycpID0+IGAke190aGlzfS5sb2cobnVsbCwgdW5kZWZpbmVkLCAnJHtuIHx8IG1OYW1lfScsICdFbnRpdHlPYmplY3QnLCAyLCBgOw0KDQpsZXQgcWxUeXBlID0gKGVhLCBiSW5wdXQpID0+IHsNCiAgICBpZihlYS5Jc0Jvb2wpIHJldHVybiAnQm9vbGVhbic7DQogICAgLy9pZihlYS5Jc0RhdGUpIHJldHVybiAnRGF0ZVRpbWUnOw0KICAgIGlmKGVhLklzSW50IHx8IGVhLklzRmxvYXQpIHJldHVybiAnSW50JzsNCiAgICBpZihlYS5FbnRpdHlUeXBlKSByZXR1cm4gbk5hbWUoZWEuRW50aXR5VHlwZSkrKGJJbnB1dD8iSW5wdXQiOiIiKTsNCiAgICByZXR1cm4gJ1N0cmluZyc7DQp9Ow0KDQovLyB3aHkgaGFyZCBjb2RlZD8/Pw0KbGV0IF9yZXN0VG9vbHMgPSBbJ1NlcnZpY2VOb3cnLCAnU2FsZXNGb3JjZScsICdSZXN0REJJTycsICdHaXRIdWInLCAnRmlsZVN5c3RlbSddOw0KbGV0IF9zcWxUb29scyA9IFsnU3FsREInLCAnU2FsZXNGb3JjZScsICdTbm93Rmxha2UnXTsNCmxldCBfZmlsZVRvb2xzID0gWydHaXRIdWInLCAnRmlsZVN5c3RlbSddOw0KDQpsZXQgY2xzVG9vbHMgPSBfYyA9PiBfYy5Ub29scy5tYXAodCA9PiB0LnR5cGU/dC50eXBlLm5hbWU6KHQubmFtZSB8fCB0KSk7DQpsZXQgbWFpbkNsYXNzID0gKF9hclRvb2xzLCBfYz1jKSA9PiBhckNsYXNzZXMuZmluZChfX2MgPT4gKF9hclRvb2xzIHx8IGNsc1Rvb2xzKF9jKSkuZmluZCh0ID0+IGNsc1Rvb2xzKF9fYykuaW5jbHVkZXModCkpKSB8fCAoIShfYXJUb29scyB8fCBjbHNUb29scyhfYykpLmxlbmd0aCAmJiBhckNsYXNzZXNbMF0pOw0KDQpsZXQgX2VhVHlwZXMgPSAoX2M9YywgYkFsbCkgPT4gX0ZyRU1ELl90b0pTKE9iamVjdC5hc3NpZ24oe30sIC4uLl9jLkVudGl0eUF0dHJpYnV0ZXMuZmlsdGVyKGVhID0+ICFlYS5FbnRpdHlNZXRob2QgJiYgYkFsbD90cnVlOmVhLkVudGl0eVR5cGUpLm1hcChlYSA9PiAoe1tuTmFtZShlYSldOiBuTmFtZShlYS5FbnRpdHlUeXBlKSB8fCBfRnJFTUQuX2F0dHIoZWEpfSkpKSk7DQoNCmxldCBfY0ZpZWxkID0gKGVhLCBfYz1lYS5FbnRpdHlDbGFzcykgPT4gKChlYS5FbnRpdHlUeXBlPyhlYS5FbnRpdHlUeXBlLlR5cGVkQXR0cmlidXRlcy5maW5kKHRhID0+IHRhLkVudGl0eUNsYXNzPT1fYykgfHwgZWEuRW50aXR5Q2xhc3MuRW50aXR5QXR0cmlidXRlcy5maW5kKF9lYSA9PiBfZWEuRW50aXR5VHlwZT09X2MpKTpudWxsKSB8fCB7TmFtZTogIiJ9KS5OYW1lOw0KDQpsZXQgX2NOYW1lID0gKGNuPWMuTmFtZSwgYkFsaWFzKSA9PiB7DQogICAgaWYoY24uTmFtZSkgY24gPSBjbi5OYW1lOw0KICAgIGxldCBfYyA9IGFyQ2xhc3Nlcy5maW5kKGVjID0+IGVjLk5hbWU9PWNuKTsNCiAgICBpZighX2MpIHJldHVybiAnJzsNCiAgICByZXR1cm4gbk5hbWUoX2MsIGJBbGlhcyk7DQp9Ow0KDQpsZXQgYWxpYXMgPSAoY24sIGo9Jy4nKSA9PiAoc2NvcGUgKyAnLicgKyBfY05hbWUoY24sIHRydWUpLnJlcGxhY2UoX2NOYW1lKGNuKSwgJycpKS5zcGxpdCgnLicpLmZpbHRlcihuID0+IG4pLmpvaW4oaik7DQpsZXQgbnNjb3BlID0gYWxpYXMoJ05vZGUnKTsNCg0KbGV0IF92Q29kZSA9IGsgPT4geyU+KDwldmFsdWVPZihrLkNvZGUpJT4gfHwgKCI8JT1uQ29kZShrKSU+IikpPCV9Ow0KbGV0IF9uQ29kZSA9IChlYSwgYlR5cGVkKSA9PiBlYT8oInRoaXMuX25Db2RlKCciICsgbkNvZGUoZWEpICsgKGJUeXBlZD8oJ18nICsgZWEuRW50aXR5Q2xhc3MuUGx1cmFsLnJlcGxhY2UoLyAvZywgJ18nKSk6IiIpICArICInLCAiICsgKGJUeXBlZD9udWxsOl9GckVNRC5fdG9KUyhlYS5Db2RlKSkgKyAiKSIpOiJ0aGlzLl9uQ29kZSgpIjsNCmxldCBtUm91dGluZyA9IChjLCBtKSA9PiB7DQogICAgaWYgKCFjICYmIG0pIGMgPSBtLkVudGl0eUNsYXNzOw0KICAgIGlmICghbSAmJiAhYykgcmV0dXJuICIiOw0KICAgIGlmICghbSkgbSA9IGM7DQogICAgaWYgKCFtLlJvdXRpbmcgJiYgIWMuUm91dGluZykgcmV0dXJuICIiOw0KDQolPihfbm9kZSwgbWV0aG9kKSA9PiB7DQogICAgCWxldCBsb2cgPSAob2JqLCAuLi5tc2cpID0+IHRoaXMubG9nKCI8JT1uTmFtZShjKSU+Iiwgb2JqLCAiPCVtP20uTmFtZTonJyU+IiB8fCBtZXRob2QsICJSb3V0ZXIiLCAwLCAuLi5tc2cpOw0KICAgIAlsZXQgd2FybiA9IChvYmosIC4uLm1zZykgPT4gdGhpcy5sb2coIjwlPW5OYW1lKGMpJT4iLCBvYmosICI8JW0/bS5OYW1lOicnJT4iIHx8IG1ldGhvZCwgIlJvdXRlciIsIDEsIC4uLm1zZyk7DQogICAgCWxldCBlcnJvciA9IChvYmosIC4uLm1zZykgPT4gdGhpcy5sb2coIjwlPW5OYW1lKGMpJT4iLCBvYmosICI8JW0/bS5OYW1lOicnJT4iIHx8IG1ldGhvZCwgIlJvdXRlciIsIDIsIC4uLm1zZyk7DQogICAgCWxldCBvU2NvcGUgPSA8JT1hbGlhcygpJT47DQogICAgCWxldCBwU2NvcGUgPSA8JT1zY29wZSU+Ow0KICAgIAlsZXQgblNjb3BlID0gPCU9bnNjb3BlJT47DQoNCiAgICAgICAgdHJ5ew0KICAgICAgICA8JWZ1bmN0aW9uT2YobS5Sb3V0aW5nKSU+DQogICAgICAgIH1jYXRjaChleCl7DQogICAgICAgICAgICB3YXJuKGV4KTsNCiAgICAgICAgfQ0KfQ0KPCV9Ow0KDQpsZXQgbU5hbWUgPSAnJzsNCg0KbGV0IGZ1bmN0aW9uT2YgPSAoZnVuLCBfdGhpcz0ndGhpcycpID0+IHslPg0KICAgICAgICBsZXQgX19yZXQgPSB1bmRlZmluZWQ7DQogICAgPCUgaWYoZnVuKXslPg0KICAgICAgICA8JSBpZih0eXBlb2YoZnVuKT09PSdvYmplY3QnKXslPg0KICAgICAgICAgICAgPCUgY2xzVG9vbHMoYykuZm9yRWFjaCh0ID0+IHslPg0KICAgICAgICBpZig8JT1fdGhpcyU+LlRvb2wgJiYgPCU9X3RoaXMlPi5Ub29sLnR5cGUubmFtZT09IjwlPXQlPiIpew0KICAgICAgICAgICAgICAgIDwlIGlmKHR5cGVvZihmdW5bdF0pPT09J2Z1bmN0aW9uJyl7JT4NCiAgICAgICAgICAgIF9fcmV0ID0gPCU9ZnVuW3RdJT47DQogICAgICAgICAgICAgICAgPCUgfWVsc2V7JT4NCiAgICAgICAgICAgIF9fcmV0ID0gPCU9KEpTT04uc3RyaW5naWZ5KGZ1blt0XSkgfHwgJyIiJyklPjsNCiAgICAgICAgICAgICAgICA8JSB9JT4NCiAgICAgICAgfQ0KICAgICAgICAgICAgPCUgfSklPg0KICAgICAgICA8JSB9ZWxzZXslPg0KICAgICAgICAgICAgX19yZXQgPSA8JT1mdW4lPjsNCiAgICAgICAgPCUgfSU+DQogICAgPCUgfSU+DQogICAgICAgIGlmKHR5cGVvZihfX3JldCk9PT0nc3RyaW5nJyAmJiBfX3JldC5zdGFydHNXaXRoKCJzKCIpICYmIF9fcmV0LmVuZHNXaXRoKCIpIikpew0KICAgICAgICAgICAgX19yZXQgPSB0aGlzLnJ1blNjcmlwdChfX3JldC5zbGljZSgyLC0xKSk7DQogICAgICAgIH0NCiAgICAgICAgaWYodHlwZW9mKF9fcmV0KT09PSJmdW5jdGlvbiIpew0KICAgICAgICAgICAgX19yZXQgPSBfX3JldCg8JT1fdGhpcyU+KTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gX19yZXQ7DQo8JX07DQoNCmxldCB2YWx1ZU9mID0gKGZ1biwgX3RoaXM9J3RoaXMnKSA9PiB7JT4oKA0KKG9TY29wZSkgPT4gew0KICAgIHRyeXsNCjwlZnVuY3Rpb25PZihmdW4sIF90aGlzKSU+DQogICAgfWNhdGNoKF92T2ZFeCl7DQogICAgICAgIDwlPXdhcm4oKSU+J3ZhbHVlT2YnLCBfdk9mRXgsIDwlPV9GckVNRC5fdG9KUyhmdW4pJT4pOw0KICAgIH0NCn0NCikoPCU9YWxpYXMoKSU+KSk8JX07DQoNCmxldCB1blJlY3Vyc2UgPSAob2JqLCBmdW4sIGZBcmdzPSdhcmd1bWVudHMnLCBzUmV0LCB2YWxpZGl0eT1gdGhpcy5fX2NvbmZpZygndW5SZWN1cnNlLnZhbGlkaXR5JywgMC41KWAsIGlkZikgPT4gew0KICAgIGlkZiA9IGlkZiB8fCBgKHRoaXM/dGhpcy5fX2NvbmZpZygnaWRGaWVsZCcsICdJZCcpOidJZCcpYDsNCiAgICBmdW4gPSBmdW4gfHwgYCIke21OYW1lfSJgOw0KICAgIHNSZXQgPSBgDQogICAgICAgIHRyeXsNCiAgICAgICAgICAgIGlmKHYpew0KICAgICAgICAgICAgICAgIHYuZGF0ZSA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpOw0KICAgICAgICAgICAgICAgIHYucmV1c2VkKys7DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgICR7c1JldH0NCiAgICAgICAgfWNhdGNoKHNSZXRfZXgpew0KICAgICAgICAgICAgdGhpcy5sb2cobnVsbCwgdW5kZWZpbmVkLCAke2Z1bn0sICcke21OYW1lfS51blJlY3Vyc2UnLCAxLCAnc1JldCcsIHNSZXRfZXgpOw0KICAgICAgICB9ZmluYWxseXsNCiAgICAgICAgICAgIGlmKHYgJiYgdi5yZXVzZWQ+MSkgcmV0dXJuIHY/di5vYmo6djsNCiAgICAgICAgfQ0KICAgIGA7DQogICAgbGV0IGJEYW5nZXIgPSAoKSA9PiAlPihbIl90b0hhc2giXS5pbmRleE9mKDwlPWZ1biU+KT49MCk8JTsNCiU+DQogICAgICAgIGxldCB2ID0gdW5kZWZpbmVkOw0KICAgICAgICB0cnl7DQogICAgICAgICAgICA8JT1zY29wZSU+LnVuUmVjdXJzZUFib3J0ID0gPCU9c2NvcGUlPi51blJlY3Vyc2VBYm9ydCB8fCB7fTsNCiAgICAgICAgICAgIGlmKDwlPXNjb3BlJT4udW5SZWN1cnNlQWJvcnRbPCU9ZnVuJT5dKXsNCiAgICAgICAgICAgICAgICA8JT13YXJuKGAke21OYW1lfS51blJlY3Vyc2VgKSU+YEFib3J0aW5nIGFzIHBlciA8JT1zY29wZSU+LnVuUmVjdXJzZUFib3J0LiR7PCU9ZnVuJT59YCk7DQogICAgICAgICAgICAgICAgPCU9c1JldCU+DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGxldCBfaWQgPSBudWxsOw0KICAgICAgICAgICAgaWYodHlwZW9mKDwlPW9iaiU+KT09PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICA8JT13YXJuKGAke21OYW1lfS51blJlY3Vyc2VgKSU+Ik51bGwgaW5wdXQiLCA8JT1vYmolPiwgPCU9ZnVuJT4sIDwlPWZBcmdzJT4pOw0KICAgICAgICAgICAgICAgIHJldHVybiA8JT1vYmolPjsNCiAgICAgICAgICAgIH1lbHNlIGlmKHR5cGVvZig8JT1vYmolPik9PT0nc3RyaW5nJyl7DQogICAgICAgICAgICAgICAgX2lkID0gdGhpcy5oYXNoQ29kZSg8JT1vYmolPik7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICBfaWQgPSA8JT1vYmolPls8JT1pZGYlPl07DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZihfaWQpPT09J3VuZGVmaW5lZCcgfHwgIV9pZCl7DQogICAgICAgICAgICAgICAgaWYoPCU9b2JqJT4uSWQgJiYgPCU9b2JqJT4uSWQ9PTwlPW9iaiU+LklkKXsNCiAgICAgICAgICAgICAgICAgICAgX2lkID0gPCU9b2JqJT4uSWQ7DQogICAgICAgICAgICAgICAgfWVsc2UgaWYodGhpcy5JZD09dGhpcy5JZCl7DQogICAgICAgICAgICAgICAgICAgIF9pZCA9IHRoaXMuSWQ7DQogICAgICAgICAgICAgICAgfWVsc2UgaWYodGhpcy5TZXRfT24pew0KICAgICAgICAgICAgICAgICAgICBfaWQgPSB0aGlzLl90b0hhc2goPCU9ZkFyZ3MlPiwge29ubHlVbmlxdWU6IHRydWV9LCA8JT1mdW4lPik7DQogICAgICAgICAgICAgICAgICAgIDwlPWxvZyhgJHttTmFtZX0udW5SZWN1cnNlYCklPiJ0aGlzLmhhc2hlZF9pZCIsIF9pZCwgPCU9ZnVuJT4sIDwlPWZBcmdzJT4pOw0KICAgICAgICAgICAgICAgIH1lbHNlIGlmKDwlPW9iaiU+LkVudGl0eUNsYXNzKXsNCiAgICAgICAgICAgICAgICAgICAgX2lkID0gPCU9b2JqJT4uRW50aXR5Q2xhc3MuSWQgfHwgPCU9b2JqJT4uRW50aXR5Q2xhc3MuTmFtZSB8fCB0aGlzLl90b0hhc2goPCU9ZkFyZ3MlPiwge2RlcHRoOiA8JWJEYW5nZXIoKSU+PzM6dW5kZWZpbmVkfSwgPCU9ZnVuJT4pOw0KICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICBfaWQgPSB0aGlzLkVudGl0eUNsYXNzLklkIHx8ICI8JT1jLklkJT4iIHx8IHRoaXMuX3RvSGFzaCg8JT1mQXJncyU+LCB7ZGVwdGg6IDwlYkRhbmdlcigpJT4/Mzp1bmRlZmluZWR9LCA8JT1mdW4lPikgfHwgIk5VTEwiOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgLy8gaWYoIjwlPW5OYW1lKGMpJT4iPT0iVXNlciIgJiYgPCU9ZnVuJT49PSJfdG9TTkZsb3ciKSA8JT13YXJuKGAke21OYW1lfS51blJlY3Vyc2VgKSU+Il9pZCIsIF9pZCwgPCU9ZnVuJT4sIDwlPWZBcmdzJT4pOw0KICAgICAgICAgICAgDQogICAgICAgIAk8JT1zY29wZSU+Ll91blJlY3Vyc2UgPSA8JT1zY29wZSU+Ll91blJlY3Vyc2UgfHwge307DQogICAgICAgIAk8JT1zY29wZSU+Ll91blJlY3Vyc2UuPCU9bk5hbWUoYyklPiA9IDwlPXNjb3BlJT4uX3VuUmVjdXJzZS48JT1uTmFtZShjKSU+IHx8IHt9Ow0KICAgICAgICAJPCU9c2NvcGUlPi5fdW5SZWN1cnNlLjwlPW5OYW1lKGMpJT5bPCU9ZnVuJT5dID0gPCU9c2NvcGUlPi5fdW5SZWN1cnNlLjwlPW5OYW1lKGMpJT5bPCU9ZnVuJT5dIHx8IHt9Ow0KICAgICAgICAJPCU9c2NvcGUlPi5fdW5SZWN1cnNlLjwlPW5OYW1lKGMpJT5bPCU9ZnVuJT5dW19pZF0gPSA8JT1zY29wZSU+Ll91blJlY3Vyc2UuPCU9bk5hbWUoYyklPls8JT1mdW4lPl1bX2lkXSB8fCB7fTsNCiAgICAgICAgCQ0KICAgICAgICAgICAgdiA9IDwlPXNjb3BlJT4uX3VuUmVjdXJzZS48JT1uTmFtZShjKSU+WzwlPWZ1biU+XVtfaWRdOw0KDQogICAgICAgICAgICBpZih2ICYmIE1hdGguYWJzKG5ldyBEYXRlKCkuZ2V0VGltZSgpIC0gdi5kYXRlKSA8ICgxMDAwKjwlPXZhbGlkaXR5JT4pKXsNCiAgICAgICAgICAgICAgICBpZigoPCViRGFuZ2VyKCklPj9uZXcgRGF0ZSgwKToodGhpcy5TZXRfT24gfHwgbmV3IERhdGUoMCkpKS5nZXRUaW1lKCkgPiB2LmRhdGUpew0KICAgICAgICAgICAgICAgICAgICA8JT1sb2coYCR7bU5hbWV9LnVuUmVjdXJzZWApJT5gU3Bhd25pbmcgaW4gJHs8JT1mdW4lPn1gLCBfaWQsIDwlPWZ1biU+LCA8JT1vYmolPiwgdi5yZXVzZWQsIDwlPXZhbGlkaXR5JT4pOw0KICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICA8JT1sb2coYCR7bU5hbWV9LnVuUmVjdXJzZWApJT4iU2VsZWN0ZWQgaGFzaCIsIF9pZCwgPCU9ZnVuJT4sIDwlPW9iaiU+LCB2LnJldXNlZCwgPCU9dmFsaWRpdHklPik7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIDwlPXNSZXQlPg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICA8JT1sb2coYCR7bU5hbWV9LnVuUmVjdXJzZWApJT4iUHVzaGluZyBoYXNoIiwgX2lkLCA8JT1mdW4lPiwgPCU9b2JqJT4pOw0KICAgICAgICAJdiA9IDwlPXNjb3BlJT4uX3VuUmVjdXJzZS48JT1uTmFtZShjKSU+WzwlPWZ1biU+XVtfaWRdID0gew0KICAgICAgICAgICAgICAgIGRhdGU6IG5ldyBEYXRlKCkuZ2V0VGltZSgpLA0KICAgICAgICAgICAgICAgIGFyZ3M6IEpTT04uc3RyaW5naWZ5KDwlPWZBcmdzJT4pLA0KICAgICAgICAgICAgICAgIG9iajogPCU9b2JqJT4sDQogICAgICAgICAgICAgICAgcmV1c2VkOiAwLA0KICAgICAgICAgICAgICAgIHBhdGg6ICcnLA0KICAgICAgICAgICAgICAgIF9pZCwNCiAgICAgICAgICAgIH07DQogICAgICAgICAgICANCiAgICAgICAgICAgIDwlLypleHBlcmltZW50YWw6IHJlbW92ZSB0aGlzIGlmIGFsbCBnb2VzIHdyb25nKi8lPg0KICAgICAgICAgICAgPCU9c1JldCU+DQogICAgCX1jYXRjaCh1blJlY0V4KXsNCiAgICAJICAgIGlmKCF1blJlY0V4LnRvU3RyaW5nKCkuaW5kZXhPZignUmFuZ2VFcnJvcjogJykpew0KICAgIAkgICAgICAgIDwlPXNjb3BlJT4udW5SZWN1cnNlQWJvcnRbPCU9ZnVuJT5dID0gdHJ1ZTsNCiAgICAJICAgIH0NCiAgICAJICAgIDwlPWVycm9yKGAke21OYW1lfS51blJlY3Vyc2VgKSU+PCU9b2JqJT4sIDwlPWZ1biU+LCA8JT1mQXJncyU+LCB1blJlY0V4LnRvU3RyaW5nKCkpOw0KICAgIAkgICAgPCU9c1JldCU+DQogICAgCX0NCjwlDQp9Ow0KDQpsZXQgaW52b2tlUnVsZSA9IHIgPT4gew0KJT4NCmF3YWl0IChhc3luYyAoYXV0aE9iaikgPT4gew0KICAgIGxldCBfcnVsZSA9IDwlPV9GckVNRC5fdG9KUyhyKSU+Ow0KICAgIGRlbGV0ZSBfcnVsZS5TY3JpcHQ7DQogICAgLy8gcnVsZVJ1bnMucHVzaChfcnVsZSk7DQogICAgdHJ5ew0KICAgICAgICA8JT1yLlNjcmlwdCU+DQogICAgfWNhdGNoKGV4KXsNCiAgICAgICAgX3J1bGUuRXhjZXB0aW9uID0gZXg7DQogICAgfQ0KfSkoYXV0aE9iaik7DQo8JQ0KfQ0KJT4NCg0KY2xhc3MgPCU9bk5hbWUoYyklPiB7DQogICAgPCU9bU5hbWU9J2NvbnN0cnVjdG9yJyU+KGlkLCB0b29sKSB7DQogICAgICAgIC8vc3VwZXIoaWQsIHRvb2wpOw0KDQogICAgICAgIHRoaXMuU2NvcGUgPSAiPCU9c2NvcGUlPiI7DQogICAgICAgIHRoaXMuRGVidWcgPSA8JT1fRnJFTUQuX3RvSlMoYy5EZWJ1ZyklPjsNCiAgICAgICAgdGhpcy5Db25maWcgPSA8JT1fRnJFTUQuX3RvSlMoYy5Db25maWcpJT47DQogICAgICAgIHRoaXMuVGVzdCA9IDwlPV9GckVNRC5fdG9KUyhjLlRlc3QpJT47DQogICAgICAgIHRoaXMuVG9vbHMgPSA8JT1fRnJFTUQuX3RvSlMoYy5Ub29scyklPjsNCiAgICAgICAgdGhpcy5NYXBwaW5ncyA9IDwlPV9GckVNRC5fdG9KUyhjLk1hcHBpbmdzKSU+Ow0KDQogICAgICAgIC8vIGF2b2lkIHN1cGVyLCBrZWVwIHRoaXMgaGVyZQ0KICAgICAgICB0aGlzLl9fSUQgPSB0aGlzLl9fSUQgfHwge307DQogICAgICAgIHRoaXMuVG9vbCA9IHRvb2w7DQogICAgICAgIHRoaXMuSWQgPSBpZDsNCg0KICAgICAgICB0aGlzLlZhbHVlRW50aXRpZXMgPSBbXTsNCg0KICAgICAgICB0aGlzLkRhdGUgPSBudWxsOw0KDQogICAgICAgIHRoaXMuY2xlYXJfVEhJUygpOw0KICAgICAgICB0aGlzLkVudGl0eVZhbHVlcyA9IFtdOw0KPCUgYy5FbnRpdHlBdHRyaWJ1dGVzLmZpbHRlcihlYSA9PiAhZWEuRW50aXR5TWV0aG9kKS5mb3JFYWNoKGVhID0+IHslPg0KICAgICAgICB0aGlzLkVudGl0eVZhbHVlcy5wdXNoKHsNCiAgICAgICAgICAgIEVudGl0eUF0dHJpYnV0ZTogew0KPCUgaWYoTnVtYmVyKGVhLklkKSl7JT4NCiAgICAgICAgICAgICAgICBJZDogIjwlPWVhLklkJT4iLA0KPCUgfSU+DQogICAgICAgICAgICAgICAgTmFtZTogIjwlPWVhLk5hbWUlPiIsDQogICAgICAgICAgICAgICAgT1BFUkFUT1JTOiB7TmFtZTogIj0ifSwNCiAgICAgICAgICAgICAgICBFbnRpdHlDbGFzczogdGhpcy5FbnRpdHlDbGFzcywNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICBPUEVSQVRPUlM6IHt9DQogICAgICAgIH0pOw0KICAgICAgICB0aGlzLmNsZWFyXzwlPW5OYW1lKGVhKSU+KCk7DQo8JSB9KTsgJT4NCg0KPCUgYy5UeXBlZEF0dHJpYnV0ZXMuZmlsdGVyKHRhID0+ICF0YS5FbnRpdHlNZXRob2QpLmZvckVhY2godGEgPT4geyU+DQogICAgICAgIHRoaXMuY2xlYXJfPCU9bk5hbWUodGEpJT5fPCU9dGEuRW50aXR5Q2xhc3MuUGx1cmFsLnJlcGxhY2UoLyAvZywgJ18nKSU+KCk7DQo8JSB9KTsgJT4NCiAgICB9DQogICAgDQogICAgPCU9bU5hbWU9J19kZWZhdWx0cyclPigpew0KPCVfZGVmYXVsdHMoKSU+DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgIH0NCiAgICANCiAgICA8JT1tTmFtZT0nZ2V0IEVudGl0eUNsYXNzJyU+KCl7DQogICAgICAgIGxldCBlYyA9IHsNCjwlIGlmKE51bWJlcihjLklkKSl7JT4NCiAgICAgICAgICAgIElkOiAiPCU9Yy5JZCU+IiwNCjwlIH0lPg0KICAgICAgICAgICAgTmFtZTogIjwlPWMuTmFtZSU+IiwNCiAgICAgICAgICAgIE9QRVJBVE9SUzoge05hbWU6ICI9In0sDQogICAgICAgIH07DQoNCjwlIGlmKGMuRW50aXR5TW9kdWxlaWQpeyAlPg0KICAgICAgICBlYy5FbnRpdHlNb2R1bGUgPSB7DQogICAgICAgICAgICBJZDogPCU9Yy5FbnRpdHlNb2R1bGVpZCU+DQogICAgICAgIH07DQo8JSB9JT4NCg0KICAgICAgICAvLyB0aGF0J3Mgd2h5IHdlIG5lZWQgaXQgYXMgYSBnZXR0ZXINCiAgICAgICAgaWYoIU51bWJlcihlYy5JZCkgJiYgPCU9c2NvcGUlPi5FbnRpdHlDbGFzc2VzKXsNCiAgICAgICAgICAgIGxldCBjaWQgPSA8JT1zY29wZSU+LkVudGl0eUNsYXNzZXMuZmluZChjID0+IE51bWJlcihjLklkKSAmJiBjLk5hbWU9PWVjLk5hbWUpOw0KICAgICAgICAgICAgaWYoY2lkKSBlYy5JZCA9IGNpZC5JZDsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gZWM7DQogICAgfQ0KDQoJPCU9bU5hbWU9J2dldCBJZCclPigpIHsNCgkJcmV0dXJuIHRoaXMuX19JRFt0aGlzLlRvb2wubmFtZV0gfHwgdGhpcy5fdXVpZCgpOw0KCX0NCg0KCTwlPW1OYW1lPSdzZXQgSWQnJT4oaWQpIHsNCgkJaWYgKCF0aGlzLlRvb2wpIHsNCgkJCTwlPWxvZygpJT4iRW1wdHkgVG9vbCIsIHRoaXMuVG9vbHMubGVuZ3RoLCA8JT1zY29wZSU+LlRvb2xzLmxlbmd0aCk7DQoJCQlyZXR1cm47DQoJCX0NCgkJaWYodGhpcy5fX0lEW3RoaXMuVG9vbC5uYW1lXT09aWQpIHJldHVybjsNCgkJdGhpcy5fX0lEW3RoaXMuVG9vbC5uYW1lXSA9IGlkOw0KCX0NCg0KICAgIDwlPW1OYW1lPSdnZXQgVG9vbCclPigpIHsNCiAgICAgICAgaWYodHlwZW9mKHRoaXMuX19Ub29sKSE9PSd1bmRlZmluZWQnKSByZXR1cm4gdGhpcy5fX1Rvb2w7DQogICAgICAgIGxldCBub1Rvb2wgPSB7DQogICAgICAgICAgICBuYW1lOiAnJywNCiAgICAgICAgICAgIHR5cGU6IHtuYW1lOiAnJ30sDQogICAgICAgIH07DQogICAgICAgIGlmKHR5cGVvZig8JT1zY29wZSU+LlRvb2xzKSE9PSJ1bmRlZmluZWQiICYmICFBcnJheS5pc0FycmF5KDwlPXNjb3BlJT4uVG9vbHMpKXsNCiAgICAgICAgICAgIDwlPWVycm9yKCklPiI8JT1zY29wZSU+LlRvb2xzIGlzIG5vdCBhbiBhcnJheTogIiwgPCU9c2NvcGUlPi5Ub29scyk7DQogICAgICAgICAgICByZXR1cm4gbm9Ub29sOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICBsZXQgcmV0ID0gKDwlPXNjb3BlJT4uX19sYXN0VG9vbD9bPCU9c2NvcGUlPi5fX2xhc3RUb29sXTpbXSkuY29uY2F0KHRoaXMuVG9vbHMpLmZpbmQodCA9PiAoPCU9c2NvcGUlPi5Ub29scyB8fCBbXSkuZmluZChfdCA9PiB0ID09IF90Lm5hbWUgfHwgdC5uYW1lPT1fdC5uYW1lKSk7DQogICAgICAgIGlmKHR5cGVvZihyZXQpIT09J3VuZGVmaW5lZCcpIHJldCA9ICg8JT1zY29wZSU+LlRvb2xzIHx8IFtdKS5maW5kKHQgPT4gdC5uYW1lPT1yZXQgfHwgdC5uYW1lPT1yZXQubmFtZSk7DQogICAgICAgIGlmKHR5cGVvZihyZXQpPT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgaWYodGhpcy5Ub29scy5sZW5ndGgpew0KICAgICAgICAgICAgICAgIHJldCA9IHsNCiAgICAgICAgICAgICAgICAgICAgbmFtZTogdGhpcy5Ub29sc1swXSwNCiAgICAgICAgICAgICAgICAgICAgdHlwZTogew0KICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogdGhpcy5Ub29sc1swXQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgIH1lbHNlIHJldCA9IG5vVG9vbDsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gcmV0Ow0KICAgIH0NCg0KICAgIDwlPW1OYW1lPSdzZXQgVG9vbCclPih0b29sKSB7DQogICAgICAgIGlmICh0eXBlb2YodG9vbCk9PT0ndW5kZWZpbmVkJykgcmV0dXJuOw0KICAgICAgICBpZih0eXBlb2YodG9vbCk9PT0ic3RyaW5nIil7DQogICAgICAgICAgICB0b29sID0ge25hbWU6IHRvb2x9Ow0KICAgICAgICB9DQogICAgICAgIGlmKHRvb2wuRW50aXR5Q2xhc3Mpew0KICAgICAgICAgICAgdG9vbCA9IHRvb2wuX3RvRG9jdW1lbnQoKTsNCiAgICAgICAgfQ0KICAgICAgICBpZih0eXBlb2YodG9vbC5uYW1lKT09PSd1bmRlZmluZWQnICYmIHR5cGVvZih0b29sLnR5cGUubmFtZSk9PT0ndW5kZWZpbmVkJykgcmV0dXJuOw0KICAgICAgICB0b29sLnR5cGUgPSB0b29sLnR5cGUgfHwge25hbWU6IHRvb2wubmFtZX07DQogICAgICAgIA0KICAgICAgICBpZighdG9vbC50eXBlICYmICF0b29sLm5hbWUpew0KICAgICAgICAgICAgPCU9d2FybigpJT4iRW1wdHkgVG9vbCBvYmplY3QiKTsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KDQogICAgICAgIGxldCB0ID0gKDwlPXNjb3BlJT4uVG9vbHMgfHwgW10pLmZpbHRlcih0ID0+IHQubmFtZSAmJiB0LnR5cGUpLmZpbmQodCA9PiAodC5uYW1lID09IHRvb2wubmFtZSkgfHwgKHQudHlwZS5uYW1lID09IHRvb2wudHlwZS5uYW1lKSk7DQogICAgICAgIGlmICghdCkgew0KICAgICAgICAgICAgPCU9bG9nKCklPiJubyBtYXRjaGluZyB0b29sIiwgdG9vbCwgPCU9c2NvcGUlPi5Ub29scyk7DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIDwlPXNjb3BlJT4uX19sYXN0VG9vbCA9IHRoaXMuX19Ub29sID0gdDsNCiAgICAgICAgDQogICAgICAgIHJldHVybiB0aGlzOw0KICAgIH0NCg0KICAgIDwlPW1OYW1lPSdUSElTJyU+KHYsIGNvKXsNCiAgICAgICAgaWYodHlwZW9mKHYpPT09J3VuZGVmaW5lZCcpIHJldHVybiB0aGlzLl9USElTOw0KICAgICAgICBpZighdikgcmV0dXJuIHRoaXM7DQogICAgICAgIHYgPSBBcnJheS5pc0FycmF5KHYpP3Y6W3ZdOw0KICAgICAgICB0aGlzLl9USElTID0gdi5maWx0ZXIoX3YgPT4gdHlwZW9mKF92KT09PSdvYmplY3QnICYmIF92LkVudGl0eUNsYXNzICYmIF92LkVudGl0eUNsYXNzLk5hbWU9PXRoaXMuRW50aXR5Q2xhc3MuTmFtZSAmJiBfdi5TY29wZT09dGhpcy5TY29wZSk7DQogICAgICAgIGlmIChjbykgdGhpcy5fVEhJU19jb29wID0gY287DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgIH0NCiAgICANCiAgICA8JT1tTmFtZT0nY2xlYXJfVEhJUyclPigpIHsNCiAgICAgICAgdGhpcy5fVEhJUyA9IFtdOw0KICAgICAgICB0aGlzLl9USElTX2Nvb3AgPSAnJzsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgfQ0KICAgIA0KPCUgYy5FbnRpdHlBdHRyaWJ1dGVzLmZpbHRlcihlYSA9PiAhZWEuRW50aXR5TWV0aG9kKS5mb3JFYWNoKGVhID0+IHslPg0KICAgIC8qKiBzdGFydDogc2V0dGVycyBhbmQgZ2V0dGVycyBmb3IgPCU9ZWEuTmFtZSU+ICoqLw0KICAgIDwlPW1OYW1lPW5OYW1lKGVhKSU+KHYsIGNvLCBpZCkgew0KICAgICAgICBpZiAoY28pIHRoaXMuXzwlPW5OYW1lKGVhKSU+X2Nvb3AgPSBjbzsNCg0KICAgICAgICB2YXIgZXYgPSB0aGlzLkVudGl0eVZhbHVlKCI8JT1lYS5OYW1lJT4iKTsNCiAgICAgICAgaWYgKCFldil7DQogICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgfQ0KDQogICAgICAgIGlmIChpZCkgZXYuSWQgPSBpZDsNCg0KICAgICAgICBpZiAodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpIHsNCiAgICAgICAgICAgIC8vIHZhbHVlcyB3ZXJlIGdpdmVuLCB0aGVyZWZvcmUgYSBzZXR0ZXINCg0KICAgIDwlIGlmKGVhLklzQXJyYXkpeyU+DQogICAgICAgICAgICB2ID0gQXJyYXkuaXNBcnJheSh2KT92Olt2XTsNCiAgICAgICAgICAgIHYgPSB2Lm1hcChfdiA9PiB7DQogICAgPCUgfWVsc2V7JT4NCiAgICAgICAgICAgIHYgPSAoX3YgPT4gew0KICAgIDwlIH0lPg0KDQogICAgPCUgaWYoZWEuSXNEYXRlKXslPg0KICAgICAgICAgICAgICAgIF92ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKF92KSA9PT0gJ1tvYmplY3QgRGF0ZV0nP192OihuZXcgRGF0ZShfdikpOw0KICAgICAgICAgICAgICAgIGlmKGlzTmFOKF92LmdldFRpbWUoKSkpIF92ID0gbnVsbDsNCiAgICA8JSB9JT4NCiAgICA8JSBpZihlYS5Jc0Jvb2wpeyU+DQogICAgICAgICAgICAgICAgX3YgPSBbInRydWUiLCAiMSIsICJ5ZXMiLCB0cnVlLCAxXS5pbmNsdWRlcyhfdik7DQogICAgPCUgfSU+DQogICAgPCUgaWYoZWEuSXNJbnQgfHwgZWEuSXNMb25nIHx8IGVhLklzRmxvYXQpeyU+DQogICAgICAgICAgICAgICAgaWYoaXNOYU4oX3YpKSBfdiA9IDA7DQogICAgPCUgfSU+DQogICAgPCUgaWYoZWEuSXNUZXh0KXslPg0KICAgICAgICAgICAgICAgIGlmKHR5cGVvZihfdik9PT0nb2JqZWN0JykgX3YgPSBKU09OLnN0cmluZ2lmeShfdik7DQogICAgPCUgfSU+DQoNCiAgICA8JSBpZihlYS5FbnRpdHlUeXBlKXslPg0KICAgICAgICAgICAgICAgIGlmKF92ICYmICFfdi5FbnRpdHlDbGFzcyl7DQogICAgICAgICAgICAgICAgICAgIDwlPWxvZygpJT4idXNpbmcgX3RvRG9jdW1lbnQgZm9yIGludmFsaWQgc2V0dGVyIHZhbHVlIiwgX3YpOw0KICAgICAgICAgICAgICAgICAgICBfdiA9IG5ldyA8JT1zY29wZSU+LjwlPV9jTmFtZShlYS5FbnRpdHlUeXBlLCB0cnVlKSU+KCkuX2Zyb21Eb2N1bWVudChfdik7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgaWYoX3YgJiYgX3YuRW50aXR5Q2xhc3MuSWQhPT0nPCU9ZWEuRW50aXR5VHlwZS5JZCU+JyAmJiBfdi5FbnRpdHlDbGFzcy5OYW1lIT09JzwlPWVhLkVudGl0eVR5cGUuTmFtZSU+Jyl7DQogICAgICAgICAgICAgICAgICAgIDwlPXdhcm4oKSU+IkludmFsaWQgU2V0dGVyIHZhbHVlIiwgX3YsICI8JT1lYS5FbnRpdHlUeXBlLklkJT4iLCBfdi5FbnRpdHlDbGFzcy5OYW1lLCAiPCU9ZWEuRW50aXR5VHlwZS5OYW1lJT4iKTsNCiAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgX3YgPSAoKF92ICYmICF0aGlzLklkKSA/IF92LnRvRW50aXR5T2JqZWN0KCkgOiBfdik7DQogICAgICAgICAgICAgICAgfQ0KICAgIDwlIH0lPg0KDQogICAgICAgICAgICAgICAgcmV0dXJuIF92Ow0KICAgIDwlIGlmKGVhLklzQXJyYXkpeyU+DQogICAgICAgICAgICB9KTsNCiAgICA8JSB9ZWxzZXslPg0KICAgICAgICAgICAgfSkodik7DQogICAgPCUgfSU+DQogICAgDQogICAgPCUgaWYoZWEuRW50aXR5VHlwZSl7JT4NCiAgICAgICAgICAgIGRlbGV0ZSBldi5PYmplY3RWYWx1ZWlkOw0KICAgICAgICAgICAgZXYuT2JqZWN0VmFsdWUgPSB2Ow0KICAgIDwlIH1lbHNleyU+DQogICAgICAgICAgICBldi48JT1fRnJFTUQuX2F0dHIoZWEpJT5WYWx1ZSA9IHY7DQogICAgPCUgfSU+DQoNCiAgICAgICAgICAgIGlmKHRydWUgfHwgdGhpcy5fPCU9bk5hbWUoZWEpJT4hPXYpew0KICAgICAgICAgICAgICAgIHRoaXMuXzwlPW5OYW1lKGVhKSU+X3NldCA9IDwlPVNldF9PbiU+OyAvLyBhIGNoYW5nZSBpbiB2YWx1ZQ0KICAgIDwlIGlmKGVhLkVudGl0eVR5cGUpeyU+DQogICAgICAgICAgICAgICAgPCU9bG9nKCklPiJTZXQgYWZ0ZXIiLCB0aGlzLl88JT1uTmFtZShlYSklPj90aGlzLl88JT1uTmFtZShlYSklPi5TZXRfT246bnVsbCwgdj92LlNldF9PbjpudWxsKTsNCiAgICAgICAgICAgICAgICAvKmlmKHYpIHRoaXMuXzwlPW5OYW1lKGVhKSU+X3NldCA9IHYuU2V0X09uOyovDQogICAgPCUgfSU+DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHRoaXMuXzwlPW5OYW1lKGVhKSU+ID0gdjsNCiAgICAgICAgICAgIGlmIChjbykgZXYuT1BFUkFUT1JTLjwlPV9GckVNRC5fYXR0cihlYSklPlZhbHVlID0gY287DQoNCiAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgcmV0dXJuIHRoaXMuaTE4bihldiwgdGhpcy5fPCU9bk5hbWUoZWEpJT4pOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgPCU9bU5hbWU9J2NsZWFyXycrbk5hbWUoZWEpJT4oKSB7DQogICAgICAgIGxldCByZXQgPSB0aGlzLl88JT1uTmFtZShlYSklPjsNCiAgICAgICAgdGhpcy5fPCU9bk5hbWUoZWEpJT5fc2V0ID0gbnVsbDsNCiAgICAgICAgdGhpcy5fPCU9bk5hbWUoZWEpJT4gPSBudWxsOw0KICAgICAgICB0aGlzLl88JT1uTmFtZShlYSklPl9jb29wID0gIiI7DQogICAgICAgIHJldHVybiByZXQ7DQogICAgfQ0KDQogICAgLyoqIGVuZDogc2V0dGVycyBhbmQgZ2V0dGVycyBmb3IgPCU9ZWEuTmFtZSU+ICoqLw0KPCUgfSk7ICU+DQo8JSBjLlR5cGVkQXR0cmlidXRlcy5maWx0ZXIodGEgPT4gIXRhLkVudGl0eU1ldGhvZCkuZm9yRWFjaCh0YSA9PiB7IGxldCB0YU5hbWUgPSB0YS5FbnRpdHlDbGFzcy5QbHVyYWwucmVwbGFjZSgvIC9nLCAnXycpOyU+DQogICAgLyoqIHN0YXJ0OiBzZXR0ZXJzIGFuZCBnZXR0ZXJzIGZvciA8JT10YS5OYW1lJT5fPCU9dGFOYW1lJT4gKiovDQogICAgPCU9bU5hbWU9bk5hbWUodGEpKydfJyt0YU5hbWUlPih2LCBjbywgYkNsZWFyKSB7DQogICAgICAgIGlmKHR5cGVvZih2KT09PSJ1bmRlZmluZWQiKSByZXR1cm4gdGhpcy5fPCU9bk5hbWUodGEpJT5fPCU9dGFOYW1lJT47DQogICAgICAgIA0KICAgICAgICBpZih2ICYmIHYudG9FbnRpdHlPYmplY3QgJiYgdi5FbnRpdHlDbGFzcy5JZCE9PSc8JT10YS5FbnRpdHlDbGFzcy5JZCU+JyAmJiB2LkVudGl0eUNsYXNzLk5hbWUhPT0nPCU9dGEuRW50aXR5Q2xhc3MuTmFtZSU+JykgcmV0dXJuIHRoaXM7DQogICAgICAgIA0KICAgICAgICB2ID0gQXJyYXkuaXNBcnJheSh2KT92Olt2XTsNCiAgICAgICAgDQogICAgICAgIHYgPSB2LmZpbHRlcihfdiA9PiAhdiB8fCBfdi5fPCU9bk5hbWUodGEpJT5fc2V0KS5jb25jYXQodi5maWx0ZXIoX3YgPT4gX3YgJiYgIV92Ll88JT1uTmFtZSh0YSklPl9zZXQpLm1hcChfdiA9PiB7DQogICAgICAgICAgICBpZighX3YuY29uc3RydWN0b3Ipew0KICAgICAgICAgICAgICAgIDwlPXdhcm4oKSU+IjwlPW5OYW1lKHRhKSU+IGhhcyBubyBjb25zdHJ1Y3RvciIsIF92KTsNCiAgICAgICAgICAgIH1lbHNlIGlmKF92LmNvbnN0cnVjdG9yLm5hbWU9PSJPYmplY3QiKXsNCiAgICAgICAgICAgICAgICBfdiA9IG5ldyA8JT1zY29wZSU+LjwlPW5OYW1lKHRhLkVudGl0eUNsYXNzLCB0cnVlKSU+KCkuX2Zyb21Eb2N1bWVudChfdikNCiAgICAgICAgICAgICAgICBfdi48JT1uTmFtZSh0YSklPih0aGlzKTsNCiAgICAgICAgICAgICAgICByZXR1cm4gX3Y7DQogICAgICAgICAgICB9ZWxzZSBpZihfdi5jb25zdHJ1Y3Rvci5uYW1lIT0iPCU9bk5hbWUodGEuRW50aXR5Q2xhc3MpJT4iKXsNCiAgICAgICAgICAgICAgICA8JT13YXJuKCklPiI8JT1uTmFtZSh0YSklPiBub3QgdmFsaWQiLCBfdiwgX3YuY29uc3RydWN0b3IubmFtZSwgIjwlPW5OYW1lKHRhLkVudGl0eUNsYXNzKSU+Iik7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICBfdi48JT1uTmFtZSh0YSklPih0aGlzKTsNCiAgICAgICAgICAgICAgICByZXR1cm4gX3Y7DQogICAgICAgICAgICB9DQogICAgICAgIH0pLmZpbHRlcihfdiA9PiBfdikpOw0KICAgICAgICANCiAgICAgICAgaWYoYkNsZWFyKSB0aGlzLmNsZWFyXzwlPW5OYW1lKHRhKSU+XzwlPXRhTmFtZSU+KCk7DQogICAgICAgIHRoaXMuXzwlPW5OYW1lKHRhKSU+XzwlPXRhTmFtZSU+LnB1c2goLi4udik7DQogICAgICAgIHRoaXMuXzwlPW5OYW1lKHRhKSU+XzwlPXRhTmFtZSU+X3NldCA9IDwlPVNldF9PbiU+Ow0KICAgICAgICBpZiAoY28pIHRoaXMuXzwlPW5OYW1lKHRhKSU+XzwlPXRhTmFtZSU+X2Nvb3AgPSBjbzsNCg0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICB9DQogICAgY2xlYXJfPCU9bk5hbWUodGEpJT5fPCU9dGFOYW1lJT4oKSB7DQogICAgICAgIGxldCByZXQgPSB0aGlzLl88JT1uTmFtZSh0YSklPl88JT10YU5hbWUlPjsNCg0KICAgICAgICB0aGlzLl88JT1uTmFtZSh0YSklPl88JT10YU5hbWUlPl9zZXQgPSBudWxsOw0KICAgICAgICB0aGlzLl88JT1uTmFtZSh0YSklPl88JT10YU5hbWUlPiA9IG5ldyBBcnJheSgpOw0KICAgICAgICB0aGlzLl88JT1uTmFtZSh0YSklPl88JT10YU5hbWUlPl9jb29wID0gbnVsbDsNCiAgICAgICAgcmV0dXJuIHJldDsNCiAgICB9DQogICAgLyoqIGVuZDogc2V0dGVycyBhbmQgZ2V0dGVycyBmb3IgPCU9bk5hbWUodGEpJT5fPCU9dGFOYW1lJT4gKiovDQoNCjwlIH0pICU+DQo8JSBjLkVudGl0eUZpZWxkcy5mb3JFYWNoKGVmID0+IHslPg0KICAgIC8qKiBzdGFydDogZ2V0dGVycyBmb3IgPCU9ZWYuTmFtZSU+ICoqLw0KICAgIDwlPW1OYW1lPSdnZXQgJytuTmFtZShlZiklPigpew0KICAgICAgICByZXR1cm4gPCV2YWx1ZU9mKGVmLlZhbHVlKSU+Ow0KICAgIH0NCiAgICAvKiogZW5kOiBnZXR0ZXJzIGZvciA8JT1lZi5OYW1lJT4gKiovDQo8JSB9KSU+DQoNCiAgICA8JT1tTmFtZT0nbG9nJyU+KGNsYXNzTmFtZSwgb2JqLCBtLCB0eXBlLCBsZXZlbCwgLi4ubXNnKXsNCiAgICAgICAgY2xhc3NOYW1lID0gY2xhc3NOYW1lIHx8ICI8JT1uTmFtZShjKSU+IjsNCiAgICAgICAgdHlwZSA9IHR5cGUgfHwgIkVudGl0eU9iamVjdCI7DQogICAgICAgIA0KPCUgaWYobWFpbkNsYXNzKCkhPWMpeyU+DQogICAgICAgIHJldHVybiBuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUobWFpbkNsYXNzKCksIHRydWUpJT4oKS48JT1tTmFtZSU+KGNsYXNzTmFtZSwgb2JqLCBtLCB0eXBlLCBsZXZlbCwgLi4ubXNnKTsNCjwlIH1lbHNleyU+DQogICAgICAgIHRyeXsNCgkJCWxldCBkZWJ1ZyA9IHRoaXMuRGVidWc7DQoJCQlsZXQgbGV2ZWxzID0gWyJpbmZvIiwgIndhcm4iLCAiZXJyb3IiLCAiY3JpdGljYWwiXTsNCg0KCQkJZGVidWcgPSBkZWJ1ZyB8fCBPYmplY3QuZnJvbUVudHJpZXMobmV3IE1hcChsZXZlbHMubWFwKGwgPT4gW2wsICcqJ10pKSk7DQoNCgkJCWxldCBmdW5jdGlvbnMgPSBPYmplY3QuYXNzaWduKHt9LCAuLi5sZXZlbHMubWFwKGwgPT4gKHsNCgkJCQlbbF06IGRlYnVnW2xdID8gZGVidWdbbF0uc3BsaXQoJywnKSA6IFtdDQoJCQl9KSkpOw0KDQoJCQlsZXQgY3NzID0gJ2JhY2tncm91bmQ6ICMwMGZmOTk7IGNvbG9yOiAjMDA4MDAwJzsNCgkJCWxldCBmZyA9ICdceDFiWzMybSc7DQoJCQlzd2l0Y2ggKE51bWJlcihsZXZlbCkpIHsNCgkJCQljYXNlIDE6DQoJCQkJCWNzcyA9ICdiYWNrZ3JvdW5kOiAjZmZmZjAwOyBjb2xvcjogIzAwMDA4MCc7DQoJCQkJCWZnID0gJ1x4MWJbMzNtJzsNCgkJCQkJYnJlYWs7DQoJCQkJY2FzZSAyOg0KCQkJCQljc3MgPSAnYmFja2dyb3VuZDogI2IyMjIyMjsgY29sb3I6ICNmZmZmZmYnOw0KCQkJCQlmZyA9ICdceDFiWzMxbSc7DQoJCQkJCWJyZWFrOw0KCQkJCWNhc2UgMzoNCgkJCQkJY3NzID0gJ2JhY2tncm91bmQ6ICNiMjIyMjI7IGNvbG9yOiAjZmZmZmZmJzsNCgkJCQkJZmcgPSAnXHgxYlszMW1bQ1JJVElDQUxdJzsNCgkJCQkJYnJlYWs7DQoJCQl9DQoNCgkJCWlmIChmdW5jdGlvbnNbbGV2ZWxzW051bWJlcihsZXZlbCkgfHwgMF1dLmV2ZXJ5KGYgPT4gIVsnKi4qJywgJyouJyArIG0sICcqJywgbSwgY2xhc3NOYW1lICsgJy4nICsgbSwgY2xhc3NOYW1lICsgJy4qJ10uaW5jbHVkZXMoZikpKSB7DQoJCQkJcmV0dXJuOw0KCQkJfQ0KDQoJCQlpZiAodHlwZW9mKGdsb2JhbCkgIT09ICd1bmRlZmluZWQnKSB7DQoJCQkJY29uc29sZS5sb2coZmcgKyAiJXNceDFiWzBtIiwgYCR7dHlwZSB8fCAnPHR5cGU+J306ICR7dGhpcy5TY29wZX0uJHtjbGFzc05hbWV9LiR7bSB8fCAnPG1ldGhvZD4nfSgpYCwgLi4uKHR5cGVvZihvYmopID09PSAndW5kZWZpbmVkJyA/IChtc2cgfHwgW10pIDogW29ial0uY29uY2F0KG1zZyB8fCBbXSkpKTsNCgkJCX0gZWxzZSB7DQoJCQkJY29uc29sZS5sb2coYCVjICR7dHlwZSB8fCAnPHR5cGU+J306ICR7dGhpcy5TY29wZX0uJHtjbGFzc05hbWV9LiR7bSB8fCAnPG1ldGhvZD4nfSgpYCwgY3NzLCAuLi4odHlwZW9mKG9iaikgPT09ICd1bmRlZmluZWQnID8gKG1zZyB8fCBbXSkgOiBbb2JqXS5jb25jYXQobXNnIHx8IFtdKSkpOw0KCQkJfQ0KCQl9IGNhdGNoIChleCkgew0KCQkJY29uc29sZS5sb2coZXgpOw0KCQl9DQo8JSB9JT4NCgl9DQoNCiAgICBhc3luYyA8JT1tTmFtZT0nc2V0SW50ZXJ2YWwnJT4oY2xhc3NOYW1lLCBmdW4sIG1pbnV0ZXMsIC4uLmFyZ3Mpew0KICAgICAgICBjbGFzc05hbWUgPSBjbGFzc05hbWUgfHwgIjwlPW5OYW1lKGMpJT4iOw0KPCUgaWYobWFpbkNsYXNzKCkhPWMpeyU+DQogICAgICAgIHJldHVybiBhd2FpdCBuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUobWFpbkNsYXNzKCksIHRydWUpJT4oKS48JT1tTmFtZSU+KGNsYXNzTmFtZSwgZnVuLCBtaW51dGVzLCAuLi5hcmdzKTsNCjwlIH1lbHNleyU+DQoJCXRyeSB7DQogICAgCQlsZXQgZk5hbWUgPSBmdW4udG9TdHJpbmcoKS5zcGxpdCgnKScpWzBdICsgJyknOw0KICAgIAkJdHJ5IHsNCiAgICAJCQkvLyB0aGlzLl9fdGltZShgJHtmTmFtZX0uTG9vcGApOw0KICAgIA0KICAgIAkJCXRoaXMuX190aW1lKGAke2ZOYW1lfS5DYWxsYCk7DQogICAgCQkJbGV0IHJldCA9IGF3YWl0IGZ1biguLi5hcmdzLmNvbmNhdChbbmV3IERhdGUoKV0pKTsNCiAgICANCiAgICAJCQk8JT1sb2coKSU+YHtDYWxsOiBgICsgdGhpcy5fX3RpbWUoYCR7Zk5hbWV9LkNhbGxgKSArIGAsIExvb3A6IGAgKyB0aGlzLl9fdGltZShgJHtmTmFtZX0uTG9vcGApICsgJ30nKTsNCiAgICAJCQlpZiAoIXJldCkgew0KICAgIAkJCQk8JT1sb2coKSU+YGRpZCBub3QgcmV0dXJuIHRydWUsIGV4aXRpbmcgbG9vcGVyICgke3RoaXMuX190aW1lKGZOYW1lKX0pYCk7DQogICAgCQkJCXJldHVybjsNCiAgICAJCQl9DQogICAgCQl9IGNhdGNoIChleCkgew0KICAgIAkJCTwlPWVycm9yKCklPnRoaXMuX190aW1lKGZOYW1lKSwgZXgpOw0KICAgIAkJCWNvbnNvbGUudHJhY2UoKTsNCiAgICAJCX0NCiAgICAJCWlmICghTnVtYmVyKG1pbnV0ZXMpKSB7DQogICAgCQkJPCU9bG9nKCklPnRoaXMuX190aW1lKGZOYW1lKSwgIk5vdCByZXBlYXRpbmcuIE1pbnV0ZXMgaXMgIiArIG1pbnV0ZXMpOw0KICAgIAkJCXJldHVybjsNCiAgICAJCX0NCiAgICAJCWF3YWl0IG5ldyBQcm9taXNlKHIgPT4gc2V0VGltZW91dChyLCBtaW51dGVzICogNjAgKiAxMDAwKSk7DQogICAgCQlhd2FpdCB0aGlzLjwlPW1OYW1lJT4obnVsbCwgZnVuLCBtaW51dGVzLCAuLi5hcmdzKTsNCgkJfSBjYXRjaCAoZXgpIHsNCgkJCTwlPWVycm9yKCklPmV4KTsNCgkJfQ0KPCUgfSU+DQoJfQ0KDQogICAgYXN5bmMgPCU9bU5hbWU9J19leGVjdXRlJyU+KGNsYXNzTmFtZSwgc2NvcGUsIG0sIGZSb3V0ZXIsIGZTY3JpcHQsIG9QYXJhbXMgPSB7fSwgc291cmNlKXsNCgkJdGhpcy5fX3RpbWUoYDwlPXNjb3BlJT4uPCU9X2NOYW1lKG1haW5DbGFzcygpLCB0cnVlKSU+LiR7bX1gKTsNCgkJY2xhc3NOYW1lID0gY2xhc3NOYW1lIHx8ICI8JT1uTmFtZShjKSU+IjsNCgkJc2NvcGUgPSBzY29wZSB8fCA8JT1zY29wZSU+Ow0KCQlzb3VyY2UgPSBzb3VyY2UgfHwgdGhpczsNCg0KPCUgaWYobWFpbkNsYXNzKCkhPWMpeyU+DQogICAgICAgIHJldHVybiBhd2FpdCBuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUobWFpbkNsYXNzKCksIHRydWUpJT4oKS48JT1tTmFtZSU+KGNsYXNzTmFtZSwgc2NvcGUsIG0sIGZSb3V0ZXIsIGZTY3JpcHQsIG9QYXJhbXMsIHRoaXMpOw0KPCUgfWVsc2V7JT4NCgkJZGVsZXRlIDwlPXNjb3BlJT4uX3VuUmVjdXJzZTsgLy8gZXhwZXJpbWVudGFsDQoJCQ0KICAgIAlsZXQgX19iZWZvcmVSdWxlcyA9IG9QYXJhbXMuX19iZWZvcmVSdWxlcyB8fCBbXTsNCiAgICAJbGV0IF9fYWZ0ZXJSdWxlcyA9IG9QYXJhbXMuX19hZnRlclJ1bGVzIHx8IFtdOw0KICAgIAlkZWxldGUgb1BhcmFtcy5fX2JlZm9yZVJ1bGVzOw0KICAgIAlkZWxldGUgb1BhcmFtcy5fX2FmdGVyUnVsZXM7DQoNCiAgICAgICAgbGV0IGxvZyA9ICguLi5zKSA9PiA8JT1sb2coKSU+Y2xhc3NOYW1lLCBtLCAuLi5zKTsNCiAgICAgICAgbGV0IHdhcm4gPSAoLi4ucykgPT4gPCU9d2FybigpJT5jbGFzc05hbWUsIG0sIC4uLnMpOw0KICAgICAgICBsZXQgZXJyb3IgPSAoLi4ucykgPT4gPCU9ZXJyb3IoKSU+Y2xhc3NOYW1lLCBtLCAuLi5zKTsNCiAgICAgICAgICAgIA0KICAgICAgICB0cnl7DQogICAgCQlsZXQgbFBhcmFtcyA9IE9iamVjdC5lbnRyaWVzKG9QYXJhbXMpLm1hcCh4ID0+IHhbMV0pOw0KICAgIAkJbGV0IHJlc3VsdHMgPSBbXTsNCiAgICANCiAgICAJCWxldCBub2RlcyA9IFtdOw0KICAgIAkJDQogICAgCQlpZiAoPCU9bnNjb3BlJT4uX25vZGUgJiYgYXdhaXQgZlJvdXRlcig8JT1uc2NvcGUlPi5fbm9kZSwgbSkpIHsNCiAgICAJCQlub2Rlcy5wdXNoKDwlPW5zY29wZSU+Ll9ub2RlKTsNCiAgICAJCX0NCiAgICANCiAgICAJCWlmICg8JT1uc2NvcGUlPi5fbm9kZSAmJiA8JT1uc2NvcGUlPi5fbm9kZS5fcGFyZW50ICYmIGF3YWl0IGZSb3V0ZXIoPCU9bnNjb3BlJT4uX25vZGUucGFyZW50KCksIG0pKSB7DQogICAgCQkJbm9kZXMucHVzaCg8JT1uc2NvcGUlPi5fbm9kZS5wYXJlbnQoKSk7DQogICAgCQl9DQogICAgDQogICAgCQlmb3IgYXdhaXQgKGNvbnN0IGNuIG9mICg8JT1uc2NvcGUlPi5fbm9kZT88JT1uc2NvcGUlPi5fbm9kZS5wYXJlbnRfTm9kZXMoKTpbXSkpIHsNCiAgICAgICAgICAgICAgICBpZiAoYXdhaXQgZlJvdXRlcihjbiwgbSkpIHsNCiAgICAgICAgICAgICAgICAJbG9nKCdhZGRpbmcgY2hpbGQgbm9kZScsIGNuKTsNCiAgICAgICAgICAgICAgICAJbm9kZXMucHVzaChjbik7DQogICAgICAgICAgICAgICAgfQ0KICAgIAkJfQ0KICAgIA0KICAgIAkJLy8gcmVtb3ZlIGFueSBudWxscw0KICAgIAkJbm9kZXMgPSBub2Rlcy5mbGF0KCkuZmlsdGVyKG4gPT4gbik7DQogICAgCQkNCiAgICAJCWlmICghbm9kZXMubGVuZ3RoKSB7DQogICAgCQkJbm9kZXMucHVzaCg8JT1uc2NvcGUlPi5fbm9kZSk7DQogICAgCQl9DQogICAgCQkNCiAgICAJCW5vZGVzID0gdGhpcy5fdW5pcXVlKG5vZGVzLCAnX2NvZGUnKTsNCiAgICAJCWxvZygnbm9kZXMubGVuZ3RoJywgbm9kZXMubGVuZ3RoKTsNCg0KICAgIAkJZm9yIGF3YWl0IChjb25zdCBuIG9mIG5vZGVzKSB7DQogICAgCQkJbGV0IG5SZXQgPSBudWxsOw0KICAgIAkJCWxvZyhgJHttfSBAICR7bj8uY29kZSgpIHx8ICdMT0NBTCd9YCk7DQogICAgCQkJaWYgKCFuIHx8IHRoaXMuX3NhbWVFbnRpdHkoPCU9bnNjb3BlJT4uX25vZGUsIG4pKSB7DQogICAgCQkJCS8vIGxvY2FsIHNjcmlwdA0KICAgIAkJCQlmb3IgYXdhaXQgKGNvbnN0IHIgb2YgX19iZWZvcmVSdWxlcykgew0KICAgICAgICAgICAgICAgICAgICAgICAgPCV2YWx1ZU9mKCJyLlNjcmlwdCIpJT4NCiAgICAJCQkJCS8vYXdhaXQgdGhpcy5fU2NyaXB0KGNsYXNzTmFtZSwgci5TY3JpcHQsIG0sIHIuTmFtZSB8fCAnQmVmb3JlUnVsZScsIHNjb3BlLCBudWxsLCAuLi5sUGFyYW1zKTsNCiAgICAJCQkJfQ0KDQogICAgCQkJCW5SZXQgPSBhd2FpdCBmU2NyaXB0KCk7DQoNCiAgICAJCQkJZm9yIGF3YWl0IChjb25zdCByIG9mIF9fYWZ0ZXJSdWxlcykgew0KICAgICAgICAgICAgICAgICAgICAgICAgPCV2YWx1ZU9mKCJyLlNjcmlwdCIpJT4NCiAgICAJCQkJCS8vYXdhaXQgdGhpcy5fU2NyaXB0KGNsYXNzTmFtZSwgci5TY3JpcHQsIG0sIHIuTmFtZSB8fCAnQWZ0ZXJSdWxlJywgc2NvcGUsIG51bGwsIC4uLmxQYXJhbXMpOw0KICAgIAkJCQl9DQogICAgCQkJfSBlbHNlIHsNCiAgICAJCQkJblJldCA9IGF3YWl0IHNvdXJjZS5faW52b2tlTm9kZShuLCBtLCBvUGFyYW1zKTsNCiAgICAJCQl9DQogICAgDQogICAgCQkJcmVzdWx0cy5wdXNoKHsNCiAgICAJCQkJbm9kZTogbiwNCiAgICAJCQkJcmV0OiBuUmV0DQogICAgCQkJfSk7DQogICAgCQl9DQogICAgCQlsb2cocmVzdWx0cywgIl9leGVjdXRlIiwgJ1Jlc3VsdHMnKTsNCiAgICANCiAgICAJCWxldCBlcnJvcnMgPSByZXN1bHRzLmZpbHRlcihyID0+IHIucmV0ICYmIHIucmV0Ll9fZXhjZXB0aW9uKS5tYXAociA9PiAoew0KICAgIAkJCW5vZGU6IHIubm9kZSA/IHsNCiAgICAJCQkJY29kZTogci5ub2RlLmNvZGUoKSwNCiAgICAJCQkJYWRkcmVzczogci5ub2RlLmFkZHJlc3MoKQ0KICAgIAkJCX0gOiBudWxsLA0KICAgIAkJCV9fZXhjZXB0aW9uOiByLnJldC5fX2V4Y2VwdGlvbg0KICAgIAkJfSkpOw0KDQogICAgCQlpZiAoZXJyb3JzLmxlbmd0aCkgew0KICAgIAkJCXdhcm4oImVycm9ycyIsIGVycm9ycyk7DQogICAgCQl9DQogICAgDQogICAgCQlyZXR1cm4gcmVzdWx0czsNCiAgICAgICAgfWNhdGNoKGV4KXsNCiAgICAgICAgICAgIGVycm9yKGV4KTsNCiAgICAgICAgfQ0KPCUgfSU+DQoJfQ0KDQogICAgYXN5bmMgPCU9bU5hbWU9J19TY3JpcHQnJT4oY2xhc3NOYW1lLCBzY3JpcHQsIG0sIHR5cGUsIHNjb3BlLCBfbm9kZSwgLi4uc2ZBcmdzKXsNCiAgICAgICAgY2xhc3NOYW1lID0gY2xhc3NOYW1lIHx8ICI8JT1uTmFtZShjKSU+IjsNCiAgICAgICAgc2NvcGUgPSBzY29wZSB8fCA8JT1zY29wZSU+Ow0KICAgICAgICANCjwlIGlmKG1haW5DbGFzcygpIT1jKXslPg0KICAgICAgICByZXR1cm4gYXdhaXQgbmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKG1haW5DbGFzcygpLCB0cnVlKSU+KCkuPCU9bU5hbWUlPihjbGFzc05hbWUsIHNjcmlwdCwgbSwgdHlwZSwgc2NvcGUsIF9ub2RlLCAuLi5zZkFyZ3MpOw0KPCUgfWVsc2V7JT4NCiAgICAJaWYgKHR5cGVvZihzY3JpcHQpID09PSAndW5kZWZpbmVkJykgcmV0dXJuOw0KICAgIAkNCiAgICAgICAgdHJ5ew0KICAgIAkJaWYgKHR5cGVvZihzY3JpcHQpID09PSAnc3RyaW5nJykgc2NyaXB0ID0gdGhpcy5ydW5TY3JpcHQoYCgpID0+IHske3NjcmlwdH19YCk7DQogICAgDQogICAgCQlsZXQgcmV0ID0gbnVsbDsNCiAgICAJCWlmICh0eXBlb2Yoc2NyaXB0KSA9PT0gJ2Z1bmN0aW9uJykgew0KICAgIAkJCXJldCA9IGF3YWl0IHNjcmlwdCgpOw0KICAgIAkJfQ0KICAgIA0KICAgIAkJcmV0dXJuIHJldDsNCiAgICAgICAgfWNhdGNoKGV4KXsNCiAgICAgICAgICAgIDwlPXdhcm4oKSU+Y2xhc3NOYW1lLCBtLCB0eXBlLCBzY3JpcHQsIGV4KTsNCiAgICAgICAgfQ0KPCUgfSU+DQoJfQ0KDQogICAgPCU9bU5hbWU9J19zYW1lRW50aXR5JyU+KC4uLmFyRW50aXRpZXMpew0KICAgICAgICBpZihhckVudGl0aWVzLmxlbmd0aD09MCkgcmV0dXJuIGZhbHNlOw0KICAgICAgICBpZihhckVudGl0aWVzLmxlbmd0aD09MSkgYXJFbnRpdGllcy5wdXNoKHRoaXMpOw0KPCUgaWYobWFpbkNsYXNzKCkhPWMpeyU+DQogICAgICAgIHJldHVybiBuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUobWFpbkNsYXNzKCksIHRydWUpJT4oKS48JT1tTmFtZSU+KC4uLmFyRW50aXRpZXMpOw0KPCUgfWVsc2V7JT4NCiAgICAgICAgdHJ5ew0KICAgICAgICAgICAgcmV0dXJuIGFyRW50aXRpZXMuc2xpY2UoMSkuZXZlcnkoZSA9PiB7DQogICAgICAgICAgICAgICAgbGV0IHYgPSBhckVudGl0aWVzWzBdOw0KICAgICAgICAgICAgICAgIGxldCBuZWdUZXN0ID0gew0KICAgICAgICAgICAgICAgICAgICB2TnVsbDogdj09bnVsbCwNCiAgICAgICAgICAgICAgICAgICAgZU51bGw6IGU9PW51bGwsDQogICAgICAgICAgICAgICAgICAgIHZPYmplY3Q6IHR5cGVvZih2KSE9PSdvYmplY3QnLA0KICAgICAgICAgICAgICAgICAgICBlT2JqZWN0OiB0eXBlb2YoZSkhPT0nb2JqZWN0JywNCiAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgIDwlPWxvZygpJT4xLCBuZWdUZXN0KTsNCiAgICAgICAgICAgICAgICBpZihPYmplY3Qua2V5cyhPYmplY3QuYXNzaWduKHt9LCAuLi5PYmplY3Qua2V5cyhuZWdUZXN0KS5maWx0ZXIoayA9PiBuZWdUZXN0W2tdKS5tYXAoayA9PiAoe3YsIGUsIFtrXTogdHJ1ZX0pKSkpLmxlbmd0aCkgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgICAgIC8vIHBhc3NlZCBpbml0aWFsIGNvbnNpc3RlbmN5IGNoZWNrDQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgaWYodj09ZSkgcmV0dXJuIHRydWU7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgbmVnVGVzdCA9IHsNCiAgICAgICAgICAgICAgICAgICAgZXZDb25zdHI6IHYuY29uc3RydWN0b3IubmFtZSE9ZS5jb25zdHJ1Y3Rvci5uYW1lLA0KICAgICAgICAgICAgICAgICAgICBlRW50aXR5OiAhZS5FbnRpdHlDbGFzcywNCiAgICAgICAgICAgICAgICAgICAgdkVudGl0eTogIXYuRW50aXR5Q2xhc3MsDQogICAgICAgICAgICAgICAgICAgIGV2RW50aXR5TmFtZXM6IHR5cGVvZihlLkVudGl0eUNsYXNzLk5hbWUpIT09J3VuZGVmaW5lZCcgJiYgZS5FbnRpdHlDbGFzcy5OYW1lIT12LkVudGl0eUNsYXNzLk5hbWUsDQogICAgICAgICAgICAgICAgICAgIGV2RW50aXR5SWRzOiB0eXBlb2YoZS5FbnRpdHlDbGFzcy5JZCkhPT0ndW5kZWZpbmVkJyAmJiBlLkVudGl0eUNsYXNzLklkIT12LkVudGl0eUNsYXNzLklkLA0KICAgICAgICAgICAgICAgICAgICBldklEczogdi5JZD09di5JZCAmJiBlLklkPT1lLklkICYmIHYuSWQhPWUuSWQsDQogICAgICAgICAgICAgICAgICAgIGV2SGFzaDogdi5fdG9IYXNoKG51bGwsIHtvbmx5VW5pcXVlOiB0cnVlfSwgJzwlPW1OYW1lJT4nKSE9ZS5fdG9IYXNoKG51bGwsIHtvbmx5VW5pcXVlOiB0cnVlfSwgJzwlPW1OYW1lJT4nKSwNCiAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgIDwlPWxvZygpJT4yLCBuZWdUZXN0KTsNCiAgICAgICAgICAgICAgICBuZWdUZXN0ID0gT2JqZWN0LmFzc2lnbih7fSwgLi4uT2JqZWN0LmtleXMobmVnVGVzdCkuZmlsdGVyKGsgPT4gbmVnVGVzdFtrXSkubWFwKGsgPT4gKHt2LCBlLCBba106IHRydWV9KSkpOw0KICAgICAgICAgICAgICAgIGlmKCFPYmplY3Qua2V5cyhuZWdUZXN0KS5sZW5ndGgpIHJldHVybiB0cnVlOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIDwlPWxvZygpJT4zLCBuZWdUZXN0KTsNCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfWNhdGNoKGV4KXsNCiAgICAgICAgICAgIDwlPWVycm9yKCklPmV4KTsNCiAgICAgICAgfQ0KPCUgfSU+DQogICAgfQ0KDQogICAgPCU9bU5hbWU9J2dldCBTZXRfT24nJT4oKSB7DQogICAgICAgIGxldCByZXQgPSBuZXcgRGF0ZShNYXRoLm1heCgNCjwlIGMuRW50aXR5QXR0cmlidXRlcy5maWx0ZXIoZWEgPT4gIWVhLkVudGl0eU1ldGhvZCkuZm9yRWFjaChlYSA9PiB7JT4NCiAgICAgICAgICAgIHRoaXMuXzwlPW5OYW1lKGVhKSU+X3NldCwNCjwlIH0pJT4gICAgICAgICAgICANCjwlIGMuVHlwZWRBdHRyaWJ1dGVzLmZvckVhY2godGEgPT4geyBsZXQgdGFOYW1lID0gbk5hbWUodGEpICsgJ18nICsgdGEuRW50aXR5Q2xhc3MuUGx1cmFsLnJlcGxhY2UoLyAvZywgJ18nKTslPg0KICAgICAgICAgICAgdGhpcy5fPCU9dGFOYW1lJT5fc2V0LA0KPCUgfSklPg0KICAgICAgICApKTsNCiAgICAgICAgDQogICAgICAgIGlmKCFyZXQgfHwgIShyZXQgaW5zdGFuY2VvZiBEYXRlICYmICFpc05hTihyZXQpKSkgcmV0dXJuIHVuZGVmaW5lZDsNCiAgICAgICAgcmV0dXJuIHJldDsNCiAgICB9DQogICAgDQogICAgPCU9bU5hbWU9J2dldCBTZXRfQ291bnQnJT4oKSB7DQogICAgICAgIHJldHVybiBbDQo8JSBjLkVudGl0eUF0dHJpYnV0ZXMuZmlsdGVyKGVhID0+ICFlYS5FbnRpdHlNZXRob2QpLmZvckVhY2goZWEgPT4geyU+DQogICAgICAgICAgICB0aGlzLl88JT1uTmFtZShlYSklPl9zZXQsDQo8JSB9KSU+ICAgICAgICAgICAgDQo8JSBjLlR5cGVkQXR0cmlidXRlcy5mb3JFYWNoKHRhID0+IHsgbGV0IHRhTmFtZSA9IG5OYW1lKHRhKSArICdfJyArIHRhLkVudGl0eUNsYXNzLlBsdXJhbC5yZXBsYWNlKC8gL2csICdfJyk7JT4NCiAgICAgICAgICAgIHRoaXMuXzwlPXRhTmFtZSU+X3NldCwNCjwlIH0pJT4NCiAgICAgICAgXS5maWx0ZXIocyA9PiBzKS5sZW5ndGg7DQogICAgfQ0KICAgIA0KICAgIDwlPW1OYW1lPSdfZmxhdHRlbiclPihkZXB0aCl7DQogICAgICAgIDwlPXdhcm4oKSU+IkRFUFJFQ0FURUQiKTsNCiAgICAgICAgbGV0IHJldCA9IHt9Ow0KICAgICAgICBpZighZGVwdGgpIHJldHVybiByZXQ7DQo8JSBjLkVudGl0eUF0dHJpYnV0ZXMuZmlsdGVyKGVhID0+ICFlYS5FbnRpdHlNZXRob2QpLmZvckVhY2goZWEgPT4geyU+DQogICAgICAgIHJldC5fPCU9bk5hbWUoZWEpJT5fc2V0ID0gdGhpcy5fPCU9bk5hbWUoZWEpJT5fc2V0Ow0KICAgICAgICByZXQuXzwlPW5OYW1lKGVhKSU+X2Nvb3AgPSB0aGlzLl88JT1uTmFtZShlYSklPl9jb29wOw0KICAgICAgICByZXQuPCU9bk5hbWUoZWEpJT4gPSB0aGlzLjwlPW5OYW1lKGVhKSU+KCk/dGhpcy48JT1uTmFtZShlYSklPigpPCVpZihlYS5FbnRpdHlUeXBlKXslPi48JT1tTmFtZSU+KGRlcHRoLTEpPCV9JT46dGhpcy48JT1uTmFtZShlYSklPigpOw0KPCUgfSklPg0KPCUgYy5UeXBlZEF0dHJpYnV0ZXMuZm9yRWFjaCh0YSA9PiB7IGxldCB0YU5hbWUgPSBuTmFtZSh0YSkgKyAnXycgKyB0YS5FbnRpdHlDbGFzcy5QbHVyYWwucmVwbGFjZSgvIC9nLCAnXycpOyU+DQogICAgICAgIHJldC48JT10YU5hbWUlPiA9IHRoaXMuPCU9dGFOYW1lJT4oKS5tYXAodCA9PiB0P3QuPCU9bU5hbWUlPihkZXB0aC0xKTp0KTsNCjwlIH0pJT4NCiAgICAgICAgcmV0dXJuIHJldDsNCiAgICB9DQogICAgDQogICAgPCU9bU5hbWU9J190b0hhc2gnJT4oYXJncywgb3B0aW9ucywgZlNvdXJjZSl7DQogICAgICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9Ow0KICAgICAgICANCiAgICAgICAgbGV0IG9IYXNoID0gew0KICAgICAgICAgICAgY2xhc3M6ICI8JT1uTmFtZShjKSU+IiwNCiAgICAgICAgICAgIHNvdXJjZTogZlNvdXJjZSwNCiAgICAgICAgICAgIGFyZ3M6IGFyZ3MsDQogICAgICAgICAgICBfdGhpczoge30NCiAgICAgICAgfTsNCiAgICAgICAgDQogICAgICAgIGlmKCFvcHRpb25zLm5vVGhpcyAmJiBmU291cmNlIT0iPCU9bU5hbWUlPiIgJiYgKHR5cGVvZihvcHRpb25zLmRlcHRoKT09PSd1bmRlZmluZWQnIHx8IC0tb3B0aW9ucy5kZXB0aD4wKSl7DQogICAgICAgICAgICB0aGlzLl9fZXhwb3J0KG9IYXNoLl90aGlzLCB7DQogICAgICAgICAgICAgICAgT1BFUkFUT1JTOiAhb3B0aW9ucy5ub09wZXJhdG9ycywNCiAgICAgICAgICAgICAgICBfbWFwOiBvcHRpb25zLl9tYXAsDQogICAgICAgICAgICAgICAgVW5pcXVlOiBvcHRpb25zLm9ubHlVbmlxdWUsDQogICAgICAgICAgICAgICAgTnVsbDogdHJ1ZSwNCiAgICAgICAgICAgICAgICBJZDogKG9iaiwgaWRDb2RlLCB2KSA9PiBvYmpbaWRDb2RlXSA9IHYsDQo8JSBjLkVudGl0eUF0dHJpYnV0ZXMuZmlsdGVyKGVhID0+ICFlYS5FbnRpdHlNZXRob2QpLmZvckVhY2goZWEgPT4geyU+DQogICAgICAgICAgICAgICAgPCU9bk5hbWUoZWEpJT46IChvYmosIGVhQ29kZSwgdikgPT4gew0KICAgICAgICAgICAgICAgICAgICA8JSBpZihlYS5FbnRpdHlUeXBlKXslPmlmKG9wdGlvbnMubm9UeXBlcykgcmV0dXJuOzwlfSU+DQogICAgICAgICAgICAgICAgICAgIG9ialtlYUNvZGVdID0gPCUgaWYoZWEuRW50aXR5VHlwZSl7JT52P3YuPCU9bU5hbWUlPihudWxsLCBvcHRpb25zLCBmU291cmNlKTo8JX0lPigob3B0aW9ucy5vbmx5VW5pcXVlICYmIDwldmFsdWVPZihlYS5Jc1VuaXF1ZSklPik/KHZ8fG51bGwpOnYpOw0KICAgICAgICAgICAgICAgIH0sDQo8JSB9KSU+DQo8JSBjLlR5cGVkQXR0cmlidXRlcy5mb3JFYWNoKHRhID0+IHsgbGV0IHRhTmFtZSA9IG5OYW1lKHRhKSArICdfJyArIHRhLkVudGl0eUNsYXNzLlBsdXJhbC5yZXBsYWNlKC8gL2csICdfJyk7JT4NCiAgICAgICAgICAgICAgICA8JT10YU5hbWUlPjogKG9iaiwgZWFDb2RlLCB2KSA9PiBvYmpbZWFDb2RlXSA9ICh2IHx8IFtdKS5tYXAoX3YgPT4gX3YuPCU9bU5hbWUlPihudWxsLCBvcHRpb25zLCBmU291cmNlKSksDQo8JSB9KSU+DQo8JSBjLkVudGl0eUZpZWxkcy5mb3JFYWNoKGVmID0+IHslPg0KICAgICAgICAgICAgICAgIGVmXzwlPW5OYW1lKGVmKSU+OiAob2JqLCBlZkNvZGUsIHYpID0+IG9ialtlZkNvZGVdID0gdiwNCjwlIH0pJT4NCiAgICAgICAgICAgIH0sICI8JT1tTmFtZSU+Iik7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIGlmKG9wdGlvbnMubm9BcmdzKSBvSGFzaCA9IG9IYXNoLl90aGlzOw0KICAgICAgICByZXR1cm4gb3B0aW9ucy5ub0NvZGU/b0hhc2g6dGhpcy5oYXNoQ29kZShKU09OLnN0cmluZ2lmeShvSGFzaCkpOw0KICAgIH0NCg0KICAgIGFzeW5jIDwlPW1OYW1lPSdfYXV0aG9yaXplJyU+KHVzZXJuYW1lLCBwYXNzd29yZCwgYlNlcnZlcil7DQo8JSBpZihtYWluQ2xhc3MoKT09Yyl7JT4NCiAgICAgICAgaWYoIXVzZXJuYW1lICYmICFwYXNzd29yZCAmJiAhPCU9c2NvcGUlPi5fX3Rva2VuICYmIHRoaXMuVGVzdFsnPCU9bU5hbWUlPi51c2VybmFtZSddKXsNCiAgICAgICAgICAgIHVzZXJuYW1lID0gdGhpcy5UZXN0Wyc8JT1tTmFtZSU+LnVzZXJuYW1lJ107DQogICAgICAgICAgICBwYXNzd29yZCA9IHRoaXMuVGVzdFsnPCU9bU5hbWUlPi5wYXNzd29yZCddOw0KICAgICAgICB9DQoNCiAgICAgICAgaWYoYlNlcnZlcil7DQogICAgICAgICAgICBpZih1c2VybmFtZSAmJiAhPCU9c2NvcGUlPi5fdGVzdFVzZXIgJiYgdGhpcy5UZXN0Wyc8JT1tTmFtZSU+LnRlc3RVc2VyJ10pew0KICAgICAgICAgICAgICAgIDwlPXNjb3BlJT4uX3Rlc3RVc2VyID0gYXdhaXQgbmV3IDwlPXNjb3BlJT4uPCU9bk5hbWUoYywgdHJ1ZSklPigpLl9mcm9tRG9jdW1lbnQodGhpcy5UZXN0Wyc8JT1tTmFtZSU+LnRlc3RVc2VyJ10pLmFjdGl2ZSh0cnVlKS5lbmFibGVkKHRydWUpLnVzZXJuYW1lKHVzZXJuYW1lKS5wYXNzd29yZChwYXNzd29yZCkuc3RvcmUoKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGxldCByZXQgPSBhd2FpdCB0aGlzLnVzZXJuYW1lKHVzZXJuYW1lLCAnPScpLnBhc3N3b3JkKHBhc3N3b3JkLCAnPScpLmFjdGl2ZSh0cnVlKS5lbmFibGVkKHRydWUpLmZpbmQoKTsNCiAgICAgICAgICAgIDwlPWxvZygpJT4iU2VydmVyOiAiICsgYlNlcnZlcisiLCBPYmo6IiwgcmV0KTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgaWYocmV0KXsNCiAgICAgICAgICAgICAgICBpZih0eXBlb2YoanNvbndlYnRva2VuKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICAgICAgcmV0ID0ganNvbndlYnRva2VuLnNpZ24ocmV0Ll90b0RvY3VtZW50KCksIHRoaXMuX19jb25maWcoJ3NlY3JldCcpLCB7IGV4cGlyZXNJbjogJzE4MDBzJyB9KTsNCiAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgcmV0ID0gdGhpcy5fYnRvYShKU09OLnN0cmluZ2lmeShyZXQuX3RvRG9jdW1lbnQoKSkpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgcmV0ID0gew0KICAgICAgICAgICAgICAgIGFjY2Vzc190b2tlbjogcmV0LA0KICAgICAgICAgICAgfTsNCiAgICAgICAgICAgIDwlPWxvZygpJT4iU2VydmVyOiAiICsgYlNlcnZlcisiLCB0b2tlbjogIiwgcmV0KTsNCiAgICAgICAgICAgIHJldHVybiByZXQ7DQogICAgICAgIH1lbHNlew0KICAgICAgICAgICAgbGV0IGNsaWVudF9pZCA9IHRoaXMuX19jb25maWcoJ2NsaWVudF9pZCcpOw0KICAgICAgICAgICAgbGV0IGNsaWVudF9zZWNyZXQgPSB0aGlzLl9fY29uZmlnKCdzZWNyZXQnKTsNCiAgICANCiAgICAgICAgICAgIGlmKCF1c2VybmFtZSAmJiAhcGFzc3dvcmQgJiYgPCU9c2NvcGUlPi5fX3Rva2VuKXsNCiAgICAgICAgICAgICAgICA8JT1sb2coKSU+Ik5vIHVzZXJuYW1lL3Bhc3N3b3JkIGFuZCB0b2tlbiBhbHJlYWR5IGV4aXN0cyIpOw0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCg0KICAgIDwlaWYoX2NOYW1lKCdvQXV0aCBUb2tlbicpKXslPg0KICAgICAgICAgICAgbGV0IGRhdGEgPSB7DQogICAgICAgICAgICAgICAgZ3JhbnRfdHlwZTogJ3Bhc3N3b3JkJywNCiAgICAgICAgICAgICAgICB1c2VybmFtZSwNCiAgICAgICAgICAgICAgICBwYXNzd29yZCwNCiAgICAgICAgICAgICAgICBjbGllbnRfaWQsDQogICAgICAgICAgICAgICAgY2xpZW50X3NlY3JldCwNCiAgICAgICAgICAgIH07DQogICAgICAgICAgICANCiAgICAgICAgICAgIGxldCBjb25maWcgPSB7DQogICAgICAgICAgICAgICAgaGVhZGVyczogew0KICAgICAgICAgICAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCcNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9Ow0KICAgICAgICAgICAgaWYoIXVzZXJuYW1lICYmICFwYXNzd29yZCAmJiA8JT1zY29wZSU+Ll9fdG9rZW4gJiYgPCU9c2NvcGUlPi5fX3Rva2VuLnJlZnJlc2hfdG9rZW4pew0KICAgICAgICAgICAgICAgIGRhdGEgPSB7DQogICAgICAgICAgICAgICAgICAgIGdyYW50X3R5cGU6ICJyZWZyZXNoX3Rva2VuIiwNCiAgICAgICAgICAgICAgICAgICAgcmVmcmVzaF90b2tlbjogPCU9c2NvcGUlPi5fX3Rva2VuLnJlZnJlc2hfdG9rZW4sDQogICAgICAgICAgICAgICAgICAgIGNsaWVudF9pZCwNCiAgICAgICAgICAgICAgICAgICAgY2xpZW50X3NlY3JldCwNCiAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgIGNvbmZpZy5oZWFkZXJzLkF1dGhvcml6YXRpb24gPSBgJHs8JT1zY29wZSU+Ll9fdG9rZW4udG9rZW5fdHlwZX0gJHs8JT1zY29wZSU+Ll9fdG9rZW4uYWNjZXNzX3Rva2VufWA7DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIGxldCByZXQgPSBhd2FpdCBheGlvcy5wb3N0KGBodHRwJHs8JT1uc2NvcGUlPi5fbm9kZS5wYXJlbnQoKS5zZWN1cmUoKT8ncyc6Jyd9Oi8vJHs8JT1uc2NvcGUlPi5fbm9kZS5wYXJlbnQoKS5hZGRyZXNzKCl9OiR7PCU9bnNjb3BlJT4uX25vZGUucGFyZW50KCkucG9ydCgpIHx8IDMwMDB9L29hdXRoL3Rva2VuYCwgT2JqZWN0LmtleXMoZGF0YSkubWFwKGtleSA9PiBrZXkgKyAnPScgKyBkYXRhW2tleV0pLmpvaW4oJyYnKSwgY29uZmlnKTsNCiAgICAgICAgICAgIGlmKHJldC5kYXRhLmFjY2Vzc190b2tlbil7DQogICAgICAgICAgICAgICAgPCU9c2NvcGUlPi5fX3Rva2VuID0gcmV0LmRhdGE7DQoNCiAgICAgICAgICAgICAgICBpZig8JT1zY29wZSU+Ll9fdG9rZW4ucmVmcmVzaF90b2tlbil7DQogICAgICAgICAgICAgICAgICAgIGlmKGF4aW9zLmludGVyY2VwdG9ycy5yZXNwb25zZS5jbGVhcikgYXhpb3MuaW50ZXJjZXB0b3JzLnJlc3BvbnNlLmNsZWFyKCk7DQogICAgICAgICAgICAgICAgICAgIGF4aW9zLmludGVyY2VwdG9ycy5yZXNwb25zZS51c2UocmVzcG9uc2UgPT4gcmVzcG9uc2UsIGFzeW5jIGVycm9yID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG9yaWdpbmFsUmVxdWVzdCA9IGVycm9yLmNvbmZpZzsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlcnJvci5yZXNwb25zZS5zdGF0dXMgPT09IDQwMSAmJiAhb3JpZ2luYWxSZXF1ZXN0Ll9yZXRyeSAmJiBvcmlnaW5hbFJlcXVlc3QuaGVhZGVycy5BdXRob3JpemF0aW9uLmluZGV4T2YoPCU9c2NvcGUlPi5fX3Rva2VuLmFjY2Vzc190b2tlbik+MCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9yaWdpbmFsUmVxdWVzdC5fcmV0cnkgPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuX2F1dGhvcml6ZSgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9yaWdpbmFsUmVxdWVzdC5oZWFkZXJzLkF1dGhvcml6YXRpb24gPSAnQmVhcmVyICcgKyA8JT1zY29wZSU+Ll9fdG9rZW4uYWNjZXNzX3Rva2VuOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBheGlvcyhvcmlnaW5hbFJlcXVlc3QpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycm9yKTsNCiAgICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgIDwlIH1lbHNlIGlmKGF1dGhDbGFzcyl7JT4NCiAgICAJPCU9c2NvcGUlPi5fX3Rva2VuID0gYXdhaXQgbmV3IDwlPXNjb3BlJT4uPCU9bk5hbWUoYXV0aENsYXNzKSU+KCkudXNlcm5hbWUodXNlcm5hbWUpLnBhc3N3b3JkKHBhc3N3b3JkKS48JT1tTmFtZS5yZXBsYWNlKCdfJywgJycpJT4oKTsNCiAgICA8JSB9ZWxzZXslPg0KICAgICAgICA8JT13YXJuKCklPiJObyBhdXRob3JpemF0aW9uIGRlZmluZWQiKTsNCiAgICA8JSB9JT4NCiAgICAgICAgfQ0KPCUgfWVsc2V7JT4NCiAgICAgICAgcmV0dXJuIGF3YWl0IG5ldyA8JT1zY29wZSU+LjwlPW5OYW1lKG1haW5DbGFzcygpKSU+KCkuPCU9bU5hbWUlPih1c2VybmFtZSwgcGFzc3dvcmQsIGJTZXJ2ZXIpOw0KPCV9JT4NCiAgICB9DQogICAgDQo8JSBpZihtYWluQ2xhc3MoKT09Yyl7JT4NCiAgICBhc3luYyA8JT1tTmFtZT0nX3NlcnZlciclPihvcHRpb25zPXt9KSB7DQogICAgICAgIHRyeXsNCiAgICAgICAgICAgIGlmKG9wdGlvbnMuY2xlYXJDb25zb2xlKSBjb25zb2xlLmNsZWFyKCk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGlmKDwlPXNjb3BlJT4uX19Ub29scykgPCU9c2NvcGUlPi5Ub29scyA9IDwlPXNjb3BlJT4uX19Ub29sczsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKGdsb2JhbCk9PT0ndW5kZWZpbmVkJyAmJiB0eXBlb2YoPCU9c2NvcGUlPi5ocmVmcykhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgIAkJZm9yIGF3YWl0IChjb25zdCBsIG9mIDwlPXNjb3BlJT4uaHJlZnMpIHsNCiAgICAgICAgCQkJYXdhaXQgdGhpcy5yZXF1aXJlKGwubGliLCA8JT1zY29wZSU+LmhyZWZzLCBhc3luYyBfbCA9PiB7DQogICAgPCUgaWYoX2NOYW1lKCdTdG9yZWRTY3JpcHQnKSl7JT4NCiAgICAgICAgICAgICAgICAgICAgaWYoX2wuc2NyaXB0ICYmIDwlPXNjb3BlJT4uVG9vbHMpIHJldHVybiBhd2FpdCBuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUoJ1N0b3JlZFNjcmlwdCcsIHRydWUpJT4oKS5fZnJvbURvY3VtZW50KF9sLnNjcmlwdCkubG9hZFNjcmlwdCgpOw0KICAgIDwlIH0lPg0KICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBsZXQgc2VjdXJlID0gdGhpcy5fX2NvbmZpZygnc2VjdXJlJyk7DQogICAgICAgICAgICBpZih0eXBlb2YoZ2xvYmFsKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICAvLyBnbG9iYWxzDQogICAgICAgICAgICAgICAgdmFyIGdsb2JhbE1vZHVsZXMgPSB7DQogICAgICAgICAgICAgICAgICAgIGV4cHJlc3M6ICdleHByZXNzJywNCiAgICAgICAgICAgICAgICAgICAgaHR0cHM6ICdodHRwcycsDQogICAgICAgICAgICAgICAgICAgIGh0dHA6ICdodHRwJywNCiAgICAgICAgICAgICAgICAgICAgc2VsZnNpZ25lZDogJ3NlbGZzaWduZWQnLA0KICAgICAgICAgICAgICAgICAgICB1dGlsOiAndXRpbCcsDQogICAgICAgICAgICAgICAgICAgIGNvcnM6ICdjb3JzJywNCiAgICAgICAgICAgICAgICAgICAgYm9keVBhcnNlcjogJ2JvZHktcGFyc2VyJywNCiAgICAgICAgICAgICAgICAgICAgYXhpb3M6ICdheGlvcycsDQogICAgICAgICAgICAgICAgICAgIC8vY3J5cHRvOiAnY3J5cHRvJywNCiAgICAgICAgICAgICAgICAgICAgb3M6ICdvcycsDQogICAgICAgICAgICAgICAgICAgIC8vam1lc3BhdGg6ICdqbWVzcGF0aCcsDQogICAgICAgICAgICAgICAgICAgIGpzb25wYXRoOiAnanNvbnBhdGgnLA0KICAgICAgICAgICAgICAgICAgICBqc29uYXRhOiAnanNvbmF0YScsDQogICAgICAgICAgICAgICAgICAgIERvdE9iamVjdDogJ2RvdC1vYmplY3QnLA0KICAgICAgICAgICAgICAgICAgICBtYWNoaW5laWQ6ICdub2RlLW1hY2hpbmUtaWQnLA0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgbWluaW1pc3Q6ICdtaW5pbWlzdCcsDQogICAgICAgICAgICAgICAgDQo8JSBpZihjLkNvbmZpZyAmJiBjLkNvbmZpZ1snZ3JhcGhxbCddKXslPg0KICAgICAgICAgICAgICAgICAgICBncmFwaHFsSFRUUDogJ2V4cHJlc3MtZ3JhcGhxbCcsDQogICAgICAgICAgICAgICAgICAgIGdyYXBocWw6ICdncmFwaHFsJywNCiAgICAgICAgICAgICAgICAgICAgcGxheWdyb3VuZDogJ2dyYXBocWwtcGxheWdyb3VuZC1taWRkbGV3YXJlLWV4cHJlc3MnLA0KPCUgfSU+DQoNCjwlIGlmKGMuQ29uZmlnICYmIGMuQ29uZmlnWydlbWFpbC5ob3N0J10peyU+DQogICAgICAgICAgICAgICAgICAgIG5vZGVtYWlsZXI6ICdub2RlbWFpbGVyJywNCjwlIH0lPg0KDQo8JSBpZihjLkNvbmZpZyAmJiBjLkNvbmZpZ1sndG90cC5zZWNyZXQnXSl7JT4NCiAgICAgICAgICAgICAgICAgICAgb3RwYXV0aDogJ290cGF1dGgnLA0KPCUgfSU+DQoNCjwlIGlmKF9jTmFtZSgnTm9kZScpKXslPg0KICAgICAgICAgICAgICAgICAgICBjaGlsZF9wcm9jZXNzOiAnY2hpbGRfcHJvY2VzcycsDQo8JSB9JT4NCg0KPCUgaWYoX2NOYW1lKCdFdmVudCcpKXslPg0KICAgICAgICAgICAgICAgICAgICBldmVudHM6ICdldmVudHMnLA0KICAgICAgICAgICAgICAgICAgICBzb2NrZXRpbzogJ3NvY2tldC5pbycsDQogICAgICAgICAgICAgICAgICAgIG1xdHQ6ICdtcXR0JywNCiAgICAgICAgICAgICAgICAgICAgYW1xcGxpYjogJ2FtcXBsaWInLA0KICAgICAgICAgICAgICAgICAgICBwcm90b2J1ZmpzOiAncHJvdG9idWZqcycsDQo8JSB9JT4NCg0KPCUgaWYobWFpbkNsYXNzKFsnRmlsZVN5c3RlbSddKSl7JT4NCiAgICAgICAgICAgICAgICAgICAgZnM6ICdmcycsDQo8JSB9JT4NCg0KPCUgaWYobWFpbkNsYXNzKFsnS2Fma2EnXSkpeyU+DQogICAgICAgICAgICAgICAgICAgIGthZmthanM6ICdrYWZrYWpzJywNCjwlIH0lPg0KDQo8JSBpZihtYWluQ2xhc3MoWydOZW80aiddKSl7JT4NCiAgICAgICAgICAgICAgICAgICAgbmVvNGo6ICduZW80ai1kcml2ZXInLA0KPCUgfSU+DQoNCjwlIGlmKF9jTmFtZSgnb0F1dGggVG9rZW4nKSl7JT4NCiAgICAgICAgICAgICAgICAgICAgT0F1dGhTZXJ2ZXI6ICdleHByZXNzLW9hdXRoLXNlcnZlcicsDQo8JSB9ZWxzZSBpZihhdXRoQ2xhc3MpeyU+DQogICAgICAgICAgICAgICAgICAgIGpzb253ZWJ0b2tlbjogJ2pzb253ZWJ0b2tlbicsDQo8JSB9JT4NCg0KDQo8JSBpZihtYWluQ2xhc3MoWydTcWxEQiddKSl7JT4NCiAgICAgICAgICAgICAgICAgICAgc3FsaXRlOiAnc3FsaXRlMycsDQogICAgICAgICAgICAgICAgICAgIG15c3FsOiAnbXlzcWwnLA0KICAgICAgICAgICAgICAgICAgICBwb3N0Z3JlczogJ3BnJywNCjwlIH0lPg0KPCUgaWYobWFpbkNsYXNzKFsnU25vd0ZsYWtlJ10pKXslPg0KICAgICAgICAgICAgICAgICAgICBzbm93Zmxha2U6ICdzbm93Zmxha2Utc2RrJywNCjwlIH0lPg0KPCUgaWYobWFpbkNsYXNzKFsnTW9uZ29EQiddKSl7JT4NCiAgICAgICAgICAgICAgICAgICAgbW9uZ29kYjogJ21vbmdvZGInLA0KPCUgfSU+DQo8JSBpZihtYWluQ2xhc3MoWydSeERCJ10pKXslPg0KICAgICAgICAgICAgICAgICAgICBSeERCOiAncnhkYicsDQo8JSB9JT4NCjwlIGlmKG1haW5DbGFzcyhbJ0V4Y2VsJ10pKXslPg0KICAgICAgICAgICAgICAgICAgICBYTFNYOiAneGxzeCcsDQo8JSB9JT4NCiAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgbGV0IG1pc3NpbmdHbG9iYWxNb2R1bGVzID0gT2JqZWN0LmVudHJpZXMoZ2xvYmFsTW9kdWxlcykubWFwKGUgPT4gew0KICAgICAgICAgICAgICAgICAgICB0cnl7DQogICAgICAgICAgICAgICAgICAgICAgICBnbG9iYWxbZVswXV0gPSByZXF1aXJlKGVbMV0pOw0KICAgICAgICAgICAgICAgICAgICB9Y2F0Y2goZXgpew0KICAgICAgICAgICAgICAgICAgICAgICAgPCU9d2FybigpJT5leCk7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZVsxXTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0pLmZpbHRlcihlID0+IGUpOw0KICAgICAgICAgICAgICAgIGlmKG1pc3NpbmdHbG9iYWxNb2R1bGVzLmxlbmd0aCkgPCU9d2FybigpJT4ibnBtIGluc3RhbGwgIiArIG1pc3NpbmdHbG9iYWxNb2R1bGVzLmpvaW4oJyAnKSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAJCTwlPWxvZygpJT5gU3RhcnRpbmcgWyR7PCU9bnNjb3BlJT4uX25vZGU/PCU9bnNjb3BlJT4uX25vZGUuY29kZSgpOicnfV0uLi5gKTsNCg0KCQkJaWYgKG9wdGlvbnMubG9hZFRvb2xzKSBhd2FpdCBuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUoJ05vZGUnLCB0cnVlKSB8fCBfY05hbWUoKSU+KCkuX2xvYWRUb29scyhvcHRpb25zLnNhdmVUb29scyk7DQoNCjwlIGlmKF9jTmFtZSgnTm9kZScpKXsgIC8qIFRvb2xzIGZpcnN0IG9yIE5vZGVzIGZpcnN0Pz8/ICovJT4NCiAgICAgICAgICAgIGlmKG9wdGlvbnMuaW5pdE5vZGUpew0KICAgICAgICAgICAgICAgIDwlPW5zY29wZSU+Ll9ub2RlID0gYXdhaXQgbmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKCdOb2RlJywgdHJ1ZSklPigpLnNlY3VyZShzZWN1cmUpLmluaXQodGhpcy5fX2NvbmZpZygnaW5pdC5sb29wJywgMC41KSk7DQogICAgICAgICAgICAgICAgaWYodHlwZW9mKDwlPW5zY29wZSU+Ll9ub2RlKT09PSd1bmRlZmluZWQnKSByZXR1cm4gPCU9ZXJyb3IoKSU+IjwlPW5zY29wZSU+Ll9ub2RlIGlzIHVuZGVmaW5lZCEiKTsNCiAgICAgICAgICAgIH0NCjwlIH0lPg0KDQogICAgCQlpZiAodHlwZW9mKHRoaXMuaW5pdCk9PT0nZnVuY3Rpb24nICYmIG9wdGlvbnMuaW5pdFNlbGYpIHsNCiAgICAJCQlhd2FpdCB0aGlzLmluaXQoKTsNCiAgICANCiAgICAJCQlsZXQgc3FsVG9vbCA9ICg8JT1zY29wZSU+LlRvb2xzIHx8IFtdKS5maW5kKHQgPT4gdC5fX2RtbFN0YXRlbWVudHMpOw0KICAgIAkJCWlmIChvcHRpb25zLmNvcHlETUwgJiYgc3FsVG9vbCkgew0KICAgIAkJCQlsZXQgZG1scyA9IHNxbFRvb2wuX19kbWxTdGF0ZW1lbnRzOw0KICAgIAkJCQlpZiAoc3FsVG9vbC50eXBlLm5hbWUgPT0gJ1NxbERCJykgZG1scyA9IFsgLyoiQ3VzdG9tZXJzIiwgIk9yZGVycyIsICJTaGlwcGluZ3MiLCAqLyAiZGVtbyJdLm1hcCh0ID0+IGBkcm9wIHRhYmxlIGlmIGV4aXN0cyAke3R9YCkuY29uY2F0KGRtbHMpOw0KICAgIAkJCQlfRnJFTUQuX2NvcHlUZXh0VG9DbGlwYm9hcmQoZG1scy5qb2luKCc7XG4nKSk7DQogICAgCQkJfQ0KICAgIAkJfQ0KDQo8JSBpZihfY05hbWUoJ05vZGUgVHlwZScpKXsgLyp0b2RvOiByZXBsYWNlIHRoaXMgd2l0aCBhbiBPVEFVcGRhdGUgY29uY2VwdCAqLyU+DQogICAgICAgICAgICAvLyByZWZyZXNoIHNjcmlwdA0KICAgICAgICAgICAgdGhpcy5zZXRJbnRlcnZhbChudWxsLCBhc3luYyAoLyp2ZXJzaW9uKi8pID0+IHsNCiAgICAgICAgICAgICAgICBpZih0aGlzLnNyKCkuYkxvY2FsKSByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgbGV0IHNjdCA9IG5ldyA8JT1zY29wZSU+LjwlPV9jTmFtZSgnTm9kZSBUeXBlJywgdHJ1ZSklPigpLl9mcm9tRG9jdW1lbnQoPCU9c2NvcGUlPi5fXzwlPV9jTmFtZSgnTm9kZSBUeXBlJyklPiB8fCB7bmFtZTogJ05vZGVKUyd9KTsNCiAgICAgICAgICAgICAgICBsZXQgY3QgPSBhd2FpdCBzY3QuZmluZCgpOw0KICAgICAgICAgICAgICAgIGlmKCFjdCB8fCAhY3QuYWN0aXZlKCkgfHwgIWN0LmVuYWJsZWQoKSkgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIGlmKCAhc2N0LmRhdGUoKSB8fCAoKGN0LmRhdGUoKS5nZXRUaW1lKCkgLSBzY3QuZGF0ZSgpLmdldFRpbWUoKSkvMTAwMCkgPiA1ICl7DQogICAgICAgICAgICAgICAgICAgIDwlPWxvZygpJT5gTmV3ZXIgdmVyc2lvbiBmb3VuZDogW2RhdGU6ICR7Y3QuZGF0ZSgpLnRvSVNPU3RyaW5nKCl9LCB0b29sOiAke2N0LlRvb2wubmFtZX1dLCBzdG9yaW5nLi4uYCk7DQogICAgICAgICAgICAgICAgICAgIGlmKHR5cGVvZihnbG9iYWwpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gd2Ugd2FudCB0byBzdG9yZSB0aGUgY29udGVudCBkaXJlY3RseSB0byB0aGUgbm9kZWpzLmpzIGZpbGUNCiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IGN0Ll9maWxlc3lzdGVtKGN0LmNvZGUoKSArICcuanMnLCB0aGlzLl9hdG9iKGN0LnJlbWFyaygpKSk7DQogICAgICAgICAgICAgICAgICAgIH1lbHNlIGlmKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgICAgICAgICAgdHJ5ew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKHdpbmRvdy5zZWxmICE9PSB3aW5kb3cudG9wKXsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPCU9bG9nKCklPiJpRnJhbWUgc2hvdWxkIGJlIHJlc3RhcnRlZC4uLiIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8JT1sb2coKSU+IndpbmRvdyBsb2NhdGlvbiByZWxvYWRpbmcuLi4iKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy93aW5kb3cubG9jYXRpb24ucmVsb2FkKCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfWNhdGNoKGV4KXsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8JT1lcnJvcigpJT4iZnJhbWUgY2hlY2siLCBleCk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgICAgICAgICAgPCU9c2NvcGUlPi5fXzwlPV9jTmFtZSgnTm9kZSBUeXBlJyklPiA9IHNjdC5kYXRlKGN0LmRhdGUoKSkubmFtZShjdC5uYW1lKCkpLmNvZGUoY3QuY29kZSgpKS5fdG9Eb2N1bWVudCgpOw0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICAgICAgfSwgMC41KTsNCjwlIH0lPg0KICAgICAgICANCiAgICAgICAgICAgIGlmKG9wdGlvbnMubG9hZENvbnRlbnQgJiYgdHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJykgd2luZG93Lm9uaGFzaGNoYW5nZSA9IGFzeW5jICgpID0+IGRvY3VtZW50LmJvZHkgPSBhd2FpdCB0aGlzLl9leHBvcnQoe3RtcDogbG9jYXRpb24uaGFzaC5wYWdlfSk7DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YoZ2xvYmFsKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICBjb25zdCBhcHAgPSBleHByZXNzKCk7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgYXBwLnVzZShjb3JzKCkpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBhcHAudXNlKGV4cHJlc3MudXJsZW5jb2RlZCh7ZXh0ZW5kZWQ6IHRydWUsIGxpbWl0OiAnNTBtYid9KSk7DQogICAgICAgICAgICAgICAgYXBwLnVzZShib2R5UGFyc2VyLmpzb24oew0KICAgICAgICAgICAgICAgICAgICB2ZXJpZnk6IChyZXEsIHJlcywgYnVmKSA9PiByZXEucmF3Qm9keSA9IGJ1Zg0KICAgICAgICAgICAgICAgIH0pKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgZ2xvYmFsLmF1dGhlbnRpY2F0ZSA9IGFzeW5jIChyZXEsIHJlcywgbmV4dCkgPT4gew0KICAgICAgICAgICAgICAgICAgICBjb25zdCBhdXRoSGVhZGVyID0gcmVxLmhlYWRlcnNbJ2F1dGhvcml6YXRpb24nXTsNCiAgICAgICAgICAgICAgICAgICAgY29uc3QgdG9rZW4gPSBhdXRoSGVhZGVyICYmIGF1dGhIZWFkZXIuc3BsaXQoJyAnKVsxXTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIGlmICh0b2tlbiA9PSBudWxsKSByZXR1cm4gcmVzLnNlbmRTdGF0dXMoNDAxKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIGpzb253ZWJ0b2tlbi52ZXJpZnkodG9rZW4sIHRoaXMuX19jb25maWcoJ3NlY3JldCcpLCAoZXJyLCBvYmopID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlcnIpIHJldHVybiByZXMuc2VuZFN0YXR1cyg0MDMpOw0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIHJlcS5fX2F1dGhvcml6YXRpb24gPSBvYmo7DQogICAgICAgICAgICAgICAgICAgICAgICBuZXh0KCk7DQogICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgIH07DQogICAgICAgIA0KPCUgaWYoX2NOYW1lKCdvQXV0aCBUb2tlbicpKXslPg0KICAgICAgICAgICAgICAgIGFwcC5vYXV0aCA9IG5ldyBPQXV0aFNlcnZlcih7DQogICAgICAgICAgICAgICAgICAgIGRlYnVnOiB0cnVlLA0KICAgICAgICAgICAgICAgICAgICAvLyB1c2VFcnJvckhhbmRsZXI6IHRydWUsDQogICAgICAgICAgICAgICAgICAgIC8vIGNvbnRpbnVlTWlkZGxld2FyZTogdHJ1ZSwNCiAgICAgICAgICAgICAgICAgICAgLy8gcmVxdWlyZUNsaWVudEF1dGhlbnRpY2F0aW9uOiB7IHBhc3N3b3JkOiBmYWxzZSB9LA0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgbW9kZWw6ICgoKSA9PiAoew0KICAgICAgICAgICAgICAgIAkJZ2V0QWNjZXNzVG9rZW46IGJlYXJlclRva2VuID0+IG5ldyA8JT1zY29wZSU+Lk9BdXRoX1Rva2VuKCkuYWNjZXNzVG9rZW4oYmVhcmVyVG9rZW4pLmFjdGl2ZSh0cnVlKS5lbmFibGVkKHRydWUpLmZpbmQoKS50aGVuKHQgPT4gYXBwLm9hdXRoLmhhbmRsZXIodCwgJ2dldEFjY2Vzc1Rva2VuJykpLnRoZW4odCA9PiB7dC5hY2Nlc3NUb2tlbkV4cGlyZXNBdCA9IG5ldyBEYXRlKHQuYWNjZXNzVG9rZW5FeHBpcmVzT24pOyByZXR1cm4gdH0pLA0KICAgICAgICAgICAgICAgICAgICAgICAgZ2V0Q2xpZW50OiAoY2xpZW50SWQsIGNsaWVudFNlY3JldCkgPT4gbmV3IDwlPXNjb3BlJT4uT0F1dGhfQ2xpZW50KCkuaW5pdCgpLmZpbmFsbHkoKCkgPT4gbmV3IDwlPXNjb3BlJT4uT0F1dGhfQ2xpZW50KCkuaWQoY2xpZW50SWQpLnNlY3JldChjbGllbnRTZWNyZXQpLmFjdGl2ZSh0cnVlKS5lbmFibGVkKHRydWUpLmZpbmQoKSkudGhlbih0ID0+IGFwcC5vYXV0aC5oYW5kbGVyKHQsICdnZXRDbGllbnQnKSksDQogICAgICAgICAgICAgICAgCSAgICBnZXRVc2VyOiAodXNlcm5hbWUsIHBhc3N3b3JkKSA9PiBuZXcgPCU9c2NvcGUlPi48JT1uTmFtZShhdXRoQ2xhc3MpJT4oKS5hdXRob3JpemUodXNlcm5hbWUsIHBhc3N3b3JkKS50aGVuKHQgPT4gYXBwLm9hdXRoLmhhbmRsZXIodCwgJ2dldFVzZXInKSksDQogICAgICAgICAgICAgICAgCSAgICBzYXZlVG9rZW46ICh0b2tlbiwgY2xpZW50LCB1c2VyKSA9PiBuZXcgPCU9c2NvcGUlPi5PQXV0aF9Ub2tlbigpLl9mcm9tRG9jdW1lbnQodG9rZW4pLmNsaWVudChuZXcgPCU9c2NvcGUlPi5PQXV0aF9DbGllbnQoKS5fZnJvbURvY3VtZW50KGNsaWVudCkpLnVzZXIodXNlcikuYWN0aXZlKHRydWUpLmVuYWJsZWQodHJ1ZSkuc3RvcmUoKS50aGVuKHQgPT4gYXBwLm9hdXRoLmhhbmRsZXIodCwgJ3NhdmVUb2tlbicpKSwNCiAgICAgICAgICAgICAgICAJICAgIHJldm9rZVRva2VuOiB0b2tlbiA9PiBuZXcgPCU9c2NvcGUlPi5PQXV0aF9Ub2tlbigpLnJlZnJlc2hUb2tlbih0b2tlbi5yZWZyZXNoVG9rZW4pLmNsaWVudChuZXcgPCU9c2NvcGUlPi5PQXV0aF9DbGllbnQoKS5pZCh0b2tlbi5jbGllbnQuaWQpLmFjdGl2ZSh0cnVlKS5lbmFibGVkKHRydWUpKS5maW5kKCkudGhlbih0ID0+IHQuZW5hYmxlZChmYWxzZSkuYWN0aXZlKGZhbHNlKS5zdG9yZSgpKS50aGVuKHQgPT4gYXBwLm9hdXRoLmhhbmRsZXIodCwgJ3Jldm9rZVRva2VuJykpLA0KICAgICAgICAgICAgICAgIAkgICAgZ2V0UmVmcmVzaFRva2VuOiByZWZyZXNoVG9rZW4gPT4gbmV3IDwlPXNjb3BlJT4uT0F1dGhfVG9rZW4oKS5yZWZyZXNoVG9rZW4ocmVmcmVzaFRva2VuKS5hY3RpdmUodHJ1ZSkuZW5hYmxlZCh0cnVlKS5maW5kKDIvKndoeSovKS50aGVuKHQgPT4gdC5fdG9Eb2N1bWVudCgpKS50aGVuKHQgPT4ge3QucmVmcmVzaFRva2VuRXhwaXJlc0F0ID0gbmV3IERhdGUodC5yZWZyZXNoVG9rZW5FeHBpcmVzT24pOyByZXR1cm4gdH0pLA0KICAgICAgICAJICAgICAgICB9KSkoKQ0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgIGFwcC5vYXV0aC5oYW5kbGVyID0gKHQsIG0pID0+IHsNCiAgICAgICAgICAgICAgICAgICAgdHJ5ew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYobSkgPCU9bG9nKCklPm0sIHQuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdC5fdG9Eb2N1bWVudCgpOw0KICAgICAgICAgICAgICAgICAgICB9Y2F0Y2goZXgpew0KICAgICAgICAgICAgICAgICAgICAgICAgPCU9d2FybigpJT5tLCBleC50b1N0cmluZygpKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH07DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGFwcC5wb3N0KCcvb2F1dGgvdG9rZW4nLCBhcHAub2F1dGgudG9rZW4oKSk7DQogICAgICAgICAgICAgICAgZ2xvYmFsLmF1dGhlbnRpY2F0ZSA9IGFwcC5vYXV0aC5hdXRoZW50aWNhdGUoKTsNCjwlIH0lPg0KDQo8JSBhckNsYXNzZXMuZm9yRWFjaChfYyA9PiBfYy5FbnRpdHlNZXRob2RzLmZpbHRlcihtID0+IG0uSXNQdWJsaWMpLmZvckVhY2gobSA9PiB7JT4NCiAgICAgICAgICAgICAgICBhcHAucG9zdCgnL21ldGhvZC88JT1uTmFtZShfYyklPi88JT1uTmFtZShtKSU+JywgKHJlcSwgcmVzKSA9PiB0aGlzLl9pbmJvdW5kQ2FsbChyZXEsIHJlcywgIjwlPW5OYW1lKF9jKSU+IiwgIjwlPW5OYW1lKG0pJT4iKSk7DQogICAgICAgICAgICAgICAgYXBwLmdldCgnL21ldGhvZC88JT1uTmFtZShfYyklPi88JT1uTmFtZShtKSU+JywgKHJlcSwgcmVzKSA9PiB0aGlzLl9pbmJvdW5kQ2FsbChyZXEsIHJlcywgIjwlPW5OYW1lKF9jKSU+IiwgIjwlPW5OYW1lKG0pJT4iKSk7DQo8JSB9KSklPg0KDQogICAgICAgICAgICAgICAgYXBwLnBvc3QoJy9tZXRob2QvOmNsYXNzLzptZXRob2QnLCBnbG9iYWwuYXV0aGVudGljYXRlLCAocmVxLCByZXMpID0+IHRoaXMuX2luYm91bmRDYWxsKHJlcSwgcmVzKSk7DQogICAgICAgICAgICAgICAgYXBwLmdldCgnL21ldGhvZC86Y2xhc3MvOm1ldGhvZCcsIGdsb2JhbC5hdXRoZW50aWNhdGUsIChyZXEsIHJlcykgPT4gdGhpcy5faW5ib3VuZENhbGwocmVxLCByZXMpKTsNCiAgICAgICAgDQo8JSBpZihjLkNvbmZpZyAmJiBjLkNvbmZpZ1snZ3JhcGhxbCddKXslPg0KICAgICAgICAgICAgICAgIGFwcC51c2UoJy9ncmFwaHFsJywgZ3JhcGhxbEhUVFAuZ3JhcGhxbEhUVFAoew0KICAgICAgICAgICAgICAgICAgICBzY2hlbWE6IGdyYXBocWwuYnVpbGRTY2hlbWEodGhpcy5fdG9HUUxTY2hlbWEoKSksDQogICAgICAgICAgICAgICAgICAgIHJvb3RWYWx1ZTogdGhpcy5fcWxSZXNvbHZlcigpLA0KICAgICAgICAgICAgICAgICAgICBncmFwaGlxbDogdGhpcy5fX2NvbmZpZygicGxheWdyb3VuZCIpLA0KICAgICAgICAgICAgICAgIH0pKTsNCiAgICAgICAgICAgICAgICBpZih0aGlzLl9fY29uZmlnKCJwbGF5Z3JvdW5kIikgJiYgdHlwZW9mKHBsYXlncm91bmQpIT09InVuZGVmaW5lZCIpIGFwcC5nZXQoJy9wbGF5Z3JvdW5kJywgcGxheWdyb3VuZC5kZWZhdWx0KHsgZW5kcG9pbnQ6ICcvZ3JhcGhxbCcgfSkpDQo8JSB9JT4NCg0KICAgICAgICAgICAgICAgIGlmKHRoaXMuX19jb25maWcoJ2VtYWlsLmhvc3QnKSl7DQogICAgICAgICAgICAgICAgICAgIDwlPXNjb3BlJT4udHJhbnNwb3J0ZXIgPSBub2RlbWFpbGVyLmNyZWF0ZVRyYW5zcG9ydCh7DQogICAgICAgICAgICAgICAgICAgICAgICBzZXJ2aWNlOiB0aGlzLl9fY29uZmlnKCdlbWFpbC5ob3N0JyksDQogICAgICAgICAgICAgICAgICAgICAgICBhdXRoOiB0aGlzLl9fY29uZmlnKCdlbWFpbC51c2VyJyk/ew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXI6IHRoaXMuX19jb25maWcoJ2VtYWlsLnVzZXInKSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXNzOiB0aGlzLl9fY29uZmlnKCdlbWFpbC5wYXNzd29yZCcpLA0KICAgICAgICAgICAgICAgICAgICAgICAgfTp1bmRlZmluZWQsDQogICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgLyoNCiAgICAgICAgICAgICAgICAgICAgYXdhaXQgPCU9c2NvcGUlPi50cmFuc3BvcnRlci5zZW5kTWFpbCh7DQogICAgICAgICAgICAgICAgICAgICAgICBmcm9tOiB0aGlzLl9fY29uZmlnKCdlbWFpbC5zZW5kZXInKSwNCiAgICAgICAgICAgICAgICAgICAgICAgIHRvLA0KICAgICAgICAgICAgICAgICAgICAgICAgc3ViamVjdCwNCiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQsDQogICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgICAgICAqLw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICBsZXQgcG9ydCA9IDwlPW5zY29wZSU+Ll9ub2RlPyg8JT1uc2NvcGUlPi5fbm9kZS5wb3J0KCkgfHwgMzAwMCk6MzAwMDsNCiAgICAgICAgICAgICAgICBsZXQgYWRkcmVzcyA9ICIwLjAuMC4wIjsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICBsZXQgbGlzdGVuID0gYXN5bmMgKCkgPT4gPCU9bG9nKCklPmA8JT1zY29wZSU+WyR7dGhpcy5pcEFkZHJlc3MoKX1dIGxpc3RlbmluZyBhdCBodHRwJHtzZWN1cmU/J3MnOicnfTovLyR7YWRkcmVzc306JHtwb3J0fWApOw0KICAgICAgICAgICAgICAgIGlmKHNlY3VyZSl7DQogICAgICAgICAgICAgICAgICAgIGxldCBjZXJ0ID0gbnVsbDsNCiAgICAgICAgICAgICAgICAgICAgaWYodGhpcy5fX2NvbmZpZygnc2VjdXJlLnByaXZhdGUnKSl7DQogICAgICAgICAgICAgICAgICAgICAgICBjZXJ0ID0gew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaXZhdGU6IChhd2FpdCBmcy5wcm9taXNlcy5yZWFkRmlsZSh0aGlzLl9fY29uZmlnKCdzZWN1cmUucHJpdmF0ZScpKSksDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2VydDogKGF3YWl0IGZzLnByb21pc2VzLnJlYWRGaWxlKHRoaXMuX19jb25maWcoJ3NlY3VyZS5jZXJ0JykpKSwNCiAgICAgICAgICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICAgICAgY2VydCA9IHNlbGZzaWduZWQuZ2VuZXJhdGUoW3sgbmFtZTogJ2NvbW1vbk5hbWUnLCB2YWx1ZTogJ25hbW1vdXIuY29tJyB9XSwgeyBkYXlzOiAzNjUgfSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgZ2xvYmFsLmV4U2VydmVyID0gaHR0cHMuY3JlYXRlU2VydmVyKHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGtleTogY2VydC5wcml2YXRlLA0KICAgICAgICAgICAgICAgICAgICAgICAgY2VydDogY2VydC5jZXJ0DQogICAgICAgICAgICAgICAgICAgIH0sIGFwcCkubGlzdGVuKHBvcnQsIGFkZHJlc3MsIGxpc3Rlbik7DQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIGdsb2JhbC5leFNlcnZlciA9IGh0dHAuY3JlYXRlU2VydmVyKGFwcCkubGlzdGVuKHBvcnQsIGFkZHJlc3MsIGxpc3Rlbik7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9Y2F0Y2goZXgpew0KICAgICAgICAgICAgPCU9ZXJyb3IoKSU+ZXgpOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICB9DQoNCiAgICBhc3luYyA8JT1tTmFtZT0nX2luYm91bmRDYWxsJyU+KHJlcSwgcmVzLCBjTmFtZSwgbU5hbWUpew0KICAgICAgICBsZXQgcmV0ID0ge307DQogICAgICAgIHRyeXsNCiAgICAgICAgICAgIHJldCA9IGF3YWl0IG5ldyA8JT1zY29wZSU+W3JlcS5wYXJhbXMuY2xhc3MgfHwgY05hbWVdKCkuX2ludm9rZShyZXEucGFyYW1zLm1ldGhvZCB8fCBtTmFtZSwgcmVxLmJvZHksIHJlcS5xdWVyeSwgcmVxLl9fYXV0aG9yaXphdGlvbik7DQogICAgICAgIH1jYXRjaChleCl7DQogICAgICAgICAgICA8JT1lcnJvcigpJT5leCk7DQogICAgICAgICAgICByZXQgPSB7DQogICAgICAgICAgICAgICAgRXhjZXB0aW9uOiAiRXhjZXB0aW9uOiAiICsgZXgsDQogICAgICAgICAgICB9Ow0KICAgICAgICB9DQoNCiAgICAgICAgaWYocmV0ICYmIHR5cGVvZihyZXQpPT09Im51bWJlciIpIHJldCA9IHJldC50b1N0cmluZygpOw0KICAgICAgICByZXMuc2VuZChyZXQpOw0KICAgIH0NCg0KPCUgaWYoYy5Db25maWdbJ2dyYXBocWwnXSl7JT4NCiAgICA8JT1tTmFtZT0nX3FsU2VsZWN0aW9ucyclPihzU2V0KXsNCiAgICAgICAgbGV0IHJldCA9IFtdOw0KICAgICAgICBpZighc1NldCB8fCAhc1NldC5zZWxlY3Rpb25zKSByZXR1cm4gcmV0Ow0KICAgICAgICANCiAgICAgICAgc1NldC5zZWxlY3Rpb25zLmZpbHRlcihzID0+IHMuc2VsZWN0aW9uU2V0KS5mb3JFYWNoKHMgPT4gew0KPCUgYy5FbnRpdHlBdHRyaWJ1dGVzLmZpbHRlcihlYSA9PiBlYS5FbnRpdHlUeXBlICYmICFlYS5FbnRpdHlNZXRob2QpLmZvckVhY2goZWEgPT4geyU+DQogICAgICAgICAgICBpZihzLm5hbWUudmFsdWU9PSI8JT1uTmFtZShlYSklPiIpew0KICAgICAgICAgICAgICAgIDwlPWxvZygpJT4nUmVmZXJlbmNlIGZvciA8JT1uTmFtZShlYSklPicsIHMpOw0KICAgICAgICAgICAgICAgIGxldCBzT2JqID0gbmV3IDwlPXNjb3BlJT4uPCU9bk5hbWUoZWEuRW50aXR5VHlwZSwgdHJ1ZSklPigpLjwlPW5OYW1lKGVhKSU+XzwlPWMuUGx1cmFsLnJlcGxhY2UoLyAvZywgJ18nKSU+KHRoaXMpOw0KICAgICAgICAgICAgICAgIHJldC5wdXNoKHNPYmopOw0KICAgICAgICAgICAgICAgIHJldC5wdXNoKC4uLnNPYmouX3FsU2VsZWN0aW9ucyhzLnNlbGVjdGlvblNldCkpOw0KICAgICAgICAgICAgfQ0KPCUgfSklPg0KICAgICAgICB9KTsNCiAgICAgICAgDQogICAgICAgIHJldHVybiByZXQ7DQogICAgfQ0KICAgIA0KICAgIDwlPW1OYW1lPSdfcWxSZXNvbHZlciclPigpew0KICAgICAgICByZXR1cm4gew0KPCUgYXJDbGFzc2VzLmZvckVhY2goX2MgPT4geyU+DQogICAgICAgICAgICA8JT1uTmFtZShfYyklPjogYXN5bmMgKHBhcmVudCwgYXJncywgY29udGV4dCwgaW5mbykgPT4gew0KICAgICAgICAgICAgICAgIGlmKCFwYXJlbnQuZGF0YSkgcGFyZW50LnF1ZXJ5ID0gcGFyZW50LnF1ZXJ5IHx8IHt9Ow0KICAgICAgICAgICAgICAgIGxldCBvYmogPSBuZXcgPCU9c2NvcGUlPi48JT1uTmFtZShfYyklPigpLl9mcm9tRG9jdW1lbnQocGFyZW50LnF1ZXJ5IHx8IHBhcmVudC5kYXRhKTsNCiAgICAgICAgICAgICAgICBsZXQgcmV0ID0gbnVsbDsNCiAgICAgICAgICAgICAgICBpZihwYXJlbnQucXVlcnkpew0KICAgICAgICAgICAgICAgICAgICBsZXQgZmllbGRzID0gbnVsbDsNCiAgICAgICAgICAgICAgICAgICAgcmV0ID0gYXdhaXQgb2JqLmZpbmRBbGwobnVsbCwgb2JqLl9xbFNlbGVjdGlvbnMoY29udGV4dC5maWVsZE5vZGVzWzBdLnNlbGVjdGlvblNldCksIG51bGwsIG51bGwsIFt0aGlzLl9fY29uZmlnKCdpZEZpZWxkJywgJ0lkJyldLmNvbmNhdChjb250ZXh0LmZpZWxkTm9kZXNbMF0uc2VsZWN0aW9uU2V0LnNlbGVjdGlvbnMubWFwKHMgPT4gcy5uYW1lLnZhbHVlKSkpOw0KICAgICAgICAgICAgICAgIH1lbHNlIGlmKHBhcmVudC5kYXRhKXsNCiAgICAgICAgICAgICAgICAgICAgcmV0ID0gYXdhaXQgb2JqLnN0b3JlKCk7DQogICAgICAgICAgICAgICAgICAgIGlmKG9iai5fX2Fzc2VydEVycm9yKSB0aHJvdyBvYmouX19hc3NlcnRFcnJvcjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYoQXJyYXkuaXNBcnJheShyZXQpKXsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldC5tYXAociA9PiByLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0P3JldC5fdG9Eb2N1bWVudCgpOnJldDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9LA0KICAgIDwlIF9jLkVudGl0eU1ldGhvZHMuZm9yRWFjaChfbSA9PiB7JT4NCiAgICAgICAgICAgIC8vIDwlPW5OYW1lKF9tKSU+OiAocGFyZW50LCBhcmdzLCBjb250ZXh0LCBpbmZvKSA9PiBuZXcgPCU9c2NvcGUlPi48JT1uTmFtZShfYyklPigpLjwlPW5OYW1lKF9tKSU+KCI8JT1uTmFtZShfbSklPiIsIHBhcmVudCwgYXJncywgY29udGV4dCwgaW5mbyksDQogICAgPCUgfSklPg0KPCUgfSklPg0KICAgICAgICB9Ow0KICAgIH0NCiAgICANCiAgICA8JT1tTmFtZT0nX3RvR1FMU2NoZW1hJyU+KCl7DQogICAgICAgIGxldCByZXQgPSBgDQp0eXBlIFF1ZXJ5IHsNCjwlIGFyQ2xhc3Nlcy5mb3JFYWNoKF9jID0+IHslPg0KICAgICIiIg0KICAgIEZpbmQgYWxsIG1hdGNoZXMgZm9yIDwlPW5OYW1lKF9jKSU+DQogICAgIiIiDQogICAgPCU9bk5hbWUoX2MpJT4ocXVlcnk6IDwlPW5OYW1lKF9jKSU+SW5wdXQpOiBbPCU9bk5hbWUoX2MpJT5dDQo8JSB9KSU+DQp9DQoNCnR5cGUgTXV0YXRpb24gew0KPCUgYXJDbGFzc2VzLmZvckVhY2goX2MgPT4geyU+DQogICAgIiIiDQogICAgU3RvcmUgYSBzaW5nbGUgPCU9bk5hbWUoX2MpJT4gb2JqZWN0DQogICAgIiIiDQogICAgPCU9bk5hbWUoX2MpJT4oZGF0YTogPCU9bk5hbWUoX2MpJT5JbnB1dCk6IDwlPW5OYW1lKF9jKSU+DQo8JSB9KSU+DQp9DQogICAgDQogICAgPCUgYXJDbGFzc2VzLmZvckVhY2goX2MgPT4geyU+DQoiIiINCklucHV0IHR5cGUgZm9yIDwlPW5OYW1lKF9jKSU+DQoiIiINCmlucHV0IDwlPW5OYW1lKF9jKSU+SW5wdXR7DQogICAgPCUgX2MuRW50aXR5QXR0cmlidXRlcy5maWx0ZXIoZWEgPT4gIWVhLkVudGl0eU1ldGhvZCkuZm9yRWFjaChlYSA9PiB7JT4NCiAgICA8JT1uTmFtZShlYSklPjogPCU9cWxUeXBlKGVhLCB0cnVlKSU+DQogICAgPCUgfSklPg0KICAgIDwlIF9jLlR5cGVkQXR0cmlidXRlcy5maWx0ZXIodGEgPT4gIXRhLkVudGl0eU1ldGhvZCAmJiB0YS5FbnRpdHlUeXBlKS5mb3JFYWNoKHRhID0+IHsgbGV0IHRhTmFtZSA9IHRhLkVudGl0eUNsYXNzLlBsdXJhbC5yZXBsYWNlKC8gL2csICdfJyk7ICU+DQogICAgPCU9bk5hbWUodGEpJT5fPCU9dGFOYW1lJT46IFs8JT1uTmFtZSh0YS5FbnRpdHlDbGFzcyklPklucHV0XQ0KICAgIDwlIH0pJT4NCiAgICBPUEVSQVRPUlM6IDwlPW5OYW1lKF9jKSU+T3BlcmF0b3INCn0NCg0KaW5wdXQgPCU9bk5hbWUoX2MpJT5PcGVyYXRvcnsNCiAgICA8JSBfYy5FbnRpdHlBdHRyaWJ1dGVzLmZpbHRlcihlYSA9PiAhZWEuRW50aXR5TWV0aG9kKS5mb3JFYWNoKGVhID0+IHslPg0KICAgIDwlPW5OYW1lKGVhKSU+OiBTdHJpbmcNCiAgICA8JSB9KSU+DQp9DQoNCiIiIg0KPCU9X2MuUmVtYXJrJT4NCiIiIg0KdHlwZSA8JT1uTmFtZShfYyklPnsNCiAgICBfaWQ6IElEIQ0KICAgIDwlIF9jLkVudGl0eUF0dHJpYnV0ZXMuZmlsdGVyKGVhID0+ICFlYS5FbnRpdHlNZXRob2QpLmZvckVhY2goZWEgPT4geyU+DQogICAgIiIiDQogICAgPCU9ZWEuUmVtYXJrJT4NCiAgICAiIiINCiAgICA8JT1uTmFtZShlYSklPjogPCU9cWxUeXBlKGVhKSU+PCU9ZWEuSXNSZXF1aXJlZD8nISc6JyclPg0KICAgIDwlIH0pJT4NCiAgICA8JSBfYy5UeXBlZEF0dHJpYnV0ZXMuZmlsdGVyKHRhID0+ICF0YS5FbnRpdHlNZXRob2QgJiYgdGEuRW50aXR5VHlwZSkuZm9yRWFjaCh0YSA9PiB7IGxldCB0YU5hbWUgPSB0YS5FbnRpdHlDbGFzcy5QbHVyYWwucmVwbGFjZSgvIC9nLCAnXycpOyAlPg0KICAgIDwlPW5OYW1lKHRhKSU+XzwlPXRhTmFtZSU+OiBbPCU9bk5hbWUodGEuRW50aXR5Q2xhc3MpJT5dDQogICAgPCUgfSklPg0KDQogICAgPCUgX2MuRW50aXR5TWV0aG9kcy5maWx0ZXIoX20gPT4gIV9tLk1ldGhvZFBhcmFtZXRlcnMubGVuZ3RoKS5mb3JFYWNoKF9tID0+IHslPg0KICAgICIiIg0KICAgIDwlPV9tLlJlbWFyayU+DQogICAgIiIiDQogICAgPCU9bk5hbWUoX20pJT46IDwlPXFsVHlwZShfbS5SZXNwb25zZUF0dHJpYnV0ZSwgdHJ1ZSklPg0KICAgIDwlIH0pJT4NCiAgICA8JSBfYy5FbnRpdHlNZXRob2RzLmZpbHRlcihfbSA9PiBfbS5NZXRob2RQYXJhbWV0ZXJzLmxlbmd0aCkuZm9yRWFjaChfbSA9PiB7JT4NCiAgICAiIiINCiAgICA8JT1fbS5SZW1hcmslPg0KICAgICIiIg0KICAgIDwlPW5OYW1lKF9tKSU+KDwlPV9tLk1ldGhvZFBhcmFtZXRlcnMubWFwKHAgPT4gbk5hbWUocCkgKyAnOiAnICsgcWxUeXBlKHAsIHRydWUpKS5qb2luKCcsICcpJT4pOiA8JT1xbFR5cGUoX20uUmVzcG9uc2VBdHRyaWJ1dGUpJT4NCiAgICA8JSB9KSU+DQp9DQogICAgPCUgfSklPg0KICAgICAgICBgOw0KICAgICAgICA8JT1sb2coKSU+cmV0KTsNCiAgICAgICAgcmV0dXJuIHJldDsNCiAgICB9DQo8JSB9IC8vIGdyYXBoJT4NCg0KPCUgfSAvLyBJc01haW4gJT4NCg0KICAgIGFzeW5jIDwlPW1OYW1lPSdfaW52b2tlTm9kZSclPihuLCBtZXRob2QsIGRhdGEsIGV2ZW50LCBiUmF3KSB7DQogICAgICAgIC8vIGlmKCFuKSByZXR1cm4gbnVsbDsNCiAgICAgICAgDQogICAgICAgIGlmKHR5cGVvZig8JT1uc2NvcGUlPi5fbm9kZSk9PT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICA8JT13YXJuKCklPiI8JT1uc2NvcGUlPi5fbm9kZSBub3QgZGVmaW5lZCIpOw0KICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIGlmKGV2ZW50KXsNCjwlIGlmKF9jTmFtZSgnRXZlbnQnKSl7JT4NCiAgICAgICAgICAgIGlmKGV2ZW50Ll9jbGFzc05hbWVfc2V0ICYmIGV2ZW50LmNsYXNzTmFtZSgpICYmIGV2ZW50LmNsYXNzTmFtZSgpIT0nPCU9bk5hbWUoYyklPicpew0KICAgICAgICAgICAgICAgIGxldCBvQ2xhc3MgPSBudWxsOw0KICAgICAgICAgICAgICAgIGlmKGZhbHNlKXsNCiAgICAgICAgICAgICAgICAgICAgPCU9bG9nKCklPiJEZWxlZ2F0aW5nIGludm9rYXRpb24gdG8gIiArIGV2ZW50LmNsYXNzTmFtZSgpKycuJyttZXRob2QrJyAuLi4uJyk7DQogICAgPCUgc3IuZ3JvdXBCeShhckNsYXNzZXMsICdFbnRpdHlNb2R1bGUnKS5mb3JFYWNoKGVtID0+IHslPg0KICAgICAgICAgICAgICAgIH1lbHNlIGlmKFsiPCU9ZW0udmFsdWVzLm1hcChtYyA9PiBuTmFtZShtYykpLmpvaW4oJyIsICInKSU+Il0uaW5kZXhPZihldmVudC5jbGFzc05hbWUoKSk+PTApew0KICAgICAgICAgICAgICAgICAgICBvQ2xhc3MgPSBuZXcgPCU9c2NvcGUlPjwlPWVtLmtleT8oJy4nK2VtLmtleS5BbGlhcyk6JyclPltldmVudC5jbGFzc05hbWUoKV0oKTsNCiAgICA8JSB9KSU+DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHJldHVybiBhd2FpdCBvQ2xhc3MuPCU9bU5hbWUlPihuLCBtZXRob2QsIGRhdGEsIGV2ZW50LCBiUmF3KTsNCiAgICAgICAgICAgIH0NCjwlIH1lbHNleyU+DQogICAgICAgICAgICA8JT1lcnJvcigpJT4iRXZlbnQgY2Fubm90IGJlIGRlZmluZWQgd2l0aG91dCB0aGUgRXZlbnQgY2xhc3MiKTsNCiAgICAgICAgICAgIHJldHVybiBudWxsOw0KPCUgfSU+DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIGxldCByZXQgPSBudWxsOw0KDQogICAgICAgIGRhdGEgPSBkYXRhIHx8IHt9Ow0KDQogICAgICAgIGlmKHR5cGVvZihkYXRhKT09PSJvYmplY3QiKXsNCiAgICAgICAgICAgIGRhdGEuX190aGlzID0gZGF0YS5fX3RoaXMgfHwgdGhpcy5fdG9KU09OKHtwYXJzZTogMX0pOw0KICAgICAgICAgICAgc3dpdGNoKG1ldGhvZCl7DQogICAgPCUgYy5FbnRpdHlNZXRob2RzLmZvckVhY2gobSA9PiB7JT4NCiAgICAgICAgICAgICAgICBjYXNlICI8JT1uQ29kZShtKSU+Ijogew0KICAgICAgICA8JSBtLk1ldGhvZFBhcmFtZXRlcnMuZm9yRWFjaChwID0+IHslPg0KICAgICAgICAgICAgICAgICAgICBkYXRhLjwlPW5OYW1lKHApJT4gPSBkYXRhLjwlPW5OYW1lKHApJT4/ZGF0YS48JT1uTmFtZShwKSU+DQogICAgICAgICAgICA8JWlmKHAuSXNBcnJheSl7JT4ubWFwKF9wID0+IF9wPCV9JT4NCiAgICAgICAgICAgIDwlIGlmKHAuRW50aXR5VHlwZSl7JT4uX3RvRG9jdW1lbnQoKQ0KICAgICAgICAgICAgPCUgfWVsc2UgaWYocC5Jc0RhdGUpeyU+LnRvSVNPU3RyaW5nKCkNCiAgICAgICAgICAgIDwlIH0lPg0KICAgICAgICAgICAgPCVpZihwLklzQXJyYXkpeyU+KTwlfSU+OnVuZGVmaW5lZDsNCiAgICAgICAgPCUgfSklPg0KICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICB9DQogICAgPCUgfSklPg0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCjwlIGlmKF9jTmFtZSgnTm9kZScpKXslPg0KICAgICAgICBpZih0eXBlb2Yobik9PT0nc3RyaW5nJykgbiA9IG5ldyA8JT1zY29wZSU+LjwlPV9jTmFtZSgnTm9kZScsIHRydWUpJT4oKS5jb2RlKG4pOw0KPCUgfSU+DQoNCiAgICAgICAgaWYoIW4gfHwgPCU9bnNjb3BlJT4uX25vZGUuX3NhbWVFbnRpdHkobikpew0KICAgICAgICAgICAgcmV0ID0gYXdhaXQgdGhpcy5faW52b2tlKG1ldGhvZCwgZGF0YSk7DQogICAgICAgICAgICA8JT1sb2coKSU+IkxvY2FsIG5vZGUiLCByZXQpOw0KDQogICAgICAgIH1lbHNlIGlmKG4uYWRkcmVzcygpKXsNCiAgICAgICAgICAgIHRyeXsNCiAgICAgICAgICAgICAgICA8JT1sb2coKSU+bi5hZGRyZXNzKCksIG4ucG9ydCgpLCBtZXRob2QpOw0KICAgICAgICAgICAgICAgIHJldCA9IGF3YWl0IHRoaXMuX3Jlc3QodW5kZWZpbmVkLCBkYXRhLCBudWxsLCBudWxsLCB7cGF0aDogYGh0dHAke24uc2VjdXJlKCk/J3MnOicnfTovLyR7bi5hZGRyZXNzKCl9OiR7bi5wb3J0KCkgfHwgMzAwMH0vbWV0aG9kLzwlPW5OYW1lKGMpJT4vJHttZXRob2R9YCwgaGVhZGVyczoge319KTsNCiAgICAgICAgICAgIH1jYXRjaChleCl7DQogICAgICAgICAgICAgICAgPCU9ZXJyb3IoKSU+ZXgpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9ZWxzZXsNCjwlIGlmKF9jTmFtZSgnRXZlbnQnKSAmJiBjLk5hbWUhPT0nRXZlbnQnKXslPg0KICAgICAgICAgICAgaWYodHlwZW9mKGRhdGEpPT09Im9iamVjdCIpew0KICAgICAgICAgICAgICAgIGRlbGV0ZSBkYXRhLl9fdGhpcy5fX2dlbmVyYXRlZDsNCiAgICAgICAgICAgICAgICBkZWxldGUgZGF0YS5fX3RoaXMub25saW5lOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICAvL3doeSBkbyB3ZSBuZWVkIHRoaXM/Pz8NCiAgICAgICAgICAgIDwlIC8qdW5SZWN1cnNlKCdkYXRhJywgJ21ldGhvZCcsICd7fScsICcnLCA1LCAnX190aGlzLmNvZGUnKSovICU+DQogICAgICAgICAgICANCiAgICAgICAgICAgIGxldCBldiA9IG5ldyA8JT1zY29wZSU+LjwlPV9jTmFtZSgnRXZlbnQnLCB0cnVlKSU+KCkuYWN0aXZlKHRydWUpLmVuYWJsZWQodHJ1ZSkuY29kZSh0aGlzLl91dWlkKCkpLm5hbWUodGhpcy5fX2NvbmZpZygnZXZlbnQnKSB8fCAnPCU9c2NvcGUlPi5FdmVudCcpLmRhdGUodGhpcy5zZXJ2ZXJEYXRlKCkpLnJlY2lwaWVudChuKS5tZXRob2QobWV0aG9kKS5jbGFzc05hbWUoJzwlPW5OYW1lKGMpJT4nKS5zZW5kZXIoPCU9bnNjb3BlJT4uX25vZGUpLmNhcnJpZXIoPCU9bnNjb3BlJT4uX25vZGUpLnBheWxvYWQodGhpcy5fYnRvYShKU09OLnN0cmluZ2lmeShkYXRhKSkpOw0KICAgICAgICAgICAgaWYoZXZlbnQpew0KICAgICAgICAgICAgICAgIGlmKGV2ZW50Ll9yZXNwb25zZVRvX3NldCkgZXYucmVzcG9uc2VUbyhldmVudC5yZXNwb25zZVRvKCkpOw0KICAgICAgICAgICAgICAgIGlmKGV2ZW50Ll9zZW5kZXJfc2V0KSBldi5zZW5kZXIoZXZlbnQuc2VuZGVyKCkpOw0KICAgICAgICAgICAgICAgIGlmKGV2ZW50Ll9jbGFzc05hbWVfc2V0KSBldi5jbGFzc05hbWUoZXZlbnQuY2xhc3NOYW1lKCkpOw0KICAgICAgICAgICAgICAgIGlmKGV2ZW50Ll9jYXJyaWVyX3NldCB8fCBldmVudC5fc2VuZGVyX3NldCkgZXYuY2FycmllcihldmVudC5jYXJyaWVyKCkgfHwgZXZlbnQuc2VuZGVyKCkpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0ID0gYXdhaXQgZXYudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBpZih0eXBlb2YocmV0KT09PSJzdHJpbmciKXsNCiAgICAgICAgICAgICAgICB0cnl7DQogICAgICAgICAgICAgICAgICAgIHJldCA9IEpTT04ucGFyc2UocmV0KTsNCiAgICAgICAgICAgICAgICB9Y2F0Y2goZXgpew0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH1lbHNlIGlmKHJldCAmJiB0eXBlb2YocmV0LnBheWxvYWQpPT09J2Z1bmN0aW9uJyl7DQogICAgICAgICAgICAgICAgLy8gcmV0IGlzIGFuIGV2ZW50DQogICAgICAgICAgICAgICAgcmV0ID0gcmV0LnBheWxvYWQoKTsNCiAgICAgICAgICAgIH1lbHNlIGlmKEFycmF5LmlzQXJyYXkocmV0KSAmJiByZXRbMF0gJiYgdHlwZW9mKHJldFswXS5wYXlsb2FkKT09PSdmdW5jdGlvbicpew0KICAgICAgICAgICAgICAgIHJldCA9IHJldC5tYXAociA9PiByLnBheWxvYWQoKSk7DQogICAgICAgICAgICAgICAgaWYocmV0Lmxlbmd0aD09MSkgcmV0ID0gcmV0WzBdOw0KICAgICAgICAgICAgfQ0KPCUgfSU+DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIGlmKCFyZXQpIHJldHVybiBudWxsOw0KICAgICAgICByZXQgPSByZXQuZGF0YSB8fCByZXQ7DQoNCiAgICAgICAgaWYocmV0Ll9fZXhjZXB0aW9uKXsNCiAgICAgICAgICAgIC8vIGFuIGV4Y2VwdGlvbiBvY2N1cnJlZCBhdCB0aGUgc2VydmVyDQogICAgICAgICAgICA8JT1lcnJvcigpJT5gRXhjZXB0aW9uIGF0ICR7bi5fYWRkcmVzc31gLCByZXQuX19leGNlcHRpb24pOw0KICAgICAgICAgICAgcmV0dXJuIHJldDsNCiAgICAgICAgfQ0KDQogICAgICAgIHN3aXRjaChtZXRob2Qpew0KPCUgYy5FbnRpdHlNZXRob2RzLmZvckVhY2gobSA9PiB7JT4NCiAgICAgICAgICAgIGNhc2UgIjwlPW5Db2RlKG0pJT4iOiB7DQogICAgPCUgaWYobS5SZXNwb25zZUF0dHJpYnV0ZS5FbnRpdHlUeXBlKXsgJT4NCiAgICAgICAgICAgICAgICBpZighYlJhdykgcmV0ID0gbmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKG0uUmVzcG9uc2VBdHRyaWJ1dGUuRW50aXR5VHlwZSwgdHJ1ZSklPigpLl9mcm9tRG9jdW1lbnQocmV0KTsNCiAgICA8JSB9ICU+DQogICAgPCUgaWYobS5OYW1lPT0nYXV0aG9yaXplJyl7JT4NCiAgICAgICAgICAgICAgICA8JT1zY29wZSU+Ll9fdG9rZW4gPSB7dG9rZW5fdHlwZTogIkJlYXJlciIsIGFjY2Vzc190b2tlbjogcmV0fTsNCiAgICA8JSB9ICU+DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQo8JSB9KTsgJT4NCg0KICAgICAgICAgICAgY2FzZSAiaW5zZXJ0IjoNCiAgICAgICAgICAgIGNhc2UgInVwZGF0ZSI6DQogICAgICAgICAgICBjYXNlICJzdG9yZSI6DQogICAgICAgICAgICBjYXNlICJkZWxldGUiOg0KICAgICAgICAgICAgY2FzZSAiZmluZCI6IA0KICAgICAgICAgICAgY2FzZSAiZmluZEFsbCI6IHsNCiAgICAgICAgICAgICAgICBpZighYlJhdykgcmV0ID0gbmV3IDwlPXNjb3BlJT4uPCU9bk5hbWUoYywgdHJ1ZSklPigpLl9mcm9tRG9jdW1lbnQocmV0KTsNCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgZGVmYXVsdDogew0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcmV0dXJuIHJldDsNCiAgICB9DQoNCjwlIGlmKG1haW5DbGFzcygpKXslPg0KICAgIGFzeW5jIDwlPW1OYW1lPSdfaW52b2tlJyU+KG1ldGhvZCwgYm9keSwgcXVlcnksIGF1dGhPYmopew0KICAgICAgICB0aGlzLl9fdGltZSgnPCU9c2NvcGUlPi48JT1uTmFtZShjKSU+LicgKyBtZXRob2QpOw0KICAgICAgICA8JT1sb2coKSU+bWV0aG9kLCBxdWVyeSwgYm9keSk7DQogICAgICAgIA0KICAgICAgICBpZih0eXBlb2YoYm9keSk9PT0nc3RyaW5nJyl7DQogICAgICAgICAgICBpZig8JT1fYjY0dGVzdCgnYm9keScpJT4peyAvLyBiYXNlNjQ/DQogICAgICAgICAgICAgICAgYm9keSA9IHRoaXMuX2F0b2IoYm9keSk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKC9bXiw6e31cW1xdMC05LlwtK0VhZWZsbnItdSBcblxyXHRdLy50ZXN0KGJvZHkpKXsgLy8ganNvbg0KICAgICAgICAgICAgICAgIHRyeXsNCiAgICAgICAgICAgICAgICAgICAgYm9keSA9IEpTT04ucGFyc2UoYm9keS50b1N0cmluZygpKTsNCiAgICAgICAgICAgICAgICB9Y2F0Y2goZXgpew0KICAgICAgICAgICAgICAgICAgICA8JT13YXJuKCklPiJCb2R5IGlzIG5vdCBhIHZhbGlkIEpTT04iLCBib2R5KTsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIGxldCBfcGFyYW1zID0gcXVlcnk/T2JqZWN0LmFzc2lnbihxdWVyeSwgYm9keSk6Ym9keTsNCiAgICAgICAgaWYodHlwZW9mKF9wYXJhbXMpPT09J3N0cmluZycpIF9wYXJhbXMgPSBKU09OLnBhcnNlKF9wYXJhbXMpOw0KICAgICAgICANCiAgICAgICAgaWYoX3BhcmFtcyl7DQogICAgICAgICAgICBfcGFyYW1zID0gRG90T2JqZWN0Lm9iamVjdChfcGFyYW1zKTsNCiAgICAgICAgfWVsc2V7DQogICAgICAgICAgICBfcGFyYW1zID0ge307DQogICAgICAgIH0NCg0KICAgICAgICA8JT1sb2coKSU+Il9wYXJhbXMiLCBfcGFyYW1zKTsNCg0KICAgIDwlIGlmKF9jTmFtZSgnTm9kZScpICYmIGMuTmFtZSE9J05vZGUnKXslPg0KICAgICAgICBpZihfcGFyYW1zLl9fbm9kZSl7DQogICAgICAgICAgICAvLyBwcm9iYWJseSBzaG91bGQgbm90IGJlIHByb2Nlc3NlZCBoZXJlLCBidXQgcmF0aGVyIGNvbnN1bWVkIGFzIHBhcnQgb2YgdGhlIGV4ZWN1dGUoKSBsb2dpYywgcHVzaGluZyBfX25vZGUgdG8gdGhlIGxpc3Qgb2YgbXkgbm9kZXMgdG8gZGVsZWdhdGUgdG8hPw0KICAgICAgICAgICAgbGV0IHRuID0gbmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKCdOb2RlJywgdHJ1ZSklPigpLl9mcm9tRG9jdW1lbnQoX3BhcmFtcy5fX25vZGUpLyouX2RlUmVmZXJlbmNlKCkqLzsNCiAgICAgICAgICAgIGRlbGV0ZSBfcGFyYW1zLl9fbm9kZTsNCiAgICAgICAgICAgIHJldHVybiBhd2FpdCBuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUoYywgdHJ1ZSklPigpLl9pbnZva2VOb2RlKHRuLCBtZXRob2QsIF9wYXJhbXMpOw0KICAgICAgICB9DQogICAgPCUgfSU+DQoNCiAgICAgICAgaWYoX3BhcmFtcy5fX3RoaXMpIHsNCiAgICAgICAgICAgIF9wYXJhbXMuX190aGlzID0gRG90T2JqZWN0Lm9iamVjdChfcGFyYW1zLl9fdGhpcyk7DQogICAgICAgICAgICBsZXQgX190aGlzID0gbmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKGMsIHRydWUpJT4oKS5fZnJvbURvY3VtZW50KF9wYXJhbXMuX190aGlzKS8qLl9kZVJlZmVyZW5jZSgpKi87DQogICAgICAgICAgICBkZWxldGUgX3BhcmFtcy5fX3RoaXM7DQogICAgICAgICAgICByZXR1cm4gYXdhaXQgX190aGlzLjwlPW1OYW1lJT4obWV0aG9kLCBfcGFyYW1zLCBudWxsLCBhdXRoT2JqKTsNCiAgICAgICAgfQ0KDQogICAgICAgIGxldCBhckFyZ3MgPSBbXTsNCiAgICAgICAgc3dpdGNoKG1ldGhvZCl7DQo8JSBjLkVudGl0eU1ldGhvZHMuZm9yRWFjaChtID0+IHslPg0KICAgICAgICAgICAgY2FzZSAiPCU9bkNvZGUobSklPiI6IHsNCjwlIGlmKF9jTmFtZSgnVHJhbnNhY3Rpb24nKSAmJiBfY05hbWUoJ0NvbnRlbnQnKSAmJiBjLk5hbWUhPSdUcmFuc2FjdGlvbicgJiYgIW0uSXNTeW5jKXslPg0KICAgICAgICBpZighX3BhcmFtcy5TeW5jKXsNCiAgICAgICAgICAgIHJldHVybiBuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUoJ0NvbnRlbnQnLCB0cnVlKSU+KChhd2FpdCBuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUoJ0NvbnRlbnQnLCB0cnVlKSU+KCkuYWN0aXZlKHRydWUpLmVuYWJsZWQodHJ1ZSkuc2NvcGUoIjwlPXNjb3BlJT4iKS5jbGFzcygiPCU9Yy5OYW1lJT4iKS5tZXRob2QobWV0aG9kKS5hdXRob3JpemF0aW9uKGF1dGhPYmopLmRhdGUodGhpcy5zZXJ2ZXJEYXRlKCkpLnBheWxvYWQodGhpcy5fYnRvYShfcGFyYW1zKSkudHJhbnNhY3Rpb25fVHJhbnNhY3Rpb25Mb2dzKFtuZXcgPCU9c2NvcGUlPi5UcmFuc2FjdGlvbkxvZygpLmRhdGUodGhpcy5zZXJ2ZXJEYXRlKCkpLnN0YXRlKG5ldyA8JT1zY29wZSU+LlRyYW5zYWN0aW9uU3RhdGUoKS5hY3RpdmUodHJ1ZSkuZW5hYmxlZCh0cnVlKS5uYW1lKCJsb2FkZWQiKSldKS5zdG9yZSgpKS5JZCkuX3RvRG9jdW1lbnQoKTsNCiAgICAgICAgfQ0KPCUgfSU+DQoNCiAgICA8JSBtLk1ldGhvZFBhcmFtZXRlcnMuZm9yRWFjaChwID0+IHslPg0KICAgICAgICA8JSBpZihwLkVudGl0eVR5cGUgJiYgcC5Jc0FycmF5KXslPg0KICAgICAgICAgICAgICAgIF9wYXJhbXMuPCU9bkNvZGUocCklPiA9IF9wYXJhbXMuPCU9bkNvZGUocCklPi5tYXAocCA9PiBuZXcgPCU9c2NvcGUlPi48JT1uTmFtZShwLkVudGl0eVR5cGUpJT4oKS5fZnJvbURvY3VtZW50KHApLl9kZVJlZmVyZW5jZSgpKTsNCiAgICAgICAgPCUgfWVsc2UgaWYocC5FbnRpdHlUeXBlKXsgJT4NCiAgICAgICAgICAgICAgICBfcGFyYW1zLjwlPW5Db2RlKHApJT4gPSBuZXcgPCU9c2NvcGUlPi48JT1uTmFtZShwLkVudGl0eVR5cGUpJT4oKS5fZnJvbURvY3VtZW50KF9wYXJhbXMuPCU9bkNvZGUocCklPikuX2RlUmVmZXJlbmNlKCk7DQogICAgICAgIDwlIH0gJT4NCiAgICAgICAgICAgICAgICBhckFyZ3MucHVzaChfcGFyYW1zLjwlPW5Db2RlKHApJT4pOw0KICAgIDwlIH0pOyU+DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQo8JSB9KTslPg0KDQogICAgICAgICAgICBjYXNlICJmaW5kQWxsIjp7DQogICAgICAgICAgICAgICAgYXJBcmdzLnB1c2goX3BhcmFtcy5kZXB0aCk7DQogICAgICAgICAgICAgICAgYXJBcmdzLnB1c2goX3BhcmFtcy5vYmpzKTsNCiAgICAgICAgICAgICAgICBhckFyZ3MucHVzaChfcGFyYW1zLnN0YXJ0KTsNCiAgICAgICAgICAgICAgICBhckFyZ3MucHVzaChfcGFyYW1zLmVuZCk7DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXNlICJmaW5kIjogew0KICAgICAgICAgICAgICAgIGFyQXJncy5wdXNoKF9wYXJhbXMuZGVwdGgpOw0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBkZWZhdWx0OiB7DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIGxldCBvYmogPSB0aGlzOw0KICAgICAgICANCiAgICAgICAgbGV0IHJldCA9IG51bGw7DQogICAgICAgIGlmKCFvYmopew0KICAgICAgICAgICAgcmV0ID0gew0KICAgICAgICAgICAgICAgIF9fZXhjZXB0aW9uOiB7DQogICAgICAgICAgICAgICAgICAgICctMSc6IGA8JT1uTmFtZShjKSU+LjwlPW1OYW1lJT46IG9iaiBpcyB1bmRlZmluZWRgDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfTsNCiAgICAgICAgfWVsc2UgaWYoIW9ialttZXRob2RdKXsNCiAgICAgICAgICAgIHJldCA9IHsNCiAgICAgICAgICAgICAgICBfX2V4Y2VwdGlvbjogew0KICAgICAgICAgICAgICAgICAgICAnLTInOiBgPCU9bk5hbWUoYyklPi48JT1tTmFtZSU+OiBtZXRob2QgJHtvYmouY29uc3RydWN0b3IubmFtZX0oJHttZXRob2R9KSBpcyBub3QgZm91bmRgLA0KICAgICAgICAgICAgICAgICAgICAnb2JqJzogb2JqDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfTsNCiAgICAgICAgfWVsc2V7DQogICAgICAgICAgICByZXQgPSBhd2FpdCBvYmpbbWV0aG9kXSguLi5hckFyZ3MpOw0KICAgICAgICB9DQogICAgICAgIA0KPCUgY2xzVG9vbHMoYykuZm9yRWFjaCh0ID0+IHslPg0KICAgICAgICBpZih0aGlzLlRvb2wudHlwZS5uYW1lPT0iPCU9dCU+Iil7DQogICAgPCUgaWYodD09IlNxbERCIil7ICU+DQogICAgICAgICAgICBpZihmYWxzZSAmJiA8JT1zY29wZSU+Ll9fc3FsVHJhbnNhY3Rpb24gJiYgITwlPXNjb3BlJT4uX19zcWxUcmFuc2FjdGlvbi5lbmQpew0KICAgICAgICAgICAgICAgIHJldCA9IHsNCiAgICAgICAgICAgICAgICAgICAgX19leGNlcHRpb246IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICctNCc6ICJVbmNvbW1pdHRlZCB0cmFuc2FjdGlvbnM6ICIgKyA8JT1zY29wZSU+Ll9fc3FsVHJhbnNhY3Rpb24uc3Fscy5sZW5ndGgsDQogICAgICAgICAgICAgICAgICAgICAgICAnb2JqJzogb2JqDQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgPCUgfSU+DQogICAgICAgIH0NCjwlIH0pJT4NCg0KICAgICAgICBpZihyZXQgJiYgIXJldC5fX2V4Y2VwdGlvbil7DQogICAgICAgICAgICA8JT1zY29wZSU+Ll91blJlY3Vyc2UgPSB7fTsNCiAgICAgICAgICAgIGlmKEFycmF5LmlzQXJyYXkocmV0KSl7DQogICAgICAgICAgICAgICAgbGV0IF9yZXQgPSBbXTsNCiAgICAgICAgICAgICAgICBmb3IgYXdhaXQoY29uc3QgciBvZiByZXQpew0KICAgICAgICAgICAgICAgICAgICBpZihyICYmIHIuX3RvRG9jdW1lbnQpew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYoPCU9c2NvcGUlPi5fdW5SZWN1cnNlLjwlPW5OYW1lKGMpJT4pIGRlbGV0ZSA8JT1zY29wZSU+Ll91blJlY3Vyc2UuPCU9bk5hbWUoYyklPi5fdG9Eb2N1bWVudDsNCiAgICAgICAgICAgICAgICAgICAgICAgIF9yZXQucHVzaChhd2FpdCByLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgICAgICAgICB9ZWxzZSBfcmV0LnB1c2gocik7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHJldCA9IF9yZXQ7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXQgPSAocmV0ICYmIHJldC5fdG9Eb2N1bWVudCk/YXdhaXQgcmV0Ll90b0RvY3VtZW50KCk6cmV0Ow0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICA8JT1sb2coKSU+J3JldCcsIHJldCk7DQogICAgICAgIDwlPWxvZygpJT5gJHttZXRob2R9OiAke3RoaXMuX190aW1lKCc8JT1zY29wZSU+LjwlPW5OYW1lKGMpJT4uJyArIG1ldGhvZCl9YCk7DQogICAgICAgIHJldHVybiByZXQ7DQogICAgfQ0KDQo8JSBpZihfY05hbWUoJ05vZGUnKSl7JT4NCiAgICA8JT1tTmFtZT0nX3BhcnNlQ29kZVN0YXRlJyU+KHQpew0KICAgIDwlIGlmKG1haW5DbGFzcygpPT1jKXslPg0KICAgICAgICBsZXQgc3RhdGUgPSB0aGlzLl9fY29uZmlnKHRoaXMuX19jb25maWcoJ29hdXRoLnJlZGlyZWN0LnN0YXRlJywgbnVsbCwge3Rvb2w6IHR9KSk7DQogICAgICAgIGxldCBjb2RlID0gdGhpcy5fX2NvbmZpZyh0aGlzLl9fY29uZmlnKCdvYXV0aC5yZWRpcmVjdC5jb2RlJywgbnVsbCwge3Rvb2w6IHR9KSk7DQogICAgICAgIGlmKCFzdGF0ZSB8fCAhY29kZSkgcmV0dXJuOw0KICAgICAgICBzdGF0ZSA9IEpTT04ucGFyc2UodGhpcy5fYXRvYihzdGF0ZSkpOw0KICAgICAgICBpZihzdGF0ZS50b29sIT09dC5uYW1lKSByZXR1cm47DQoNCiAgICAgICAgPCU9bG9nKCklPiJHT1QgQ09ERSAiICsgY29kZSArICIgZm9yIG5vZGUgIiArIHN0YXRlLm5jb2RlICsgIiB3aXRoIHRvb2wgIiArIHN0YXRlLnRvb2wpOw0KICAgICAgICBpZighPCU9bnNjb3BlJT4uX25vZGUucGFyZW50KCkgfHwgITwlPW5zY29wZSU+Ll9ub2RlLl9wYXJlbnQuX3NhbWVFbnRpdHkoPCU9bnNjb3BlJT4uX25vZGUucGFyZW50KCkpKXsNCiAgICAgICAgICAgIDwlPWxvZygpJT4nbmV3IHBhcmVudCcsIHN0YXRlLm5jb2RlKTsNCiAgICAgICAgICAgIDwlPW5zY29wZSU+Ll9ub2RlLnBhcmVudChuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUoJ05vZGUnLCB0cnVlKSU+KCkuY29kZShzdGF0ZS5uY29kZSkpOw0KICAgICAgICB9DQogICAgICAgIDwlPW5zY29wZSU+Ll9ub2RlLmF1dGhDb2RlKGNvZGUsIG5ldyA8JT1zY29wZSU+LjwlPV9jTmFtZSgnVG9vbCcsIHRydWUpJT4oKS5uYW1lKHN0YXRlLnRvb2wpKTsNCiAgICAgICAgd2luZG93LmNsb3NlKCk7DQogICAgPCUgfWVsc2V7JT4NCiAgICAgICAgcmV0dXJuIG5ldyA8JT1zY29wZSU+LjwlPW5OYW1lKG1haW5DbGFzcygpKSU+KCkuPCU9bU5hbWUlPih0KTsNCiAgICA8JSB9JT4NCiAgICB9DQo8JSB9JT4NCg0KICAgIGFzeW5jIDwlPW1OYW1lPSdfbG9hZFRvb2xzJyU+KGJTdG9yZSl7DQogICAgICAgIGlmKDwlPXNjb3BlJT4uVG9vbHMgJiYgPCU9c2NvcGUlPi5Ub29scy5sZW5ndGgpew0KICAgICAgICAgICAgPCU9bG9nKCklPmBUb29scyBhbHJlYWR5IGxvYWRlZGApOw0KICAgICAgICAgICAgcmV0dXJuIDwlPXNjb3BlJT4uVG9vbHM7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIDwlPWxvZygpJT5gTG9hZGluZyB0b29scy4uLmApOw0KICAgICAgICANCiAgICAgICAgbGV0IHRvb2xzID0gW107DQogICAgICAgIHRvb2xzID0gPCU9c2NvcGUlPi5fX1Rvb2xzIHx8IHRvb2xzOw0KICAgICAgICBkZWxldGUgPCU9c2NvcGUlPi5fX1Rvb2xzOw0KDQogICAgICAgIGxldCBhclRvb2xzID0gPCU9X0ZyRU1ELl90b0pTKFsuLi5uZXcgU2V0KGFyQ2xhc3Nlcy5tYXAoX2MgPT4gX2MuVG9vbHMpLmZsYXQoKSldKSU+Ow0KICAgICAgICBsZXQgdG9vbE5hbWVzID0gYXJUb29scy5tYXAodCA9PiB0Lm5hbWUgfHwgKHQudHlwZT90LnR5cGUubmFtZTp0KSk7DQogICAgICAgIHRyeXsNCiAgICAgICAgICAgIGlmKHRvb2xzLmxlbmd0aCE9PXRvb2xOYW1lcy5sZW5ndGgpew0KICAgICAgICAgICAgICAgIC8vIGNhbm5vdCB1c2UgcmVxdWlyZSB5ZXQsIG5vIHRvb2xzIHByb3Blcmx5IGxvYWRlZCB0byB1c2UgYSBsb2FkZXIgZnVuY3Rpb24NCiAgICAgICAgICAgICAgICB0b29scyA9IGF3YWl0IHRoaXMuX2dldFN0b3JlZFNjcmlwdCh7TmFtZTogJ0FQSVNFUlZFUjwlPW1OYW1lJT4nLCBBY3RpdmU6IHRydWUsIEVuYWJsZWQ6IHRydWV9KSB8fCB0b29sczsNCiAgICAgICAgICAgIH0NCg0KPCUgaWYoX2NOYW1lKCdUb29sJykpeyU+DQogICAgICAgICAgICBpZighdG9vbHMubGVuZ3RoKSB0b29scyA9IChhd2FpdCBuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUoJ1Rvb2wnLCB0cnVlKSU+KCkuVEhJUyh0b29sTmFtZXMubWFwKHQgPT4gbmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKCdUb29sJywgdHJ1ZSklPigpLm5hbWUodCkpKS5maW5kQWxsKDIpKS5tYXAodCA9PiB0Ll90b0pTT04oe3BhcnNlOiAxfSkpIHx8IHRvb2xzOw0KPCUgfSU+DQogICAgICAgIH1jYXRjaChleCl7DQogICAgICAgICAgICA8JT13YXJuKCklPmV4KTsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgbGV0IGZpeFRvb2xzID0gdG9vbHMgPT4gew0KICAgICAgICAgICAgdG9vbHMuZmlsdGVyKHQgPT4gdHlwZW9mKHQpPT09J29iamVjdCcgJiYgdCkuZm9yRWFjaCh0ID0+IHsNCiAgICAgICAgICAgICAgICA8JV9kZWYoJ3QuSWQnLCAndGhpcy5fdXVpZCgpJyklPg0KICAgICAgICAgICAgICAgIDwlX2RlZigndC5uYW1lJywgJ3QudHlwZS5uYW1lJyklPg0KICAgICAgICAgICAgICAgIDwlX2RlZigndC5hY3RpdmUnLCB0cnVlKSU+DQogICAgICAgICAgICAgICAgPCVfZGVmKCd0LmVuYWJsZWQnLCB0cnVlKSU+DQogICAgICAgICAgICAgICAgPCVfZGVmKCd0LnR5cGUuYWN0aXZlJywgdHJ1ZSklPg0KICAgICAgICAgICAgICAgIDwlX2RlZigndC50eXBlLmVuYWJsZWQnLCB0cnVlKSU+DQoNCiAgICAgICAgICAgICAgICA8JV9kZWYoJ3QudG9vbF9Db25maWdzJywgJ1tdJyklPjsNCiAgICAgICAgICAgICAgICA8JV9kZWYoJ3QudHlwZS50eXBlX0NvbmZpZ3MnLCAnW10nKSU+Ow0KICAgICAgICAgICAgICAgIDwlX2RlZigndC50eXBlLnR5cGVfTWFwcGluZ3MnLCAnW10nKSU+Ow0KICAgICAgICAgICAgICAgIDwlX2RlZigndC50b29sX01hcHBpbmdzJywgJ1tdJyklPjsNCiAgICANCiAgICAgICAgICAgICAgICBbXS5jb25jYXQodC50b29sX0NvbmZpZ3MsIHQudHlwZS50eXBlX0NvbmZpZ3MsIHQudHlwZS50eXBlX01hcHBpbmdzLCB0LnRvb2xfTWFwcGluZ3MpLmZvckVhY2goYyA9PiB7DQogICAgICAgICAgICAgICAgICAgIDwlX2RlZignYy5hY3RpdmUnLCB0cnVlKSU+DQogICAgICAgICAgICAgICAgICAgIDwlX2RlZignYy5lbmFibGVkJywgdHJ1ZSklPg0KICAgICAgICAgICAgICAgICAgICA8JV9kZWYoJ2MuSWQnLCAndGhpcy5fdXVpZCgpJyklPg0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfSk7DQogICAgDQogICAgICAgICAgICB0b29scy5maWx0ZXIodCA9PiB0eXBlb2YodCk9PT0nb2JqZWN0JyAmJiB0KS5mb3JFYWNoKHQgPT4gWyd0b29sX0NvbmZpZ3MnLCAndHlwZS50eXBlX0NvbmZpZ3MnXS5mb3JFYWNoKHNDb25maWcgPT4gew0KICAgICAgICAgICAgICAgICAgICBEb3RPYmplY3Quc2V0KHNDb25maWcsIERvdE9iamVjdC5waWNrKHNDb25maWcsIHQpLmZpbHRlcihjID0+IHR5cGVvZihjLnZhbHVlKSE9PSJvYmplY3QiKS5jb25jYXQoRG90T2JqZWN0LnBpY2soc0NvbmZpZywgdCkuZmlsdGVyKGMgPT4gdHlwZW9mKGMudmFsdWUpPT09Im9iamVjdCIgJiYgYy52YWx1ZSkubWFwKGMgPT4gT2JqZWN0LmtleXMoYy52YWx1ZSkubWFwKG5jb2RlID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBfYyA9IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBjLm5hbWUsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IGMudmFsdWVbbmNvZGVdLA0KICAgICAgICAgICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmKG5jb2RlIT0iZGVmYXVsdCIpew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9jLm5vZGUgPSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvZGU6IG5jb2RlLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY3RpdmU6IHRydWUsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuYWJsZWQ6IGZhbHNlLCA8JS8vIG90aGVyd2lzZSBpdCBzdGFydHMgZ2V0dGluZyBldmVudHMlPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiTm9kZUpTIiwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2M7DQogICAgICAgICAgICAgICAgICAgIH0pLmZsYXQoKSkuZmxhdCgpKSwgdCk7DQogICAgICAgICAgICAgICAgICAgIERvdE9iamVjdC5waWNrKHNDb25maWcsIHQpLmZvckVhY2goYyA9PiBjLnZhbHVlID0gSlNPTi5zdHJpbmdpZnkoYy52YWx1ZSkpOw0KICAgICAgICAgICAgICAgIH0pDQogICAgICAgICAgICApOw0KICAgICAgICB9Ow0KDQoNCiAgICAgICAgZml4VG9vbHModG9vbHMpOw0KICAgICAgICB0b29scyA9IHRvb2xzLmZpbHRlcih0ID0+IHQuYWN0aXZlKTsNCiAgICAgICAgdG9vbHMgPSB0b29scy5maWx0ZXIodCA9PiB0b29sTmFtZXMuZmluZChfdCA9PiAodHlwZW9mKF90KT09PSdzdHJpbmcnP190Ol90Lm5hbWUpPT10Lm5hbWUpKTsNCg0KICAgICAgICA8JT1sb2coKSU+YFRvb2xzIGFyZSAke3Rvb2xzLmxlbmd0aH1gKTsNCg0KICAgICAgICA8JT1zY29wZSU+LlRvb2xzID0gdG9vbHM7DQoNCiAgICAgICAgPCU9c2NvcGUlPi5Ub29scy5maWx0ZXIodCA9PiAhdC5heGlvcyAmJiA8JT1KU09OLnN0cmluZ2lmeShfcmVzdFRvb2xzKSU+LmluZGV4T2YodC50eXBlLm5hbWUpPj0wKS5mb3JFYWNoKHQgPT4gew0KICAgICAgICAgICAgdC5heGlvcyA9IHR5cGVvZihheGlvcy5jcmVhdGUpPT09J2Z1bmN0aW9uJz9heGlvcy5jcmVhdGUoKTpheGlvczsNCiAgICAgICAgICAgIHQuYXhpb3MuaW50ZXJjZXB0b3JzLnJlcXVlc3QudXNlKHJlcXVlc3QgPT4gdGhpcy5fcmVxdWVzdEludGVyY2VwdG9yKHJlcXVlc3QsIHQpLCBlcnJvciA9PiB7fSk7DQogICAgICAgICAgICB0LmF4aW9zLmludGVyY2VwdG9ycy5yZXNwb25zZS51c2UocmVzcG9uc2UgPT4gcmVzcG9uc2UsIGVycm9yID0+IHRoaXMuX3Jlc3BvbnNlSW50ZXJjZXB0b3IoZXJyb3IsIHQpKTsNCiAgICAgICAgfSk7DQogICAgICAgIA0KICAgICAgICAvLyBjb25uZWN0IHRvIHRoZSBsb2FkZWQgdG9vbHMhISENCiAgICAgICAgbGV0IHRvb2wgPSB0aGlzLlRvb2w7DQogICAgICAgIGZvciBhd2FpdCAoY29uc3QgdCBvZiA8JT1zY29wZSU+LlRvb2xzKXsNCjwlIHNyLmdyb3VwQnkoYXJDbGFzc2VzLCAnRW50aXR5TW9kdWxlJykuZm9yRWFjaChlbSA9PiB7ZW0udmFsdWVzID0gZW0udmFsdWVzLnNvcnQoKGEsIGIpID0+IGIuUmFuayAtIGEuUmFuayk7ICU+DQogICAgICAgICAgICBhd2FpdCBuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUoZW0udmFsdWVzWzBdLCB0cnVlKSU+KHVuZGVmaW5lZCwgdCkuX3N0b3JlRW50aXR5Q2xhc3MoPCU9ZW0udmFsdWVzWzBdLlJhbmslPik7DQo8JSB9KSU+DQogICAgICAgIH0NCiAgICAgICAgdGhpcy5Ub29sID0gdG9vbDsNCiAgICAgICAgDQogICAgICAgIGFyVG9vbHMgPSBhclRvb2xzLmZpbHRlcihfdCA9PiAhdG9vbHMuZmluZCh0ID0+ICh0eXBlb2YoX3QpPT09J3N0cmluZyc/X3Q6X3QubmFtZSk9PXQubmFtZSkpOw0KICAgICAgICBmaXhUb29scyhhclRvb2xzKTsNCg0KPCUgaWYoX2NOYW1lKCdUb29sJykpeyU+DQogICAgICAgIDwlPXNjb3BlJT4ub1Rvb2xzID0gPCU9c2NvcGUlPi5Ub29scy5jb25jYXQoYXJUb29scykuZmlsdGVyKHQgPT4gdC5hY3RpdmUpLm1hcCh0ID0+IHsNCiAgICAgICAgICAgIHQudG9vbF9NYXBwaW5ncy5mb3JFYWNoKG0gPT4gZGVsZXRlIG0udG9vbCk7DQogICAgICAgICAgICB0LnR5cGUudHlwZV9NYXBwaW5ncy5mb3JFYWNoKG0gPT4gZGVsZXRlIG0udHlwZSk7DQogICAgDQogICAgICAgICAgICByZXR1cm4gbmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKCdUb29sJywgdHJ1ZSklPigpLl9mcm9tRG9jdW1lbnQodCk7DQogICAgICAgIH0pOw0KICAgICAgICBpZihiU3RvcmUpew0KICAgICAgICAgICAgPCU9bG9nKCklPmBTYXZpbmcgdG9vbHMuLi5gKTsNCiAgICAgICAgICAgIGZvciBhd2FpdCAoY29uc3QgdCBvZiA8JT1zY29wZSU+Lm9Ub29scyl7DQogICAgICAgICAgICAgICAgYXdhaXQgdC5zdG9yZSgpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQo8JSB9JT4NCg0KICAgICAgICA8JT1sb2coKSU+YEV4aXRpbmdgKTsNCiAgICAgICAgcmV0dXJuIHRvb2xzOw0KICAgIH0NCiAgICANCjwlIH0gLy8gbWFpbkNsYXNzICU+DQoNCgk8JT1tTmFtZT0nX3BhcmFtZXRyaXplJyU+KHN0ciwgZnVuLCBvcHRpb25zPXt9LCBwcmVmaXg9J3t7JywgcG9zdGZpeD0nfX0nKSB7DQo8JSBpZihtYWluQ2xhc3MoKT09Yyl7JT4NCiAgICAgICAgdHJ5ew0KICAgICAgICAgICAgaWYodHlwZW9mKHN0cikhPT0nc3RyaW5nJykgcmV0dXJuIHN0cjsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgbGV0IHJleCA9IGAke3ByZWZpeH0oW14ke3Bvc3RmaXh9XSspJHtwb3N0Zml4fWA7DQogICAgICAgICAgICAoc3RyLm1hdGNoKG5ldyBSZWdFeHAocmV4LCAiZyIpKSB8fCBbXSkuZm9yRWFjaChtID0+IHN0ciA9IHN0ci5yZXBsYWNlKG0sIG0gPT4gZnVuKG0ucmVwbGFjZShwcmVmaXgsICcnKS5yZXBsYWNlKHBvc3RmaXgsICcnKSkpKTsNCg0KICAgICAgICAgICAgcmV0dXJuIHN0cjsNCiAgICAgICAgfWNhdGNoKGV4KXsNCiAgICAgICAgICAgIDwlPWVycm9yKCklPmV4KTsNCiAgICAgICAgfQ0KPCUgfWVsc2V7JT4NCiAgICAgICAgcmV0dXJuIG5ldyA8JT1zY29wZSU+LjwlPW5OYW1lKG1haW5DbGFzcygpKSU+KCkuPCU9bU5hbWUlPihzdHIsIGZ1biwgb3B0aW9ucywgcHJlZml4LCBwb3N0Zml4KTsNCjwlIH0lPg0KCX0NCg0KICAgIDwlPW1OYW1lPSdfX3N5bmNfb24nJT4oZCl7DQogICAgICAgIHRoaXMuXzwlPW1OYW1lJT4gPSB0aGlzLl88JT1tTmFtZSU+IHx8IHt9Ow0KICAgIA0KICAgICAgICBpZihkKXsgLy8gc2V0IHRoZSB2YWx1ZQ0KICAgICAgICAgICAgdGhpcy5fPCU9bU5hbWUlPlt0aGlzLlRvb2wubmFtZV0gPSBkOw0KDQogICAgICAgICAgICByZXR1cm4gdGhpcy5fX2ltcG9ydCh0aGlzLCB7DQogICAgICAgICAgICAgICAgQ3ljbGljOiB0cnVlLA0KPCUgYy5FbnRpdHlBdHRyaWJ1dGVzLmZpbHRlcihlYSA9PiAhZWEuRW50aXR5TWV0aG9kICYmIGVhLkVudGl0eVR5cGUpLmZvckVhY2goZWEgPT4geyU+DQogICAgICAgICAgICAgICAgPCU9bk5hbWUoZWEpJT46IChvYmosIGVhQ29kZSkgPT4gdGhpcy48JT1uTmFtZShlYSklPigpP3RoaXMuPCU9bk5hbWUoZWEpJT4oKS48JT1tTmFtZSU+KGQpOnVuZGVmaW5lZCwNCjwlIH0pJT4NCg0KPCUgYy5UeXBlZEF0dHJpYnV0ZXMuZm9yRWFjaCh0YSA9PiB7IGxldCB0YU5hbWUgPSBuTmFtZSh0YSkgKyAnXycgKyB0YS5FbnRpdHlDbGFzcy5QbHVyYWwucmVwbGFjZSgvIC9nLCAnXycpOyU+DQogICAgICAgICAgICAgICAgLy88JT10YU5hbWUlPjogdGhpcy48JT10YU5hbWUlPigpLmZvckVhY2godCA9PiB0LjwlPW1OYW1lJT4oZCkpLA0KPCUgfSklPg0KICAgICAgICAgICAgfSwgIjwlPW1OYW1lJT4iLCBkKTsNCg0KDQo8JSBjLkVudGl0eUF0dHJpYnV0ZXMuZmlsdGVyKGVhID0+ICFlYS5FbnRpdHlNZXRob2QgJiYgZWEuRW50aXR5VHlwZSkuZm9yRWFjaChlYSA9PiB7JT4NCiAgICAgICAgICAgIGlmKHRoaXMuXzwlPW5OYW1lKGVhKSU+X3NldCAmJiB0aGlzLjwlPW5OYW1lKGVhKSU+KCkpIHRoaXMuPCU9bk5hbWUoZWEpJT4oKS48JT1tTmFtZSU+KGQpOw0KPCUgfSklPg0KDQo8JSBjLlR5cGVkQXR0cmlidXRlcy5mb3JFYWNoKHRhID0+IHsgbGV0IHRhTmFtZSA9IG5OYW1lKHRhKSArICdfJyArIHRhLkVudGl0eUNsYXNzLlBsdXJhbC5yZXBsYWNlKC8gL2csICdfJyk7JT4NCiAgICAgICAgICAgIC8vIHRoaXMuPCU9dGFOYW1lJT4oKS5mb3JFYWNoKHQgPT4gdC48JT1tTmFtZSU+KGQpKTsNCjwlIH0pJT4NCiAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICB9DQoNCiAgICAgICAgcmV0dXJuIHRoaXMuXzwlPW1OYW1lJT5bdGhpcy5Ub29sLm5hbWVdOyAvLyBnZXQgdGhlIHZhbHVlDQogICAgfQ0KICAgIA0KICAgIDwlPW1OYW1lPSdfY2xvbmUnJT4oYlR5cGVBdHRyaWJ1dGVzKXsNCiAgICAgICAgPCU9d2FybigpJT4iREVQUkVDQVRFRDogdXNlIG5ldyA8JT1zY29wZSU+LjwlPV9jTmFtZShjLk5hbWUsIHRydWUpJT4oKS5fZnJvbURvY3VtZW50KHRoaXMuX3RvSlNPTigpKSIpOw0KDQogICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICANCiAgICAgICAgdHJ5ew0KICAgICAgICAgICAgcmV0dXJuIHRoaXMuX19leHBvcnQobmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKGMuTmFtZSwgdHJ1ZSklPigpLCB7DQo8JSBjLkVudGl0eUF0dHJpYnV0ZXMuZmlsdGVyKGVhID0+ICFlYS5FbnRpdHlNZXRob2QpLmZvckVhY2goZWEgPT4geyU+DQogICAgICAgICAgICAgICAgPCU9bk5hbWUoZWEpJT46IChvYmosIGVhQ29kZSwgdikgPT4gb2JqLjwlPW5OYW1lKGVhKSU+KHY8JWlmKGVhLkVudGl0eVR5cGUpeyU+LjwlPW1OYW1lJT4oYlR5cGVBdHRyaWJ1dGVzKTwlfSU+KSwNCjwlIH0pOyU+DQo8JSBjLlR5cGVkQXR0cmlidXRlcy5mb3JFYWNoKHRhID0+IHsgbGV0IHRhTmFtZSA9IG5OYW1lKHRhKSArICdfJyArIHRhLkVudGl0eUNsYXNzLlBsdXJhbC5yZXBsYWNlKC8gL2csICdfJyk7JT4NCiAgICAgICAgICAgICAgICA8JT10YU5hbWUlPjogKG9iaiwgZWFDb2RlLCB2KSA9PiBiVHlwZUF0dHJpYnV0ZXM/b2JqLjwlPXRhTmFtZSU+KHYubWFwKF92ID0+IF92LjwlPW1OYW1lJT4oYlR5cGVBdHRyaWJ1dGVzKSkpOm51bGwsDQo8JSB9KTslPg0KICAgICAgICAgICAgfSwgIjwlPW1OYW1lJT4iKTsNCiAgICAgICAgfWNhdGNoKGV4KXsNCiAgICAgICAgICAgIDwlPWVycm9yKCklPmV4KTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIDwlPW1OYW1lPSdfbWFwJyU+KGNvZGUsIGJSZXZlcnNlLCBjb250ZXh0LCBvYmpGcm9tLCBvYmpUbywgZWFDb2RlLCBjbGFzc05hbWUsIHRvb2wsIGNvZGVUeXBlLCBfdGhpcywgbW9kdWxlTmFtZSl7DQogICAgICAgIF90aGlzID0gX3RoaXMgfHwgdGhpczsNCiAgICAgICAgY29udGV4dCA9IGNvbnRleHQgfHwgJ0VudGl0eUF0dHJpYnV0ZSc7DQogICAgICAgIHRvb2wgPSB0b29sIHx8IF90aGlzLlRvb2w7DQogICAgICAgIGNvZGVUeXBlID0gY29kZVR5cGUgfHwgPCU9X2VhVHlwZXMoKSU+W2NvZGVdOw0KICAgICAgICBjbGFzc05hbWUgPSBjbGFzc05hbWUgfHwgIjwlPW5OYW1lKGMpJT4iOw0KICAgICAgICBtb2R1bGVOYW1lID0gbW9kdWxlTmFtZSB8fCAiPCU9Yy5FbnRpdHlNb2R1bGU/Yy5FbnRpdHlNb2R1bGUuTmFtZTonJyU+IjsNCg0KPCUgaWYobWFpbkNsYXNzKCkhPWMpeyU+DQogICAgICAgIHJldHVybiBuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUobWFpbkNsYXNzKCksIHRydWUpJT4oKS48JT1tTmFtZSU+KGNvZGUsIGJSZXZlcnNlLCBjb250ZXh0LCBvYmpGcm9tLCBvYmpUbywgZWFDb2RlLCBjbGFzc05hbWUsIHRvb2wsIGNvZGVUeXBlLCBfdGhpcywgbW9kdWxlTmFtZSk7DQo8JSB9ZWxzZXslPg0KICAgICAgICB0cnl7DQogICAgICAgICAgICBsZXQgX2xvZyA9IGAke21vZHVsZU5hbWV9LiR7Y2xhc3NOYW1lfS4ke2NvbnRleHR9JHtiUmV2ZXJzZT8nPD0nOic9Pid9JHtjb2RlfWA7DQogICAgICAgICAgICANCiAgICAgICAgICAgIC8vaWYoQXJyYXkuaXNBcnJheShvYmpGcm9tKSkgcmV0dXJuIG9iakZyb20ubWFwKG8gPT4gdGhpcy48JT1tTmFtZSU+KGNvZGUsIGJSZXZlcnNlLCBjb250ZXh0LCBvLCBvYmpUbywgZWFDb2RlLCBjbGFzc05hbWUsIHRvb2wsIGNvZGVUeXBlLCBfdGhpcywgbW9kdWxlTmFtZSkpOw0KICAgICAgICANCiAgICAgICAgICAgIDwlIC8qIHRlbXB0ZWQgdG8gdXNlIGpzb25hdGEgaW4gUXVlcnkgZmllbGRzLCBkb2VzIG5vdCB3b3JrIGJlY2F1c2UganNvbmF0YS5ldmFsdWF0ZSByZXR1cm4gYSBwcm9taXNlISEhICovJT4NCiAgICAgICAgICAgIGxldCBzRmllbGQgPSBiUmV2ZXJzZT8ndGFyZ2V0Jzonc291cmNlJzsNCiAgICAgICAgICAgIGxldCBzU2NyaXB0ID0gKGJSZXZlcnNlPydvdXQnOidpbicpKydTY3JpcHQnOw0KICAgICAgICAgICAgbGV0IHNDb25kID0gKGJSZXZlcnNlPydvdXQnOidpbicpKydDb25kaXRpb24nOw0KICAgICAgICAgICAgbGV0IHNQYXRoID0gKGJSZXZlcnNlPydvdXQnOidpbicpKydQYXRoJzsNCiAgICAgICAgICAgIGxldCB0RmllbGQgPSBiUmV2ZXJzZT8nc291cmNlJzondGFyZ2V0JzsNCiAgICAgICAgICAgIGxldCB0U2NyaXB0ID0gKGJSZXZlcnNlPydpbic6J291dCcpKydTY3JpcHQnOw0KICAgICAgICAgICAgbGV0IHRQYXRoID0gKGJSZXZlcnNlPydpbic6J291dCcpKydQYXRoJzsNCiAgICAgICAgICAgIGxldCB0Q29uZCA9IChiUmV2ZXJzZT8naW4nOidvdXQnKSsnQ29uZGl0aW9uJzsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgbGV0IGxvZyA9ICguLi5zKSA9PiA8JT1sb2coKSU+Y2xhc3NOYW1lLCBfbG9nLCAuLi5zKTsNCiAgICAgICAgICAgIGxldCB3YXJuID0gKC4uLnMpID0+IDwlPXdhcm4oKSU+Y2xhc3NOYW1lLCBfbG9nLCAuLi5zKTsNCiAgICAgICAgICAgIGxldCBlcnJvciA9ICguLi5zKSA9PiA8JT1lcnJvcigpJT5jbGFzc05hbWUsIF9sb2csIC4uLnMpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBsZXQgb3B0aW9ucyA9IHtfY2xhc3M6IGNsYXNzTmFtZSwgX3RoaXM6IF90aGlzLCB0b29sOiB0b29sfTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgbGV0IF9zY3JpcHQgPSAocywgbSkgPT4gew0KICAgICAgICAgICAgICAgIHRyeXsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucnVuU2NyaXB0KGAob1Njb3BlLCBtLCBvYmpGcm9tLCBvYmpUbywgY29kZSwgX3RoaXMsIGNsYXNzTmFtZSwgdG9vbCwgY29kZVR5cGUsIGVhQ29kZSwgYlJldmVyc2UsIGNvbnRleHQsIGxvZywgd2FybiwgZXJyb3IpID0+ICR7c31gKSg8JT1zY29wZSU+LCBtLCBvYmpGcm9tLCBvYmpUbywgY29kZSwgX3RoaXMsIGNsYXNzTmFtZSwgdG9vbCwgY29kZVR5cGUsIGVhQ29kZSwgYlJldmVyc2UsIGNvbnRleHQsIGxvZywgd2FybiwgZXJyb3IpOw0KICAgICAgICAgICAgICAgIH1jYXRjaChleCl7DQogICAgICAgICAgICAgICAgICAgIHdhcm4obS50ZXN0cy5sb2csIGV4KTsgDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgbGV0IF9tYXRjaCA9IChzLCByKSA9PiB7DQogICAgICAgICAgICAgICAgaWYodHlwZW9mKHMpPT09J3VuZGVmaW5lZCcgfHwgcz09PW51bGwgfHwgdHlwZW9mKHMubWF0Y2gpIT09J2Z1bmN0aW9uJykgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgICAgIGxldCBhbnN3ZXIgPSBzLm1hdGNoKG5ldyBSZWdFeHAociwgJ2cnKSk7DQogICAgICAgICAgICAgICAgcmV0dXJuIHM9PXIgfHwgKChhbnN3ZXIgJiYgYW5zd2VyLmxlbmd0aCk/dHJ1ZTpmYWxzZSk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGNvbnN0IGNsb25lID0gaXRlbXMgPT4gaXRlbXMubWFwKGl0ZW0gPT4gQXJyYXkuaXNBcnJheShpdGVtKSA/IGNsb25lKGl0ZW0pIDogaXRlbSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGxldCBtcyA9IGNsb25lKCBbLi4uKHRvb2wudG9vbF9NYXBwaW5ncyB8fCBbXSkuY29uY2F0KHRvb2wudHlwZS50eXBlX01hcHBpbmdzIHx8IFtdKV0gKTsgLy8gZG8gbm90IHRhbXBlciB3aXRoIHRoZSBtYXBwaW5ncywgZGVlcCBjbG9uZQ0KICAgICAgICAgICAgbXMuZm9yRWFjaChtID0+IE9iamVjdC5rZXlzKG0pLmZvckVhY2goayA9PiBtW2tdID0gdGhpcy5fcGFyYW1ldHJpemUobVtrXSwgcCA9PiB0aGlzLl9fY29uZmlnKHApIHx8IERvdE9iamVjdC5waWNrKHAsIG9wdGlvbnMpLCBvcHRpb25zKSkpOw0KICAgICAgICAgICAgbXMuZm9yRWFjaChtID0+IG0udGVzdHMgPSB7DQogICAgICAgICAgICAgICAgYWN0aXZlOiA8JXZhbHVlT2YoIm0uYWN0aXZlIiklPiwgLy9fc2NyaXB0KG0uYWN0aXZlLCBtKSwNCiAgICAgICAgICAgICAgICBlbmFibGVkOiA8JXZhbHVlT2YoIm0uZW5hYmxlZCIpJT4sIC8vX3NjcmlwdChtLmVuYWJsZWQsIG0pLA0KICAgICAgICAgICAgICAgIGNvbnRleHQ6IF9tYXRjaChjb250ZXh0LCBtLmNvbnRleHQpLA0KICAgICAgICAgICAgICAgIGNsYXNzOiBfbWF0Y2goY2xhc3NOYW1lLCBtLmNsYXNzTmFtZSksDQogICAgICAgICAgICAgICAgbW9kdWxlOiBfbWF0Y2gobW9kdWxlTmFtZSwgbS5tb2R1bGVOYW1lKSwNCiAgICAgICAgICAgICAgICBzRmllbGQ6IHR5cGVvZihjb2RlKT09PSd1bmRlZmluZWQnIHx8IF9tYXRjaChjb2RlLCBtW3NGaWVsZF0pLA0KICAgICAgICAgICAgICAgIHNTY3JpcHQ6IHR5cGVvZihjb2RlKT09PSd1bmRlZmluZWQnIHx8IHR5cGVvZihtW3NTY3JpcHRdKSE9PSd1bmRlZmluZWQnLA0KICAgICAgICAgICAgICAgIHNQYXRoOiB0eXBlb2YobVtzUGF0aF0pIT09J3VuZGVmaW5lZCcsDQogICAgICAgICAgICAgICAgdGFyZ2V0OiB0eXBlb2YobVt0RmllbGRdIHx8IG1bdFNjcmlwdF0gfHwgbVt0UGF0aF0pIT09J3VuZGVmaW5lZCcsDQogICAgICAgICAgICAgICAgdGV4dDogYCR7Y29kZX06JHtzRmllbGR9PT0+JHt0RmllbGR9YCwNCiAgICAgICAgICAgICAgICBsb2c6IGAke19sb2d9WyR7bS5jb250ZXh0fS8ke20uY2xhc3NOYW1lfV1gLA0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgICBtcyA9IG1zLmZpbHRlcihtID0+IG0udGVzdHMuYWN0aXZlICYmIG0udGVzdHMuZW5hYmxlZCAmJiBtLnRlc3RzLmNvbnRleHQgJiYgbS50ZXN0cy5jbGFzcyAmJiBtLnRlc3RzLm1vZHVsZSAmJiAobS50ZXN0cy5zRmllbGQgfHwgbS50ZXN0cy5zU2NyaXB0IHx8IG0udGVzdHMuc1BhdGgpICYmIG0udGVzdHMudGFyZ2V0KS5zb3J0KChhLCBiKSA9PiBhLm9yZGVyIC0gYi5vcmRlcik7DQogICAgICAgICAgICANCiAgICAgICAgICAgIDwlIC8qIHdlIG1pZ2h0IG5vdCB3b3JrIHdpdGggYWxsIG1zIGVudHJpZXMuIGxvZyBoZXJlIGlzIG9ubHkgYSBwcmV2aWV3IG9mIHdoYXQgbWlnaHQgd29yayEgKi8gJT4NCiAgICAgICAgICAgIC8vaWYobXMuZmlsdGVyKG0gPT4gbS5kZWJ1ZykubGVuZ3RoKSBsb2codGhpcy5fYmVhdXRpZnkobXMuZmlsdGVyKG0gPT4gbS5kZWJ1ZyksICdqYXZhc2NyaXB0JykpOw0KDQogICAgICAgICAgICBtcy5mb3JFYWNoKG0gPT4gew0KICAgICAgICAgICAgICAgIGlmKG1bdFNjcmlwdF0pew0KICAgICAgICAgICAgICAgICAgICBpZih0eXBlb2YobVt0Q29uZF0pPT09J3VuZGVmaW5lZCcgfHwgPCV2YWx1ZU9mKCJtW3RDb25kXSIsICdfdGhpcycpJT4pew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYobS5kZWJ1ZykgbG9nKG0udGVzdHMubG9nICsgJzogJyArIHRTY3JpcHQsICc8JT1tTmFtZSU+JywgbVt0U2NyaXB0XSk7DQogICAgICAgICAgICAgICAgICAgICAgICBjb2RlID0gPCV2YWx1ZU9mKCJtW3RTY3JpcHRdIiwgJ190aGlzJyklPg0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIGlmKG1bc1BhdGhdICYmIHR5cGVvZihqbWVzcGF0aCkhPT0ndW5kZWZpbmVkJykgY29kZSA9IGptZXNwYXRoLnNlYXJjaChvYmpGcm9tLCBtW3NQYXRoXSk7DQogICAgICAgICAgICAgICAgaWYobVtzUGF0aF0gJiYgdHlwZW9mKGpzb25wYXRoKSE9PSd1bmRlZmluZWQnKSBjb2RlID0ganNvbnBhdGgucXVlcnkob2JqRnJvbSwgbVtzUGF0aF0pOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIGlmKG1bdEZpZWxkXSl7DQogICAgICAgICAgICAgICAgICAgIGxldCBkUGF0aCA9ICcnOw0KICAgICAgICAgICAgICAgICAgICBpZih0eXBlb2YobVt0RmllbGRdKT09PSdmdW5jdGlvbicpew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYodHlwZW9mKGNvZGUpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRQYXRoID0gYCR7Y29kZX0ucmVwbGFjZWA7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29kZSA9IGNvZGUucmVwbGFjZShuZXcgUmVnRXhwKG1bc0ZpZWxkXSwgJ2cnKSwgbVt0RmllbGRdKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vY29kZSA9IERvdE9iamVjdC5jb3B5KG1bc0ZpZWxkXSwgbVt0RmllbGRdLCBvYmpGcm9tLCBvYmpUbyk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYodHlwZW9mKGNvZGUpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKF9tYXRjaChjb2RlLCBtW3NGaWVsZF0pKXsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZFBhdGggPSBgJHtjb2RlfS5jb2RlYDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29kZSA9IG1bdEZpZWxkXTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkUGF0aCA9IGBkb3Rjb3B5YDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2RlID0gRG90T2JqZWN0LmNvcHkobVtzRmllbGRdLCBtW3RGaWVsZF0sIG9iakZyb20sIG9ialRvKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgaWYobS5kZWJ1ZyAmJiBkUGF0aCkgbG9nKGAke20udGVzdHMubG9nfS8ke2RQYXRofVtjb2RlPSR7Y29kZX1dOiAke21bc0ZpZWxkXX0gPT4gJHttW3RGaWVsZF19YCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIGlmKG1bdFBhdGhdICYmIHR5cGVvZihqbWVzcGF0aCkhPT0ndW5kZWZpbmVkJyAmJiAoIW1bdENvbmRdIHx8IGptZXNwYXRoLnNlYXJjaChvYmpUbywgbVt0Q29uZF0pKSkgb2JqVG9bbVt0RmllbGRdXSA9IGptZXNwYXRoLnNlYXJjaChvYmpUbywgbVt0UGF0aF0pOw0KICAgICAgICAgICAgICAgIGlmKG1bdFBhdGhdICYmIHR5cGVvZihqc29ucGF0aCkhPT0ndW5kZWZpbmVkJyAmJiAoIW1bdENvbmRdIHx8IGpzb25wYXRoLnF1ZXJ5KG9ialRvLCBtW3RDb25kXSkpKSBvYmpUb1ttW3RGaWVsZF1dID0ganNvbnBhdGgucXVlcnkob2JqVG8sIG1bdFBhdGhdKTsNCiAgICAgICAgICAgIH0pOw0KDQogICAgICAgICAgICBtcy5mb3JFYWNoKG0gPT4gZGVsZXRlIG0udGVzdHMpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBpZih0eXBlb2YoY29kZSk9PT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgcmV0dXJuIG9ialRvOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICAvL2lmKGNvbnRleHQ9PSdFbnRpdHlDbGFzcycgJiYgY2xhc3NOYW1lPT0nVXNlcicpIDwlPXdhcm4oKSU+IkdPVCBIRVJFIiwgY29kZSwgY29udGV4dCwgb3B0aW9ucyk7DQogICAgICAgICAgICByZXR1cm4gdGhpcy5fcGFyYW1ldHJpemUoY29kZSwgcCA9PiB0aGlzLl9fY29uZmlnKHApIHx8IERvdE9iamVjdC5waWNrKHAsIG9wdGlvbnMpLCBvcHRpb25zKTsNCiAgICAgICAgfWNhdGNoKGV4KXsNCiAgICAgICAgICAgIDwlPWVycm9yKCklPmV4KTsNCiAgICAgICAgfQ0KPCUgfSU+DQogICAgfQ0KICAgIA0KICAgIDwlPW1OYW1lPSdfbkNvZGUnJT4oY29kZSwgb0NvZGUpew0KICAgICAgICB0cnl7DQogICAgICAgICAgICBsZXQgY29udGV4dCA9ICdFbnRpdHlBdHRyaWJ1dGUnOw0KICAgICAgICAgICAgaWYoIWNvZGUgJiYgIW9Db2RlKXsNCiAgICAgICAgICAgICAgICBjb250ZXh0ID0gJ0VudGl0eUNsYXNzJzsNCiAgICAgICAgICAgICAgICBjb2RlID0gIjwlPW5Db2RlKGMpJT4iOw0KICAgICAgICAgICAgICAgIG9Db2RlID0gPCU9X0ZyRU1ELl90b0pTKGMuQ29kZSklPjsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgbGV0IHJldCA9IGNvZGU7DQogICAgICAgICAgICBpZihvQ29kZSAmJiB0eXBlb2Yob0NvZGUpPT09J29iamVjdCcpew0KICAgICAgICAgICAgICAgIHJldCA9IG9Db2RlW3RoaXMuVG9vbC5uYW1lXSB8fCBvQ29kZVt0aGlzLlRvb2wudHlwZS5uYW1lXSB8fCByZXQ7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHJldHVybiB0aGlzLl9tYXAocmV0LCBmYWxzZSwgY29udGV4dCkgfHwgcmV0Ow0KICAgICAgICB9Y2F0Y2goZXgpew0KICAgICAgICAgICAgPCU9d2FybigpJT5leCk7DQogICAgICAgICAgICByZXR1cm4gY29kZTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICANCiAgICA8JT1tTmFtZT0nX19jb25maWcnJT4obiwgbnVsbFZhbHVlLCBvcHRpb25zKXsNCiAgICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307DQogICAgICAgIG9wdGlvbnMuX3RoaXMgPSBvcHRpb25zLl90aGlzIHx8IHRoaXM7DQogICAgICAgIG9wdGlvbnMuX2NsYXNzID0gb3B0aW9ucy5fY2xhc3MgfHwgJzwlPW5OYW1lKGMpJT4nOw0KICAgICAgICBvcHRpb25zLnRvb2wgPSBvcHRpb25zLnRvb2wgfHwgb3B0aW9ucy5fdGhpcy5Ub29sIHx8IHRoaXMuVG9vbDsNCiAgICAgICAgaWYodHlwZW9mKG9wdGlvbnMudG9vbCk9PT0nb2JqZWN0JyAmJiBvcHRpb25zLnRvb2wuY29uc3RydWN0b3IubmFtZT09J1Rvb2wnKSBvcHRpb25zLnRvb2wgPSAoPCU9c2NvcGUlPi5Ub29scyB8fCBbXSkuZmluZCh0ID0+IHQubmFtZT09b3B0aW9ucy50b29sLm5hbWUoKSk7DQogICAgICAgIA0KICAgICAgICBpZih0eXBlb2Yob3B0aW9ucy50b29sKT09PSdzdHJpbmcnKSBvcHRpb25zLnRvb2wgPSAoPCU9c2NvcGUlPi5Ub29scyB8fCBbXSkuZmluZCh0ID0+IHQubmFtZT09b3B0aW9ucy50b29sIHx8IHQudHlwZS5uYW1lPT1vcHRpb25zLnRvb2wpOw0KDQo8JSBpZihtYWluQ2xhc3MoKSE9Yyl7JT4NCiAgICAgICAgcmV0dXJuIG5ldyA8JT1zY29wZSU+LjwlPV9jTmFtZShtYWluQ2xhc3MoKSwgdHJ1ZSklPigpLjwlPW1OYW1lJT4obiwgbnVsbFZhbHVlLCBPYmplY3QuYXNzaWduKHtfdGhpczogdGhpcywgdG9vbDogdGhpcy5Ub29sLCBfY2xhc3M6ICc8JT1uTmFtZShjKSU+J30sIG9wdGlvbnMgfHwge30pKTsNCjwlIH1lbHNleyU+DQogICAgICAgIHRyeXsNCiAgICAgICAgICAgIGlmKHR5cGVvZihvcHRpb25zLnRvb2wpIT09J29iamVjdCcpIDwlPXdhcm4oKSU+b3B0aW9ucy50b29sKTsNCiAgICAgICAgICAgIGlmKCFvcHRpb25zLnRvb2wpIDwlPXdhcm4oKSU+InRvb2wgbm90IGRlZmluZWQiLCBvcHRpb25zLl90aGlzLlRvb2wsIDwlPXNjb3BlJT4uVG9vbHMsIG9wdGlvbnMuX3RoaXMuVG9vbHMpOw0KICAgICAgICAgICAgLy9vcHRpb25zLm5vQ2FjaGUgPSB0cnVlOw0KICAgICAgICAgICAgaWYoIW9wdGlvbnMubm9DYWNoZSkgPCU9c2NvcGUlPi48JT1tTmFtZSU+ID0gPCU9c2NvcGUlPi48JT1tTmFtZSU+IHx8IHt9Ow0KDQogICAgICAgICAgICBsZXQgbklEID0gPCU9bnNjb3BlJT4uX25vZGU/PCU9bnNjb3BlJT4uX25vZGUuY29kZSgpOidkZWZhdWx0JzsNCg0KICAgICAgICAgICAgaWYodHlwZW9mKG9wdGlvbnNbbl0pIT09J3VuZGVmaW5lZCcpIG51bGxWYWx1ZSA9IG51bGxWYWx1ZSB8fCBvcHRpb25zW25dOw0KICAgICAgICAgICAgbGV0IHJldCA9IG51bGxWYWx1ZTsNCiAgICAgICAgICAgIGlmKHR5cGVvZihyZXQpPT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHJldCA9IG51bGw7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgLy8gdXNlIHNjb3BlIGNhY2hlIChpbXByb3ZlcyBwZXJmb3JtYW5jZT8/PykNCiAgICAgICAgICAgICAgICBpZighb3B0aW9ucy5ub0NhY2hlICYmIE9iamVjdC5oYXNPd24oPCU9c2NvcGUlPi48JT1tTmFtZSU+LCBgJHtvcHRpb25zLl9jbGFzc30uJHtvcHRpb25zLnRvb2wubmFtZX0uJHtuSUR9LiR7bn1gKSkgcmV0dXJuIDwlPXNjb3BlJT4uPCU9bU5hbWUlPltgJHtvcHRpb25zLl9jbGFzc30uJHtvcHRpb25zLnRvb2wubmFtZX0uJHtuSUR9LiR7bn1gXTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgLy8gdG9vbF9Db25maWdzLCB0eXBlX0NvbmZpZ3M6IGFsbG93IGNsYXNzLWxldmVsIGFuZCBub2RlLWxldmVsIC0gZG9uZQ0KICAgICAgICAgICAgbGV0IHRjb25mID0gW10uY29uY2F0KG9wdGlvbnMudG9vbC50eXBlLnR5cGVfQ29uZmlncyB8fCBbXSwgb3B0aW9ucy50b29sLnRvb2xfQ29uZmlncyB8fCBbXSkuZmlsdGVyKGMgPT4gYyAmJiBjLm5hbWU9PW4gJiYgKCFjLm5vZGUgfHwgYy5ub2RlLmNvZGU9PW5JRCkpLnNvcnQoYyA9PiBjLm5vZGU/KGMubm9kZS5jb2RlPT0nZGVmYXVsdCc/MDotMSk6MSk7DQogICAgICAgICAgICBpZih0Y29uZi5sZW5ndGgpew0KICAgICAgICAgICAgICAgIGlmKHRjb25mWzBdLnNjcmlwdCl7DQogICAgICAgICAgICAgICAgICAgIHJldCA9IHRjb25mWzBdLnNjcmlwdDsNCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIGxldCBfc2MgPSB0aGlzLl9wYXJhbWV0cml6ZSh0Y29uZlswXS5zY3JpcHQsIHAgPT4gdGhpcy48JT1tTmFtZSU+KHAsIG51bGwsIG9wdGlvbnMpIHx8IERvdE9iamVjdC5waWNrKHAsIG9wdGlvbnMpLCBvcHRpb25zKTsNCiAgICAgICAgICAgICAgICAgICAgcmV0ID0gPCV2YWx1ZU9mKCJfc2MiKSU+Ow0KICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICByZXQgPSB0Y29uZlswXS52YWx1ZTsNCiAgICAgICAgICAgICAgICAgICAgdHJ5ew0KICAgICAgICAgICAgICAgICAgICAgICAgWzEsMiwzXS5mb3JFYWNoKGEgPT4gcmV0ID0gSlNPTi5wYXJzZShyZXQpKTsNCiAgICAgICAgICAgICAgICAgICAgfWNhdGNoKGpleCl7fQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmKG9wdGlvbnMubmV3VmFsdWUpew0KICAgICAgICAgICAgICAgIGxldCB0YyA9IHRjb25mLmxlbmd0aD90Y29uZlswXTp7fTsNCiAgICAgICAgICAgICAgICBpZihvcHRpb25zLm5vZGUpIHRjLm5vZGUgPSB7Y29kZTogb3B0aW9ucy5ub2RlLmNvZGUoKX07DQogICAgICAgICAgICAgICAgdGMudmFsdWUgPSBvcHRpb25zLm5ld1ZhbHVlOw0KICAgICAgICAgICAgICAgIHRjLm5hbWUgPSBuOw0KICAgICAgICAgICAgICAgIGlmKCF0Y29uZi5sZW5ndGgpew0KICAgICAgICAgICAgICAgICAgICAob3B0aW9ucy50b29sLnRvb2xfQ29uZmlncyB8fCBvcHRpb25zLnRvb2wudHlwZS50eXBlX0NvbmZpZ3MpLnB1c2godGMpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICByZXQgPSBvcHRpb25zLm5ld1ZhbHVlOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAvLyBtb2RlbCBDb25maWc6IENvbmZpZyBpcyBjbGFzcyBsZXZlbCwgbm9kZSBub3QgcG9zc2libGUgLSBwZW5kaW5nDQogICAgICAgICAgICBsZXQgbWNvbmYgPSBvcHRpb25zLl90aGlzLkNvbmZpZz9vcHRpb25zLl90aGlzLkNvbmZpZ1tuXTp1bmRlZmluZWQ7DQogICAgICAgICAgICBtY29uZiA9IHRoaXMuX3BhcmFtZXRyaXplKG1jb25mLCBwID0+IHRoaXMuPCU9bU5hbWUlPihwLCBudWxsLCBvcHRpb25zKSB8fCBEb3RPYmplY3QucGljayhwLCBvcHRpb25zKSwgb3B0aW9ucyk7DQogICAgICAgICAgICBtY29uZiA9IDwldmFsdWVPZigibWNvbmYiKSU+Ow0KICAgICAgICAgICAgaWYodHlwZW9mKG1jb25mKSE9PSJ1bmRlZmluZWQiKSByZXQgPSBtY29uZjsNCg0KICAgICAgICAgICAgLy8gY29tbWFuZCBsaW5lOiBhbGxvdyBjbGFzcy1sZXZlbCBhbmQgbm9kZS1sZXZlbCAtIHBlbmRpbmcNCiAgICAgICAgICAgIGlmKHR5cGVvZihnbG9iYWwpIT09J3VuZGVmaW5lZCcgJiYgZ2xvYmFsLm1pbmltaXN0KXsNCiAgICAgICAgICAgICAgICByZXQgPSBEb3RPYmplY3QucGljayhuLCBnbG9iYWwubWluaW1pc3QocHJvY2Vzcy5hcmd2LnNsaWNlKDIpKSkgfHwgcmV0Ow0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICAvLyByZXF1ZXN0OiBhbGxvdyBjbGFzcy1sZXZlbCBhbmQgbm9kZS1sZXZlbCAtIHBlbmRpbmcNCiAgICAgICAgICAgIGlmKHRoaXMuJF9SRVFVRVNUKSByZXQgPSB0aGlzLiRfUkVRVUVTVChuKSB8fCByZXQ7DQogICAgICAgICAgICANCiAgICAgICAgICAgIC8vIGNvbmZpZyByZXBsYWNlbWVudA0KICAgICAgICAgICAgcmV0ID0gdGhpcy5fcGFyYW1ldHJpemUocmV0LCBwID0+IHRoaXMuPCU9bU5hbWUlPihwLCBudWxsLCBvcHRpb25zKSB8fCBEb3RPYmplY3QucGljayhwLCBvcHRpb25zKSwgb3B0aW9ucyk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGlmKCFvcHRpb25zLm5vQ2FjaGUpIDwlPXNjb3BlJT4uPCU9bU5hbWUlPltgJHtvcHRpb25zLl9jbGFzc30uJHtvcHRpb25zLnRvb2wubmFtZX0uJHtuSUR9LiR7bn1gXSA9IHJldDsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgcmV0ID0gPCV2YWx1ZU9mKCJyZXQiKSU+Ow0KICAgICAgICAgICAgDQogICAgICAgICAgICByZXR1cm4gcmV0Ow0KICAgICAgICB9Y2F0Y2goZXgpew0KICAgICAgICAgICAgPCU9d2FybigpJT5uLCBudWxsVmFsdWUsIG9wdGlvbnMuX2NsYXNzLCBvcHRpb25zLnRvb2wudG9vbF9Db25maWdzLCBleCk7DQogICAgICAgIH0NCjwlIH0lPg0KICAgIH0NCg0KDQo8JSBjLkVudGl0eU1ldGhvZHMuZm9yRWFjaChtID0+IHslPg0KICAgIC8qKg0KICAgICAqIFN1bW1hcnkuIDwlPW0uTmFtZSU+Lg0KICAgICAqDQogICAgICogRGVzY3JpcHRpb24uIDwlPW0uUmVtYXJrJT4uDQogICAgICoNCiAgICAgKiBAc2luY2UgICAgICB4LngueA0KICAgICAqIEBkZXByZWNhdGVkIHgueC54IFVzZSBuZXdfZnVuY3Rpb25fbmFtZSgpIGluc3RlYWQuDQogICAgICogQGFjY2VzcyAgICAgcHVibGljDQogICAgICoNCiAgICAgKiBAY2xhc3MNCiAgICAgKiBAYXVnbWVudHMgcGFyZW50DQogICAgICogQG1peGVzICAgIG1peGluDQogICAgICoNCiAgICAgKiBAYWxpYXMgICAgcmVhbE5hbWUNCiAgICAgKiBAbWVtYmVyb2YgbmFtZXNwYWNlDQogICAgICoNCiAgICAgKiBAc2VlICBGdW5jdGlvbi9jbGFzcyByZWxpZWQgb24NCiAgICAgKiBAbGluayBVUkwNCiAgICAgKiBAZ2xvYmFsDQogICAgICoNCiAgICAgKiBAZmlyZXMgICBldmVudE5hbWUNCiAgICAgKiBAZmlyZXMgICBjbGFzc05hbWUjZXZlbnROYW1lDQogICAgICogQGxpc3RlbnMgZXZlbnQ6ZXZlbnROYW1lDQogICAgICogQGxpc3RlbnMgY2xhc3NOYW1lfmV2ZW50OmV2ZW50TmFtZQ0KICAgICAqIEBwYXJhbSB7dHlwZX0gICB2YXIgICAgICAgICAgIERlc2NyaXB0aW9uLg0KICAgICAqIEBwYXJhbSB7dHlwZX0gICBbdmFyXSAgICAgICAgIERlc2NyaXB0aW9uIG9mIG9wdGlvbmFsIHZhcmlhYmxlLg0KICAgICAqIEBwYXJhbSB7dHlwZX0gICBbdmFyPWRlZmF1bHRdIERlc2NyaXB0aW9uIG9mIG9wdGlvbmFsIHZhcmlhYmxlIHdpdGggZGVmYXVsdCB2YXJpYWJsZS4NCiAgICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0VmFyICAgICBEZXNjcmlwdGlvbi4NCiAgICAgKiBAcGFyYW0ge3R5cGV9ICAgb2JqZWN0VmFyLmtleSBEZXNjcmlwdGlvbiBvZiBhIGtleSBpbiB0aGUgb2JqZWN0VmFyIHBhcmFtZXRlci4NCiAgICAgKg0KICAgICAqIEB5aWVsZCB7dHlwZX0gWWllbGRlZCB2YWx1ZSBkZXNjcmlwdGlvbi4NCiAgICAgKg0KICAgICAqIEByZXR1cm4ge3R5cGV9IFJldHVybiB2YWx1ZSBkZXNjcmlwdGlvbi4NCiAgICAgKi8NCiAgICA8JSBpZighbS5Jc1N5bmMpeyU+YXN5bmMgPCV9JT48JT1tTmFtZT1uQ29kZShtKSU+KDwlPW0uTWV0aG9kUGFyYW1ldGVycy5tYXAocCA9PiBuQ29kZShwKSkuam9pbignLCAnKSU+KXsNCg0KICAgIAlsZXQgbG9nID0gKG9iaiwgLi4ubXNnKSA9PiB0aGlzLmxvZygiPCU9bk5hbWUoYyklPiIsIG9iaiwgIjwlPW5Db2RlKG0pJT4iLCBudWxsLCAwLCAuLi5tc2cpOw0KICAgIAlsZXQgd2FybiA9IChvYmosIC4uLm1zZykgPT4gdGhpcy5sb2coIjwlPW5OYW1lKGMpJT4iLCBvYmosICI8JT1uQ29kZShtKSU+IiwgbnVsbCwgMSwgLi4ubXNnKTsNCiAgICAJbGV0IGVycm9yID0gKG9iaiwgLi4ubXNnKSA9PiB0aGlzLmxvZygiPCU9bk5hbWUoYyklPiIsIG9iaiwgIjwlPW5Db2RlKG0pJT4iLCBudWxsLCAyLCAuLi5tc2cpOw0KICAgIAlsZXQgb1Njb3BlID0gPCU9YWxpYXMoKSU+Ow0KICAgIAlsZXQgcFNjb3BlID0gPCU9c2NvcGUlPjsNCiAgICAgICAgDQogICAgDQo8JSBpZighbS5Jc1N5bmMpeyU+DQogICAgPCUgaWYoIW0uUmVzcG9uc2VBdHRyaWJ1dGUpeyAlPg0KICAgICAgICBsZXQgYW5zd2VyID0gbnVsbDsNCiAgICA8JSB9ZWxzZSBpZihtLlJlc3BvbnNlQXR0cmlidXRlLkVudGl0eVR5cGUpeyAlPg0KICAgICAgICBsZXQgYW5zd2VyID0gbmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKG0uUmVzcG9uc2VBdHRyaWJ1dGUuRW50aXR5VHlwZSwgdHJ1ZSklPigpOw0KICAgIDwlIH1lbHNlIGlmKG0uUmVzcG9uc2VBdHRyaWJ1dGUuSXNCb29sKXsgJT4NCiAgICAgICAgbGV0IGFuc3dlciA9IGZhbHNlOw0KICAgIDwlIH1lbHNlIGlmKG0uSXNBcnJheSl7ICU+DQogICAgICAgIGxldCBhbnN3ZXIgPSBbXTsNCiAgICA8JSB9ZWxzZXsgJT4NCiAgICAgICAgbGV0IGFuc3dlciA9IG51bGw7DQogICAgPCUgfSAlPg0KICAgIA0KICAgICAgICBsZXQgcmVzdWx0cyA9IGF3YWl0IHRoaXMuX2V4ZWN1dGUobnVsbCwgPCU9YWxpYXMoKSU+LCAiPCU9bkNvZGUobSklPiIsIDwlbVJvdXRpbmcoYywgbSklPiwgYXN5bmMgKCkgPT4gew0KICAgICAgICANCjwlIH0lPg0KPCUgbS5NZXRob2RQYXJhbWV0ZXJzLmZpbHRlcihwID0+IHAuRGVmYXVsdCkuZm9yRWFjaChwID0+IHslPg0KICAgICAgICBpZih0eXBlb2YoPCU9bk5hbWUocCklPik9PT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICA8JT1uTmFtZShwKSU+ID0gPCV2YWx1ZU9mKHAuRGVmYXVsdCklPjsNCiAgICAgICAgfQ0KPCUgfSklPg0KDQogICAgICAgIHZhciBlcnJvcnMgPSB7DQogICAgICAgIDwlICBbXS5jb25jYXQobS5NZXRob2RQYXJhbWV0ZXJzLmZpbHRlcihwID0+IHAuUmVxdWlyZWQpLm1hcChwID0+ICh7DQogICAgICAgICAgICAgICAgQ29kZTogYCR7bk5hbWUocCl9LXJlcXVpcmVkYCwNCiAgICAgICAgICAgICAgICBFcnJvcjogYCR7bk5hbWUocCl9IGlzIGEgcmVxdWlyZWQgUGFyYW1ldGVyYCwNCiAgICAgICAgICAgICAgICBTY3JpcHQ6IGB0eXBlb2YoJHtuTmFtZShwKX0pPT09J3VuZGVmaW5lZCdgLA0KICAgICAgICAgICAgfSkpKS5jb25jYXQobS5NZXRob2RQYXJhbWV0ZXJzLmZpbHRlcihwID0+IHAuRW50aXR5VHlwZSkubWFwKHAgPT4gKHsNCiAgICAgICAgICAgICAgICBDb2RlOiBgJHtuTmFtZShwKX1gLA0KICAgICAgICAgICAgICAgIEVycm9yOiBgJHtuTmFtZShwKX0gaXMgbm90IG9mIHR5cGUgJHtuTmFtZShwLkVudGl0eVR5cGUpfWAsDQogICAgICAgICAgICAgICAgU2NyaXB0OiBgKCEke25OYW1lKHApfSAmJiAke3AuUmVxdWlyZWQ/J3RydWUnOidmYWxzZSd9KSB8fCAoJHtuTmFtZShwKX0gJiYgKCR7bk5hbWUocCl9LmNvbnN0cnVjdG9yLm5hbWUhPScke25OYW1lKHAuRW50aXR5VHlwZSl9JyB8fCAke25OYW1lKHApfS5FbnRpdHlDbGFzcy5OYW1lIT0nJHtuTmFtZShwLkVudGl0eVR5cGUpfScpKWAsDQogICAgICAgICAgICB9KSkpLmNvbmNhdChtLlZhbGlkYXRvcnMgfHwgW10pLmZpbHRlcih2ID0+ICF2Lklnbm9yZSkuZm9yRWFjaCh2ID0+IHsgJT4NCiAgICAgICAgICAgICI8JT12LkNvZGUlPiI6ICgoPCU9bS5NZXRob2RQYXJhbWV0ZXJzLm1hcChwID0+IHAuTmFtZSkuam9pbignLCAnKSU+KSA9PiB7DQogICAgICAgICAgICAgICAgdHJ5ew0KDQogICAgICAgICAgICAgICAgPCUgaWYodi5TY3JpcHQuaW5kZXhPZigncmV0dXJuICcpPDApeyU+DQogICAgICAgICAgICAgICAgICAgIGxldCBhbnN3ZXIgPSANCiAgICAgICAgICAgICAgICA8JX0lPg0KICAgICAgICAgICAgICAgICAgICA8JT12LlNjcmlwdCU+DQogICAgICAgICAgICAgICAgICAgIC8vPCU9bG9nKCklPiJhbnN3ZXIiLCAiPCU9di5Db2RlJT4iLCBhbnN3ZXIpOw0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gYW5zd2VyOw0KICAgICAgICAgICAgICAgIH1jYXRjaChleCl7DQogICAgICAgICAgICAgICAgICAgIDwlPXdhcm4oKSU+InZhbGlkYXRvciIsICI8JT12LkNvZGUlPiIsIGV4KTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9KSg8JT1tLk1ldGhvZFBhcmFtZXRlcnMubWFwKHAgPT4gcC5OYW1lKS5qb2luKCcsICcpJT4pPygnPCU9di5FcnJvciU+JyB8fCAnVmFsaWRhdGlvbiBFcnJvcicpOicnLA0KICAgICAgICA8JSB9KSAlPg0KICAgICAgICB9Ow0KICAgICAgICBPYmplY3Qua2V5cyhlcnJvcnMpLmZpbHRlcihrID0+ICFlcnJvcnNba10pLmZvckVhY2goayA9PiBkZWxldGUgZXJyb3JzW2tdKTsNCiAgICAgICAgaWYoT2JqZWN0LmtleXMoZXJyb3JzKS5sZW5ndGgpew0KICAgICAgICAgICAgT2JqZWN0LmtleXMoZXJyb3JzKS5maWx0ZXIoayA9PiBrLnN0YXJ0c1dpdGgoJy0nKSkuZm9yRWFjaChrID0+IHsNCiAgICAgICAgICAgICAgICA8JT1sb2coKSU+e1trXTogZXJyb3JzW2tdfSk7DQogICAgICAgICAgICAgICAgZGVsZXRlIGVycm9yc1trXTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgaWYoT2JqZWN0LnZhbHVlcyhlcnJvcnMpLmxlbmd0aCl7DQogICAgICAgICAgICAgICAgcmV0dXJuIHsNCiAgICAgICAgICAgICAgICAgICAgX19leGNlcHRpb246IGVycm9ycywNCiAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQoNCiAgICAgICAgPCU9bS5TY3JpcHQlPg0KICAgICAgICANCjwlIGlmKCFtLklzU3luYyl7JT4NCiAgICAgICAgfSwge19fYmVmb3JlUnVsZXM6IFs8JShtLk1ldGhvZFJ1bGVzIHx8IFtdKS5maWx0ZXIociA9PiByLkJlZm9yZSkubWFwKHIgPT4geyU+PCU9X0ZyRU1ELl90b0pTKHIpJT48JSB9KS5qb2luKCcsICcpJT5dLCBfX2FmdGVyUnVsZXM6IFs8JShtLk1ldGhvZFJ1bGVzIHx8IFtdKS5maWx0ZXIociA9PiByLkFmdGVyKS5tYXAociA9PiB7JT48JT1fRnJFTUQuX3RvSlMociklPjwlIH0pLmpvaW4oJywgJyklPl0sIDwlPW0uTWV0aG9kUGFyYW1ldGVycy5tYXAocCA9PiBuQ29kZShwKSArICI6ICIgKyBuQ29kZShwKSkuam9pbignLCAnKSU+fSk7DQogICAgICAgIA0KICAgICAgICANCiAgICAgICAgLy8gdGFrZSBvdXQgdGhlIGludmFsaWQgbm9kZSByZXN1bHRzDQogICAgICAgIHJlc3VsdHMgPSByZXN1bHRzLmZpbHRlcihyID0+IHIgJiYgci5yZXQpOw0KDQogICAgICAgIC8vIGhhcyBhbnkgbm9kZSBnZW5lcmF0ZWQgYSB2YWxpZGF0aW9uIGV4Y2VwdGlvbj8NCiAgICAgICAgbGV0IF9fZXggPSByZXN1bHRzLmZpbmQociA9PiByLnJldC5fX2V4Y2VwdGlvbik7DQogICAgICAgIGlmKF9fZXgpIHJldHVybiBfX2V4LnJldDsNCg0KICAgICAgICA8JT1tLlJlZHVjZSU+DQoNCiAgICAgICAgPCUgaWYobS5Jc0FycmF5IHx8IG0uUmVzcG9uc2VBdHRyaWJ1dGUuSXNBcnJheSl7JT4NCiAgICAgICAgcmV0dXJuIHJlc3VsdHMubWFwKHIgPT4gci5yZXQpLmZsYXQoKTsNCiAgICAgICAgPCUgfWVsc2UgaWYobS5SZXNwb25zZUF0dHJpYnV0ZS5FbnRpdHlUeXBlKXsgJT4NCiAgICAgICAgcmV0dXJuIHJlc3VsdHMubGVuZ3RoP3Jlc3VsdHNbMF0ucmV0Om51bGw7DQogICAgICAgIDwlIH1lbHNleyAlPg0KICAgICAgICByZXR1cm4gcmVzdWx0cy5sZW5ndGg/cmVzdWx0c1swXS5yZXQ6bnVsbDsNCiAgICAgICAgPCUgfSU+DQo8JSB9JT4NCiAgICB9DQo8JSB9KTslPg0KDQo8JSBpZihtYWluQ2xhc3MoX3Jlc3RUb29scykpeyU+DQogICAgYXN5bmMgPCU9bU5hbWU9J19yZXNwb25zZUludGVyY2VwdG9yJyU+KGVycm9yLCB0KXsNCiAgICA8JSBpZihtYWluQ2xhc3MoX3Jlc3RUb29scykhPWMpeyU+DQogICAgICAgIHJldHVybiBhd2FpdCBuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUobWFpbkNsYXNzKF9yZXN0VG9vbHMpKSU+KCkuPCU9bU5hbWUlPihlcnJvciwgdCk7DQogICAgPCUgfWVsc2V7JT4NCiAgICAgICAgdHJ5ew0KICAgICAgICAgICAgdCA9IHQgfHwgdGhpcy5Ub29sOw0KICAgICAgICAgICAgY29uc3Qgb3JpZ2luYWxSZXF1ZXN0ID0gZXJyb3IuY29uZmlnOw0KICAgICAgICAgICAgaWYgKHRoaXMuX19jb25maWcoIm9hdXRoLmFjY2Vzc190b2tlbiIsIG51bGwsIHt0b29sOiB0fSkgJiYgZXJyb3IucmVzcG9uc2UgJiYgZXJyb3IucmVzcG9uc2Uuc3RhdHVzID09PSA0MDEgJiYgIW9yaWdpbmFsUmVxdWVzdC5fcmV0cnkgJiYgb3JpZ2luYWxSZXF1ZXN0LmhlYWRlcnMuQXV0aG9yaXphdGlvbi5pbmRleE9mKHRoaXMuX19jb25maWcoIm9hdXRoLmFjY2Vzc190b2tlbiIsIG51bGwsIHt0b29sOiB0fSkpPjApIHsNCiAgICAgICAgICAgICAgICBvcmlnaW5hbFJlcXVlc3QuX3JldHJ5ID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAvLyBhd2FpdCAoZ2V0IHRoZSB0b2tlbiBvciByZWZyZXNoIGl0KQ0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIG9yaWdpbmFsUmVxdWVzdC5oZWFkZXJzLkF1dGhvcml6YXRpb24gPSB0aGlzLl9fY29uZmlnKCJvYXV0aC5hY2Nlc3NfdHlwZSIsICJCZWFyZXIiLCB7dG9vbDogdH0pICsgIiAiICsgdGhpcy5fX2NvbmZpZygib2F1dGguYWNjZXNzX3Rva2VuIiwgbnVsbCwge3Rvb2w6IHR9KTsNCiAgICAgICAgICAgICAgICByZXR1cm4gdC5heGlvcyhvcmlnaW5hbFJlcXVlc3QpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycm9yKTsNCiAgICAgICAgfWNhdGNoKGV4KXsNCiAgICAgICAgICAgIDwlPWVycm9yKCklPmV4KTsNCiAgICAgICAgfQ0KICAgICAgICA8JT1sb2coKSU+Y29uZmlnKTsNCiAgICAgICAgcmV0dXJuIGNvbmZpZzsNCiAgICA8JSB9JT4NCiAgICB9DQoNCiAgICBhc3luYyA8JT1tTmFtZT0nX3JlcXVlc3RJbnRlcmNlcHRvciclPihjb25maWcsIHQpew0KICAgIDwlIGlmKG1haW5DbGFzcyhfcmVzdFRvb2xzKSE9Yyl7JT4NCiAgICAgICAgcmV0dXJuIGF3YWl0IG5ldyA8JT1zY29wZSU+LjwlPV9jTmFtZShtYWluQ2xhc3MoX3Jlc3RUb29scykpJT4oKS48JT1tTmFtZSU+KGNvbmZpZywgdCk7DQogICAgPCUgfWVsc2V7JT4NCiAgICAgICAgdHJ5ew0KICAgICAgICAgICAgdCA9IHQgfHwgdGhpcy5Ub29sOw0KICAgICAgICAgICAgY29uZmlnID0gY29uZmlnIHx8IHtoZWFkZXJzOiB7fX07DQogICAgICAgICAgICBjb25maWcubWV0YSA9IGNvbmZpZy5tZXRhIHx8IHt9Ow0KICAgICAgICAgICAgY29uZmlnLm1ldGEuY291bnRlciA9IDQ7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGxldCB0b2tlblVyaSA9IHRoaXMuX19jb25maWcoIm9hdXRoLnRva2VuLnVyaSIsIG51bGwsIHt0b29sOiB0fSk7DQogICAgICAgICAgICBsZXQgcmVmcmVzaFVyaSA9IHRoaXMuX19jb25maWcoIm9hdXRoLnJlZnJlc2gudXJpIiwgbnVsbCwge3Rvb2w6IHR9KTsNCiAgICAgICAgICAgIGxldCBhdXRoVXJpID0gdGhpcy5fX2NvbmZpZygib2F1dGguYXV0aG9yaXplLnVyaSIsIG51bGwsIHt0b29sOiB0fSk7DQogICAgICAgICAgICBsZXQgYXV0aFR5cGUgPSB0aGlzLl9fY29uZmlnKCJvYXV0aC5hdXRoX3R5cGUiLCAiQmVhcmVyIiwge3Rvb2w6IHR9KTsNCiAgICAgICAgICAgIGxldCB0b2tlbiA9IHRoaXMuX19jb25maWcoIm9hdXRoLmFjY2Vzc190b2tlbi4iK2NvbmZpZy5tZXRob2QsIHRoaXMuX19jb25maWcoIm9hdXRoLmFjY2Vzc190b2tlbiIsIG51bGwsIHt0b29sOiB0LCBub2RlOiA8JT1uc2NvcGUlPi5fbm9kZX0pLCB7dG9vbDogdCwgbm9kZTogPCU9bnNjb3BlJT4uX25vZGV9KTsNCiAgICAgICAgICAgIGlmKCFjb25maWcuaGVhZGVycy5BdXRob3JpemF0aW9uICYmIFt0b2tlblVyaSwgcmVmcmVzaFVyaSwgYXV0aFVyaV0uaW5kZXhPZihjb25maWcudXJsKTwwKXsNCiAgICAgICAgICAgICAgICBpZighdG9rZW4pew0KICAgICAgICAgICAgICAgICAgICBsZXQgYXV0aENvZGUgPSB0aGlzLl9fY29uZmlnKCdvYXV0aC5hdXRob3JpemUuY29kZScsIG51bGwsIHt0b29sOiB0fSk7DQogICAgICAgICAgICAgICAgICAgIGxldCBhdXRoTWV0aG9kID0gdGhpcy5fX2NvbmZpZygnb2F1dGguYXV0aG9yaXplLm1ldGhvZCcsIG51bGwsIHt0b29sOiB0fSk7DQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBpZighdG9rZW5VcmkgJiYgIWF1dGhDb2RlICYmICFhdXRoTWV0aG9kICYmIHRoaXMuX19jb25maWcoJ3VzZXJuYW1lJykpew0KICAgICAgICAgICAgICAgICAgICAgICAgYXV0aFR5cGUgPSAnQmFzaWMnOw0KICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW4gPSB0aGlzLl9idG9hKHRoaXMuX19jb25maWcoJ3VzZXJuYW1lJykgKyAiOiIgKyB0aGlzLl9fY29uZmlnKCdwYXNzd29yZCcpKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICANCjwlaWYoX2NOYW1lKCdOb2RlJykpeyU+DQogICAgICAgICAgICAgICAgICAgIGlmKDwlPW5zY29wZSU+Ll9ub2RlICYmICFhdXRoQ29kZSAmJiBhdXRoTWV0aG9kPT0iZ2V0Iil7DQogICAgICAgICAgICAgICAgICAgICAgICAvLyBjcmVhdGUgb3IgbG9hZCBhIG5ldyBvYXV0aCBzdGF0ZQ0KICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fX2NvbmZpZygib2F1dGguYXV0aG9yaXplLnN0YXRlIiwgbnVsbCwge3Rvb2w6IHQsIG5vZGU6IDwlPW5zY29wZSU+Ll9ub2RlLCBuZXdWYWx1ZTogdGhpcy5fYnRvYShKU09OLnN0cmluZ2lmeSh7dG9vbDogdC5uYW1lLCBuY29kZTogPCU9bnNjb3BlJT4uX25vZGUuY29kZSgpfSkpfSk7DQogICAgICAgICAgICAgICAgICAgICAgICAvLyBhdXRob3JpemUgYW5kIGdldCB0aGUgYXV0aCBjb2RlDQogICAgICAgICAgICAgICAgICAgICAgICBhdXRoVXJpID0gdGhpcy5fX2NvbmZpZygib2F1dGguYXV0aG9yaXplLnVyaSIsIG51bGwsIHt0b29sOiB0fSk7DQogICAgICAgICAgICAgICAgICAgICAgICA8JT1sb2coKSU+YCR7YXV0aFVyaX1gKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5vcGVuKGF1dGhVcmkpOw0KICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5zZXRJbnRlcnZhbChudWxsLCB0b29sID0+IDwlPW5zY29wZSU+Ll9ub2RlICYmIGNvbmZpZy5tZXRhLmNvdW50ZXItLSAmJiAhKGF1dGhDb2RlID0gdGhpcy5fX2NvbmZpZygnb2F1dGguYXV0aG9yaXplLmNvZGUnLCBudWxsLCB7dG9vbDogdH0pKSwgMC4xLCB0KTsNCiAgICAgICAgICAgICAgICAgICAgICAgIDwlPWxvZygpJT5gRG9uZSBMb29waW5nOiAke2F1dGhDb2RlfWApOw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYoIWF1dGhDb2RlKSBhdXRoTWV0aG9kPXVuZGVmaW5lZDsNCiAgICAgICAgICAgICAgICAgICAgfQ0KPCV9JT4NCg0KICAgICAgICAgICAgICAgICAgICBpZihhdXRoTWV0aG9kKXsNCiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBmbG93ID0gKCFhdXRoQ29kZSAmJiBhdXRoTWV0aG9kPT0ncG9zdCcpPydhdXRob3JpemUnOid0b2tlbic7DQogICAgICAgICAgICAgICAgICAgICAgICAvLyBnZXQgdGhlIHRva2VuDQogICAgICAgICAgICAgICAgICAgICAgICAvLyB0aGUgdG9rZW5VcmkgbWlnaHQgaGF2ZSBhIGRlcGVuZGVuY3kgb24gdGhlIGF1dGhvcml6YXRpb24gY29kZQ0KICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5VcmkgPSB0aGlzLl9fY29uZmlnKGBvYXV0aC4ke2Zsb3d9LnVyaWAsIG51bGwsIHt0b29sOiB0fSk7DQogICAgICAgICAgICAgICAgICAgICAgICBsZXQgdGNvbmZpZyA9IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmw6IHRva2VuVXJpLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZDogdGhpcy5fX2NvbmZpZyhgb2F1dGguJHtmbG93fS5tZXRob2RgLCAncG9zdCcsIHt0b29sOiB0fSksDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVyczogT2JqZWN0LmFzc2lnbih7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJDb250ZW50LVR5cGUiOiB0aGlzLl9fY29uZmlnKGBvYXV0aC4ke2Zsb3d9LmNvbnRlbnRfdHlwZWAsICJ0ZXh0L2pzb24iLCB7dG9vbDogdH0pLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiQXV0aG9yaXphdGlvbiI6ICJCYXNpYyAiK3RoaXMuX2J0b2EodGhpcy5fX2NvbmZpZygib2F1dGgubG9naW4iLCBudWxsLCB7dG9vbDogdH0pICsgIjoiICsgdGhpcy5fX2NvbmZpZygib2F1dGgucGFzc3dvcmQiLCBudWxsLCB7dG9vbDogdH0pKSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCB0aGlzLl9fY29uZmlnKGBvYXV0aC4ke2Zsb3d9LmhlYWRlcnNgLCAie30iLCB7dG9vbDogdH0pKSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiB0aGlzLl9fY29uZmlnKGBvYXV0aC4ke2Zsb3d9LmJvZHlgLCBudWxsLCB7dG9vbDogdH0pLA0KICAgICAgICAgICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGxldCB0cmVzID0gYXdhaXQgdC5heGlvcyh0Y29uZmlnKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIDwlPWxvZygpJT5gVG9rZW4gZmV0Y2hlZCAtICR7Zmxvd31gLCB0Y29uZmlnLCB0cmVzLmRhdGEpOw0KICAgICAgICAgICAgICAgICAgICAgICAgWydhY2Nlc3NfdG9rZW4nLCAndG9rZW5fdHlwZScsICdleHBpcmVzX2luJywgJ3JlZnJlc2hfdG9rZW4nXS5mb3JFYWNoKHRhID0+IHRoaXMuX19jb25maWcoYG9hdXRoLiR7dGF9YCwgbnVsbCwge3Rvb2w6IHQsIG5vZGU6IDwlPW5zY29wZSU+Ll9ub2RlLCBuZXdWYWx1ZTogdHJlcy5kYXRhW3RoaXMuX19jb25maWcoYG9hdXRoLnRva2VuLnJlc3BvbnNlLiR7dGF9YCwgdGEsIHt0b29sOiB0fSldfSkpOw0KICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW4gPSB0aGlzLl9fY29uZmlnKCJvYXV0aC5hY2Nlc3NfdG9rZW4iLCBudWxsLCB7dG9vbDogdCwgbm9kZTogPCU9bnNjb3BlJT4uX25vZGV9KTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICBjb25maWcuaGVhZGVycy5BdXRob3JpemF0aW9uID0gYXV0aFR5cGUgKyAiICIgKyB0b2tlbjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH1jYXRjaChleCl7DQogICAgICAgICAgICA8JT1lcnJvcigpJT5leCk7DQogICAgICAgIH0NCiAgICAgICAgPCU9bG9nKCklPmNvbmZpZyk7DQogICAgICAgIHJldHVybiBjb25maWc7DQogICAgPCUgfSU+DQogICAgfQ0KDQogICAgYXN5bmMgPCU9bU5hbWU9J19yZXN0JyU+KHROYW1lLCBwYXJhbXMsIGRhdGEsIG1ldGhvZCwgb3B0aW9ucyl7DQogICAgICAgIC8qIHROYW1lIG5vIGxvbmdlciByZXF1aXJlZCEhICovDQogICAgICAgIHROYW1lID0gdE5hbWUgfHwgPCU9X25Db2RlKCklPjsNCiAgICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge190aGlzOiB0aGlzfTsNCiAgICAgICAgb3B0aW9ucy50TmFtZSA9IG9wdGlvbnMudE5hbWUgfHwgdE5hbWU7DQogICAgICAgIA0KICAgICAgICBwYXJhbXMgPSBwYXJhbXMgfHwge307DQogICAgICAgIG1ldGhvZCA9IG1ldGhvZCB8fCAoZGF0YT8icG9zdCI6ImdldCIpOw0KICAgICAgICANCiAgICA8JSBpZihtYWluQ2xhc3MoX3Jlc3RUb29scykhPWMpeyU+DQogICAgICAgIHJldHVybiBhd2FpdCBuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUobWFpbkNsYXNzKF9yZXN0VG9vbHMpKSU+KC8qbnVsbCwgdGhpcy5Ub29sKi8pLjwlPW1OYW1lJT4odE5hbWUsIHBhcmFtcywgZGF0YSwgbWV0aG9kLCBvcHRpb25zKTsNCiAgICA8JSB9ZWxzZXslPg0KICAgICAgICB0cnl7DQogICAgICAgICAgICBpZihvcHRpb25zLmZvcm0pew0KICAgICAgICAgICAgICAgIGxldCBmZCA9IG5ldyBGb3JtRGF0YSgpOw0KICAgICAgICAgICAgICAgIE9iamVjdC5rZXlzKGRhdGEpLmZvckVhY2goayA9PiBmZC5hcHBlbmQoaywgZGF0YVtrXSkpOw0KICAgICAgICAgICAgICAgIGRhdGEgPSBmZDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgbGV0IGNvbmZpZyA9IHsNCiAgICAgICAgICAgICAgICB1cmw6IHRoaXMuX19jb25maWcob3B0aW9ucy51cmwgfHwgYHJlc3RhcGkudXJsLiR7bWV0aG9kfWAsIHRoaXMuX19jb25maWcob3B0aW9ucy51cmwgfHwgJ3Jlc3RhcGkudXJsJywgKG9wdGlvbnMucGF0aHx8JycpICsgb3B0aW9ucy5maWxlLCBvcHRpb25zKSwgb3B0aW9ucyksDQogICAgICAgICAgICAgICAgbWV0aG9kOiBtZXRob2QsDQogICAgICAgICAgICAgICAgcGFyYW1zOiBwYXJhbXMsDQogICAgICAgICAgICAgICAgaGVhZGVyczogT2JqZWN0LmFzc2lnbih0aGlzLl9fY29uZmlnKCdyZXN0YXBpLmhlYWRlcnMuJyttZXRob2QsIHRoaXMuX19jb25maWcoJ3Jlc3RhcGkuaGVhZGVycycsIHt9LCBvcHRpb25zKSwgb3B0aW9ucyksIG9wdGlvbnMuaGVhZGVycyB8fCB7fSksDQogICAgICAgICAgICAgICAgZGF0YTogZGF0YSwNCiAgICAgICAgICAgICAgICB2YWxpZGF0ZVN0YXR1czogc3RhdHVzID0+IHN0YXR1czw0MDAsDQogICAgICAgICAgICB9Ow0KICAgICAgICAgICAgDQogICAgICAgICAgICBsZXQgcmV0ID0gW107DQogICAgICAgICAgICA8JT1sb2coKSU+YFtMSVZFOiR7dGhpcy5fX2NvbmZpZygnbGl2ZScsIHRydWUpfV1gLCBjb25maWcsIG9wdGlvbnMpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBpZih0aGlzLl9fY29uZmlnKCdsaXZlJywgdHJ1ZSkpew0KICAgICAgICAgICAgICAgIGlmKHR5cGVvZih0aGlzLlRvb2wuYXhpb3MpIT09J3VuZGVmaW5lZCcgfHwgdHlwZW9mKGF4aW9zKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICAgICAgcmV0ID0gKGF3YWl0ICgodGhpcy5Ub29sLmF4aW9zIHx8IGF4aW9zKSkoY29uZmlnKSkuZGF0YTsNCiAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgcmV0ID0gYXdhaXQgKGF3YWl0IGZldGNoKGNvbmZpZy51cmwsIGNvbmZpZykpLmpzb24oKTsNCiAgICAgICAgICAgICAgICAgICAgPCU9d2FybigpJT4iYXhpb3Mgbm90IGRlZmluZWQhLCB1c2luZyBmZXRjaCIsIHJldCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgPCU9bG9nKCklPiJyZXQiLCBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpKTsNCiAgICAgICAgICAgIHJldHVybiByZXQ7DQogICAgICAgIH1jYXRjaChleCl7DQogICAgICAgICAgICA8JT1lcnJvcigpJT5leCk7DQogICAgICAgIH0NCiAgICA8JSB9JT4NCiAgICB9DQo8JSB9IC8vIG1haW5DbGFzcyhfcmVzdFRvb2xzKSAlPg0KDQo8JSBpZihtYWluQ2xhc3MoX3NxbFRvb2xzKSl7JT4NCiAgICA8JT1tTmFtZT0nX3RvU1FMVGFibGUnJT4ob3B0aW9ucz17fSl7DQogICAgICAgIGxldCByZXQgPSB0aGlzLl9fZXhwb3J0KHtJZDogIjwlPXNjb3BlJT4uPCU9X2NOYW1lKGMsIHRydWUpJT4iLCBkZXBzOiB7fSwgc3FsOiBgYCwgZmllbGRzOiBgYH0sIHsNCiAgICAgICAgICAgIC8vX21hcDogdHJ1ZSwNCiAgICAgICAgICAgIE51bGw6IHRydWUsDQogICAgICAgICAgICBGdWxsOiB0cnVlLA0KICAgICAgICAgICAgX19oZWFkZXI6IG9iaiA9PiBvYmouc3FsID0gYENSRUFURSBUQUJMRSBJRiBOT1QgRVhJU1RTICR7dGhpcy5fUSgpfSR7PCU9X25Db2RlKCklPn0ke3RoaXMuX1EoKX0gKCR7b2JqLmZpZWxkc30vKjwlPW5OYW1lKGMpJT4qLyk7XG5gLA0KICAgICAgICAgICAgZXhwb3J0ZXI6IHYgPT4gdi5vYmogPSAodHlwZW9mKG9wdGlvbnMucmV1c2VkKT09PSd1bmRlZmluZWQnIHx8IG9wdGlvbnMucmV1c2VkPj12LnJldXNlZCk/di5vYmo6e3NxbDogdi5vYmouc3FsICs9IGAvKjwlPW5OYW1lKGMpJT46IHJldXNlZDogJHt2LnJldXNlZH0qL1xuXG5gLCBJZDogdi5vYmouSWR9LA0KICAgICAgICAgICAgSWQ6IChvYmosIGlkQ29kZSwgdikgPT4gb2JqLmZpZWxkcyArPSBgJHt0aGlzLl9RKCl9JHt0aGlzLl9fY29uZmlnKCdpZEZpZWxkJywgJ0lkJyl9JHt0aGlzLl9RKCl9IENIQVIoMjUpIFBSSU1BUlkgS0VZYCwNCiAgICA8JSBjLkVudGl0eUF0dHJpYnV0ZXMuZmlsdGVyKGVhID0+ICFlYS5FbnRpdHlNZXRob2QgJiYgIWVhLkVudGl0eVR5cGUpLmZvckVhY2goZWEgPT4geyU+DQogICAgICAgICAgICA8JT1uTmFtZShlYSklPjogKG9iaiwgZWFDb2RlLCB2KSA9PiBvYmouZmllbGRzICs9IGAsJHt0aGlzLl9RKCl9JHs8JT1fbkNvZGUoZWEpJT59JHt0aGlzLl9RKCl9ICR7dGhpcy5fc3FsVHlwZSgiPCU9X0ZyRU1ELl9hdHRyKGVhKSU+IiwgdGhpcy5fX2NvbmZpZygndHlwZScpKX1gLA0KICAgIDwlIH0pOyAlPg0KICAgIDwlIGMuRW50aXR5QXR0cmlidXRlcy5maWx0ZXIoZWEgPT4gIWVhLkVudGl0eU1ldGhvZCAmJiBlYS5FbnRpdHlUeXBlKS5mb3JFYWNoKGVhID0+IHslPg0KICAgICAgICAgICAgPCU9bk5hbWUoZWEpJT46IChvYmosIGVhQ29kZSwgdikgPT4gew0KICAgICAgICAgICAgICAgIG9iai5kZXBzLjwlPW5OYW1lKGVhLkVudGl0eVR5cGUpJT4gPSAodiB8fCBuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUoZWEuRW50aXR5VHlwZSwgdHJ1ZSklPigpKS48JT1tTmFtZSU+KG9wdGlvbnMpOw0KICAgICAgICAgICAgICAgIG9iai5maWVsZHMgKz0gYCwke3RoaXMuX1EoKX0ke2VhQ29kZX1pZCR7dGhpcy5fUSgpfSAke3RoaXMuX3NxbFR5cGUoIjwlPV9GckVNRC5fYXR0cihlYSklPiIsIHRoaXMuX19jb25maWcoJ3R5cGUnKSl9YDsNCiAgICAgICAgICAgIH0sDQogICAgPCUgfSk7ICU+DQogICAgPCUgYy5UeXBlZEF0dHJpYnV0ZXMuZm9yRWFjaCh0YSA9PiB7IGxldCB0YU5hbWUgPSBuTmFtZSh0YSkgKyAnXycgKyB0YS5FbnRpdHlDbGFzcy5QbHVyYWwucmVwbGFjZSgvIC9nLCAnXycpOyU+DQogICAgICAgICAgICA8JT10YU5hbWUlPjogKG9iaiwgZWFDb2RlLCB2KSA9PiB7DQogICAgICAgICAgICAgICAgb2JqLmRlcHMuPCU9bk5hbWUodGEuRW50aXR5Q2xhc3MpJT4gPSAodiAmJiB2Lmxlbmd0aCk/dlswXTpuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUodGEuRW50aXR5Q2xhc3MsIHRydWUpJT4oKS48JT1tTmFtZSU+KG9wdGlvbnMpOw0KICAgICAgICAgICAgfSwNCiAgICA8JSB9KSU+DQogICAgICAgIH0sICI8JT1tTmFtZSU+Iik7DQogICAgICAgIA0KICAgICAgICA8JT1sb2coKSU+cmV0KTsNCiAgICAgICAgDQogICAgICAgIHJldHVybiBPYmplY3Qua2V5cyhyZXQuZGVwcyB8fCB7fSkuZmlsdGVyKGsgPT4gdHlwZW9mKHJldC5kZXBzW2tdKT09PSdzdHJpbmcnKS5tYXAoayA9PiByZXQuZGVwc1trXSkuam9pbignXG5cbicpICsgcmV0LnNxbDsNCiAgICB9DQogICAgDQogICAgPCU9bU5hbWU9J19mcm9tU1FMVGFibGUnJT4odGFibGUsIGZpZWxkcyl7DQogICAgICAgIC8vIHRhYmxlIGlzIGEganNvbiBhcnJheQ0KPCUgYy5FbnRpdHlBdHRyaWJ1dGVzLmZpbHRlcihlYSA9PiAhZWEuRW50aXR5TWV0aG9kKS5mb3JFYWNoKGVhID0+IHsgJT4NCiAgICAgICAgaWYoKGZpZWxkcyAmJiBmaWVsZHMuaW5kZXhPZigiPCU9bk5hbWUoZWEpJT4iKSkgfHwgIWZpZWxkcyl7DQogICAgICAgICAgICB0aGlzLjwlPW5OYW1lKGVhKSU+KHRhYmxlWyI8JT1uQ29kZShlYSklPiJdKTsNCiAgICAgICAgfQ0KPCUgfSk7ICU+DQogICAgICAgIA0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICB9DQoNCiAgICBhc3luYyA8JT1tTmFtZT0nX3NxbCclPihzcWwsIF90aGlzKXsNCiAgICAgICAgX3RoaXMgPSBfdGhpcyB8fCB0aGlzOw0KICAgIDwlIGlmKG1haW5DbGFzcyhfc3FsVG9vbHMpIT1jKXslPg0KICAgICAgICByZXR1cm4gYXdhaXQgbmV3IDwlPXNjb3BlJT4uPCU9bk5hbWUobWFpbkNsYXNzKF9zcWxUb29scykpJT4oKS48JT1tTmFtZSU+KHNxbCwgX3RoaXMpOw0KICAgIDwlIH1lbHNleyU+DQogICAgICAgIGlmKCF0aGlzLlRvb2wuZGIgfHwgIXNxbCB8fCAhc3FsLnRyaW0oKSl7DQogICAgICAgICAgICBpZighdGhpcy5Ub29sLmRiKSA8JT1sb2coKSU+c3FsLCAiIDw9PVNLSVBQRUQ9PT4iKTsNCiAgICAgICAgICAgIHJldHVybiBbXTsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgaWYoc3FsLmluZGV4T2YoJztcbicpPjApew0KICAgICAgICAgICAgZm9yIGF3YWl0IChjb25zdCBzcWxTIG9mIHNxbC5zcGxpdCgnO1xuJykpew0KICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuPCU9bU5hbWUlPihzcWxTLnRyaW0oKSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIGxldCByZXQgPSBudWxsOw0KDQogICAgICAgIGlmKChzcWwubWF0Y2goL1woL2cpIHx8IFtdKS5sZW5ndGghPShzcWwubWF0Y2goL1wpL2cpIHx8IFtdKS5sZW5ndGgpew0KICAgICAgICAgICAgPCU9bG9nKCklPiJpbmNvcnJlY3Qgc3FsIiwgc3FsKTsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgdHJ5ew0KICAgICAgICAgICAgcmV0ID0gYXdhaXQgbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gew0KICAgICAgICAgICAgICAgIGxldCBfb2sgPSAoX3JldCwgX3NxbCkgPT4gew0KICAgICAgICAgICAgICAgICAgICBpZihfc3FsICYmIF9zcWwuaW5kZXhPZignc2VsZWN0JykpIHRoaXMuVG9vbC5fX2RtbFN0YXRlbWVudHMucHVzaChfc3FsKTsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc29sdmUoX3JldCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgbGV0IGRiID0gdGhpcy5Ub29sLmRiOw0KICAgICAgICAgICAgICAgIGxldCB0eXBlID0gdGhpcy5fX2NvbmZpZygndHlwZScpOw0KICAgIA0KICAgICAgICAgICAgICAgIGxldCBmdW4gPSAiIjsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBRdWVyeSBsaXN0IG9mIHN0YXRlbWVudCBzdGFydGluZyBrZXl3b3JkcyAgICAgICAgDQogICAgICAgICAgICAgICAgbGV0IHFMaXN0ID0gWyJzZWxlY3QiLCAiaW5zZXJ0IiwgInVwZGF0ZSIsICJkZWxldGUiXTsNCiAgICAgICAgICAgICAgICBpZih0aGlzLl9fY29uZmlnKCdkYXRhYmFzZS50cmFuc2FjdGlvbnMnLCB0cnVlKSl7DQogICAgICAgICAgICAgICAgICAgIHFMaXN0ID0gcUxpc3QuY29uY2F0KFsiYmVnaW4iLCAic3RhcnQiLCAiY29tbWl0Il0pOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBsZXQgYlF1ZXJ5ID0gcUxpc3QuaW5kZXhPZihzcWwuc3Vic3RyaW5nKDAsIHNxbC5pbmRleE9mKCcgJykpLnRyaW0oKS50b0xvd2VyQ2FzZSgpKT49MDsNCg0KICAgICAgICAgICAgICAgIGlmKGJRdWVyeSl7DQogICAgICAgICAgICAgICAgICAgIC8vIHF1ZXJ5DQogICAgICAgICAgICAgICAgICAgIGlmKFsnbXlzcWwnLCAncG9zdGdyZXMnXS5pbmRleE9mKHR5cGUpPj0wKSBmdW4gPSAncXVlcnknOw0KICAgICAgICAgICAgICAgICAgICBpZih0eXBlPT0nc3FsaXRlJykgZnVuID0gJ2FsbCc7DQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIC8vIERNTA0KICAgICAgICAgICAgICAgICAgICBpZihbJ215c3FsJywgJ3Bvc3RncmVzJ10uaW5kZXhPZih0eXBlKT49MCkgZnVuID0gJ3F1ZXJ5JzsNCiAgICAgICAgICAgICAgICAgICAgaWYodHlwZT09J3NxbGl0ZScpIGZ1biA9ICdydW4nOw0KDQogICAgICAgICAgICAgICAgICAgIHRoaXMuVG9vbC5kbWxDYWNoZSA9IHRoaXMuVG9vbC5kbWxDYWNoZSB8fCB7fTsNCiAgICAgICAgICAgICAgICAgICAgaWYodGhpcy5Ub29sLmRtbENhY2hlW3RoaXMuaGFzaENvZGUoc3FsKV0pIHJldHVybiBfb2soMCk7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuVG9vbC5kbWxDYWNoZVt0aGlzLmhhc2hDb2RlKHNxbCldID0gc3FsOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZih0eXBlPT0nc3FsaXRlJyAmJiB0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnKSBmdW4gPSAiIjsNCiAgICAgICAgICAgICAgICBpZihmdW4gJiYgIWRiW2Z1bl0pIGZ1biA9ICIiOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIHNxbCA9IHR5cGVvZihzcWxGb3JtYXR0ZXIpIT09J3VuZGVmaW5lZCc/c3FsRm9ybWF0dGVyLmZvcm1hdChzcWwpOnNxbDsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICA8JT1sb2coKSU+YCR7dHlwZX0uJHtmdW59YCwgc3FsKTsNCiAgICAgICAgICAgICAgICBpZig8JT1zY29wZSU+Ll9fc3FsVHJhbnNhY3Rpb24pIDwlPXNjb3BlJT4uX19zcWxUcmFuc2FjdGlvbi5zcWxzLnB1c2goc3FsKTsNCg0KICAgICAgICAgICAgICAgIGlmIChmdW4pIHsNCiAgICAgICAgICAgICAgICAgICAgbGV0IHJldCA9IFtdOw0KICAgICAgICAgICAgICAgICAgICBpZih0eXBlPT0icG9zdGdyZXMiKXsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldCA9IGRiW2Z1bl0oc3FsKS50aGVuKHJvd3MgPT4gX29rKHJvd3MsIHNxbCkpLmNhdGNoKHJldEV4ID0+IHJlamVjdChyZXRFeCkpOw0KICAgICAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldCA9IGRiW2Z1bl0oc3FsLCBbXSwgKGVycm9yLCByb3dzKSA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoZXJyb3Ipew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyb3IpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfb2socm93cywgc3FsKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZT09J3Nub3dmbGFrZScpIHsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5Ub29sLmRiLmV4ZWN1dGUoew0KICAgICAgICAgICAgICAgICAgICAgICAgc3FsVGV4dDogc3FsLA0KICAgICAgICAgICAgICAgICAgICAgICAgY29tcGxldGU6IGZ1bmN0aW9uKGVyciwgc3RtdCwgcm93cykgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKGVycil7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfb2socm93cywgc3FsKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZT09J3NxbGl0ZScpIHsNCiAgICAgICAgICAgICAgICAgICAgLy8gc3FsaXRlIGluIHRoZSBicm93c2VyDQogICAgICAgICAgICAgICAgICAgIHRyeXsNCiAgICAgICAgICAgICAgICAgICAgICAgIGxldCByZXQgPSBudWxsOw0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0ID0gZGIuZXhlYyhzcWwpOw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYoIXJldCB8fCAhcmV0Lmxlbmd0aCkgcmV0dXJuIF9vayhyZXQsIHNxbCk7DQogICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIHJldCA9IHJldFswXS52YWx1ZXMubWFwKHIgPT4gT2JqZWN0LmZyb21FbnRyaWVzKG5ldyBNYXAocmV0WzBdLmNvbHVtbnMubWFwKChjLCBpKSA9PiBbYywgcltpXV0pKSkpOw0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gPCU9bG9nKCklPnJldCk7DQogICAgICAgICAgICAgICAgICAgICAgICBfb2socmV0LCBzcWwpOw0KICAgICAgICAgICAgICAgICAgICB9Y2F0Y2goZXgpew0KICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGV4KTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0gZWxzZSBpZih0eXBlPT0ncXVlc3RkYicpew0KICAgICAgICAgICAgICAgICAgICB0aGlzLl9yZXN0KG51bGwsIHtxdWVyeTogc3FsfSkudGhlbihyID0+IF9vayhyLCBzcWwpKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfWNhdGNoKGV4KXsNCiAgICAgICAgICAgIDwlPWVycm9yKCklPmANCkVSUk9SOg0KJHtleH0NCg0KV2hpbGUgU2VuZGluZyBRdWVyeSANCiR7c3FsfQ0KYCk7DQogICAgICAgIH0NCg0KICAgICAgICBpZihyZXQgJiYgcmV0LnJvd3MpIHJldCA9IHJldC5yb3dzOyAgICAgICAgDQogICAgICAgIGlmKEFycmF5LmlzQXJyYXkocmV0KSkgcmV0ID0gcmV0Lm1hcChyID0+IERvdE9iamVjdC5vYmplY3QocikpOw0KICAgICAgICByZXR1cm4gcmV0Ow0KICAgIDwlIH0lPg0KICAgIH0NCjwlIH0lPg0KDQo8JSBpZihtYWluQ2xhc3MoWydBaXJUYWJsZSddKSl7JT4NCjwlDQpsZXQgX3RvVHlwZUFUID0gZWEgPT4gew0KICAgIGxldCByZXQgPSB7bmFtZTogbk5hbWUoZWEpLCBkZXNjcmlwdGlvbjogZWEuTmFtZSwgdHlwZTogInNpbmdsZUxpbmVUZXh0In07DQogICAgaWYoZWEuSXNCb29sKXsNCiAgICAgICAgcmV0LnR5cGUgPSAiY2hlY2tib3giOw0KICAgICAgICByZXQub3B0aW9ucyA9IHsNCiAgICAgICAgICAgIGNvbG9yOiAiZ3JlZW5CcmlnaHQiLA0KICAgICAgICAgICAgaWNvbjogImNoZWNrIg0KICAgICAgICB9Ow0KICAgIH0NCiAgICBpZihlYS5Jc0RhdGUpew0KICAgICAgICByZXQudHlwZSA9ICJkYXRlVGltZSI7DQogICAgICAgIHJldC5vcHRpb25zID0gew0KICAgICAgICAgICAgZGF0ZUZvcm1hdDogew0KICAgICAgICAgICAgICAgIG5hbWU6ICdpc28nDQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgdGltZUZvcm1hdDogew0KICAgICAgICAgICAgICAgIG5hbWU6ICcyNGhvdXInLA0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIHRpbWVab25lOiAndXRjJywNCiAgICAgICAgfTsNCiAgICB9DQogICAgDQogICAgcmV0dXJuIHJldDsNCn07DQolPg0KICAgIDwlPW1OYW1lPSdfdG9BVFRhYmxlJyU+KGxldmVsKXsNCiAgICAgICAgbGV0IHJldCA9IFt7DQogICAgICAgICAgICBuYW1lOiAnPCU9bk5hbWUoYyklPicsDQogICAgICAgICAgICBkZXNjcmlwdGlvbjogJycsDQogICAgICAgICAgICBmaWVsZHM6IFsNCiAgICAgICAgICAgICAgICB7bmFtZTogdGhpcy5fX2NvbmZpZygnaWRGaWVsZCcsICdJZCcpLCBkZXNjcmlwdGlvbjogJ0lEJywgdHlwZTogJ3NpbmdsZUxpbmVUZXh0J30sDQogICAgPCUgYy5FbnRpdHlBdHRyaWJ1dGVzLmZpbHRlcihlYSA9PiAhZWEuRW50aXR5TWV0aG9kKS5mb3JFYWNoKGVhID0+IHslPjwlPV9GckVNRC5fdG9KUyhfdG9UeXBlQVQoZWEpKSU+LDwlIH0pJT5dLA0KICAgICAgICB9XTsNCg0KICAgICAgICByZXQgPSB0aGlzLl9fZXhwb3J0KHJldCwgew0KICAgICAgICAgICAgRnVsbDogdHJ1ZSwNCiAgICAgICAgICAgIE51bGw6IHRydWUsDQogICAgPCUgYy5FbnRpdHlBdHRyaWJ1dGVzLmZpbHRlcihlYSA9PiAhZWEuRW50aXR5TWV0aG9kICYmIGVhLkVudGl0eVR5cGUpLmZvckVhY2goZWEgPT4geyAlPg0KICAgICAgICAgICAgIjwlPW5OYW1lKGVhKSU+IjogKG9iaiwgZWFDb2RlLCB2KSA9PiByZXQucHVzaChuZXcgPCU9c2NvcGUlPi48JT1uTmFtZShlYS5FbnRpdHlUeXBlLCB0cnVlKSU+KCkuPCU9bU5hbWUlPigpKSwNCiAgICA8JSB9KTsgJT4NCiAgICA8JSBjLlR5cGVkQXR0cmlidXRlcy5mb3JFYWNoKHRhID0+IHsgbGV0IHRhTmFtZSA9IG5OYW1lKHRhKSArICdfJyArIHRhLkVudGl0eUNsYXNzLlBsdXJhbC5yZXBsYWNlKC8gL2csICdfJyk7JT4NCiAgICAgICAgICAgIDwlPXRhTmFtZSU+OiAob2JqLCBlYUNvZGUsIHYpID0+IHJldC5wdXNoKG5ldyA8JT1zY29wZSU+LjwlPW5OYW1lKHRhLkVudGl0eUNsYXNzLCB0cnVlKSU+KCkuPCU9bU5hbWUlPigpKSwNCiAgICA8JSB9KSU+DQogICAgICAgIH0sICI8JT1tTmFtZSU+Iik7DQoNCiAgICAgICAgPCU9bG9nKCklPnJldC5zcWwpOw0KICAgICAgICByZXR1cm4gcmV0LnNxbDsNCg0KICAgICAgICByZXQgPSByZXQuZmlsdGVyKCh0YWcsIGluZGV4LCBhcnJheSkgPT4gYXJyYXkuZmluZEluZGV4KHQgPT4gdC5uYW1lID09IHRhZy5uYW1lKSA9PSBpbmRleCk7DQogICAgICAgIDwlPWxvZygpJT5yZXQsIGxldmVsKTsNCiAgICAgICAgcmV0dXJuIHJldDsNCiAgICB9DQogICAgDQogICAgPCU9bU5hbWU9J190b0FURnVuY3Rpb24nJT4oKXsNCiAgICAgICAgbGV0IHRQcmVmID0gYCR7dGhpcy5fUSgpfSR7PCU9X25Db2RlKCklPn0ke3RoaXMuX1EoKX0uYDsNCiAgICAgICAgbGV0IHJldCA9IHRoaXMuX19leHBvcnQoe2Z1bjogIiJ9LCB7DQogICAgICAgICAgICBfZmllbGRzOiAodGhpcy5fX3N5bmNfb24oKSB8fCB0aGlzLklkPT10aGlzLklkKT9bJ0lkJ106dW5kZWZpbmVkLA0KICAgICAgICAgICAgX1RISVM6IG9iaiA9PiBvYmouZnVuICs9IGAgYW5kICR7dFByZWZ9JHt0aGlzLl9RKCl9JHt0aGlzLl9fY29uZmlnKCdpZEZpZWxkJywgJ0lkJyl9JHt0aGlzLl9RKCl9IGAgKyAodGhpcy5fVEhJU19jb29wIHx8ICJJTiIpICsgIiAoIiArIHRoaXMuX1RISVMubWFwKHQgPT4gdC48JT1tTmFtZSU+KHQuX19jb25maWcoJ2lkRmllbGQnLCAnSWQnKSkpLmpvaW4oJyBVTklPTiBBTEwgJykgKyAiKSIsDQogICAgICAgICAgICBJZDogb2JqID0+IG9iai5mdW4gKz0gYCBhbmQgJHt0UHJlZn0ke3RoaXMuX1EoKX0ke3RoaXMuX19jb25maWcoJ2lkRmllbGQnLCAnSWQnKX0ke3RoaXMuX1EoKX09JyR7dGhpcy5JZH0nYCwNCiAgICA8JSBjLkVudGl0eUF0dHJpYnV0ZXMuZmlsdGVyKGVhID0+ICFlYS5FbnRpdHlNZXRob2QpLmZvckVhY2goZWEgPT4geyAlPg0KICAgICAgICAgICAgPCU9bk5hbWUoZWEpJT46IChvYmosIGVhQ29kZSwgdikgPT4gew0KICAgICAgICA8JSBpZihlYS5FbnRpdHlUeXBlKXslPg0KICAgICAgICAgICAgICAgIGxldCBjb29wID0gdGhpcy5fPCU9bk5hbWUoZWEpJT5fY29vcDsNCiAgICAgICAgICAgICAgICBzd2l0Y2goY29vcCl7DQogICAgICAgICAgICAgICAgICAgIGNhc2UgIiE9IjoNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvb3AgPSAiTk9UIElOIjsNCiAgICAgICAgICAgICAgICAgICAgY2FzZSAiPSI6DQogICAgICAgICAgICAgICAgICAgICAgICBjb29wID0gIklOIjsNCiAgICAgICAgICAgICAgICAgICAgY2FzZSAiIjoNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvb3AgPSAiSU4iOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICBpZih2KXsNCiAgICAgICAgICAgICAgICAgICAgb2JqLmZ1biArPSBgIGFuZCAke3RQcmVmfSR7dGhpcy5fUSgpfSR7ZWFDb2RlfWlkJHt0aGlzLl9RKCl9ICR7Y29vcH0gKCR7di48JT1tTmFtZSU+KHYuX19jb25maWcoJ2lkRmllbGQnLCAnSWQnKSl9KWA7DQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIG9iai5mdW4gKz0gYCBhbmQgKCR7dFByZWZ9JHt0aGlzLl9RKCl9JHtlYUNvZGV9aWQke3RoaXMuX1EoKX0gJHtjb29wfSAoMCkgT1IgJHt0UHJlZn0ke3RoaXMuX1EoKX0ke2VhQ29kZX1pZCR7dGhpcy5fUSgpfSBJUyBOVUxMKWA7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgPCUgfWVsc2UgaWYoZWEuSXNUZXh0IHx8IGVhLklzSW1hZ2UgfHwgZWEuSXNGaWxlKXslPg0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgPCUgfWVsc2V7JT4NCiAgICAgICAgICAgICAgICBvYmouZnVuICs9IGAgYW5kICR7dFByZWZ9JHt0aGlzLl9RKCl9JHtlYUNvZGV9JHt0aGlzLl9RKCl9IGAgKyA8JWlmKGVhLklzQm9vbCl7JT4iPSI8JX1lbHNleyU+KHRoaXMuXzwlPW5OYW1lKGVhKSU+X2Nvb3AgfHwgIkxJS0UiKTwlfSU+ICsgIiAiOw0KICAgICAgICA8JSB9JT4NCiAgICAgICAgDQogICAgICAgIDwlIGlmKGVhLklzRGF0ZSl7ICU+DQogICAgICAgICAgICAgICAgaWYodiAmJiB2LnRvSVNPU3RyaW5nKXsNCiAgICAgICAgICAgICAgICAgICAgb2JqLmZ1biArPSAiJyIgKyB2LnRvSVNPU3RyaW5nKCkgKyAiJyI7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICA8JSB9ZWxzZSBpZihlYS5Jc1N0cmluZyl7ICU+DQogICAgICAgICAgICAgICAgaWYodHlwZW9mKHYpPT09InN0cmluZyIpew0KICAgICAgICAgICAgICAgICAgICBvYmouZnVuICs9ICInIiArICgodGhpcy5fPCU9bk5hbWUoZWEpJT5fY29vcD09IkxJS0UiIHx8ICF0aGlzLl88JT1uTmFtZShlYSklPl9jb29wKT8iJSI6IiIpICsgdiArICgodGhpcy5fPCU9bk5hbWUoZWEpJT5fY29vcD09IkxJS0UiIHx8ICF0aGlzLl88JT1uTmFtZShlYSklPl9jb29wKT8iJSI6IiIpICsgIiciOw0KICAgICAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICA8JSB9ZWxzZSBpZihlYS5Jc0Jvb2wpeyAlPg0KICAgICAgICAgICAgICAgIGlmKHR5cGVvZih2KT09PSJib29sZWFuIil7DQogICAgICAgICAgICAgICAgICAgIG9iai5mdW4gKz0gIiciICsgKHY/IjEiOiIwIikgKyAiJyI7DQogICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIDwlIH0gJT4NCiAgICAgICAgICAgICAgICBpZih2ICYmIHYuRW50aXR5Q2xhc3Mpew0KICAgICAgICAgICAgICAgICAgICBvYmouZnVuICs9ICIoIiArIHYuPCU9bU5hbWUlPigpICsgIikiOw0KICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICBvYmouZnVuICs9ICInIiArIHYgKyAiJyI7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSwNCiAgICA8JSB9KTsgJT4NCiAgICA8JSBjLlR5cGVkQXR0cmlidXRlcy5mb3JFYWNoKHRhID0+IHsgbGV0IHRhTmFtZSA9IG5OYW1lKHRhKSArICdfJyArIHRhLkVudGl0eUNsYXNzLlBsdXJhbC5yZXBsYWNlKC8gL2csICdfJyk7JT4NCiAgICAgICAgICAgIDwlPXRhTmFtZSU+OiAob2JqLCBlYUNvZGUsIHYpID0+IHsNCiAgICAgICAgICAgICAgICBvYmouc3FsICs9ICIgYW5kIC8qPCU9dGFOYW1lJT4qLyAiOw0KICAgICAgICAgICAgICAgIGlmKHRoaXMuXzwlPXRhTmFtZSU+X2Nvb3A9PSchPScpew0KICAgICAgICAgICAgICAgICAgICBvYmouZnVuICs9ICJOT1QgRVhJU1RTIjsNCiAgICAgICAgICAgICAgICB9ZWxzZSBpZih0aGlzLl88JT10YU5hbWUlPl9jb29wPT0nPScpew0KICAgICAgICAgICAgICAgICAgICBvYmouZnVuICs9ICJFWElTVFMiOw0KICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICBvYmouZnVuICs9IGAke3RQcmVmfSR7dGhpcy5fUSgpfSR7dGhpcy5fX2NvbmZpZygnaWRGaWVsZCcsICdJZCcpfSR7dGhpcy5fUSgpfSAke3RoaXMuXzwlPXRhTmFtZSU+X2Nvb3AgfHwgIklOIn1gOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICBvYmouZnVuICs9ICIgKCIgKyAodiB8fCBbXSkubWFwKHQgPT4gKHQgJiYgdC48JT1tTmFtZSU+KT90LjwlPW1OYW1lJT4oIjwlPW5OYW1lKHRhKSU+LmlkIik6KHQgfHwgJ05VTEwnKSkuam9pbignIFVOSU9OIEFMTC8qTTJNKi8gJykgKyAiKSI7DQogICAgICAgICAgICB9LA0KICAgIDwlIH0pJT4NCiAgICAgICAgfSwgIjwlPW1OYW1lJT4iKTsNCg0KICAgICAgICA8JT1sb2coKSU+cmV0KTsNCiAgICAgICAgcmV0dXJuIHJldDsNCiAgICB9DQoNCiAgICBhc3luYyA8JT1tTmFtZT0nX2FpcnRhYmxlJyU+KHROYW1lLCBwYXJhbXMsIGRhdGEsIG1ldGhvZCl7DQogICAgPCUgaWYobWFpbkNsYXNzKFsnQWlyVGFibGUnXSkhPWMpeyU+DQogICAgICAgIHJldHVybiBhd2FpdCBuZXcgPCU9c2NvcGUlPi48JT1uTmFtZShtYWluQ2xhc3MoWydBaXJUYWJsZSddKSklPigpLjwlPW1OYW1lJT4odE5hbWUsIHBhcmFtcywgZGF0YSwgbWV0aG9kKTsNCiAgICA8JSB9ZWxzZXslPg0KICAgICAgICB0cnl7DQogICAgICAgICAgICB0TmFtZSA9IHROYW1lIHx8IDwlPV9uQ29kZSgpJT47DQogICAgICAgICAgICBsZXQgcmV0ID0gKGF3YWl0IGF4aW9zLnJlcXVlc3Qoew0KICAgICAgICAgICAgICAgIHVybDogYCR7dGhpcy5fX2NvbmZpZygnZW5kcG9pbnRVcmwnKX0ke3ROYW1lfWAsDQogICAgICAgICAgICAgICAgbWV0aG9kOiBtZXRob2Q/bWV0aG9kOihkYXRhPyJwb3N0IjoiZ2V0IiksDQogICAgICAgICAgICAgICAgcGFyYW1zOiB7DQogICAgICAgICAgICAgICAgICAgIGZpbHRlckJ5Rm9ybXVsYTogcGFyYW1zLA0KICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgZGF0YTogZGF0YSwNCiAgICAgICAgICAgICAgICBoZWFkZXJzOiB7DQogICAgICAgICAgICAgICAgICAgICJjb250ZW50LXR5cGUiOiAiYXBwbGljYXRpb24vanNvbiIsDQogICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIH0pKS5kYXRhOw0KICAgICAgICAgICAgPCU9bG9nKCklPnJldCk7DQogICAgICAgICAgICByZXR1cm4gcmV0Ow0KICAgICAgICB9Y2F0Y2goZXgpew0KICAgICAgICAgICAgPCU9ZXJyb3IoKSU+SlNPTi5zdHJpbmdpZnkoZXgucmVzcG9uc2UuZGF0YSwgbnVsbCwgNCkpOw0KICAgICAgICB9DQogICAgPCUgfSU+DQogICAgfQ0KPCUgfSU+DQoNCjwlIGlmKG1haW5DbGFzcyhbJ0ZpbGVTeXN0ZW0nXSkpeyU+DQogICAgYXN5bmMgPCU9bU5hbWU9J19maWxlc3lzdGVtJyU+KGZpbGUsIGNvbnRlbnQsIGlkLCBvYmo9dGhpcyl7DQogICAgPCUgaWYobWFpbkNsYXNzKFsnRmlsZVN5c3RlbSddKSE9Yyl7JT4NCiAgICAgICAgcmV0dXJuIGF3YWl0IG5ldyA8JT1zY29wZSU+LjwlPV9jTmFtZShtYWluQ2xhc3MoWydGaWxlU3lzdGVtJ10pLCB0cnVlKSU+KCkuPCU9bU5hbWUlPihmaWxlLCBjb250ZW50LCBpZCwgb2JqKTsNCiAgICA8JSB9ZWxzZXslPg0KICAgICAgICB0cnl7DQogICAgICAgICAgICBpZighZmlsZSkgcmV0dXJuIG51bGw7DQoNCiAgICAgICAgICAgIGxldCByZXQgPSB7fTsNCiAgICAgICAgICAgIGxldCBwYXRoID0gb2JqLl9fY29uZmlnKGBwYXRoLiR7Y29udGVudD8nd3JpdGUnOidyZWFkJ31gLCAodHlwZW9mKGdsb2JhbCkhPT0ndW5kZWZpbmVkJz8nLi9kYi8nOidodHRwczovL3t7b3duZXJ9fS5naXRodWIuaW8vJykpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBpZihvYmouX19jb25maWcoJ2xpdmUnLCB0cnVlKSl7DQogICAgICAgICAgICAgICAgaWYodHlwZW9mKGNvbnRlbnQpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgICAgICAvLyB3cml0ZQ0KICAgICAgICAgICAgICAgICAgICBpZih0eXBlb2YoZ2xvYmFsKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IGZzLnByb21pc2VzLm1rZGlyKChwYXRoICsgZmlsZSkucmVwbGFjZSgvKC4qXC8pLiovZywgJyQxJyksIHsgcmVjdXJzaXZlOiB0cnVlIH0pOw0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0ID0gZ2xvYmFsLmZzLndyaXRlRmlsZVN5bmMocGF0aCArIGZpbGUsIHR5cGVvZihjb250ZW50KT09PSdvYmplY3QnPy8qdGhpcy5fYnRvYSgqL0pTT04uc3RyaW5naWZ5KGNvbnRlbnQsIG51bGwsICdcdCcpLyopKi86Y29udGVudCk7DQogICAgICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICAgICAgPCU9d2FybigpJT4iQ2Fubm90IHdyaXRlIHRvIGZpbGUgc3lzdGVtIik7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9ZWxzZSBpZihmYWxzZSAmJiBmaWxlLmVuZHNXaXRoKCcvJykpew0KICAgICAgICAgICAgICAgICAgICA8JT13YXJuKCklPiJzaW11bGF0ZWQgZGlyZWN0b3J5IGxpc3RpbmcuLi4uIiwgZmlsZSk7DQogICAgICAgICAgICAgICAgICAgIHJldCA9IFsiRU1TIFdlYiJdOw0KICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICAvLyByZWFkDQogICAgICAgICAgICAgICAgICAgIGlmKHBhdGguc3RhcnRzV2l0aCgnaHR0cCcpICYmIHBhdGguaW5kZXhPZignOi8vJyk+MCl7DQogICAgICAgICAgICAgICAgICAgICAgICByZXQgPSBhd2FpdCB0aGlzLl9yZXN0KHVuZGVmaW5lZCwgbnVsbCwgbnVsbCwgbnVsbCwge3VybDogJ3BhdGgucmVhZCcsIGZpbGUsIHBhdGh9KTsNCiAgICAgICAgICAgICAgICAgICAgfWVsc2UgaWYodHlwZW9mKGdsb2JhbCkhPT0ndW5kZWZpbmVkJyAmJiBnbG9iYWwuZnMuZXhpc3RzU3luYyhwYXRoICsgZmlsZSkpew0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0ID0gZ2xvYmFsLmZzLnJlYWRGaWxlU3luYyhwYXRoICsgZmlsZSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIHJldCA9IHJldD8ocmV0LmRhdGEgfHwgcmV0KTpyZXQ7DQogICAgICAgICAgICA8JT1sb2coKSU+YFske29iai5fX2NvbmZpZygnbGl2ZScsIHRydWUpPycnOidOT1QgJ31MSVZFfCR7dHlwZW9mKGNvbnRlbnQpIT09J3VuZGVmaW5lZCc/J3dyaXRlJzoncmVhZCd9XSR7cGF0aCArIGZpbGV9OiAkeyhyZXQgfHwgJycpLmxlbmd0aH1gKTsNCiAgICAgICAgICAgIHJldHVybiByZXQ7DQogICAgICAgIH1jYXRjaChleCl7DQogICAgICAgICAgICA8JT1lcnJvcigpJT5leCk7DQogICAgICAgIH0NCiAgICA8JSB9JT4NCiAgICB9DQo8JSB9JT4NCg0KPCUgaWYobWFpbkNsYXNzKF9maWxlVG9vbHMpKXslPg0KICAgIDwlPW1OYW1lPSdfZmlsZU5hbWUnJT4oX2NsYXNzPTwlPV9uQ29kZSgpJT4sIG9iaj10aGlzLCBhbGlhcz0iPCU9YWxpYXMoKSU+Iil7DQogICAgPCUgaWYobWFpbkNsYXNzKF9maWxlVG9vbHMpIT1jKXslPg0KICAgICAgICByZXR1cm4gbmV3IDwlPXNjb3BlJT4uPCU9bk5hbWUobWFpbkNsYXNzKF9maWxlVG9vbHMpLCB0cnVlKSU+KCkuPCU9bU5hbWUlPihfY2xhc3MsIG9iaiwgYWxpYXM9IjwlPWFsaWFzKCklPiIpOw0KICAgIDwlIH1lbHNleyU+DQogICAgICAgIHRyeXsNCiAgICAgICAgICAgIGxldCBvSGFzaCA9IG9iai5fdG9IYXNoKG51bGwsIHtub0NvZGU6IHRydWUsIG9ubHlVbmlxdWU6IHRydWV9LCAnPCU9bU5hbWUlPicpOw0KICAgICAgICAgICAgbGV0IGhLZXlzID0gT2JqZWN0LmtleXMob0hhc2guX3RoaXMpLmZpbHRlcihrID0+IGshPT0nT1BFUkFUT1JTJyAmJiB0eXBlb2Yob0hhc2guX3RoaXNba10pIT09J3VuZGVmaW5lZCcpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAvL2lmKCFoS2V5cy5ldmVyeShrID0+IG9IYXNoLl90aGlzLk9QRVJBVE9SU1trXT09Jz0nIHx8IHR5cGVvZihvSGFzaC5fdGhpcy5PUEVSQVRPUlNba10pPT09J3VuZGVmaW5lZCcpKSBoS2V5cyA9IFtdOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBsZXQgZk5hbWUgPSBoS2V5cy5tYXAoayA9PiBvSGFzaC5fdGhpc1trXSkuam9pbignX18nKTsNCiAgICAgICAgICAgIGlmKGZOYW1lKSBmTmFtZSs9Jy5qc29uJzsNCiAgICAgICAgICAgIGZOYW1lID0gKG9iai5fX2NvbmZpZygnc3RvcmUucm9vdCcsICc8JT1zY29wZSU+LycpICsgYCR7YWxpYXMuc3BsaXQoJy4nKS5zbGljZSgxKS5qb2luKCcvJyl9LyR7X2NsYXNzfS8ke2ZOYW1lfWApLnJlcGxhY2UoL1wvXC8vZywgJy8nKTsNCg0KICAgICAgICAgICAgPCU9bG9nKCklPm9IYXNoLl90aGlzLCBoS2V5cywgZk5hbWUpOw0KICAgICAgICAgICAgcmV0dXJuIGZOYW1lOw0KICAgICAgICB9Y2F0Y2goZXgpew0KICAgICAgICAgICAgPCU9ZXJyb3IoKSU+ZXgpOw0KICAgICAgICB9DQogICAgPCUgfSU+DQogICAgfQ0KPCUgfSU+DQoNCjwlIGlmKG1haW5DbGFzcyhbJ0dpdEh1YiddKSl7JT4NCiAgICBhc3luYyA8JT1tTmFtZT0nX2dpdGh1YiclPihmaWxlLCBjb250ZW50LCBpZCwgb2JqPXRoaXMpew0KICAgIDwlIGlmKG1haW5DbGFzcyhbJ0dpdEh1YiddKSE9Yyl7JT4NCiAgICAgICAgcmV0dXJuIGF3YWl0IG5ldyA8JT1zY29wZSU+LjwlPW5OYW1lKG1haW5DbGFzcyhbJ0dpdEh1YiddKSklPihudWxsLCB0aGlzLlRvb2wpLjwlPW1OYW1lJT4oZmlsZSwgY29udGVudCwgaWQsIG9iaik7DQogICAgPCUgfWVsc2V7JT4NCiAgICAgICAgdHJ5ew0KICAgICAgICAgICAgaWYoIWZpbGUpIHJldHVybiBudWxsOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBsZXQgc2hhMSA9IGFzeW5jIHN0ciA9PiB0eXBlb2YoY3J5cHRvLnN1YnRsZSkhPT0ndW5kZWZpbmVkJz9BcnJheS5mcm9tKG5ldyBVaW50OEFycmF5KGF3YWl0IGNyeXB0by5zdWJ0bGUuZGlnZXN0KCdTSEEtMScsIG5ldyBUZXh0RW5jb2RlcigpLmVuY29kZSgnYmxvYiAnICsgbmV3IEJsb2IoW3N0cl0pLnNpemUgKyAnXHgwMCcgKyBzdHIpKSkpLm1hcCh2ID0+IHYudG9TdHJpbmcoMTYpLnBhZFN0YXJ0KDIsICcwJykpLmpvaW4oJycpOnN0ci5zdWJzdHJpbmcoMCwgMTApOw0KICAgICAgICAgICAgDQogICAgICAgICAgICA8JT1sb2coKSU+ImZpbGUiLCBmaWxlLCBjb250ZW50PydwdXQnOidnZXQnKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgbGV0IHJldCA9IGF3YWl0IHRoaXMuX3Jlc3QodW5kZWZpbmVkLCBudWxsLCBjb250ZW50P0pTT04uc3RyaW5naWZ5KHsNCiAgICAJCQltZXNzYWdlOiAiZGVwbG95ZWQgYnkgPCU9bU5hbWUlPigpIiwNCiAgICAJCQlzaGE6IGlkIHx8IGNvbnRlbnRbdGhpcy5fX2NvbmZpZygnaWRGaWVsZCcsICdJZCcpXSwNCiAgICAJCQljb250ZW50OiB0aGlzLl9idG9hKHR5cGVvZihjb250ZW50KT09PSdvYmplY3QnP0pTT04uc3RyaW5naWZ5KGNvbnRlbnQsIG51bGwsICdcdCcpOmNvbnRlbnQpLA0KICAgIAkJfSk6bnVsbCwgY29udGVudD8ncHV0JzpudWxsLCB7DQogICAgCQkgICAgZmlsZTogKGZpbGUgKyAoKGNvbnRlbnQgfHwgZmlsZS5lbmRzV2l0aCgnLycpKT8nJzooJz9yYW5kPScrTWF0aC5yYW5kb20oKSkpKSwNCiAgICAJCX0pOw0KICAgIAkJDQogICAgCQlpZighcmV0KSByZXR1cm4gcmV0Ow0KICAgIAkJDQogICAgCQlyZXQgPSBjb250ZW50P3JldC5jb250ZW50OnJldDsNCg0KICAgICAgICAgICAgbGV0IGlkeEZpbGUgPSAnaW5kZXguaHRtJzsNCiAgICAgICAgICAgIC8vIDwlPWxvZygpJT4icmV0IiwgcmV0KTsNCiAgICAJCWlmKEFycmF5LmlzQXJyYXkocmV0KSl7DQogICAgCQkgICAgLy8gaW4gY2FzZSB3ZSBhcmUgbGlzdGluZyB0aGUgY29udGVudHMgb2YgYSBmb2xkZXIgcmVzb3VyY2UNCiAgICAJCSAgICByZXR1cm4gcmV0LmZpbHRlcihyID0+ICh0eXBlb2Yoci50eXBlKT09PSd1bmRlZmluZWQnIHx8IHIudHlwZT09J2ZpbGUnKSAmJiByLm5hbWUhPWlkeEZpbGUpLm1hcChyID0+ICh7W3RoaXMuX19jb25maWcoJ2lkRmllbGQnLCAnSWQnKV06IHIuc2hhIHx8IHJbdGhpcy5fX2NvbmZpZygnaWRGaWVsZCcsICdJZCcpXSwgbmFtZTogci5uYW1lLnJlcGxhY2UoJy5qc29uJywgJycpfSkpOw0KICAgIAkJfQ0KICAgIAkJDQogICAgCQlsZXQgX3RoaXMgPSB7fTsNCiAgICAJCWlmKHJldC5zaGEpew0KICAgIAkJICAgIHRyeXsNCiAgICAgICAgICAgICAgICAgICAgX3RoaXMgPSByZXQuY29udGVudD9KU09OLnBhcnNlKHRoaXMuX2F0b2IocmV0LmNvbnRlbnQpKTp7fTsNCiAgICAgICAgICAgICAgICB9Y2F0Y2goX2V4KXsNCiAgICAgICAgICAgICAgICAgICAgPCU9d2FybigpJT4ibm90IGEgdmFsaWQgSlNPTiBvYmplY3QiLCBmaWxlKTsNCiAgICAgICAgICAgICAgICB9DQogICAgCQkgIA0KICAgIAkJICAgIF90aGlzW29iai5fX2NvbmZpZygnaWRGaWVsZCcsICdJZCcpXSA9IHJldC5zaGE7IC8vPz8NCiAgICAJCX1lbHNlIGlmKHJldFt0aGlzLl9fY29uZmlnKCdpZEZpZWxkJywgJ0lkJyldKXsNCiAgICAJCSAgICAvLzwlPXdhcm4oKSU+J3NoYTEnLCBmaWxlLCBhd2FpdCBzaGExKEpTT04uc3RyaW5naWZ5KHJldCkpKTsNCiAgICAJCSAgICBfdGhpcyA9IHJldDsNCiAgICAJCX0NCiAgICAJCQ0KICAgIAkJPCU9bG9nKCklPmZpbGUsIGNvbnRlbnQ/J3B1dCc6J2dldCcsIF90aGlzKTsNCiAgICAJCQ0KICAgICAgICAgICAgbGV0IGZSb290ID0gZmlsZS5zcGxpdCgnLycpLnNsaWNlKDAsIC0xKS5qb2luKCcvJyk7DQogICAgICAgICAgICBpZihmaWxlLmluZGV4T2YoaWR4RmlsZSk+PTApIHJldHVybiByZXQ7DQogICAgICAgICAgICBpZHhGaWxlID0gZlJvb3QgKyAnLycgKyBpZHhGaWxlOw0KICAgIAkJDQogICAgCQlpZigvKiFvYmouX19zeW5jX29uKCkgJiYgKi9jb250ZW50KXsNCiAgICAJCSAgICAvLyBuZXcgY29udGVudCBzdG9yZWQNCiAgICAJCSAgICBsZXQgaWR4UmV0ID0gYXdhaXQgb2JqLjwlPW1OYW1lJT4oaWR4RmlsZSk7DQogICAgCQkgICAgPCU9bG9nKCklPiJmaWxlIGNvbnRlbnQiLCBmaWxlLCBpZHhGaWxlLCByZXQsIGlkeFJldCk7DQogICAgCQkgICAgYXdhaXQgb2JqLjwlPW1OYW1lJT4oaWR4RmlsZSwgYXdhaXQgb2JqLjwlPW1OYW1lJT4oZlJvb3QpLCBpZHhSZXQ/aWR4UmV0LnNoYTpudWxsKTsNCiAgICAJCX0NCiAgICAJCQ0KICAgICAgICAgICAgcmV0dXJuIF90aGlzOw0KICAgICAgICB9Y2F0Y2goZXgpew0KICAgICAgICAgICAgPCU9ZXJyb3IoKSU+ZXgpOw0KICAgICAgICB9DQogICAgPCUgfSU+DQogICAgfQ0KPCUgfSU+DQoNCjwlIGlmKG1haW5DbGFzcyhbJ1NhbGVzRm9yY2UnXSkpeyU+DQogICAgPCU9bU5hbWU9J190b1NGUXVlcnknJT4oZmllbGRzLCBvYmpzLCBiU3RyaW5nKXsNCiAgICAgICAgbGV0IHJldCA9IHRoaXMuX19leHBvcnQoe1s8JT1fbkNvZGUoKSU+XToge3BhcmFtczoge3doZXJlOiB7YW5kOiBbXSwgb3I6IFtdfX0sIGVkZ2VzOiB7bm9kZToge319fX0sIHsNCiAgICAgICAgICAgIC8vT1BFUkFUT1JTOiB0cnVlLA0KICAgICAgICAgICAgSWQ6IChvYmosIGVhQ29kZSwgdikgPT4gb2JqWzwlPV9uQ29kZSgpJT5dLnBhcmFtcy53aGVyZS5hbmQucHVzaCh7SWQ6IHtlcTogdn19KSwNCiAgICA8JSBjLkVudGl0eUF0dHJpYnV0ZXMuZmlsdGVyKGVhID0+ICFlYS5FbnRpdHlNZXRob2QpLmZvckVhY2goZWEgPT4geyAlPg0KICAgICAgICAgICAgPCU9bk5hbWUoZWEpJT46IChvYmosIGVhQ29kZSwgdikgPT4gew0KICAgICAgICAgICAgICAgIGxldCBvcCA9ICdlcSc7DQogICAgICAgICAgICAgICAgbGV0IGNvbmQgPSB7W2VhQ29kZV06IHtbb3BdOiANCiAgICAgICAgPCUgaWYoZWEuRW50aXR5VHlwZSl7JT4NCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgaW5xOiB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgQXBpTmFtZTogJ0lkJywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBbPCU9X25Db2RlKGVhLkVudGl0eVR5cGUpJT5dOiB2P3YuPCU9bU5hbWUlPigpWzwlPV9uQ29kZShlYS5FbnRpdHlUeXBlKSU+XS5wYXJhbXMud2hlcmUuYW5kOltdLA0KICAgICAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICA8JSB9ZWxzZSBpZihlYS5Jc0RhdGUpeyU+DQogICAgICAgICAgICAgICAgICAgICh2P3YudG9JU09TdHJpbmcoKTpudWxsKQ0KICAgICAgICA8JSB9ZWxzZXslPg0KICAgICAgICAgICAgICAgICAgICB2DQogICAgICAgIDwlIH0lPg0KICAgICAgICAgICAgICAgIH19Ow0KICAgICAgICAgICAgICAgIG9ials8JT1fbkNvZGUoKSU+XS5wYXJhbXMud2hlcmUuYW5kLnB1c2goY29uZCk7DQogICAgICAgICAgICB9LA0KICAgIDwlIH0pOyAlPg0KICAgICAgICB9LCAiPCU9bU5hbWUlPiIpOw0KICAgICAgICANCiAgICAgICAgLy9PYmplY3Qua2V5cyhyZXQpLmZpbHRlcihrID0+ICFTdHJpbmcocmV0W2tdKS5sZW5ndGgpLmZvckVhY2goayA9PiBkZWxldGUgcmV0W2tdKTsNCiAgICAgICAgDQogICAgICAgIGlmKGJTdHJpbmcpew0KICAgICAgICAgICAgcmV0ID0ge3F1ZXJ5OiB7WzwlPV9uQ29kZSgpJT4gKyAnUXVlcnknXToge3VpYXBpOiB7cXVlcnk6IHJldH19fX07DQogICAgICAgICAgICByZXQgPSBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpOw0KICAgICAgICB9DQoNCiAgICAgICAgPCU9bG9nKCklPnJldCk7DQogICAgICAgIHJldHVybiByZXQ7DQogICAgfQ0KPCUgfSU+DQoNCjwlIGlmKG1haW5DbGFzcyhbJ1NlcnZpY2VOb3cnXSkpeyU+DQogICAgPCUNCiAgICBsZXQgX2lkID0gcyA9PiAvKnM/czoqL2B0aGlzLl91dWlkKCR7c3x8dW5kZWZpbmVkfSkucmVwbGFjZSgvLS9nLCAnJylgOw0KICAgIGxldCBfdGlkID0gX2MgPT4gX2lkKCInIitzY29wZSsiLiIrIChfYyB8fCBjKS5OYW1lICsgIiciKTsNCiAgICBsZXQgYXBwID0gKCkgPT4geyU+YXBwbGljYXRpb24obmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKCdBcHBsaWNhdGlvbicsIHRydWUpJT4oKS5jb2RlKHRoaXMuX19jb25maWcoJ3Njb3BlJywgJzwlPXNjb3BlJT4nKSkpPCV9Ow0KICAgIA0KICAgIGxldCBsYWJlbCA9ICh0LCBuLCBjLCBwKSA9PiB7bj1zci5FbmdsaXNoTmFtZShuKTsgJT4uPCU9dCU+X0ZpZWxkX0xhYmVscyhbbmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKCdGaWVsZCBMYWJlbCcsIHRydWUpJT4oPCU9X2lkKCklPikucmVtYXJrKCc8JT1uJT4nKS5uYW1lKCc8JT1uJT4nKS5jb2RlKDwlPWMlPikubGFuZ3VhZ2UoJ2VuJykucGx1cmFsKCc8JT0ocCB8fCAobiArICdzJykpJT4nKS48JWFwcCgpJT5dKTwlfTslPg0KDQogICAgPCU9bU5hbWU9J190b1NOVGFibGUnJT4oKXsNCiAgICAgICAgLy90aGlzLl9kZWZhdWx0cygpOw0KDQogICAgICAgIHRyeXsNCiAgICA8JSBpZihfY05hbWUoJ0FwcGxpY2F0aW9uJykpeyU+DQogICAgICAgICAgICBsZXQgcmV0ID0gdGhpcy5fX2V4cG9ydChuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUoJ1RhYmxlJywgdHJ1ZSklPig8JT1fdGlkKCklPikuY29kZSg8JT1fbkNvZGUoKSU+KS48JWFwcCgpJT4ubmFtZSgnPCU9Yy5OYW1lJT4nKS5yZW1hcmsoYDwlPWMuUmVtYXJrJT5gKS5hY3RpdmUodHJ1ZSkuZW5hYmxlZCh0cnVlKSwgew0KICAgICAgICAgICAgICAgIEZ1bGw6IHRydWUsDQogICAgICAgICAgICAgICAgTnVsbDogdHJ1ZSwNCiAgICAgICAgPCUgYy5FbnRpdHlBdHRyaWJ1dGVzLmZpbHRlcihlYSA9PiAhZWEuRW50aXR5TWV0aG9kKS5mb3JFYWNoKGVhID0+IHsgJT4NCiAgICAgICAgICAgICAgICA8JT1uTmFtZShlYSklPjogKG9iaiwgZWFDb2RlLCB2KSA9PiBvYmoudGFibGVfQ29sdW1ucyhuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUoJ0NvbHVtbicsIHRydWUpJT4oPCU9X2lkKCInIitzY29wZSsiLiIrYy5OYW1lKyInK2VhQ29kZSIpJT4pLmFjdGl2ZSh0cnVlKS5lbmFibGVkKHRydWUpLm5hbWUoIjwlPXNyLkVuZ2xpc2hOYW1lKGVhLk5hbWUpJT4iKS5jb2RlKGVhQ29kZSkudHlwZSgnPCU9X0ZyRU1ELl9hdHRyKGVhKSU+JykucmVmZXJlbmNlKDwlaWYoZWEuRW50aXR5VHlwZSl7JT4odiB8fCBuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUoZWEuRW50aXR5VHlwZSwgdHJ1ZSklPigpKS48JT1tTmFtZSU+KCk8JX1lbHNleyU+bnVsbDwlfSU+KS8qPCVsYWJlbCgnY29sdW1uJywgZWEuTmFtZSwgJ2VhQ29kZScsIGVhLlBsdXJhbCklPiovKSwNCiAgICAgICAgPCUgfSklPg0KICAgICAgICA8JSBjLlR5cGVkQXR0cmlidXRlcy5maWx0ZXIodGEgPT4gIXRhLkVudGl0eU1ldGhvZCkuZm9yRWFjaCh0YSA9PiB7bGV0IHRhTmFtZSA9IG5OYW1lKHRhKSArICdfJyArIHRhLkVudGl0eUNsYXNzLlBsdXJhbC5yZXBsYWNlKC8gL2csICdfJyk7JT4NCiAgICAgICAgICAgICAgICA8JT10YU5hbWUlPjogKG9iaiwgZWFDb2RlLCB2KSA9PiBvYmoucmVmZXJlbmNlX0NvbHVtbnMobmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKCdDb2x1bW4nLCB0cnVlKSU+KCkuYWN0aXZlKGZhbHNlKS5lbmFibGVkKHRydWUpLmNvZGUoZWFDb2RlKS50eXBlKCdMaXN0JykubmFtZSgiPCU9bk5hbWUodGEpJT4gPCU9dGEuRW50aXR5Q2xhc3MuUGx1cmFsJT4iKS5yZWZlcmVuY2UobmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKHRhLkVudGl0eUNsYXNzLCB0cnVlKSU+KCkuPCU9bU5hbWUlPigpKS8qPCVsYWJlbCgnY29sdW1uJywgdGEuTmFtZSsnICcrdGEuRW50aXR5Q2xhc3MuUGx1cmFsLCAnZWFDb2RlJywgdGEuRW50aXR5Q2xhc3MuUGx1cmFsKSU+Ki8pLA0KICAgICAgICA8JSB9KSU+DQogICAgICAgICAgICB9LCAiPCU9bU5hbWUlPiIpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICByZXR1cm4gcmV0Ow0KICAgIDwlIH1lbHNleyU+DQogICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICA8JSB9JT4NCiAgICAgICAgfWNhdGNoKGV4KXsNCiAgICAgICAgICAgIDwlPWVycm9yKCklPmV4KTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICANCiAgICA8JT1tTmFtZT0nX3RvU05GbG93JyU+KGJEcmFmdCwgYkhlYWRlcil7DQogICAgICAgIHRyeXsNCiAgICA8JSBpZihfY05hbWUoJ0FwcGxpY2F0aW9uJykpeyU+DQogICAgICAgIDwlIGxldCBiT3JkZXIgPSAxOyBsZXQgX2ZpZCA9IF9jID0+IF9pZCgiJyIrc2NvcGUrIi4nICsgKGJEcmFmdD8nZCc6J3MnKSArICdsIisgKF9jIHx8IGMpLk5hbWUgKyAiJyIpOw0KICAgICAgICBsZXQgbG9naWMgPSAobiwgdCwgbWFwPVtdKSA9PiB7JT4NCiAgICAgICAgICAgIG5ldyA8JT1zY29wZSU+LjwlPV9jTmFtZSgnRmxvdyBMb2dpYycsIHRydWUpJT4oPCU9X2lkKCklPikub3JkZXIoPCU9Yk9yZGVyKyslPikuY29kZSh0aGlzLl91dWlkKCkpLm5hbWUoJzwlPW4lPicpLnJlbWFyaygnPCU9biU+JykNCiAgICAgICAgICAgICAgICAuYmxvY2sobmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKCdGbG93IEJsb2NrJywgdHJ1ZSklPig8JT1faWQoKSU+KS5jb2RlKDwlPV9pZCgpJT4pLm5hbWUoJzwlPW4lPicpDQogICAgICAgICAgICAgICAgICAgIC5ibG9ja19FbGVtZW50X01hcHBpbmdzKFs8JSBtYXAuZmlsdGVyKG0gPT4gbSkuZm9yRWFjaChtID0+IHslPg0KICAgICAgICAgICAgICAgICAgICAgICAgbmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKCdFbGVtZW50IE1hcHBpbmcnLCB0cnVlKSU+KDwlPV9pZCgpJT4pLm5hbWUoIjwlPW4lPiAtICIgKyA8JT1tLmNkJT4pLmNvZGUoPCU9bS5jZCU+KS52YWx1ZSg8JT1tLnYlPik8JXBDb21wb3VuZChtLnYsIG0udHJuKSU+LA0KICAgICAgICAgICAgICAgICAgICA8JX0pJT5dKQ0KICAgICAgICAgICAgICAgICkuZGVmaW5pdGlvbihuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUoJ0xvZ2ljIERlZmluaXRpb24nLCB0cnVlKSU+KCc8JT10JT4gPCU9biU+JykuY29kZSgnPCU9dCU+JykubmFtZSgnPCU9dCU+JykpLjwlYXBwKCklPg0KICAgICAgICA8JX0NCiAgICAgICAgbGV0IGFjdGlvbiA9IChhQ29kZSwgcGFyYW1zPXt9KSA9PiB7ICU+DQogICAgICAgICAgICBuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUoJ0FjdGlvbiBJbnN0YW5jZScsIHRydWUpJT4oPCU9X2lkKCklPikuY29kZSh0aGlzLl91dWlkKCkpLmFjdGlvbihuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUoJ0FjdGlvbiBUeXBlJywgdHJ1ZSklPig8JT1faWQoKSU+KS5jb2RlKCc8JT1hQ29kZSU+JykpLm9yZGVyKDwlPWJPcmRlcisrJT4pLjwlYXBwKCklPg0KICAgICAgICAgICAgLmFjdGlvbl9WYXJpYWJsZV9WYWx1ZXMoWw0KICAgICAgICAgICAgPCUgT2JqZWN0LmtleXMocGFyYW1zKS5mb3JFYWNoKHAgPT4geyU+DQogICAgICAgICAgICAgICAgbmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKCdWYXJpYWJsZSBWYWx1ZScsIHRydWUpJT4oKS5jb2RlKCc8JT1wJT4nKS52YWx1ZSg8JT1wYXJhbXNbcF0lPikuYWN0aW9uSW5wdXQoDQogICAgICAgICAgICAgICAgICAgIG5ldyA8JT1zY29wZSU+LjwlPV9jTmFtZSgnQWN0aW9uIElucHV0JywgdHJ1ZSklPigpLmNvZGUoJzwlPXAlPicpDQogICAgICAgICAgICAgICAgKS5tYXBwaW5nKG5ldyA8JT1zY29wZSU+LjwlPV9jTmFtZSgnRWxlbWVudCBNYXBwaW5nJywgdHJ1ZSklPigpLmNvZGUoJzwlPXAlPicpLnZhbHVlKCIiKSksDQogICAgICAgICAgICA8JSB9KSU+DQogICAgICAgICAgICBdKQ0KICAgICAgICA8JX0NCiAgICAgICAgbGV0IHN1YmZsb3cgPSAoZmxvdywgcGFyYW1zPXt9LCBiTm9XYWl0KSA9PiB7ICU+DQogICAgICAgICAgICBuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUoJ0Zsb3cgSW5zdGFuY2UnLCB0cnVlKSU+KDwlPV9pZCgpJT4pLmNvZGUodGhpcy5fdXVpZCgpKS5zdWJmbG93KDwlPWZsb3clPikub3JkZXIoPCU9Yk9yZGVyKyslPikuPCVhcHAoKSU+DQogICAgICAgICAgICA8JSBpZighYk5vV2FpdCl7JT4NCiAgICAgICAgICAgIC5pbnN0YW5jZV9GbG93X0luc3RhbmNlX0lucHV0cyhbbmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKCdGbG93IEluc3RhbmNlIElucHV0JywgdHJ1ZSklPig8JT1faWQoKSU+KS5jb2RlKCd3YWl0X2Zvcl9jb21wbGV0aW9uJykubmFtZSgnV2FpdCBmb3IgQ29tcGxldGlvbicpLnR5cGUoJ0Jvb2wnKV0pDQogICAgICAgICAgICAuaW5zdGFuY2VfVmFyaWFibGVfVmFsdWVzKFsNCiAgICAgICAgICAgICAgICAgICAgbmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKCdWYXJpYWJsZSBWYWx1ZScsIHRydWUpJT4oKS5jb2RlKCd3YWl0X2Zvcl9jb21wbGV0aW9uJykudmFsdWUoJzEnKQ0KICAgICAgICAgICAgICAgICAgICAubWFwcGluZyhuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUoJ0VsZW1lbnQgTWFwcGluZycsIHRydWUpJT4oKS5jb2RlKCd3YWl0X2Zvcl9jb21wbGV0aW9uJykpDQogICAgICAgICAgICBdKQ0KICAgICAgICAgICAgPCV9JT4NCiAgICAgICAgICAgIC5pbnN0YW5jZV9WYXJpYWJsZV9WYWx1ZXMoWw0KICAgICAgICAgICAgPCUgT2JqZWN0LmtleXMocGFyYW1zKS5mb3JFYWNoKHAgPT4geyU+DQogICAgICAgICAgICAgICAgbmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKCdWYXJpYWJsZSBWYWx1ZScsIHRydWUpJT4oKS5jb2RlKCc8JT1wJT4nKS52YWx1ZSg8JT1wYXJhbXNbcF0lPikuZmxvd0lucHV0KA0KICAgICAgICAgICAgICAgICAgICBuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUoJ0Zsb3cgSW5wdXQnLCB0cnVlKSU+KCkuY29kZSgnPCU9cCU+JykNCiAgICAgICAgICAgICAgICApLm1hcHBpbmcobmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKCdFbGVtZW50IE1hcHBpbmcnLCB0cnVlKSU+KCkuY29kZSgnPCU9cCU+JykudmFsdWUoPCU9cGFyYW1zW3BdJT4pKQ0KICAgICAgICAgICAgPCUgfSklPg0KICAgICAgICAgICAgXSkNCiAgICAgICAgPCV9DQogICAgICAgIGxldCBwQ29tcG91bmQgPSAodiwgdHJuKSA9PiB7aWYoIXRybikgcmV0dXJuOyAlPi5lbGVtZW50TWFwcGluZ19QaWxsX0NvbXBvdW5kcyhbbmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKCdQaWxsIENvbXBvdW5kJywgdHJ1ZSklPih0aGlzLl91dWlkKCkpLmNvZGUoJycpLm5hbWUoPCU9diU+KS5vcmRlcigwKS8qLnJlbWFyayh0aGlzLl9idG9hKGA8JT1KU09OLnN0cmluZ2lmeShbXSklPmApKSovLjwlYXBwKCklPg0KICAgICAgICAgICAgLnBhcmVudF9QaWxsX0NvbXBvdW5kcyhbDQogICAgICAgICAgICA8JSBPYmplY3Qua2V5cyh0cm4pLmZvckVhY2goKHQsIGkpID0+IHslPiBuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUoJ1BpbGwgQ29tcG91bmQnLCB0cnVlKSU+KHRoaXMuX3V1aWQoKSkuY29kZSgiPCU9dCU+Iikub3JkZXIoPCU9aSsxJT4pLm5hbWUoPCU9diU+KS5yZW1hcmsodGhpcy5fYnRvYShgPCU9SlNPTi5zdHJpbmdpZnkodHJuW3RdKSU+YCkpLjwlYXBwKCklPi8qLnRyYW5zZm9ybShuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUoJ1RyYW5zZm9ybScsIHRydWUpJT4oPCU9X2lkKCklPikuY29kZSgnPCU9dCU+JykudHJhbnNmb3JtX1RyYW5zZm9ybV9Db21wb3NpdGlvbnMoW25ldyA8JT1zY29wZSU+LjwlPV9jTmFtZSgnVHJhbnNmb3JtIENvbXBvc2l0aW9uJywgdHJ1ZSklPigpLmNvZGUoJycpXSkpKi8sDQogICAgICAgICAgICA8JSB9KSU+DQogICAgICAgICAgICBdKV0pDQogICAgICAgIDwlIH0lPg0KICAgICAgICAgICAgDQogICAgICAgICAgICANCiAgICAgICAgICAgIC8qDQogICAgICAgICAgICAgKiBPT0IgRW5kcG9pbnQ6IGh0dHBzOi8vZGV2MTYyNTcwLnNlcnZpY2Utbm93LmNvbS9hcGkvbm93L3Byb2Nlc3NmbG93L2Zsb3dvYmplY3Qvc3RhcnQvc3ViZmxvdw0KICAgICAgICAgICAgICogUGF5bG9hZDogeyJuYW1lIjoieF83ODYxMV9zY2hvb2xfbWFuLlVzZXJfbG9va3VwIiwiaW5wdXRzIjp7Impzb24iOnsibmFtZSI6InRlc3QiLCJnZW5kZXIiOnsiY29kZSI6Ik0iLCAiT1BFUkFUT1JTIjogeyJjb2RlIjogIiE9In19LCJ1c2VyX1N0dWRlbnRzIjpbeyJuYW1lIjoiU1RBIiwiZ2VuZGVyIjp7ImNvZGUiOiJNIn19XX19fQ0KICAgICAgICAgICAgKi8NCg0KICAgICAgICAgICAgbGV0IGZsb3cgPSBuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUoJ0Zsb3cnLCB0cnVlKSU+KDwlPV9maWQoKSU+KS5uYW1lKCc8JT1jLk5hbWUlPiBMb29rdXAnKS5jb2RlKDwlPV9uQ29kZSgpJT4gKyAnX2xvb2t1cCcpLjwlYXBwKCklPi5hY3RpdmUodHJ1ZSkuZW5hYmxlZCh0cnVlKTsNCiAgICAgICAgICAgIGlmKGJIZWFkZXIpIHJldHVybiBmbG93Ow0KICAgICAgICAgICAgDQogICAgICAgICAgICByZXR1cm4gdGhpcy5fX2V4cG9ydChmbG93LyouX2RlZmF1bHRzKCkqLw0KICAgICAgICAgICAgICAgIC5mbG93X0Zsb3dfU2V0dGluZ3MoW25ldyA8JT1zY29wZSU+LjwlPV9jTmFtZSgnRmxvdyBTZXR0aW5nJywgdHJ1ZSklPig8JT1faWQoKSU+KS5jb2RlKCdBQ1RJT04nKV0pDQogICAgICAgICAgICAgICAgLmZsb3dfRmxvd19JbnB1dHMoWw0KICAgICAgICAgICAgICAgICAgICBuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUoJ0Zsb3cgSW5wdXQnLCB0cnVlKSU+KDwlPV9pZCgpJT4pLmFjdGl2ZSh0cnVlKS5jb2RlKCdqc29uJykubmFtZSgnSlNPTicpLnR5cGUoJ0pTT04nKTwlbGFiZWwoJ2lucHV0JywgJ0pTT04nLCAiJ2pzb24nIiklPg0KICAgICAgICAgICAgICAgIF0pLmZsb3dfRmxvd19PdXRwdXRzKFsNCiAgICAgICAgICAgICAgICAgICAgbmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKCdGbG93IE91dHB1dCcsIHRydWUpJT4oPCU9X2lkKCklPikuYWN0aXZlKHRydWUpLmNvZGUoPCU9X25Db2RlKCklPiArICdfbGlzdCcpLm5hbWUoJzwlPW5OYW1lKGMpJT4gTGlzdCcpLnR5cGUoJ0xpc3QnKS5yZWZlcmVuY2UobmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKCdUYWJsZScsIHRydWUpJT4oIjwlPW5OYW1lKGMpJT4iKS5uYW1lKCc8JT1jLk5hbWUlPicpLmNvZGUoPCU9X25Db2RlKCklPikuPCVhcHAoKSU+KQ0KICAgICAgICAgICAgICAgICAgICA8JWxhYmVsKCdvdXRwdXQnLCBjLk5hbWUgKyAnIExpc3QnLCBfbkNvZGUoKSArICIrICdfbGlzdCciKSU+DQogICAgICAgICAgICAgICAgXSkuZmxvd19GbG93X1ZhcmlhYmxlcyhbDQogICAgICAgICAgICAgICAgICAgIG5ldyA8JT1zY29wZSU+LjwlPV9jTmFtZSgnRmxvdyBWYXJpYWJsZScsIHRydWUpJT4oPCU9X2lkKCklPikuYWN0aXZlKHRydWUpLmNvZGUoJ2pzb24nKS5uYW1lKCdKU09OJykudHlwZSgnSlNPTicpPCVsYWJlbCgndmFyaWFibGUnLCAnSlNPTicsICcianNvbiInKSU+LA0KICAgICAgICAgICAgICAgICAgICBuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUoJ0Zsb3cgVmFyaWFibGUnLCB0cnVlKSU+KDwlPV9pZCgpJT4pLmFjdGl2ZSh0cnVlKS5jb2RlKCdlcXVlcnknKS5uYW1lKCdFUXVlcnknKS50eXBlKCdTdHJpbmcnKTwlbGFiZWwoJ3ZhcmlhYmxlJywgJ0VRdWVyeScsICciZXF1ZXJ5IicpJT4sDQogICAgICAgICAgICAgICAgXSkuZmxvd19GbG93X0xvZ2ljcyhbDQogICAgICAgICAgICAgICAgICAgIDwlbG9naWMoJ1NldCAnICsgYy5OYW1lICsgJyBKU09OJywgJ1NldCBGbG93IFZhcmlhYmxlcycsIFt7Y2Q6ICInanNvbiciLCB2OiAiJ3t7c3ViZmxvdy5qc29ufX0nIn1dKSU+LA0KICAgICAgICAgICAgICAgICAgICA8JSAvLyAsIHRybjoge3JlcGxhY2Vfc3RyaW5nOiB7cmVnZXg6ICIvL2ciLCByZXBsYWNlX3N0cmluZzogIiJ9fSU+DQogICAgICAgICAgICAgICAgXSkuc2VjdXJpdHlDb250cm9sKG5ldyA8JT1zY29wZSU+LjwlPV9jTmFtZSgnU2VjdXJpdHkgQ29udHJvbCcsIHRydWUpJT4oPCU9X2lkKCklPikuY29kZSgnc3lzX2h1Yl9mbG93JykubmFtZShgc3lzX3Njb3BlLnNjb3BlPSR7dGhpcy5fX2NvbmZpZygnc2NvcGUnLCAnPCU9c2NvcGUlPicpfWApLnR5cGUobmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKCdTZWN1cml0eSBUeXBlJywgdHJ1ZSklPigpLmNvZGUoJ2NsaWVudF9jYWxsYWJsZV9mbG93X29iamVjdCcpKS5vcGVyYXRpb24obmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKCdTZWN1cml0eSBPcGVyYXRpb24nLCB0cnVlKSU+KCkuY29kZSgnZXhlY3V0ZScpKS48JWFwcCgpJT4pLCB7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgLy9leHBvcnRlcjogdiA9PiB2Lm9iaiA9IHYucmV1c2VkP25ldyA8JT1zY29wZSU+LjwlPV9jTmFtZSgnRmxvdycsIHRydWUpJT4odi5vYmouSWQpOnYub2JqLCAvKmluZm9ybWF0aW9uIGxvc3MqLw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIE51bGw6ICFiSGVhZGVyLA0KICAgICAgICAgICAgICAgIEZ1bGw6IHRydWUsDQogICAgICAgICAgICAgICAgDQogICAgICAgIDwlIGMuRW50aXR5QXR0cmlidXRlcy5maWx0ZXIoZWEgPT4gIWVhLkVudGl0eU1ldGhvZCkuZm9yRWFjaChlYSA9PiB7ICU+DQogICAgICAgICAgICAgICAgPCU9bk5hbWUoZWEpJT46IChvYmosIGVhQ29kZSwgdikgPT4gb2JqPCVpZigwIHx8IChbJ25hbWUnLCAncmVtYXJrJywgJ2RhdGUnLCAnb3JkZXInLCAnYWN0aXZlJywgJ2VuYWJsZWQnXS5pbmRleE9mKGVhLk5hbWUpPDApKXslPi5mbG93X0Zsb3dfVmFyaWFibGVzKFsNCiAgICAgICAgICAgICAgICAgICAgbmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKCdGbG93IFZhcmlhYmxlJywgdHJ1ZSklPig8JT1faWQoKSU+KS5jb2RlKGVhQ29kZSkubmFtZSgnPCU9c3IuRW5nbGlzaE5hbWUoZWEuTmFtZSklPicpLnR5cGUoPCUgaWYoZWEuRW50aXR5VHlwZSl7JT4nSlNPTic8JSB9ZWxzZXslPic8JT1fRnJFTUQuX2F0dHIoZWEpJT4nPCV9JT4pPCVsYWJlbCgndmFyaWFibGUnLCBlYS5OYW1lLCAiZWFDb2RlIiklPiwNCiAgICAgICAgICAgICAgICAgICAgbmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKCdGbG93IFZhcmlhYmxlJywgdHJ1ZSklPig8JT1faWQoKSU+KS5uYW1lKCc8JT1uTmFtZShjKSU+LjwlPWVhLk5hbWUlPi5TZXQnKS5jb2RlKGVhQ29kZSArICdfc2V0JykubmFtZSgnPCU9c3IuRW5nbGlzaE5hbWUoZWEuTmFtZSklPiBTZXQnKS50eXBlKCdCb29sJyk8JWxhYmVsKCd2YXJpYWJsZScsIGVhLk5hbWUgKyAnIFNldCcsICJlYUNvZGUgKyAnX3NldCciKSU+LA0KICAgICAgICAgICAgICAgICAgICBuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUoJ0Zsb3cgVmFyaWFibGUnLCB0cnVlKSU+KDwlPV9pZCgpJT4pLmNvZGUoZWFDb2RlICsgJ19vcCcpLm5hbWUoJzwlPXNyLkVuZ2xpc2hOYW1lKGVhLk5hbWUpJT4gT3BlcmF0b3InKS50eXBlKCdTdHJpbmcnKTwlbGFiZWwoJ3ZhcmlhYmxlJywgZWEuTmFtZSArICcgT3BlcmF0b3InLCAiZWFDb2RlICsgJ19vcCciKSU+LA0KICAgICAgICAgICAgICAgICAgICBdKS5mbG93X0Zsb3dfTG9naWNzKFsNCiAgICAgICAgICAgICAgICAgICAgPCVsb2dpYygnU2V0ICcrZWEuTmFtZSwgJ1NldCBGbG93IFZhcmlhYmxlcycsIFsNCiAgICAgICAgICAgICAgICAgICAgICAgIGVhLkVudGl0eVR5cGU/bnVsbDp7Y2Q6ICJlYUNvZGUiLCB2OiAiJ3t7Zmxvd192YXJpYWJsZS5qc29ufX0nIiwgdHJuOiBPYmplY3QuYXNzaWduKHt9LCB7dmFsdWVfbWFwOiB7a2V5OiAiJHtlYUNvZGV9IiwgZGVmYXVsdDogIiJ9fSwgZWEuX0lzRGF0ZT97c3RyaW5nX3RvX2RhdGU6IHtkYXRlX2Zvcm1hdDogInl5eXktTU0tZGRcJ1RcJ0hIOm1tOnNzXCdaXCciLCBjdXN0b21fZm9ybWF0OiAiIn19Ont9KX0sDQogICAgICAgICAgICAgICAgICAgICAgICAvL3tjZDogImVhQ29kZSsnX3NldCciLCB2OiAiJ3t7Zmxvd192YXJpYWJsZS4nK2VhQ29kZSsnfX19JyIsIHRybjoge2lzX251bGw6IHt9fX0sDQogICAgICAgICAgICAgICAgICAgICAgICAvL3tjZDogImVhQ29kZSsnX29wJyIsIHY6ICIne3tmbG93X3ZhcmlhYmxlLm9wZXJhdG9yc319JyIsIHRybjoge3ZhbHVlX21hcDoge2tleTogIiR7ZWFDb2RlfSJ9fX0sDQogICAgICAgICAgICAgICAgICAgIF0pJT4ubG9naWNfRmxvd19JbnB1dF9TY3JpcHRzKFsNCiAgICAgICAgICAgICAgICAgICAgICAgIDwlaWYoZWEuRW50aXR5VHlwZSl7JT5uZXcgPCU9c2NvcGUlPi48JT1fY05hbWUoJ0Zsb3cgSW5wdXQgU2NyaXB0JywgdHJ1ZSklPig8JT1faWQoKSU+KS5uYW1lKCdTZXQgPCU9ZWEuTmFtZSU+JykuYWN0aXZlKHRydWUpLmNvZGUoZWFDb2RlKS5yZW1hcmsoYHJldHVybiBmZF9kYXRhLmZsb3dfdmFyLmpzb24uJHtlYUNvZGV9O2ApLDwlfSU+DQogICAgICAgICAgICAgICAgICAgICAgICBuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUoJ0Zsb3cgSW5wdXQgU2NyaXB0JywgdHJ1ZSklPig8JT1faWQoKSU+KS5uYW1lKCdTZXQgPCU9ZWEuTmFtZSU+IFNldCcpLmFjdGl2ZSh0cnVlKS5jb2RlKGVhQ29kZSArICdfc2V0JykucmVtYXJrKGByZXR1cm4gdHlwZW9mKGZkX2RhdGEuZmxvd192YXIuanNvbi4ke2VhQ29kZX0pIVx1MDAzZFx1MDAzZFx1MDAyN3VuZGVmaW5lZFx1MDAyNztgKSwNCiAgICAgICAgICAgICAgICAgICAgICAgIG5ldyA8JT1zY29wZSU+LjwlPV9jTmFtZSgnRmxvdyBJbnB1dCBTY3JpcHQnLCB0cnVlKSU+KDwlPV9pZCgpJT4pLm5hbWUoJ1NldCA8JT1lYS5OYW1lJT4gT3BlcmF0b3InKS5hY3RpdmUodHJ1ZSkuY29kZShlYUNvZGUgKyAnX29wJykucmVtYXJrKGByZXR1cm4gKGZkX2RhdGEuZmxvd192YXIuanNvbi5PUEVSQVRPUlMgfHwge30pLiR7ZWFDb2RlfTtgKSwNCiAgICAgICAgICAgICAgICAgICAgXSksDQoNCiAgICAgICAgICAgICAgICAgICAgPCVsb2dpYygnSWYgJyArIGMuTmFtZSArICcgJytlYS5OYW1lKycgU2V0JywgJ0lmJywgW3tjZDogIidjb25kaXRpb24nIiwgdjogIid7e2Zsb3dfdmFyaWFibGUuJyArIGVhQ29kZSArICdfc2V0fX09dHJ1ZScifV0pJT4NCiAgICAgICAgICAgICAgICAgICAgPCVpZihlYS5FbnRpdHlUeXBlKXslPi5wYXJlbnRfRmxvd19JbnN0YW5jZXMoPCVzdWJmbG93KCduZXcgJytzY29wZSsnLicrX2NOYW1lKGVhLkVudGl0eVR5cGUsIHRydWUpKycoKS4nK21OYW1lKycoZmFsc2UsIHRydWUpJywge2pzb246ICIne3tmbG93X3ZhcmlhYmxlLicrZWFDb2RlKyd9fScifSklPik8JX0lPg0KICAgICAgICAgICAgICAgICAgICAucGFyZW50X0Zsb3dfTG9naWNzKFsNCiAgICAgICAgICAgICAgICAgICAgICAgIDwlbG9naWMoJ0FkZCAnK2VhLk5hbWUrJyB0byAnICsgYy5OYW1lICsgJyBFUXVlcnknLCAnU2V0IEZsb3cgVmFyaWFibGVzJywgW3tjZDogIidlcXVlcnknIiwgdjogIid7e2Zsb3dfdmFyaWFibGUuZXF1ZXJ5fX1eJytlYUNvZGUifV0pJT4sDQogICAgICAgICAgICAgICAgICAgICAgICA8JWxvZ2ljKCdJZiAnICsgYy5OYW1lICsgJyAnK2VhLk5hbWUrJyBPcGVyYXRvciBpcyBub3QgZW1wdHknLCAnSWYnLCBbe2NkOiAiJ2NvbmRpdGlvbiciLCB2OiAiJ3t7Zmxvd192YXJpYWJsZS4nK2VhQ29kZSsnX29wfX0hPScifV0pJT4ucGFyZW50X0Zsb3dfTG9naWNzKFsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8JWxvZ2ljKCdBcHBlbmQgJytlYS5OYW1lKycgT3BlcmF0b3IgdG8gJyArIGMuTmFtZSArICcgRVF1ZXJ5JywgJ1NldCBGbG93IFZhcmlhYmxlcycsIFt7Y2Q6ICInZXF1ZXJ5JyIsIHY6ICIne3tmbG93X3ZhcmlhYmxlLmVxdWVyeX19e3tmbG93X3ZhcmlhYmxlLicrZWFDb2RlKydfb3B9fScifV0pJT4NCiAgICAgICAgICAgICAgICAgICAgICAgIF0pLA0KICAgICAgICAgICAgICAgICAgICAgICAgPCVsb2dpYygnRWxzZSAnICsgYy5OYW1lICsgJyAnK2VhLk5hbWUrJyBub3QgU2V0JywgJ0Vsc2UnKSU+LnBhcmVudF9GbG93X0xvZ2ljcyhbDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPCVsb2dpYygnQXBwZW5kID0gdG8gJyArIGMuTmFtZSArICcgRVF1ZXJ5IGZvciAnK2VhLk5hbWUsICdTZXQgRmxvdyBWYXJpYWJsZXMnLCBbe2NkOiAiJ2VxdWVyeSciLCB2OiAiJ3t7Zmxvd192YXJpYWJsZS5lcXVlcnl9fT0nIn1dKSU+DQogICAgICAgICAgICAgICAgICAgICAgICBdKSwNCiAgICAgICAgICAgICAgICAgICAgICAgIDwlaWYoZWEuRW50aXR5VHlwZSl7JT48JWxvZ2ljKCdGb3IgZWFjaCAnK2MuTmFtZSsnICcrZWEuTmFtZSwgJ0ZvciBFYWNoJywgW3tjZDogIidpdGVtcyciLCB2OiAiJ3t7PDwqKiMkZltpbnRlcm5hbF9uYW1lPVxcJyIrYy5OYW1lKyJfbG9va3VwXFwnIGFuZCAkbm90KCRleGlzdHMoZmxvd19GbG93X1NuYXBzaG90cykpXS5zbmFwc2hvdF9GbG93X0xvZ2ljcy4qKi5wYXJlbnRfRmxvd19JbnN0YW5jZXMjJGZpWyRudW1iZXIob3JkZXIpPD0iK2JPcmRlcisiIGFuZCBzdWJmbG93LmludGVybmFsX25hbWU9XFwnIitlYS5FbnRpdHlUeXBlLk5hbWUrIl9sb29rdXBcXCddLnVpX2lkPj4uIitlYS5FbnRpdHlUeXBlLk5hbWUrIl9saXN0fX0nIn1dKSU+LnBhcmVudF9GbG93X0xvZ2ljcyhbPCV9JT4NCiAgICAgICAgICAgICAgICAgICAgICAgIDwlbG9naWMoJ0FwcGVuZCAnK2VhLk5hbWUrJyB0byAnICsgYy5OYW1lICsgJyBFUXVlcnknLCAnU2V0IEZsb3cgVmFyaWFibGVzJywgW3tjZDogIidlcXVlcnknIiwgdjogIid7e2Zsb3dfdmFyaWFibGUuZXF1ZXJ5fX17e2Zsb3dfdmFyaWFibGUuJytlYUNvZGUrJ319JyJ9XSklPiwNCiAgICAgICAgICAgICAgICAgICAgICAgIDwlaWYoZWEuRW50aXR5VHlwZSl7JT5dKTwlfSU+LA0KICAgICAgICAgICAgICAgICAgICBdKSwNCiAgICAgICAgICAgICAgICBdKTwlfSU+DQogICAgICAgICAgICAgICAgLA0KICAgICAgICA8JSB9KSU+DQogICAgICAgIDwlIGMuVHlwZWRBdHRyaWJ1dGVzLmZpbHRlcih0YSA9PiAhdGEuRW50aXR5TWV0aG9kKS5mb3JFYWNoKHRhID0+IHtsZXQgdGFOYW1lID0gbk5hbWUodGEpICsgJ18nICsgdGEuRW50aXR5Q2xhc3MuUGx1cmFsLnJlcGxhY2UoLyAvZywgJ18nKTslPg0KICAgICAgICAgICAgICAgIDwlPXRhTmFtZSU+OiAob2JqLCBlYUNvZGUsIHYpID0+IG9iajwlaWYoMCB8fCBbJ1VzZXInLCAnR2VuZGVyJywgJ19TdHVkZW50JywgJ19UZWFjaGVyJ10uaW5kZXhPZih0YS5FbnRpdHlDbGFzcy5OYW1lKT49MCl7JT4uZmxvd19GbG93X0xvZ2ljcyhbPCVsb2dpYygnSWYgJyt0YU5hbWUrJyBub3QgZW1wdHknLCAnSWYnKSU+LnBhcmVudF9GbG93X0luc3RhbmNlcyg8JXN1YmZsb3coJ25ldyAnK3Njb3BlKycuJytfY05hbWUodGEuRW50aXR5Q2xhc3MsIHRydWUpKycoKS4nK21OYW1lKycoYkRyYWZ0LCB0cnVlKScsIHtqc29uOiAiJ3Rlc3QnIn0pJT4pXSk8JX0lPiwNCiAgICAgICAgPCUgfSklPg0KICAgICAgICAgICAgICAgIF9sb29rdXA6IG9iaiA9PiBvYmouZmxvd19GbG93X0xvZ2ljcyhbPCVsb2dpYygnSWYgRVF1ZXJ5IG5vdCBlbXB0eScsICdJZicsIFt7Y2Q6ICInY29uZGl0aW9uJyIsIHY6ICIne3tmbG93X3ZhcmlhYmxlLmVxdWVyeX19IT0nIn1dKSU+DQogICAgICAgICAgICAgICAgICAgIC5wYXJlbnRfQWN0aW9uX0luc3RhbmNlcyhbDQogICAgICAgICAgICAgICAgICAgICAgICA8JWFjdGlvbignbG9va191cF9yZWNvcmRzJywge3RhYmxlOiAnIjw8JC5zeXNfc2NvcGUuc2NvcGU+Pl8iKygnK19uQ29kZSgpKycpLnRvTG93ZXJDYXNlKCknfSklPiwNCiAgICAgICAgICAgICAgICAgICAgXSkubG9naWNfRmxvd19JbnB1dF9TY3JpcHRzKFsNCiAgICAgICAgICAgICAgICAgICAgICAgIG5ldyA8JT1zY29wZSU+LjwlPV9jTmFtZSgnRmxvdyBJbnB1dCBTY3JpcHQnLCB0cnVlKSU+KCkubmFtZSgnU2V0IENvbmRpdGlvbicpLmFjdGl2ZSh0cnVlKS5jb2RlKCdjb25kaXRpb25zJykucmVtYXJrKGByZXR1cm4gZmRfZGF0YS5mbG93X3Zhci5lcXVlcnk7YCksDQogICAgICAgICAgICAgICAgICAgIF0pDQogICAgICAgICAgICAgICAgXSksDQogICAgICAgICAgICAgICAgX3NuYXBzaG90OiBvYmogPT4gYkRyYWZ0P251bGw6b2JqLmZsb3dfRmxvd19TbmFwc2hvdHMobmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKCdGbG93IFNuYXBzaG90JywgdHJ1ZSklPig8JT1fZmlkKCklPikuc25hcHNob3RfRmxvd19QbGFucyhbDQogICAgICAgICAgICAgICAgICAgIG5ldyA8JT1zY29wZSU+LjwlPV9jTmFtZSgnRmxvdyBQbGFuJywgdHJ1ZSklPig8JT1faWQoKSU+KS5jb2RlKCc8JT1jLk5hbWUlPl9QbGFuJykubmFtZSgnPCU9Yy5OYW1lJT4gUGxhbicpDQogICAgICAgICAgICAgICAgICAgIF0pLmZyb21GbG93KHRoaXMuPCU9bU5hbWUlPih0cnVlKSkpLA0KICAgICAgICAgICAgfSwgIjwlPW1OYW1lJT4iLCBiRHJhZnQsIGJIZWFkZXIpOw0KICAgIDwlIH1lbHNleyU+DQogICAgICAgICAgICByZXR1cm4gW107DQogICAgPCUgfSU+DQogICAgICAgIH1jYXRjaChleCl7DQogICAgICAgICAgICA8JT1lcnJvcigpJT5leCk7DQogICAgICAgIH0NCiAgICB9DQogICAgDQogICAgYXN5bmMgPCU9bU5hbWU9J190b1NOU2NyaXB0JyU+KG9wdGlvbnM9e30pew0KICAgICAgICBvcHRpb25zLl90aGlzID0gb3B0aW9ucy5fdGhpcyB8fCB0aGlzOw0KPCUgaWYobWFpbkNsYXNzKCkhPWMpeyU+DQogICAgICAgIHJldHVybiBhd2FpdCBuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUobWFpbkNsYXNzKCksIHRydWUpJT4oKS48JT1tTmFtZSU+KG9wdGlvbnMpOw0KPCUgfWVsc2V7JT4NCiAgICAgICAgdHJ5ew0KICAgIDwlIGlmKF9jTmFtZSgnQXBwbGljYXRpb24nKSl7JT4NCiAgICAgICAgICAgIGxldCBleHAgPSBvcHRpb25zLnJhdz8iX3RvSlNPTiI6Il90b0RvY3VtZW50IjsNCiAgICAgICAgICAgIGxldCByb2xsYmFjayA9IChvcHRpb25zLmFwcCAmJiBvcHRpb25zLnJvbGxiYWNrKT9hd2FpdCBuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUoJ1JvbGxiYWNrIENvbnRleHQnLCB0cnVlKSU+KCkuY29kZSgnbGFzdCcpW2V4cF0oT2JqZWN0LmFzc2lnbih7YkpTT046IHRydWV9LCBvcHRpb25zKSk6IiI7DQogICAgICAgICAgICBsZXQgZGIgPSBvcHRpb25zLmRiP2F3YWl0IG9wdGlvbnMuX3RoaXMvKi5fdG9PYmpUcmVlKHRydWUpKi8uX3RvU05UYWJsZSgpW2V4cF0oT2JqZWN0LmFzc2lnbih7YkpTT046IHRydWV9LCBvcHRpb25zKSk6IiI7DQogICAgICAgICAgICBsZXQgZmxvdyA9IG9wdGlvbnMuZmxvdz9hd2FpdCBvcHRpb25zLl90aGlzLyouX3RvT2JqVHJlZSh0cnVlKSovLl90b1NORmxvdyhvcHRpb25zLmRyYWZ0KVtleHBdKE9iamVjdC5hc3NpZ24oe2JKU09OOiB0cnVlfSwgb3B0aW9ucykpOiIiOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBpZihvcHRpb25zLmd6aXApew0KICAgICAgICAgICAgICAgIGlmKGZsb3cpIGZsb3cgPSB0aGlzLlV0ZjhBcnJheVRvU3RyKGF3YWl0IHRoaXMuX2NvbXByZXNzKGZsb3cpKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgbGV0IHRlc3QgPSAob3B0aW9ucy50ZXN0ICYmIG9wdGlvbnMuZmxvdyAmJiAhb3B0aW9ucy5kcmFmdCk/YFxuLypncy5jYWNoZUZsdXNoKCk7ICovZ3MuaW5mbyhzbl9mZC5GbG93QVBJLmdldFJ1bm5lcigpLnN1YmZsb3coJyR7dGhpcy5fX2NvbmZpZygnc2NvcGUnLCAnPCU9c2NvcGUlPicpfS5Vc2VyX2xvb2t1cCcpLmluRm9yZWdyb3VuZCgpLndpdGhJbnB1dHMoe2pzb246IHtjb2RlOiJ0ZXN0IixkYXRlOicyMDI0LTA1LTAzVDE4OjQ0OjAzLjE3N1onLGdlbmRlcjp7Y29kZToiTSIsIE9QRVJBVE9SUzoge2NvZGU6ICIhPSJ9fSx1c2VyX1N0dWRlbnRzOlt7Y29kZToiU1RBIixnZW5kZXI6e2NvZGU6Ik0ifX1dLCBPUEVSQVRPUlM6IHtkYXRlOiAnPCd9fX0pLnJ1bigpLmdldE91dHB1dHMoKVsiVXNlcl9saXN0Il0pO1xuYDonJzsNCiAgICAgICAgICAgIGxldCBhcHAgPSBvcHRpb25zLmFwcD8obmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKCdBcHBsaWNhdGlvbicsIHRydWUpJT4oKS8qLl90b09ialRyZWUodHJ1ZSkqLy5fdG9TTlNhdmUob3B0aW9ucykgKyBgXG4gdmFyIGNvbmZpZyA9IHtBcHBsaWNhdGlvbjoge3JlYWRPbmx5OiB0cnVlfSwgVGFibGU6IHtpZEtleTogJ25hbWUnLCBMb2dTZXQ6IDB9LCBDb2x1bW46IHtMb2dTZXQ6IDB9LCBFbGVtZW50X01hcHBpbmc6IHtMb2dTZXQ6IDB9LCBBY3Rpb25fSW5wdXQ6IHtyZWFkT25seTogdHJ1ZX0sIEFjdGlvbl9UeXBlOiB7cmVhZE9ubHk6IHRydWUsIGlkS2V5OiAnbWFzdGVyX3NuYXBzaG90J30sIEFjdGlvbl9JbnN0YW5jZToge0xvZ1NldDogMH0sIFNlY3VyaXR5X1R5cGU6IHtyZWFkT25seTogdHJ1ZSwgaWRLZXk6ICduYW1lJ30sIFNlY3VyaXR5X09wZXJhdGlvbjoge3JlYWRPbmx5OiB0cnVlLCBpZEtleTogJ25hbWUnfSwgTG9naWNfRGVmaW5pdGlvbjoge3JlYWRPbmx5OiB0cnVlfSwgRmxvdzoge0xvZ1NldDogMH0sIFRyYW5zZm9ybToge3JlYWRPbmx5OiB0cnVlfSwgVHJhbnNmb3JtX0NvbXBvc2l0aW9uOiB7cmVhZE9ubHk6IHRydWV9LCBSb2xsYmFja19Db250ZXh0OiB7cmVhZE9ubHk6IHRydWV9fTsgXG5gICsgKG9wdGlvbnMucm9sbGJhY2s/KCJ2YXIgY2lkID0gc2F2ZVJvbGxiYWNrX0NvbnRleHQoIityb2xsYmFjaytgKTsgaWYoY2lkKXt2YXIgcncgPSBuZXcgR2xpZGVSb2xsYmFja1dvcmtlcigpOyBydy5zZXRSb2xsYmFja0NvbnRleHRJRChjaWQuc3lzX2lkKTsgcncuc3RhcnQoKTt9IFxuYCk6IiIpKyAob3B0aW9ucy5kYj8oInNhdmVUYWJsZSgiK2RiKyIpOyBcbiIpOiIiKSArIChvcHRpb25zLmZsb3c/KCJzYXZlRmxvdygiK2Zsb3crIik7IFxuIik6IiIpICsgdGVzdCk6KHJvbGxiYWNrICsgZGIgKyBmbG93KTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgbGV0IHNjcmlwdCA9IHRoaXMuX2JlYXV0aWZ5KGFwcCwgJ2phdmFzY3JpcHQnKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgaWYoIW9wdGlvbnMuZGVwbG95KSByZXR1cm4gc2NyaXB0Ow0KICAgIDwlIH0lPg0KICAgICAgICB9Y2F0Y2goZXgpew0KICAgICAgICAgICAgPCU9ZXJyb3IoKSU+ZXgpOw0KICAgICAgICB9DQo8JSB9JT4NCiAgICB9DQoNCiAgICA8JT1tTmFtZT0nX3RvU05TYXZlJyU+KG9wdGlvbnMpew0KICAgICAgICB0cnl7DQogICAgICAgICAgICA8JSB2YXIgX2ZSZWdFeHAgPSAvX2Z7W159XSt9L2dtOyAlPg0KICAgICAgICAgICAgbGV0IF9mID0gKHYsIGVhQ29kZSkgPT4gew0KICAgICAgICAgICAgICAgIGlmKHR5cGVvZih2KT09PSJzdHJpbmciKXsNCiAgICAgICAgICAgICAgICAgICAgbGV0IHJldCA9IHY7DQogICAgICAgICAgICAgICAgICAgIC8vaWYodi5zdGFydHNXaXRoKCJmKCIpICYmIHYuZW5kc1dpdGgoIikiKSkgcmV0ID0gJygnK3Yuc2xpY2UoMiwtMSkrJyknOw0KICAgICAgICAgICAgICAgICAgICBpZih2LnN0YXJ0c1dpdGgoInMoIikgJiYgdi5lbmRzV2l0aCgiKSIpKXsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldCA9IGAoZnVuY3Rpb24gKG9iaiwgJHtlYUNvZGV9KXtgK3Yuc2xpY2UoMiwtMSkrYH0pKG9iaiwgJHtlYUNvZGV9KWA7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIGlmKHJldCAmJiByZXQubWF0Y2ggJiYgcmV0Lm1hdGNoKDwlPV9mUmVnRXhwJT4pKSByZXQgPSBgKGZ1bmN0aW9uIChvYmosICR7ZWFDb2RlfSl7JHtyZXQuaW5kZXhPZigicmV0dXJuIik8MD8icmV0dXJuICI6IiJ9ICdgK3JldC5yZXBsYWNlKDwlPV9mUmVnRXhwJT4sIG0gPT4gYCcgKyAke20uc2xpY2UoMywgLTEpfSArICdgKStgJzt9KShvYmosICR7ZWFDb2RlfSlgOw0KICAgICAgICAgICAgICAgICAgICBpZihyZXQgJiYgcmV0Lm1hdGNoICYmIHJldC5tYXRjaCgvPDxbXj4+XSs+Pi9nbSkpIHJldCA9ICciIic7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBgKGZ1bmN0aW9uKHYpeyB0cnl7IHJldHVybiAodiAmJiB2LnJlcGxhY2UpP3YucmVwbGFjZSg8JT1fZlJlZ0V4cCU+LCBmdW5jdGlvbihtKXtyZXR1cm4gZXZhbChtLnNsaWNlKDMsIC0xKSk7fSk6djsgIH1jYXRjaChleCl7Z3MuaW5mbygnX2Z7RXhjZXB0aW9ufTogJHtlYUNvZGV9OiAnICsgZXgpOyByZXR1cm4gdjt9IH0pKCR7cmV0fSB8fCAke2VhQ29kZX0pYDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgcmV0dXJuIGVhQ29kZTsNCiAgICAgICAgICAgIH07DQoNCiAgICAgICAgICAgIGxldCByZXQgPSB0aGlzLl9fZXhwb3J0KHtJZDogIjwlPXNjb3BlJT4uPCU9X2NOYW1lKGMsIHRydWUpJT4iLCB2YXJzOiBgYCwgY29kZTogYGAsIHF1ZXJ5OiBgYCwgc2V0OiBgYCwgZXNldDogYGAsIGRzZXQ6IGBgLCB0YXM6IGBgLCBkZXBzOiB7fX0sIHsNCiAgICAgICAgICAgICAgICBleHBvcnRlcjogdiA9PiB2Lm9iaiA9ICh0eXBlb2Yob3B0aW9ucy5yZXVzZWQpPT09J3VuZGVmaW5lZCcgfHwgb3B0aW9ucy5yZXVzZWQ+PXYucmV1c2VkKT92Lm9iajp7Y29kZTogdi5vYmouY29kZSArIGBcblxuLyoqIHJldXNlZDogdi5vYmouSWQqKi9cblxuYCwgZGVwczogJycsIElkOiB2Lm9iai5JZH0sDQoNCiAgICAgICAgICAgICAgICBGdWxsOiB0cnVlLA0KICAgICAgICAgICAgICAgIE51bGw6IHRydWUsDQogICAgICAgICAgICAgICAgSWQ6IChvYmosIGlkQ29kZSwgdikgPT4gew0KICAgICAgICAgICAgICAgICAgICBvYmouSWQgPSBgaWYob2JqLiR7aWRDb2RlfSAmJiBvYmouJHtpZENvZGV9LnJlcGxhY2UoLy0vZywgJycpLmxlbmd0aD09MzIpe190b1N0cmluZys9J18nK29iai4ke2lkQ29kZX0ucmVwbGFjZSgvLS9nLCAnJyk7IGdyLmdldCgnc3lzX2lkJywgb2JqLiR7aWRDb2RlfS5yZXBsYWNlKC8tL2csICcnKSk7fVxuYDsNCiAgICAgICAgICAgICAgICAgICAgb2JqLmlkVG9TdHJpbmcgPSBgX3RvU3RyaW5nICs9IChvYmo/b2JqLiR7aWRDb2RlfTooJ2dyXycrZ3Iuc3lzX2lkKSkgKyAnOiAnOyBgOw0KICAgICAgICAgICAgICAgICAgICBvYmoubmV3VVVJRCA9IGBpZighb2JqLiR7aWRDb2RlfSB8fCBvYmouJHtpZENvZGV9LnJlcGxhY2UoLy0vZywgJycpLmxlbmd0aCE9MzIpe29iai4ke2lkQ29kZX0gPSBnci5zZXROZXdHdWlkKCk7fWVsc2V7Z3Iuc2V0TmV3R3VpZFZhbHVlKG9iai4ke2lkQ29kZX0ucmVwbGFjZSgvLS9nLCAnJykpO319XG5gOw0KICAgICAgICAgICAgICAgIH0sDQogICAgPCUgYy5FbnRpdHlBdHRyaWJ1dGVzLmZpbHRlcihlYSA9PiAhZWEuRW50aXR5TWV0aG9kKS5mb3JFYWNoKGVhID0+IHsgJT4NCiAgICAgICAgICAgICAgICA8JT1uTmFtZShlYSklPjogKG9iaiwgZWFDb2RlLCB2KSA9PiB7DQogICAgICAgIDwlIGlmKGVhLkVudGl0eVR5cGUgJiYgZWEuRW50aXR5VHlwZSE9Yyl7JT4NCiAgICAgICAgICAgICAgICAgICAgb2JqLmRlcHMuPCU9bk5hbWUoZWEuRW50aXR5VHlwZSklPiA9ICh2IHx8IG5ldyA8JT1zY29wZSU+LjwlPV9jTmFtZShlYS5FbnRpdHlUeXBlLCB0cnVlKSU+KCkpLjwlPW1OYW1lJT4ob3B0aW9ucyk7DQogICAgICAgIDwlIH0lPg0KDQogICAgICAgICAgICAgICAgICAgIG9iai52YXJzICs9IGB2YXIgJHtlYUNvZGV9ID0gPCVpZihlYS5FbnRpdHlUeXBlKXslPigoKHJlZnMuPCU9bk5hbWUoZWEpJT4gPSAodHlwZW9mKG9iai4ke2VhQ29kZX0pIT09J3VuZGVmaW5lZCc/Lyp0aGlzLiovc2F2ZTwlPW5OYW1lKGVhLkVudGl0eVR5cGUpJT4ob2JqLiR7ZWFDb2RlfSwgezwlPW5OYW1lKGMpJT46IG9iaiwgPCU9bk5hbWUoYy8qZWEqLyklPlJlZnM6IHJlZnMsIDwlPW5OYW1lKGMpLnRvTG93ZXJDYXNlKCklPjogZ3J9LCAiPCU9bk5hbWUoYyklPiIsIHJlZnMuPCU9bk5hbWUoZWEpJT4gfHwgLypFWFA6IHJlZnMuPCU9bk5hbWUoZWEuRW50aXR5VHlwZSkudG9Mb3dlckNhc2UoKSU+IHx8ICovKCR7X2YoPCV2YWx1ZU9mKGVhLkRlZmF1bHQpJT4sIGVhQ29kZSl9KSk6cmVmcy48JT1uTmFtZShlYSklPikpIHx8IHtzeXNfaWQ6ICcnfSlbLyp0aGlzLiovY29uZmlnLjwlPW5OYW1lKGVhLkVudGl0eVR5cGUpJT4uaWRLZXkgfHwgInN5c19pZCJdKS50b1N0cmluZygpPCV9ZWxzZXslPm9iai4ke2VhQ29kZX08JX0lPjtgOw0KICAgICAgICA8JSBpZihlYS5Jc1VuaXF1ZSl7JT4NCiAgICAgICAgICAgICAgICAgICAgb2JqLnF1ZXJ5ICs9IGBfdG9TdHJpbmcrPSdfJyske2VhQ29kZX07IF90b1F1ZXJ5LiR7ZWFDb2RlfSA9ICR7X2YodiwgZWFDb2RlKX07IGA7DQogICAgICAgIDwlIH0lPg0KICAgICAgICAgICAgICAgICAgICBvYmouc2V0ICs9IGBpZih0eXBlb2YoX3RvU2V0LiR7ZWFDb2RlfSA9ICR7X2YodiwgZWFDb2RlKX0pIT09J3VuZGVmaW5lZCc8JWlmKGVhLkVudGl0eVR5cGUpeyU+JiYgX3RvU2V0LiR7ZWFDb2RlfTwlfSU+KSBnci5zZXRWYWx1ZSgnJHtlYUNvZGV9JywgX3RvU2V0LiR7ZWFDb2RlfSk7YDsNCiAgICAgICAgICAgICAgICB9LA0KICAgIDwlIH0pJT4NCiAgICA8JSBjLkVudGl0eUZpZWxkcy5mb3JFYWNoKGVmID0+IHslPg0KICAgICAgICAgICAgICAgIGVmXzwlPW5OYW1lKGVmKSU+OiAob2JqLCBlZkNvZGUsIHYpID0+IG9iai5lc2V0ICs9IGBpZih0eXBlb2YoX3RvU2V0LiR7ZWZDb2RlfSA9ICR7X2YoSlNPTi5zdHJpbmdpZnkodiksICdvYmouJytlZkNvZGUpfSkhPT0ndW5kZWZpbmVkJykgZ3Iuc2V0VmFsdWUoJyR7ZWZDb2RlfScsIF90b1NldC4ke2VmQ29kZX0pO2AsDQogICAgPCUgfSklPg0KICAgIDwlIGMuVHlwZWRBdHRyaWJ1dGVzLmZpbHRlcih0YSA9PiAhdGEuRW50aXR5TWV0aG9kKS5mb3JFYWNoKHRhID0+IHtsZXQgdGFOYW1lID0gbk5hbWUodGEpICsgJ18nICsgdGEuRW50aXR5Q2xhc3MuUGx1cmFsLnJlcGxhY2UoLyAvZywgJ18nKTslPg0KICAgICAgICAgICAgICAgIDwlPXRhTmFtZSU+OiAob2JqLCBlYUNvZGUsIHYpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgb2JqLnRhcyArPSBgcmVmcy48JT10YU5hbWUlPiA9ICgob2JqP29iai4ke2VhQ29kZX06W10pIHx8IFtdKS5tYXAoZnVuY3Rpb24obyl7Z3MuaW5mbyhfdG9TdHJpbmcgKyAnID0+IHNhdmU8JT1uTmFtZSh0YS5FbnRpdHlDbGFzcyklPigke2VhQ29kZX1bXSknKTsgcmV0dXJuIC8qdGhpcy4qL3NhdmU8JT1uTmFtZSh0YS5FbnRpdHlDbGFzcyklPihvLCB7PCU9bk5hbWUoYyklPjogb2JqLCA8JT1uTmFtZShjKS50b0xvd2VyQ2FzZSgpJT46IGdyLCBtYW55UmVmczogcmVmc30sICI8JT1uTmFtZShjKSU+Iik7fSk7YA0KICAgICAgICAgICAgICAgICAgICBvYmouZGVwcy48JT1uTmFtZSh0YS5FbnRpdHlDbGFzcyklPiA9ICh2ICYmIHYubGVuZ3RoKT92WzBdOm5ldyA8JT1zY29wZSU+LjwlPV9jTmFtZSh0YS5FbnRpdHlDbGFzcywgdHJ1ZSklPigpLjwlPW1OYW1lJT4ob3B0aW9ucyk7DQogICAgICAgICAgICAgICAgfSwNCiAgICA8JSB9KSU+DQogICAgICAgICAgICB9LCAiPCU9bU5hbWUlPiIpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBpZighcmV0LmRzZXQpIHJldC5kc2V0ICs9IGBcbmlmKHR5cGVvZihvYmopPT09Im9iamVjdCIpIE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspe3JldHVybiAhay5zdGFydHNXaXRoKCdfXycpICYmIFsnc3lzX2lkJywgJ0lkJywgJ09QRVJBVE9SUyddLmluZGV4T2Yoayk8MCAmJiB0eXBlb2YoX3RvU2V0W2tdKT09PSd1bmRlZmluZWQnICYmICFBcnJheS5pc0FycmF5KG9ialtrXSk7fSkuZm9yRWFjaChmdW5jdGlvbihrKXtfdG9TZXRba10gPSAke19mKCJvYmpba10iLCAibnVsbCIpfTsgaWYoX3RvU2V0W2tdICYmIF90b1NldFtrXS5fX2NsYXNzKXtfdG9TZXRba10gPSBfdG9TZXRba11bY29uZmlnW190b1NldFtrXS5fX2NsYXNzXS5pZEZpZWxkIHx8ICdJZCddOyB9IGdyLnNldFZhbHVlKGssIF90b1NldFtrXSApOyB9KVxuYDsNCg0KICAgICAgICAgICAgcmV0LmNvZGUgKz0gYCR7T2JqZWN0LnZhbHVlcyhyZXQuZGVwcykuam9pbignXG4nKX1mdW5jdGlvbiBzYXZlPCU9bk5hbWUoYyklPihvYmosIHJlZnMsIHNvdXJjZSwgZ3Ipe3JlZnMgPSByZWZzIHx8IHt9OyAvKnRoaXMuKi9jb25maWcuc2F2ZV8kezwlPV9uQ29kZSgpJT59ID0gc2F2ZTwlPW5OYW1lKGMpJT47IC8qdGhpcy4qL2NvbmZpZy48JT1uTmFtZShjKSU+ID0gLyp0aGlzLiovY29uZmlnLjwlPW5OYW1lKGMpJT4gfHwge307IC8qdGhpcy4qL2NvbmZpZy5faWRNYXAgPSAvKnRoaXMuKi9jb25maWcuX2lkTWFwIHx8IFtdOyB2YXIgX3RvU3RyaW5nID0gc291cmNlICsgJ1snICsgKHJlZnNbc291cmNlXS5zeXNfaWQpICsgJ109PiBzYXZlPCU9bk5hbWUoYyklPignOyBpZih0eXBlb2Yob2JqKT09PSdzdHJpbmcnICYmIG9iai5sZW5ndGg+PTMyKXt2YXIgcmV0ID0ge307IHJldFsvKnRoaXMuKi9jb25maWcuPCU9bk5hbWUoYyklPi5pZEtleSB8fCAic3lzX2lkIl09b2JqOyBncy5pbmZvKF90b1N0cmluZyArICcpOiBvYmogaXMgdXVpZCwgcmV0dXJuaW5nIHsnK29iaisnfScpOyByZXR1cm4gcmV0O30gaWYoIW9iaiAmJiAhZ3Ipe2dzLmluZm8oX3RvU3RyaW5nICsgJyk6IG9iaiBpcyBudWxsJyk7IHJldHVybiBudWxsO30gJHtyZXQuaWRUb1N0cmluZ30gdmFyIGJTYXZlID0gIS8qdGhpcy4qL2NvbmZpZy48JT1uTmFtZShjKSU+LnJlYWRPbmx5OyBpZighZ3IpeyBnciA9IG5ldyBHbGlkZVJlY29yZCgnJHs8JT1fbkNvZGUoKSU+fScpO1xuJHtyZXQuSWR9XG4ke3JldC52YXJzfVxuaWYoIWdyLmlzVmFsaWRSZWNvcmQoKSl7Z3IgPSBuZXcgR2xpZGVSZWNvcmQoJyR7PCU9X25Db2RlKCklPn0nKTsgdmFyIF90b1F1ZXJ5PXt9OyAke3JldC5xdWVyeX0gXG5fdG9TdHJpbmcgKz0gJyk6ICc7IGlmKG9iai5fX2tleXMgJiYgKGJTYXZlIHx8IGNvbmZpZy48JT1uTmFtZShjKSU+LnJlYWRPbmx5KSl7aWYoX3RvUXVlcnkuX19lbmNvZGVkUXVlcnkpe2dyLmFkZEVuY29kZWRRdWVyeShfdG9RdWVyeS5fX2VuY29kZWRRdWVyeSk7fWVsc2V7b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspe2dyLmFkZFF1ZXJ5KGssIF90b1F1ZXJ5W2tdIHx8IG9ialtrXSk7fSk7fSBnci5zZXRMaW1pdCgxKTsgaWYoIWdyLmdldEVuY29kZWRRdWVyeSgpKSBnci5hZGRRdWVyeSgnc3lzX2lkJywgJy0xJyk7IGdzLmluZm8oX3RvU3RyaW5nICsgJ0VuY29kZWQgUXVlcnk6ICcgKyBnci5nZXRFbmNvZGVkUXVlcnkoKSk7IGdyLnF1ZXJ5KCk7aWYoIWdyLm5leHQoKSl7Z3MuaW5mbyhfdG9TdHJpbmcgKyAnbm90IGZvdW5kJyk7fWVsc2V7Z3MuaW5mbyhfdG9TdHJpbmcgKyAnZm91bmQgWyR7PCU9X25Db2RlKCklPn0vJyArIGdyLnN5c19pZCArICddIC0gaXMgdmFsaWQ6ICcgKyBnci5pc1ZhbGlkUmVjb3JkKCkpOyBvYmouSWQgPSBnci5zeXNfaWQudG9TdHJpbmcoKTsgaWYob2JqLl9fcmV1c2VkKXsvKmdzLmluZm8oX3RvU3RyaW5nICsgJzogX19yZXVzZWQ6IFskezwlPV9uQ29kZSgpJT59LycgKyBnci5zeXNfaWQgKyAnXSAtIGlzIHZhbGlkOiAnICsgZ3IuaXNWYWxpZFJlY29yZCgpKTsgKi9yZXR1cm4gZ3I7fSB9fX19ZWxzZXtiU2F2ZT1mYWxzZTt9IGlmKGJTYXZlICYmICFnci5pc1ZhbGlkUmVjb3JkKCkpe2dzLmluZm8oX3RvU3RyaW5nICsgJ2luc2VydGluZy4uLicpOyBnciA9IG5ldyBHbGlkZVJlY29yZCgnJHs8JT1fbkNvZGUoKSU+fScpOyBnci5pbml0aWFsaXplKCk7ICR7cmV0Lm5ld1VVSUR9IGlmKGJTYXZlICYmIG9iail7dmFyIF90b1NldCA9IHt9OyAvKnNldCovJHtyZXQuc2V0fSAvKmVzZXQqLyR7cmV0LmVzZXR9ICAke3JldC5kc2V0fSBpZigvKnRoaXMuKi9jb25maWcuPCU9bk5hbWUoYyklPi5Ob1dvcmtmbG93KSBnci5zZXRXb3JrZmxvdyhmYWxzZSk7IGlmKC8qdGhpcy4qL2NvbmZpZy48JT1uTmFtZShjKSU+LkxvZ1NldCkgZ3MuaW5mbyhfdG9TdHJpbmcgKyAnX3RvU2V0OiAnICsgSlNPTi5zdHJpbmdpZnkoX3RvU2V0KSk7IH1lbHNlIGlmKCFnci5pc1ZhbGlkUmVjb3JkKCkpe2dzLmluZm8oX3RvU3RyaW5nICsgJ1tiU2F2ZT0nICsgYlNhdmUgKyAnXSAtIHJldHVybmluZyBudWxsLicpOyByZXR1cm4gbnVsbDt9XG5pZighYlNhdmUgfHwgZ3IudXBkYXRlKCkpeyBpZihmYWxzZSAmJiBiU2F2ZSl7Y29uZmlnLl9pZE1hcC5wdXNoKHt0YWJsZTogJyR7PCU9X25Db2RlKCklPn0nLCBzeXNfaWQ6IGdyLnN5c19pZC50b1N0cmluZygpLCBrZXlzOiBvYmouX19rZXlzLm1hcChmdW5jdGlvbihrKXtyZXR1cm4ge2s6IGssIHY6IF90b1F1ZXJ5W2tdIHx8IG9ialtrXX07fSl9KTt9ICR7cmV0LnRhc31cbmdzLmluZm8oX3RvU3RyaW5nICsgJ1tiU2F2ZT0nICsgYlNhdmUgKyAnXSAtIHJldHVybmluZyAnICsgZ3Iuc3lzX2lkKTsgcmV0dXJuIGdyO319XG5gOw0KDQogICAgICAgICAgICAvKnJldHVybiBPYmplY3QudmFsdWVzKE9iamVjdC5hc3NpZ24oe30sIC4uLnJldC5jb2RlLnNwbGl0KCdmdW5jdGlvbiBzYXZlJykuZmlsdGVyKHMgPT4gcykuc29ydCgoYSwgYikgPT4gYS5sZW5ndGggLSBiLmxlbmd0aCkubWFwKHMgPT4gKHtbcy5zcGxpdCgnKG9iaiwgcmVmcywgc291cmNlLCBnciknKVswXV06ICdmdW5jdGlvbiBzYXZlJytzfSkpKSkuam9pbignXG4nKTsgKi8NCiAgICAgICAgICAgIHJldHVybiByZXQuY29kZTsNCiAgICAgICAgfWNhdGNoKGV4KXsNCiAgICAgICAgICAgIDwlPWVycm9yKCklPmV4KTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICANCiAgICA8JT1tTmFtZT0nX3RvU05RdWVyeSclPihmaWVsZHMsIG9ianMsIGJVUkwpew0KICAgICAgICBsZXQgcmV0ID0gdGhpcy5fX2V4cG9ydCh7fSwgew0KICAgICAgICAgICAgT1BFUkFUT1JTOiB0cnVlLA0KICAgICAgICAgICAgLy9fbWFwOiB0cnVlLA0KICAgICAgICAgICAgSWQ6IChvYmosIGlkQ29kZSwgdikgPT4gb2JqW2lkQ29kZV0gPSB2LA0KICAgIDwlIGMuRW50aXR5QXR0cmlidXRlcy5maWx0ZXIoZWEgPT4gIWVhLkVudGl0eU1ldGhvZCkuZm9yRWFjaChlYSA9PiB7ICU+DQogICAgICAgICAgICA8JT1uTmFtZShlYSklPjogKG9iaiwgZWFDb2RlLCB2KSA9PiB7DQogICAgICAgIDwlIGlmKGVhLkVudGl0eVR5cGUpeyU+DQogICAgICAgICAgICAgICAgb2JqW2VhQ29kZV0gPSB2P3YuPCU9bU5hbWUlPigpOm51bGw7DQogICAgICAgIDwlIH1lbHNlIGlmKGVhLklzRGF0ZSl7JT4NCiAgICAgICAgICAgICAgICBsZXQgZCA9IGAke3YuZ2V0RnVsbFllYXIoKX0tJHsoJzAnKyh2LmdldE1vbnRoKCkrMSkpLnNsaWNlKC0yKX0tJHt2LmdldERhdGUoKX1gOw0KICAgICAgICAgICAgICAgIGxldCB0ID0gYCR7di5nZXRIb3VycygpfToke3YuZ2V0TWludXRlcygpfToke3YuZ2V0U2Vjb25kcygpfWA7DQogICAgICAgICAgICAgICAgaWYoKHYuZ2V0SG91cnMoKT09MCAmJiB2LmdldE1pbnV0ZXMoKT09MCAmJiB2LmdldFNlY29uZHMoKT09MCkgfHwgdGhpcy5fPCU9bk5hbWUoZWEpJT5fY29vcD09Jz0nIHx8ICF0aGlzLl88JT1uTmFtZShlYSklPl9jb29wKXsNCiAgICAgICAgICAgICAgICAgICAgb2JqW2VhQ29kZV0gPSBgT04ke2R9QGphdmFzY3JpcHQ6Z3MuZGF0ZUdlbmVyYXRlKCcke2R9Jywnc3RhcnQnKUBqYXZhc2NyaXB0OmdzLmRhdGVHZW5lcmF0ZSgnJHtkfScsJ2VuZCcpYDsNCiAgICAgICAgICAgICAgICB9ZWxzZSBpZih0aGlzLl88JT1uTmFtZShlYSklPl9jb29wIT09J0JFVFdFRU4nKXsNCiAgICAgICAgICAgICAgICAgICAgb2JqW2VhQ29kZV0gPSBgamF2YXNjcmlwdDpncy5kYXRlR2VuZXJhdGUoJyR7ZH0nLCAnJHt0fScpYDsNCiAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgb2JqW2VhQ29kZV0gPSBgamF2YXNjcmlwdDpncy5kYXRlR2VuZXJhdGUoJyR7ZH0nLCAnJHt0fScpQGphdmFzY3JpcHQ6Z3MuZGF0ZUdlbmVyYXRlKCcke2R9JywgJyR7dH0nKWA7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICA8JSB9ZWxzZSBpZihlYS5Jc0Jvb2wpeyU+DQogICAgICAgICAgICAgICAgb2JqLk9QRVJBVE9SUy48JT1uTmFtZShlYSklPiA9ICc9JzsNCiAgICAgICAgICAgICAgICBvYmpbZWFDb2RlXSA9IHY7DQogICAgICAgIDwlIH1lbHNleyU+DQogICAgICAgICAgICAgICAgb2JqW2VhQ29kZV0gPSB2Ow0KICAgICAgICA8JSB9JT4NCiAgICAgICAgICAgIH0sDQogICAgPCUgfSk7ICU+DQogICAgICAgIH0sICI8JT1tTmFtZSU+Iik7DQogICAgICAgIA0KICAgICAgICBPYmplY3Qua2V5cyhyZXQuT1BFUkFUT1JTIHx8IHt9KS5maWx0ZXIoayA9PiB0eXBlb2YocmV0W2tdKSE9PSd1bmRlZmluZWQnICYmIHR5cGVvZihyZXRba10pIT09J29iamVjdCcpLmZvckVhY2goayA9PiByZXRba10gPSByZXQuT1BFUkFUT1JTW2tdICsgcmV0W2tdKTsNCg0KICAgICAgICBkZWxldGUgcmV0Lk9QRVJBVE9SUzsNCiAgICAgICAgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoayA9PiAhU3RyaW5nKHJldFtrXSkubGVuZ3RoKS5mb3JFYWNoKGsgPT4gZGVsZXRlIHJldFtrXSk7DQoNCiAgICAgICAgcmV0ID0gRG90T2JqZWN0LmRvdChyZXQpOw0KDQogICAgICAgIC8vIGF2b2lkIHNlbmRpbmcgd2l0aCBubyBjb21wYXJpc29uIG9wZXJhdG9ycw0KICAgICAgICBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihrID0+ICFbJz4nLCAnPCcsICdCRVRXRUVOJywgJ09OJywgJyEnLCAnPScsICdTVEFSVFNXSVRIJywgJ0xJS0UnXS5zb21lKHMgPT4gU3RyaW5nKHJldFtrXSkuc3RhcnRzV2l0aChzKSkpLmZvckVhY2goayA9PiByZXRba10gPSAodGhpc1tgXyR7a31fY29vcGBdIHx8ICdTVEFSVFNXSVRIJykgKyByZXRba10pOw0KICAgICAgICANCiAgICAgICAgPCU9bG9nKCklPnJldCk7DQoNCiAgICAgICAgaWYoYlVSTCkgcmV0ID0gT2JqZWN0LmVudHJpZXMocmV0IHx8IHt9KS5tYXAocCA9PiBgJHtwWzBdfSR7cFsxXX1gKS5qb2luKCJeIik7DQogICAgICAgIA0KICAgICAgICByZXR1cm4gcmV0Ow0KICAgIH0NCjwlIH0lPg0KDQoJPCU9bU5hbWU9J19fZXhwb3J0JyU+KG9iaiwgb3B0aW9ucywgZnVuLCAuLi5mQXJncykgew0KCSAgICB0cnl7DQogICAgCSAgICBpZighb2JqKSByZXR1cm4gdGhpczsNCiAgICAJICAgIA0KICAgIAkgICAgaWYob3B0aW9ucy5PUEVSQVRPUlMpIG9iai5PUEVSQVRPUlMgPSBvYmouT1BFUkFUT1JTIHx8IHt9Ow0KICAgIAkgICAgDQogICAgCSAgICA8JSAvKiBJTVBPUlRBTlQ6IHRoaXMuSWQ9PXRoaXMuSWQgbWFrZXMgc3VyZSB0aGUgSWQgaXMgZml4ZWQgZm9yIHRoZSB0b29sLCBub3QgZ2V0dGluZyBnZW5lcmF0ZWQgZXZlcnkgdGltZSB3ZSBjYWxsIGl0ICovICU+DQogICAgCSAgICANCiAgICAJICAgIGxldCBlYUNvZGVzID0gew0KICAgIAkgICAgICAgIGV4cG9ydGVyOiAiIiwNCiAgICAJICAgICAgICBJZDogIiIsDQogICAgCSAgICB9Ow0KICAgIAkgICAgDQogICAgCQlpZiAoIW9wdGlvbnMuVW5pcXVlICYmIChvcHRpb25zLkZ1bGwgfHwgdGhpcy5fX3N5bmNfb24oKSB8fCB0aGlzLklkPT10aGlzLklkKSkgdGhpcy5fX29wdGlvbnMoIklkIiwgb2JqLCBlYUNvZGVzLklkID0gKG9wdGlvbnMuX21hcD90aGlzLl9uQ29kZSgnSWQnKTonSWQnKSwgdGhpcy5JZCwgdGhpcywgb3B0aW9ucywgZnVuKTsNCiAgICAJCQ0KPCUgYy5FbnRpdHlBdHRyaWJ1dGVzLmZpbHRlcihlYSA9PiAhZWEuRW50aXR5TWV0aG9kICYmICFlYS5FbnRpdHlUeXBlKS5mb3JFYWNoKGVhID0+IHslPg0KICAgICAgICAgICAgaWYoIW9wdGlvbnMuVW5pcXVlIHx8IChvcHRpb25zLlVuaXF1ZSAmJiA8JXZhbHVlT2YoZWEuSXNVbmlxdWUpJT4pKSB0aGlzLl9fb3B0aW9ucygiPCU9bk5hbWUoZWEpJT4iLCBvYmosIGVhQ29kZXMuPCU9bk5hbWUoZWEpJT4gPSAob3B0aW9ucy5fbWFwPzwlPV9uQ29kZShlYSklPjo8JV92Q29kZShlYSklPiksIHRoaXMuPCU9bk5hbWUoZWEpJT4oKSwgdGhpcywgb3B0aW9ucywgZnVuLCAiPCU9X2NGaWVsZChlYSklPiIpOw0KPCUgfSklPg0KDQo8JSBjLkVudGl0eUF0dHJpYnV0ZXMuZmlsdGVyKGVhID0+ICFlYS5FbnRpdHlNZXRob2QgJiYgZWEuRW50aXR5VHlwZSAmJiBlYS5Jc1VuaXF1ZSkuZm9yRWFjaChlYSA9PiB7JT4NCiAgICAgICAgICAgIGlmICghb3B0aW9ucy5VbmlxdWUgfHwgKG9wdGlvbnMuVW5pcXVlICYmIDwldmFsdWVPZihlYS5Jc1VuaXF1ZSklPikpIHRoaXMuX19vcHRpb25zKCI8JT1uTmFtZShlYSklPiIsIG9iaiwgZWFDb2Rlcy48JT1uTmFtZShlYSklPiA9IChvcHRpb25zLl9tYXA/PCU9X25Db2RlKGVhKSU+OjwlX3ZDb2RlKGVhKSU+KSwgdGhpcy48JT1uTmFtZShlYSklPigpLCB0aGlzLCBvcHRpb25zLCBmdW4sICI8JT1fY0ZpZWxkKGVhKSU+Iik7DQo8JSB9KSU+DQoNCjwlIGMuRW50aXR5RmllbGRzLmZvckVhY2goZWYgPT4geyU+DQogICAgICAgICAgICBpZiAoIW9wdGlvbnMuVW5pcXVlIHx8IChvcHRpb25zLlVuaXF1ZSAmJiA8JXZhbHVlT2YoZWYuSXNVbmlxdWUpJT4pKSB0aGlzLl9fb3B0aW9ucygiZWZfPCU9bk5hbWUoZWYpJT4iLCBvYmosIGVhQ29kZXMuZWZfPCU9bk5hbWUoZWYpJT4gPSAob3B0aW9ucy5fbWFwPzwlPV9uQ29kZShlZiklPjo8JV92Q29kZShlZiklPiksIDwldmFsdWVPZihlZi5WYWx1ZSklPiwgdGhpcywgb3B0aW9ucywgZnVuKTsNCjwlIH0pJT4NCg0KCQkgICAgPCUgdW5SZWN1cnNlKCdvYmonLCAnZnVuJywgJ2ZBcmdzJywgJ2lmKHR5cGVvZihvcHRpb25zLmV4cG9ydGVyKT09PSJmdW5jdGlvbiIpIG9wdGlvbnMuZXhwb3J0ZXIodiknKSU+DQoNCjwlIGMuRW50aXR5QXR0cmlidXRlcy5maWx0ZXIoZWEgPT4gIWVhLkVudGl0eU1ldGhvZCAmJiBlYS5FbnRpdHlUeXBlICYmICFlYS5Jc1VuaXF1ZSkuZm9yRWFjaChlYSA9PiB7JT4NCiAgICAgICAgICAgIGlmICghb3B0aW9ucy5VbmlxdWUpIHRoaXMuX19vcHRpb25zKCI8JT1uTmFtZShlYSklPiIsIG9iaiwgZWFDb2Rlcy48JT1uTmFtZShlYSklPiA9IChvcHRpb25zLl9tYXA/PCU9X25Db2RlKGVhKSU+OjwlX3ZDb2RlKGVhKSU+KSwgdGhpcy48JT1uTmFtZShlYSklPigpLCB0aGlzLCBvcHRpb25zLCBmdW4sICI8JT1fY0ZpZWxkKGVhKSU+Iik7DQo8JSB9KSU+DQoNCiAgICAgICAgICAgIGlmICghb3B0aW9ucy5VbmlxdWUpIHRoaXMuX19vcHRpb25zKCJfVEhJUyIsIG9iaiwgZWFDb2Rlcy5fVEhJUyA9IChvcHRpb25zLl9tYXA/dGhpcy5fbkNvZGUoJ19USElTJyk6Il9USElTIiksIHRoaXMuX1RISVMsIHRoaXMsIG9wdGlvbnMsIGZ1bik7DQoNCjwlIGMuVHlwZWRBdHRyaWJ1dGVzLmZpbHRlcih0YSA9PiAhdGEuRW50aXR5TWV0aG9kKS5mb3JFYWNoKHRhID0+IHtsZXQgdGFOYW1lID0gbk5hbWUodGEpICsgJ18nICsgdGEuRW50aXR5Q2xhc3MuUGx1cmFsLnJlcGxhY2UoLyAvZywgJ18nKTslPg0KICAgICAgICAgICAgaWYgKCFvcHRpb25zLlVuaXF1ZSkgdGhpcy5fX29wdGlvbnMoIjwlPXRhTmFtZSU+Iiwgb2JqLCBlYUNvZGVzLjwlPXRhTmFtZSU+ID0gKG9wdGlvbnMuX21hcD88JT1fbkNvZGUodGEsIHRydWUpJT46IjwlPXRhTmFtZSU+IiksIHRoaXMuPCU9dGFOYW1lJT4oKSwgdGhpcywgb3B0aW9ucywgZnVuLCAiPCU9X2NGaWVsZCh0YSklPiIpOw0KPCUgfSklPg0KDQogICAgICAgICAgICBpZiAoIW9wdGlvbnMuVW5pcXVlKSBPYmplY3Qua2V5cyhvcHRpb25zKS5maWx0ZXIoayA9PiB0eXBlb2Yob3B0aW9uc1trXSk9PT0nZnVuY3Rpb24nICYmICFPYmplY3Qua2V5cyhlYUNvZGVzKS5pbmNsdWRlcyhrKSkuZm9yRWFjaChrID0+IHRoaXMuX19vcHRpb25zKGssIG9iaiwgaywgdW5kZWZpbmVkLCB0aGlzLCBvcHRpb25zLCBmdW4pKTsNCiAgICAgICAgDQogICAgICAgICAgICA8JT1zY29wZSU+Ll91blJlY3Vyc2UuPCU9bk5hbWUoYyklPltmdW5dID0gPCU9c2NvcGUlPi5fdW5SZWN1cnNlLjwlPW5OYW1lKGMpJT5bZnVuXSB8fCB7fTsNCiAgICAgICAgICAgICg8JT1zY29wZSU+Ll91blJlY3Vyc2UuPCU9bk5hbWUoYyklPltmdW5dLkN5Y2xpYyB8fCBbXSkuZm9yRWFjaChuID0+IG4uX2Nbbi5lYUZpZWxkXShuLl9jW24uZWFGaWVsZF0oKS5fdG9IYXNoKG51bGwsIHtub0NvZGU6IHRydWUsIG9ubHlVbmlxdWU6IHRydWUsIG5vQXJnczogdHJ1ZSwgX21hcDogb3B0aW9ucy5fbWFwfSwgZnVuKSkpOw0KICAgICAgICAgICAgPCU9c2NvcGUlPi5fdW5SZWN1cnNlLjwlPW5OYW1lKGMpJT5bZnVuXS5DeWNsaWMgPSBbXTsgLy8/Pw0KICAgICAgICAgICAgDQogICAgCQlyZXR1cm4gb2JqOw0KICAgIAl9Y2F0Y2goZXgpew0KICAgIAkgICAgPCU9ZXJyb3IoKSU+ZXgpOw0KICAgIAl9DQoJfQ0KCQ0KCTwlPW1OYW1lPSdfX29wdGlvbnMnJT4oZmllbGQsIG9iaiwgZWFDb2RlLCBlYU9iaiwgX3RoaXM9dGhpcywgb3B0aW9ucz17fSwgZnVuLCBlYUZpZWxkKXsNCjwlIGlmKG1haW5DbGFzcygpIT1jKXslPg0KICAgICAgICByZXR1cm4gbmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKG1haW5DbGFzcygpLCB0cnVlKSU+KCkuPCU9bU5hbWUlPihmaWVsZCwgb2JqLCBlYUNvZGUsIGVhT2JqLCBfdGhpcywgb3B0aW9ucywgZnVuLCBlYUZpZWxkKTsNCjwlIH1lbHNleyU+DQogICAgICAgIHRyeXsNCiAgICAgICAgICAgIGlmKG9wdGlvbnMuX2ZpZWxkcyAmJiAhb3B0aW9ucy5fZmllbGRzLmluY2x1ZGVzKGZpZWxkKSkgcmV0dXJuOw0KICAgICAgICAgICAgaWYoIW9iaikgcmV0dXJuOw0KICAgICAgICAgICAgaWYodHlwZW9mKG9wdGlvbnNbZmllbGRdKSE9PSJmdW5jdGlvbiIpew0KICAgICAgICAgICAgICAgIDwlPWxvZygpJT5gJHtmdW59Lm9wdGlvbnMuJHtmaWVsZH0gaXMgbm90IGEgZnVuY3Rpb25gKTsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZihlYU9iaikhPT0ndW5kZWZpbmVkJyAmJiAhb3B0aW9ucy5OdWxsKXsNCiAgICAgICAgICAgICAgICBpZihmaWVsZCE9J0lkJyAmJiB0eXBlb2YoX3RoaXNbZmllbGRdKT09PSdmdW5jdGlvbicgJiYgIV90aGlzWydfJytmaWVsZCsnX3NldCddKSByZXR1cm47DQogICAgICAgICAgICAgICAgaWYoQXJyYXkuaXNBcnJheShlYU9iaikgJiYgdHlwZW9mKGVhT2JqLmxlbmd0aCkhPT0ndW5kZWZpbmVkJykgZWFPYmogPSBlYU9iai5maWx0ZXIodiA9PiB2KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgaWYoIW9wdGlvbnMuTnVsbCAmJiBBcnJheS5pc0FycmF5KGVhT2JqKSAmJiAhZWFPYmoubGVuZ3RoKSByZXR1cm47DQoNCiAgICAgICAgICAgIGxldCBfcmV0ID0gb3B0aW9uc1tmaWVsZF0ob2JqLCBlYUNvZGUsIGVhT2JqLCBfdGhpcyk7DQogICAgICAgICAgICBpZihvcHRpb25zLk9QRVJBVE9SUyAmJiBfdGhpc1snXycgKyBmaWVsZCArICdfY29vcCddKSBvYmouT1BFUkFUT1JTID0gT2JqZWN0LmFzc2lnbihvYmouT1BFUkFUT1JTIHx8IHt9LCB7W2ZpZWxkXTogX3RoaXNbJ18nICsgZmllbGQgKyAnX2Nvb3AnXX0pOw0KDQogICAgICAgICAgICBpZighb3B0aW9ucy5DeWNsaWMgJiYgZWFGaWVsZCAmJiBvYmogJiYgb2JqLkVudGl0eUNsYXNzICYmIHR5cGVvZihvYmpbZmllbGRdKT09PSdmdW5jdGlvbicpew0KICAgICAgICAgICAgICAgIDwlPXNjb3BlJT4uX3VuUmVjdXJzZS48JT1uTmFtZShjKSU+W2Z1bl0gPSA8JT1zY29wZSU+Ll91blJlY3Vyc2UuPCU9bk5hbWUoYyklPltmdW5dIHx8IHt9Ow0KICAgICAgICAgICAgICAgIDwlPXNjb3BlJT4uX3VuUmVjdXJzZS48JT1uTmFtZShjKSU+W2Z1bl0uQ3ljbGljID0gPCU9c2NvcGUlPi5fdW5SZWN1cnNlLjwlPW5OYW1lKGMpJT5bZnVuXS5DeWNsaWMgfHwgW107DQogICAgICAgICAgICAgICAgbGV0IF9jeWNsZXMgPSBvYmpbZmllbGRdKCk7DQogICAgICAgICAgICAgICAgaWYoIUFycmF5LmlzQXJyYXkoX2N5Y2xlcykpIF9jeWNsZXMgPSBbX2N5Y2xlc107DQogICAgICAgICAgICAgICAgX2N5Y2xlcyA9IF9jeWNsZXMuZmlsdGVyKF9jID0+IF9jICYmIHR5cGVvZihfY1tlYUZpZWxkXSk9PT0nZnVuY3Rpb24nICYmIF9jWydfJyArIGVhRmllbGQgKyAnX3NldCddICYmIG9iai5fc2FtZUVudGl0eShfY1tlYUZpZWxkXSgpKSkubWFwKF9jID0+ICh7DQogICAgICAgICAgICAgICAgICAgIC8qbWFyayBfY1tlYUZpZWxkXV9zZXQgdG8gbnVsbCBpbnN0ZWFkKi8NCiAgICAgICAgICAgICAgICAgICAgX2MsDQogICAgICAgICAgICAgICAgICAgIGVhRmllbGQsDQogICAgICAgICAgICAgICAgfSkpOw0KICAgICAgICAgICAgICAgIGlmKF9jeWNsZXMubGVuZ3RoKSA8JT13YXJuKCklPmZ1biArICIvX2N5Y2xlcyIsIF9jeWNsZXMpOw0KICAgICAgICAgICAgICAgIDwlPXNjb3BlJT4uX3VuUmVjdXJzZS48JT1uTmFtZShjKSU+W2Z1bl0uQ3ljbGljLnB1c2goLi4uX2N5Y2xlcyk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKG9wdGlvbnMuX21hcCkgX3RoaXMuX21hcChmaWVsZCwgdHlwZW9mKGVhT2JqKT09PSd1bmRlZmluZWQnLCBmdW4sIHR5cGVvZihlYU9iaik9PT0ndW5kZWZpbmVkJz9vYmo6ZWFPYmosIHR5cGVvZihlYU9iaik9PT0ndW5kZWZpbmVkJz9fdGhpczpvYmosIGVhQ29kZSk7DQoNCiAgICAgICAgICAgIHJldHVybiBfcmV0Ow0KICAgICAgICB9Y2F0Y2goZXgpew0KICAgICAgICAgICAgPCU9ZXJyb3IoKSU+ZnVuLCBmaWVsZCwgZXgpOw0KICAgICAgICB9DQo8JSB9JT4NCgl9DQoJDQoJPCU9bU5hbWU9J19faW1wb3J0JyU+KG9iaiwgb3B0aW9ucywgZnVuLCAuLi5mQXJncykgew0KICAgICAgICBpZih0eXBlb2Yob2JqKSE9PSdvYmplY3QnKXsNCiAgICAgICAgICAgIDwlPXdhcm4oKSU+YCR7ZnVufTogTm90IGFuIG9iamVjdDogJHt0eXBlb2Yob2JqKX1gLCBvYmopOw0KICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgIH0NCgkgICAgDQogICAgICAgIGxldCBlYUNvZGVzID0ge307DQoNCgkJdGhpcy5fX29wdGlvbnMoIklkIiwgb2JqLCBlYUNvZGVzLklkID0gKG9wdGlvbnMuX21hcD90aGlzLl9uQ29kZSgnSWQnKTonSWQnKSwgdW5kZWZpbmVkLCB0aGlzLCBvcHRpb25zLCBmdW4pOw0KCQkNCjwlIGMuRW50aXR5QXR0cmlidXRlcy5maWx0ZXIoZWEgPT4gIWVhLkVudGl0eU1ldGhvZCAmJiAhZWEuRW50aXR5VHlwZSkuZm9yRWFjaChlYSA9PiB7JT4NCiAgICAgICAgdGhpcy5fX29wdGlvbnMoIjwlPW5OYW1lKGVhKSU+Iiwgb2JqLCBlYUNvZGVzLjwlPW5OYW1lKGVhKSU+ID0gKG9wdGlvbnMuX21hcD88JT1fbkNvZGUoZWEpJT46PCVfdkNvZGUoZWEpJT4pLCB1bmRlZmluZWQsIHRoaXMsIG9wdGlvbnMsIGZ1biwgIjwlPV9jRmllbGQoZWEpJT4iKTsNCjwlIH0pJT4NCg0KPCUgYy5FbnRpdHlBdHRyaWJ1dGVzLmZpbHRlcihlYSA9PiAhZWEuRW50aXR5TWV0aG9kICYmIGVhLkVudGl0eVR5cGUgJiYgZWEuSXNVbmlxdWUpLmZvckVhY2goZWEgPT4geyU+DQogICAgICAgIHRoaXMuX19vcHRpb25zKCI8JT1uTmFtZShlYSklPiIsIG9iaiwgZWFDb2Rlcy48JT1uTmFtZShlYSklPiA9IChvcHRpb25zLl9tYXA/PCU9X25Db2RlKGVhKSU+OjwlX3ZDb2RlKGVhKSU+KSwgdW5kZWZpbmVkLCB0aGlzLCBvcHRpb25zLCBmdW4sICI8JT1fY0ZpZWxkKGVhKSU+Iik7DQo8JSB9KSU+DQoNCgkJPCUgdW5SZWN1cnNlKCd0aGlzJywgJ2Z1bicsICdmQXJncycsICdpZih0eXBlb2Yob3B0aW9ucy5pbXBvcnRlcik9PT0iZnVuY3Rpb24iKSBvcHRpb25zLmltcG9ydGVyKHYpJyklPg0KDQo8JSBjLkVudGl0eUF0dHJpYnV0ZXMuZmlsdGVyKGVhID0+ICFlYS5FbnRpdHlNZXRob2QgJiYgZWEuRW50aXR5VHlwZSAmJiAhZWEuSXNVbmlxdWUpLmZvckVhY2goZWEgPT4geyU+DQogICAgICAgIHRoaXMuX19vcHRpb25zKCI8JT1uTmFtZShlYSklPiIsIG9iaiwgZWFDb2Rlcy48JT1uTmFtZShlYSklPiA9IChvcHRpb25zLl9tYXA/PCU9X25Db2RlKGVhKSU+OjwlX3ZDb2RlKGVhKSU+KSwgdW5kZWZpbmVkLCB0aGlzLCBvcHRpb25zLCBmdW4sICI8JT1fY0ZpZWxkKGVhKSU+Iik7DQo8JSB9KSU+DQoNCgkJdGhpcy5fX29wdGlvbnMoIl9USElTIiwgb2JqLCBlYUNvZGVzLl9USElTID0gKG9wdGlvbnMuX21hcD90aGlzLl9uQ29kZSgnX1RISVMnKTonX1RISVMnKSwgdW5kZWZpbmVkLCB0aGlzLCBvcHRpb25zLCBmdW4pOw0KDQo8JSBjLlR5cGVkQXR0cmlidXRlcy5maWx0ZXIodGEgPT4gIXRhLkVudGl0eU1ldGhvZCkuZm9yRWFjaCh0YSA9PiB7DQogICAgbGV0IHRhTmFtZSA9IG5OYW1lKHRhKSArICdfJyArIHRhLkVudGl0eUNsYXNzLlBsdXJhbC5yZXBsYWNlKC8gL2csICdfJyk7DQolPg0KICAgICAgICB0aGlzLl9fb3B0aW9ucygiPCU9dGFOYW1lJT4iLCBvYmosIGVhQ29kZXMuPCU9dGFOYW1lJT4gPSAob3B0aW9ucy5fbWFwPzwlPV9uQ29kZSh0YSwgdHJ1ZSklPjoiPCU9dGFOYW1lJT4iKSwgdW5kZWZpbmVkLCB0aGlzLCBvcHRpb25zLCBmdW4sICI8JT1fY0ZpZWxkKHRhKSU+Iik7DQo8JSB9KSU+DQoNCiAgICAgICAgT2JqZWN0LmtleXMob3B0aW9ucykuZmlsdGVyKGsgPT4gdHlwZW9mKG9wdGlvbnNba10pPT09J2Z1bmN0aW9uJyAmJiAhT2JqZWN0LmtleXMoZWFDb2RlcykuaW5jbHVkZXMoaykpLmZvckVhY2goayA9PiB0aGlzLl9fb3B0aW9ucyhrLCBvYmosIGssIHVuZGVmaW5lZCwgdGhpcywgb3B0aW9ucywgZnVuKSk7DQoNCgkJcmV0dXJuIHRoaXM7DQoJfQ0KDQo8JSBpZihtYWluQ2xhc3MoWydOZW80aiddKSl7JT4NCiAgICA8JT1tTmFtZT0nX3RvQ3lUYWJsZSclPigpew0KICAgICAgICBsZXQgcmV0ID0gdGhpcy5fX2V4cG9ydCh7Y3FsOiBgDQpDUkVBVEUgQ09OU1RSQUlOVCBJRiBOT1QgRVhJU1RTIEZPUiAobzokezwlPV9uQ29kZSgpJT59KSBSRVFVSVJFIG8uJHt0aGlzLl9fY29uZmlnKCdpZEZpZWxkJywgJ0lkJyl9IElTIFVOSVFVRTsNCkNSRUFURSBDT05TVFJBSU5UIElGIE5PVCBFWElTVFMgRk9SIChvOiR7PCU9X25Db2RlKCklPn0pIFJFUVVJUkUgby4ke3RoaXMuX19jb25maWcoJ2lkRmllbGQnLCAnSWQnKX0gSVMgTk9UIE5VTEw7DQogICAgICAgIGB9LCB7DQogICAgICAgICAgICBGdWxsOiB0cnVlLA0KICAgICAgICAgICAgTnVsbDogdHJ1ZSwNCiAgICA8JSBjLkVudGl0eUF0dHJpYnV0ZXMuZmlsdGVyKGVhID0+ICFlYS5FbnRpdHlNZXRob2QpLmZvckVhY2goZWEgPT4geyU+DQogICAgICAgICAgICAiPCU9bk5hbWUoZWEpJT4iOiAob2JqLCBlYUNvZGUsIHYpID0+IHsNCiAgICAgICAgPCUgaWYoZWEuRW50aXR5VHlwZSl7JT4NCiAgICAgICAgICAgICAgICBvYmouY3FsICs9IHY/di48JT1tTmFtZSU+KCk6Jyc7DQogICAgICAgIDwlIH1lbHNlIGlmKGVhLklzVW5pcXVlKXslPg0KICAgICAgICAgICAgICAgIG9iai5jcWwgKz0gYENSRUFURSBDT05TVFJBSU5UIElGIE5PVCBFWElTVFMgRk9SIChvOiR7PCU9X25Db2RlKCklPn0pIFJFUVVJUkUgby4ke2VhQ29kZX0gSVMgVU5JUVVFOw0KYA0KICAgICAgICA8JSB9JT4NCiAgICAgICAgICAgIH0sDQogICAgPCUgfSk7ICU+DQogICAgPCUgYy5UeXBlZEF0dHJpYnV0ZXMuZm9yRWFjaCh0YSA9PiB7IGxldCB0YU5hbWUgPSBuTmFtZSh0YSkgKyAnXycgKyB0YS5FbnRpdHlDbGFzcy5QbHVyYWwucmVwbGFjZSgvIC9nLCAnXycpOyU+DQogICAgICAgICAgICA8JT10YU5hbWUlPjogKG9iaiwgZWFDb2RlLCB2KSA9PiBvYmouY3FsICs9IHYubWFwKF92ID0+IF92LjwlPW1OYW1lJT4oKSkuam9pbignXG4nKSwNCiAgICA8JSB9KSU+DQogICAgICAgIH0sICI8JT1tTmFtZSU+Iik7DQoNCiAgICAgICAgPCU9bG9nKCklPnJldC5jcWwpOw0KICAgICAgICByZXR1cm4gcmV0LmNxbDsNCiAgICB9DQogICAgDQogICAgPCU9bU5hbWU9J190b0N5TWVyZ2UnJT4oZmllbGRzLCBiUmF3KXsNCiAgICAgICAgbGV0IG9iaiA9IHRoaXMuX3RvREJPYmplY3QoZmllbGRzLCB0cnVlKTsNCiAgICAgICAgbGV0IHVrZXlzID0gW107DQogICAgPCUgYy5FbnRpdHlBdHRyaWJ1dGVzLmZpbHRlcihlYSA9PiAhZWEuRW50aXR5TWV0aG9kICYmIGVhLklzVW5pcXVlKS5mb3JFYWNoKGVhID0+IHslPg0KICAgICAgICBpZig8JXZhbHVlT2YoZWEuSXNVbmlxdWUpJT4pIHVrZXlzLnB1c2goPCU9X25Db2RlKGVhKSU+KTsNCiAgICA8JSB9KSU+DQogICAgICAgIGxldCBjcWwgPSBgOiR7PCU9X25Db2RlKCklPn0ge2AgKyBPYmplY3Qua2V5cyhvYmopLmZpbHRlcihrID0+IHVrZXlzLmluY2x1ZGVzKGspKS5tYXAoayA9PiBrICsgIjogIiArIG9ialtrXSkuam9pbignLCAnKSArIGB9KWA7DQogICAgICAgIA0KICAgICAgICBpZighYlJhdyl7DQogICAgICAgICAgICBsZXQgbWF0Y2ggPSAnXG5NQVRDSCAobycgKyBjcWw7DQogICAgICAgICAgICBjcWwgPSAnTUVSR0UgKG8nICsgY3FsOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBsZXQgb25TZXQgPSBPYmplY3Qua2V5cyhvYmopLmZpbHRlcihrID0+ICF1a2V5cy5pbmNsdWRlcyhrKSkubWFwKGsgPT4gIm8uIiArIGsgKyAiPSIgKyBvYmpba10pLmpvaW4oJywgJykNCiAgICAgICAgICAgIGNxbCArPSAnXG5PTiBDUkVBVEUgU0VUICcgKyBvblNldCArICdcbk9OIE1BVENIIFNFVCAnICsgb25TZXQ7DQogICAgICAgICAgICBjcWwgKz0gJ1xuUkVUVVJOIG87JzsNCg0KICAgIDwlIGMuRW50aXR5QXR0cmlidXRlcy5maWx0ZXIoZWEgPT4gIWVhLkVudGl0eU1ldGhvZCAmJiBlYS5FbnRpdHlUeXBlKS5mb3JFYWNoKGVhID0+IHslPg0KICAgICAgICAgICAgaWYodGhpcy5fPCU9bk5hbWUoZWEpJT5fc2V0KSBjcWwgKz0gbWF0Y2ggKyAnLCAnICsgdGhpcy48JT1uTmFtZShlYSklPigpLjwlPW1OYW1lJT4obnVsbCwgdHJ1ZSkucmVwbGFjZSgnKDonLCAnKDwlPW5OYW1lKGVhKSU+OicpICsgJyBNRVJHRSAobyktWzo8JT1uTmFtZShjKSU+XzwlPW5OYW1lKGVhKSU+XS0+KDwlPW5OYW1lKGVhKSU+KTsnOw0KICAgIDwlIH0pJT4NCiAgICAgICAgfWVsc2V7DQogICAgICAgICAgICBjcWwgPSAnKCcgKyBjcWw7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIDwlPWxvZygpJT5jcWwpOw0KICAgICAgICByZXR1cm4gY3FsOw0KICAgIH0NCg0KICAgIDwlPW1OYW1lPSdfdG9DeVF1ZXJ5JyU+KGZpZWxkcywgb2Jqcyl7DQogICAgICAgIGxldCBzcWwgPSAiTUFUQ0ggIjsNCiAgICAgICAgDQogICAgICAgIGxldCB0UHJlZiA9IGAke3RoaXMuX1EoKX0kezwlPV9uQ29kZSgpJT4udG9Mb3dlckNhc2UoKX0ke3RoaXMuX1EoKX1gOw0KDQogICAgICAgIGxldCBoZWFkZXIgPSB0aGlzLl90b1NlbGVjdEhlYWRlcihmaWVsZHMpOw0KDQogICAgICAgIHNxbCArPSBgICgke3RQcmVmfToke3RoaXMuX1EoKX0kezwlPV9uQ29kZSgpJT59JHt0aGlzLl9RKCl9KWA7DQogICAgICAgIA0KICAgICAgICBPYmplY3Qua2V5cyhoZWFkZXIuam9pbnMpLmZvckVhY2goayA9PiBzcWwgKz0gYCBPUFRJT05BTCBNQVRDSCAoJHt0aGlzLl9RKCl9JHtrfSR7dGhpcy5fUSgpfToke3RoaXMuX1EoKX0ke2hlYWRlci5qb2luc1trXS50YWJsZX0ke3RoaXMuX1EoKX0pIE9QVElPTkFMIE1BVENIICgke3RoaXMuX1EoKX0kezwlPV9uQ29kZSgpJT4udG9Mb3dlckNhc2UoKX0ke3RoaXMuX1EoKX0pLVs6JHt0aGlzLl9RKCl9JHtoZWFkZXIuam9pbnNba10udGFibGV9XyR7a30ke3RoaXMuX1EoKX1dLT4oJHt0aGlzLl9RKCl9JHtrfSR7dGhpcy5fUSgpfSlgKTsNCiAgICAgICAgDQoNCiAgICAgICAgLy9zcWwgKz0gT2JqZWN0LnZhbHVlcyhoZWFkZXIuZmllbGRzKS5tYXAoZiA9PiBgJHt0UHJlZn0uJHtmfWApLmpvaW4oJywgJyk7DQogICAgICAgIC8vT2JqZWN0LmtleXMoaGVhZGVyLmpvaW5zKS5mb3JFYWNoKGsgPT4gc3FsICs9ICIsICIgKyBPYmplY3QudmFsdWVzKGhlYWRlci5qb2luc1trXS5maWVsZHMpLm1hcChmID0+IGAke3RoaXMuX1EoKX0ke2hlYWRlci5qb2luc1trXS50YWJsZX1fJHtrfSR7dGhpcy5fUSgpfS4ke2Z9IGFzICR7dGhpcy5fUSgpfSR7a30uJHtmLnJlcGxhY2UodGhpcy5fUSgpLCAnJyl9YCkuam9pbignLCAnKSk7DQogICAgICAgIA0KICAgICAgICBpZih0aGlzLl9fZmllbGRBZ2dyZWdhdGVzKXsNCiAgICAgICAgICAgIC8vIHtmaWVsZDogZnVuY3Rpb259DQogICAgPCUgYy5FbnRpdHlBdHRyaWJ1dGVzLmZpbHRlcihlYSA9PiAhZWEuRW50aXR5TWV0aG9kICYmICFlYS5Jc1RleHQgJiYgIWVhLklzSW1hZ2UgJiYgIWVhLklzRmlsZSkuZm9yRWFjaChlYSA9PiB7ICU+DQogICAgICAgICAgICBpZih0aGlzLl9fZmllbGRBZ2dyZWdhdGVzLjwlPW5OYW1lKGVhKSU+KSBzcWwgKz0gYCR7c3FsPT0oJ3NlbGVjdCAnKT8nJzonLCd9ICR7dGhpcy5fX2ZpZWxkQWdncmVnYXRlcy48JT1uTmFtZShlYSklPn0oJHt0aGlzLl9RKCl9JHs8JT1fbkNvZGUoZWEpJT59JHt0aGlzLl9RKCl9KWA7DQogICAgPCUgfSklPg0KICAgICAgICB9DQoNCiAgICAgICAgc3FsICs9IGAgd2hlcmUgMT0xYDsNCg0KICAgICAgICBzcWwgPSB0aGlzLl9fZXhwb3J0KHtzcWw6IHNxbH0sIHsNCiAgICAgICAgICAgIF9maWVsZHM6ICh0aGlzLl9fc3luY19vbigpIHx8IHRoaXMuSWQ9PXRoaXMuSWQpP1snSWQnXTp1bmRlZmluZWQsDQogICAgICAgICAgICBOdWxsOiB0cnVlLA0KICAgICAgICAgICAgX1RISVM6IG9iaiA9PiB7DQogICAgICAgICAgICAgICAgaWYoIXRoaXMuX1RISVMgfHwgIXRoaXMuX1RISVMubGVuZ3RoKSByZXR1cm47DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgb2JqLnNxbCArPSBgIGFuZCAke3RQcmVmfS4ke3RoaXMuX1EoKX0ke3RoaXMuX19jb25maWcoJ2lkRmllbGQnLCAnSWQnKX0ke3RoaXMuX1EoKX0gYCArICh0aGlzLl9USElTX2Nvb3AgfHwgIklOIikgKyAiICgiICsgdGhpcy5fVEhJUy5tYXAodCA9PiB0LjwlPW1OYW1lJT4odC5fX2NvbmZpZygnaWRGaWVsZCcsICdJZCcpKSkuam9pbignIFVOSU9OIEFMTCAnKSArICIpIjsNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICBJZDogb2JqID0+IG9iai5zcWwgKz0gYCBhbmQgJHt0UHJlZn0uJHt0aGlzLl9RKCl9JHt0aGlzLl9fY29uZmlnKCdpZEZpZWxkJywgJ0lkJyl9JHt0aGlzLl9RKCl9PScke3RoaXMuSWR9J2AsDQogICAgPCUgYy5FbnRpdHlBdHRyaWJ1dGVzLmZpbHRlcihlYSA9PiAhZWEuRW50aXR5TWV0aG9kKS5mb3JFYWNoKGVhID0+IHsgJT4NCiAgICAgICAgICAgIDwlPW5OYW1lKGVhKSU+OiAob2JqLCBlYUNvZGUsIHYpID0+IHsNCiAgICAgICAgICAgICAgICBpZighdGhpcy5fPCU9bk5hbWUoZWEpJT5fc2V0KSByZXR1cm47DQogICAgICAgICAgICAgICAgDQogICAgICAgIDwlIGlmKGVhLkVudGl0eVR5cGUpeyU+DQogICAgICAgICAgICAgICAgbGV0IGNvb3AgPSB0aGlzLl88JT1uTmFtZShlYSklPl9jb29wOw0KICAgICAgICAgICAgICAgIHN3aXRjaChjb29wKXsNCiAgICAgICAgICAgICAgICAgICAgY2FzZSAiIT0iOg0KICAgICAgICAgICAgICAgICAgICAgICAgY29vcCA9ICJOT1QgIjsNCiAgICAgICAgICAgICAgICAgICAgY2FzZSAiPSI6DQogICAgICAgICAgICAgICAgICAgICAgICBjb29wID0gIiI7DQogICAgICAgICAgICAgICAgICAgIGNhc2UgIiI6DQogICAgICAgICAgICAgICAgICAgICAgICBjb29wID0gIiI7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIGlmKHYpew0KICAgICAgICAgICAgICAgICAgICBvYmouc3FsICs9IGAgYW5kICR7Y29vcH0gRVhJU1RTIHske3YuPCU9bU5hbWUlPigpfX1gOw0KICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICBvYmouc3FsICs9IGAgYW5kICgke3RQcmVmfS4ke3RoaXMuX1EoKX0ke2VhQ29kZX1pZCR7dGhpcy5fUSgpfSAke2Nvb3B9ICgwKSBPUiAke3RQcmVmfS4ke3RoaXMuX1EoKX0ke2VhQ29kZX1pZCR7dGhpcy5fUSgpfSBJUyBOVUxMKWA7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgPCUgfWVsc2UgaWYoZWEuSXNUZXh0IHx8IGVhLklzSW1hZ2UgfHwgZWEuSXNGaWxlKXslPg0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgPCUgfWVsc2V7JT4NCiAgICAgICAgICAgICAgICBvYmouc3FsICs9IGAgYW5kICR7dFByZWZ9LiR7dGhpcy5fUSgpfSR7ZWFDb2RlfSR7dGhpcy5fUSgpfSBgICsgPCVpZihlYS5Jc0Jvb2wpeyU+Ij0iPCV9ZWxzZXslPih0aGlzLl88JT1uTmFtZShlYSklPl9jb29wIHx8ICJDT05UQUlOUyIpPCV9JT4gKyAiICI7DQogICAgICAgIDwlIH0lPg0KICAgICAgICANCiAgICAgICAgPCUgaWYoZWEuSXNEYXRlKXsgJT4NCiAgICAgICAgICAgICAgICBpZih2ICYmIHYudG9JU09TdHJpbmcpew0KICAgICAgICAgICAgICAgICAgICBpZih0aGlzLl9fY29uZmlnKCd0eXBlJyk9PSdzcWxpdGUnKXsNCiAgICAgICAgICAgICAgICAgICAgICAgIG9iai5zcWwgKz0gInN0cmZ0aW1lKCclcycsICciICsgdi50b0lTT1N0cmluZygpICsgIicpIjsNCiAgICAgICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgICAgICBvYmouc3FsICs9ICInIiArIHYudG9JU09TdHJpbmcoKSArICInIjsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICA8JSB9ZWxzZSBpZihlYS5Jc1N0cmluZyl7ICU+DQogICAgICAgICAgICAgICAgaWYodHlwZW9mKHYpPT09InN0cmluZyIpew0KICAgICAgICAgICAgICAgICAgICBvYmouc3FsICs9ICInIiArICgodGhpcy5fPCU9bk5hbWUoZWEpJT5fY29vcD09IkxJS0UiIHx8ICF0aGlzLl88JT1uTmFtZShlYSklPl9jb29wKT8iJSI6IiIpICsgdiArICgodGhpcy5fPCU9bk5hbWUoZWEpJT5fY29vcD09IkxJS0UiIHx8ICF0aGlzLl88JT1uTmFtZShlYSklPl9jb29wKT8iJSI6IiIpICsgIiciOw0KICAgICAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICA8JSB9ZWxzZSBpZihlYS5Jc0Jvb2wpeyAlPg0KICAgICAgICAgICAgICAgIGlmKHR5cGVvZih2KT09PSJib29sZWFuIil7DQogICAgICAgICAgICAgICAgICAgIG9iai5zcWwgKz0gIiciICsgKHY/IjEiOiIwIikgKyAiJyI7DQogICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIDwlIH0gJT4NCiAgICAgICAgICAgICAgICBpZih2ICYmIHYuRW50aXR5Q2xhc3Mpew0KICAgICAgICAgICAgICAgICAgICBvYmouc3FsICs9ICIoIiArIHYuPCU9bU5hbWUlPigpICsgIikiOw0KICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICBvYmouc3FsICs9ICInIiArIHYgKyAiJyI7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSwNCiAgICA8JSB9KTsgJT4NCiAgICA8JSBjLlR5cGVkQXR0cmlidXRlcy5mb3JFYWNoKHRhID0+IHsgbGV0IHRhTmFtZSA9IG5OYW1lKHRhKSArICdfJyArIHRhLkVudGl0eUNsYXNzLlBsdXJhbC5yZXBsYWNlKC8gL2csICdfJyk7JT4NCiAgICAgICAgICAgIDwlPXRhTmFtZSU+OiAob2JqLCBlYUNvZGUsIHYpID0+IHsNCiAgICAgICAgICAgICAgICBpZighdGhpcy5fPCU9dGFOYW1lJT5fc2V0KSByZXR1cm47DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgbGV0IHNxdWVyaWVzID0gKHYgfHwgW10pLmZpbHRlcih0ID0+IHQpLm1hcCh0ID0+IHQuPCU9bU5hbWUlPigiPCU9bk5hbWUodGEpJT4uaWQiKSk7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgbGV0IGpPUCA9ICdVTklPTiBBTEwnOw0KICAgICAgICAgICAgICAgIGxldCBpbk9QID0gJ0lOJzsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICBvYmouc3FsICs9IGBgOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIGlmKHRoaXMuXzwlPXRhTmFtZSU+X2Nvb3A9PSchPScgfHwgdGhpcy5fPCU9dGFOYW1lJT5fY29vcD09J05PVCBJTicpew0KICAgICAgICAgICAgICAgICAgICBpbk9QID0gJ05PVCBJTic7DQogICAgICAgICAgICAgICAgfWVsc2UgaWYodGhpcy5fPCU9dGFOYW1lJT5fY29vcD09Jz0nIHx8IHRoaXMuXzwlPXRhTmFtZSU+X2Nvb3A9PSdJTicpew0KICAgICAgICAgICAgICAgIH1lbHNlIGlmKHRoaXMuXzwlPXRhTmFtZSU+X2Nvb3A9PSc9PScpew0KICAgICAgICAgICAgICAgICAgICBqT1AgPSAnSU5URVJTRUNUJzsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgb2JqLnNxbCArPSBgYW5kIC8qPCU9dGFOYW1lJT4qLyAke3RQcmVmfS4ke3RoaXMuX1EoKX0ke3RoaXMuX19jb25maWcoJ2lkRmllbGQnLCAnSWQnKX0ke3RoaXMuX1EoKX0gJHtpbk9QfSAoYCArIHNxdWVyaWVzLmpvaW4oYCAke2pPUH0vKk0yTSovIGApICsgJyknOw0KICAgICAgICAgICAgfSwNCiAgICA8JSB9KSU+DQogICAgICAgIH0sICI8JT1tTmFtZSU+IiwgZmllbGRzKS5zcWw7DQoNCiAgICAgICAgaWYodGhpcy5fX2ZpZWxkR3JvdXBzKXsNCiAgICAgICAgICAgIGlmKE9iamVjdC5rZXlzKHRoaXMuX19maWVsZEdyb3VwcykubGVuZ3RoKSBzcWwgKz0gIiBncm91cCBieSAiOw0KICAgIDwlIGMuRW50aXR5QXR0cmlidXRlcy5maWx0ZXIoZWEgPT4gIWVhLkVudGl0eU1ldGhvZCAmJiAhZWEuSXNUZXh0ICYmICFlYS5Jc0ltYWdlICYmICFlYS5Jc0ZpbGUpLmZvckVhY2goZWEgPT4geyAlPg0KICAgICAgICAgICAgaWYodGhpcy5fX2ZpZWxkR3JvdXBzLjwlPW5OYW1lKGVhKSU+KSBzcWwgKz0gYCR7dGhpcy5fUSgpfSR7PCU9X25Db2RlKGVhKSU+PCU9KGVhLkVudGl0eVR5cGU/JysiaWQiJzonJyklPn0ke3RoaXMuX1EoKX0gJHt0aGlzLl9fZmllbGRHcm91cHMuPCU9bk5hbWUoZWEpJT59YDsNCiAgICA8JSB9KSU+DQogICAgICAgIH0NCg0KICAgICAgICBpZihzcWwuZW5kc1dpdGgoIndoZXJlIDE9MSIpKXsNCiAgICAgICAgICAgIC8vIHNxbCA9IHNxbC5yZXBsYWNlKCJ3aGVyZSAxPTEiLCAid2hlcmUgMT0wIik7DQogICAgICAgIH1lbHNlew0KICAgICAgICAgICAgc3FsID0gc3FsLnJlcGxhY2UoIndoZXJlIDE9MSBhbmQgIiwgIndoZXJlICIpOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICBzcWwgKz0gJyByZXR1cm4gJyArIFt0UHJlZl0uY29uY2F0KE9iamVjdC5rZXlzKGhlYWRlci5qb2lucykubWFwKGsgPT4gYCR7dGhpcy5fUSgpfSR7a30ke3RoaXMuX1EoKX1gKSkuam9pbignLCAnKTsNCiAgICAgICAgDQogICAgICAgIDwlPWxvZygpJT5zcWwpOw0KICAgICAgICANCiAgICAgICAgcmV0dXJuIHNxbDsNCiAgICB9DQoNCiAgICBhc3luYyA8JT1tTmFtZT0nX25lbzRqJyU+KGNxbCl7DQogICAgPCUgaWYobWFpbkNsYXNzKFsnTmVvNGonXSk9PWMpeyU+DQogICAgICAgIGxldCBzZXNzaW9uID0gbnVsbDsNCiAgICAgICAgbGV0IHJldCA9IFtdOw0KICAgICAgICB0cnl7DQogICAgICAgICAgICBpZighdGhpcy5Ub29sLmRiIHx8ICFjcWwgfHwgIWNxbC50cmltKCkpew0KICAgICAgICAgICAgICAgIGlmKCF0aGlzLlRvb2wuZGIpIDwlPWxvZygpJT5jcWwsICIgPD09U0tJUFBFRD09PiIpOw0KICAgICAgICAgICAgICAgIHJldHVybiBbXTsNCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKGNxbC5pbmRleE9mKCc7XG4nKT4wKXsNCiAgICAgICAgICAgICAgICBmb3IgYXdhaXQgKGNvbnN0IHNxbFMgb2YgY3FsLnNwbGl0KCc7XG4nKSl7DQogICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuPCU9bU5hbWUlPihzcWxTLnRyaW0oKSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgbGV0IGJTdG9yZSA9IFsiTUVSR0UiLCAiQ1JFQVRFIiwgIlVQREFURSJdLmZpbHRlcihuID0+IGNxbC5pbmRleE9mKG4pPj0wKS5maW5kKG4gPT4gbik7DQogICAgICAgICAgICBsZXQgYkRNTCA9IFsiQ09OU1RSQUlOVCJdLmZpbHRlcihuID0+IGNxbC5pbmRleE9mKG4pPj0wKS5maW5kKG4gPT4gbik7DQoNCiAgICAgICAgICAgIGlmKGJETUwpew0KICAgICAgICAgICAgICAgIHRoaXMuVG9vbC5kbWxDYWNoZSA9IHRoaXMuVG9vbC5kbWxDYWNoZSB8fCB7fTsNCiAgICAgICAgICAgICAgICBpZih0aGlzLlRvb2wuZG1sQ2FjaGVbdGhpcy5oYXNoQ29kZShjcWwpXSkgcmV0dXJuOw0KICAgICAgICAgICAgICAgIHRoaXMuVG9vbC5kbWxDYWNoZVt0aGlzLmhhc2hDb2RlKGNxbCldID0gY3FsOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBzZXNzaW9uID0gdGhpcy5Ub29sLmRiLnNlc3Npb24oeyBkYXRhYmFzZTogdGhpcy5fX2NvbmZpZygnZGF0YWJhc2UnKSB9KTsNCiAgICAgICAgICAgIGxldCBmdW4gPSAnUmVhZCc7DQogICAgICAgICAgICBpZihiU3RvcmUgfHwgYkRNTCkgZnVuID0gJ1dyaXRlJzsNCiAgICAgICAgICAgIGlmKGZ1bj09J1dyaXRlJykgdGhpcy5Ub29sLl9fZG1sU3RhdGVtZW50cy5wdXNoKGNxbCk7DQogICAgICAgICAgICA8JT1sb2coKSU+Y3FsKTsNCiAgICAgICAgICAgIC8vcmV0ID0gKGF3YWl0IHNlc3Npb25bJ2V4ZWN1dGUnK2Z1bl0odHggPT4gdHgucnVuKGNxbCkpKS5yZWNvcmRzOw0KICAgICAgICAgICAgLy88JT1sb2coKSU+cmV0KTsNCiAgICAgICAgfWNhdGNoKGV4KXsNCiAgICAgICAgICAgIDwlPWVycm9yKCklPmV4KTsNCiAgICAgICAgfQ0KICAgICAgICBpZihzZXNzaW9uKSBhd2FpdCBzZXNzaW9uLmNsb3NlKCk7DQogICAgICAgIHJldHVybiByZXQ7DQogICAgPCUgfWVsc2V7JT4NCiAgICAgICAgcmV0dXJuIGF3YWl0IG5ldyA8JT1zY29wZSU+LjwlPW5OYW1lKG1haW5DbGFzcyhbJ05lbzRqJ10pKSU+KCkuPCU9bU5hbWUlPihjcWwpOw0KICAgIDwlIH0lPg0KICAgIH0NCjwlIH0lPg0KDQo8JSBpZihtYWluQ2xhc3MoWydSeERCJywgJ01vbmdvREInXSkpeyU+DQogICAgPCU9bU5hbWU9J190b0pTT05TY2hlbWEnJT4oKXsNCiAgICAgICAgdHJ5ew0KICAgICAgICAgICAgbGV0IHR5cGUgPSB0aGlzLl9fY29uZmlnKCdqc29uLnR5cGUnLCAndHlwZScpOw0KICAgICAgICAgICAgbGV0IHNjaGVtYSA9IHsNCiAgICAgICAgICAgICAgICAkaWQ6ICc8JT1jLklkJT4nLA0KICAgICAgICAgICAgICAgICRzY2hlbWE6ICJodHRwczovL2pzb24tc2NoZW1hLm9yZy9kcmFmdC8yMDIwLTEyL3NjaGVtYSIsDQogICAgICAgICAgICAgICAgZGVzY3JpcHRpb246ICc8JT1jLlJlbWFyayU+JywNCiAgICAgICAgICAgICAgICB0aXRsZTogPCU9X25Db2RlKCklPiwNCiAgICAgICAgICAgICAgICBbdHlwZV06ICdvYmplY3QnLA0KICAgICAgICAgICAgICAgIHZlcnNpb246IDAsDQogICAgICAgICAgICAgICAgcHJvcGVydGllczogew0KICAgICAgICA8JSBjLkVudGl0eUF0dHJpYnV0ZXMuZmlsdGVyKGVhID0+ICFlYS5FbnRpdHlNZXRob2QpLmZvckVhY2goZWEgPT4geyU+DQogICAgICAgICAgICAgICAgICAgIFs8JT1fbkNvZGUoZWEpJT5dOiB7DQogICAgICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogIjwlPWVhLlJlbWFyayU+IiwNCiAgICAgICAgICAgIDwlIGlmKGVhLklzQXJyYXkpeyU+DQogICAgICAgICAgICAgICAgICAgICAgICBbdHlwZV06IHRoaXMuX19jb25maWcoJ2pzb24udHlwZS5hcnJheScsICdhcnJheScpLA0KICAgICAgICAgICAgICAgICAgICAgICAgaXRlbXM6IHsNCiAgICAgICAgICAgIDwlIH0lPg0KICAgICAgICAgICAgPCUgaWYoZWEuRW50aXR5VHlwZSl7JT4NCiAgICAgICAgICAgICAgICAgICAgICAgICRyZWY6ICc8JT1lYS5FbnRpdHlDbGFzcy5JZCU+JywNCiAgICAgICAgICAgIDwlIH1lbHNlIGlmKGVhLklzU3RyaW5nKXslPg0KICAgICAgICAgICAgICAgICAgICAgICAgW3R5cGVdOiB0aGlzLl9fY29uZmlnKCdqc29uLnR5cGUuc3RyaW5nJywgJ3N0cmluZycpLA0KICAgICAgICAgICAgPCUgfWVsc2UgaWYoZWEuSXNUZXh0KXslPg0KICAgICAgICAgICAgICAgICAgICAgICAgW3R5cGVdOiB0aGlzLl9fY29uZmlnKCdqc29uLnR5cGUudGV4dCcsICdzdHJpbmcnKSwNCiAgICAgICAgICAgIDwlIH1lbHNlIGlmKGVhLklzQm9vbCl7JT4NCiAgICAgICAgICAgICAgICAgICAgICAgIFt0eXBlXTogdGhpcy5fX2NvbmZpZygnanNvbi50eXBlLmJvb2wnLCAnYm9vbGVhbicpLA0KICAgICAgICAgICAgPCUgfWVsc2UgaWYoZWEuSXNJbnQpeyU+DQogICAgICAgICAgICAgICAgICAgICAgICBbdHlwZV06IHRoaXMuX19jb25maWcoJ2pzb24udHlwZS5pbnQnLCAnaW50ZWdlcicpLA0KICAgICAgICAgICAgPCUgfWVsc2UgaWYoZWEuSXNGbG9hdCl7JT4NCiAgICAgICAgICAgICAgICAgICAgICAgIFt0eXBlXTogdGhpcy5fX2NvbmZpZygnanNvbi50eXBlLmZsb2F0JywgJ251bWJlcicpLA0KICAgICAgICAgICAgPCUgfWVsc2UgaWYoZWEuSXNJbWFnZSl7JT4NCiAgICAgICAgICAgICAgICAgICAgICAgIFt0eXBlXTogdGhpcy5fX2NvbmZpZygnanNvbi50eXBlLmltYWdlJywgJ29iamVjdCcpLA0KICAgICAgICAgICAgPCUgfWVsc2UgaWYoZWEuSXNGaWxlKXslPg0KICAgICAgICAgICAgICAgICAgICAgICAgW3R5cGVdOiB0aGlzLl9fY29uZmlnKCdqc29uLnR5cGUuZmlsZScsICdvYmplY3QnKSwNCiAgICAgICAgICAgIDwlIH0lPg0KICAgICAgICAgICAgPCUgaWYoZWEuSXNBcnJheSl7JT4NCiAgICAgICAgICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICA8JSB9JT4NCiAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgPCUgfSklPg0KICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgcmVxdWlyZWQ6IFs8JWMuRW50aXR5QXR0cmlidXRlcy5maWx0ZXIoZWEgPT4gIWVhLkVudGl0eU1ldGhvZCAmJiBlYS5SZXF1aXJlZCkubWFwKGVhID0+IHslPjwlPV9uQ29kZShlYSklPjwlfSkuam9pbignLCcpJT5dLA0KICAgICAgICAgICAgfTsNCg0KICAgICAgICAgICAgPCU9bG9nKCklPnNjaGVtYSk7DQogICAgICAgICAgICByZXR1cm4gc2NoZW1hOw0KICAgICAgICB9Y2F0Y2goZXgpew0KICAgICAgICAgICAgPCU9ZXJyb3IoKSU+ZXgpOw0KICAgICAgICB9DQogICAgfQ0KPCUgfSU+DQoNCjwlIGlmKG1haW5DbGFzcyhbJ01vbmdvREInLCAnUnhEQicsICdaYW5nb0RCJ10pKXslPg0KICAgIDwlPW1OYW1lPSdfdG9TZWxlY3RNZGInJT4oKXsNCiAgICAgICAgcmV0dXJuIHRoaXMuX19leHBvcnQoe30sIHsNCiAgICAgICAgICAgIF9USElTOiBvYmogPT4gb2JqLl9pZCA9IHskaW46IHRoaXMuX1RISVMubWFwKHQgPT4gdC48JT1tTmFtZSU+KCkpfSwNCiAgICAgICAgICAgIElkOiBvYmogPT4gb2JqLl9pZCA9IHRoaXMuSWQsDQogICAgPCUgYy5FbnRpdHlBdHRyaWJ1dGVzLmZpbHRlcihlYSA9PiAhZWEuRW50aXR5TWV0aG9kICYmICFlYS5Jc1RleHQgJiYgIWVhLklzSW1hZ2UgJiYgIWVhLklzRmlsZSkuZm9yRWFjaChlYSA9PiB7ICU+DQogICAgICAgICAgICA8JT1uTmFtZShlYSklPjogKG9iaiwgZWFDb2RlLCB2KSA9PiB7DQogICAgICAgIDwlIGlmKGVhLkVudGl0eVR5cGUpeyU+DQogICAgICAgICAgICAgICAgaWYoIXYuPCU9bU5hbWUlPikgcmV0dXJuOw0KICAgICAgICA8JSB9JT4NCiAgICAgICAgICAgICAgICBvYmpbZWFDb2RlXSA9IHt9Ow0KICAgICAgICAgICAgICAgIGxldCBvcCA9ICIkZSI7DQogICAgICAgICAgICAgICAgc3dpdGNoKHRoaXMuXzwlPW5OYW1lKGVhKSU+X2Nvb3Apew0KICAgICAgICAgICAgICAgICAgICBjYXNlICI9IjoNCiAgICAgICAgICAgICAgICAgICAgICAgIG9wID0gIiRlIjsNCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICBjYXNlICI+IjoNCiAgICAgICAgICAgICAgICAgICAgICAgIG9wID0gIiRndCI7DQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgY2FzZSAiPCI6DQogICAgICAgICAgICAgICAgICAgICAgICBvcCA9ICIkbHQiOw0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgICAgIGNhc2UgIj49IjoNCiAgICAgICAgICAgICAgICAgICAgICAgIG9wID0gIiRndGUiOw0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgICAgIGNhc2UgIjw9IjoNCiAgICAgICAgICAgICAgICAgICAgICAgIG9wID0gIiRsdGUiOw0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgICAgIGNhc2UgIiE9IjoNCiAgICAgICAgICAgICAgICAgICAgICAgIG9wID0gIiRuZSI7DQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgY2FzZSAiSU4iOg0KICAgICAgICAgICAgICAgICAgICAgICAgb3AgPSAiJGluIjsNCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICBkZWZhdWx0Og0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICA8JSBpZihlYS5Jc0RhdGUpeyAlPg0KICAgICAgICAgICAgICAgIG9ialtlYUNvZGVdW29wXSA9IHYuPCU9bU5hbWUlPigpLnRvSVNPU3RyaW5nKCk7DQogICAgICAgIDwlIH1lbHNlIGlmKGVhLkVudGl0eVR5cGUpeyU+DQogICAgICAgICAgICAgICAgb2JqW2VhQ29kZV0gPSB2LjwlPW1OYW1lJT4oKTsNCiAgICAgICAgPCUgfWVsc2V7JT4NCiAgICAgICAgICAgICAgICBvYmpbZWFDb2RlXSA9IHY7DQogICAgICAgIDwlIH0gJT4NCiAgICAgICAgICAgIH0sDQogICAgPCUgfSk7ICU+DQogICAgPCUgYy5UeXBlZEF0dHJpYnV0ZXMuZm9yRWFjaCh0YSA9PiB7IGxldCB0YU5hbWUgPSBuTmFtZSh0YSkgKyAnXycgKyB0YS5FbnRpdHlDbGFzcy5QbHVyYWwucmVwbGFjZSgvIC9nLCAnXycpOyU+DQogICAgICAgICAgICA8JT10YU5hbWUlPjogKG9iaiwgZWFDb2RlLCB2KSA9PiBvYmpbZWFDb2RlXSA9IHskaW46IHYubWFwKHQgPT4gdC48JT1tTmFtZSU+KCkpfSwNCiAgICA8JSB9KSU+DQogICAgICAgIH0sICI8JT1tTmFtZSU+Iik7DQogICAgfQ0KPCUgfSU+DQoNCjwlIGlmKG1haW5DbGFzcyhfc3FsVG9vbHMpKXslPg0KICAgIDwlPW1OYW1lPSdfdG9EQk9iamVjdCclPihmaWVsZHMsIGJOb1JlZil7DQogICAgICAgIGlmKCF0aGlzLklkKXsNCiAgICAgICAgICAgIDwlPWVycm9yKCklPiJJbnZhbGlkIElEIiwgdGhpcy5FbnRpdHlDbGFzcy5OYW1lLCB0aGlzLlRvb2wpOw0KICAgICAgICB9DQogICAgICAgIGxldCByZXQgPSB7DQogICAgICAgICAgICBbdGhpcy5fX2NvbmZpZygnaWRGaWVsZCcsICdJZCcpXTogIiciICsgdGhpcy5JZCArICInIg0KICAgICAgICB9Ow0KICAgIDwlIGMuRW50aXR5QXR0cmlidXRlcy5maWx0ZXIoZWEgPT4gIWVhLkVudGl0eU1ldGhvZCkuZm9yRWFjaChlYSA9PiB7ICU+DQogICAgICAgIGlmKCgoZmllbGRzICYmIGZpZWxkcy5pbmRleE9mKCI8JT1lYS5OYW1lJT4iKSkgfHwgIWZpZWxkcykgJiYgdGhpcy5fPCU9bk5hbWUoZWEpJT5fc2V0ICYmICghYk5vUmVmIHx8IDwlPWVhLkVudGl0eVR5cGU/J2ZhbHNlJzondHJ1ZSclPikpew0KICAgICAgICAgICAgbGV0IGZWYWx1ZSA9IG51bGw7DQogICAgICAgICAgICBsZXQgdiA9IHRoaXMuPCU9bk5hbWUoZWEpJT4oKTsNCiAgICAgICAgPCUgaWYoZWEuRW50aXR5VHlwZSl7JT4NCiAgICAgICAgICAgIGlmKHYgJiYgKHYuX19zeW5jX29uKCkgfHwgdi5JZD09di5JZCkpew0KICAgICAgICAgICAgICAgIGZWYWx1ZSA9ICInIiArIHYuSWQgKyAiJyI7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICBmVmFsdWUgPSAiTlVMTCI7DQogICAgICAgICAgICB9DQogICAgICAgIDwlIH1lbHNlIGlmKGVhLklzQm9vbCl7JT4NCiAgICAgICAgICAgIGZWYWx1ZSA9IHY/MTowOw0KICAgICAgICAgICAgaWYodGhpcy5Ub29sLnR5cGUubmFtZT09J05lbzRqJykgZlZhbHVlID0gZlZhbHVlPydUcnVlJzonRmFsc2UnOw0KICAgICAgICAgICAgaWYodGhpcy5Ub29sLnR5cGUubmFtZT09J1NxbERCJykgZlZhbHVlID0gIiciICsgZlZhbHVlICsgIiciOw0KICAgICAgICA8JSB9ZWxzZSBpZihlYS5Jc0ludCB8fCBlYS5Jc0xvbmcgfHwgZWEuSXNGbG9hdCl7JT4NCiAgICAgICAgICAgIGZWYWx1ZSA9IHYgfHwgJzAnOw0KICAgICAgICA8JSB9ZWxzZSBpZihlYS5Jc0RhdGUpeyU+DQogICAgICAgICAgICB0cnl7DQogICAgICAgICAgICAgICAgZlZhbHVlID0gIiciICsgKHY/di50b0lTT1N0cmluZygpOiIxOTcwLTEtMSIpICsgIiciOw0KICAgICAgICAgICAgICAgIGlmKHRoaXMuX19jb25maWcoJ3R5cGUnKT09J215c3FsJyl7DQogICAgICAgICAgICAgICAgICAgIGZWYWx1ZSA9IGBTVFJfVE9fREFURSgke2ZWYWx1ZX0sICclWS0lbS0lZFQlVC4lZlonKWA7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfWNhdGNoKGV4KXsNCiAgICAgICAgICAgICAgICBmVmFsdWUgPSAiJyIgKyB2ICsgIiciOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYodGhpcy5Ub29sLnR5cGUubmFtZT09J05lbzRqJykgZlZhbHVlID0gJ2RhdGV0aW1lKCcgKyBmVmFsdWUgKyAnKSc7DQogICAgICAgIDwlIH1lbHNlIGlmKGVhLklzT2JqZWN0KXslPg0KICAgICAgICAgICAgZlZhbHVlID0gIiciICsgSlNPTi5zdHJpbmdpZnkodiwgbnVsbCwgJ1x0JykgKyAiJyI7DQogICAgICAgIDwlIH1lbHNlIGlmKGVhLklzU3RyaW5nKXslPg0KICAgICAgICAgICAgZlZhbHVlID0gdj09PW51bGw/Ik5VTEwiOigiJyIgKyAoKGZhbHNlICYmIHYgJiYgdi5yZXBsYWNlKT92LnJlcGxhY2UoL1xcbi9nLCAiXFxcXG4iKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAucmVwbGFjZSgvXFwnL2csICJcXFxcJyIpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKC9cXCIvZywgJ1xcXFwiJykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLnJlcGxhY2UoL1xcJi9nLCAiXFxcXCYiKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAucmVwbGFjZSgvXFxyL2csICJcXFxcciIpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKC9cXHQvZywgIlxcXFx0IikNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLnJlcGxhY2UoL1xcYi9nLCAiXFxcXGIiKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAucmVwbGFjZSgvXFxmL2csICJcXFxcZiIpICA6dikgKyAiJyIpOw0KICAgICAgICA8JSB9ZWxzZSBpZihlYS5Jc1RleHQpeyU+DQogICAgICAgICAgICBpZih2PT09bnVsbCl7DQogICAgICAgICAgICAgICAgZlZhbHVlID0gIk5VTEwiOw0KICAgICAgICAgICAgfWVsc2UgaWYodGhpcy5Ub29sLnR5cGUubmFtZT09J1NxbERCJyl7DQogICAgICAgICAgICAgICAgaWYodGhpcy5fX2NvbmZpZygndHlwZScpPT0nbXlzcWwnKXsNCiAgICAgICAgICAgICAgICAgICAgZlZhbHVlID0gYEZST01fQkFTRTY0KCcke3RoaXMuX2J0b2Eodil9JylgOw0KICAgICAgICAgICAgICAgIH1lbHNlIGlmKHRoaXMuX19jb25maWcoJ3R5cGUnKT09J3NxbGl0ZScpew0KICAgICAgICAgICAgICAgICAgICBmVmFsdWUgPSBgY2FzdCh1bmhleCgnJHt2LnNwbGl0KCIiKS5tYXAoeCA9PiAoMjU2ICsgeC5jaGFyQ29kZUF0KCkpLnRvU3RyaW5nKDE2KS5zdWJzdHIoLTIpKS5qb2luKCIiKX0nKSBhcyB2YXJjaGFyKWA7DQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIGZWYWx1ZSA9IHY7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgZlZhbHVlID0gIiciICsgdiArICInIjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgPCUgfWVsc2V7ICU+DQogICAgICAgICAgICBmVmFsdWUgPSAiJyIgKyB2ICsgIiciOw0KICAgICAgICA8JSB9ICU+DQogICAgICAgICAgICANCiAgICAgICAgICAgIHJldFs8JT1fbkNvZGUoZWEpJT4gKyAiPCU9KGVhLkVudGl0eVR5cGU/J2lkJzonJyklPiJdID0gZlZhbHVlOw0KICAgICAgICB9DQogICAgPCUgfSk7ICU+DQogICAgDQogICAgICAgIDwlPWxvZygpJT5yZXQpOw0KICAgICAgICByZXR1cm4gcmV0Ow0KICAgIH0NCjwlIH0lPg0KDQo8JSBpZihtYWluQ2xhc3MoWydCSVNlcnZlciddKSl7JT4NCiAgICBhc3luYyA8JT1tTmFtZT0nZ2V0JyU+KG5hbWUpIHsNCiAgICAgICAgaWYgKCF0aGlzLklkKSByZXR1cm4gbnVsbDsNCiAgICAgICAgdmFyIHQgPSBudWxsOw0KICAgICAgICAkLmVhY2gobmFtZS5zcGxpdCgnLicpLCAoXywgZikgPT4gew0KICAgICAgICAgICAgdCA9IHsNCiAgICAgICAgICAgICAgICBFbnRpdHlPYmplY3Q6IHQgPyB7DQogICAgICAgICAgICAgICAgICAgIEFjdGl2ZTogdHJ1ZSwNCiAgICAgICAgICAgICAgICAgICAgVmFsdWVFbnRpdGllczogW3RdDQogICAgICAgICAgICAgICAgfSA6IHsNCiAgICAgICAgICAgICAgICAgICAgQWN0aXZlOiB0cnVlLA0KICAgICAgICAgICAgICAgICAgICBJZDogdGhpcy5JZA0KICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgRW50aXR5QXR0cmlidXRlOiB7DQogICAgICAgICAgICAgICAgICAgIE5hbWU6IGYsDQogICAgICAgICAgICAgICAgICAgIE9QRVJBVE9SUzogew0KICAgICAgICAgICAgICAgICAgICAgICAgTmFtZTogIj0iDQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9Ow0KICAgICAgICB9KTsNCiAgICAgICAgcmV0dXJuICQud2hlbih0aGlzLnNyKCkuXygiRW50ZXJwcmlzZU1hbmFnZXIuZW1zRW50aXR5VmFsdWVGaW5kIiwgbnVsbCwgdCkpLnRoZW4oZXYgPT4gew0KICAgICAgICAgICAgPCU9bG9nKCklPmV2KTsNCiAgICAgICAgICAgIGlmIChldiA9PT0gbnVsbCkgcmV0dXJuIG51bGw7DQogICAgICAgICAgICBpZiAoZXYuRW50aXR5QXR0cmlidXRlLklzU3RyaW5nKSByZXR1cm4gZXYuU3RyaW5nVmFsdWU7DQogICAgICAgICAgICBpZiAoZXYuRW50aXR5QXR0cmlidXRlLklzRmxvYXQpIHJldHVybiBldi5GbG9hdFZhbHVlOw0KICAgICAgICAgICAgaWYgKGV2LkVudGl0eUF0dHJpYnV0ZS5Jc0ludCkgcmV0dXJuIGV2LkludFZhbHVlOw0KICAgICAgICAgICAgaWYgKGV2LkVudGl0eUF0dHJpYnV0ZS5Jc0xvbmcpIHJldHVybiBldi5Mb25nVmFsdWU7DQogICAgICAgICAgICBpZiAoZXYuRW50aXR5QXR0cmlidXRlLklzVGV4dCkgcmV0dXJuIGV2LlRleHRWYWx1ZTsNCiAgICAgICAgICAgIGlmIChldi5FbnRpdHlBdHRyaWJ1dGUuSXNCb29sKSByZXR1cm4gZXYuQm9vbFZhbHVlOw0KDQogICAgICAgICAgICBpZiAoIWV2Lk9iamVjdFZhbHVlKSByZXR1cm4gbnVsbDsNCg0KICAgICAgICAgICAgcmV0dXJuIG5ldyA8JT1zY29wZSU+WyQuZ3JlcCg8JT1zY29wZSU+LkVudGl0eUNsYXNzZXMsIGMgPT4gYy5JZCA9PSBldi5FbnRpdHlBdHRyaWJ1dGUuRW50aXR5VHlwZWlkKVswXS5OYW1lLnJlcGxhY2UoLyAvZywgJ18nKV0oZXYuT2JqZWN0VmFsdWUuSWQpOw0KICAgICAgICB9KTsNCiAgICB9DQo8JSB9JT4NCg0KPCUgaWYobWFpbkNsYXNzKF9zcWxUb29scykpeyU+DQogICAgPCU9bU5hbWU9J19RJyU+KCl7DQogICAgICAgIGxldCBfbyA9ICciJzsNCiAgICAgICAgbGV0IF9xID0gX287DQoNCiAgICAgICAgaWYoWydTYWxlc0ZvcmNlJ10uaW5kZXhPZih0aGlzLlRvb2wudHlwZS5uYW1lKT09MCl7DQogICAgICAgICAgICBfbyA9IF9xID0gIiI7DQogICAgICAgIH1lbHNlIGlmKHRoaXMuX19jb25maWcoJ3R5cGUnKT09J215c3FsJyB8fCB0aGlzLlRvb2wudHlwZS5uYW1lPT0nTmVvNGonKXsNCiAgICAgICAgICAgIF9vID0gX3EgPSAnYCc7DQogICAgICAgIH1lbHNlIGlmKFsnU2FsZXNGb3JjZSddLmluZGV4T2YodGhpcy5Ub29sLnR5cGUubmFtZSk9PTApew0KICAgICAgICAgICAgX28gPSBfcSA9IGAnYDsNCiAgICAgICAgfWVsc2UgaWYodGhpcy5fX2NvbmZpZygndHlwZScpPT0nc3Fsc2VydmVyJyl7DQogICAgICAgICAgICBfbyA9ICdbJzsNCiAgICAgICAgICAgIF9xID0gJ10nOw0KICAgICAgICB9ZWxzZSBpZih0aGlzLl9fY29uZmlnKCdhcGlLZXknKT09J2FpcnRhYmxlJyl7DQogICAgICAgICAgICBfbyA9ICd7JzsNCiAgICAgICAgICAgIF9xID0gJ30nOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiBfbz9fcTpfbzsNCiAgICB9DQogICAgDQogICAgPCU9bU5hbWU9J19maWVsZEdyb3VwcyclPihmZ3MgPSB7fSl7DQogICAgICAgIHRoaXMuX19maWVsZEdyb3VwcyA9IGZnczsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgfQ0KICAgIA0KICAgIDwlPW1OYW1lPSdfZmllbGRBZ2dyZWdhdGVzJyU+KGZhcyA9IHt9KXsNCiAgICAgICAgdGhpcy5fX2ZpZWxkQWdncmVnYXRlcyA9IGZhczsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgfQ0KICAgIA0KICAgIDwlPW1OYW1lPSdfdG9GaWVsZHNTUUwnJT4oZmllbGRzKXsNCiAgICAgICAgDQogICAgICAgIGZpZWxkcyA9IGZpZWxkcyB8fCBbdGhpcy5fX2NvbmZpZygnaWRGaWVsZCcsICdJZCcpLCA8JT1jLkVudGl0eUF0dHJpYnV0ZXMuZmlsdGVyKGVhID0+ICFlYS5FbnRpdHlNZXRob2QpLm1hcChlYSA9PiBfbkNvZGUoZWEpICsgKGVhLkVudGl0eVR5cGU/JysiLmlkIic6JycpKS5qb2luKCcsJyklPl07DQogICAgICAgIGZpZWxkcyA9IEFycmF5LmlzQXJyYXkoZmllbGRzKT9maWVsZHM6W2ZpZWxkc107DQoNCiAgICAgICAgaWYodGhpcy5fX2ZpZWxkR3JvdXBzKXsNCiAgICAgICAgICAgIC8vIHtmaWVsZDogb3JkZXJ9DQogICAgICAgICAgICBmaWVsZHMgPSBbXTsNCiAgICA8JSBjLkVudGl0eUF0dHJpYnV0ZXMuZmlsdGVyKGVhID0+ICFlYS5FbnRpdHlNZXRob2QgJiYgIWVhLklzVGV4dCAmJiAhZWEuSXNJbWFnZSAmJiAhZWEuSXNGaWxlKS5mb3JFYWNoKGVhID0+IHsgJT4NCiAgICAgICAgICAgIGlmKHRoaXMuX19maWVsZEdyb3Vwcy48JT1uTmFtZShlYSklPikgZmllbGRzLnB1c2goYCR7PCU9X25Db2RlKGVhKSU+PCU9KGVhLkVudGl0eVR5cGU/JysiaWQiJzonJyklPn1gKTsNCiAgICA8JSB9KSU+DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIGZpZWxkczsNCiAgICB9DQogICAgDQogICAgPCU9bU5hbWU9J19mcm9tREJPYmplY3QnJT4ocj17fSl7DQogICAgICAgIHRyeXsNCiAgICAgICAgICAgIHJldHVybiB0aGlzLl9faW1wb3J0KHIsIHsNCiAgICAgICAgICAgICAgICBJZDogb2JqID0+IHRoaXMuSWQgPSBvYmpbdGhpcy5fX2NvbmZpZygnaWRGaWVsZCcsICdJZCcpXSwNCiAgICA8JSBjLkVudGl0eUF0dHJpYnV0ZXMuZmlsdGVyKGVhID0+ICFlYS5FbnRpdHlNZXRob2QpLmZvckVhY2goZWEgPT4geyAlPg0KICAgICAgICAgICAgICAgIDwlPW5OYW1lKGVhKSU+OiAob2JqLCBlYUNvZGUpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy48JT1uTmFtZShlYSklPihvYmpbZWFDb2RlXSk7DQogICAgICAgICAgICAgICAgfSwNCiAgICA8JSB9KSU+DQogICAgICAgICAgICB9LCAiPCU9bU5hbWUlPiIpOw0KICAgICAgICB9Y2F0Y2goZXgpew0KICAgICAgICAgICAgPCU9ZXJyb3IoKSU+ZXgpOw0KICAgICAgICB9DQogICAgfQ0KICAgIA0KICAgIDwlPW1OYW1lPSdfdG9TZWxlY3RIZWFkZXInJT4oZmllbGRzKXsNCiAgICAgICAgdHJ5ew0KICAgICAgICAgICAgbGV0IHJldCA9IHsNCiAgICAgICAgICAgICAgICB0YWJsZTogPCU9X25Db2RlKCklPiwNCiAgICAgICAgICAgICAgICBmaWVsZHM6IERvdE9iamVjdC5vYmplY3QoT2JqZWN0LmZyb21FbnRyaWVzKHRoaXMuX3RvRmllbGRzU1FMKGZpZWxkcykubWFwKGYgPT4gdGhpcy5fUSgpICsgZi5yZXBsYWNlKC9cLi9nLCAnJykgKyB0aGlzLl9RKCkpLm1hcChmID0+IFtmLCBmXSkpKSwNCiAgICAgICAgICAgICAgICBqb2luczoge30sDQogICAgICAgICAgICB9Ow0KICAgICAgICAgICAgDQogICAgICAgICAgICBpZihmaWVsZHMpIHJldHVybiByZXQ7DQogICAgICAgICAgICANCiAgICAgICAgICAgIHJldC5qb2lucyA9IHRoaXMuX19leHBvcnQoe30sIHsNCiAgICAgICAgICAgICAgICBOdWxsOiB0cnVlLA0KICAgIDwlIGMuRW50aXR5QXR0cmlidXRlcy5maWx0ZXIoZWEgPT4gIWVhLkVudGl0eU1ldGhvZCAmJiBlYS5FbnRpdHlUeXBlKS5mb3JFYWNoKGVhID0+IHslPg0KICAgICAgICAgICAgICAgIDwlPW5OYW1lKGVhKSU+OiAob2JqLCBlYUNvZGUsIHYpID0+IG9ialtlYUNvZGVdID0gbmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKGVhLkVudGl0eVR5cGUsIHRydWUpJT4oKS48JT1tTmFtZSU+KCksDQogICAgPCUgfSklPg0KICAgICAgICAgICAgfSwgIjwlPW1OYW1lJT4iKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgPCU9bG9nKCklPnJldCk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIHJldHVybiByZXQ7DQogICAgICAgIH1jYXRjaChleCl7DQogICAgICAgICAgICA8JT1lcnJvcigpJT5leCk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICA8JT1tTmFtZT0nX3RvU2VsZWN0U1FMJyU+KGZpZWxkcyl7DQogICAgICAgIHRyeXsNCiAgICAgICAgICAgIGxldCBzcWwgPSAic2VsZWN0ICI7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGxldCB0UHJlZiA9IGAke3RoaXMuX1EoKX0kezwlPV9uQ29kZSgpJT59JHt0aGlzLl9RKCl9YDsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgbGV0IGhlYWRlciA9IHRoaXMuX3RvU2VsZWN0SGVhZGVyKGZpZWxkcyk7DQoNCiAgICAgICAgICAgIHNxbCArPSBPYmplY3QudmFsdWVzKGhlYWRlci5maWVsZHMpLm1hcChmID0+IGAke3RQcmVmfS4ke2Z9YCkuam9pbignLCAnKTsNCiAgICAgICAgICAgIE9iamVjdC5rZXlzKGhlYWRlci5qb2lucykuZm9yRWFjaChrID0+IHNxbCArPSAiLCAiICsgT2JqZWN0LnZhbHVlcyhoZWFkZXIuam9pbnNba10uZmllbGRzKS5tYXAoZiA9PiBgJHt0aGlzLl9RKCl9JHtoZWFkZXIuam9pbnNba10udGFibGV9XyR7a30ke3RoaXMuX1EoKX0uJHtmfSBhcyAke3RoaXMuX1EoKX0ke2t9LiR7Zi5yZXBsYWNlKHRoaXMuX1EoKSwgJycpfWApLmpvaW4oJywgJykpOw0KICAgIA0KICAgICAgICAgICAgaWYodGhpcy5fX2ZpZWxkQWdncmVnYXRlcyl7DQogICAgICAgICAgICAgICAgLy8ge2ZpZWxkOiBmdW5jdGlvbn0NCiAgICA8JSBjLkVudGl0eUF0dHJpYnV0ZXMuZmlsdGVyKGVhID0+ICFlYS5FbnRpdHlNZXRob2QgJiYgIWVhLklzVGV4dCAmJiAhZWEuSXNJbWFnZSAmJiAhZWEuSXNGaWxlKS5mb3JFYWNoKGVhID0+IHsgJT4NCiAgICAgICAgICAgICAgICBpZih0aGlzLl9fZmllbGRBZ2dyZWdhdGVzLjwlPW5OYW1lKGVhKSU+KSBzcWwgKz0gYCR7c3FsPT0oJ3NlbGVjdCAnKT8nJzonLCd9ICR7dGhpcy5fX2ZpZWxkQWdncmVnYXRlcy48JT1uTmFtZShlYSklPn0oJHt0aGlzLl9RKCl9JHs8JT1fbkNvZGUoZWEpJT59JHt0aGlzLl9RKCl9KWA7DQogICAgPCUgfSklPg0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgc3FsICs9IGAgZnJvbSAke3RQcmVmfSBgOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBPYmplY3Qua2V5cyhoZWFkZXIuam9pbnMpLmZvckVhY2goayA9PiBzcWwgKz0gYGxlZnQgam9pbiAke3RoaXMuX1EoKX0ke2hlYWRlci5qb2luc1trXS50YWJsZX0ke3RoaXMuX1EoKX0gYXMgJHt0aGlzLl9RKCl9JHtoZWFkZXIuam9pbnNba10udGFibGV9XyR7a30ke3RoaXMuX1EoKX0gb24gJHt0UHJlZn0uJHt0aGlzLl9RKCl9JHtrfWlkJHt0aGlzLl9RKCl9PSR7dGhpcy5fUSgpfSR7aGVhZGVyLmpvaW5zW2tdLnRhYmxlfV8ke2t9JHt0aGlzLl9RKCl9LiR7dGhpcy5fUSgpfSR7dGhpcy5fX2NvbmZpZygnaWRGaWVsZCcsICdJZCcpfSR7dGhpcy5fUSgpfSBgKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgc3FsICs9IGAgd2hlcmUgMT0xYDsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgc3FsID0gdGhpcy5fX2V4cG9ydCh7c3FsOiBzcWx9LCB7DQogICAgICAgICAgICAgICAgTnVsbDogdHJ1ZSwNCiAgICAgICAgICAgICAgICBfZmllbGRzOiAodGhpcy5fX3N5bmNfb24oKSB8fCB0aGlzLklkPT10aGlzLklkKT9bJ0lkJ106dW5kZWZpbmVkLA0KICAgICAgICAgICAgICAgIGV4cG9ydGVyOiB2ID0+IHsNCiAgICAgICAgICAgICAgICAgICAgaWYodi5yZXVzZWQ+Mil7DQogICAgICAgICAgICAgICAgICAgICAgICAvLyA8JT13YXJuKCklPiJSZXVzZWQ6ICIsIHYpOw0KICAgICAgICAgICAgICAgICAgICAgICAgdi5vYmouc3FsID0gYC8qUkVTVUVEOiAke3YucmV1c2VkfSovYDsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgX1RISVM6IG9iaiA9PiB7DQogICAgICAgICAgICAgICAgICAgIGlmKCF0aGlzLl9USElTIHx8ICF0aGlzLl9USElTLmxlbmd0aCkgcmV0dXJuOw0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgb2JqLnNxbCArPSBgIC8qYW5kICovJHt0UHJlZn0uJHt0aGlzLl9RKCl9JHt0aGlzLl9fY29uZmlnKCdpZEZpZWxkJywgJ0lkJyl9JHt0aGlzLl9RKCl9IGAgKyAodGhpcy5fVEhJU19jb29wIHx8ICJJTiIpICsgIiAoIiArIHRoaXMuX1RISVMubWFwKHQgPT4gdC48JT1tTmFtZSU+KHQuX19jb25maWcoJ2lkRmllbGQnKXx8J0lkJykudGhpcykuam9pbignIFVOSU9OIEFMTCAnKSArICIpIjsNCiAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgIElkOiAob2JqLCBpZENvZGUsIHYpID0+IG9iai5zcWwgKz0gKHRoaXMuSWQ9PXRoaXMuSWQpP2AgYW5kICR7dFByZWZ9LiR7dGhpcy5fUSgpfSR7dGhpcy5fX2NvbmZpZygnaWRGaWVsZCcsICdJZCcpfSR7dGhpcy5fUSgpfT0nJHt0aGlzLklkfSdgOicnLA0KICAgIDwlIGMuRW50aXR5QXR0cmlidXRlcy5maWx0ZXIoZWEgPT4gIWVhLkVudGl0eU1ldGhvZCkuZm9yRWFjaChlYSA9PiB7ICU+DQogICAgICAgICAgICAgICAgPCU9bk5hbWUoZWEpJT46IChvYmosIGVhQ29kZSwgdikgPT4gew0KICAgICAgICAgICAgICAgICAgICBpZighdGhpcy5fPCU9bk5hbWUoZWEpJT5fc2V0KSByZXR1cm47DQogICAgICAgICAgICAgICAgDQogICAgICAgIDwlIGlmKGVhLkVudGl0eVR5cGUpeyU+DQogICAgICAgICAgICAgICAgbGV0IGNvb3AgPSB0aGlzLl88JT1uTmFtZShlYSklPl9jb29wOw0KICAgICAgICAgICAgICAgICAgICBzd2l0Y2goY29vcCl7DQogICAgICAgICAgICAgICAgICAgICAgICBjYXNlICIhPSI6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29vcCA9ICJOT1QgSU4iOw0KICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiPSI6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29vcCA9ICJJTiI7DQogICAgICAgICAgICAgICAgICAgICAgICBjYXNlICIiOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvb3AgPSAiSU4iOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBpZih2KXsNCiAgICAgICAgICAgICAgICAgICAgICAgIG9iai5zcWwgKz0gYCBhbmQgJHt0UHJlZn0uJHt0aGlzLl9RKCl9JHtlYUNvZGV9aWQke3RoaXMuX1EoKX0gJHtjb29wfSAoJHt2LjwlPW1OYW1lJT4odi5fX2NvbmZpZygnaWRGaWVsZCcsICdJZCcpKX0pYDsNCiAgICAgICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgICAgICBvYmouc3FsICs9IGAgYW5kICgke3RQcmVmfS4ke3RoaXMuX1EoKX0ke2VhQ29kZX1pZCR7dGhpcy5fUSgpfSAke2Nvb3B9ICgwKSBPUiAke3RQcmVmfS4ke3RoaXMuX1EoKX0ke2VhQ29kZX1pZCR7dGhpcy5fUSgpfSBJUyBOVUxMKWA7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICA8JSB9ZWxzZSBpZihlYS5Jc1RleHQgfHwgZWEuSXNJbWFnZSB8fCBlYS5Jc0ZpbGUpeyU+DQogICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgPCUgfWVsc2V7JT4NCiAgICAgICAgICAgICAgICAgICAgb2JqLnNxbCArPSBgIGFuZCAke3RQcmVmfS4ke3RoaXMuX1EoKX0ke2VhQ29kZX0ke3RoaXMuX1EoKX0gYCArIDwlaWYoZWEuSXNCb29sKXslPiI9IjwlfWVsc2V7JT4odGhpcy5fPCU9bk5hbWUoZWEpJT5fY29vcCB8fCAiTElLRSIpPCV9JT4gKyAiICI7DQogICAgICAgIDwlIH0lPg0KICAgICAgICANCiAgICAgICAgPCUgaWYoZWEuSXNEYXRlKXsgJT4NCiAgICAgICAgICAgICAgICAgICAgaWYodiAmJiB2LnRvSVNPU3RyaW5nKXsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmKHRoaXMuX19jb25maWcoJ3R5cGUnKT09J3NxbGl0ZScpew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iai5zcWwgKz0gInN0cmZ0aW1lKCclcycsICciICsgdi50b0lTT1N0cmluZygpICsgIicpIjsNCiAgICAgICAgICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iai5zcWwgKz0gIiciICsgdi50b0lTT1N0cmluZygpICsgIiciOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgIDwlIH1lbHNlIGlmKGVhLklzU3RyaW5nKXsgJT4NCiAgICAgICAgICAgICAgICAgICAgaWYodHlwZW9mKHYpPT09InN0cmluZyIpew0KICAgICAgICAgICAgICAgICAgICAgICAgb2JqLnNxbCArPSAiJyIgKyAoKHRoaXMuXzwlPW5OYW1lKGVhKSU+X2Nvb3A9PSJMSUtFIiB8fCAhdGhpcy5fPCU9bk5hbWUoZWEpJT5fY29vcCk/IiUiOiIiKSArIHYgKyAoKHRoaXMuXzwlPW5OYW1lKGVhKSU+X2Nvb3A9PSJMSUtFIiB8fCAhdGhpcy5fPCU9bk5hbWUoZWEpJT5fY29vcCk/IiUiOiIiKSArICInIjsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICA8JSB9ZWxzZSBpZihlYS5Jc0Jvb2wpeyAlPg0KICAgICAgICAgICAgICAgICAgICBpZih0eXBlb2Yodik9PT0iYm9vbGVhbiIpew0KICAgICAgICAgICAgICAgICAgICAgICAgb2JqLnNxbCArPSAiJyIgKyAodj8iMSI6IjAiKSArICInIjsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICA8JSB9ICU+DQogICAgICAgICAgICAgICAgICAgIGlmKHYgJiYgdi5FbnRpdHlDbGFzcyl7DQogICAgICAgICAgICAgICAgICAgICAgICBvYmouc3FsICs9ICIoIiArIHYuPCU9bU5hbWUlPigpICsgIikiOw0KICAgICAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgICAgIG9iai5zcWwgKz0gIiciICsgdiArICInIjsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0sDQogICAgPCUgfSk7ICU+DQogICAgPCUgYy5UeXBlZEF0dHJpYnV0ZXMuZm9yRWFjaCh0YSA9PiB7IGxldCB0YU5hbWUgPSBuTmFtZSh0YSkgKyAnXycgKyB0YS5FbnRpdHlDbGFzcy5QbHVyYWwucmVwbGFjZSgvIC9nLCAnXycpOyU+DQogICAgICAgICAgICAgICAgPCU9dGFOYW1lJT46IChvYmosIGVhQ29kZSwgdikgPT4gew0KICAgICAgICAgICAgICAgICAgICBpZighdGhpcy5fPCU9dGFOYW1lJT5fc2V0KSByZXR1cm47DQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBsZXQgak9QID0gJ1VOSU9OIEFMTCc7DQogICAgICAgICAgICAgICAgICAgIGxldCBpbk9QID0gJ0lOJzsNCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIGlmKHRoaXMuXzwlPXRhTmFtZSU+X2Nvb3A9PSchPScgfHwgdGhpcy5fPCU9dGFOYW1lJT5fY29vcD09J05PVCBJTicpew0KICAgICAgICAgICAgICAgICAgICAgICAgaW5PUCA9ICdOT1QgSU4nOw0KICAgICAgICAgICAgICAgICAgICB9ZWxzZSBpZih0aGlzLl88JT10YU5hbWUlPl9jb29wPT0nPScgfHwgdGhpcy5fPCU9dGFOYW1lJT5fY29vcD09J0lOJyl7DQogICAgICAgICAgICAgICAgICAgIH1lbHNlIGlmKHRoaXMuXzwlPXRhTmFtZSU+X2Nvb3A9PSc9PScpew0KICAgICAgICAgICAgICAgICAgICAgICAgak9QID0gJ0lOVEVSU0VDVCc7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIG9iai5zcWwgKz0gYGFuZCAvKjwlPXRhTmFtZSU+Ki8gJHt0UHJlZn0uJHt0aGlzLl9RKCl9JHt0aGlzLl9fY29uZmlnKCdpZEZpZWxkJywgJ0lkJyl9JHt0aGlzLl9RKCl9ICR7aW5PUH0gKGAgKyAodiB8fCBbXSkuZmlsdGVyKHQgPT4gdCkubWFwKHQgPT4gdC48JT1tTmFtZSU+KCI8JT1uTmFtZSh0YSklPi5pZCIpKS5qb2luKGAgJHtqT1B9LypNMk0qLyBgKSArICcpJzsNCiAgICAgICAgICAgICAgICB9LA0KICAgIDwlIH0pJT4NCiAgICAgICAgICAgIH0sICI8JT1tTmFtZSU+IiwgZmllbGRzKS5zcWw7DQoNCiAgICAgICAgICAgIGlmKHRoaXMuX19maWVsZEdyb3Vwcyl7DQogICAgICAgICAgICAgICAgaWYoT2JqZWN0LmtleXModGhpcy5fX2ZpZWxkR3JvdXBzKS5sZW5ndGgpIHNxbCArPSAiIGdyb3VwIGJ5ICI7DQogICAgPCUgYy5FbnRpdHlBdHRyaWJ1dGVzLmZpbHRlcihlYSA9PiAhZWEuRW50aXR5TWV0aG9kICYmICFlYS5Jc1RleHQgJiYgIWVhLklzSW1hZ2UgJiYgIWVhLklzRmlsZSkuZm9yRWFjaChlYSA9PiB7ICU+DQogICAgICAgICAgICAgICAgaWYodGhpcy5fX2ZpZWxkR3JvdXBzLjwlPW5OYW1lKGVhKSU+KSBzcWwgKz0gYCR7dGhpcy5fUSgpfSR7PCU9X25Db2RlKGVhKSU+PCU9KGVhLkVudGl0eVR5cGU/JysiaWQiJzonJyklPn0ke3RoaXMuX1EoKX0gJHt0aGlzLl9fZmllbGRHcm91cHMuPCU9bk5hbWUoZWEpJT59YDsNCiAgICA8JSB9KSU+DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKCFzcWwuZW5kc1dpdGgoIndoZXJlIDE9MSIpKXsNCiAgICAgICAgICAgICAgICBzcWwgPSBzcWwucmVwbGFjZSgid2hlcmUgMT0xIGFuZCAiLCAid2hlcmUgIik7DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIHNxbCA9IHR5cGVvZihzcWxGb3JtYXR0ZXIpIT09J3VuZGVmaW5lZCc/c3FsRm9ybWF0dGVyLmZvcm1hdChzcWwpOnNxbDsNCiAgICAgICAgICAgIDwlPWxvZygpJT5zcWwpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICByZXR1cm4gc3FsOw0KICAgICAgICB9Y2F0Y2goZXgpew0KICAgICAgICAgICAgPCU9ZXJyb3IoKSU+ZXgpOw0KICAgICAgICB9DQogICAgfQ0KICAgIA0KICAgIDwlPW1OYW1lPSdfdG9QYXRocyclPigpew0KICAgICAgICBsZXQgcmV0ID0gdGhpcy5fX2V4cG9ydCh7fSwgew0KICAgICAgICAgICAgX1RISVM6IG9iaiA9PiB7fSwNCiAgICA8JSBjLkVudGl0eUF0dHJpYnV0ZXMuZmlsdGVyKGVhID0+ICFlYS5FbnRpdHlNZXRob2QgJiYgZWEuRW50aXR5VHlwZSkuZm9yRWFjaChlYSA9PiB7ICU+DQogICAgICAgICAgICA8JT1uTmFtZShlYSklPjogKG9iaiwgZWFDb2RlLCB2KSA9PiBvYmouPCU9bk5hbWUoZWEpJT4gPSB2LjwlPW1OYW1lJT4oKSwNCiAgICA8JSB9KTsgJT4NCiAgICA8JSBjLlR5cGVkQXR0cmlidXRlcy5mb3JFYWNoKHRhID0+IHsgbGV0IHRhTmFtZSA9IG5OYW1lKHRhKSArICdfJyArIHRhLkVudGl0eUNsYXNzLlBsdXJhbC5yZXBsYWNlKC8gL2csICdfJyk7JT4NCiAgICAgICAgICAgIDwlPXRhTmFtZSU+OiAob2JqLCBlYUNvZGUsIHYpID0+IG9iai48JT10YU5hbWUlPiA9IHYubWFwKF92ID0+IF92LjwlPW1OYW1lJT4oKSksDQogICAgPCUgfSklPg0KICAgICAgICB9LCAiPCU9bU5hbWUlPiIpOw0KICAgICAgICAvLyByZXR1cm4gcmV0Ow0KICAgICAgICByZXR1cm4gT2JqZWN0LmtleXMocmV0KS5tYXAoayA9PiAoe1trXTogcmV0W2tdfSkpOw0KICAgIH0NCg0KICAgIDwlPW1OYW1lPSdfdG9VcGRhdGVTUUwnJT4oZmllbGRzKXsNCiAgICAgICAgbGV0IHJldEZpZWxkcyA9IHRoaXMuX3RvRmllbGRzU1FMKGZpZWxkcykubWFwKGYgPT4gdGhpcy5fUSgpICsgZi5yZXBsYWNlKC9cLi9nLCAnJykgKyB0aGlzLl9RKCkpLmpvaW4oJywgJyk7DQogICAgICAgIGxldCBzcWwgPSBgdXBkYXRlICR7dGhpcy5fUSgpfSR7PCU9X25Db2RlKCklPn0ke3RoaXMuX1EoKX0gc2V0IGAgKyBPYmplY3QuZW50cmllcyh0aGlzLl90b0RCT2JqZWN0KGZpZWxkcykpLm1hcCh2ID0+IHRoaXMuX1EoKSArIHZbMF0gKyB0aGlzLl9RKCkgKyAiPSIgKyB2WzFdKSArIGAgd2hlcmUgJHt0aGlzLl9RKCl9JHt0aGlzLl9fY29uZmlnKCdpZEZpZWxkJywgJ0lkJyl9JHt0aGlzLl9RKCl9PScke3RoaXMuSWR9J2A7IC8vYCByZXR1cm5pbmcgJHtyZXRGaWVsZHN9YDsNCiAgICAgICAgPCU9bG9nKCklPnNxbCk7DQogICAgICAgIHJldHVybiBzcWw7DQogICAgfQ0KDQogICAgPCU9bU5hbWU9J190b0luc2VydFNRTCclPihmaWVsZHMpew0KICAgICAgICBsZXQgb2JqID0gdGhpcy5fdG9EQk9iamVjdChmaWVsZHMpOw0KICAgICAgICBsZXQgc3FsID0gYGluc2VydCBpbnRvICR7dGhpcy5fUSgpfSR7PCU9X25Db2RlKCklPn0ke3RoaXMuX1EoKX0gKGAgKyBPYmplY3Qua2V5cyhvYmopLm1hcChrID0+IHRoaXMuX1EoKSArIGsgKyB0aGlzLl9RKCkpICsgIikgdmFsdWVzICgiICsgT2JqZWN0LnZhbHVlcyhvYmopICsgYClgOw0KICAgICAgICA8JT1sb2coKSU+c3FsKTsNCiAgICAgICAgcmV0dXJuIHNxbDsNCiAgICB9DQo8JSB9ICU+DQogICAgDQogICAgPCU9bU5hbWU9J19jb3B5RnJvbSclPihvYmopew0KICAgICAgICBpZighb2JqKSByZXR1cm4gbnVsbDsNCiAgICAgICAgcmV0dXJuIHRoaXMuX3JldmVydChvYmopOw0KICAgIH0NCiAgICANCiAgICA8JT1tTmFtZT0nX3RvT2JqVHJlZSclPihiQ3ljbGljKXsNCiAgICAgICAgPCU9d2FybigpJT4iZGVwcmVjYXRlZCIpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgDQogICAgICAgIHRoaXMuX2RlZmF1bHRzKCk7DQoNCiAgICAgICAgcmV0dXJuIHRoaXMuX19leHBvcnQobmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKGMuTmFtZSwgdHJ1ZSklPignPCU9Yy5OYW1lJT4nKSwgew0KICAgICAgICAgICAgTnVsbDogdHJ1ZSwNCiAgICAgICAgICAgIEN5Y2xpYzogYkN5Y2xpYywNCiAgICAgICAgICAgIC8vZXhwb3J0ZXI6IHYgPT4gPCU9d2FybigpJT52LnJldXNlZCksDQogICAgPCUgYy5FbnRpdHlBdHRyaWJ1dGVzLmZpbHRlcihlYSA9PiAhZWEuRW50aXR5TWV0aG9kKS5mb3JFYWNoKGVhID0+IHslPg0KICAgICAgICAgICAgPCU9bk5hbWUoZWEpJT46IChvYmosIGVhQ29kZSwgdikgPT4gb2JqLjwlPW5OYW1lKGVhKSU+KDwlaWYoZWEuRW50aXR5VHlwZSl7JT5uZXcgPCU9c2NvcGUlPi48JT1fY05hbWUoZWEuRW50aXR5VHlwZSwgdHJ1ZSklPigpLjwlPW1OYW1lJT4oYkN5Y2xpYyk8JX1lbHNleyU+djwlfSU+KSwNCiAgICA8JSB9KTslPg0KICAgIDwlIGMuVHlwZWRBdHRyaWJ1dGVzLmZvckVhY2godGEgPT4geyBsZXQgdGFOYW1lID0gbk5hbWUodGEpICsgJ18nICsgdGEuRW50aXR5Q2xhc3MuUGx1cmFsLnJlcGxhY2UoLyAvZywgJ18nKTslPg0KICAgICAgICAgICAgPCU9dGFOYW1lJT46IChvYmosIGVhQ29kZSwgdikgPT4gb2JqLjwlPXRhTmFtZSU+KG5ldyA8JT1zY29wZSU+LjwlPV9jTmFtZSh0YS5FbnRpdHlDbGFzcywgdHJ1ZSklPigpLjwlPW1OYW1lJT4oYkN5Y2xpYykpLA0KICAgIDwlIH0pOyU+DQogICAgICAgIH0sICI8JT1tTmFtZSU+Iik7DQogICAgfQ0KICAgIA0KICAgIDwlPW1OYW1lPSdfdW5DeWNsZSclPihzb3VyY2U9dGhpcyl7DQogICAgICAgIHJldHVybiB0aGlzLl9fZXhwb3J0KHRoaXMsIHsNCiAgICAgICAgICAgIE51bGw6IHRydWUsDQogICAgPCUgYy5FbnRpdHlBdHRyaWJ1dGVzLmZpbHRlcihlYSA9PiAhZWEuRW50aXR5TWV0aG9kICYmIGVhLkVudGl0eVR5cGUpLmZvckVhY2goZWEgPT4geyU+DQogICAgICAgICAgICA8JT1uTmFtZShlYSklPjogKG9iaiwgZWFDb2RlLCB2KSA9PiBvYmouPCU9bk5hbWUoZWEpJT4oc291cmNlPT1vYmouPCU9bk5hbWUoZWEpJT4oKT9udWxsOnVuZGVmaW5lZCksDQogICAgPCUgfSk7JT4NCiAgICA8JSBjLlR5cGVkQXR0cmlidXRlcy5mb3JFYWNoKHRhID0+IHsgbGV0IHRhTmFtZSA9IG5OYW1lKHRhKSArICdfJyArIHRhLkVudGl0eUNsYXNzLlBsdXJhbC5yZXBsYWNlKC8gL2csICdfJyk7JT4NCiAgICAgICAgICAgIDwlPXRhTmFtZSU+OiAob2JqLCBlYUNvZGUsIHYpID0+IHRydWUsDQogICAgPCUgfSk7JT4NCiAgICAgICAgfSwgIjwlPW1OYW1lJT4iKTsNCiAgICB9DQogICAgDQogICAgYXN5bmMgPCU9bU5hbWU9J19zdG9yZUVudGl0eUNsYXNzJyU+KGRlcHRoKXsNCiAgICAgICAgdHJ5ew0KICAgICAgICAgICAgaWYodHlwZW9mKGRlcHRoKT09PSJ1bmRlZmluZWQiKSBkZXB0aCA9IHRoaXMuX19jb25maWcoImNyZWF0ZSIpOw0KICAgICAgICAgICAgaWYoIWRlcHRoKSByZXR1cm47DQogICAgICAgICAgICANCiAgICAgICAgICAgIHRoaXMuVG9vbC48JT1tTmFtZSU+ID0gdGhpcy5Ub29sLjwlPW1OYW1lJT4gfHwge307DQogICAgICAgICAgICBpZih0aGlzLlRvb2wuPCU9bU5hbWUlPi48JT1uTmFtZShjKSU+KSByZXR1cm47DQogICAgICAgICAgICB0aGlzLlRvb2wuPCU9bU5hbWUlPi48JT1uTmFtZShjKSU+ID0gdHJ1ZTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgPCU9bG9nKCklPmBzdG9yaW5nICcke3RoaXMuVG9vbC50eXBlLm5hbWV9JyBtb2RlbCB3aXRoIGRlcHRoICR7ZGVwdGh9YCk7DQogICAgICAgICAgICANCjwlIGNsc1Rvb2xzKGMpLmZvckVhY2godCA9PiB7JT4NCiAgICAgICAgICAgIGF3YWl0IHRoaXMuRFNDb25uZWN0KCk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGlmKHRoaXMuVG9vbC50eXBlLm5hbWU9PSI8JT10JT4iKXsNCiAgICA8JSBpZih0PT0iTmVvNGoiKXslPg0KICAgICAgICAgICAgICAgIGxldCBjcWwgPSB0aGlzLyouX3RvT2JqVHJlZSh0cnVlKSovLl90b0N5VGFibGUoZGVwdGgpOw0KICAgICAgICAgICAgICAgIDwlPWxvZygpJT5jcWwpOw0KICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuX25lbzRqKGNxbCk7DQogICAgPCUgfWVsc2UgaWYodD09IkFpclRhYmxlIil7JT4NCiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLl9haXJ0YWJsZSgnbWV0YS9iYXNlcycsIG51bGwsIHtuYW1lOiAnPCU9c2NvcGUlPicsIHdvcmtzcGFjZUlkOiB0aGlzLlRvb2wuZGIud29ya3NwYWNlSWQsIHRhYmxlczogdGhpcy5fdG9BVFRhYmxlKGRlcHRoKX0pOw0KICAgIDwlIH1lbHNlIGlmKF9zcWxUb29scy5pbmRleE9mKHQpPj0wKXslPg0KICAgICAgICAgICAgICAgIGxldCBzcWwgPSB0aGlzLyouX3RvT2JqVHJlZSh0cnVlKSovLl90b1NRTFRhYmxlKHtyZXVzZWQ6IDN9KTsgPCUvKmRlcHRoOiBjaGFsbGVuZ2UgLSB0b28gbG93IGRvZXMgbm90IGNvdmVyIGFsbCB0YWJsZXMsIHRvbyBoaWdoIChtYXggZGVwdGgpIHJlc3VsdHMgaW4gb3V0LW9mLW1lbW9yeSBvbiBicm93c2VyKi8lPg0KICAgICAgICAgICAgICAgIDwlPWxvZygpJT5zcWwpOw0KICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuX3NxbChzcWwpOw0KICAgIDwlIH1lbHNlIGlmKHQ9PSJTZXJ2aWNlTm93Iil7JT4NCiAgICAgICAgICAgICAgICAvLzwlPWxvZygpJT50aGlzLyouX3RvT2JqVHJlZSh0cnVlKSovLl90b1NOVGFibGUoKSk7DQogICAgPCUgfWVsc2UgaWYodD09IkVNUyIpeyU+DQogICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5fdG9FTVNDbGFzcyhkZXB0aCkuc3RvcmUoKTsNCiAgICA8JSB9ZWxzZSBpZih0PT0iQklTZXJ2ZXIiKXslPg0KICAgICAgICAgICAgICAgIC8vIG9ubHkgZG8gdGhpcyBpZiB0aGUgbW9kdWxlIGlzIG5vdCBsb2FkZWQgZnJvbSANCiAgICAgICAgICAgICAgICAoYXdhaXQgdGhpcy5zcigpLl8oIkVudGVycHJpc2VNYW5hZ2VyLmVtc0VudGl0eUF0dHJpYnV0ZUZpbmRhbGwiLCBudWxsLCB7DQogICAgICAgICAgICAgICAgICAgIEFjdGl2ZTogdHJ1ZSwNCiAgICAgICAgICAgICAgICAgICAgRW50aXR5Q2xhc3M6IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIEFjdGl2ZTogdHJ1ZSwNCiAgICAgICAgICAgICAgICAgICAgICAgIENvbXBhbnk6IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBBY3RpdmU6IHRydWUsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgQ29kZTogdGhpcy5fX2NvbmZpZygnY29tcGFueScsICc8JT1zY29wZSU+JyksDQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgfSkpLmZvckVhY2goZWEgPT4gLyogdHJ5ZSBfZWFUeXBlcyAqLzwlPXNjb3BlJT4uRW50aXR5QXR0cmlidXRlcy5mb3JFYWNoKHNlYSA9PiB7DQogICAgICAgICAgICAgICAgICAgIGlmKHNlYS5JZCE9PWVhLklkICYmIHNlYS5OYW1lPT1lYS5OYW1lICYmIChzZWEuRW50aXR5Q2xhc3MuSWQ9PWVhLkVudGl0eUNsYXNzLklkIHx8IHNlYS5FbnRpdHlDbGFzcy5OYW1lPT1lYS5FbnRpdHlDbGFzcy5OYW1lKSl7DQogICAgICAgICAgICAgICAgICAgICAgICBzZWEuSWQgPT0gZWEuSWQ7DQogICAgICAgICAgICAgICAgICAgICAgICBzZWEuRW50aXR5Q2xhc3MuSWQgPSBlYS5FbnRpdHlDbGFzcy5JZDsNCiAgICAgICAgICAgICAgICAgICAgICAgIDwlPXNjb3BlJT4uRW50aXR5Q2xhc3Nlcy5maW5kKGMgPT4gYy5OYW1lPT1zZWEuRW50aXR5Q2xhc3MuTmFtZSkuRW50aXR5QXR0cmlidXRlcy5maW5kKHNjZWEgPT4gc2NlYS5OYW1lPT1lYS5OYW1lKS5JZCA9IGVhLklkOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSkpOw0KICAgIDwlIH1lbHNlIGlmKHQ9PSJNb25nb0RCIiB8fCB0PT0iWmFuZ29EQiIpeyU+DQogICAgICAgICAgICAgICAgaWYodGhpcy5Ub29sLmRiKSBhd2FpdCB0aGlzLlRvb2wuZGIuY3JlYXRlQ29sbGVjdGlvbig8JT1fbkNvZGUoKSU+LCB7dmFsaWRhdG9yOiB7JGpzb25TY2hlbWE6IHRoaXMuX3RvSlNPTlNjaGVtYSgpfX0pOw0KICAgIDwlIH1lbHNlIGlmKHQ9PSJSeERCIil7JT4NCiAgICAgICAgICAgICAgICBpZih0aGlzLlRvb2wuZGIpIGF3YWl0IHRoaXMuVG9vbC5kYi5hZGRDb2xsZWN0aW9ucyh7WzwlPV9uQ29kZSgpJT5dOiB7c2NoZW1hOiB0aGlzLl90b0pTT05TY2hlbWEoKX19KTsNCiAgICA8JSB9JT4NCiAgICAgICAgICAgIH0NCjwlIH0pJT4NCiAgICAgICAgfWNhdGNoKGV4KXsNCiAgICAgICAgICAgIDwlPWVycm9yKCklPmV4KTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICB9DQoNCiAgICA8JT1tTmFtZT0nX2xvZyclPihvYmo9dGhpcyl7DQo8JSBpZihtYWluQ2xhc3MoKSE9Yyl7JT4NCiAgICAgICAgcmV0dXJuIG5ldyA8JT1zY29wZSU+LjwlPV9jTmFtZShtYWluQ2xhc3MoKSwgdHJ1ZSklPigpLjwlPW1OYW1lJT4ob2JqKTsNCjwlIH1lbHNleyU+DQogICAgICAgIHRyeXsNCiAgICAgICAgICAgIGlmKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAobyA9PiB0aGlzLl9sb2cobykpOw0KICAgICAgICAgICAgaWYob2JqLkVudGl0eUNsYXNzKSBvYmogPSBvYmouX3RvSlNPTih7Yk1hcDogdHJ1ZX0pOw0KICAgICAgICAgICAgPCU9bG9nKCklPm9iaik7DQogICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgfWNhdGNoKGV4KXsNCiAgICAgICAgICAgIDwlPWVycm9yKCklPmV4KTsNCiAgICAgICAgfQ0KPCUgfSU+DQogICAgfQ0KDQogICAgYXN5bmMgPCU9bU5hbWU9J0RTQ29ubmVjdCclPih0b29sPXRoaXMuVG9vbCl7DQo8JSBpZihtYWluQ2xhc3MoKSE9Yyl7JT4NCiAgICAgICAgcmV0dXJuIGF3YWl0IG5ldyA8JT1zY29wZSU+LjwlPV9jTmFtZShtYWluQ2xhc3MoKSwgdHJ1ZSklPigpLjwlPW1OYW1lJT4odG9vbCk7DQo8JSB9ZWxzZXslPg0KICAgICAgICB0cnl7DQogICAgICAgICAgICBpZighdG9vbCl7DQogICAgICAgICAgICAgICAgPCU9ZXJyb3IoKSU+IlRvb2wgaXMgbnVsbCIsIHRoaXMuVG9vbHMubGVuZ3RoLCA8JT1zY29wZSU+LlRvb2xzLmxlbmd0aCk7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfWVsc2UgaWYoIXRvb2wudHlwZSl7DQogICAgICAgICAgICAgICAgPCU9ZXJyb3IoKSU+IlRvb2wudHlwZSBpcyBudWxsIiwgdG9vbCwgdGhpcy5Ub29scy5sZW5ndGgsIDwlPXNjb3BlJT4uVG9vbHMubGVuZ3RoKTsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9ZWxzZSBpZih0eXBlb2YodG9vbC5kYikhPT0idW5kZWZpbmVkIil7DQogICAgICAgICAgICAgICAgPCU9bG9nKCklPiJUb29sIGFscmVhZHkgY29ubmVjdGVkISIpOw0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH1lbHNlIGlmKDwlPW5zY29wZSU+Ll9ub2RlICYmIC8qPCU9bnNjb3BlJT4uX25vZGUuX3BhcmVudF9zZXQgJiYgKi88JT1uc2NvcGUlPi5fbm9kZS5wYXJlbnQoKS5fc2FtZUVudGl0eSg8JT1uc2NvcGUlPi5fbm9kZS5wYXJlbnQoKSkpew0KICAgICAgICAgICAgICAgIDwlPWxvZygpJT4iTm9kZSBoYXMgYSB2YWxpZCBwYXJlbnQsIG5vIGxvY2FsIFNRTCBwb3NzaWJsZSIpOw0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgdG9vbC5fX2RtbFN0YXRlbWVudHMgPSB0b29sLl9fZG1sU3RhdGVtZW50cyB8fCBbXTsNCjwlIGNsc1Rvb2xzKGMpLmZvckVhY2godCA9PiB7JT4NCiAgICAgICAgICAgIDwlPWxvZygpJT4iWzwlPXQlPl06IENvbm5lY3RpbmcuLi4iKTsNCg0KICAgICAgICAgICAgaWYodG9vbC50eXBlLm5hbWU9PSI8JT10JT4iKXsNCiAgICA8JSBpZih0PT0iRU1TIil7JT4NCiAgICA8JSB9ZWxzZSBpZih0PT0iTW9uZ29EQiIpeyU+DQogICAgICAgICAgICAgICAgLy88JT1sb2coKSU+dGhpcy5fX2NvbmZpZygndXJpJywgbnVsbCwge3Rvb2w6IHRvb2x9KSwgdGhpcy5fX2NvbmZpZygnY29uZmlnJywgbnVsbCwge3Rvb2w6IHRvb2x9KSk7DQogICAgICAgICAgICAgICAgaWYodHlwZW9mKG1vbmdvZGIpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgICAgICB0b29sLmRiID0gKGF3YWl0IG5ldyBtb25nb2RiLk1vbmdvQ2xpZW50KHRoaXMuX19jb25maWcoJ3VyaScsIG51bGwsIHt0b29sOiB0b29sfSksIHRoaXMuX19jb25maWcoJ2NvbmZpZycsIG51bGwsIHt0b29sOiB0b29sfSkpLmNvbm5lY3QoKSkuZGIodGhpcy5fX2NvbmZpZygnZGF0YWJhc2UnLCAiPCU9c2NvcGUlPiIsIHt0b29sOiB0b29sfSkpOw0KICAgICAgICAgICAgICAgIH0NCiAgICA8JSB9ZWxzZSBpZih0PT0nUnhEQicpeyU+DQogICAgICAgICAgICAgICAgdG9vbC5kYiA9IGF3YWl0IFJ4REIuY3JlYXRlUnhEYXRhYmFzZSh7bmFtZTogdGhpcy5fX2NvbmZpZygnZGF0YWJhc2UnLCAiPCU9c2NvcGUlPiIsIHt0b29sOiB0b29sfSksIHN0b3JhZ2U6IG51bGx9KTsNCiAgICA8JSB9ZWxzZSBpZih0PT0nWmFuZ29EQicpeyU+DQogICAgICAgICAgICAgICAgdG9vbC5kYiA9IG5ldyB6YW5nby5EYih0aGlzLl9fY29uZmlnKCdkYXRhYmFzZScsICI8JT1zY29wZSU+Iiwge3Rvb2w6IHRvb2x9KSwgew0KICAgICAgICA8JSBhckNsYXNzZXMuZm9yRWFjaChlYyA9PiB7JT4NCiAgICAgICAgICAgICAgICAgICAgPCU9bk5hbWUoZWMpJT46IFsiPCU9ZWMuRW50aXR5QXR0cmlidXRlcy5maWx0ZXIoZWEgPT4gIWVhLkVudGl0eU1ldGhvZCkubWFwKGVhID0+IG5OYW1lKGVhKSkuam9pbignXCIsIFwiJyklPiJdLA0KICAgICAgICA8JSB9KSAlPg0KICAgICAgICAgICAgICAgIH0pOw0KICAgIDwlIH1lbHNlIGlmKHQ9PSdLYWZrYScpeyU+DQogICAgICAgICAgICAgICAgaWYodHlwZW9mKGthZmthanMpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgICAgICB0b29sLmRiID0gbmV3IGthZmthanMuS2Fma2Eoew0KICAgICAgICAgICAgICAgICAgICAgICAgY2xpZW50SWQ6IHRoaXMuX19jb25maWcoJ2NsaWVudElkJywgbnVsbCwge3Rvb2w6IHRvb2x9KSwNCiAgICAgICAgICAgICAgICAgICAgICAgIGJyb2tlcnM6IFt0aGlzLl9fY29uZmlnKCdicm9rZXJzJywgbnVsbCwge3Rvb2w6IHRvb2x9KV0sDQogICAgICAgICAgICAgICAgICAgICAgICBzc2w6IHRydWUsDQogICAgICAgICAgICAgICAgICAgICAgICBzYXNsOiB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlcm5hbWU6IHRoaXMuX19jb25maWcoJ2NsaWVudElkJywgbnVsbCwge3Rvb2w6IHRvb2x9KSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXNzd29yZDogdGhpcy5fX2NvbmZpZygnc2FzbF9wYXNzd29yZCcsIG51bGwsIHt0b29sOiB0b29sfSksDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVjaGFuaXNtOiB0aGlzLl9fY29uZmlnKCdzYXNsX21lY2hhbmlzbXMnLCBudWxsLCB7dG9vbDogdG9vbH0pLA0KICAgICAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbm5lY3Rpb25UaW1lb3V0OiAzMDAwLA0KICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICAgICAgdG9vbC5wcm9kdWNlciA9IHRvb2wuZGIucHJvZHVjZXIoKTsNCiAgICAgICAgICAgICAgICAgICAgYXdhaXQgdG9vbC5wcm9kdWNlci5jb25uZWN0KCk7DQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICB0b29sLmNvbnN1bWVyID0gdG9vbC5kYi5jb25zdW1lcih7Z3JvdXBJZDogdGhpcy5fX2NvbmZpZygnY2xpZW50SWQnLCBudWxsLCB7dG9vbDogdG9vbH0pfSk7DQogICAgICAgICAgICAgICAgICAgIGF3YWl0IHRvb2wuY29uc3VtZXIuY29ubmVjdCgpOw0KICAgICAgICAgICAgICAgICAgICBhd2FpdCB0b29sLmNvbnN1bWVyLnN1YnNjcmliZSh7DQogICAgICAgICAgICAgICAgICAgICAgICB0b3BpYzogJzwlPXNjb3BlJT4uY2FsbCcsDQogICAgICAgICAgICAgICAgICAgICAgICBmcm9tQmVnaW5uaW5nOiBmYWxzZSwNCiAgICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgIDwlIGlmKF9jTmFtZSgnRXZlbnQnKSl7JT4NCiAgICAgICAgICAgICAgICAgICAgdG9vbC5jb25zdW1lci5ydW4oe2VhY2hNZXNzYWdlOiBhc3luYyAoeyB0b3BpYywgcGFydGl0aW9uLCBtZXNzYWdlIH0pID0+IG5ldyA8JT1zY29wZSU+LjwlPV9jTmFtZSgnRXZlbnQnLCB0cnVlKSU+KCkuX2Zyb21Eb2N1bWVudChtZXNzYWdlLnZhbHVlLnRvU3RyaW5nKCkpLnByb2Nlc3MoKX0pOw0KICAgICAgICA8JSB9JT4NCiAgICAgICAgICAgICAgICB9DQogICAgPCV9ZWxzZSBpZih0PT0nTWVtb3J5Jyl7JT4NCiAgICAgICAgICAgICAgICB0b29sLmRiID0gew0KICAgICAgICA8JSBhckNsYXNzZXMuZm9yRWFjaChlYyA9PiB7JT4NCiAgICAgICAgICAgICAgICAgICAgJzwlPW5OYW1lKGVjKSU+JzogW10sDQogICAgICAgIDwlIH0pOyAlPg0KICAgICAgICAgICAgICAgIH07DQogICAgPCV9ZWxzZSBpZih0PT0iRXhjZWwiKXslPg0KICAgICAgICAgICAgICAgIGlmKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgICAgICA8JT1zY29wZSU+LmRiID0gPCU9c2NvcGUlPi54bHN4RGF0YT9YTFNYLnJlYWQoPCU9c2NvcGUlPi54bHN4RGF0YSk6WExTWC51dGlscy5ib29rX25ldygpOw0KICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICA8JT1zY29wZSU+LmRiID0gWExTWC5yZWFkKGF3YWl0IGZzLnByb21pc2VzLnJlYWRGaWxlKHRoaXMuX19jb25maWcoJ2ZpbGVuYW1lJywgbnVsbCwge3Rvb2w6IHRvb2x9KSkpOw0KICAgICAgICAgICAgICAgIH0NCiAgICA8JX1lbHNlIGlmKHQ9PSJTbm93Rmxha2UiKXslPg0KICAgICAgICAgICAgICAgIGlmKHR5cGVvZihnbG9iYWwpIT09J3VuZGVmaW5lZCcgJiYgZ2xvYmFsLnNub3dmbGFrZSl7DQogICAgICAgICAgICAgICAgICAgIHRvb2wuZGIgPSBnbG9iYWwuc25vd2ZsYWtlLmNyZWF0ZUNvbm5lY3Rpb24oew0KICAgICAgICAgICAgICAgICAgICAgICAgYWNjb3VudDogdGhpcy5fX2NvbmZpZygiYWNjb3VudCIsIG51bGwsIHt0b29sOiB0b29sfSksDQogICAgICAgICAgICAgICAgICAgICAgICB1c2VybmFtZTogdGhpcy5fX2NvbmZpZygidXNlcm5hbWUiLCBudWxsLCB7dG9vbDogdG9vbH0pLA0KICAgICAgICAgICAgICAgICAgICAgICAgcGFzc3dvcmQ6IHRoaXMuX19jb25maWcoInBhc3N3b3JkIiwgbnVsbCwge3Rvb2w6IHRvb2x9KSwNCiAgICAgICAgICAgICAgICAgICAgICAgIGFwcGxpY2F0aW9uOiB0aGlzLl9fY29uZmlnKCJzY29wZSIsIG51bGwsIHt0b29sOiB0b29sfSkgfHwgIjwlPXNjb3BlJT4iLA0KICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICAgICAgYXdhaXQgbmV3IFByb21pc2UoKHJlcywgcmVqKSA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICB0b29sLmRiLmNvbm5lY3QoKGVyciwgY29ubik9PnsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXJyKXsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPCU9ZXJyb3IoKSU+J1VuYWJsZSB0byBjb25uZWN0OiAnICsgZXJyLm1lc3NhZ2UpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWooZXJyKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b29sLmRiLmNvbm5lY3Rpb25fSUQgPSBjb25uLmdldElkKCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcygpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICB9DQogICAgPCV9ZWxzZSBpZih0PT0iTmVvNGoiKXslPg0KICAgICAgICAgICAgICAgIHRvb2wuZGIgPSBuZW80ai5kcml2ZXIoDQogICAgICAgICAgICAgICAgICAgIHRoaXMuX19jb25maWcoJ3VybCcsIG51bGwsIHt0b29sOiB0b29sfSksDQogICAgICAgICAgICAgICAgICAgIG5lbzRqLmF1dGguYmFzaWModGhpcy5fX2NvbmZpZygndXNlcm5hbWUnLCBudWxsLCB7dG9vbDogdG9vbH0pLCB0aGlzLl9fY29uZmlnKCdwYXNzd29yZCcsIG51bGwsIHt0b29sOiB0b29sfSkpDQogICAgICAgICAgICAgICAgKTsNCiAgICA8JX1lbHNlIGlmKHQ9PSJBaXJUYWJsZSIpeyU+DQogICAgICAgICAgICAgICAgdG9vbC5kYiA9IHsNCiAgICAgICAgICAgICAgICAgICAgYmFzZUlkOiAnJywNCiAgICAgICAgICAgICAgICAgICAgd29ya3NwYWNlSWQ6IHRoaXMuX19jb25maWcoJ3dvcmtzcGFjZUlkJywgbnVsbCwge3Rvb2w6IHRvb2x9KSwNCiAgICAgICAgICAgICAgICAgICAgbmFtZTogJycsDQogICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAnJywNCiAgICAgICAgICAgICAgICAgICAgdXNlcklkOiAoYXdhaXQgdGhpcy5fYWlydGFibGUoJ21ldGEvd2hvYW1pJykpLmlkLA0KICAgICAgICAgICAgICAgIH07DQoNCiAgICAgICAgICAgICAgICBsZXQgYmFzZXMgPSAoYXdhaXQgdGhpcy5fYWlydGFibGUoJ21ldGEvYmFzZXMnKSkuYmFzZXM7DQogICAgICAgICAgICAgICAgaWYoYmFzZXMubGVuZ3RoKXsNCiAgICAgICAgICAgICAgICAgICAgdG9vbC5kYi5iYXNlSWQgPSBiYXNlcy5maWx0ZXIoYiA9PiBiLm5hbWU9PSc8JT1zY29wZSU+JykuaWQ7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmKCF0aGlzLlRvb2wuZGIuYmFzZUlkKSB0b29sLmRiLmJhc2VJZCA9ICdhcHAnICsgdGhpcy5fdXVpZCgpLnNwbGl0KCctJykuc2xpY2UoLTEpWzBdOw0KICAgIDwlfWVsc2UgaWYodD09IlNxbERCIil7JT4NCiAgICAgICAgICAgICAgICBpZih0eXBlb2YoZ2xvYmFsKSE9PSd1bmRlZmluZWQnICYmIGdsb2JhbFt0aGlzLl9fY29uZmlnKCd0eXBlJywgbnVsbCwge3Rvb2w6IHRvb2x9KV0pew0KICAgICAgICAgICAgICAgICAgICBpZihnbG9iYWxbdGhpcy5fX2NvbmZpZygndHlwZScsIG51bGwsIHt0b29sOiB0b29sfSldLkRhdGFiYXNlKXsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRvb2wuZGIgPSBuZXcgZ2xvYmFsW3RoaXMuX19jb25maWcoJ3R5cGUnLCBudWxsLCB0b29sKV0uRGF0YWJhc2UodGhpcy5fX2NvbmZpZygnZGF0YWJhc2UnLCBudWxsLCB7dG9vbDogdG9vbH0pIHx8ICIuLzwlPXNjb3BlJT4uZGIiKTsNCiAgICAgICAgICAgICAgICAgICAgfWVsc2UgaWYoZ2xvYmFsW3RoaXMuX19jb25maWcoJ3R5cGUnLCBudWxsLCB7dG9vbDogdG9vbH0pXS5jcmVhdGVDb25uZWN0aW9uKXsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRvb2wuZGIgPSBnbG9iYWxbdGhpcy5fX2NvbmZpZygndHlwZScsIG51bGwsIHt0b29sOiB0b29sfSldLmNyZWF0ZUNvbm5lY3Rpb24oew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhvc3Q6IHRoaXMuX19jb25maWcoJ3NlcnZlcicsIG51bGwsIHt0b29sOiB0b29sfSksDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlcjogdGhpcy5fX2NvbmZpZygndXNlcm5hbWUnLCBudWxsLCB7dG9vbDogdG9vbH0pLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhc3N3b3JkOiB0aGlzLl9fY29uZmlnKCdwYXNzd29yZCcsIG51bGwsIHt0b29sOiB0b29sfSksDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YWJhc2U6IHRoaXMuX19jb25maWcoJ2RhdGFiYXNlJywgbnVsbCwge3Rvb2w6IHRvb2x9KSB8fCAiPCU9c2NvcGUlPiIsDQogICAgICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICAgICAgfWVsc2UgaWYoZ2xvYmFsW3RoaXMuX19jb25maWcoJ3R5cGUnLCBudWxsLCB7dG9vbDogdG9vbH0pXS5DbGllbnQpew0KICAgICAgICAgICAgICAgICAgICAgICAgdG9vbC5kYiA9IG5ldyBnbG9iYWxbdGhpcy5fX2NvbmZpZygndHlwZScsIG51bGwsIHt0b29sOiB0b29sfSldLkNsaWVudCh7Y29ubmVjdGlvblN0cmluZzogdGhpcy5fX2NvbmZpZygnY29ubnN0cicsIG51bGwsIHt0b29sOiB0b29sfSl9KTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHRvb2wuZGIuY29ubmVjdCgpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfWVsc2UgaWYodHlwZW9mKGdsb2JhbCk9PT0ndW5kZWZpbmVkJyAmJiB0aGlzLl9fY29uZmlnKCd0eXBlJywgbnVsbCwge3Rvb2w6IHRvb2x9KT09PSdzcWxpdGUnKXsNCiAgICAgICAgICAgICAgICAgICAgLy8gc3FsaXRlIGluIGJyb3dzZXINCiAgICAgICAgICAgICAgICAgICAgdG9vbC5kYiA9IG5ldyBTUUwuRGF0YWJhc2UoKTsNCiAgICAgICAgICAgICAgICB9DQogICAgPCV9ZWxzZSBpZih0PT0iU2VydmljZU5vdyIpeyU+DQogICAgICAgICAgICAgICAgaWYodHlwZW9mKHRvb2wuc3lzX3Njb3BlKT09PSJ1bmRlZmluZWQiKXsNCiAgICAgICAgICAgICAgICAgICAgLy8gdG9vbC5zeXNfc2NvcGUgPSAoYXdhaXQgdGhpcy5fcmVzdCgic3lzX2FwcCIsIHtzeXNfc2NvcGU6IHRoaXMuX19jb25maWcoInNjb3BlIiwgbnVsbCwge3Rvb2w6IHRvb2x9KSB8fCAiZ2xvYmFsIn0pKVswXS5zeXNfaWQ7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmKHR5cGVvZih0b29sLnN5c19wcm9wZXJ0aWVzKT09PSJ1bmRlZmluZWQiKXsNCiAgICAgICAgICAgICAgICAgICAgLy8gbG9hZGluZyBzb21lIHBsYXRmb3JtIHN0dWZmDQogICAgICAgICAgICAgICAgICAgIHRvb2wuc3lzX3Byb3BlcnRpZXMgPSB7fTsNCiAgICAgICAgICAgICAgICAgICAgbGV0IGNvbmRpdGlvbiA9IE9iamVjdC5rZXlzKHRvb2wuc3lzX3Byb3BlcnRpZXMpLmZpbHRlcihrID0+ICF0b29sLnN5c19wcm9wZXJ0aWVzW2tdKS5qb2luKCcsJyk7DQogICAgICAgICAgICAgICAgICAgIGlmKGNvbmRpdGlvbil7DQogICAgICAgICAgICAgICAgICAgICAgICAoYXdhaXQgdGhpcy5fcmVzdCgic3lzX3Byb3BlcnRpZXMiLCB7bmFtZTogIklOIitjb25kaXRpb259KSkuZm9yRWFjaChyID0+IHRvb2wuc3lzX3Byb3BlcnRpZXNbci5uYW1lXSA9IHIudmFsdWUpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgIDwlfSU+DQogICAgICAgICAgICB9DQo8JSB9KSU+DQogICAgICAgIH1jYXRjaChleCl7DQogICAgICAgICAgICA8JT1lcnJvcigpJT5leCk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHRoaXM7DQo8JSB9JT4NCiAgICB9DQogICAgLyogRW5kOiBVdGlsIGZ1bmN0aW9ucyAqLw0KICAgIA0KICAgIDwlPW1OYW1lPSdfbWF0Y2hlcyclPihxdWVyeSwgb3B0aW9ucyl7DQogICAgICAgIHRyeXsNCiAgICAgICAgICAgIGlmKCFxdWVyeSB8fCAhcXVlcnkuRW50aXR5Q2xhc3MgfHwgcXVlcnkuRW50aXR5Q2xhc3MuTmFtZSE9IjwlPW5OYW1lKGMpJT4iKSByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZihtaWNyb2RpZmYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIGxldCB0SGFzaCA9IHRoaXMuX3RvSGFzaChudWxsLCB7bm9Db2RlOiB0cnVlfSwgJzwlPW1OYW1lJT4nLCB7b25seVVuaXF1ZTogb3B0aW9ucy5vbmx5VW5pcXVlfSkuX3RoaXM7DQogICAgICAgICAgICAgICAgbGV0IHFIYXNoID0gcXVlcnkuX3RvSGFzaChudWxsLCB7bm9Db2RlOiB0cnVlfSwgJzwlPW1OYW1lJT4nLCB7b25seVVuaXF1ZTogb3B0aW9ucy5vbmx5VW5pcXVlfSkuX3RoaXM7DQogICAgICAgICAgICAgICAgbGV0IGRpZmYgPSBtaWNyb2RpZmYocUhhc2gsIHRIYXNoKS5maWx0ZXIoZCA9PiBkLnR5cGUhPSdDUkVBVEUnICYmIFsnT1BFUkFUT1JTJywgJ0lkJ10uaW5kZXhPZihkLnBhdGhbMF0pPDApOw0KICAgICAgICAgICAgICAgIDwlPWxvZygpJT50SGFzaCwgcUhhc2gsIGRpZmYpOw0KICAgICAgICAgICAgICAgIGxldCByZXQgPSBkaWZmLmZpbHRlcihkID0+IGQudHlwZT09J0NIQU5HRScpLnJlZHVjZSgodiwgZCkgPT4gew0KICAgICAgICAgICAgICAgICAgICBsZXQgY29vcCA9IHF1ZXJ5WydfJyArIGQucGF0aFswXSArICdfY29vcCddIHx8ICh0eXBlb2YoZC52YWx1ZSk9PT0nc3RyaW5nJz8nTElLRSc6Jz0nKTsNCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIGxldCBvbGRWYWx1ZSA9IHR5cGVvZihkLm9sZFZhbHVlKT09PSdzdHJpbmcnP2Qub2xkVmFsdWUuc3BsaXQoJy8nKS5zbGljZSgtMSlbMF06ZC5vbGRWYWx1ZTsNCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIDwlPWxvZygpJT5kLnBhdGhbMF0sIGQub2xkVmFsdWUsIGQudmFsdWUsIGNvb3AsIG9sZFZhbHVlLCBkKTsNCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIHN3aXRjaChjb29wKXsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ0xJS0UnOiByZXR1cm4gdiAmJiBkLnZhbHVlLmluZGV4T2Yob2xkVmFsdWUpPj0wOw0KICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnPSc6IHJldHVybiB2ICYmICghZC52YWx1ZSB8fCBkLnZhbHVlPT1vbGRWYWx1ZSk7DQogICAgICAgICAgICAgICAgICAgICAgICBjYXNlICchPSc6IHJldHVybiB2ICYmIGQudmFsdWUhPW9sZFZhbHVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnPj0nOiByZXR1cm4gdiAmJiBkLnZhbHVlPj1vbGRWYWx1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJzw9JzogcmV0dXJuIHYgJiYgZC52YWx1ZTw9b2xkVmFsdWU7DQogICAgICAgICAgICAgICAgICAgICAgICBjYXNlICc+JzogcmV0dXJuIHYgJiYgZC52YWx1ZT5vbGRWYWx1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJzwnOiByZXR1cm4gdiAmJiBkLnZhbHVlPG9sZFZhbHVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDogcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSwgdHJ1ZSk7DQogICAgICAgICAgICAgICAgcmV0dXJuIHJldDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgbGV0IG9NYXRjaCA9IHRoaXMuX19leHBvcnQoe30sIHsNCiAgICAgICAgICAgICAgICAvL0Z1bGw6IHRydWUsDQogICAgICAgICAgICAgICAgLy9OdWxsOiB0cnVlLA0KICAgICAgICAgICAgICAgIElkOiAob2JqLCBlYUNvZGUsIHYpID0+IG9iai5faWQgPSB0aGlzLklkPT1xdWVyeS5JZCwNCiAgICAgICAgPCUgYy5FbnRpdHlBdHRyaWJ1dGVzLmZpbHRlcihlYSA9PiAhZWEuRW50aXR5TWV0aG9kKS5mb3JFYWNoKGVhID0+IHslPg0KICAgICAgICAgICAgICAgIDwlPW5OYW1lKGVhKSU+OiAob2JqLCBlYUNvZGUsIHYpID0+IHsNCiAgICAgICAgICAgIDwlIGlmKGVhLkVudGl0eVR5cGUpeyU+DQogICAgICAgICAgICAgICAgICAgIG9iai48JT1uTmFtZShlYSklPiA9IHY/di48JT1tTmFtZSU+KHF1ZXJ5P3F1ZXJ5LjwlPW5OYW1lKGVhKSU+KCk6bnVsbCk6dHJ1ZTsNCiAgICAgICAgICAgIDwlIH1lbHNleyU+DQogICAgICAgICAgICAgICAgICAgIG9iai48JT1uTmFtZShlYSklPiA9IHY9PXF1ZXJ5LjwlPW5OYW1lKGVhKSU+KCk7DQogICAgICAgICAgICA8JSB9JT4NCiAgICAgICAgICAgICAgICAgICAgaWYoDQogICAgICAgICAgICAgICAgICAgICAgICAodGhpcy5fPCU9bk5hbWUoZWEpJT5fc2V0ICYmICFxdWVyeS5fPCU9bk5hbWUoZWEpJT5fc2V0KSB8fA0KICAgICAgICAgICAgICAgICAgICAgICAgZmFsc2UNCiAgICAgICAgICAgICAgICAgICAgKSBvYmouPCU9bk5hbWUoZWEpJT4gPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgaWYoDQogICAgICAgICAgICAgICAgICAgICAgICAoIXRoaXMuXzwlPW5OYW1lKGVhKSU+X3NldCAmJiBxdWVyeS5fPCU9bk5hbWUoZWEpJT5fc2V0KSB8fA0KICAgICAgICAgICAgPCUgaWYoZWEuRW50aXR5VHlwZSl7JT4NCiAgICAgICAgICAgICAgICAgICAgICAgICh0aGlzLjwlPW5OYW1lKGVhKSU+KCkgJiYgIXRoaXMuPCU9bk5hbWUoZWEpJT4oKS48JT1tTmFtZSU+KHF1ZXJ5LjwlPW5OYW1lKGVhKSU+KCkpKSB8fA0KICAgICAgICAgICAgPCUgfSU+DQogICAgICAgICAgICAgICAgICAgICAgICBmYWxzZQ0KICAgICAgICAgICAgICAgICAgICApIG9iai48JT1uTmFtZShlYSklPiA9IGZhbHNlOw0KICAgICAgICAgICAgICAgIH0sDQogICAgICAgIDwlIH0pOyAlPg0KICAgICAgICA8JSBjLlR5cGVkQXR0cmlidXRlcy5mb3JFYWNoKHRhID0+IHsgbGV0IHRhTmFtZSA9IG5OYW1lKHRhKSArICdfJyArIHRhLkVudGl0eUNsYXNzLlBsdXJhbC5yZXBsYWNlKC8gL2csICdfJyk7JT4NCiAgICAgICAgICAgICAgICA8JT10YU5hbWUlPjogKG9iaiwgZWFDb2RlLCB2KSA9PiB7DQogICAgICAgICAgICAgICAgICAgIG9iai48JT10YU5hbWUlPiA9IHYubWFwKF92ID0+IHF1ZXJ5LjwlPXRhTmFtZSU+KCkuYW55KHEgPT4gX3YuPCU9bU5hbWUlPihxKSkpOw0KICAgICAgICAgICAgICAgIH0sDQogICAgICAgIDwlIH0pJT4NCiAgICAgICAgICAgIH0sICI8JT1tTmFtZSU+Iik7DQogICAgICAgICAgICANCiAgICAgICAgICAgIDwlPWxvZygpJT5vTWF0Y2gpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICByZXR1cm4gT2JqZWN0LmtleXMob01hdGNoKS5ldmVyeShrID0+IG9NYXRjaFtrXSk7DQogICAgICAgIH1jYXRjaChleCl7DQogICAgICAgICAgICA8JT1lcnJvcigpJT5leCk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICA8JT1tTmFtZT0nX21hdGNoaW5nJyU+KHF1ZXJ5KXsNCiAgICAgICAgdHJ5ew0KICAgICAgICAgICAgbGV0IHJldCA9IFtdOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBsZXQgbWF0Y2hlcyA9IHRoaXMuX19leHBvcnQoe30sIHsNCiAgICAgICAgPCUgYy5FbnRpdHlBdHRyaWJ1dGVzLmZpbHRlcihlYSA9PiAhZWEuRW50aXR5TWV0aG9kICYmIGVhLkVudGl0eVR5cGUpLmZvckVhY2goZWEgPT4geyU+DQogICAgICAgICAgICAgICAgPCU9bk5hbWUoZWEpJT46IChvYmosIGVhQ29kZSwgdikgPT4gew0KICAgICAgICAgICAgICAgICAgICA8JT1sb2coKSU+IkZvciA8JT1uTmFtZShlYSklPiIpOw0KICAgICAgICAgICAgICAgICAgICBvYmouPCU9bk5hbWUoZWEpJT4gPSB2P1t2LjwlPW1OYW1lJT4ocXVlcnkpP3Y6bnVsbF0uY29uY2F0KHYuPCU9bU5hbWUlPihxdWVyeSkpLmZpbHRlcihtID0+IG0pOltdOw0KICAgICAgICAgICAgICAgIH0sDQogICAgICAgIDwlIH0pJT4NCiAgICAgICAgPCUgYy5UeXBlZEF0dHJpYnV0ZXMuZm9yRWFjaCh0YSA9PiB7IGxldCB0YU5hbWUgPSBuTmFtZSh0YSkgKyAnXycgKyB0YS5FbnRpdHlDbGFzcy5QbHVyYWwucmVwbGFjZSgvIC9nLCAnXycpOyU+DQogICAgICAgICAgICAgICAgPCU9dGFOYW1lJT46IChvYmosIGVhQ29kZSwgdikgPT4gew0KICAgICAgICAgICAgICAgICAgICBvYmouPCU9dGFOYW1lJT4gPSB2Lm1hcChfdiA9PiBfdi48JT1tTmFtZSU+KHF1ZXJ5KSkuZmxhdCgpOw0KICAgICAgICAgICAgICAgIH0sDQogICAgICAgIDwlIH0pJT4NCiAgICAgICAgICAgIH0sICI8JT1tTmFtZSU+Iik7DQoNCiAgICAgICAgICAgIDwlPWxvZygpJT4ibWF0Y2hlcyIsIG1hdGNoZXMpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICByZXQgPSBbLi4ubmV3IFNldChPYmplY3Qua2V5cyhtYXRjaGVzKS5tYXAoayA9PiBtYXRjaGVzW2tdKS5mbGF0KCkpXS5maWx0ZXIobSA9PiBtIT1xdWVyeSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIDwlPWxvZygpJT4icmV0IiwgcmV0KTsNCiAgICAgICAgICAgIHJldHVybiByZXQ7DQogICAgICAgIH1jYXRjaChleCl7DQogICAgICAgICAgICA8JT1lcnJvcigpJT5leCk7DQogICAgICAgIH0NCiAgICB9DQogICAgDQogICAgPCU9bU5hbWU9J19kZVJlZmVyZW5jZSclPihyb290KXsNCiAgICAgICAgdHJ5ew0KICAgICAgICAgICAgaWYoIXJvb3QpIHJvb3Q9dGhpczsNCg0KICAgICAgICAgICAgaWYocm9vdCE9dGhpcyAmJiB0aGlzLlNldF9Pbikgew0KICAgICAgICAgICAgICAgIGxldCBteU1hdGNoZXMgPSByb290Ll9tYXRjaGluZyh0aGlzKTsNCiAgICAgICAgICAgICAgICBpZighbXlNYXRjaGVzLmxlbmd0aCkgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICAgICAgPCU9bG9nKCklPiJRdWVyeSIsIG15TWF0Y2hlcy5sZWd0aCk7DQogICAgICAgICAgICAgICAgcmV0dXJuIG15TWF0Y2hlc1swXTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgIHRoaXMuX19leHBvcnQoe30sIHsNCiAgICAgICAgPCUgYy5FbnRpdHlBdHRyaWJ1dGVzLmZpbHRlcihlYSA9PiAhZWEuRW50aXR5TWV0aG9kICYmIGVhLkVudGl0eVR5cGUpLmZvckVhY2goZWEgPT4geyU+DQogICAgICAgICAgICAgICAgPCU9bk5hbWUoZWEpJT46IChvYmosIGVhQ29kZSwgdikgPT4gew0KICAgICAgICAgICAgICAgICAgICBpZih2KXsNCiAgICAgICAgICAgICAgICAgICAgICAgIGxldCByZXQgPSB2LjwlPW1OYW1lJT4ocm9vdCk7DQogICAgICAgICAgICAgICAgICAgICAgICBpZihyZXQhPXYpIHRoaXMuPCU9bk5hbWUoZWEpJT4ocmV0KTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0sDQogICAgICAgIDwlIH0pOyAlPg0KICAgICAgICANCiAgICAgICAgPCUgYy5UeXBlZEF0dHJpYnV0ZXMuZm9yRWFjaCh0YSA9PiB7IGxldCB0YU5hbWUgPSBuTmFtZSh0YSkgKyAnXycgKyB0YS5FbnRpdHlDbGFzcy5QbHVyYWwucmVwbGFjZSgvIC9nLCAnXycpOyU+DQogICAgICAgICAgICAgICAgPCU9dGFOYW1lJT46IChvYmosIGVhQ29kZSwgdikgPT4gew0KICAgICAgICAgICAgICAgICAgICB2LmZpbHRlcih0YSA9PiB0YSkuZm9yRWFjaCgodGEsIGkpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGxldCByZXQgPSB0YS48JT1tTmFtZSU+KHJvb3QpOw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYocmV0IT10YSkgdGhpcy48JT10YU5hbWUlPigpW2ldID0gcmV0Ow0KICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICB9LA0KICAgICAgICA8JSB9KSU+DQogICAgICAgICAgICB9LCAiPCU9bU5hbWUlPiIpOw0KDQogICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgfWNhdGNoKGV4KXsNCiAgICAgICAgICAgIDwlPWVycm9yKCklPmV4KTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICANCiAgICA8JT1tTmFtZT0nX2Zyb21Eb2N1bWVudCclPihvYmosIGJUb29sKXsNCiAgICAgICAgaWYoIW9iaikgcmV0dXJuIHRoaXM7DQogICAgICAgIGlmKG9iai48JT1tTmFtZSU+KSByZXR1cm4gb2JqOw0KICAgICAgICANCiAgICAgICAgaWYodHlwZW9mKG9iaik9PT0nc3RyaW5nJyl7DQogICAgICAgICAgICBpZig8JT1fYjY0dGVzdCgnb2JqJyklPikgb2JqID0gdGhpcy5fYXRvYihvYmopOw0KICAgICAgICAgICAgDQogICAgICAgICAgICB0cnl7DQogICAgICAgICAgICAgICAgaWYob2JqLmxlbmd0aDwzMyAmJiAhb2JqLm1hdGNoKC9ccy9nKSl7DQogICAgICAgICAgICAgICAgICAgIG9iaiA9IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIFt0aGlzLl9fY29uZmlnKCdpZEZpZWxkJywgJ0lkJywge3Rvb2w6IG9iai5fX3Rvb2x9KV06IG9iag0KICAgICAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICBvYmogPSBKU09OLnBhcnNlKG9iaik7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfWNhdGNoKGV4KXsNCiAgICAgICAgICAgICAgICA8JT13YXJuKCklPiJJbnZhbGlkIEpTT04gb3IgVVVJRCIsIG9iaik7DQogICAgICAgICAgICB9DQogICAgICAgIH1lbHNlIGlmKEFycmF5LmlzQXJyYXkob2JqKSl7DQogICAgICAgICAgICByZXR1cm4gb2JqLm1hcChvID0+IHRoaXMuPCU9bU5hbWUlPihvLCBiVG9vbCkpOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICBpZihvYmouX190b29sKSB0aGlzLlRvb2wgPSBvYmouX190b29sOw0KICAgICAgICANCiAgICAgICAgaWYoIU9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGsgPT4gdHlwZW9mKG9ialtrXSkhPT0ndW5kZWZpbmVkJyAmJiBvYmpba10hPT1udWxsKS5sZW5ndGgpew0KICAgICAgICAgICAgPCU9bG9nKCklPiJFbXB0eSBvYmplY3Qgb3Igb2JqZWN0IG9mIG51bGxzIiwgb2JqKTsNCiAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICB9DQoNCiAgICAgICAgPCU9bG9nKCklPm9iaik7DQogICAgICAgIHJldHVybiB0aGlzLl9faW1wb3J0KG9iaiwgew0KICAgICAgICAgICAgX21hcDogYlRvb2wsDQogICAgICAgICAgICBpbXBvcnRlcjogdiA9PiB2Lm9iaiA9ICh2Lm9iaiYmdi5vYmouU2V0X0NvdW50PHRoaXMuU2V0X0NvdW50KT90aGlzOnYub2JqLA0KICAgICAgICAgICAgX1RISVM6IG9iaiA9PiB0aGlzLlRISVMob2JqLlRISVMsIG9iai5PUEVSQVRPUlM/b2JqLk9QRVJBVE9SUy5USElTOnVuZGVmaW5lZCksDQogICAgICAgICAgICBJZDogKG9iaiwgaWRDb2RlKSA9PiB7DQogICAgICAgICAgICAgICAgaWYoaWRDb2RlPT0nSWQnKSBpZENvZGUgPSB0aGlzLl9fY29uZmlnKCdpZEZpZWxkJywgJ0lkJyk7DQogICAgICAgICAgICAgICAgaWYob2JqW2lkQ29kZV0pIHRoaXMuSWQgPSBvYmpbaWRDb2RlXTsNCiAgICAgICAgICAgIH0sDQogICAgPCUgYy5FbnRpdHlBdHRyaWJ1dGVzLmZpbHRlcihlYSA9PiAhZWEuRW50aXR5TWV0aG9kKS5mb3JFYWNoKGVhID0+IHsgJT4NCiAgICAgICAgICAgIDwlPW5OYW1lKGVhKSU+OiAob2JqLCBlYUNvZGUpID0+IHsNCiAgICAgICAgICAgICAgICBpZihvYmouT1BFUkFUT1JTICYmIG9iai5PUEVSQVRPUlNbZWFDb2RlXSl7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuXzwlPW5OYW1lKGVhKSU+X2Nvb3AgPSBvYmouT1BFUkFUT1JTW2VhQ29kZV07DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIGxldCByZWYgPSBvYmpbZWFDb2RlXTsNCiAgICAgICAgICAgICAgICBpZih0eXBlb2YocmVmKT09PSd1bmRlZmluZWQnKSByZXR1cm47DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICA8JSBpZihlYS5FbnRpdHlUeXBlKXsgJT4NCiAgICAgICAgICAgICAgICA8JSBpZighZWEuSXNBcnJheSl7ICU+DQogICAgICAgICAgICAgICAgaWYodGhpcy5Ub29sLnR5cGUubmFtZT09IlJlc3REQklPIikgcmVmID0gcmVmWzBdOw0KICAgICAgICAgICAgICAgIGlmKCFyZWYpIHJldHVybjsNCiAgICAgICAgICAgICAgICA8JSB9ICU+DQoNCiAgICAgICAgICAgICAgICB0aGlzLjwlPW5OYW1lKGVhKSU+KCh0aGlzLjwlPW5OYW1lKGVhKSU+KCkgfHwgbmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKGVhLkVudGl0eVR5cGUsIHRydWUpJT4oKSkuPCU9bU5hbWUlPihyZWYsIGJUb29sKSk7DQogICAgICAgICAgICA8JSB9ZWxzZSBpZihlYS5Jc0RhdGUpeyAlPg0KICAgICAgICAgICAgICAgIGlmKHRoaXMuVG9vbC50eXBlLm5hbWU9PSJTcWxEQiIpew0KICAgICAgICAgICAgICAgICAgICBpZih0eXBlb2YobW9tZW50KSE9PSJ1bmRlZmluZWQiICYmIHR5cGVvZih0aGlzLlRvb2wuc3lzX3Byb3BlcnRpZXMpIT09InVuZGVmaW5lZCIpew0KICAgICAgICAgICAgICAgICAgICAgICAgcmVmID0gbW9tZW50LnBhcnNlWm9uZShyZWYsIHRoaXMuVG9vbC5zeXNfcHJvcGVydGllc1siZ2xpZGUuc3lzLmRhdGVfZm9ybWF0Il0gKyAiICIgKyB0aGlzLlRvb2wuc3lzX3Byb3BlcnRpZXNbImdsaWRlLnN5cy50aW1lX2Zvcm1hdCJdLCB0aGlzLlRvb2wuc3lzX3Byb3BlcnRpZXNbImdsaWRlLnN5cy5kZWZhdWx0LnR6Il0pLnRvRGF0ZSgpOw0KICAgICAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJlZiA9IG5ldyBEYXRlKHJlZik7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgaWYodHlwZW9mKHJlZik9PT0nc3RyaW5nJyl7DQogICAgICAgICAgICAgICAgICAgICAgICBpZihyZWYuaW5kZXhPZignVCcpPjApew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZiA9IERhdGUucGFyc2UocmVmKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZiA9IERhdGUucGFyc2UocmVmICsgIiBHTVQiKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICByZWYgPSBuZXcgRGF0ZShyZWYpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB0aGlzLjwlPW5OYW1lKGVhKSU+KHJlZik7DQogICAgICAgICAgICA8JSB9ZWxzZSBpZihlYS5Jc1RleHQpeyU+DQogICAgICAgICAgICAgICAgaWYoPCU9X2I2NHRlc3QoJ3JlZicpJT4peyAvLyBpcyBiYXNlNjQ/DQogICAgICAgICAgICAgICAgICAgIHRoaXMuPCU9bk5hbWUoZWEpJT4odGhpcy5fYXRvYihyZWYpKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICA8JSB9ZWxzZXsgJT4NCiAgICAgICAgICAgICAgICB0aGlzLjwlPW5OYW1lKGVhKSU+KHJlZik7DQogICAgICAgICAgICA8JSB9ICU+DQogICAgICAgICAgICB9LA0KICAgIDwlIH0pOyAlPg0KICAgIDwlIGMuVHlwZWRBdHRyaWJ1dGVzLmZvckVhY2godGEgPT4geyBsZXQgdGFOYW1lID0gbk5hbWUodGEpICsgJ18nICsgdGEuRW50aXR5Q2xhc3MuUGx1cmFsLnJlcGxhY2UoLyAvZywgJ18nKTslPg0KICAgICAgICAgICAgPCU9dGFOYW1lJT46IChvYmosIGVhQ29kZSkgPT4gb2JqW2VhQ29kZV0/dGhpcy48JT10YU5hbWUlPihvYmpbZWFDb2RlXS5tYXAoX3YgPT4gbmV3IDwlPXNjb3BlJT4uPCU9bk5hbWUodGEuRW50aXR5Q2xhc3MsIHRydWUpJT4oKS48JT1tTmFtZSU+KF92LCBiVG9vbCkpLCBvYmouT1BFUkFUT1JTP29iai5PUEVSQVRPUlNbZWFDb2RlXTp1bmRlZmluZWQsIHRydWUpOnVuZGVmaW5lZCwNCiAgICA8JSB9KSU+DQogICAgICAgIH0sICI8JT1tTmFtZSU+Iik7DQogICAgfQ0KICAgIA0KPCUgaWYoX2NOYW1lKCdFdmVudCcpKXslPg0KICAgIDwlPW1OYW1lPSdfdG9Qcm90byclPihvcHRpb25zPXt9LCBzUGF0aCl7DQogICAgICAgIHRyeXsNCiAgICAgICAgICAgIGxldCByZXQgPSB0aGlzLl9fZXhwb3J0KHtJZDogPCU9X25Db2RlKCklPiwgcHJvdG86IGBcblxubWVzc2FnZSAkezwlPV9uQ29kZSgpJT59IHtgLCBpbmRleDogMX0sIHsNCiAgICAgICAgICAgICAgICBfbWFwOiBvcHRpb25zLmJNYXAsDQogICAgICAgICAgICAgICAgRnVsbDogdHJ1ZSwNCiAgICAgICAgICAgICAgICBOdWxsOiB0cnVlLA0KICAgICAgICAgICAgICAgIGV4cG9ydGVyOiB2ID0+IHYub2JqPSh2LnJldXNlZD4xKT97cHJvdG86IGBcblxuLy8gcmV1c2VkWyR7di5yZXVzZWR9XTogJHs8JT1fbkNvZGUoKSU+fVxuXG5gfTp2Lm9iaiwNCiAgICAgICAgICAgICAgICBfVEhJUzogKG9iaiwgZWFDb2RlLCB2KSA9PiBvYmoucHJvdG8gKz0gYFxuXHRyZXBlYXRlZCAkezwlPV9uQ29kZSgpJT59ICR7ZWFDb2RlfSA9ICR7b2JqLmluZGV4Kyt9O2AsDQogICAgICAgICAgICAgICAgSWQ6IChvYmosIGlkQ29kZSwgdikgPT4gb2JqLnByb3RvICs9IGBcblx0c3RyaW5nICR7aWRDb2RlfSA9ICR7b2JqLmluZGV4Kyt9O2AsDQogICAgPCUgYy5FbnRpdHlBdHRyaWJ1dGVzLmZpbHRlcihlYSA9PiAhZWEuRW50aXR5TWV0aG9kKS5mb3JFYWNoKGVhID0+IHsgJT4NCiAgICAgICAgICAgICAgICA8JT1uTmFtZShlYSklPjogKG9iaiwgZWFDb2RlLCB2KSA9PiB7DQogICAgICAgIDwlIGlmKGVhLkVudGl0eVR5cGUpeyU+DQogICAgICAgICAgICAgICAgICAgIG9iai5wcm90byArPSBgXG5cdGAgKyBuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUoZWEuRW50aXR5VHlwZSwgdHJ1ZSklPigpLjwlPW1OYW1lJT4ob3B0aW9ucywgYCR7c1BhdGh9LiR7ZWFDb2RlfWApOw0KICAgICAgICA8JSB9JT4NCiAgICAgICAgICAgICAgICAgICAgb2JqLnByb3RvICs9IGBcblx0YDsNCiAgICAgICAgPCUgaWYoZWEuUmVxdWlyZWQpeyU+DQogICAgICAgICAgICAgICAgICAgIGlmKDwldmFsdWVPZihlYS5SZXF1aXJlZCklPikgb2JqLnByb3RvICs9ICdyZXF1aXJlZCAnOw0KICAgICAgICA8JSB9JT4NCiAgICAgICAgPCUgaWYoZWEuSXNBcnJheSl7JT4NCiAgICAgICAgICAgICAgICAgICAgb2JqLnByb3RvICs9ICdyZXBlYXRlZCAnOw0KICAgICAgICA8JSB9JT4NCiAgICAgICAgPCUgaWYoZWEuSXNTdHJpbmcgfHwgZWEuSXNUZXh0KXslPg0KICAgICAgICAgICAgICAgICAgICBvYmoucHJvdG8gKz0gInN0cmluZyI7DQogICAgICAgIDwlIH1lbHNlIGlmKGVhLklzQm9vbCl7JT4NCiAgICAgICAgICAgICAgICAgICAgb2JqLnByb3RvICs9ICJib29sIjsNCiAgICAgICAgPCUgfWVsc2UgaWYoZWEuSXNJbnQpeyU+DQogICAgICAgICAgICAgICAgICAgIG9iai5wcm90byArPSAiaW50MzIiOw0KICAgICAgICA8JSB9ZWxzZSBpZihlYS5Jc0xvbmcpeyU+DQogICAgICAgICAgICAgICAgICAgIG9iai5wcm90byArPSAiaW50NjQiOw0KICAgICAgICA8JSB9ZWxzZSBpZihlYS5Jc0Zsb3QpeyU+DQogICAgICAgICAgICAgICAgICAgIG9iai5wcm90byArPSAiZmxvYXQiOw0KICAgICAgICA8JSB9ZWxzZSBpZihlYS5Jc0RvdWJsZSl7JT4NCiAgICAgICAgICAgICAgICAgICAgb2JqLnByb3RvICs9ICJkb3VibGUiOw0KICAgICAgICA8JSB9ZWxzZSBpZihlYS5Jc0RhdGUpeyU+DQogICAgICAgICAgICAgICAgICAgIG9iai5wcm90byArPSAic3RyaW5nIjsNCiAgICAgICAgPCUgfWVsc2UgaWYoZWEuRW50aXR5VHlwZSl7JT4NCiAgICAgICAgICAgICAgICAgICAgb2JqLnByb3RvICs9IDwlPV9uQ29kZShlYS5FbnRpdHlUeXBlKSU+Ow0KICAgICAgICA8JSB9JT4NCiAgICAgICAgICAgICAgICAgICAgb2JqLnByb3RvICs9IGAgJHtlYUNvZGV9ID0gJHtvYmouaW5kZXgrK307YDsNCiAgICAgICAgICAgICAgICB9LA0KICAgIDwlIH0pJT4NCiAgICA8JSBjLlR5cGVkQXR0cmlidXRlcy5maWx0ZXIodGEgPT4gIXRhLkVudGl0eU1ldGhvZCkuZm9yRWFjaCh0YSA9PiB7bGV0IHRhTmFtZSA9IG5OYW1lKHRhKSArICdfJyArIHRhLkVudGl0eUNsYXNzLlBsdXJhbC5yZXBsYWNlKC8gL2csICdfJyk7JT4NCiAgICAgICAgICAgICAgICA8JT10YU5hbWUlPjogKG9iaiwgZWFDb2RlLCB2KSA9PiBvYmoucHJvdG8gKz0gYFxuXHRgICsgbmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKHRhLkVudGl0eUNsYXNzLCB0cnVlKSU+KCkuPCU9bU5hbWUlPihvcHRpb25zLCBgJHtzUGF0aH0uJHtlYUNvZGV9W11gKSArIGBcblx0cmVwZWF0ZWQgJHs8JT1fbkNvZGUodGEuRW50aXR5Q2xhc3MpJT59ICR7ZWFDb2RlfSA9ICR7b2JqLmluZGV4Kyt9O2AsDQogICAgPCUgfSklPg0KICAgIDwlIGMuRW50aXR5RmllbGRzLmZvckVhY2goZWYgPT4geyU+DQogICAgICAgICAgICAgICAgZWZfPCU9bk5hbWUoZWYpJT46IChvYmosIGVmQ29kZSwgdikgPT4gb2JqLnByb3RvICs9IGBcblx0c3RyaW5nICR7ZWZDb2RlfSA9ICR7b2JqLmluZGV4Kyt9O2AsDQogICAgPCUgfSklPg0KICAgICAgICAgICAgICAgIF9fY2xvc2U6IG9iaiA9PiBvYmoucHJvdG8gKz0gJ1xufVxuXG4nLA0KICAgICAgICAgICAgfSwgIjwlPW1OYW1lJT4iLCBvcHRpb25zLCBzUGF0aCkucHJvdG87DQogICAgICAgICAgICANCiAgICAgICAgICAgIGlmKHJldCAmJiAhc1BhdGgpew0KICAgICAgICAgICAgICAgIHJldCA9IGBwYWNrYWdlIDwlPXNjb3BlJT47XG5cbnN5bnRheCA9ICJwcm90bzMiO1xuXG5gICsgcmV0Ow0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIHJldDsNCiAgICAgICAgfWNhdGNoKGV4KXsNCiAgICAgICAgICAgIDwlPWVycm9yKCklPmV4KTsNCiAgICAgICAgfQ0KICAgIH0NCjwlfSU+DQoNCiAgICA8JT1tTmFtZT0nX3RvSlNPTiclPihvcHRpb25zPXt9LCBzUGF0aCl7DQogICAgICAgIHRyeXsNCiAgICAgICAgICAgIHNQYXRoID0gc1BhdGggfHwgIiI7DQogICAgICAgICAgICBsZXQgcmV0ID0ge307DQogICAgICAgICAgICByZXQuX19rZXlzID0gW107IC8vISENCiAgICAgICAgICAgIA0KICAgICAgICAgICAgaWYoIW9wdGlvbnMuYk1hcCl7DQogICAgICAgICAgICAgICAgcmV0Ll9fZ2VuZXJhdGVkID0gJyInICsgbmV3IERhdGUoKS50b0lTT1N0cmluZygpICsgJyInOw0KICAgICAgICAgICAgICAgIGlmKHRoaXMuVG9vbC5uYW1lKXsNCiAgICAgICAgICAgICAgICAgICAgcmV0Ll9fdG9vbCA9IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IHRoaXMuVG9vbC5uYW1lLA0KICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IHRoaXMuVG9vbC50eXBlLm5hbWUsDQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgICAgIHJldC5fX2NsYXNzID0gJyI8JT1uTmFtZShjKSU+Iic7DQogICAgICAgICAgICAgICAgICAgIHJldC5fX3R5cGUgPSAnIicrPCU9X25Db2RlKCklPisnIic7DQogICAgICAgICAgICAgICAgICAgIC8vcmV0Ll9fcGF0aCA9ICciJytzUGF0aCsnIic7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmKDwlPW5zY29wZSU+Ll9ub2RlKXsNCiAgICAgICAgICAgICAgICAgICAgcmV0Ll9fbm9kZSA9IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvZGU6IDwlPW5zY29wZSU+Ll9ub2RlLmNvZGUoKQ0KICAgICAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHRoaXMuX2RlZmF1bHRzKCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIGxldCB0ck1hcCA9IChvYmosIGVhQ29kZSwgdiwgc1BhdGgpID0+ICh2ICYmIHR5cGVvZih2KT09PSdzdHJpbmcnICYmIHYucmVwbGFjZSk/di5yZXBsYWNlKC88PFtePj5dKz4+L2dtLCBtID0+IHsNCiAgICAgICAgICAgICAgICA8JT1zY29wZSU+Ll9fdHJNYXAgPSA8JT1zY29wZSU+Ll9fdHJNYXAgfHwgW107DQoNCiAgICAgICAgICAgICAgICBsZXQgdHJpZCA9IHRoaXMuX3V1aWQoKTsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICBsZXQgcFBhdGggPSAnLicrKHNQYXRoLnNwbGl0KCcuJykuc2xpY2UoMSwgLTEpLmpvaW4oJy4nKSk7DQogICAgICAgICAgICAgICAgaWYocFBhdGg9PSIuIikgcFBhdGggPSAiIjsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICBsZXQgdHIgPSBtLnJlcGxhY2UoJzw8JywgJycpLnJlcGxhY2UoJz4+JywgJycpLnJlcGxhY2UoL3t7bnJ9fS9nbSwgJyRub3QoJGV4aXN0cyhfX3JldXNlZCkpJykucmVwbGFjZSgve3t2Zn19L2csIG9ialtlYUNvZGVdKTsNCiAgICAgICAgICAgICAgICBpZih0ci5zdGFydHNXaXRoKCdzKCcpICYmIHRyLmVuZHNXaXRoKCcpJykpew0KICAgICAgICAgICAgICAgICAgICB0ciA9IHRyLnJlcGxhY2UoL3t7X199fS9nbSwgJ29KU09OJytzUGF0aCkucmVwbGFjZSgve3twcGF0aH19L2dtLCAnb0pTT04nK3BQYXRoKTsNCiAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgdHIgPSB0ci5yZXBsYWNlKC97e19ffX0vZ20sIGAqKltJZD0ke29iai5JZH1dWzBdYCk7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgLy8gPCU9d2FybigpJT5lYUNvZGUsIHRyaWQsIHRyKTsNCg0KICAgICAgICAgICAgICAgIHRyID0gdGhpcy5fYnRvYSh0cik7DQogICAgICAgICAgICAgICAgbGV0IG1hcCA9IDwlPXNjb3BlJT4uX190ck1hcC5maW5kKG8gPT4gby50cmFuc2Zvcm09PXRyKTsNCiAgICAgICAgICAgICAgICByZXR1cm4gKG1hcD9tYXAuaWQ6PCU9c2NvcGUlPi5fX3RyTWFwWzwlPXNjb3BlJT4uX190ck1hcC5wdXNoKHtpZDogdHJpZCwgdHJhbnNmb3JtOiB0cn0pLTFdLmlkKTsNCiAgICAgICAgICAgIH0pOnY7DQogICAgICAgICAgICANCiAgICAgICAgICAgIHJldCA9IHRoaXMuX19leHBvcnQocmV0LCB7DQogICAgICAgICAgICAgICAgX21hcDogb3B0aW9ucy5iTWFwLA0KICAgICAgICAgICAgICAgIEZ1bGw6IG9wdGlvbnMuYkZ1bGwsDQogICAgICAgICAgICAgICAgTnVsbDogb3B0aW9ucy5iTnVsbCwNCiAgICAgICAgICAgICAgICBleHBvcnRlcjogdiA9PiB7DQogICAgICAgICAgICAgICAgICAgIGlmKHR5cGVvZihvcHRpb25zLnJldXNlZCk9PT0ndW5kZWZpbmVkJyB8fCBvcHRpb25zLnJldXNlZD49di5yZXVzZWQpIHJldHVybjsNCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIGlmKHYgJiYgdi5vYmogJiYgdHlwZW9mKHYub2JqLl9yZXR1cm4pPT09J3N0cmluZycgJiYgdi5vYmouX3JldHVybi5pbmRleE9mKCdfX3JldXNlZDogMScpPjApIHJldHVybjsNCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIGxldCBvSGFzaCA9IG9wdGlvbnMuYkhhc2g/W3RoaXMuX3RvSGFzaChudWxsLCB7bm9Db2RlOiB0cnVlLCBvbmx5VW5pcXVlOiB0cnVlLCBub0FyZ3M6IHRydWUsIF9tYXA6IG9wdGlvbnMuYk1hcCwgbm9UeXBlczogZmFsc2V9LCAiPCU9bU5hbWUlPiIpXTpPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihrID0+IGs9PSdJZCcgfHwgay5pbmRleE9mKCdfXycpPT0wKS5tYXAoayA9PiB7dHJ5e3JldHVybiB7IFtrXTogSlNPTi5wYXJzZShyZXRba10pIH07IH1jYXRjaChleCl7cmV0dXJuIHtba106IHJldFtrXX07IH0gfSk7DQogICAgICAgICAgICAgICAgICAgIGxldCBlUmV0ID0gT2JqZWN0LmFzc2lnbiguLi5vSGFzaCwge19fcmV1c2VkOiB2LnJldXNlZH0gKTsNCiAgICAgICAgICAgICAgICAgICAgaWYoQXJyYXkuaXNBcnJheShlUmV0Ll9fa2V5cykpIGVSZXQuX19rZXlzLmZvckVhY2goZWsgPT4ge3RyeXsgZVJldFtla10gPSBKU09OLnBhcnNlKHJldFtla10pO31jYXRjaChleCl7ZVJldFtla10gPSByZXRbZWtdOyB9IH0pOw0KDQogICAgICAgICAgICAgICAgICAgIHYub2JqID0ge19yZXR1cm46IEpTT04uc3RyaW5naWZ5KGVSZXQpfTsNCiAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgIF9USElTOiAob2JqLCBlYUNvZGUsIHYpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgaWYob3B0aW9ucy5iTWFwKSByZXR1cm47DQogICAgICAgICAgICAgICAgICAgIG9iai5USElTID0gdGhpcy5fVEhJUy5tYXAodCA9PiB0LjwlPW1OYW1lJT4ob3B0aW9ucywgYCR7c1BhdGh9LiR7ZWFDb2RlfWApKTsNCiAgICAgICAgICAgICAgICAgICAgb2JqLk9QRVJBVE9SUyA9IG9iai5PUEVSQVRPUlMgfHwge307DQogICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICBJZDogKG9iaiwgaWRDb2RlLCB2KSA9PiBvYmpbaWRDb2RlXSA9IGAiJHt2fSJgLA0KICAgIDwlIGMuRW50aXR5QXR0cmlidXRlcy5maWx0ZXIoZWEgPT4gIWVhLkVudGl0eU1ldGhvZCkuZm9yRWFjaChlYSA9PiB7ICU+DQogICAgICAgICAgICAgICAgPCU9bk5hbWUoZWEpJT46IChvYmosIGVhQ29kZSwgdikgPT4gew0KICAgICAgICA8JSBpZihlYS5Jc1VuaXF1ZSl7JT4NCiAgICAgICAgICAgICAgICAgICAgaWYob2JqLl9fa2V5cykgb2JqLl9fa2V5cy5wdXNoKGVhQ29kZSk7DQogICAgICAgIDwlIH0lPg0KICAgICAgICANCiAgICAgICAgPCUgaWYoZWEuSXNUZXh0KXslPg0KICAgICAgICAgICAgICAgICAgICBpZighPCU9X2I2NHRlc3QoJ3YnKSU+KXsgLy8gaXMgbm90IGJhc2U2ND8NCiAgICAgICAgICAgICAgICAgICAgICAgIHYgPSB0aGlzLl9idG9hKHYpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgIDwlIH1lbHNlIGlmKGVhLklzRGF0ZSl7JT4NCiAgICAgICAgICAgICAgICAgICAgdiA9IHYmJnYudG9JU09TdHJpbmc/di50b0lTT1N0cmluZygpOnY7DQogICAgICAgIDwlIH0lPg0KICAgICAgICANCiAgICAgICAgPCUgaWYoZWEuRW50aXR5VHlwZSl7JT4NCiAgICAgICAgICAgICAgICAgICAgb2JqW2VhQ29kZV0gPSB2P3YuPCU9bU5hbWUlPihvcHRpb25zLCBgJHtzUGF0aH0uJHtlYUNvZGV9YCk6J251bGwnOw0KICAgICAgICA8JSB9ZWxzZSBpZihlYS5Jc0Jvb2wgfHwgZWEuSXNJbnQgfHwgZWEuSXNMb25nIHx8IGVhLklzRmxvYXQgfHwgZWEuSXNEb3VibGUpeyU+DQogICAgICAgICAgICAgICAgICAgIG9ialtlYUNvZGVdID0gdHJNYXAob2JqLCBlYUNvZGUsIHYsIHNQYXRoKTsNCiAgICAgICAgPCUgfWVsc2V7JT4NCiAgICAgICAgICAgICAgICAgICAgb2JqW2VhQ29kZV0gPSAnIicgKyB0ck1hcChvYmosIGVhQ29kZSwgdiwgc1BhdGgpICsgJyInOw0KICAgICAgICA8JSB9JT4NCiAgICAgICAgICAgICAgICB9LA0KICAgIDwlIH0pJT4NCiAgICA8JSBjLlR5cGVkQXR0cmlidXRlcy5maWx0ZXIodGEgPT4gIXRhLkVudGl0eU1ldGhvZCkuZm9yRWFjaCh0YSA9PiB7bGV0IHRhTmFtZSA9IG5OYW1lKHRhKSArICdfJyArIHRhLkVudGl0eUNsYXNzLlBsdXJhbC5yZXBsYWNlKC8gL2csICdfJyk7JT4NCiAgICAgICAgICAgICAgICA8JT10YU5hbWUlPjogKG9iaiwgZWFDb2RlLCB2KSA9PiBvYmpbZWFDb2RlXSA9ICdbJyArICh2IHx8IFtdKS5tYXAoKF92LCBfaSkgPT4gX3YuPCU9bU5hbWUlPihvcHRpb25zLCBgJHtzUGF0aH0uJHtlYUNvZGV9WyR7X2l9XWApKS5maWx0ZXIoX3YgPT4gX3YpLmpvaW4oKSArICddJywNCiAgICA8JSB9KSU+DQogICAgPCUgYy5FbnRpdHlGaWVsZHMuZm9yRWFjaChlZiA9PiB7JT4NCiAgICAgICAgICAgICAgICBlZl88JT1uTmFtZShlZiklPjogKG9iaiwgZWZDb2RlLCB2KSA9PiB7DQogICAgICAgICAgICAgICAgICAgIGlmKEFycmF5LmlzQXJyYXkodikpew0KICAgICAgICAgICAgICAgICAgICAgICAgb2JqW2VmQ29kZV0gPSBKU09OLnN0cmluZ2lmeSh2KTsNCiAgICAgICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgICAgICB2ID0gdHJNYXAob2JqLCBlZkNvZGUsIHYsIHNQYXRoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmKHR5cGVvZih2KT09PSd1bmRlZmluZWQnKSByZXR1cm47DQogICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgPCUgaWYoZWYpeyU+DQogICAgICAgICAgICAgICAgICAgICAgICBpZighPCU9X2I2NHRlc3QoJ3YnKSU+KXsgLy8gaXMgbm90IGJhc2U2ND8NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2ID0gdGhpcy5fYnRvYSh2KTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgPCUgfWVsc2UgaWYoZWYuSXNEYXRlKXslPg0KICAgICAgICAgICAgICAgICAgICAgICAgdiA9IHYmJnYudG9JU09TdHJpbmc/di50b0lTT1N0cmluZygpOnY7DQogICAgICAgIDwlIH0lPg0KDQogICAgICAgICAgICAgICAgICAgICAgICBvYmpbZWZDb2RlXSA9IHY7DQogICAgICAgIDwlIGlmKCFlZi5Jc0Jvb2wgJiYgIWVmLklzSW50ICYmICFlZi5Jc0xvbmcgJiYgIWVmLklzRmxvYXQgJiYgIWVmLklzRG91YmxlKXslPg0KICAgICAgICAgICAgICAgICAgICAgICAgb2JqW2VmQ29kZV0gPSAnIicgKyBvYmpbZWZDb2RlXSArICciJzsNCiAgICAgICAgPCUgfSU+DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9LA0KICAgIDwlIH0pJT4NCg0KICAgICAgICAgICAgICAgIF9fdHJNYXA6IG9iaiA9PiB7DQogICAgICAgICAgICAgICAgICAgIGlmKCFzUGF0aCl7DQogICAgICAgICAgICAgICAgICAgICAgICBvYmouX190ck1hcCA9IDwlPXNjb3BlJT4uX190ck1hcCB8fCBbXTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSA8JT1zY29wZSU+Ll9fdHJNYXA7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9LA0KDQogICAgICAgICAgICAgICAgX3JldHVybjogb2JqID0+IHsNCiAgICAgICAgICAgICAgICAgICAgaWYob2JqKSBvYmouX3JldHVybiA9IChPYmplY3Qua2V5cyhvYmp8fHt9KS5sZW5ndGgpPygneycgKyBPYmplY3Qua2V5cyhvYmopLmZpbHRlcihrID0+IHR5cGVvZihvYmpba10pPT09InN0cmluZyIpLm1hcChrID0+IGAiJHtrfSI6ICR7b2JqW2tdfWApLmNvbmNhdChPYmplY3Qua2V5cyhvYmopLmZpbHRlcihrID0+IHR5cGVvZihvYmpba10pIT09InN0cmluZyIpLm1hcChrID0+IGAiJHtrfSI6ICR7SlNPTi5zdHJpbmdpZnkob2JqW2tdKX1gKSkuam9pbigpICsgJ30nKTonbnVsbCc7DQogICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIH0sICI8JT1tTmFtZSU+Iiwgb3B0aW9ucywgc1BhdGgpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICByZXQgPSByZXQ/cmV0Ll9yZXR1cm46cmV0Ow0KICAgICAgICAgICAgcmV0ID0gdHlwZW9mKHJldCk9PT0ndW5kZWZpbmVkJz9udWxsOnJldDsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgaWYoIXNQYXRoICYmIHJldCl7DQogICAgICAgICAgICAgICAgcmV0ID0gdGhpcy5fYmVhdXRpZnkocmV0LCAnamF2YXNjcmlwdCcpOw0KICAgICAgICAgICAgICAgIDwlPWxvZygpJT5yZXQpOw0KICAgICAgICAgICAgICAgIGlmKG9wdGlvbnMucGFyc2UpIHJldHVybiBKU09OLnBhcnNlKHJldCk7DQogICAgICAgICAgICAgICAgaWYob3B0aW9ucy5nemlwKSByZXR1cm4gdGhpcy5VdGY4QXJyYXlUb1N0cih0aGlzLl9jb21wcmVzcyhyZXQpKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgcmV0dXJuIHJldDsNCiAgICAgICAgfWNhdGNoKGV4KXsNCiAgICAgICAgICAgIDwlPWVycm9yKCklPmV4KTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIGFzeW5jIDwlPW1OYW1lPSdfdG9Eb2N1bWVudCclPihvcHRpb25zPXt9KXsNCiAgICAgICAgdHJ5ew0KICAgICAgICAgICAgbGV0IGpzb24gPSB0aGlzLl90b0pTT04ob3B0aW9ucyk7DQogICAgICAgICAgICBsZXQgb0pTT04gPSBKU09OLnBhcnNlKGpzb24pOw0KICAgICAgICAgICAgbGV0IHRyTWFwID0gb0pTT04uX190ck1hcCB8fCBbXTsNCiAgICAgICAgICAgIGRlbGV0ZSBvSlNPTi5fX3RyTWFwOw0KICAgICAgICAgICAganNvbiA9IEpTT04uc3RyaW5naWZ5KG9KU09OKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgbGV0IGxvZyA9ICguLi5zKSA9PiA8JT1sb2coKSU+Li4ucyk7DQogICAgICAgICAgICBsZXQgd2FybiA9ICguLi5zKSA9PiA8JT13YXJuKCklPi4uLnMpOw0KICAgICAgICAgICAgbGV0IGVycm9yID0gKC4uLnMpID0+IDwlPWVycm9yKCklPi4uLnMpOw0KDQogICAgICAgICAgICBmb3IgYXdhaXQgKGNvbnN0IHQgb2YgdHJNYXApew0KICAgICAgICAgICAgICAgIGlmKCFuZXcgUmVnRXhwKHQuaWQpLnRlc3QoanNvbikpIGNvbnRpbnVlOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIGxldCB0cm4gPSB0aGlzLl9hdG9iKHQudHJhbnNmb3JtKTsNCiAgICAgICAgICAgICAgICB0cnl7DQogICAgICAgICAgICAgICAgICAgIG9KU09OID0gSlNPTi5wYXJzZShqc29uKTsNCiAgICAgICAgICAgICAgICAgICAgbGV0IHJlcyA9IHVuZGVmaW5lZDsNCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIGlmKHRybi5zdGFydHNXaXRoKCJzKCIpICYmIHRybi5lbmRzV2l0aCgiKSIpKXsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJlcyA9IHRoaXMucnVuU2NyaXB0KGAob0pTT04sIG9TY29wZSwgbG9nLCB3YXJuLCBlcnJvcikgPT4gJHt0cm4uc3Vic3RyaW5nKDIsIHRybi5sZW5ndGgtMSl9YCkob0pTT04sIDwlPXNjb3BlJT4sIGxvZywgd2FybiwgZXJyb3IpOw0KICAgICAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vcmVzID0gYXdhaXQganNvbmF0YSh0cm4pLmV2YWx1YXRlKG9KU09OKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgLy88JT13YXJuKCklPnQuaWQsIHJlcywgdHJuKTsNCiAgICAgICAgICAgICAgICAgICAganNvbiA9IGpzb24ucmVwbGFjZShuZXcgUmVnRXhwKHQuaWQsICJnIiksICghQXJyYXkuaXNBcnJheShyZXMpICYmIHR5cGVvZihyZXMpIT09J29iamVjdCcpP3Jlczp0aGlzLl9idG9hKEpTT04uc3RyaW5naWZ5KHJlcykpKTsNCiAgICAgICAgICAgICAgICB9Y2F0Y2goZXgpew0KICAgICAgICAgICAgICAgICAgICA8JT13YXJuKCklPnQuaWQsIHRybiwgZXgpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgLy8ganNvbiA9IGpzb24ucmVwbGFjZSgvIl9fdHJNYXAiOlxzXFtce1tePj5dK1x9XF0vZ20sICciX190ck1hcCI6ICIiJyk7DQoNCiAgICAgICAgICAgIHJldHVybiBvcHRpb25zLmJKU09OP3RoaXMuX2JlYXV0aWZ5KGpzb24sICdqYXZhc2NyaXB0Jyk6SlNPTi5wYXJzZShqc29uKTsNCiAgICAgICAgfWNhdGNoKGV4KXsNCiAgICAgICAgICAgIDwlPWVycm9yKCklPmV4KTsNCiAgICAgICAgfQ0KICAgIH0NCg0KPCUNCl9jbG9uZUZ1bmN0aW9uID0gKG8sIGYsIHNjb3BlLCBjKSA9PiB7DQoNCiAgICBsZXQgb2JqID0gbnVsbDsNCiAgICBpZihvPT0nc3InICYmIHR5cGVvZihzcikhPT0ndW5kZWZpbmVkJykgb2JqID0gc3I7DQogICAgaWYobz09J19GckVNRCcgJiYgdHlwZW9mKF9GckVNRCkhPT0ndW5kZWZpbmVkJykgb2JqID0gX0ZyRU1EOw0KICAgIA0KICAgIGxldCBjb2RlID0gb2JqW2ZdID8gb2JqW2ZdLnRvU3RyaW5nKCkgOiBgICAgJHtmfSgpew0KICAgICAgICBjb25zb2xlLmxvZygnRXJyb3IgaW4gX2Nsb25lRnVuY3Rpb24oJHtvfSwgJHtmfSk6IEludmFsaWQgRnVuY3Rpb24gTmFtZScpOw0KICAgIH1gOw0KICAgIGxldCBzID0gY29kZS5yZXBsYWNlKCcpJywgJykgPT4gJyk7DQogICAgaWYgKHMuaW5kZXhPZignZnVuY3Rpb24nKSA9PSAwIHx8IHMuaW5kZXhPZignYXN5bmMgZnVuY3Rpb24nKSA9PSAwKSB7DQogICAgCXMgPSBzLnJlcGxhY2UoJ2Z1bmN0aW9uJywgJyAnKTsNCiAgICB9IGVsc2Ugew0KICAgIAlzID0gcy5yZXBsYWNlKGYsICcnKTsNCiAgICB9DQoNCiAgICBpZiAoYy5Jc01haW4gJiYgIW9ialtmXSkgew0KICAgIAljb25zb2xlLmxvZygnRXJyb3IgaW4gX2Nsb25lRnVuY3Rpb24oKTogSW52YWxpZCBGdW5jdGlvbiBOYW1lICcgKyBmKTsNCiAgICB9DQoNCiAgICByZXR1cm4gYA0KICAgICR7Zn0oLi4ucGFyYW1zKXsNCiAgICAgICAgaWYodHlwZW9mKHdpbmRvdykhPT0idW5kZWZpbmVkIiAmJiB0eXBlb2Yod2luZG93LiR7b30pIT09InVuZGVmaW5lZCIpew0KICAgICAgICAgICAgcmV0dXJuIHdpbmRvdy4ke299LiR7Zn0oLi4ucGFyYW1zKTsNCiAgICAgICAgfWVsc2V7DQogICAgICAgICAgICBgICsgKGMuSXNNYWluID8gYHJldHVybiAoJHtzfSkoLi4ucGFyYW1zKTtgIDogYHJldHVybiBuZXcgJHtzY29wZX0uJHtuTmFtZShtYWluQ2xhc3MoKSl9KCkuJHtmfSguLi5wYXJhbXMpO2ApICsgYA0KICAgICAgICB9DQoJfQ0KICAgIGA7DQp9Ow0KDQoNClt7DQogICAgd09iajogJ3NyJywNCiAgICBmdW5jdGlvbnM6IFsnaGFzaENvZGUnLCAnRXF1YWxzJywgJ3NlcnZlckRhdGUnLCAnX19zY29wZScsICdhZGRNU2Vjb25kcycsICdpcEFkZHJlc3MnXS5jb25jYXQobWFpbkNsYXNzKFsnQklTZXJ2ZXInXSk/WydfJywgJ2J1aWxkVVJMJywgJyRfUkVRVUVTVCcsICdwYXJhbScsICdfdG9YTUwnLCAnY29vcCcsICdPUicsICdteVJlcGxhY2UnLCAnc2VuZFhNTCcsICdwcm9jZXNzUmVzcG9uc2UnLCAncHJvY2Vzc1Jlc3VsdCcsICdydW5TUlNjcmlwdCcsICdncm91cEJ5JywgJ1Nob3dEZWJ1ZycsICdjYWNoZVJlc3VsdCcsICd0b0hleCcsICdTaG93RXJyb3InXTpbXSksDQp9LCB7DQogICAgd09iajogJ19GckVNRCcsDQogICAgZnVuY3Rpb25zOiBbJ19hdHRyJywgJ3J1blNjcmlwdCcsICdfdW5pcXVlJywgJ3NyJywgJ19hdG9iJywgJ19nZXRTdG9yZWRTY3JpcHQnLCAnX2J0b2EnLCAnX190aW1lJywgJ193YWl0JywgJ19zcWxUeXBlJywgJ191dWlkJywgJ3JlcXVpcmUnLCAnX2luY2x1ZGUnLCAnX2JlYXV0aWZ5JywgJ19pbmplY3QnLCAnX2NvbXByZXNzJywgJ19kZWNvbXByZXNzJywgJ1V0ZjhBcnJheVRvU3RyJywgJ3JhbmRVUkwnXSwNCn1dLmZvckVhY2goY2MgPT4geyAlPg0KLyogU1RBUlQ6IDwlPWNjLndPYmolPiBmdW5jdGlvbiBjb3BpZXMgKi8NCjwlIGNjLmZ1bmN0aW9ucy5mb3JFYWNoKGYgPT4geyU+DQoNCi8qIENMT05FOjpTVEFSVDogPCU9Y2Mud09iaiU+LjwlPWYlPigpICovPCU9X2Nsb25lRnVuY3Rpb24oY2Mud09iaiwgZiwgc2NvcGUsIGMpICU+LyogQ0xPTkU6OkVORCAgOiA8JT1jYy53T2JqJT4uPCU9ZiU+KCkgKi8NCjwlIH0pJT4NCi8qIEVORDogPCU9Y2Mud09iaiU+IGZ1bmN0aW9uIGNvcGllcyAqLw0KPCUgfSk7ICU+DQogICAgDQogICAgPCU9bU5hbWU9J2kxOG4nJT4oZXYsIHYpew0KICAgICAgICBpZih0eXBlb2Yod2luZG93KT09PSJ1bmRlZmluZWQiIHx8IHR5cGVvZih3aW5kb3cuaTE4bl9zdG9yZSk9PT0idW5kZWZpbmVkIikgcmV0dXJuIHY7DQogICAgICAgIA0KICAgICAgICBpZighZXYuRW50aXR5QXR0cmlidXRlLklzVGV4dCAmJiAhZXYuRW50aXR5QXR0cmlidXRlLklzU3RyaW5nKXsNCiAgICAgICAgICAgIHJldHVybiB2Ow0KICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgIHJldHVybiB3aW5kb3cuaTE4bl9zdG9yZVt0aGlzLmhhc2hDb2RlKHYpXSA9IHdpbmRvdy5pMThuX3N0b3JlW3RoaXMuaGFzaENvZGUodildIHx8IHY7DQogICAgICAgIH0NCiAgICB9DQoNCjwlIGMuRW50aXR5QXR0cmlidXRlcy5maWx0ZXIoZWEgPT4gIWVhLkVudGl0eU1ldGhvZCAmJiBlYS5FbnRpdHlUeXBlKS5mb3JFYWNoKGVhID0+IHslPg0KICAgIDwlPW1OYW1lPSdieScgKyBuTmFtZShlYS5FbnRpdHlUeXBlKSU+KGFyKSB7DQogICAgICAgIHZhciByZXQgPSBbXTsNCiAgICAgICAgYXIuZm9yRWFjaChhID0+IHsNCiAgICAgICAgICAgIHJldC5mb3JFYWNoKHIgPT4gew0KICAgICAgICAgICAgICAgIGlmIChhWyJfPCU9bk5hbWUoZWEpJT4iXSAmJiAoYVsiXzwlPW5OYW1lKGVhKSU+Il0uRXF1YWxzP2FbIl88JT1uTmFtZShlYSklPiJdLkVxdWFscyhyKTpzci5FcXVhbHMoYVsiXzwlPW5OYW1lKGVhKSU+Il0sIHIpKSkgew0KICAgICAgICAgICAgICAgICAgICByLl88JT1uTmFtZShlYSklPl88JT1jLlBsdXJhbC5yZXBsYWNlKC8gL2csICdfJyklPi5wdXNoKGEpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9KTsNCiAgICAgICAgcmV0dXJuIHJldDsNCiAgICB9DQo8JSB9KSU+DQoNCiAgICA8JT1tTmFtZT0nZ2V0IF9Ub1N0cmluZyclPigpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMudG9TdHJpbmcoKTsNCiAgICB9DQogICAgDQogICAgPCU9bU5hbWU9J3RvU3RyaW5nJyU+KCkgew0KICAgICAgICBsZXQgcmV0ID0gW107DQo8JSBjLkVudGl0eUF0dHJpYnV0ZXMuZmlsdGVyKGVhID0+ICFlYS5FbnRpdHlNZXRob2QgJiYgZWEuSXNVbmlxdWUpLmZvckVhY2goZWEgPT4geyU+DQogICAgICAgIGlmKHRoaXMuXzwlPW5OYW1lKGVhKSU+X3NldCAmJiA8JXZhbHVlT2YoZWEuSXNVbmlxdWUpJT4pIHJldC5wdXNoKHRoaXMuPCU9bk5hbWUoZWEpJT4oKTwlaWYoZWEuRW50aXR5VHlwZSl7JT4uPCU9bU5hbWUlPigpPCV9JT4pOw0KPCUgfSklPg0KICAgICAgICByZXR1cm4gcmV0LmpvaW4oJy0nKTsNCiAgICB9DQoNCiAgICA8JT1tTmFtZT0nRW50aXR5VmFsdWUnJT4oYU5hbWUpIHsNCiAgICAgICAgbGV0IHJldCA9IFtdLmNvbmNhdCh0aGlzLkVudGl0eVZhbHVlcywgdGhpcy5WYWx1ZUVudGl0aWVzKS5maW5kKGV2ID0+IGV2LkVudGl0eUF0dHJpYnV0ZSAmJiBldi5FbnRpdHlBdHRyaWJ1dGUuTmFtZSA9PSBhTmFtZSk7DQogICAgICAgIA0KICAgICAgICBpZighcmV0KXsNCiAgICAgICAgICAgIC8vIGFuIGF0dHJpYnV0ZSB0aGF0IGhhcyB5ZXQgbm8ga25vd24gZW50aXR5IHZhbHVlDQogICAgICAgICAgICByZXQgPSB7QWN0aXZlOiB0cnVlLCBPUEVSQVRPUlM6IHt9LCBFbnRpdHlBdHRyaWJ1dGU6IHtOYW1lOiBhTmFtZSwgQWN0aXZlOiB0cnVlLCBFbnRpdHlDbGFzczoge0lkOiB0aGlzLkVudGl0eUNsYXNzLklkfX19Ow0KICAgICAgICAgICAgdGhpcy5FbnRpdHlWYWx1ZXMucHVzaChyZXQpOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICByZXR1cm4gcmV0Ow0KICAgIH0NCg0KICAgIGFzeW5jIDwlPW1OYW1lPSdmaW5kJyU+KGRlcHRoID0gMSwgb2JqcywgZmllbGRzKSB7DQogICAgICAgIHJldHVybiAoYXdhaXQgdGhpcy5maW5kQWxsKGRlcHRoLCBvYmpzLCBudWxsLCBudWxsLCBmaWVsZHMpKVswXTsNCiAgICB9DQoNCiAgICA8JT1tTmFtZT0nX19hc3NlcnRWYWxpZCclPihiU3luYyl7DQo8JSBpZighYy5Ub29scy5sZW5ndGgpeyU+DQogICAgICAgIHJldHVybiB0cnVlOw0KPCUgfWVsc2V7JT4NCiAgICAgICAgbGV0IGVycm9yID0ge307DQoNCiAgICA8JSBjLkVudGl0eUF0dHJpYnV0ZXMuZmlsdGVyKGVhID0+ICFlYS5FbnRpdHlNZXRob2QgJiYgZWEuUmVxdWlyZWQpLmZvckVhY2goZWEgPT4geyU+DQogICAgICAgIGlmKDwldmFsdWVPZihlYS5SZXF1aXJlZCklPil7DQogICAgICAgICAgICBlcnJvci48JT1uTmFtZShlYSklPiA9IHt9Ow0KICAgICAgICAgICAgaWYoIXRoaXMuXzwlPW5OYW1lKGVhKSU+X3NldCkgZXJyb3IuPCU9bk5hbWUoZWEpJT5bIjAxIl0gPSAiTm90IFNldCI7DQogICAgICAgIDwlIGlmKGVhLkVudGl0eVR5cGUpeyU+DQogICAgICAgICAgICBpZighdGhpcy48JT1uTmFtZShlYSklPigpKSBlcnJvci48JT1uTmFtZShlYSklPlsiMDIiXSA9ICJFbXB0eSBWYWx1ZSI7DQogICAgICAgICAgICBpZih0aGlzLjwlPW5OYW1lKGVhKSU+KCkgJiYgYlN5bmMgJiYgIXRoaXMuPCU9bk5hbWUoZWEpJT4oKS5fX3N5bmNfb24oKSkgZXJyb3IuPCU9bk5hbWUoZWEpJT5bIjAzIl0gPSAiTm90IGluIFN5bmMiOw0KICAgICAgICA8JSB9JT4NCiAgICAgICAgICAgIGlmKCFPYmplY3Qua2V5cyhlcnJvci48JT1uTmFtZShlYSklPikubGVuZ3RoKSBkZWxldGUgZXJyb3IuPCU9bk5hbWUoZWEpJT47DQogICAgICAgIH0NCiAgICA8JSB9KSU+DQoNCiAgICAgICAgaWYoT2JqZWN0LmtleXMoZXJyb3IpLmxlbmd0aCl7DQogICAgICAgICAgICB0aGlzLl9fYXNzZXJ0RXJyb3IgPSBlcnJvcjsNCiAgICAgICAgICAgIDwlPWVycm9yKCklPkpTT04uc3RyaW5naWZ5KGVycm9yLG51bGwsNCksIHRoaXMuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH1lbHNlew0KICAgICAgICAgICAgZGVsZXRlIHRoaXMuX19hc3NlcnRFcnJvcjsNCiAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICB9DQo8JSB9JT4NCiAgICB9DQoNCiAgICA8JT1tTmFtZT0nX3JhbmsnJT4oXzwlPW1OYW1lJT49MCl7DQoJCXRyeSB7DQogICAgICAgICAgICByZXR1cm4gdGhpcy5fX2V4cG9ydCh7XzwlPW1OYW1lJT46IF88JT1tTmFtZSU+fSwgew0KICAgICAgICAgICAgICAgIE51bGw6IHRydWUsDQogICAgICAgICAgICAgICAgZXhwb3J0ZXI6IHYgPT4gdi5yZXVzZWQ/di5vYmouX19yZXVzZWQgPSB2LnJldXNlZDowLA0KICAgICAgICAgICAgICAgIElkOiAob2JqLCBpZENvZGUsIHYpID0+IG9ialtpZENvZGVdID0gIjwlPV9jTmFtZShjLCB0cnVlKSU+IiwNCgk8JSBjLkVudGl0eUF0dHJpYnV0ZXMuZmlsdGVyKGVhID0+ICFlYS5FbnRpdHlNZXRob2QgJiYgZWEuRW50aXR5VHlwZSkuZm9yRWFjaChlYSA9PiB7JT4NCiAgICAgICAgICAgICAgICA8JT1uTmFtZShlYSklPjogKG9iaiwgZWFDb2RlLCB2KSA9PiBvYmouXzwlPW1OYW1lJT4gKz0gKG9ialtlYUNvZGVdID0gKHYgfHwgbmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKGVhLkVudGl0eVR5cGUsIHRydWUpJT4oKSkuPCU9bU5hbWUlPihfPCU9bU5hbWUlPisxKSkuXzwlPW1OYW1lJT4sDQoJPCUgfSklPg0KICAgIDwlIGMuVHlwZWRBdHRyaWJ1dGVzLmZpbHRlcih0YSA9PiAhdGEuRW50aXR5TWV0aG9kKS5mb3JFYWNoKHRhID0+IHtsZXQgdGFOYW1lID0gbk5hbWUodGEpICsgJ18nICsgdGEuRW50aXR5Q2xhc3MuUGx1cmFsLnJlcGxhY2UoLyAvZywgJ18nKTslPg0KICAgICAgICAgICAgICAgIDwlPXRhTmFtZSU+OiAob2JqLCB0YUNvZGUsIHYpID0+IChvYmpbdGFDb2RlXSA9IFtuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUodGEuRW50aXR5VHlwZSwgdHJ1ZSklPigpXS5tYXAoX3YgPT4gX3YuPCU9bU5hbWUlPihfPCU9bU5hbWUlPisxKSkpLmZvckVhY2godiA9PiB2Ll88JT1tTmFtZSU+KSwNCiAgICA8JSB9KSU+DQoJICAgICAgICB9LCAiPCU9bU5hbWUlPiIpOw0KCQl9IGNhdGNoIChleCkgew0KCQkJPCU9ZXJyb3IoKSU+ZXgpOw0KCQl9DQoJfQ0KDQogICAgPCU9bU5hbWU9J19pc1F1ZXJ5JyU+KCl7DQogICAgICAgIGxldCByZXQgPSB0aGlzLl9fZXhwb3J0KC8qX190eXBlKi97SWQ6ICI8JT1uTmFtZShjKSU+IiwgPCU9bU5hbWUlPkNvdW50OiAwfSwgew0KICAgICAgICAgICAgTnVsbDogdHJ1ZSwNCiAgICA8JSBjLkVudGl0eUF0dHJpYnV0ZXMuZmlsdGVyKGVhID0+ICFlYS5FbnRpdHlNZXRob2QpLmZvckVhY2goZWEgPT4geyAlPg0KICAgICAgICAgICAgPCU9bk5hbWUoZWEpJT46IChvYmosIGVhQ29kZSwgdikgPT4gew0KICAgICAgICAgICAgICAgIG9ialtlYUNvZGVdID0ge19jb29wOiB0aGlzLl88JT1uTmFtZShlYSklPl9jb29wIHx8IHVuZGVmaW5lZH07DQogICAgICAgICAgICAgICAgb2JqLjwlPW1OYW1lJT5Db3VudCArPSB0eXBlb2Yob2JqW2VhQ29kZV0uX2Nvb3ApPT09InVuZGVmaW5lZCI/MDoxOw0KICAgICAgICAgICAgICAgIGlmKHYgJiYgdi48JT1tTmFtZSU+KXsNCiAgICAgICAgICAgICAgICAgICAgb2JqW2VhQ29kZV0uX29iamVjdCA9IHYuPCU9bU5hbWUlPigpOw0KICAgICAgICAgICAgICAgICAgICBvYmouPCU9bU5hbWUlPkNvdW50ICs9IG9ialtlYUNvZGVdLl9vYmplY3QuPCU9bU5hbWUlPkNvdW50Ow0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0sDQogICAgPCUgfSk7ICU+DQogICAgPCUgYy5UeXBlZEF0dHJpYnV0ZXMuZmlsdGVyKHRhID0+ICF0YS5FbnRpdHlNZXRob2QpLmZvckVhY2godGEgPT4ge2xldCB0YU5hbWUgPSBuTmFtZSh0YSkgKyAnXycgKyB0YS5FbnRpdHlDbGFzcy5QbHVyYWwucmVwbGFjZSgvIC9nLCAnXycpOyU+DQogICAgICAgICAgICA8JT10YU5hbWUlPjogKG9iaiwgdGFDb2RlLCB2KSA9PiB7DQogICAgICAgICAgICAgICAgb2JqW3RhQ29kZV0gPSB7X2Nvb3A6IHRoaXMuXzwlPXRhTmFtZSU+X2Nvb3AgfHwgdW5kZWZpbmVkLCBfb2JqZWN0czogKHZ8fFtdKS5tYXAoX3YgPT4gX3YuPCU9bU5hbWUlPigpKX07DQogICAgICAgICAgICAgICAgaWYob2JqW3RhQ29kZV0uX29iamVjdHMubGVuZ3RoKSBvYmpbdGFDb2RlXS48JT1tTmFtZSU+Q291bnQgKz0gb2JqW3RhQ29kZV0uX29iamVjdHMucmVkdWNlKCh2LCBvKSA9PiB2ICs9IG8uPCU9bU5hbWUlPkNvdW50KTsNCiAgICAgICAgICAgIH0sDQogICAgPCUgfSklPg0KICAgICAgICB9LCAiPCU9bU5hbWUlPiIpOw0KICAgICAgICANCiAgICAgICAgcmV0dXJuIHJldDsNCiAgICB9DQogICAgDQogICAgPCU9bU5hbWU9J19uZXcnJT4oY2xOYW1lLCB0b29sKXsNCjwlIGlmKG1haW5DbGFzcygpIT1jKXslPg0KICAgICAgICByZXR1cm4gbmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKG1haW5DbGFzcygpLCB0cnVlKSU+KCkuPCU9bU5hbWUlPihjbE5hbWUsIHRvb2wpOw0KPCUgfWVsc2V7JT4NCiAgICAgICAgdHJ5ew0KICAgICAgICAgICAgc3dpdGNoKGNsTmFtZSl7DQogICAgPCUgYXJDbGFzc2VzLmZvckVhY2goX2MgPT4geyU+DQogICAgICAgICAgICAgICAgY2FzZSAiPCU9bk5hbWUoX2MpJT4iOg0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKF9jLCB0cnVlKSU+KHVuZGVmaW5lZCwgdG9vbCk7DQogICAgPCUgfSklPg0KICAgICAgICAgICAgfQ0KICAgICAgICB9Y2F0Y2goZXgpew0KICAgICAgICAgICAgPCU9ZXJyb3IoKSU+ZXgpOw0KICAgICAgICB9DQo8JSB9JT4NCiAgICB9DQogICAgDQogICAgYXN5bmMgPCU9bU5hbWU9J3N0b3JlJyU+KCkgew0KICAgICAgICBsZXQgcmVzdWx0cyA9IGF3YWl0IHRoaXMuX2V4ZWN1dGUobnVsbCwgPCU9YWxpYXMoKSU+LCAiPCU9bU5hbWUlPiIsIDwlbVJvdXRpbmcoYyklPiwgYXN5bmMgKCkgPT4gew0KICAgICAgICAgICAgLyoqKiBTVEFSVCBMT0NBTCA8JT1tTmFtZSU+KCkgKioqLw0KICAgICAgICAgICAgDQogICAgICAgIGxldCBiVXBkYXRlID0gZmFsc2U7DQogICAgICAgIGxldCBiSW5zZXJ0ID0gZmFsc2U7DQoNCiAgICAgICAgaWYodGhpcy5fX2NvbmZpZygnc3RvcmUuZGlzYWJsZWQnKSl7DQogICAgICAgICAgICA8JT13YXJuKCklPiJzdG9yaW5nIGRpc2FibGVkIik7DQogICAgICAgIH1lbHNlIGlmKHRoaXMuX2lzUXVlcnkoKS5faXNRdWVyeUNvdW50KXsNCiAgICAgICAgICAgIDwlPXdhcm4oKSU+IkNhbm5vdCBzdG9yZSBhIHF1ZXJ5ISIpOw0KICAgICAgICB9ZWxzZSBpZighdGhpcy5fX3N5bmNfb24oKSB8fCA8JT1fRnJFTUQuX3RvSlMoX2ZpbGVUb29scyklPi5pbmRleE9mKHRoaXMuVG9vbC50eXBlLm5hbWUpPj0wKXsNCiAgICAgICAgICAgIGxldCBfdGhpcyA9IG5ldyA8JT1zY29wZSU+LjwlPW5OYW1lKGMsIHRydWUpJT4oKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgbGV0IGJGaW5kID0gZmFsc2U7DQogICAgICAgICAgICBpZih0aGlzLklkPT10aGlzLklkKXsNCiAgICAgICAgICAgICAgICBiRmluZCA9IHRydWU7DQogICAgICAgICAgICAgICAgX3RoaXMuSWQgPSB0aGlzLklkOw0KICAgICAgICAgICAgfQ0KPCUgYy5FbnRpdHlBdHRyaWJ1dGVzLmZpbHRlcihlYSA9PiBlYS5Jc1VuaXF1ZSkuZm9yRWFjaChlYSA9PiB7JT4NCiAgICAgICAgICAgIGlmKDwldmFsdWVPZihlYS5Jc1VuaXF1ZSklPil7DQogICAgICAgICAgICAgICAgYkZpbmQgPSB0cnVlOw0KICAgICAgICAgICAgICAgIF90aGlzLjwlPW5OYW1lKGVhKSU+KHRoaXMuPCU9bk5hbWUoZWEpJT4oKSwgJz0nKTsNCiAgICAgICAgICAgIH0NCjwlIH0pOyAlPg0KDQogICAgICAgICAgICBpZihiRmluZCl7DQogICAgICAgICAgICAgICAgX3RoaXMgPSBhd2FpdCBfdGhpcy5maW5kKCk7DQogICAgICAgICAgICB9ZWxzZSBfdGhpcyA9IG51bGw7DQogICAgICAgICAgICBpZihfdGhpcyl7DQogICAgICAgICAgICAgICAgdGhpcy5JZCA9IF90aGlzLklkOw0KICAgICAgICAgICAgICAgIHRoaXMuX19zeW5jX29uKF90aGlzLl9fc3luY19vbigpKTsNCiAgICAgICAgICAgICAgICA8JT1sb2coKSU+Il90aGlzLklkIiwgX3RoaXMuSWQsIHRoaXMuSWQsIF90aGlzLlRvb2wubmFtZSwgdGhpcy5Ub29sLm5hbWUpOw0KICAgICAgICAgICAgICAgIGJVcGRhdGUgPSB0cnVlOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgdGhpcy5JZCA9IHRoaXMuSWQ7IC8vIHRvIGVuZm9yY2UgdGhlIElkIGFuZCBub3QgZ2V0IGEgbmV3IG9uZSBldmVyeSB0aW1lDQogICAgICAgICAgICAgICAgYkluc2VydCA9IHRydWU7DQogICAgICAgICAgICB9DQogICAgICAgIH1lbHNlIGlmKE1hdGguYWJzKCh0aGlzLlNldF9Pbi5nZXRUaW1lKCkgLSB0aGlzLl9fc3luY19vbigpLmdldFRpbWUoKSkgLyAxMDAwKSA8IHRoaXMuX19jb25maWcoJ3N0b3JlLnNlbnNpdGl2aXR5JywgNSkpew0KICAgICAgICAgICAgPCU9bG9nKCklPiJBbHJlYWR5IHN0b3JlZCIsIE1hdGguYWJzKCh0aGlzLlNldF9Pbi5nZXRUaW1lKCkgLSB0aGlzLl9fc3luY19vbigpLmdldFRpbWUoKSkgLyAxMDAwKSArIjwiK3RoaXMuX19jb25maWcoJ3N0b3JlLnNlbnNpdGl2aXR5JywgNSkpOw0KICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgIGJVcGRhdGUgPSB0cnVlOw0KICAgICAgICB9DQoNCiAgICAgICAgaWYoIWJVcGRhdGUgJiYgIWJJbnNlcnQpew0KICAgICAgICAgICAgPCU9bG9nKCklPiJObyBkYXRhIGNoYW5nZXMiKTsNCiAgICAgICAgfWVsc2V7DQo8JSBjbHNUb29scyhjKS5mb3JFYWNoKHQgPT4geyU+DQogICAgICAgICAgICBpZih0aGlzLlRvb2wudHlwZS5uYW1lPT0iPCU9dCU+Iil7DQogICAgPCUgaWYodD09IlNxbERCIil7ICU+DQogICAgICAgICAgICAgICAgaWYodHlwZW9mKDwlPXNjb3BlJT4uX19zcWxUcmFuc2FjdGlvbik9PT0idW5kZWZpbmVkIiB8fCA8JT1zY29wZSU+Ll9fc3FsVHJhbnNhY3Rpb24uZW5kKXsNCiAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5fc3FsKGAke3RoaXMuX19jb25maWcoJ3R5cGUnKT09J3NxbGl0ZSc/J0JFR0lOJzonU1RBUlQnfSBUUkFOU0FDVElPTmApOw0KICAgICAgICAgICAgICAgICAgICA8JT1zY29wZSU+Ll9fc3FsVHJhbnNhY3Rpb24gPSB7T3duZXI6IHRoaXMsIHNxbHM6IFtdLCBzdGFydDogbmV3IERhdGUoKSwgZW5kOiBudWxsfTsNCiAgICAgICAgICAgICAgICB9DQogICAgPCUgfSU+DQogICAgICAgICAgICB9DQo8JSB9KSU+DQoNCiAgICAgICAgICAgIHRoaXMuX2RlZmF1bHRzKCk7DQoNCiAgICAgICAgICAgIGlmKHRoaXMuX19jb25maWcoIlN5bmNFbnRpdHlBdHRyaWJ1dGVzIikpew0KPCUgYy5FbnRpdHlBdHRyaWJ1dGVzLmZpbHRlcihlYSA9PiAhZWEuRW50aXR5TWV0aG9kICYmIGVhLkVudGl0eVR5cGUpLmZvckVhY2goZWEgPT4geyU+DQogICAgICAgICAgICAgICAgaWYodGhpcy48JT1uTmFtZShlYSklPigpICYmICEoYXdhaXQgdGhpcy48JT1uTmFtZShlYSklPigpLjwlPW1OYW1lJT4oKSkpIHRoaXMuY2xlYXJfPCU9bk5hbWUoZWEpJT4oKTsNCjwlIH0pOyAlPg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZighdGhpcy5fX2Fzc2VydFZhbGlkKHRydWUpKSByZXR1cm4gbnVsbDsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgPCU9bG9nKCklPmA9PT0+IEluc2VydDoke2JJbnNlcnR9LCBVcGRhdGU6JHtiVXBkYXRlfSwgSWQ6WyR7dGhpcy5JZH1dYCk7DQogICAgICAgICAgICBpZihiVXBkYXRlKSBhd2FpdCB0aGlzLnVwZGF0ZSgpOw0KICAgICAgICAgICAgaWYoYkluc2VydCkgYXdhaXQgdGhpcy5pbnNlcnQoKTsNCiAgICAgICAgICAgIDwlPWxvZygpJT5gPD09PSBJbnNlcnQ6JHtiSW5zZXJ0fSwgVXBkYXRlOiR7YlVwZGF0ZX0sIElkOlske3RoaXMuSWR9XWApOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBpZih0aGlzLl9fY29uZmlnKCJTeW5jVHlwZWRBdHRyaWJ1dGVzIikpew0KPCUgYy5UeXBlZEF0dHJpYnV0ZXMuZm9yRWFjaCh0YSA9PiB7IGxldCB0YU5hbWUgPSBuTmFtZSh0YSkgKyAnXycgKyB0YS5FbnRpdHlDbGFzcy5QbHVyYWwucmVwbGFjZSgvIC9nLCAnXycpOyU+DQogICAgICAgICAgICAgICAgZm9yIGF3YWl0IChjb25zdCB0YSBvZiB0aGlzLjwlPXRhTmFtZSU+KCkpew0KICAgICAgICAgICAgICAgICAgICA8JT1sb2coKSU+IlN5bmNpbmcuLi48JT10YU5hbWUlPiIsIHRhKTsNCiAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGEuPCU9bU5hbWUlPigpOw0KICAgICAgICAgICAgICAgIH0NCjwlIH0pOyAlPg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZihiVXBkYXRlIHx8IGJJbnNlcnQpew0KPCUgY2xzVG9vbHMoYykuZm9yRWFjaCh0ID0+IHslPg0KICAgICAgICAgICAgICAgIGlmKHRoaXMuVG9vbC50eXBlLm5hbWU9PSI8JT10JT4iKXsNCiAgICA8JSBpZih0PT0iU3FsREIiKXsgJT4NCiAgICAgICAgICAgICAgICAgICAgaWYoPCU9c2NvcGUlPi5fX3NxbFRyYW5zYWN0aW9uICYmICE8JT1zY29wZSU+Ll9fc3FsVHJhbnNhY3Rpb24uZW5kICYmIDwlPXNjb3BlJT4uX19zcWxUcmFuc2FjdGlvbi5Pd25lcj09dGhpcyl7DQogICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLl9zcWwoYENPTU1JVCR7dGhpcy5fX2NvbmZpZygndHlwZScpPT0nc3FsaXRlJz8nIFRSQU5TQUNUSU9OJzonJ31gKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIDwlPXNjb3BlJT4uX19zcWxUcmFuc2FjdGlvbi5lbmQgPSBuZXcgRGF0ZSgpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgPCUgfSU+DQogICAgICAgICAgICAgICAgfQ0KPCUgfSklPg0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgIH0sIHtfX2JlZm9yZVJ1bGVzOiBbPCUoYy5FbnRpdHlSdWxlcyB8fCBbXSkuZmlsdGVyKHIgPT4gclttTmFtZV0gJiYgci5CZWZvcmUpLm1hcChyID0+IHslPjwlPV9GckVNRC5fdG9KUyhyKSU+PCUgfSkuam9pbignLCAnKSU+XSwgX19hZnRlclJ1bGVzOiBbPCUoYy5FbnRpdHlSdWxlcyB8fCBbXSkuZmlsdGVyKHIgPT4gclttTmFtZV0gJiYgci5BZnRlcikubWFwKHIgPT4geyU+PCU9X0ZyRU1ELl90b0pTKHIpJT48JSB9KS5qb2luKCcsICcpJT5dfSk7DQogICAgICAgIA0KICAgICAgICByZXR1cm4gKHJlc3VsdHMuZmluZChyID0+IHIucmV0KSB8fCB7cmV0OiBudWxsfSkucmV0OyAvLyBmaXJzdCBvbmUgdG8gZXhlY3V0ZSBjb3JyZWN0bHkNCiAgICB9DQoNCiAgICBhc3luYyA8JT1tTmFtZT0naW5zZXJ0JyU+KCl7DQogICAgICAgIGxldCByZXN1bHRzID0gYXdhaXQgdGhpcy5fZXhlY3V0ZShudWxsLCA8JT1hbGlhcygpJT4sICI8JT1tTmFtZSU+IiwgPCVtUm91dGluZyhjKSU+LCBhc3luYyAoKSA9PiB7DQogICAgICAgICAgICAvKioqIFNUQVJUIExPQ0FMIDwlPW1OYW1lJT4oKSAqKiovDQoNCjwlIGNsc1Rvb2xzKGMpLmZvckVhY2godCA9PiB7JT4NCiAgICAgICAgaWYodGhpcy5Ub29sLnR5cGUubmFtZT09IjwlPXQlPiIpew0KICAgIDwlIGlmKHQ9PSJNb25nb0RCIiB8fCB0PT0iWmFuZ29EQiIpeyAlPg0KICAgICAgICAgICAgYXdhaXQgdGhpcy5Ub29sLmRiLmdldENvbGxlY3Rpb24oPCU9X25Db2RlKGMpJT4pLmluc2VydE9uZSh0aGlzLl90b0RvY3VtZW50KHtiTWFwOiB0cnVlfSkpOw0KICAgICAgICAgICAgdGhpcy5Ub29sLl9fZG1sU3RhdGVtZW50cy5wdXNoKGBkYi5nZXRDb2xsZWN0aW9uKCckezwlPV9uQ29kZSgpJT59JykuaW5zZXJ0T25lKCR7dGhpcy5fdG9KU09OKHtiTWFwOiB0cnVlfSl9KWApOw0KICAgIDwlIH0gZWxzZSBpZih0ID09ICJSeERCIikgeyU+DQogICAgICAgICAgICBhd2FpdCB0aGlzLlRvb2wuZGJbPCU9X25Db2RlKGMpJT5dLjwlPW1OYW1lJT4odGhpcy5fdG9Eb2N1bWVudCh7Yk1hcDogdHJ1ZX0pKTsNCiAgICA8JSB9IGVsc2UgaWYodCA9PSAiS2Fma2EiKSB7JT4NCiAgICAgICAgICAgIHRoaXMuX190aW1lKCc8JT1zY29wZSU+LjwlPW5OYW1lKGMsIHRydWUpJT4uPCU9bU5hbWUlPi5rYWZrYScpOw0KICAgICAgICAgICAgbGV0IHJldCA9IGF3YWl0IHRoaXMuVG9vbC5wcm9kdWNlci5zZW5kKHsNCiAgICAgICAgICAgICAgICB0b3BpYzogJzwlPXNjb3BlJT4uY2FsbCcsDQogICAgICAgICAgICAgICAgbWVzc2FnZXM6IFt7DQogICAgICAgICAgICAgICAgICAgIGtleTogdGhpcy5JZCwNCiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuX3RvRG9jdW1lbnQoe2JNYXA6IHRydWV9KQ0KICAgICAgICAgICAgICAgIH1dDQogICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIDwlPWxvZygpJT4nY2FsbDogJyArIHRoaXMuX190aW1lKCc8JT1zY29wZSU+LjwlPW5OYW1lKGMsIHRydWUpJT4uPCU9bU5hbWUlPi5rYWZrYScpKTsNCiAgICAgICAgICAgIDwlPWxvZygpJT4ncmVzcG9uc2U6ICcsIHJldCk7DQogICAgPCUgfSBlbHNlIGlmKHQgPT0gIk1lbW9yeSIpIHslPg0KICAgICAgICAgICAgdGhpcy5Ub29sLmRiLjwlPW5OYW1lKGMpJT4ucHVzaCh0aGlzKTsNCiAgICA8JSB9IGVsc2UgaWYodCA9PSAiTmVvNGoiKSB7JT4NCiAgICAgICAgICAgIGxldCByZXQgPSBhd2FpdCB0aGlzLl9uZW80aih0aGlzLl90b0N5TWVyZ2UoKSk7DQogICAgPCUgfSBlbHNlIGlmKHQgPT0gIlNhbGVzRm9yY2UiKSB7JT4NCiAgICAgICAgICAgIGxldCBvYmogPSB7fTsNCiAgICAgICAgICAgIDwlICQuZWFjaChjLkVudGl0eUF0dHJpYnV0ZXMuZmlsdGVyKGVhID0+ICFlYS5FbnRpdHlNZXRob2QpLCAoXywgZWEpID0+IHslPg0KICAgICAgICAgICAgaWYodGhpcy5fPCU9bk5hbWUoZWEpJT5fc2V0KXsNCiAgICAgICAgICAgICAgICA8JSBpZihlYS5FbnRpdHlUeXBlKXsgJT4NCiAgICAgICAgICAgICAgICBvYmouPCU9bk5hbWUoZWEpJT4gPSB0aGlzLl88JT1uTmFtZShlYSklPi5JZDsNCiAgICAgICAgICAgICAgICA8JSB9ZWxzZXsgJT4NCiAgICAgICAgICAgICAgICBvYmouPCU9bk5hbWUoZWEpJT4gPSB0aGlzLjwlPW5OYW1lKGVhKSU+KCk7DQogICAgICAgICAgICAgICAgPCUgfSAlPg0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgPCUgfSk7ICU+DQogICAgDQogICAgICAgICAgICBsb2coIlNlbmRpbmcgdG8gU0YiLCBvYmopOw0KICAgIA0KICAgICAgICAgICAgbGV0IHJlcyA9IGF3YWl0IHRoaXMuVG9vbC5kYi5zb2JqZWN0KCI8JT1uTmFtZShjKSU+IikuY3JlYXRlKG9iaik7DQogICAgICAgICAgICB0aGlzLklkID0gcmVzLmlkOw0KICAgIDwlIH0gZWxzZSBpZihfc3FsVG9vbHMuaW5kZXhPZih0KT49MCkgeyU+DQogICAgICAgICAgICBsZXQgcmV0ID0gYXdhaXQgdGhpcy5fc3FsKHRoaXMuX3RvSW5zZXJ0U1FMKCkpOw0KICAgICAgICAgICAgPCU9bG9nKCklPiJyZXN1bHQiLCByZXQpOw0KICAgIDwlIH0gZWxzZSBpZih0ID09ICJTZXJ2aWNlTm93IikgeyU+DQogICAgICAgICAgICB0aGlzLl9mcm9tRG9jdW1lbnQoYXdhaXQgdGhpcy5fcmVzdChudWxsLCBudWxsLCBhd2FpdCB0aGlzLl90b0RvY3VtZW50KHtiTWFwOiB0cnVlLCByZXVzZWQ6IDF9KSkpOw0KICAgIDwlIH0gZWxzZSBpZihfZmlsZVRvb2xzLmluZGV4T2YodCk+LTEpeyAlPg0KICAgICAgICAgICAgYXdhaXQgdGhpcy5fPCU9dC50b0xvd2VyQ2FzZSgpJT4odGhpcy5fZmlsZU5hbWUoKSwgdGhpcy5fdG9KU09OKHtiTWFwOiB0cnVlLCByZXVzZWQ6IDF9KSwgdGhpcy5JZCk7DQogICAgPCUgfSBlbHNlIGlmKHQgPT0gIkVNUyIpIHslPg0KICAgICAgICAgICAgdGhpcy5JZCA9IChhd2FpdCB0aGlzLl90b0VNU09iamVjdCgpLnN0b3JlKCkpLklkOw0KICAgIDwlIH0gZWxzZSBpZih0ID09ICJSZXN0REJJTyIpIHslPg0KICAgICAgICAgICAgbGV0IG9iaiA9IHt9Ow0KICAgICAgICAgICAgPCUgJC5lYWNoKGMuRW50aXR5QXR0cmlidXRlcy5maWx0ZXIoZWEgPT4gIWVhLkVudGl0eU1ldGhvZCksIChfLCBlYSkgPT4geyU+DQogICAgICAgICAgICBpZih0aGlzLl88JT1uTmFtZShlYSklPl9zZXQpew0KICAgICAgICAgICAgICAgIDwlIGlmKGVhLkVudGl0eVR5cGUpeyAlPg0KICAgICAgICAgICAgICAgIG9iai48JT1uQ29kZShlYSklPiA9IHRoaXMuPCU9bk5hbWUoZWEpJT4oKS5JZC8qX2lkKCkqLzsNCiAgICAgICAgICAgICAgICA8JSB9ZWxzZXsgJT4NCiAgICAgICAgICAgICAgICBvYmouPCU9bkNvZGUoZWEpJT4gPSB0aGlzLjwlPW5OYW1lKGVhKSU+KCk7DQogICAgICAgICAgICAgICAgPCUgfSAlPg0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgPCUgfSk7ICU+DQogICAgDQogICAgICAgICAgICBsZXQgdXJsID0gImh0dHBzOi8vIiArIHRoaXMuX19jb25maWcoJ2RhdGFiYXNlJykgKyAiLnJlc3RkYi5pby9yZXN0LyIgKyA8JT1fbkNvZGUoKSU+LnRvTG93ZXJDYXNlKCk7DQogICAgICAgICAgICBsb2coIjwlPXQlPiBVUkwiLCB1cmwpOw0KICAgICAgICAgICAgbGV0IHJlcyA9IGF3YWl0IGF4aW9zLnBvc3QodXJsLCBvYmosIHsNCiAgICAgICAgICAgICAgICBoZWFkZXJzOiB7DQogICAgICAgICAgICAgICAgICAgICJjYWNoZS1jb250cm9sIjogIm5vLWNhY2hlIiwNCiAgICAgICAgICAgICAgICAgICAgIngtYXBpa2V5IjogdGhpcy5fX2NvbmZpZygnYXBpa2V5JyksDQogICAgICAgICAgICAgICAgICAgICJjb250ZW50LXR5cGUiOiAiYXBwbGljYXRpb24vanNvbiIsDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSk7DQogICAgDQogICAgICAgICAgICBsb2coInJlc3VsdCIsIHJlcy5kYXRhKTsNCiAgICAgICAgICAgIHRoaXMuX2Zyb21Eb2N1bWVudChyZXMuZGF0YSk7DQogICAgPCUgfSBlbHNlIGlmKHQgPT0gIkJJU2VydmVyIikgeyU+DQogICAgICAgICAgICAvLyB3ZSBuZWVkIGRlcHRoIDIgdG8gZ2V0IHRoZSBFbnRpdHlWYWx1ZXMgYm91bmQgdG8gdGhlIG9uZXMgd2Ugc2VudA0KICAgICAgICAgICAgbGV0IGluc09iaiA9IGF3YWl0IHRoaXMuc3IoKS5fKCJFbnRlcnByaXNlTWFuYWdlci5lbXNFbnRpdHlPYmplY3RJbnNlcnQiLCBudWxsLCB0aGlzLnRvRW50aXR5T2JqZWN0KCksIG51bGwsIDIpOw0KICAgICAgICAgICAgaWYoIWluc09iaikgcmV0dXJuIG51bGw7DQogICAgICAgICAgICB0aGlzLklkID0gaW5zT2JqLklkOw0KICAgICAgICAgICAgdGhpcy5FbnRpdHlWYWx1ZXMgPSBpbnNPYmouRW50aXR5VmFsdWVzOw0KICAgICAgICAgICAgdGhpcy5fcmV2ZXJ0KCk7DQogICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICA8JSB9ICU+DQogICAgICAgIH0NCjwlIH0pICU+DQoNCiAgICAgICAgdGhpcy5fX3N5bmNfb24obmV3IERhdGUoKSk7DQoNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgIH0sIHtfX2JlZm9yZVJ1bGVzOiBbPCUoYy5FbnRpdHlSdWxlcyB8fCBbXSkuZmlsdGVyKHIgPT4gclttTmFtZV0gJiYgci5CZWZvcmUpLm1hcChyID0+IHslPjwlPV9GckVNRC5fdG9KUyhyKSU+PCUgfSkuam9pbignLCAnKSU+XSwgX19hZnRlclJ1bGVzOiBbPCUoYy5FbnRpdHlSdWxlcyB8fCBbXSkuZmlsdGVyKHIgPT4gclttTmFtZV0gJiYgci5BZnRlcikubWFwKHIgPT4geyU+PCU9X0ZyRU1ELl90b0pTKHIpJT48JSB9KS5qb2luKCcsICcpJT5dfSk7DQogICAgICAgIA0KICAgICAgICByZXR1cm4gKHJlc3VsdHMuZmluZChyID0+IHIucmV0KSB8fCB7cmV0OiBudWxsfSkucmV0OyAvLyBmaXJzdCBvbmUgdG8gZXhlY3V0ZSBjb3JyZWN0bHkNCiAgICB9DQogICAgDQogICAgYXN5bmMgPCU9bU5hbWU9J3VwZGF0ZSclPigpIHsNCiAgICAgICAgbGV0IHJlc3VsdHMgPSBhd2FpdCB0aGlzLl9leGVjdXRlKG51bGwsIDwlPWFsaWFzKCklPiwgIjwlPW1OYW1lJT4iLCA8JW1Sb3V0aW5nKGMpJT4sIGFzeW5jICgpID0+IHsNCiAgICAgICAgLyoqKiBTVEFSVCBMT0NBTCA8JT1tTmFtZSU+KCkgKioqLw0KDQogICAgICAgIGxldCByZXQgPSBudWxsOw0KPCUgY2xzVG9vbHMoYykuZm9yRWFjaCh0ID0+IHslPg0KICAgICAgICBpZih0aGlzLlRvb2wudHlwZS5uYW1lPT0iPCU9dCU+Iil7DQoNCiAgICA8JSBpZih0ID09ICJNb25nb0RCIikgeyU+DQogICAgICAgICAgICByZXQgPSBhd2FpdCB0aGlzLlRvb2wuZGIuY29sbGVjdGlvbig8JT1fbkNvZGUoYyklPikudXBkYXRlT25lKHtfaWQ6IHRoaXMuSWR9LCB7JHNldDogdGhpcy5fdG9Eb2N1bWVudCh7Yk1hcDogdHJ1ZX0pfSk7DQogICAgICAgICAgICB0aGlzLlRvb2wuX19kbWxTdGF0ZW1lbnRzLnB1c2goYGRiLmdldENvbGxlY3Rpb24oJyR7PCU9X25Db2RlKCklPn0nKS51cGRhdGVPbmUoe19pZDogJyR7cmV0Ll9pZH0nfSwgeyRzZXQ6ICR7dGhpcy5fdG9Eb2N1bWVudCh7Yk1hcDogdHJ1ZX0pfSlgKTsNCiAgICA8JSB9ZWxzZSBpZih0ID09ICJNZW1vcnkiKSB7JT4NCiAgICAgICAgICAgIHRoaXMuVG9vbC5kYi48JT1uTmFtZShjKSU+W3RoaXMuVG9vbC5kYi48JT1uTmFtZShjKSU+LmZpbmRJbmRleChvID0+IG8uSWQ9PXRoaXMuSWQpXSA9IHRoaXM7DQogICAgPCUgfWVsc2UgaWYodCA9PSAiS2Fma2EiKSB7JT4NCiAgICAgICAgICAgIHRoaXMuX190aW1lKCc8JT1zY29wZSU+LjwlPW5OYW1lKGMsIHRydWUpJT4uPCU9bU5hbWUlPi5rYWZrYScpOw0KICAgICAgICAgICAgcmV0ID0gYXdhaXQgdGhpcy5Ub29sLnByb2R1Y2VyLnNlbmQoew0KICAgICAgICAgICAgICAgIHRvcGljOiAnPCU9c2NvcGUlPi5jYWxsJywNCiAgICAgICAgICAgICAgICBtZXNzYWdlczogW3sNCiAgICAgICAgICAgICAgICAgICAga2V5OiB0aGlzLklkLA0KICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5fdG9Eb2N1bWVudCh7Yk1hcDogdHJ1ZX0pDQogICAgICAgICAgICAgICAgfV0NCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgPCU9bG9nKCklPidjYWxsOiAnICsgdGhpcy5fX3RpbWUoJzwlPXNjb3BlJT4uPCU9bk5hbWUoYywgdHJ1ZSklPi48JT1tTmFtZSU+LmthZmthJykpOw0KICAgICAgICAgICAgPCU9bG9nKCklPidyZXNwb25zZTogJywgcmV0KTsNCiAgICA8JSB9IGVsc2UgaWYodCA9PSAiTmVvNGoiKSB7JT4NCiAgICAgICAgICAgIGF3YWl0IHRoaXMuX25lbzRqKHRoaXMuX3RvQ3lNZXJnZSgpKTsNCiAgICA8JSB9ZWxzZSBpZihfc3FsVG9vbHMuaW5kZXhPZih0KT49MCkgeyU+DQogICAgICAgICAgICBhd2FpdCB0aGlzLl9zcWwodGhpcy5fdG9VcGRhdGVTUUwoKSk7DQogICAgICAgICAgICByZXQgPSBhd2FpdCB0aGlzLl9zcWwodGhpcy5fdG9TZWxlY3RTUUwoKSk7DQogICAgICAgICAgICBpZihBcnJheS5pc0FycmF5KHJldCkpIHJldCA9IHJldFswXTsNCiAgICA8JSB9ZWxzZSBpZih0ID09ICJTZXJ2aWNlTm93IikgeyU+DQogICAgICAgICAgICByZXQgPSAoYXdhaXQgdGhpcy5fcmVzdChudWxsLCBudWxsLCBhd2FpdCB0aGlzLl90b0RvY3VtZW50KHtiTWFwOiB0cnVlLCByZXVzZWQ6IDF9KSwgJ3B1dCcpKS5yZXN1bHQ7DQogICAgPCUgfWVsc2UgaWYoX2ZpbGVUb29scy5pbmRleE9mKHQpPi0xKXsgJT4NCiAgICAgICAgICAgIGF3YWl0IHRoaXMuXzwlPXQudG9Mb3dlckNhc2UoKSU+KHRoaXMuX2ZpbGVOYW1lKCksIHRoaXMuX3RvSlNPTih7Yk1hcDogdHJ1ZSwgcmV1c2VkOiAxfSksIHRoaXMuSWQpOw0KICAgIDwlIH0gZWxzZSBpZih0ID09ICJFTVMiKSB7JT4NCiAgICAgICAgICAgIGF3YWl0IHRoaXMuX3RvRU1TT2JqZWN0KCkuc3RvcmUoKTsNCiAgICA8JSB9ZWxzZSBpZih0ID09ICJSZXN0REJJTyIpIHslPg0KICAgICAgICAgICAgPCU9bG9nKCklPiJTZW5kaW5nIHVwZGF0ZSB0byBSRVNUREJJTyB0byBzYXZlIik7DQoNCiAgICAgICAgICAgIGxldCB1cmwgPSAiaHR0cHM6Ly8iICsgdGhpcy5fX2NvbmZpZygnZGF0YWJhc2UnKSArICIucmVzdGRiLmlvL3Jlc3QvIiArIDwlPV9uQ29kZSgpJT4udG9Mb3dlckNhc2UoKSArICIvIiArIHRoaXMuSWQ7DQogICAgICAgICAgICAvLyA8JT1sb2coKSU+IlVwZGF0ZSB0byBSRVNUREJJTyIsIHVybCk7DQogICAgICAgICAgICByZXQgPSAoYXdhaXQgYXhpb3MucHV0KHVybCwgb2JqLCB7DQogICAgICAgICAgICAgICAgaGVhZGVyczogew0KICAgICAgICAgICAgICAgICAgICAiY2FjaGUtY29udHJvbCI6ICJuby1jYWNoZSIsDQogICAgICAgICAgICAgICAgICAgICJ4LWFwaWtleSI6IHRoaXMuX19jb25maWcoJ2FwaWtleScpLA0KICAgICAgICAgICAgICAgICAgICAiY29udGVudC10eXBlIjogImFwcGxpY2F0aW9uL2pzb24iLA0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0pKS5kYXRhOw0KICAgIDwlIH1lbHNlIGlmKHQgPT0gIkJJU2VydmVyIikgeyU+DQogICAgICAgICAgICAvLyB3ZSBuZWVkIGRlcHRoIDIgdG8gZ2V0IHRoZSBFbnRpdHlWYWx1ZXMgYm91bmQgdG8gdGhlIG9uZXMgd2Ugc2VudA0KICAgICAgICAgICAgbGV0IHVwZE9iaiA9IGF3YWl0IHRoaXMuc3IoKS5fKCJFbnRlcnByaXNlTWFuYWdlci5lbXNFbnRpdHlPYmplY3RVcGRhdGUiLCBudWxsLCB0aGlzLnRvRW50aXR5T2JqZWN0KCksIDIpOw0KICAgICAgICAgICAgaWYoIXVwZE9iaikgcmV0dXJuIG51bGw7DQogICAgICAgICAgICB0aGlzLl9fc3luY19vbihuZXcgRGF0ZSgpKTsNCiAgICAgICAgICAgIHJldHVybiB0aGlzLl9jb3B5RnJvbSh1cGRPYmopOw0KICAgIDwlIH0gJT4NCiAgICAgICAgfQ0KPCUgfSklPg0KDQogICAgICAgICAgICA8JT1sb2coKSU+InJlc3VsdCIsIHJldCk7DQogICAgICAgICAgICB0aGlzLl9fc3luY19vbihuZXcgRGF0ZSgpKTsNCiAgICAgICAgICAgIHRoaXMuX2Zyb21Eb2N1bWVudChyZXQsIHRydWUpOw0KDQogICAgICAgICAgICByZXR1cm4gcmV0Ow0KDQogICAgICAgICAgICAvKioqIEVORCBMT0NBTCA8JT1tTmFtZSU+KCkgKioqLw0KICAgICAgICB9LCB7X19iZWZvcmVSdWxlczogWzwlKGMuRW50aXR5UnVsZXMgfHwgW10pLmZpbHRlcihyID0+IHJbbU5hbWVdICYmIHIuQmVmb3JlKS5tYXAociA9PiB7JT48JT1fRnJFTUQuX3RvSlMociklPjwlIH0pLmpvaW4oJywgJyklPl0sIF9fYWZ0ZXJSdWxlczogWzwlKGMuRW50aXR5UnVsZXMgfHwgW10pLmZpbHRlcihyID0+IHJbbU5hbWVdICYmIHIuQWZ0ZXIpLm1hcChyID0+IHslPjwlPV9GckVNRC5fdG9KUyhyKSU+PCUgfSkuam9pbignLCAnKSU+XX0pOw0KICAgICAgICANCiAgICAgICAgcmV0dXJuIChyZXN1bHRzLmZpbmQociA9PiByLnJldCkgfHwge3JldDogbnVsbH0pLnJldDsgLy8gZmlyc3Qgb25lIHRvIGV4ZWN1dGUgY29ycmVjdGx5DQogICAgfQ0KICAgIA0KICAgIGFzeW5jIDwlPW1OYW1lPSdmaW5kQWxsJyU+KGRlcHRoID0gMSwgb2Jqcz1bXSwgc3RhcnQsIGVuZCwgZmllbGRzKSB7DQogICAgICAgIGxldCByZXN1bHRzID0gYXdhaXQgdGhpcy5fZXhlY3V0ZShudWxsLCA8JT1hbGlhcygpJT4sICI8JT1tTmFtZSU+IiwgPCVtUm91dGluZyhjKSU+LCBhc3luYyAoKSA9PiB7DQogICAgICAgICAgICAgICAgLyoqKiBTVEFSVCBMT0NBTCA8JT1tTmFtZSU+KCkgKioqLw0KICAgICAgICANCiAgICAgICAgbGV0IHJldCA9IFtdOyAvLyBhIGpzb24gYXJyYXkNCg0KPCUgY2xzVG9vbHMoYykuZm9yRWFjaCh0ID0+IHslPg0KICAgICAgICBpZih0aGlzLlRvb2wudHlwZS5uYW1lPT0iPCU9dCU+Iil7DQogICAgPCUgaWYodD09Ik1vbmdvREIiKXsgJT4NCiAgICAgICAgICAgIGlmKHRoaXMuVG9vbC5kYikgcmV0ID0gYXdhaXQgdGhpcy5Ub29sLmRiLmNvbGxlY3Rpb24oPCU9X25Db2RlKGMpJT4pLmZpbmQodGhpcy5fdG9TZWxlY3RNb25nb0RCKGZpZWxkcywgb2JqcykpLnRvQXJyYXkoKTsNCiAgICA8JSB9IGVsc2UgaWYodCA9PSAiUnhEQiIpIHslPg0KICAgICAgICAgICAgYXdhaXQgdGhpcy5Ub29sLmRiWzwlPV9uQ29kZShjKSU+XS5maW5kKHRoaXMuX3RvU2VsZWN0UnhEQihmaWVsZHMsIG9ianMpKS5leGVjKCk7DQogICAgPCUgfWVsc2UgaWYoX3NxbFRvb2xzLmluZGV4T2YodCk+PTApeyAlPg0KICAgICAgICAgICAgcmV0ID0gYXdhaXQgdGhpcy5fc3FsKHRoaXMuX3RvU2VsZWN0U1FMKGZpZWxkcywgb2JqcykpOw0KICAgIDwlIH1lbHNlIGlmKHQ9PSJFTVMiKXsgJT4NCiAgICAgICAgICAgIGxldCBvID0gdGhpcy5fdG9FTVNPYmplY3QodHJ1ZSwgdHJ1ZSk7DQogICAgICAgICAgICBpZih0aGlzLl9fY29uZmlnKCdlbXMuZGVlcC5xdWVyeScpKSBvID0gbmV3IDwlPXNjb3BlJT4uRW50aXR5T2JqZWN0KCkuVEhJUyhbb10uY29uY2F0KG9ianMubWFwKF9vID0+IF9vLl90b0VNU09iamVjdCh0cnVlLCB0cnVlKSkpKTsNCiAgICAgICAgICAgIHJldCA9IGF3YWl0IHRoaXMuX2Zyb21FTVNWYWx1ZXMoYXdhaXQgbmV3IDwlPXNjb3BlJT4uRW50aXR5VmFsdWUoKS5hY3RpdmUodHJ1ZSkuZW50aXR5T2JqZWN0KG8pLjwlPW1OYW1lJT4oKSk7DQogICAgICAgICAgICBpZih0aGlzLl9fY29uZmlnKCdlbXMuZGVlcC5xdWVyeScpKSByZXR1cm4gcmV0Ow0KICAgIDwlIH1lbHNlIGlmKHQ9PSJNZW1vcnkiKXsgJT4NCiAgICAgICAgICAgIHJldHVybiB0aGlzLlRvb2wuZGJbPCU9X25Db2RlKCklPl0uZmlsdGVyKG8gPT4gbyAmJiB0aGlzLl9zYW1lRW50aXR5KG8pKTsNCiAgICA8JSB9ZWxzZSBpZih0PT0iSHViU3BvdCIpeyAlPg0KICAgIDwlIH1lbHNlIGlmKHQ9PSJTZXJ2aWNlTm93Iil7ICU+DQogICAgICAgICAgICByZXQgPSAoYXdhaXQgdGhpcy5fcmVzdChudWxsLCB7c3lzcGFybV9xdWVyeTogdGhpcy5fdG9TTlF1ZXJ5KGZpZWxkcywgb2JqcywgdHJ1ZSl9KSkucmVzdWx0Ow0KICAgIDwlIH1lbHNlIGlmKHQ9PSJTYWxlc0ZvcmNlIil7ICU+DQogICAgICAgICAgICByZXQgPSBhd2FpdCB0aGlzLl9yZXN0KG51bGwsIG51bGwsIHRoaXMuX3RvU0ZRdWVyeShmaWVsZHMsIG9ianMsIHRydWUpLCBudWxsLCB7dXJsOiAncmVzdC51cmwuZ3FsJ30pOw0KICAgIDwlIH1lbHNlIGlmKF9maWxlVG9vbHMuaW5kZXhPZih0KT4tMSl7ICU+DQogICAgICAgICAgICBsZXQgZE5hbWUgPSB0aGlzLl9maWxlTmFtZSgpLnNwbGl0KCcvJykuc2xpY2UoMCwgLTEpLmpvaW4oJy8nKTsNCiAgICAgICAgICAgIC8vPCU9bG9nKCklPiJkTmFtZSIsIGROYW1lKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgbGV0IGlkeExpc3QgPSAoYXdhaXQgdGhpcy5fPCU9dC50b0xvd2VyQ2FzZSgpJT4oZE5hbWUpKS5maWx0ZXIociA9PiB0eXBlb2Yoci5uYW1lKSE9PSd1bmRlZmluZWQnKS5tYXAociA9PiB7DQogICAgICAgICAgICAgICAgbGV0IGhUaGlzID0gdGhpcy5fdG9IYXNoKG51bGwsIHtub0NvZGU6IHRydWUsIG9ubHlVbmlxdWU6IHRydWUsIG5vT3BlcmF0b3JzOiB0cnVlfSwgJzwlPW1OYW1lJT4nKS5fdGhpczsNCiAgICAgICAgICAgICAgICBsZXQgdUtleXMgPSBPYmplY3Qua2V5cyhoVGhpcykuZmlsdGVyKGsgPT4gdHlwZW9mKGhUaGlzW2tdKSE9PSd1bmRlZmluZWQnKTsNCiAgICAgICAgICAgICAgICByLm5hbWUuc3BsaXQoJ19fJykuZm9yRWFjaCgobnAsIGkpID0+IHJbdUtleXNbaV1dID0gbnApOw0KICAgICAgICAgICAgICAgIHIuT1BFUkFUT1JTID0gT2JqZWN0LmFzc2lnbih7fSwgLi4udUtleXMubWFwKGsgPT4gKHtba106ICc9J30pKSk7DQogICAgICAgICAgICAgICAgcmV0dXJuIHI7DQogICAgICAgICAgICB9KS5tYXAociA9PiBuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUoYywgdHJ1ZSklPigpLl9mcm9tRG9jdW1lbnQociwgdHJ1ZSkpOw0KICAgICAgICAgICAgPCU9bG9nKCklPiJpZHhMaXN0IiwgaWR4TGlzdCwgaWR4TGlzdC5tYXAociA9PiBkTmFtZSArICcvJyArIHIuX2ZpbGVOYW1lKCkuc3BsaXQoJy8nKS5zbGljZSgtMSkuam9pbignLycpKSk7DQogICAgICAgICAgICBpZHhMaXN0ID0gaWR4TGlzdC5maWx0ZXIociA9PiByLl9tYXRjaGVzKHRoaXMsIHtvbmx5VW5pcXVlOiB0cnVlfSkpOw0KICAgICAgICAgICAgPCU9bG9nKCklPiJpZHhMaXN0IGZpbHRlcmVkIiwgaWR4TGlzdCk7IA0KDQogICAgICAgICAgICBpZihpZHhMaXN0Lmxlbmd0aD09MSl7DQogICAgICAgICAgICAgICAgcmV0LnB1c2goYXdhaXQgdGhpcy5fPCU9dC50b0xvd2VyQ2FzZSgpJT4oZE5hbWUgKyAnLycgKyBpZHhMaXN0WzBdLl9maWxlTmFtZSgpLnNwbGl0KCcvJykuc2xpY2UoLTEpLmpvaW4oJy8nKSkpOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0ID0gaWR4TGlzdDsNCiAgICAgICAgICAgIH0NCiAgICA8JSB9ZWxzZSBpZih0PT0iTmVvNGoiKXsgJT4NCiAgICAgICAgICAgIHJldCA9IGF3YWl0IHRoaXMuX25lbzRqKHRoaXMuX3RvQ3lRdWVyeShmaWVsZHMsIG9ianMpKTsNCiAgICA8JSB9ZWxzZSBpZih0PT0iUmVzdERCSU8iKXsgJT4NCiAgICAgICAgICAgIGxldCB0aGlzRG9jID0gdGhpcy5fdG9Eb2N1bWVudCh7Yk1hcDogdHJ1ZX0pOw0KICAgICAgICAgICAgbGV0IGVhQ29kZSA9ICIiOw0KICAgICAgICA8JSAkLmVhY2goYy5FbnRpdHlBdHRyaWJ1dGVzLmZpbHRlcihlYSA9PiAhZWEuRW50aXR5TWV0aG9kKSwgKF8sIGVhKSA9PiB7JT4NCiAgICAgICAgICAgIGVhQ29kZSA9IDwlPV9uQ29kZShlYSklPjsNCiAgICAgICAgICAgIGlmKHRoaXMuXzwlPW5OYW1lKGVhKSU+X3NldCl7DQogICAgICAgICAgICA8JSBpZihlYS5FbnRpdHlUeXBlKXsgJT4NCiAgICAgICAgICAgIDwlIH1lbHNlIGlmKGVhLklzQXJyYXkpeyAlPg0KICAgICAgICAgICAgICAgIGlmKHRoaXMuXzwlPW5OYW1lKGVhKSU+X2Nvb3A9PSIhPSIpew0KICAgICAgICAgICAgICAgICAgICB0aGlzRG9jW2VhQ29kZV0gPSB7IiRuaW4iOiB0aGlzRG9jW2VhQ29kZV19Ow0KICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICB0aGlzRG9jW2VhQ29kZV0gPSB7IiRpbiI6IHRoaXNEb2NbZWFDb2RlXX07DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgPCUgfWVsc2UgaWYoZWEuSXNTdHJpbmcgfHwgZWEuSXNUZXh0KXsgJT4NCiAgICAgICAgICAgICAgICBpZihbbnVsbCwgJyUnLCAnTElLRSddLmluZGV4T2YodGhpcy5fPCU9bk5hbWUoZWEpJT5fY29vcCk+LTEpew0KICAgICAgICAgICAgICAgICAgICB0aGlzRG9jW2VhQ29kZV0gPSB7IiRyZWdleCI6IHRoaXNEb2NbZWFDb2RlXSB8fCAiLioifTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICA8JSB9ICU+DQogICAgICAgICAgICB9DQogICAgICAgIDwlIH0pOyAlPg0KDQogICAgICAgICAgICBsZXQgdXJsID0gImh0dHBzOi8vIiArIHRoaXMuX19jb25maWcoJ2RhdGFiYXNlJykgKyAiLnJlc3RkYi5pby9yZXN0LyIgKyA8JT1fbkNvZGUoKSU+LnRvTG93ZXJDYXNlKCkgKyAiP3E9IiArIEpTT04uc3RyaW5naWZ5KGNvbmRpdGlvbnMpOw0KICAgICAgICAgICAgcmV0ID0gKGF3YWl0IGF4aW9zLmdldCh1cmwsIHsNCiAgICAgICAgICAgICAgICBoZWFkZXJzOiB7DQogICAgICAgICAgICAgICAgICAgICJjYWNoZS1jb250cm9sIjogIm5vLWNhY2hlIiwNCiAgICAgICAgICAgICAgICAgICAgIngtYXBpa2V5IjogdGhpcy5fX2NvbmZpZygnYXBpa2V5JyksDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSkpLmRhdGE7DQogICAgPCUgfWVsc2UgaWYodD09IkJJU2VydmVyIil7ICU+DQogICAgICAgICAgICBsZXQgcSA9IHsNCiAgICAgICAgICAgICAgICBUSElTOiB0aGlzLl9idWlsZFRoaXMoZGVwdGgpLmNvbmNhdCgob2JqcyB8fCBbXSkubWFwKG9iaiA9PiBvYmoudG9FbnRpdHlPYmplY3Q/ew0KICAgICAgICAgICAgICAgICAgICBBY3RpdmU6IHRydWUsDQogICAgICAgICAgICAgICAgICAgIEVudGl0eU9iamVjdDogb2JqLnRvRW50aXR5T2JqZWN0KHRydWUpLA0KICAgICAgICAgICAgICAgIH06b2JqKSksDQogICAgICAgICAgICAgICAgQWN0aXZlOiB0cnVlLA0KICAgICAgICAgICAgICAgIEVudGl0eU9iamVjdDogeyAvLyBhYnNvbHV0ZWx5IHJlcXVpcmVkIGZvciBpbmRleGluZw0KICAgICAgICAgICAgICAgICAgICBBY3RpdmU6IHRydWUsDQogICAgICAgICAgICAgICAgICAgIEVudGl0eUNsYXNzOiB0aGlzLl92YWx1ZUNsYXNzKCksDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfTsNCiAgICAgICAgICAgIDwlPWxvZygpJT5xKTsNCiAgICAgICAgICAgIHJldHVybiB0aGlzLl9hc09iamVjdHMoKGF3YWl0IHRoaXMuc3IoKS5fKCJFbnRlcnByaXNlTWFuYWdlci5lbXNFbnRpdHlWYWx1ZUZpbmRhbGwiLCBudWxsLCBxKSkpOw0KICAgIDwlIH0gJT4NCiAgICAgICAgfQ0KPCUgfSklPg0KDQogICAgICAgIDwlPWxvZygpJT4iQmVmb3JlIF9mcm9tRG9jdW1lbnQoKSIsIGRlcHRoLCByZXQpOw0KICAgICAgICANCiAgICAgICAgaWYoIUFycmF5LmlzQXJyYXkocmV0KSkgcmV0ID0gW3JldF07DQogICAgICAgIHJldCA9IHJldC5maWx0ZXIociA9PiByKS5tYXAociA9PiBuZXcgPCU9c2NvcGUlPi48JT1uTmFtZShjLCB0cnVlKSU+KCkuX2Zyb21Eb2N1bWVudChyLCB0cnVlKSkuZmlsdGVyKHIgPT4gcikubWFwKHIgPT4gci5fX3N5bmNfb24obmV3IERhdGUoKSkpOw0KDQogICAgICAgIGlmKGRlcHRoPjEpew0KICAgICAgICAgICAgZm9yIGF3YWl0IChjb25zdCByIG9mIHJldCl7DQo8JSBjLkVudGl0eUF0dHJpYnV0ZXMuZmlsdGVyKGVhID0+IGVhLkVudGl0eVR5cGUgJiYgIWVhLkVudGl0eU1ldGhvZCkuZm9yRWFjaChlYSA9PiB7JT4NCiAgICAgICAgICAgICAgICBpZihyLl88JT1uTmFtZShlYSklPl9zZXQpew0KICAgICAgICAgICAgICAgICAgICAvLyA8JT1sb2coKSU+IjwlPW5OYW1lKGVhKSU+Iiwgci48JT1uTmFtZShlYSklPigpLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgICAgICAgICByLjwlPW5OYW1lKGVhKSU+KGF3YWl0IHIuXzwlPW5OYW1lKGVhKSU+LmZpbmQoZGVwdGgtMSkpOw0KICAgICAgICAgICAgICAgIH0NCjwlIH0pJT4NCiAgICANCjwlIGMuVHlwZWRBdHRyaWJ1dGVzLmZvckVhY2godGEgPT4geyBsZXQgdGFOYW1lID0gbk5hbWUodGEpICsgJ18nICsgdGEuRW50aXR5Q2xhc3MuUGx1cmFsLnJlcGxhY2UoLyAvZywgJ18nKTsgJT4NCiAgICA8JSBjbHNUb29scyhjKS5mb3JFYWNoKHQgPT4geyU+DQogICAgICAgICAgICAgICAgaWYodGhpcy5Ub29sLnR5cGUubmFtZT09IjwlPXQlPiIpew0KICAgICAgICA8JSBpZihfZmlsZVRvb2xzLmluZGV4T2YodCk+PTApeyAlPg0KICAgICAgICAgICAgICAgICAgICBsZXQgcl88JT10YU5hbWUlPiA9IFtdOw0KICAgICAgICAgICAgICAgICAgICBmb3IgYXdhaXQgKGNvbnN0IF90YSBvZiByLjwlPXRhTmFtZSU+KCkpew0KICAgICAgICAgICAgICAgICAgICAgICAgPCU9bG9nKCklPiI8JT10YU5hbWUlPiIsIF90YSk7DQogICAgICAgICAgICAgICAgICAgICAgICByXzwlPXRhTmFtZSU+LnB1c2goYXdhaXQgX3RhLmZpbmQoZGVwdGgtMSkpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIHIuY2xlYXJfPCU9dGFOYW1lJT4oKTsNCiAgICAgICAgICAgICAgICAgICAgci48JT10YU5hbWUlPihyXzwlPXRhTmFtZSU+KTsNCiAgICAgICAgPCUgfWVsc2V7ICU+DQogICAgICAgICAgICAgICAgICAgIC8vIDwlPWxvZygpJT4iPCU9dGFOYW1lJT4iLCByLjwlPXRhTmFtZSU+KCkpOw0KICAgICAgICAgICAgICAgICAgICByLjwlPXRhTmFtZSU+KGF3YWl0IG5ldyA8JT1zY29wZSU+LjwlPV9jTmFtZSh0YS5FbnRpdHlDbGFzcywgdHJ1ZSklPigpLjwlPW5OYW1lKHRhKSU+KHIpDQogICAgICAgICAgICA8JSBpZihmYWxzZSAmJiBbJ1NxbERCJ10uaW5kZXhPZih0KT49MCl7IC8vIHNxbCBzdGF0ZW1lbnRzIGRvIG5vdCBpbmNsdWRlIGxlZnQgam9pbnMgd2l0aG91dCBleHBsaWNpdCByZWZlcmVuY2VzICU+DQogICAgICAgICAgICAgICAgICAgICAgICA8JXRhLkVudGl0eUNsYXNzLkVudGl0eUF0dHJpYnV0ZXMuZmlsdGVyKGVhID0+ICFlYS5FbnRpdHlNZXRob2QgJiYgZWEuRW50aXR5VHlwZSAmJiBlYSE9dGEpLmZvckVhY2goZWEgPT4geyU+LjwlPW5OYW1lKGVhKSU+KG5ldyA8JT1zY29wZSU+LjwlPW5OYW1lKGVhLkVudGl0eVR5cGUsIHRydWUpJT4oKSk8JX0pJT4NCiAgICAgICAgICAgIDwlIH0lPg0KICAgICAgICAgICAgICAgICAgICAgICAgLjwlPW1OYW1lJT4oZGVwdGgtMSkpOw0KICAgICAgICA8JSB9JT4NCiAgICAgICAgICAgICAgICB9DQogICAgPCUgfSklPg0KPCUgfSklPg0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgbGV0IHJlZnMgPSByZXQuZmlsdGVyKHIgPT4gci5FbnRpdHlDbGFzcyk7DQogICAgICAgIGZvciBhd2FpdCAoY29uc3QgbyBvZiAob2JqcyB8fCBbXSkuZmlsdGVyKF9vID0+ICFfby5fX3N5bmNfb24oKSkpew0KICAgICAgICAgICAgaWYoby5fdG9FTVNPYmplY3Qpew0KICAgICAgICAgICAgICAgIHJlZnMucHVzaCguLi4oYXdhaXQgdGhpcy5fZnJvbUVNU1ZhbHVlcyhhd2FpdCBvLl90b0VNU09iamVjdCh0cnVlLCB0cnVlKS48JT1tTmFtZSU+KGRlcHRoKSkpKTsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJlZnMucHVzaCguLi4oYXdhaXQgby48JT1tTmFtZSU+KGRlcHRoKSkpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHJlZnMgPSByZWZzLmZpbHRlcihyID0+IHIpOw0KICAgICAgICANCiAgICAgICAgcmVmcy5mb3JFYWNoKHIgPT4gci5fcmVzb2x2ZShyZWZzKSk7DQoNCiAgICAgICAgPCU9bG9nKCklPiJPdXRwdXQiLCByZXQpOw0KDQogICAgICAgIHJldHVybiByZXQ7DQogICAgICAgICAgICAgICAgLyoqKiBFTkQgTE9DQUwgPCU9bU5hbWUlPigpICoqKi8NCiAgICAgICAgfSwge2RlcHRoLCBvYmpzLCBzdGFydCwgZW5kLCBmaWVsZHMsIF9fYmVmb3JlUnVsZXM6IFs8JShjLkVudGl0eVJ1bGVzIHx8IFtdKS5maWx0ZXIociA9PiByW21OYW1lXSAmJiByLkJlZm9yZSkubWFwKHIgPT4geyU+PCU9X0ZyRU1ELl90b0pTKHIpJT48JSB9KS5qb2luKCcsICcpJT5dLCBfX2FmdGVyUnVsZXM6IFs8JShjLkVudGl0eVJ1bGVzIHx8IFtdKS5maWx0ZXIociA9PiByW21OYW1lXSAmJiByLkFmdGVyKS5tYXAociA9PiB7JT48JT1fRnJFTUQuX3RvSlMociklPjwlIH0pLmpvaW4oJywgJyklPl19KTsNCg0KICAgICAgICByZXR1cm4gKHJlc3VsdHMuZmluZChyID0+IHIucmV0KSB8fCB7cmV0OiBbXX0pLnJldCB8fCBbXTsgLy8gZmlyc3Qgb25lIHRvIGV4ZWN1dGUgY29ycmVjdGx5DQogICAgfQ0KICAgIA0KICAgIDwlPW1OYW1lPSdfcmVzb2x2ZSclPihyZWZzKXsNCiAgICAgICAgdHJ5ew0KICAgICAgICAgICAgaWYoIXJlZnMubGVuZ3RoKSByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgdGhpcy5fX2ltcG9ydCh7fSwgew0KICAgIDwlIGMuRW50aXR5QXR0cmlidXRlcy5maWx0ZXIoZWEgPT4gIWVhLkVudGl0eU1ldGhvZCAmJiBlYS5FbnRpdHlUeXBlKS5mb3JFYWNoKGVhID0+IHsgJT4NCiAgICAgICAgICAgICAgICA8JT1uTmFtZShlYSklPjogKCkgPT4gew0KICAgICAgICAgICAgICAgICAgICBpZih0aGlzLjwlPW5OYW1lKGVhKSU+KCkpew0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gPCU9bG9nKCklPiI8JT1uTmFtZShlYSklPiIsIHRoaXMuPCU9bk5hbWUoZWEpJT4oKS5JZCwgcmVmcy5tYXAociA9PiAoe2lkOiByLklkLCBjb2RlOiByLmNvZGUoKX0pKSk7DQogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLjwlPW5OYW1lKGVhKSU+KHJlZnMuZmluZChvID0+IG8uSWQ9PXRoaXMuPCU9bk5hbWUoZWEpJT4oKS5JZCkgfHwgdGhpcy48JT1uTmFtZShlYSklPigpLjwlPW1OYW1lJT4ocmVmcykpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSwNCiAgICA8JSB9KSU+DQogICAgPCUgYy5UeXBlZEF0dHJpYnV0ZXMuZm9yRWFjaCh0YSA9PiB7IGxldCB0YU5hbWUgPSBuTmFtZSh0YSkgKyAnXycgKyB0YS5FbnRpdHlDbGFzcy5QbHVyYWwucmVwbGFjZSgvIC9nLCAnXycpOyU+DQogICAgICAgICAgICAgICAgPCU9dGFOYW1lJT46ICgpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgaWYodGhpcy48JT10YU5hbWUlPigpLmxlbmd0aCkgdGhpcy48JT10YU5hbWUlPih0aGlzLjwlPXRhTmFtZSU+KCkubWFwKHRhID0+IHJlZnMuZmluZChvID0+IG8uSWQ9PXRhLklkKSB8fCB0YS48JT1tTmFtZSU+KHJlZnMpKSwgbnVsbCwgdHJ1ZSk7DQogICAgICAgICAgICAgICAgfSwNCiAgICA8JSB9KSU+DQogICAgICAgICAgICB9LCAiPCU9bU5hbWUlPiIpOw0KDQogICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgfWNhdGNoKGV4KXsNCiAgICAgICAgICAgIDwlPWVycm9yKCklPmV4KTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICANCjwlIGlmKG1haW5DbGFzcyhbJ0VNUyddKSl7JT4NCiAgICBhc3luYyA8JT1tTmFtZT0nX2Zyb21FTVNWYWx1ZXMnJT4oZXZzKXsNCiAgICA8JSBpZihtYWluQ2xhc3MoWydFTVMnXSk9PWMpeyU+DQogICAgICAgIHRyeXsNCiAgICAgICAgICAgIGF3YWl0IHRoaXMuX2ZpbmRSZWZlcmVuY2VzKGV2cywgWy4uLm5ldyBTZXQoZXZzLm1hcCh2ID0+IHYuZW50aXR5QXR0cmlidXRlKCkuSWQpLmZsYXQoKSldLm1hcChpZCA9PiBuZXcgPCU9c2NvcGUlPi5FbnRpdHlBdHRyaWJ1dGUoaWQpKSk7DQogICAgICAgICAgICA8JT1sb2coKSU+ZXZzKTsNCiAgICAgICAgDQogICAgICAgICAgICBsZXQgb2JqcyA9IFtdOw0KICAgICAgICAgICAgdGhpcy5ncm91cEJ5KGV2cywgIl9lbnRpdHlPYmplY3QiKS5mb3JFYWNoKGV2ZyA9PiB7DQogICAgICAgICAgICAgICAgZXZnLmtleS5lbnRpdHlPYmplY3RfRW50aXR5VmFsdWVzKGV2Zy52YWx1ZXMpOw0KICAgICAgICAgICAgICAgIG9ianMucHVzaChldmcua2V5KTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBvYmpzLmZvckVhY2gociA9PiByLmVudGl0eUNsYXNzKHIuZW50aXR5T2JqZWN0X0VudGl0eVZhbHVlcygpWzBdLmVudGl0eUF0dHJpYnV0ZSgpLmVudGl0eUNsYXNzKCkpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgbGV0IHJldCA9IFtdOw0KICAgICAgICAgICAgZm9yIGF3YWl0IChjb25zdCByIG9mIG9ianMpew0KICAgICAgICAgICAgICAgIHJldC5wdXNoKGF3YWl0IG5ldyA8JT1zY29wZSU+W3IuZW50aXR5Q2xhc3MoKS5uYW1lKCldKCkuX2Zyb21FTVNPYmplY3QocikpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICA8JT1sb2coKSU+cmV0KTsNCiAgICAgICAgICAgIHJldHVybiByZXQ7DQogICAgICAgIH1jYXRjaChleCl7DQogICAgICAgICAgICA8JT1lcnJvcigpJT5leCk7DQogICAgICAgIH0NCiAgICA8JX1lbHNleyU+DQogICAgICAgIHJldHVybiBhd2FpdCBuZXcgPCU9c2NvcGUlPi48JT1uTmFtZShtYWluQ2xhc3MoWydFTVMnXSxjKSklPigpLjwlPW1OYW1lJT4oZXZzKTsNCiAgICA8JX0lPg0KICAgIH0NCiAgICANCiAgICA8JT1tTmFtZT0nX3RvRU1TQ2xhc3MnJT4oZGVwdGgpew0KICAgICAgICAvLyB3aHkgbm90IF9fZXhwb3J0ID8NCiAgICAgICAgdHJ5ew0KICAgICAgICAgICAgbGV0IHJldCA9IG5ldyA8JT1zY29wZSU+LkVudGl0eUNsYXNzKCc8JT1jLklkJT4nKS5uYW1lKCI8JT1jLk5hbWUlPiIpLmNvZGUoIjwlPW5OYW1lKGMpJT4iKS5hY3RpdmUodHJ1ZSkuZW5hYmxlZCh0cnVlKS5kYXRlKG5ldyBEYXRlKCkpLmNvbXBhbnkobmV3IDwlPXNjb3BlJT4uQ29tcGFueSgpLm5hbWUoIjwlPXNjb3BlJT4iKS5jb2RlKCI8JT1zY29wZSU+IikpLmVudGl0eU1vZHVsZShuZXcgPCU9c2NvcGUlPi5FbnRpdHlNb2R1bGUoKS5jb2RlKCI8JT1zY29wZSU+IikubmFtZSgiPCU9c2NvcGUlPiIpKTsNCiAgICAgICAgICAgIGlmKCFkZXB0aCkgcmV0dXJuIHJldDsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgcmV0LmVudGl0eUNsYXNzX0VudGl0eU1ldGhvZHMoWw0KICAgIDwlIGMuRW50aXR5TWV0aG9kcy5mb3JFYWNoKG0gPT4geyU+DQogICAgICAgICAgICAgICAgbmV3IDwlPXNjb3BlJT4uRW50aXR5TWV0aG9kKCc8JT1tLklkJT4nKS5hY3RpdmUodHJ1ZSkuZW5hYmxlZCh0cnVlKS5uYW1lKCI8JT1tLk5hbWUlPiIpLmNvZGUoIjwlPW5OYW1lKG0pJT4iKS5lbnRpdHlNZXRob2RfRW50aXR5QXR0cmlidXRlcyhbDQogICAgICAgIDwlIG0uTWV0aG9kUGFyYW1ldGVycy5mb3JFYWNoKHAgPT4geyU+DQogICAgICAgICAgICAgICAgICAgIG5ldyA8JT1zY29wZSU+LkVudGl0eUF0dHJpYnV0ZSgnPCU9cC5JZCU+JykuYWN0aXZlKHRydWUpLmVuYWJsZWQodHJ1ZSkubmFtZSgiPCU9cC5OYW1lJT4iKS5jb2RlKCI8JT1uTmFtZShwKSU+IikuaXNBcnJheSg8JT1wLklzQXJyYXk/J3RydWUnOidmYWxzZSclPikucmVtYXJrKCI8JT1jLk5hbWUlPi48JT1tLk5hbWUlPigpIikuZW50aXR5Q2xhc3MobmV3IDwlPXNjb3BlJT4uPCU9bk5hbWUoYywgdHJ1ZSklPigpLjwlPW1OYW1lJT4oKSkNCiAgICAgICAgICAgIDwlIGlmKHAuRW50aXR5VHlwZSl7JT4NCiAgICAgICAgICAgICAgICAgICAgLmVudGl0eVR5cGUobmV3IDwlPXNjb3BlJT4uPCU9bk5hbWUocC5FbnRpdHlUeXBlKSU+KCkuPCU9bU5hbWUlPihkZXB0aC0xKSkNCiAgICAgICAgICAgIDwlIH1lbHNleyU+DQogICAgICAgICAgICAgICAgICAgIC5pczwlPV9GckVNRC5fYXR0cihwKSU+KHRydWUpDQogICAgICAgICAgICA8JSB9JT4sDQogICAgICAgIDwlIH0pJT4NCiAgICAgICAgICAgICAgICBdKS5yZXNwb25zZUF0dHJpYnV0ZShuZXcgPCU9c2NvcGUlPi5FbnRpdHlBdHRyaWJ1dGUoJzwlPW0uUmVzcG9uc2VBdHRyaWJ1dGUuSWQlPicpLmFjdGl2ZSh0cnVlKS5lbmFibGVkKHRydWUpLm5hbWUoIjwlPW0uUmVzcG9uc2VBdHRyaWJ1dGUuTmFtZSU+IikuY29kZSgiPCU9bk5hbWUobS5SZXNwb25zZUF0dHJpYnV0ZSklPiIpLmVudGl0eUNsYXNzKG5ldyA8JT1zY29wZSU+LjwlPW5OYW1lKGMsIHRydWUpJT4oKS48JT1tTmFtZSU+KCkpDQogICAgICAgIDwlIGlmKG0uUmVzcG9uc2VBdHRyaWJ1dGUuRW50aXR5VHlwZSl7JT4NCiAgICAgICAgICAgICAgICAuZW50aXR5VHlwZShuZXcgPCU9c2NvcGUlPi48JT1uTmFtZShtLlJlc3BvbnNlQXR0cmlidXRlLkVudGl0eVR5cGUpJT4oKS48JT1tTmFtZSU+KGRlcHRoLTEpKQ0KICAgICAgICA8JSB9ZWxzZXslPg0KICAgICAgICAgICAgICAgIC5pczwlPV9GckVNRC5fYXR0cihtLlJlc3BvbnNlQXR0cmlidXRlKSU+KHRydWUpDQogICAgICAgIDwlIH0lPg0KICAgICAgICAgICAgICAgICksDQogICAgPCUgfSklPg0KICAgICAgICAgICAgXSkuZW50aXR5Q2xhc3NfRW50aXR5QXR0cmlidXRlcyhbDQogICAgPCUgYy5FbnRpdHlBdHRyaWJ1dGVzLmZpbHRlcihlYSA9PiAhZWEuRW50aXR5TWV0aG9kKS5mb3JFYWNoKGVhID0+IHslPg0KICAgICAgICAgICAgICAgIG5ldyA8JT1zY29wZSU+LkVudGl0eUF0dHJpYnV0ZSgnPCU9ZWEuSWQlPicpLmFjdGl2ZSh0cnVlKS5lbmFibGVkKHRydWUpLm5hbWUoIjwlPWVhLk5hbWUlPiIpLmNvZGUoIjwlPW5OYW1lKGVhKSU+IikucmVtYXJrKCc8JT1jLk5hbWUlPi48JT1lYS5OYW1lJT4nKQ0KICAgICAgICA8JSBpZihlYS5FbnRpdHlUeXBlKXslPg0KICAgICAgICAgICAgICAgIC5lbnRpdHlUeXBlKG5ldyA8JT1zY29wZSU+LjwlPW5OYW1lKGVhLkVudGl0eVR5cGUsIHRydWUpJT4oKS48JT1tTmFtZSU+KGRlcHRoLTEpKQ0KICAgICAgICA8JSB9ZWxzZXslPg0KICAgICAgICAgICAgICAgIC5pczwlPV9GckVNRC5fYXR0cihlYSklPih0cnVlKQ0KICAgICAgICA8JSB9JT4sDQogICAgPCUgfSklPg0KICAgICAgICAgICAgXSk7DQogICAgICAgICAgICA8JT1sb2coKSU+cmV0KTsNCiAgICAgICAgICAgIHJldHVybiByZXQ7DQogICAgICAgIH1jYXRjaChleCl7DQogICAgICAgICAgICA8JT1lcnJvcigpJT5leCk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBhc3luYyA8JT1tTmFtZT0nX2Zyb21FTVNPYmplY3QnJT4ob2JqKXsNCiAgICAgICAgdHJ5ew0KICAgICAgICAgICAgdGhpcy5JZCA9IG9iai5JZDsNCiAgICAgICAgICAgIGxldCBldiA9IG51bGw7DQogICAgPCUgYy5FbnRpdHlBdHRyaWJ1dGVzLmZpbHRlcihlYSA9PiAhZWEuRW50aXR5TWV0aG9kKS5mb3JFYWNoKGVhID0+IHslPg0KICAgICAgICAgICAgZXYgPSBvYmouZW50aXR5T2JqZWN0X0VudGl0eVZhbHVlcygpLmZpbmQoZXYgPT4gZXYuZW50aXR5QXR0cmlidXRlKCkuY29kZSgpPT08JT1fbkNvZGUoZWEpJT4pOw0KICAgICAgICA8JSBpZihlYS5FbnRpdHlUeXBlKXslPg0KICAgICAgICAgICAgaWYoZXYpIHRoaXMuPCU9bk5hbWUoZWEpJT4oYXdhaXQgbmV3IDwlPXNjb3BlJT4uPCU9bk5hbWUoZWEuRW50aXR5VHlwZSwgdHJ1ZSklPigpLjwlPW1OYW1lJT4oZXYub2JqZWN0VmFsdWUoKSkpOw0KICAgICAgICA8JSB9ZWxzZXslPg0KICAgICAgICAgICAgaWYoZXYpIHRoaXMuPCU9bk5hbWUoZWEpJT4oZXYuPCU9X0ZyRU1ELl9hdHRyKGVhKS50b0xvd2VyQ2FzZSgpJT5WYWx1ZSgpKTsNCiAgICAgICAgPCUgfSU+DQogICAgPCUgfSklPg0KICAgIDwlIGMuVHlwZWRBdHRyaWJ1dGVzLmZvckVhY2godGEgPT4geyBsZXQgdGFOYW1lID0gbk5hbWUodGEpICsgJ18nICsgdGEuRW50aXR5Q2xhc3MuUGx1cmFsLnJlcGxhY2UoLyAvZywgJ18nKTslPg0KICAgIDwlIH0pJT4NCiAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICB9Y2F0Y2goZXgpew0KICAgICAgICAgICAgPCU9ZXJyb3IoKSU+ZXgpOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgPCU9bU5hbWU9J190b0VNU09iamVjdCclPihiUXVlcnksIGJUeXBlZEF0dHJpYnV0ZXMpew0KICAgICAgICBsZXQgcmV0ID0gbmV3IDwlPXNjb3BlJT4uRW50aXR5T2JqZWN0KCkuYWN0aXZlKHRydWUpLmVudGl0eUNsYXNzKHRoaXMuX3RvRU1TQ2xhc3MoKSk7DQoNCiAgICAgICAgcmV0ID0gdGhpcy5fX2V4cG9ydChyZXQsIHsNCiAgICAgICAgICAgIEZ1bGw6ICFiUXVlcnksDQogICAgICAgICAgICAvL051bGw6ICFiUXVlcnksDQogICAgICAgICAgICBJZDogKG9iaiwgZWFDb2RlLCB2KSA9PiBvYmouSWQgPSB2LA0KICAgIDwlIGMuRW50aXR5QXR0cmlidXRlcy5maWx0ZXIoZWEgPT4gIWVhLkVudGl0eU1ldGhvZCkuZm9yRWFjaChlYSA9PiB7ICU+DQogICAgICAgICAgICAiPCU9bk5hbWUoZWEpJT4iOiAob2JqLCBlYUNvZGUsIHYpID0+IHsNCiAgICAgICAgICAgICAgICBsZXQgZXYgPSBuZXcgPCU9c2NvcGUlPi5FbnRpdHlWYWx1ZSgpLmFjdGl2ZSh0cnVlKS5lbnRpdHlBdHRyaWJ1dGUobmV3IDwlPXNjb3BlJT4uRW50aXR5QXR0cmlidXRlKCc8JT1lYS5JZCU+JykuYWN0aXZlKHRydWUpLmVuYWJsZWQodHJ1ZSkubmFtZSgiPCU9ZWEuTmFtZSU+IikuY29kZSgiPCU9bk5hbWUoZWEpJT4iKS5lbnRpdHlDbGFzcyh0aGlzLl90b0VNU0NsYXNzKCkpKTsNCiAgICAgICAgPCUgaWYoZWEuRW50aXR5VHlwZSl7JT4NCiAgICAgICAgICAgICAgICBldi5vYmplY3RWYWx1ZSh2P3YuPCU9bU5hbWUlPihiUXVlcnksIGJUeXBlZEF0dHJpYnV0ZXMpOm51bGwsIHRoaXMuXzwlPW5OYW1lKGVhKSU+X2Nvb3ApOw0KICAgICAgICA8JSB9ZWxzZXslPg0KICAgICAgICAgICAgICAgIGV2LjwlPV9GckVNRC5fYXR0cihlYSkudG9Mb3dlckNhc2UoKSU+VmFsdWUodiwgdGhpcy5fPCU9bk5hbWUoZWEpJT5fY29vcCk7DQogICAgICAgIDwlIH0lPg0KICAgICAgICAgICAgICAgIG9iai5lbnRpdHlPYmplY3RfRW50aXR5VmFsdWVzKGV2LCAnPT0nKTsNCiAgICAgICAgICAgIH0sDQogICAgPCUgfSk7ICU+DQogICAgPCUgYy5UeXBlZEF0dHJpYnV0ZXMuZm9yRWFjaCh0YSA9PiB7IGxldCB0YU5hbWUgPSBuTmFtZSh0YSkgKyAnXycgKyB0YS5FbnRpdHlDbGFzcy5QbHVyYWwucmVwbGFjZSgvIC9nLCAnXycpOyU+DQogICAgICAgICAgICA8JT10YU5hbWUlPjogKG9iaiwgZWFDb2RlLCB2KSA9PiB7DQogICAgICAgICAgICAgICAgaWYodiAmJiBiVHlwZWRBdHRyaWJ1dGVzKSBvYmoub2JqZWN0VmFsdWVfRW50aXR5VmFsdWVzKHYubWFwKF92ID0+IG5ldyA8JT1zY29wZSU+LkVudGl0eVZhbHVlKCkuYWN0aXZlKHRydWUpLmVudGl0eUF0dHJpYnV0ZShuZXcgPCU9c2NvcGUlPi5FbnRpdHlBdHRyaWJ1dGUoJzwlPXRhLklkJT4nKS5hY3RpdmUodHJ1ZSkuZW5hYmxlZCh0cnVlKS5jb2RlKCI8JT1uTmFtZSh0YSklPiIpLm5hbWUoIjwlPXRhLk5hbWUlPiIpLmVudGl0eUNsYXNzKG5ldyA8JT1zY29wZSU+LjwlPW5OYW1lKHRhLkVudGl0eUNsYXNzLCB0cnVlKSU+KCkuX3RvRU1TQ2xhc3MoKSkpLm9iamVjdFZhbHVlKF92LjwlPW1OYW1lJT4oYlF1ZXJ5LCBiVHlwZWRBdHRyaWJ1dGVzKSkpLCAnPT0nKTsNCiAgICAgICAgICAgIH0sDQogICAgPCUgfSklPg0KICAgICAgICB9LCAiPCU9bU5hbWUlPiIpOw0KDQogICAgICAgIDwlPWxvZygpJT5yZXQpOw0KICAgICAgICByZXR1cm4gcmV0Ow0KICAgIH0NCjwlIH0gJT4NCg0KPCUgaWYobWFpbkNsYXNzKFsnQklTZXJ2ZXInXSkpeyU+DQogICAgPCU9bU5hbWU9J19hc09iamVjdHMnJT4oZXZzKXsNCiAgICA8JSBpZihtYWluQ2xhc3MoWydCSVNlcnZlciddKSE9Yyl7JT4NCiAgICAgICAgICAgIHJldHVybiBuZXcgPCU9c2NvcGUlPi48JT1uTmFtZShtYWluQ2xhc3MoWydCSVNlcnZlciddLGMpKSU+KCkuPCU9bU5hbWUlPihldnMpOw0KICAgIDwlfWVsc2V7JT4NCiAgICAgICAgdHJ5ew0KICAgICAgICAgICAgaWYodHlwZW9mKGV2cyk9PT0idW5kZWZpbmVkIiB8fCAhZXZzIHx8ICFBcnJheS5pc0FycmF5KGV2cykgfHwgIWV2cy5sZW5ndGgpIHJldHVybiBbXTsNCg0KICAgICAgICAgICAgZXZzLmZvckVhY2goZXYgPT4gew0KICAgICAgICAgICAgICAgIGV2LkVudGl0eUF0dHJpYnV0ZSA9IDwlPXNjb3BlJT4uRW50aXR5QXR0cmlidXRlcy5maW5kKGVhID0+IGVhLklkPT1ldi5FbnRpdHlBdHRyaWJ1dGVpZCk7DQogICAgICAgICAgICAgICAgZXYuRW50aXR5T2JqZWN0LkVudGl0eUNsYXNzID0gZXYuRW50aXR5QXR0cmlidXRlLkVudGl0eUNsYXNzOw0KICAgICAgICAgICAgICAgIGlmKGV2Lk9iamVjdFZhbHVlKXsNCiAgICAgICAgICAgICAgICAgICAgZXYuT2JqZWN0VmFsdWUuRW50aXR5Q2xhc3MgPSA8JT1zY29wZSU+LkVudGl0eUNsYXNzZXMuZmluZChlYyA9PiBlYy5JZD09ZXYuT2JqZWN0VmFsdWUuRW50aXR5Q2xhc3MuSWQpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0pOw0KICAgIA0KICAgICAgICAgICAgbGV0IG9iaiA9IFtdOw0KICAgICAgICAgICAgdGhpcy5ncm91cEJ5KGV2cywgIkVudGl0eU9iamVjdCIpLmZvckVhY2goZXZnID0+IHsNCiAgICAgICAgICAgICAgICBsZXQgYyA9IG5ldyA8JT1zY29wZSU+W2V2Zy5rZXkuRW50aXR5Q2xhc3MuTmFtZS5yZXBsYWNlKC8gL2csICdfJyldKCk7DQogICAgICAgICAgICAgICAgYy5FbnRpdHlWYWx1ZXMgPSBldmcudmFsdWVzOw0KICAgICAgICAgICAgICAgIGMuVmFsdWVFbnRpdGllcyA9IFtdOw0KICAgICAgICAgICAgICAgIC8vIGMuRW50aXR5Q2xhc3MgPSBldmcua2V5LkVudGl0eUNsYXNzOw0KICAgICAgICAgICAgICAgIGMuSWQgPSBldmcua2V5LklkOw0KICAgICAgICAgICAgICAgIGV2Zy52YWx1ZXMuZm9yRWFjaCh2ID0+IHYuRW50aXR5T2JqZWN0ID0gYyk7DQogICAgICAgICAgICAgICAgb2JqLnB1c2goYyk7DQogICAgICAgICAgICB9KTsNCg0KICAgICAgICAgICAgZXZzLmZpbHRlcihldiA9PiBldi5PYmplY3RWYWx1ZSkuZm9yRWFjaChldiA9PiB7DQogICAgICAgICAgICAgICAgdmFyIF9mID0gb2JqLmZpbmQobyA9PiBvLklkID09IGV2Lk9iamVjdFZhbHVlLklkKTsNCiAgICAgICAgICAgICAgICBpZihfZikgX2YuVmFsdWVFbnRpdGllcy5wdXNoKGV2KTsNCiAgICAgICAgICAgICAgICBldi5PYmplY3RWYWx1ZSA9IF9mOw0KICAgICAgICAgICAgfSk7DQogICAgICAgIA0KICAgICAgICAgICAgbGV0IHJldCA9IFtdOw0KICAgICAgICAgICAgb2JqLmZvckVhY2gobyA9PiB7DQogICAgICAgICAgICAgICAgaWYoby5FbnRpdHlDbGFzcyAmJiBvLkVudGl0eUNsYXNzLklkIT10aGlzLkVudGl0eUNsYXNzLklkKSByZXR1cm4gdHJ1ZTsNCiAgICAgICAgICAgICAgICByZXQucHVzaChvKTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgDQogICAgICAgICAgICByZXR1cm4gcmV0Lm1hcChvID0+IG8uX3JldmVydCgpKTsNCiAgICAgICAgfWNhdGNoKGV4KXsNCiAgICAgICAgICAgIDwlPWVycm9yKCklPmV4KTsNCiAgICAgICAgfQ0KICAgIDwlfSU+DQogICAgfQ0KICAgIA0KICAgIDwlPW1OYW1lPSdfcmV2ZXJ0JyU+KGVvKSB7DQogICAgICAgIGlmIChlbykgew0KICAgICAgICAgICAgLy8gcmV2ZXJ0IGZyb20gc291cmNlIGRhdGENCiAgICAgICAgICAgIGlmKGVvLkVudGl0eUNsYXNzICYmICgodGhpcy5FbnRpdHlDbGFzcy5JZCAmJiBlby5FbnRpdHlDbGFzcy5JZCE9dGhpcy5FbnRpdHlDbGFzcy5JZCkgfHwgKHRoaXMuRW50aXR5Q2xhc3MuTmFtZSAmJiBlby5FbnRpdHlDbGFzcy5OYW1lIT10aGlzLkVudGl0eUNsYXNzLk5hbWUpKSl7DQogICAgICAgICAgICAgICAgPCU9ZXJyb3IoKSU+IkNhbm5vdCByZXZlcnQgIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuRW50aXR5Q2xhc3MpICsgIiBmcm9tICIgKyBlby5FbnRpdHlDbGFzcy5OYW1lLCBlbyk7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9DQogICAgICAgICAgICB0aGlzLklkID0gZW8uSWQ7DQogICAgICAgICAgICB0aGlzLkVudGl0eVZhbHVlcyA9IGVvLkVudGl0eVZhbHVlcyB8fCBbXTsNCiAgICAgICAgICAgIHRoaXMuVmFsdWVFbnRpdGllcyA9IGVvLlZhbHVlRW50aXRpZXMgfHwgW107DQogICAgICAgICAgICByZXR1cm4gdGhpcy48JT1tTmFtZSU+KCk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBpZih0aGlzLl9fc3luY19vbigpICYmIE1hdGguYWJzKChuZXcgRGF0ZSgpLmdldFRpbWUoKSAtIHRoaXMuX19zeW5jX29uKCkuZ2V0VGltZSgpKSAvIDEwMDApIDwgNSl7DQogICAgICAgICAgICAgICAgPCU9d2FybigpJT4iT2JqZWN0IGFscmVhZHkgcmV2ZXJ0ZWQiLCB0aGlzLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgdGhpcy5fX3N5bmNfb24obmV3IERhdGUoKSk7DQogICAgICAgIA0KICAgICAgICAgICAgLy8gdXNlIEVudGl0eVZhbHVlcyBhbmQgVmFsdWVFbnRpdGllcyB0byByZXZlcnQgdGhlIGF0dHJpYnV0ZSB2YWx1ZXMNCiAgICAgICAgICAgIHRoaXMuRW50aXR5VmFsdWVzLmZvckVhY2goZXYgPT4gew0KICAgICAgICAgICAgICAgIGxldCBlYSA9IG51bGw7DQogICAgICAgICAgICAgICAgdHJ5ew0KICAgICAgICAgICAgICAgICAgICBlYSA9IDwlPXNjb3BlJT4uRW50aXR5QXR0cmlidXRlcy5maWx0ZXIoX2VhID0+IF9lYS5FbnRpdHlDbGFzcy5OYW1lPT0nPCU9Yy5OYW1lJT4nKS5maW5kKF9lYSA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZihldi5FbnRpdHlBdHRyaWJ1dGVpZD09X2VhLklkKSByZXR1cm4gX2VhOw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYoZXYuRW50aXR5QXR0cmlidXRlKXsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihldi5FbnRpdHlBdHRyaWJ1dGUuSWQ9PV9lYS5JZCkgcmV0dXJuIF9lYTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihldi5FbnRpdHlBdHRyaWJ1dGUuTmFtZT09X2VhLk5hbWUpIHJldHVybiBfZWE7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICAgICAgaWYoIWVhKXsNCiAgICAgICAgICAgICAgICAgICAgICAgIDwlPXdhcm4oKSU+InVuYWJsZSB0byBkZXRlY3QgYXR0cmlidXRlIGZyb20gdmFsdWUiLCBldik7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH1jYXRjaChleCl7DQogICAgICAgICAgICAgICAgICAgIDwlPWVycm9yKCklPmV2LCBleCk7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBsZXQgdiA9IGV2Wyh0aGlzWyJfYXR0ciJdP3RoaXM6X0ZyRU1EKS5fYXR0cihlYSkgKyAiVmFsdWUiXTsNCiAgICAgICAgICAgICAgICBsZXQgcCA9IGVhLk5hbWUucmVwbGFjZSgvIC9nLCAnXycpOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIGlmKHR5cGVvZih0aGlzW3BdKSE9PSdmdW5jdGlvbicpew0KICAgICAgICAgICAgICAgICAgICA8JT13YXJuKCklPiJpbnZhbGlkIHR5cGUiLCBlYSwgcCwgdik7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgaWYodiAmJiBlYS5FbnRpdHlUeXBlICYmIHR5cGVvZih2KT09PSdvYmplY3QnKXsNCiAgICAgICAgICAgICAgICAgICAgPCU9bG9nKCklPiJyZXZlcnRpbmcgIiArIGVhLk5hbWUsIHYsIG5ldyA8JT1zY29wZSU+W2VhLkVudGl0eVR5cGUuTmFtZS5yZXBsYWNlKC8gL2csICdfJyldKCkuPCU9bU5hbWUlPih2KSk7DQogICAgICAgICAgICAgICAgICAgIGlmKCF2LkVudGl0eVZhbHVlcyl7DQogICAgICAgICAgICAgICAgICAgICAgICA8JT13YXJuKCklPiJlbXB0eSB2YWx1ZXMgZm9yICIgKyBlYS5OYW1lLCB2KTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB2ID0gdi48JT1tTmFtZSU+P3YuPCU9bU5hbWUlPigpOm5ldyA8JT1zY29wZSU+W2VhLkVudGl0eVR5cGUuTmFtZS5yZXBsYWNlKC8gL2csICdfJyldKCkuPCU9bU5hbWUlPih2KTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgdGhpc1twXSh2KTsNCiAgICAgICAgICAgIH0pOw0KDQogICAgICAgICAgICB0aGlzLlZhbHVlRW50aXRpZXMuZmlsdGVyKHZlID0+IHZlLkVudGl0eUF0dHJpYnV0ZSkuZm9yRWFjaCh2ZSA9PiB7DQogICAgICAgICAgICAgICAgdmFyIHRhID0gPCU9c2NvcGUlPi5FbnRpdHlBdHRyaWJ1dGVzLmZpbmQoZWEgPT4gZWEuSWQ9PXZlLkVudGl0eUF0dHJpYnV0ZS5JZCk7DQogICAgICAgICAgICAgICAgaWYoIXRhKSByZXR1cm4gbnVsbDsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICB2YXIgdGFOYW1lID0gdGEuRW50aXR5Q2xhc3MuUGx1cmFsLnJlcGxhY2UoLyAvZywgJ18nKTsNCg0KICAgICAgICAgICAgICAgIGxldCB2ID0gdmUuRW50aXR5T2JqZWN0Ow0KICAgICAgICAgICAgICAgIGlmKHYpew0KICAgICAgICAgICAgICAgICAgICB2ID0gdi48JT1tTmFtZSU+P3YuPCU9bU5hbWUlPigpOm5ldyA8JT1zY29wZSU+W3RhLkVudGl0eVR5cGUuTmFtZS5yZXBsYWNlKC8gL2csICdfJyldKCkuPCU9bU5hbWUlPih2KTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgdGhpc1t0YS5OYW1lLnJlcGxhY2UoLyAvZywgIl8iKSArICJfIiArIHRhTmFtZV0odik7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICB9DQogICAgDQogICAgPCU9bU5hbWU9J192YWx1ZUNsYXNzJyU+KCl7DQogICAgICAgIGxldCBfY2xhc3MgPSB7QWN0aXZlOiB0cnVlfTsNCiAgICAgICAgaWYodGhpcy5FbnRpdHlDbGFzcy5FbnRpdHlNb2R1bGUpew0KICAgICAgICAgICAgX2NsYXNzLkVudGl0eU1vZHVsZSA9IHRoaXMuRW50aXR5Q2xhc3MuRW50aXR5TW9kdWxlOw0KICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgIF9jbGFzcyA9IHsNCiAgICAgICAgICAgICAgICBBY3RpdmU6IHRydWUsDQogICAgICAgICAgICAgICAgQ29tcGFueToge0FjdGl2ZTogdHJ1ZSwgRW5hYmxlZDogdHJ1ZSwgRW50aXR5Q2xhc3NlczogW3RoaXMuRW50aXR5Q2xhc3NdfQ0KICAgICAgICAgICAgfTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gX2NsYXNzOw0KICAgIH0NCg0KICAgIDwlPW1OYW1lPSdfdG9YTUwnJT4oKXsNCiAgICAgICAgLy8gYW4gb3ZlcmxvYWQgb2YgdGhlIHNyLl90b1hNTA0KICAgICAgICBsZXQgcmV0ID0ge3htbDogYGB9Ow0KICAgICAgICByZXQgPSB0aGlzLl9fZXhwb3J0KHJldCwgew0KICAgICAgICAgICAgSWQ6IChvYmosIGVhQ29kZSwgdikgPT4gcmV0LnhtbCArPSBgPCR7dGhpcy5fX2NvbmZpZygnaWRGaWVsZCcpfHwnSWQnfT4ke3Z9PC8ke3RoaXMuX19jb25maWcoJ2lkRmllbGQnKXx8J0lkJ30+YCwNCiAgICA8JSBjLkVudGl0eUF0dHJpYnV0ZXMuZmlsdGVyKGVhID0+ICFlYS5FbnRpdHlNZXRob2QpLmZvckVhY2goZWEgPT4geyAlPg0KICAgICAgICAgICAgIjwlPW5OYW1lKGVhKSU+IjogKG9iaiwgZWFDb2RlLCB2KSA9PiB7DQogICAgICAgICAgICAgICAgcmV0LnhtbCArPSBgPCR7ZWFDb2RlfT5gOw0KICAgICAgICA8JSBpZihlYS5FbnRpdHlUeXBlKXslPg0KICAgICAgICAgICAgICAgIHJldC54bWwgKz0gdj92LjwlPW1OYW1lJT4oKTpudWxsOw0KICAgICAgICA8JSB9ZWxzZXslPg0KICAgICAgICAgICAgICAgIHJldC54bWwgKz0gYDwhW0NEQVRBWyR7dn1dXT5gOw0KICAgICAgICA8JSB9JT4NCiAgICAgICAgICAgICAgICByZXQueG1sICs9IGA8LyR7ZWFDb2RlfT5gOw0KICAgICAgICAgICAgfSwNCiAgICA8JSB9KTsgJT4NCiAgICA8JSBjLlR5cGVkQXR0cmlidXRlcy5mb3JFYWNoKHRhID0+IHsgbGV0IHRhTmFtZSA9IG5OYW1lKHRhKSArICdfJyArIHRhLkVudGl0eUNsYXNzLlBsdXJhbC5yZXBsYWNlKC8gL2csICdfJyk7JT4NCiAgICAgICAgICAgIDwlPXRhTmFtZSU+OiAob2JqLCBlYUNvZGUsIHYpID0+IHsNCiAgICAgICAgICAgICAgICByZXQueG1sICs9IGA8JHtlYUNvZGV9PmAgKyB2Lm1hcChfdiA9PiAnPE9iamVjdD4nICsgX3YuPCU9bU5hbWUlPigpICsgIjwvT2JqZWN0PiIpLmpvaW4oJycpICsgYDwvJHtlYUNvZGV9PmA7DQogICAgICAgICAgICB9LA0KICAgIDwlIH0pJT4NCiAgICAgICAgfSwgIjwlPW1OYW1lJT4iKTsNCg0KICAgICAgICA8JT1sb2coKSU+cmV0KTsNCiAgICAgICAgcmV0dXJuIHJldC54bWw7DQogICAgfQ0KDQogICAgPCU9bU5hbWU9J19idWlsZFRoaXMnJT4oZGVwdGg9MSl7DQogICAgICAgIC8vIGNhbmRpZGF0ZSBmb3IgX19leHBvcnQNCiAgICAgICAgdmFyIHJldCA9IFt7DQogICAgICAgICAgICBBY3RpdmU6IHRydWUsDQogICAgICAgICAgICBFbnRpdHlBdHRyaWJ1dGU6IHtBY3RpdmU6IHRydWUsIEVudGl0eUNsYXNzOiB0aGlzLl92YWx1ZUNsYXNzKCl9LA0KICAgICAgICAgICAgRW50aXR5T2JqZWN0OiB0aGlzLnRvRW50aXR5T2JqZWN0KHRydWUpLA0KICAgICAgICB9XTsNCiAgICAgICAgZm9yICh2YXIgaSA9IDE7IGkgPD0gZGVwdGg7IGkrKykgew0KICAgICAgICAgICAgcmV0LnB1c2goew0KICAgICAgICAgICAgICAgIEFjdGl2ZTogdHJ1ZSwNCiAgICAgICAgICAgICAgICBFbnRpdHlPYmplY3Q6IHsNCiAgICAgICAgICAgICAgICAgICAgQWN0aXZlOiB0cnVlLA0KICAgICAgICAgICAgICAgICAgICBWYWx1ZUVudGl0aWVzOiBbcmV0W2kgLSAxXV0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KICAgICAgICANCjwlIGMuVHlwZWRBdHRyaWJ1dGVzLmZpbHRlcih0YSA9PiAhdGEuRW50aXR5TWV0aG9kKS5mb3JFYWNoKHRhID0+IHslPg0KICAgICAgICBpZihkZXB0aD4xKXsNCiAgICAgICAgICAgIGxldCB2ID0gbmV3IDwlPXNjb3BlJT4uPCU9bk5hbWUodGEuRW50aXR5Q2xhc3MsIHRydWUpJT4oKS48JT1uTmFtZSh0YSklPih0aGlzKTsNCiAgICAgICAgICAgIHJldC5wdXNoKHsNCiAgICAgICAgICAgICAgICBBY3RpdmU6IHRydWUsDQogICAgICAgICAgICAgICAgRW50aXR5T2JqZWN0OiB2P3YudG9FbnRpdHlPYmplY3QodHJ1ZSk6bnVsbCwNCiAgICAgICAgICAgIH0pOw0KICAgIA0KICAgICAgICAgICAgcmV0LnB1c2goew0KICAgICAgICAgICAgICAgIEVudGl0eU9iamVjdDogew0KICAgICAgICAgICAgICAgICAgICBBY3RpdmU6IHRydWUsDQogICAgICAgICAgICAgICAgICAgIFZhbHVlRW50aXRpZXM6IFt7DQogICAgICAgICAgICAgICAgICAgICAgICBBY3RpdmU6IHRydWUsDQogICAgICAgICAgICAgICAgICAgICAgICBFbnRpdHlPYmplY3Q6IHY/di50b0VudGl0eU9iamVjdCh0cnVlKTpudWxsLA0KICAgICAgICAgICAgICAgICAgICB9XQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9DQo8JSB9KSU+DQogICAgICAgIA0KICAgICAgICByZXR1cm4gcmV0Ow0KICAgIH0NCiAgICANCiAgICA8JT1tTmFtZT0ndG9FbnRpdHlPYmplY3QnJT4oYlF1ZXJ5LCBiVHlwZWRBdHRyaWJ1dGVzKSB7DQogICAgICAgIGxldCByZXQgPSB7QWN0aXZlOiB0cnVlLCBFbnRpdHlDbGFzczogdGhpcy5fdmFsdWVDbGFzcygpLCBFbnRpdHlWYWx1ZXM6IFtdLCBWYWx1ZUVudGl0aWVzOiBbXX07DQogICAgICAgIGlmKCFiUXVlcnkpIHJldC5EYXRlID0gdGhpcy5zZXJ2ZXJEYXRlKCk7IA0KDQogICAgICAgIHJldCA9IHRoaXMuX19leHBvcnQocmV0LCB7DQogICAgICAgICAgICBGdWxsOiAhYlF1ZXJ5LA0KICAgICAgICAgICAgSWQ6IChvYmosIGVhQ29kZSwgdikgPT4gb2JqLklkID0gdiwNCiAgICA8JSBjLkVudGl0eUF0dHJpYnV0ZXMuZmlsdGVyKGVhID0+ICFlYS5FbnRpdHlNZXRob2QpLmZvckVhY2goZWEgPT4geyAlPg0KICAgICAgICAgICAgIjwlPW5OYW1lKGVhKSU+IjogKG9iaiwgZWFDb2RlLCB2KSA9PiB7DQogICAgICAgICAgICAgICAgbGV0IGV2ID0gew0KICAgICAgICAgICAgICAgICAgICBBY3RpdmU6IHRydWUsDQogICAgICAgICAgICAgICAgICAgIEVudGl0eUF0dHJpYnV0ZTogew0KICAgICAgICAgICAgICAgICAgICAgICAgSWQ6IDwlPXNjb3BlJT4uRW50aXR5Q2xhc3Nlcy5maW5kKGMgPT4gYy5JZCA9IHRoaXMuRW50aXR5Q2xhc3MuSWQpLkVudGl0eUF0dHJpYnV0ZXMuZmluZChlYSA9PiBlYS5OYW1lPT0nPCU9ZWEuTmFtZSU+JykuSWQsDQogICAgICAgICAgICAgICAgICAgICAgICBBY3RpdmU6IHRydWUsDQogICAgICAgICAgICAgICAgICAgICAgICBOYW1lOiAiPCU9ZWEuTmFtZSU+IiwNCiAgICAgICAgICAgICAgICAgICAgICAgIEVudGl0eUNsYXNzOiB0aGlzLl92YWx1ZUNsYXNzKCksDQogICAgICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgICAgIE9QRVJBVE9SUzoge30sDQogICAgICAgICAgICAgICAgfTsNCiAgICAgICAgPCUgaWYoZWEuRW50aXR5VHlwZSl7JT4NCiAgICAgICAgICAgICAgICBpZih2KXsNCiAgICAgICAgICAgICAgICAgICAgZXYuT2JqZWN0VmFsdWUgPSB2LjwlPW1OYW1lJT4oYlF1ZXJ5LCBiVHlwZWRBdHRyaWJ1dGVzKTsNCiAgICAgICAgICAgICAgICAgICAgZXYuT1BFUkFUT1JTLk9iamVjdFZhbHVlID0gdGhpcy5fPCU9bk5hbWUoZWEpJT5fY29vcDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIDwlIH1lbHNleyU+DQogICAgICAgICAgICAgICAgZXYuPCU9X0ZyRU1ELl9hdHRyKGVhKSU+VmFsdWUgPSB2Ow0KICAgICAgICAgICAgICAgIGV2Lk9QRVJBVE9SUy48JT1fRnJFTUQuX2F0dHIoZWEpJT5WYWx1ZSA9IHRoaXMuXzwlPW5OYW1lKGVhKSU+X2Nvb3A7DQogICAgICAgIDwlIH0lPg0KICAgICAgICAgICAgICAgIG9iai5WYWx1ZUVudGl0aWVzLnB1c2goZXYpOw0KICAgICAgICAgICAgfSwNCiAgICA8JSB9KTsgJT4NCiAgICA8JSBjLlR5cGVkQXR0cmlidXRlcy5mb3JFYWNoKHRhID0+IHsgbGV0IHRhTmFtZSA9IG5OYW1lKHRhKSArICdfJyArIHRhLkVudGl0eUNsYXNzLlBsdXJhbC5yZXBsYWNlKC8gL2csICdfJyk7JT4NCiAgICAgICAgICAgIDwlPXRhTmFtZSU+OiAob2JqLCBlYUNvZGUsIHYpID0+IHsNCiAgICAgICAgICAgICAgICBpZih2ICYmIGJUeXBlZEF0dHJpYnV0ZXMpIG9iai5FbnRpdHlWYWx1ZXMucHVzaCh2Lm1hcChfdiA9PiAoew0KICAgICAgICAgICAgICAgICAgICBBY3RpdmU6IHRydWUsDQogICAgICAgICAgICAgICAgICAgIEVudGl0eUF0dHJpYnV0ZTogew0KICAgICAgICAgICAgICAgICAgICAgICAgSWQ6ICc8JT10YS5JZCU+JywNCiAgICAgICAgICAgICAgICAgICAgICAgIEFjdGl2ZTogdHJ1ZSwNCiAgICAgICAgICAgICAgICAgICAgICAgIE5hbWU6ICI8JT10YS5OYW1lJT4iLA0KICAgICAgICAgICAgICAgICAgICAgICAgRW50aXR5Q2xhc3M6IG5ldyA8JT1zY29wZSU+LjwlPW5OYW1lKHRhLkVudGl0eUNsYXNzLCB0cnVlKSU+KCkuX3ZhbHVlQ2xhc3MoKSwNCiAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAgICAgT2JqZWN0VmFsdWU6IF92LjwlPW1OYW1lJT4oYlF1ZXJ5LCBiVHlwZWRBdHRyaWJ1dGVzKSwNCiAgICAgICAgICAgICAgICB9KSkpOw0KICAgICAgICAgICAgfSwNCiAgICA8JSB9KSU+DQogICAgICAgIH0sICI8JT1tTmFtZSU+Iik7DQoNCiAgICAgICAgPCU9bG9nKCklPnJldCk7DQogICAgICAgIHJldHVybiByZXQ7DQogICAgfQ0KPCUgfSAlPg0KfQ0K",
	"Name": "RW50aXR5Q2xhc3M=",
	"Script": "PCUNCmxldCBhdXRoQ2xhc3MgPSBhckNsYXNzZXMuZmluZChfYyA9PiBfYy5FbnRpdHlNZXRob2RzLmZpbmQobSA9PiBtLk5hbWU9PSdhdXRob3JpemUnICYmIG0uSXNQdWJsaWMpKTsNCmxldCBlbXMgPSBhckNsYXNzZXMuZmluZChfYyA9PiBfYy5OYW1lPT0nRW50aXR5Q2xhc3MnKTsNCg0KLy8gdGhlIGRlZmF1bHQgU2V0X09uIGRhdGUgdG8gdXNlDQpsZXQgU2V0X09uID0gYG5ldyBEYXRlKClgOw0KDQpsZXQgX2I2NHRlc3QgPSBzID0+IHR5cGVvZihzKT09PSd1bmRlZmluZWQnPycnOmAvXihbMC05YS16QS1aK1wvXXs0fSkqKChbMC05YS16QS1aK1wvXXsyfT09KXwoWzAtOWEtekEtWitcL117M309KSk/JC8udGVzdCh0eXBlb2YoKCR7c318fCcnKS5zdWJzdHJpbmcpIT09J3VuZGVmaW5lZCc/JHtzfTonJylgOw0KDQpsZXQgX2RlZiA9IChzLCB2KSA9PiAlPjwlPXMlPiA9IHR5cGVvZig8JT1zJT4pIT09J3VuZGVmaW5lZCc/PCU9cyU+OjwlPXYlPjs8JQ0KDQpsZXQgX2RlZmF1bHRzID0gKG9iaj0ndGhpcycsIF9jPWMpID0+IF9jLkVudGl0eUF0dHJpYnV0ZXMuZmlsdGVyKGVhID0+ICFlYS5FbnRpdHlNZXRob2QgJiYgZWEuRGVmYXVsdCkuZm9yRWFjaChlYSA9PiB7JT4NCiAgICAgICAgICAgIGlmKCE8JT1vYmolPi5fPCU9bk5hbWUoZWEpJT5fc2V0KXsNCiAgICAgICAgICAgICAgICA8JT1vYmolPi48JT1uTmFtZShlYSklPig8JXZhbHVlT2YoZWEuRGVmYXVsdCklPik7DQogICAgICAgICAgICB9DQo8JSB9KTsNCg0KbGV0IGxvZyA9IChuLCBfdGhpcz0ndGhpcycpID0+IGAke190aGlzfS5sb2cobnVsbCwgdW5kZWZpbmVkLCAnJHtuIHx8IG1OYW1lfScsICdFbnRpdHlPYmplY3QnLCAwLCBgOw0KbGV0IHdhcm4gPSAobiwgX3RoaXM9J3RoaXMnKSA9PiBgJHtfdGhpc30ubG9nKG51bGwsIHVuZGVmaW5lZCwgJyR7biB8fCBtTmFtZX0nLCAnRW50aXR5T2JqZWN0JywgMSwgYDsNCmxldCBlcnJvciA9IChuLCBfdGhpcz0ndGhpcycpID0+IGAke190aGlzfS5sb2cobnVsbCwgdW5kZWZpbmVkLCAnJHtuIHx8IG1OYW1lfScsICdFbnRpdHlPYmplY3QnLCAyLCBgOw0KDQpsZXQgcWxUeXBlID0gKGVhLCBiSW5wdXQpID0+IHsNCiAgICBpZihlYS5Jc0Jvb2wpIHJldHVybiAnQm9vbGVhbic7DQogICAgLy9pZihlYS5Jc0RhdGUpIHJldHVybiAnRGF0ZVRpbWUnOw0KICAgIGlmKGVhLklzSW50IHx8IGVhLklzRmxvYXQpIHJldHVybiAnSW50JzsNCiAgICBpZihlYS5FbnRpdHlUeXBlKSByZXR1cm4gbk5hbWUoZWEuRW50aXR5VHlwZSkrKGJJbnB1dD8iSW5wdXQiOiIiKTsNCiAgICByZXR1cm4gJ1N0cmluZyc7DQp9Ow0KDQovLyB3aHkgaGFyZCBjb2RlZD8/Pw0KbGV0IF9yZXN0VG9vbHMgPSBbJ1NlcnZpY2VOb3cnLCAnU2FsZXNGb3JjZScsICdSZXN0REJJTycsICdHaXRIdWInLCAnRmlsZVN5c3RlbSddOw0KbGV0IF9zcWxUb29scyA9IFsnU3FsREInLCAnU2FsZXNGb3JjZScsICdTbm93Rmxha2UnXTsNCmxldCBfZmlsZVRvb2xzID0gWydHaXRIdWInLCAnRmlsZVN5c3RlbSddOw0KDQpsZXQgY2xzVG9vbHMgPSBfYyA9PiBfYy5Ub29scy5tYXAodCA9PiB0LnR5cGU/dC50eXBlLm5hbWU6KHQubmFtZSB8fCB0KSk7DQpsZXQgbWFpbkNsYXNzID0gKF9hclRvb2xzLCBfYz1jKSA9PiBhckNsYXNzZXMuZmluZChfX2MgPT4gKF9hclRvb2xzIHx8IGNsc1Rvb2xzKF9jKSkuZmluZCh0ID0+IGNsc1Rvb2xzKF9fYykuaW5jbHVkZXModCkpKSB8fCAoIShfYXJUb29scyB8fCBjbHNUb29scyhfYykpLmxlbmd0aCAmJiBhckNsYXNzZXNbMF0pOw0KDQpsZXQgX2VhVHlwZXMgPSAoX2M9YywgYkFsbCkgPT4gX0ZyRU1ELl90b0pTKE9iamVjdC5hc3NpZ24oe30sIC4uLl9jLkVudGl0eUF0dHJpYnV0ZXMuZmlsdGVyKGVhID0+ICFlYS5FbnRpdHlNZXRob2QgJiYgYkFsbD90cnVlOmVhLkVudGl0eVR5cGUpLm1hcChlYSA9PiAoe1tuTmFtZShlYSldOiBuTmFtZShlYS5FbnRpdHlUeXBlKSB8fCBfRnJFTUQuX2F0dHIoZWEpfSkpKSk7DQoNCmxldCBfY0ZpZWxkID0gKGVhLCBfYz1lYS5FbnRpdHlDbGFzcykgPT4gKChlYS5FbnRpdHlUeXBlPyhlYS5FbnRpdHlUeXBlLlR5cGVkQXR0cmlidXRlcy5maW5kKHRhID0+IHRhLkVudGl0eUNsYXNzPT1fYykgfHwgZWEuRW50aXR5Q2xhc3MuRW50aXR5QXR0cmlidXRlcy5maW5kKF9lYSA9PiBfZWEuRW50aXR5VHlwZT09X2MpKTpudWxsKSB8fCB7TmFtZTogIiJ9KS5OYW1lOw0KDQpsZXQgX2NOYW1lID0gKGNuPWMuTmFtZSwgYkFsaWFzKSA9PiB7DQogICAgaWYoY24uTmFtZSkgY24gPSBjbi5OYW1lOw0KICAgIGxldCBfYyA9IGFyQ2xhc3Nlcy5maW5kKGVjID0+IGVjLk5hbWU9PWNuKTsNCiAgICBpZighX2MpIHJldHVybiAnJzsNCiAgICByZXR1cm4gbk5hbWUoX2MsIGJBbGlhcyk7DQp9Ow0KDQpsZXQgYWxpYXMgPSAoY24sIGo9Jy4nKSA9PiAoc2NvcGUgKyAnLicgKyBfY05hbWUoY24sIHRydWUpLnJlcGxhY2UoX2NOYW1lKGNuKSwgJycpKS5zcGxpdCgnLicpLmZpbHRlcihuID0+IG4pLmpvaW4oaik7DQpsZXQgbnNjb3BlID0gYWxpYXMoJ05vZGUnKTsNCg0KbGV0IF92Q29kZSA9IGsgPT4geyU+KDwldmFsdWVPZihrLkNvZGUpJT4gfHwgKCI8JT1uQ29kZShrKSU+IikpPCV9Ow0KbGV0IF9uQ29kZSA9IChlYSwgYlR5cGVkKSA9PiBlYT8oInRoaXMuX25Db2RlKCciICsgbkNvZGUoZWEpICsgKGJUeXBlZD8oJ18nICsgZWEuRW50aXR5Q2xhc3MuUGx1cmFsLnJlcGxhY2UoLyAvZywgJ18nKSk6IiIpICArICInLCAiICsgKGJUeXBlZD9udWxsOl9GckVNRC5fdG9KUyhlYS5Db2RlKSkgKyAiKSIpOiJ0aGlzLl9uQ29kZSgpIjsNCmxldCBtUm91dGluZyA9IChjLCBtKSA9PiB7DQogICAgaWYgKCFjICYmIG0pIGMgPSBtLkVudGl0eUNsYXNzOw0KICAgIGlmICghbSAmJiAhYykgcmV0dXJuICIiOw0KICAgIGlmICghbSkgbSA9IGM7DQogICAgaWYgKCFtLlJvdXRpbmcgJiYgIWMuUm91dGluZykgcmV0dXJuICIiOw0KDQolPihfbm9kZSwgbWV0aG9kKSA9PiB7DQogICAgCWxldCBsb2cgPSAob2JqLCAuLi5tc2cpID0+IHRoaXMubG9nKCI8JT1uTmFtZShjKSU+Iiwgb2JqLCAiPCVtP20uTmFtZTonJyU+IiB8fCBtZXRob2QsICJSb3V0ZXIiLCAwLCAuLi5tc2cpOw0KICAgIAlsZXQgd2FybiA9IChvYmosIC4uLm1zZykgPT4gdGhpcy5sb2coIjwlPW5OYW1lKGMpJT4iLCBvYmosICI8JW0/bS5OYW1lOicnJT4iIHx8IG1ldGhvZCwgIlJvdXRlciIsIDEsIC4uLm1zZyk7DQogICAgCWxldCBlcnJvciA9IChvYmosIC4uLm1zZykgPT4gdGhpcy5sb2coIjwlPW5OYW1lKGMpJT4iLCBvYmosICI8JW0/bS5OYW1lOicnJT4iIHx8IG1ldGhvZCwgIlJvdXRlciIsIDIsIC4uLm1zZyk7DQogICAgCWxldCBvU2NvcGUgPSA8JT1hbGlhcygpJT47DQogICAgCWxldCBwU2NvcGUgPSA8JT1zY29wZSU+Ow0KICAgIAlsZXQgblNjb3BlID0gPCU9bnNjb3BlJT47DQoNCiAgICAgICAgdHJ5ew0KICAgICAgICA8JWZ1bmN0aW9uT2YobS5Sb3V0aW5nKSU+DQogICAgICAgIH1jYXRjaChleCl7DQogICAgICAgICAgICB3YXJuKGV4KTsNCiAgICAgICAgfQ0KfQ0KPCV9Ow0KDQpsZXQgbU5hbWUgPSAnJzsNCg0KbGV0IGZ1bmN0aW9uT2YgPSAoZnVuLCBfdGhpcz0ndGhpcycpID0+IHslPg0KICAgICAgICBsZXQgX19yZXQgPSB1bmRlZmluZWQ7DQogICAgPCUgaWYoZnVuKXslPg0KICAgICAgICA8JSBpZih0eXBlb2YoZnVuKT09PSdvYmplY3QnKXslPg0KICAgICAgICAgICAgPCUgY2xzVG9vbHMoYykuZm9yRWFjaCh0ID0+IHslPg0KICAgICAgICBpZig8JT1fdGhpcyU+LlRvb2wgJiYgPCU9X3RoaXMlPi5Ub29sLnR5cGUubmFtZT09IjwlPXQlPiIpew0KICAgICAgICAgICAgICAgIDwlIGlmKHR5cGVvZihmdW5bdF0pPT09J2Z1bmN0aW9uJyl7JT4NCiAgICAgICAgICAgIF9fcmV0ID0gPCU9ZnVuW3RdJT47DQogICAgICAgICAgICAgICAgPCUgfWVsc2V7JT4NCiAgICAgICAgICAgIF9fcmV0ID0gPCU9KEpTT04uc3RyaW5naWZ5KGZ1blt0XSkgfHwgJyIiJyklPjsNCiAgICAgICAgICAgICAgICA8JSB9JT4NCiAgICAgICAgfQ0KICAgICAgICAgICAgPCUgfSklPg0KICAgICAgICA8JSB9ZWxzZXslPg0KICAgICAgICAgICAgX19yZXQgPSA8JT1mdW4lPjsNCiAgICAgICAgPCUgfSU+DQogICAgPCUgfSU+DQogICAgICAgIGlmKHR5cGVvZihfX3JldCk9PT0nc3RyaW5nJyAmJiBfX3JldC5zdGFydHNXaXRoKCJzKCIpICYmIF9fcmV0LmVuZHNXaXRoKCIpIikpew0KICAgICAgICAgICAgX19yZXQgPSB0aGlzLnJ1blNjcmlwdChfX3JldC5zbGljZSgyLC0xKSk7DQogICAgICAgIH0NCiAgICAgICAgaWYodHlwZW9mKF9fcmV0KT09PSJmdW5jdGlvbiIpew0KICAgICAgICAgICAgX19yZXQgPSBfX3JldCg8JT1fdGhpcyU+KTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gX19yZXQ7DQo8JX07DQoNCmxldCB2YWx1ZU9mID0gKGZ1biwgX3RoaXM9J3RoaXMnKSA9PiB7JT4oKA0KKG9TY29wZSkgPT4gew0KICAgIHRyeXsNCjwlZnVuY3Rpb25PZihmdW4sIF90aGlzKSU+DQogICAgfWNhdGNoKF92T2ZFeCl7DQogICAgICAgIDwlPXdhcm4oKSU+J3ZhbHVlT2YnLCBfdk9mRXgsIDwlPV9GckVNRC5fdG9KUyhmdW4pJT4pOw0KICAgIH0NCn0NCikoPCU9YWxpYXMoKSU+KSk8JX07DQoNCmxldCB1blJlY3Vyc2UgPSAob2JqLCBmdW4sIGZBcmdzPSdhcmd1bWVudHMnLCBzUmV0LCB2YWxpZGl0eT1gdGhpcy5fX2NvbmZpZygndW5SZWN1cnNlLnZhbGlkaXR5JywgMC41KWAsIGlkZikgPT4gew0KICAgIGlkZiA9IGlkZiB8fCBgKHRoaXM/dGhpcy5fX2NvbmZpZygnaWRGaWVsZCcsICdJZCcpOidJZCcpYDsNCiAgICBmdW4gPSBmdW4gfHwgYCIke21OYW1lfSJgOw0KICAgIHNSZXQgPSBgDQogICAgICAgIHRyeXsNCiAgICAgICAgICAgIGlmKHYpew0KICAgICAgICAgICAgICAgIHYuZGF0ZSA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpOw0KICAgICAgICAgICAgICAgIHYucmV1c2VkKys7DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgICR7c1JldH0NCiAgICAgICAgfWNhdGNoKHNSZXRfZXgpew0KICAgICAgICAgICAgdGhpcy5sb2cobnVsbCwgdW5kZWZpbmVkLCAke2Z1bn0sICcke21OYW1lfS51blJlY3Vyc2UnLCAxLCAnc1JldCcsIHNSZXRfZXgpOw0KICAgICAgICB9ZmluYWxseXsNCiAgICAgICAgICAgIGlmKHYgJiYgdi5yZXVzZWQ+MSkgcmV0dXJuIHY/di5vYmo6djsNCiAgICAgICAgfQ0KICAgIGA7DQogICAgbGV0IGJEYW5nZXIgPSAoKSA9PiAlPihbIl90b0hhc2giXS5pbmRleE9mKDwlPWZ1biU+KT49MCk8JTsNCiU+DQogICAgICAgIGxldCB2ID0gdW5kZWZpbmVkOw0KICAgICAgICB0cnl7DQogICAgICAgICAgICA8JT1zY29wZSU+LnVuUmVjdXJzZUFib3J0ID0gPCU9c2NvcGUlPi51blJlY3Vyc2VBYm9ydCB8fCB7fTsNCiAgICAgICAgICAgIGlmKDwlPXNjb3BlJT4udW5SZWN1cnNlQWJvcnRbPCU9ZnVuJT5dKXsNCiAgICAgICAgICAgICAgICA8JT13YXJuKGAke21OYW1lfS51blJlY3Vyc2VgKSU+YEFib3J0aW5nIGFzIHBlciA8JT1zY29wZSU+LnVuUmVjdXJzZUFib3J0LiR7PCU9ZnVuJT59YCk7DQogICAgICAgICAgICAgICAgPCU9c1JldCU+DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGxldCBfaWQgPSBudWxsOw0KICAgICAgICAgICAgaWYodHlwZW9mKDwlPW9iaiU+KT09PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICA8JT13YXJuKGAke21OYW1lfS51blJlY3Vyc2VgKSU+Ik51bGwgaW5wdXQiLCA8JT1vYmolPiwgPCU9ZnVuJT4sIDwlPWZBcmdzJT4pOw0KICAgICAgICAgICAgICAgIHJldHVybiA8JT1vYmolPjsNCiAgICAgICAgICAgIH1lbHNlIGlmKHR5cGVvZig8JT1vYmolPik9PT0nc3RyaW5nJyl7DQogICAgICAgICAgICAgICAgX2lkID0gdGhpcy5oYXNoQ29kZSg8JT1vYmolPik7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICBfaWQgPSA8JT1vYmolPls8JT1pZGYlPl07DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZihfaWQpPT09J3VuZGVmaW5lZCcgfHwgIV9pZCl7DQogICAgICAgICAgICAgICAgaWYoPCU9b2JqJT4uSWQgJiYgPCU9b2JqJT4uSWQ9PTwlPW9iaiU+LklkKXsNCiAgICAgICAgICAgICAgICAgICAgX2lkID0gPCU9b2JqJT4uSWQ7DQogICAgICAgICAgICAgICAgfWVsc2UgaWYodGhpcy5JZD09dGhpcy5JZCl7DQogICAgICAgICAgICAgICAgICAgIF9pZCA9IHRoaXMuSWQ7DQogICAgICAgICAgICAgICAgfWVsc2UgaWYodGhpcy5TZXRfT24pew0KICAgICAgICAgICAgICAgICAgICBfaWQgPSB0aGlzLl90b0hhc2goPCU9ZkFyZ3MlPiwge29ubHlVbmlxdWU6IHRydWV9LCA8JT1mdW4lPik7DQogICAgICAgICAgICAgICAgICAgIDwlPWxvZyhgJHttTmFtZX0udW5SZWN1cnNlYCklPiJ0aGlzLmhhc2hlZF9pZCIsIF9pZCwgPCU9ZnVuJT4sIDwlPWZBcmdzJT4pOw0KICAgICAgICAgICAgICAgIH1lbHNlIGlmKDwlPW9iaiU+LkVudGl0eUNsYXNzKXsNCiAgICAgICAgICAgICAgICAgICAgX2lkID0gPCU9b2JqJT4uRW50aXR5Q2xhc3MuSWQgfHwgPCU9b2JqJT4uRW50aXR5Q2xhc3MuTmFtZSB8fCB0aGlzLl90b0hhc2goPCU9ZkFyZ3MlPiwge2RlcHRoOiA8JWJEYW5nZXIoKSU+PzM6dW5kZWZpbmVkfSwgPCU9ZnVuJT4pOw0KICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICBfaWQgPSB0aGlzLkVudGl0eUNsYXNzLklkIHx8ICI8JT1jLklkJT4iIHx8IHRoaXMuX3RvSGFzaCg8JT1mQXJncyU+LCB7ZGVwdGg6IDwlYkRhbmdlcigpJT4/Mzp1bmRlZmluZWR9LCA8JT1mdW4lPikgfHwgIk5VTEwiOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgLy8gaWYoIjwlPW5OYW1lKGMpJT4iPT0iVXNlciIgJiYgPCU9ZnVuJT49PSJfdG9TTkZsb3ciKSA8JT13YXJuKGAke21OYW1lfS51blJlY3Vyc2VgKSU+Il9pZCIsIF9pZCwgPCU9ZnVuJT4sIDwlPWZBcmdzJT4pOw0KICAgICAgICAgICAgDQogICAgICAgIAk8JT1zY29wZSU+Ll91blJlY3Vyc2UgPSA8JT1zY29wZSU+Ll91blJlY3Vyc2UgfHwge307DQogICAgICAgIAk8JT1zY29wZSU+Ll91blJlY3Vyc2UuPCU9bk5hbWUoYyklPiA9IDwlPXNjb3BlJT4uX3VuUmVjdXJzZS48JT1uTmFtZShjKSU+IHx8IHt9Ow0KICAgICAgICAJPCU9c2NvcGUlPi5fdW5SZWN1cnNlLjwlPW5OYW1lKGMpJT5bPCU9ZnVuJT5dID0gPCU9c2NvcGUlPi5fdW5SZWN1cnNlLjwlPW5OYW1lKGMpJT5bPCU9ZnVuJT5dIHx8IHt9Ow0KICAgICAgICAJPCU9c2NvcGUlPi5fdW5SZWN1cnNlLjwlPW5OYW1lKGMpJT5bPCU9ZnVuJT5dW19pZF0gPSA8JT1zY29wZSU+Ll91blJlY3Vyc2UuPCU9bk5hbWUoYyklPls8JT1mdW4lPl1bX2lkXSB8fCB7fTsNCiAgICAgICAgCQ0KICAgICAgICAgICAgdiA9IDwlPXNjb3BlJT4uX3VuUmVjdXJzZS48JT1uTmFtZShjKSU+WzwlPWZ1biU+XVtfaWRdOw0KDQogICAgICAgICAgICBpZih2ICYmIE1hdGguYWJzKG5ldyBEYXRlKCkuZ2V0VGltZSgpIC0gdi5kYXRlKSA8ICgxMDAwKjwlPXZhbGlkaXR5JT4pKXsNCiAgICAgICAgICAgICAgICBpZigoPCViRGFuZ2VyKCklPj9uZXcgRGF0ZSgwKToodGhpcy5TZXRfT24gfHwgbmV3IERhdGUoMCkpKS5nZXRUaW1lKCkgPiB2LmRhdGUpew0KICAgICAgICAgICAgICAgICAgICA8JT1sb2coYCR7bU5hbWV9LnVuUmVjdXJzZWApJT5gU3Bhd25pbmcgaW4gJHs8JT1mdW4lPn1gLCBfaWQsIDwlPWZ1biU+LCA8JT1vYmolPiwgdi5yZXVzZWQsIDwlPXZhbGlkaXR5JT4pOw0KICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICA8JT1sb2coYCR7bU5hbWV9LnVuUmVjdXJzZWApJT4iU2VsZWN0ZWQgaGFzaCIsIF9pZCwgPCU9ZnVuJT4sIDwlPW9iaiU+LCB2LnJldXNlZCwgPCU9dmFsaWRpdHklPik7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIDwlPXNSZXQlPg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICA8JT1sb2coYCR7bU5hbWV9LnVuUmVjdXJzZWApJT4iUHVzaGluZyBoYXNoIiwgX2lkLCA8JT1mdW4lPiwgPCU9b2JqJT4pOw0KICAgICAgICAJdiA9IDwlPXNjb3BlJT4uX3VuUmVjdXJzZS48JT1uTmFtZShjKSU+WzwlPWZ1biU+XVtfaWRdID0gew0KICAgICAgICAgICAgICAgIGRhdGU6IG5ldyBEYXRlKCkuZ2V0VGltZSgpLA0KICAgICAgICAgICAgICAgIGFyZ3M6IEpTT04uc3RyaW5naWZ5KDwlPWZBcmdzJT4pLA0KICAgICAgICAgICAgICAgIG9iajogPCU9b2JqJT4sDQogICAgICAgICAgICAgICAgcmV1c2VkOiAwLA0KICAgICAgICAgICAgICAgIHBhdGg6ICcnLA0KICAgICAgICAgICAgICAgIF9pZCwNCiAgICAgICAgICAgIH07DQogICAgICAgICAgICANCiAgICAgICAgICAgIDwlLypleHBlcmltZW50YWw6IHJlbW92ZSB0aGlzIGlmIGFsbCBnb2VzIHdyb25nKi8lPg0KICAgICAgICAgICAgPCU9c1JldCU+DQogICAgCX1jYXRjaCh1blJlY0V4KXsNCiAgICAJICAgIGlmKCF1blJlY0V4LnRvU3RyaW5nKCkuaW5kZXhPZignUmFuZ2VFcnJvcjogJykpew0KICAgIAkgICAgICAgIDwlPXNjb3BlJT4udW5SZWN1cnNlQWJvcnRbPCU9ZnVuJT5dID0gdHJ1ZTsNCiAgICAJICAgIH0NCiAgICAJICAgIDwlPWVycm9yKGAke21OYW1lfS51blJlY3Vyc2VgKSU+PCU9b2JqJT4sIDwlPWZ1biU+LCA8JT1mQXJncyU+LCB1blJlY0V4LnRvU3RyaW5nKCkpOw0KICAgIAkgICAgPCU9c1JldCU+DQogICAgCX0NCjwlDQp9Ow0KDQpsZXQgaW52b2tlUnVsZSA9IHIgPT4gew0KJT4NCmF3YWl0IChhc3luYyAoYXV0aE9iaikgPT4gew0KICAgIGxldCBfcnVsZSA9IDwlPV9GckVNRC5fdG9KUyhyKSU+Ow0KICAgIGRlbGV0ZSBfcnVsZS5TY3JpcHQ7DQogICAgLy8gcnVsZVJ1bnMucHVzaChfcnVsZSk7DQogICAgdHJ5ew0KICAgICAgICA8JT1yLlNjcmlwdCU+DQogICAgfWNhdGNoKGV4KXsNCiAgICAgICAgX3J1bGUuRXhjZXB0aW9uID0gZXg7DQogICAgfQ0KfSkoYXV0aE9iaik7DQo8JQ0KfQ0KJT4NCg0KY2xhc3MgPCU9bk5hbWUoYyklPiB7DQogICAgPCU9bU5hbWU9J2NvbnN0cnVjdG9yJyU+KGlkLCB0b29sKSB7DQogICAgICAgIC8vc3VwZXIoaWQsIHRvb2wpOw0KDQogICAgICAgIHRoaXMuU2NvcGUgPSAiPCU9c2NvcGUlPiI7DQogICAgICAgIHRoaXMuRGVidWcgPSA8JT1fRnJFTUQuX3RvSlMoYy5EZWJ1ZyklPjsNCiAgICAgICAgdGhpcy5Db25maWcgPSA8JT1fRnJFTUQuX3RvSlMoYy5Db25maWcpJT47DQogICAgICAgIHRoaXMuVGVzdCA9IDwlPV9GckVNRC5fdG9KUyhjLlRlc3QpJT47DQogICAgICAgIHRoaXMuVG9vbHMgPSA8JT1fRnJFTUQuX3RvSlMoYy5Ub29scyklPjsNCiAgICAgICAgdGhpcy5NYXBwaW5ncyA9IDwlPV9GckVNRC5fdG9KUyhjLk1hcHBpbmdzKSU+Ow0KDQogICAgICAgIC8vIGF2b2lkIHN1cGVyLCBrZWVwIHRoaXMgaGVyZQ0KICAgICAgICB0aGlzLl9fSUQgPSB0aGlzLl9fSUQgfHwge307DQogICAgICAgIHRoaXMuVG9vbCA9IHRvb2w7DQogICAgICAgIHRoaXMuSWQgPSBpZDsNCg0KICAgICAgICB0aGlzLlZhbHVlRW50aXRpZXMgPSBbXTsNCg0KICAgICAgICB0aGlzLkRhdGUgPSBudWxsOw0KDQogICAgICAgIHRoaXMuY2xlYXJfVEhJUygpOw0KICAgICAgICB0aGlzLkVudGl0eVZhbHVlcyA9IFtdOw0KPCUgYy5FbnRpdHlBdHRyaWJ1dGVzLmZpbHRlcihlYSA9PiAhZWEuRW50aXR5TWV0aG9kKS5mb3JFYWNoKGVhID0+IHslPg0KICAgICAgICB0aGlzLkVudGl0eVZhbHVlcy5wdXNoKHsNCiAgICAgICAgICAgIEVudGl0eUF0dHJpYnV0ZTogew0KPCUgaWYoTnVtYmVyKGVhLklkKSl7JT4NCiAgICAgICAgICAgICAgICBJZDogIjwlPWVhLklkJT4iLA0KPCUgfSU+DQogICAgICAgICAgICAgICAgTmFtZTogIjwlPWVhLk5hbWUlPiIsDQogICAgICAgICAgICAgICAgT1BFUkFUT1JTOiB7TmFtZTogIj0ifSwNCiAgICAgICAgICAgICAgICBFbnRpdHlDbGFzczogdGhpcy5FbnRpdHlDbGFzcywNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICBPUEVSQVRPUlM6IHt9DQogICAgICAgIH0pOw0KICAgICAgICB0aGlzLmNsZWFyXzwlPW5OYW1lKGVhKSU+KCk7DQo8JSB9KTsgJT4NCg0KPCUgYy5UeXBlZEF0dHJpYnV0ZXMuZmlsdGVyKHRhID0+ICF0YS5FbnRpdHlNZXRob2QpLmZvckVhY2godGEgPT4geyU+DQogICAgICAgIHRoaXMuY2xlYXJfPCU9bk5hbWUodGEpJT5fPCU9dGEuRW50aXR5Q2xhc3MuUGx1cmFsLnJlcGxhY2UoLyAvZywgJ18nKSU+KCk7DQo8JSB9KTsgJT4NCiAgICB9DQogICAgDQogICAgPCU9bU5hbWU9J19kZWZhdWx0cyclPigpew0KPCVfZGVmYXVsdHMoKSU+DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgIH0NCiAgICANCiAgICA8JT1tTmFtZT0nZ2V0IEVudGl0eUNsYXNzJyU+KCl7DQogICAgICAgIGxldCBlYyA9IHsNCjwlIGlmKE51bWJlcihjLklkKSl7JT4NCiAgICAgICAgICAgIElkOiAiPCU9Yy5JZCU+IiwNCjwlIH0lPg0KICAgICAgICAgICAgTmFtZTogIjwlPWMuTmFtZSU+IiwNCiAgICAgICAgICAgIE9QRVJBVE9SUzoge05hbWU6ICI9In0sDQogICAgICAgIH07DQoNCjwlIGlmKGMuRW50aXR5TW9kdWxlaWQpeyAlPg0KICAgICAgICBlYy5FbnRpdHlNb2R1bGUgPSB7DQogICAgICAgICAgICBJZDogPCU9Yy5FbnRpdHlNb2R1bGVpZCU+DQogICAgICAgIH07DQo8JSB9JT4NCg0KICAgICAgICAvLyB0aGF0J3Mgd2h5IHdlIG5lZWQgaXQgYXMgYSBnZXR0ZXINCiAgICAgICAgaWYoIU51bWJlcihlYy5JZCkgJiYgPCU9c2NvcGUlPi5FbnRpdHlDbGFzc2VzKXsNCiAgICAgICAgICAgIGxldCBjaWQgPSA8JT1zY29wZSU+LkVudGl0eUNsYXNzZXMuZmluZChjID0+IE51bWJlcihjLklkKSAmJiBjLk5hbWU9PWVjLk5hbWUpOw0KICAgICAgICAgICAgaWYoY2lkKSBlYy5JZCA9IGNpZC5JZDsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gZWM7DQogICAgfQ0KDQoJPCU9bU5hbWU9J2dldCBJZCclPigpIHsNCgkJcmV0dXJuIHRoaXMuX19JRFt0aGlzLlRvb2wubmFtZV0gfHwgdGhpcy5fdXVpZCgpOw0KCX0NCg0KCTwlPW1OYW1lPSdzZXQgSWQnJT4oaWQpIHsNCgkJaWYgKCF0aGlzLlRvb2wpIHsNCgkJCTwlPWxvZygpJT4iRW1wdHkgVG9vbCIsIHRoaXMuVG9vbHMubGVuZ3RoLCA8JT1zY29wZSU+LlRvb2xzLmxlbmd0aCk7DQoJCQlyZXR1cm47DQoJCX0NCgkJaWYodGhpcy5fX0lEW3RoaXMuVG9vbC5uYW1lXT09aWQpIHJldHVybjsNCgkJdGhpcy5fX0lEW3RoaXMuVG9vbC5uYW1lXSA9IGlkOw0KCX0NCg0KICAgIDwlPW1OYW1lPSdnZXQgVG9vbCclPigpIHsNCiAgICAgICAgaWYodHlwZW9mKHRoaXMuX19Ub29sKSE9PSd1bmRlZmluZWQnKSByZXR1cm4gdGhpcy5fX1Rvb2w7DQogICAgICAgIGxldCBub1Rvb2wgPSB7DQogICAgICAgICAgICBuYW1lOiAnJywNCiAgICAgICAgICAgIHR5cGU6IHtuYW1lOiAnJ30sDQogICAgICAgIH07DQogICAgICAgIGlmKHR5cGVvZig8JT1zY29wZSU+LlRvb2xzKSE9PSJ1bmRlZmluZWQiICYmICFBcnJheS5pc0FycmF5KDwlPXNjb3BlJT4uVG9vbHMpKXsNCiAgICAgICAgICAgIDwlPWVycm9yKCklPiI8JT1zY29wZSU+LlRvb2xzIGlzIG5vdCBhbiBhcnJheTogIiwgPCU9c2NvcGUlPi5Ub29scyk7DQogICAgICAgICAgICByZXR1cm4gbm9Ub29sOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICBsZXQgcmV0ID0gKDwlPXNjb3BlJT4uX19sYXN0VG9vbD9bPCU9c2NvcGUlPi5fX2xhc3RUb29sXTpbXSkuY29uY2F0KHRoaXMuVG9vbHMpLmZpbmQodCA9PiAoPCU9c2NvcGUlPi5Ub29scyB8fCBbXSkuZmluZChfdCA9PiB0ID09IF90Lm5hbWUgfHwgdC5uYW1lPT1fdC5uYW1lKSk7DQogICAgICAgIGlmKHR5cGVvZihyZXQpIT09J3VuZGVmaW5lZCcpIHJldCA9ICg8JT1zY29wZSU+LlRvb2xzIHx8IFtdKS5maW5kKHQgPT4gdC5uYW1lPT1yZXQgfHwgdC5uYW1lPT1yZXQubmFtZSk7DQogICAgICAgIGlmKHR5cGVvZihyZXQpPT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgaWYodGhpcy5Ub29scy5sZW5ndGgpew0KICAgICAgICAgICAgICAgIHJldCA9IHsNCiAgICAgICAgICAgICAgICAgICAgbmFtZTogdGhpcy5Ub29sc1swXSwNCiAgICAgICAgICAgICAgICAgICAgdHlwZTogew0KICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogdGhpcy5Ub29sc1swXQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgIH1lbHNlIHJldCA9IG5vVG9vbDsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gcmV0Ow0KICAgIH0NCg0KICAgIDwlPW1OYW1lPSdzZXQgVG9vbCclPih0b29sKSB7DQogICAgICAgIGlmICh0eXBlb2YodG9vbCk9PT0ndW5kZWZpbmVkJykgcmV0dXJuOw0KICAgICAgICBpZih0eXBlb2YodG9vbCk9PT0ic3RyaW5nIil7DQogICAgICAgICAgICB0b29sID0ge25hbWU6IHRvb2x9Ow0KICAgICAgICB9DQogICAgICAgIGlmKHRvb2wuRW50aXR5Q2xhc3Mpew0KICAgICAgICAgICAgdG9vbCA9IHRvb2wuX3RvRG9jdW1lbnQoKTsNCiAgICAgICAgfQ0KICAgICAgICBpZih0eXBlb2YodG9vbC5uYW1lKT09PSd1bmRlZmluZWQnICYmIHR5cGVvZih0b29sLnR5cGUubmFtZSk9PT0ndW5kZWZpbmVkJykgcmV0dXJuOw0KICAgICAgICB0b29sLnR5cGUgPSB0b29sLnR5cGUgfHwge25hbWU6IHRvb2wubmFtZX07DQogICAgICAgIA0KICAgICAgICBpZighdG9vbC50eXBlICYmICF0b29sLm5hbWUpew0KICAgICAgICAgICAgPCU9d2FybigpJT4iRW1wdHkgVG9vbCBvYmplY3QiKTsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KDQogICAgICAgIGxldCB0ID0gKDwlPXNjb3BlJT4uVG9vbHMgfHwgW10pLmZpbHRlcih0ID0+IHQubmFtZSAmJiB0LnR5cGUpLmZpbmQodCA9PiAodC5uYW1lID09IHRvb2wubmFtZSkgfHwgKHQudHlwZS5uYW1lID09IHRvb2wudHlwZS5uYW1lKSk7DQogICAgICAgIGlmICghdCkgew0KICAgICAgICAgICAgPCU9bG9nKCklPiJubyBtYXRjaGluZyB0b29sIiwgdG9vbCwgPCU9c2NvcGUlPi5Ub29scyk7DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIDwlPXNjb3BlJT4uX19sYXN0VG9vbCA9IHRoaXMuX19Ub29sID0gdDsNCiAgICAgICAgDQogICAgICAgIHJldHVybiB0aGlzOw0KICAgIH0NCg0KICAgIDwlPW1OYW1lPSdUSElTJyU+KHYsIGNvKXsNCiAgICAgICAgaWYodHlwZW9mKHYpPT09J3VuZGVmaW5lZCcpIHJldHVybiB0aGlzLl9USElTOw0KICAgICAgICBpZighdikgcmV0dXJuIHRoaXM7DQogICAgICAgIHYgPSBBcnJheS5pc0FycmF5KHYpP3Y6W3ZdOw0KICAgICAgICB0aGlzLl9USElTID0gdi5maWx0ZXIoX3YgPT4gdHlwZW9mKF92KT09PSdvYmplY3QnICYmIF92LkVudGl0eUNsYXNzICYmIF92LkVudGl0eUNsYXNzLk5hbWU9PXRoaXMuRW50aXR5Q2xhc3MuTmFtZSAmJiBfdi5TY29wZT09dGhpcy5TY29wZSk7DQogICAgICAgIGlmIChjbykgdGhpcy5fVEhJU19jb29wID0gY287DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgIH0NCiAgICANCiAgICA8JT1tTmFtZT0nY2xlYXJfVEhJUyclPigpIHsNCiAgICAgICAgdGhpcy5fVEhJUyA9IFtdOw0KICAgICAgICB0aGlzLl9USElTX2Nvb3AgPSAnJzsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgfQ0KICAgIA0KPCUgYy5FbnRpdHlBdHRyaWJ1dGVzLmZpbHRlcihlYSA9PiAhZWEuRW50aXR5TWV0aG9kKS5mb3JFYWNoKGVhID0+IHslPg0KICAgIC8qKiBzdGFydDogc2V0dGVycyBhbmQgZ2V0dGVycyBmb3IgPCU9ZWEuTmFtZSU+ICoqLw0KICAgIDwlPW1OYW1lPW5OYW1lKGVhKSU+KHYsIGNvLCBpZCkgew0KICAgICAgICBpZiAoY28pIHRoaXMuXzwlPW5OYW1lKGVhKSU+X2Nvb3AgPSBjbzsNCg0KICAgICAgICB2YXIgZXYgPSB0aGlzLkVudGl0eVZhbHVlKCI8JT1lYS5OYW1lJT4iKTsNCiAgICAgICAgaWYgKCFldil7DQogICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgfQ0KDQogICAgICAgIGlmIChpZCkgZXYuSWQgPSBpZDsNCg0KICAgICAgICBpZiAodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpIHsNCiAgICAgICAgICAgIC8vIHZhbHVlcyB3ZXJlIGdpdmVuLCB0aGVyZWZvcmUgYSBzZXR0ZXINCg0KICAgIDwlIGlmKGVhLklzQXJyYXkpeyU+DQogICAgICAgICAgICB2ID0gQXJyYXkuaXNBcnJheSh2KT92Olt2XTsNCiAgICAgICAgICAgIHYgPSB2Lm1hcChfdiA9PiB7DQogICAgPCUgfWVsc2V7JT4NCiAgICAgICAgICAgIHYgPSAoX3YgPT4gew0KICAgIDwlIH0lPg0KDQogICAgPCUgaWYoZWEuSXNEYXRlKXslPg0KICAgICAgICAgICAgICAgIF92ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKF92KSA9PT0gJ1tvYmplY3QgRGF0ZV0nP192OihuZXcgRGF0ZShfdikpOw0KICAgICAgICAgICAgICAgIGlmKGlzTmFOKF92LmdldFRpbWUoKSkpIF92ID0gbnVsbDsNCiAgICA8JSB9JT4NCiAgICA8JSBpZihlYS5Jc0Jvb2wpeyU+DQogICAgICAgICAgICAgICAgX3YgPSBbInRydWUiLCAiMSIsICJ5ZXMiLCB0cnVlLCAxXS5pbmNsdWRlcyhfdik7DQogICAgPCUgfSU+DQogICAgPCUgaWYoZWEuSXNJbnQgfHwgZWEuSXNMb25nIHx8IGVhLklzRmxvYXQpeyU+DQogICAgICAgICAgICAgICAgaWYoaXNOYU4oX3YpKSBfdiA9IDA7DQogICAgPCUgfSU+DQogICAgPCUgaWYoZWEuSXNUZXh0KXslPg0KICAgICAgICAgICAgICAgIGlmKHR5cGVvZihfdik9PT0nb2JqZWN0JykgX3YgPSBKU09OLnN0cmluZ2lmeShfdik7DQogICAgPCUgfSU+DQoNCiAgICA8JSBpZihlYS5FbnRpdHlUeXBlKXslPg0KICAgICAgICAgICAgICAgIGlmKF92ICYmICFfdi5FbnRpdHlDbGFzcyl7DQogICAgICAgICAgICAgICAgICAgIDwlPWxvZygpJT4idXNpbmcgX3RvRG9jdW1lbnQgZm9yIGludmFsaWQgc2V0dGVyIHZhbHVlIiwgX3YpOw0KICAgICAgICAgICAgICAgICAgICBfdiA9IG5ldyA8JT1zY29wZSU+LjwlPV9jTmFtZShlYS5FbnRpdHlUeXBlLCB0cnVlKSU+KCkuX2Zyb21Eb2N1bWVudChfdik7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgaWYoX3YgJiYgX3YuRW50aXR5Q2xhc3MuSWQhPT0nPCU9ZWEuRW50aXR5VHlwZS5JZCU+JyAmJiBfdi5FbnRpdHlDbGFzcy5OYW1lIT09JzwlPWVhLkVudGl0eVR5cGUuTmFtZSU+Jyl7DQogICAgICAgICAgICAgICAgICAgIDwlPXdhcm4oKSU+IkludmFsaWQgU2V0dGVyIHZhbHVlIiwgX3YsICI8JT1lYS5FbnRpdHlUeXBlLklkJT4iLCBfdi5FbnRpdHlDbGFzcy5OYW1lLCAiPCU9ZWEuRW50aXR5VHlwZS5OYW1lJT4iKTsNCiAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgX3YgPSAoKF92ICYmICF0aGlzLklkKSA/IF92LnRvRW50aXR5T2JqZWN0KCkgOiBfdik7DQogICAgICAgICAgICAgICAgfQ0KICAgIDwlIH0lPg0KDQogICAgICAgICAgICAgICAgcmV0dXJuIF92Ow0KICAgIDwlIGlmKGVhLklzQXJyYXkpeyU+DQogICAgICAgICAgICB9KTsNCiAgICA8JSB9ZWxzZXslPg0KICAgICAgICAgICAgfSkodik7DQogICAgPCUgfSU+DQogICAgDQogICAgPCUgaWYoZWEuRW50aXR5VHlwZSl7JT4NCiAgICAgICAgICAgIGRlbGV0ZSBldi5PYmplY3RWYWx1ZWlkOw0KICAgICAgICAgICAgZXYuT2JqZWN0VmFsdWUgPSB2Ow0KICAgIDwlIH1lbHNleyU+DQogICAgICAgICAgICBldi48JT1fRnJFTUQuX2F0dHIoZWEpJT5WYWx1ZSA9IHY7DQogICAgPCUgfSU+DQoNCiAgICAgICAgICAgIGlmKHRydWUgfHwgdGhpcy5fPCU9bk5hbWUoZWEpJT4hPXYpew0KICAgICAgICAgICAgICAgIHRoaXMuXzwlPW5OYW1lKGVhKSU+X3NldCA9IDwlPVNldF9PbiU+OyAvLyBhIGNoYW5nZSBpbiB2YWx1ZQ0KICAgIDwlIGlmKGVhLkVudGl0eVR5cGUpeyU+DQogICAgICAgICAgICAgICAgPCU9bG9nKCklPiJTZXQgYWZ0ZXIiLCB0aGlzLl88JT1uTmFtZShlYSklPj90aGlzLl88JT1uTmFtZShlYSklPi5TZXRfT246bnVsbCwgdj92LlNldF9PbjpudWxsKTsNCiAgICAgICAgICAgICAgICAvKmlmKHYpIHRoaXMuXzwlPW5OYW1lKGVhKSU+X3NldCA9IHYuU2V0X09uOyovDQogICAgPCUgfSU+DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHRoaXMuXzwlPW5OYW1lKGVhKSU+ID0gdjsNCiAgICAgICAgICAgIGlmIChjbykgZXYuT1BFUkFUT1JTLjwlPV9GckVNRC5fYXR0cihlYSklPlZhbHVlID0gY287DQoNCiAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgcmV0dXJuIHRoaXMuaTE4bihldiwgdGhpcy5fPCU9bk5hbWUoZWEpJT4pOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgPCU9bU5hbWU9J2NsZWFyXycrbk5hbWUoZWEpJT4oKSB7DQogICAgICAgIGxldCByZXQgPSB0aGlzLl88JT1uTmFtZShlYSklPjsNCiAgICAgICAgdGhpcy5fPCU9bk5hbWUoZWEpJT5fc2V0ID0gbnVsbDsNCiAgICAgICAgdGhpcy5fPCU9bk5hbWUoZWEpJT4gPSBudWxsOw0KICAgICAgICB0aGlzLl88JT1uTmFtZShlYSklPl9jb29wID0gIiI7DQogICAgICAgIHJldHVybiByZXQ7DQogICAgfQ0KDQogICAgLyoqIGVuZDogc2V0dGVycyBhbmQgZ2V0dGVycyBmb3IgPCU9ZWEuTmFtZSU+ICoqLw0KPCUgfSk7ICU+DQo8JSBjLlR5cGVkQXR0cmlidXRlcy5maWx0ZXIodGEgPT4gIXRhLkVudGl0eU1ldGhvZCkuZm9yRWFjaCh0YSA9PiB7IGxldCB0YU5hbWUgPSB0YS5FbnRpdHlDbGFzcy5QbHVyYWwucmVwbGFjZSgvIC9nLCAnXycpOyU+DQogICAgLyoqIHN0YXJ0OiBzZXR0ZXJzIGFuZCBnZXR0ZXJzIGZvciA8JT10YS5OYW1lJT5fPCU9dGFOYW1lJT4gKiovDQogICAgPCU9bU5hbWU9bk5hbWUodGEpKydfJyt0YU5hbWUlPih2LCBjbywgYkNsZWFyKSB7DQogICAgICAgIGlmKHR5cGVvZih2KT09PSJ1bmRlZmluZWQiKSByZXR1cm4gdGhpcy5fPCU9bk5hbWUodGEpJT5fPCU9dGFOYW1lJT47DQogICAgICAgIA0KICAgICAgICBpZih2ICYmIHYudG9FbnRpdHlPYmplY3QgJiYgdi5FbnRpdHlDbGFzcy5JZCE9PSc8JT10YS5FbnRpdHlDbGFzcy5JZCU+JyAmJiB2LkVudGl0eUNsYXNzLk5hbWUhPT0nPCU9dGEuRW50aXR5Q2xhc3MuTmFtZSU+JykgcmV0dXJuIHRoaXM7DQogICAgICAgIA0KICAgICAgICB2ID0gQXJyYXkuaXNBcnJheSh2KT92Olt2XTsNCiAgICAgICAgDQogICAgICAgIHYgPSB2LmZpbHRlcihfdiA9PiAhdiB8fCBfdi5fPCU9bk5hbWUodGEpJT5fc2V0KS5jb25jYXQodi5maWx0ZXIoX3YgPT4gX3YgJiYgIV92Ll88JT1uTmFtZSh0YSklPl9zZXQpLm1hcChfdiA9PiB7DQogICAgICAgICAgICBpZighX3YuY29uc3RydWN0b3Ipew0KICAgICAgICAgICAgICAgIDwlPXdhcm4oKSU+IjwlPW5OYW1lKHRhKSU+IGhhcyBubyBjb25zdHJ1Y3RvciIsIF92KTsNCiAgICAgICAgICAgIH1lbHNlIGlmKF92LmNvbnN0cnVjdG9yLm5hbWU9PSJPYmplY3QiKXsNCiAgICAgICAgICAgICAgICBfdiA9IG5ldyA8JT1zY29wZSU+LjwlPW5OYW1lKHRhLkVudGl0eUNsYXNzLCB0cnVlKSU+KCkuX2Zyb21Eb2N1bWVudChfdikNCiAgICAgICAgICAgICAgICBfdi48JT1uTmFtZSh0YSklPih0aGlzKTsNCiAgICAgICAgICAgICAgICByZXR1cm4gX3Y7DQogICAgICAgICAgICB9ZWxzZSBpZihfdi5jb25zdHJ1Y3Rvci5uYW1lIT0iPCU9bk5hbWUodGEuRW50aXR5Q2xhc3MpJT4iKXsNCiAgICAgICAgICAgICAgICA8JT13YXJuKCklPiI8JT1uTmFtZSh0YSklPiBub3QgdmFsaWQiLCBfdiwgX3YuY29uc3RydWN0b3IubmFtZSwgIjwlPW5OYW1lKHRhLkVudGl0eUNsYXNzKSU+Iik7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICBfdi48JT1uTmFtZSh0YSklPih0aGlzKTsNCiAgICAgICAgICAgICAgICByZXR1cm4gX3Y7DQogICAgICAgICAgICB9DQogICAgICAgIH0pLmZpbHRlcihfdiA9PiBfdikpOw0KICAgICAgICANCiAgICAgICAgaWYoYkNsZWFyKSB0aGlzLmNsZWFyXzwlPW5OYW1lKHRhKSU+XzwlPXRhTmFtZSU+KCk7DQogICAgICAgIHRoaXMuXzwlPW5OYW1lKHRhKSU+XzwlPXRhTmFtZSU+LnB1c2goLi4udik7DQogICAgICAgIHRoaXMuXzwlPW5OYW1lKHRhKSU+XzwlPXRhTmFtZSU+X3NldCA9IDwlPVNldF9PbiU+Ow0KICAgICAgICBpZiAoY28pIHRoaXMuXzwlPW5OYW1lKHRhKSU+XzwlPXRhTmFtZSU+X2Nvb3AgPSBjbzsNCg0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICB9DQogICAgY2xlYXJfPCU9bk5hbWUodGEpJT5fPCU9dGFOYW1lJT4oKSB7DQogICAgICAgIGxldCByZXQgPSB0aGlzLl88JT1uTmFtZSh0YSklPl88JT10YU5hbWUlPjsNCg0KICAgICAgICB0aGlzLl88JT1uTmFtZSh0YSklPl88JT10YU5hbWUlPl9zZXQgPSBudWxsOw0KICAgICAgICB0aGlzLl88JT1uTmFtZSh0YSklPl88JT10YU5hbWUlPiA9IG5ldyBBcnJheSgpOw0KICAgICAgICB0aGlzLl88JT1uTmFtZSh0YSklPl88JT10YU5hbWUlPl9jb29wID0gbnVsbDsNCiAgICAgICAgcmV0dXJuIHJldDsNCiAgICB9DQogICAgLyoqIGVuZDogc2V0dGVycyBhbmQgZ2V0dGVycyBmb3IgPCU9bk5hbWUodGEpJT5fPCU9dGFOYW1lJT4gKiovDQoNCjwlIH0pICU+DQo8JSBjLkVudGl0eUZpZWxkcy5mb3JFYWNoKGVmID0+IHslPg0KICAgIC8qKiBzdGFydDogZ2V0dGVycyBmb3IgPCU9ZWYuTmFtZSU+ICoqLw0KICAgIDwlPW1OYW1lPSdnZXQgJytuTmFtZShlZiklPigpew0KICAgICAgICByZXR1cm4gPCV2YWx1ZU9mKGVmLlZhbHVlKSU+Ow0KICAgIH0NCiAgICAvKiogZW5kOiBnZXR0ZXJzIGZvciA8JT1lZi5OYW1lJT4gKiovDQo8JSB9KSU+DQoNCiAgICA8JT1tTmFtZT0nbG9nJyU+KGNsYXNzTmFtZSwgb2JqLCBtLCB0eXBlLCBsZXZlbCwgLi4ubXNnKXsNCiAgICAgICAgY2xhc3NOYW1lID0gY2xhc3NOYW1lIHx8ICI8JT1uTmFtZShjKSU+IjsNCiAgICAgICAgdHlwZSA9IHR5cGUgfHwgIkVudGl0eU9iamVjdCI7DQogICAgICAgIA0KPCUgaWYobWFpbkNsYXNzKCkhPWMpeyU+DQogICAgICAgIHJldHVybiBuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUobWFpbkNsYXNzKCksIHRydWUpJT4oKS48JT1tTmFtZSU+KGNsYXNzTmFtZSwgb2JqLCBtLCB0eXBlLCBsZXZlbCwgLi4ubXNnKTsNCjwlIH1lbHNleyU+DQogICAgICAgIHRyeXsNCgkJCWxldCBkZWJ1ZyA9IHRoaXMuRGVidWc7DQoJCQlsZXQgbGV2ZWxzID0gWyJpbmZvIiwgIndhcm4iLCAiZXJyb3IiLCAiY3JpdGljYWwiXTsNCg0KCQkJZGVidWcgPSBkZWJ1ZyB8fCBPYmplY3QuZnJvbUVudHJpZXMobmV3IE1hcChsZXZlbHMubWFwKGwgPT4gW2wsICcqJ10pKSk7DQoNCgkJCWxldCBmdW5jdGlvbnMgPSBPYmplY3QuYXNzaWduKHt9LCAuLi5sZXZlbHMubWFwKGwgPT4gKHsNCgkJCQlbbF06IGRlYnVnW2xdID8gZGVidWdbbF0uc3BsaXQoJywnKSA6IFtdDQoJCQl9KSkpOw0KDQoJCQlsZXQgY3NzID0gJ2JhY2tncm91bmQ6ICMwMGZmOTk7IGNvbG9yOiAjMDA4MDAwJzsNCgkJCWxldCBmZyA9ICdceDFiWzMybSc7DQoJCQlzd2l0Y2ggKE51bWJlcihsZXZlbCkpIHsNCgkJCQljYXNlIDE6DQoJCQkJCWNzcyA9ICdiYWNrZ3JvdW5kOiAjZmZmZjAwOyBjb2xvcjogIzAwMDA4MCc7DQoJCQkJCWZnID0gJ1x4MWJbMzNtJzsNCgkJCQkJYnJlYWs7DQoJCQkJY2FzZSAyOg0KCQkJCQljc3MgPSAnYmFja2dyb3VuZDogI2IyMjIyMjsgY29sb3I6ICNmZmZmZmYnOw0KCQkJCQlmZyA9ICdceDFiWzMxbSc7DQoJCQkJCWJyZWFrOw0KCQkJCWNhc2UgMzoNCgkJCQkJY3NzID0gJ2JhY2tncm91bmQ6ICNiMjIyMjI7IGNvbG9yOiAjZmZmZmZmJzsNCgkJCQkJZmcgPSAnXHgxYlszMW1bQ1JJVElDQUxdJzsNCgkJCQkJYnJlYWs7DQoJCQl9DQoNCgkJCWlmIChmdW5jdGlvbnNbbGV2ZWxzW051bWJlcihsZXZlbCkgfHwgMF1dLmV2ZXJ5KGYgPT4gIVsnKi4qJywgJyouJyArIG0sICcqJywgbSwgY2xhc3NOYW1lICsgJy4nICsgbSwgY2xhc3NOYW1lICsgJy4qJ10uaW5jbHVkZXMoZikpKSB7DQoJCQkJcmV0dXJuOw0KCQkJfQ0KDQoJCQlpZiAodHlwZW9mKGdsb2JhbCkgIT09ICd1bmRlZmluZWQnKSB7DQoJCQkJY29uc29sZS5sb2coZmcgKyAiJXNceDFiWzBtIiwgYCR7dHlwZSB8fCAnPHR5cGU+J306ICR7dGhpcy5TY29wZX0uJHtjbGFzc05hbWV9LiR7bSB8fCAnPG1ldGhvZD4nfSgpYCwgLi4uKHR5cGVvZihvYmopID09PSAndW5kZWZpbmVkJyA/IChtc2cgfHwgW10pIDogW29ial0uY29uY2F0KG1zZyB8fCBbXSkpKTsNCgkJCX0gZWxzZSB7DQoJCQkJY29uc29sZS5sb2coYCVjICR7dHlwZSB8fCAnPHR5cGU+J306ICR7dGhpcy5TY29wZX0uJHtjbGFzc05hbWV9LiR7bSB8fCAnPG1ldGhvZD4nfSgpYCwgY3NzLCAuLi4odHlwZW9mKG9iaikgPT09ICd1bmRlZmluZWQnID8gKG1zZyB8fCBbXSkgOiBbb2JqXS5jb25jYXQobXNnIHx8IFtdKSkpOw0KCQkJfQ0KCQl9IGNhdGNoIChleCkgew0KCQkJY29uc29sZS5sb2coZXgpOw0KCQl9DQo8JSB9JT4NCgl9DQoNCiAgICBhc3luYyA8JT1tTmFtZT0nc2V0SW50ZXJ2YWwnJT4oY2xhc3NOYW1lLCBmdW4sIG1pbnV0ZXMsIC4uLmFyZ3Mpew0KICAgICAgICBjbGFzc05hbWUgPSBjbGFzc05hbWUgfHwgIjwlPW5OYW1lKGMpJT4iOw0KPCUgaWYobWFpbkNsYXNzKCkhPWMpeyU+DQogICAgICAgIHJldHVybiBhd2FpdCBuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUobWFpbkNsYXNzKCksIHRydWUpJT4oKS48JT1tTmFtZSU+KGNsYXNzTmFtZSwgZnVuLCBtaW51dGVzLCAuLi5hcmdzKTsNCjwlIH1lbHNleyU+DQoJCXRyeSB7DQogICAgCQlsZXQgZk5hbWUgPSBmdW4udG9TdHJpbmcoKS5zcGxpdCgnKScpWzBdICsgJyknOw0KICAgIAkJdHJ5IHsNCiAgICAJCQkvLyB0aGlzLl9fdGltZShgJHtmTmFtZX0uTG9vcGApOw0KICAgIA0KICAgIAkJCXRoaXMuX190aW1lKGAke2ZOYW1lfS5DYWxsYCk7DQogICAgCQkJbGV0IHJldCA9IGF3YWl0IGZ1biguLi5hcmdzLmNvbmNhdChbbmV3IERhdGUoKV0pKTsNCiAgICANCiAgICAJCQk8JT1sb2coKSU+YHtDYWxsOiBgICsgdGhpcy5fX3RpbWUoYCR7Zk5hbWV9LkNhbGxgKSArIGAsIExvb3A6IGAgKyB0aGlzLl9fdGltZShgJHtmTmFtZX0uTG9vcGApICsgJ30nKTsNCiAgICAJCQlpZiAoIXJldCkgew0KICAgIAkJCQk8JT1sb2coKSU+YGRpZCBub3QgcmV0dXJuIHRydWUsIGV4aXRpbmcgbG9vcGVyICgke3RoaXMuX190aW1lKGZOYW1lKX0pYCk7DQogICAgCQkJCXJldHVybjsNCiAgICAJCQl9DQogICAgCQl9IGNhdGNoIChleCkgew0KICAgIAkJCTwlPWVycm9yKCklPnRoaXMuX190aW1lKGZOYW1lKSwgZXgpOw0KICAgIAkJCWNvbnNvbGUudHJhY2UoKTsNCiAgICAJCX0NCiAgICAJCWlmICghTnVtYmVyKG1pbnV0ZXMpKSB7DQogICAgCQkJPCU9bG9nKCklPnRoaXMuX190aW1lKGZOYW1lKSwgIk5vdCByZXBlYXRpbmcuIE1pbnV0ZXMgaXMgIiArIG1pbnV0ZXMpOw0KICAgIAkJCXJldHVybjsNCiAgICAJCX0NCiAgICAJCWF3YWl0IG5ldyBQcm9taXNlKHIgPT4gc2V0VGltZW91dChyLCBtaW51dGVzICogNjAgKiAxMDAwKSk7DQogICAgCQlhd2FpdCB0aGlzLjwlPW1OYW1lJT4obnVsbCwgZnVuLCBtaW51dGVzLCAuLi5hcmdzKTsNCgkJfSBjYXRjaCAoZXgpIHsNCgkJCTwlPWVycm9yKCklPmV4KTsNCgkJfQ0KPCUgfSU+DQoJfQ0KDQogICAgYXN5bmMgPCU9bU5hbWU9J19leGVjdXRlJyU+KGNsYXNzTmFtZSwgc2NvcGUsIG0sIGZSb3V0ZXIsIGZTY3JpcHQsIG9QYXJhbXMgPSB7fSwgc291cmNlKXsNCgkJdGhpcy5fX3RpbWUoYDwlPXNjb3BlJT4uPCU9X2NOYW1lKG1haW5DbGFzcygpLCB0cnVlKSU+LiR7bX1gKTsNCgkJY2xhc3NOYW1lID0gY2xhc3NOYW1lIHx8ICI8JT1uTmFtZShjKSU+IjsNCgkJc2NvcGUgPSBzY29wZSB8fCA8JT1zY29wZSU+Ow0KCQlzb3VyY2UgPSBzb3VyY2UgfHwgdGhpczsNCg0KPCUgaWYobWFpbkNsYXNzKCkhPWMpeyU+DQogICAgICAgIHJldHVybiBhd2FpdCBuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUobWFpbkNsYXNzKCksIHRydWUpJT4oKS48JT1tTmFtZSU+KGNsYXNzTmFtZSwgc2NvcGUsIG0sIGZSb3V0ZXIsIGZTY3JpcHQsIG9QYXJhbXMsIHRoaXMpOw0KPCUgfWVsc2V7JT4NCgkJZGVsZXRlIDwlPXNjb3BlJT4uX3VuUmVjdXJzZTsgLy8gZXhwZXJpbWVudGFsDQoJCQ0KICAgIAlsZXQgX19iZWZvcmVSdWxlcyA9IG9QYXJhbXMuX19iZWZvcmVSdWxlcyB8fCBbXTsNCiAgICAJbGV0IF9fYWZ0ZXJSdWxlcyA9IG9QYXJhbXMuX19hZnRlclJ1bGVzIHx8IFtdOw0KICAgIAlkZWxldGUgb1BhcmFtcy5fX2JlZm9yZVJ1bGVzOw0KICAgIAlkZWxldGUgb1BhcmFtcy5fX2FmdGVyUnVsZXM7DQoNCiAgICAgICAgbGV0IGxvZyA9ICguLi5zKSA9PiA8JT1sb2coKSU+Y2xhc3NOYW1lLCBtLCAuLi5zKTsNCiAgICAgICAgbGV0IHdhcm4gPSAoLi4ucykgPT4gPCU9d2FybigpJT5jbGFzc05hbWUsIG0sIC4uLnMpOw0KICAgICAgICBsZXQgZXJyb3IgPSAoLi4ucykgPT4gPCU9ZXJyb3IoKSU+Y2xhc3NOYW1lLCBtLCAuLi5zKTsNCiAgICAgICAgICAgIA0KICAgICAgICB0cnl7DQogICAgCQlsZXQgbFBhcmFtcyA9IE9iamVjdC5lbnRyaWVzKG9QYXJhbXMpLm1hcCh4ID0+IHhbMV0pOw0KICAgIAkJbGV0IHJlc3VsdHMgPSBbXTsNCiAgICANCiAgICAJCWxldCBub2RlcyA9IFtdOw0KICAgIAkJDQogICAgCQlpZiAoPCU9bnNjb3BlJT4uX25vZGUgJiYgYXdhaXQgZlJvdXRlcig8JT1uc2NvcGUlPi5fbm9kZSwgbSkpIHsNCiAgICAJCQlub2Rlcy5wdXNoKDwlPW5zY29wZSU+Ll9ub2RlKTsNCiAgICAJCX0NCiAgICANCiAgICAJCWlmICg8JT1uc2NvcGUlPi5fbm9kZSAmJiA8JT1uc2NvcGUlPi5fbm9kZS5fcGFyZW50ICYmIGF3YWl0IGZSb3V0ZXIoPCU9bnNjb3BlJT4uX25vZGUucGFyZW50KCksIG0pKSB7DQogICAgCQkJbm9kZXMucHVzaCg8JT1uc2NvcGUlPi5fbm9kZS5wYXJlbnQoKSk7DQogICAgCQl9DQogICAgDQogICAgCQlmb3IgYXdhaXQgKGNvbnN0IGNuIG9mICg8JT1uc2NvcGUlPi5fbm9kZT88JT1uc2NvcGUlPi5fbm9kZS5wYXJlbnRfTm9kZXMoKTpbXSkpIHsNCiAgICAgICAgICAgICAgICBpZiAoYXdhaXQgZlJvdXRlcihjbiwgbSkpIHsNCiAgICAgICAgICAgICAgICAJbG9nKCdhZGRpbmcgY2hpbGQgbm9kZScsIGNuKTsNCiAgICAgICAgICAgICAgICAJbm9kZXMucHVzaChjbik7DQogICAgICAgICAgICAgICAgfQ0KICAgIAkJfQ0KICAgIA0KICAgIAkJLy8gcmVtb3ZlIGFueSBudWxscw0KICAgIAkJbm9kZXMgPSBub2Rlcy5mbGF0KCkuZmlsdGVyKG4gPT4gbik7DQogICAgCQkNCiAgICAJCWlmICghbm9kZXMubGVuZ3RoKSB7DQogICAgCQkJbm9kZXMucHVzaCg8JT1uc2NvcGUlPi5fbm9kZSk7DQogICAgCQl9DQogICAgCQkNCiAgICAJCW5vZGVzID0gdGhpcy5fdW5pcXVlKG5vZGVzLCAnX2NvZGUnKTsNCiAgICAJCWxvZygnbm9kZXMubGVuZ3RoJywgbm9kZXMubGVuZ3RoKTsNCg0KICAgIAkJZm9yIGF3YWl0IChjb25zdCBuIG9mIG5vZGVzKSB7DQogICAgCQkJbGV0IG5SZXQgPSBudWxsOw0KICAgIAkJCWxvZyhgJHttfSBAICR7bj8uY29kZSgpIHx8ICdMT0NBTCd9YCk7DQogICAgCQkJaWYgKCFuIHx8IHRoaXMuX3NhbWVFbnRpdHkoPCU9bnNjb3BlJT4uX25vZGUsIG4pKSB7DQogICAgCQkJCS8vIGxvY2FsIHNjcmlwdA0KICAgIAkJCQlmb3IgYXdhaXQgKGNvbnN0IHIgb2YgX19iZWZvcmVSdWxlcykgew0KICAgICAgICAgICAgICAgICAgICAgICAgPCV2YWx1ZU9mKCJyLlNjcmlwdCIpJT4NCiAgICAJCQkJCS8vYXdhaXQgdGhpcy5fU2NyaXB0KGNsYXNzTmFtZSwgci5TY3JpcHQsIG0sIHIuTmFtZSB8fCAnQmVmb3JlUnVsZScsIHNjb3BlLCBudWxsLCAuLi5sUGFyYW1zKTsNCiAgICAJCQkJfQ0KDQogICAgCQkJCW5SZXQgPSBhd2FpdCBmU2NyaXB0KCk7DQoNCiAgICAJCQkJZm9yIGF3YWl0IChjb25zdCByIG9mIF9fYWZ0ZXJSdWxlcykgew0KICAgICAgICAgICAgICAgICAgICAgICAgPCV2YWx1ZU9mKCJyLlNjcmlwdCIpJT4NCiAgICAJCQkJCS8vYXdhaXQgdGhpcy5fU2NyaXB0KGNsYXNzTmFtZSwgci5TY3JpcHQsIG0sIHIuTmFtZSB8fCAnQWZ0ZXJSdWxlJywgc2NvcGUsIG51bGwsIC4uLmxQYXJhbXMpOw0KICAgIAkJCQl9DQogICAgCQkJfSBlbHNlIHsNCiAgICAJCQkJblJldCA9IGF3YWl0IHNvdXJjZS5faW52b2tlTm9kZShuLCBtLCBvUGFyYW1zKTsNCiAgICAJCQl9DQogICAgDQogICAgCQkJcmVzdWx0cy5wdXNoKHsNCiAgICAJCQkJbm9kZTogbiwNCiAgICAJCQkJcmV0OiBuUmV0DQogICAgCQkJfSk7DQogICAgCQl9DQogICAgCQlsb2cocmVzdWx0cywgIl9leGVjdXRlIiwgJ1Jlc3VsdHMnKTsNCiAgICANCiAgICAJCWxldCBlcnJvcnMgPSByZXN1bHRzLmZpbHRlcihyID0+IHIucmV0ICYmIHIucmV0Ll9fZXhjZXB0aW9uKS5tYXAociA9PiAoew0KICAgIAkJCW5vZGU6IHIubm9kZSA/IHsNCiAgICAJCQkJY29kZTogci5ub2RlLmNvZGUoKSwNCiAgICAJCQkJYWRkcmVzczogci5ub2RlLmFkZHJlc3MoKQ0KICAgIAkJCX0gOiBudWxsLA0KICAgIAkJCV9fZXhjZXB0aW9uOiByLnJldC5fX2V4Y2VwdGlvbg0KICAgIAkJfSkpOw0KDQogICAgCQlpZiAoZXJyb3JzLmxlbmd0aCkgew0KICAgIAkJCXdhcm4oImVycm9ycyIsIGVycm9ycyk7DQogICAgCQl9DQogICAgDQogICAgCQlyZXR1cm4gcmVzdWx0czsNCiAgICAgICAgfWNhdGNoKGV4KXsNCiAgICAgICAgICAgIGVycm9yKGV4KTsNCiAgICAgICAgfQ0KPCUgfSU+DQoJfQ0KDQogICAgYXN5bmMgPCU9bU5hbWU9J19TY3JpcHQnJT4oY2xhc3NOYW1lLCBzY3JpcHQsIG0sIHR5cGUsIHNjb3BlLCBfbm9kZSwgLi4uc2ZBcmdzKXsNCiAgICAgICAgY2xhc3NOYW1lID0gY2xhc3NOYW1lIHx8ICI8JT1uTmFtZShjKSU+IjsNCiAgICAgICAgc2NvcGUgPSBzY29wZSB8fCA8JT1zY29wZSU+Ow0KICAgICAgICANCjwlIGlmKG1haW5DbGFzcygpIT1jKXslPg0KICAgICAgICByZXR1cm4gYXdhaXQgbmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKG1haW5DbGFzcygpLCB0cnVlKSU+KCkuPCU9bU5hbWUlPihjbGFzc05hbWUsIHNjcmlwdCwgbSwgdHlwZSwgc2NvcGUsIF9ub2RlLCAuLi5zZkFyZ3MpOw0KPCUgfWVsc2V7JT4NCiAgICAJaWYgKHR5cGVvZihzY3JpcHQpID09PSAndW5kZWZpbmVkJykgcmV0dXJuOw0KICAgIAkNCiAgICAgICAgdHJ5ew0KICAgIAkJaWYgKHR5cGVvZihzY3JpcHQpID09PSAnc3RyaW5nJykgc2NyaXB0ID0gdGhpcy5ydW5TY3JpcHQoYCgpID0+IHske3NjcmlwdH19YCk7DQogICAgDQogICAgCQlsZXQgcmV0ID0gbnVsbDsNCiAgICAJCWlmICh0eXBlb2Yoc2NyaXB0KSA9PT0gJ2Z1bmN0aW9uJykgew0KICAgIAkJCXJldCA9IGF3YWl0IHNjcmlwdCgpOw0KICAgIAkJfQ0KICAgIA0KICAgIAkJcmV0dXJuIHJldDsNCiAgICAgICAgfWNhdGNoKGV4KXsNCiAgICAgICAgICAgIDwlPXdhcm4oKSU+Y2xhc3NOYW1lLCBtLCB0eXBlLCBzY3JpcHQsIGV4KTsNCiAgICAgICAgfQ0KPCUgfSU+DQoJfQ0KDQogICAgPCU9bU5hbWU9J19zYW1lRW50aXR5JyU+KC4uLmFyRW50aXRpZXMpew0KICAgICAgICBpZihhckVudGl0aWVzLmxlbmd0aD09MCkgcmV0dXJuIGZhbHNlOw0KICAgICAgICBpZihhckVudGl0aWVzLmxlbmd0aD09MSkgYXJFbnRpdGllcy5wdXNoKHRoaXMpOw0KPCUgaWYobWFpbkNsYXNzKCkhPWMpeyU+DQogICAgICAgIHJldHVybiBuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUobWFpbkNsYXNzKCksIHRydWUpJT4oKS48JT1tTmFtZSU+KC4uLmFyRW50aXRpZXMpOw0KPCUgfWVsc2V7JT4NCiAgICAgICAgdHJ5ew0KICAgICAgICAgICAgcmV0dXJuIGFyRW50aXRpZXMuc2xpY2UoMSkuZXZlcnkoZSA9PiB7DQogICAgICAgICAgICAgICAgbGV0IHYgPSBhckVudGl0aWVzWzBdOw0KICAgICAgICAgICAgICAgIGxldCBuZWdUZXN0ID0gew0KICAgICAgICAgICAgICAgICAgICB2TnVsbDogdj09bnVsbCwNCiAgICAgICAgICAgICAgICAgICAgZU51bGw6IGU9PW51bGwsDQogICAgICAgICAgICAgICAgICAgIHZPYmplY3Q6IHR5cGVvZih2KSE9PSdvYmplY3QnLA0KICAgICAgICAgICAgICAgICAgICBlT2JqZWN0OiB0eXBlb2YoZSkhPT0nb2JqZWN0JywNCiAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgIDwlPWxvZygpJT4xLCBuZWdUZXN0KTsNCiAgICAgICAgICAgICAgICBpZihPYmplY3Qua2V5cyhPYmplY3QuYXNzaWduKHt9LCAuLi5PYmplY3Qua2V5cyhuZWdUZXN0KS5maWx0ZXIoayA9PiBuZWdUZXN0W2tdKS5tYXAoayA9PiAoe3YsIGUsIFtrXTogdHJ1ZX0pKSkpLmxlbmd0aCkgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgICAgIC8vIHBhc3NlZCBpbml0aWFsIGNvbnNpc3RlbmN5IGNoZWNrDQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgaWYodj09ZSkgcmV0dXJuIHRydWU7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgbmVnVGVzdCA9IHsNCiAgICAgICAgICAgICAgICAgICAgZXZDb25zdHI6IHYuY29uc3RydWN0b3IubmFtZSE9ZS5jb25zdHJ1Y3Rvci5uYW1lLA0KICAgICAgICAgICAgICAgICAgICBlRW50aXR5OiAhZS5FbnRpdHlDbGFzcywNCiAgICAgICAgICAgICAgICAgICAgdkVudGl0eTogIXYuRW50aXR5Q2xhc3MsDQogICAgICAgICAgICAgICAgICAgIGV2RW50aXR5TmFtZXM6IHR5cGVvZihlLkVudGl0eUNsYXNzLk5hbWUpIT09J3VuZGVmaW5lZCcgJiYgZS5FbnRpdHlDbGFzcy5OYW1lIT12LkVudGl0eUNsYXNzLk5hbWUsDQogICAgICAgICAgICAgICAgICAgIGV2RW50aXR5SWRzOiB0eXBlb2YoZS5FbnRpdHlDbGFzcy5JZCkhPT0ndW5kZWZpbmVkJyAmJiBlLkVudGl0eUNsYXNzLklkIT12LkVudGl0eUNsYXNzLklkLA0KICAgICAgICAgICAgICAgICAgICBldklEczogdi5JZD09di5JZCAmJiBlLklkPT1lLklkICYmIHYuSWQhPWUuSWQsDQogICAgICAgICAgICAgICAgICAgIGV2SGFzaDogdi5fdG9IYXNoKG51bGwsIHtvbmx5VW5pcXVlOiB0cnVlfSwgJzwlPW1OYW1lJT4nKSE9ZS5fdG9IYXNoKG51bGwsIHtvbmx5VW5pcXVlOiB0cnVlfSwgJzwlPW1OYW1lJT4nKSwNCiAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgIDwlPWxvZygpJT4yLCBuZWdUZXN0KTsNCiAgICAgICAgICAgICAgICBuZWdUZXN0ID0gT2JqZWN0LmFzc2lnbih7fSwgLi4uT2JqZWN0LmtleXMobmVnVGVzdCkuZmlsdGVyKGsgPT4gbmVnVGVzdFtrXSkubWFwKGsgPT4gKHt2LCBlLCBba106IHRydWV9KSkpOw0KICAgICAgICAgICAgICAgIGlmKCFPYmplY3Qua2V5cyhuZWdUZXN0KS5sZW5ndGgpIHJldHVybiB0cnVlOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIDwlPWxvZygpJT4zLCBuZWdUZXN0KTsNCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfWNhdGNoKGV4KXsNCiAgICAgICAgICAgIDwlPWVycm9yKCklPmV4KTsNCiAgICAgICAgfQ0KPCUgfSU+DQogICAgfQ0KDQogICAgPCU9bU5hbWU9J2dldCBTZXRfT24nJT4oKSB7DQogICAgICAgIGxldCByZXQgPSBuZXcgRGF0ZShNYXRoLm1heCgNCjwlIGMuRW50aXR5QXR0cmlidXRlcy5maWx0ZXIoZWEgPT4gIWVhLkVudGl0eU1ldGhvZCkuZm9yRWFjaChlYSA9PiB7JT4NCiAgICAgICAgICAgIHRoaXMuXzwlPW5OYW1lKGVhKSU+X3NldCwNCjwlIH0pJT4gICAgICAgICAgICANCjwlIGMuVHlwZWRBdHRyaWJ1dGVzLmZvckVhY2godGEgPT4geyBsZXQgdGFOYW1lID0gbk5hbWUodGEpICsgJ18nICsgdGEuRW50aXR5Q2xhc3MuUGx1cmFsLnJlcGxhY2UoLyAvZywgJ18nKTslPg0KICAgICAgICAgICAgdGhpcy5fPCU9dGFOYW1lJT5fc2V0LA0KPCUgfSklPg0KICAgICAgICApKTsNCiAgICAgICAgDQogICAgICAgIGlmKCFyZXQgfHwgIShyZXQgaW5zdGFuY2VvZiBEYXRlICYmICFpc05hTihyZXQpKSkgcmV0dXJuIHVuZGVmaW5lZDsNCiAgICAgICAgcmV0dXJuIHJldDsNCiAgICB9DQogICAgDQogICAgPCU9bU5hbWU9J2dldCBTZXRfQ291bnQnJT4oKSB7DQogICAgICAgIHJldHVybiBbDQo8JSBjLkVudGl0eUF0dHJpYnV0ZXMuZmlsdGVyKGVhID0+ICFlYS5FbnRpdHlNZXRob2QpLmZvckVhY2goZWEgPT4geyU+DQogICAgICAgICAgICB0aGlzLl88JT1uTmFtZShlYSklPl9zZXQsDQo8JSB9KSU+ICAgICAgICAgICAgDQo8JSBjLlR5cGVkQXR0cmlidXRlcy5mb3JFYWNoKHRhID0+IHsgbGV0IHRhTmFtZSA9IG5OYW1lKHRhKSArICdfJyArIHRhLkVudGl0eUNsYXNzLlBsdXJhbC5yZXBsYWNlKC8gL2csICdfJyk7JT4NCiAgICAgICAgICAgIHRoaXMuXzwlPXRhTmFtZSU+X3NldCwNCjwlIH0pJT4NCiAgICAgICAgXS5maWx0ZXIocyA9PiBzKS5sZW5ndGg7DQogICAgfQ0KICAgIA0KICAgIDwlPW1OYW1lPSdfZmxhdHRlbiclPihkZXB0aCl7DQogICAgICAgIDwlPXdhcm4oKSU+IkRFUFJFQ0FURUQiKTsNCiAgICAgICAgbGV0IHJldCA9IHt9Ow0KICAgICAgICBpZighZGVwdGgpIHJldHVybiByZXQ7DQo8JSBjLkVudGl0eUF0dHJpYnV0ZXMuZmlsdGVyKGVhID0+ICFlYS5FbnRpdHlNZXRob2QpLmZvckVhY2goZWEgPT4geyU+DQogICAgICAgIHJldC5fPCU9bk5hbWUoZWEpJT5fc2V0ID0gdGhpcy5fPCU9bk5hbWUoZWEpJT5fc2V0Ow0KICAgICAgICByZXQuXzwlPW5OYW1lKGVhKSU+X2Nvb3AgPSB0aGlzLl88JT1uTmFtZShlYSklPl9jb29wOw0KICAgICAgICByZXQuPCU9bk5hbWUoZWEpJT4gPSB0aGlzLjwlPW5OYW1lKGVhKSU+KCk/dGhpcy48JT1uTmFtZShlYSklPigpPCVpZihlYS5FbnRpdHlUeXBlKXslPi48JT1tTmFtZSU+KGRlcHRoLTEpPCV9JT46dGhpcy48JT1uTmFtZShlYSklPigpOw0KPCUgfSklPg0KPCUgYy5UeXBlZEF0dHJpYnV0ZXMuZm9yRWFjaCh0YSA9PiB7IGxldCB0YU5hbWUgPSBuTmFtZSh0YSkgKyAnXycgKyB0YS5FbnRpdHlDbGFzcy5QbHVyYWwucmVwbGFjZSgvIC9nLCAnXycpOyU+DQogICAgICAgIHJldC48JT10YU5hbWUlPiA9IHRoaXMuPCU9dGFOYW1lJT4oKS5tYXAodCA9PiB0P3QuPCU9bU5hbWUlPihkZXB0aC0xKTp0KTsNCjwlIH0pJT4NCiAgICAgICAgcmV0dXJuIHJldDsNCiAgICB9DQogICAgDQogICAgPCU9bU5hbWU9J190b0hhc2gnJT4oYXJncywgb3B0aW9ucywgZlNvdXJjZSl7DQogICAgICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9Ow0KICAgICAgICANCiAgICAgICAgbGV0IG9IYXNoID0gew0KICAgICAgICAgICAgY2xhc3M6ICI8JT1uTmFtZShjKSU+IiwNCiAgICAgICAgICAgIHNvdXJjZTogZlNvdXJjZSwNCiAgICAgICAgICAgIGFyZ3M6IGFyZ3MsDQogICAgICAgICAgICBfdGhpczoge30NCiAgICAgICAgfTsNCiAgICAgICAgDQogICAgICAgIGlmKCFvcHRpb25zLm5vVGhpcyAmJiBmU291cmNlIT0iPCU9bU5hbWUlPiIgJiYgKHR5cGVvZihvcHRpb25zLmRlcHRoKT09PSd1bmRlZmluZWQnIHx8IC0tb3B0aW9ucy5kZXB0aD4wKSl7DQogICAgICAgICAgICB0aGlzLl9fZXhwb3J0KG9IYXNoLl90aGlzLCB7DQogICAgICAgICAgICAgICAgT1BFUkFUT1JTOiAhb3B0aW9ucy5ub09wZXJhdG9ycywNCiAgICAgICAgICAgICAgICBfbWFwOiBvcHRpb25zLl9tYXAsDQogICAgICAgICAgICAgICAgVW5pcXVlOiBvcHRpb25zLm9ubHlVbmlxdWUsDQogICAgICAgICAgICAgICAgTnVsbDogdHJ1ZSwNCiAgICAgICAgICAgICAgICBJZDogKG9iaiwgaWRDb2RlLCB2KSA9PiBvYmpbaWRDb2RlXSA9IHYsDQo8JSBjLkVudGl0eUF0dHJpYnV0ZXMuZmlsdGVyKGVhID0+ICFlYS5FbnRpdHlNZXRob2QpLmZvckVhY2goZWEgPT4geyU+DQogICAgICAgICAgICAgICAgPCU9bk5hbWUoZWEpJT46IChvYmosIGVhQ29kZSwgdikgPT4gew0KICAgICAgICAgICAgICAgICAgICA8JSBpZihlYS5FbnRpdHlUeXBlKXslPmlmKG9wdGlvbnMubm9UeXBlcykgcmV0dXJuOzwlfSU+DQogICAgICAgICAgICAgICAgICAgIG9ialtlYUNvZGVdID0gPCUgaWYoZWEuRW50aXR5VHlwZSl7JT52P3YuPCU9bU5hbWUlPihudWxsLCBvcHRpb25zLCBmU291cmNlKTo8JX0lPigob3B0aW9ucy5vbmx5VW5pcXVlICYmIDwldmFsdWVPZihlYS5Jc1VuaXF1ZSklPik/KHZ8fG51bGwpOnYpOw0KICAgICAgICAgICAgICAgIH0sDQo8JSB9KSU+DQo8JSBjLlR5cGVkQXR0cmlidXRlcy5mb3JFYWNoKHRhID0+IHsgbGV0IHRhTmFtZSA9IG5OYW1lKHRhKSArICdfJyArIHRhLkVudGl0eUNsYXNzLlBsdXJhbC5yZXBsYWNlKC8gL2csICdfJyk7JT4NCiAgICAgICAgICAgICAgICA8JT10YU5hbWUlPjogKG9iaiwgZWFDb2RlLCB2KSA9PiBvYmpbZWFDb2RlXSA9ICh2IHx8IFtdKS5tYXAoX3YgPT4gX3YuPCU9bU5hbWUlPihudWxsLCBvcHRpb25zLCBmU291cmNlKSksDQo8JSB9KSU+DQo8JSBjLkVudGl0eUZpZWxkcy5mb3JFYWNoKGVmID0+IHslPg0KICAgICAgICAgICAgICAgIGVmXzwlPW5OYW1lKGVmKSU+OiAob2JqLCBlZkNvZGUsIHYpID0+IG9ialtlZkNvZGVdID0gdiwNCjwlIH0pJT4NCiAgICAgICAgICAgIH0sICI8JT1tTmFtZSU+Iik7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIGlmKG9wdGlvbnMubm9BcmdzKSBvSGFzaCA9IG9IYXNoLl90aGlzOw0KICAgICAgICByZXR1cm4gb3B0aW9ucy5ub0NvZGU/b0hhc2g6dGhpcy5oYXNoQ29kZShKU09OLnN0cmluZ2lmeShvSGFzaCkpOw0KICAgIH0NCg0KICAgIGFzeW5jIDwlPW1OYW1lPSdfYXV0aG9yaXplJyU+KHVzZXJuYW1lLCBwYXNzd29yZCwgYlNlcnZlcil7DQo8JSBpZihtYWluQ2xhc3MoKT09Yyl7JT4NCiAgICAgICAgaWYoIXVzZXJuYW1lICYmICFwYXNzd29yZCAmJiAhPCU9c2NvcGUlPi5fX3Rva2VuICYmIHRoaXMuVGVzdFsnPCU9bU5hbWUlPi51c2VybmFtZSddKXsNCiAgICAgICAgICAgIHVzZXJuYW1lID0gdGhpcy5UZXN0Wyc8JT1tTmFtZSU+LnVzZXJuYW1lJ107DQogICAgICAgICAgICBwYXNzd29yZCA9IHRoaXMuVGVzdFsnPCU9bU5hbWUlPi5wYXNzd29yZCddOw0KICAgICAgICB9DQoNCiAgICAgICAgaWYoYlNlcnZlcil7DQogICAgICAgICAgICBpZih1c2VybmFtZSAmJiAhPCU9c2NvcGUlPi5fdGVzdFVzZXIgJiYgdGhpcy5UZXN0Wyc8JT1tTmFtZSU+LnRlc3RVc2VyJ10pew0KICAgICAgICAgICAgICAgIDwlPXNjb3BlJT4uX3Rlc3RVc2VyID0gYXdhaXQgbmV3IDwlPXNjb3BlJT4uPCU9bk5hbWUoYywgdHJ1ZSklPigpLl9mcm9tRG9jdW1lbnQodGhpcy5UZXN0Wyc8JT1tTmFtZSU+LnRlc3RVc2VyJ10pLmFjdGl2ZSh0cnVlKS5lbmFibGVkKHRydWUpLnVzZXJuYW1lKHVzZXJuYW1lKS5wYXNzd29yZChwYXNzd29yZCkuc3RvcmUoKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGxldCByZXQgPSBhd2FpdCB0aGlzLnVzZXJuYW1lKHVzZXJuYW1lLCAnPScpLnBhc3N3b3JkKHBhc3N3b3JkLCAnPScpLmFjdGl2ZSh0cnVlKS5lbmFibGVkKHRydWUpLmZpbmQoKTsNCiAgICAgICAgICAgIDwlPWxvZygpJT4iU2VydmVyOiAiICsgYlNlcnZlcisiLCBPYmo6IiwgcmV0KTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgaWYocmV0KXsNCiAgICAgICAgICAgICAgICBpZih0eXBlb2YoanNvbndlYnRva2VuKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICAgICAgcmV0ID0ganNvbndlYnRva2VuLnNpZ24ocmV0Ll90b0RvY3VtZW50KCksIHRoaXMuX19jb25maWcoJ3NlY3JldCcpLCB7IGV4cGlyZXNJbjogJzE4MDBzJyB9KTsNCiAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgcmV0ID0gdGhpcy5fYnRvYShKU09OLnN0cmluZ2lmeShyZXQuX3RvRG9jdW1lbnQoKSkpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgcmV0ID0gew0KICAgICAgICAgICAgICAgIGFjY2Vzc190b2tlbjogcmV0LA0KICAgICAgICAgICAgfTsNCiAgICAgICAgICAgIDwlPWxvZygpJT4iU2VydmVyOiAiICsgYlNlcnZlcisiLCB0b2tlbjogIiwgcmV0KTsNCiAgICAgICAgICAgIHJldHVybiByZXQ7DQogICAgICAgIH1lbHNlew0KICAgICAgICAgICAgbGV0IGNsaWVudF9pZCA9IHRoaXMuX19jb25maWcoJ2NsaWVudF9pZCcpOw0KICAgICAgICAgICAgbGV0IGNsaWVudF9zZWNyZXQgPSB0aGlzLl9fY29uZmlnKCdzZWNyZXQnKTsNCiAgICANCiAgICAgICAgICAgIGlmKCF1c2VybmFtZSAmJiAhcGFzc3dvcmQgJiYgPCU9c2NvcGUlPi5fX3Rva2VuKXsNCiAgICAgICAgICAgICAgICA8JT1sb2coKSU+Ik5vIHVzZXJuYW1lL3Bhc3N3b3JkIGFuZCB0b2tlbiBhbHJlYWR5IGV4aXN0cyIpOw0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCg0KICAgIDwlaWYoX2NOYW1lKCdvQXV0aCBUb2tlbicpKXslPg0KICAgICAgICAgICAgbGV0IGRhdGEgPSB7DQogICAgICAgICAgICAgICAgZ3JhbnRfdHlwZTogJ3Bhc3N3b3JkJywNCiAgICAgICAgICAgICAgICB1c2VybmFtZSwNCiAgICAgICAgICAgICAgICBwYXNzd29yZCwNCiAgICAgICAgICAgICAgICBjbGllbnRfaWQsDQogICAgICAgICAgICAgICAgY2xpZW50X3NlY3JldCwNCiAgICAgICAgICAgIH07DQogICAgICAgICAgICANCiAgICAgICAgICAgIGxldCBjb25maWcgPSB7DQogICAgICAgICAgICAgICAgaGVhZGVyczogew0KICAgICAgICAgICAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCcNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9Ow0KICAgICAgICAgICAgaWYoIXVzZXJuYW1lICYmICFwYXNzd29yZCAmJiA8JT1zY29wZSU+Ll9fdG9rZW4gJiYgPCU9c2NvcGUlPi5fX3Rva2VuLnJlZnJlc2hfdG9rZW4pew0KICAgICAgICAgICAgICAgIGRhdGEgPSB7DQogICAgICAgICAgICAgICAgICAgIGdyYW50X3R5cGU6ICJyZWZyZXNoX3Rva2VuIiwNCiAgICAgICAgICAgICAgICAgICAgcmVmcmVzaF90b2tlbjogPCU9c2NvcGUlPi5fX3Rva2VuLnJlZnJlc2hfdG9rZW4sDQogICAgICAgICAgICAgICAgICAgIGNsaWVudF9pZCwNCiAgICAgICAgICAgICAgICAgICAgY2xpZW50X3NlY3JldCwNCiAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgIGNvbmZpZy5oZWFkZXJzLkF1dGhvcml6YXRpb24gPSBgJHs8JT1zY29wZSU+Ll9fdG9rZW4udG9rZW5fdHlwZX0gJHs8JT1zY29wZSU+Ll9fdG9rZW4uYWNjZXNzX3Rva2VufWA7DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIGxldCByZXQgPSBhd2FpdCBheGlvcy5wb3N0KGBodHRwJHs8JT1uc2NvcGUlPi5fbm9kZS5wYXJlbnQoKS5zZWN1cmUoKT8ncyc6Jyd9Oi8vJHs8JT1uc2NvcGUlPi5fbm9kZS5wYXJlbnQoKS5hZGRyZXNzKCl9OiR7PCU9bnNjb3BlJT4uX25vZGUucGFyZW50KCkucG9ydCgpIHx8IDMwMDB9L29hdXRoL3Rva2VuYCwgT2JqZWN0LmtleXMoZGF0YSkubWFwKGtleSA9PiBrZXkgKyAnPScgKyBkYXRhW2tleV0pLmpvaW4oJyYnKSwgY29uZmlnKTsNCiAgICAgICAgICAgIGlmKHJldC5kYXRhLmFjY2Vzc190b2tlbil7DQogICAgICAgICAgICAgICAgPCU9c2NvcGUlPi5fX3Rva2VuID0gcmV0LmRhdGE7DQoNCiAgICAgICAgICAgICAgICBpZig8JT1zY29wZSU+Ll9fdG9rZW4ucmVmcmVzaF90b2tlbil7DQogICAgICAgICAgICAgICAgICAgIGlmKGF4aW9zLmludGVyY2VwdG9ycy5yZXNwb25zZS5jbGVhcikgYXhpb3MuaW50ZXJjZXB0b3JzLnJlc3BvbnNlLmNsZWFyKCk7DQogICAgICAgICAgICAgICAgICAgIGF4aW9zLmludGVyY2VwdG9ycy5yZXNwb25zZS51c2UocmVzcG9uc2UgPT4gcmVzcG9uc2UsIGFzeW5jIGVycm9yID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG9yaWdpbmFsUmVxdWVzdCA9IGVycm9yLmNvbmZpZzsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlcnJvci5yZXNwb25zZS5zdGF0dXMgPT09IDQwMSAmJiAhb3JpZ2luYWxSZXF1ZXN0Ll9yZXRyeSAmJiBvcmlnaW5hbFJlcXVlc3QuaGVhZGVycy5BdXRob3JpemF0aW9uLmluZGV4T2YoPCU9c2NvcGUlPi5fX3Rva2VuLmFjY2Vzc190b2tlbik+MCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9yaWdpbmFsUmVxdWVzdC5fcmV0cnkgPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuX2F1dGhvcml6ZSgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9yaWdpbmFsUmVxdWVzdC5oZWFkZXJzLkF1dGhvcml6YXRpb24gPSAnQmVhcmVyICcgKyA8JT1zY29wZSU+Ll9fdG9rZW4uYWNjZXNzX3Rva2VuOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBheGlvcyhvcmlnaW5hbFJlcXVlc3QpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycm9yKTsNCiAgICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgIDwlIH1lbHNlIGlmKGF1dGhDbGFzcyl7JT4NCiAgICAJPCU9c2NvcGUlPi5fX3Rva2VuID0gYXdhaXQgbmV3IDwlPXNjb3BlJT4uPCU9bk5hbWUoYXV0aENsYXNzKSU+KCkudXNlcm5hbWUodXNlcm5hbWUpLnBhc3N3b3JkKHBhc3N3b3JkKS48JT1tTmFtZS5yZXBsYWNlKCdfJywgJycpJT4oKTsNCiAgICA8JSB9ZWxzZXslPg0KICAgICAgICA8JT13YXJuKCklPiJObyBhdXRob3JpemF0aW9uIGRlZmluZWQiKTsNCiAgICA8JSB9JT4NCiAgICAgICAgfQ0KPCUgfWVsc2V7JT4NCiAgICAgICAgcmV0dXJuIGF3YWl0IG5ldyA8JT1zY29wZSU+LjwlPW5OYW1lKG1haW5DbGFzcygpKSU+KCkuPCU9bU5hbWUlPih1c2VybmFtZSwgcGFzc3dvcmQsIGJTZXJ2ZXIpOw0KPCV9JT4NCiAgICB9DQogICAgDQo8JSBpZihtYWluQ2xhc3MoKT09Yyl7JT4NCiAgICBhc3luYyA8JT1tTmFtZT0nX3NlcnZlciclPihvcHRpb25zPXt9KSB7DQogICAgICAgIHRyeXsNCiAgICAgICAgICAgIGlmKG9wdGlvbnMuY2xlYXJDb25zb2xlKSBjb25zb2xlLmNsZWFyKCk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGlmKDwlPXNjb3BlJT4uX19Ub29scykgPCU9c2NvcGUlPi5Ub29scyA9IDwlPXNjb3BlJT4uX19Ub29sczsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKGdsb2JhbCk9PT0ndW5kZWZpbmVkJyAmJiB0eXBlb2YoPCU9c2NvcGUlPi5ocmVmcykhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgIAkJZm9yIGF3YWl0IChjb25zdCBsIG9mIDwlPXNjb3BlJT4uaHJlZnMpIHsNCiAgICAgICAgCQkJYXdhaXQgdGhpcy5yZXF1aXJlKGwubGliLCA8JT1zY29wZSU+LmhyZWZzLCBhc3luYyBfbCA9PiB7DQogICAgPCUgaWYoX2NOYW1lKCdTdG9yZWRTY3JpcHQnKSl7JT4NCiAgICAgICAgICAgICAgICAgICAgaWYoX2wuc2NyaXB0ICYmIDwlPXNjb3BlJT4uVG9vbHMpIHJldHVybiBhd2FpdCBuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUoJ1N0b3JlZFNjcmlwdCcsIHRydWUpJT4oKS5fZnJvbURvY3VtZW50KF9sLnNjcmlwdCkubG9hZFNjcmlwdCgpOw0KICAgIDwlIH0lPg0KICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBsZXQgc2VjdXJlID0gdGhpcy5fX2NvbmZpZygnc2VjdXJlJyk7DQogICAgICAgICAgICBpZih0eXBlb2YoZ2xvYmFsKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICAvLyBnbG9iYWxzDQogICAgICAgICAgICAgICAgdmFyIGdsb2JhbE1vZHVsZXMgPSB7DQogICAgICAgICAgICAgICAgICAgIGV4cHJlc3M6ICdleHByZXNzJywNCiAgICAgICAgICAgICAgICAgICAgaHR0cHM6ICdodHRwcycsDQogICAgICAgICAgICAgICAgICAgIGh0dHA6ICdodHRwJywNCiAgICAgICAgICAgICAgICAgICAgc2VsZnNpZ25lZDogJ3NlbGZzaWduZWQnLA0KICAgICAgICAgICAgICAgICAgICB1dGlsOiAndXRpbCcsDQogICAgICAgICAgICAgICAgICAgIGNvcnM6ICdjb3JzJywNCiAgICAgICAgICAgICAgICAgICAgYm9keVBhcnNlcjogJ2JvZHktcGFyc2VyJywNCiAgICAgICAgICAgICAgICAgICAgYXhpb3M6ICdheGlvcycsDQogICAgICAgICAgICAgICAgICAgIC8vY3J5cHRvOiAnY3J5cHRvJywNCiAgICAgICAgICAgICAgICAgICAgb3M6ICdvcycsDQogICAgICAgICAgICAgICAgICAgIC8vam1lc3BhdGg6ICdqbWVzcGF0aCcsDQogICAgICAgICAgICAgICAgICAgIGpzb25wYXRoOiAnanNvbnBhdGgnLA0KICAgICAgICAgICAgICAgICAgICBqc29uYXRhOiAnanNvbmF0YScsDQogICAgICAgICAgICAgICAgICAgIERvdE9iamVjdDogJ2RvdC1vYmplY3QnLA0KICAgICAgICAgICAgICAgICAgICBtYWNoaW5laWQ6ICdub2RlLW1hY2hpbmUtaWQnLA0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgbWluaW1pc3Q6ICdtaW5pbWlzdCcsDQogICAgICAgICAgICAgICAgDQo8JSBpZihjLkNvbmZpZyAmJiBjLkNvbmZpZ1snZ3JhcGhxbCddKXslPg0KICAgICAgICAgICAgICAgICAgICBncmFwaHFsSFRUUDogJ2V4cHJlc3MtZ3JhcGhxbCcsDQogICAgICAgICAgICAgICAgICAgIGdyYXBocWw6ICdncmFwaHFsJywNCiAgICAgICAgICAgICAgICAgICAgcGxheWdyb3VuZDogJ2dyYXBocWwtcGxheWdyb3VuZC1taWRkbGV3YXJlLWV4cHJlc3MnLA0KPCUgfSU+DQoNCjwlIGlmKGMuQ29uZmlnICYmIGMuQ29uZmlnWydlbWFpbC5ob3N0J10peyU+DQogICAgICAgICAgICAgICAgICAgIG5vZGVtYWlsZXI6ICdub2RlbWFpbGVyJywNCjwlIH0lPg0KDQo8JSBpZihjLkNvbmZpZyAmJiBjLkNvbmZpZ1sndG90cC5zZWNyZXQnXSl7JT4NCiAgICAgICAgICAgICAgICAgICAgb3RwYXV0aDogJ290cGF1dGgnLA0KPCUgfSU+DQoNCjwlIGlmKF9jTmFtZSgnTm9kZScpKXslPg0KICAgICAgICAgICAgICAgICAgICBjaGlsZF9wcm9jZXNzOiAnY2hpbGRfcHJvY2VzcycsDQo8JSB9JT4NCg0KPCUgaWYoX2NOYW1lKCdFdmVudCcpKXslPg0KICAgICAgICAgICAgICAgICAgICBldmVudHM6ICdldmVudHMnLA0KICAgICAgICAgICAgICAgICAgICBzb2NrZXRpbzogJ3NvY2tldC5pbycsDQogICAgICAgICAgICAgICAgICAgIG1xdHQ6ICdtcXR0JywNCiAgICAgICAgICAgICAgICAgICAgYW1xcGxpYjogJ2FtcXBsaWInLA0KICAgICAgICAgICAgICAgICAgICBwcm90b2J1ZmpzOiAncHJvdG9idWZqcycsDQo8JSB9JT4NCg0KPCUgaWYobWFpbkNsYXNzKFsnRmlsZVN5c3RlbSddKSl7JT4NCiAgICAgICAgICAgICAgICAgICAgZnM6ICdmcycsDQo8JSB9JT4NCg0KPCUgaWYobWFpbkNsYXNzKFsnS2Fma2EnXSkpeyU+DQogICAgICAgICAgICAgICAgICAgIGthZmthanM6ICdrYWZrYWpzJywNCjwlIH0lPg0KDQo8JSBpZihtYWluQ2xhc3MoWydOZW80aiddKSl7JT4NCiAgICAgICAgICAgICAgICAgICAgbmVvNGo6ICduZW80ai1kcml2ZXInLA0KPCUgfSU+DQoNCjwlIGlmKF9jTmFtZSgnb0F1dGggVG9rZW4nKSl7JT4NCiAgICAgICAgICAgICAgICAgICAgT0F1dGhTZXJ2ZXI6ICdleHByZXNzLW9hdXRoLXNlcnZlcicsDQo8JSB9ZWxzZSBpZihhdXRoQ2xhc3MpeyU+DQogICAgICAgICAgICAgICAgICAgIGpzb253ZWJ0b2tlbjogJ2pzb253ZWJ0b2tlbicsDQo8JSB9JT4NCg0KDQo8JSBpZihtYWluQ2xhc3MoWydTcWxEQiddKSl7JT4NCiAgICAgICAgICAgICAgICAgICAgc3FsaXRlOiAnc3FsaXRlMycsDQogICAgICAgICAgICAgICAgICAgIG15c3FsOiAnbXlzcWwnLA0KICAgICAgICAgICAgICAgICAgICBwb3N0Z3JlczogJ3BnJywNCjwlIH0lPg0KPCUgaWYobWFpbkNsYXNzKFsnU25vd0ZsYWtlJ10pKXslPg0KICAgICAgICAgICAgICAgICAgICBzbm93Zmxha2U6ICdzbm93Zmxha2Utc2RrJywNCjwlIH0lPg0KPCUgaWYobWFpbkNsYXNzKFsnTW9uZ29EQiddKSl7JT4NCiAgICAgICAgICAgICAgICAgICAgbW9uZ29kYjogJ21vbmdvZGInLA0KPCUgfSU+DQo8JSBpZihtYWluQ2xhc3MoWydSeERCJ10pKXslPg0KICAgICAgICAgICAgICAgICAgICBSeERCOiAncnhkYicsDQo8JSB9JT4NCjwlIGlmKG1haW5DbGFzcyhbJ0V4Y2VsJ10pKXslPg0KICAgICAgICAgICAgICAgICAgICBYTFNYOiAneGxzeCcsDQo8JSB9JT4NCiAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgbGV0IG1pc3NpbmdHbG9iYWxNb2R1bGVzID0gT2JqZWN0LmVudHJpZXMoZ2xvYmFsTW9kdWxlcykubWFwKGUgPT4gew0KICAgICAgICAgICAgICAgICAgICB0cnl7DQogICAgICAgICAgICAgICAgICAgICAgICBnbG9iYWxbZVswXV0gPSByZXF1aXJlKGVbMV0pOw0KICAgICAgICAgICAgICAgICAgICB9Y2F0Y2goZXgpew0KICAgICAgICAgICAgICAgICAgICAgICAgPCU9d2FybigpJT5leCk7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZVsxXTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0pLmZpbHRlcihlID0+IGUpOw0KICAgICAgICAgICAgICAgIGlmKG1pc3NpbmdHbG9iYWxNb2R1bGVzLmxlbmd0aCkgPCU9d2FybigpJT4ibnBtIGluc3RhbGwgIiArIG1pc3NpbmdHbG9iYWxNb2R1bGVzLmpvaW4oJyAnKSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAJCTwlPWxvZygpJT5gU3RhcnRpbmcgWyR7PCU9bnNjb3BlJT4uX25vZGU/PCU9bnNjb3BlJT4uX25vZGUuY29kZSgpOicnfV0uLi5gKTsNCg0KCQkJaWYgKG9wdGlvbnMubG9hZFRvb2xzKSBhd2FpdCBuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUoJ05vZGUnLCB0cnVlKSB8fCBfY05hbWUoKSU+KCkuX2xvYWRUb29scyhvcHRpb25zLnNhdmVUb29scyk7DQoNCjwlIGlmKF9jTmFtZSgnTm9kZScpKXsgIC8qIFRvb2xzIGZpcnN0IG9yIE5vZGVzIGZpcnN0Pz8/ICovJT4NCiAgICAgICAgICAgIGlmKG9wdGlvbnMuaW5pdE5vZGUpew0KICAgICAgICAgICAgICAgIDwlPW5zY29wZSU+Ll9ub2RlID0gYXdhaXQgbmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKCdOb2RlJywgdHJ1ZSklPigpLnNlY3VyZShzZWN1cmUpLmluaXQodGhpcy5fX2NvbmZpZygnaW5pdC5sb29wJywgMC41KSk7DQogICAgICAgICAgICAgICAgaWYodHlwZW9mKDwlPW5zY29wZSU+Ll9ub2RlKT09PSd1bmRlZmluZWQnKSByZXR1cm4gPCU9ZXJyb3IoKSU+IjwlPW5zY29wZSU+Ll9ub2RlIGlzIHVuZGVmaW5lZCEiKTsNCiAgICAgICAgICAgIH0NCjwlIH0lPg0KDQogICAgCQlpZiAodHlwZW9mKHRoaXMuaW5pdCk9PT0nZnVuY3Rpb24nICYmIG9wdGlvbnMuaW5pdFNlbGYpIHsNCiAgICAJCQlhd2FpdCB0aGlzLmluaXQoKTsNCiAgICANCiAgICAJCQlsZXQgc3FsVG9vbCA9ICg8JT1zY29wZSU+LlRvb2xzIHx8IFtdKS5maW5kKHQgPT4gdC5fX2RtbFN0YXRlbWVudHMpOw0KICAgIAkJCWlmIChvcHRpb25zLmNvcHlETUwgJiYgc3FsVG9vbCkgew0KICAgIAkJCQlsZXQgZG1scyA9IHNxbFRvb2wuX19kbWxTdGF0ZW1lbnRzOw0KICAgIAkJCQlpZiAoc3FsVG9vbC50eXBlLm5hbWUgPT0gJ1NxbERCJykgZG1scyA9IFsgLyoiQ3VzdG9tZXJzIiwgIk9yZGVycyIsICJTaGlwcGluZ3MiLCAqLyAiZGVtbyJdLm1hcCh0ID0+IGBkcm9wIHRhYmxlIGlmIGV4aXN0cyAke3R9YCkuY29uY2F0KGRtbHMpOw0KICAgIAkJCQlfRnJFTUQuX2NvcHlUZXh0VG9DbGlwYm9hcmQoZG1scy5qb2luKCc7XG4nKSk7DQogICAgCQkJfQ0KICAgIAkJfQ0KDQo8JSBpZihfY05hbWUoJ05vZGUgVHlwZScpKXsgLyp0b2RvOiByZXBsYWNlIHRoaXMgd2l0aCBhbiBPVEFVcGRhdGUgY29uY2VwdCAqLyU+DQogICAgICAgICAgICAvLyByZWZyZXNoIHNjcmlwdA0KICAgICAgICAgICAgdGhpcy5zZXRJbnRlcnZhbChudWxsLCBhc3luYyAoLyp2ZXJzaW9uKi8pID0+IHsNCiAgICAgICAgICAgICAgICBpZih0aGlzLnNyKCkuYkxvY2FsKSByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgbGV0IHNjdCA9IG5ldyA8JT1zY29wZSU+LjwlPV9jTmFtZSgnTm9kZSBUeXBlJywgdHJ1ZSklPigpLl9mcm9tRG9jdW1lbnQoPCU9c2NvcGUlPi5fXzwlPV9jTmFtZSgnTm9kZSBUeXBlJyklPiB8fCB7bmFtZTogJ05vZGVKUyd9KTsNCiAgICAgICAgICAgICAgICBsZXQgY3QgPSBhd2FpdCBzY3QuZmluZCgpOw0KICAgICAgICAgICAgICAgIGlmKCFjdCB8fCAhY3QuYWN0aXZlKCkgfHwgIWN0LmVuYWJsZWQoKSkgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIGlmKCAhc2N0LmRhdGUoKSB8fCAoKGN0LmRhdGUoKS5nZXRUaW1lKCkgLSBzY3QuZGF0ZSgpLmdldFRpbWUoKSkvMTAwMCkgPiA1ICl7DQogICAgICAgICAgICAgICAgICAgIDwlPWxvZygpJT5gTmV3ZXIgdmVyc2lvbiBmb3VuZDogW2RhdGU6ICR7Y3QuZGF0ZSgpLnRvSVNPU3RyaW5nKCl9LCB0b29sOiAke2N0LlRvb2wubmFtZX1dLCBzdG9yaW5nLi4uYCk7DQogICAgICAgICAgICAgICAgICAgIGlmKHR5cGVvZihnbG9iYWwpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gd2Ugd2FudCB0byBzdG9yZSB0aGUgY29udGVudCBkaXJlY3RseSB0byB0aGUgbm9kZWpzLmpzIGZpbGUNCiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IGN0Ll9maWxlc3lzdGVtKGN0LmNvZGUoKSArICcuanMnLCB0aGlzLl9hdG9iKGN0LnJlbWFyaygpKSk7DQogICAgICAgICAgICAgICAgICAgIH1lbHNlIGlmKHR5cGVvZih3aW5kb3cpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgICAgICAgICAgdHJ5ew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKHdpbmRvdy5zZWxmICE9PSB3aW5kb3cudG9wKXsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPCU9bG9nKCklPiJpRnJhbWUgc2hvdWxkIGJlIHJlc3RhcnRlZC4uLiIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8JT1sb2coKSU+IndpbmRvdyBsb2NhdGlvbiByZWxvYWRpbmcuLi4iKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy93aW5kb3cubG9jYXRpb24ucmVsb2FkKCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfWNhdGNoKGV4KXsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8JT1lcnJvcigpJT4iZnJhbWUgY2hlY2siLCBleCk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgICAgICAgICAgPCU9c2NvcGUlPi5fXzwlPV9jTmFtZSgnTm9kZSBUeXBlJyklPiA9IHNjdC5kYXRlKGN0LmRhdGUoKSkubmFtZShjdC5uYW1lKCkpLmNvZGUoY3QuY29kZSgpKS5fdG9Eb2N1bWVudCgpOw0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICAgICAgfSwgMC41KTsNCjwlIH0lPg0KICAgICAgICANCiAgICAgICAgICAgIGlmKG9wdGlvbnMubG9hZENvbnRlbnQgJiYgdHlwZW9mKHdpbmRvdykhPT0ndW5kZWZpbmVkJykgd2luZG93Lm9uaGFzaGNoYW5nZSA9IGFzeW5jICgpID0+IGRvY3VtZW50LmJvZHkgPSBhd2FpdCB0aGlzLl9leHBvcnQoe3RtcDogbG9jYXRpb24uaGFzaC5wYWdlfSk7DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YoZ2xvYmFsKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICBjb25zdCBhcHAgPSBleHByZXNzKCk7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgYXBwLnVzZShjb3JzKCkpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBhcHAudXNlKGV4cHJlc3MudXJsZW5jb2RlZCh7ZXh0ZW5kZWQ6IHRydWUsIGxpbWl0OiAnNTBtYid9KSk7DQogICAgICAgICAgICAgICAgYXBwLnVzZShib2R5UGFyc2VyLmpzb24oew0KICAgICAgICAgICAgICAgICAgICB2ZXJpZnk6IChyZXEsIHJlcywgYnVmKSA9PiByZXEucmF3Qm9keSA9IGJ1Zg0KICAgICAgICAgICAgICAgIH0pKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgZ2xvYmFsLmF1dGhlbnRpY2F0ZSA9IGFzeW5jIChyZXEsIHJlcywgbmV4dCkgPT4gew0KICAgICAgICAgICAgICAgICAgICBjb25zdCBhdXRoSGVhZGVyID0gcmVxLmhlYWRlcnNbJ2F1dGhvcml6YXRpb24nXTsNCiAgICAgICAgICAgICAgICAgICAgY29uc3QgdG9rZW4gPSBhdXRoSGVhZGVyICYmIGF1dGhIZWFkZXIuc3BsaXQoJyAnKVsxXTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIGlmICh0b2tlbiA9PSBudWxsKSByZXR1cm4gcmVzLnNlbmRTdGF0dXMoNDAxKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIGpzb253ZWJ0b2tlbi52ZXJpZnkodG9rZW4sIHRoaXMuX19jb25maWcoJ3NlY3JldCcpLCAoZXJyLCBvYmopID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlcnIpIHJldHVybiByZXMuc2VuZFN0YXR1cyg0MDMpOw0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIHJlcS5fX2F1dGhvcml6YXRpb24gPSBvYmo7DQogICAgICAgICAgICAgICAgICAgICAgICBuZXh0KCk7DQogICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgIH07DQogICAgICAgIA0KPCUgaWYoX2NOYW1lKCdvQXV0aCBUb2tlbicpKXslPg0KICAgICAgICAgICAgICAgIGFwcC5vYXV0aCA9IG5ldyBPQXV0aFNlcnZlcih7DQogICAgICAgICAgICAgICAgICAgIGRlYnVnOiB0cnVlLA0KICAgICAgICAgICAgICAgICAgICAvLyB1c2VFcnJvckhhbmRsZXI6IHRydWUsDQogICAgICAgICAgICAgICAgICAgIC8vIGNvbnRpbnVlTWlkZGxld2FyZTogdHJ1ZSwNCiAgICAgICAgICAgICAgICAgICAgLy8gcmVxdWlyZUNsaWVudEF1dGhlbnRpY2F0aW9uOiB7IHBhc3N3b3JkOiBmYWxzZSB9LA0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgbW9kZWw6ICgoKSA9PiAoew0KICAgICAgICAgICAgICAgIAkJZ2V0QWNjZXNzVG9rZW46IGJlYXJlclRva2VuID0+IG5ldyA8JT1zY29wZSU+Lk9BdXRoX1Rva2VuKCkuYWNjZXNzVG9rZW4oYmVhcmVyVG9rZW4pLmFjdGl2ZSh0cnVlKS5lbmFibGVkKHRydWUpLmZpbmQoKS50aGVuKHQgPT4gYXBwLm9hdXRoLmhhbmRsZXIodCwgJ2dldEFjY2Vzc1Rva2VuJykpLnRoZW4odCA9PiB7dC5hY2Nlc3NUb2tlbkV4cGlyZXNBdCA9IG5ldyBEYXRlKHQuYWNjZXNzVG9rZW5FeHBpcmVzT24pOyByZXR1cm4gdH0pLA0KICAgICAgICAgICAgICAgICAgICAgICAgZ2V0Q2xpZW50OiAoY2xpZW50SWQsIGNsaWVudFNlY3JldCkgPT4gbmV3IDwlPXNjb3BlJT4uT0F1dGhfQ2xpZW50KCkuaW5pdCgpLmZpbmFsbHkoKCkgPT4gbmV3IDwlPXNjb3BlJT4uT0F1dGhfQ2xpZW50KCkuaWQoY2xpZW50SWQpLnNlY3JldChjbGllbnRTZWNyZXQpLmFjdGl2ZSh0cnVlKS5lbmFibGVkKHRydWUpLmZpbmQoKSkudGhlbih0ID0+IGFwcC5vYXV0aC5oYW5kbGVyKHQsICdnZXRDbGllbnQnKSksDQogICAgICAgICAgICAgICAgCSAgICBnZXRVc2VyOiAodXNlcm5hbWUsIHBhc3N3b3JkKSA9PiBuZXcgPCU9c2NvcGUlPi48JT1uTmFtZShhdXRoQ2xhc3MpJT4oKS5hdXRob3JpemUodXNlcm5hbWUsIHBhc3N3b3JkKS50aGVuKHQgPT4gYXBwLm9hdXRoLmhhbmRsZXIodCwgJ2dldFVzZXInKSksDQogICAgICAgICAgICAgICAgCSAgICBzYXZlVG9rZW46ICh0b2tlbiwgY2xpZW50LCB1c2VyKSA9PiBuZXcgPCU9c2NvcGUlPi5PQXV0aF9Ub2tlbigpLl9mcm9tRG9jdW1lbnQodG9rZW4pLmNsaWVudChuZXcgPCU9c2NvcGUlPi5PQXV0aF9DbGllbnQoKS5fZnJvbURvY3VtZW50KGNsaWVudCkpLnVzZXIodXNlcikuYWN0aXZlKHRydWUpLmVuYWJsZWQodHJ1ZSkuc3RvcmUoKS50aGVuKHQgPT4gYXBwLm9hdXRoLmhhbmRsZXIodCwgJ3NhdmVUb2tlbicpKSwNCiAgICAgICAgICAgICAgICAJICAgIHJldm9rZVRva2VuOiB0b2tlbiA9PiBuZXcgPCU9c2NvcGUlPi5PQXV0aF9Ub2tlbigpLnJlZnJlc2hUb2tlbih0b2tlbi5yZWZyZXNoVG9rZW4pLmNsaWVudChuZXcgPCU9c2NvcGUlPi5PQXV0aF9DbGllbnQoKS5pZCh0b2tlbi5jbGllbnQuaWQpLmFjdGl2ZSh0cnVlKS5lbmFibGVkKHRydWUpKS5maW5kKCkudGhlbih0ID0+IHQuZW5hYmxlZChmYWxzZSkuYWN0aXZlKGZhbHNlKS5zdG9yZSgpKS50aGVuKHQgPT4gYXBwLm9hdXRoLmhhbmRsZXIodCwgJ3Jldm9rZVRva2VuJykpLA0KICAgICAgICAgICAgICAgIAkgICAgZ2V0UmVmcmVzaFRva2VuOiByZWZyZXNoVG9rZW4gPT4gbmV3IDwlPXNjb3BlJT4uT0F1dGhfVG9rZW4oKS5yZWZyZXNoVG9rZW4ocmVmcmVzaFRva2VuKS5hY3RpdmUodHJ1ZSkuZW5hYmxlZCh0cnVlKS5maW5kKDIvKndoeSovKS50aGVuKHQgPT4gdC5fdG9Eb2N1bWVudCgpKS50aGVuKHQgPT4ge3QucmVmcmVzaFRva2VuRXhwaXJlc0F0ID0gbmV3IERhdGUodC5yZWZyZXNoVG9rZW5FeHBpcmVzT24pOyByZXR1cm4gdH0pLA0KICAgICAgICAJICAgICAgICB9KSkoKQ0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgIGFwcC5vYXV0aC5oYW5kbGVyID0gKHQsIG0pID0+IHsNCiAgICAgICAgICAgICAgICAgICAgdHJ5ew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYobSkgPCU9bG9nKCklPm0sIHQuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdC5fdG9Eb2N1bWVudCgpOw0KICAgICAgICAgICAgICAgICAgICB9Y2F0Y2goZXgpew0KICAgICAgICAgICAgICAgICAgICAgICAgPCU9d2FybigpJT5tLCBleC50b1N0cmluZygpKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH07DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGFwcC5wb3N0KCcvb2F1dGgvdG9rZW4nLCBhcHAub2F1dGgudG9rZW4oKSk7DQogICAgICAgICAgICAgICAgZ2xvYmFsLmF1dGhlbnRpY2F0ZSA9IGFwcC5vYXV0aC5hdXRoZW50aWNhdGUoKTsNCjwlIH0lPg0KDQo8JSBhckNsYXNzZXMuZm9yRWFjaChfYyA9PiBfYy5FbnRpdHlNZXRob2RzLmZpbHRlcihtID0+IG0uSXNQdWJsaWMpLmZvckVhY2gobSA9PiB7JT4NCiAgICAgICAgICAgICAgICBhcHAucG9zdCgnL21ldGhvZC88JT1uTmFtZShfYyklPi88JT1uTmFtZShtKSU+JywgKHJlcSwgcmVzKSA9PiB0aGlzLl9pbmJvdW5kQ2FsbChyZXEsIHJlcywgIjwlPW5OYW1lKF9jKSU+IiwgIjwlPW5OYW1lKG0pJT4iKSk7DQogICAgICAgICAgICAgICAgYXBwLmdldCgnL21ldGhvZC88JT1uTmFtZShfYyklPi88JT1uTmFtZShtKSU+JywgKHJlcSwgcmVzKSA9PiB0aGlzLl9pbmJvdW5kQ2FsbChyZXEsIHJlcywgIjwlPW5OYW1lKF9jKSU+IiwgIjwlPW5OYW1lKG0pJT4iKSk7DQo8JSB9KSklPg0KDQogICAgICAgICAgICAgICAgYXBwLnBvc3QoJy9tZXRob2QvOmNsYXNzLzptZXRob2QnLCBnbG9iYWwuYXV0aGVudGljYXRlLCAocmVxLCByZXMpID0+IHRoaXMuX2luYm91bmRDYWxsKHJlcSwgcmVzKSk7DQogICAgICAgICAgICAgICAgYXBwLmdldCgnL21ldGhvZC86Y2xhc3MvOm1ldGhvZCcsIGdsb2JhbC5hdXRoZW50aWNhdGUsIChyZXEsIHJlcykgPT4gdGhpcy5faW5ib3VuZENhbGwocmVxLCByZXMpKTsNCiAgICAgICAgDQo8JSBpZihjLkNvbmZpZyAmJiBjLkNvbmZpZ1snZ3JhcGhxbCddKXslPg0KICAgICAgICAgICAgICAgIGFwcC51c2UoJy9ncmFwaHFsJywgZ3JhcGhxbEhUVFAuZ3JhcGhxbEhUVFAoew0KICAgICAgICAgICAgICAgICAgICBzY2hlbWE6IGdyYXBocWwuYnVpbGRTY2hlbWEodGhpcy5fdG9HUUxTY2hlbWEoKSksDQogICAgICAgICAgICAgICAgICAgIHJvb3RWYWx1ZTogdGhpcy5fcWxSZXNvbHZlcigpLA0KICAgICAgICAgICAgICAgICAgICBncmFwaGlxbDogdGhpcy5fX2NvbmZpZygicGxheWdyb3VuZCIpLA0KICAgICAgICAgICAgICAgIH0pKTsNCiAgICAgICAgICAgICAgICBpZih0aGlzLl9fY29uZmlnKCJwbGF5Z3JvdW5kIikgJiYgdHlwZW9mKHBsYXlncm91bmQpIT09InVuZGVmaW5lZCIpIGFwcC5nZXQoJy9wbGF5Z3JvdW5kJywgcGxheWdyb3VuZC5kZWZhdWx0KHsgZW5kcG9pbnQ6ICcvZ3JhcGhxbCcgfSkpDQo8JSB9JT4NCg0KICAgICAgICAgICAgICAgIGlmKHRoaXMuX19jb25maWcoJ2VtYWlsLmhvc3QnKSl7DQogICAgICAgICAgICAgICAgICAgIDwlPXNjb3BlJT4udHJhbnNwb3J0ZXIgPSBub2RlbWFpbGVyLmNyZWF0ZVRyYW5zcG9ydCh7DQogICAgICAgICAgICAgICAgICAgICAgICBzZXJ2aWNlOiB0aGlzLl9fY29uZmlnKCdlbWFpbC5ob3N0JyksDQogICAgICAgICAgICAgICAgICAgICAgICBhdXRoOiB0aGlzLl9fY29uZmlnKCdlbWFpbC51c2VyJyk/ew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXI6IHRoaXMuX19jb25maWcoJ2VtYWlsLnVzZXInKSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXNzOiB0aGlzLl9fY29uZmlnKCdlbWFpbC5wYXNzd29yZCcpLA0KICAgICAgICAgICAgICAgICAgICAgICAgfTp1bmRlZmluZWQsDQogICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgLyoNCiAgICAgICAgICAgICAgICAgICAgYXdhaXQgPCU9c2NvcGUlPi50cmFuc3BvcnRlci5zZW5kTWFpbCh7DQogICAgICAgICAgICAgICAgICAgICAgICBmcm9tOiB0aGlzLl9fY29uZmlnKCdlbWFpbC5zZW5kZXInKSwNCiAgICAgICAgICAgICAgICAgICAgICAgIHRvLA0KICAgICAgICAgICAgICAgICAgICAgICAgc3ViamVjdCwNCiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQsDQogICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgICAgICAqLw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICBsZXQgcG9ydCA9IDwlPW5zY29wZSU+Ll9ub2RlPyg8JT1uc2NvcGUlPi5fbm9kZS5wb3J0KCkgfHwgMzAwMCk6MzAwMDsNCiAgICAgICAgICAgICAgICBsZXQgYWRkcmVzcyA9ICIwLjAuMC4wIjsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICBsZXQgbGlzdGVuID0gYXN5bmMgKCkgPT4gPCU9bG9nKCklPmA8JT1zY29wZSU+WyR7dGhpcy5pcEFkZHJlc3MoKX1dIGxpc3RlbmluZyBhdCBodHRwJHtzZWN1cmU/J3MnOicnfTovLyR7YWRkcmVzc306JHtwb3J0fWApOw0KICAgICAgICAgICAgICAgIGlmKHNlY3VyZSl7DQogICAgICAgICAgICAgICAgICAgIGxldCBjZXJ0ID0gbnVsbDsNCiAgICAgICAgICAgICAgICAgICAgaWYodGhpcy5fX2NvbmZpZygnc2VjdXJlLnByaXZhdGUnKSl7DQogICAgICAgICAgICAgICAgICAgICAgICBjZXJ0ID0gew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaXZhdGU6IChhd2FpdCBmcy5wcm9taXNlcy5yZWFkRmlsZSh0aGlzLl9fY29uZmlnKCdzZWN1cmUucHJpdmF0ZScpKSksDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2VydDogKGF3YWl0IGZzLnByb21pc2VzLnJlYWRGaWxlKHRoaXMuX19jb25maWcoJ3NlY3VyZS5jZXJ0JykpKSwNCiAgICAgICAgICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICAgICAgY2VydCA9IHNlbGZzaWduZWQuZ2VuZXJhdGUoW3sgbmFtZTogJ2NvbW1vbk5hbWUnLCB2YWx1ZTogJ25hbW1vdXIuY29tJyB9XSwgeyBkYXlzOiAzNjUgfSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgZ2xvYmFsLmV4U2VydmVyID0gaHR0cHMuY3JlYXRlU2VydmVyKHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGtleTogY2VydC5wcml2YXRlLA0KICAgICAgICAgICAgICAgICAgICAgICAgY2VydDogY2VydC5jZXJ0DQogICAgICAgICAgICAgICAgICAgIH0sIGFwcCkubGlzdGVuKHBvcnQsIGFkZHJlc3MsIGxpc3Rlbik7DQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIGdsb2JhbC5leFNlcnZlciA9IGh0dHAuY3JlYXRlU2VydmVyKGFwcCkubGlzdGVuKHBvcnQsIGFkZHJlc3MsIGxpc3Rlbik7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9Y2F0Y2goZXgpew0KICAgICAgICAgICAgPCU9ZXJyb3IoKSU+ZXgpOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICB9DQoNCiAgICBhc3luYyA8JT1tTmFtZT0nX2luYm91bmRDYWxsJyU+KHJlcSwgcmVzLCBjTmFtZSwgbU5hbWUpew0KICAgICAgICBsZXQgcmV0ID0ge307DQogICAgICAgIHRyeXsNCiAgICAgICAgICAgIHJldCA9IGF3YWl0IG5ldyA8JT1zY29wZSU+W3JlcS5wYXJhbXMuY2xhc3MgfHwgY05hbWVdKCkuX2ludm9rZShyZXEucGFyYW1zLm1ldGhvZCB8fCBtTmFtZSwgcmVxLmJvZHksIHJlcS5xdWVyeSwgcmVxLl9fYXV0aG9yaXphdGlvbik7DQogICAgICAgIH1jYXRjaChleCl7DQogICAgICAgICAgICA8JT1lcnJvcigpJT5leCk7DQogICAgICAgICAgICByZXQgPSB7DQogICAgICAgICAgICAgICAgRXhjZXB0aW9uOiAiRXhjZXB0aW9uOiAiICsgZXgsDQogICAgICAgICAgICB9Ow0KICAgICAgICB9DQoNCiAgICAgICAgaWYocmV0ICYmIHR5cGVvZihyZXQpPT09Im51bWJlciIpIHJldCA9IHJldC50b1N0cmluZygpOw0KICAgICAgICByZXMuc2VuZChyZXQpOw0KICAgIH0NCg0KPCUgaWYoYy5Db25maWdbJ2dyYXBocWwnXSl7JT4NCiAgICA8JT1tTmFtZT0nX3FsU2VsZWN0aW9ucyclPihzU2V0KXsNCiAgICAgICAgbGV0IHJldCA9IFtdOw0KICAgICAgICBpZighc1NldCB8fCAhc1NldC5zZWxlY3Rpb25zKSByZXR1cm4gcmV0Ow0KICAgICAgICANCiAgICAgICAgc1NldC5zZWxlY3Rpb25zLmZpbHRlcihzID0+IHMuc2VsZWN0aW9uU2V0KS5mb3JFYWNoKHMgPT4gew0KPCUgYy5FbnRpdHlBdHRyaWJ1dGVzLmZpbHRlcihlYSA9PiBlYS5FbnRpdHlUeXBlICYmICFlYS5FbnRpdHlNZXRob2QpLmZvckVhY2goZWEgPT4geyU+DQogICAgICAgICAgICBpZihzLm5hbWUudmFsdWU9PSI8JT1uTmFtZShlYSklPiIpew0KICAgICAgICAgICAgICAgIDwlPWxvZygpJT4nUmVmZXJlbmNlIGZvciA8JT1uTmFtZShlYSklPicsIHMpOw0KICAgICAgICAgICAgICAgIGxldCBzT2JqID0gbmV3IDwlPXNjb3BlJT4uPCU9bk5hbWUoZWEuRW50aXR5VHlwZSwgdHJ1ZSklPigpLjwlPW5OYW1lKGVhKSU+XzwlPWMuUGx1cmFsLnJlcGxhY2UoLyAvZywgJ18nKSU+KHRoaXMpOw0KICAgICAgICAgICAgICAgIHJldC5wdXNoKHNPYmopOw0KICAgICAgICAgICAgICAgIHJldC5wdXNoKC4uLnNPYmouX3FsU2VsZWN0aW9ucyhzLnNlbGVjdGlvblNldCkpOw0KICAgICAgICAgICAgfQ0KPCUgfSklPg0KICAgICAgICB9KTsNCiAgICAgICAgDQogICAgICAgIHJldHVybiByZXQ7DQogICAgfQ0KICAgIA0KICAgIDwlPW1OYW1lPSdfcWxSZXNvbHZlciclPigpew0KICAgICAgICByZXR1cm4gew0KPCUgYXJDbGFzc2VzLmZvckVhY2goX2MgPT4geyU+DQogICAgICAgICAgICA8JT1uTmFtZShfYyklPjogYXN5bmMgKHBhcmVudCwgYXJncywgY29udGV4dCwgaW5mbykgPT4gew0KICAgICAgICAgICAgICAgIGlmKCFwYXJlbnQuZGF0YSkgcGFyZW50LnF1ZXJ5ID0gcGFyZW50LnF1ZXJ5IHx8IHt9Ow0KICAgICAgICAgICAgICAgIGxldCBvYmogPSBuZXcgPCU9c2NvcGUlPi48JT1uTmFtZShfYyklPigpLl9mcm9tRG9jdW1lbnQocGFyZW50LnF1ZXJ5IHx8IHBhcmVudC5kYXRhKTsNCiAgICAgICAgICAgICAgICBsZXQgcmV0ID0gbnVsbDsNCiAgICAgICAgICAgICAgICBpZihwYXJlbnQucXVlcnkpew0KICAgICAgICAgICAgICAgICAgICBsZXQgZmllbGRzID0gbnVsbDsNCiAgICAgICAgICAgICAgICAgICAgcmV0ID0gYXdhaXQgb2JqLmZpbmRBbGwobnVsbCwgb2JqLl9xbFNlbGVjdGlvbnMoY29udGV4dC5maWVsZE5vZGVzWzBdLnNlbGVjdGlvblNldCksIG51bGwsIG51bGwsIFt0aGlzLl9fY29uZmlnKCdpZEZpZWxkJywgJ0lkJyldLmNvbmNhdChjb250ZXh0LmZpZWxkTm9kZXNbMF0uc2VsZWN0aW9uU2V0LnNlbGVjdGlvbnMubWFwKHMgPT4gcy5uYW1lLnZhbHVlKSkpOw0KICAgICAgICAgICAgICAgIH1lbHNlIGlmKHBhcmVudC5kYXRhKXsNCiAgICAgICAgICAgICAgICAgICAgcmV0ID0gYXdhaXQgb2JqLnN0b3JlKCk7DQogICAgICAgICAgICAgICAgICAgIGlmKG9iai5fX2Fzc2VydEVycm9yKSB0aHJvdyBvYmouX19hc3NlcnRFcnJvcjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYoQXJyYXkuaXNBcnJheShyZXQpKXsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldC5tYXAociA9PiByLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0P3JldC5fdG9Eb2N1bWVudCgpOnJldDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9LA0KICAgIDwlIF9jLkVudGl0eU1ldGhvZHMuZm9yRWFjaChfbSA9PiB7JT4NCiAgICAgICAgICAgIC8vIDwlPW5OYW1lKF9tKSU+OiAocGFyZW50LCBhcmdzLCBjb250ZXh0LCBpbmZvKSA9PiBuZXcgPCU9c2NvcGUlPi48JT1uTmFtZShfYyklPigpLjwlPW5OYW1lKF9tKSU+KCI8JT1uTmFtZShfbSklPiIsIHBhcmVudCwgYXJncywgY29udGV4dCwgaW5mbyksDQogICAgPCUgfSklPg0KPCUgfSklPg0KICAgICAgICB9Ow0KICAgIH0NCiAgICANCiAgICA8JT1tTmFtZT0nX3RvR1FMU2NoZW1hJyU+KCl7DQogICAgICAgIGxldCByZXQgPSBgDQp0eXBlIFF1ZXJ5IHsNCjwlIGFyQ2xhc3Nlcy5mb3JFYWNoKF9jID0+IHslPg0KICAgICIiIg0KICAgIEZpbmQgYWxsIG1hdGNoZXMgZm9yIDwlPW5OYW1lKF9jKSU+DQogICAgIiIiDQogICAgPCU9bk5hbWUoX2MpJT4ocXVlcnk6IDwlPW5OYW1lKF9jKSU+SW5wdXQpOiBbPCU9bk5hbWUoX2MpJT5dDQo8JSB9KSU+DQp9DQoNCnR5cGUgTXV0YXRpb24gew0KPCUgYXJDbGFzc2VzLmZvckVhY2goX2MgPT4geyU+DQogICAgIiIiDQogICAgU3RvcmUgYSBzaW5nbGUgPCU9bk5hbWUoX2MpJT4gb2JqZWN0DQogICAgIiIiDQogICAgPCU9bk5hbWUoX2MpJT4oZGF0YTogPCU9bk5hbWUoX2MpJT5JbnB1dCk6IDwlPW5OYW1lKF9jKSU+DQo8JSB9KSU+DQp9DQogICAgDQogICAgPCUgYXJDbGFzc2VzLmZvckVhY2goX2MgPT4geyU+DQoiIiINCklucHV0IHR5cGUgZm9yIDwlPW5OYW1lKF9jKSU+DQoiIiINCmlucHV0IDwlPW5OYW1lKF9jKSU+SW5wdXR7DQogICAgPCUgX2MuRW50aXR5QXR0cmlidXRlcy5maWx0ZXIoZWEgPT4gIWVhLkVudGl0eU1ldGhvZCkuZm9yRWFjaChlYSA9PiB7JT4NCiAgICA8JT1uTmFtZShlYSklPjogPCU9cWxUeXBlKGVhLCB0cnVlKSU+DQogICAgPCUgfSklPg0KICAgIDwlIF9jLlR5cGVkQXR0cmlidXRlcy5maWx0ZXIodGEgPT4gIXRhLkVudGl0eU1ldGhvZCAmJiB0YS5FbnRpdHlUeXBlKS5mb3JFYWNoKHRhID0+IHsgbGV0IHRhTmFtZSA9IHRhLkVudGl0eUNsYXNzLlBsdXJhbC5yZXBsYWNlKC8gL2csICdfJyk7ICU+DQogICAgPCU9bk5hbWUodGEpJT5fPCU9dGFOYW1lJT46IFs8JT1uTmFtZSh0YS5FbnRpdHlDbGFzcyklPklucHV0XQ0KICAgIDwlIH0pJT4NCiAgICBPUEVSQVRPUlM6IDwlPW5OYW1lKF9jKSU+T3BlcmF0b3INCn0NCg0KaW5wdXQgPCU9bk5hbWUoX2MpJT5PcGVyYXRvcnsNCiAgICA8JSBfYy5FbnRpdHlBdHRyaWJ1dGVzLmZpbHRlcihlYSA9PiAhZWEuRW50aXR5TWV0aG9kKS5mb3JFYWNoKGVhID0+IHslPg0KICAgIDwlPW5OYW1lKGVhKSU+OiBTdHJpbmcNCiAgICA8JSB9KSU+DQp9DQoNCiIiIg0KPCU9X2MuUmVtYXJrJT4NCiIiIg0KdHlwZSA8JT1uTmFtZShfYyklPnsNCiAgICBfaWQ6IElEIQ0KICAgIDwlIF9jLkVudGl0eUF0dHJpYnV0ZXMuZmlsdGVyKGVhID0+ICFlYS5FbnRpdHlNZXRob2QpLmZvckVhY2goZWEgPT4geyU+DQogICAgIiIiDQogICAgPCU9ZWEuUmVtYXJrJT4NCiAgICAiIiINCiAgICA8JT1uTmFtZShlYSklPjogPCU9cWxUeXBlKGVhKSU+PCU9ZWEuSXNSZXF1aXJlZD8nISc6JyclPg0KICAgIDwlIH0pJT4NCiAgICA8JSBfYy5UeXBlZEF0dHJpYnV0ZXMuZmlsdGVyKHRhID0+ICF0YS5FbnRpdHlNZXRob2QgJiYgdGEuRW50aXR5VHlwZSkuZm9yRWFjaCh0YSA9PiB7IGxldCB0YU5hbWUgPSB0YS5FbnRpdHlDbGFzcy5QbHVyYWwucmVwbGFjZSgvIC9nLCAnXycpOyAlPg0KICAgIDwlPW5OYW1lKHRhKSU+XzwlPXRhTmFtZSU+OiBbPCU9bk5hbWUodGEuRW50aXR5Q2xhc3MpJT5dDQogICAgPCUgfSklPg0KDQogICAgPCUgX2MuRW50aXR5TWV0aG9kcy5maWx0ZXIoX20gPT4gIV9tLk1ldGhvZFBhcmFtZXRlcnMubGVuZ3RoKS5mb3JFYWNoKF9tID0+IHslPg0KICAgICIiIg0KICAgIDwlPV9tLlJlbWFyayU+DQogICAgIiIiDQogICAgPCU9bk5hbWUoX20pJT46IDwlPXFsVHlwZShfbS5SZXNwb25zZUF0dHJpYnV0ZSwgdHJ1ZSklPg0KICAgIDwlIH0pJT4NCiAgICA8JSBfYy5FbnRpdHlNZXRob2RzLmZpbHRlcihfbSA9PiBfbS5NZXRob2RQYXJhbWV0ZXJzLmxlbmd0aCkuZm9yRWFjaChfbSA9PiB7JT4NCiAgICAiIiINCiAgICA8JT1fbS5SZW1hcmslPg0KICAgICIiIg0KICAgIDwlPW5OYW1lKF9tKSU+KDwlPV9tLk1ldGhvZFBhcmFtZXRlcnMubWFwKHAgPT4gbk5hbWUocCkgKyAnOiAnICsgcWxUeXBlKHAsIHRydWUpKS5qb2luKCcsICcpJT4pOiA8JT1xbFR5cGUoX20uUmVzcG9uc2VBdHRyaWJ1dGUpJT4NCiAgICA8JSB9KSU+DQp9DQogICAgPCUgfSklPg0KICAgICAgICBgOw0KICAgICAgICA8JT1sb2coKSU+cmV0KTsNCiAgICAgICAgcmV0dXJuIHJldDsNCiAgICB9DQo8JSB9IC8vIGdyYXBoJT4NCg0KPCUgfSAvLyBJc01haW4gJT4NCg0KICAgIGFzeW5jIDwlPW1OYW1lPSdfaW52b2tlTm9kZSclPihuLCBtZXRob2QsIGRhdGEsIGV2ZW50LCBiUmF3KSB7DQogICAgICAgIC8vIGlmKCFuKSByZXR1cm4gbnVsbDsNCiAgICAgICAgDQogICAgICAgIGlmKHR5cGVvZig8JT1uc2NvcGUlPi5fbm9kZSk9PT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICA8JT13YXJuKCklPiI8JT1uc2NvcGUlPi5fbm9kZSBub3QgZGVmaW5lZCIpOw0KICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIGlmKGV2ZW50KXsNCjwlIGlmKF9jTmFtZSgnRXZlbnQnKSl7JT4NCiAgICAgICAgICAgIGlmKGV2ZW50Ll9jbGFzc05hbWVfc2V0ICYmIGV2ZW50LmNsYXNzTmFtZSgpICYmIGV2ZW50LmNsYXNzTmFtZSgpIT0nPCU9bk5hbWUoYyklPicpew0KICAgICAgICAgICAgICAgIGxldCBvQ2xhc3MgPSBudWxsOw0KICAgICAgICAgICAgICAgIGlmKGZhbHNlKXsNCiAgICAgICAgICAgICAgICAgICAgPCU9bG9nKCklPiJEZWxlZ2F0aW5nIGludm9rYXRpb24gdG8gIiArIGV2ZW50LmNsYXNzTmFtZSgpKycuJyttZXRob2QrJyAuLi4uJyk7DQogICAgPCUgc3IuZ3JvdXBCeShhckNsYXNzZXMsICdFbnRpdHlNb2R1bGUnKS5mb3JFYWNoKGVtID0+IHslPg0KICAgICAgICAgICAgICAgIH1lbHNlIGlmKFsiPCU9ZW0udmFsdWVzLm1hcChtYyA9PiBuTmFtZShtYykpLmpvaW4oJyIsICInKSU+Il0uaW5kZXhPZihldmVudC5jbGFzc05hbWUoKSk+PTApew0KICAgICAgICAgICAgICAgICAgICBvQ2xhc3MgPSBuZXcgPCU9c2NvcGUlPjwlPWVtLmtleT8oJy4nK2VtLmtleS5BbGlhcyk6JyclPltldmVudC5jbGFzc05hbWUoKV0oKTsNCiAgICA8JSB9KSU+DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHJldHVybiBhd2FpdCBvQ2xhc3MuPCU9bU5hbWUlPihuLCBtZXRob2QsIGRhdGEsIGV2ZW50LCBiUmF3KTsNCiAgICAgICAgICAgIH0NCjwlIH1lbHNleyU+DQogICAgICAgICAgICA8JT1lcnJvcigpJT4iRXZlbnQgY2Fubm90IGJlIGRlZmluZWQgd2l0aG91dCB0aGUgRXZlbnQgY2xhc3MiKTsNCiAgICAgICAgICAgIHJldHVybiBudWxsOw0KPCUgfSU+DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIGxldCByZXQgPSBudWxsOw0KDQogICAgICAgIGRhdGEgPSBkYXRhIHx8IHt9Ow0KDQogICAgICAgIGlmKHR5cGVvZihkYXRhKT09PSJvYmplY3QiKXsNCiAgICAgICAgICAgIGRhdGEuX190aGlzID0gZGF0YS5fX3RoaXMgfHwgdGhpcy5fdG9KU09OKHtwYXJzZTogMX0pOw0KICAgICAgICAgICAgc3dpdGNoKG1ldGhvZCl7DQogICAgPCUgYy5FbnRpdHlNZXRob2RzLmZvckVhY2gobSA9PiB7JT4NCiAgICAgICAgICAgICAgICBjYXNlICI8JT1uQ29kZShtKSU+Ijogew0KICAgICAgICA8JSBtLk1ldGhvZFBhcmFtZXRlcnMuZm9yRWFjaChwID0+IHslPg0KICAgICAgICAgICAgICAgICAgICBkYXRhLjwlPW5OYW1lKHApJT4gPSBkYXRhLjwlPW5OYW1lKHApJT4/ZGF0YS48JT1uTmFtZShwKSU+DQogICAgICAgICAgICA8JWlmKHAuSXNBcnJheSl7JT4ubWFwKF9wID0+IF9wPCV9JT4NCiAgICAgICAgICAgIDwlIGlmKHAuRW50aXR5VHlwZSl7JT4uX3RvRG9jdW1lbnQoKQ0KICAgICAgICAgICAgPCUgfWVsc2UgaWYocC5Jc0RhdGUpeyU+LnRvSVNPU3RyaW5nKCkNCiAgICAgICAgICAgIDwlIH0lPg0KICAgICAgICAgICAgPCVpZihwLklzQXJyYXkpeyU+KTwlfSU+OnVuZGVmaW5lZDsNCiAgICAgICAgPCUgfSklPg0KICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICB9DQogICAgPCUgfSklPg0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCjwlIGlmKF9jTmFtZSgnTm9kZScpKXslPg0KICAgICAgICBpZih0eXBlb2Yobik9PT0nc3RyaW5nJykgbiA9IG5ldyA8JT1zY29wZSU+LjwlPV9jTmFtZSgnTm9kZScsIHRydWUpJT4oKS5jb2RlKG4pOw0KPCUgfSU+DQoNCiAgICAgICAgaWYoIW4gfHwgPCU9bnNjb3BlJT4uX25vZGUuX3NhbWVFbnRpdHkobikpew0KICAgICAgICAgICAgcmV0ID0gYXdhaXQgdGhpcy5faW52b2tlKG1ldGhvZCwgZGF0YSk7DQogICAgICAgICAgICA8JT1sb2coKSU+IkxvY2FsIG5vZGUiLCByZXQpOw0KDQogICAgICAgIH1lbHNlIGlmKG4uYWRkcmVzcygpKXsNCiAgICAgICAgICAgIHRyeXsNCiAgICAgICAgICAgICAgICA8JT1sb2coKSU+bi5hZGRyZXNzKCksIG4ucG9ydCgpLCBtZXRob2QpOw0KICAgICAgICAgICAgICAgIHJldCA9IGF3YWl0IHRoaXMuX3Jlc3QodW5kZWZpbmVkLCBkYXRhLCBudWxsLCBudWxsLCB7cGF0aDogYGh0dHAke24uc2VjdXJlKCk/J3MnOicnfTovLyR7bi5hZGRyZXNzKCl9OiR7bi5wb3J0KCkgfHwgMzAwMH0vbWV0aG9kLzwlPW5OYW1lKGMpJT4vJHttZXRob2R9YCwgaGVhZGVyczoge319KTsNCiAgICAgICAgICAgIH1jYXRjaChleCl7DQogICAgICAgICAgICAgICAgPCU9ZXJyb3IoKSU+ZXgpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9ZWxzZXsNCjwlIGlmKF9jTmFtZSgnRXZlbnQnKSAmJiBjLk5hbWUhPT0nRXZlbnQnKXslPg0KICAgICAgICAgICAgaWYodHlwZW9mKGRhdGEpPT09Im9iamVjdCIpew0KICAgICAgICAgICAgICAgIGRlbGV0ZSBkYXRhLl9fdGhpcy5fX2dlbmVyYXRlZDsNCiAgICAgICAgICAgICAgICBkZWxldGUgZGF0YS5fX3RoaXMub25saW5lOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICAvL3doeSBkbyB3ZSBuZWVkIHRoaXM/Pz8NCiAgICAgICAgICAgIDwlIC8qdW5SZWN1cnNlKCdkYXRhJywgJ21ldGhvZCcsICd7fScsICcnLCA1LCAnX190aGlzLmNvZGUnKSovICU+DQogICAgICAgICAgICANCiAgICAgICAgICAgIGxldCBldiA9IG5ldyA8JT1zY29wZSU+LjwlPV9jTmFtZSgnRXZlbnQnLCB0cnVlKSU+KCkuYWN0aXZlKHRydWUpLmVuYWJsZWQodHJ1ZSkuY29kZSh0aGlzLl91dWlkKCkpLm5hbWUodGhpcy5fX2NvbmZpZygnZXZlbnQnKSB8fCAnPCU9c2NvcGUlPi5FdmVudCcpLmRhdGUodGhpcy5zZXJ2ZXJEYXRlKCkpLnJlY2lwaWVudChuKS5tZXRob2QobWV0aG9kKS5jbGFzc05hbWUoJzwlPW5OYW1lKGMpJT4nKS5zZW5kZXIoPCU9bnNjb3BlJT4uX25vZGUpLmNhcnJpZXIoPCU9bnNjb3BlJT4uX25vZGUpLnBheWxvYWQodGhpcy5fYnRvYShKU09OLnN0cmluZ2lmeShkYXRhKSkpOw0KICAgICAgICAgICAgaWYoZXZlbnQpew0KICAgICAgICAgICAgICAgIGlmKGV2ZW50Ll9yZXNwb25zZVRvX3NldCkgZXYucmVzcG9uc2VUbyhldmVudC5yZXNwb25zZVRvKCkpOw0KICAgICAgICAgICAgICAgIGlmKGV2ZW50Ll9zZW5kZXJfc2V0KSBldi5zZW5kZXIoZXZlbnQuc2VuZGVyKCkpOw0KICAgICAgICAgICAgICAgIGlmKGV2ZW50Ll9jbGFzc05hbWVfc2V0KSBldi5jbGFzc05hbWUoZXZlbnQuY2xhc3NOYW1lKCkpOw0KICAgICAgICAgICAgICAgIGlmKGV2ZW50Ll9jYXJyaWVyX3NldCB8fCBldmVudC5fc2VuZGVyX3NldCkgZXYuY2FycmllcihldmVudC5jYXJyaWVyKCkgfHwgZXZlbnQuc2VuZGVyKCkpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0ID0gYXdhaXQgZXYudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBpZih0eXBlb2YocmV0KT09PSJzdHJpbmciKXsNCiAgICAgICAgICAgICAgICB0cnl7DQogICAgICAgICAgICAgICAgICAgIHJldCA9IEpTT04ucGFyc2UocmV0KTsNCiAgICAgICAgICAgICAgICB9Y2F0Y2goZXgpew0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH1lbHNlIGlmKHJldCAmJiB0eXBlb2YocmV0LnBheWxvYWQpPT09J2Z1bmN0aW9uJyl7DQogICAgICAgICAgICAgICAgLy8gcmV0IGlzIGFuIGV2ZW50DQogICAgICAgICAgICAgICAgcmV0ID0gcmV0LnBheWxvYWQoKTsNCiAgICAgICAgICAgIH1lbHNlIGlmKEFycmF5LmlzQXJyYXkocmV0KSAmJiByZXRbMF0gJiYgdHlwZW9mKHJldFswXS5wYXlsb2FkKT09PSdmdW5jdGlvbicpew0KICAgICAgICAgICAgICAgIHJldCA9IHJldC5tYXAociA9PiByLnBheWxvYWQoKSk7DQogICAgICAgICAgICAgICAgaWYocmV0Lmxlbmd0aD09MSkgcmV0ID0gcmV0WzBdOw0KICAgICAgICAgICAgfQ0KPCUgfSU+DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIGlmKCFyZXQpIHJldHVybiBudWxsOw0KICAgICAgICByZXQgPSByZXQuZGF0YSB8fCByZXQ7DQoNCiAgICAgICAgaWYocmV0Ll9fZXhjZXB0aW9uKXsNCiAgICAgICAgICAgIC8vIGFuIGV4Y2VwdGlvbiBvY2N1cnJlZCBhdCB0aGUgc2VydmVyDQogICAgICAgICAgICA8JT1lcnJvcigpJT5gRXhjZXB0aW9uIGF0ICR7bi5fYWRkcmVzc31gLCByZXQuX19leGNlcHRpb24pOw0KICAgICAgICAgICAgcmV0dXJuIHJldDsNCiAgICAgICAgfQ0KDQogICAgICAgIHN3aXRjaChtZXRob2Qpew0KPCUgYy5FbnRpdHlNZXRob2RzLmZvckVhY2gobSA9PiB7JT4NCiAgICAgICAgICAgIGNhc2UgIjwlPW5Db2RlKG0pJT4iOiB7DQogICAgPCUgaWYobS5SZXNwb25zZUF0dHJpYnV0ZS5FbnRpdHlUeXBlKXsgJT4NCiAgICAgICAgICAgICAgICBpZighYlJhdykgcmV0ID0gbmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKG0uUmVzcG9uc2VBdHRyaWJ1dGUuRW50aXR5VHlwZSwgdHJ1ZSklPigpLl9mcm9tRG9jdW1lbnQocmV0KTsNCiAgICA8JSB9ICU+DQogICAgPCUgaWYobS5OYW1lPT0nYXV0aG9yaXplJyl7JT4NCiAgICAgICAgICAgICAgICA8JT1zY29wZSU+Ll9fdG9rZW4gPSB7dG9rZW5fdHlwZTogIkJlYXJlciIsIGFjY2Vzc190b2tlbjogcmV0fTsNCiAgICA8JSB9ICU+DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQo8JSB9KTsgJT4NCg0KICAgICAgICAgICAgY2FzZSAiaW5zZXJ0IjoNCiAgICAgICAgICAgIGNhc2UgInVwZGF0ZSI6DQogICAgICAgICAgICBjYXNlICJzdG9yZSI6DQogICAgICAgICAgICBjYXNlICJkZWxldGUiOg0KICAgICAgICAgICAgY2FzZSAiZmluZCI6IA0KICAgICAgICAgICAgY2FzZSAiZmluZEFsbCI6IHsNCiAgICAgICAgICAgICAgICBpZighYlJhdykgcmV0ID0gbmV3IDwlPXNjb3BlJT4uPCU9bk5hbWUoYywgdHJ1ZSklPigpLl9mcm9tRG9jdW1lbnQocmV0KTsNCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgZGVmYXVsdDogew0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcmV0dXJuIHJldDsNCiAgICB9DQoNCjwlIGlmKG1haW5DbGFzcygpKXslPg0KICAgIGFzeW5jIDwlPW1OYW1lPSdfaW52b2tlJyU+KG1ldGhvZCwgYm9keSwgcXVlcnksIGF1dGhPYmopew0KICAgICAgICB0aGlzLl9fdGltZSgnPCU9c2NvcGUlPi48JT1uTmFtZShjKSU+LicgKyBtZXRob2QpOw0KICAgICAgICA8JT1sb2coKSU+bWV0aG9kLCBxdWVyeSwgYm9keSk7DQogICAgICAgIA0KICAgICAgICBpZih0eXBlb2YoYm9keSk9PT0nc3RyaW5nJyl7DQogICAgICAgICAgICBpZig8JT1fYjY0dGVzdCgnYm9keScpJT4peyAvLyBiYXNlNjQ/DQogICAgICAgICAgICAgICAgYm9keSA9IHRoaXMuX2F0b2IoYm9keSk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKC9bXiw6e31cW1xdMC05LlwtK0VhZWZsbnItdSBcblxyXHRdLy50ZXN0KGJvZHkpKXsgLy8ganNvbg0KICAgICAgICAgICAgICAgIHRyeXsNCiAgICAgICAgICAgICAgICAgICAgYm9keSA9IEpTT04ucGFyc2UoYm9keS50b1N0cmluZygpKTsNCiAgICAgICAgICAgICAgICB9Y2F0Y2goZXgpew0KICAgICAgICAgICAgICAgICAgICA8JT13YXJuKCklPiJCb2R5IGlzIG5vdCBhIHZhbGlkIEpTT04iLCBib2R5KTsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIGxldCBfcGFyYW1zID0gcXVlcnk/T2JqZWN0LmFzc2lnbihxdWVyeSwgYm9keSk6Ym9keTsNCiAgICAgICAgaWYodHlwZW9mKF9wYXJhbXMpPT09J3N0cmluZycpIF9wYXJhbXMgPSBKU09OLnBhcnNlKF9wYXJhbXMpOw0KICAgICAgICANCiAgICAgICAgaWYoX3BhcmFtcyl7DQogICAgICAgICAgICBfcGFyYW1zID0gRG90T2JqZWN0Lm9iamVjdChfcGFyYW1zKTsNCiAgICAgICAgfWVsc2V7DQogICAgICAgICAgICBfcGFyYW1zID0ge307DQogICAgICAgIH0NCg0KICAgICAgICA8JT1sb2coKSU+Il9wYXJhbXMiLCBfcGFyYW1zKTsNCg0KICAgIDwlIGlmKF9jTmFtZSgnTm9kZScpICYmIGMuTmFtZSE9J05vZGUnKXslPg0KICAgICAgICBpZihfcGFyYW1zLl9fbm9kZSl7DQogICAgICAgICAgICAvLyBwcm9iYWJseSBzaG91bGQgbm90IGJlIHByb2Nlc3NlZCBoZXJlLCBidXQgcmF0aGVyIGNvbnN1bWVkIGFzIHBhcnQgb2YgdGhlIGV4ZWN1dGUoKSBsb2dpYywgcHVzaGluZyBfX25vZGUgdG8gdGhlIGxpc3Qgb2YgbXkgbm9kZXMgdG8gZGVsZWdhdGUgdG8hPw0KICAgICAgICAgICAgbGV0IHRuID0gbmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKCdOb2RlJywgdHJ1ZSklPigpLl9mcm9tRG9jdW1lbnQoX3BhcmFtcy5fX25vZGUpLyouX2RlUmVmZXJlbmNlKCkqLzsNCiAgICAgICAgICAgIGRlbGV0ZSBfcGFyYW1zLl9fbm9kZTsNCiAgICAgICAgICAgIHJldHVybiBhd2FpdCBuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUoYywgdHJ1ZSklPigpLl9pbnZva2VOb2RlKHRuLCBtZXRob2QsIF9wYXJhbXMpOw0KICAgICAgICB9DQogICAgPCUgfSU+DQoNCiAgICAgICAgaWYoX3BhcmFtcy5fX3RoaXMpIHsNCiAgICAgICAgICAgIF9wYXJhbXMuX190aGlzID0gRG90T2JqZWN0Lm9iamVjdChfcGFyYW1zLl9fdGhpcyk7DQogICAgICAgICAgICBsZXQgX190aGlzID0gbmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKGMsIHRydWUpJT4oKS5fZnJvbURvY3VtZW50KF9wYXJhbXMuX190aGlzKS8qLl9kZVJlZmVyZW5jZSgpKi87DQogICAgICAgICAgICBkZWxldGUgX3BhcmFtcy5fX3RoaXM7DQogICAgICAgICAgICByZXR1cm4gYXdhaXQgX190aGlzLjwlPW1OYW1lJT4obWV0aG9kLCBfcGFyYW1zLCBudWxsLCBhdXRoT2JqKTsNCiAgICAgICAgfQ0KDQogICAgICAgIGxldCBhckFyZ3MgPSBbXTsNCiAgICAgICAgc3dpdGNoKG1ldGhvZCl7DQo8JSBjLkVudGl0eU1ldGhvZHMuZm9yRWFjaChtID0+IHslPg0KICAgICAgICAgICAgY2FzZSAiPCU9bkNvZGUobSklPiI6IHsNCjwlIGlmKF9jTmFtZSgnVHJhbnNhY3Rpb24nKSAmJiBfY05hbWUoJ0NvbnRlbnQnKSAmJiBjLk5hbWUhPSdUcmFuc2FjdGlvbicgJiYgIW0uSXNTeW5jKXslPg0KICAgICAgICBpZighX3BhcmFtcy5TeW5jKXsNCiAgICAgICAgICAgIHJldHVybiBuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUoJ0NvbnRlbnQnLCB0cnVlKSU+KChhd2FpdCBuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUoJ0NvbnRlbnQnLCB0cnVlKSU+KCkuYWN0aXZlKHRydWUpLmVuYWJsZWQodHJ1ZSkuc2NvcGUoIjwlPXNjb3BlJT4iKS5jbGFzcygiPCU9Yy5OYW1lJT4iKS5tZXRob2QobWV0aG9kKS5hdXRob3JpemF0aW9uKGF1dGhPYmopLmRhdGUodGhpcy5zZXJ2ZXJEYXRlKCkpLnBheWxvYWQodGhpcy5fYnRvYShfcGFyYW1zKSkudHJhbnNhY3Rpb25fVHJhbnNhY3Rpb25Mb2dzKFtuZXcgPCU9c2NvcGUlPi5UcmFuc2FjdGlvbkxvZygpLmRhdGUodGhpcy5zZXJ2ZXJEYXRlKCkpLnN0YXRlKG5ldyA8JT1zY29wZSU+LlRyYW5zYWN0aW9uU3RhdGUoKS5hY3RpdmUodHJ1ZSkuZW5hYmxlZCh0cnVlKS5uYW1lKCJsb2FkZWQiKSldKS5zdG9yZSgpKS5JZCkuX3RvRG9jdW1lbnQoKTsNCiAgICAgICAgfQ0KPCUgfSU+DQoNCiAgICA8JSBtLk1ldGhvZFBhcmFtZXRlcnMuZm9yRWFjaChwID0+IHslPg0KICAgICAgICA8JSBpZihwLkVudGl0eVR5cGUgJiYgcC5Jc0FycmF5KXslPg0KICAgICAgICAgICAgICAgIF9wYXJhbXMuPCU9bkNvZGUocCklPiA9IF9wYXJhbXMuPCU9bkNvZGUocCklPi5tYXAocCA9PiBuZXcgPCU9c2NvcGUlPi48JT1uTmFtZShwLkVudGl0eVR5cGUpJT4oKS5fZnJvbURvY3VtZW50KHApLl9kZVJlZmVyZW5jZSgpKTsNCiAgICAgICAgPCUgfWVsc2UgaWYocC5FbnRpdHlUeXBlKXsgJT4NCiAgICAgICAgICAgICAgICBfcGFyYW1zLjwlPW5Db2RlKHApJT4gPSBuZXcgPCU9c2NvcGUlPi48JT1uTmFtZShwLkVudGl0eVR5cGUpJT4oKS5fZnJvbURvY3VtZW50KF9wYXJhbXMuPCU9bkNvZGUocCklPikuX2RlUmVmZXJlbmNlKCk7DQogICAgICAgIDwlIH0gJT4NCiAgICAgICAgICAgICAgICBhckFyZ3MucHVzaChfcGFyYW1zLjwlPW5Db2RlKHApJT4pOw0KICAgIDwlIH0pOyU+DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQo8JSB9KTslPg0KDQogICAgICAgICAgICBjYXNlICJmaW5kQWxsIjp7DQogICAgICAgICAgICAgICAgYXJBcmdzLnB1c2goX3BhcmFtcy5kZXB0aCk7DQogICAgICAgICAgICAgICAgYXJBcmdzLnB1c2goX3BhcmFtcy5vYmpzKTsNCiAgICAgICAgICAgICAgICBhckFyZ3MucHVzaChfcGFyYW1zLnN0YXJ0KTsNCiAgICAgICAgICAgICAgICBhckFyZ3MucHVzaChfcGFyYW1zLmVuZCk7DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXNlICJmaW5kIjogew0KICAgICAgICAgICAgICAgIGFyQXJncy5wdXNoKF9wYXJhbXMuZGVwdGgpOw0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBkZWZhdWx0OiB7DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIGxldCBvYmogPSB0aGlzOw0KICAgICAgICANCiAgICAgICAgbGV0IHJldCA9IG51bGw7DQogICAgICAgIGlmKCFvYmopew0KICAgICAgICAgICAgcmV0ID0gew0KICAgICAgICAgICAgICAgIF9fZXhjZXB0aW9uOiB7DQogICAgICAgICAgICAgICAgICAgICctMSc6IGA8JT1uTmFtZShjKSU+LjwlPW1OYW1lJT46IG9iaiBpcyB1bmRlZmluZWRgDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfTsNCiAgICAgICAgfWVsc2UgaWYoIW9ialttZXRob2RdKXsNCiAgICAgICAgICAgIHJldCA9IHsNCiAgICAgICAgICAgICAgICBfX2V4Y2VwdGlvbjogew0KICAgICAgICAgICAgICAgICAgICAnLTInOiBgPCU9bk5hbWUoYyklPi48JT1tTmFtZSU+OiBtZXRob2QgJHtvYmouY29uc3RydWN0b3IubmFtZX0oJHttZXRob2R9KSBpcyBub3QgZm91bmRgLA0KICAgICAgICAgICAgICAgICAgICAnb2JqJzogb2JqDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfTsNCiAgICAgICAgfWVsc2V7DQogICAgICAgICAgICByZXQgPSBhd2FpdCBvYmpbbWV0aG9kXSguLi5hckFyZ3MpOw0KICAgICAgICB9DQogICAgICAgIA0KPCUgY2xzVG9vbHMoYykuZm9yRWFjaCh0ID0+IHslPg0KICAgICAgICBpZih0aGlzLlRvb2wudHlwZS5uYW1lPT0iPCU9dCU+Iil7DQogICAgPCUgaWYodD09IlNxbERCIil7ICU+DQogICAgICAgICAgICBpZihmYWxzZSAmJiA8JT1zY29wZSU+Ll9fc3FsVHJhbnNhY3Rpb24gJiYgITwlPXNjb3BlJT4uX19zcWxUcmFuc2FjdGlvbi5lbmQpew0KICAgICAgICAgICAgICAgIHJldCA9IHsNCiAgICAgICAgICAgICAgICAgICAgX19leGNlcHRpb246IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICctNCc6ICJVbmNvbW1pdHRlZCB0cmFuc2FjdGlvbnM6ICIgKyA8JT1zY29wZSU+Ll9fc3FsVHJhbnNhY3Rpb24uc3Fscy5sZW5ndGgsDQogICAgICAgICAgICAgICAgICAgICAgICAnb2JqJzogb2JqDQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgPCUgfSU+DQogICAgICAgIH0NCjwlIH0pJT4NCg0KICAgICAgICBpZihyZXQgJiYgIXJldC5fX2V4Y2VwdGlvbil7DQogICAgICAgICAgICA8JT1zY29wZSU+Ll91blJlY3Vyc2UgPSB7fTsNCiAgICAgICAgICAgIGlmKEFycmF5LmlzQXJyYXkocmV0KSl7DQogICAgICAgICAgICAgICAgbGV0IF9yZXQgPSBbXTsNCiAgICAgICAgICAgICAgICBmb3IgYXdhaXQoY29uc3QgciBvZiByZXQpew0KICAgICAgICAgICAgICAgICAgICBpZihyICYmIHIuX3RvRG9jdW1lbnQpew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYoPCU9c2NvcGUlPi5fdW5SZWN1cnNlLjwlPW5OYW1lKGMpJT4pIGRlbGV0ZSA8JT1zY29wZSU+Ll91blJlY3Vyc2UuPCU9bk5hbWUoYyklPi5fdG9Eb2N1bWVudDsNCiAgICAgICAgICAgICAgICAgICAgICAgIF9yZXQucHVzaChhd2FpdCByLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgICAgICAgICB9ZWxzZSBfcmV0LnB1c2gocik7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHJldCA9IF9yZXQ7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXQgPSAocmV0ICYmIHJldC5fdG9Eb2N1bWVudCk/YXdhaXQgcmV0Ll90b0RvY3VtZW50KCk6cmV0Ow0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICA8JT1sb2coKSU+J3JldCcsIHJldCk7DQogICAgICAgIDwlPWxvZygpJT5gJHttZXRob2R9OiAke3RoaXMuX190aW1lKCc8JT1zY29wZSU+LjwlPW5OYW1lKGMpJT4uJyArIG1ldGhvZCl9YCk7DQogICAgICAgIHJldHVybiByZXQ7DQogICAgfQ0KDQo8JSBpZihfY05hbWUoJ05vZGUnKSl7JT4NCiAgICA8JT1tTmFtZT0nX3BhcnNlQ29kZVN0YXRlJyU+KHQpew0KICAgIDwlIGlmKG1haW5DbGFzcygpPT1jKXslPg0KICAgICAgICBsZXQgc3RhdGUgPSB0aGlzLl9fY29uZmlnKHRoaXMuX19jb25maWcoJ29hdXRoLnJlZGlyZWN0LnN0YXRlJywgbnVsbCwge3Rvb2w6IHR9KSk7DQogICAgICAgIGxldCBjb2RlID0gdGhpcy5fX2NvbmZpZyh0aGlzLl9fY29uZmlnKCdvYXV0aC5yZWRpcmVjdC5jb2RlJywgbnVsbCwge3Rvb2w6IHR9KSk7DQogICAgICAgIGlmKCFzdGF0ZSB8fCAhY29kZSkgcmV0dXJuOw0KICAgICAgICBzdGF0ZSA9IEpTT04ucGFyc2UodGhpcy5fYXRvYihzdGF0ZSkpOw0KICAgICAgICBpZihzdGF0ZS50b29sIT09dC5uYW1lKSByZXR1cm47DQoNCiAgICAgICAgPCU9bG9nKCklPiJHT1QgQ09ERSAiICsgY29kZSArICIgZm9yIG5vZGUgIiArIHN0YXRlLm5jb2RlICsgIiB3aXRoIHRvb2wgIiArIHN0YXRlLnRvb2wpOw0KICAgICAgICBpZighPCU9bnNjb3BlJT4uX25vZGUucGFyZW50KCkgfHwgITwlPW5zY29wZSU+Ll9ub2RlLl9wYXJlbnQuX3NhbWVFbnRpdHkoPCU9bnNjb3BlJT4uX25vZGUucGFyZW50KCkpKXsNCiAgICAgICAgICAgIDwlPWxvZygpJT4nbmV3IHBhcmVudCcsIHN0YXRlLm5jb2RlKTsNCiAgICAgICAgICAgIDwlPW5zY29wZSU+Ll9ub2RlLnBhcmVudChuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUoJ05vZGUnLCB0cnVlKSU+KCkuY29kZShzdGF0ZS5uY29kZSkpOw0KICAgICAgICB9DQogICAgICAgIDwlPW5zY29wZSU+Ll9ub2RlLmF1dGhDb2RlKGNvZGUsIG5ldyA8JT1zY29wZSU+LjwlPV9jTmFtZSgnVG9vbCcsIHRydWUpJT4oKS5uYW1lKHN0YXRlLnRvb2wpKTsNCiAgICAgICAgd2luZG93LmNsb3NlKCk7DQogICAgPCUgfWVsc2V7JT4NCiAgICAgICAgcmV0dXJuIG5ldyA8JT1zY29wZSU+LjwlPW5OYW1lKG1haW5DbGFzcygpKSU+KCkuPCU9bU5hbWUlPih0KTsNCiAgICA8JSB9JT4NCiAgICB9DQo8JSB9JT4NCg0KICAgIGFzeW5jIDwlPW1OYW1lPSdfbG9hZFRvb2xzJyU+KGJTdG9yZSl7DQogICAgICAgIGlmKDwlPXNjb3BlJT4uVG9vbHMgJiYgPCU9c2NvcGUlPi5Ub29scy5sZW5ndGgpew0KICAgICAgICAgICAgPCU9bG9nKCklPmBUb29scyBhbHJlYWR5IGxvYWRlZGApOw0KICAgICAgICAgICAgcmV0dXJuIDwlPXNjb3BlJT4uVG9vbHM7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIDwlPWxvZygpJT5gTG9hZGluZyB0b29scy4uLmApOw0KICAgICAgICANCiAgICAgICAgbGV0IHRvb2xzID0gW107DQogICAgICAgIHRvb2xzID0gPCU9c2NvcGUlPi5fX1Rvb2xzIHx8IHRvb2xzOw0KICAgICAgICBkZWxldGUgPCU9c2NvcGUlPi5fX1Rvb2xzOw0KDQogICAgICAgIGxldCBhclRvb2xzID0gPCU9X0ZyRU1ELl90b0pTKFsuLi5uZXcgU2V0KGFyQ2xhc3Nlcy5tYXAoX2MgPT4gX2MuVG9vbHMpLmZsYXQoKSldKSU+Ow0KICAgICAgICBsZXQgdG9vbE5hbWVzID0gYXJUb29scy5tYXAodCA9PiB0Lm5hbWUgfHwgKHQudHlwZT90LnR5cGUubmFtZTp0KSk7DQogICAgICAgIHRyeXsNCiAgICAgICAgICAgIGlmKHRvb2xzLmxlbmd0aCE9PXRvb2xOYW1lcy5sZW5ndGgpew0KICAgICAgICAgICAgICAgIC8vIGNhbm5vdCB1c2UgcmVxdWlyZSB5ZXQsIG5vIHRvb2xzIHByb3Blcmx5IGxvYWRlZCB0byB1c2UgYSBsb2FkZXIgZnVuY3Rpb24NCiAgICAgICAgICAgICAgICB0b29scyA9IGF3YWl0IHRoaXMuX2dldFN0b3JlZFNjcmlwdCh7TmFtZTogJ0FQSVNFUlZFUjwlPW1OYW1lJT4nLCBBY3RpdmU6IHRydWUsIEVuYWJsZWQ6IHRydWV9KSB8fCB0b29sczsNCiAgICAgICAgICAgIH0NCg0KPCUgaWYoX2NOYW1lKCdUb29sJykpeyU+DQogICAgICAgICAgICBpZighdG9vbHMubGVuZ3RoKSB0b29scyA9IChhd2FpdCBuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUoJ1Rvb2wnLCB0cnVlKSU+KCkuVEhJUyh0b29sTmFtZXMubWFwKHQgPT4gbmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKCdUb29sJywgdHJ1ZSklPigpLm5hbWUodCkpKS5maW5kQWxsKDIpKS5tYXAodCA9PiB0Ll90b0pTT04oe3BhcnNlOiAxfSkpIHx8IHRvb2xzOw0KPCUgfSU+DQogICAgICAgIH1jYXRjaChleCl7DQogICAgICAgICAgICA8JT13YXJuKCklPmV4KTsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgbGV0IGZpeFRvb2xzID0gdG9vbHMgPT4gew0KICAgICAgICAgICAgdG9vbHMuZmlsdGVyKHQgPT4gdHlwZW9mKHQpPT09J29iamVjdCcgJiYgdCkuZm9yRWFjaCh0ID0+IHsNCiAgICAgICAgICAgICAgICA8JV9kZWYoJ3QuSWQnLCAndGhpcy5fdXVpZCgpJyklPg0KICAgICAgICAgICAgICAgIDwlX2RlZigndC5uYW1lJywgJ3QudHlwZS5uYW1lJyklPg0KICAgICAgICAgICAgICAgIDwlX2RlZigndC5hY3RpdmUnLCB0cnVlKSU+DQogICAgICAgICAgICAgICAgPCVfZGVmKCd0LmVuYWJsZWQnLCB0cnVlKSU+DQogICAgICAgICAgICAgICAgPCVfZGVmKCd0LnR5cGUuYWN0aXZlJywgdHJ1ZSklPg0KICAgICAgICAgICAgICAgIDwlX2RlZigndC50eXBlLmVuYWJsZWQnLCB0cnVlKSU+DQoNCiAgICAgICAgICAgICAgICA8JV9kZWYoJ3QudG9vbF9Db25maWdzJywgJ1tdJyklPjsNCiAgICAgICAgICAgICAgICA8JV9kZWYoJ3QudHlwZS50eXBlX0NvbmZpZ3MnLCAnW10nKSU+Ow0KICAgICAgICAgICAgICAgIDwlX2RlZigndC50eXBlLnR5cGVfTWFwcGluZ3MnLCAnW10nKSU+Ow0KICAgICAgICAgICAgICAgIDwlX2RlZigndC50b29sX01hcHBpbmdzJywgJ1tdJyklPjsNCiAgICANCiAgICAgICAgICAgICAgICBbXS5jb25jYXQodC50b29sX0NvbmZpZ3MsIHQudHlwZS50eXBlX0NvbmZpZ3MsIHQudHlwZS50eXBlX01hcHBpbmdzLCB0LnRvb2xfTWFwcGluZ3MpLmZvckVhY2goYyA9PiB7DQogICAgICAgICAgICAgICAgICAgIDwlX2RlZignYy5hY3RpdmUnLCB0cnVlKSU+DQogICAgICAgICAgICAgICAgICAgIDwlX2RlZignYy5lbmFibGVkJywgdHJ1ZSklPg0KICAgICAgICAgICAgICAgICAgICA8JV9kZWYoJ2MuSWQnLCAndGhpcy5fdXVpZCgpJyklPg0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfSk7DQogICAgDQogICAgICAgICAgICB0b29scy5maWx0ZXIodCA9PiB0eXBlb2YodCk9PT0nb2JqZWN0JyAmJiB0KS5mb3JFYWNoKHQgPT4gWyd0b29sX0NvbmZpZ3MnLCAndHlwZS50eXBlX0NvbmZpZ3MnXS5mb3JFYWNoKHNDb25maWcgPT4gew0KICAgICAgICAgICAgICAgICAgICBEb3RPYmplY3Quc2V0KHNDb25maWcsIERvdE9iamVjdC5waWNrKHNDb25maWcsIHQpLmZpbHRlcihjID0+IHR5cGVvZihjLnZhbHVlKSE9PSJvYmplY3QiKS5jb25jYXQoRG90T2JqZWN0LnBpY2soc0NvbmZpZywgdCkuZmlsdGVyKGMgPT4gdHlwZW9mKGMudmFsdWUpPT09Im9iamVjdCIgJiYgYy52YWx1ZSkubWFwKGMgPT4gT2JqZWN0LmtleXMoYy52YWx1ZSkubWFwKG5jb2RlID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBfYyA9IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBjLm5hbWUsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IGMudmFsdWVbbmNvZGVdLA0KICAgICAgICAgICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmKG5jb2RlIT0iZGVmYXVsdCIpew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9jLm5vZGUgPSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvZGU6IG5jb2RlLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY3RpdmU6IHRydWUsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuYWJsZWQ6IGZhbHNlLCA8JS8vIG90aGVyd2lzZSBpdCBzdGFydHMgZ2V0dGluZyBldmVudHMlPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiTm9kZUpTIiwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2M7DQogICAgICAgICAgICAgICAgICAgIH0pLmZsYXQoKSkuZmxhdCgpKSwgdCk7DQogICAgICAgICAgICAgICAgICAgIERvdE9iamVjdC5waWNrKHNDb25maWcsIHQpLmZvckVhY2goYyA9PiBjLnZhbHVlID0gSlNPTi5zdHJpbmdpZnkoYy52YWx1ZSkpOw0KICAgICAgICAgICAgICAgIH0pDQogICAgICAgICAgICApOw0KICAgICAgICB9Ow0KDQoNCiAgICAgICAgZml4VG9vbHModG9vbHMpOw0KICAgICAgICB0b29scyA9IHRvb2xzLmZpbHRlcih0ID0+IHQuYWN0aXZlKTsNCiAgICAgICAgdG9vbHMgPSB0b29scy5maWx0ZXIodCA9PiB0b29sTmFtZXMuZmluZChfdCA9PiAodHlwZW9mKF90KT09PSdzdHJpbmcnP190Ol90Lm5hbWUpPT10Lm5hbWUpKTsNCg0KICAgICAgICA8JT1sb2coKSU+YFRvb2xzIGFyZSAke3Rvb2xzLmxlbmd0aH1gKTsNCg0KICAgICAgICA8JT1zY29wZSU+LlRvb2xzID0gdG9vbHM7DQoNCiAgICAgICAgPCU9c2NvcGUlPi5Ub29scy5maWx0ZXIodCA9PiAhdC5heGlvcyAmJiA8JT1KU09OLnN0cmluZ2lmeShfcmVzdFRvb2xzKSU+LmluZGV4T2YodC50eXBlLm5hbWUpPj0wKS5mb3JFYWNoKHQgPT4gew0KICAgICAgICAgICAgdC5heGlvcyA9IHR5cGVvZihheGlvcy5jcmVhdGUpPT09J2Z1bmN0aW9uJz9heGlvcy5jcmVhdGUoKTpheGlvczsNCiAgICAgICAgICAgIHQuYXhpb3MuaW50ZXJjZXB0b3JzLnJlcXVlc3QudXNlKHJlcXVlc3QgPT4gdGhpcy5fcmVxdWVzdEludGVyY2VwdG9yKHJlcXVlc3QsIHQpLCBlcnJvciA9PiB7fSk7DQogICAgICAgICAgICB0LmF4aW9zLmludGVyY2VwdG9ycy5yZXNwb25zZS51c2UocmVzcG9uc2UgPT4gcmVzcG9uc2UsIGVycm9yID0+IHRoaXMuX3Jlc3BvbnNlSW50ZXJjZXB0b3IoZXJyb3IsIHQpKTsNCiAgICAgICAgfSk7DQogICAgICAgIA0KICAgICAgICAvLyBjb25uZWN0IHRvIHRoZSBsb2FkZWQgdG9vbHMhISENCiAgICAgICAgbGV0IHRvb2wgPSB0aGlzLlRvb2w7DQogICAgICAgIGZvciBhd2FpdCAoY29uc3QgdCBvZiA8JT1zY29wZSU+LlRvb2xzKXsNCjwlIHNyLmdyb3VwQnkoYXJDbGFzc2VzLCAnRW50aXR5TW9kdWxlJykuZm9yRWFjaChlbSA9PiB7ZW0udmFsdWVzID0gZW0udmFsdWVzLnNvcnQoKGEsIGIpID0+IGIuUmFuayAtIGEuUmFuayk7ICU+DQogICAgICAgICAgICBhd2FpdCBuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUoZW0udmFsdWVzWzBdLCB0cnVlKSU+KHVuZGVmaW5lZCwgdCkuX3N0b3JlRW50aXR5Q2xhc3MoPCU9ZW0udmFsdWVzWzBdLlJhbmslPik7DQo8JSB9KSU+DQogICAgICAgIH0NCiAgICAgICAgdGhpcy5Ub29sID0gdG9vbDsNCiAgICAgICAgDQogICAgICAgIGFyVG9vbHMgPSBhclRvb2xzLmZpbHRlcihfdCA9PiAhdG9vbHMuZmluZCh0ID0+ICh0eXBlb2YoX3QpPT09J3N0cmluZyc/X3Q6X3QubmFtZSk9PXQubmFtZSkpOw0KICAgICAgICBmaXhUb29scyhhclRvb2xzKTsNCg0KPCUgaWYoX2NOYW1lKCdUb29sJykpeyU+DQogICAgICAgIDwlPXNjb3BlJT4ub1Rvb2xzID0gPCU9c2NvcGUlPi5Ub29scy5jb25jYXQoYXJUb29scykuZmlsdGVyKHQgPT4gdC5hY3RpdmUpLm1hcCh0ID0+IHsNCiAgICAgICAgICAgIHQudG9vbF9NYXBwaW5ncy5mb3JFYWNoKG0gPT4gZGVsZXRlIG0udG9vbCk7DQogICAgICAgICAgICB0LnR5cGUudHlwZV9NYXBwaW5ncy5mb3JFYWNoKG0gPT4gZGVsZXRlIG0udHlwZSk7DQogICAgDQogICAgICAgICAgICByZXR1cm4gbmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKCdUb29sJywgdHJ1ZSklPigpLl9mcm9tRG9jdW1lbnQodCk7DQogICAgICAgIH0pOw0KICAgICAgICBpZihiU3RvcmUpew0KICAgICAgICAgICAgPCU9bG9nKCklPmBTYXZpbmcgdG9vbHMuLi5gKTsNCiAgICAgICAgICAgIGZvciBhd2FpdCAoY29uc3QgdCBvZiA8JT1zY29wZSU+Lm9Ub29scyl7DQogICAgICAgICAgICAgICAgYXdhaXQgdC5zdG9yZSgpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQo8JSB9JT4NCg0KICAgICAgICA8JT1sb2coKSU+YEV4aXRpbmdgKTsNCiAgICAgICAgcmV0dXJuIHRvb2xzOw0KICAgIH0NCiAgICANCjwlIH0gLy8gbWFpbkNsYXNzICU+DQoNCgk8JT1tTmFtZT0nX3BhcmFtZXRyaXplJyU+KHN0ciwgZnVuLCBvcHRpb25zPXt9LCBwcmVmaXg9J3t7JywgcG9zdGZpeD0nfX0nKSB7DQo8JSBpZihtYWluQ2xhc3MoKT09Yyl7JT4NCiAgICAgICAgdHJ5ew0KICAgICAgICAgICAgaWYodHlwZW9mKHN0cikhPT0nc3RyaW5nJykgcmV0dXJuIHN0cjsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgbGV0IHJleCA9IGAke3ByZWZpeH0oW14ke3Bvc3RmaXh9XSspJHtwb3N0Zml4fWA7DQogICAgICAgICAgICAoc3RyLm1hdGNoKG5ldyBSZWdFeHAocmV4LCAiZyIpKSB8fCBbXSkuZm9yRWFjaChtID0+IHN0ciA9IHN0ci5yZXBsYWNlKG0sIG0gPT4gZnVuKG0ucmVwbGFjZShwcmVmaXgsICcnKS5yZXBsYWNlKHBvc3RmaXgsICcnKSkpKTsNCg0KICAgICAgICAgICAgcmV0dXJuIHN0cjsNCiAgICAgICAgfWNhdGNoKGV4KXsNCiAgICAgICAgICAgIDwlPWVycm9yKCklPmV4KTsNCiAgICAgICAgfQ0KPCUgfWVsc2V7JT4NCiAgICAgICAgcmV0dXJuIG5ldyA8JT1zY29wZSU+LjwlPW5OYW1lKG1haW5DbGFzcygpKSU+KCkuPCU9bU5hbWUlPihzdHIsIGZ1biwgb3B0aW9ucywgcHJlZml4LCBwb3N0Zml4KTsNCjwlIH0lPg0KCX0NCg0KICAgIDwlPW1OYW1lPSdfX3N5bmNfb24nJT4oZCl7DQogICAgICAgIHRoaXMuXzwlPW1OYW1lJT4gPSB0aGlzLl88JT1tTmFtZSU+IHx8IHt9Ow0KICAgIA0KICAgICAgICBpZihkKXsgLy8gc2V0IHRoZSB2YWx1ZQ0KICAgICAgICAgICAgdGhpcy5fPCU9bU5hbWUlPlt0aGlzLlRvb2wubmFtZV0gPSBkOw0KDQogICAgICAgICAgICByZXR1cm4gdGhpcy5fX2ltcG9ydCh0aGlzLCB7DQogICAgICAgICAgICAgICAgQ3ljbGljOiB0cnVlLA0KPCUgYy5FbnRpdHlBdHRyaWJ1dGVzLmZpbHRlcihlYSA9PiAhZWEuRW50aXR5TWV0aG9kICYmIGVhLkVudGl0eVR5cGUpLmZvckVhY2goZWEgPT4geyU+DQogICAgICAgICAgICAgICAgPCU9bk5hbWUoZWEpJT46IChvYmosIGVhQ29kZSkgPT4gdGhpcy48JT1uTmFtZShlYSklPigpP3RoaXMuPCU9bk5hbWUoZWEpJT4oKS48JT1tTmFtZSU+KGQpOnVuZGVmaW5lZCwNCjwlIH0pJT4NCg0KPCUgYy5UeXBlZEF0dHJpYnV0ZXMuZm9yRWFjaCh0YSA9PiB7IGxldCB0YU5hbWUgPSBuTmFtZSh0YSkgKyAnXycgKyB0YS5FbnRpdHlDbGFzcy5QbHVyYWwucmVwbGFjZSgvIC9nLCAnXycpOyU+DQogICAgICAgICAgICAgICAgLy88JT10YU5hbWUlPjogdGhpcy48JT10YU5hbWUlPigpLmZvckVhY2godCA9PiB0LjwlPW1OYW1lJT4oZCkpLA0KPCUgfSklPg0KICAgICAgICAgICAgfSwgIjwlPW1OYW1lJT4iLCBkKTsNCg0KDQo8JSBjLkVudGl0eUF0dHJpYnV0ZXMuZmlsdGVyKGVhID0+ICFlYS5FbnRpdHlNZXRob2QgJiYgZWEuRW50aXR5VHlwZSkuZm9yRWFjaChlYSA9PiB7JT4NCiAgICAgICAgICAgIGlmKHRoaXMuXzwlPW5OYW1lKGVhKSU+X3NldCAmJiB0aGlzLjwlPW5OYW1lKGVhKSU+KCkpIHRoaXMuPCU9bk5hbWUoZWEpJT4oKS48JT1tTmFtZSU+KGQpOw0KPCUgfSklPg0KDQo8JSBjLlR5cGVkQXR0cmlidXRlcy5mb3JFYWNoKHRhID0+IHsgbGV0IHRhTmFtZSA9IG5OYW1lKHRhKSArICdfJyArIHRhLkVudGl0eUNsYXNzLlBsdXJhbC5yZXBsYWNlKC8gL2csICdfJyk7JT4NCiAgICAgICAgICAgIC8vIHRoaXMuPCU9dGFOYW1lJT4oKS5mb3JFYWNoKHQgPT4gdC48JT1tTmFtZSU+KGQpKTsNCjwlIH0pJT4NCiAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICB9DQoNCiAgICAgICAgcmV0dXJuIHRoaXMuXzwlPW1OYW1lJT5bdGhpcy5Ub29sLm5hbWVdOyAvLyBnZXQgdGhlIHZhbHVlDQogICAgfQ0KICAgIA0KICAgIDwlPW1OYW1lPSdfY2xvbmUnJT4oYlR5cGVBdHRyaWJ1dGVzKXsNCiAgICAgICAgPCU9d2FybigpJT4iREVQUkVDQVRFRDogdXNlIG5ldyA8JT1zY29wZSU+LjwlPV9jTmFtZShjLk5hbWUsIHRydWUpJT4oKS5fZnJvbURvY3VtZW50KHRoaXMuX3RvSlNPTigpKSIpOw0KDQogICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICANCiAgICAgICAgdHJ5ew0KICAgICAgICAgICAgcmV0dXJuIHRoaXMuX19leHBvcnQobmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKGMuTmFtZSwgdHJ1ZSklPigpLCB7DQo8JSBjLkVudGl0eUF0dHJpYnV0ZXMuZmlsdGVyKGVhID0+ICFlYS5FbnRpdHlNZXRob2QpLmZvckVhY2goZWEgPT4geyU+DQogICAgICAgICAgICAgICAgPCU9bk5hbWUoZWEpJT46IChvYmosIGVhQ29kZSwgdikgPT4gb2JqLjwlPW5OYW1lKGVhKSU+KHY8JWlmKGVhLkVudGl0eVR5cGUpeyU+LjwlPW1OYW1lJT4oYlR5cGVBdHRyaWJ1dGVzKTwlfSU+KSwNCjwlIH0pOyU+DQo8JSBjLlR5cGVkQXR0cmlidXRlcy5mb3JFYWNoKHRhID0+IHsgbGV0IHRhTmFtZSA9IG5OYW1lKHRhKSArICdfJyArIHRhLkVudGl0eUNsYXNzLlBsdXJhbC5yZXBsYWNlKC8gL2csICdfJyk7JT4NCiAgICAgICAgICAgICAgICA8JT10YU5hbWUlPjogKG9iaiwgZWFDb2RlLCB2KSA9PiBiVHlwZUF0dHJpYnV0ZXM/b2JqLjwlPXRhTmFtZSU+KHYubWFwKF92ID0+IF92LjwlPW1OYW1lJT4oYlR5cGVBdHRyaWJ1dGVzKSkpOm51bGwsDQo8JSB9KTslPg0KICAgICAgICAgICAgfSwgIjwlPW1OYW1lJT4iKTsNCiAgICAgICAgfWNhdGNoKGV4KXsNCiAgICAgICAgICAgIDwlPWVycm9yKCklPmV4KTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIDwlPW1OYW1lPSdfbWFwJyU+KGNvZGUsIGJSZXZlcnNlLCBjb250ZXh0LCBvYmpGcm9tLCBvYmpUbywgZWFDb2RlLCBjbGFzc05hbWUsIHRvb2wsIGNvZGVUeXBlLCBfdGhpcywgbW9kdWxlTmFtZSl7DQogICAgICAgIF90aGlzID0gX3RoaXMgfHwgdGhpczsNCiAgICAgICAgY29udGV4dCA9IGNvbnRleHQgfHwgJ0VudGl0eUF0dHJpYnV0ZSc7DQogICAgICAgIHRvb2wgPSB0b29sIHx8IF90aGlzLlRvb2w7DQogICAgICAgIGNvZGVUeXBlID0gY29kZVR5cGUgfHwgPCU9X2VhVHlwZXMoKSU+W2NvZGVdOw0KICAgICAgICBjbGFzc05hbWUgPSBjbGFzc05hbWUgfHwgIjwlPW5OYW1lKGMpJT4iOw0KICAgICAgICBtb2R1bGVOYW1lID0gbW9kdWxlTmFtZSB8fCAiPCU9Yy5FbnRpdHlNb2R1bGU/Yy5FbnRpdHlNb2R1bGUuTmFtZTonJyU+IjsNCg0KPCUgaWYobWFpbkNsYXNzKCkhPWMpeyU+DQogICAgICAgIHJldHVybiBuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUobWFpbkNsYXNzKCksIHRydWUpJT4oKS48JT1tTmFtZSU+KGNvZGUsIGJSZXZlcnNlLCBjb250ZXh0LCBvYmpGcm9tLCBvYmpUbywgZWFDb2RlLCBjbGFzc05hbWUsIHRvb2wsIGNvZGVUeXBlLCBfdGhpcywgbW9kdWxlTmFtZSk7DQo8JSB9ZWxzZXslPg0KICAgICAgICB0cnl7DQogICAgICAgICAgICBsZXQgX2xvZyA9IGAke21vZHVsZU5hbWV9LiR7Y2xhc3NOYW1lfS4ke2NvbnRleHR9JHtiUmV2ZXJzZT8nPD0nOic9Pid9JHtjb2RlfWA7DQogICAgICAgICAgICANCiAgICAgICAgICAgIC8vaWYoQXJyYXkuaXNBcnJheShvYmpGcm9tKSkgcmV0dXJuIG9iakZyb20ubWFwKG8gPT4gdGhpcy48JT1tTmFtZSU+KGNvZGUsIGJSZXZlcnNlLCBjb250ZXh0LCBvLCBvYmpUbywgZWFDb2RlLCBjbGFzc05hbWUsIHRvb2wsIGNvZGVUeXBlLCBfdGhpcywgbW9kdWxlTmFtZSkpOw0KICAgICAgICANCiAgICAgICAgICAgIDwlIC8qIHRlbXB0ZWQgdG8gdXNlIGpzb25hdGEgaW4gUXVlcnkgZmllbGRzLCBkb2VzIG5vdCB3b3JrIGJlY2F1c2UganNvbmF0YS5ldmFsdWF0ZSByZXR1cm4gYSBwcm9taXNlISEhICovJT4NCiAgICAgICAgICAgIGxldCBzRmllbGQgPSBiUmV2ZXJzZT8ndGFyZ2V0Jzonc291cmNlJzsNCiAgICAgICAgICAgIGxldCBzU2NyaXB0ID0gKGJSZXZlcnNlPydvdXQnOidpbicpKydTY3JpcHQnOw0KICAgICAgICAgICAgbGV0IHNDb25kID0gKGJSZXZlcnNlPydvdXQnOidpbicpKydDb25kaXRpb24nOw0KICAgICAgICAgICAgbGV0IHNQYXRoID0gKGJSZXZlcnNlPydvdXQnOidpbicpKydQYXRoJzsNCiAgICAgICAgICAgIGxldCB0RmllbGQgPSBiUmV2ZXJzZT8nc291cmNlJzondGFyZ2V0JzsNCiAgICAgICAgICAgIGxldCB0U2NyaXB0ID0gKGJSZXZlcnNlPydpbic6J291dCcpKydTY3JpcHQnOw0KICAgICAgICAgICAgbGV0IHRQYXRoID0gKGJSZXZlcnNlPydpbic6J291dCcpKydQYXRoJzsNCiAgICAgICAgICAgIGxldCB0Q29uZCA9IChiUmV2ZXJzZT8naW4nOidvdXQnKSsnQ29uZGl0aW9uJzsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgbGV0IGxvZyA9ICguLi5zKSA9PiA8JT1sb2coKSU+Y2xhc3NOYW1lLCBfbG9nLCAuLi5zKTsNCiAgICAgICAgICAgIGxldCB3YXJuID0gKC4uLnMpID0+IDwlPXdhcm4oKSU+Y2xhc3NOYW1lLCBfbG9nLCAuLi5zKTsNCiAgICAgICAgICAgIGxldCBlcnJvciA9ICguLi5zKSA9PiA8JT1lcnJvcigpJT5jbGFzc05hbWUsIF9sb2csIC4uLnMpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBsZXQgb3B0aW9ucyA9IHtfY2xhc3M6IGNsYXNzTmFtZSwgX3RoaXM6IF90aGlzLCB0b29sOiB0b29sfTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgbGV0IF9zY3JpcHQgPSAocywgbSkgPT4gew0KICAgICAgICAgICAgICAgIHRyeXsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucnVuU2NyaXB0KGAob1Njb3BlLCBtLCBvYmpGcm9tLCBvYmpUbywgY29kZSwgX3RoaXMsIGNsYXNzTmFtZSwgdG9vbCwgY29kZVR5cGUsIGVhQ29kZSwgYlJldmVyc2UsIGNvbnRleHQsIGxvZywgd2FybiwgZXJyb3IpID0+ICR7c31gKSg8JT1zY29wZSU+LCBtLCBvYmpGcm9tLCBvYmpUbywgY29kZSwgX3RoaXMsIGNsYXNzTmFtZSwgdG9vbCwgY29kZVR5cGUsIGVhQ29kZSwgYlJldmVyc2UsIGNvbnRleHQsIGxvZywgd2FybiwgZXJyb3IpOw0KICAgICAgICAgICAgICAgIH1jYXRjaChleCl7DQogICAgICAgICAgICAgICAgICAgIHdhcm4obS50ZXN0cy5sb2csIGV4KTsgDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgbGV0IF9tYXRjaCA9IChzLCByKSA9PiB7DQogICAgICAgICAgICAgICAgaWYodHlwZW9mKHMpPT09J3VuZGVmaW5lZCcgfHwgcz09PW51bGwgfHwgdHlwZW9mKHMubWF0Y2gpIT09J2Z1bmN0aW9uJykgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgICAgIGxldCBhbnN3ZXIgPSBzLm1hdGNoKG5ldyBSZWdFeHAociwgJ2cnKSk7DQogICAgICAgICAgICAgICAgcmV0dXJuIHM9PXIgfHwgKChhbnN3ZXIgJiYgYW5zd2VyLmxlbmd0aCk/dHJ1ZTpmYWxzZSk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGNvbnN0IGNsb25lID0gaXRlbXMgPT4gaXRlbXMubWFwKGl0ZW0gPT4gQXJyYXkuaXNBcnJheShpdGVtKSA/IGNsb25lKGl0ZW0pIDogaXRlbSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGxldCBtcyA9IGNsb25lKCBbLi4uKHRvb2wudG9vbF9NYXBwaW5ncyB8fCBbXSkuY29uY2F0KHRvb2wudHlwZS50eXBlX01hcHBpbmdzIHx8IFtdKV0gKTsgLy8gZG8gbm90IHRhbXBlciB3aXRoIHRoZSBtYXBwaW5ncywgZGVlcCBjbG9uZQ0KICAgICAgICAgICAgbXMuZm9yRWFjaChtID0+IE9iamVjdC5rZXlzKG0pLmZvckVhY2goayA9PiBtW2tdID0gdGhpcy5fcGFyYW1ldHJpemUobVtrXSwgcCA9PiB0aGlzLl9fY29uZmlnKHApIHx8IERvdE9iamVjdC5waWNrKHAsIG9wdGlvbnMpLCBvcHRpb25zKSkpOw0KICAgICAgICAgICAgbXMuZm9yRWFjaChtID0+IG0udGVzdHMgPSB7DQogICAgICAgICAgICAgICAgYWN0aXZlOiA8JXZhbHVlT2YoIm0uYWN0aXZlIiklPiwgLy9fc2NyaXB0KG0uYWN0aXZlLCBtKSwNCiAgICAgICAgICAgICAgICBlbmFibGVkOiA8JXZhbHVlT2YoIm0uZW5hYmxlZCIpJT4sIC8vX3NjcmlwdChtLmVuYWJsZWQsIG0pLA0KICAgICAgICAgICAgICAgIGNvbnRleHQ6IF9tYXRjaChjb250ZXh0LCBtLmNvbnRleHQpLA0KICAgICAgICAgICAgICAgIGNsYXNzOiBfbWF0Y2goY2xhc3NOYW1lLCBtLmNsYXNzTmFtZSksDQogICAgICAgICAgICAgICAgbW9kdWxlOiBfbWF0Y2gobW9kdWxlTmFtZSwgbS5tb2R1bGVOYW1lKSwNCiAgICAgICAgICAgICAgICBzRmllbGQ6IHR5cGVvZihjb2RlKT09PSd1bmRlZmluZWQnIHx8IF9tYXRjaChjb2RlLCBtW3NGaWVsZF0pLA0KICAgICAgICAgICAgICAgIHNTY3JpcHQ6IHR5cGVvZihjb2RlKT09PSd1bmRlZmluZWQnIHx8IHR5cGVvZihtW3NTY3JpcHRdKSE9PSd1bmRlZmluZWQnLA0KICAgICAgICAgICAgICAgIHNQYXRoOiB0eXBlb2YobVtzUGF0aF0pIT09J3VuZGVmaW5lZCcsDQogICAgICAgICAgICAgICAgdGFyZ2V0OiB0eXBlb2YobVt0RmllbGRdIHx8IG1bdFNjcmlwdF0gfHwgbVt0UGF0aF0pIT09J3VuZGVmaW5lZCcsDQogICAgICAgICAgICAgICAgdGV4dDogYCR7Y29kZX06JHtzRmllbGR9PT0+JHt0RmllbGR9YCwNCiAgICAgICAgICAgICAgICBsb2c6IGAke19sb2d9WyR7bS5jb250ZXh0fS8ke20uY2xhc3NOYW1lfV1gLA0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgICBtcyA9IG1zLmZpbHRlcihtID0+IG0udGVzdHMuYWN0aXZlICYmIG0udGVzdHMuZW5hYmxlZCAmJiBtLnRlc3RzLmNvbnRleHQgJiYgbS50ZXN0cy5jbGFzcyAmJiBtLnRlc3RzLm1vZHVsZSAmJiAobS50ZXN0cy5zRmllbGQgfHwgbS50ZXN0cy5zU2NyaXB0IHx8IG0udGVzdHMuc1BhdGgpICYmIG0udGVzdHMudGFyZ2V0KS5zb3J0KChhLCBiKSA9PiBhLm9yZGVyIC0gYi5vcmRlcik7DQogICAgICAgICAgICANCiAgICAgICAgICAgIDwlIC8qIHdlIG1pZ2h0IG5vdCB3b3JrIHdpdGggYWxsIG1zIGVudHJpZXMuIGxvZyBoZXJlIGlzIG9ubHkgYSBwcmV2aWV3IG9mIHdoYXQgbWlnaHQgd29yayEgKi8gJT4NCiAgICAgICAgICAgIC8vaWYobXMuZmlsdGVyKG0gPT4gbS5kZWJ1ZykubGVuZ3RoKSBsb2codGhpcy5fYmVhdXRpZnkobXMuZmlsdGVyKG0gPT4gbS5kZWJ1ZyksICdqYXZhc2NyaXB0JykpOw0KDQogICAgICAgICAgICBtcy5mb3JFYWNoKG0gPT4gew0KICAgICAgICAgICAgICAgIGlmKG1bdFNjcmlwdF0pew0KICAgICAgICAgICAgICAgICAgICBpZih0eXBlb2YobVt0Q29uZF0pPT09J3VuZGVmaW5lZCcgfHwgPCV2YWx1ZU9mKCJtW3RDb25kXSIsICdfdGhpcycpJT4pew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYobS5kZWJ1ZykgbG9nKG0udGVzdHMubG9nICsgJzogJyArIHRTY3JpcHQsICc8JT1tTmFtZSU+JywgbVt0U2NyaXB0XSk7DQogICAgICAgICAgICAgICAgICAgICAgICBjb2RlID0gPCV2YWx1ZU9mKCJtW3RTY3JpcHRdIiwgJ190aGlzJyklPg0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIGlmKG1bc1BhdGhdICYmIHR5cGVvZihqbWVzcGF0aCkhPT0ndW5kZWZpbmVkJykgY29kZSA9IGptZXNwYXRoLnNlYXJjaChvYmpGcm9tLCBtW3NQYXRoXSk7DQogICAgICAgICAgICAgICAgaWYobVtzUGF0aF0gJiYgdHlwZW9mKGpzb25wYXRoKSE9PSd1bmRlZmluZWQnKSBjb2RlID0ganNvbnBhdGgucXVlcnkob2JqRnJvbSwgbVtzUGF0aF0pOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIGlmKG1bdEZpZWxkXSl7DQogICAgICAgICAgICAgICAgICAgIGxldCBkUGF0aCA9ICcnOw0KICAgICAgICAgICAgICAgICAgICBpZih0eXBlb2YobVt0RmllbGRdKT09PSdmdW5jdGlvbicpew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYodHlwZW9mKGNvZGUpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRQYXRoID0gYCR7Y29kZX0ucmVwbGFjZWA7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29kZSA9IGNvZGUucmVwbGFjZShuZXcgUmVnRXhwKG1bc0ZpZWxkXSwgJ2cnKSwgbVt0RmllbGRdKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vY29kZSA9IERvdE9iamVjdC5jb3B5KG1bc0ZpZWxkXSwgbVt0RmllbGRdLCBvYmpGcm9tLCBvYmpUbyk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYodHlwZW9mKGNvZGUpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKF9tYXRjaChjb2RlLCBtW3NGaWVsZF0pKXsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZFBhdGggPSBgJHtjb2RlfS5jb2RlYDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29kZSA9IG1bdEZpZWxkXTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkUGF0aCA9IGBkb3Rjb3B5YDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2RlID0gRG90T2JqZWN0LmNvcHkobVtzRmllbGRdLCBtW3RGaWVsZF0sIG9iakZyb20sIG9ialRvKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgaWYobS5kZWJ1ZyAmJiBkUGF0aCkgbG9nKGAke20udGVzdHMubG9nfS8ke2RQYXRofVtjb2RlPSR7Y29kZX1dOiAke21bc0ZpZWxkXX0gPT4gJHttW3RGaWVsZF19YCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIGlmKG1bdFBhdGhdICYmIHR5cGVvZihqbWVzcGF0aCkhPT0ndW5kZWZpbmVkJyAmJiAoIW1bdENvbmRdIHx8IGptZXNwYXRoLnNlYXJjaChvYmpUbywgbVt0Q29uZF0pKSkgb2JqVG9bbVt0RmllbGRdXSA9IGptZXNwYXRoLnNlYXJjaChvYmpUbywgbVt0UGF0aF0pOw0KICAgICAgICAgICAgICAgIGlmKG1bdFBhdGhdICYmIHR5cGVvZihqc29ucGF0aCkhPT0ndW5kZWZpbmVkJyAmJiAoIW1bdENvbmRdIHx8IGpzb25wYXRoLnF1ZXJ5KG9ialRvLCBtW3RDb25kXSkpKSBvYmpUb1ttW3RGaWVsZF1dID0ganNvbnBhdGgucXVlcnkob2JqVG8sIG1bdFBhdGhdKTsNCiAgICAgICAgICAgIH0pOw0KDQogICAgICAgICAgICBtcy5mb3JFYWNoKG0gPT4gZGVsZXRlIG0udGVzdHMpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBpZih0eXBlb2YoY29kZSk9PT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgcmV0dXJuIG9ialRvOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICAvL2lmKGNvbnRleHQ9PSdFbnRpdHlDbGFzcycgJiYgY2xhc3NOYW1lPT0nVXNlcicpIDwlPXdhcm4oKSU+IkdPVCBIRVJFIiwgY29kZSwgY29udGV4dCwgb3B0aW9ucyk7DQogICAgICAgICAgICByZXR1cm4gdGhpcy5fcGFyYW1ldHJpemUoY29kZSwgcCA9PiB0aGlzLl9fY29uZmlnKHApIHx8IERvdE9iamVjdC5waWNrKHAsIG9wdGlvbnMpLCBvcHRpb25zKTsNCiAgICAgICAgfWNhdGNoKGV4KXsNCiAgICAgICAgICAgIDwlPWVycm9yKCklPmV4KTsNCiAgICAgICAgfQ0KPCUgfSU+DQogICAgfQ0KICAgIA0KICAgIDwlPW1OYW1lPSdfbkNvZGUnJT4oY29kZSwgb0NvZGUpew0KICAgICAgICB0cnl7DQogICAgICAgICAgICBsZXQgY29udGV4dCA9ICdFbnRpdHlBdHRyaWJ1dGUnOw0KICAgICAgICAgICAgaWYoIWNvZGUgJiYgIW9Db2RlKXsNCiAgICAgICAgICAgICAgICBjb250ZXh0ID0gJ0VudGl0eUNsYXNzJzsNCiAgICAgICAgICAgICAgICBjb2RlID0gIjwlPW5Db2RlKGMpJT4iOw0KICAgICAgICAgICAgICAgIG9Db2RlID0gPCU9X0ZyRU1ELl90b0pTKGMuQ29kZSklPjsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgbGV0IHJldCA9IGNvZGU7DQogICAgICAgICAgICBpZihvQ29kZSAmJiB0eXBlb2Yob0NvZGUpPT09J29iamVjdCcpew0KICAgICAgICAgICAgICAgIHJldCA9IG9Db2RlW3RoaXMuVG9vbC5uYW1lXSB8fCBvQ29kZVt0aGlzLlRvb2wudHlwZS5uYW1lXSB8fCByZXQ7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHJldHVybiB0aGlzLl9tYXAocmV0LCBmYWxzZSwgY29udGV4dCkgfHwgcmV0Ow0KICAgICAgICB9Y2F0Y2goZXgpew0KICAgICAgICAgICAgPCU9d2FybigpJT5leCk7DQogICAgICAgICAgICByZXR1cm4gY29kZTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICANCiAgICA8JT1tTmFtZT0nX19jb25maWcnJT4obiwgbnVsbFZhbHVlLCBvcHRpb25zKXsNCiAgICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307DQogICAgICAgIG9wdGlvbnMuX3RoaXMgPSBvcHRpb25zLl90aGlzIHx8IHRoaXM7DQogICAgICAgIG9wdGlvbnMuX2NsYXNzID0gb3B0aW9ucy5fY2xhc3MgfHwgJzwlPW5OYW1lKGMpJT4nOw0KICAgICAgICBvcHRpb25zLnRvb2wgPSBvcHRpb25zLnRvb2wgfHwgb3B0aW9ucy5fdGhpcy5Ub29sIHx8IHRoaXMuVG9vbDsNCiAgICAgICAgaWYodHlwZW9mKG9wdGlvbnMudG9vbCk9PT0nb2JqZWN0JyAmJiBvcHRpb25zLnRvb2wuY29uc3RydWN0b3IubmFtZT09J1Rvb2wnKSBvcHRpb25zLnRvb2wgPSAoPCU9c2NvcGUlPi5Ub29scyB8fCBbXSkuZmluZCh0ID0+IHQubmFtZT09b3B0aW9ucy50b29sLm5hbWUoKSk7DQogICAgICAgIA0KICAgICAgICBpZih0eXBlb2Yob3B0aW9ucy50b29sKT09PSdzdHJpbmcnKSBvcHRpb25zLnRvb2wgPSAoPCU9c2NvcGUlPi5Ub29scyB8fCBbXSkuZmluZCh0ID0+IHQubmFtZT09b3B0aW9ucy50b29sIHx8IHQudHlwZS5uYW1lPT1vcHRpb25zLnRvb2wpOw0KDQo8JSBpZihtYWluQ2xhc3MoKSE9Yyl7JT4NCiAgICAgICAgcmV0dXJuIG5ldyA8JT1zY29wZSU+LjwlPV9jTmFtZShtYWluQ2xhc3MoKSwgdHJ1ZSklPigpLjwlPW1OYW1lJT4obiwgbnVsbFZhbHVlLCBPYmplY3QuYXNzaWduKHtfdGhpczogdGhpcywgdG9vbDogdGhpcy5Ub29sLCBfY2xhc3M6ICc8JT1uTmFtZShjKSU+J30sIG9wdGlvbnMgfHwge30pKTsNCjwlIH1lbHNleyU+DQogICAgICAgIHRyeXsNCiAgICAgICAgICAgIGlmKHR5cGVvZihvcHRpb25zLnRvb2wpIT09J29iamVjdCcpIDwlPXdhcm4oKSU+b3B0aW9ucy50b29sKTsNCiAgICAgICAgICAgIGlmKCFvcHRpb25zLnRvb2wpIDwlPXdhcm4oKSU+InRvb2wgbm90IGRlZmluZWQiLCBvcHRpb25zLl90aGlzLlRvb2wsIDwlPXNjb3BlJT4uVG9vbHMsIG9wdGlvbnMuX3RoaXMuVG9vbHMpOw0KICAgICAgICAgICAgLy9vcHRpb25zLm5vQ2FjaGUgPSB0cnVlOw0KICAgICAgICAgICAgaWYoIW9wdGlvbnMubm9DYWNoZSkgPCU9c2NvcGUlPi48JT1tTmFtZSU+ID0gPCU9c2NvcGUlPi48JT1tTmFtZSU+IHx8IHt9Ow0KDQogICAgICAgICAgICBsZXQgbklEID0gPCU9bnNjb3BlJT4uX25vZGU/PCU9bnNjb3BlJT4uX25vZGUuY29kZSgpOidkZWZhdWx0JzsNCg0KICAgICAgICAgICAgaWYodHlwZW9mKG9wdGlvbnNbbl0pIT09J3VuZGVmaW5lZCcpIG51bGxWYWx1ZSA9IG51bGxWYWx1ZSB8fCBvcHRpb25zW25dOw0KICAgICAgICAgICAgbGV0IHJldCA9IG51bGxWYWx1ZTsNCiAgICAgICAgICAgIGlmKHR5cGVvZihyZXQpPT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHJldCA9IG51bGw7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgLy8gdXNlIHNjb3BlIGNhY2hlIChpbXByb3ZlcyBwZXJmb3JtYW5jZT8/PykNCiAgICAgICAgICAgICAgICBpZighb3B0aW9ucy5ub0NhY2hlICYmIE9iamVjdC5oYXNPd24oPCU9c2NvcGUlPi48JT1tTmFtZSU+LCBgJHtvcHRpb25zLl9jbGFzc30uJHtvcHRpb25zLnRvb2wubmFtZX0uJHtuSUR9LiR7bn1gKSkgcmV0dXJuIDwlPXNjb3BlJT4uPCU9bU5hbWUlPltgJHtvcHRpb25zLl9jbGFzc30uJHtvcHRpb25zLnRvb2wubmFtZX0uJHtuSUR9LiR7bn1gXTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgLy8gdG9vbF9Db25maWdzLCB0eXBlX0NvbmZpZ3M6IGFsbG93IGNsYXNzLWxldmVsIGFuZCBub2RlLWxldmVsIC0gZG9uZQ0KICAgICAgICAgICAgbGV0IHRjb25mID0gW10uY29uY2F0KG9wdGlvbnMudG9vbC50eXBlLnR5cGVfQ29uZmlncyB8fCBbXSwgb3B0aW9ucy50b29sLnRvb2xfQ29uZmlncyB8fCBbXSkuZmlsdGVyKGMgPT4gYyAmJiBjLm5hbWU9PW4gJiYgKCFjLm5vZGUgfHwgYy5ub2RlLmNvZGU9PW5JRCkpLnNvcnQoYyA9PiBjLm5vZGU/KGMubm9kZS5jb2RlPT0nZGVmYXVsdCc/MDotMSk6MSk7DQogICAgICAgICAgICBpZih0Y29uZi5sZW5ndGgpew0KICAgICAgICAgICAgICAgIGlmKHRjb25mWzBdLnNjcmlwdCl7DQogICAgICAgICAgICAgICAgICAgIHJldCA9IHRjb25mWzBdLnNjcmlwdDsNCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIGxldCBfc2MgPSB0aGlzLl9wYXJhbWV0cml6ZSh0Y29uZlswXS5zY3JpcHQsIHAgPT4gdGhpcy48JT1tTmFtZSU+KHAsIG51bGwsIG9wdGlvbnMpIHx8IERvdE9iamVjdC5waWNrKHAsIG9wdGlvbnMpLCBvcHRpb25zKTsNCiAgICAgICAgICAgICAgICAgICAgcmV0ID0gPCV2YWx1ZU9mKCJfc2MiKSU+Ow0KICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICByZXQgPSB0Y29uZlswXS52YWx1ZTsNCiAgICAgICAgICAgICAgICAgICAgdHJ5ew0KICAgICAgICAgICAgICAgICAgICAgICAgWzEsMiwzXS5mb3JFYWNoKGEgPT4gcmV0ID0gSlNPTi5wYXJzZShyZXQpKTsNCiAgICAgICAgICAgICAgICAgICAgfWNhdGNoKGpleCl7fQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmKG9wdGlvbnMubmV3VmFsdWUpew0KICAgICAgICAgICAgICAgIGxldCB0YyA9IHRjb25mLmxlbmd0aD90Y29uZlswXTp7fTsNCiAgICAgICAgICAgICAgICBpZihvcHRpb25zLm5vZGUpIHRjLm5vZGUgPSB7Y29kZTogb3B0aW9ucy5ub2RlLmNvZGUoKX07DQogICAgICAgICAgICAgICAgdGMudmFsdWUgPSBvcHRpb25zLm5ld1ZhbHVlOw0KICAgICAgICAgICAgICAgIHRjLm5hbWUgPSBuOw0KICAgICAgICAgICAgICAgIGlmKCF0Y29uZi5sZW5ndGgpew0KICAgICAgICAgICAgICAgICAgICAob3B0aW9ucy50b29sLnRvb2xfQ29uZmlncyB8fCBvcHRpb25zLnRvb2wudHlwZS50eXBlX0NvbmZpZ3MpLnB1c2godGMpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICByZXQgPSBvcHRpb25zLm5ld1ZhbHVlOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAvLyBtb2RlbCBDb25maWc6IENvbmZpZyBpcyBjbGFzcyBsZXZlbCwgbm9kZSBub3QgcG9zc2libGUgLSBwZW5kaW5nDQogICAgICAgICAgICBsZXQgbWNvbmYgPSBvcHRpb25zLl90aGlzLkNvbmZpZz9vcHRpb25zLl90aGlzLkNvbmZpZ1tuXTp1bmRlZmluZWQ7DQogICAgICAgICAgICBtY29uZiA9IHRoaXMuX3BhcmFtZXRyaXplKG1jb25mLCBwID0+IHRoaXMuPCU9bU5hbWUlPihwLCBudWxsLCBvcHRpb25zKSB8fCBEb3RPYmplY3QucGljayhwLCBvcHRpb25zKSwgb3B0aW9ucyk7DQogICAgICAgICAgICBtY29uZiA9IDwldmFsdWVPZigibWNvbmYiKSU+Ow0KICAgICAgICAgICAgaWYodHlwZW9mKG1jb25mKSE9PSJ1bmRlZmluZWQiKSByZXQgPSBtY29uZjsNCg0KICAgICAgICAgICAgLy8gY29tbWFuZCBsaW5lOiBhbGxvdyBjbGFzcy1sZXZlbCBhbmQgbm9kZS1sZXZlbCAtIHBlbmRpbmcNCiAgICAgICAgICAgIGlmKHR5cGVvZihnbG9iYWwpIT09J3VuZGVmaW5lZCcgJiYgZ2xvYmFsLm1pbmltaXN0KXsNCiAgICAgICAgICAgICAgICByZXQgPSBEb3RPYmplY3QucGljayhuLCBnbG9iYWwubWluaW1pc3QocHJvY2Vzcy5hcmd2LnNsaWNlKDIpKSkgfHwgcmV0Ow0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICAvLyByZXF1ZXN0OiBhbGxvdyBjbGFzcy1sZXZlbCBhbmQgbm9kZS1sZXZlbCAtIHBlbmRpbmcNCiAgICAgICAgICAgIGlmKHRoaXMuJF9SRVFVRVNUKSByZXQgPSB0aGlzLiRfUkVRVUVTVChuKSB8fCByZXQ7DQogICAgICAgICAgICANCiAgICAgICAgICAgIC8vIGNvbmZpZyByZXBsYWNlbWVudA0KICAgICAgICAgICAgcmV0ID0gdGhpcy5fcGFyYW1ldHJpemUocmV0LCBwID0+IHRoaXMuPCU9bU5hbWUlPihwLCBudWxsLCBvcHRpb25zKSB8fCBEb3RPYmplY3QucGljayhwLCBvcHRpb25zKSwgb3B0aW9ucyk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGlmKCFvcHRpb25zLm5vQ2FjaGUpIDwlPXNjb3BlJT4uPCU9bU5hbWUlPltgJHtvcHRpb25zLl9jbGFzc30uJHtvcHRpb25zLnRvb2wubmFtZX0uJHtuSUR9LiR7bn1gXSA9IHJldDsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgcmV0ID0gPCV2YWx1ZU9mKCJyZXQiKSU+Ow0KICAgICAgICAgICAgDQogICAgICAgICAgICByZXR1cm4gcmV0Ow0KICAgICAgICB9Y2F0Y2goZXgpew0KICAgICAgICAgICAgPCU9d2FybigpJT5uLCBudWxsVmFsdWUsIG9wdGlvbnMuX2NsYXNzLCBvcHRpb25zLnRvb2wudG9vbF9Db25maWdzLCBleCk7DQogICAgICAgIH0NCjwlIH0lPg0KICAgIH0NCg0KDQo8JSBjLkVudGl0eU1ldGhvZHMuZm9yRWFjaChtID0+IHslPg0KICAgIC8qKg0KICAgICAqIFN1bW1hcnkuIDwlPW0uTmFtZSU+Lg0KICAgICAqDQogICAgICogRGVzY3JpcHRpb24uIDwlPW0uUmVtYXJrJT4uDQogICAgICoNCiAgICAgKiBAc2luY2UgICAgICB4LngueA0KICAgICAqIEBkZXByZWNhdGVkIHgueC54IFVzZSBuZXdfZnVuY3Rpb25fbmFtZSgpIGluc3RlYWQuDQogICAgICogQGFjY2VzcyAgICAgcHVibGljDQogICAgICoNCiAgICAgKiBAY2xhc3MNCiAgICAgKiBAYXVnbWVudHMgcGFyZW50DQogICAgICogQG1peGVzICAgIG1peGluDQogICAgICoNCiAgICAgKiBAYWxpYXMgICAgcmVhbE5hbWUNCiAgICAgKiBAbWVtYmVyb2YgbmFtZXNwYWNlDQogICAgICoNCiAgICAgKiBAc2VlICBGdW5jdGlvbi9jbGFzcyByZWxpZWQgb24NCiAgICAgKiBAbGluayBVUkwNCiAgICAgKiBAZ2xvYmFsDQogICAgICoNCiAgICAgKiBAZmlyZXMgICBldmVudE5hbWUNCiAgICAgKiBAZmlyZXMgICBjbGFzc05hbWUjZXZlbnROYW1lDQogICAgICogQGxpc3RlbnMgZXZlbnQ6ZXZlbnROYW1lDQogICAgICogQGxpc3RlbnMgY2xhc3NOYW1lfmV2ZW50OmV2ZW50TmFtZQ0KICAgICAqIEBwYXJhbSB7dHlwZX0gICB2YXIgICAgICAgICAgIERlc2NyaXB0aW9uLg0KICAgICAqIEBwYXJhbSB7dHlwZX0gICBbdmFyXSAgICAgICAgIERlc2NyaXB0aW9uIG9mIG9wdGlvbmFsIHZhcmlhYmxlLg0KICAgICAqIEBwYXJhbSB7dHlwZX0gICBbdmFyPWRlZmF1bHRdIERlc2NyaXB0aW9uIG9mIG9wdGlvbmFsIHZhcmlhYmxlIHdpdGggZGVmYXVsdCB2YXJpYWJsZS4NCiAgICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0VmFyICAgICBEZXNjcmlwdGlvbi4NCiAgICAgKiBAcGFyYW0ge3R5cGV9ICAgb2JqZWN0VmFyLmtleSBEZXNjcmlwdGlvbiBvZiBhIGtleSBpbiB0aGUgb2JqZWN0VmFyIHBhcmFtZXRlci4NCiAgICAgKg0KICAgICAqIEB5aWVsZCB7dHlwZX0gWWllbGRlZCB2YWx1ZSBkZXNjcmlwdGlvbi4NCiAgICAgKg0KICAgICAqIEByZXR1cm4ge3R5cGV9IFJldHVybiB2YWx1ZSBkZXNjcmlwdGlvbi4NCiAgICAgKi8NCiAgICA8JSBpZighbS5Jc1N5bmMpeyU+YXN5bmMgPCV9JT48JT1tTmFtZT1uQ29kZShtKSU+KDwlPW0uTWV0aG9kUGFyYW1ldGVycy5tYXAocCA9PiBuQ29kZShwKSkuam9pbignLCAnKSU+KXsNCg0KICAgIAlsZXQgbG9nID0gKG9iaiwgLi4ubXNnKSA9PiB0aGlzLmxvZygiPCU9bk5hbWUoYyklPiIsIG9iaiwgIjwlPW5Db2RlKG0pJT4iLCBudWxsLCAwLCAuLi5tc2cpOw0KICAgIAlsZXQgd2FybiA9IChvYmosIC4uLm1zZykgPT4gdGhpcy5sb2coIjwlPW5OYW1lKGMpJT4iLCBvYmosICI8JT1uQ29kZShtKSU+IiwgbnVsbCwgMSwgLi4ubXNnKTsNCiAgICAJbGV0IGVycm9yID0gKG9iaiwgLi4ubXNnKSA9PiB0aGlzLmxvZygiPCU9bk5hbWUoYyklPiIsIG9iaiwgIjwlPW5Db2RlKG0pJT4iLCBudWxsLCAyLCAuLi5tc2cpOw0KICAgIAlsZXQgb1Njb3BlID0gPCU9YWxpYXMoKSU+Ow0KICAgIAlsZXQgcFNjb3BlID0gPCU9c2NvcGUlPjsNCiAgICAgICAgDQogICAgDQo8JSBpZighbS5Jc1N5bmMpeyU+DQogICAgPCUgaWYoIW0uUmVzcG9uc2VBdHRyaWJ1dGUpeyAlPg0KICAgICAgICBsZXQgYW5zd2VyID0gbnVsbDsNCiAgICA8JSB9ZWxzZSBpZihtLlJlc3BvbnNlQXR0cmlidXRlLkVudGl0eVR5cGUpeyAlPg0KICAgICAgICBsZXQgYW5zd2VyID0gbmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKG0uUmVzcG9uc2VBdHRyaWJ1dGUuRW50aXR5VHlwZSwgdHJ1ZSklPigpOw0KICAgIDwlIH1lbHNlIGlmKG0uUmVzcG9uc2VBdHRyaWJ1dGUuSXNCb29sKXsgJT4NCiAgICAgICAgbGV0IGFuc3dlciA9IGZhbHNlOw0KICAgIDwlIH1lbHNlIGlmKG0uSXNBcnJheSl7ICU+DQogICAgICAgIGxldCBhbnN3ZXIgPSBbXTsNCiAgICA8JSB9ZWxzZXsgJT4NCiAgICAgICAgbGV0IGFuc3dlciA9IG51bGw7DQogICAgPCUgfSAlPg0KICAgIA0KICAgICAgICBsZXQgcmVzdWx0cyA9IGF3YWl0IHRoaXMuX2V4ZWN1dGUobnVsbCwgPCU9YWxpYXMoKSU+LCAiPCU9bkNvZGUobSklPiIsIDwlbVJvdXRpbmcoYywgbSklPiwgYXN5bmMgKCkgPT4gew0KICAgICAgICANCjwlIH0lPg0KPCUgbS5NZXRob2RQYXJhbWV0ZXJzLmZpbHRlcihwID0+IHAuRGVmYXVsdCkuZm9yRWFjaChwID0+IHslPg0KICAgICAgICBpZih0eXBlb2YoPCU9bk5hbWUocCklPik9PT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICA8JT1uTmFtZShwKSU+ID0gPCV2YWx1ZU9mKHAuRGVmYXVsdCklPjsNCiAgICAgICAgfQ0KPCUgfSklPg0KDQogICAgICAgIHZhciBlcnJvcnMgPSB7DQogICAgICAgIDwlICBbXS5jb25jYXQobS5NZXRob2RQYXJhbWV0ZXJzLmZpbHRlcihwID0+IHAuUmVxdWlyZWQpLm1hcChwID0+ICh7DQogICAgICAgICAgICAgICAgQ29kZTogYCR7bk5hbWUocCl9LXJlcXVpcmVkYCwNCiAgICAgICAgICAgICAgICBFcnJvcjogYCR7bk5hbWUocCl9IGlzIGEgcmVxdWlyZWQgUGFyYW1ldGVyYCwNCiAgICAgICAgICAgICAgICBTY3JpcHQ6IGB0eXBlb2YoJHtuTmFtZShwKX0pPT09J3VuZGVmaW5lZCdgLA0KICAgICAgICAgICAgfSkpKS5jb25jYXQobS5NZXRob2RQYXJhbWV0ZXJzLmZpbHRlcihwID0+IHAuRW50aXR5VHlwZSkubWFwKHAgPT4gKHsNCiAgICAgICAgICAgICAgICBDb2RlOiBgJHtuTmFtZShwKX1gLA0KICAgICAgICAgICAgICAgIEVycm9yOiBgJHtuTmFtZShwKX0gaXMgbm90IG9mIHR5cGUgJHtuTmFtZShwLkVudGl0eVR5cGUpfWAsDQogICAgICAgICAgICAgICAgU2NyaXB0OiBgKCEke25OYW1lKHApfSAmJiAke3AuUmVxdWlyZWQ/J3RydWUnOidmYWxzZSd9KSB8fCAoJHtuTmFtZShwKX0gJiYgKCR7bk5hbWUocCl9LmNvbnN0cnVjdG9yLm5hbWUhPScke25OYW1lKHAuRW50aXR5VHlwZSl9JyB8fCAke25OYW1lKHApfS5FbnRpdHlDbGFzcy5OYW1lIT0nJHtuTmFtZShwLkVudGl0eVR5cGUpfScpKWAsDQogICAgICAgICAgICB9KSkpLmNvbmNhdChtLlZhbGlkYXRvcnMgfHwgW10pLmZpbHRlcih2ID0+ICF2Lklnbm9yZSkuZm9yRWFjaCh2ID0+IHsgJT4NCiAgICAgICAgICAgICI8JT12LkNvZGUlPiI6ICgoPCU9bS5NZXRob2RQYXJhbWV0ZXJzLm1hcChwID0+IHAuTmFtZSkuam9pbignLCAnKSU+KSA9PiB7DQogICAgICAgICAgICAgICAgdHJ5ew0KDQogICAgICAgICAgICAgICAgPCUgaWYodi5TY3JpcHQuaW5kZXhPZigncmV0dXJuICcpPDApeyU+DQogICAgICAgICAgICAgICAgICAgIGxldCBhbnN3ZXIgPSANCiAgICAgICAgICAgICAgICA8JX0lPg0KICAgICAgICAgICAgICAgICAgICA8JT12LlNjcmlwdCU+DQogICAgICAgICAgICAgICAgICAgIC8vPCU9bG9nKCklPiJhbnN3ZXIiLCAiPCU9di5Db2RlJT4iLCBhbnN3ZXIpOw0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gYW5zd2VyOw0KICAgICAgICAgICAgICAgIH1jYXRjaChleCl7DQogICAgICAgICAgICAgICAgICAgIDwlPXdhcm4oKSU+InZhbGlkYXRvciIsICI8JT12LkNvZGUlPiIsIGV4KTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9KSg8JT1tLk1ldGhvZFBhcmFtZXRlcnMubWFwKHAgPT4gcC5OYW1lKS5qb2luKCcsICcpJT4pPygnPCU9di5FcnJvciU+JyB8fCAnVmFsaWRhdGlvbiBFcnJvcicpOicnLA0KICAgICAgICA8JSB9KSAlPg0KICAgICAgICB9Ow0KICAgICAgICBPYmplY3Qua2V5cyhlcnJvcnMpLmZpbHRlcihrID0+ICFlcnJvcnNba10pLmZvckVhY2goayA9PiBkZWxldGUgZXJyb3JzW2tdKTsNCiAgICAgICAgaWYoT2JqZWN0LmtleXMoZXJyb3JzKS5sZW5ndGgpew0KICAgICAgICAgICAgT2JqZWN0LmtleXMoZXJyb3JzKS5maWx0ZXIoayA9PiBrLnN0YXJ0c1dpdGgoJy0nKSkuZm9yRWFjaChrID0+IHsNCiAgICAgICAgICAgICAgICA8JT1sb2coKSU+e1trXTogZXJyb3JzW2tdfSk7DQogICAgICAgICAgICAgICAgZGVsZXRlIGVycm9yc1trXTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgaWYoT2JqZWN0LnZhbHVlcyhlcnJvcnMpLmxlbmd0aCl7DQogICAgICAgICAgICAgICAgcmV0dXJuIHsNCiAgICAgICAgICAgICAgICAgICAgX19leGNlcHRpb246IGVycm9ycywNCiAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQoNCiAgICAgICAgPCU9bS5TY3JpcHQlPg0KICAgICAgICANCjwlIGlmKCFtLklzU3luYyl7JT4NCiAgICAgICAgfSwge19fYmVmb3JlUnVsZXM6IFs8JShtLk1ldGhvZFJ1bGVzIHx8IFtdKS5maWx0ZXIociA9PiByLkJlZm9yZSkubWFwKHIgPT4geyU+PCU9X0ZyRU1ELl90b0pTKHIpJT48JSB9KS5qb2luKCcsICcpJT5dLCBfX2FmdGVyUnVsZXM6IFs8JShtLk1ldGhvZFJ1bGVzIHx8IFtdKS5maWx0ZXIociA9PiByLkFmdGVyKS5tYXAociA9PiB7JT48JT1fRnJFTUQuX3RvSlMociklPjwlIH0pLmpvaW4oJywgJyklPl0sIDwlPW0uTWV0aG9kUGFyYW1ldGVycy5tYXAocCA9PiBuQ29kZShwKSArICI6ICIgKyBuQ29kZShwKSkuam9pbignLCAnKSU+fSk7DQogICAgICAgIA0KICAgICAgICANCiAgICAgICAgLy8gdGFrZSBvdXQgdGhlIGludmFsaWQgbm9kZSByZXN1bHRzDQogICAgICAgIHJlc3VsdHMgPSByZXN1bHRzLmZpbHRlcihyID0+IHIgJiYgci5yZXQpOw0KDQogICAgICAgIC8vIGhhcyBhbnkgbm9kZSBnZW5lcmF0ZWQgYSB2YWxpZGF0aW9uIGV4Y2VwdGlvbj8NCiAgICAgICAgbGV0IF9fZXggPSByZXN1bHRzLmZpbmQociA9PiByLnJldC5fX2V4Y2VwdGlvbik7DQogICAgICAgIGlmKF9fZXgpIHJldHVybiBfX2V4LnJldDsNCg0KICAgICAgICA8JT1tLlJlZHVjZSU+DQoNCiAgICAgICAgPCUgaWYobS5Jc0FycmF5IHx8IG0uUmVzcG9uc2VBdHRyaWJ1dGUuSXNBcnJheSl7JT4NCiAgICAgICAgcmV0dXJuIHJlc3VsdHMubWFwKHIgPT4gci5yZXQpLmZsYXQoKTsNCiAgICAgICAgPCUgfWVsc2UgaWYobS5SZXNwb25zZUF0dHJpYnV0ZS5FbnRpdHlUeXBlKXsgJT4NCiAgICAgICAgcmV0dXJuIHJlc3VsdHMubGVuZ3RoP3Jlc3VsdHNbMF0ucmV0Om51bGw7DQogICAgICAgIDwlIH1lbHNleyAlPg0KICAgICAgICByZXR1cm4gcmVzdWx0cy5sZW5ndGg/cmVzdWx0c1swXS5yZXQ6bnVsbDsNCiAgICAgICAgPCUgfSU+DQo8JSB9JT4NCiAgICB9DQo8JSB9KTslPg0KDQo8JSBpZihtYWluQ2xhc3MoX3Jlc3RUb29scykpeyU+DQogICAgYXN5bmMgPCU9bU5hbWU9J19yZXNwb25zZUludGVyY2VwdG9yJyU+KGVycm9yLCB0KXsNCiAgICA8JSBpZihtYWluQ2xhc3MoX3Jlc3RUb29scykhPWMpeyU+DQogICAgICAgIHJldHVybiBhd2FpdCBuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUobWFpbkNsYXNzKF9yZXN0VG9vbHMpKSU+KCkuPCU9bU5hbWUlPihlcnJvciwgdCk7DQogICAgPCUgfWVsc2V7JT4NCiAgICAgICAgdHJ5ew0KICAgICAgICAgICAgdCA9IHQgfHwgdGhpcy5Ub29sOw0KICAgICAgICAgICAgY29uc3Qgb3JpZ2luYWxSZXF1ZXN0ID0gZXJyb3IuY29uZmlnOw0KICAgICAgICAgICAgaWYgKHRoaXMuX19jb25maWcoIm9hdXRoLmFjY2Vzc190b2tlbiIsIG51bGwsIHt0b29sOiB0fSkgJiYgZXJyb3IucmVzcG9uc2UgJiYgZXJyb3IucmVzcG9uc2Uuc3RhdHVzID09PSA0MDEgJiYgIW9yaWdpbmFsUmVxdWVzdC5fcmV0cnkgJiYgb3JpZ2luYWxSZXF1ZXN0LmhlYWRlcnMuQXV0aG9yaXphdGlvbi5pbmRleE9mKHRoaXMuX19jb25maWcoIm9hdXRoLmFjY2Vzc190b2tlbiIsIG51bGwsIHt0b29sOiB0fSkpPjApIHsNCiAgICAgICAgICAgICAgICBvcmlnaW5hbFJlcXVlc3QuX3JldHJ5ID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAvLyBhd2FpdCAoZ2V0IHRoZSB0b2tlbiBvciByZWZyZXNoIGl0KQ0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIG9yaWdpbmFsUmVxdWVzdC5oZWFkZXJzLkF1dGhvcml6YXRpb24gPSB0aGlzLl9fY29uZmlnKCJvYXV0aC5hY2Nlc3NfdHlwZSIsICJCZWFyZXIiLCB7dG9vbDogdH0pICsgIiAiICsgdGhpcy5fX2NvbmZpZygib2F1dGguYWNjZXNzX3Rva2VuIiwgbnVsbCwge3Rvb2w6IHR9KTsNCiAgICAgICAgICAgICAgICByZXR1cm4gdC5heGlvcyhvcmlnaW5hbFJlcXVlc3QpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycm9yKTsNCiAgICAgICAgfWNhdGNoKGV4KXsNCiAgICAgICAgICAgIDwlPWVycm9yKCklPmV4KTsNCiAgICAgICAgfQ0KICAgICAgICA8JT1sb2coKSU+Y29uZmlnKTsNCiAgICAgICAgcmV0dXJuIGNvbmZpZzsNCiAgICA8JSB9JT4NCiAgICB9DQoNCiAgICBhc3luYyA8JT1tTmFtZT0nX3JlcXVlc3RJbnRlcmNlcHRvciclPihjb25maWcsIHQpew0KICAgIDwlIGlmKG1haW5DbGFzcyhfcmVzdFRvb2xzKSE9Yyl7JT4NCiAgICAgICAgcmV0dXJuIGF3YWl0IG5ldyA8JT1zY29wZSU+LjwlPV9jTmFtZShtYWluQ2xhc3MoX3Jlc3RUb29scykpJT4oKS48JT1tTmFtZSU+KGNvbmZpZywgdCk7DQogICAgPCUgfWVsc2V7JT4NCiAgICAgICAgdHJ5ew0KICAgICAgICAgICAgdCA9IHQgfHwgdGhpcy5Ub29sOw0KICAgICAgICAgICAgY29uZmlnID0gY29uZmlnIHx8IHtoZWFkZXJzOiB7fX07DQogICAgICAgICAgICBjb25maWcubWV0YSA9IGNvbmZpZy5tZXRhIHx8IHt9Ow0KICAgICAgICAgICAgY29uZmlnLm1ldGEuY291bnRlciA9IDQ7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGxldCB0b2tlblVyaSA9IHRoaXMuX19jb25maWcoIm9hdXRoLnRva2VuLnVyaSIsIG51bGwsIHt0b29sOiB0fSk7DQogICAgICAgICAgICBsZXQgcmVmcmVzaFVyaSA9IHRoaXMuX19jb25maWcoIm9hdXRoLnJlZnJlc2gudXJpIiwgbnVsbCwge3Rvb2w6IHR9KTsNCiAgICAgICAgICAgIGxldCBhdXRoVXJpID0gdGhpcy5fX2NvbmZpZygib2F1dGguYXV0aG9yaXplLnVyaSIsIG51bGwsIHt0b29sOiB0fSk7DQogICAgICAgICAgICBsZXQgYXV0aFR5cGUgPSB0aGlzLl9fY29uZmlnKCJvYXV0aC5hdXRoX3R5cGUiLCAiQmVhcmVyIiwge3Rvb2w6IHR9KTsNCiAgICAgICAgICAgIGxldCB0b2tlbiA9IHRoaXMuX19jb25maWcoIm9hdXRoLmFjY2Vzc190b2tlbi4iK2NvbmZpZy5tZXRob2QsIHRoaXMuX19jb25maWcoIm9hdXRoLmFjY2Vzc190b2tlbiIsIG51bGwsIHt0b29sOiB0LCBub2RlOiA8JT1uc2NvcGUlPi5fbm9kZX0pLCB7dG9vbDogdCwgbm9kZTogPCU9bnNjb3BlJT4uX25vZGV9KTsNCiAgICAgICAgICAgIGlmKCFjb25maWcuaGVhZGVycy5BdXRob3JpemF0aW9uICYmIFt0b2tlblVyaSwgcmVmcmVzaFVyaSwgYXV0aFVyaV0uaW5kZXhPZihjb25maWcudXJsKTwwKXsNCiAgICAgICAgICAgICAgICBpZighdG9rZW4pew0KICAgICAgICAgICAgICAgICAgICBsZXQgYXV0aENvZGUgPSB0aGlzLl9fY29uZmlnKCdvYXV0aC5hdXRob3JpemUuY29kZScsIG51bGwsIHt0b29sOiB0fSk7DQogICAgICAgICAgICAgICAgICAgIGxldCBhdXRoTWV0aG9kID0gdGhpcy5fX2NvbmZpZygnb2F1dGguYXV0aG9yaXplLm1ldGhvZCcsIG51bGwsIHt0b29sOiB0fSk7DQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBpZighdG9rZW5VcmkgJiYgIWF1dGhDb2RlICYmICFhdXRoTWV0aG9kICYmIHRoaXMuX19jb25maWcoJ3VzZXJuYW1lJykpew0KICAgICAgICAgICAgICAgICAgICAgICAgYXV0aFR5cGUgPSAnQmFzaWMnOw0KICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW4gPSB0aGlzLl9idG9hKHRoaXMuX19jb25maWcoJ3VzZXJuYW1lJykgKyAiOiIgKyB0aGlzLl9fY29uZmlnKCdwYXNzd29yZCcpKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICANCjwlaWYoX2NOYW1lKCdOb2RlJykpeyU+DQogICAgICAgICAgICAgICAgICAgIGlmKDwlPW5zY29wZSU+Ll9ub2RlICYmICFhdXRoQ29kZSAmJiBhdXRoTWV0aG9kPT0iZ2V0Iil7DQogICAgICAgICAgICAgICAgICAgICAgICAvLyBjcmVhdGUgb3IgbG9hZCBhIG5ldyBvYXV0aCBzdGF0ZQ0KICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fX2NvbmZpZygib2F1dGguYXV0aG9yaXplLnN0YXRlIiwgbnVsbCwge3Rvb2w6IHQsIG5vZGU6IDwlPW5zY29wZSU+Ll9ub2RlLCBuZXdWYWx1ZTogdGhpcy5fYnRvYShKU09OLnN0cmluZ2lmeSh7dG9vbDogdC5uYW1lLCBuY29kZTogPCU9bnNjb3BlJT4uX25vZGUuY29kZSgpfSkpfSk7DQogICAgICAgICAgICAgICAgICAgICAgICAvLyBhdXRob3JpemUgYW5kIGdldCB0aGUgYXV0aCBjb2RlDQogICAgICAgICAgICAgICAgICAgICAgICBhdXRoVXJpID0gdGhpcy5fX2NvbmZpZygib2F1dGguYXV0aG9yaXplLnVyaSIsIG51bGwsIHt0b29sOiB0fSk7DQogICAgICAgICAgICAgICAgICAgICAgICA8JT1sb2coKSU+YCR7YXV0aFVyaX1gKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5vcGVuKGF1dGhVcmkpOw0KICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5zZXRJbnRlcnZhbChudWxsLCB0b29sID0+IDwlPW5zY29wZSU+Ll9ub2RlICYmIGNvbmZpZy5tZXRhLmNvdW50ZXItLSAmJiAhKGF1dGhDb2RlID0gdGhpcy5fX2NvbmZpZygnb2F1dGguYXV0aG9yaXplLmNvZGUnLCBudWxsLCB7dG9vbDogdH0pKSwgMC4xLCB0KTsNCiAgICAgICAgICAgICAgICAgICAgICAgIDwlPWxvZygpJT5gRG9uZSBMb29waW5nOiAke2F1dGhDb2RlfWApOw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYoIWF1dGhDb2RlKSBhdXRoTWV0aG9kPXVuZGVmaW5lZDsNCiAgICAgICAgICAgICAgICAgICAgfQ0KPCV9JT4NCg0KICAgICAgICAgICAgICAgICAgICBpZihhdXRoTWV0aG9kKXsNCiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBmbG93ID0gKCFhdXRoQ29kZSAmJiBhdXRoTWV0aG9kPT0ncG9zdCcpPydhdXRob3JpemUnOid0b2tlbic7DQogICAgICAgICAgICAgICAgICAgICAgICAvLyBnZXQgdGhlIHRva2VuDQogICAgICAgICAgICAgICAgICAgICAgICAvLyB0aGUgdG9rZW5VcmkgbWlnaHQgaGF2ZSBhIGRlcGVuZGVuY3kgb24gdGhlIGF1dGhvcml6YXRpb24gY29kZQ0KICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5VcmkgPSB0aGlzLl9fY29uZmlnKGBvYXV0aC4ke2Zsb3d9LnVyaWAsIG51bGwsIHt0b29sOiB0fSk7DQogICAgICAgICAgICAgICAgICAgICAgICBsZXQgdGNvbmZpZyA9IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmw6IHRva2VuVXJpLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZDogdGhpcy5fX2NvbmZpZyhgb2F1dGguJHtmbG93fS5tZXRob2RgLCAncG9zdCcsIHt0b29sOiB0fSksDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVyczogT2JqZWN0LmFzc2lnbih7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJDb250ZW50LVR5cGUiOiB0aGlzLl9fY29uZmlnKGBvYXV0aC4ke2Zsb3d9LmNvbnRlbnRfdHlwZWAsICJ0ZXh0L2pzb24iLCB7dG9vbDogdH0pLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiQXV0aG9yaXphdGlvbiI6ICJCYXNpYyAiK3RoaXMuX2J0b2EodGhpcy5fX2NvbmZpZygib2F1dGgubG9naW4iLCBudWxsLCB7dG9vbDogdH0pICsgIjoiICsgdGhpcy5fX2NvbmZpZygib2F1dGgucGFzc3dvcmQiLCBudWxsLCB7dG9vbDogdH0pKSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCB0aGlzLl9fY29uZmlnKGBvYXV0aC4ke2Zsb3d9LmhlYWRlcnNgLCAie30iLCB7dG9vbDogdH0pKSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiB0aGlzLl9fY29uZmlnKGBvYXV0aC4ke2Zsb3d9LmJvZHlgLCBudWxsLCB7dG9vbDogdH0pLA0KICAgICAgICAgICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGxldCB0cmVzID0gYXdhaXQgdC5heGlvcyh0Y29uZmlnKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIDwlPWxvZygpJT5gVG9rZW4gZmV0Y2hlZCAtICR7Zmxvd31gLCB0Y29uZmlnLCB0cmVzLmRhdGEpOw0KICAgICAgICAgICAgICAgICAgICAgICAgWydhY2Nlc3NfdG9rZW4nLCAndG9rZW5fdHlwZScsICdleHBpcmVzX2luJywgJ3JlZnJlc2hfdG9rZW4nXS5mb3JFYWNoKHRhID0+IHRoaXMuX19jb25maWcoYG9hdXRoLiR7dGF9YCwgbnVsbCwge3Rvb2w6IHQsIG5vZGU6IDwlPW5zY29wZSU+Ll9ub2RlLCBuZXdWYWx1ZTogdHJlcy5kYXRhW3RoaXMuX19jb25maWcoYG9hdXRoLnRva2VuLnJlc3BvbnNlLiR7dGF9YCwgdGEsIHt0b29sOiB0fSldfSkpOw0KICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW4gPSB0aGlzLl9fY29uZmlnKCJvYXV0aC5hY2Nlc3NfdG9rZW4iLCBudWxsLCB7dG9vbDogdCwgbm9kZTogPCU9bnNjb3BlJT4uX25vZGV9KTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICBjb25maWcuaGVhZGVycy5BdXRob3JpemF0aW9uID0gYXV0aFR5cGUgKyAiICIgKyB0b2tlbjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH1jYXRjaChleCl7DQogICAgICAgICAgICA8JT1lcnJvcigpJT5leCk7DQogICAgICAgIH0NCiAgICAgICAgPCU9bG9nKCklPmNvbmZpZyk7DQogICAgICAgIHJldHVybiBjb25maWc7DQogICAgPCUgfSU+DQogICAgfQ0KDQogICAgYXN5bmMgPCU9bU5hbWU9J19yZXN0JyU+KHROYW1lLCBwYXJhbXMsIGRhdGEsIG1ldGhvZCwgb3B0aW9ucyl7DQogICAgICAgIC8qIHROYW1lIG5vIGxvbmdlciByZXF1aXJlZCEhICovDQogICAgICAgIHROYW1lID0gdE5hbWUgfHwgPCU9X25Db2RlKCklPjsNCiAgICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge190aGlzOiB0aGlzfTsNCiAgICAgICAgb3B0aW9ucy50TmFtZSA9IG9wdGlvbnMudE5hbWUgfHwgdE5hbWU7DQogICAgICAgIA0KICAgICAgICBwYXJhbXMgPSBwYXJhbXMgfHwge307DQogICAgICAgIG1ldGhvZCA9IG1ldGhvZCB8fCAoZGF0YT8icG9zdCI6ImdldCIpOw0KICAgICAgICANCiAgICA8JSBpZihtYWluQ2xhc3MoX3Jlc3RUb29scykhPWMpeyU+DQogICAgICAgIHJldHVybiBhd2FpdCBuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUobWFpbkNsYXNzKF9yZXN0VG9vbHMpKSU+KC8qbnVsbCwgdGhpcy5Ub29sKi8pLjwlPW1OYW1lJT4odE5hbWUsIHBhcmFtcywgZGF0YSwgbWV0aG9kLCBvcHRpb25zKTsNCiAgICA8JSB9ZWxzZXslPg0KICAgICAgICB0cnl7DQogICAgICAgICAgICBpZihvcHRpb25zLmZvcm0pew0KICAgICAgICAgICAgICAgIGxldCBmZCA9IG5ldyBGb3JtRGF0YSgpOw0KICAgICAgICAgICAgICAgIE9iamVjdC5rZXlzKGRhdGEpLmZvckVhY2goayA9PiBmZC5hcHBlbmQoaywgZGF0YVtrXSkpOw0KICAgICAgICAgICAgICAgIGRhdGEgPSBmZDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgbGV0IGNvbmZpZyA9IHsNCiAgICAgICAgICAgICAgICB1cmw6IHRoaXMuX19jb25maWcob3B0aW9ucy51cmwgfHwgYHJlc3RhcGkudXJsLiR7bWV0aG9kfWAsIHRoaXMuX19jb25maWcob3B0aW9ucy51cmwgfHwgJ3Jlc3RhcGkudXJsJywgKG9wdGlvbnMucGF0aHx8JycpICsgb3B0aW9ucy5maWxlLCBvcHRpb25zKSwgb3B0aW9ucyksDQogICAgICAgICAgICAgICAgbWV0aG9kOiBtZXRob2QsDQogICAgICAgICAgICAgICAgcGFyYW1zOiBwYXJhbXMsDQogICAgICAgICAgICAgICAgaGVhZGVyczogT2JqZWN0LmFzc2lnbih0aGlzLl9fY29uZmlnKCdyZXN0YXBpLmhlYWRlcnMuJyttZXRob2QsIHRoaXMuX19jb25maWcoJ3Jlc3RhcGkuaGVhZGVycycsIHt9LCBvcHRpb25zKSwgb3B0aW9ucyksIG9wdGlvbnMuaGVhZGVycyB8fCB7fSksDQogICAgICAgICAgICAgICAgZGF0YTogZGF0YSwNCiAgICAgICAgICAgICAgICB2YWxpZGF0ZVN0YXR1czogc3RhdHVzID0+IHN0YXR1czw0MDAsDQogICAgICAgICAgICB9Ow0KICAgICAgICAgICAgDQogICAgICAgICAgICBsZXQgcmV0ID0gW107DQogICAgICAgICAgICA8JT1sb2coKSU+YFtMSVZFOiR7dGhpcy5fX2NvbmZpZygnbGl2ZScsIHRydWUpfV1gLCBjb25maWcsIG9wdGlvbnMpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBpZih0aGlzLl9fY29uZmlnKCdsaXZlJywgdHJ1ZSkpew0KICAgICAgICAgICAgICAgIGlmKHR5cGVvZih0aGlzLlRvb2wuYXhpb3MpIT09J3VuZGVmaW5lZCcgfHwgdHlwZW9mKGF4aW9zKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICAgICAgcmV0ID0gKGF3YWl0ICgodGhpcy5Ub29sLmF4aW9zIHx8IGF4aW9zKSkoY29uZmlnKSkuZGF0YTsNCiAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgcmV0ID0gYXdhaXQgKGF3YWl0IGZldGNoKGNvbmZpZy51cmwsIGNvbmZpZykpLmpzb24oKTsNCiAgICAgICAgICAgICAgICAgICAgPCU9d2FybigpJT4iYXhpb3Mgbm90IGRlZmluZWQhLCB1c2luZyBmZXRjaCIsIHJldCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgPCU9bG9nKCklPiJyZXQiLCBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpKTsNCiAgICAgICAgICAgIHJldHVybiByZXQ7DQogICAgICAgIH1jYXRjaChleCl7DQogICAgICAgICAgICA8JT1lcnJvcigpJT5leCk7DQogICAgICAgIH0NCiAgICA8JSB9JT4NCiAgICB9DQo8JSB9IC8vIG1haW5DbGFzcyhfcmVzdFRvb2xzKSAlPg0KDQo8JSBpZihtYWluQ2xhc3MoX3NxbFRvb2xzKSl7JT4NCiAgICA8JT1tTmFtZT0nX3RvU1FMVGFibGUnJT4ob3B0aW9ucz17fSl7DQogICAgICAgIGxldCByZXQgPSB0aGlzLl9fZXhwb3J0KHtJZDogIjwlPXNjb3BlJT4uPCU9X2NOYW1lKGMsIHRydWUpJT4iLCBkZXBzOiB7fSwgc3FsOiBgYCwgZmllbGRzOiBgYH0sIHsNCiAgICAgICAgICAgIC8vX21hcDogdHJ1ZSwNCiAgICAgICAgICAgIE51bGw6IHRydWUsDQogICAgICAgICAgICBGdWxsOiB0cnVlLA0KICAgICAgICAgICAgX19oZWFkZXI6IG9iaiA9PiBvYmouc3FsID0gYENSRUFURSBUQUJMRSBJRiBOT1QgRVhJU1RTICR7dGhpcy5fUSgpfSR7PCU9X25Db2RlKCklPn0ke3RoaXMuX1EoKX0gKCR7b2JqLmZpZWxkc30vKjwlPW5OYW1lKGMpJT4qLyk7XG5gLA0KICAgICAgICAgICAgZXhwb3J0ZXI6IHYgPT4gdi5vYmogPSAodHlwZW9mKG9wdGlvbnMucmV1c2VkKT09PSd1bmRlZmluZWQnIHx8IG9wdGlvbnMucmV1c2VkPj12LnJldXNlZCk/di5vYmo6e3NxbDogdi5vYmouc3FsICs9IGAvKjwlPW5OYW1lKGMpJT46IHJldXNlZDogJHt2LnJldXNlZH0qL1xuXG5gLCBJZDogdi5vYmouSWR9LA0KICAgICAgICAgICAgSWQ6IChvYmosIGlkQ29kZSwgdikgPT4gb2JqLmZpZWxkcyArPSBgJHt0aGlzLl9RKCl9JHt0aGlzLl9fY29uZmlnKCdpZEZpZWxkJywgJ0lkJyl9JHt0aGlzLl9RKCl9IENIQVIoMjUpIFBSSU1BUlkgS0VZYCwNCiAgICA8JSBjLkVudGl0eUF0dHJpYnV0ZXMuZmlsdGVyKGVhID0+ICFlYS5FbnRpdHlNZXRob2QgJiYgIWVhLkVudGl0eVR5cGUpLmZvckVhY2goZWEgPT4geyU+DQogICAgICAgICAgICA8JT1uTmFtZShlYSklPjogKG9iaiwgZWFDb2RlLCB2KSA9PiBvYmouZmllbGRzICs9IGAsJHt0aGlzLl9RKCl9JHs8JT1fbkNvZGUoZWEpJT59JHt0aGlzLl9RKCl9ICR7dGhpcy5fc3FsVHlwZSgiPCU9X0ZyRU1ELl9hdHRyKGVhKSU+IiwgdGhpcy5fX2NvbmZpZygndHlwZScpKX1gLA0KICAgIDwlIH0pOyAlPg0KICAgIDwlIGMuRW50aXR5QXR0cmlidXRlcy5maWx0ZXIoZWEgPT4gIWVhLkVudGl0eU1ldGhvZCAmJiBlYS5FbnRpdHlUeXBlKS5mb3JFYWNoKGVhID0+IHslPg0KICAgICAgICAgICAgPCU9bk5hbWUoZWEpJT46IChvYmosIGVhQ29kZSwgdikgPT4gew0KICAgICAgICAgICAgICAgIG9iai5kZXBzLjwlPW5OYW1lKGVhLkVudGl0eVR5cGUpJT4gPSAodiB8fCBuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUoZWEuRW50aXR5VHlwZSwgdHJ1ZSklPigpKS48JT1tTmFtZSU+KG9wdGlvbnMpOw0KICAgICAgICAgICAgICAgIG9iai5maWVsZHMgKz0gYCwke3RoaXMuX1EoKX0ke2VhQ29kZX1pZCR7dGhpcy5fUSgpfSAke3RoaXMuX3NxbFR5cGUoIjwlPV9GckVNRC5fYXR0cihlYSklPiIsIHRoaXMuX19jb25maWcoJ3R5cGUnKSl9YDsNCiAgICAgICAgICAgIH0sDQogICAgPCUgfSk7ICU+DQogICAgPCUgYy5UeXBlZEF0dHJpYnV0ZXMuZm9yRWFjaCh0YSA9PiB7IGxldCB0YU5hbWUgPSBuTmFtZSh0YSkgKyAnXycgKyB0YS5FbnRpdHlDbGFzcy5QbHVyYWwucmVwbGFjZSgvIC9nLCAnXycpOyU+DQogICAgICAgICAgICA8JT10YU5hbWUlPjogKG9iaiwgZWFDb2RlLCB2KSA9PiB7DQogICAgICAgICAgICAgICAgb2JqLmRlcHMuPCU9bk5hbWUodGEuRW50aXR5Q2xhc3MpJT4gPSAodiAmJiB2Lmxlbmd0aCk/dlswXTpuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUodGEuRW50aXR5Q2xhc3MsIHRydWUpJT4oKS48JT1tTmFtZSU+KG9wdGlvbnMpOw0KICAgICAgICAgICAgfSwNCiAgICA8JSB9KSU+DQogICAgICAgIH0sICI8JT1tTmFtZSU+Iik7DQogICAgICAgIA0KICAgICAgICA8JT1sb2coKSU+cmV0KTsNCiAgICAgICAgDQogICAgICAgIHJldHVybiBPYmplY3Qua2V5cyhyZXQuZGVwcyB8fCB7fSkuZmlsdGVyKGsgPT4gdHlwZW9mKHJldC5kZXBzW2tdKT09PSdzdHJpbmcnKS5tYXAoayA9PiByZXQuZGVwc1trXSkuam9pbignXG5cbicpICsgcmV0LnNxbDsNCiAgICB9DQogICAgDQogICAgPCU9bU5hbWU9J19mcm9tU1FMVGFibGUnJT4odGFibGUsIGZpZWxkcyl7DQogICAgICAgIC8vIHRhYmxlIGlzIGEganNvbiBhcnJheQ0KPCUgYy5FbnRpdHlBdHRyaWJ1dGVzLmZpbHRlcihlYSA9PiAhZWEuRW50aXR5TWV0aG9kKS5mb3JFYWNoKGVhID0+IHsgJT4NCiAgICAgICAgaWYoKGZpZWxkcyAmJiBmaWVsZHMuaW5kZXhPZigiPCU9bk5hbWUoZWEpJT4iKSkgfHwgIWZpZWxkcyl7DQogICAgICAgICAgICB0aGlzLjwlPW5OYW1lKGVhKSU+KHRhYmxlWyI8JT1uQ29kZShlYSklPiJdKTsNCiAgICAgICAgfQ0KPCUgfSk7ICU+DQogICAgICAgIA0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICB9DQoNCiAgICBhc3luYyA8JT1tTmFtZT0nX3NxbCclPihzcWwsIF90aGlzKXsNCiAgICAgICAgX3RoaXMgPSBfdGhpcyB8fCB0aGlzOw0KICAgIDwlIGlmKG1haW5DbGFzcyhfc3FsVG9vbHMpIT1jKXslPg0KICAgICAgICByZXR1cm4gYXdhaXQgbmV3IDwlPXNjb3BlJT4uPCU9bk5hbWUobWFpbkNsYXNzKF9zcWxUb29scykpJT4oKS48JT1tTmFtZSU+KHNxbCwgX3RoaXMpOw0KICAgIDwlIH1lbHNleyU+DQogICAgICAgIGlmKCF0aGlzLlRvb2wuZGIgfHwgIXNxbCB8fCAhc3FsLnRyaW0oKSl7DQogICAgICAgICAgICBpZighdGhpcy5Ub29sLmRiKSA8JT1sb2coKSU+c3FsLCAiIDw9PVNLSVBQRUQ9PT4iKTsNCiAgICAgICAgICAgIHJldHVybiBbXTsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgaWYoc3FsLmluZGV4T2YoJztcbicpPjApew0KICAgICAgICAgICAgZm9yIGF3YWl0IChjb25zdCBzcWxTIG9mIHNxbC5zcGxpdCgnO1xuJykpew0KICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuPCU9bU5hbWUlPihzcWxTLnRyaW0oKSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIGxldCByZXQgPSBudWxsOw0KDQogICAgICAgIGlmKChzcWwubWF0Y2goL1woL2cpIHx8IFtdKS5sZW5ndGghPShzcWwubWF0Y2goL1wpL2cpIHx8IFtdKS5sZW5ndGgpew0KICAgICAgICAgICAgPCU9bG9nKCklPiJpbmNvcnJlY3Qgc3FsIiwgc3FsKTsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgdHJ5ew0KICAgICAgICAgICAgcmV0ID0gYXdhaXQgbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gew0KICAgICAgICAgICAgICAgIGxldCBfb2sgPSAoX3JldCwgX3NxbCkgPT4gew0KICAgICAgICAgICAgICAgICAgICBpZihfc3FsICYmIF9zcWwuaW5kZXhPZignc2VsZWN0JykpIHRoaXMuVG9vbC5fX2RtbFN0YXRlbWVudHMucHVzaChfc3FsKTsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc29sdmUoX3JldCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgbGV0IGRiID0gdGhpcy5Ub29sLmRiOw0KICAgICAgICAgICAgICAgIGxldCB0eXBlID0gdGhpcy5fX2NvbmZpZygndHlwZScpOw0KICAgIA0KICAgICAgICAgICAgICAgIGxldCBmdW4gPSAiIjsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBRdWVyeSBsaXN0IG9mIHN0YXRlbWVudCBzdGFydGluZyBrZXl3b3JkcyAgICAgICAgDQogICAgICAgICAgICAgICAgbGV0IHFMaXN0ID0gWyJzZWxlY3QiLCAiaW5zZXJ0IiwgInVwZGF0ZSIsICJkZWxldGUiXTsNCiAgICAgICAgICAgICAgICBpZih0aGlzLl9fY29uZmlnKCdkYXRhYmFzZS50cmFuc2FjdGlvbnMnLCB0cnVlKSl7DQogICAgICAgICAgICAgICAgICAgIHFMaXN0ID0gcUxpc3QuY29uY2F0KFsiYmVnaW4iLCAic3RhcnQiLCAiY29tbWl0Il0pOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBsZXQgYlF1ZXJ5ID0gcUxpc3QuaW5kZXhPZihzcWwuc3Vic3RyaW5nKDAsIHNxbC5pbmRleE9mKCcgJykpLnRyaW0oKS50b0xvd2VyQ2FzZSgpKT49MDsNCg0KICAgICAgICAgICAgICAgIGlmKGJRdWVyeSl7DQogICAgICAgICAgICAgICAgICAgIC8vIHF1ZXJ5DQogICAgICAgICAgICAgICAgICAgIGlmKFsnbXlzcWwnLCAncG9zdGdyZXMnXS5pbmRleE9mKHR5cGUpPj0wKSBmdW4gPSAncXVlcnknOw0KICAgICAgICAgICAgICAgICAgICBpZih0eXBlPT0nc3FsaXRlJykgZnVuID0gJ2FsbCc7DQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIC8vIERNTA0KICAgICAgICAgICAgICAgICAgICBpZihbJ215c3FsJywgJ3Bvc3RncmVzJ10uaW5kZXhPZih0eXBlKT49MCkgZnVuID0gJ3F1ZXJ5JzsNCiAgICAgICAgICAgICAgICAgICAgaWYodHlwZT09J3NxbGl0ZScpIGZ1biA9ICdydW4nOw0KDQogICAgICAgICAgICAgICAgICAgIHRoaXMuVG9vbC5kbWxDYWNoZSA9IHRoaXMuVG9vbC5kbWxDYWNoZSB8fCB7fTsNCiAgICAgICAgICAgICAgICAgICAgaWYodGhpcy5Ub29sLmRtbENhY2hlW3RoaXMuaGFzaENvZGUoc3FsKV0pIHJldHVybiBfb2soMCk7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuVG9vbC5kbWxDYWNoZVt0aGlzLmhhc2hDb2RlKHNxbCldID0gc3FsOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZih0eXBlPT0nc3FsaXRlJyAmJiB0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnKSBmdW4gPSAiIjsNCiAgICAgICAgICAgICAgICBpZihmdW4gJiYgIWRiW2Z1bl0pIGZ1biA9ICIiOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIHNxbCA9IHR5cGVvZihzcWxGb3JtYXR0ZXIpIT09J3VuZGVmaW5lZCc/c3FsRm9ybWF0dGVyLmZvcm1hdChzcWwpOnNxbDsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICA8JT1sb2coKSU+YCR7dHlwZX0uJHtmdW59YCwgc3FsKTsNCiAgICAgICAgICAgICAgICBpZig8JT1zY29wZSU+Ll9fc3FsVHJhbnNhY3Rpb24pIDwlPXNjb3BlJT4uX19zcWxUcmFuc2FjdGlvbi5zcWxzLnB1c2goc3FsKTsNCg0KICAgICAgICAgICAgICAgIGlmIChmdW4pIHsNCiAgICAgICAgICAgICAgICAgICAgbGV0IHJldCA9IFtdOw0KICAgICAgICAgICAgICAgICAgICBpZih0eXBlPT0icG9zdGdyZXMiKXsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldCA9IGRiW2Z1bl0oc3FsKS50aGVuKHJvd3MgPT4gX29rKHJvd3MsIHNxbCkpLmNhdGNoKHJldEV4ID0+IHJlamVjdChyZXRFeCkpOw0KICAgICAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldCA9IGRiW2Z1bl0oc3FsLCBbXSwgKGVycm9yLCByb3dzKSA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoZXJyb3Ipew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyb3IpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfb2socm93cywgc3FsKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZT09J3Nub3dmbGFrZScpIHsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5Ub29sLmRiLmV4ZWN1dGUoew0KICAgICAgICAgICAgICAgICAgICAgICAgc3FsVGV4dDogc3FsLA0KICAgICAgICAgICAgICAgICAgICAgICAgY29tcGxldGU6IGZ1bmN0aW9uKGVyciwgc3RtdCwgcm93cykgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKGVycil7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfb2socm93cywgc3FsKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZT09J3NxbGl0ZScpIHsNCiAgICAgICAgICAgICAgICAgICAgLy8gc3FsaXRlIGluIHRoZSBicm93c2VyDQogICAgICAgICAgICAgICAgICAgIHRyeXsNCiAgICAgICAgICAgICAgICAgICAgICAgIGxldCByZXQgPSBudWxsOw0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0ID0gZGIuZXhlYyhzcWwpOw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYoIXJldCB8fCAhcmV0Lmxlbmd0aCkgcmV0dXJuIF9vayhyZXQsIHNxbCk7DQogICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIHJldCA9IHJldFswXS52YWx1ZXMubWFwKHIgPT4gT2JqZWN0LmZyb21FbnRyaWVzKG5ldyBNYXAocmV0WzBdLmNvbHVtbnMubWFwKChjLCBpKSA9PiBbYywgcltpXV0pKSkpOw0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gPCU9bG9nKCklPnJldCk7DQogICAgICAgICAgICAgICAgICAgICAgICBfb2socmV0LCBzcWwpOw0KICAgICAgICAgICAgICAgICAgICB9Y2F0Y2goZXgpew0KICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGV4KTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0gZWxzZSBpZih0eXBlPT0ncXVlc3RkYicpew0KICAgICAgICAgICAgICAgICAgICB0aGlzLl9yZXN0KG51bGwsIHtxdWVyeTogc3FsfSkudGhlbihyID0+IF9vayhyLCBzcWwpKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfWNhdGNoKGV4KXsNCiAgICAgICAgICAgIDwlPWVycm9yKCklPmANCkVSUk9SOg0KJHtleH0NCg0KV2hpbGUgU2VuZGluZyBRdWVyeSANCiR7c3FsfQ0KYCk7DQogICAgICAgIH0NCg0KICAgICAgICBpZihyZXQgJiYgcmV0LnJvd3MpIHJldCA9IHJldC5yb3dzOyAgICAgICAgDQogICAgICAgIGlmKEFycmF5LmlzQXJyYXkocmV0KSkgcmV0ID0gcmV0Lm1hcChyID0+IERvdE9iamVjdC5vYmplY3QocikpOw0KICAgICAgICByZXR1cm4gcmV0Ow0KICAgIDwlIH0lPg0KICAgIH0NCjwlIH0lPg0KDQo8JSBpZihtYWluQ2xhc3MoWydBaXJUYWJsZSddKSl7JT4NCjwlDQpsZXQgX3RvVHlwZUFUID0gZWEgPT4gew0KICAgIGxldCByZXQgPSB7bmFtZTogbk5hbWUoZWEpLCBkZXNjcmlwdGlvbjogZWEuTmFtZSwgdHlwZTogInNpbmdsZUxpbmVUZXh0In07DQogICAgaWYoZWEuSXNCb29sKXsNCiAgICAgICAgcmV0LnR5cGUgPSAiY2hlY2tib3giOw0KICAgICAgICByZXQub3B0aW9ucyA9IHsNCiAgICAgICAgICAgIGNvbG9yOiAiZ3JlZW5CcmlnaHQiLA0KICAgICAgICAgICAgaWNvbjogImNoZWNrIg0KICAgICAgICB9Ow0KICAgIH0NCiAgICBpZihlYS5Jc0RhdGUpew0KICAgICAgICByZXQudHlwZSA9ICJkYXRlVGltZSI7DQogICAgICAgIHJldC5vcHRpb25zID0gew0KICAgICAgICAgICAgZGF0ZUZvcm1hdDogew0KICAgICAgICAgICAgICAgIG5hbWU6ICdpc28nDQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgdGltZUZvcm1hdDogew0KICAgICAgICAgICAgICAgIG5hbWU6ICcyNGhvdXInLA0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIHRpbWVab25lOiAndXRjJywNCiAgICAgICAgfTsNCiAgICB9DQogICAgDQogICAgcmV0dXJuIHJldDsNCn07DQolPg0KICAgIDwlPW1OYW1lPSdfdG9BVFRhYmxlJyU+KGxldmVsKXsNCiAgICAgICAgbGV0IHJldCA9IFt7DQogICAgICAgICAgICBuYW1lOiAnPCU9bk5hbWUoYyklPicsDQogICAgICAgICAgICBkZXNjcmlwdGlvbjogJycsDQogICAgICAgICAgICBmaWVsZHM6IFsNCiAgICAgICAgICAgICAgICB7bmFtZTogdGhpcy5fX2NvbmZpZygnaWRGaWVsZCcsICdJZCcpLCBkZXNjcmlwdGlvbjogJ0lEJywgdHlwZTogJ3NpbmdsZUxpbmVUZXh0J30sDQogICAgPCUgYy5FbnRpdHlBdHRyaWJ1dGVzLmZpbHRlcihlYSA9PiAhZWEuRW50aXR5TWV0aG9kKS5mb3JFYWNoKGVhID0+IHslPjwlPV9GckVNRC5fdG9KUyhfdG9UeXBlQVQoZWEpKSU+LDwlIH0pJT5dLA0KICAgICAgICB9XTsNCg0KICAgICAgICByZXQgPSB0aGlzLl9fZXhwb3J0KHJldCwgew0KICAgICAgICAgICAgRnVsbDogdHJ1ZSwNCiAgICAgICAgICAgIE51bGw6IHRydWUsDQogICAgPCUgYy5FbnRpdHlBdHRyaWJ1dGVzLmZpbHRlcihlYSA9PiAhZWEuRW50aXR5TWV0aG9kICYmIGVhLkVudGl0eVR5cGUpLmZvckVhY2goZWEgPT4geyAlPg0KICAgICAgICAgICAgIjwlPW5OYW1lKGVhKSU+IjogKG9iaiwgZWFDb2RlLCB2KSA9PiByZXQucHVzaChuZXcgPCU9c2NvcGUlPi48JT1uTmFtZShlYS5FbnRpdHlUeXBlLCB0cnVlKSU+KCkuPCU9bU5hbWUlPigpKSwNCiAgICA8JSB9KTsgJT4NCiAgICA8JSBjLlR5cGVkQXR0cmlidXRlcy5mb3JFYWNoKHRhID0+IHsgbGV0IHRhTmFtZSA9IG5OYW1lKHRhKSArICdfJyArIHRhLkVudGl0eUNsYXNzLlBsdXJhbC5yZXBsYWNlKC8gL2csICdfJyk7JT4NCiAgICAgICAgICAgIDwlPXRhTmFtZSU+OiAob2JqLCBlYUNvZGUsIHYpID0+IHJldC5wdXNoKG5ldyA8JT1zY29wZSU+LjwlPW5OYW1lKHRhLkVudGl0eUNsYXNzLCB0cnVlKSU+KCkuPCU9bU5hbWUlPigpKSwNCiAgICA8JSB9KSU+DQogICAgICAgIH0sICI8JT1tTmFtZSU+Iik7DQoNCiAgICAgICAgPCU9bG9nKCklPnJldC5zcWwpOw0KICAgICAgICByZXR1cm4gcmV0LnNxbDsNCg0KICAgICAgICByZXQgPSByZXQuZmlsdGVyKCh0YWcsIGluZGV4LCBhcnJheSkgPT4gYXJyYXkuZmluZEluZGV4KHQgPT4gdC5uYW1lID09IHRhZy5uYW1lKSA9PSBpbmRleCk7DQogICAgICAgIDwlPWxvZygpJT5yZXQsIGxldmVsKTsNCiAgICAgICAgcmV0dXJuIHJldDsNCiAgICB9DQogICAgDQogICAgPCU9bU5hbWU9J190b0FURnVuY3Rpb24nJT4oKXsNCiAgICAgICAgbGV0IHRQcmVmID0gYCR7dGhpcy5fUSgpfSR7PCU9X25Db2RlKCklPn0ke3RoaXMuX1EoKX0uYDsNCiAgICAgICAgbGV0IHJldCA9IHRoaXMuX19leHBvcnQoe2Z1bjogIiJ9LCB7DQogICAgICAgICAgICBfZmllbGRzOiAodGhpcy5fX3N5bmNfb24oKSB8fCB0aGlzLklkPT10aGlzLklkKT9bJ0lkJ106dW5kZWZpbmVkLA0KICAgICAgICAgICAgX1RISVM6IG9iaiA9PiBvYmouZnVuICs9IGAgYW5kICR7dFByZWZ9JHt0aGlzLl9RKCl9JHt0aGlzLl9fY29uZmlnKCdpZEZpZWxkJywgJ0lkJyl9JHt0aGlzLl9RKCl9IGAgKyAodGhpcy5fVEhJU19jb29wIHx8ICJJTiIpICsgIiAoIiArIHRoaXMuX1RISVMubWFwKHQgPT4gdC48JT1tTmFtZSU+KHQuX19jb25maWcoJ2lkRmllbGQnLCAnSWQnKSkpLmpvaW4oJyBVTklPTiBBTEwgJykgKyAiKSIsDQogICAgICAgICAgICBJZDogb2JqID0+IG9iai5mdW4gKz0gYCBhbmQgJHt0UHJlZn0ke3RoaXMuX1EoKX0ke3RoaXMuX19jb25maWcoJ2lkRmllbGQnLCAnSWQnKX0ke3RoaXMuX1EoKX09JyR7dGhpcy5JZH0nYCwNCiAgICA8JSBjLkVudGl0eUF0dHJpYnV0ZXMuZmlsdGVyKGVhID0+ICFlYS5FbnRpdHlNZXRob2QpLmZvckVhY2goZWEgPT4geyAlPg0KICAgICAgICAgICAgPCU9bk5hbWUoZWEpJT46IChvYmosIGVhQ29kZSwgdikgPT4gew0KICAgICAgICA8JSBpZihlYS5FbnRpdHlUeXBlKXslPg0KICAgICAgICAgICAgICAgIGxldCBjb29wID0gdGhpcy5fPCU9bk5hbWUoZWEpJT5fY29vcDsNCiAgICAgICAgICAgICAgICBzd2l0Y2goY29vcCl7DQogICAgICAgICAgICAgICAgICAgIGNhc2UgIiE9IjoNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvb3AgPSAiTk9UIElOIjsNCiAgICAgICAgICAgICAgICAgICAgY2FzZSAiPSI6DQogICAgICAgICAgICAgICAgICAgICAgICBjb29wID0gIklOIjsNCiAgICAgICAgICAgICAgICAgICAgY2FzZSAiIjoNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvb3AgPSAiSU4iOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICBpZih2KXsNCiAgICAgICAgICAgICAgICAgICAgb2JqLmZ1biArPSBgIGFuZCAke3RQcmVmfSR7dGhpcy5fUSgpfSR7ZWFDb2RlfWlkJHt0aGlzLl9RKCl9ICR7Y29vcH0gKCR7di48JT1tTmFtZSU+KHYuX19jb25maWcoJ2lkRmllbGQnLCAnSWQnKSl9KWA7DQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIG9iai5mdW4gKz0gYCBhbmQgKCR7dFByZWZ9JHt0aGlzLl9RKCl9JHtlYUNvZGV9aWQke3RoaXMuX1EoKX0gJHtjb29wfSAoMCkgT1IgJHt0UHJlZn0ke3RoaXMuX1EoKX0ke2VhQ29kZX1pZCR7dGhpcy5fUSgpfSBJUyBOVUxMKWA7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgPCUgfWVsc2UgaWYoZWEuSXNUZXh0IHx8IGVhLklzSW1hZ2UgfHwgZWEuSXNGaWxlKXslPg0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgPCUgfWVsc2V7JT4NCiAgICAgICAgICAgICAgICBvYmouZnVuICs9IGAgYW5kICR7dFByZWZ9JHt0aGlzLl9RKCl9JHtlYUNvZGV9JHt0aGlzLl9RKCl9IGAgKyA8JWlmKGVhLklzQm9vbCl7JT4iPSI8JX1lbHNleyU+KHRoaXMuXzwlPW5OYW1lKGVhKSU+X2Nvb3AgfHwgIkxJS0UiKTwlfSU+ICsgIiAiOw0KICAgICAgICA8JSB9JT4NCiAgICAgICAgDQogICAgICAgIDwlIGlmKGVhLklzRGF0ZSl7ICU+DQogICAgICAgICAgICAgICAgaWYodiAmJiB2LnRvSVNPU3RyaW5nKXsNCiAgICAgICAgICAgICAgICAgICAgb2JqLmZ1biArPSAiJyIgKyB2LnRvSVNPU3RyaW5nKCkgKyAiJyI7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICA8JSB9ZWxzZSBpZihlYS5Jc1N0cmluZyl7ICU+DQogICAgICAgICAgICAgICAgaWYodHlwZW9mKHYpPT09InN0cmluZyIpew0KICAgICAgICAgICAgICAgICAgICBvYmouZnVuICs9ICInIiArICgodGhpcy5fPCU9bk5hbWUoZWEpJT5fY29vcD09IkxJS0UiIHx8ICF0aGlzLl88JT1uTmFtZShlYSklPl9jb29wKT8iJSI6IiIpICsgdiArICgodGhpcy5fPCU9bk5hbWUoZWEpJT5fY29vcD09IkxJS0UiIHx8ICF0aGlzLl88JT1uTmFtZShlYSklPl9jb29wKT8iJSI6IiIpICsgIiciOw0KICAgICAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICA8JSB9ZWxzZSBpZihlYS5Jc0Jvb2wpeyAlPg0KICAgICAgICAgICAgICAgIGlmKHR5cGVvZih2KT09PSJib29sZWFuIil7DQogICAgICAgICAgICAgICAgICAgIG9iai5mdW4gKz0gIiciICsgKHY/IjEiOiIwIikgKyAiJyI7DQogICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIDwlIH0gJT4NCiAgICAgICAgICAgICAgICBpZih2ICYmIHYuRW50aXR5Q2xhc3Mpew0KICAgICAgICAgICAgICAgICAgICBvYmouZnVuICs9ICIoIiArIHYuPCU9bU5hbWUlPigpICsgIikiOw0KICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICBvYmouZnVuICs9ICInIiArIHYgKyAiJyI7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSwNCiAgICA8JSB9KTsgJT4NCiAgICA8JSBjLlR5cGVkQXR0cmlidXRlcy5mb3JFYWNoKHRhID0+IHsgbGV0IHRhTmFtZSA9IG5OYW1lKHRhKSArICdfJyArIHRhLkVudGl0eUNsYXNzLlBsdXJhbC5yZXBsYWNlKC8gL2csICdfJyk7JT4NCiAgICAgICAgICAgIDwlPXRhTmFtZSU+OiAob2JqLCBlYUNvZGUsIHYpID0+IHsNCiAgICAgICAgICAgICAgICBvYmouc3FsICs9ICIgYW5kIC8qPCU9dGFOYW1lJT4qLyAiOw0KICAgICAgICAgICAgICAgIGlmKHRoaXMuXzwlPXRhTmFtZSU+X2Nvb3A9PSchPScpew0KICAgICAgICAgICAgICAgICAgICBvYmouZnVuICs9ICJOT1QgRVhJU1RTIjsNCiAgICAgICAgICAgICAgICB9ZWxzZSBpZih0aGlzLl88JT10YU5hbWUlPl9jb29wPT0nPScpew0KICAgICAgICAgICAgICAgICAgICBvYmouZnVuICs9ICJFWElTVFMiOw0KICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICBvYmouZnVuICs9IGAke3RQcmVmfSR7dGhpcy5fUSgpfSR7dGhpcy5fX2NvbmZpZygnaWRGaWVsZCcsICdJZCcpfSR7dGhpcy5fUSgpfSAke3RoaXMuXzwlPXRhTmFtZSU+X2Nvb3AgfHwgIklOIn1gOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICBvYmouZnVuICs9ICIgKCIgKyAodiB8fCBbXSkubWFwKHQgPT4gKHQgJiYgdC48JT1tTmFtZSU+KT90LjwlPW1OYW1lJT4oIjwlPW5OYW1lKHRhKSU+LmlkIik6KHQgfHwgJ05VTEwnKSkuam9pbignIFVOSU9OIEFMTC8qTTJNKi8gJykgKyAiKSI7DQogICAgICAgICAgICB9LA0KICAgIDwlIH0pJT4NCiAgICAgICAgfSwgIjwlPW1OYW1lJT4iKTsNCg0KICAgICAgICA8JT1sb2coKSU+cmV0KTsNCiAgICAgICAgcmV0dXJuIHJldDsNCiAgICB9DQoNCiAgICBhc3luYyA8JT1tTmFtZT0nX2FpcnRhYmxlJyU+KHROYW1lLCBwYXJhbXMsIGRhdGEsIG1ldGhvZCl7DQogICAgPCUgaWYobWFpbkNsYXNzKFsnQWlyVGFibGUnXSkhPWMpeyU+DQogICAgICAgIHJldHVybiBhd2FpdCBuZXcgPCU9c2NvcGUlPi48JT1uTmFtZShtYWluQ2xhc3MoWydBaXJUYWJsZSddKSklPigpLjwlPW1OYW1lJT4odE5hbWUsIHBhcmFtcywgZGF0YSwgbWV0aG9kKTsNCiAgICA8JSB9ZWxzZXslPg0KICAgICAgICB0cnl7DQogICAgICAgICAgICB0TmFtZSA9IHROYW1lIHx8IDwlPV9uQ29kZSgpJT47DQogICAgICAgICAgICBsZXQgcmV0ID0gKGF3YWl0IGF4aW9zLnJlcXVlc3Qoew0KICAgICAgICAgICAgICAgIHVybDogYCR7dGhpcy5fX2NvbmZpZygnZW5kcG9pbnRVcmwnKX0ke3ROYW1lfWAsDQogICAgICAgICAgICAgICAgbWV0aG9kOiBtZXRob2Q/bWV0aG9kOihkYXRhPyJwb3N0IjoiZ2V0IiksDQogICAgICAgICAgICAgICAgcGFyYW1zOiB7DQogICAgICAgICAgICAgICAgICAgIGZpbHRlckJ5Rm9ybXVsYTogcGFyYW1zLA0KICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgZGF0YTogZGF0YSwNCiAgICAgICAgICAgICAgICBoZWFkZXJzOiB7DQogICAgICAgICAgICAgICAgICAgICJjb250ZW50LXR5cGUiOiAiYXBwbGljYXRpb24vanNvbiIsDQogICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIH0pKS5kYXRhOw0KICAgICAgICAgICAgPCU9bG9nKCklPnJldCk7DQogICAgICAgICAgICByZXR1cm4gcmV0Ow0KICAgICAgICB9Y2F0Y2goZXgpew0KICAgICAgICAgICAgPCU9ZXJyb3IoKSU+SlNPTi5zdHJpbmdpZnkoZXgucmVzcG9uc2UuZGF0YSwgbnVsbCwgNCkpOw0KICAgICAgICB9DQogICAgPCUgfSU+DQogICAgfQ0KPCUgfSU+DQoNCjwlIGlmKG1haW5DbGFzcyhbJ0ZpbGVTeXN0ZW0nXSkpeyU+DQogICAgYXN5bmMgPCU9bU5hbWU9J19maWxlc3lzdGVtJyU+KGZpbGUsIGNvbnRlbnQsIGlkLCBvYmo9dGhpcyl7DQogICAgPCUgaWYobWFpbkNsYXNzKFsnRmlsZVN5c3RlbSddKSE9Yyl7JT4NCiAgICAgICAgcmV0dXJuIGF3YWl0IG5ldyA8JT1zY29wZSU+LjwlPV9jTmFtZShtYWluQ2xhc3MoWydGaWxlU3lzdGVtJ10pLCB0cnVlKSU+KCkuPCU9bU5hbWUlPihmaWxlLCBjb250ZW50LCBpZCwgb2JqKTsNCiAgICA8JSB9ZWxzZXslPg0KICAgICAgICB0cnl7DQogICAgICAgICAgICBpZighZmlsZSkgcmV0dXJuIG51bGw7DQoNCiAgICAgICAgICAgIGxldCByZXQgPSB7fTsNCiAgICAgICAgICAgIGxldCBwYXRoID0gb2JqLl9fY29uZmlnKGBwYXRoLiR7Y29udGVudD8nd3JpdGUnOidyZWFkJ31gLCAodHlwZW9mKGdsb2JhbCkhPT0ndW5kZWZpbmVkJz8nLi9kYi8nOidodHRwczovL3t7b3duZXJ9fS5naXRodWIuaW8vJykpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBpZihvYmouX19jb25maWcoJ2xpdmUnLCB0cnVlKSl7DQogICAgICAgICAgICAgICAgaWYodHlwZW9mKGNvbnRlbnQpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgICAgICAvLyB3cml0ZQ0KICAgICAgICAgICAgICAgICAgICBpZih0eXBlb2YoZ2xvYmFsKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IGZzLnByb21pc2VzLm1rZGlyKChwYXRoICsgZmlsZSkucmVwbGFjZSgvKC4qXC8pLiovZywgJyQxJyksIHsgcmVjdXJzaXZlOiB0cnVlIH0pOw0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0ID0gZ2xvYmFsLmZzLndyaXRlRmlsZVN5bmMocGF0aCArIGZpbGUsIHR5cGVvZihjb250ZW50KT09PSdvYmplY3QnPy8qdGhpcy5fYnRvYSgqL0pTT04uc3RyaW5naWZ5KGNvbnRlbnQsIG51bGwsICdcdCcpLyopKi86Y29udGVudCk7DQogICAgICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICAgICAgPCU9d2FybigpJT4iQ2Fubm90IHdyaXRlIHRvIGZpbGUgc3lzdGVtIik7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9ZWxzZSBpZihmYWxzZSAmJiBmaWxlLmVuZHNXaXRoKCcvJykpew0KICAgICAgICAgICAgICAgICAgICA8JT13YXJuKCklPiJzaW11bGF0ZWQgZGlyZWN0b3J5IGxpc3RpbmcuLi4uIiwgZmlsZSk7DQogICAgICAgICAgICAgICAgICAgIHJldCA9IFsiRU1TIFdlYiJdOw0KICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICAvLyByZWFkDQogICAgICAgICAgICAgICAgICAgIGlmKHBhdGguc3RhcnRzV2l0aCgnaHR0cCcpICYmIHBhdGguaW5kZXhPZignOi8vJyk+MCl7DQogICAgICAgICAgICAgICAgICAgICAgICByZXQgPSBhd2FpdCB0aGlzLl9yZXN0KHVuZGVmaW5lZCwgbnVsbCwgbnVsbCwgbnVsbCwge3VybDogJ3BhdGgucmVhZCcsIGZpbGUsIHBhdGh9KTsNCiAgICAgICAgICAgICAgICAgICAgfWVsc2UgaWYodHlwZW9mKGdsb2JhbCkhPT0ndW5kZWZpbmVkJyAmJiBnbG9iYWwuZnMuZXhpc3RzU3luYyhwYXRoICsgZmlsZSkpew0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0ID0gZ2xvYmFsLmZzLnJlYWRGaWxlU3luYyhwYXRoICsgZmlsZSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIHJldCA9IHJldD8ocmV0LmRhdGEgfHwgcmV0KTpyZXQ7DQogICAgICAgICAgICA8JT1sb2coKSU+YFske29iai5fX2NvbmZpZygnbGl2ZScsIHRydWUpPycnOidOT1QgJ31MSVZFfCR7dHlwZW9mKGNvbnRlbnQpIT09J3VuZGVmaW5lZCc/J3dyaXRlJzoncmVhZCd9XSR7cGF0aCArIGZpbGV9OiAkeyhyZXQgfHwgJycpLmxlbmd0aH1gKTsNCiAgICAgICAgICAgIHJldHVybiByZXQ7DQogICAgICAgIH1jYXRjaChleCl7DQogICAgICAgICAgICA8JT1lcnJvcigpJT5leCk7DQogICAgICAgIH0NCiAgICA8JSB9JT4NCiAgICB9DQo8JSB9JT4NCg0KPCUgaWYobWFpbkNsYXNzKF9maWxlVG9vbHMpKXslPg0KICAgIDwlPW1OYW1lPSdfZmlsZU5hbWUnJT4oX2NsYXNzPTwlPV9uQ29kZSgpJT4sIG9iaj10aGlzLCBhbGlhcz0iPCU9YWxpYXMoKSU+Iil7DQogICAgPCUgaWYobWFpbkNsYXNzKF9maWxlVG9vbHMpIT1jKXslPg0KICAgICAgICByZXR1cm4gbmV3IDwlPXNjb3BlJT4uPCU9bk5hbWUobWFpbkNsYXNzKF9maWxlVG9vbHMpLCB0cnVlKSU+KCkuPCU9bU5hbWUlPihfY2xhc3MsIG9iaiwgYWxpYXM9IjwlPWFsaWFzKCklPiIpOw0KICAgIDwlIH1lbHNleyU+DQogICAgICAgIHRyeXsNCiAgICAgICAgICAgIGxldCBvSGFzaCA9IG9iai5fdG9IYXNoKG51bGwsIHtub0NvZGU6IHRydWUsIG9ubHlVbmlxdWU6IHRydWV9LCAnPCU9bU5hbWUlPicpOw0KICAgICAgICAgICAgbGV0IGhLZXlzID0gT2JqZWN0LmtleXMob0hhc2guX3RoaXMpLmZpbHRlcihrID0+IGshPT0nT1BFUkFUT1JTJyAmJiB0eXBlb2Yob0hhc2guX3RoaXNba10pIT09J3VuZGVmaW5lZCcpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAvL2lmKCFoS2V5cy5ldmVyeShrID0+IG9IYXNoLl90aGlzLk9QRVJBVE9SU1trXT09Jz0nIHx8IHR5cGVvZihvSGFzaC5fdGhpcy5PUEVSQVRPUlNba10pPT09J3VuZGVmaW5lZCcpKSBoS2V5cyA9IFtdOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBsZXQgZk5hbWUgPSBoS2V5cy5tYXAoayA9PiBvSGFzaC5fdGhpc1trXSkuam9pbignX18nKTsNCiAgICAgICAgICAgIGlmKGZOYW1lKSBmTmFtZSs9Jy5qc29uJzsNCiAgICAgICAgICAgIGZOYW1lID0gKG9iai5fX2NvbmZpZygnc3RvcmUucm9vdCcsICc8JT1zY29wZSU+LycpICsgYCR7YWxpYXMuc3BsaXQoJy4nKS5zbGljZSgxKS5qb2luKCcvJyl9LyR7X2NsYXNzfS8ke2ZOYW1lfWApLnJlcGxhY2UoL1wvXC8vZywgJy8nKTsNCg0KICAgICAgICAgICAgPCU9bG9nKCklPm9IYXNoLl90aGlzLCBoS2V5cywgZk5hbWUpOw0KICAgICAgICAgICAgcmV0dXJuIGZOYW1lOw0KICAgICAgICB9Y2F0Y2goZXgpew0KICAgICAgICAgICAgPCU9ZXJyb3IoKSU+ZXgpOw0KICAgICAgICB9DQogICAgPCUgfSU+DQogICAgfQ0KPCUgfSU+DQoNCjwlIGlmKG1haW5DbGFzcyhbJ0dpdEh1YiddKSl7JT4NCiAgICBhc3luYyA8JT1tTmFtZT0nX2dpdGh1YiclPihmaWxlLCBjb250ZW50LCBpZCwgb2JqPXRoaXMpew0KICAgIDwlIGlmKG1haW5DbGFzcyhbJ0dpdEh1YiddKSE9Yyl7JT4NCiAgICAgICAgcmV0dXJuIGF3YWl0IG5ldyA8JT1zY29wZSU+LjwlPW5OYW1lKG1haW5DbGFzcyhbJ0dpdEh1YiddKSklPihudWxsLCB0aGlzLlRvb2wpLjwlPW1OYW1lJT4oZmlsZSwgY29udGVudCwgaWQsIG9iaik7DQogICAgPCUgfWVsc2V7JT4NCiAgICAgICAgdHJ5ew0KICAgICAgICAgICAgaWYoIWZpbGUpIHJldHVybiBudWxsOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBsZXQgc2hhMSA9IGFzeW5jIHN0ciA9PiB0eXBlb2YoY3J5cHRvLnN1YnRsZSkhPT0ndW5kZWZpbmVkJz9BcnJheS5mcm9tKG5ldyBVaW50OEFycmF5KGF3YWl0IGNyeXB0by5zdWJ0bGUuZGlnZXN0KCdTSEEtMScsIG5ldyBUZXh0RW5jb2RlcigpLmVuY29kZSgnYmxvYiAnICsgbmV3IEJsb2IoW3N0cl0pLnNpemUgKyAnXHgwMCcgKyBzdHIpKSkpLm1hcCh2ID0+IHYudG9TdHJpbmcoMTYpLnBhZFN0YXJ0KDIsICcwJykpLmpvaW4oJycpOnN0ci5zdWJzdHJpbmcoMCwgMTApOw0KICAgICAgICAgICAgDQogICAgICAgICAgICA8JT1sb2coKSU+ImZpbGUiLCBmaWxlLCBjb250ZW50PydwdXQnOidnZXQnKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgbGV0IHJldCA9IGF3YWl0IHRoaXMuX3Jlc3QodW5kZWZpbmVkLCBudWxsLCBjb250ZW50P0pTT04uc3RyaW5naWZ5KHsNCiAgICAJCQltZXNzYWdlOiAiZGVwbG95ZWQgYnkgPCU9bU5hbWUlPigpIiwNCiAgICAJCQlzaGE6IGlkIHx8IGNvbnRlbnRbdGhpcy5fX2NvbmZpZygnaWRGaWVsZCcsICdJZCcpXSwNCiAgICAJCQljb250ZW50OiB0aGlzLl9idG9hKHR5cGVvZihjb250ZW50KT09PSdvYmplY3QnP0pTT04uc3RyaW5naWZ5KGNvbnRlbnQsIG51bGwsICdcdCcpOmNvbnRlbnQpLA0KICAgIAkJfSk6bnVsbCwgY29udGVudD8ncHV0JzpudWxsLCB7DQogICAgCQkgICAgZmlsZTogKGZpbGUgKyAoKGNvbnRlbnQgfHwgZmlsZS5lbmRzV2l0aCgnLycpKT8nJzooJz9yYW5kPScrTWF0aC5yYW5kb20oKSkpKSwNCiAgICAJCX0pOw0KICAgIAkJDQogICAgCQlpZighcmV0KSByZXR1cm4gcmV0Ow0KICAgIAkJDQogICAgCQlyZXQgPSBjb250ZW50P3JldC5jb250ZW50OnJldDsNCg0KICAgICAgICAgICAgbGV0IGlkeEZpbGUgPSAnaW5kZXguaHRtJzsNCiAgICAgICAgICAgIC8vIDwlPWxvZygpJT4icmV0IiwgcmV0KTsNCiAgICAJCWlmKEFycmF5LmlzQXJyYXkocmV0KSl7DQogICAgCQkgICAgLy8gaW4gY2FzZSB3ZSBhcmUgbGlzdGluZyB0aGUgY29udGVudHMgb2YgYSBmb2xkZXIgcmVzb3VyY2UNCiAgICAJCSAgICByZXR1cm4gcmV0LmZpbHRlcihyID0+ICh0eXBlb2Yoci50eXBlKT09PSd1bmRlZmluZWQnIHx8IHIudHlwZT09J2ZpbGUnKSAmJiByLm5hbWUhPWlkeEZpbGUpLm1hcChyID0+ICh7W3RoaXMuX19jb25maWcoJ2lkRmllbGQnLCAnSWQnKV06IHIuc2hhIHx8IHJbdGhpcy5fX2NvbmZpZygnaWRGaWVsZCcsICdJZCcpXSwgbmFtZTogci5uYW1lLnJlcGxhY2UoJy5qc29uJywgJycpfSkpOw0KICAgIAkJfQ0KICAgIAkJDQogICAgCQlsZXQgX3RoaXMgPSB7fTsNCiAgICAJCWlmKHJldC5zaGEpew0KICAgIAkJICAgIHRyeXsNCiAgICAgICAgICAgICAgICAgICAgX3RoaXMgPSByZXQuY29udGVudD9KU09OLnBhcnNlKHRoaXMuX2F0b2IocmV0LmNvbnRlbnQpKTp7fTsNCiAgICAgICAgICAgICAgICB9Y2F0Y2goX2V4KXsNCiAgICAgICAgICAgICAgICAgICAgPCU9d2FybigpJT4ibm90IGEgdmFsaWQgSlNPTiBvYmplY3QiLCBmaWxlKTsNCiAgICAgICAgICAgICAgICB9DQogICAgCQkgIA0KICAgIAkJICAgIF90aGlzW29iai5fX2NvbmZpZygnaWRGaWVsZCcsICdJZCcpXSA9IHJldC5zaGE7IC8vPz8NCiAgICAJCX1lbHNlIGlmKHJldFt0aGlzLl9fY29uZmlnKCdpZEZpZWxkJywgJ0lkJyldKXsNCiAgICAJCSAgICAvLzwlPXdhcm4oKSU+J3NoYTEnLCBmaWxlLCBhd2FpdCBzaGExKEpTT04uc3RyaW5naWZ5KHJldCkpKTsNCiAgICAJCSAgICBfdGhpcyA9IHJldDsNCiAgICAJCX0NCiAgICAJCQ0KICAgIAkJPCU9bG9nKCklPmZpbGUsIGNvbnRlbnQ/J3B1dCc6J2dldCcsIF90aGlzKTsNCiAgICAJCQ0KICAgICAgICAgICAgbGV0IGZSb290ID0gZmlsZS5zcGxpdCgnLycpLnNsaWNlKDAsIC0xKS5qb2luKCcvJyk7DQogICAgICAgICAgICBpZihmaWxlLmluZGV4T2YoaWR4RmlsZSk+PTApIHJldHVybiByZXQ7DQogICAgICAgICAgICBpZHhGaWxlID0gZlJvb3QgKyAnLycgKyBpZHhGaWxlOw0KICAgIAkJDQogICAgCQlpZigvKiFvYmouX19zeW5jX29uKCkgJiYgKi9jb250ZW50KXsNCiAgICAJCSAgICAvLyBuZXcgY29udGVudCBzdG9yZWQNCiAgICAJCSAgICBsZXQgaWR4UmV0ID0gYXdhaXQgb2JqLjwlPW1OYW1lJT4oaWR4RmlsZSk7DQogICAgCQkgICAgPCU9bG9nKCklPiJmaWxlIGNvbnRlbnQiLCBmaWxlLCBpZHhGaWxlLCByZXQsIGlkeFJldCk7DQogICAgCQkgICAgYXdhaXQgb2JqLjwlPW1OYW1lJT4oaWR4RmlsZSwgYXdhaXQgb2JqLjwlPW1OYW1lJT4oZlJvb3QpLCBpZHhSZXQ/aWR4UmV0LnNoYTpudWxsKTsNCiAgICAJCX0NCiAgICAJCQ0KICAgICAgICAgICAgcmV0dXJuIF90aGlzOw0KICAgICAgICB9Y2F0Y2goZXgpew0KICAgICAgICAgICAgPCU9ZXJyb3IoKSU+ZXgpOw0KICAgICAgICB9DQogICAgPCUgfSU+DQogICAgfQ0KPCUgfSU+DQoNCjwlIGlmKG1haW5DbGFzcyhbJ1NhbGVzRm9yY2UnXSkpeyU+DQogICAgPCU9bU5hbWU9J190b1NGUXVlcnknJT4oZmllbGRzLCBvYmpzLCBiU3RyaW5nKXsNCiAgICAgICAgbGV0IHJldCA9IHRoaXMuX19leHBvcnQoe1s8JT1fbkNvZGUoKSU+XToge3BhcmFtczoge3doZXJlOiB7YW5kOiBbXSwgb3I6IFtdfX0sIGVkZ2VzOiB7bm9kZToge319fX0sIHsNCiAgICAgICAgICAgIC8vT1BFUkFUT1JTOiB0cnVlLA0KICAgICAgICAgICAgSWQ6IChvYmosIGVhQ29kZSwgdikgPT4gb2JqWzwlPV9uQ29kZSgpJT5dLnBhcmFtcy53aGVyZS5hbmQucHVzaCh7SWQ6IHtlcTogdn19KSwNCiAgICA8JSBjLkVudGl0eUF0dHJpYnV0ZXMuZmlsdGVyKGVhID0+ICFlYS5FbnRpdHlNZXRob2QpLmZvckVhY2goZWEgPT4geyAlPg0KICAgICAgICAgICAgPCU9bk5hbWUoZWEpJT46IChvYmosIGVhQ29kZSwgdikgPT4gew0KICAgICAgICAgICAgICAgIGxldCBvcCA9ICdlcSc7DQogICAgICAgICAgICAgICAgbGV0IGNvbmQgPSB7W2VhQ29kZV06IHtbb3BdOiANCiAgICAgICAgPCUgaWYoZWEuRW50aXR5VHlwZSl7JT4NCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgaW5xOiB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgQXBpTmFtZTogJ0lkJywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBbPCU9X25Db2RlKGVhLkVudGl0eVR5cGUpJT5dOiB2P3YuPCU9bU5hbWUlPigpWzwlPV9uQ29kZShlYS5FbnRpdHlUeXBlKSU+XS5wYXJhbXMud2hlcmUuYW5kOltdLA0KICAgICAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICA8JSB9ZWxzZSBpZihlYS5Jc0RhdGUpeyU+DQogICAgICAgICAgICAgICAgICAgICh2P3YudG9JU09TdHJpbmcoKTpudWxsKQ0KICAgICAgICA8JSB9ZWxzZXslPg0KICAgICAgICAgICAgICAgICAgICB2DQogICAgICAgIDwlIH0lPg0KICAgICAgICAgICAgICAgIH19Ow0KICAgICAgICAgICAgICAgIG9ials8JT1fbkNvZGUoKSU+XS5wYXJhbXMud2hlcmUuYW5kLnB1c2goY29uZCk7DQogICAgICAgICAgICB9LA0KICAgIDwlIH0pOyAlPg0KICAgICAgICB9LCAiPCU9bU5hbWUlPiIpOw0KICAgICAgICANCiAgICAgICAgLy9PYmplY3Qua2V5cyhyZXQpLmZpbHRlcihrID0+ICFTdHJpbmcocmV0W2tdKS5sZW5ndGgpLmZvckVhY2goayA9PiBkZWxldGUgcmV0W2tdKTsNCiAgICAgICAgDQogICAgICAgIGlmKGJTdHJpbmcpew0KICAgICAgICAgICAgcmV0ID0ge3F1ZXJ5OiB7WzwlPV9uQ29kZSgpJT4gKyAnUXVlcnknXToge3VpYXBpOiB7cXVlcnk6IHJldH19fX07DQogICAgICAgICAgICByZXQgPSBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpOw0KICAgICAgICB9DQoNCiAgICAgICAgPCU9bG9nKCklPnJldCk7DQogICAgICAgIHJldHVybiByZXQ7DQogICAgfQ0KPCUgfSU+DQoNCjwlIGlmKG1haW5DbGFzcyhbJ1NlcnZpY2VOb3cnXSkpeyU+DQogICAgPCUNCiAgICBsZXQgX2lkID0gcyA9PiAvKnM/czoqL2B0aGlzLl91dWlkKCR7c3x8dW5kZWZpbmVkfSkucmVwbGFjZSgvLS9nLCAnJylgOw0KICAgIGxldCBfdGlkID0gX2MgPT4gX2lkKCInIitzY29wZSsiLiIrIChfYyB8fCBjKS5OYW1lICsgIiciKTsNCiAgICBsZXQgYXBwID0gKCkgPT4geyU+YXBwbGljYXRpb24obmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKCdBcHBsaWNhdGlvbicsIHRydWUpJT4oKS5jb2RlKHRoaXMuX19jb25maWcoJ3Njb3BlJywgJzwlPXNjb3BlJT4nKSkpPCV9Ow0KICAgIA0KICAgIGxldCBsYWJlbCA9ICh0LCBuLCBjLCBwKSA9PiB7bj1zci5FbmdsaXNoTmFtZShuKTsgJT4uPCU9dCU+X0ZpZWxkX0xhYmVscyhbbmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKCdGaWVsZCBMYWJlbCcsIHRydWUpJT4oPCU9X2lkKCklPikucmVtYXJrKCc8JT1uJT4nKS5uYW1lKCc8JT1uJT4nKS5jb2RlKDwlPWMlPikubGFuZ3VhZ2UoJ2VuJykucGx1cmFsKCc8JT0ocCB8fCAobiArICdzJykpJT4nKS48JWFwcCgpJT5dKTwlfTslPg0KDQogICAgPCU9bU5hbWU9J190b1NOVGFibGUnJT4oKXsNCiAgICAgICAgLy90aGlzLl9kZWZhdWx0cygpOw0KDQogICAgICAgIHRyeXsNCiAgICA8JSBpZihfY05hbWUoJ0FwcGxpY2F0aW9uJykpeyU+DQogICAgICAgICAgICBsZXQgcmV0ID0gdGhpcy5fX2V4cG9ydChuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUoJ1RhYmxlJywgdHJ1ZSklPig8JT1fdGlkKCklPikuY29kZSg8JT1fbkNvZGUoKSU+KS48JWFwcCgpJT4ubmFtZSgnPCU9Yy5OYW1lJT4nKS5yZW1hcmsoYDwlPWMuUmVtYXJrJT5gKS5hY3RpdmUodHJ1ZSkuZW5hYmxlZCh0cnVlKSwgew0KICAgICAgICAgICAgICAgIEZ1bGw6IHRydWUsDQogICAgICAgICAgICAgICAgTnVsbDogdHJ1ZSwNCiAgICAgICAgPCUgYy5FbnRpdHlBdHRyaWJ1dGVzLmZpbHRlcihlYSA9PiAhZWEuRW50aXR5TWV0aG9kKS5mb3JFYWNoKGVhID0+IHsgJT4NCiAgICAgICAgICAgICAgICA8JT1uTmFtZShlYSklPjogKG9iaiwgZWFDb2RlLCB2KSA9PiBvYmoudGFibGVfQ29sdW1ucyhuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUoJ0NvbHVtbicsIHRydWUpJT4oPCU9X2lkKCInIitzY29wZSsiLiIrYy5OYW1lKyInK2VhQ29kZSIpJT4pLmFjdGl2ZSh0cnVlKS5lbmFibGVkKHRydWUpLm5hbWUoIjwlPXNyLkVuZ2xpc2hOYW1lKGVhLk5hbWUpJT4iKS5jb2RlKGVhQ29kZSkudHlwZSgnPCU9X0ZyRU1ELl9hdHRyKGVhKSU+JykucmVmZXJlbmNlKDwlaWYoZWEuRW50aXR5VHlwZSl7JT4odiB8fCBuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUoZWEuRW50aXR5VHlwZSwgdHJ1ZSklPigpKS48JT1tTmFtZSU+KCk8JX1lbHNleyU+bnVsbDwlfSU+KS8qPCVsYWJlbCgnY29sdW1uJywgZWEuTmFtZSwgJ2VhQ29kZScsIGVhLlBsdXJhbCklPiovKSwNCiAgICAgICAgPCUgfSklPg0KICAgICAgICA8JSBjLlR5cGVkQXR0cmlidXRlcy5maWx0ZXIodGEgPT4gIXRhLkVudGl0eU1ldGhvZCkuZm9yRWFjaCh0YSA9PiB7bGV0IHRhTmFtZSA9IG5OYW1lKHRhKSArICdfJyArIHRhLkVudGl0eUNsYXNzLlBsdXJhbC5yZXBsYWNlKC8gL2csICdfJyk7JT4NCiAgICAgICAgICAgICAgICA8JT10YU5hbWUlPjogKG9iaiwgZWFDb2RlLCB2KSA9PiBvYmoucmVmZXJlbmNlX0NvbHVtbnMobmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKCdDb2x1bW4nLCB0cnVlKSU+KCkuYWN0aXZlKGZhbHNlKS5lbmFibGVkKHRydWUpLmNvZGUoZWFDb2RlKS50eXBlKCdMaXN0JykubmFtZSgiPCU9bk5hbWUodGEpJT4gPCU9dGEuRW50aXR5Q2xhc3MuUGx1cmFsJT4iKS5yZWZlcmVuY2UobmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKHRhLkVudGl0eUNsYXNzLCB0cnVlKSU+KCkuPCU9bU5hbWUlPigpKS8qPCVsYWJlbCgnY29sdW1uJywgdGEuTmFtZSsnICcrdGEuRW50aXR5Q2xhc3MuUGx1cmFsLCAnZWFDb2RlJywgdGEuRW50aXR5Q2xhc3MuUGx1cmFsKSU+Ki8pLA0KICAgICAgICA8JSB9KSU+DQogICAgICAgICAgICB9LCAiPCU9bU5hbWUlPiIpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICByZXR1cm4gcmV0Ow0KICAgIDwlIH1lbHNleyU+DQogICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICA8JSB9JT4NCiAgICAgICAgfWNhdGNoKGV4KXsNCiAgICAgICAgICAgIDwlPWVycm9yKCklPmV4KTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICANCiAgICA8JT1tTmFtZT0nX3RvU05GbG93JyU+KGJEcmFmdCwgYkhlYWRlcil7DQogICAgICAgIHRyeXsNCiAgICA8JSBpZihfY05hbWUoJ0FwcGxpY2F0aW9uJykpeyU+DQogICAgICAgIDwlIGxldCBiT3JkZXIgPSAxOyBsZXQgX2ZpZCA9IF9jID0+IF9pZCgiJyIrc2NvcGUrIi4nICsgKGJEcmFmdD8nZCc6J3MnKSArICdsIisgKF9jIHx8IGMpLk5hbWUgKyAiJyIpOw0KICAgICAgICBsZXQgbG9naWMgPSAobiwgdCwgbWFwPVtdKSA9PiB7JT4NCiAgICAgICAgICAgIG5ldyA8JT1zY29wZSU+LjwlPV9jTmFtZSgnRmxvdyBMb2dpYycsIHRydWUpJT4oPCU9X2lkKCklPikub3JkZXIoPCU9Yk9yZGVyKyslPikuY29kZSh0aGlzLl91dWlkKCkpLm5hbWUoJzwlPW4lPicpLnJlbWFyaygnPCU9biU+JykNCiAgICAgICAgICAgICAgICAuYmxvY2sobmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKCdGbG93IEJsb2NrJywgdHJ1ZSklPig8JT1faWQoKSU+KS5jb2RlKDwlPV9pZCgpJT4pLm5hbWUoJzwlPW4lPicpDQogICAgICAgICAgICAgICAgICAgIC5ibG9ja19FbGVtZW50X01hcHBpbmdzKFs8JSBtYXAuZmlsdGVyKG0gPT4gbSkuZm9yRWFjaChtID0+IHslPg0KICAgICAgICAgICAgICAgICAgICAgICAgbmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKCdFbGVtZW50IE1hcHBpbmcnLCB0cnVlKSU+KDwlPV9pZCgpJT4pLm5hbWUoIjwlPW4lPiAtICIgKyA8JT1tLmNkJT4pLmNvZGUoPCU9bS5jZCU+KS52YWx1ZSg8JT1tLnYlPik8JXBDb21wb3VuZChtLnYsIG0udHJuKSU+LA0KICAgICAgICAgICAgICAgICAgICA8JX0pJT5dKQ0KICAgICAgICAgICAgICAgICkuZGVmaW5pdGlvbihuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUoJ0xvZ2ljIERlZmluaXRpb24nLCB0cnVlKSU+KCc8JT10JT4gPCU9biU+JykuY29kZSgnPCU9dCU+JykubmFtZSgnPCU9dCU+JykpLjwlYXBwKCklPg0KICAgICAgICA8JX0NCiAgICAgICAgbGV0IGFjdGlvbiA9IChhQ29kZSwgcGFyYW1zPXt9KSA9PiB7ICU+DQogICAgICAgICAgICBuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUoJ0FjdGlvbiBJbnN0YW5jZScsIHRydWUpJT4oPCU9X2lkKCklPikuY29kZSh0aGlzLl91dWlkKCkpLmFjdGlvbihuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUoJ0FjdGlvbiBUeXBlJywgdHJ1ZSklPig8JT1faWQoKSU+KS5jb2RlKCc8JT1hQ29kZSU+JykpLm9yZGVyKDwlPWJPcmRlcisrJT4pLjwlYXBwKCklPg0KICAgICAgICAgICAgLmFjdGlvbl9WYXJpYWJsZV9WYWx1ZXMoWw0KICAgICAgICAgICAgPCUgT2JqZWN0LmtleXMocGFyYW1zKS5mb3JFYWNoKHAgPT4geyU+DQogICAgICAgICAgICAgICAgbmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKCdWYXJpYWJsZSBWYWx1ZScsIHRydWUpJT4oKS5jb2RlKCc8JT1wJT4nKS52YWx1ZSg8JT1wYXJhbXNbcF0lPikuYWN0aW9uSW5wdXQoDQogICAgICAgICAgICAgICAgICAgIG5ldyA8JT1zY29wZSU+LjwlPV9jTmFtZSgnQWN0aW9uIElucHV0JywgdHJ1ZSklPigpLmNvZGUoJzwlPXAlPicpDQogICAgICAgICAgICAgICAgKS5tYXBwaW5nKG5ldyA8JT1zY29wZSU+LjwlPV9jTmFtZSgnRWxlbWVudCBNYXBwaW5nJywgdHJ1ZSklPigpLmNvZGUoJzwlPXAlPicpLnZhbHVlKCIiKSksDQogICAgICAgICAgICA8JSB9KSU+DQogICAgICAgICAgICBdKQ0KICAgICAgICA8JX0NCiAgICAgICAgbGV0IHN1YmZsb3cgPSAoZmxvdywgcGFyYW1zPXt9LCBiTm9XYWl0KSA9PiB7ICU+DQogICAgICAgICAgICBuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUoJ0Zsb3cgSW5zdGFuY2UnLCB0cnVlKSU+KDwlPV9pZCgpJT4pLmNvZGUodGhpcy5fdXVpZCgpKS5zdWJmbG93KDwlPWZsb3clPikub3JkZXIoPCU9Yk9yZGVyKyslPikuPCVhcHAoKSU+DQogICAgICAgICAgICA8JSBpZighYk5vV2FpdCl7JT4NCiAgICAgICAgICAgIC5pbnN0YW5jZV9GbG93X0luc3RhbmNlX0lucHV0cyhbbmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKCdGbG93IEluc3RhbmNlIElucHV0JywgdHJ1ZSklPig8JT1faWQoKSU+KS5jb2RlKCd3YWl0X2Zvcl9jb21wbGV0aW9uJykubmFtZSgnV2FpdCBmb3IgQ29tcGxldGlvbicpLnR5cGUoJ0Jvb2wnKV0pDQogICAgICAgICAgICAuaW5zdGFuY2VfVmFyaWFibGVfVmFsdWVzKFsNCiAgICAgICAgICAgICAgICAgICAgbmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKCdWYXJpYWJsZSBWYWx1ZScsIHRydWUpJT4oKS5jb2RlKCd3YWl0X2Zvcl9jb21wbGV0aW9uJykudmFsdWUoJzEnKQ0KICAgICAgICAgICAgICAgICAgICAubWFwcGluZyhuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUoJ0VsZW1lbnQgTWFwcGluZycsIHRydWUpJT4oKS5jb2RlKCd3YWl0X2Zvcl9jb21wbGV0aW9uJykpDQogICAgICAgICAgICBdKQ0KICAgICAgICAgICAgPCV9JT4NCiAgICAgICAgICAgIC5pbnN0YW5jZV9WYXJpYWJsZV9WYWx1ZXMoWw0KICAgICAgICAgICAgPCUgT2JqZWN0LmtleXMocGFyYW1zKS5mb3JFYWNoKHAgPT4geyU+DQogICAgICAgICAgICAgICAgbmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKCdWYXJpYWJsZSBWYWx1ZScsIHRydWUpJT4oKS5jb2RlKCc8JT1wJT4nKS52YWx1ZSg8JT1wYXJhbXNbcF0lPikuZmxvd0lucHV0KA0KICAgICAgICAgICAgICAgICAgICBuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUoJ0Zsb3cgSW5wdXQnLCB0cnVlKSU+KCkuY29kZSgnPCU9cCU+JykNCiAgICAgICAgICAgICAgICApLm1hcHBpbmcobmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKCdFbGVtZW50IE1hcHBpbmcnLCB0cnVlKSU+KCkuY29kZSgnPCU9cCU+JykudmFsdWUoPCU9cGFyYW1zW3BdJT4pKQ0KICAgICAgICAgICAgPCUgfSklPg0KICAgICAgICAgICAgXSkNCiAgICAgICAgPCV9DQogICAgICAgIGxldCBwQ29tcG91bmQgPSAodiwgdHJuKSA9PiB7aWYoIXRybikgcmV0dXJuOyAlPi5lbGVtZW50TWFwcGluZ19QaWxsX0NvbXBvdW5kcyhbbmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKCdQaWxsIENvbXBvdW5kJywgdHJ1ZSklPih0aGlzLl91dWlkKCkpLmNvZGUoJycpLm5hbWUoPCU9diU+KS5vcmRlcigwKS8qLnJlbWFyayh0aGlzLl9idG9hKGA8JT1KU09OLnN0cmluZ2lmeShbXSklPmApKSovLjwlYXBwKCklPg0KICAgICAgICAgICAgLnBhcmVudF9QaWxsX0NvbXBvdW5kcyhbDQogICAgICAgICAgICA8JSBPYmplY3Qua2V5cyh0cm4pLmZvckVhY2goKHQsIGkpID0+IHslPiBuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUoJ1BpbGwgQ29tcG91bmQnLCB0cnVlKSU+KHRoaXMuX3V1aWQoKSkuY29kZSgiPCU9dCU+Iikub3JkZXIoPCU9aSsxJT4pLm5hbWUoPCU9diU+KS5yZW1hcmsodGhpcy5fYnRvYShgPCU9SlNPTi5zdHJpbmdpZnkodHJuW3RdKSU+YCkpLjwlYXBwKCklPi8qLnRyYW5zZm9ybShuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUoJ1RyYW5zZm9ybScsIHRydWUpJT4oPCU9X2lkKCklPikuY29kZSgnPCU9dCU+JykudHJhbnNmb3JtX1RyYW5zZm9ybV9Db21wb3NpdGlvbnMoW25ldyA8JT1zY29wZSU+LjwlPV9jTmFtZSgnVHJhbnNmb3JtIENvbXBvc2l0aW9uJywgdHJ1ZSklPigpLmNvZGUoJycpXSkpKi8sDQogICAgICAgICAgICA8JSB9KSU+DQogICAgICAgICAgICBdKV0pDQogICAgICAgIDwlIH0lPg0KICAgICAgICAgICAgDQogICAgICAgICAgICANCiAgICAgICAgICAgIC8qDQogICAgICAgICAgICAgKiBPT0IgRW5kcG9pbnQ6IGh0dHBzOi8vZGV2MTYyNTcwLnNlcnZpY2Utbm93LmNvbS9hcGkvbm93L3Byb2Nlc3NmbG93L2Zsb3dvYmplY3Qvc3RhcnQvc3ViZmxvdw0KICAgICAgICAgICAgICogUGF5bG9hZDogeyJuYW1lIjoieF83ODYxMV9zY2hvb2xfbWFuLlVzZXJfbG9va3VwIiwiaW5wdXRzIjp7Impzb24iOnsibmFtZSI6InRlc3QiLCJnZW5kZXIiOnsiY29kZSI6Ik0iLCAiT1BFUkFUT1JTIjogeyJjb2RlIjogIiE9In19LCJ1c2VyX1N0dWRlbnRzIjpbeyJuYW1lIjoiU1RBIiwiZ2VuZGVyIjp7ImNvZGUiOiJNIn19XX19fQ0KICAgICAgICAgICAgKi8NCg0KICAgICAgICAgICAgbGV0IGZsb3cgPSBuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUoJ0Zsb3cnLCB0cnVlKSU+KDwlPV9maWQoKSU+KS5uYW1lKCc8JT1jLk5hbWUlPiBMb29rdXAnKS5jb2RlKDwlPV9uQ29kZSgpJT4gKyAnX2xvb2t1cCcpLjwlYXBwKCklPi5hY3RpdmUodHJ1ZSkuZW5hYmxlZCh0cnVlKTsNCiAgICAgICAgICAgIGlmKGJIZWFkZXIpIHJldHVybiBmbG93Ow0KICAgICAgICAgICAgDQogICAgICAgICAgICByZXR1cm4gdGhpcy5fX2V4cG9ydChmbG93LyouX2RlZmF1bHRzKCkqLw0KICAgICAgICAgICAgICAgIC5mbG93X0Zsb3dfU2V0dGluZ3MoW25ldyA8JT1zY29wZSU+LjwlPV9jTmFtZSgnRmxvdyBTZXR0aW5nJywgdHJ1ZSklPig8JT1faWQoKSU+KS5jb2RlKCdBQ1RJT04nKV0pDQogICAgICAgICAgICAgICAgLmZsb3dfRmxvd19JbnB1dHMoWw0KICAgICAgICAgICAgICAgICAgICBuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUoJ0Zsb3cgSW5wdXQnLCB0cnVlKSU+KDwlPV9pZCgpJT4pLmFjdGl2ZSh0cnVlKS5jb2RlKCdqc29uJykubmFtZSgnSlNPTicpLnR5cGUoJ0pTT04nKTwlbGFiZWwoJ2lucHV0JywgJ0pTT04nLCAiJ2pzb24nIiklPg0KICAgICAgICAgICAgICAgIF0pLmZsb3dfRmxvd19PdXRwdXRzKFsNCiAgICAgICAgICAgICAgICAgICAgbmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKCdGbG93IE91dHB1dCcsIHRydWUpJT4oPCU9X2lkKCklPikuYWN0aXZlKHRydWUpLmNvZGUoPCU9X25Db2RlKCklPiArICdfbGlzdCcpLm5hbWUoJzwlPW5OYW1lKGMpJT4gTGlzdCcpLnR5cGUoJ0xpc3QnKS5yZWZlcmVuY2UobmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKCdUYWJsZScsIHRydWUpJT4oIjwlPW5OYW1lKGMpJT4iKS5uYW1lKCc8JT1jLk5hbWUlPicpLmNvZGUoPCU9X25Db2RlKCklPikuPCVhcHAoKSU+KQ0KICAgICAgICAgICAgICAgICAgICA8JWxhYmVsKCdvdXRwdXQnLCBjLk5hbWUgKyAnIExpc3QnLCBfbkNvZGUoKSArICIrICdfbGlzdCciKSU+DQogICAgICAgICAgICAgICAgXSkuZmxvd19GbG93X1ZhcmlhYmxlcyhbDQogICAgICAgICAgICAgICAgICAgIG5ldyA8JT1zY29wZSU+LjwlPV9jTmFtZSgnRmxvdyBWYXJpYWJsZScsIHRydWUpJT4oPCU9X2lkKCklPikuYWN0aXZlKHRydWUpLmNvZGUoJ2pzb24nKS5uYW1lKCdKU09OJykudHlwZSgnSlNPTicpPCVsYWJlbCgndmFyaWFibGUnLCAnSlNPTicsICcianNvbiInKSU+LA0KICAgICAgICAgICAgICAgICAgICBuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUoJ0Zsb3cgVmFyaWFibGUnLCB0cnVlKSU+KDwlPV9pZCgpJT4pLmFjdGl2ZSh0cnVlKS5jb2RlKCdlcXVlcnknKS5uYW1lKCdFUXVlcnknKS50eXBlKCdTdHJpbmcnKTwlbGFiZWwoJ3ZhcmlhYmxlJywgJ0VRdWVyeScsICciZXF1ZXJ5IicpJT4sDQogICAgICAgICAgICAgICAgXSkuZmxvd19GbG93X0xvZ2ljcyhbDQogICAgICAgICAgICAgICAgICAgIDwlbG9naWMoJ1NldCAnICsgYy5OYW1lICsgJyBKU09OJywgJ1NldCBGbG93IFZhcmlhYmxlcycsIFt7Y2Q6ICInanNvbiciLCB2OiAiJ3t7c3ViZmxvdy5qc29ufX0nIn1dKSU+LA0KICAgICAgICAgICAgICAgICAgICA8JSAvLyAsIHRybjoge3JlcGxhY2Vfc3RyaW5nOiB7cmVnZXg6ICIvL2ciLCByZXBsYWNlX3N0cmluZzogIiJ9fSU+DQogICAgICAgICAgICAgICAgXSkuc2VjdXJpdHlDb250cm9sKG5ldyA8JT1zY29wZSU+LjwlPV9jTmFtZSgnU2VjdXJpdHkgQ29udHJvbCcsIHRydWUpJT4oPCU9X2lkKCklPikuY29kZSgnc3lzX2h1Yl9mbG93JykubmFtZShgc3lzX3Njb3BlLnNjb3BlPSR7dGhpcy5fX2NvbmZpZygnc2NvcGUnLCAnPCU9c2NvcGUlPicpfWApLnR5cGUobmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKCdTZWN1cml0eSBUeXBlJywgdHJ1ZSklPigpLmNvZGUoJ2NsaWVudF9jYWxsYWJsZV9mbG93X29iamVjdCcpKS5vcGVyYXRpb24obmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKCdTZWN1cml0eSBPcGVyYXRpb24nLCB0cnVlKSU+KCkuY29kZSgnZXhlY3V0ZScpKS48JWFwcCgpJT4pLCB7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgLy9leHBvcnRlcjogdiA9PiB2Lm9iaiA9IHYucmV1c2VkP25ldyA8JT1zY29wZSU+LjwlPV9jTmFtZSgnRmxvdycsIHRydWUpJT4odi5vYmouSWQpOnYub2JqLCAvKmluZm9ybWF0aW9uIGxvc3MqLw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIE51bGw6ICFiSGVhZGVyLA0KICAgICAgICAgICAgICAgIEZ1bGw6IHRydWUsDQogICAgICAgICAgICAgICAgDQogICAgICAgIDwlIGMuRW50aXR5QXR0cmlidXRlcy5maWx0ZXIoZWEgPT4gIWVhLkVudGl0eU1ldGhvZCkuZm9yRWFjaChlYSA9PiB7ICU+DQogICAgICAgICAgICAgICAgPCU9bk5hbWUoZWEpJT46IChvYmosIGVhQ29kZSwgdikgPT4gb2JqPCVpZigwIHx8IChbJ25hbWUnLCAncmVtYXJrJywgJ2RhdGUnLCAnb3JkZXInLCAnYWN0aXZlJywgJ2VuYWJsZWQnXS5pbmRleE9mKGVhLk5hbWUpPDApKXslPi5mbG93X0Zsb3dfVmFyaWFibGVzKFsNCiAgICAgICAgICAgICAgICAgICAgbmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKCdGbG93IFZhcmlhYmxlJywgdHJ1ZSklPig8JT1faWQoKSU+KS5jb2RlKGVhQ29kZSkubmFtZSgnPCU9c3IuRW5nbGlzaE5hbWUoZWEuTmFtZSklPicpLnR5cGUoPCUgaWYoZWEuRW50aXR5VHlwZSl7JT4nSlNPTic8JSB9ZWxzZXslPic8JT1fRnJFTUQuX2F0dHIoZWEpJT4nPCV9JT4pPCVsYWJlbCgndmFyaWFibGUnLCBlYS5OYW1lLCAiZWFDb2RlIiklPiwNCiAgICAgICAgICAgICAgICAgICAgbmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKCdGbG93IFZhcmlhYmxlJywgdHJ1ZSklPig8JT1faWQoKSU+KS5uYW1lKCc8JT1uTmFtZShjKSU+LjwlPWVhLk5hbWUlPi5TZXQnKS5jb2RlKGVhQ29kZSArICdfc2V0JykubmFtZSgnPCU9c3IuRW5nbGlzaE5hbWUoZWEuTmFtZSklPiBTZXQnKS50eXBlKCdCb29sJyk8JWxhYmVsKCd2YXJpYWJsZScsIGVhLk5hbWUgKyAnIFNldCcsICJlYUNvZGUgKyAnX3NldCciKSU+LA0KICAgICAgICAgICAgICAgICAgICBuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUoJ0Zsb3cgVmFyaWFibGUnLCB0cnVlKSU+KDwlPV9pZCgpJT4pLmNvZGUoZWFDb2RlICsgJ19vcCcpLm5hbWUoJzwlPXNyLkVuZ2xpc2hOYW1lKGVhLk5hbWUpJT4gT3BlcmF0b3InKS50eXBlKCdTdHJpbmcnKTwlbGFiZWwoJ3ZhcmlhYmxlJywgZWEuTmFtZSArICcgT3BlcmF0b3InLCAiZWFDb2RlICsgJ19vcCciKSU+LA0KICAgICAgICAgICAgICAgICAgICBdKS5mbG93X0Zsb3dfTG9naWNzKFsNCiAgICAgICAgICAgICAgICAgICAgPCVsb2dpYygnU2V0ICcrZWEuTmFtZSwgJ1NldCBGbG93IFZhcmlhYmxlcycsIFsNCiAgICAgICAgICAgICAgICAgICAgICAgIGVhLkVudGl0eVR5cGU/bnVsbDp7Y2Q6ICJlYUNvZGUiLCB2OiAiJ3t7Zmxvd192YXJpYWJsZS5qc29ufX0nIiwgdHJuOiBPYmplY3QuYXNzaWduKHt9LCB7dmFsdWVfbWFwOiB7a2V5OiAiJHtlYUNvZGV9IiwgZGVmYXVsdDogIiJ9fSwgZWEuX0lzRGF0ZT97c3RyaW5nX3RvX2RhdGU6IHtkYXRlX2Zvcm1hdDogInl5eXktTU0tZGRcJ1RcJ0hIOm1tOnNzXCdaXCciLCBjdXN0b21fZm9ybWF0OiAiIn19Ont9KX0sDQogICAgICAgICAgICAgICAgICAgICAgICAvL3tjZDogImVhQ29kZSsnX3NldCciLCB2OiAiJ3t7Zmxvd192YXJpYWJsZS4nK2VhQ29kZSsnfX19JyIsIHRybjoge2lzX251bGw6IHt9fX0sDQogICAgICAgICAgICAgICAgICAgICAgICAvL3tjZDogImVhQ29kZSsnX29wJyIsIHY6ICIne3tmbG93X3ZhcmlhYmxlLm9wZXJhdG9yc319JyIsIHRybjoge3ZhbHVlX21hcDoge2tleTogIiR7ZWFDb2RlfSJ9fX0sDQogICAgICAgICAgICAgICAgICAgIF0pJT4ubG9naWNfRmxvd19JbnB1dF9TY3JpcHRzKFsNCiAgICAgICAgICAgICAgICAgICAgICAgIDwlaWYoZWEuRW50aXR5VHlwZSl7JT5uZXcgPCU9c2NvcGUlPi48JT1fY05hbWUoJ0Zsb3cgSW5wdXQgU2NyaXB0JywgdHJ1ZSklPig8JT1faWQoKSU+KS5uYW1lKCdTZXQgPCU9ZWEuTmFtZSU+JykuYWN0aXZlKHRydWUpLmNvZGUoZWFDb2RlKS5yZW1hcmsoYHJldHVybiBmZF9kYXRhLmZsb3dfdmFyLmpzb24uJHtlYUNvZGV9O2ApLDwlfSU+DQogICAgICAgICAgICAgICAgICAgICAgICBuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUoJ0Zsb3cgSW5wdXQgU2NyaXB0JywgdHJ1ZSklPig8JT1faWQoKSU+KS5uYW1lKCdTZXQgPCU9ZWEuTmFtZSU+IFNldCcpLmFjdGl2ZSh0cnVlKS5jb2RlKGVhQ29kZSArICdfc2V0JykucmVtYXJrKGByZXR1cm4gdHlwZW9mKGZkX2RhdGEuZmxvd192YXIuanNvbi4ke2VhQ29kZX0pIVx1MDAzZFx1MDAzZFx1MDAyN3VuZGVmaW5lZFx1MDAyNztgKSwNCiAgICAgICAgICAgICAgICAgICAgICAgIG5ldyA8JT1zY29wZSU+LjwlPV9jTmFtZSgnRmxvdyBJbnB1dCBTY3JpcHQnLCB0cnVlKSU+KDwlPV9pZCgpJT4pLm5hbWUoJ1NldCA8JT1lYS5OYW1lJT4gT3BlcmF0b3InKS5hY3RpdmUodHJ1ZSkuY29kZShlYUNvZGUgKyAnX29wJykucmVtYXJrKGByZXR1cm4gKGZkX2RhdGEuZmxvd192YXIuanNvbi5PUEVSQVRPUlMgfHwge30pLiR7ZWFDb2RlfTtgKSwNCiAgICAgICAgICAgICAgICAgICAgXSksDQoNCiAgICAgICAgICAgICAgICAgICAgPCVsb2dpYygnSWYgJyArIGMuTmFtZSArICcgJytlYS5OYW1lKycgU2V0JywgJ0lmJywgW3tjZDogIidjb25kaXRpb24nIiwgdjogIid7e2Zsb3dfdmFyaWFibGUuJyArIGVhQ29kZSArICdfc2V0fX09dHJ1ZScifV0pJT4NCiAgICAgICAgICAgICAgICAgICAgPCVpZihlYS5FbnRpdHlUeXBlKXslPi5wYXJlbnRfRmxvd19JbnN0YW5jZXMoPCVzdWJmbG93KCduZXcgJytzY29wZSsnLicrX2NOYW1lKGVhLkVudGl0eVR5cGUsIHRydWUpKycoKS4nK21OYW1lKycoZmFsc2UsIHRydWUpJywge2pzb246ICIne3tmbG93X3ZhcmlhYmxlLicrZWFDb2RlKyd9fScifSklPik8JX0lPg0KICAgICAgICAgICAgICAgICAgICAucGFyZW50X0Zsb3dfTG9naWNzKFsNCiAgICAgICAgICAgICAgICAgICAgICAgIDwlbG9naWMoJ0FkZCAnK2VhLk5hbWUrJyB0byAnICsgYy5OYW1lICsgJyBFUXVlcnknLCAnU2V0IEZsb3cgVmFyaWFibGVzJywgW3tjZDogIidlcXVlcnknIiwgdjogIid7e2Zsb3dfdmFyaWFibGUuZXF1ZXJ5fX1eJytlYUNvZGUifV0pJT4sDQogICAgICAgICAgICAgICAgICAgICAgICA8JWxvZ2ljKCdJZiAnICsgYy5OYW1lICsgJyAnK2VhLk5hbWUrJyBPcGVyYXRvciBpcyBub3QgZW1wdHknLCAnSWYnLCBbe2NkOiAiJ2NvbmRpdGlvbiciLCB2OiAiJ3t7Zmxvd192YXJpYWJsZS4nK2VhQ29kZSsnX29wfX0hPScifV0pJT4ucGFyZW50X0Zsb3dfTG9naWNzKFsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8JWxvZ2ljKCdBcHBlbmQgJytlYS5OYW1lKycgT3BlcmF0b3IgdG8gJyArIGMuTmFtZSArICcgRVF1ZXJ5JywgJ1NldCBGbG93IFZhcmlhYmxlcycsIFt7Y2Q6ICInZXF1ZXJ5JyIsIHY6ICIne3tmbG93X3ZhcmlhYmxlLmVxdWVyeX19e3tmbG93X3ZhcmlhYmxlLicrZWFDb2RlKydfb3B9fScifV0pJT4NCiAgICAgICAgICAgICAgICAgICAgICAgIF0pLA0KICAgICAgICAgICAgICAgICAgICAgICAgPCVsb2dpYygnRWxzZSAnICsgYy5OYW1lICsgJyAnK2VhLk5hbWUrJyBub3QgU2V0JywgJ0Vsc2UnKSU+LnBhcmVudF9GbG93X0xvZ2ljcyhbDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPCVsb2dpYygnQXBwZW5kID0gdG8gJyArIGMuTmFtZSArICcgRVF1ZXJ5IGZvciAnK2VhLk5hbWUsICdTZXQgRmxvdyBWYXJpYWJsZXMnLCBbe2NkOiAiJ2VxdWVyeSciLCB2OiAiJ3t7Zmxvd192YXJpYWJsZS5lcXVlcnl9fT0nIn1dKSU+DQogICAgICAgICAgICAgICAgICAgICAgICBdKSwNCiAgICAgICAgICAgICAgICAgICAgICAgIDwlaWYoZWEuRW50aXR5VHlwZSl7JT48JWxvZ2ljKCdGb3IgZWFjaCAnK2MuTmFtZSsnICcrZWEuTmFtZSwgJ0ZvciBFYWNoJywgW3tjZDogIidpdGVtcyciLCB2OiAiJ3t7MDE5NTc5YThhOWY5NzVkMjhlODk5MDU2NDQ2ZjllODIuIitlYS5FbnRpdHlUeXBlLk5hbWUrIl9saXN0fX0nIn1dKSU+LnBhcmVudF9GbG93X0xvZ2ljcyhbPCV9JT4NCiAgICAgICAgICAgICAgICAgICAgICAgIDwlbG9naWMoJ0FwcGVuZCAnK2VhLk5hbWUrJyB0byAnICsgYy5OYW1lICsgJyBFUXVlcnknLCAnU2V0IEZsb3cgVmFyaWFibGVzJywgW3tjZDogIidlcXVlcnknIiwgdjogIid7e2Zsb3dfdmFyaWFibGUuZXF1ZXJ5fX17e2Zsb3dfdmFyaWFibGUuJytlYUNvZGUrJ319JyJ9XSklPiwNCiAgICAgICAgICAgICAgICAgICAgICAgIDwlaWYoZWEuRW50aXR5VHlwZSl7JT5dKTwlfSU+LA0KICAgICAgICAgICAgICAgICAgICBdKSwNCiAgICAgICAgICAgICAgICBdKTwlfSU+DQogICAgICAgICAgICAgICAgLA0KICAgICAgICA8JSB9KSU+DQogICAgICAgIDwlIGMuVHlwZWRBdHRyaWJ1dGVzLmZpbHRlcih0YSA9PiAhdGEuRW50aXR5TWV0aG9kKS5mb3JFYWNoKHRhID0+IHtsZXQgdGFOYW1lID0gbk5hbWUodGEpICsgJ18nICsgdGEuRW50aXR5Q2xhc3MuUGx1cmFsLnJlcGxhY2UoLyAvZywgJ18nKTslPg0KICAgICAgICAgICAgICAgIDwlPXRhTmFtZSU+OiAob2JqLCBlYUNvZGUsIHYpID0+IG9iajwlaWYoMCB8fCBbJ1VzZXInLCAnR2VuZGVyJywgJ19TdHVkZW50JywgJ19UZWFjaGVyJ10uaW5kZXhPZih0YS5FbnRpdHlDbGFzcy5OYW1lKT49MCl7JT4uZmxvd19GbG93X0xvZ2ljcyhbPCVsb2dpYygnSWYgJyt0YU5hbWUrJyBub3QgZW1wdHknLCAnSWYnKSU+LnBhcmVudF9GbG93X0luc3RhbmNlcyg8JXN1YmZsb3coJ25ldyAnK3Njb3BlKycuJytfY05hbWUodGEuRW50aXR5Q2xhc3MsIHRydWUpKycoKS4nK21OYW1lKycoYkRyYWZ0LCB0cnVlKScsIHtqc29uOiAiJ3Rlc3QnIn0pJT4pXSk8JX0lPiwNCiAgICAgICAgPCUgfSklPg0KICAgICAgICAgICAgICAgIF9sb29rdXA6IG9iaiA9PiBvYmouZmxvd19GbG93X0xvZ2ljcyhbPCVsb2dpYygnSWYgRVF1ZXJ5IG5vdCBlbXB0eScsICdJZicsIFt7Y2Q6ICInY29uZGl0aW9uJyIsIHY6ICIne3tmbG93X3ZhcmlhYmxlLmVxdWVyeX19IT0nIn1dKSU+DQogICAgICAgICAgICAgICAgICAgIC5wYXJlbnRfQWN0aW9uX0luc3RhbmNlcyhbDQogICAgICAgICAgICAgICAgICAgICAgICA8JWFjdGlvbignbG9va191cF9yZWNvcmRzJywge3RhYmxlOiAnIjAxOTU3OWE4YTlmOTc1ZDI4ZTg5OTZmM2Y4Yzk0ZjJjXyIrKCcrX25Db2RlKCkrJykudG9Mb3dlckNhc2UoKSd9KSU+LA0KICAgICAgICAgICAgICAgICAgICBdKS5sb2dpY19GbG93X0lucHV0X1NjcmlwdHMoWw0KICAgICAgICAgICAgICAgICAgICAgICAgbmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKCdGbG93IElucHV0IFNjcmlwdCcsIHRydWUpJT4oKS5uYW1lKCdTZXQgQ29uZGl0aW9uJykuYWN0aXZlKHRydWUpLmNvZGUoJ2NvbmRpdGlvbnMnKS5yZW1hcmsoYHJldHVybiBmZF9kYXRhLmZsb3dfdmFyLmVxdWVyeTtgKSwNCiAgICAgICAgICAgICAgICAgICAgXSkNCiAgICAgICAgICAgICAgICBdKSwNCiAgICAgICAgICAgICAgICBfc25hcHNob3Q6IG9iaiA9PiBiRHJhZnQ/bnVsbDpvYmouZmxvd19GbG93X1NuYXBzaG90cyhuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUoJ0Zsb3cgU25hcHNob3QnLCB0cnVlKSU+KDwlPV9maWQoKSU+KS5zbmFwc2hvdF9GbG93X1BsYW5zKFsNCiAgICAgICAgICAgICAgICAgICAgbmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKCdGbG93IFBsYW4nLCB0cnVlKSU+KDwlPV9pZCgpJT4pLmNvZGUoJzwlPWMuTmFtZSU+X1BsYW4nKS5uYW1lKCc8JT1jLk5hbWUlPiBQbGFuJykNCiAgICAgICAgICAgICAgICAgICAgXSkuZnJvbUZsb3codGhpcy48JT1tTmFtZSU+KHRydWUpKSksDQogICAgICAgICAgICB9LCAiPCU9bU5hbWUlPiIsIGJEcmFmdCwgYkhlYWRlcik7DQogICAgPCUgfWVsc2V7JT4NCiAgICAgICAgICAgIHJldHVybiBbXTsNCiAgICA8JSB9JT4NCiAgICAgICAgfWNhdGNoKGV4KXsNCiAgICAgICAgICAgIDwlPWVycm9yKCklPmV4KTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICANCiAgICBhc3luYyA8JT1tTmFtZT0nX3RvU05TY3JpcHQnJT4ob3B0aW9ucz17fSl7DQogICAgICAgIG9wdGlvbnMuX3RoaXMgPSBvcHRpb25zLl90aGlzIHx8IHRoaXM7DQo8JSBpZihtYWluQ2xhc3MoKSE9Yyl7JT4NCiAgICAgICAgcmV0dXJuIGF3YWl0IG5ldyA8JT1zY29wZSU+LjwlPV9jTmFtZShtYWluQ2xhc3MoKSwgdHJ1ZSklPigpLjwlPW1OYW1lJT4ob3B0aW9ucyk7DQo8JSB9ZWxzZXslPg0KICAgICAgICB0cnl7DQogICAgPCUgaWYoX2NOYW1lKCdBcHBsaWNhdGlvbicpKXslPg0KICAgICAgICAgICAgbGV0IGV4cCA9IG9wdGlvbnMucmF3PyJfdG9KU09OIjoiX3RvRG9jdW1lbnQiOw0KICAgICAgICAgICAgbGV0IHJvbGxiYWNrID0gKG9wdGlvbnMuYXBwICYmIG9wdGlvbnMucm9sbGJhY2spP2F3YWl0IG5ldyA8JT1zY29wZSU+LjwlPV9jTmFtZSgnUm9sbGJhY2sgQ29udGV4dCcsIHRydWUpJT4oKS5jb2RlKCdsYXN0JylbZXhwXShPYmplY3QuYXNzaWduKHtiSlNPTjogdHJ1ZX0sIG9wdGlvbnMpKToiIjsNCiAgICAgICAgICAgIGxldCBkYiA9IG9wdGlvbnMuZGI/YXdhaXQgb3B0aW9ucy5fdGhpcy8qLl90b09ialRyZWUodHJ1ZSkqLy5fdG9TTlRhYmxlKClbZXhwXShPYmplY3QuYXNzaWduKHtiSlNPTjogdHJ1ZX0sIG9wdGlvbnMpKToiIjsNCiAgICAgICAgICAgIGxldCBmbG93ID0gb3B0aW9ucy5mbG93P2F3YWl0IG9wdGlvbnMuX3RoaXMvKi5fdG9PYmpUcmVlKHRydWUpKi8uX3RvU05GbG93KG9wdGlvbnMuZHJhZnQpW2V4cF0oT2JqZWN0LmFzc2lnbih7YkpTT046IHRydWV9LCBvcHRpb25zKSk6IiI7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGlmKG9wdGlvbnMuZ3ppcCl7DQogICAgICAgICAgICAgICAgaWYoZmxvdykgZmxvdyA9IHRoaXMuVXRmOEFycmF5VG9TdHIoYXdhaXQgdGhpcy5fY29tcHJlc3MoZmxvdykpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICBsZXQgdGVzdCA9IChvcHRpb25zLnRlc3QgJiYgb3B0aW9ucy5mbG93ICYmICFvcHRpb25zLmRyYWZ0KT9gXG4vKmdzLmNhY2hlRmx1c2goKTsgKi9ncy5pbmZvKHNuX2ZkLkZsb3dBUEkuZ2V0UnVubmVyKCkuc3ViZmxvdygnJHt0aGlzLl9fY29uZmlnKCdzY29wZScsICc8JT1zY29wZSU+Jyl9LlVzZXJfbG9va3VwJykuaW5Gb3JlZ3JvdW5kKCkud2l0aElucHV0cyh7anNvbjoge2NvZGU6InRlc3QiLGRhdGU6JzIwMjQtMDUtMDNUMTg6NDQ6MDMuMTc3WicsZ2VuZGVyOntjb2RlOiJNIiwgT1BFUkFUT1JTOiB7Y29kZTogIiE9In19LHVzZXJfU3R1ZGVudHM6W3tjb2RlOiJTVEEiLGdlbmRlcjp7Y29kZToiTSJ9fV0sIE9QRVJBVE9SUzoge2RhdGU6ICc8J319fSkucnVuKCkuZ2V0T3V0cHV0cygpWyJVc2VyX2xpc3QiXSk7XG5gOicnOw0KICAgICAgICAgICAgbGV0IGFwcCA9IG9wdGlvbnMuYXBwPyhuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUoJ0FwcGxpY2F0aW9uJywgdHJ1ZSklPigpLyouX3RvT2JqVHJlZSh0cnVlKSovLl90b1NOU2F2ZShvcHRpb25zKSArIGBcbiB2YXIgY29uZmlnID0ge0FwcGxpY2F0aW9uOiB7cmVhZE9ubHk6IHRydWV9LCBUYWJsZToge2lkS2V5OiAnbmFtZScsIExvZ1NldDogMH0sIENvbHVtbjoge0xvZ1NldDogMH0sIEVsZW1lbnRfTWFwcGluZzoge0xvZ1NldDogMH0sIEFjdGlvbl9JbnB1dDoge3JlYWRPbmx5OiB0cnVlfSwgQWN0aW9uX1R5cGU6IHtyZWFkT25seTogdHJ1ZSwgaWRLZXk6ICdtYXN0ZXJfc25hcHNob3QnfSwgQWN0aW9uX0luc3RhbmNlOiB7TG9nU2V0OiAwfSwgU2VjdXJpdHlfVHlwZToge3JlYWRPbmx5OiB0cnVlLCBpZEtleTogJ25hbWUnfSwgU2VjdXJpdHlfT3BlcmF0aW9uOiB7cmVhZE9ubHk6IHRydWUsIGlkS2V5OiAnbmFtZSd9LCBMb2dpY19EZWZpbml0aW9uOiB7cmVhZE9ubHk6IHRydWV9LCBGbG93OiB7TG9nU2V0OiAwfSwgVHJhbnNmb3JtOiB7cmVhZE9ubHk6IHRydWV9LCBUcmFuc2Zvcm1fQ29tcG9zaXRpb246IHtyZWFkT25seTogdHJ1ZX0sIFJvbGxiYWNrX0NvbnRleHQ6IHtyZWFkT25seTogdHJ1ZX19OyBcbmAgKyAob3B0aW9ucy5yb2xsYmFjaz8oInZhciBjaWQgPSBzYXZlUm9sbGJhY2tfQ29udGV4dCgiK3JvbGxiYWNrK2ApOyBpZihjaWQpe3ZhciBydyA9IG5ldyBHbGlkZVJvbGxiYWNrV29ya2VyKCk7IHJ3LnNldFJvbGxiYWNrQ29udGV4dElEKGNpZC5zeXNfaWQpOyBydy5zdGFydCgpO30gXG5gKToiIikrIChvcHRpb25zLmRiPygic2F2ZVRhYmxlKCIrZGIrIik7IFxuIik6IiIpICsgKG9wdGlvbnMuZmxvdz8oInNhdmVGbG93KCIrZmxvdysiKTsgXG4iKToiIikgKyB0ZXN0KToocm9sbGJhY2sgKyBkYiArIGZsb3cpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBsZXQgc2NyaXB0ID0gdGhpcy5fYmVhdXRpZnkoYXBwLCAnamF2YXNjcmlwdCcpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBpZighb3B0aW9ucy5kZXBsb3kpIHJldHVybiBzY3JpcHQ7DQogICAgPCUgfSU+DQogICAgICAgIH1jYXRjaChleCl7DQogICAgICAgICAgICA8JT1lcnJvcigpJT5leCk7DQogICAgICAgIH0NCjwlIH0lPg0KICAgIH0NCg0KICAgIDwlPW1OYW1lPSdfdG9TTlNhdmUnJT4ob3B0aW9ucyl7DQogICAgICAgIHRyeXsNCiAgICAgICAgICAgIDwlIHZhciBfZlJlZ0V4cCA9IC9fZntbXn1dK30vZ207ICU+DQogICAgICAgICAgICBsZXQgX2YgPSAodiwgZWFDb2RlKSA9PiB7DQogICAgICAgICAgICAgICAgaWYodHlwZW9mKHYpPT09InN0cmluZyIpew0KICAgICAgICAgICAgICAgICAgICBsZXQgcmV0ID0gdjsNCiAgICAgICAgICAgICAgICAgICAgLy9pZih2LnN0YXJ0c1dpdGgoImYoIikgJiYgdi5lbmRzV2l0aCgiKSIpKSByZXQgPSAnKCcrdi5zbGljZSgyLC0xKSsnKSc7DQogICAgICAgICAgICAgICAgICAgIGlmKHYuc3RhcnRzV2l0aCgicygiKSAmJiB2LmVuZHNXaXRoKCIpIikpew0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0ID0gYChmdW5jdGlvbiAob2JqLCAke2VhQ29kZX0pe2Ardi5zbGljZSgyLC0xKStgfSkob2JqLCAke2VhQ29kZX0pYDsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgaWYocmV0ICYmIHJldC5tYXRjaCAmJiByZXQubWF0Y2goPCU9X2ZSZWdFeHAlPikpIHJldCA9IGAoZnVuY3Rpb24gKG9iaiwgJHtlYUNvZGV9KXske3JldC5pbmRleE9mKCJyZXR1cm4iKTwwPyJyZXR1cm4gIjoiIn0gJ2ArcmV0LnJlcGxhY2UoPCU9X2ZSZWdFeHAlPiwgbSA9PiBgJyArICR7bS5zbGljZSgzLCAtMSl9ICsgJ2ApK2AnO30pKG9iaiwgJHtlYUNvZGV9KWA7DQogICAgICAgICAgICAgICAgICAgIGlmKHJldCAmJiByZXQubWF0Y2ggJiYgcmV0Lm1hdGNoKC8wMTk1NzlhOGE5Zjk3NWQyOGU4OTk5MjgxMDlhMTUzMl0rPj4vZ20pKSByZXQgPSAnIiInOw0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gYChmdW5jdGlvbih2KXsgdHJ5eyByZXR1cm4gKHYgJiYgdi5yZXBsYWNlKT92LnJlcGxhY2UoPCU9X2ZSZWdFeHAlPiwgZnVuY3Rpb24obSl7cmV0dXJuIGV2YWwobS5zbGljZSgzLCAtMSkpO30pOnY7ICB9Y2F0Y2goZXgpe2dzLmluZm8oJ19me0V4Y2VwdGlvbn06ICR7ZWFDb2RlfTogJyArIGV4KTsgcmV0dXJuIHY7fSB9KSgke3JldH0gfHwgJHtlYUNvZGV9KWA7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHJldHVybiBlYUNvZGU7DQogICAgICAgICAgICB9Ow0KDQogICAgICAgICAgICBsZXQgcmV0ID0gdGhpcy5fX2V4cG9ydCh7SWQ6ICI8JT1zY29wZSU+LjwlPV9jTmFtZShjLCB0cnVlKSU+IiwgdmFyczogYGAsIGNvZGU6IGBgLCBxdWVyeTogYGAsIHNldDogYGAsIGVzZXQ6IGBgLCBkc2V0OiBgYCwgdGFzOiBgYCwgZGVwczoge319LCB7DQogICAgICAgICAgICAgICAgZXhwb3J0ZXI6IHYgPT4gdi5vYmogPSAodHlwZW9mKG9wdGlvbnMucmV1c2VkKT09PSd1bmRlZmluZWQnIHx8IG9wdGlvbnMucmV1c2VkPj12LnJldXNlZCk/di5vYmo6e2NvZGU6IHYub2JqLmNvZGUgKyBgXG5cbi8qKiByZXVzZWQ6IHYub2JqLklkKiovXG5cbmAsIGRlcHM6ICcnLCBJZDogdi5vYmouSWR9LA0KDQogICAgICAgICAgICAgICAgRnVsbDogdHJ1ZSwNCiAgICAgICAgICAgICAgICBOdWxsOiB0cnVlLA0KICAgICAgICAgICAgICAgIElkOiAob2JqLCBpZENvZGUsIHYpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgb2JqLklkID0gYGlmKG9iai4ke2lkQ29kZX0gJiYgb2JqLiR7aWRDb2RlfS5yZXBsYWNlKC8tL2csICcnKS5sZW5ndGg9PTMyKXtfdG9TdHJpbmcrPSdfJytvYmouJHtpZENvZGV9LnJlcGxhY2UoLy0vZywgJycpOyBnci5nZXQoJ3N5c19pZCcsIG9iai4ke2lkQ29kZX0ucmVwbGFjZSgvLS9nLCAnJykpO31cbmA7DQogICAgICAgICAgICAgICAgICAgIG9iai5pZFRvU3RyaW5nID0gYF90b1N0cmluZyArPSAob2JqP29iai4ke2lkQ29kZX06KCdncl8nK2dyLnN5c19pZCkpICsgJzogJzsgYDsNCiAgICAgICAgICAgICAgICAgICAgb2JqLm5ld1VVSUQgPSBgaWYoIW9iai4ke2lkQ29kZX0gfHwgb2JqLiR7aWRDb2RlfS5yZXBsYWNlKC8tL2csICcnKS5sZW5ndGghPTMyKXtvYmouJHtpZENvZGV9ID0gZ3Iuc2V0TmV3R3VpZCgpO31lbHNle2dyLnNldE5ld0d1aWRWYWx1ZShvYmouJHtpZENvZGV9LnJlcGxhY2UoLy0vZywgJycpKTt9fVxuYDsNCiAgICAgICAgICAgICAgICB9LA0KICAgIDwlIGMuRW50aXR5QXR0cmlidXRlcy5maWx0ZXIoZWEgPT4gIWVhLkVudGl0eU1ldGhvZCkuZm9yRWFjaChlYSA9PiB7ICU+DQogICAgICAgICAgICAgICAgPCU9bk5hbWUoZWEpJT46IChvYmosIGVhQ29kZSwgdikgPT4gew0KICAgICAgICA8JSBpZihlYS5FbnRpdHlUeXBlICYmIGVhLkVudGl0eVR5cGUhPWMpeyU+DQogICAgICAgICAgICAgICAgICAgIG9iai5kZXBzLjwlPW5OYW1lKGVhLkVudGl0eVR5cGUpJT4gPSAodiB8fCBuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUoZWEuRW50aXR5VHlwZSwgdHJ1ZSklPigpKS48JT1tTmFtZSU+KG9wdGlvbnMpOw0KICAgICAgICA8JSB9JT4NCg0KICAgICAgICAgICAgICAgICAgICBvYmoudmFycyArPSBgdmFyICR7ZWFDb2RlfSA9IDwlaWYoZWEuRW50aXR5VHlwZSl7JT4oKChyZWZzLjwlPW5OYW1lKGVhKSU+ID0gKHR5cGVvZihvYmouJHtlYUNvZGV9KSE9PSd1bmRlZmluZWQnPy8qdGhpcy4qL3NhdmU8JT1uTmFtZShlYS5FbnRpdHlUeXBlKSU+KG9iai4ke2VhQ29kZX0sIHs8JT1uTmFtZShjKSU+OiBvYmosIDwlPW5OYW1lKGMvKmVhKi8pJT5SZWZzOiByZWZzLCA8JT1uTmFtZShjKS50b0xvd2VyQ2FzZSgpJT46IGdyfSwgIjwlPW5OYW1lKGMpJT4iLCByZWZzLjwlPW5OYW1lKGVhKSU+IHx8IC8qRVhQOiByZWZzLjwlPW5OYW1lKGVhLkVudGl0eVR5cGUpLnRvTG93ZXJDYXNlKCklPiB8fCAqLygke19mKDwldmFsdWVPZihlYS5EZWZhdWx0KSU+LCBlYUNvZGUpfSkpOnJlZnMuPCU9bk5hbWUoZWEpJT4pKSB8fCB7c3lzX2lkOiAnJ30pWy8qdGhpcy4qL2NvbmZpZy48JT1uTmFtZShlYS5FbnRpdHlUeXBlKSU+LmlkS2V5IHx8ICJzeXNfaWQiXSkudG9TdHJpbmcoKTwlfWVsc2V7JT5vYmouJHtlYUNvZGV9PCV9JT47YDsNCiAgICAgICAgPCUgaWYoZWEuSXNVbmlxdWUpeyU+DQogICAgICAgICAgICAgICAgICAgIG9iai5xdWVyeSArPSBgX3RvU3RyaW5nKz0nXycrJHtlYUNvZGV9OyBfdG9RdWVyeS4ke2VhQ29kZX0gPSAke19mKHYsIGVhQ29kZSl9OyBgOw0KICAgICAgICA8JSB9JT4NCiAgICAgICAgICAgICAgICAgICAgb2JqLnNldCArPSBgaWYodHlwZW9mKF90b1NldC4ke2VhQ29kZX0gPSAke19mKHYsIGVhQ29kZSl9KSE9PSd1bmRlZmluZWQnPCVpZihlYS5FbnRpdHlUeXBlKXslPiYmIF90b1NldC4ke2VhQ29kZX08JX0lPikgZ3Iuc2V0VmFsdWUoJyR7ZWFDb2RlfScsIF90b1NldC4ke2VhQ29kZX0pO2A7DQogICAgICAgICAgICAgICAgfSwNCiAgICA8JSB9KSU+DQogICAgPCUgYy5FbnRpdHlGaWVsZHMuZm9yRWFjaChlZiA9PiB7JT4NCiAgICAgICAgICAgICAgICBlZl88JT1uTmFtZShlZiklPjogKG9iaiwgZWZDb2RlLCB2KSA9PiBvYmouZXNldCArPSBgaWYodHlwZW9mKF90b1NldC4ke2VmQ29kZX0gPSAke19mKEpTT04uc3RyaW5naWZ5KHYpLCAnb2JqLicrZWZDb2RlKX0pIT09J3VuZGVmaW5lZCcpIGdyLnNldFZhbHVlKCcke2VmQ29kZX0nLCBfdG9TZXQuJHtlZkNvZGV9KTtgLA0KICAgIDwlIH0pJT4NCiAgICA8JSBjLlR5cGVkQXR0cmlidXRlcy5maWx0ZXIodGEgPT4gIXRhLkVudGl0eU1ldGhvZCkuZm9yRWFjaCh0YSA9PiB7bGV0IHRhTmFtZSA9IG5OYW1lKHRhKSArICdfJyArIHRhLkVudGl0eUNsYXNzLlBsdXJhbC5yZXBsYWNlKC8gL2csICdfJyk7JT4NCiAgICAgICAgICAgICAgICA8JT10YU5hbWUlPjogKG9iaiwgZWFDb2RlLCB2KSA9PiB7DQogICAgICAgICAgICAgICAgICAgIG9iai50YXMgKz0gYHJlZnMuPCU9dGFOYW1lJT4gPSAoKG9iaj9vYmouJHtlYUNvZGV9OltdKSB8fCBbXSkubWFwKGZ1bmN0aW9uKG8pe2dzLmluZm8oX3RvU3RyaW5nICsgJyA9PiBzYXZlPCU9bk5hbWUodGEuRW50aXR5Q2xhc3MpJT4oJHtlYUNvZGV9W10pJyk7IHJldHVybiAvKnRoaXMuKi9zYXZlPCU9bk5hbWUodGEuRW50aXR5Q2xhc3MpJT4obywgezwlPW5OYW1lKGMpJT46IG9iaiwgPCU9bk5hbWUoYykudG9Mb3dlckNhc2UoKSU+OiBnciwgbWFueVJlZnM6IHJlZnN9LCAiPCU9bk5hbWUoYyklPiIpO30pO2ANCiAgICAgICAgICAgICAgICAgICAgb2JqLmRlcHMuPCU9bk5hbWUodGEuRW50aXR5Q2xhc3MpJT4gPSAodiAmJiB2Lmxlbmd0aCk/dlswXTpuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUodGEuRW50aXR5Q2xhc3MsIHRydWUpJT4oKS48JT1tTmFtZSU+KG9wdGlvbnMpOw0KICAgICAgICAgICAgICAgIH0sDQogICAgPCUgfSklPg0KICAgICAgICAgICAgfSwgIjwlPW1OYW1lJT4iKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgaWYoIXJldC5kc2V0KSByZXQuZHNldCArPSBgXG5pZih0eXBlb2Yob2JqKT09PSJvYmplY3QiKSBPYmplY3Qua2V5cyhvYmopLmZpbHRlcihmdW5jdGlvbihrKXtyZXR1cm4gIWsuc3RhcnRzV2l0aCgnX18nKSAmJiBbJ3N5c19pZCcsICdJZCcsICdPUEVSQVRPUlMnXS5pbmRleE9mKGspPDAgJiYgdHlwZW9mKF90b1NldFtrXSk9PT0ndW5kZWZpbmVkJyAmJiAhQXJyYXkuaXNBcnJheShvYmpba10pO30pLmZvckVhY2goZnVuY3Rpb24oayl7X3RvU2V0W2tdID0gJHtfZigib2JqW2tdIiwgIm51bGwiKX07IGlmKF90b1NldFtrXSAmJiBfdG9TZXRba10uX19jbGFzcyl7X3RvU2V0W2tdID0gX3RvU2V0W2tdW2NvbmZpZ1tfdG9TZXRba10uX19jbGFzc10uaWRGaWVsZCB8fCAnSWQnXTsgfSBnci5zZXRWYWx1ZShrLCBfdG9TZXRba10gKTsgfSlcbmA7DQoNCiAgICAgICAgICAgIHJldC5jb2RlICs9IGAke09iamVjdC52YWx1ZXMocmV0LmRlcHMpLmpvaW4oJ1xuJyl9ZnVuY3Rpb24gc2F2ZTwlPW5OYW1lKGMpJT4ob2JqLCByZWZzLCBzb3VyY2UsIGdyKXtyZWZzID0gcmVmcyB8fCB7fTsgLyp0aGlzLiovY29uZmlnLnNhdmVfJHs8JT1fbkNvZGUoKSU+fSA9IHNhdmU8JT1uTmFtZShjKSU+OyAvKnRoaXMuKi9jb25maWcuPCU9bk5hbWUoYyklPiA9IC8qdGhpcy4qL2NvbmZpZy48JT1uTmFtZShjKSU+IHx8IHt9OyAvKnRoaXMuKi9jb25maWcuX2lkTWFwID0gLyp0aGlzLiovY29uZmlnLl9pZE1hcCB8fCBbXTsgdmFyIF90b1N0cmluZyA9IHNvdXJjZSArICdbJyArIChyZWZzW3NvdXJjZV0uc3lzX2lkKSArICddPT4gc2F2ZTwlPW5OYW1lKGMpJT4oJzsgaWYodHlwZW9mKG9iaik9PT0nc3RyaW5nJyAmJiBvYmoubGVuZ3RoPj0zMil7dmFyIHJldCA9IHt9OyByZXRbLyp0aGlzLiovY29uZmlnLjwlPW5OYW1lKGMpJT4uaWRLZXkgfHwgInN5c19pZCJdPW9iajsgZ3MuaW5mbyhfdG9TdHJpbmcgKyAnKTogb2JqIGlzIHV1aWQsIHJldHVybmluZyB7JytvYmorJ30nKTsgcmV0dXJuIHJldDt9IGlmKCFvYmogJiYgIWdyKXtncy5pbmZvKF90b1N0cmluZyArICcpOiBvYmogaXMgbnVsbCcpOyByZXR1cm4gbnVsbDt9ICR7cmV0LmlkVG9TdHJpbmd9IHZhciBiU2F2ZSA9ICEvKnRoaXMuKi9jb25maWcuPCU9bk5hbWUoYyklPi5yZWFkT25seTsgaWYoIWdyKXsgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJyR7PCU9X25Db2RlKCklPn0nKTtcbiR7cmV0LklkfVxuJHtyZXQudmFyc31cbmlmKCFnci5pc1ZhbGlkUmVjb3JkKCkpe2dyID0gbmV3IEdsaWRlUmVjb3JkKCckezwlPV9uQ29kZSgpJT59Jyk7IHZhciBfdG9RdWVyeT17fTsgJHtyZXQucXVlcnl9IFxuX3RvU3RyaW5nICs9ICcpOiAnOyBpZihvYmouX19rZXlzICYmIChiU2F2ZSB8fCBjb25maWcuPCU9bk5hbWUoYyklPi5yZWFkT25seSkpe2lmKF90b1F1ZXJ5Ll9fZW5jb2RlZFF1ZXJ5KXtnci5hZGRFbmNvZGVkUXVlcnkoX3RvUXVlcnkuX19lbmNvZGVkUXVlcnkpO31lbHNle29iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKXtnci5hZGRRdWVyeShrLCBfdG9RdWVyeVtrXSB8fCBvYmpba10pO30pO30gZ3Iuc2V0TGltaXQoMSk7IGlmKCFnci5nZXRFbmNvZGVkUXVlcnkoKSkgZ3IuYWRkUXVlcnkoJ3N5c19pZCcsICctMScpOyBncy5pbmZvKF90b1N0cmluZyArICdFbmNvZGVkIFF1ZXJ5OiAnICsgZ3IuZ2V0RW5jb2RlZFF1ZXJ5KCkpOyBnci5xdWVyeSgpO2lmKCFnci5uZXh0KCkpe2dzLmluZm8oX3RvU3RyaW5nICsgJ25vdCBmb3VuZCcpO31lbHNle2dzLmluZm8oX3RvU3RyaW5nICsgJ2ZvdW5kIFskezwlPV9uQ29kZSgpJT59LycgKyBnci5zeXNfaWQgKyAnXSAtIGlzIHZhbGlkOiAnICsgZ3IuaXNWYWxpZFJlY29yZCgpKTsgb2JqLklkID0gZ3Iuc3lzX2lkLnRvU3RyaW5nKCk7IGlmKG9iai5fX3JldXNlZCl7Lypncy5pbmZvKF90b1N0cmluZyArICc6IF9fcmV1c2VkOiBbJHs8JT1fbkNvZGUoKSU+fS8nICsgZ3Iuc3lzX2lkICsgJ10gLSBpcyB2YWxpZDogJyArIGdyLmlzVmFsaWRSZWNvcmQoKSk7ICovcmV0dXJuIGdyO30gfX19fWVsc2V7YlNhdmU9ZmFsc2U7fSBpZihiU2F2ZSAmJiAhZ3IuaXNWYWxpZFJlY29yZCgpKXtncy5pbmZvKF90b1N0cmluZyArICdpbnNlcnRpbmcuLi4nKTsgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJyR7PCU9X25Db2RlKCklPn0nKTsgZ3IuaW5pdGlhbGl6ZSgpOyAke3JldC5uZXdVVUlEfSBpZihiU2F2ZSAmJiBvYmope3ZhciBfdG9TZXQgPSB7fTsgLypzZXQqLyR7cmV0LnNldH0gLyplc2V0Ki8ke3JldC5lc2V0fSAgJHtyZXQuZHNldH0gaWYoLyp0aGlzLiovY29uZmlnLjwlPW5OYW1lKGMpJT4uTm9Xb3JrZmxvdykgZ3Iuc2V0V29ya2Zsb3coZmFsc2UpOyBpZigvKnRoaXMuKi9jb25maWcuPCU9bk5hbWUoYyklPi5Mb2dTZXQpIGdzLmluZm8oX3RvU3RyaW5nICsgJ190b1NldDogJyArIEpTT04uc3RyaW5naWZ5KF90b1NldCkpOyB9ZWxzZSBpZighZ3IuaXNWYWxpZFJlY29yZCgpKXtncy5pbmZvKF90b1N0cmluZyArICdbYlNhdmU9JyArIGJTYXZlICsgJ10gLSByZXR1cm5pbmcgbnVsbC4nKTsgcmV0dXJuIG51bGw7fVxuaWYoIWJTYXZlIHx8IGdyLnVwZGF0ZSgpKXsgaWYoZmFsc2UgJiYgYlNhdmUpe2NvbmZpZy5faWRNYXAucHVzaCh7dGFibGU6ICckezwlPV9uQ29kZSgpJT59Jywgc3lzX2lkOiBnci5zeXNfaWQudG9TdHJpbmcoKSwga2V5czogb2JqLl9fa2V5cy5tYXAoZnVuY3Rpb24oayl7cmV0dXJuIHtrOiBrLCB2OiBfdG9RdWVyeVtrXSB8fCBvYmpba119O30pfSk7fSAke3JldC50YXN9XG5ncy5pbmZvKF90b1N0cmluZyArICdbYlNhdmU9JyArIGJTYXZlICsgJ10gLSByZXR1cm5pbmcgJyArIGdyLnN5c19pZCk7IHJldHVybiBncjt9fVxuYDsNCg0KICAgICAgICAgICAgLypyZXR1cm4gT2JqZWN0LnZhbHVlcyhPYmplY3QuYXNzaWduKHt9LCAuLi5yZXQuY29kZS5zcGxpdCgnZnVuY3Rpb24gc2F2ZScpLmZpbHRlcihzID0+IHMpLnNvcnQoKGEsIGIpID0+IGEubGVuZ3RoIC0gYi5sZW5ndGgpLm1hcChzID0+ICh7W3Muc3BsaXQoJyhvYmosIHJlZnMsIHNvdXJjZSwgZ3IpJylbMF1dOiAnZnVuY3Rpb24gc2F2ZScrc30pKSkpLmpvaW4oJ1xuJyk7ICovDQogICAgICAgICAgICByZXR1cm4gcmV0LmNvZGU7DQogICAgICAgIH1jYXRjaChleCl7DQogICAgICAgICAgICA8JT1lcnJvcigpJT5leCk7DQogICAgICAgIH0NCiAgICB9DQogICAgDQogICAgPCU9bU5hbWU9J190b1NOUXVlcnknJT4oZmllbGRzLCBvYmpzLCBiVVJMKXsNCiAgICAgICAgbGV0IHJldCA9IHRoaXMuX19leHBvcnQoe30sIHsNCiAgICAgICAgICAgIE9QRVJBVE9SUzogdHJ1ZSwNCiAgICAgICAgICAgIC8vX21hcDogdHJ1ZSwNCiAgICAgICAgICAgIElkOiAob2JqLCBpZENvZGUsIHYpID0+IG9ialtpZENvZGVdID0gdiwNCiAgICA8JSBjLkVudGl0eUF0dHJpYnV0ZXMuZmlsdGVyKGVhID0+ICFlYS5FbnRpdHlNZXRob2QpLmZvckVhY2goZWEgPT4geyAlPg0KICAgICAgICAgICAgPCU9bk5hbWUoZWEpJT46IChvYmosIGVhQ29kZSwgdikgPT4gew0KICAgICAgICA8JSBpZihlYS5FbnRpdHlUeXBlKXslPg0KICAgICAgICAgICAgICAgIG9ialtlYUNvZGVdID0gdj92LjwlPW1OYW1lJT4oKTpudWxsOw0KICAgICAgICA8JSB9ZWxzZSBpZihlYS5Jc0RhdGUpeyU+DQogICAgICAgICAgICAgICAgbGV0IGQgPSBgJHt2LmdldEZ1bGxZZWFyKCl9LSR7KCcwJysodi5nZXRNb250aCgpKzEpKS5zbGljZSgtMil9LSR7di5nZXREYXRlKCl9YDsNCiAgICAgICAgICAgICAgICBsZXQgdCA9IGAke3YuZ2V0SG91cnMoKX06JHt2LmdldE1pbnV0ZXMoKX06JHt2LmdldFNlY29uZHMoKX1gOw0KICAgICAgICAgICAgICAgIGlmKCh2LmdldEhvdXJzKCk9PTAgJiYgdi5nZXRNaW51dGVzKCk9PTAgJiYgdi5nZXRTZWNvbmRzKCk9PTApIHx8IHRoaXMuXzwlPW5OYW1lKGVhKSU+X2Nvb3A9PSc9JyB8fCAhdGhpcy5fPCU9bk5hbWUoZWEpJT5fY29vcCl7DQogICAgICAgICAgICAgICAgICAgIG9ialtlYUNvZGVdID0gYE9OJHtkfUBqYXZhc2NyaXB0OmdzLmRhdGVHZW5lcmF0ZSgnJHtkfScsJ3N0YXJ0JylAamF2YXNjcmlwdDpncy5kYXRlR2VuZXJhdGUoJyR7ZH0nLCdlbmQnKWA7DQogICAgICAgICAgICAgICAgfWVsc2UgaWYodGhpcy5fPCU9bk5hbWUoZWEpJT5fY29vcCE9PSdCRVRXRUVOJyl7DQogICAgICAgICAgICAgICAgICAgIG9ialtlYUNvZGVdID0gYGphdmFzY3JpcHQ6Z3MuZGF0ZUdlbmVyYXRlKCcke2R9JywgJyR7dH0nKWA7DQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIG9ialtlYUNvZGVdID0gYGphdmFzY3JpcHQ6Z3MuZGF0ZUdlbmVyYXRlKCcke2R9JywgJyR7dH0nKUBqYXZhc2NyaXB0OmdzLmRhdGVHZW5lcmF0ZSgnJHtkfScsICcke3R9JylgOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgPCUgfWVsc2UgaWYoZWEuSXNCb29sKXslPg0KICAgICAgICAgICAgICAgIG9iai5PUEVSQVRPUlMuPCU9bk5hbWUoZWEpJT4gPSAnPSc7DQogICAgICAgICAgICAgICAgb2JqW2VhQ29kZV0gPSB2Ow0KICAgICAgICA8JSB9ZWxzZXslPg0KICAgICAgICAgICAgICAgIG9ialtlYUNvZGVdID0gdjsNCiAgICAgICAgPCUgfSU+DQogICAgICAgICAgICB9LA0KICAgIDwlIH0pOyAlPg0KICAgICAgICB9LCAiPCU9bU5hbWUlPiIpOw0KICAgICAgICANCiAgICAgICAgT2JqZWN0LmtleXMocmV0Lk9QRVJBVE9SUyB8fCB7fSkuZmlsdGVyKGsgPT4gdHlwZW9mKHJldFtrXSkhPT0ndW5kZWZpbmVkJyAmJiB0eXBlb2YocmV0W2tdKSE9PSdvYmplY3QnKS5mb3JFYWNoKGsgPT4gcmV0W2tdID0gcmV0Lk9QRVJBVE9SU1trXSArIHJldFtrXSk7DQoNCiAgICAgICAgZGVsZXRlIHJldC5PUEVSQVRPUlM7DQogICAgICAgIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGsgPT4gIVN0cmluZyhyZXRba10pLmxlbmd0aCkuZm9yRWFjaChrID0+IGRlbGV0ZSByZXRba10pOw0KDQogICAgICAgIHJldCA9IERvdE9iamVjdC5kb3QocmV0KTsNCg0KICAgICAgICAvLyBhdm9pZCBzZW5kaW5nIHdpdGggbm8gY29tcGFyaXNvbiBvcGVyYXRvcnMNCiAgICAgICAgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoayA9PiAhWyc+JywgJzwnLCAnQkVUV0VFTicsICdPTicsICchJywgJz0nLCAnU1RBUlRTV0lUSCcsICdMSUtFJ10uc29tZShzID0+IFN0cmluZyhyZXRba10pLnN0YXJ0c1dpdGgocykpKS5mb3JFYWNoKGsgPT4gcmV0W2tdID0gKHRoaXNbYF8ke2t9X2Nvb3BgXSB8fCAnU1RBUlRTV0lUSCcpICsgcmV0W2tdKTsNCiAgICAgICAgDQogICAgICAgIDwlPWxvZygpJT5yZXQpOw0KDQogICAgICAgIGlmKGJVUkwpIHJldCA9IE9iamVjdC5lbnRyaWVzKHJldCB8fCB7fSkubWFwKHAgPT4gYCR7cFswXX0ke3BbMV19YCkuam9pbigiXiIpOw0KICAgICAgICANCiAgICAgICAgcmV0dXJuIHJldDsNCiAgICB9DQo8JSB9JT4NCg0KCTwlPW1OYW1lPSdfX2V4cG9ydCclPihvYmosIG9wdGlvbnMsIGZ1biwgLi4uZkFyZ3MpIHsNCgkgICAgdHJ5ew0KICAgIAkgICAgaWYoIW9iaikgcmV0dXJuIHRoaXM7DQogICAgCSAgICANCiAgICAJICAgIGlmKG9wdGlvbnMuT1BFUkFUT1JTKSBvYmouT1BFUkFUT1JTID0gb2JqLk9QRVJBVE9SUyB8fCB7fTsNCiAgICAJICAgIA0KICAgIAkgICAgPCUgLyogSU1QT1JUQU5UOiB0aGlzLklkPT10aGlzLklkIG1ha2VzIHN1cmUgdGhlIElkIGlzIGZpeGVkIGZvciB0aGUgdG9vbCwgbm90IGdldHRpbmcgZ2VuZXJhdGVkIGV2ZXJ5IHRpbWUgd2UgY2FsbCBpdCAqLyAlPg0KICAgIAkgICAgDQogICAgCSAgICBsZXQgZWFDb2RlcyA9IHsNCiAgICAJICAgICAgICBleHBvcnRlcjogIiIsDQogICAgCSAgICAgICAgSWQ6ICIiLA0KICAgIAkgICAgfTsNCiAgICAJICAgIA0KICAgIAkJaWYgKCFvcHRpb25zLlVuaXF1ZSAmJiAob3B0aW9ucy5GdWxsIHx8IHRoaXMuX19zeW5jX29uKCkgfHwgdGhpcy5JZD09dGhpcy5JZCkpIHRoaXMuX19vcHRpb25zKCJJZCIsIG9iaiwgZWFDb2Rlcy5JZCA9IChvcHRpb25zLl9tYXA/dGhpcy5fbkNvZGUoJ0lkJyk6J0lkJyksIHRoaXMuSWQsIHRoaXMsIG9wdGlvbnMsIGZ1bik7DQogICAgCQkNCjwlIGMuRW50aXR5QXR0cmlidXRlcy5maWx0ZXIoZWEgPT4gIWVhLkVudGl0eU1ldGhvZCAmJiAhZWEuRW50aXR5VHlwZSkuZm9yRWFjaChlYSA9PiB7JT4NCiAgICAgICAgICAgIGlmKCFvcHRpb25zLlVuaXF1ZSB8fCAob3B0aW9ucy5VbmlxdWUgJiYgPCV2YWx1ZU9mKGVhLklzVW5pcXVlKSU+KSkgdGhpcy5fX29wdGlvbnMoIjwlPW5OYW1lKGVhKSU+Iiwgb2JqLCBlYUNvZGVzLjwlPW5OYW1lKGVhKSU+ID0gKG9wdGlvbnMuX21hcD88JT1fbkNvZGUoZWEpJT46PCVfdkNvZGUoZWEpJT4pLCB0aGlzLjwlPW5OYW1lKGVhKSU+KCksIHRoaXMsIG9wdGlvbnMsIGZ1biwgIjwlPV9jRmllbGQoZWEpJT4iKTsNCjwlIH0pJT4NCg0KPCUgYy5FbnRpdHlBdHRyaWJ1dGVzLmZpbHRlcihlYSA9PiAhZWEuRW50aXR5TWV0aG9kICYmIGVhLkVudGl0eVR5cGUgJiYgZWEuSXNVbmlxdWUpLmZvckVhY2goZWEgPT4geyU+DQogICAgICAgICAgICBpZiAoIW9wdGlvbnMuVW5pcXVlIHx8IChvcHRpb25zLlVuaXF1ZSAmJiA8JXZhbHVlT2YoZWEuSXNVbmlxdWUpJT4pKSB0aGlzLl9fb3B0aW9ucygiPCU9bk5hbWUoZWEpJT4iLCBvYmosIGVhQ29kZXMuPCU9bk5hbWUoZWEpJT4gPSAob3B0aW9ucy5fbWFwPzwlPV9uQ29kZShlYSklPjo8JV92Q29kZShlYSklPiksIHRoaXMuPCU9bk5hbWUoZWEpJT4oKSwgdGhpcywgb3B0aW9ucywgZnVuLCAiPCU9X2NGaWVsZChlYSklPiIpOw0KPCUgfSklPg0KDQo8JSBjLkVudGl0eUZpZWxkcy5mb3JFYWNoKGVmID0+IHslPg0KICAgICAgICAgICAgaWYgKCFvcHRpb25zLlVuaXF1ZSB8fCAob3B0aW9ucy5VbmlxdWUgJiYgPCV2YWx1ZU9mKGVmLklzVW5pcXVlKSU+KSkgdGhpcy5fX29wdGlvbnMoImVmXzwlPW5OYW1lKGVmKSU+Iiwgb2JqLCBlYUNvZGVzLmVmXzwlPW5OYW1lKGVmKSU+ID0gKG9wdGlvbnMuX21hcD88JT1fbkNvZGUoZWYpJT46PCVfdkNvZGUoZWYpJT4pLCA8JXZhbHVlT2YoZWYuVmFsdWUpJT4sIHRoaXMsIG9wdGlvbnMsIGZ1bik7DQo8JSB9KSU+DQoNCgkJICAgIDwlIHVuUmVjdXJzZSgnb2JqJywgJ2Z1bicsICdmQXJncycsICdpZih0eXBlb2Yob3B0aW9ucy5leHBvcnRlcik9PT0iZnVuY3Rpb24iKSBvcHRpb25zLmV4cG9ydGVyKHYpJyklPg0KDQo8JSBjLkVudGl0eUF0dHJpYnV0ZXMuZmlsdGVyKGVhID0+ICFlYS5FbnRpdHlNZXRob2QgJiYgZWEuRW50aXR5VHlwZSAmJiAhZWEuSXNVbmlxdWUpLmZvckVhY2goZWEgPT4geyU+DQogICAgICAgICAgICBpZiAoIW9wdGlvbnMuVW5pcXVlKSB0aGlzLl9fb3B0aW9ucygiPCU9bk5hbWUoZWEpJT4iLCBvYmosIGVhQ29kZXMuPCU9bk5hbWUoZWEpJT4gPSAob3B0aW9ucy5fbWFwPzwlPV9uQ29kZShlYSklPjo8JV92Q29kZShlYSklPiksIHRoaXMuPCU9bk5hbWUoZWEpJT4oKSwgdGhpcywgb3B0aW9ucywgZnVuLCAiPCU9X2NGaWVsZChlYSklPiIpOw0KPCUgfSklPg0KDQogICAgICAgICAgICBpZiAoIW9wdGlvbnMuVW5pcXVlKSB0aGlzLl9fb3B0aW9ucygiX1RISVMiLCBvYmosIGVhQ29kZXMuX1RISVMgPSAob3B0aW9ucy5fbWFwP3RoaXMuX25Db2RlKCdfVEhJUycpOiJfVEhJUyIpLCB0aGlzLl9USElTLCB0aGlzLCBvcHRpb25zLCBmdW4pOw0KDQo8JSBjLlR5cGVkQXR0cmlidXRlcy5maWx0ZXIodGEgPT4gIXRhLkVudGl0eU1ldGhvZCkuZm9yRWFjaCh0YSA9PiB7bGV0IHRhTmFtZSA9IG5OYW1lKHRhKSArICdfJyArIHRhLkVudGl0eUNsYXNzLlBsdXJhbC5yZXBsYWNlKC8gL2csICdfJyk7JT4NCiAgICAgICAgICAgIGlmICghb3B0aW9ucy5VbmlxdWUpIHRoaXMuX19vcHRpb25zKCI8JT10YU5hbWUlPiIsIG9iaiwgZWFDb2Rlcy48JT10YU5hbWUlPiA9IChvcHRpb25zLl9tYXA/PCU9X25Db2RlKHRhLCB0cnVlKSU+OiI8JT10YU5hbWUlPiIpLCB0aGlzLjwlPXRhTmFtZSU+KCksIHRoaXMsIG9wdGlvbnMsIGZ1biwgIjwlPV9jRmllbGQodGEpJT4iKTsNCjwlIH0pJT4NCg0KICAgICAgICAgICAgaWYgKCFvcHRpb25zLlVuaXF1ZSkgT2JqZWN0LmtleXMob3B0aW9ucykuZmlsdGVyKGsgPT4gdHlwZW9mKG9wdGlvbnNba10pPT09J2Z1bmN0aW9uJyAmJiAhT2JqZWN0LmtleXMoZWFDb2RlcykuaW5jbHVkZXMoaykpLmZvckVhY2goayA9PiB0aGlzLl9fb3B0aW9ucyhrLCBvYmosIGssIHVuZGVmaW5lZCwgdGhpcywgb3B0aW9ucywgZnVuKSk7DQogICAgICAgIA0KICAgICAgICAgICAgPCU9c2NvcGUlPi5fdW5SZWN1cnNlLjwlPW5OYW1lKGMpJT5bZnVuXSA9IDwlPXNjb3BlJT4uX3VuUmVjdXJzZS48JT1uTmFtZShjKSU+W2Z1bl0gfHwge307DQogICAgICAgICAgICAoPCU9c2NvcGUlPi5fdW5SZWN1cnNlLjwlPW5OYW1lKGMpJT5bZnVuXS5DeWNsaWMgfHwgW10pLmZvckVhY2gobiA9PiBuLl9jW24uZWFGaWVsZF0obi5fY1tuLmVhRmllbGRdKCkuX3RvSGFzaChudWxsLCB7bm9Db2RlOiB0cnVlLCBvbmx5VW5pcXVlOiB0cnVlLCBub0FyZ3M6IHRydWUsIF9tYXA6IG9wdGlvbnMuX21hcH0sIGZ1bikpKTsNCiAgICAgICAgICAgIDwlPXNjb3BlJT4uX3VuUmVjdXJzZS48JT1uTmFtZShjKSU+W2Z1bl0uQ3ljbGljID0gW107IC8vPz8NCiAgICAgICAgICAgIA0KICAgIAkJcmV0dXJuIG9iajsNCiAgICAJfWNhdGNoKGV4KXsNCiAgICAJICAgIDwlPWVycm9yKCklPmV4KTsNCiAgICAJfQ0KCX0NCgkNCgk8JT1tTmFtZT0nX19vcHRpb25zJyU+KGZpZWxkLCBvYmosIGVhQ29kZSwgZWFPYmosIF90aGlzPXRoaXMsIG9wdGlvbnM9e30sIGZ1biwgZWFGaWVsZCl7DQo8JSBpZihtYWluQ2xhc3MoKSE9Yyl7JT4NCiAgICAgICAgcmV0dXJuIG5ldyA8JT1zY29wZSU+LjwlPV9jTmFtZShtYWluQ2xhc3MoKSwgdHJ1ZSklPigpLjwlPW1OYW1lJT4oZmllbGQsIG9iaiwgZWFDb2RlLCBlYU9iaiwgX3RoaXMsIG9wdGlvbnMsIGZ1biwgZWFGaWVsZCk7DQo8JSB9ZWxzZXslPg0KICAgICAgICB0cnl7DQogICAgICAgICAgICBpZihvcHRpb25zLl9maWVsZHMgJiYgIW9wdGlvbnMuX2ZpZWxkcy5pbmNsdWRlcyhmaWVsZCkpIHJldHVybjsNCiAgICAgICAgICAgIGlmKCFvYmopIHJldHVybjsNCiAgICAgICAgICAgIGlmKHR5cGVvZihvcHRpb25zW2ZpZWxkXSkhPT0iZnVuY3Rpb24iKXsNCiAgICAgICAgICAgICAgICA8JT1sb2coKSU+YCR7ZnVufS5vcHRpb25zLiR7ZmllbGR9IGlzIG5vdCBhIGZ1bmN0aW9uYCk7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICBpZih0eXBlb2YoZWFPYmopIT09J3VuZGVmaW5lZCcgJiYgIW9wdGlvbnMuTnVsbCl7DQogICAgICAgICAgICAgICAgaWYoZmllbGQhPSdJZCcgJiYgdHlwZW9mKF90aGlzW2ZpZWxkXSk9PT0nZnVuY3Rpb24nICYmICFfdGhpc1snXycrZmllbGQrJ19zZXQnXSkgcmV0dXJuOw0KICAgICAgICAgICAgICAgIGlmKEFycmF5LmlzQXJyYXkoZWFPYmopICYmIHR5cGVvZihlYU9iai5sZW5ndGgpIT09J3VuZGVmaW5lZCcpIGVhT2JqID0gZWFPYmouZmlsdGVyKHYgPT4gdik7DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIGlmKCFvcHRpb25zLk51bGwgJiYgQXJyYXkuaXNBcnJheShlYU9iaikgJiYgIWVhT2JqLmxlbmd0aCkgcmV0dXJuOw0KDQogICAgICAgICAgICBsZXQgX3JldCA9IG9wdGlvbnNbZmllbGRdKG9iaiwgZWFDb2RlLCBlYU9iaiwgX3RoaXMpOw0KICAgICAgICAgICAgaWYob3B0aW9ucy5PUEVSQVRPUlMgJiYgX3RoaXNbJ18nICsgZmllbGQgKyAnX2Nvb3AnXSkgb2JqLk9QRVJBVE9SUyA9IE9iamVjdC5hc3NpZ24ob2JqLk9QRVJBVE9SUyB8fCB7fSwge1tmaWVsZF06IF90aGlzWydfJyArIGZpZWxkICsgJ19jb29wJ119KTsNCg0KICAgICAgICAgICAgaWYoIW9wdGlvbnMuQ3ljbGljICYmIGVhRmllbGQgJiYgb2JqICYmIG9iai5FbnRpdHlDbGFzcyAmJiB0eXBlb2Yob2JqW2ZpZWxkXSk9PT0nZnVuY3Rpb24nKXsNCiAgICAgICAgICAgICAgICA8JT1zY29wZSU+Ll91blJlY3Vyc2UuPCU9bk5hbWUoYyklPltmdW5dID0gPCU9c2NvcGUlPi5fdW5SZWN1cnNlLjwlPW5OYW1lKGMpJT5bZnVuXSB8fCB7fTsNCiAgICAgICAgICAgICAgICA8JT1zY29wZSU+Ll91blJlY3Vyc2UuPCU9bk5hbWUoYyklPltmdW5dLkN5Y2xpYyA9IDwlPXNjb3BlJT4uX3VuUmVjdXJzZS48JT1uTmFtZShjKSU+W2Z1bl0uQ3ljbGljIHx8IFtdOw0KICAgICAgICAgICAgICAgIGxldCBfY3ljbGVzID0gb2JqW2ZpZWxkXSgpOw0KICAgICAgICAgICAgICAgIGlmKCFBcnJheS5pc0FycmF5KF9jeWNsZXMpKSBfY3ljbGVzID0gW19jeWNsZXNdOw0KICAgICAgICAgICAgICAgIF9jeWNsZXMgPSBfY3ljbGVzLmZpbHRlcihfYyA9PiBfYyAmJiB0eXBlb2YoX2NbZWFGaWVsZF0pPT09J2Z1bmN0aW9uJyAmJiBfY1snXycgKyBlYUZpZWxkICsgJ19zZXQnXSAmJiBvYmouX3NhbWVFbnRpdHkoX2NbZWFGaWVsZF0oKSkpLm1hcChfYyA9PiAoew0KICAgICAgICAgICAgICAgICAgICAvKm1hcmsgX2NbZWFGaWVsZF1fc2V0IHRvIG51bGwgaW5zdGVhZCovDQogICAgICAgICAgICAgICAgICAgIF9jLA0KICAgICAgICAgICAgICAgICAgICBlYUZpZWxkLA0KICAgICAgICAgICAgICAgIH0pKTsNCiAgICAgICAgICAgICAgICBpZihfY3ljbGVzLmxlbmd0aCkgPCU9d2FybigpJT5mdW4gKyAiL19jeWNsZXMiLCBfY3ljbGVzKTsNCiAgICAgICAgICAgICAgICA8JT1zY29wZSU+Ll91blJlY3Vyc2UuPCU9bk5hbWUoYyklPltmdW5dLkN5Y2xpYy5wdXNoKC4uLl9jeWNsZXMpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZihvcHRpb25zLl9tYXApIF90aGlzLl9tYXAoZmllbGQsIHR5cGVvZihlYU9iaik9PT0ndW5kZWZpbmVkJywgZnVuLCB0eXBlb2YoZWFPYmopPT09J3VuZGVmaW5lZCc/b2JqOmVhT2JqLCB0eXBlb2YoZWFPYmopPT09J3VuZGVmaW5lZCc/X3RoaXM6b2JqLCBlYUNvZGUpOw0KDQogICAgICAgICAgICByZXR1cm4gX3JldDsNCiAgICAgICAgfWNhdGNoKGV4KXsNCiAgICAgICAgICAgIDwlPWVycm9yKCklPmZ1biwgZmllbGQsIGV4KTsNCiAgICAgICAgfQ0KPCUgfSU+DQoJfQ0KCQ0KCTwlPW1OYW1lPSdfX2ltcG9ydCclPihvYmosIG9wdGlvbnMsIGZ1biwgLi4uZkFyZ3MpIHsNCiAgICAgICAgaWYodHlwZW9mKG9iaikhPT0nb2JqZWN0Jyl7DQogICAgICAgICAgICA8JT13YXJuKCklPmAke2Z1bn06IE5vdCBhbiBvYmplY3Q6ICR7dHlwZW9mKG9iail9YCwgb2JqKTsNCiAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICB9DQoJICAgIA0KICAgICAgICBsZXQgZWFDb2RlcyA9IHt9Ow0KDQoJCXRoaXMuX19vcHRpb25zKCJJZCIsIG9iaiwgZWFDb2Rlcy5JZCA9IChvcHRpb25zLl9tYXA/dGhpcy5fbkNvZGUoJ0lkJyk6J0lkJyksIHVuZGVmaW5lZCwgdGhpcywgb3B0aW9ucywgZnVuKTsNCgkJDQo8JSBjLkVudGl0eUF0dHJpYnV0ZXMuZmlsdGVyKGVhID0+ICFlYS5FbnRpdHlNZXRob2QgJiYgIWVhLkVudGl0eVR5cGUpLmZvckVhY2goZWEgPT4geyU+DQogICAgICAgIHRoaXMuX19vcHRpb25zKCI8JT1uTmFtZShlYSklPiIsIG9iaiwgZWFDb2Rlcy48JT1uTmFtZShlYSklPiA9IChvcHRpb25zLl9tYXA/PCU9X25Db2RlKGVhKSU+OjwlX3ZDb2RlKGVhKSU+KSwgdW5kZWZpbmVkLCB0aGlzLCBvcHRpb25zLCBmdW4sICI8JT1fY0ZpZWxkKGVhKSU+Iik7DQo8JSB9KSU+DQoNCjwlIGMuRW50aXR5QXR0cmlidXRlcy5maWx0ZXIoZWEgPT4gIWVhLkVudGl0eU1ldGhvZCAmJiBlYS5FbnRpdHlUeXBlICYmIGVhLklzVW5pcXVlKS5mb3JFYWNoKGVhID0+IHslPg0KICAgICAgICB0aGlzLl9fb3B0aW9ucygiPCU9bk5hbWUoZWEpJT4iLCBvYmosIGVhQ29kZXMuPCU9bk5hbWUoZWEpJT4gPSAob3B0aW9ucy5fbWFwPzwlPV9uQ29kZShlYSklPjo8JV92Q29kZShlYSklPiksIHVuZGVmaW5lZCwgdGhpcywgb3B0aW9ucywgZnVuLCAiPCU9X2NGaWVsZChlYSklPiIpOw0KPCUgfSklPg0KDQoJCTwlIHVuUmVjdXJzZSgndGhpcycsICdmdW4nLCAnZkFyZ3MnLCAnaWYodHlwZW9mKG9wdGlvbnMuaW1wb3J0ZXIpPT09ImZ1bmN0aW9uIikgb3B0aW9ucy5pbXBvcnRlcih2KScpJT4NCg0KPCUgYy5FbnRpdHlBdHRyaWJ1dGVzLmZpbHRlcihlYSA9PiAhZWEuRW50aXR5TWV0aG9kICYmIGVhLkVudGl0eVR5cGUgJiYgIWVhLklzVW5pcXVlKS5mb3JFYWNoKGVhID0+IHslPg0KICAgICAgICB0aGlzLl9fb3B0aW9ucygiPCU9bk5hbWUoZWEpJT4iLCBvYmosIGVhQ29kZXMuPCU9bk5hbWUoZWEpJT4gPSAob3B0aW9ucy5fbWFwPzwlPV9uQ29kZShlYSklPjo8JV92Q29kZShlYSklPiksIHVuZGVmaW5lZCwgdGhpcywgb3B0aW9ucywgZnVuLCAiPCU9X2NGaWVsZChlYSklPiIpOw0KPCUgfSklPg0KDQoJCXRoaXMuX19vcHRpb25zKCJfVEhJUyIsIG9iaiwgZWFDb2Rlcy5fVEhJUyA9IChvcHRpb25zLl9tYXA/dGhpcy5fbkNvZGUoJ19USElTJyk6J19USElTJyksIHVuZGVmaW5lZCwgdGhpcywgb3B0aW9ucywgZnVuKTsNCg0KPCUgYy5UeXBlZEF0dHJpYnV0ZXMuZmlsdGVyKHRhID0+ICF0YS5FbnRpdHlNZXRob2QpLmZvckVhY2godGEgPT4gew0KICAgIGxldCB0YU5hbWUgPSBuTmFtZSh0YSkgKyAnXycgKyB0YS5FbnRpdHlDbGFzcy5QbHVyYWwucmVwbGFjZSgvIC9nLCAnXycpOw0KJT4NCiAgICAgICAgdGhpcy5fX29wdGlvbnMoIjwlPXRhTmFtZSU+Iiwgb2JqLCBlYUNvZGVzLjwlPXRhTmFtZSU+ID0gKG9wdGlvbnMuX21hcD88JT1fbkNvZGUodGEsIHRydWUpJT46IjwlPXRhTmFtZSU+IiksIHVuZGVmaW5lZCwgdGhpcywgb3B0aW9ucywgZnVuLCAiPCU9X2NGaWVsZCh0YSklPiIpOw0KPCUgfSklPg0KDQogICAgICAgIE9iamVjdC5rZXlzKG9wdGlvbnMpLmZpbHRlcihrID0+IHR5cGVvZihvcHRpb25zW2tdKT09PSdmdW5jdGlvbicgJiYgIU9iamVjdC5rZXlzKGVhQ29kZXMpLmluY2x1ZGVzKGspKS5mb3JFYWNoKGsgPT4gdGhpcy5fX29wdGlvbnMoaywgb2JqLCBrLCB1bmRlZmluZWQsIHRoaXMsIG9wdGlvbnMsIGZ1bikpOw0KDQoJCXJldHVybiB0aGlzOw0KCX0NCg0KPCUgaWYobWFpbkNsYXNzKFsnTmVvNGonXSkpeyU+DQogICAgPCU9bU5hbWU9J190b0N5VGFibGUnJT4oKXsNCiAgICAgICAgbGV0IHJldCA9IHRoaXMuX19leHBvcnQoe2NxbDogYA0KQ1JFQVRFIENPTlNUUkFJTlQgSUYgTk9UIEVYSVNUUyBGT1IgKG86JHs8JT1fbkNvZGUoKSU+fSkgUkVRVUlSRSBvLiR7dGhpcy5fX2NvbmZpZygnaWRGaWVsZCcsICdJZCcpfSBJUyBVTklRVUU7DQpDUkVBVEUgQ09OU1RSQUlOVCBJRiBOT1QgRVhJU1RTIEZPUiAobzokezwlPV9uQ29kZSgpJT59KSBSRVFVSVJFIG8uJHt0aGlzLl9fY29uZmlnKCdpZEZpZWxkJywgJ0lkJyl9IElTIE5PVCBOVUxMOw0KICAgICAgICBgfSwgew0KICAgICAgICAgICAgRnVsbDogdHJ1ZSwNCiAgICAgICAgICAgIE51bGw6IHRydWUsDQogICAgPCUgYy5FbnRpdHlBdHRyaWJ1dGVzLmZpbHRlcihlYSA9PiAhZWEuRW50aXR5TWV0aG9kKS5mb3JFYWNoKGVhID0+IHslPg0KICAgICAgICAgICAgIjwlPW5OYW1lKGVhKSU+IjogKG9iaiwgZWFDb2RlLCB2KSA9PiB7DQogICAgICAgIDwlIGlmKGVhLkVudGl0eVR5cGUpeyU+DQogICAgICAgICAgICAgICAgb2JqLmNxbCArPSB2P3YuPCU9bU5hbWUlPigpOicnOw0KICAgICAgICA8JSB9ZWxzZSBpZihlYS5Jc1VuaXF1ZSl7JT4NCiAgICAgICAgICAgICAgICBvYmouY3FsICs9IGBDUkVBVEUgQ09OU1RSQUlOVCBJRiBOT1QgRVhJU1RTIEZPUiAobzokezwlPV9uQ29kZSgpJT59KSBSRVFVSVJFIG8uJHtlYUNvZGV9IElTIFVOSVFVRTsNCmANCiAgICAgICAgPCUgfSU+DQogICAgICAgICAgICB9LA0KICAgIDwlIH0pOyAlPg0KICAgIDwlIGMuVHlwZWRBdHRyaWJ1dGVzLmZvckVhY2godGEgPT4geyBsZXQgdGFOYW1lID0gbk5hbWUodGEpICsgJ18nICsgdGEuRW50aXR5Q2xhc3MuUGx1cmFsLnJlcGxhY2UoLyAvZywgJ18nKTslPg0KICAgICAgICAgICAgPCU9dGFOYW1lJT46IChvYmosIGVhQ29kZSwgdikgPT4gb2JqLmNxbCArPSB2Lm1hcChfdiA9PiBfdi48JT1tTmFtZSU+KCkpLmpvaW4oJ1xuJyksDQogICAgPCUgfSklPg0KICAgICAgICB9LCAiPCU9bU5hbWUlPiIpOw0KDQogICAgICAgIDwlPWxvZygpJT5yZXQuY3FsKTsNCiAgICAgICAgcmV0dXJuIHJldC5jcWw7DQogICAgfQ0KICAgIA0KICAgIDwlPW1OYW1lPSdfdG9DeU1lcmdlJyU+KGZpZWxkcywgYlJhdyl7DQogICAgICAgIGxldCBvYmogPSB0aGlzLl90b0RCT2JqZWN0KGZpZWxkcywgdHJ1ZSk7DQogICAgICAgIGxldCB1a2V5cyA9IFtdOw0KICAgIDwlIGMuRW50aXR5QXR0cmlidXRlcy5maWx0ZXIoZWEgPT4gIWVhLkVudGl0eU1ldGhvZCAmJiBlYS5Jc1VuaXF1ZSkuZm9yRWFjaChlYSA9PiB7JT4NCiAgICAgICAgaWYoPCV2YWx1ZU9mKGVhLklzVW5pcXVlKSU+KSB1a2V5cy5wdXNoKDwlPV9uQ29kZShlYSklPik7DQogICAgPCUgfSklPg0KICAgICAgICBsZXQgY3FsID0gYDokezwlPV9uQ29kZSgpJT59IHtgICsgT2JqZWN0LmtleXMob2JqKS5maWx0ZXIoayA9PiB1a2V5cy5pbmNsdWRlcyhrKSkubWFwKGsgPT4gayArICI6ICIgKyBvYmpba10pLmpvaW4oJywgJykgKyBgfSlgOw0KICAgICAgICANCiAgICAgICAgaWYoIWJSYXcpew0KICAgICAgICAgICAgbGV0IG1hdGNoID0gJ1xuTUFUQ0ggKG8nICsgY3FsOw0KICAgICAgICAgICAgY3FsID0gJ01FUkdFIChvJyArIGNxbDsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgbGV0IG9uU2V0ID0gT2JqZWN0LmtleXMob2JqKS5maWx0ZXIoayA9PiAhdWtleXMuaW5jbHVkZXMoaykpLm1hcChrID0+ICJvLiIgKyBrICsgIj0iICsgb2JqW2tdKS5qb2luKCcsICcpDQogICAgICAgICAgICBjcWwgKz0gJ1xuT04gQ1JFQVRFIFNFVCAnICsgb25TZXQgKyAnXG5PTiBNQVRDSCBTRVQgJyArIG9uU2V0Ow0KICAgICAgICAgICAgY3FsICs9ICdcblJFVFVSTiBvOyc7DQoNCiAgICA8JSBjLkVudGl0eUF0dHJpYnV0ZXMuZmlsdGVyKGVhID0+ICFlYS5FbnRpdHlNZXRob2QgJiYgZWEuRW50aXR5VHlwZSkuZm9yRWFjaChlYSA9PiB7JT4NCiAgICAgICAgICAgIGlmKHRoaXMuXzwlPW5OYW1lKGVhKSU+X3NldCkgY3FsICs9IG1hdGNoICsgJywgJyArIHRoaXMuPCU9bk5hbWUoZWEpJT4oKS48JT1tTmFtZSU+KG51bGwsIHRydWUpLnJlcGxhY2UoJyg6JywgJyg8JT1uTmFtZShlYSklPjonKSArICcgTUVSR0UgKG8pLVs6PCU9bk5hbWUoYyklPl88JT1uTmFtZShlYSklPl0tPig8JT1uTmFtZShlYSklPik7JzsNCiAgICA8JSB9KSU+DQogICAgICAgIH1lbHNlew0KICAgICAgICAgICAgY3FsID0gJygnICsgY3FsOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICA8JT1sb2coKSU+Y3FsKTsNCiAgICAgICAgcmV0dXJuIGNxbDsNCiAgICB9DQoNCiAgICA8JT1tTmFtZT0nX3RvQ3lRdWVyeSclPihmaWVsZHMsIG9ianMpew0KICAgICAgICBsZXQgc3FsID0gIk1BVENIICI7DQogICAgICAgIA0KICAgICAgICBsZXQgdFByZWYgPSBgJHt0aGlzLl9RKCl9JHs8JT1fbkNvZGUoKSU+LnRvTG93ZXJDYXNlKCl9JHt0aGlzLl9RKCl9YDsNCg0KICAgICAgICBsZXQgaGVhZGVyID0gdGhpcy5fdG9TZWxlY3RIZWFkZXIoZmllbGRzKTsNCg0KICAgICAgICBzcWwgKz0gYCAoJHt0UHJlZn06JHt0aGlzLl9RKCl9JHs8JT1fbkNvZGUoKSU+fSR7dGhpcy5fUSgpfSlgOw0KICAgICAgICANCiAgICAgICAgT2JqZWN0LmtleXMoaGVhZGVyLmpvaW5zKS5mb3JFYWNoKGsgPT4gc3FsICs9IGAgT1BUSU9OQUwgTUFUQ0ggKCR7dGhpcy5fUSgpfSR7a30ke3RoaXMuX1EoKX06JHt0aGlzLl9RKCl9JHtoZWFkZXIuam9pbnNba10udGFibGV9JHt0aGlzLl9RKCl9KSBPUFRJT05BTCBNQVRDSCAoJHt0aGlzLl9RKCl9JHs8JT1fbkNvZGUoKSU+LnRvTG93ZXJDYXNlKCl9JHt0aGlzLl9RKCl9KS1bOiR7dGhpcy5fUSgpfSR7aGVhZGVyLmpvaW5zW2tdLnRhYmxlfV8ke2t9JHt0aGlzLl9RKCl9XS0+KCR7dGhpcy5fUSgpfSR7a30ke3RoaXMuX1EoKX0pYCk7DQogICAgICAgIA0KDQogICAgICAgIC8vc3FsICs9IE9iamVjdC52YWx1ZXMoaGVhZGVyLmZpZWxkcykubWFwKGYgPT4gYCR7dFByZWZ9LiR7Zn1gKS5qb2luKCcsICcpOw0KICAgICAgICAvL09iamVjdC5rZXlzKGhlYWRlci5qb2lucykuZm9yRWFjaChrID0+IHNxbCArPSAiLCAiICsgT2JqZWN0LnZhbHVlcyhoZWFkZXIuam9pbnNba10uZmllbGRzKS5tYXAoZiA9PiBgJHt0aGlzLl9RKCl9JHtoZWFkZXIuam9pbnNba10udGFibGV9XyR7a30ke3RoaXMuX1EoKX0uJHtmfSBhcyAke3RoaXMuX1EoKX0ke2t9LiR7Zi5yZXBsYWNlKHRoaXMuX1EoKSwgJycpfWApLmpvaW4oJywgJykpOw0KICAgICAgICANCiAgICAgICAgaWYodGhpcy5fX2ZpZWxkQWdncmVnYXRlcyl7DQogICAgICAgICAgICAvLyB7ZmllbGQ6IGZ1bmN0aW9ufQ0KICAgIDwlIGMuRW50aXR5QXR0cmlidXRlcy5maWx0ZXIoZWEgPT4gIWVhLkVudGl0eU1ldGhvZCAmJiAhZWEuSXNUZXh0ICYmICFlYS5Jc0ltYWdlICYmICFlYS5Jc0ZpbGUpLmZvckVhY2goZWEgPT4geyAlPg0KICAgICAgICAgICAgaWYodGhpcy5fX2ZpZWxkQWdncmVnYXRlcy48JT1uTmFtZShlYSklPikgc3FsICs9IGAke3NxbD09KCdzZWxlY3QgJyk/Jyc6JywnfSAke3RoaXMuX19maWVsZEFnZ3JlZ2F0ZXMuPCU9bk5hbWUoZWEpJT59KCR7dGhpcy5fUSgpfSR7PCU9X25Db2RlKGVhKSU+fSR7dGhpcy5fUSgpfSlgOw0KICAgIDwlIH0pJT4NCiAgICAgICAgfQ0KDQogICAgICAgIHNxbCArPSBgIHdoZXJlIDE9MWA7DQoNCiAgICAgICAgc3FsID0gdGhpcy5fX2V4cG9ydCh7c3FsOiBzcWx9LCB7DQogICAgICAgICAgICBfZmllbGRzOiAodGhpcy5fX3N5bmNfb24oKSB8fCB0aGlzLklkPT10aGlzLklkKT9bJ0lkJ106dW5kZWZpbmVkLA0KICAgICAgICAgICAgTnVsbDogdHJ1ZSwNCiAgICAgICAgICAgIF9USElTOiBvYmogPT4gew0KICAgICAgICAgICAgICAgIGlmKCF0aGlzLl9USElTIHx8ICF0aGlzLl9USElTLmxlbmd0aCkgcmV0dXJuOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIG9iai5zcWwgKz0gYCBhbmQgJHt0UHJlZn0uJHt0aGlzLl9RKCl9JHt0aGlzLl9fY29uZmlnKCdpZEZpZWxkJywgJ0lkJyl9JHt0aGlzLl9RKCl9IGAgKyAodGhpcy5fVEhJU19jb29wIHx8ICJJTiIpICsgIiAoIiArIHRoaXMuX1RISVMubWFwKHQgPT4gdC48JT1tTmFtZSU+KHQuX19jb25maWcoJ2lkRmllbGQnLCAnSWQnKSkpLmpvaW4oJyBVTklPTiBBTEwgJykgKyAiKSI7DQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgSWQ6IG9iaiA9PiBvYmouc3FsICs9IGAgYW5kICR7dFByZWZ9LiR7dGhpcy5fUSgpfSR7dGhpcy5fX2NvbmZpZygnaWRGaWVsZCcsICdJZCcpfSR7dGhpcy5fUSgpfT0nJHt0aGlzLklkfSdgLA0KICAgIDwlIGMuRW50aXR5QXR0cmlidXRlcy5maWx0ZXIoZWEgPT4gIWVhLkVudGl0eU1ldGhvZCkuZm9yRWFjaChlYSA9PiB7ICU+DQogICAgICAgICAgICA8JT1uTmFtZShlYSklPjogKG9iaiwgZWFDb2RlLCB2KSA9PiB7DQogICAgICAgICAgICAgICAgaWYoIXRoaXMuXzwlPW5OYW1lKGVhKSU+X3NldCkgcmV0dXJuOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICA8JSBpZihlYS5FbnRpdHlUeXBlKXslPg0KICAgICAgICAgICAgICAgIGxldCBjb29wID0gdGhpcy5fPCU9bk5hbWUoZWEpJT5fY29vcDsNCiAgICAgICAgICAgICAgICBzd2l0Y2goY29vcCl7DQogICAgICAgICAgICAgICAgICAgIGNhc2UgIiE9IjoNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvb3AgPSAiTk9UICI7DQogICAgICAgICAgICAgICAgICAgIGNhc2UgIj0iOg0KICAgICAgICAgICAgICAgICAgICAgICAgY29vcCA9ICIiOw0KICAgICAgICAgICAgICAgICAgICBjYXNlICIiOg0KICAgICAgICAgICAgICAgICAgICAgICAgY29vcCA9ICIiOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICBpZih2KXsNCiAgICAgICAgICAgICAgICAgICAgb2JqLnNxbCArPSBgIGFuZCAke2Nvb3B9IEVYSVNUUyB7JHt2LjwlPW1OYW1lJT4oKX19YDsNCiAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgb2JqLnNxbCArPSBgIGFuZCAoJHt0UHJlZn0uJHt0aGlzLl9RKCl9JHtlYUNvZGV9aWQke3RoaXMuX1EoKX0gJHtjb29wfSAoMCkgT1IgJHt0UHJlZn0uJHt0aGlzLl9RKCl9JHtlYUNvZGV9aWQke3RoaXMuX1EoKX0gSVMgTlVMTClgOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgIDwlIH1lbHNlIGlmKGVhLklzVGV4dCB8fCBlYS5Jc0ltYWdlIHx8IGVhLklzRmlsZSl7JT4NCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgIDwlIH1lbHNleyU+DQogICAgICAgICAgICAgICAgb2JqLnNxbCArPSBgIGFuZCAke3RQcmVmfS4ke3RoaXMuX1EoKX0ke2VhQ29kZX0ke3RoaXMuX1EoKX0gYCArIDwlaWYoZWEuSXNCb29sKXslPiI9IjwlfWVsc2V7JT4odGhpcy5fPCU9bk5hbWUoZWEpJT5fY29vcCB8fCAiQ09OVEFJTlMiKTwlfSU+ICsgIiAiOw0KICAgICAgICA8JSB9JT4NCiAgICAgICAgDQogICAgICAgIDwlIGlmKGVhLklzRGF0ZSl7ICU+DQogICAgICAgICAgICAgICAgaWYodiAmJiB2LnRvSVNPU3RyaW5nKXsNCiAgICAgICAgICAgICAgICAgICAgaWYodGhpcy5fX2NvbmZpZygndHlwZScpPT0nc3FsaXRlJyl7DQogICAgICAgICAgICAgICAgICAgICAgICBvYmouc3FsICs9ICJzdHJmdGltZSgnJXMnLCAnIiArIHYudG9JU09TdHJpbmcoKSArICInKSI7DQogICAgICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICAgICAgb2JqLnNxbCArPSAiJyIgKyB2LnRvSVNPU3RyaW5nKCkgKyAiJyI7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgPCUgfWVsc2UgaWYoZWEuSXNTdHJpbmcpeyAlPg0KICAgICAgICAgICAgICAgIGlmKHR5cGVvZih2KT09PSJzdHJpbmciKXsNCiAgICAgICAgICAgICAgICAgICAgb2JqLnNxbCArPSAiJyIgKyAoKHRoaXMuXzwlPW5OYW1lKGVhKSU+X2Nvb3A9PSJMSUtFIiB8fCAhdGhpcy5fPCU9bk5hbWUoZWEpJT5fY29vcCk/IiUiOiIiKSArIHYgKyAoKHRoaXMuXzwlPW5OYW1lKGVhKSU+X2Nvb3A9PSJMSUtFIiB8fCAhdGhpcy5fPCU9bk5hbWUoZWEpJT5fY29vcCk/IiUiOiIiKSArICInIjsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgPCUgfWVsc2UgaWYoZWEuSXNCb29sKXsgJT4NCiAgICAgICAgICAgICAgICBpZih0eXBlb2Yodik9PT0iYm9vbGVhbiIpew0KICAgICAgICAgICAgICAgICAgICBvYmouc3FsICs9ICInIiArICh2PyIxIjoiMCIpICsgIiciOw0KICAgICAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICA8JSB9ICU+DQogICAgICAgICAgICAgICAgaWYodiAmJiB2LkVudGl0eUNsYXNzKXsNCiAgICAgICAgICAgICAgICAgICAgb2JqLnNxbCArPSAiKCIgKyB2LjwlPW1OYW1lJT4oKSArICIpIjsNCiAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgb2JqLnNxbCArPSAiJyIgKyB2ICsgIiciOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0sDQogICAgPCUgfSk7ICU+DQogICAgPCUgYy5UeXBlZEF0dHJpYnV0ZXMuZm9yRWFjaCh0YSA9PiB7IGxldCB0YU5hbWUgPSBuTmFtZSh0YSkgKyAnXycgKyB0YS5FbnRpdHlDbGFzcy5QbHVyYWwucmVwbGFjZSgvIC9nLCAnXycpOyU+DQogICAgICAgICAgICA8JT10YU5hbWUlPjogKG9iaiwgZWFDb2RlLCB2KSA9PiB7DQogICAgICAgICAgICAgICAgaWYoIXRoaXMuXzwlPXRhTmFtZSU+X3NldCkgcmV0dXJuOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIGxldCBzcXVlcmllcyA9ICh2IHx8IFtdKS5maWx0ZXIodCA9PiB0KS5tYXAodCA9PiB0LjwlPW1OYW1lJT4oIjwlPW5OYW1lKHRhKSU+LmlkIikpOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIGxldCBqT1AgPSAnVU5JT04gQUxMJzsNCiAgICAgICAgICAgICAgICBsZXQgaW5PUCA9ICdJTic7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgb2JqLnNxbCArPSBgYDsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICBpZih0aGlzLl88JT10YU5hbWUlPl9jb29wPT0nIT0nIHx8IHRoaXMuXzwlPXRhTmFtZSU+X2Nvb3A9PSdOT1QgSU4nKXsNCiAgICAgICAgICAgICAgICAgICAgaW5PUCA9ICdOT1QgSU4nOw0KICAgICAgICAgICAgICAgIH1lbHNlIGlmKHRoaXMuXzwlPXRhTmFtZSU+X2Nvb3A9PSc9JyB8fCB0aGlzLl88JT10YU5hbWUlPl9jb29wPT0nSU4nKXsNCiAgICAgICAgICAgICAgICB9ZWxzZSBpZih0aGlzLl88JT10YU5hbWUlPl9jb29wPT0nPT0nKXsNCiAgICAgICAgICAgICAgICAgICAgak9QID0gJ0lOVEVSU0VDVCc7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIG9iai5zcWwgKz0gYGFuZCAvKjwlPXRhTmFtZSU+Ki8gJHt0UHJlZn0uJHt0aGlzLl9RKCl9JHt0aGlzLl9fY29uZmlnKCdpZEZpZWxkJywgJ0lkJyl9JHt0aGlzLl9RKCl9ICR7aW5PUH0gKGAgKyBzcXVlcmllcy5qb2luKGAgJHtqT1B9LypNMk0qLyBgKSArICcpJzsNCiAgICAgICAgICAgIH0sDQogICAgPCUgfSklPg0KICAgICAgICB9LCAiPCU9bU5hbWUlPiIsIGZpZWxkcykuc3FsOw0KDQogICAgICAgIGlmKHRoaXMuX19maWVsZEdyb3Vwcyl7DQogICAgICAgICAgICBpZihPYmplY3Qua2V5cyh0aGlzLl9fZmllbGRHcm91cHMpLmxlbmd0aCkgc3FsICs9ICIgZ3JvdXAgYnkgIjsNCiAgICA8JSBjLkVudGl0eUF0dHJpYnV0ZXMuZmlsdGVyKGVhID0+ICFlYS5FbnRpdHlNZXRob2QgJiYgIWVhLklzVGV4dCAmJiAhZWEuSXNJbWFnZSAmJiAhZWEuSXNGaWxlKS5mb3JFYWNoKGVhID0+IHsgJT4NCiAgICAgICAgICAgIGlmKHRoaXMuX19maWVsZEdyb3Vwcy48JT1uTmFtZShlYSklPikgc3FsICs9IGAke3RoaXMuX1EoKX0kezwlPV9uQ29kZShlYSklPjwlPShlYS5FbnRpdHlUeXBlPycrImlkIic6JycpJT59JHt0aGlzLl9RKCl9ICR7dGhpcy5fX2ZpZWxkR3JvdXBzLjwlPW5OYW1lKGVhKSU+fWA7DQogICAgPCUgfSklPg0KICAgICAgICB9DQoNCiAgICAgICAgaWYoc3FsLmVuZHNXaXRoKCJ3aGVyZSAxPTEiKSl7DQogICAgICAgICAgICAvLyBzcWwgPSBzcWwucmVwbGFjZSgid2hlcmUgMT0xIiwgIndoZXJlIDE9MCIpOw0KICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgIHNxbCA9IHNxbC5yZXBsYWNlKCJ3aGVyZSAxPTEgYW5kICIsICJ3aGVyZSAiKTsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgc3FsICs9ICcgcmV0dXJuICcgKyBbdFByZWZdLmNvbmNhdChPYmplY3Qua2V5cyhoZWFkZXIuam9pbnMpLm1hcChrID0+IGAke3RoaXMuX1EoKX0ke2t9JHt0aGlzLl9RKCl9YCkpLmpvaW4oJywgJyk7DQogICAgICAgIA0KICAgICAgICA8JT1sb2coKSU+c3FsKTsNCiAgICAgICAgDQogICAgICAgIHJldHVybiBzcWw7DQogICAgfQ0KDQogICAgYXN5bmMgPCU9bU5hbWU9J19uZW80aiclPihjcWwpew0KICAgIDwlIGlmKG1haW5DbGFzcyhbJ05lbzRqJ10pPT1jKXslPg0KICAgICAgICBsZXQgc2Vzc2lvbiA9IG51bGw7DQogICAgICAgIGxldCByZXQgPSBbXTsNCiAgICAgICAgdHJ5ew0KICAgICAgICAgICAgaWYoIXRoaXMuVG9vbC5kYiB8fCAhY3FsIHx8ICFjcWwudHJpbSgpKXsNCiAgICAgICAgICAgICAgICBpZighdGhpcy5Ub29sLmRiKSA8JT1sb2coKSU+Y3FsLCAiIDw9PVNLSVBQRUQ9PT4iKTsNCiAgICAgICAgICAgICAgICByZXR1cm4gW107DQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZihjcWwuaW5kZXhPZignO1xuJyk+MCl7DQogICAgICAgICAgICAgICAgZm9yIGF3YWl0IChjb25zdCBzcWxTIG9mIGNxbC5zcGxpdCgnO1xuJykpew0KICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLjwlPW1OYW1lJT4oc3FsUy50cmltKCkpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIGxldCBiU3RvcmUgPSBbIk1FUkdFIiwgIkNSRUFURSIsICJVUERBVEUiXS5maWx0ZXIobiA9PiBjcWwuaW5kZXhPZihuKT49MCkuZmluZChuID0+IG4pOw0KICAgICAgICAgICAgbGV0IGJETUwgPSBbIkNPTlNUUkFJTlQiXS5maWx0ZXIobiA9PiBjcWwuaW5kZXhPZihuKT49MCkuZmluZChuID0+IG4pOw0KDQogICAgICAgICAgICBpZihiRE1MKXsNCiAgICAgICAgICAgICAgICB0aGlzLlRvb2wuZG1sQ2FjaGUgPSB0aGlzLlRvb2wuZG1sQ2FjaGUgfHwge307DQogICAgICAgICAgICAgICAgaWYodGhpcy5Ub29sLmRtbENhY2hlW3RoaXMuaGFzaENvZGUoY3FsKV0pIHJldHVybjsNCiAgICAgICAgICAgICAgICB0aGlzLlRvb2wuZG1sQ2FjaGVbdGhpcy5oYXNoQ29kZShjcWwpXSA9IGNxbDsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgc2Vzc2lvbiA9IHRoaXMuVG9vbC5kYi5zZXNzaW9uKHsgZGF0YWJhc2U6IHRoaXMuX19jb25maWcoJ2RhdGFiYXNlJykgfSk7DQogICAgICAgICAgICBsZXQgZnVuID0gJ1JlYWQnOw0KICAgICAgICAgICAgaWYoYlN0b3JlIHx8IGJETUwpIGZ1biA9ICdXcml0ZSc7DQogICAgICAgICAgICBpZihmdW49PSdXcml0ZScpIHRoaXMuVG9vbC5fX2RtbFN0YXRlbWVudHMucHVzaChjcWwpOw0KICAgICAgICAgICAgPCU9bG9nKCklPmNxbCk7DQogICAgICAgICAgICAvL3JldCA9IChhd2FpdCBzZXNzaW9uWydleGVjdXRlJytmdW5dKHR4ID0+IHR4LnJ1bihjcWwpKSkucmVjb3JkczsNCiAgICAgICAgICAgIC8vPCU9bG9nKCklPnJldCk7DQogICAgICAgIH1jYXRjaChleCl7DQogICAgICAgICAgICA8JT1lcnJvcigpJT5leCk7DQogICAgICAgIH0NCiAgICAgICAgaWYoc2Vzc2lvbikgYXdhaXQgc2Vzc2lvbi5jbG9zZSgpOw0KICAgICAgICByZXR1cm4gcmV0Ow0KICAgIDwlIH1lbHNleyU+DQogICAgICAgIHJldHVybiBhd2FpdCBuZXcgPCU9c2NvcGUlPi48JT1uTmFtZShtYWluQ2xhc3MoWydOZW80aiddKSklPigpLjwlPW1OYW1lJT4oY3FsKTsNCiAgICA8JSB9JT4NCiAgICB9DQo8JSB9JT4NCg0KPCUgaWYobWFpbkNsYXNzKFsnUnhEQicsICdNb25nb0RCJ10pKXslPg0KICAgIDwlPW1OYW1lPSdfdG9KU09OU2NoZW1hJyU+KCl7DQogICAgICAgIHRyeXsNCiAgICAgICAgICAgIGxldCB0eXBlID0gdGhpcy5fX2NvbmZpZygnanNvbi50eXBlJywgJ3R5cGUnKTsNCiAgICAgICAgICAgIGxldCBzY2hlbWEgPSB7DQogICAgICAgICAgICAgICAgJGlkOiAnPCU9Yy5JZCU+JywNCiAgICAgICAgICAgICAgICAkc2NoZW1hOiAiaHR0cHM6Ly9qc29uLXNjaGVtYS5vcmcvZHJhZnQvMjAyMC0xMi9zY2hlbWEiLA0KICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAnPCU9Yy5SZW1hcmslPicsDQogICAgICAgICAgICAgICAgdGl0bGU6IDwlPV9uQ29kZSgpJT4sDQogICAgICAgICAgICAgICAgW3R5cGVdOiAnb2JqZWN0JywNCiAgICAgICAgICAgICAgICB2ZXJzaW9uOiAwLA0KICAgICAgICAgICAgICAgIHByb3BlcnRpZXM6IHsNCiAgICAgICAgPCUgYy5FbnRpdHlBdHRyaWJ1dGVzLmZpbHRlcihlYSA9PiAhZWEuRW50aXR5TWV0aG9kKS5mb3JFYWNoKGVhID0+IHslPg0KICAgICAgICAgICAgICAgICAgICBbPCU9X25Db2RlKGVhKSU+XTogew0KICAgICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246ICI8JT1lYS5SZW1hcmslPiIsDQogICAgICAgICAgICA8JSBpZihlYS5Jc0FycmF5KXslPg0KICAgICAgICAgICAgICAgICAgICAgICAgW3R5cGVdOiB0aGlzLl9fY29uZmlnKCdqc29uLnR5cGUuYXJyYXknLCAnYXJyYXknKSwNCiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1zOiB7DQogICAgICAgICAgICA8JSB9JT4NCiAgICAgICAgICAgIDwlIGlmKGVhLkVudGl0eVR5cGUpeyU+DQogICAgICAgICAgICAgICAgICAgICAgICAkcmVmOiAnPCU9ZWEuRW50aXR5Q2xhc3MuSWQlPicsDQogICAgICAgICAgICA8JSB9ZWxzZSBpZihlYS5Jc1N0cmluZyl7JT4NCiAgICAgICAgICAgICAgICAgICAgICAgIFt0eXBlXTogdGhpcy5fX2NvbmZpZygnanNvbi50eXBlLnN0cmluZycsICdzdHJpbmcnKSwNCiAgICAgICAgICAgIDwlIH1lbHNlIGlmKGVhLklzVGV4dCl7JT4NCiAgICAgICAgICAgICAgICAgICAgICAgIFt0eXBlXTogdGhpcy5fX2NvbmZpZygnanNvbi50eXBlLnRleHQnLCAnc3RyaW5nJyksDQogICAgICAgICAgICA8JSB9ZWxzZSBpZihlYS5Jc0Jvb2wpeyU+DQogICAgICAgICAgICAgICAgICAgICAgICBbdHlwZV06IHRoaXMuX19jb25maWcoJ2pzb24udHlwZS5ib29sJywgJ2Jvb2xlYW4nKSwNCiAgICAgICAgICAgIDwlIH1lbHNlIGlmKGVhLklzSW50KXslPg0KICAgICAgICAgICAgICAgICAgICAgICAgW3R5cGVdOiB0aGlzLl9fY29uZmlnKCdqc29uLnR5cGUuaW50JywgJ2ludGVnZXInKSwNCiAgICAgICAgICAgIDwlIH1lbHNlIGlmKGVhLklzRmxvYXQpeyU+DQogICAgICAgICAgICAgICAgICAgICAgICBbdHlwZV06IHRoaXMuX19jb25maWcoJ2pzb24udHlwZS5mbG9hdCcsICdudW1iZXInKSwNCiAgICAgICAgICAgIDwlIH1lbHNlIGlmKGVhLklzSW1hZ2UpeyU+DQogICAgICAgICAgICAgICAgICAgICAgICBbdHlwZV06IHRoaXMuX19jb25maWcoJ2pzb24udHlwZS5pbWFnZScsICdvYmplY3QnKSwNCiAgICAgICAgICAgIDwlIH1lbHNlIGlmKGVhLklzRmlsZSl7JT4NCiAgICAgICAgICAgICAgICAgICAgICAgIFt0eXBlXTogdGhpcy5fX2NvbmZpZygnanNvbi50eXBlLmZpbGUnLCAnb2JqZWN0JyksDQogICAgICAgICAgICA8JSB9JT4NCiAgICAgICAgICAgIDwlIGlmKGVhLklzQXJyYXkpeyU+DQogICAgICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgPCUgfSU+DQogICAgICAgICAgICAgICAgICAgIH0sDQogICAgICAgIDwlIH0pJT4NCiAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgIHJlcXVpcmVkOiBbPCVjLkVudGl0eUF0dHJpYnV0ZXMuZmlsdGVyKGVhID0+ICFlYS5FbnRpdHlNZXRob2QgJiYgZWEuUmVxdWlyZWQpLm1hcChlYSA9PiB7JT48JT1fbkNvZGUoZWEpJT48JX0pLmpvaW4oJywnKSU+XSwNCiAgICAgICAgICAgIH07DQoNCiAgICAgICAgICAgIDwlPWxvZygpJT5zY2hlbWEpOw0KICAgICAgICAgICAgcmV0dXJuIHNjaGVtYTsNCiAgICAgICAgfWNhdGNoKGV4KXsNCiAgICAgICAgICAgIDwlPWVycm9yKCklPmV4KTsNCiAgICAgICAgfQ0KICAgIH0NCjwlIH0lPg0KDQo8JSBpZihtYWluQ2xhc3MoWydNb25nb0RCJywgJ1J4REInLCAnWmFuZ29EQiddKSl7JT4NCiAgICA8JT1tTmFtZT0nX3RvU2VsZWN0TWRiJyU+KCl7DQogICAgICAgIHJldHVybiB0aGlzLl9fZXhwb3J0KHt9LCB7DQogICAgICAgICAgICBfVEhJUzogb2JqID0+IG9iai5faWQgPSB7JGluOiB0aGlzLl9USElTLm1hcCh0ID0+IHQuPCU9bU5hbWUlPigpKX0sDQogICAgICAgICAgICBJZDogb2JqID0+IG9iai5faWQgPSB0aGlzLklkLA0KICAgIDwlIGMuRW50aXR5QXR0cmlidXRlcy5maWx0ZXIoZWEgPT4gIWVhLkVudGl0eU1ldGhvZCAmJiAhZWEuSXNUZXh0ICYmICFlYS5Jc0ltYWdlICYmICFlYS5Jc0ZpbGUpLmZvckVhY2goZWEgPT4geyAlPg0KICAgICAgICAgICAgPCU9bk5hbWUoZWEpJT46IChvYmosIGVhQ29kZSwgdikgPT4gew0KICAgICAgICA8JSBpZihlYS5FbnRpdHlUeXBlKXslPg0KICAgICAgICAgICAgICAgIGlmKCF2LjwlPW1OYW1lJT4pIHJldHVybjsNCiAgICAgICAgPCUgfSU+DQogICAgICAgICAgICAgICAgb2JqW2VhQ29kZV0gPSB7fTsNCiAgICAgICAgICAgICAgICBsZXQgb3AgPSAiJGUiOw0KICAgICAgICAgICAgICAgIHN3aXRjaCh0aGlzLl88JT1uTmFtZShlYSklPl9jb29wKXsNCiAgICAgICAgICAgICAgICAgICAgY2FzZSAiPSI6DQogICAgICAgICAgICAgICAgICAgICAgICBvcCA9ICIkZSI7DQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgY2FzZSAiPiI6DQogICAgICAgICAgICAgICAgICAgICAgICBvcCA9ICIkZ3QiOw0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgICAgIGNhc2UgIjwiOg0KICAgICAgICAgICAgICAgICAgICAgICAgb3AgPSAiJGx0IjsNCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICBjYXNlICI+PSI6DQogICAgICAgICAgICAgICAgICAgICAgICBvcCA9ICIkZ3RlIjsNCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICBjYXNlICI8PSI6DQogICAgICAgICAgICAgICAgICAgICAgICBvcCA9ICIkbHRlIjsNCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICBjYXNlICIhPSI6DQogICAgICAgICAgICAgICAgICAgICAgICBvcCA9ICIkbmUiOw0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgICAgIGNhc2UgIklOIjoNCiAgICAgICAgICAgICAgICAgICAgICAgIG9wID0gIiRpbiI7DQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoNCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgPCUgaWYoZWEuSXNEYXRlKXsgJT4NCiAgICAgICAgICAgICAgICBvYmpbZWFDb2RlXVtvcF0gPSB2LjwlPW1OYW1lJT4oKS50b0lTT1N0cmluZygpOw0KICAgICAgICA8JSB9ZWxzZSBpZihlYS5FbnRpdHlUeXBlKXslPg0KICAgICAgICAgICAgICAgIG9ialtlYUNvZGVdID0gdi48JT1tTmFtZSU+KCk7DQogICAgICAgIDwlIH1lbHNleyU+DQogICAgICAgICAgICAgICAgb2JqW2VhQ29kZV0gPSB2Ow0KICAgICAgICA8JSB9ICU+DQogICAgICAgICAgICB9LA0KICAgIDwlIH0pOyAlPg0KICAgIDwlIGMuVHlwZWRBdHRyaWJ1dGVzLmZvckVhY2godGEgPT4geyBsZXQgdGFOYW1lID0gbk5hbWUodGEpICsgJ18nICsgdGEuRW50aXR5Q2xhc3MuUGx1cmFsLnJlcGxhY2UoLyAvZywgJ18nKTslPg0KICAgICAgICAgICAgPCU9dGFOYW1lJT46IChvYmosIGVhQ29kZSwgdikgPT4gb2JqW2VhQ29kZV0gPSB7JGluOiB2Lm1hcCh0ID0+IHQuPCU9bU5hbWUlPigpKX0sDQogICAgPCUgfSklPg0KICAgICAgICB9LCAiPCU9bU5hbWUlPiIpOw0KICAgIH0NCjwlIH0lPg0KDQo8JSBpZihtYWluQ2xhc3MoX3NxbFRvb2xzKSl7JT4NCiAgICA8JT1tTmFtZT0nX3RvREJPYmplY3QnJT4oZmllbGRzLCBiTm9SZWYpew0KICAgICAgICBpZighdGhpcy5JZCl7DQogICAgICAgICAgICA8JT1lcnJvcigpJT4iSW52YWxpZCBJRCIsIHRoaXMuRW50aXR5Q2xhc3MuTmFtZSwgdGhpcy5Ub29sKTsNCiAgICAgICAgfQ0KICAgICAgICBsZXQgcmV0ID0gew0KICAgICAgICAgICAgW3RoaXMuX19jb25maWcoJ2lkRmllbGQnLCAnSWQnKV06ICInIiArIHRoaXMuSWQgKyAiJyINCiAgICAgICAgfTsNCiAgICA8JSBjLkVudGl0eUF0dHJpYnV0ZXMuZmlsdGVyKGVhID0+ICFlYS5FbnRpdHlNZXRob2QpLmZvckVhY2goZWEgPT4geyAlPg0KICAgICAgICBpZigoKGZpZWxkcyAmJiBmaWVsZHMuaW5kZXhPZigiPCU9ZWEuTmFtZSU+IikpIHx8ICFmaWVsZHMpICYmIHRoaXMuXzwlPW5OYW1lKGVhKSU+X3NldCAmJiAoIWJOb1JlZiB8fCA8JT1lYS5FbnRpdHlUeXBlPydmYWxzZSc6J3RydWUnJT4pKXsNCiAgICAgICAgICAgIGxldCBmVmFsdWUgPSBudWxsOw0KICAgICAgICAgICAgbGV0IHYgPSB0aGlzLjwlPW5OYW1lKGVhKSU+KCk7DQogICAgICAgIDwlIGlmKGVhLkVudGl0eVR5cGUpeyU+DQogICAgICAgICAgICBpZih2ICYmICh2Ll9fc3luY19vbigpIHx8IHYuSWQ9PXYuSWQpKXsNCiAgICAgICAgICAgICAgICBmVmFsdWUgPSAiJyIgKyB2LklkICsgIiciOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgZlZhbHVlID0gIk5VTEwiOw0KICAgICAgICAgICAgfQ0KICAgICAgICA8JSB9ZWxzZSBpZihlYS5Jc0Jvb2wpeyU+DQogICAgICAgICAgICBmVmFsdWUgPSB2PzE6MDsNCiAgICAgICAgICAgIGlmKHRoaXMuVG9vbC50eXBlLm5hbWU9PSdOZW80aicpIGZWYWx1ZSA9IGZWYWx1ZT8nVHJ1ZSc6J0ZhbHNlJzsNCiAgICAgICAgICAgIGlmKHRoaXMuVG9vbC50eXBlLm5hbWU9PSdTcWxEQicpIGZWYWx1ZSA9ICInIiArIGZWYWx1ZSArICInIjsNCiAgICAgICAgPCUgfWVsc2UgaWYoZWEuSXNJbnQgfHwgZWEuSXNMb25nIHx8IGVhLklzRmxvYXQpeyU+DQogICAgICAgICAgICBmVmFsdWUgPSB2IHx8ICcwJzsNCiAgICAgICAgPCUgfWVsc2UgaWYoZWEuSXNEYXRlKXslPg0KICAgICAgICAgICAgdHJ5ew0KICAgICAgICAgICAgICAgIGZWYWx1ZSA9ICInIiArICh2P3YudG9JU09TdHJpbmcoKToiMTk3MC0xLTEiKSArICInIjsNCiAgICAgICAgICAgICAgICBpZih0aGlzLl9fY29uZmlnKCd0eXBlJyk9PSdteXNxbCcpew0KICAgICAgICAgICAgICAgICAgICBmVmFsdWUgPSBgU1RSX1RPX0RBVEUoJHtmVmFsdWV9LCAnJVktJW0tJWRUJVQuJWZaJylgOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH1jYXRjaChleCl7DQogICAgICAgICAgICAgICAgZlZhbHVlID0gIiciICsgdiArICInIjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmKHRoaXMuVG9vbC50eXBlLm5hbWU9PSdOZW80aicpIGZWYWx1ZSA9ICdkYXRldGltZSgnICsgZlZhbHVlICsgJyknOw0KICAgICAgICA8JSB9ZWxzZSBpZihlYS5Jc09iamVjdCl7JT4NCiAgICAgICAgICAgIGZWYWx1ZSA9ICInIiArIEpTT04uc3RyaW5naWZ5KHYsIG51bGwsICdcdCcpICsgIiciOw0KICAgICAgICA8JSB9ZWxzZSBpZihlYS5Jc1N0cmluZyl7JT4NCiAgICAgICAgICAgIGZWYWx1ZSA9IHY9PT1udWxsPyJOVUxMIjooIiciICsgKChmYWxzZSAmJiB2ICYmIHYucmVwbGFjZSk/di5yZXBsYWNlKC9cXG4vZywgIlxcXFxuIikNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLnJlcGxhY2UoL1xcJy9nLCAiXFxcXCciKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAucmVwbGFjZSgvXFwiL2csICdcXFxcIicpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKC9cXCYvZywgIlxcXFwmIikNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLnJlcGxhY2UoL1xcci9nLCAiXFxcXHIiKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAucmVwbGFjZSgvXFx0L2csICJcXFxcdCIpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKC9cXGIvZywgIlxcXFxiIikNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLnJlcGxhY2UoL1xcZi9nLCAiXFxcXGYiKSAgOnYpICsgIiciKTsNCiAgICAgICAgPCUgfWVsc2UgaWYoZWEuSXNUZXh0KXslPg0KICAgICAgICAgICAgaWYodj09PW51bGwpew0KICAgICAgICAgICAgICAgIGZWYWx1ZSA9ICJOVUxMIjsNCiAgICAgICAgICAgIH1lbHNlIGlmKHRoaXMuVG9vbC50eXBlLm5hbWU9PSdTcWxEQicpew0KICAgICAgICAgICAgICAgIGlmKHRoaXMuX19jb25maWcoJ3R5cGUnKT09J215c3FsJyl7DQogICAgICAgICAgICAgICAgICAgIGZWYWx1ZSA9IGBGUk9NX0JBU0U2NCgnJHt0aGlzLl9idG9hKHYpfScpYDsNCiAgICAgICAgICAgICAgICB9ZWxzZSBpZih0aGlzLl9fY29uZmlnKCd0eXBlJyk9PSdzcWxpdGUnKXsNCiAgICAgICAgICAgICAgICAgICAgZlZhbHVlID0gYGNhc3QodW5oZXgoJyR7di5zcGxpdCgiIikubWFwKHggPT4gKDI1NiArIHguY2hhckNvZGVBdCgpKS50b1N0cmluZygxNikuc3Vic3RyKC0yKSkuam9pbigiIil9JykgYXMgdmFyY2hhcilgOw0KICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICBmVmFsdWUgPSB2Ow0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIGZWYWx1ZSA9ICInIiArIHYgKyAiJyI7DQogICAgICAgICAgICB9DQogICAgICAgIDwlIH1lbHNleyAlPg0KICAgICAgICAgICAgZlZhbHVlID0gIiciICsgdiArICInIjsNCiAgICAgICAgPCUgfSAlPg0KICAgICAgICAgICAgDQogICAgICAgICAgICByZXRbPCU9X25Db2RlKGVhKSU+ICsgIjwlPShlYS5FbnRpdHlUeXBlPydpZCc6JycpJT4iXSA9IGZWYWx1ZTsNCiAgICAgICAgfQ0KICAgIDwlIH0pOyAlPg0KICAgIA0KICAgICAgICA8JT1sb2coKSU+cmV0KTsNCiAgICAgICAgcmV0dXJuIHJldDsNCiAgICB9DQo8JSB9JT4NCg0KPCUgaWYobWFpbkNsYXNzKFsnQklTZXJ2ZXInXSkpeyU+DQogICAgYXN5bmMgPCU9bU5hbWU9J2dldCclPihuYW1lKSB7DQogICAgICAgIGlmICghdGhpcy5JZCkgcmV0dXJuIG51bGw7DQogICAgICAgIHZhciB0ID0gbnVsbDsNCiAgICAgICAgJC5lYWNoKG5hbWUuc3BsaXQoJy4nKSwgKF8sIGYpID0+IHsNCiAgICAgICAgICAgIHQgPSB7DQogICAgICAgICAgICAgICAgRW50aXR5T2JqZWN0OiB0ID8gew0KICAgICAgICAgICAgICAgICAgICBBY3RpdmU6IHRydWUsDQogICAgICAgICAgICAgICAgICAgIFZhbHVlRW50aXRpZXM6IFt0XQ0KICAgICAgICAgICAgICAgIH0gOiB7DQogICAgICAgICAgICAgICAgICAgIEFjdGl2ZTogdHJ1ZSwNCiAgICAgICAgICAgICAgICAgICAgSWQ6IHRoaXMuSWQNCiAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgIEVudGl0eUF0dHJpYnV0ZTogew0KICAgICAgICAgICAgICAgICAgICBOYW1lOiBmLA0KICAgICAgICAgICAgICAgICAgICBPUEVSQVRPUlM6IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIE5hbWU6ICI9Ig0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfTsNCiAgICAgICAgfSk7DQogICAgICAgIHJldHVybiAkLndoZW4odGhpcy5zcigpLl8oIkVudGVycHJpc2VNYW5hZ2VyLmVtc0VudGl0eVZhbHVlRmluZCIsIG51bGwsIHQpKS50aGVuKGV2ID0+IHsNCiAgICAgICAgICAgIDwlPWxvZygpJT5ldik7DQogICAgICAgICAgICBpZiAoZXYgPT09IG51bGwpIHJldHVybiBudWxsOw0KICAgICAgICAgICAgaWYgKGV2LkVudGl0eUF0dHJpYnV0ZS5Jc1N0cmluZykgcmV0dXJuIGV2LlN0cmluZ1ZhbHVlOw0KICAgICAgICAgICAgaWYgKGV2LkVudGl0eUF0dHJpYnV0ZS5Jc0Zsb2F0KSByZXR1cm4gZXYuRmxvYXRWYWx1ZTsNCiAgICAgICAgICAgIGlmIChldi5FbnRpdHlBdHRyaWJ1dGUuSXNJbnQpIHJldHVybiBldi5JbnRWYWx1ZTsNCiAgICAgICAgICAgIGlmIChldi5FbnRpdHlBdHRyaWJ1dGUuSXNMb25nKSByZXR1cm4gZXYuTG9uZ1ZhbHVlOw0KICAgICAgICAgICAgaWYgKGV2LkVudGl0eUF0dHJpYnV0ZS5Jc1RleHQpIHJldHVybiBldi5UZXh0VmFsdWU7DQogICAgICAgICAgICBpZiAoZXYuRW50aXR5QXR0cmlidXRlLklzQm9vbCkgcmV0dXJuIGV2LkJvb2xWYWx1ZTsNCg0KICAgICAgICAgICAgaWYgKCFldi5PYmplY3RWYWx1ZSkgcmV0dXJuIG51bGw7DQoNCiAgICAgICAgICAgIHJldHVybiBuZXcgPCU9c2NvcGUlPlskLmdyZXAoPCU9c2NvcGUlPi5FbnRpdHlDbGFzc2VzLCBjID0+IGMuSWQgPT0gZXYuRW50aXR5QXR0cmlidXRlLkVudGl0eVR5cGVpZClbMF0uTmFtZS5yZXBsYWNlKC8gL2csICdfJyldKGV2Lk9iamVjdFZhbHVlLklkKTsNCiAgICAgICAgfSk7DQogICAgfQ0KPCUgfSU+DQoNCjwlIGlmKG1haW5DbGFzcyhfc3FsVG9vbHMpKXslPg0KICAgIDwlPW1OYW1lPSdfUSclPigpew0KICAgICAgICBsZXQgX28gPSAnIic7DQogICAgICAgIGxldCBfcSA9IF9vOw0KDQogICAgICAgIGlmKFsnU2FsZXNGb3JjZSddLmluZGV4T2YodGhpcy5Ub29sLnR5cGUubmFtZSk9PTApew0KICAgICAgICAgICAgX28gPSBfcSA9ICIiOw0KICAgICAgICB9ZWxzZSBpZih0aGlzLl9fY29uZmlnKCd0eXBlJyk9PSdteXNxbCcgfHwgdGhpcy5Ub29sLnR5cGUubmFtZT09J05lbzRqJyl7DQogICAgICAgICAgICBfbyA9IF9xID0gJ2AnOw0KICAgICAgICB9ZWxzZSBpZihbJ1NhbGVzRm9yY2UnXS5pbmRleE9mKHRoaXMuVG9vbC50eXBlLm5hbWUpPT0wKXsNCiAgICAgICAgICAgIF9vID0gX3EgPSBgJ2A7DQogICAgICAgIH1lbHNlIGlmKHRoaXMuX19jb25maWcoJ3R5cGUnKT09J3NxbHNlcnZlcicpew0KICAgICAgICAgICAgX28gPSAnWyc7DQogICAgICAgICAgICBfcSA9ICddJzsNCiAgICAgICAgfWVsc2UgaWYodGhpcy5fX2NvbmZpZygnYXBpS2V5Jyk9PSdhaXJ0YWJsZScpew0KICAgICAgICAgICAgX28gPSAneyc7DQogICAgICAgICAgICBfcSA9ICd9JzsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gX28/X3E6X287DQogICAgfQ0KICAgIA0KICAgIDwlPW1OYW1lPSdfZmllbGRHcm91cHMnJT4oZmdzID0ge30pew0KICAgICAgICB0aGlzLl9fZmllbGRHcm91cHMgPSBmZ3M7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgIH0NCiAgICANCiAgICA8JT1tTmFtZT0nX2ZpZWxkQWdncmVnYXRlcyclPihmYXMgPSB7fSl7DQogICAgICAgIHRoaXMuX19maWVsZEFnZ3JlZ2F0ZXMgPSBmYXM7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgIH0NCiAgICANCiAgICA8JT1tTmFtZT0nX3RvRmllbGRzU1FMJyU+KGZpZWxkcyl7DQogICAgICAgIA0KICAgICAgICBmaWVsZHMgPSBmaWVsZHMgfHwgW3RoaXMuX19jb25maWcoJ2lkRmllbGQnLCAnSWQnKSwgPCU9Yy5FbnRpdHlBdHRyaWJ1dGVzLmZpbHRlcihlYSA9PiAhZWEuRW50aXR5TWV0aG9kKS5tYXAoZWEgPT4gX25Db2RlKGVhKSArIChlYS5FbnRpdHlUeXBlPycrIi5pZCInOicnKSkuam9pbignLCcpJT5dOw0KICAgICAgICBmaWVsZHMgPSBBcnJheS5pc0FycmF5KGZpZWxkcyk/ZmllbGRzOltmaWVsZHNdOw0KDQogICAgICAgIGlmKHRoaXMuX19maWVsZEdyb3Vwcyl7DQogICAgICAgICAgICAvLyB7ZmllbGQ6IG9yZGVyfQ0KICAgICAgICAgICAgZmllbGRzID0gW107DQogICAgPCUgYy5FbnRpdHlBdHRyaWJ1dGVzLmZpbHRlcihlYSA9PiAhZWEuRW50aXR5TWV0aG9kICYmICFlYS5Jc1RleHQgJiYgIWVhLklzSW1hZ2UgJiYgIWVhLklzRmlsZSkuZm9yRWFjaChlYSA9PiB7ICU+DQogICAgICAgICAgICBpZih0aGlzLl9fZmllbGRHcm91cHMuPCU9bk5hbWUoZWEpJT4pIGZpZWxkcy5wdXNoKGAkezwlPV9uQ29kZShlYSklPjwlPShlYS5FbnRpdHlUeXBlPycrImlkIic6JycpJT59YCk7DQogICAgPCUgfSklPg0KICAgICAgICB9DQogICAgICAgIHJldHVybiBmaWVsZHM7DQogICAgfQ0KICAgIA0KICAgIDwlPW1OYW1lPSdfZnJvbURCT2JqZWN0JyU+KHI9e30pew0KICAgICAgICB0cnl7DQogICAgICAgICAgICByZXR1cm4gdGhpcy5fX2ltcG9ydChyLCB7DQogICAgICAgICAgICAgICAgSWQ6IG9iaiA9PiB0aGlzLklkID0gb2JqW3RoaXMuX19jb25maWcoJ2lkRmllbGQnLCAnSWQnKV0sDQogICAgPCUgYy5FbnRpdHlBdHRyaWJ1dGVzLmZpbHRlcihlYSA9PiAhZWEuRW50aXR5TWV0aG9kKS5mb3JFYWNoKGVhID0+IHsgJT4NCiAgICAgICAgICAgICAgICA8JT1uTmFtZShlYSklPjogKG9iaiwgZWFDb2RlKSA9PiB7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuPCU9bk5hbWUoZWEpJT4ob2JqW2VhQ29kZV0pOw0KICAgICAgICAgICAgICAgIH0sDQogICAgPCUgfSklPg0KICAgICAgICAgICAgfSwgIjwlPW1OYW1lJT4iKTsNCiAgICAgICAgfWNhdGNoKGV4KXsNCiAgICAgICAgICAgIDwlPWVycm9yKCklPmV4KTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICANCiAgICA8JT1tTmFtZT0nX3RvU2VsZWN0SGVhZGVyJyU+KGZpZWxkcyl7DQogICAgICAgIHRyeXsNCiAgICAgICAgICAgIGxldCByZXQgPSB7DQogICAgICAgICAgICAgICAgdGFibGU6IDwlPV9uQ29kZSgpJT4sDQogICAgICAgICAgICAgICAgZmllbGRzOiBEb3RPYmplY3Qub2JqZWN0KE9iamVjdC5mcm9tRW50cmllcyh0aGlzLl90b0ZpZWxkc1NRTChmaWVsZHMpLm1hcChmID0+IHRoaXMuX1EoKSArIGYucmVwbGFjZSgvXC4vZywgJycpICsgdGhpcy5fUSgpKS5tYXAoZiA9PiBbZiwgZl0pKSksDQogICAgICAgICAgICAgICAgam9pbnM6IHt9LA0KICAgICAgICAgICAgfTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgaWYoZmllbGRzKSByZXR1cm4gcmV0Ow0KICAgICAgICAgICAgDQogICAgICAgICAgICByZXQuam9pbnMgPSB0aGlzLl9fZXhwb3J0KHt9LCB7DQogICAgICAgICAgICAgICAgTnVsbDogdHJ1ZSwNCiAgICA8JSBjLkVudGl0eUF0dHJpYnV0ZXMuZmlsdGVyKGVhID0+ICFlYS5FbnRpdHlNZXRob2QgJiYgZWEuRW50aXR5VHlwZSkuZm9yRWFjaChlYSA9PiB7JT4NCiAgICAgICAgICAgICAgICA8JT1uTmFtZShlYSklPjogKG9iaiwgZWFDb2RlLCB2KSA9PiBvYmpbZWFDb2RlXSA9IG5ldyA8JT1zY29wZSU+LjwlPV9jTmFtZShlYS5FbnRpdHlUeXBlLCB0cnVlKSU+KCkuPCU9bU5hbWUlPigpLA0KICAgIDwlIH0pJT4NCiAgICAgICAgICAgIH0sICI8JT1tTmFtZSU+Iik7DQogICAgICAgICAgICANCiAgICAgICAgICAgIDwlPWxvZygpJT5yZXQpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICByZXR1cm4gcmV0Ow0KICAgICAgICB9Y2F0Y2goZXgpew0KICAgICAgICAgICAgPCU9ZXJyb3IoKSU+ZXgpOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgPCU9bU5hbWU9J190b1NlbGVjdFNRTCclPihmaWVsZHMpew0KICAgICAgICB0cnl7DQogICAgICAgICAgICBsZXQgc3FsID0gInNlbGVjdCAiOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBsZXQgdFByZWYgPSBgJHt0aGlzLl9RKCl9JHs8JT1fbkNvZGUoKSU+fSR7dGhpcy5fUSgpfWA7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGxldCBoZWFkZXIgPSB0aGlzLl90b1NlbGVjdEhlYWRlcihmaWVsZHMpOw0KDQogICAgICAgICAgICBzcWwgKz0gT2JqZWN0LnZhbHVlcyhoZWFkZXIuZmllbGRzKS5tYXAoZiA9PiBgJHt0UHJlZn0uJHtmfWApLmpvaW4oJywgJyk7DQogICAgICAgICAgICBPYmplY3Qua2V5cyhoZWFkZXIuam9pbnMpLmZvckVhY2goayA9PiBzcWwgKz0gIiwgIiArIE9iamVjdC52YWx1ZXMoaGVhZGVyLmpvaW5zW2tdLmZpZWxkcykubWFwKGYgPT4gYCR7dGhpcy5fUSgpfSR7aGVhZGVyLmpvaW5zW2tdLnRhYmxlfV8ke2t9JHt0aGlzLl9RKCl9LiR7Zn0gYXMgJHt0aGlzLl9RKCl9JHtrfS4ke2YucmVwbGFjZSh0aGlzLl9RKCksICcnKX1gKS5qb2luKCcsICcpKTsNCiAgICANCiAgICAgICAgICAgIGlmKHRoaXMuX19maWVsZEFnZ3JlZ2F0ZXMpew0KICAgICAgICAgICAgICAgIC8vIHtmaWVsZDogZnVuY3Rpb259DQogICAgPCUgYy5FbnRpdHlBdHRyaWJ1dGVzLmZpbHRlcihlYSA9PiAhZWEuRW50aXR5TWV0aG9kICYmICFlYS5Jc1RleHQgJiYgIWVhLklzSW1hZ2UgJiYgIWVhLklzRmlsZSkuZm9yRWFjaChlYSA9PiB7ICU+DQogICAgICAgICAgICAgICAgaWYodGhpcy5fX2ZpZWxkQWdncmVnYXRlcy48JT1uTmFtZShlYSklPikgc3FsICs9IGAke3NxbD09KCdzZWxlY3QgJyk/Jyc6JywnfSAke3RoaXMuX19maWVsZEFnZ3JlZ2F0ZXMuPCU9bk5hbWUoZWEpJT59KCR7dGhpcy5fUSgpfSR7PCU9X25Db2RlKGVhKSU+fSR7dGhpcy5fUSgpfSlgOw0KICAgIDwlIH0pJT4NCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIHNxbCArPSBgIGZyb20gJHt0UHJlZn0gYDsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgT2JqZWN0LmtleXMoaGVhZGVyLmpvaW5zKS5mb3JFYWNoKGsgPT4gc3FsICs9IGBsZWZ0IGpvaW4gJHt0aGlzLl9RKCl9JHtoZWFkZXIuam9pbnNba10udGFibGV9JHt0aGlzLl9RKCl9IGFzICR7dGhpcy5fUSgpfSR7aGVhZGVyLmpvaW5zW2tdLnRhYmxlfV8ke2t9JHt0aGlzLl9RKCl9IG9uICR7dFByZWZ9LiR7dGhpcy5fUSgpfSR7a31pZCR7dGhpcy5fUSgpfT0ke3RoaXMuX1EoKX0ke2hlYWRlci5qb2luc1trXS50YWJsZX1fJHtrfSR7dGhpcy5fUSgpfS4ke3RoaXMuX1EoKX0ke3RoaXMuX19jb25maWcoJ2lkRmllbGQnLCAnSWQnKX0ke3RoaXMuX1EoKX0gYCk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIHNxbCArPSBgIHdoZXJlIDE9MWA7DQogICAgICAgICAgICANCiAgICAgICAgICAgIHNxbCA9IHRoaXMuX19leHBvcnQoe3NxbDogc3FsfSwgew0KICAgICAgICAgICAgICAgIE51bGw6IHRydWUsDQogICAgICAgICAgICAgICAgX2ZpZWxkczogKHRoaXMuX19zeW5jX29uKCkgfHwgdGhpcy5JZD09dGhpcy5JZCk/WydJZCddOnVuZGVmaW5lZCwNCiAgICAgICAgICAgICAgICBleHBvcnRlcjogdiA9PiB7DQogICAgICAgICAgICAgICAgICAgIGlmKHYucmV1c2VkPjIpew0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gPCU9d2FybigpJT4iUmV1c2VkOiAiLCB2KTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHYub2JqLnNxbCA9IGAvKlJFU1VFRDogJHt2LnJldXNlZH0qL2A7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgIF9USElTOiBvYmogPT4gew0KICAgICAgICAgICAgICAgICAgICBpZighdGhpcy5fVEhJUyB8fCAhdGhpcy5fVEhJUy5sZW5ndGgpIHJldHVybjsNCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIG9iai5zcWwgKz0gYCAvKmFuZCAqLyR7dFByZWZ9LiR7dGhpcy5fUSgpfSR7dGhpcy5fX2NvbmZpZygnaWRGaWVsZCcsICdJZCcpfSR7dGhpcy5fUSgpfSBgICsgKHRoaXMuX1RISVNfY29vcCB8fCAiSU4iKSArICIgKCIgKyB0aGlzLl9USElTLm1hcCh0ID0+IHQuPCU9bU5hbWUlPih0Ll9fY29uZmlnKCdpZEZpZWxkJyl8fCdJZCcpLnRoaXMpLmpvaW4oJyBVTklPTiBBTEwgJykgKyAiKSI7DQogICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICBJZDogKG9iaiwgaWRDb2RlLCB2KSA9PiBvYmouc3FsICs9ICh0aGlzLklkPT10aGlzLklkKT9gIGFuZCAke3RQcmVmfS4ke3RoaXMuX1EoKX0ke3RoaXMuX19jb25maWcoJ2lkRmllbGQnLCAnSWQnKX0ke3RoaXMuX1EoKX09JyR7dGhpcy5JZH0nYDonJywNCiAgICA8JSBjLkVudGl0eUF0dHJpYnV0ZXMuZmlsdGVyKGVhID0+ICFlYS5FbnRpdHlNZXRob2QpLmZvckVhY2goZWEgPT4geyAlPg0KICAgICAgICAgICAgICAgIDwlPW5OYW1lKGVhKSU+OiAob2JqLCBlYUNvZGUsIHYpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgaWYoIXRoaXMuXzwlPW5OYW1lKGVhKSU+X3NldCkgcmV0dXJuOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICA8JSBpZihlYS5FbnRpdHlUeXBlKXslPg0KICAgICAgICAgICAgICAgIGxldCBjb29wID0gdGhpcy5fPCU9bk5hbWUoZWEpJT5fY29vcDsNCiAgICAgICAgICAgICAgICAgICAgc3dpdGNoKGNvb3Apew0KICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiIT0iOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvb3AgPSAiTk9UIElOIjsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgIj0iOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvb3AgPSAiSU4iOw0KICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiIjoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb29wID0gIklOIjsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgaWYodil7DQogICAgICAgICAgICAgICAgICAgICAgICBvYmouc3FsICs9IGAgYW5kICR7dFByZWZ9LiR7dGhpcy5fUSgpfSR7ZWFDb2RlfWlkJHt0aGlzLl9RKCl9ICR7Y29vcH0gKCR7di48JT1tTmFtZSU+KHYuX19jb25maWcoJ2lkRmllbGQnLCAnSWQnKSl9KWA7DQogICAgICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICAgICAgb2JqLnNxbCArPSBgIGFuZCAoJHt0UHJlZn0uJHt0aGlzLl9RKCl9JHtlYUNvZGV9aWQke3RoaXMuX1EoKX0gJHtjb29wfSAoMCkgT1IgJHt0UHJlZn0uJHt0aGlzLl9RKCl9JHtlYUNvZGV9aWQke3RoaXMuX1EoKX0gSVMgTlVMTClgOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgPCUgfWVsc2UgaWYoZWEuSXNUZXh0IHx8IGVhLklzSW1hZ2UgfHwgZWEuSXNGaWxlKXslPg0KICAgICAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgIDwlIH1lbHNleyU+DQogICAgICAgICAgICAgICAgICAgIG9iai5zcWwgKz0gYCBhbmQgJHt0UHJlZn0uJHt0aGlzLl9RKCl9JHtlYUNvZGV9JHt0aGlzLl9RKCl9IGAgKyA8JWlmKGVhLklzQm9vbCl7JT4iPSI8JX1lbHNleyU+KHRoaXMuXzwlPW5OYW1lKGVhKSU+X2Nvb3AgfHwgIkxJS0UiKTwlfSU+ICsgIiAiOw0KICAgICAgICA8JSB9JT4NCiAgICAgICAgDQogICAgICAgIDwlIGlmKGVhLklzRGF0ZSl7ICU+DQogICAgICAgICAgICAgICAgICAgIGlmKHYgJiYgdi50b0lTT1N0cmluZyl7DQogICAgICAgICAgICAgICAgICAgICAgICBpZih0aGlzLl9fY29uZmlnKCd0eXBlJyk9PSdzcWxpdGUnKXsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmouc3FsICs9ICJzdHJmdGltZSgnJXMnLCAnIiArIHYudG9JU09TdHJpbmcoKSArICInKSI7DQogICAgICAgICAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmouc3FsICs9ICInIiArIHYudG9JU09TdHJpbmcoKSArICInIjsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICA8JSB9ZWxzZSBpZihlYS5Jc1N0cmluZyl7ICU+DQogICAgICAgICAgICAgICAgICAgIGlmKHR5cGVvZih2KT09PSJzdHJpbmciKXsNCiAgICAgICAgICAgICAgICAgICAgICAgIG9iai5zcWwgKz0gIiciICsgKCh0aGlzLl88JT1uTmFtZShlYSklPl9jb29wPT0iTElLRSIgfHwgIXRoaXMuXzwlPW5OYW1lKGVhKSU+X2Nvb3ApPyIlIjoiIikgKyB2ICsgKCh0aGlzLl88JT1uTmFtZShlYSklPl9jb29wPT0iTElLRSIgfHwgIXRoaXMuXzwlPW5OYW1lKGVhKSU+X2Nvb3ApPyIlIjoiIikgKyAiJyI7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgPCUgfWVsc2UgaWYoZWEuSXNCb29sKXsgJT4NCiAgICAgICAgICAgICAgICAgICAgaWYodHlwZW9mKHYpPT09ImJvb2xlYW4iKXsNCiAgICAgICAgICAgICAgICAgICAgICAgIG9iai5zcWwgKz0gIiciICsgKHY/IjEiOiIwIikgKyAiJyI7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgPCUgfSAlPg0KICAgICAgICAgICAgICAgICAgICBpZih2ICYmIHYuRW50aXR5Q2xhc3Mpew0KICAgICAgICAgICAgICAgICAgICAgICAgb2JqLnNxbCArPSAiKCIgKyB2LjwlPW1OYW1lJT4oKSArICIpIjsNCiAgICAgICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgICAgICBvYmouc3FsICs9ICInIiArIHYgKyAiJyI7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9LA0KICAgIDwlIH0pOyAlPg0KICAgIDwlIGMuVHlwZWRBdHRyaWJ1dGVzLmZvckVhY2godGEgPT4geyBsZXQgdGFOYW1lID0gbk5hbWUodGEpICsgJ18nICsgdGEuRW50aXR5Q2xhc3MuUGx1cmFsLnJlcGxhY2UoLyAvZywgJ18nKTslPg0KICAgICAgICAgICAgICAgIDwlPXRhTmFtZSU+OiAob2JqLCBlYUNvZGUsIHYpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgaWYoIXRoaXMuXzwlPXRhTmFtZSU+X3NldCkgcmV0dXJuOw0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgbGV0IGpPUCA9ICdVTklPTiBBTEwnOw0KICAgICAgICAgICAgICAgICAgICBsZXQgaW5PUCA9ICdJTic7DQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBpZih0aGlzLl88JT10YU5hbWUlPl9jb29wPT0nIT0nIHx8IHRoaXMuXzwlPXRhTmFtZSU+X2Nvb3A9PSdOT1QgSU4nKXsNCiAgICAgICAgICAgICAgICAgICAgICAgIGluT1AgPSAnTk9UIElOJzsNCiAgICAgICAgICAgICAgICAgICAgfWVsc2UgaWYodGhpcy5fPCU9dGFOYW1lJT5fY29vcD09Jz0nIHx8IHRoaXMuXzwlPXRhTmFtZSU+X2Nvb3A9PSdJTicpew0KICAgICAgICAgICAgICAgICAgICB9ZWxzZSBpZih0aGlzLl88JT10YU5hbWUlPl9jb29wPT0nPT0nKXsNCiAgICAgICAgICAgICAgICAgICAgICAgIGpPUCA9ICdJTlRFUlNFQ1QnOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBvYmouc3FsICs9IGBhbmQgLyo8JT10YU5hbWUlPiovICR7dFByZWZ9LiR7dGhpcy5fUSgpfSR7dGhpcy5fX2NvbmZpZygnaWRGaWVsZCcsICdJZCcpfSR7dGhpcy5fUSgpfSAke2luT1B9IChgICsgKHYgfHwgW10pLmZpbHRlcih0ID0+IHQpLm1hcCh0ID0+IHQuPCU9bU5hbWUlPigiPCU9bk5hbWUodGEpJT4uaWQiKSkuam9pbihgICR7ak9QfS8qTTJNKi8gYCkgKyAnKSc7DQogICAgICAgICAgICAgICAgfSwNCiAgICA8JSB9KSU+DQogICAgICAgICAgICB9LCAiPCU9bU5hbWUlPiIsIGZpZWxkcykuc3FsOw0KDQogICAgICAgICAgICBpZih0aGlzLl9fZmllbGRHcm91cHMpew0KICAgICAgICAgICAgICAgIGlmKE9iamVjdC5rZXlzKHRoaXMuX19maWVsZEdyb3VwcykubGVuZ3RoKSBzcWwgKz0gIiBncm91cCBieSAiOw0KICAgIDwlIGMuRW50aXR5QXR0cmlidXRlcy5maWx0ZXIoZWEgPT4gIWVhLkVudGl0eU1ldGhvZCAmJiAhZWEuSXNUZXh0ICYmICFlYS5Jc0ltYWdlICYmICFlYS5Jc0ZpbGUpLmZvckVhY2goZWEgPT4geyAlPg0KICAgICAgICAgICAgICAgIGlmKHRoaXMuX19maWVsZEdyb3Vwcy48JT1uTmFtZShlYSklPikgc3FsICs9IGAke3RoaXMuX1EoKX0kezwlPV9uQ29kZShlYSklPjwlPShlYS5FbnRpdHlUeXBlPycrImlkIic6JycpJT59JHt0aGlzLl9RKCl9ICR7dGhpcy5fX2ZpZWxkR3JvdXBzLjwlPW5OYW1lKGVhKSU+fWA7DQogICAgPCUgfSklPg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZighc3FsLmVuZHNXaXRoKCJ3aGVyZSAxPTEiKSl7DQogICAgICAgICAgICAgICAgc3FsID0gc3FsLnJlcGxhY2UoIndoZXJlIDE9MSBhbmQgIiwgIndoZXJlICIpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICBzcWwgPSB0eXBlb2Yoc3FsRm9ybWF0dGVyKSE9PSd1bmRlZmluZWQnP3NxbEZvcm1hdHRlci5mb3JtYXQoc3FsKTpzcWw7DQogICAgICAgICAgICA8JT1sb2coKSU+c3FsKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgcmV0dXJuIHNxbDsNCiAgICAgICAgfWNhdGNoKGV4KXsNCiAgICAgICAgICAgIDwlPWVycm9yKCklPmV4KTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICANCiAgICA8JT1tTmFtZT0nX3RvUGF0aHMnJT4oKXsNCiAgICAgICAgbGV0IHJldCA9IHRoaXMuX19leHBvcnQoe30sIHsNCiAgICAgICAgICAgIF9USElTOiBvYmogPT4ge30sDQogICAgPCUgYy5FbnRpdHlBdHRyaWJ1dGVzLmZpbHRlcihlYSA9PiAhZWEuRW50aXR5TWV0aG9kICYmIGVhLkVudGl0eVR5cGUpLmZvckVhY2goZWEgPT4geyAlPg0KICAgICAgICAgICAgPCU9bk5hbWUoZWEpJT46IChvYmosIGVhQ29kZSwgdikgPT4gb2JqLjwlPW5OYW1lKGVhKSU+ID0gdi48JT1tTmFtZSU+KCksDQogICAgPCUgfSk7ICU+DQogICAgPCUgYy5UeXBlZEF0dHJpYnV0ZXMuZm9yRWFjaCh0YSA9PiB7IGxldCB0YU5hbWUgPSBuTmFtZSh0YSkgKyAnXycgKyB0YS5FbnRpdHlDbGFzcy5QbHVyYWwucmVwbGFjZSgvIC9nLCAnXycpOyU+DQogICAgICAgICAgICA8JT10YU5hbWUlPjogKG9iaiwgZWFDb2RlLCB2KSA9PiBvYmouPCU9dGFOYW1lJT4gPSB2Lm1hcChfdiA9PiBfdi48JT1tTmFtZSU+KCkpLA0KICAgIDwlIH0pJT4NCiAgICAgICAgfSwgIjwlPW1OYW1lJT4iKTsNCiAgICAgICAgLy8gcmV0dXJuIHJldDsNCiAgICAgICAgcmV0dXJuIE9iamVjdC5rZXlzKHJldCkubWFwKGsgPT4gKHtba106IHJldFtrXX0pKTsNCiAgICB9DQoNCiAgICA8JT1tTmFtZT0nX3RvVXBkYXRlU1FMJyU+KGZpZWxkcyl7DQogICAgICAgIGxldCByZXRGaWVsZHMgPSB0aGlzLl90b0ZpZWxkc1NRTChmaWVsZHMpLm1hcChmID0+IHRoaXMuX1EoKSArIGYucmVwbGFjZSgvXC4vZywgJycpICsgdGhpcy5fUSgpKS5qb2luKCcsICcpOw0KICAgICAgICBsZXQgc3FsID0gYHVwZGF0ZSAke3RoaXMuX1EoKX0kezwlPV9uQ29kZSgpJT59JHt0aGlzLl9RKCl9IHNldCBgICsgT2JqZWN0LmVudHJpZXModGhpcy5fdG9EQk9iamVjdChmaWVsZHMpKS5tYXAodiA9PiB0aGlzLl9RKCkgKyB2WzBdICsgdGhpcy5fUSgpICsgIj0iICsgdlsxXSkgKyBgIHdoZXJlICR7dGhpcy5fUSgpfSR7dGhpcy5fX2NvbmZpZygnaWRGaWVsZCcsICdJZCcpfSR7dGhpcy5fUSgpfT0nJHt0aGlzLklkfSdgOyAvL2AgcmV0dXJuaW5nICR7cmV0RmllbGRzfWA7DQogICAgICAgIDwlPWxvZygpJT5zcWwpOw0KICAgICAgICByZXR1cm4gc3FsOw0KICAgIH0NCg0KICAgIDwlPW1OYW1lPSdfdG9JbnNlcnRTUUwnJT4oZmllbGRzKXsNCiAgICAgICAgbGV0IG9iaiA9IHRoaXMuX3RvREJPYmplY3QoZmllbGRzKTsNCiAgICAgICAgbGV0IHNxbCA9IGBpbnNlcnQgaW50byAke3RoaXMuX1EoKX0kezwlPV9uQ29kZSgpJT59JHt0aGlzLl9RKCl9IChgICsgT2JqZWN0LmtleXMob2JqKS5tYXAoayA9PiB0aGlzLl9RKCkgKyBrICsgdGhpcy5fUSgpKSArICIpIHZhbHVlcyAoIiArIE9iamVjdC52YWx1ZXMob2JqKSArIGApYDsNCiAgICAgICAgPCU9bG9nKCklPnNxbCk7DQogICAgICAgIHJldHVybiBzcWw7DQogICAgfQ0KPCUgfSAlPg0KICAgIA0KICAgIDwlPW1OYW1lPSdfY29weUZyb20nJT4ob2JqKXsNCiAgICAgICAgaWYoIW9iaikgcmV0dXJuIG51bGw7DQogICAgICAgIHJldHVybiB0aGlzLl9yZXZlcnQob2JqKTsNCiAgICB9DQogICAgDQogICAgPCU9bU5hbWU9J190b09ialRyZWUnJT4oYkN5Y2xpYyl7DQogICAgICAgIDwlPXdhcm4oKSU+ImRlcHJlY2F0ZWQiKTsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgIA0KICAgICAgICB0aGlzLl9kZWZhdWx0cygpOw0KDQogICAgICAgIHJldHVybiB0aGlzLl9fZXhwb3J0KG5ldyA8JT1zY29wZSU+LjwlPV9jTmFtZShjLk5hbWUsIHRydWUpJT4oJzwlPWMuTmFtZSU+JyksIHsNCiAgICAgICAgICAgIE51bGw6IHRydWUsDQogICAgICAgICAgICBDeWNsaWM6IGJDeWNsaWMsDQogICAgICAgICAgICAvL2V4cG9ydGVyOiB2ID0+IDwlPXdhcm4oKSU+di5yZXVzZWQpLA0KICAgIDwlIGMuRW50aXR5QXR0cmlidXRlcy5maWx0ZXIoZWEgPT4gIWVhLkVudGl0eU1ldGhvZCkuZm9yRWFjaChlYSA9PiB7JT4NCiAgICAgICAgICAgIDwlPW5OYW1lKGVhKSU+OiAob2JqLCBlYUNvZGUsIHYpID0+IG9iai48JT1uTmFtZShlYSklPig8JWlmKGVhLkVudGl0eVR5cGUpeyU+bmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKGVhLkVudGl0eVR5cGUsIHRydWUpJT4oKS48JT1tTmFtZSU+KGJDeWNsaWMpPCV9ZWxzZXslPnY8JX0lPiksDQogICAgPCUgfSk7JT4NCiAgICA8JSBjLlR5cGVkQXR0cmlidXRlcy5mb3JFYWNoKHRhID0+IHsgbGV0IHRhTmFtZSA9IG5OYW1lKHRhKSArICdfJyArIHRhLkVudGl0eUNsYXNzLlBsdXJhbC5yZXBsYWNlKC8gL2csICdfJyk7JT4NCiAgICAgICAgICAgIDwlPXRhTmFtZSU+OiAob2JqLCBlYUNvZGUsIHYpID0+IG9iai48JT10YU5hbWUlPihuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUodGEuRW50aXR5Q2xhc3MsIHRydWUpJT4oKS48JT1tTmFtZSU+KGJDeWNsaWMpKSwNCiAgICA8JSB9KTslPg0KICAgICAgICB9LCAiPCU9bU5hbWUlPiIpOw0KICAgIH0NCiAgICANCiAgICA8JT1tTmFtZT0nX3VuQ3ljbGUnJT4oc291cmNlPXRoaXMpew0KICAgICAgICByZXR1cm4gdGhpcy5fX2V4cG9ydCh0aGlzLCB7DQogICAgICAgICAgICBOdWxsOiB0cnVlLA0KICAgIDwlIGMuRW50aXR5QXR0cmlidXRlcy5maWx0ZXIoZWEgPT4gIWVhLkVudGl0eU1ldGhvZCAmJiBlYS5FbnRpdHlUeXBlKS5mb3JFYWNoKGVhID0+IHslPg0KICAgICAgICAgICAgPCU9bk5hbWUoZWEpJT46IChvYmosIGVhQ29kZSwgdikgPT4gb2JqLjwlPW5OYW1lKGVhKSU+KHNvdXJjZT09b2JqLjwlPW5OYW1lKGVhKSU+KCk/bnVsbDp1bmRlZmluZWQpLA0KICAgIDwlIH0pOyU+DQogICAgPCUgYy5UeXBlZEF0dHJpYnV0ZXMuZm9yRWFjaCh0YSA9PiB7IGxldCB0YU5hbWUgPSBuTmFtZSh0YSkgKyAnXycgKyB0YS5FbnRpdHlDbGFzcy5QbHVyYWwucmVwbGFjZSgvIC9nLCAnXycpOyU+DQogICAgICAgICAgICA8JT10YU5hbWUlPjogKG9iaiwgZWFDb2RlLCB2KSA9PiB0cnVlLA0KICAgIDwlIH0pOyU+DQogICAgICAgIH0sICI8JT1tTmFtZSU+Iik7DQogICAgfQ0KICAgIA0KICAgIGFzeW5jIDwlPW1OYW1lPSdfc3RvcmVFbnRpdHlDbGFzcyclPihkZXB0aCl7DQogICAgICAgIHRyeXsNCiAgICAgICAgICAgIGlmKHR5cGVvZihkZXB0aCk9PT0idW5kZWZpbmVkIikgZGVwdGggPSB0aGlzLl9fY29uZmlnKCJjcmVhdGUiKTsNCiAgICAgICAgICAgIGlmKCFkZXB0aCkgcmV0dXJuOw0KICAgICAgICAgICAgDQogICAgICAgICAgICB0aGlzLlRvb2wuPCU9bU5hbWUlPiA9IHRoaXMuVG9vbC48JT1tTmFtZSU+IHx8IHt9Ow0KICAgICAgICAgICAgaWYodGhpcy5Ub29sLjwlPW1OYW1lJT4uPCU9bk5hbWUoYyklPikgcmV0dXJuOw0KICAgICAgICAgICAgdGhpcy5Ub29sLjwlPW1OYW1lJT4uPCU9bk5hbWUoYyklPiA9IHRydWU7DQogICAgICAgICAgICANCiAgICAgICAgICAgIDwlPWxvZygpJT5gc3RvcmluZyAnJHt0aGlzLlRvb2wudHlwZS5uYW1lfScgbW9kZWwgd2l0aCBkZXB0aCAke2RlcHRofWApOw0KICAgICAgICAgICAgDQo8JSBjbHNUb29scyhjKS5mb3JFYWNoKHQgPT4geyU+DQogICAgICAgICAgICBhd2FpdCB0aGlzLkRTQ29ubmVjdCgpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBpZih0aGlzLlRvb2wudHlwZS5uYW1lPT0iPCU9dCU+Iil7DQogICAgPCUgaWYodD09Ik5lbzRqIil7JT4NCiAgICAgICAgICAgICAgICBsZXQgY3FsID0gdGhpcy8qLl90b09ialRyZWUodHJ1ZSkqLy5fdG9DeVRhYmxlKGRlcHRoKTsNCiAgICAgICAgICAgICAgICA8JT1sb2coKSU+Y3FsKTsNCiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLl9uZW80aihjcWwpOw0KICAgIDwlIH1lbHNlIGlmKHQ9PSJBaXJUYWJsZSIpeyU+DQogICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5fYWlydGFibGUoJ21ldGEvYmFzZXMnLCBudWxsLCB7bmFtZTogJzwlPXNjb3BlJT4nLCB3b3Jrc3BhY2VJZDogdGhpcy5Ub29sLmRiLndvcmtzcGFjZUlkLCB0YWJsZXM6IHRoaXMuX3RvQVRUYWJsZShkZXB0aCl9KTsNCiAgICA8JSB9ZWxzZSBpZihfc3FsVG9vbHMuaW5kZXhPZih0KT49MCl7JT4NCiAgICAgICAgICAgICAgICBsZXQgc3FsID0gdGhpcy8qLl90b09ialRyZWUodHJ1ZSkqLy5fdG9TUUxUYWJsZSh7cmV1c2VkOiAzfSk7IDwlLypkZXB0aDogY2hhbGxlbmdlIC0gdG9vIGxvdyBkb2VzIG5vdCBjb3ZlciBhbGwgdGFibGVzLCB0b28gaGlnaCAobWF4IGRlcHRoKSByZXN1bHRzIGluIG91dC1vZi1tZW1vcnkgb24gYnJvd3NlciovJT4NCiAgICAgICAgICAgICAgICA8JT1sb2coKSU+c3FsKTsNCiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLl9zcWwoc3FsKTsNCiAgICA8JSB9ZWxzZSBpZih0PT0iU2VydmljZU5vdyIpeyU+DQogICAgICAgICAgICAgICAgLy88JT1sb2coKSU+dGhpcy8qLl90b09ialRyZWUodHJ1ZSkqLy5fdG9TTlRhYmxlKCkpOw0KICAgIDwlIH1lbHNlIGlmKHQ9PSJFTVMiKXslPg0KICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuX3RvRU1TQ2xhc3MoZGVwdGgpLnN0b3JlKCk7DQogICAgPCUgfWVsc2UgaWYodD09IkJJU2VydmVyIil7JT4NCiAgICAgICAgICAgICAgICAvLyBvbmx5IGRvIHRoaXMgaWYgdGhlIG1vZHVsZSBpcyBub3QgbG9hZGVkIGZyb20gDQogICAgICAgICAgICAgICAgKGF3YWl0IHRoaXMuc3IoKS5fKCJFbnRlcnByaXNlTWFuYWdlci5lbXNFbnRpdHlBdHRyaWJ1dGVGaW5kYWxsIiwgbnVsbCwgew0KICAgICAgICAgICAgICAgICAgICBBY3RpdmU6IHRydWUsDQogICAgICAgICAgICAgICAgICAgIEVudGl0eUNsYXNzOiB7DQogICAgICAgICAgICAgICAgICAgICAgICBBY3RpdmU6IHRydWUsDQogICAgICAgICAgICAgICAgICAgICAgICBDb21wYW55OiB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgQWN0aXZlOiB0cnVlLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIENvZGU6IHRoaXMuX19jb25maWcoJ2NvbXBhbnknLCAnPCU9c2NvcGUlPicpLA0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgIH0pKS5mb3JFYWNoKGVhID0+IC8qIHRyeWUgX2VhVHlwZXMgKi88JT1zY29wZSU+LkVudGl0eUF0dHJpYnV0ZXMuZm9yRWFjaChzZWEgPT4gew0KICAgICAgICAgICAgICAgICAgICBpZihzZWEuSWQhPT1lYS5JZCAmJiBzZWEuTmFtZT09ZWEuTmFtZSAmJiAoc2VhLkVudGl0eUNsYXNzLklkPT1lYS5FbnRpdHlDbGFzcy5JZCB8fCBzZWEuRW50aXR5Q2xhc3MuTmFtZT09ZWEuRW50aXR5Q2xhc3MuTmFtZSkpew0KICAgICAgICAgICAgICAgICAgICAgICAgc2VhLklkID09IGVhLklkOw0KICAgICAgICAgICAgICAgICAgICAgICAgc2VhLkVudGl0eUNsYXNzLklkID0gZWEuRW50aXR5Q2xhc3MuSWQ7DQogICAgICAgICAgICAgICAgICAgICAgICA8JT1zY29wZSU+LkVudGl0eUNsYXNzZXMuZmluZChjID0+IGMuTmFtZT09c2VhLkVudGl0eUNsYXNzLk5hbWUpLkVudGl0eUF0dHJpYnV0ZXMuZmluZChzY2VhID0+IHNjZWEuTmFtZT09ZWEuTmFtZSkuSWQgPSBlYS5JZDsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0pKTsNCiAgICA8JSB9ZWxzZSBpZih0PT0iTW9uZ29EQiIgfHwgdD09IlphbmdvREIiKXslPg0KICAgICAgICAgICAgICAgIGlmKHRoaXMuVG9vbC5kYikgYXdhaXQgdGhpcy5Ub29sLmRiLmNyZWF0ZUNvbGxlY3Rpb24oPCU9X25Db2RlKCklPiwge3ZhbGlkYXRvcjogeyRqc29uU2NoZW1hOiB0aGlzLl90b0pTT05TY2hlbWEoKX19KTsNCiAgICA8JSB9ZWxzZSBpZih0PT0iUnhEQiIpeyU+DQogICAgICAgICAgICAgICAgaWYodGhpcy5Ub29sLmRiKSBhd2FpdCB0aGlzLlRvb2wuZGIuYWRkQ29sbGVjdGlvbnMoe1s8JT1fbkNvZGUoKSU+XToge3NjaGVtYTogdGhpcy5fdG9KU09OU2NoZW1hKCl9fSk7DQogICAgPCUgfSU+DQogICAgICAgICAgICB9DQo8JSB9KSU+DQogICAgICAgIH1jYXRjaChleCl7DQogICAgICAgICAgICA8JT1lcnJvcigpJT5leCk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgfQ0KDQogICAgPCU9bU5hbWU9J19sb2cnJT4ob2JqPXRoaXMpew0KPCUgaWYobWFpbkNsYXNzKCkhPWMpeyU+DQogICAgICAgIHJldHVybiBuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUobWFpbkNsYXNzKCksIHRydWUpJT4oKS48JT1tTmFtZSU+KG9iaik7DQo8JSB9ZWxzZXslPg0KICAgICAgICB0cnl7DQogICAgICAgICAgICBpZihBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKG8gPT4gdGhpcy5fbG9nKG8pKTsNCiAgICAgICAgICAgIGlmKG9iai5FbnRpdHlDbGFzcykgb2JqID0gb2JqLl90b0pTT04oe2JNYXA6IHRydWV9KTsNCiAgICAgICAgICAgIDwlPWxvZygpJT5vYmopOw0KICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgIH1jYXRjaChleCl7DQogICAgICAgICAgICA8JT1lcnJvcigpJT5leCk7DQogICAgICAgIH0NCjwlIH0lPg0KICAgIH0NCg0KICAgIGFzeW5jIDwlPW1OYW1lPSdEU0Nvbm5lY3QnJT4odG9vbD10aGlzLlRvb2wpew0KPCUgaWYobWFpbkNsYXNzKCkhPWMpeyU+DQogICAgICAgIHJldHVybiBhd2FpdCBuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUobWFpbkNsYXNzKCksIHRydWUpJT4oKS48JT1tTmFtZSU+KHRvb2wpOw0KPCUgfWVsc2V7JT4NCiAgICAgICAgdHJ5ew0KICAgICAgICAgICAgaWYoIXRvb2wpew0KICAgICAgICAgICAgICAgIDwlPWVycm9yKCklPiJUb29sIGlzIG51bGwiLCB0aGlzLlRvb2xzLmxlbmd0aCwgPCU9c2NvcGUlPi5Ub29scy5sZW5ndGgpOw0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH1lbHNlIGlmKCF0b29sLnR5cGUpew0KICAgICAgICAgICAgICAgIDwlPWVycm9yKCklPiJUb29sLnR5cGUgaXMgbnVsbCIsIHRvb2wsIHRoaXMuVG9vbHMubGVuZ3RoLCA8JT1zY29wZSU+LlRvb2xzLmxlbmd0aCk7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfWVsc2UgaWYodHlwZW9mKHRvb2wuZGIpIT09InVuZGVmaW5lZCIpew0KICAgICAgICAgICAgICAgIDwlPWxvZygpJT4iVG9vbCBhbHJlYWR5IGNvbm5lY3RlZCEiKTsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9ZWxzZSBpZig8JT1uc2NvcGUlPi5fbm9kZSAmJiAvKjwlPW5zY29wZSU+Ll9ub2RlLl9wYXJlbnRfc2V0ICYmICovPCU9bnNjb3BlJT4uX25vZGUucGFyZW50KCkuX3NhbWVFbnRpdHkoPCU9bnNjb3BlJT4uX25vZGUucGFyZW50KCkpKXsNCiAgICAgICAgICAgICAgICA8JT1sb2coKSU+Ik5vZGUgaGFzIGEgdmFsaWQgcGFyZW50LCBubyBsb2NhbCBTUUwgcG9zc2libGUiKTsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIHRvb2wuX19kbWxTdGF0ZW1lbnRzID0gdG9vbC5fX2RtbFN0YXRlbWVudHMgfHwgW107DQo8JSBjbHNUb29scyhjKS5mb3JFYWNoKHQgPT4geyU+DQogICAgICAgICAgICA8JT1sb2coKSU+Ils8JT10JT5dOiBDb25uZWN0aW5nLi4uIik7DQoNCiAgICAgICAgICAgIGlmKHRvb2wudHlwZS5uYW1lPT0iPCU9dCU+Iil7DQogICAgPCUgaWYodD09IkVNUyIpeyU+DQogICAgPCUgfWVsc2UgaWYodD09Ik1vbmdvREIiKXslPg0KICAgICAgICAgICAgICAgIC8vPCU9bG9nKCklPnRoaXMuX19jb25maWcoJ3VyaScsIG51bGwsIHt0b29sOiB0b29sfSksIHRoaXMuX19jb25maWcoJ2NvbmZpZycsIG51bGwsIHt0b29sOiB0b29sfSkpOw0KICAgICAgICAgICAgICAgIGlmKHR5cGVvZihtb25nb2RiKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICAgICAgdG9vbC5kYiA9IChhd2FpdCBuZXcgbW9uZ29kYi5Nb25nb0NsaWVudCh0aGlzLl9fY29uZmlnKCd1cmknLCBudWxsLCB7dG9vbDogdG9vbH0pLCB0aGlzLl9fY29uZmlnKCdjb25maWcnLCBudWxsLCB7dG9vbDogdG9vbH0pKS5jb25uZWN0KCkpLmRiKHRoaXMuX19jb25maWcoJ2RhdGFiYXNlJywgIjwlPXNjb3BlJT4iLCB7dG9vbDogdG9vbH0pKTsNCiAgICAgICAgICAgICAgICB9DQogICAgPCUgfWVsc2UgaWYodD09J1J4REInKXslPg0KICAgICAgICAgICAgICAgIHRvb2wuZGIgPSBhd2FpdCBSeERCLmNyZWF0ZVJ4RGF0YWJhc2Uoe25hbWU6IHRoaXMuX19jb25maWcoJ2RhdGFiYXNlJywgIjwlPXNjb3BlJT4iLCB7dG9vbDogdG9vbH0pLCBzdG9yYWdlOiBudWxsfSk7DQogICAgPCUgfWVsc2UgaWYodD09J1phbmdvREInKXslPg0KICAgICAgICAgICAgICAgIHRvb2wuZGIgPSBuZXcgemFuZ28uRGIodGhpcy5fX2NvbmZpZygnZGF0YWJhc2UnLCAiPCU9c2NvcGUlPiIsIHt0b29sOiB0b29sfSksIHsNCiAgICAgICAgPCUgYXJDbGFzc2VzLmZvckVhY2goZWMgPT4geyU+DQogICAgICAgICAgICAgICAgICAgIDwlPW5OYW1lKGVjKSU+OiBbIjwlPWVjLkVudGl0eUF0dHJpYnV0ZXMuZmlsdGVyKGVhID0+ICFlYS5FbnRpdHlNZXRob2QpLm1hcChlYSA9PiBuTmFtZShlYSkpLmpvaW4oJ1wiLCBcIicpJT4iXSwNCiAgICAgICAgPCUgfSkgJT4NCiAgICAgICAgICAgICAgICB9KTsNCiAgICA8JSB9ZWxzZSBpZih0PT0nS2Fma2EnKXslPg0KICAgICAgICAgICAgICAgIGlmKHR5cGVvZihrYWZrYWpzKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICAgICAgdG9vbC5kYiA9IG5ldyBrYWZrYWpzLkthZmthKHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNsaWVudElkOiB0aGlzLl9fY29uZmlnKCdjbGllbnRJZCcsIG51bGwsIHt0b29sOiB0b29sfSksDQogICAgICAgICAgICAgICAgICAgICAgICBicm9rZXJzOiBbdGhpcy5fX2NvbmZpZygnYnJva2VycycsIG51bGwsIHt0b29sOiB0b29sfSldLA0KICAgICAgICAgICAgICAgICAgICAgICAgc3NsOiB0cnVlLA0KICAgICAgICAgICAgICAgICAgICAgICAgc2FzbDogew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJuYW1lOiB0aGlzLl9fY29uZmlnKCdjbGllbnRJZCcsIG51bGwsIHt0b29sOiB0b29sfSksDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFzc3dvcmQ6IHRoaXMuX19jb25maWcoJ3Nhc2xfcGFzc3dvcmQnLCBudWxsLCB7dG9vbDogdG9vbH0pLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lY2hhbmlzbTogdGhpcy5fX2NvbmZpZygnc2FzbF9tZWNoYW5pc21zJywgbnVsbCwge3Rvb2w6IHRvb2x9KSwNCiAgICAgICAgICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgICAgICAgICBjb25uZWN0aW9uVGltZW91dDogMzAwMCwNCiAgICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgICAgIHRvb2wucHJvZHVjZXIgPSB0b29sLmRiLnByb2R1Y2VyKCk7DQogICAgICAgICAgICAgICAgICAgIGF3YWl0IHRvb2wucHJvZHVjZXIuY29ubmVjdCgpOw0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgdG9vbC5jb25zdW1lciA9IHRvb2wuZGIuY29uc3VtZXIoe2dyb3VwSWQ6IHRoaXMuX19jb25maWcoJ2NsaWVudElkJywgbnVsbCwge3Rvb2w6IHRvb2x9KX0pOw0KICAgICAgICAgICAgICAgICAgICBhd2FpdCB0b29sLmNvbnN1bWVyLmNvbm5lY3QoKTsNCiAgICAgICAgICAgICAgICAgICAgYXdhaXQgdG9vbC5jb25zdW1lci5zdWJzY3JpYmUoew0KICAgICAgICAgICAgICAgICAgICAgICAgdG9waWM6ICc8JT1zY29wZSU+LmNhbGwnLA0KICAgICAgICAgICAgICAgICAgICAgICAgZnJvbUJlZ2lubmluZzogZmFsc2UsDQogICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICA8JSBpZihfY05hbWUoJ0V2ZW50JykpeyU+DQogICAgICAgICAgICAgICAgICAgIHRvb2wuY29uc3VtZXIucnVuKHtlYWNoTWVzc2FnZTogYXN5bmMgKHsgdG9waWMsIHBhcnRpdGlvbiwgbWVzc2FnZSB9KSA9PiBuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUoJ0V2ZW50JywgdHJ1ZSklPigpLl9mcm9tRG9jdW1lbnQobWVzc2FnZS52YWx1ZS50b1N0cmluZygpKS5wcm9jZXNzKCl9KTsNCiAgICAgICAgPCUgfSU+DQogICAgICAgICAgICAgICAgfQ0KICAgIDwlfWVsc2UgaWYodD09J01lbW9yeScpeyU+DQogICAgICAgICAgICAgICAgdG9vbC5kYiA9IHsNCiAgICAgICAgPCUgYXJDbGFzc2VzLmZvckVhY2goZWMgPT4geyU+DQogICAgICAgICAgICAgICAgICAgICc8JT1uTmFtZShlYyklPic6IFtdLA0KICAgICAgICA8JSB9KTsgJT4NCiAgICAgICAgICAgICAgICB9Ow0KICAgIDwlfWVsc2UgaWYodD09IkV4Y2VsIil7JT4NCiAgICAgICAgICAgICAgICBpZih0eXBlb2Yod2luZG93KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICAgICAgPCU9c2NvcGUlPi5kYiA9IDwlPXNjb3BlJT4ueGxzeERhdGE/WExTWC5yZWFkKDwlPXNjb3BlJT4ueGxzeERhdGEpOlhMU1gudXRpbHMuYm9va19uZXcoKTsNCiAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgPCU9c2NvcGUlPi5kYiA9IFhMU1gucmVhZChhd2FpdCBmcy5wcm9taXNlcy5yZWFkRmlsZSh0aGlzLl9fY29uZmlnKCdmaWxlbmFtZScsIG51bGwsIHt0b29sOiB0b29sfSkpKTsNCiAgICAgICAgICAgICAgICB9DQogICAgPCV9ZWxzZSBpZih0PT0iU25vd0ZsYWtlIil7JT4NCiAgICAgICAgICAgICAgICBpZih0eXBlb2YoZ2xvYmFsKSE9PSd1bmRlZmluZWQnICYmIGdsb2JhbC5zbm93Zmxha2Upew0KICAgICAgICAgICAgICAgICAgICB0b29sLmRiID0gZ2xvYmFsLnNub3dmbGFrZS5jcmVhdGVDb25uZWN0aW9uKHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGFjY291bnQ6IHRoaXMuX19jb25maWcoImFjY291bnQiLCBudWxsLCB7dG9vbDogdG9vbH0pLA0KICAgICAgICAgICAgICAgICAgICAgICAgdXNlcm5hbWU6IHRoaXMuX19jb25maWcoInVzZXJuYW1lIiwgbnVsbCwge3Rvb2w6IHRvb2x9KSwNCiAgICAgICAgICAgICAgICAgICAgICAgIHBhc3N3b3JkOiB0aGlzLl9fY29uZmlnKCJwYXNzd29yZCIsIG51bGwsIHt0b29sOiB0b29sfSksDQogICAgICAgICAgICAgICAgICAgICAgICBhcHBsaWNhdGlvbjogdGhpcy5fX2NvbmZpZygic2NvcGUiLCBudWxsLCB7dG9vbDogdG9vbH0pIHx8ICI8JT1zY29wZSU+IiwNCiAgICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgICAgIGF3YWl0IG5ldyBQcm9taXNlKChyZXMsIHJlaikgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgdG9vbC5kYi5jb25uZWN0KChlcnIsIGNvbm4pPT57DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVycil7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwlPWVycm9yKCklPidVbmFibGUgdG8gY29ubmVjdDogJyArIGVyci5tZXNzYWdlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqKGVycik7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9vbC5kYi5jb25uZWN0aW9uX0lEID0gY29ubi5nZXRJZCgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXMoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgfQ0KICAgIDwlfWVsc2UgaWYodD09Ik5lbzRqIil7JT4NCiAgICAgICAgICAgICAgICB0b29sLmRiID0gbmVvNGouZHJpdmVyKA0KICAgICAgICAgICAgICAgICAgICB0aGlzLl9fY29uZmlnKCd1cmwnLCBudWxsLCB7dG9vbDogdG9vbH0pLA0KICAgICAgICAgICAgICAgICAgICBuZW80ai5hdXRoLmJhc2ljKHRoaXMuX19jb25maWcoJ3VzZXJuYW1lJywgbnVsbCwge3Rvb2w6IHRvb2x9KSwgdGhpcy5fX2NvbmZpZygncGFzc3dvcmQnLCBudWxsLCB7dG9vbDogdG9vbH0pKQ0KICAgICAgICAgICAgICAgICk7DQogICAgPCV9ZWxzZSBpZih0PT0iQWlyVGFibGUiKXslPg0KICAgICAgICAgICAgICAgIHRvb2wuZGIgPSB7DQogICAgICAgICAgICAgICAgICAgIGJhc2VJZDogJycsDQogICAgICAgICAgICAgICAgICAgIHdvcmtzcGFjZUlkOiB0aGlzLl9fY29uZmlnKCd3b3Jrc3BhY2VJZCcsIG51bGwsIHt0b29sOiB0b29sfSksDQogICAgICAgICAgICAgICAgICAgIG5hbWU6ICcnLA0KICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogJycsDQogICAgICAgICAgICAgICAgICAgIHVzZXJJZDogKGF3YWl0IHRoaXMuX2FpcnRhYmxlKCdtZXRhL3dob2FtaScpKS5pZCwNCiAgICAgICAgICAgICAgICB9Ow0KDQogICAgICAgICAgICAgICAgbGV0IGJhc2VzID0gKGF3YWl0IHRoaXMuX2FpcnRhYmxlKCdtZXRhL2Jhc2VzJykpLmJhc2VzOw0KICAgICAgICAgICAgICAgIGlmKGJhc2VzLmxlbmd0aCl7DQogICAgICAgICAgICAgICAgICAgIHRvb2wuZGIuYmFzZUlkID0gYmFzZXMuZmlsdGVyKGIgPT4gYi5uYW1lPT0nPCU9c2NvcGUlPicpLmlkOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZighdGhpcy5Ub29sLmRiLmJhc2VJZCkgdG9vbC5kYi5iYXNlSWQgPSAnYXBwJyArIHRoaXMuX3V1aWQoKS5zcGxpdCgnLScpLnNsaWNlKC0xKVswXTsNCiAgICA8JX1lbHNlIGlmKHQ9PSJTcWxEQiIpeyU+DQogICAgICAgICAgICAgICAgaWYodHlwZW9mKGdsb2JhbCkhPT0ndW5kZWZpbmVkJyAmJiBnbG9iYWxbdGhpcy5fX2NvbmZpZygndHlwZScsIG51bGwsIHt0b29sOiB0b29sfSldKXsNCiAgICAgICAgICAgICAgICAgICAgaWYoZ2xvYmFsW3RoaXMuX19jb25maWcoJ3R5cGUnLCBudWxsLCB7dG9vbDogdG9vbH0pXS5EYXRhYmFzZSl7DQogICAgICAgICAgICAgICAgICAgICAgICB0b29sLmRiID0gbmV3IGdsb2JhbFt0aGlzLl9fY29uZmlnKCd0eXBlJywgbnVsbCwgdG9vbCldLkRhdGFiYXNlKHRoaXMuX19jb25maWcoJ2RhdGFiYXNlJywgbnVsbCwge3Rvb2w6IHRvb2x9KSB8fCAiLi88JT1zY29wZSU+LmRiIik7DQogICAgICAgICAgICAgICAgICAgIH1lbHNlIGlmKGdsb2JhbFt0aGlzLl9fY29uZmlnKCd0eXBlJywgbnVsbCwge3Rvb2w6IHRvb2x9KV0uY3JlYXRlQ29ubmVjdGlvbil7DQogICAgICAgICAgICAgICAgICAgICAgICB0b29sLmRiID0gZ2xvYmFsW3RoaXMuX19jb25maWcoJ3R5cGUnLCBudWxsLCB7dG9vbDogdG9vbH0pXS5jcmVhdGVDb25uZWN0aW9uKHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBob3N0OiB0aGlzLl9fY29uZmlnKCdzZXJ2ZXInLCBudWxsLCB7dG9vbDogdG9vbH0pLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXI6IHRoaXMuX19jb25maWcoJ3VzZXJuYW1lJywgbnVsbCwge3Rvb2w6IHRvb2x9KSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXNzd29yZDogdGhpcy5fX2NvbmZpZygncGFzc3dvcmQnLCBudWxsLCB7dG9vbDogdG9vbH0pLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFiYXNlOiB0aGlzLl9fY29uZmlnKCdkYXRhYmFzZScsIG51bGwsIHt0b29sOiB0b29sfSkgfHwgIjwlPXNjb3BlJT4iLA0KICAgICAgICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgICAgIH1lbHNlIGlmKGdsb2JhbFt0aGlzLl9fY29uZmlnKCd0eXBlJywgbnVsbCwge3Rvb2w6IHRvb2x9KV0uQ2xpZW50KXsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRvb2wuZGIgPSBuZXcgZ2xvYmFsW3RoaXMuX19jb25maWcoJ3R5cGUnLCBudWxsLCB7dG9vbDogdG9vbH0pXS5DbGllbnQoe2Nvbm5lY3Rpb25TdHJpbmc6IHRoaXMuX19jb25maWcoJ2Nvbm5zdHInLCBudWxsLCB7dG9vbDogdG9vbH0pfSk7DQogICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCB0b29sLmRiLmNvbm5lY3QoKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH1lbHNlIGlmKHR5cGVvZihnbG9iYWwpPT09J3VuZGVmaW5lZCcgJiYgdGhpcy5fX2NvbmZpZygndHlwZScsIG51bGwsIHt0b29sOiB0b29sfSk9PT0nc3FsaXRlJyl7DQogICAgICAgICAgICAgICAgICAgIC8vIHNxbGl0ZSBpbiBicm93c2VyDQogICAgICAgICAgICAgICAgICAgIHRvb2wuZGIgPSBuZXcgU1FMLkRhdGFiYXNlKCk7DQogICAgICAgICAgICAgICAgfQ0KICAgIDwlfWVsc2UgaWYodD09IlNlcnZpY2VOb3ciKXslPg0KICAgICAgICAgICAgICAgIGlmKHR5cGVvZih0b29sLnN5c19zY29wZSk9PT0idW5kZWZpbmVkIil7DQogICAgICAgICAgICAgICAgICAgIC8vIHRvb2wuc3lzX3Njb3BlID0gKGF3YWl0IHRoaXMuX3Jlc3QoInN5c19hcHAiLCB7c3lzX3Njb3BlOiB0aGlzLl9fY29uZmlnKCJzY29wZSIsIG51bGwsIHt0b29sOiB0b29sfSkgfHwgImdsb2JhbCJ9KSlbMF0uc3lzX2lkOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZih0eXBlb2YodG9vbC5zeXNfcHJvcGVydGllcyk9PT0idW5kZWZpbmVkIil7DQogICAgICAgICAgICAgICAgICAgIC8vIGxvYWRpbmcgc29tZSBwbGF0Zm9ybSBzdHVmZg0KICAgICAgICAgICAgICAgICAgICB0b29sLnN5c19wcm9wZXJ0aWVzID0ge307DQogICAgICAgICAgICAgICAgICAgIGxldCBjb25kaXRpb24gPSBPYmplY3Qua2V5cyh0b29sLnN5c19wcm9wZXJ0aWVzKS5maWx0ZXIoayA9PiAhdG9vbC5zeXNfcHJvcGVydGllc1trXSkuam9pbignLCcpOw0KICAgICAgICAgICAgICAgICAgICBpZihjb25kaXRpb24pew0KICAgICAgICAgICAgICAgICAgICAgICAgKGF3YWl0IHRoaXMuX3Jlc3QoInN5c19wcm9wZXJ0aWVzIiwge25hbWU6ICJJTiIrY29uZGl0aW9ufSkpLmZvckVhY2gociA9PiB0b29sLnN5c19wcm9wZXJ0aWVzW3IubmFtZV0gPSByLnZhbHVlKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICA8JX0lPg0KICAgICAgICAgICAgfQ0KPCUgfSklPg0KICAgICAgICB9Y2F0Y2goZXgpew0KICAgICAgICAgICAgPCU9ZXJyb3IoKSU+ZXgpOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiB0aGlzOw0KPCUgfSU+DQogICAgfQ0KICAgIC8qIEVuZDogVXRpbCBmdW5jdGlvbnMgKi8NCiAgICANCiAgICA8JT1tTmFtZT0nX21hdGNoZXMnJT4ocXVlcnksIG9wdGlvbnMpew0KICAgICAgICB0cnl7DQogICAgICAgICAgICBpZighcXVlcnkgfHwgIXF1ZXJ5LkVudGl0eUNsYXNzIHx8IHF1ZXJ5LkVudGl0eUNsYXNzLk5hbWUhPSI8JT1uTmFtZShjKSU+IikgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBpZih0eXBlb2YobWljcm9kaWZmKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICBsZXQgdEhhc2ggPSB0aGlzLl90b0hhc2gobnVsbCwge25vQ29kZTogdHJ1ZX0sICc8JT1tTmFtZSU+Jywge29ubHlVbmlxdWU6IG9wdGlvbnMub25seVVuaXF1ZX0pLl90aGlzOw0KICAgICAgICAgICAgICAgIGxldCBxSGFzaCA9IHF1ZXJ5Ll90b0hhc2gobnVsbCwge25vQ29kZTogdHJ1ZX0sICc8JT1tTmFtZSU+Jywge29ubHlVbmlxdWU6IG9wdGlvbnMub25seVVuaXF1ZX0pLl90aGlzOw0KICAgICAgICAgICAgICAgIGxldCBkaWZmID0gbWljcm9kaWZmKHFIYXNoLCB0SGFzaCkuZmlsdGVyKGQgPT4gZC50eXBlIT0nQ1JFQVRFJyAmJiBbJ09QRVJBVE9SUycsICdJZCddLmluZGV4T2YoZC5wYXRoWzBdKTwwKTsNCiAgICAgICAgICAgICAgICA8JT1sb2coKSU+dEhhc2gsIHFIYXNoLCBkaWZmKTsNCiAgICAgICAgICAgICAgICBsZXQgcmV0ID0gZGlmZi5maWx0ZXIoZCA9PiBkLnR5cGU9PSdDSEFOR0UnKS5yZWR1Y2UoKHYsIGQpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgbGV0IGNvb3AgPSBxdWVyeVsnXycgKyBkLnBhdGhbMF0gKyAnX2Nvb3AnXSB8fCAodHlwZW9mKGQudmFsdWUpPT09J3N0cmluZyc/J0xJS0UnOic9Jyk7DQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBsZXQgb2xkVmFsdWUgPSB0eXBlb2YoZC5vbGRWYWx1ZSk9PT0nc3RyaW5nJz9kLm9sZFZhbHVlLnNwbGl0KCcvJykuc2xpY2UoLTEpWzBdOmQub2xkVmFsdWU7DQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICA8JT1sb2coKSU+ZC5wYXRoWzBdLCBkLm9sZFZhbHVlLCBkLnZhbHVlLCBjb29wLCBvbGRWYWx1ZSwgZCk7DQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBzd2l0Y2goY29vcCl7DQogICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdMSUtFJzogcmV0dXJuIHYgJiYgZC52YWx1ZS5pbmRleE9mKG9sZFZhbHVlKT49MDsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJz0nOiByZXR1cm4gdiAmJiAoIWQudmFsdWUgfHwgZC52YWx1ZT09b2xkVmFsdWUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnIT0nOiByZXR1cm4gdiAmJiBkLnZhbHVlIT1vbGRWYWx1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJz49JzogcmV0dXJuIHYgJiYgZC52YWx1ZT49b2xkVmFsdWU7DQogICAgICAgICAgICAgICAgICAgICAgICBjYXNlICc8PSc6IHJldHVybiB2ICYmIGQudmFsdWU8PW9sZFZhbHVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnPic6IHJldHVybiB2ICYmIGQudmFsdWU+b2xkVmFsdWU7DQogICAgICAgICAgICAgICAgICAgICAgICBjYXNlICc8JzogcmV0dXJuIHYgJiYgZC52YWx1ZTxvbGRWYWx1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6IHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0sIHRydWUpOw0KICAgICAgICAgICAgICAgIHJldHVybiByZXQ7DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIGxldCBvTWF0Y2ggPSB0aGlzLl9fZXhwb3J0KHt9LCB7DQogICAgICAgICAgICAgICAgLy9GdWxsOiB0cnVlLA0KICAgICAgICAgICAgICAgIC8vTnVsbDogdHJ1ZSwNCiAgICAgICAgICAgICAgICBJZDogKG9iaiwgZWFDb2RlLCB2KSA9PiBvYmouX2lkID0gdGhpcy5JZD09cXVlcnkuSWQsDQogICAgICAgIDwlIGMuRW50aXR5QXR0cmlidXRlcy5maWx0ZXIoZWEgPT4gIWVhLkVudGl0eU1ldGhvZCkuZm9yRWFjaChlYSA9PiB7JT4NCiAgICAgICAgICAgICAgICA8JT1uTmFtZShlYSklPjogKG9iaiwgZWFDb2RlLCB2KSA9PiB7DQogICAgICAgICAgICA8JSBpZihlYS5FbnRpdHlUeXBlKXslPg0KICAgICAgICAgICAgICAgICAgICBvYmouPCU9bk5hbWUoZWEpJT4gPSB2P3YuPCU9bU5hbWUlPihxdWVyeT9xdWVyeS48JT1uTmFtZShlYSklPigpOm51bGwpOnRydWU7DQogICAgICAgICAgICA8JSB9ZWxzZXslPg0KICAgICAgICAgICAgICAgICAgICBvYmouPCU9bk5hbWUoZWEpJT4gPSB2PT1xdWVyeS48JT1uTmFtZShlYSklPigpOw0KICAgICAgICAgICAgPCUgfSU+DQogICAgICAgICAgICAgICAgICAgIGlmKA0KICAgICAgICAgICAgICAgICAgICAgICAgKHRoaXMuXzwlPW5OYW1lKGVhKSU+X3NldCAmJiAhcXVlcnkuXzwlPW5OYW1lKGVhKSU+X3NldCkgfHwNCiAgICAgICAgICAgICAgICAgICAgICAgIGZhbHNlDQogICAgICAgICAgICAgICAgICAgICkgb2JqLjwlPW5OYW1lKGVhKSU+ID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIGlmKA0KICAgICAgICAgICAgICAgICAgICAgICAgKCF0aGlzLl88JT1uTmFtZShlYSklPl9zZXQgJiYgcXVlcnkuXzwlPW5OYW1lKGVhKSU+X3NldCkgfHwNCiAgICAgICAgICAgIDwlIGlmKGVhLkVudGl0eVR5cGUpeyU+DQogICAgICAgICAgICAgICAgICAgICAgICAodGhpcy48JT1uTmFtZShlYSklPigpICYmICF0aGlzLjwlPW5OYW1lKGVhKSU+KCkuPCU9bU5hbWUlPihxdWVyeS48JT1uTmFtZShlYSklPigpKSkgfHwNCiAgICAgICAgICAgIDwlIH0lPg0KICAgICAgICAgICAgICAgICAgICAgICAgZmFsc2UNCiAgICAgICAgICAgICAgICAgICAgKSBvYmouPCU9bk5hbWUoZWEpJT4gPSBmYWxzZTsNCiAgICAgICAgICAgICAgICB9LA0KICAgICAgICA8JSB9KTsgJT4NCiAgICAgICAgPCUgYy5UeXBlZEF0dHJpYnV0ZXMuZm9yRWFjaCh0YSA9PiB7IGxldCB0YU5hbWUgPSBuTmFtZSh0YSkgKyAnXycgKyB0YS5FbnRpdHlDbGFzcy5QbHVyYWwucmVwbGFjZSgvIC9nLCAnXycpOyU+DQogICAgICAgICAgICAgICAgPCU9dGFOYW1lJT46IChvYmosIGVhQ29kZSwgdikgPT4gew0KICAgICAgICAgICAgICAgICAgICBvYmouPCU9dGFOYW1lJT4gPSB2Lm1hcChfdiA9PiBxdWVyeS48JT10YU5hbWUlPigpLmFueShxID0+IF92LjwlPW1OYW1lJT4ocSkpKTsNCiAgICAgICAgICAgICAgICB9LA0KICAgICAgICA8JSB9KSU+DQogICAgICAgICAgICB9LCAiPCU9bU5hbWUlPiIpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICA8JT1sb2coKSU+b01hdGNoKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgcmV0dXJuIE9iamVjdC5rZXlzKG9NYXRjaCkuZXZlcnkoayA9PiBvTWF0Y2hba10pOw0KICAgICAgICB9Y2F0Y2goZXgpew0KICAgICAgICAgICAgPCU9ZXJyb3IoKSU+ZXgpOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgPCU9bU5hbWU9J19tYXRjaGluZyclPihxdWVyeSl7DQogICAgICAgIHRyeXsNCiAgICAgICAgICAgIGxldCByZXQgPSBbXTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgbGV0IG1hdGNoZXMgPSB0aGlzLl9fZXhwb3J0KHt9LCB7DQogICAgICAgIDwlIGMuRW50aXR5QXR0cmlidXRlcy5maWx0ZXIoZWEgPT4gIWVhLkVudGl0eU1ldGhvZCAmJiBlYS5FbnRpdHlUeXBlKS5mb3JFYWNoKGVhID0+IHslPg0KICAgICAgICAgICAgICAgIDwlPW5OYW1lKGVhKSU+OiAob2JqLCBlYUNvZGUsIHYpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgPCU9bG9nKCklPiJGb3IgPCU9bk5hbWUoZWEpJT4iKTsNCiAgICAgICAgICAgICAgICAgICAgb2JqLjwlPW5OYW1lKGVhKSU+ID0gdj9bdi48JT1tTmFtZSU+KHF1ZXJ5KT92Om51bGxdLmNvbmNhdCh2LjwlPW1OYW1lJT4ocXVlcnkpKS5maWx0ZXIobSA9PiBtKTpbXTsNCiAgICAgICAgICAgICAgICB9LA0KICAgICAgICA8JSB9KSU+DQogICAgICAgIDwlIGMuVHlwZWRBdHRyaWJ1dGVzLmZvckVhY2godGEgPT4geyBsZXQgdGFOYW1lID0gbk5hbWUodGEpICsgJ18nICsgdGEuRW50aXR5Q2xhc3MuUGx1cmFsLnJlcGxhY2UoLyAvZywgJ18nKTslPg0KICAgICAgICAgICAgICAgIDwlPXRhTmFtZSU+OiAob2JqLCBlYUNvZGUsIHYpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgb2JqLjwlPXRhTmFtZSU+ID0gdi5tYXAoX3YgPT4gX3YuPCU9bU5hbWUlPihxdWVyeSkpLmZsYXQoKTsNCiAgICAgICAgICAgICAgICB9LA0KICAgICAgICA8JSB9KSU+DQogICAgICAgICAgICB9LCAiPCU9bU5hbWUlPiIpOw0KDQogICAgICAgICAgICA8JT1sb2coKSU+Im1hdGNoZXMiLCBtYXRjaGVzKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgcmV0ID0gWy4uLm5ldyBTZXQoT2JqZWN0LmtleXMobWF0Y2hlcykubWFwKGsgPT4gbWF0Y2hlc1trXSkuZmxhdCgpKV0uZmlsdGVyKG0gPT4gbSE9cXVlcnkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICA8JT1sb2coKSU+InJldCIsIHJldCk7DQogICAgICAgICAgICByZXR1cm4gcmV0Ow0KICAgICAgICB9Y2F0Y2goZXgpew0KICAgICAgICAgICAgPCU9ZXJyb3IoKSU+ZXgpOw0KICAgICAgICB9DQogICAgfQ0KICAgIA0KICAgIDwlPW1OYW1lPSdfZGVSZWZlcmVuY2UnJT4ocm9vdCl7DQogICAgICAgIHRyeXsNCiAgICAgICAgICAgIGlmKCFyb290KSByb290PXRoaXM7DQoNCiAgICAgICAgICAgIGlmKHJvb3QhPXRoaXMgJiYgdGhpcy5TZXRfT24pIHsNCiAgICAgICAgICAgICAgICBsZXQgbXlNYXRjaGVzID0gcm9vdC5fbWF0Y2hpbmcodGhpcyk7DQogICAgICAgICAgICAgICAgaWYoIW15TWF0Y2hlcy5sZW5ndGgpIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgICAgIDwlPWxvZygpJT4iUXVlcnkiLCBteU1hdGNoZXMubGVndGgpOw0KICAgICAgICAgICAgICAgIHJldHVybiBteU1hdGNoZXNbMF07DQogICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICB0aGlzLl9fZXhwb3J0KHt9LCB7DQogICAgICAgIDwlIGMuRW50aXR5QXR0cmlidXRlcy5maWx0ZXIoZWEgPT4gIWVhLkVudGl0eU1ldGhvZCAmJiBlYS5FbnRpdHlUeXBlKS5mb3JFYWNoKGVhID0+IHslPg0KICAgICAgICAgICAgICAgIDwlPW5OYW1lKGVhKSU+OiAob2JqLCBlYUNvZGUsIHYpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgaWYodil7DQogICAgICAgICAgICAgICAgICAgICAgICBsZXQgcmV0ID0gdi48JT1tTmFtZSU+KHJvb3QpOw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYocmV0IT12KSB0aGlzLjwlPW5OYW1lKGVhKSU+KHJldCk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9LA0KICAgICAgICA8JSB9KTsgJT4NCiAgICAgICAgDQogICAgICAgIDwlIGMuVHlwZWRBdHRyaWJ1dGVzLmZvckVhY2godGEgPT4geyBsZXQgdGFOYW1lID0gbk5hbWUodGEpICsgJ18nICsgdGEuRW50aXR5Q2xhc3MuUGx1cmFsLnJlcGxhY2UoLyAvZywgJ18nKTslPg0KICAgICAgICAgICAgICAgIDwlPXRhTmFtZSU+OiAob2JqLCBlYUNvZGUsIHYpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgdi5maWx0ZXIodGEgPT4gdGEpLmZvckVhY2goKHRhLCBpKSA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICBsZXQgcmV0ID0gdGEuPCU9bU5hbWUlPihyb290KTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmKHJldCE9dGEpIHRoaXMuPCU9dGFOYW1lJT4oKVtpXSA9IHJldDsNCiAgICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgfSwNCiAgICAgICAgPCUgfSklPg0KICAgICAgICAgICAgfSwgIjwlPW1OYW1lJT4iKTsNCg0KICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgIH1jYXRjaChleCl7DQogICAgICAgICAgICA8JT1lcnJvcigpJT5leCk7DQogICAgICAgIH0NCiAgICB9DQogICAgDQogICAgPCU9bU5hbWU9J19mcm9tRG9jdW1lbnQnJT4ob2JqLCBiVG9vbCl7DQogICAgICAgIGlmKCFvYmopIHJldHVybiB0aGlzOw0KICAgICAgICBpZihvYmouPCU9bU5hbWUlPikgcmV0dXJuIG9iajsNCiAgICAgICAgDQogICAgICAgIGlmKHR5cGVvZihvYmopPT09J3N0cmluZycpew0KICAgICAgICAgICAgaWYoPCU9X2I2NHRlc3QoJ29iaicpJT4pIG9iaiA9IHRoaXMuX2F0b2Iob2JqKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgdHJ5ew0KICAgICAgICAgICAgICAgIGlmKG9iai5sZW5ndGg8MzMgJiYgIW9iai5tYXRjaCgvXHMvZykpew0KICAgICAgICAgICAgICAgICAgICBvYmogPSB7DQogICAgICAgICAgICAgICAgICAgICAgICBbdGhpcy5fX2NvbmZpZygnaWRGaWVsZCcsICdJZCcsIHt0b29sOiBvYmouX190b29sfSldOiBvYmoNCiAgICAgICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgb2JqID0gSlNPTi5wYXJzZShvYmopOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH1jYXRjaChleCl7DQogICAgICAgICAgICAgICAgPCU9d2FybigpJT4iSW52YWxpZCBKU09OIG9yIFVVSUQiLCBvYmopOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9ZWxzZSBpZihBcnJheS5pc0FycmF5KG9iaikpew0KICAgICAgICAgICAgcmV0dXJuIG9iai5tYXAobyA9PiB0aGlzLjwlPW1OYW1lJT4obywgYlRvb2wpKTsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgaWYob2JqLl9fdG9vbCkgdGhpcy5Ub29sID0gb2JqLl9fdG9vbDsNCiAgICAgICAgDQogICAgICAgIGlmKCFPYmplY3Qua2V5cyhvYmopLmZpbHRlcihrID0+IHR5cGVvZihvYmpba10pIT09J3VuZGVmaW5lZCcgJiYgb2JqW2tdIT09bnVsbCkubGVuZ3RoKXsNCiAgICAgICAgICAgIDwlPWxvZygpJT4iRW1wdHkgb2JqZWN0IG9yIG9iamVjdCBvZiBudWxscyIsIG9iaik7DQogICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgfQ0KDQogICAgICAgIDwlPWxvZygpJT5vYmopOw0KICAgICAgICByZXR1cm4gdGhpcy5fX2ltcG9ydChvYmosIHsNCiAgICAgICAgICAgIF9tYXA6IGJUb29sLA0KICAgICAgICAgICAgaW1wb3J0ZXI6IHYgPT4gdi5vYmogPSAodi5vYmomJnYub2JqLlNldF9Db3VudDx0aGlzLlNldF9Db3VudCk/dGhpczp2Lm9iaiwNCiAgICAgICAgICAgIF9USElTOiBvYmogPT4gdGhpcy5USElTKG9iai5USElTLCBvYmouT1BFUkFUT1JTP29iai5PUEVSQVRPUlMuVEhJUzp1bmRlZmluZWQpLA0KICAgICAgICAgICAgSWQ6IChvYmosIGlkQ29kZSkgPT4gew0KICAgICAgICAgICAgICAgIGlmKGlkQ29kZT09J0lkJykgaWRDb2RlID0gdGhpcy5fX2NvbmZpZygnaWRGaWVsZCcsICdJZCcpOw0KICAgICAgICAgICAgICAgIGlmKG9ialtpZENvZGVdKSB0aGlzLklkID0gb2JqW2lkQ29kZV07DQogICAgICAgICAgICB9LA0KICAgIDwlIGMuRW50aXR5QXR0cmlidXRlcy5maWx0ZXIoZWEgPT4gIWVhLkVudGl0eU1ldGhvZCkuZm9yRWFjaChlYSA9PiB7ICU+DQogICAgICAgICAgICA8JT1uTmFtZShlYSklPjogKG9iaiwgZWFDb2RlKSA9PiB7DQogICAgICAgICAgICAgICAgaWYob2JqLk9QRVJBVE9SUyAmJiBvYmouT1BFUkFUT1JTW2VhQ29kZV0pew0KICAgICAgICAgICAgICAgICAgICB0aGlzLl88JT1uTmFtZShlYSklPl9jb29wID0gb2JqLk9QRVJBVE9SU1tlYUNvZGVdOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICBsZXQgcmVmID0gb2JqW2VhQ29kZV07DQogICAgICAgICAgICAgICAgaWYodHlwZW9mKHJlZik9PT0ndW5kZWZpbmVkJykgcmV0dXJuOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgPCUgaWYoZWEuRW50aXR5VHlwZSl7ICU+DQogICAgICAgICAgICAgICAgPCUgaWYoIWVhLklzQXJyYXkpeyAlPg0KICAgICAgICAgICAgICAgIGlmKHRoaXMuVG9vbC50eXBlLm5hbWU9PSJSZXN0REJJTyIpIHJlZiA9IHJlZlswXTsNCiAgICAgICAgICAgICAgICBpZighcmVmKSByZXR1cm47DQogICAgICAgICAgICAgICAgPCUgfSAlPg0KDQogICAgICAgICAgICAgICAgdGhpcy48JT1uTmFtZShlYSklPigodGhpcy48JT1uTmFtZShlYSklPigpIHx8IG5ldyA8JT1zY29wZSU+LjwlPV9jTmFtZShlYS5FbnRpdHlUeXBlLCB0cnVlKSU+KCkpLjwlPW1OYW1lJT4ocmVmLCBiVG9vbCkpOw0KICAgICAgICAgICAgPCUgfWVsc2UgaWYoZWEuSXNEYXRlKXsgJT4NCiAgICAgICAgICAgICAgICBpZih0aGlzLlRvb2wudHlwZS5uYW1lPT0iU3FsREIiKXsNCiAgICAgICAgICAgICAgICAgICAgaWYodHlwZW9mKG1vbWVudCkhPT0idW5kZWZpbmVkIiAmJiB0eXBlb2YodGhpcy5Ub29sLnN5c19wcm9wZXJ0aWVzKSE9PSJ1bmRlZmluZWQiKXsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJlZiA9IG1vbWVudC5wYXJzZVpvbmUocmVmLCB0aGlzLlRvb2wuc3lzX3Byb3BlcnRpZXNbImdsaWRlLnN5cy5kYXRlX2Zvcm1hdCJdICsgIiAiICsgdGhpcy5Ub29sLnN5c19wcm9wZXJ0aWVzWyJnbGlkZS5zeXMudGltZV9mb3JtYXQiXSwgdGhpcy5Ub29sLnN5c19wcm9wZXJ0aWVzWyJnbGlkZS5zeXMuZGVmYXVsdC50eiJdKS50b0RhdGUoKTsNCiAgICAgICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgICAgICByZWYgPSBuZXcgRGF0ZShyZWYpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIGlmKHR5cGVvZihyZWYpPT09J3N0cmluZycpew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYocmVmLmluZGV4T2YoJ1QnKT4wKXsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWYgPSBEYXRlLnBhcnNlKHJlZik7DQogICAgICAgICAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWYgPSBEYXRlLnBhcnNlKHJlZiArICIgR01UIik7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgcmVmID0gbmV3IERhdGUocmVmKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgdGhpcy48JT1uTmFtZShlYSklPihyZWYpOw0KICAgICAgICAgICAgPCUgfWVsc2UgaWYoZWEuSXNUZXh0KXslPg0KICAgICAgICAgICAgICAgIGlmKDwlPV9iNjR0ZXN0KCdyZWYnKSU+KXsgLy8gaXMgYmFzZTY0Pw0KICAgICAgICAgICAgICAgICAgICB0aGlzLjwlPW5OYW1lKGVhKSU+KHRoaXMuX2F0b2IocmVmKSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgPCUgfWVsc2V7ICU+DQogICAgICAgICAgICAgICAgdGhpcy48JT1uTmFtZShlYSklPihyZWYpOw0KICAgICAgICAgICAgPCUgfSAlPg0KICAgICAgICAgICAgfSwNCiAgICA8JSB9KTsgJT4NCiAgICA8JSBjLlR5cGVkQXR0cmlidXRlcy5mb3JFYWNoKHRhID0+IHsgbGV0IHRhTmFtZSA9IG5OYW1lKHRhKSArICdfJyArIHRhLkVudGl0eUNsYXNzLlBsdXJhbC5yZXBsYWNlKC8gL2csICdfJyk7JT4NCiAgICAgICAgICAgIDwlPXRhTmFtZSU+OiAob2JqLCBlYUNvZGUpID0+IG9ialtlYUNvZGVdP3RoaXMuPCU9dGFOYW1lJT4ob2JqW2VhQ29kZV0ubWFwKF92ID0+IG5ldyA8JT1zY29wZSU+LjwlPW5OYW1lKHRhLkVudGl0eUNsYXNzLCB0cnVlKSU+KCkuPCU9bU5hbWUlPihfdiwgYlRvb2wpKSwgb2JqLk9QRVJBVE9SUz9vYmouT1BFUkFUT1JTW2VhQ29kZV06dW5kZWZpbmVkLCB0cnVlKTp1bmRlZmluZWQsDQogICAgPCUgfSklPg0KICAgICAgICB9LCAiPCU9bU5hbWUlPiIpOw0KICAgIH0NCiAgICANCjwlIGlmKF9jTmFtZSgnRXZlbnQnKSl7JT4NCiAgICA8JT1tTmFtZT0nX3RvUHJvdG8nJT4ob3B0aW9ucz17fSwgc1BhdGgpew0KICAgICAgICB0cnl7DQogICAgICAgICAgICBsZXQgcmV0ID0gdGhpcy5fX2V4cG9ydCh7SWQ6IDwlPV9uQ29kZSgpJT4sIHByb3RvOiBgXG5cbm1lc3NhZ2UgJHs8JT1fbkNvZGUoKSU+fSB7YCwgaW5kZXg6IDF9LCB7DQogICAgICAgICAgICAgICAgX21hcDogb3B0aW9ucy5iTWFwLA0KICAgICAgICAgICAgICAgIEZ1bGw6IHRydWUsDQogICAgICAgICAgICAgICAgTnVsbDogdHJ1ZSwNCiAgICAgICAgICAgICAgICBleHBvcnRlcjogdiA9PiB2Lm9iaj0odi5yZXVzZWQ+MSk/e3Byb3RvOiBgXG5cbi8vIHJldXNlZFske3YucmV1c2VkfV06ICR7PCU9X25Db2RlKCklPn1cblxuYH06di5vYmosDQogICAgICAgICAgICAgICAgX1RISVM6IChvYmosIGVhQ29kZSwgdikgPT4gb2JqLnByb3RvICs9IGBcblx0cmVwZWF0ZWQgJHs8JT1fbkNvZGUoKSU+fSAke2VhQ29kZX0gPSAke29iai5pbmRleCsrfTtgLA0KICAgICAgICAgICAgICAgIElkOiAob2JqLCBpZENvZGUsIHYpID0+IG9iai5wcm90byArPSBgXG5cdHN0cmluZyAke2lkQ29kZX0gPSAke29iai5pbmRleCsrfTtgLA0KICAgIDwlIGMuRW50aXR5QXR0cmlidXRlcy5maWx0ZXIoZWEgPT4gIWVhLkVudGl0eU1ldGhvZCkuZm9yRWFjaChlYSA9PiB7ICU+DQogICAgICAgICAgICAgICAgPCU9bk5hbWUoZWEpJT46IChvYmosIGVhQ29kZSwgdikgPT4gew0KICAgICAgICA8JSBpZihlYS5FbnRpdHlUeXBlKXslPg0KICAgICAgICAgICAgICAgICAgICBvYmoucHJvdG8gKz0gYFxuXHRgICsgbmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKGVhLkVudGl0eVR5cGUsIHRydWUpJT4oKS48JT1tTmFtZSU+KG9wdGlvbnMsIGAke3NQYXRofS4ke2VhQ29kZX1gKTsNCiAgICAgICAgPCUgfSU+DQogICAgICAgICAgICAgICAgICAgIG9iai5wcm90byArPSBgXG5cdGA7DQogICAgICAgIDwlIGlmKGVhLlJlcXVpcmVkKXslPg0KICAgICAgICAgICAgICAgICAgICBpZig8JXZhbHVlT2YoZWEuUmVxdWlyZWQpJT4pIG9iai5wcm90byArPSAncmVxdWlyZWQgJzsNCiAgICAgICAgPCUgfSU+DQogICAgICAgIDwlIGlmKGVhLklzQXJyYXkpeyU+DQogICAgICAgICAgICAgICAgICAgIG9iai5wcm90byArPSAncmVwZWF0ZWQgJzsNCiAgICAgICAgPCUgfSU+DQogICAgICAgIDwlIGlmKGVhLklzU3RyaW5nIHx8IGVhLklzVGV4dCl7JT4NCiAgICAgICAgICAgICAgICAgICAgb2JqLnByb3RvICs9ICJzdHJpbmciOw0KICAgICAgICA8JSB9ZWxzZSBpZihlYS5Jc0Jvb2wpeyU+DQogICAgICAgICAgICAgICAgICAgIG9iai5wcm90byArPSAiYm9vbCI7DQogICAgICAgIDwlIH1lbHNlIGlmKGVhLklzSW50KXslPg0KICAgICAgICAgICAgICAgICAgICBvYmoucHJvdG8gKz0gImludDMyIjsNCiAgICAgICAgPCUgfWVsc2UgaWYoZWEuSXNMb25nKXslPg0KICAgICAgICAgICAgICAgICAgICBvYmoucHJvdG8gKz0gImludDY0IjsNCiAgICAgICAgPCUgfWVsc2UgaWYoZWEuSXNGbG90KXslPg0KICAgICAgICAgICAgICAgICAgICBvYmoucHJvdG8gKz0gImZsb2F0IjsNCiAgICAgICAgPCUgfWVsc2UgaWYoZWEuSXNEb3VibGUpeyU+DQogICAgICAgICAgICAgICAgICAgIG9iai5wcm90byArPSAiZG91YmxlIjsNCiAgICAgICAgPCUgfWVsc2UgaWYoZWEuSXNEYXRlKXslPg0KICAgICAgICAgICAgICAgICAgICBvYmoucHJvdG8gKz0gInN0cmluZyI7DQogICAgICAgIDwlIH1lbHNlIGlmKGVhLkVudGl0eVR5cGUpeyU+DQogICAgICAgICAgICAgICAgICAgIG9iai5wcm90byArPSA8JT1fbkNvZGUoZWEuRW50aXR5VHlwZSklPjsNCiAgICAgICAgPCUgfSU+DQogICAgICAgICAgICAgICAgICAgIG9iai5wcm90byArPSBgICR7ZWFDb2RlfSA9ICR7b2JqLmluZGV4Kyt9O2A7DQogICAgICAgICAgICAgICAgfSwNCiAgICA8JSB9KSU+DQogICAgPCUgYy5UeXBlZEF0dHJpYnV0ZXMuZmlsdGVyKHRhID0+ICF0YS5FbnRpdHlNZXRob2QpLmZvckVhY2godGEgPT4ge2xldCB0YU5hbWUgPSBuTmFtZSh0YSkgKyAnXycgKyB0YS5FbnRpdHlDbGFzcy5QbHVyYWwucmVwbGFjZSgvIC9nLCAnXycpOyU+DQogICAgICAgICAgICAgICAgPCU9dGFOYW1lJT46IChvYmosIGVhQ29kZSwgdikgPT4gb2JqLnByb3RvICs9IGBcblx0YCArIG5ldyA8JT1zY29wZSU+LjwlPV9jTmFtZSh0YS5FbnRpdHlDbGFzcywgdHJ1ZSklPigpLjwlPW1OYW1lJT4ob3B0aW9ucywgYCR7c1BhdGh9LiR7ZWFDb2RlfVtdYCkgKyBgXG5cdHJlcGVhdGVkICR7PCU9X25Db2RlKHRhLkVudGl0eUNsYXNzKSU+fSAke2VhQ29kZX0gPSAke29iai5pbmRleCsrfTtgLA0KICAgIDwlIH0pJT4NCiAgICA8JSBjLkVudGl0eUZpZWxkcy5mb3JFYWNoKGVmID0+IHslPg0KICAgICAgICAgICAgICAgIGVmXzwlPW5OYW1lKGVmKSU+OiAob2JqLCBlZkNvZGUsIHYpID0+IG9iai5wcm90byArPSBgXG5cdHN0cmluZyAke2VmQ29kZX0gPSAke29iai5pbmRleCsrfTtgLA0KICAgIDwlIH0pJT4NCiAgICAgICAgICAgICAgICBfX2Nsb3NlOiBvYmogPT4gb2JqLnByb3RvICs9ICdcbn1cblxuJywNCiAgICAgICAgICAgIH0sICI8JT1tTmFtZSU+Iiwgb3B0aW9ucywgc1BhdGgpLnByb3RvOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBpZihyZXQgJiYgIXNQYXRoKXsNCiAgICAgICAgICAgICAgICByZXQgPSBgcGFja2FnZSA8JT1zY29wZSU+O1xuXG5zeW50YXggPSAicHJvdG8zIjtcblxuYCArIHJldDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiByZXQ7DQogICAgICAgIH1jYXRjaChleCl7DQogICAgICAgICAgICA8JT1lcnJvcigpJT5leCk7DQogICAgICAgIH0NCiAgICB9DQo8JX0lPg0KDQogICAgPCU9bU5hbWU9J190b0pTT04nJT4ob3B0aW9ucz17fSwgc1BhdGgpew0KICAgICAgICB0cnl7DQogICAgICAgICAgICBzUGF0aCA9IHNQYXRoIHx8ICIiOw0KICAgICAgICAgICAgbGV0IHJldCA9IHt9Ow0KICAgICAgICAgICAgcmV0Ll9fa2V5cyA9IFtdOyAvLyEhDQogICAgICAgICAgICANCiAgICAgICAgICAgIGlmKCFvcHRpb25zLmJNYXApew0KICAgICAgICAgICAgICAgIHJldC5fX2dlbmVyYXRlZCA9ICciJyArIG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSArICciJzsNCiAgICAgICAgICAgICAgICBpZih0aGlzLlRvb2wubmFtZSl7DQogICAgICAgICAgICAgICAgICAgIHJldC5fX3Rvb2wgPSB7DQogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiB0aGlzLlRvb2wubmFtZSwNCiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiB0aGlzLlRvb2wudHlwZS5uYW1lLA0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgICAgICByZXQuX19jbGFzcyA9ICciPCU9bk5hbWUoYyklPiInOw0KICAgICAgICAgICAgICAgICAgICByZXQuX190eXBlID0gJyInKzwlPV9uQ29kZSgpJT4rJyInOw0KICAgICAgICAgICAgICAgICAgICAvL3JldC5fX3BhdGggPSAnIicrc1BhdGgrJyInOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZig8JT1uc2NvcGUlPi5fbm9kZSl7DQogICAgICAgICAgICAgICAgICAgIHJldC5fX25vZGUgPSB7DQogICAgICAgICAgICAgICAgICAgICAgICBjb2RlOiA8JT1uc2NvcGUlPi5fbm9kZS5jb2RlKCkNCiAgICAgICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICB0aGlzLl9kZWZhdWx0cygpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICBsZXQgdHJNYXAgPSAob2JqLCBlYUNvZGUsIHYsIHNQYXRoKSA9PiAodiAmJiB0eXBlb2Yodik9PT0nc3RyaW5nJyAmJiB2LnJlcGxhY2UpP3YucmVwbGFjZSgvMDE5NTc5YThhOWY5NzVkMjhlODk5OTI4MTA5YTE1MzJdKz4+L2dtLCBtID0+IHsNCiAgICAgICAgICAgICAgICA8JT1zY29wZSU+Ll9fdHJNYXAgPSA8JT1zY29wZSU+Ll9fdHJNYXAgfHwgW107DQoNCiAgICAgICAgICAgICAgICBsZXQgdHJpZCA9IHRoaXMuX3V1aWQoKTsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICBsZXQgcFBhdGggPSAnLicrKHNQYXRoLnNwbGl0KCcuJykuc2xpY2UoMSwgLTEpLmpvaW4oJy4nKSk7DQogICAgICAgICAgICAgICAgaWYocFBhdGg9PSIuIikgcFBhdGggPSAiIjsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICBsZXQgdHIgPSBtLnJlcGxhY2UoJzAxOTU3OWE4YTlmOTc1ZDI4ZTg5YTFlZmQxNzA5Y2IxJywgJycpLnJlcGxhY2UoL3t7bnJ9fS9nbSwgJyRub3QoJGV4aXN0cyhfX3JldXNlZCkpJykucmVwbGFjZSgve3t2Zn19L2csIG9ialtlYUNvZGVdKTsNCiAgICAgICAgICAgICAgICBpZih0ci5zdGFydHNXaXRoKCdzKCcpICYmIHRyLmVuZHNXaXRoKCcpJykpew0KICAgICAgICAgICAgICAgICAgICB0ciA9IHRyLnJlcGxhY2UoL3t7X199fS9nbSwgJ29KU09OJytzUGF0aCkucmVwbGFjZSgve3twcGF0aH19L2dtLCAnb0pTT04nK3BQYXRoKTsNCiAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgdHIgPSB0ci5yZXBsYWNlKC97e19ffX0vZ20sIGAqKltJZD0ke29iai5JZH1dWzBdYCk7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgLy8gPCU9d2FybigpJT5lYUNvZGUsIHRyaWQsIHRyKTsNCg0KICAgICAgICAgICAgICAgIHRyID0gdGhpcy5fYnRvYSh0cik7DQogICAgICAgICAgICAgICAgbGV0IG1hcCA9IDwlPXNjb3BlJT4uX190ck1hcC5maW5kKG8gPT4gby50cmFuc2Zvcm09PXRyKTsNCiAgICAgICAgICAgICAgICByZXR1cm4gKG1hcD9tYXAuaWQ6PCU9c2NvcGUlPi5fX3RyTWFwWzwlPXNjb3BlJT4uX190ck1hcC5wdXNoKHtpZDogdHJpZCwgdHJhbnNmb3JtOiB0cn0pLTFdLmlkKTsNCiAgICAgICAgICAgIH0pOnY7DQogICAgICAgICAgICANCiAgICAgICAgICAgIHJldCA9IHRoaXMuX19leHBvcnQocmV0LCB7DQogICAgICAgICAgICAgICAgX21hcDogb3B0aW9ucy5iTWFwLA0KICAgICAgICAgICAgICAgIEZ1bGw6IG9wdGlvbnMuYkZ1bGwsDQogICAgICAgICAgICAgICAgTnVsbDogb3B0aW9ucy5iTnVsbCwNCiAgICAgICAgICAgICAgICBleHBvcnRlcjogdiA9PiB7DQogICAgICAgICAgICAgICAgICAgIGlmKHR5cGVvZihvcHRpb25zLnJldXNlZCk9PT0ndW5kZWZpbmVkJyB8fCBvcHRpb25zLnJldXNlZD49di5yZXVzZWQpIHJldHVybjsNCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIGlmKHYgJiYgdi5vYmogJiYgdHlwZW9mKHYub2JqLl9yZXR1cm4pPT09J3N0cmluZycgJiYgdi5vYmouX3JldHVybi5pbmRleE9mKCdfX3JldXNlZDogMScpPjApIHJldHVybjsNCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIGxldCBvSGFzaCA9IG9wdGlvbnMuYkhhc2g/W3RoaXMuX3RvSGFzaChudWxsLCB7bm9Db2RlOiB0cnVlLCBvbmx5VW5pcXVlOiB0cnVlLCBub0FyZ3M6IHRydWUsIF9tYXA6IG9wdGlvbnMuYk1hcCwgbm9UeXBlczogZmFsc2V9LCAiPCU9bU5hbWUlPiIpXTpPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihrID0+IGs9PSdJZCcgfHwgay5pbmRleE9mKCdfXycpPT0wKS5tYXAoayA9PiB7dHJ5e3JldHVybiB7IFtrXTogSlNPTi5wYXJzZShyZXRba10pIH07IH1jYXRjaChleCl7cmV0dXJuIHtba106IHJldFtrXX07IH0gfSk7DQogICAgICAgICAgICAgICAgICAgIGxldCBlUmV0ID0gT2JqZWN0LmFzc2lnbiguLi5vSGFzaCwge19fcmV1c2VkOiB2LnJldXNlZH0gKTsNCiAgICAgICAgICAgICAgICAgICAgaWYoQXJyYXkuaXNBcnJheShlUmV0Ll9fa2V5cykpIGVSZXQuX19rZXlzLmZvckVhY2goZWsgPT4ge3RyeXsgZVJldFtla10gPSBKU09OLnBhcnNlKHJldFtla10pO31jYXRjaChleCl7ZVJldFtla10gPSByZXRbZWtdOyB9IH0pOw0KDQogICAgICAgICAgICAgICAgICAgIHYub2JqID0ge19yZXR1cm46IEpTT04uc3RyaW5naWZ5KGVSZXQpfTsNCiAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgIF9USElTOiAob2JqLCBlYUNvZGUsIHYpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgaWYob3B0aW9ucy5iTWFwKSByZXR1cm47DQogICAgICAgICAgICAgICAgICAgIG9iai5USElTID0gdGhpcy5fVEhJUy5tYXAodCA9PiB0LjwlPW1OYW1lJT4ob3B0aW9ucywgYCR7c1BhdGh9LiR7ZWFDb2RlfWApKTsNCiAgICAgICAgICAgICAgICAgICAgb2JqLk9QRVJBVE9SUyA9IG9iai5PUEVSQVRPUlMgfHwge307DQogICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICBJZDogKG9iaiwgaWRDb2RlLCB2KSA9PiBvYmpbaWRDb2RlXSA9IGAiJHt2fSJgLA0KICAgIDwlIGMuRW50aXR5QXR0cmlidXRlcy5maWx0ZXIoZWEgPT4gIWVhLkVudGl0eU1ldGhvZCkuZm9yRWFjaChlYSA9PiB7ICU+DQogICAgICAgICAgICAgICAgPCU9bk5hbWUoZWEpJT46IChvYmosIGVhQ29kZSwgdikgPT4gew0KICAgICAgICA8JSBpZihlYS5Jc1VuaXF1ZSl7JT4NCiAgICAgICAgICAgICAgICAgICAgaWYob2JqLl9fa2V5cykgb2JqLl9fa2V5cy5wdXNoKGVhQ29kZSk7DQogICAgICAgIDwlIH0lPg0KICAgICAgICANCiAgICAgICAgPCUgaWYoZWEuSXNUZXh0KXslPg0KICAgICAgICAgICAgICAgICAgICBpZighPCU9X2I2NHRlc3QoJ3YnKSU+KXsgLy8gaXMgbm90IGJhc2U2ND8NCiAgICAgICAgICAgICAgICAgICAgICAgIHYgPSB0aGlzLl9idG9hKHYpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgIDwlIH1lbHNlIGlmKGVhLklzRGF0ZSl7JT4NCiAgICAgICAgICAgICAgICAgICAgdiA9IHYmJnYudG9JU09TdHJpbmc/di50b0lTT1N0cmluZygpOnY7DQogICAgICAgIDwlIH0lPg0KICAgICAgICANCiAgICAgICAgPCUgaWYoZWEuRW50aXR5VHlwZSl7JT4NCiAgICAgICAgICAgICAgICAgICAgb2JqW2VhQ29kZV0gPSB2P3YuPCU9bU5hbWUlPihvcHRpb25zLCBgJHtzUGF0aH0uJHtlYUNvZGV9YCk6J251bGwnOw0KICAgICAgICA8JSB9ZWxzZSBpZihlYS5Jc0Jvb2wgfHwgZWEuSXNJbnQgfHwgZWEuSXNMb25nIHx8IGVhLklzRmxvYXQgfHwgZWEuSXNEb3VibGUpeyU+DQogICAgICAgICAgICAgICAgICAgIG9ialtlYUNvZGVdID0gdHJNYXAob2JqLCBlYUNvZGUsIHYsIHNQYXRoKTsNCiAgICAgICAgPCUgfWVsc2V7JT4NCiAgICAgICAgICAgICAgICAgICAgb2JqW2VhQ29kZV0gPSAnIicgKyB0ck1hcChvYmosIGVhQ29kZSwgdiwgc1BhdGgpICsgJyInOw0KICAgICAgICA8JSB9JT4NCiAgICAgICAgICAgICAgICB9LA0KICAgIDwlIH0pJT4NCiAgICA8JSBjLlR5cGVkQXR0cmlidXRlcy5maWx0ZXIodGEgPT4gIXRhLkVudGl0eU1ldGhvZCkuZm9yRWFjaCh0YSA9PiB7bGV0IHRhTmFtZSA9IG5OYW1lKHRhKSArICdfJyArIHRhLkVudGl0eUNsYXNzLlBsdXJhbC5yZXBsYWNlKC8gL2csICdfJyk7JT4NCiAgICAgICAgICAgICAgICA8JT10YU5hbWUlPjogKG9iaiwgZWFDb2RlLCB2KSA9PiBvYmpbZWFDb2RlXSA9ICdbJyArICh2IHx8IFtdKS5tYXAoKF92LCBfaSkgPT4gX3YuPCU9bU5hbWUlPihvcHRpb25zLCBgJHtzUGF0aH0uJHtlYUNvZGV9WyR7X2l9XWApKS5maWx0ZXIoX3YgPT4gX3YpLmpvaW4oKSArICddJywNCiAgICA8JSB9KSU+DQogICAgPCUgYy5FbnRpdHlGaWVsZHMuZm9yRWFjaChlZiA9PiB7JT4NCiAgICAgICAgICAgICAgICBlZl88JT1uTmFtZShlZiklPjogKG9iaiwgZWZDb2RlLCB2KSA9PiB7DQogICAgICAgICAgICAgICAgICAgIGlmKEFycmF5LmlzQXJyYXkodikpew0KICAgICAgICAgICAgICAgICAgICAgICAgb2JqW2VmQ29kZV0gPSBKU09OLnN0cmluZ2lmeSh2KTsNCiAgICAgICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgICAgICB2ID0gdHJNYXAob2JqLCBlZkNvZGUsIHYsIHNQYXRoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmKHR5cGVvZih2KT09PSd1bmRlZmluZWQnKSByZXR1cm47DQogICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgPCUgaWYoZWYpeyU+DQogICAgICAgICAgICAgICAgICAgICAgICBpZighPCU9X2I2NHRlc3QoJ3YnKSU+KXsgLy8gaXMgbm90IGJhc2U2ND8NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2ID0gdGhpcy5fYnRvYSh2KTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgPCUgfWVsc2UgaWYoZWYuSXNEYXRlKXslPg0KICAgICAgICAgICAgICAgICAgICAgICAgdiA9IHYmJnYudG9JU09TdHJpbmc/di50b0lTT1N0cmluZygpOnY7DQogICAgICAgIDwlIH0lPg0KDQogICAgICAgICAgICAgICAgICAgICAgICBvYmpbZWZDb2RlXSA9IHY7DQogICAgICAgIDwlIGlmKCFlZi5Jc0Jvb2wgJiYgIWVmLklzSW50ICYmICFlZi5Jc0xvbmcgJiYgIWVmLklzRmxvYXQgJiYgIWVmLklzRG91YmxlKXslPg0KICAgICAgICAgICAgICAgICAgICAgICAgb2JqW2VmQ29kZV0gPSAnIicgKyBvYmpbZWZDb2RlXSArICciJzsNCiAgICAgICAgPCUgfSU+DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9LA0KICAgIDwlIH0pJT4NCg0KICAgICAgICAgICAgICAgIF9fdHJNYXA6IG9iaiA9PiB7DQogICAgICAgICAgICAgICAgICAgIGlmKCFzUGF0aCl7DQogICAgICAgICAgICAgICAgICAgICAgICBvYmouX190ck1hcCA9IDwlPXNjb3BlJT4uX190ck1hcCB8fCBbXTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSA8JT1zY29wZSU+Ll9fdHJNYXA7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9LA0KDQogICAgICAgICAgICAgICAgX3JldHVybjogb2JqID0+IHsNCiAgICAgICAgICAgICAgICAgICAgaWYob2JqKSBvYmouX3JldHVybiA9IChPYmplY3Qua2V5cyhvYmp8fHt9KS5sZW5ndGgpPygneycgKyBPYmplY3Qua2V5cyhvYmopLmZpbHRlcihrID0+IHR5cGVvZihvYmpba10pPT09InN0cmluZyIpLm1hcChrID0+IGAiJHtrfSI6ICR7b2JqW2tdfWApLmNvbmNhdChPYmplY3Qua2V5cyhvYmopLmZpbHRlcihrID0+IHR5cGVvZihvYmpba10pIT09InN0cmluZyIpLm1hcChrID0+IGAiJHtrfSI6ICR7SlNPTi5zdHJpbmdpZnkob2JqW2tdKX1gKSkuam9pbigpICsgJ30nKTonbnVsbCc7DQogICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIH0sICI8JT1tTmFtZSU+Iiwgb3B0aW9ucywgc1BhdGgpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICByZXQgPSByZXQ/cmV0Ll9yZXR1cm46cmV0Ow0KICAgICAgICAgICAgcmV0ID0gdHlwZW9mKHJldCk9PT0ndW5kZWZpbmVkJz9udWxsOnJldDsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgaWYoIXNQYXRoICYmIHJldCl7DQogICAgICAgICAgICAgICAgcmV0ID0gdGhpcy5fYmVhdXRpZnkocmV0LCAnamF2YXNjcmlwdCcpOw0KICAgICAgICAgICAgICAgIDwlPWxvZygpJT5yZXQpOw0KICAgICAgICAgICAgICAgIGlmKG9wdGlvbnMucGFyc2UpIHJldHVybiBKU09OLnBhcnNlKHJldCk7DQogICAgICAgICAgICAgICAgaWYob3B0aW9ucy5nemlwKSByZXR1cm4gdGhpcy5VdGY4QXJyYXlUb1N0cih0aGlzLl9jb21wcmVzcyhyZXQpKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgcmV0dXJuIHJldDsNCiAgICAgICAgfWNhdGNoKGV4KXsNCiAgICAgICAgICAgIDwlPWVycm9yKCklPmV4KTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIGFzeW5jIDwlPW1OYW1lPSdfdG9Eb2N1bWVudCclPihvcHRpb25zPXt9KXsNCiAgICAgICAgdHJ5ew0KICAgICAgICAgICAgbGV0IGpzb24gPSB0aGlzLl90b0pTT04ob3B0aW9ucyk7DQogICAgICAgICAgICBsZXQgb0pTT04gPSBKU09OLnBhcnNlKGpzb24pOw0KICAgICAgICAgICAgbGV0IHRyTWFwID0gb0pTT04uX190ck1hcCB8fCBbXTsNCiAgICAgICAgICAgIGRlbGV0ZSBvSlNPTi5fX3RyTWFwOw0KICAgICAgICAgICAganNvbiA9IEpTT04uc3RyaW5naWZ5KG9KU09OKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgbGV0IGxvZyA9ICguLi5zKSA9PiA8JT1sb2coKSU+Li4ucyk7DQogICAgICAgICAgICBsZXQgd2FybiA9ICguLi5zKSA9PiA8JT13YXJuKCklPi4uLnMpOw0KICAgICAgICAgICAgbGV0IGVycm9yID0gKC4uLnMpID0+IDwlPWVycm9yKCklPi4uLnMpOw0KDQogICAgICAgICAgICBmb3IgYXdhaXQgKGNvbnN0IHQgb2YgdHJNYXApew0KICAgICAgICAgICAgICAgIGlmKCFuZXcgUmVnRXhwKHQuaWQpLnRlc3QoanNvbikpIGNvbnRpbnVlOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIGxldCB0cm4gPSB0aGlzLl9hdG9iKHQudHJhbnNmb3JtKTsNCiAgICAgICAgICAgICAgICB0cnl7DQogICAgICAgICAgICAgICAgICAgIG9KU09OID0gSlNPTi5wYXJzZShqc29uKTsNCiAgICAgICAgICAgICAgICAgICAgbGV0IHJlcyA9IHVuZGVmaW5lZDsNCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIGlmKHRybi5zdGFydHNXaXRoKCJzKCIpICYmIHRybi5lbmRzV2l0aCgiKSIpKXsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJlcyA9IHRoaXMucnVuU2NyaXB0KGAob0pTT04sIG9TY29wZSwgbG9nLCB3YXJuLCBlcnJvcikgPT4gJHt0cm4uc3Vic3RyaW5nKDIsIHRybi5sZW5ndGgtMSl9YCkob0pTT04sIDwlPXNjb3BlJT4sIGxvZywgd2FybiwgZXJyb3IpOw0KICAgICAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vcmVzID0gYXdhaXQganNvbmF0YSh0cm4pLmV2YWx1YXRlKG9KU09OKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgLy88JT13YXJuKCklPnQuaWQsIHJlcywgdHJuKTsNCiAgICAgICAgICAgICAgICAgICAganNvbiA9IGpzb24ucmVwbGFjZShuZXcgUmVnRXhwKHQuaWQsICJnIiksICghQXJyYXkuaXNBcnJheShyZXMpICYmIHR5cGVvZihyZXMpIT09J29iamVjdCcpP3Jlczp0aGlzLl9idG9hKEpTT04uc3RyaW5naWZ5KHJlcykpKTsNCiAgICAgICAgICAgICAgICB9Y2F0Y2goZXgpew0KICAgICAgICAgICAgICAgICAgICA8JT13YXJuKCklPnQuaWQsIHRybiwgZXgpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgLy8ganNvbiA9IGpzb24ucmVwbGFjZSgvIl9fdHJNYXAiOlxzXFtce1tePj5dK1x9XF0vZ20sICciX190ck1hcCI6ICIiJyk7DQoNCiAgICAgICAgICAgIHJldHVybiBvcHRpb25zLmJKU09OP3RoaXMuX2JlYXV0aWZ5KGpzb24sICdqYXZhc2NyaXB0Jyk6SlNPTi5wYXJzZShqc29uKTsNCiAgICAgICAgfWNhdGNoKGV4KXsNCiAgICAgICAgICAgIDwlPWVycm9yKCklPmV4KTsNCiAgICAgICAgfQ0KICAgIH0NCg0KPCUNCl9jbG9uZUZ1bmN0aW9uID0gKG8sIGYsIHNjb3BlLCBjKSA9PiB7DQoNCiAgICBsZXQgb2JqID0gbnVsbDsNCiAgICBpZihvPT0nc3InICYmIHR5cGVvZihzcikhPT0ndW5kZWZpbmVkJykgb2JqID0gc3I7DQogICAgaWYobz09J19GckVNRCcgJiYgdHlwZW9mKF9GckVNRCkhPT0ndW5kZWZpbmVkJykgb2JqID0gX0ZyRU1EOw0KICAgIA0KICAgIGxldCBjb2RlID0gb2JqW2ZdID8gb2JqW2ZdLnRvU3RyaW5nKCkgOiBgICAgJHtmfSgpew0KICAgICAgICBjb25zb2xlLmxvZygnRXJyb3IgaW4gX2Nsb25lRnVuY3Rpb24oJHtvfSwgJHtmfSk6IEludmFsaWQgRnVuY3Rpb24gTmFtZScpOw0KICAgIH1gOw0KICAgIGxldCBzID0gY29kZS5yZXBsYWNlKCcpJywgJykgPT4gJyk7DQogICAgaWYgKHMuaW5kZXhPZignZnVuY3Rpb24nKSA9PSAwIHx8IHMuaW5kZXhPZignYXN5bmMgZnVuY3Rpb24nKSA9PSAwKSB7DQogICAgCXMgPSBzLnJlcGxhY2UoJ2Z1bmN0aW9uJywgJyAnKTsNCiAgICB9IGVsc2Ugew0KICAgIAlzID0gcy5yZXBsYWNlKGYsICcnKTsNCiAgICB9DQoNCiAgICBpZiAoYy5Jc01haW4gJiYgIW9ialtmXSkgew0KICAgIAljb25zb2xlLmxvZygnRXJyb3IgaW4gX2Nsb25lRnVuY3Rpb24oKTogSW52YWxpZCBGdW5jdGlvbiBOYW1lICcgKyBmKTsNCiAgICB9DQoNCiAgICByZXR1cm4gYA0KICAgICR7Zn0oLi4ucGFyYW1zKXsNCiAgICAgICAgaWYodHlwZW9mKHdpbmRvdykhPT0idW5kZWZpbmVkIiAmJiB0eXBlb2Yod2luZG93LiR7b30pIT09InVuZGVmaW5lZCIpew0KICAgICAgICAgICAgcmV0dXJuIHdpbmRvdy4ke299LiR7Zn0oLi4ucGFyYW1zKTsNCiAgICAgICAgfWVsc2V7DQogICAgICAgICAgICBgICsgKGMuSXNNYWluID8gYHJldHVybiAoJHtzfSkoLi4ucGFyYW1zKTtgIDogYHJldHVybiBuZXcgJHtzY29wZX0uJHtuTmFtZShtYWluQ2xhc3MoKSl9KCkuJHtmfSguLi5wYXJhbXMpO2ApICsgYA0KICAgICAgICB9DQoJfQ0KICAgIGA7DQp9Ow0KDQoNClt7DQogICAgd09iajogJ3NyJywNCiAgICBmdW5jdGlvbnM6IFsnaGFzaENvZGUnLCAnRXF1YWxzJywgJ3NlcnZlckRhdGUnLCAnX19zY29wZScsICdhZGRNU2Vjb25kcycsICdpcEFkZHJlc3MnXS5jb25jYXQobWFpbkNsYXNzKFsnQklTZXJ2ZXInXSk/WydfJywgJ2J1aWxkVVJMJywgJyRfUkVRVUVTVCcsICdwYXJhbScsICdfdG9YTUwnLCAnY29vcCcsICdPUicsICdteVJlcGxhY2UnLCAnc2VuZFhNTCcsICdwcm9jZXNzUmVzcG9uc2UnLCAncHJvY2Vzc1Jlc3VsdCcsICdydW5TUlNjcmlwdCcsICdncm91cEJ5JywgJ1Nob3dEZWJ1ZycsICdjYWNoZVJlc3VsdCcsICd0b0hleCcsICdTaG93RXJyb3InXTpbXSksDQp9LCB7DQogICAgd09iajogJ19GckVNRCcsDQogICAgZnVuY3Rpb25zOiBbJ19hdHRyJywgJ3J1blNjcmlwdCcsICdfdW5pcXVlJywgJ3NyJywgJ19hdG9iJywgJ19nZXRTdG9yZWRTY3JpcHQnLCAnX2J0b2EnLCAnX190aW1lJywgJ193YWl0JywgJ19zcWxUeXBlJywgJ191dWlkJywgJ3JlcXVpcmUnLCAnX2luY2x1ZGUnLCAnX2JlYXV0aWZ5JywgJ19pbmplY3QnLCAnX2NvbXByZXNzJywgJ19kZWNvbXByZXNzJywgJ1V0ZjhBcnJheVRvU3RyJywgJ3JhbmRVUkwnXSwNCn1dLmZvckVhY2goY2MgPT4geyAlPg0KLyogU1RBUlQ6IDwlPWNjLndPYmolPiBmdW5jdGlvbiBjb3BpZXMgKi8NCjwlIGNjLmZ1bmN0aW9ucy5mb3JFYWNoKGYgPT4geyU+DQoNCi8qIENMT05FOjpTVEFSVDogPCU9Y2Mud09iaiU+LjwlPWYlPigpICovPCU9X2Nsb25lRnVuY3Rpb24oY2Mud09iaiwgZiwgc2NvcGUsIGMpICU+LyogQ0xPTkU6OkVORCAgOiA8JT1jYy53T2JqJT4uPCU9ZiU+KCkgKi8NCjwlIH0pJT4NCi8qIEVORDogPCU9Y2Mud09iaiU+IGZ1bmN0aW9uIGNvcGllcyAqLw0KPCUgfSk7ICU+DQogICAgDQogICAgPCU9bU5hbWU9J2kxOG4nJT4oZXYsIHYpew0KICAgICAgICBpZih0eXBlb2Yod2luZG93KT09PSJ1bmRlZmluZWQiIHx8IHR5cGVvZih3aW5kb3cuaTE4bl9zdG9yZSk9PT0idW5kZWZpbmVkIikgcmV0dXJuIHY7DQogICAgICAgIA0KICAgICAgICBpZighZXYuRW50aXR5QXR0cmlidXRlLklzVGV4dCAmJiAhZXYuRW50aXR5QXR0cmlidXRlLklzU3RyaW5nKXsNCiAgICAgICAgICAgIHJldHVybiB2Ow0KICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgIHJldHVybiB3aW5kb3cuaTE4bl9zdG9yZVt0aGlzLmhhc2hDb2RlKHYpXSA9IHdpbmRvdy5pMThuX3N0b3JlW3RoaXMuaGFzaENvZGUodildIHx8IHY7DQogICAgICAgIH0NCiAgICB9DQoNCjwlIGMuRW50aXR5QXR0cmlidXRlcy5maWx0ZXIoZWEgPT4gIWVhLkVudGl0eU1ldGhvZCAmJiBlYS5FbnRpdHlUeXBlKS5mb3JFYWNoKGVhID0+IHslPg0KICAgIDwlPW1OYW1lPSdieScgKyBuTmFtZShlYS5FbnRpdHlUeXBlKSU+KGFyKSB7DQogICAgICAgIHZhciByZXQgPSBbXTsNCiAgICAgICAgYXIuZm9yRWFjaChhID0+IHsNCiAgICAgICAgICAgIHJldC5mb3JFYWNoKHIgPT4gew0KICAgICAgICAgICAgICAgIGlmIChhWyJfPCU9bk5hbWUoZWEpJT4iXSAmJiAoYVsiXzwlPW5OYW1lKGVhKSU+Il0uRXF1YWxzP2FbIl88JT1uTmFtZShlYSklPiJdLkVxdWFscyhyKTpzci5FcXVhbHMoYVsiXzwlPW5OYW1lKGVhKSU+Il0sIHIpKSkgew0KICAgICAgICAgICAgICAgICAgICByLl88JT1uTmFtZShlYSklPl88JT1jLlBsdXJhbC5yZXBsYWNlKC8gL2csICdfJyklPi5wdXNoKGEpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9KTsNCiAgICAgICAgcmV0dXJuIHJldDsNCiAgICB9DQo8JSB9KSU+DQoNCiAgICA8JT1tTmFtZT0nZ2V0IF9Ub1N0cmluZyclPigpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMudG9TdHJpbmcoKTsNCiAgICB9DQogICAgDQogICAgPCU9bU5hbWU9J3RvU3RyaW5nJyU+KCkgew0KICAgICAgICBsZXQgcmV0ID0gW107DQo8JSBjLkVudGl0eUF0dHJpYnV0ZXMuZmlsdGVyKGVhID0+ICFlYS5FbnRpdHlNZXRob2QgJiYgZWEuSXNVbmlxdWUpLmZvckVhY2goZWEgPT4geyU+DQogICAgICAgIGlmKHRoaXMuXzwlPW5OYW1lKGVhKSU+X3NldCAmJiA8JXZhbHVlT2YoZWEuSXNVbmlxdWUpJT4pIHJldC5wdXNoKHRoaXMuPCU9bk5hbWUoZWEpJT4oKTwlaWYoZWEuRW50aXR5VHlwZSl7JT4uPCU9bU5hbWUlPigpPCV9JT4pOw0KPCUgfSklPg0KICAgICAgICByZXR1cm4gcmV0LmpvaW4oJy0nKTsNCiAgICB9DQoNCiAgICA8JT1tTmFtZT0nRW50aXR5VmFsdWUnJT4oYU5hbWUpIHsNCiAgICAgICAgbGV0IHJldCA9IFtdLmNvbmNhdCh0aGlzLkVudGl0eVZhbHVlcywgdGhpcy5WYWx1ZUVudGl0aWVzKS5maW5kKGV2ID0+IGV2LkVudGl0eUF0dHJpYnV0ZSAmJiBldi5FbnRpdHlBdHRyaWJ1dGUuTmFtZSA9PSBhTmFtZSk7DQogICAgICAgIA0KICAgICAgICBpZighcmV0KXsNCiAgICAgICAgICAgIC8vIGFuIGF0dHJpYnV0ZSB0aGF0IGhhcyB5ZXQgbm8ga25vd24gZW50aXR5IHZhbHVlDQogICAgICAgICAgICByZXQgPSB7QWN0aXZlOiB0cnVlLCBPUEVSQVRPUlM6IHt9LCBFbnRpdHlBdHRyaWJ1dGU6IHtOYW1lOiBhTmFtZSwgQWN0aXZlOiB0cnVlLCBFbnRpdHlDbGFzczoge0lkOiB0aGlzLkVudGl0eUNsYXNzLklkfX19Ow0KICAgICAgICAgICAgdGhpcy5FbnRpdHlWYWx1ZXMucHVzaChyZXQpOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICByZXR1cm4gcmV0Ow0KICAgIH0NCg0KICAgIGFzeW5jIDwlPW1OYW1lPSdmaW5kJyU+KGRlcHRoID0gMSwgb2JqcywgZmllbGRzKSB7DQogICAgICAgIHJldHVybiAoYXdhaXQgdGhpcy5maW5kQWxsKGRlcHRoLCBvYmpzLCBudWxsLCBudWxsLCBmaWVsZHMpKVswXTsNCiAgICB9DQoNCiAgICA8JT1tTmFtZT0nX19hc3NlcnRWYWxpZCclPihiU3luYyl7DQo8JSBpZighYy5Ub29scy5sZW5ndGgpeyU+DQogICAgICAgIHJldHVybiB0cnVlOw0KPCUgfWVsc2V7JT4NCiAgICAgICAgbGV0IGVycm9yID0ge307DQoNCiAgICA8JSBjLkVudGl0eUF0dHJpYnV0ZXMuZmlsdGVyKGVhID0+ICFlYS5FbnRpdHlNZXRob2QgJiYgZWEuUmVxdWlyZWQpLmZvckVhY2goZWEgPT4geyU+DQogICAgICAgIGlmKDwldmFsdWVPZihlYS5SZXF1aXJlZCklPil7DQogICAgICAgICAgICBlcnJvci48JT1uTmFtZShlYSklPiA9IHt9Ow0KICAgICAgICAgICAgaWYoIXRoaXMuXzwlPW5OYW1lKGVhKSU+X3NldCkgZXJyb3IuPCU9bk5hbWUoZWEpJT5bIjAxIl0gPSAiTm90IFNldCI7DQogICAgICAgIDwlIGlmKGVhLkVudGl0eVR5cGUpeyU+DQogICAgICAgICAgICBpZighdGhpcy48JT1uTmFtZShlYSklPigpKSBlcnJvci48JT1uTmFtZShlYSklPlsiMDIiXSA9ICJFbXB0eSBWYWx1ZSI7DQogICAgICAgICAgICBpZih0aGlzLjwlPW5OYW1lKGVhKSU+KCkgJiYgYlN5bmMgJiYgIXRoaXMuPCU9bk5hbWUoZWEpJT4oKS5fX3N5bmNfb24oKSkgZXJyb3IuPCU9bk5hbWUoZWEpJT5bIjAzIl0gPSAiTm90IGluIFN5bmMiOw0KICAgICAgICA8JSB9JT4NCiAgICAgICAgICAgIGlmKCFPYmplY3Qua2V5cyhlcnJvci48JT1uTmFtZShlYSklPikubGVuZ3RoKSBkZWxldGUgZXJyb3IuPCU9bk5hbWUoZWEpJT47DQogICAgICAgIH0NCiAgICA8JSB9KSU+DQoNCiAgICAgICAgaWYoT2JqZWN0LmtleXMoZXJyb3IpLmxlbmd0aCl7DQogICAgICAgICAgICB0aGlzLl9fYXNzZXJ0RXJyb3IgPSBlcnJvcjsNCiAgICAgICAgICAgIDwlPWVycm9yKCklPkpTT04uc3RyaW5naWZ5KGVycm9yLG51bGwsNCksIHRoaXMuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH1lbHNlew0KICAgICAgICAgICAgZGVsZXRlIHRoaXMuX19hc3NlcnRFcnJvcjsNCiAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICB9DQo8JSB9JT4NCiAgICB9DQoNCiAgICA8JT1tTmFtZT0nX3JhbmsnJT4oXzwlPW1OYW1lJT49MCl7DQoJCXRyeSB7DQogICAgICAgICAgICByZXR1cm4gdGhpcy5fX2V4cG9ydCh7XzwlPW1OYW1lJT46IF88JT1tTmFtZSU+fSwgew0KICAgICAgICAgICAgICAgIE51bGw6IHRydWUsDQogICAgICAgICAgICAgICAgZXhwb3J0ZXI6IHYgPT4gdi5yZXVzZWQ/di5vYmouX19yZXVzZWQgPSB2LnJldXNlZDowLA0KICAgICAgICAgICAgICAgIElkOiAob2JqLCBpZENvZGUsIHYpID0+IG9ialtpZENvZGVdID0gIjwlPV9jTmFtZShjLCB0cnVlKSU+IiwNCgk8JSBjLkVudGl0eUF0dHJpYnV0ZXMuZmlsdGVyKGVhID0+ICFlYS5FbnRpdHlNZXRob2QgJiYgZWEuRW50aXR5VHlwZSkuZm9yRWFjaChlYSA9PiB7JT4NCiAgICAgICAgICAgICAgICA8JT1uTmFtZShlYSklPjogKG9iaiwgZWFDb2RlLCB2KSA9PiBvYmouXzwlPW1OYW1lJT4gKz0gKG9ialtlYUNvZGVdID0gKHYgfHwgbmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKGVhLkVudGl0eVR5cGUsIHRydWUpJT4oKSkuPCU9bU5hbWUlPihfPCU9bU5hbWUlPisxKSkuXzwlPW1OYW1lJT4sDQoJPCUgfSklPg0KICAgIDwlIGMuVHlwZWRBdHRyaWJ1dGVzLmZpbHRlcih0YSA9PiAhdGEuRW50aXR5TWV0aG9kKS5mb3JFYWNoKHRhID0+IHtsZXQgdGFOYW1lID0gbk5hbWUodGEpICsgJ18nICsgdGEuRW50aXR5Q2xhc3MuUGx1cmFsLnJlcGxhY2UoLyAvZywgJ18nKTslPg0KICAgICAgICAgICAgICAgIDwlPXRhTmFtZSU+OiAob2JqLCB0YUNvZGUsIHYpID0+IChvYmpbdGFDb2RlXSA9IFtuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUodGEuRW50aXR5VHlwZSwgdHJ1ZSklPigpXS5tYXAoX3YgPT4gX3YuPCU9bU5hbWUlPihfPCU9bU5hbWUlPisxKSkpLmZvckVhY2godiA9PiB2Ll88JT1tTmFtZSU+KSwNCiAgICA8JSB9KSU+DQoJICAgICAgICB9LCAiPCU9bU5hbWUlPiIpOw0KCQl9IGNhdGNoIChleCkgew0KCQkJPCU9ZXJyb3IoKSU+ZXgpOw0KCQl9DQoJfQ0KDQogICAgPCU9bU5hbWU9J19pc1F1ZXJ5JyU+KCl7DQogICAgICAgIGxldCByZXQgPSB0aGlzLl9fZXhwb3J0KC8qX190eXBlKi97SWQ6ICI8JT1uTmFtZShjKSU+IiwgPCU9bU5hbWUlPkNvdW50OiAwfSwgew0KICAgICAgICAgICAgTnVsbDogdHJ1ZSwNCiAgICA8JSBjLkVudGl0eUF0dHJpYnV0ZXMuZmlsdGVyKGVhID0+ICFlYS5FbnRpdHlNZXRob2QpLmZvckVhY2goZWEgPT4geyAlPg0KICAgICAgICAgICAgPCU9bk5hbWUoZWEpJT46IChvYmosIGVhQ29kZSwgdikgPT4gew0KICAgICAgICAgICAgICAgIG9ialtlYUNvZGVdID0ge19jb29wOiB0aGlzLl88JT1uTmFtZShlYSklPl9jb29wIHx8IHVuZGVmaW5lZH07DQogICAgICAgICAgICAgICAgb2JqLjwlPW1OYW1lJT5Db3VudCArPSB0eXBlb2Yob2JqW2VhQ29kZV0uX2Nvb3ApPT09InVuZGVmaW5lZCI/MDoxOw0KICAgICAgICAgICAgICAgIGlmKHYgJiYgdi48JT1tTmFtZSU+KXsNCiAgICAgICAgICAgICAgICAgICAgb2JqW2VhQ29kZV0uX29iamVjdCA9IHYuPCU9bU5hbWUlPigpOw0KICAgICAgICAgICAgICAgICAgICBvYmouPCU9bU5hbWUlPkNvdW50ICs9IG9ialtlYUNvZGVdLl9vYmplY3QuPCU9bU5hbWUlPkNvdW50Ow0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0sDQogICAgPCUgfSk7ICU+DQogICAgPCUgYy5UeXBlZEF0dHJpYnV0ZXMuZmlsdGVyKHRhID0+ICF0YS5FbnRpdHlNZXRob2QpLmZvckVhY2godGEgPT4ge2xldCB0YU5hbWUgPSBuTmFtZSh0YSkgKyAnXycgKyB0YS5FbnRpdHlDbGFzcy5QbHVyYWwucmVwbGFjZSgvIC9nLCAnXycpOyU+DQogICAgICAgICAgICA8JT10YU5hbWUlPjogKG9iaiwgdGFDb2RlLCB2KSA9PiB7DQogICAgICAgICAgICAgICAgb2JqW3RhQ29kZV0gPSB7X2Nvb3A6IHRoaXMuXzwlPXRhTmFtZSU+X2Nvb3AgfHwgdW5kZWZpbmVkLCBfb2JqZWN0czogKHZ8fFtdKS5tYXAoX3YgPT4gX3YuPCU9bU5hbWUlPigpKX07DQogICAgICAgICAgICAgICAgaWYob2JqW3RhQ29kZV0uX29iamVjdHMubGVuZ3RoKSBvYmpbdGFDb2RlXS48JT1tTmFtZSU+Q291bnQgKz0gb2JqW3RhQ29kZV0uX29iamVjdHMucmVkdWNlKCh2LCBvKSA9PiB2ICs9IG8uPCU9bU5hbWUlPkNvdW50KTsNCiAgICAgICAgICAgIH0sDQogICAgPCUgfSklPg0KICAgICAgICB9LCAiPCU9bU5hbWUlPiIpOw0KICAgICAgICANCiAgICAgICAgcmV0dXJuIHJldDsNCiAgICB9DQogICAgDQogICAgPCU9bU5hbWU9J19uZXcnJT4oY2xOYW1lLCB0b29sKXsNCjwlIGlmKG1haW5DbGFzcygpIT1jKXslPg0KICAgICAgICByZXR1cm4gbmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKG1haW5DbGFzcygpLCB0cnVlKSU+KCkuPCU9bU5hbWUlPihjbE5hbWUsIHRvb2wpOw0KPCUgfWVsc2V7JT4NCiAgICAgICAgdHJ5ew0KICAgICAgICAgICAgc3dpdGNoKGNsTmFtZSl7DQogICAgPCUgYXJDbGFzc2VzLmZvckVhY2goX2MgPT4geyU+DQogICAgICAgICAgICAgICAgY2FzZSAiPCU9bk5hbWUoX2MpJT4iOg0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IDwlPXNjb3BlJT4uPCU9X2NOYW1lKF9jLCB0cnVlKSU+KHVuZGVmaW5lZCwgdG9vbCk7DQogICAgPCUgfSklPg0KICAgICAgICAgICAgfQ0KICAgICAgICB9Y2F0Y2goZXgpew0KICAgICAgICAgICAgPCU9ZXJyb3IoKSU+ZXgpOw0KICAgICAgICB9DQo8JSB9JT4NCiAgICB9DQogICAgDQogICAgYXN5bmMgPCU9bU5hbWU9J3N0b3JlJyU+KCkgew0KICAgICAgICBsZXQgcmVzdWx0cyA9IGF3YWl0IHRoaXMuX2V4ZWN1dGUobnVsbCwgPCU9YWxpYXMoKSU+LCAiPCU9bU5hbWUlPiIsIDwlbVJvdXRpbmcoYyklPiwgYXN5bmMgKCkgPT4gew0KICAgICAgICAgICAgLyoqKiBTVEFSVCBMT0NBTCA8JT1tTmFtZSU+KCkgKioqLw0KICAgICAgICAgICAgDQogICAgICAgIGxldCBiVXBkYXRlID0gZmFsc2U7DQogICAgICAgIGxldCBiSW5zZXJ0ID0gZmFsc2U7DQoNCiAgICAgICAgaWYodGhpcy5fX2NvbmZpZygnc3RvcmUuZGlzYWJsZWQnKSl7DQogICAgICAgICAgICA8JT13YXJuKCklPiJzdG9yaW5nIGRpc2FibGVkIik7DQogICAgICAgIH1lbHNlIGlmKHRoaXMuX2lzUXVlcnkoKS5faXNRdWVyeUNvdW50KXsNCiAgICAgICAgICAgIDwlPXdhcm4oKSU+IkNhbm5vdCBzdG9yZSBhIHF1ZXJ5ISIpOw0KICAgICAgICB9ZWxzZSBpZighdGhpcy5fX3N5bmNfb24oKSB8fCA8JT1fRnJFTUQuX3RvSlMoX2ZpbGVUb29scyklPi5pbmRleE9mKHRoaXMuVG9vbC50eXBlLm5hbWUpPj0wKXsNCiAgICAgICAgICAgIGxldCBfdGhpcyA9IG5ldyA8JT1zY29wZSU+LjwlPW5OYW1lKGMsIHRydWUpJT4oKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgbGV0IGJGaW5kID0gZmFsc2U7DQogICAgICAgICAgICBpZih0aGlzLklkPT10aGlzLklkKXsNCiAgICAgICAgICAgICAgICBiRmluZCA9IHRydWU7DQogICAgICAgICAgICAgICAgX3RoaXMuSWQgPSB0aGlzLklkOw0KICAgICAgICAgICAgfQ0KPCUgYy5FbnRpdHlBdHRyaWJ1dGVzLmZpbHRlcihlYSA9PiBlYS5Jc1VuaXF1ZSkuZm9yRWFjaChlYSA9PiB7JT4NCiAgICAgICAgICAgIGlmKDwldmFsdWVPZihlYS5Jc1VuaXF1ZSklPil7DQogICAgICAgICAgICAgICAgYkZpbmQgPSB0cnVlOw0KICAgICAgICAgICAgICAgIF90aGlzLjwlPW5OYW1lKGVhKSU+KHRoaXMuPCU9bk5hbWUoZWEpJT4oKSwgJz0nKTsNCiAgICAgICAgICAgIH0NCjwlIH0pOyAlPg0KDQogICAgICAgICAgICBpZihiRmluZCl7DQogICAgICAgICAgICAgICAgX3RoaXMgPSBhd2FpdCBfdGhpcy5maW5kKCk7DQogICAgICAgICAgICB9ZWxzZSBfdGhpcyA9IG51bGw7DQogICAgICAgICAgICBpZihfdGhpcyl7DQogICAgICAgICAgICAgICAgdGhpcy5JZCA9IF90aGlzLklkOw0KICAgICAgICAgICAgICAgIHRoaXMuX19zeW5jX29uKF90aGlzLl9fc3luY19vbigpKTsNCiAgICAgICAgICAgICAgICA8JT1sb2coKSU+Il90aGlzLklkIiwgX3RoaXMuSWQsIHRoaXMuSWQsIF90aGlzLlRvb2wubmFtZSwgdGhpcy5Ub29sLm5hbWUpOw0KICAgICAgICAgICAgICAgIGJVcGRhdGUgPSB0cnVlOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgdGhpcy5JZCA9IHRoaXMuSWQ7IC8vIHRvIGVuZm9yY2UgdGhlIElkIGFuZCBub3QgZ2V0IGEgbmV3IG9uZSBldmVyeSB0aW1lDQogICAgICAgICAgICAgICAgYkluc2VydCA9IHRydWU7DQogICAgICAgICAgICB9DQogICAgICAgIH1lbHNlIGlmKE1hdGguYWJzKCh0aGlzLlNldF9Pbi5nZXRUaW1lKCkgLSB0aGlzLl9fc3luY19vbigpLmdldFRpbWUoKSkgLyAxMDAwKSA8IHRoaXMuX19jb25maWcoJ3N0b3JlLnNlbnNpdGl2aXR5JywgNSkpew0KICAgICAgICAgICAgPCU9bG9nKCklPiJBbHJlYWR5IHN0b3JlZCIsIE1hdGguYWJzKCh0aGlzLlNldF9Pbi5nZXRUaW1lKCkgLSB0aGlzLl9fc3luY19vbigpLmdldFRpbWUoKSkgLyAxMDAwKSArIjwiK3RoaXMuX19jb25maWcoJ3N0b3JlLnNlbnNpdGl2aXR5JywgNSkpOw0KICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgIGJVcGRhdGUgPSB0cnVlOw0KICAgICAgICB9DQoNCiAgICAgICAgaWYoIWJVcGRhdGUgJiYgIWJJbnNlcnQpew0KICAgICAgICAgICAgPCU9bG9nKCklPiJObyBkYXRhIGNoYW5nZXMiKTsNCiAgICAgICAgfWVsc2V7DQo8JSBjbHNUb29scyhjKS5mb3JFYWNoKHQgPT4geyU+DQogICAgICAgICAgICBpZih0aGlzLlRvb2wudHlwZS5uYW1lPT0iPCU9dCU+Iil7DQogICAgPCUgaWYodD09IlNxbERCIil7ICU+DQogICAgICAgICAgICAgICAgaWYodHlwZW9mKDwlPXNjb3BlJT4uX19zcWxUcmFuc2FjdGlvbik9PT0idW5kZWZpbmVkIiB8fCA8JT1zY29wZSU+Ll9fc3FsVHJhbnNhY3Rpb24uZW5kKXsNCiAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5fc3FsKGAke3RoaXMuX19jb25maWcoJ3R5cGUnKT09J3NxbGl0ZSc/J0JFR0lOJzonU1RBUlQnfSBUUkFOU0FDVElPTmApOw0KICAgICAgICAgICAgICAgICAgICA8JT1zY29wZSU+Ll9fc3FsVHJhbnNhY3Rpb24gPSB7T3duZXI6IHRoaXMsIHNxbHM6IFtdLCBzdGFydDogbmV3IERhdGUoKSwgZW5kOiBudWxsfTsNCiAgICAgICAgICAgICAgICB9DQogICAgPCUgfSU+DQogICAgICAgICAgICB9DQo8JSB9KSU+DQoNCiAgICAgICAgICAgIHRoaXMuX2RlZmF1bHRzKCk7DQoNCiAgICAgICAgICAgIGlmKHRoaXMuX19jb25maWcoIlN5bmNFbnRpdHlBdHRyaWJ1dGVzIikpew0KPCUgYy5FbnRpdHlBdHRyaWJ1dGVzLmZpbHRlcihlYSA9PiAhZWEuRW50aXR5TWV0aG9kICYmIGVhLkVudGl0eVR5cGUpLmZvckVhY2goZWEgPT4geyU+DQogICAgICAgICAgICAgICAgaWYodGhpcy48JT1uTmFtZShlYSklPigpICYmICEoYXdhaXQgdGhpcy48JT1uTmFtZShlYSklPigpLjwlPW1OYW1lJT4oKSkpIHRoaXMuY2xlYXJfPCU9bk5hbWUoZWEpJT4oKTsNCjwlIH0pOyAlPg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZighdGhpcy5fX2Fzc2VydFZhbGlkKHRydWUpKSByZXR1cm4gbnVsbDsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgPCU9bG9nKCklPmA9PT0+IEluc2VydDoke2JJbnNlcnR9LCBVcGRhdGU6JHtiVXBkYXRlfSwgSWQ6WyR7dGhpcy5JZH1dYCk7DQogICAgICAgICAgICBpZihiVXBkYXRlKSBhd2FpdCB0aGlzLnVwZGF0ZSgpOw0KICAgICAgICAgICAgaWYoYkluc2VydCkgYXdhaXQgdGhpcy5pbnNlcnQoKTsNCiAgICAgICAgICAgIDwlPWxvZygpJT5gPD09PSBJbnNlcnQ6JHtiSW5zZXJ0fSwgVXBkYXRlOiR7YlVwZGF0ZX0sIElkOlske3RoaXMuSWR9XWApOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBpZih0aGlzLl9fY29uZmlnKCJTeW5jVHlwZWRBdHRyaWJ1dGVzIikpew0KPCUgYy5UeXBlZEF0dHJpYnV0ZXMuZm9yRWFjaCh0YSA9PiB7IGxldCB0YU5hbWUgPSBuTmFtZSh0YSkgKyAnXycgKyB0YS5FbnRpdHlDbGFzcy5QbHVyYWwucmVwbGFjZSgvIC9nLCAnXycpOyU+DQogICAgICAgICAgICAgICAgZm9yIGF3YWl0IChjb25zdCB0YSBvZiB0aGlzLjwlPXRhTmFtZSU+KCkpew0KICAgICAgICAgICAgICAgICAgICA8JT1sb2coKSU+IlN5bmNpbmcuLi48JT10YU5hbWUlPiIsIHRhKTsNCiAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGEuPCU9bU5hbWUlPigpOw0KICAgICAgICAgICAgICAgIH0NCjwlIH0pOyAlPg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZihiVXBkYXRlIHx8IGJJbnNlcnQpew0KPCUgY2xzVG9vbHMoYykuZm9yRWFjaCh0ID0+IHslPg0KICAgICAgICAgICAgICAgIGlmKHRoaXMuVG9vbC50eXBlLm5hbWU9PSI8JT10JT4iKXsNCiAgICA8JSBpZih0PT0iU3FsREIiKXsgJT4NCiAgICAgICAgICAgICAgICAgICAgaWYoPCU9c2NvcGUlPi5fX3NxbFRyYW5zYWN0aW9uICYmICE8JT1zY29wZSU+Ll9fc3FsVHJhbnNhY3Rpb24uZW5kICYmIDwlPXNjb3BlJT4uX19zcWxUcmFuc2FjdGlvbi5Pd25lcj09dGhpcyl7DQogICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLl9zcWwoYENPTU1JVCR7dGhpcy5fX2NvbmZpZygndHlwZScpPT0nc3FsaXRlJz8nIFRSQU5TQUNUSU9OJzonJ31gKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIDwlPXNjb3BlJT4uX19zcWxUcmFuc2FjdGlvbi5lbmQgPSBuZXcgRGF0ZSgpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgPCUgfSU+DQogICAgICAgICAgICAgICAgfQ0KPCUgfSklPg0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgIH0sIHtfX2JlZm9yZVJ1bGVzOiBbPCUoYy5FbnRpdHlSdWxlcyB8fCBbXSkuZmlsdGVyKHIgPT4gclttTmFtZV0gJiYgci5CZWZvcmUpLm1hcChyID0+IHslPjwlPV9GckVNRC5fdG9KUyhyKSU+PCUgfSkuam9pbignLCAnKSU+XSwgX19hZnRlclJ1bGVzOiBbPCUoYy5FbnRpdHlSdWxlcyB8fCBbXSkuZmlsdGVyKHIgPT4gclttTmFtZV0gJiYgci5BZnRlcikubWFwKHIgPT4geyU+PCU9X0ZyRU1ELl90b0pTKHIpJT48JSB9KS5qb2luKCcsICcpJT5dfSk7DQogICAgICAgIA0KICAgICAgICByZXR1cm4gKHJlc3VsdHMuZmluZChyID0+IHIucmV0KSB8fCB7cmV0OiBudWxsfSkucmV0OyAvLyBmaXJzdCBvbmUgdG8gZXhlY3V0ZSBjb3JyZWN0bHkNCiAgICB9DQoNCiAgICBhc3luYyA8JT1tTmFtZT0naW5zZXJ0JyU+KCl7DQogICAgICAgIGxldCByZXN1bHRzID0gYXdhaXQgdGhpcy5fZXhlY3V0ZShudWxsLCA8JT1hbGlhcygpJT4sICI8JT1tTmFtZSU+IiwgPCVtUm91dGluZyhjKSU+LCBhc3luYyAoKSA9PiB7DQogICAgICAgICAgICAvKioqIFNUQVJUIExPQ0FMIDwlPW1OYW1lJT4oKSAqKiovDQoNCjwlIGNsc1Rvb2xzKGMpLmZvckVhY2godCA9PiB7JT4NCiAgICAgICAgaWYodGhpcy5Ub29sLnR5cGUubmFtZT09IjwlPXQlPiIpew0KICAgIDwlIGlmKHQ9PSJNb25nb0RCIiB8fCB0PT0iWmFuZ29EQiIpeyAlPg0KICAgICAgICAgICAgYXdhaXQgdGhpcy5Ub29sLmRiLmdldENvbGxlY3Rpb24oPCU9X25Db2RlKGMpJT4pLmluc2VydE9uZSh0aGlzLl90b0RvY3VtZW50KHtiTWFwOiB0cnVlfSkpOw0KICAgICAgICAgICAgdGhpcy5Ub29sLl9fZG1sU3RhdGVtZW50cy5wdXNoKGBkYi5nZXRDb2xsZWN0aW9uKCckezwlPV9uQ29kZSgpJT59JykuaW5zZXJ0T25lKCR7dGhpcy5fdG9KU09OKHtiTWFwOiB0cnVlfSl9KWApOw0KICAgIDwlIH0gZWxzZSBpZih0ID09ICJSeERCIikgeyU+DQogICAgICAgICAgICBhd2FpdCB0aGlzLlRvb2wuZGJbPCU9X25Db2RlKGMpJT5dLjwlPW1OYW1lJT4odGhpcy5fdG9Eb2N1bWVudCh7Yk1hcDogdHJ1ZX0pKTsNCiAgICA8JSB9IGVsc2UgaWYodCA9PSAiS2Fma2EiKSB7JT4NCiAgICAgICAgICAgIHRoaXMuX190aW1lKCc8JT1zY29wZSU+LjwlPW5OYW1lKGMsIHRydWUpJT4uPCU9bU5hbWUlPi5rYWZrYScpOw0KICAgICAgICAgICAgbGV0IHJldCA9IGF3YWl0IHRoaXMuVG9vbC5wcm9kdWNlci5zZW5kKHsNCiAgICAgICAgICAgICAgICB0b3BpYzogJzwlPXNjb3BlJT4uY2FsbCcsDQogICAgICAgICAgICAgICAgbWVzc2FnZXM6IFt7DQogICAgICAgICAgICAgICAgICAgIGtleTogdGhpcy5JZCwNCiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuX3RvRG9jdW1lbnQoe2JNYXA6IHRydWV9KQ0KICAgICAgICAgICAgICAgIH1dDQogICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIDwlPWxvZygpJT4nY2FsbDogJyArIHRoaXMuX190aW1lKCc8JT1zY29wZSU+LjwlPW5OYW1lKGMsIHRydWUpJT4uPCU9bU5hbWUlPi5rYWZrYScpKTsNCiAgICAgICAgICAgIDwlPWxvZygpJT4ncmVzcG9uc2U6ICcsIHJldCk7DQogICAgPCUgfSBlbHNlIGlmKHQgPT0gIk1lbW9yeSIpIHslPg0KICAgICAgICAgICAgdGhpcy5Ub29sLmRiLjwlPW5OYW1lKGMpJT4ucHVzaCh0aGlzKTsNCiAgICA8JSB9IGVsc2UgaWYodCA9PSAiTmVvNGoiKSB7JT4NCiAgICAgICAgICAgIGxldCByZXQgPSBhd2FpdCB0aGlzLl9uZW80aih0aGlzLl90b0N5TWVyZ2UoKSk7DQogICAgPCUgfSBlbHNlIGlmKHQgPT0gIlNhbGVzRm9yY2UiKSB7JT4NCiAgICAgICAgICAgIGxldCBvYmogPSB7fTsNCiAgICAgICAgICAgIDwlICQuZWFjaChjLkVudGl0eUF0dHJpYnV0ZXMuZmlsdGVyKGVhID0+ICFlYS5FbnRpdHlNZXRob2QpLCAoXywgZWEpID0+IHslPg0KICAgICAgICAgICAgaWYodGhpcy5fPCU9bk5hbWUoZWEpJT5fc2V0KXsNCiAgICAgICAgICAgICAgICA8JSBpZihlYS5FbnRpdHlUeXBlKXsgJT4NCiAgICAgICAgICAgICAgICBvYmouPCU9bk5hbWUoZWEpJT4gPSB0aGlzLl88JT1uTmFtZShlYSklPi5JZDsNCiAgICAgICAgICAgICAgICA8JSB9ZWxzZXsgJT4NCiAgICAgICAgICAgICAgICBvYmouPCU9bk5hbWUoZWEpJT4gPSB0aGlzLjwlPW5OYW1lKGVhKSU+KCk7DQogICAgICAgICAgICAgICAgPCUgfSAlPg0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgPCUgfSk7ICU+DQogICAgDQogICAgICAgICAgICBsb2coIlNlbmRpbmcgdG8gU0YiLCBvYmopOw0KICAgIA0KICAgICAgICAgICAgbGV0IHJlcyA9IGF3YWl0IHRoaXMuVG9vbC5kYi5zb2JqZWN0KCI8JT1uTmFtZShjKSU+IikuY3JlYXRlKG9iaik7DQogICAgICAgICAgICB0aGlzLklkID0gcmVzLmlkOw0KICAgIDwlIH0gZWxzZSBpZihfc3FsVG9vbHMuaW5kZXhPZih0KT49MCkgeyU+DQogICAgICAgICAgICBsZXQgcmV0ID0gYXdhaXQgdGhpcy5fc3FsKHRoaXMuX3RvSW5zZXJ0U1FMKCkpOw0KICAgICAgICAgICAgPCU9bG9nKCklPiJyZXN1bHQiLCByZXQpOw0KICAgIDwlIH0gZWxzZSBpZih0ID09ICJTZXJ2aWNlTm93IikgeyU+DQogICAgICAgICAgICB0aGlzLl9mcm9tRG9jdW1lbnQoYXdhaXQgdGhpcy5fcmVzdChudWxsLCBudWxsLCBhd2FpdCB0aGlzLl90b0RvY3VtZW50KHtiTWFwOiB0cnVlLCByZXVzZWQ6IDF9KSkpOw0KICAgIDwlIH0gZWxzZSBpZihfZmlsZVRvb2xzLmluZGV4T2YodCk+LTEpeyAlPg0KICAgICAgICAgICAgYXdhaXQgdGhpcy5fPCU9dC50b0xvd2VyQ2FzZSgpJT4odGhpcy5fZmlsZU5hbWUoKSwgdGhpcy5fdG9KU09OKHtiTWFwOiB0cnVlLCByZXVzZWQ6IDF9KSwgdGhpcy5JZCk7DQogICAgPCUgfSBlbHNlIGlmKHQgPT0gIkVNUyIpIHslPg0KICAgICAgICAgICAgdGhpcy5JZCA9IChhd2FpdCB0aGlzLl90b0VNU09iamVjdCgpLnN0b3JlKCkpLklkOw0KICAgIDwlIH0gZWxzZSBpZih0ID09ICJSZXN0REJJTyIpIHslPg0KICAgICAgICAgICAgbGV0IG9iaiA9IHt9Ow0KICAgICAgICAgICAgPCUgJC5lYWNoKGMuRW50aXR5QXR0cmlidXRlcy5maWx0ZXIoZWEgPT4gIWVhLkVudGl0eU1ldGhvZCksIChfLCBlYSkgPT4geyU+DQogICAgICAgICAgICBpZih0aGlzLl88JT1uTmFtZShlYSklPl9zZXQpew0KICAgICAgICAgICAgICAgIDwlIGlmKGVhLkVudGl0eVR5cGUpeyAlPg0KICAgICAgICAgICAgICAgIG9iai48JT1uQ29kZShlYSklPiA9IHRoaXMuPCU9bk5hbWUoZWEpJT4oKS5JZC8qX2lkKCkqLzsNCiAgICAgICAgICAgICAgICA8JSB9ZWxzZXsgJT4NCiAgICAgICAgICAgICAgICBvYmouPCU9bkNvZGUoZWEpJT4gPSB0aGlzLjwlPW5OYW1lKGVhKSU+KCk7DQogICAgICAgICAgICAgICAgPCUgfSAlPg0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgPCUgfSk7ICU+DQogICAgDQogICAgICAgICAgICBsZXQgdXJsID0gImh0dHBzOi8vIiArIHRoaXMuX19jb25maWcoJ2RhdGFiYXNlJykgKyAiLnJlc3RkYi5pby9yZXN0LyIgKyA8JT1fbkNvZGUoKSU+LnRvTG93ZXJDYXNlKCk7DQogICAgICAgICAgICBsb2coIjwlPXQlPiBVUkwiLCB1cmwpOw0KICAgICAgICAgICAgbGV0IHJlcyA9IGF3YWl0IGF4aW9zLnBvc3QodXJsLCBvYmosIHsNCiAgICAgICAgICAgICAgICBoZWFkZXJzOiB7DQogICAgICAgICAgICAgICAgICAgICJjYWNoZS1jb250cm9sIjogIm5vLWNhY2hlIiwNCiAgICAgICAgICAgICAgICAgICAgIngtYXBpa2V5IjogdGhpcy5fX2NvbmZpZygnYXBpa2V5JyksDQogICAgICAgICAgICAgICAgICAgICJjb250ZW50LXR5cGUiOiAiYXBwbGljYXRpb24vanNvbiIsDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSk7DQogICAgDQogICAgICAgICAgICBsb2coInJlc3VsdCIsIHJlcy5kYXRhKTsNCiAgICAgICAgICAgIHRoaXMuX2Zyb21Eb2N1bWVudChyZXMuZGF0YSk7DQogICAgPCUgfSBlbHNlIGlmKHQgPT0gIkJJU2VydmVyIikgeyU+DQogICAgICAgICAgICAvLyB3ZSBuZWVkIGRlcHRoIDIgdG8gZ2V0IHRoZSBFbnRpdHlWYWx1ZXMgYm91bmQgdG8gdGhlIG9uZXMgd2Ugc2VudA0KICAgICAgICAgICAgbGV0IGluc09iaiA9IGF3YWl0IHRoaXMuc3IoKS5fKCJFbnRlcnByaXNlTWFuYWdlci5lbXNFbnRpdHlPYmplY3RJbnNlcnQiLCBudWxsLCB0aGlzLnRvRW50aXR5T2JqZWN0KCksIG51bGwsIDIpOw0KICAgICAgICAgICAgaWYoIWluc09iaikgcmV0dXJuIG51bGw7DQogICAgICAgICAgICB0aGlzLklkID0gaW5zT2JqLklkOw0KICAgICAgICAgICAgdGhpcy5FbnRpdHlWYWx1ZXMgPSBpbnNPYmouRW50aXR5VmFsdWVzOw0KICAgICAgICAgICAgdGhpcy5fcmV2ZXJ0KCk7DQogICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICA8JSB9ICU+DQogICAgICAgIH0NCjwlIH0pICU+DQoNCiAgICAgICAgdGhpcy5fX3N5bmNfb24obmV3IERhdGUoKSk7DQoNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgIH0sIHtfX2JlZm9yZVJ1bGVzOiBbPCUoYy5FbnRpdHlSdWxlcyB8fCBbXSkuZmlsdGVyKHIgPT4gclttTmFtZV0gJiYgci5CZWZvcmUpLm1hcChyID0+IHslPjwlPV9GckVNRC5fdG9KUyhyKSU+PCUgfSkuam9pbignLCAnKSU+XSwgX19hZnRlclJ1bGVzOiBbPCUoYy5FbnRpdHlSdWxlcyB8fCBbXSkuZmlsdGVyKHIgPT4gclttTmFtZV0gJiYgci5BZnRlcikubWFwKHIgPT4geyU+PCU9X0ZyRU1ELl90b0pTKHIpJT48JSB9KS5qb2luKCcsICcpJT5dfSk7DQogICAgICAgIA0KICAgICAgICByZXR1cm4gKHJlc3VsdHMuZmluZChyID0+IHIucmV0KSB8fCB7cmV0OiBudWxsfSkucmV0OyAvLyBmaXJzdCBvbmUgdG8gZXhlY3V0ZSBjb3JyZWN0bHkNCiAgICB9DQogICAgDQogICAgYXN5bmMgPCU9bU5hbWU9J3VwZGF0ZSclPigpIHsNCiAgICAgICAgbGV0IHJlc3VsdHMgPSBhd2FpdCB0aGlzLl9leGVjdXRlKG51bGwsIDwlPWFsaWFzKCklPiwgIjwlPW1OYW1lJT4iLCA8JW1Sb3V0aW5nKGMpJT4sIGFzeW5jICgpID0+IHsNCiAgICAgICAgLyoqKiBTVEFSVCBMT0NBTCA8JT1tTmFtZSU+KCkgKioqLw0KDQogICAgICAgIGxldCByZXQgPSBudWxsOw0KPCUgY2xzVG9vbHMoYykuZm9yRWFjaCh0ID0+IHslPg0KICAgICAgICBpZih0aGlzLlRvb2wudHlwZS5uYW1lPT0iPCU9dCU+Iil7DQoNCiAgICA8JSBpZih0ID09ICJNb25nb0RCIikgeyU+DQogICAgICAgICAgICByZXQgPSBhd2FpdCB0aGlzLlRvb2wuZGIuY29sbGVjdGlvbig8JT1fbkNvZGUoYyklPikudXBkYXRlT25lKHtfaWQ6IHRoaXMuSWR9LCB7JHNldDogdGhpcy5fdG9Eb2N1bWVudCh7Yk1hcDogdHJ1ZX0pfSk7DQogICAgICAgICAgICB0aGlzLlRvb2wuX19kbWxTdGF0ZW1lbnRzLnB1c2goYGRiLmdldENvbGxlY3Rpb24oJyR7PCU9X25Db2RlKCklPn0nKS51cGRhdGVPbmUoe19pZDogJyR7cmV0Ll9pZH0nfSwgeyRzZXQ6ICR7dGhpcy5fdG9Eb2N1bWVudCh7Yk1hcDogdHJ1ZX0pfSlgKTsNCiAgICA8JSB9ZWxzZSBpZih0ID09ICJNZW1vcnkiKSB7JT4NCiAgICAgICAgICAgIHRoaXMuVG9vbC5kYi48JT1uTmFtZShjKSU+W3RoaXMuVG9vbC5kYi48JT1uTmFtZShjKSU+LmZpbmRJbmRleChvID0+IG8uSWQ9PXRoaXMuSWQpXSA9IHRoaXM7DQogICAgPCUgfWVsc2UgaWYodCA9PSAiS2Fma2EiKSB7JT4NCiAgICAgICAgICAgIHRoaXMuX190aW1lKCc8JT1zY29wZSU+LjwlPW5OYW1lKGMsIHRydWUpJT4uPCU9bU5hbWUlPi5rYWZrYScpOw0KICAgICAgICAgICAgcmV0ID0gYXdhaXQgdGhpcy5Ub29sLnByb2R1Y2VyLnNlbmQoew0KICAgICAgICAgICAgICAgIHRvcGljOiAnPCU9c2NvcGUlPi5jYWxsJywNCiAgICAgICAgICAgICAgICBtZXNzYWdlczogW3sNCiAgICAgICAgICAgICAgICAgICAga2V5OiB0aGlzLklkLA0KICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5fdG9Eb2N1bWVudCh7Yk1hcDogdHJ1ZX0pDQogICAgICAgICAgICAgICAgfV0NCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgPCU9bG9nKCklPidjYWxsOiAnICsgdGhpcy5fX3RpbWUoJzwlPXNjb3BlJT4uPCU9bk5hbWUoYywgdHJ1ZSklPi48JT1tTmFtZSU+LmthZmthJykpOw0KICAgICAgICAgICAgPCU9bG9nKCklPidyZXNwb25zZTogJywgcmV0KTsNCiAgICA8JSB9IGVsc2UgaWYodCA9PSAiTmVvNGoiKSB7JT4NCiAgICAgICAgICAgIGF3YWl0IHRoaXMuX25lbzRqKHRoaXMuX3RvQ3lNZXJnZSgpKTsNCiAgICA8JSB9ZWxzZSBpZihfc3FsVG9vbHMuaW5kZXhPZih0KT49MCkgeyU+DQogICAgICAgICAgICBhd2FpdCB0aGlzLl9zcWwodGhpcy5fdG9VcGRhdGVTUUwoKSk7DQogICAgICAgICAgICByZXQgPSBhd2FpdCB0aGlzLl9zcWwodGhpcy5fdG9TZWxlY3RTUUwoKSk7DQogICAgICAgICAgICBpZihBcnJheS5pc0FycmF5KHJldCkpIHJldCA9IHJldFswXTsNCiAgICA8JSB9ZWxzZSBpZih0ID09ICJTZXJ2aWNlTm93IikgeyU+DQogICAgICAgICAgICByZXQgPSAoYXdhaXQgdGhpcy5fcmVzdChudWxsLCBudWxsLCBhd2FpdCB0aGlzLl90b0RvY3VtZW50KHtiTWFwOiB0cnVlLCByZXVzZWQ6IDF9KSwgJ3B1dCcpKS5yZXN1bHQ7DQogICAgPCUgfWVsc2UgaWYoX2ZpbGVUb29scy5pbmRleE9mKHQpPi0xKXsgJT4NCiAgICAgICAgICAgIGF3YWl0IHRoaXMuXzwlPXQudG9Mb3dlckNhc2UoKSU+KHRoaXMuX2ZpbGVOYW1lKCksIHRoaXMuX3RvSlNPTih7Yk1hcDogdHJ1ZSwgcmV1c2VkOiAxfSksIHRoaXMuSWQpOw0KICAgIDwlIH0gZWxzZSBpZih0ID09ICJFTVMiKSB7JT4NCiAgICAgICAgICAgIGF3YWl0IHRoaXMuX3RvRU1TT2JqZWN0KCkuc3RvcmUoKTsNCiAgICA8JSB9ZWxzZSBpZih0ID09ICJSZXN0REJJTyIpIHslPg0KICAgICAgICAgICAgPCU9bG9nKCklPiJTZW5kaW5nIHVwZGF0ZSB0byBSRVNUREJJTyB0byBzYXZlIik7DQoNCiAgICAgICAgICAgIGxldCB1cmwgPSAiaHR0cHM6Ly8iICsgdGhpcy5fX2NvbmZpZygnZGF0YWJhc2UnKSArICIucmVzdGRiLmlvL3Jlc3QvIiArIDwlPV9uQ29kZSgpJT4udG9Mb3dlckNhc2UoKSArICIvIiArIHRoaXMuSWQ7DQogICAgICAgICAgICAvLyA8JT1sb2coKSU+IlVwZGF0ZSB0byBSRVNUREJJTyIsIHVybCk7DQogICAgICAgICAgICByZXQgPSAoYXdhaXQgYXhpb3MucHV0KHVybCwgb2JqLCB7DQogICAgICAgICAgICAgICAgaGVhZGVyczogew0KICAgICAgICAgICAgICAgICAgICAiY2FjaGUtY29udHJvbCI6ICJuby1jYWNoZSIsDQogICAgICAgICAgICAgICAgICAgICJ4LWFwaWtleSI6IHRoaXMuX19jb25maWcoJ2FwaWtleScpLA0KICAgICAgICAgICAgICAgICAgICAiY29udGVudC10eXBlIjogImFwcGxpY2F0aW9uL2pzb24iLA0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0pKS5kYXRhOw0KICAgIDwlIH1lbHNlIGlmKHQgPT0gIkJJU2VydmVyIikgeyU+DQogICAgICAgICAgICAvLyB3ZSBuZWVkIGRlcHRoIDIgdG8gZ2V0IHRoZSBFbnRpdHlWYWx1ZXMgYm91bmQgdG8gdGhlIG9uZXMgd2Ugc2VudA0KICAgICAgICAgICAgbGV0IHVwZE9iaiA9IGF3YWl0IHRoaXMuc3IoKS5fKCJFbnRlcnByaXNlTWFuYWdlci5lbXNFbnRpdHlPYmplY3RVcGRhdGUiLCBudWxsLCB0aGlzLnRvRW50aXR5T2JqZWN0KCksIDIpOw0KICAgICAgICAgICAgaWYoIXVwZE9iaikgcmV0dXJuIG51bGw7DQogICAgICAgICAgICB0aGlzLl9fc3luY19vbihuZXcgRGF0ZSgpKTsNCiAgICAgICAgICAgIHJldHVybiB0aGlzLl9jb3B5RnJvbSh1cGRPYmopOw0KICAgIDwlIH0gJT4NCiAgICAgICAgfQ0KPCUgfSklPg0KDQogICAgICAgICAgICA8JT1sb2coKSU+InJlc3VsdCIsIHJldCk7DQogICAgICAgICAgICB0aGlzLl9fc3luY19vbihuZXcgRGF0ZSgpKTsNCiAgICAgICAgICAgIHRoaXMuX2Zyb21Eb2N1bWVudChyZXQsIHRydWUpOw0KDQogICAgICAgICAgICByZXR1cm4gcmV0Ow0KDQogICAgICAgICAgICAvKioqIEVORCBMT0NBTCA8JT1tTmFtZSU+KCkgKioqLw0KICAgICAgICB9LCB7X19iZWZvcmVSdWxlczogWzwlKGMuRW50aXR5UnVsZXMgfHwgW10pLmZpbHRlcihyID0+IHJbbU5hbWVdICYmIHIuQmVmb3JlKS5tYXAociA9PiB7JT48JT1fRnJFTUQuX3RvSlMociklPjwlIH0pLmpvaW4oJywgJyklPl0sIF9fYWZ0ZXJSdWxlczogWzwlKGMuRW50aXR5UnVsZXMgfHwgW10pLmZpbHRlcihyID0+IHJbbU5hbWVdICYmIHIuQWZ0ZXIpLm1hcChyID0+IHslPjwlPV9GckVNRC5fdG9KUyhyKSU+PCUgfSkuam9pbignLCAnKSU+XX0pOw0KICAgICAgICANCiAgICAgICAgcmV0dXJuIChyZXN1bHRzLmZpbmQociA9PiByLnJldCkgfHwge3JldDogbnVsbH0pLnJldDsgLy8gZmlyc3Qgb25lIHRvIGV4ZWN1dGUgY29ycmVjdGx5DQogICAgfQ0KICAgIA0KICAgIGFzeW5jIDwlPW1OYW1lPSdmaW5kQWxsJyU+KGRlcHRoID0gMSwgb2Jqcz1bXSwgc3RhcnQsIGVuZCwgZmllbGRzKSB7DQogICAgICAgIGxldCByZXN1bHRzID0gYXdhaXQgdGhpcy5fZXhlY3V0ZShudWxsLCA8JT1hbGlhcygpJT4sICI8JT1tTmFtZSU+IiwgPCVtUm91dGluZyhjKSU+LCBhc3luYyAoKSA9PiB7DQogICAgICAgICAgICAgICAgLyoqKiBTVEFSVCBMT0NBTCA8JT1tTmFtZSU+KCkgKioqLw0KICAgICAgICANCiAgICAgICAgbGV0IHJldCA9IFtdOyAvLyBhIGpzb24gYXJyYXkNCg0KPCUgY2xzVG9vbHMoYykuZm9yRWFjaCh0ID0+IHslPg0KICAgICAgICBpZih0aGlzLlRvb2wudHlwZS5uYW1lPT0iPCU9dCU+Iil7DQogICAgPCUgaWYodD09Ik1vbmdvREIiKXsgJT4NCiAgICAgICAgICAgIGlmKHRoaXMuVG9vbC5kYikgcmV0ID0gYXdhaXQgdGhpcy5Ub29sLmRiLmNvbGxlY3Rpb24oPCU9X25Db2RlKGMpJT4pLmZpbmQodGhpcy5fdG9TZWxlY3RNb25nb0RCKGZpZWxkcywgb2JqcykpLnRvQXJyYXkoKTsNCiAgICA8JSB9IGVsc2UgaWYodCA9PSAiUnhEQiIpIHslPg0KICAgICAgICAgICAgYXdhaXQgdGhpcy5Ub29sLmRiWzwlPV9uQ29kZShjKSU+XS5maW5kKHRoaXMuX3RvU2VsZWN0UnhEQihmaWVsZHMsIG9ianMpKS5leGVjKCk7DQogICAgPCUgfWVsc2UgaWYoX3NxbFRvb2xzLmluZGV4T2YodCk+PTApeyAlPg0KICAgICAgICAgICAgcmV0ID0gYXdhaXQgdGhpcy5fc3FsKHRoaXMuX3RvU2VsZWN0U1FMKGZpZWxkcywgb2JqcykpOw0KICAgIDwlIH1lbHNlIGlmKHQ9PSJFTVMiKXsgJT4NCiAgICAgICAgICAgIGxldCBvID0gdGhpcy5fdG9FTVNPYmplY3QodHJ1ZSwgdHJ1ZSk7DQogICAgICAgICAgICBpZih0aGlzLl9fY29uZmlnKCdlbXMuZGVlcC5xdWVyeScpKSBvID0gbmV3IDwlPXNjb3BlJT4uRW50aXR5T2JqZWN0KCkuVEhJUyhbb10uY29uY2F0KG9ianMubWFwKF9vID0+IF9vLl90b0VNU09iamVjdCh0cnVlLCB0cnVlKSkpKTsNCiAgICAgICAgICAgIHJldCA9IGF3YWl0IHRoaXMuX2Zyb21FTVNWYWx1ZXMoYXdhaXQgbmV3IDwlPXNjb3BlJT4uRW50aXR5VmFsdWUoKS5hY3RpdmUodHJ1ZSkuZW50aXR5T2JqZWN0KG8pLjwlPW1OYW1lJT4oKSk7DQogICAgICAgICAgICBpZih0aGlzLl9fY29uZmlnKCdlbXMuZGVlcC5xdWVyeScpKSByZXR1cm4gcmV0Ow0KICAgIDwlIH1lbHNlIGlmKHQ9PSJNZW1vcnkiKXsgJT4NCiAgICAgICAgICAgIHJldHVybiB0aGlzLlRvb2wuZGJbPCU9X25Db2RlKCklPl0uZmlsdGVyKG8gPT4gbyAmJiB0aGlzLl9zYW1lRW50aXR5KG8pKTsNCiAgICA8JSB9ZWxzZSBpZih0PT0iSHViU3BvdCIpeyAlPg0KICAgIDwlIH1lbHNlIGlmKHQ9PSJTZXJ2aWNlTm93Iil7ICU+DQogICAgICAgICAgICByZXQgPSAoYXdhaXQgdGhpcy5fcmVzdChudWxsLCB7c3lzcGFybV9xdWVyeTogdGhpcy5fdG9TTlF1ZXJ5KGZpZWxkcywgb2JqcywgdHJ1ZSl9KSkucmVzdWx0Ow0KICAgIDwlIH1lbHNlIGlmKHQ9PSJTYWxlc0ZvcmNlIil7ICU+DQogICAgICAgICAgICByZXQgPSBhd2FpdCB0aGlzLl9yZXN0KG51bGwsIG51bGwsIHRoaXMuX3RvU0ZRdWVyeShmaWVsZHMsIG9ianMsIHRydWUpLCBudWxsLCB7dXJsOiAncmVzdC51cmwuZ3FsJ30pOw0KICAgIDwlIH1lbHNlIGlmKF9maWxlVG9vbHMuaW5kZXhPZih0KT4tMSl7ICU+DQogICAgICAgICAgICBsZXQgZE5hbWUgPSB0aGlzLl9maWxlTmFtZSgpLnNwbGl0KCcvJykuc2xpY2UoMCwgLTEpLmpvaW4oJy8nKTsNCiAgICAgICAgICAgIC8vPCU9bG9nKCklPiJkTmFtZSIsIGROYW1lKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgbGV0IGlkeExpc3QgPSAoYXdhaXQgdGhpcy5fPCU9dC50b0xvd2VyQ2FzZSgpJT4oZE5hbWUpKS5maWx0ZXIociA9PiB0eXBlb2Yoci5uYW1lKSE9PSd1bmRlZmluZWQnKS5tYXAociA9PiB7DQogICAgICAgICAgICAgICAgbGV0IGhUaGlzID0gdGhpcy5fdG9IYXNoKG51bGwsIHtub0NvZGU6IHRydWUsIG9ubHlVbmlxdWU6IHRydWUsIG5vT3BlcmF0b3JzOiB0cnVlfSwgJzwlPW1OYW1lJT4nKS5fdGhpczsNCiAgICAgICAgICAgICAgICBsZXQgdUtleXMgPSBPYmplY3Qua2V5cyhoVGhpcykuZmlsdGVyKGsgPT4gdHlwZW9mKGhUaGlzW2tdKSE9PSd1bmRlZmluZWQnKTsNCiAgICAgICAgICAgICAgICByLm5hbWUuc3BsaXQoJ19fJykuZm9yRWFjaCgobnAsIGkpID0+IHJbdUtleXNbaV1dID0gbnApOw0KICAgICAgICAgICAgICAgIHIuT1BFUkFUT1JTID0gT2JqZWN0LmFzc2lnbih7fSwgLi4udUtleXMubWFwKGsgPT4gKHtba106ICc9J30pKSk7DQogICAgICAgICAgICAgICAgcmV0dXJuIHI7DQogICAgICAgICAgICB9KS5tYXAociA9PiBuZXcgPCU9c2NvcGUlPi48JT1fY05hbWUoYywgdHJ1ZSklPigpLl9mcm9tRG9jdW1lbnQociwgdHJ1ZSkpOw0KICAgICAgICAgICAgPCU9bG9nKCklPiJpZHhMaXN0IiwgaWR4TGlzdCwgaWR4TGlzdC5tYXAociA9PiBkTmFtZSArICcvJyArIHIuX2ZpbGVOYW1lKCkuc3BsaXQoJy8nKS5zbGljZSgtMSkuam9pbignLycpKSk7DQogICAgICAgICAgICBpZHhMaXN0ID0gaWR4TGlzdC5maWx0ZXIociA9PiByLl9tYXRjaGVzKHRoaXMsIHtvbmx5VW5pcXVlOiB0cnVlfSkpOw0KICAgICAgICAgICAgPCU9bG9nKCklPiJpZHhMaXN0IGZpbHRlcmVkIiwgaWR4TGlzdCk7IA0KDQogICAgICAgICAgICBpZihpZHhMaXN0Lmxlbmd0aD09MSl7DQogICAgICAgICAgICAgICAgcmV0LnB1c2goYXdhaXQgdGhpcy5fPCU9dC50b0xvd2VyQ2FzZSgpJT4oZE5hbWUgKyAnLycgKyBpZHhMaXN0WzBdLl9maWxlTmFtZSgpLnNwbGl0KCcvJykuc2xpY2UoLTEpLmpvaW4oJy8nKSkpOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0ID0gaWR4TGlzdDsNCiAgICAgICAgICAgIH0NCiAgICA8JSB9ZWxzZSBpZih0PT0iTmVvNGoiKXsgJT4NCiAgICAgICAgICAgIHJldCA9IGF3YWl0IHRoaXMuX25lbzRqKHRoaXMuX3RvQ3lRdWVyeShmaWVsZHMsIG9ianMpKTsNCiAgICA8JSB9ZWxzZSBpZih0PT0iUmVzdERCSU8iKXsgJT4NCiAgICAgICAgICAgIGxldCB0aGlzRG9jID0gdGhpcy5fdG9Eb2N1bWVudCh7Yk1hcDogdHJ1ZX0pOw0KICAgICAgICAgICAgbGV0IGVhQ29kZSA9ICIiOw0KICAgICAgICA8JSAkLmVhY2goYy5FbnRpdHlBdHRyaWJ1dGVzLmZpbHRlcihlYSA9PiAhZWEuRW50aXR5TWV0aG9kKSwgKF8sIGVhKSA9PiB7JT4NCiAgICAgICAgICAgIGVhQ29kZSA9IDwlPV9uQ29kZShlYSklPjsNCiAgICAgICAgICAgIGlmKHRoaXMuXzwlPW5OYW1lKGVhKSU+X3NldCl7DQogICAgICAgICAgICA8JSBpZihlYS5FbnRpdHlUeXBlKXsgJT4NCiAgICAgICAgICAgIDwlIH1lbHNlIGlmKGVhLklzQXJyYXkpeyAlPg0KICAgICAgICAgICAgICAgIGlmKHRoaXMuXzwlPW5OYW1lKGVhKSU+X2Nvb3A9PSIhPSIpew0KICAgICAgICAgICAgICAgICAgICB0aGlzRG9jW2VhQ29kZV0gPSB7IiRuaW4iOiB0aGlzRG9jW2VhQ29kZV19Ow0KICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICB0aGlzRG9jW2VhQ29kZV0gPSB7IiRpbiI6IHRoaXNEb2NbZWFDb2RlXX07DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgPCUgfWVsc2UgaWYoZWEuSXNTdHJpbmcgfHwgZWEuSXNUZXh0KXsgJT4NCiAgICAgICAgICAgICAgICBpZihbbnVsbCwgJyUnLCAnTElLRSddLmluZGV4T2YodGhpcy5fPCU9bk5hbWUoZWEpJT5fY29vcCk+LTEpew0KICAgICAgICAgICAgICAgICAgICB0aGlzRG9jW2VhQ29kZV0gPSB7IiRyZWdleCI6IHRoaXNEb2NbZWFDb2RlXSB8fCAiLioifTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICA8JSB9ICU+DQogICAgICAgICAgICB9DQogICAgICAgIDwlIH0pOyAlPg0KDQogICAgICAgICAgICBsZXQgdXJsID0gImh0dHBzOi8vIiArIHRoaXMuX19jb25maWcoJ2RhdGFiYXNlJykgKyAiLnJlc3RkYi5pby9yZXN0LyIgKyA8JT1fbkNvZGUoKSU+LnRvTG93ZXJDYXNlKCkgKyAiP3E9IiArIEpTT04uc3RyaW5naWZ5KGNvbmRpdGlvbnMpOw0KICAgICAgICAgICAgcmV0ID0gKGF3YWl0IGF4aW9zLmdldCh1cmwsIHsNCiAgICAgICAgICAgICAgICBoZWFkZXJzOiB7DQogICAgICAgICAgICAgICAgICAgICJjYWNoZS1jb250cm9sIjogIm5vLWNhY2hlIiwNCiAgICAgICAgICAgICAgICAgICAgIngtYXBpa2V5IjogdGhpcy5fX2NvbmZpZygnYXBpa2V5JyksDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSkpLmRhdGE7DQogICAgPCUgfWVsc2UgaWYodD09IkJJU2VydmVyIil7ICU+DQogICAgICAgICAgICBsZXQgcSA9IHsNCiAgICAgICAgICAgICAgICBUSElTOiB0aGlzLl9idWlsZFRoaXMoZGVwdGgpLmNvbmNhdCgob2JqcyB8fCBbXSkubWFwKG9iaiA9PiBvYmoudG9FbnRpdHlPYmplY3Q/ew0KICAgICAgICAgICAgICAgICAgICBBY3RpdmU6IHRydWUsDQogICAgICAgICAgICAgICAgICAgIEVudGl0eU9iamVjdDogb2JqLnRvRW50aXR5T2JqZWN0KHRydWUpLA0KICAgICAgICAgICAgICAgIH06b2JqKSksDQogICAgICAgICAgICAgICAgQWN0aXZlOiB0cnVlLA0KICAgICAgICAgICAgICAgIEVudGl0eU9iamVjdDogeyAvLyBhYnNvbHV0ZWx5IHJlcXVpcmVkIGZvciBpbmRleGluZw0KICAgICAgICAgICAgICAgICAgICBBY3RpdmU6IHRydWUsDQogICAgICAgICAgICAgICAgICAgIEVudGl0eUNsYXNzOiB0aGlzLl92YWx1ZUNsYXNzKCksDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfTsNCiAgICAgICAgICAgIDwlPWxvZygpJT5xKTsNCiAgICAgICAgICAgIHJldHVybiB0aGlzLl9hc09iamVjdHMoKGF3YWl0IHRoaXMuc3IoKS5fKCJFbnRlcnByaXNlTWFuYWdlci5lbXNFbnRpdHlWYWx1ZUZpbmRhbGwiLCBudWxsLCBxKSkpOw0KICAgIDwlIH0gJT4NCiAgICAgICAgfQ0KPCUgfSklPg0KDQogICAgICAgIDwlPWxvZygpJT4iQmVmb3JlIF9mcm9tRG9jdW1lbnQoKSIsIGRlcHRoLCByZXQpOw0KICAgICAgICANCiAgICAgICAgaWYoIUFycmF5LmlzQXJyYXkocmV0KSkgcmV0ID0gW3JldF07DQogICAgICAgIHJldCA9IHJldC5maWx0ZXIociA9PiByKS5tYXAociA9PiBuZXcgPCU9c2NvcGUlPi48JT1uTmFtZShjLCB0cnVlKSU+KCkuX2Zyb21Eb2N1bWVudChyLCB0cnVlKSkuZmlsdGVyKHIgPT4gcikubWFwKHIgPT4gci5fX3N5bmNfb24obmV3IERhdGUoKSkpOw0KDQogICAgICAgIGlmKGRlcHRoPjEpew0KICAgICAgICAgICAgZm9yIGF3YWl0IChjb25zdCByIG9mIHJldCl7DQo8JSBjLkVudGl0eUF0dHJpYnV0ZXMuZmlsdGVyKGVhID0+IGVhLkVudGl0eVR5cGUgJiYgIWVhLkVudGl0eU1ldGhvZCkuZm9yRWFjaChlYSA9PiB7JT4NCiAgICAgICAgICAgICAgICBpZihyLl88JT1uTmFtZShlYSklPl9zZXQpew0KICAgICAgICAgICAgICAgICAgICAvLyA8JT1sb2coKSU+IjwlPW5OYW1lKGVhKSU+Iiwgci48JT1uTmFtZShlYSklPigpLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgICAgICAgICByLjwlPW5OYW1lKGVhKSU+KGF3YWl0IHIuXzwlPW5OYW1lKGVhKSU+LmZpbmQoZGVwdGgtMSkpOw0KICAgICAgICAgICAgICAgIH0NCjwlIH0pJT4NCiAgICANCjwlIGMuVHlwZWRBdHRyaWJ1dGVzLmZvckVhY2godGEgPT4geyBsZXQgdGFOYW1lID0gbk5hbWUodGEpICsgJ18nICsgdGEuRW50aXR5Q2xhc3MuUGx1cmFsLnJlcGxhY2UoLyAvZywgJ18nKTsgJT4NCiAgICA8JSBjbHNUb29scyhjKS5mb3JFYWNoKHQgPT4geyU+DQogICAgICAgICAgICAgICAgaWYodGhpcy5Ub29sLnR5cGUubmFtZT09IjwlPXQlPiIpew0KICAgICAgICA8JSBpZihfZmlsZVRvb2xzLmluZGV4T2YodCk+PTApeyAlPg0KICAgICAgICAgICAgICAgICAgICBsZXQgcl88JT10YU5hbWUlPiA9IFtdOw0KICAgICAgICAgICAgICAgICAgICBmb3IgYXdhaXQgKGNvbnN0IF90YSBvZiByLjwlPXRhTmFtZSU+KCkpew0KICAgICAgICAgICAgICAgICAgICAgICAgPCU9bG9nKCklPiI8JT10YU5hbWUlPiIsIF90YSk7DQogICAgICAgICAgICAgICAgICAgICAgICByXzwlPXRhTmFtZSU+LnB1c2goYXdhaXQgX3RhLmZpbmQoZGVwdGgtMSkpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIHIuY2xlYXJfPCU9dGFOYW1lJT4oKTsNCiAgICAgICAgICAgICAgICAgICAgci48JT10YU5hbWUlPihyXzwlPXRhTmFtZSU+KTsNCiAgICAgICAgPCUgfWVsc2V7ICU+DQogICAgICAgICAgICAgICAgICAgIC8vIDwlPWxvZygpJT4iPCU9dGFOYW1lJT4iLCByLjwlPXRhTmFtZSU+KCkpOw0KICAgICAgICAgICAgICAgICAgICByLjwlPXRhTmFtZSU+KGF3YWl0IG5ldyA8JT1zY29wZSU+LjwlPV9jTmFtZSh0YS5FbnRpdHlDbGFzcywgdHJ1ZSklPigpLjwlPW5OYW1lKHRhKSU+KHIpDQogICAgICAgICAgICA8JSBpZihmYWxzZSAmJiBbJ1NxbERCJ10uaW5kZXhPZih0KT49MCl7IC8vIHNxbCBzdGF0ZW1lbnRzIGRvIG5vdCBpbmNsdWRlIGxlZnQgam9pbnMgd2l0aG91dCBleHBsaWNpdCByZWZlcmVuY2VzICU+DQogICAgICAgICAgICAgICAgICAgICAgICA8JXRhLkVudGl0eUNsYXNzLkVudGl0eUF0dHJpYnV0ZXMuZmlsdGVyKGVhID0+ICFlYS5FbnRpdHlNZXRob2QgJiYgZWEuRW50aXR5VHlwZSAmJiBlYSE9dGEpLmZvckVhY2goZWEgPT4geyU+LjwlPW5OYW1lKGVhKSU+KG5ldyA8JT1zY29wZSU+LjwlPW5OYW1lKGVhLkVudGl0eVR5cGUsIHRydWUpJT4oKSk8JX0pJT4NCiAgICAgICAgICAgIDwlIH0lPg0KICAgICAgICAgICAgICAgICAgICAgICAgLjwlPW1OYW1lJT4oZGVwdGgtMSkpOw0KICAgICAgICA8JSB9JT4NCiAgICAgICAgICAgICAgICB9DQogICAgPCUgfSklPg0KPCUgfSklPg0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgbGV0IHJlZnMgPSByZXQuZmlsdGVyKHIgPT4gci5FbnRpdHlDbGFzcyk7DQogICAgICAgIGZvciBhd2FpdCAoY29uc3QgbyBvZiAob2JqcyB8fCBbXSkuZmlsdGVyKF9vID0+ICFfby5fX3N5bmNfb24oKSkpew0KICAgICAgICAgICAgaWYoby5fdG9FTVNPYmplY3Qpew0KICAgICAgICAgICAgICAgIHJlZnMucHVzaCguLi4oYXdhaXQgdGhpcy5fZnJvbUVNU1ZhbHVlcyhhd2FpdCBvLl90b0VNU09iamVjdCh0cnVlLCB0cnVlKS48JT1tTmFtZSU+KGRlcHRoKSkpKTsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJlZnMucHVzaCguLi4oYXdhaXQgby48JT1tTmFtZSU+KGRlcHRoKSkpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHJlZnMgPSByZWZzLmZpbHRlcihyID0+IHIpOw0KICAgICAgICANCiAgICAgICAgcmVmcy5mb3JFYWNoKHIgPT4gci5fcmVzb2x2ZShyZWZzKSk7DQoNCiAgICAgICAgPCU9bG9nKCklPiJPdXRwdXQiLCByZXQpOw0KDQogICAgICAgIHJldHVybiByZXQ7DQogICAgICAgICAgICAgICAgLyoqKiBFTkQgTE9DQUwgPCU9bU5hbWUlPigpICoqKi8NCiAgICAgICAgfSwge2RlcHRoLCBvYmpzLCBzdGFydCwgZW5kLCBmaWVsZHMsIF9fYmVmb3JlUnVsZXM6IFs8JShjLkVudGl0eVJ1bGVzIHx8IFtdKS5maWx0ZXIociA9PiByW21OYW1lXSAmJiByLkJlZm9yZSkubWFwKHIgPT4geyU+PCU9X0ZyRU1ELl90b0pTKHIpJT48JSB9KS5qb2luKCcsICcpJT5dLCBfX2FmdGVyUnVsZXM6IFs8JShjLkVudGl0eVJ1bGVzIHx8IFtdKS5maWx0ZXIociA9PiByW21OYW1lXSAmJiByLkFmdGVyKS5tYXAociA9PiB7JT48JT1fRnJFTUQuX3RvSlMociklPjwlIH0pLmpvaW4oJywgJyklPl19KTsNCg0KICAgICAgICByZXR1cm4gKHJlc3VsdHMuZmluZChyID0+IHIucmV0KSB8fCB7cmV0OiBbXX0pLnJldCB8fCBbXTsgLy8gZmlyc3Qgb25lIHRvIGV4ZWN1dGUgY29ycmVjdGx5DQogICAgfQ0KICAgIA0KICAgIDwlPW1OYW1lPSdfcmVzb2x2ZSclPihyZWZzKXsNCiAgICAgICAgdHJ5ew0KICAgICAgICAgICAgaWYoIXJlZnMubGVuZ3RoKSByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgdGhpcy5fX2ltcG9ydCh7fSwgew0KICAgIDwlIGMuRW50aXR5QXR0cmlidXRlcy5maWx0ZXIoZWEgPT4gIWVhLkVudGl0eU1ldGhvZCAmJiBlYS5FbnRpdHlUeXBlKS5mb3JFYWNoKGVhID0+IHsgJT4NCiAgICAgICAgICAgICAgICA8JT1uTmFtZShlYSklPjogKCkgPT4gew0KICAgICAgICAgICAgICAgICAgICBpZih0aGlzLjwlPW5OYW1lKGVhKSU+KCkpew0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gPCU9bG9nKCklPiI8JT1uTmFtZShlYSklPiIsIHRoaXMuPCU9bk5hbWUoZWEpJT4oKS5JZCwgcmVmcy5tYXAociA9PiAoe2lkOiByLklkLCBjb2RlOiByLmNvZGUoKX0pKSk7DQogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLjwlPW5OYW1lKGVhKSU+KHJlZnMuZmluZChvID0+IG8uSWQ9PXRoaXMuPCU9bk5hbWUoZWEpJT4oKS5JZCkgfHwgdGhpcy48JT1uTmFtZShlYSklPigpLjwlPW1OYW1lJT4ocmVmcykpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSwNCiAgICA8JSB9KSU+DQogICAgPCUgYy5UeXBlZEF0dHJpYnV0ZXMuZm9yRWFjaCh0YSA9PiB7IGxldCB0YU5hbWUgPSBuTmFtZSh0YSkgKyAnXycgKyB0YS5FbnRpdHlDbGFzcy5QbHVyYWwucmVwbGFjZSgvIC9nLCAnXycpOyU+DQogICAgICAgICAgICAgICAgPCU9dGFOYW1lJT46ICgpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgaWYodGhpcy48JT10YU5hbWUlPigpLmxlbmd0aCkgdGhpcy48JT10YU5hbWUlPih0aGlzLjwlPXRhTmFtZSU+KCkubWFwKHRhID0+IHJlZnMuZmluZChvID0+IG8uSWQ9PXRhLklkKSB8fCB0YS48JT1tTmFtZSU+KHJlZnMpKSwgbnVsbCwgdHJ1ZSk7DQogICAgICAgICAgICAgICAgfSwNCiAgICA8JSB9KSU+DQogICAgICAgICAgICB9LCAiPCU9bU5hbWUlPiIpOw0KDQogICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgfWNhdGNoKGV4KXsNCiAgICAgICAgICAgIDwlPWVycm9yKCklPmV4KTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICANCjwlIGlmKG1haW5DbGFzcyhbJ0VNUyddKSl7JT4NCiAgICBhc3luYyA8JT1tTmFtZT0nX2Zyb21FTVNWYWx1ZXMnJT4oZXZzKXsNCiAgICA8JSBpZihtYWluQ2xhc3MoWydFTVMnXSk9PWMpeyU+DQogICAgICAgIHRyeXsNCiAgICAgICAgICAgIGF3YWl0IHRoaXMuX2ZpbmRSZWZlcmVuY2VzKGV2cywgWy4uLm5ldyBTZXQoZXZzLm1hcCh2ID0+IHYuZW50aXR5QXR0cmlidXRlKCkuSWQpLmZsYXQoKSldLm1hcChpZCA9PiBuZXcgPCU9c2NvcGUlPi5FbnRpdHlBdHRyaWJ1dGUoaWQpKSk7DQogICAgICAgICAgICA8JT1sb2coKSU+ZXZzKTsNCiAgICAgICAgDQogICAgICAgICAgICBsZXQgb2JqcyA9IFtdOw0KICAgICAgICAgICAgdGhpcy5ncm91cEJ5KGV2cywgIl9lbnRpdHlPYmplY3QiKS5mb3JFYWNoKGV2ZyA9PiB7DQogICAgICAgICAgICAgICAgZXZnLmtleS5lbnRpdHlPYmplY3RfRW50aXR5VmFsdWVzKGV2Zy52YWx1ZXMpOw0KICAgICAgICAgICAgICAgIG9ianMucHVzaChldmcua2V5KTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBvYmpzLmZvckVhY2gociA9PiByLmVudGl0eUNsYXNzKHIuZW50aXR5T2JqZWN0X0VudGl0eVZhbHVlcygpWzBdLmVudGl0eUF0dHJpYnV0ZSgpLmVudGl0eUNsYXNzKCkpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgbGV0IHJldCA9IFtdOw0KICAgICAgICAgICAgZm9yIGF3YWl0IChjb25zdCByIG9mIG9ianMpew0KICAgICAgICAgICAgICAgIHJldC5wdXNoKGF3YWl0IG5ldyA8JT1zY29wZSU+W3IuZW50aXR5Q2xhc3MoKS5uYW1lKCldKCkuX2Zyb21FTVNPYmplY3QocikpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICA8JT1sb2coKSU+cmV0KTsNCiAgICAgICAgICAgIHJldHVybiByZXQ7DQogICAgICAgIH1jYXRjaChleCl7DQogICAgICAgICAgICA8JT1lcnJvcigpJT5leCk7DQogICAgICAgIH0NCiAgICA8JX1lbHNleyU+DQogICAgICAgIHJldHVybiBhd2FpdCBuZXcgPCU9c2NvcGUlPi48JT1uTmFtZShtYWluQ2xhc3MoWydFTVMnXSxjKSklPigpLjwlPW1OYW1lJT4oZXZzKTsNCiAgICA8JX0lPg0KICAgIH0NCiAgICANCiAgICA8JT1tTmFtZT0nX3RvRU1TQ2xhc3MnJT4oZGVwdGgpew0KICAgICAgICAvLyB3aHkgbm90IF9fZXhwb3J0ID8NCiAgICAgICAgdHJ5ew0KICAgICAgICAgICAgbGV0IHJldCA9IG5ldyA8JT1zY29wZSU+LkVudGl0eUNsYXNzKCc8JT1jLklkJT4nKS5uYW1lKCI8JT1jLk5hbWUlPiIpLmNvZGUoIjwlPW5OYW1lKGMpJT4iKS5hY3RpdmUodHJ1ZSkuZW5hYmxlZCh0cnVlKS5kYXRlKG5ldyBEYXRlKCkpLmNvbXBhbnkobmV3IDwlPXNjb3BlJT4uQ29tcGFueSgpLm5hbWUoIjwlPXNjb3BlJT4iKS5jb2RlKCI8JT1zY29wZSU+IikpLmVudGl0eU1vZHVsZShuZXcgPCU9c2NvcGUlPi5FbnRpdHlNb2R1bGUoKS5jb2RlKCI8JT1zY29wZSU+IikubmFtZSgiPCU9c2NvcGUlPiIpKTsNCiAgICAgICAgICAgIGlmKCFkZXB0aCkgcmV0dXJuIHJldDsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgcmV0LmVudGl0eUNsYXNzX0VudGl0eU1ldGhvZHMoWw0KICAgIDwlIGMuRW50aXR5TWV0aG9kcy5mb3JFYWNoKG0gPT4geyU+DQogICAgICAgICAgICAgICAgbmV3IDwlPXNjb3BlJT4uRW50aXR5TWV0aG9kKCc8JT1tLklkJT4nKS5hY3RpdmUodHJ1ZSkuZW5hYmxlZCh0cnVlKS5uYW1lKCI8JT1tLk5hbWUlPiIpLmNvZGUoIjwlPW5OYW1lKG0pJT4iKS5lbnRpdHlNZXRob2RfRW50aXR5QXR0cmlidXRlcyhbDQogICAgICAgIDwlIG0uTWV0aG9kUGFyYW1ldGVycy5mb3JFYWNoKHAgPT4geyU+DQogICAgICAgICAgICAgICAgICAgIG5ldyA8JT1zY29wZSU+LkVudGl0eUF0dHJpYnV0ZSgnPCU9cC5JZCU+JykuYWN0aXZlKHRydWUpLmVuYWJsZWQodHJ1ZSkubmFtZSgiPCU9cC5OYW1lJT4iKS5jb2RlKCI8JT1uTmFtZShwKSU+IikuaXNBcnJheSg8JT1wLklzQXJyYXk/J3RydWUnOidmYWxzZSclPikucmVtYXJrKCI8JT1jLk5hbWUlPi48JT1tLk5hbWUlPigpIikuZW50aXR5Q2xhc3MobmV3IDwlPXNjb3BlJT4uPCU9bk5hbWUoYywgdHJ1ZSklPigpLjwlPW1OYW1lJT4oKSkNCiAgICAgICAgICAgIDwlIGlmKHAuRW50aXR5VHlwZSl7JT4NCiAgICAgICAgICAgICAgICAgICAgLmVudGl0eVR5cGUobmV3IDwlPXNjb3BlJT4uPCU9bk5hbWUocC5FbnRpdHlUeXBlKSU+KCkuPCU9bU5hbWUlPihkZXB0aC0xKSkNCiAgICAgICAgICAgIDwlIH1lbHNleyU+DQogICAgICAgICAgICAgICAgICAgIC5pczwlPV9GckVNRC5fYXR0cihwKSU+KHRydWUpDQogICAgICAgICAgICA8JSB9JT4sDQogICAgICAgIDwlIH0pJT4NCiAgICAgICAgICAgICAgICBdKS5yZXNwb25zZUF0dHJpYnV0ZShuZXcgPCU9c2NvcGUlPi5FbnRpdHlBdHRyaWJ1dGUoJzwlPW0uUmVzcG9uc2VBdHRyaWJ1dGUuSWQlPicpLmFjdGl2ZSh0cnVlKS5lbmFibGVkKHRydWUpLm5hbWUoIjwlPW0uUmVzcG9uc2VBdHRyaWJ1dGUuTmFtZSU+IikuY29kZSgiPCU9bk5hbWUobS5SZXNwb25zZUF0dHJpYnV0ZSklPiIpLmVudGl0eUNsYXNzKG5ldyA8JT1zY29wZSU+LjwlPW5OYW1lKGMsIHRydWUpJT4oKS48JT1tTmFtZSU+KCkpDQogICAgICAgIDwlIGlmKG0uUmVzcG9uc2VBdHRyaWJ1dGUuRW50aXR5VHlwZSl7JT4NCiAgICAgICAgICAgICAgICAuZW50aXR5VHlwZShuZXcgPCU9c2NvcGUlPi48JT1uTmFtZShtLlJlc3BvbnNlQXR0cmlidXRlLkVudGl0eVR5cGUpJT4oKS48JT1tTmFtZSU+KGRlcHRoLTEpKQ0KICAgICAgICA8JSB9ZWxzZXslPg0KICAgICAgICAgICAgICAgIC5pczwlPV9GckVNRC5fYXR0cihtLlJlc3BvbnNlQXR0cmlidXRlKSU+KHRydWUpDQogICAgICAgIDwlIH0lPg0KICAgICAgICAgICAgICAgICksDQogICAgPCUgfSklPg0KICAgICAgICAgICAgXSkuZW50aXR5Q2xhc3NfRW50aXR5QXR0cmlidXRlcyhbDQogICAgPCUgYy5FbnRpdHlBdHRyaWJ1dGVzLmZpbHRlcihlYSA9PiAhZWEuRW50aXR5TWV0aG9kKS5mb3JFYWNoKGVhID0+IHslPg0KICAgICAgICAgICAgICAgIG5ldyA8JT1zY29wZSU+LkVudGl0eUF0dHJpYnV0ZSgnPCU9ZWEuSWQlPicpLmFjdGl2ZSh0cnVlKS5lbmFibGVkKHRydWUpLm5hbWUoIjwlPWVhLk5hbWUlPiIpLmNvZGUoIjwlPW5OYW1lKGVhKSU+IikucmVtYXJrKCc8JT1jLk5hbWUlPi48JT1lYS5OYW1lJT4nKQ0KICAgICAgICA8JSBpZihlYS5FbnRpdHlUeXBlKXslPg0KICAgICAgICAgICAgICAgIC5lbnRpdHlUeXBlKG5ldyA8JT1zY29wZSU+LjwlPW5OYW1lKGVhLkVudGl0eVR5cGUsIHRydWUpJT4oKS48JT1tTmFtZSU+KGRlcHRoLTEpKQ0KICAgICAgICA8JSB9ZWxzZXslPg0KICAgICAgICAgICAgICAgIC5pczwlPV9GckVNRC5fYXR0cihlYSklPih0cnVlKQ0KICAgICAgICA8JSB9JT4sDQogICAgPCUgfSklPg0KICAgICAgICAgICAgXSk7DQogICAgICAgICAgICA8JT1sb2coKSU+cmV0KTsNCiAgICAgICAgICAgIHJldHVybiByZXQ7DQogICAgICAgIH1jYXRjaChleCl7DQogICAgICAgICAgICA8JT1lcnJvcigpJT5leCk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBhc3luYyA8JT1tTmFtZT0nX2Zyb21FTVNPYmplY3QnJT4ob2JqKXsNCiAgICAgICAgdHJ5ew0KICAgICAgICAgICAgdGhpcy5JZCA9IG9iai5JZDsNCiAgICAgICAgICAgIGxldCBldiA9IG51bGw7DQogICAgPCUgYy5FbnRpdHlBdHRyaWJ1dGVzLmZpbHRlcihlYSA9PiAhZWEuRW50aXR5TWV0aG9kKS5mb3JFYWNoKGVhID0+IHslPg0KICAgICAgICAgICAgZXYgPSBvYmouZW50aXR5T2JqZWN0X0VudGl0eVZhbHVlcygpLmZpbmQoZXYgPT4gZXYuZW50aXR5QXR0cmlidXRlKCkuY29kZSgpPT08JT1fbkNvZGUoZWEpJT4pOw0KICAgICAgICA8JSBpZihlYS5FbnRpdHlUeXBlKXslPg0KICAgICAgICAgICAgaWYoZXYpIHRoaXMuPCU9bk5hbWUoZWEpJT4oYXdhaXQgbmV3IDwlPXNjb3BlJT4uPCU9bk5hbWUoZWEuRW50aXR5VHlwZSwgdHJ1ZSklPigpLjwlPW1OYW1lJT4oZXYub2JqZWN0VmFsdWUoKSkpOw0KICAgICAgICA8JSB9ZWxzZXslPg0KICAgICAgICAgICAgaWYoZXYpIHRoaXMuPCU9bk5hbWUoZWEpJT4oZXYuPCU9X0ZyRU1ELl9hdHRyKGVhKS50b0xvd2VyQ2FzZSgpJT5WYWx1ZSgpKTsNCiAgICAgICAgPCUgfSU+DQogICAgPCUgfSklPg0KICAgIDwlIGMuVHlwZWRBdHRyaWJ1dGVzLmZvckVhY2godGEgPT4geyBsZXQgdGFOYW1lID0gbk5hbWUodGEpICsgJ18nICsgdGEuRW50aXR5Q2xhc3MuUGx1cmFsLnJlcGxhY2UoLyAvZywgJ18nKTslPg0KICAgIDwlIH0pJT4NCiAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICB9Y2F0Y2goZXgpew0KICAgICAgICAgICAgPCU9ZXJyb3IoKSU+ZXgpOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgPCU9bU5hbWU9J190b0VNU09iamVjdCclPihiUXVlcnksIGJUeXBlZEF0dHJpYnV0ZXMpew0KICAgICAgICBsZXQgcmV0ID0gbmV3IDwlPXNjb3BlJT4uRW50aXR5T2JqZWN0KCkuYWN0aXZlKHRydWUpLmVudGl0eUNsYXNzKHRoaXMuX3RvRU1TQ2xhc3MoKSk7DQoNCiAgICAgICAgcmV0ID0gdGhpcy5fX2V4cG9ydChyZXQsIHsNCiAgICAgICAgICAgIEZ1bGw6ICFiUXVlcnksDQogICAgICAgICAgICAvL051bGw6ICFiUXVlcnksDQogICAgICAgICAgICBJZDogKG9iaiwgZWFDb2RlLCB2KSA9PiBvYmouSWQgPSB2LA0KICAgIDwlIGMuRW50aXR5QXR0cmlidXRlcy5maWx0ZXIoZWEgPT4gIWVhLkVudGl0eU1ldGhvZCkuZm9yRWFjaChlYSA9PiB7ICU+DQogICAgICAgICAgICAiPCU9bk5hbWUoZWEpJT4iOiAob2JqLCBlYUNvZGUsIHYpID0+IHsNCiAgICAgICAgICAgICAgICBsZXQgZXYgPSBuZXcgPCU9c2NvcGUlPi5FbnRpdHlWYWx1ZSgpLmFjdGl2ZSh0cnVlKS5lbnRpdHlBdHRyaWJ1dGUobmV3IDwlPXNjb3BlJT4uRW50aXR5QXR0cmlidXRlKCc8JT1lYS5JZCU+JykuYWN0aXZlKHRydWUpLmVuYWJsZWQodHJ1ZSkubmFtZSgiPCU9ZWEuTmFtZSU+IikuY29kZSgiPCU9bk5hbWUoZWEpJT4iKS5lbnRpdHlDbGFzcyh0aGlzLl90b0VNU0NsYXNzKCkpKTsNCiAgICAgICAgPCUgaWYoZWEuRW50aXR5VHlwZSl7JT4NCiAgICAgICAgICAgICAgICBldi5vYmplY3RWYWx1ZSh2P3YuPCU9bU5hbWUlPihiUXVlcnksIGJUeXBlZEF0dHJpYnV0ZXMpOm51bGwsIHRoaXMuXzwlPW5OYW1lKGVhKSU+X2Nvb3ApOw0KICAgICAgICA8JSB9ZWxzZXslPg0KICAgICAgICAgICAgICAgIGV2LjwlPV9GckVNRC5fYXR0cihlYSkudG9Mb3dlckNhc2UoKSU+VmFsdWUodiwgdGhpcy5fPCU9bk5hbWUoZWEpJT5fY29vcCk7DQogICAgICAgIDwlIH0lPg0KICAgICAgICAgICAgICAgIG9iai5lbnRpdHlPYmplY3RfRW50aXR5VmFsdWVzKGV2LCAnPT0nKTsNCiAgICAgICAgICAgIH0sDQogICAgPCUgfSk7ICU+DQogICAgPCUgYy5UeXBlZEF0dHJpYnV0ZXMuZm9yRWFjaCh0YSA9PiB7IGxldCB0YU5hbWUgPSBuTmFtZSh0YSkgKyAnXycgKyB0YS5FbnRpdHlDbGFzcy5QbHVyYWwucmVwbGFjZSgvIC9nLCAnXycpOyU+DQogICAgICAgICAgICA8JT10YU5hbWUlPjogKG9iaiwgZWFDb2RlLCB2KSA9PiB7DQogICAgICAgICAgICAgICAgaWYodiAmJiBiVHlwZWRBdHRyaWJ1dGVzKSBvYmoub2JqZWN0VmFsdWVfRW50aXR5VmFsdWVzKHYubWFwKF92ID0+IG5ldyA8JT1zY29wZSU+LkVudGl0eVZhbHVlKCkuYWN0aXZlKHRydWUpLmVudGl0eUF0dHJpYnV0ZShuZXcgPCU9c2NvcGUlPi5FbnRpdHlBdHRyaWJ1dGUoJzwlPXRhLklkJT4nKS5hY3RpdmUodHJ1ZSkuZW5hYmxlZCh0cnVlKS5jb2RlKCI8JT1uTmFtZSh0YSklPiIpLm5hbWUoIjwlPXRhLk5hbWUlPiIpLmVudGl0eUNsYXNzKG5ldyA8JT1zY29wZSU+LjwlPW5OYW1lKHRhLkVudGl0eUNsYXNzLCB0cnVlKSU+KCkuX3RvRU1TQ2xhc3MoKSkpLm9iamVjdFZhbHVlKF92LjwlPW1OYW1lJT4oYlF1ZXJ5LCBiVHlwZWRBdHRyaWJ1dGVzKSkpLCAnPT0nKTsNCiAgICAgICAgICAgIH0sDQogICAgPCUgfSklPg0KICAgICAgICB9LCAiPCU9bU5hbWUlPiIpOw0KDQogICAgICAgIDwlPWxvZygpJT5yZXQpOw0KICAgICAgICByZXR1cm4gcmV0Ow0KICAgIH0NCjwlIH0gJT4NCg0KPCUgaWYobWFpbkNsYXNzKFsnQklTZXJ2ZXInXSkpeyU+DQogICAgPCU9bU5hbWU9J19hc09iamVjdHMnJT4oZXZzKXsNCiAgICA8JSBpZihtYWluQ2xhc3MoWydCSVNlcnZlciddKSE9Yyl7JT4NCiAgICAgICAgICAgIHJldHVybiBuZXcgPCU9c2NvcGUlPi48JT1uTmFtZShtYWluQ2xhc3MoWydCSVNlcnZlciddLGMpKSU+KCkuPCU9bU5hbWUlPihldnMpOw0KICAgIDwlfWVsc2V7JT4NCiAgICAgICAgdHJ5ew0KICAgICAgICAgICAgaWYodHlwZW9mKGV2cyk9PT0idW5kZWZpbmVkIiB8fCAhZXZzIHx8ICFBcnJheS5pc0FycmF5KGV2cykgfHwgIWV2cy5sZW5ndGgpIHJldHVybiBbXTsNCg0KICAgICAgICAgICAgZXZzLmZvckVhY2goZXYgPT4gew0KICAgICAgICAgICAgICAgIGV2LkVudGl0eUF0dHJpYnV0ZSA9IDwlPXNjb3BlJT4uRW50aXR5QXR0cmlidXRlcy5maW5kKGVhID0+IGVhLklkPT1ldi5FbnRpdHlBdHRyaWJ1dGVpZCk7DQogICAgICAgICAgICAgICAgZXYuRW50aXR5T2JqZWN0LkVudGl0eUNsYXNzID0gZXYuRW50aXR5QXR0cmlidXRlLkVudGl0eUNsYXNzOw0KICAgICAgICAgICAgICAgIGlmKGV2Lk9iamVjdFZhbHVlKXsNCiAgICAgICAgICAgICAgICAgICAgZXYuT2JqZWN0VmFsdWUuRW50aXR5Q2xhc3MgPSA8JT1zY29wZSU+LkVudGl0eUNsYXNzZXMuZmluZChlYyA9PiBlYy5JZD09ZXYuT2JqZWN0VmFsdWUuRW50aXR5Q2xhc3MuSWQpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0pOw0KICAgIA0KICAgICAgICAgICAgbGV0IG9iaiA9IFtdOw0KICAgICAgICAgICAgdGhpcy5ncm91cEJ5KGV2cywgIkVudGl0eU9iamVjdCIpLmZvckVhY2goZXZnID0+IHsNCiAgICAgICAgICAgICAgICBsZXQgYyA9IG5ldyA8JT1zY29wZSU+W2V2Zy5rZXkuRW50aXR5Q2xhc3MuTmFtZS5yZXBsYWNlKC8gL2csICdfJyldKCk7DQogICAgICAgICAgICAgICAgYy5FbnRpdHlWYWx1ZXMgPSBldmcudmFsdWVzOw0KICAgICAgICAgICAgICAgIGMuVmFsdWVFbnRpdGllcyA9IFtdOw0KICAgICAgICAgICAgICAgIC8vIGMuRW50aXR5Q2xhc3MgPSBldmcua2V5LkVudGl0eUNsYXNzOw0KICAgICAgICAgICAgICAgIGMuSWQgPSBldmcua2V5LklkOw0KICAgICAgICAgICAgICAgIGV2Zy52YWx1ZXMuZm9yRWFjaCh2ID0+IHYuRW50aXR5T2JqZWN0ID0gYyk7DQogICAgICAgICAgICAgICAgb2JqLnB1c2goYyk7DQogICAgICAgICAgICB9KTsNCg0KICAgICAgICAgICAgZXZzLmZpbHRlcihldiA9PiBldi5PYmplY3RWYWx1ZSkuZm9yRWFjaChldiA9PiB7DQogICAgICAgICAgICAgICAgdmFyIF9mID0gb2JqLmZpbmQobyA9PiBvLklkID09IGV2Lk9iamVjdFZhbHVlLklkKTsNCiAgICAgICAgICAgICAgICBpZihfZikgX2YuVmFsdWVFbnRpdGllcy5wdXNoKGV2KTsNCiAgICAgICAgICAgICAgICBldi5PYmplY3RWYWx1ZSA9IF9mOw0KICAgICAgICAgICAgfSk7DQogICAgICAgIA0KICAgICAgICAgICAgbGV0IHJldCA9IFtdOw0KICAgICAgICAgICAgb2JqLmZvckVhY2gobyA9PiB7DQogICAgICAgICAgICAgICAgaWYoby5FbnRpdHlDbGFzcyAmJiBvLkVudGl0eUNsYXNzLklkIT10aGlzLkVudGl0eUNsYXNzLklkKSByZXR1cm4gdHJ1ZTsNCiAgICAgICAgICAgICAgICByZXQucHVzaChvKTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgDQogICAgICAgICAgICByZXR1cm4gcmV0Lm1hcChvID0+IG8uX3JldmVydCgpKTsNCiAgICAgICAgfWNhdGNoKGV4KXsNCiAgICAgICAgICAgIDwlPWVycm9yKCklPmV4KTsNCiAgICAgICAgfQ0KICAgIDwlfSU+DQogICAgfQ0KICAgIA0KICAgIDwlPW1OYW1lPSdfcmV2ZXJ0JyU+KGVvKSB7DQogICAgICAgIGlmIChlbykgew0KICAgICAgICAgICAgLy8gcmV2ZXJ0IGZyb20gc291cmNlIGRhdGENCiAgICAgICAgICAgIGlmKGVvLkVudGl0eUNsYXNzICYmICgodGhpcy5FbnRpdHlDbGFzcy5JZCAmJiBlby5FbnRpdHlDbGFzcy5JZCE9dGhpcy5FbnRpdHlDbGFzcy5JZCkgfHwgKHRoaXMuRW50aXR5Q2xhc3MuTmFtZSAmJiBlby5FbnRpdHlDbGFzcy5OYW1lIT10aGlzLkVudGl0eUNsYXNzLk5hbWUpKSl7DQogICAgICAgICAgICAgICAgPCU9ZXJyb3IoKSU+IkNhbm5vdCByZXZlcnQgIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuRW50aXR5Q2xhc3MpICsgIiBmcm9tICIgKyBlby5FbnRpdHlDbGFzcy5OYW1lLCBlbyk7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9DQogICAgICAgICAgICB0aGlzLklkID0gZW8uSWQ7DQogICAgICAgICAgICB0aGlzLkVudGl0eVZhbHVlcyA9IGVvLkVudGl0eVZhbHVlcyB8fCBbXTsNCiAgICAgICAgICAgIHRoaXMuVmFsdWVFbnRpdGllcyA9IGVvLlZhbHVlRW50aXRpZXMgfHwgW107DQogICAgICAgICAgICByZXR1cm4gdGhpcy48JT1tTmFtZSU+KCk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBpZih0aGlzLl9fc3luY19vbigpICYmIE1hdGguYWJzKChuZXcgRGF0ZSgpLmdldFRpbWUoKSAtIHRoaXMuX19zeW5jX29uKCkuZ2V0VGltZSgpKSAvIDEwMDApIDwgNSl7DQogICAgICAgICAgICAgICAgPCU9d2FybigpJT4iT2JqZWN0IGFscmVhZHkgcmV2ZXJ0ZWQiLCB0aGlzLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgdGhpcy5fX3N5bmNfb24obmV3IERhdGUoKSk7DQogICAgICAgIA0KICAgICAgICAgICAgLy8gdXNlIEVudGl0eVZhbHVlcyBhbmQgVmFsdWVFbnRpdGllcyB0byByZXZlcnQgdGhlIGF0dHJpYnV0ZSB2YWx1ZXMNCiAgICAgICAgICAgIHRoaXMuRW50aXR5VmFsdWVzLmZvckVhY2goZXYgPT4gew0KICAgICAgICAgICAgICAgIGxldCBlYSA9IG51bGw7DQogICAgICAgICAgICAgICAgdHJ5ew0KICAgICAgICAgICAgICAgICAgICBlYSA9IDwlPXNjb3BlJT4uRW50aXR5QXR0cmlidXRlcy5maWx0ZXIoX2VhID0+IF9lYS5FbnRpdHlDbGFzcy5OYW1lPT0nPCU9Yy5OYW1lJT4nKS5maW5kKF9lYSA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZihldi5FbnRpdHlBdHRyaWJ1dGVpZD09X2VhLklkKSByZXR1cm4gX2VhOw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYoZXYuRW50aXR5QXR0cmlidXRlKXsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihldi5FbnRpdHlBdHRyaWJ1dGUuSWQ9PV9lYS5JZCkgcmV0dXJuIF9lYTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihldi5FbnRpdHlBdHRyaWJ1dGUuTmFtZT09X2VhLk5hbWUpIHJldHVybiBfZWE7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICAgICAgaWYoIWVhKXsNCiAgICAgICAgICAgICAgICAgICAgICAgIDwlPXdhcm4oKSU+InVuYWJsZSB0byBkZXRlY3QgYXR0cmlidXRlIGZyb20gdmFsdWUiLCBldik7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH1jYXRjaChleCl7DQogICAgICAgICAgICAgICAgICAgIDwlPWVycm9yKCklPmV2LCBleCk7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBsZXQgdiA9IGV2Wyh0aGlzWyJfYXR0ciJdP3RoaXM6X0ZyRU1EKS5fYXR0cihlYSkgKyAiVmFsdWUiXTsNCiAgICAgICAgICAgICAgICBsZXQgcCA9IGVhLk5hbWUucmVwbGFjZSgvIC9nLCAnXycpOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIGlmKHR5cGVvZih0aGlzW3BdKSE9PSdmdW5jdGlvbicpew0KICAgICAgICAgICAgICAgICAgICA8JT13YXJuKCklPiJpbnZhbGlkIHR5cGUiLCBlYSwgcCwgdik7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgaWYodiAmJiBlYS5FbnRpdHlUeXBlICYmIHR5cGVvZih2KT09PSdvYmplY3QnKXsNCiAgICAgICAgICAgICAgICAgICAgPCU9bG9nKCklPiJyZXZlcnRpbmcgIiArIGVhLk5hbWUsIHYsIG5ldyA8JT1zY29wZSU+W2VhLkVudGl0eVR5cGUuTmFtZS5yZXBsYWNlKC8gL2csICdfJyldKCkuPCU9bU5hbWUlPih2KSk7DQogICAgICAgICAgICAgICAgICAgIGlmKCF2LkVudGl0eVZhbHVlcyl7DQogICAgICAgICAgICAgICAgICAgICAgICA8JT13YXJuKCklPiJlbXB0eSB2YWx1ZXMgZm9yICIgKyBlYS5OYW1lLCB2KTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB2ID0gdi48JT1tTmFtZSU+P3YuPCU9bU5hbWUlPigpOm5ldyA8JT1zY29wZSU+W2VhLkVudGl0eVR5cGUuTmFtZS5yZXBsYWNlKC8gL2csICdfJyldKCkuPCU9bU5hbWUlPih2KTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgdGhpc1twXSh2KTsNCiAgICAgICAgICAgIH0pOw0KDQogICAgICAgICAgICB0aGlzLlZhbHVlRW50aXRpZXMuZmlsdGVyKHZlID0+IHZlLkVudGl0eUF0dHJpYnV0ZSkuZm9yRWFjaCh2ZSA9PiB7DQogICAgICAgICAgICAgICAgdmFyIHRhID0gPCU9c2NvcGUlPi5FbnRpdHlBdHRyaWJ1dGVzLmZpbmQoZWEgPT4gZWEuSWQ9PXZlLkVudGl0eUF0dHJpYnV0ZS5JZCk7DQogICAgICAgICAgICAgICAgaWYoIXRhKSByZXR1cm4gbnVsbDsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICB2YXIgdGFOYW1lID0gdGEuRW50aXR5Q2xhc3MuUGx1cmFsLnJlcGxhY2UoLyAvZywgJ18nKTsNCg0KICAgICAgICAgICAgICAgIGxldCB2ID0gdmUuRW50aXR5T2JqZWN0Ow0KICAgICAgICAgICAgICAgIGlmKHYpew0KICAgICAgICAgICAgICAgICAgICB2ID0gdi48JT1tTmFtZSU+P3YuPCU9bU5hbWUlPigpOm5ldyA8JT1zY29wZSU+W3RhLkVudGl0eVR5cGUuTmFtZS5yZXBsYWNlKC8gL2csICdfJyldKCkuPCU9bU5hbWUlPih2KTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgdGhpc1t0YS5OYW1lLnJlcGxhY2UoLyAvZywgIl8iKSArICJfIiArIHRhTmFtZV0odik7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICB9DQogICAgDQogICAgPCU9bU5hbWU9J192YWx1ZUNsYXNzJyU+KCl7DQogICAgICAgIGxldCBfY2xhc3MgPSB7QWN0aXZlOiB0cnVlfTsNCiAgICAgICAgaWYodGhpcy5FbnRpdHlDbGFzcy5FbnRpdHlNb2R1bGUpew0KICAgICAgICAgICAgX2NsYXNzLkVudGl0eU1vZHVsZSA9IHRoaXMuRW50aXR5Q2xhc3MuRW50aXR5TW9kdWxlOw0KICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgIF9jbGFzcyA9IHsNCiAgICAgICAgICAgICAgICBBY3RpdmU6IHRydWUsDQogICAgICAgICAgICAgICAgQ29tcGFueToge0FjdGl2ZTogdHJ1ZSwgRW5hYmxlZDogdHJ1ZSwgRW50aXR5Q2xhc3NlczogW3RoaXMuRW50aXR5Q2xhc3NdfQ0KICAgICAgICAgICAgfTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gX2NsYXNzOw0KICAgIH0NCg0KICAgIDwlPW1OYW1lPSdfdG9YTUwnJT4oKXsNCiAgICAgICAgLy8gYW4gb3ZlcmxvYWQgb2YgdGhlIHNyLl90b1hNTA0KICAgICAgICBsZXQgcmV0ID0ge3htbDogYGB9Ow0KICAgICAgICByZXQgPSB0aGlzLl9fZXhwb3J0KHJldCwgew0KICAgICAgICAgICAgSWQ6IChvYmosIGVhQ29kZSwgdikgPT4gcmV0LnhtbCArPSBgPCR7dGhpcy5fX2NvbmZpZygnaWRGaWVsZCcpfHwnSWQnfT4ke3Z9PC8ke3RoaXMuX19jb25maWcoJ2lkRmllbGQnKXx8J0lkJ30+YCwNCiAgICA8JSBjLkVudGl0eUF0dHJpYnV0ZXMuZmlsdGVyKGVhID0+ICFlYS5FbnRpdHlNZXRob2QpLmZvckVhY2goZWEgPT4geyAlPg0KICAgICAgICAgICAgIjwlPW5OYW1lKGVhKSU+IjogKG9iaiwgZWFDb2RlLCB2KSA9PiB7DQogICAgICAgICAgICAgICAgcmV0LnhtbCArPSBgPCR7ZWFDb2RlfT5gOw0KICAgICAgICA8JSBpZihlYS5FbnRpdHlUeXBlKXslPg0KICAgICAgICAgICAgICAgIHJldC54bWwgKz0gdj92LjwlPW1OYW1lJT4oKTpudWxsOw0KICAgICAgICA8JSB9ZWxzZXslPg0KICAgICAgICAgICAgICAgIHJldC54bWwgKz0gYDwhW0NEQVRBWyR7dn1dXT5gOw0KICAgICAgICA8JSB9JT4NCiAgICAgICAgICAgICAgICByZXQueG1sICs9IGA8LyR7ZWFDb2RlfT5gOw0KICAgICAgICAgICAgfSwNCiAgICA8JSB9KTsgJT4NCiAgICA8JSBjLlR5cGVkQXR0cmlidXRlcy5mb3JFYWNoKHRhID0+IHsgbGV0IHRhTmFtZSA9IG5OYW1lKHRhKSArICdfJyArIHRhLkVudGl0eUNsYXNzLlBsdXJhbC5yZXBsYWNlKC8gL2csICdfJyk7JT4NCiAgICAgICAgICAgIDwlPXRhTmFtZSU+OiAob2JqLCBlYUNvZGUsIHYpID0+IHsNCiAgICAgICAgICAgICAgICByZXQueG1sICs9IGA8JHtlYUNvZGV9PmAgKyB2Lm1hcChfdiA9PiAnPE9iamVjdD4nICsgX3YuPCU9bU5hbWUlPigpICsgIjwvT2JqZWN0PiIpLmpvaW4oJycpICsgYDwvJHtlYUNvZGV9PmA7DQogICAgICAgICAgICB9LA0KICAgIDwlIH0pJT4NCiAgICAgICAgfSwgIjwlPW1OYW1lJT4iKTsNCg0KICAgICAgICA8JT1sb2coKSU+cmV0KTsNCiAgICAgICAgcmV0dXJuIHJldC54bWw7DQogICAgfQ0KDQogICAgPCU9bU5hbWU9J19idWlsZFRoaXMnJT4oZGVwdGg9MSl7DQogICAgICAgIC8vIGNhbmRpZGF0ZSBmb3IgX19leHBvcnQNCiAgICAgICAgdmFyIHJldCA9IFt7DQogICAgICAgICAgICBBY3RpdmU6IHRydWUsDQogICAgICAgICAgICBFbnRpdHlBdHRyaWJ1dGU6IHtBY3RpdmU6IHRydWUsIEVudGl0eUNsYXNzOiB0aGlzLl92YWx1ZUNsYXNzKCl9LA0KICAgICAgICAgICAgRW50aXR5T2JqZWN0OiB0aGlzLnRvRW50aXR5T2JqZWN0KHRydWUpLA0KICAgICAgICB9XTsNCiAgICAgICAgZm9yICh2YXIgaSA9IDE7IGkgPD0gZGVwdGg7IGkrKykgew0KICAgICAgICAgICAgcmV0LnB1c2goew0KICAgICAgICAgICAgICAgIEFjdGl2ZTogdHJ1ZSwNCiAgICAgICAgICAgICAgICBFbnRpdHlPYmplY3Q6IHsNCiAgICAgICAgICAgICAgICAgICAgQWN0aXZlOiB0cnVlLA0KICAgICAgICAgICAgICAgICAgICBWYWx1ZUVudGl0aWVzOiBbcmV0W2kgLSAxXV0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KICAgICAgICANCjwlIGMuVHlwZWRBdHRyaWJ1dGVzLmZpbHRlcih0YSA9PiAhdGEuRW50aXR5TWV0aG9kKS5mb3JFYWNoKHRhID0+IHslPg0KICAgICAgICBpZihkZXB0aD4xKXsNCiAgICAgICAgICAgIGxldCB2ID0gbmV3IDwlPXNjb3BlJT4uPCU9bk5hbWUodGEuRW50aXR5Q2xhc3MsIHRydWUpJT4oKS48JT1uTmFtZSh0YSklPih0aGlzKTsNCiAgICAgICAgICAgIHJldC5wdXNoKHsNCiAgICAgICAgICAgICAgICBBY3RpdmU6IHRydWUsDQogICAgICAgICAgICAgICAgRW50aXR5T2JqZWN0OiB2P3YudG9FbnRpdHlPYmplY3QodHJ1ZSk6bnVsbCwNCiAgICAgICAgICAgIH0pOw0KICAgIA0KICAgICAgICAgICAgcmV0LnB1c2goew0KICAgICAgICAgICAgICAgIEVudGl0eU9iamVjdDogew0KICAgICAgICAgICAgICAgICAgICBBY3RpdmU6IHRydWUsDQogICAgICAgICAgICAgICAgICAgIFZhbHVlRW50aXRpZXM6IFt7DQogICAgICAgICAgICAgICAgICAgICAgICBBY3RpdmU6IHRydWUsDQogICAgICAgICAgICAgICAgICAgICAgICBFbnRpdHlPYmplY3Q6IHY/di50b0VudGl0eU9iamVjdCh0cnVlKTpudWxsLA0KICAgICAgICAgICAgICAgICAgICB9XQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9DQo8JSB9KSU+DQogICAgICAgIA0KICAgICAgICByZXR1cm4gcmV0Ow0KICAgIH0NCiAgICANCiAgICA8JT1tTmFtZT0ndG9FbnRpdHlPYmplY3QnJT4oYlF1ZXJ5LCBiVHlwZWRBdHRyaWJ1dGVzKSB7DQogICAgICAgIGxldCByZXQgPSB7QWN0aXZlOiB0cnVlLCBFbnRpdHlDbGFzczogdGhpcy5fdmFsdWVDbGFzcygpLCBFbnRpdHlWYWx1ZXM6IFtdLCBWYWx1ZUVudGl0aWVzOiBbXX07DQogICAgICAgIGlmKCFiUXVlcnkpIHJldC5EYXRlID0gdGhpcy5zZXJ2ZXJEYXRlKCk7IA0KDQogICAgICAgIHJldCA9IHRoaXMuX19leHBvcnQocmV0LCB7DQogICAgICAgICAgICBGdWxsOiAhYlF1ZXJ5LA0KICAgICAgICAgICAgSWQ6IChvYmosIGVhQ29kZSwgdikgPT4gb2JqLklkID0gdiwNCiAgICA8JSBjLkVudGl0eUF0dHJpYnV0ZXMuZmlsdGVyKGVhID0+ICFlYS5FbnRpdHlNZXRob2QpLmZvckVhY2goZWEgPT4geyAlPg0KICAgICAgICAgICAgIjwlPW5OYW1lKGVhKSU+IjogKG9iaiwgZWFDb2RlLCB2KSA9PiB7DQogICAgICAgICAgICAgICAgbGV0IGV2ID0gew0KICAgICAgICAgICAgICAgICAgICBBY3RpdmU6IHRydWUsDQogICAgICAgICAgICAgICAgICAgIEVudGl0eUF0dHJpYnV0ZTogew0KICAgICAgICAgICAgICAgICAgICAgICAgSWQ6IDwlPXNjb3BlJT4uRW50aXR5Q2xhc3Nlcy5maW5kKGMgPT4gYy5JZCA9IHRoaXMuRW50aXR5Q2xhc3MuSWQpLkVudGl0eUF0dHJpYnV0ZXMuZmluZChlYSA9PiBlYS5OYW1lPT0nPCU9ZWEuTmFtZSU+JykuSWQsDQogICAgICAgICAgICAgICAgICAgICAgICBBY3RpdmU6IHRydWUsDQogICAgICAgICAgICAgICAgICAgICAgICBOYW1lOiAiPCU9ZWEuTmFtZSU+IiwNCiAgICAgICAgICAgICAgICAgICAgICAgIEVudGl0eUNsYXNzOiB0aGlzLl92YWx1ZUNsYXNzKCksDQogICAgICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgICAgIE9QRVJBVE9SUzoge30sDQogICAgICAgICAgICAgICAgfTsNCiAgICAgICAgPCUgaWYoZWEuRW50aXR5VHlwZSl7JT4NCiAgICAgICAgICAgICAgICBpZih2KXsNCiAgICAgICAgICAgICAgICAgICAgZXYuT2JqZWN0VmFsdWUgPSB2LjwlPW1OYW1lJT4oYlF1ZXJ5LCBiVHlwZWRBdHRyaWJ1dGVzKTsNCiAgICAgICAgICAgICAgICAgICAgZXYuT1BFUkFUT1JTLk9iamVjdFZhbHVlID0gdGhpcy5fPCU9bk5hbWUoZWEpJT5fY29vcDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIDwlIH1lbHNleyU+DQogICAgICAgICAgICAgICAgZXYuPCU9X0ZyRU1ELl9hdHRyKGVhKSU+VmFsdWUgPSB2Ow0KICAgICAgICAgICAgICAgIGV2Lk9QRVJBVE9SUy48JT1fRnJFTUQuX2F0dHIoZWEpJT5WYWx1ZSA9IHRoaXMuXzwlPW5OYW1lKGVhKSU+X2Nvb3A7DQogICAgICAgIDwlIH0lPg0KICAgICAgICAgICAgICAgIG9iai5WYWx1ZUVudGl0aWVzLnB1c2goZXYpOw0KICAgICAgICAgICAgfSwNCiAgICA8JSB9KTsgJT4NCiAgICA8JSBjLlR5cGVkQXR0cmlidXRlcy5mb3JFYWNoKHRhID0+IHsgbGV0IHRhTmFtZSA9IG5OYW1lKHRhKSArICdfJyArIHRhLkVudGl0eUNsYXNzLlBsdXJhbC5yZXBsYWNlKC8gL2csICdfJyk7JT4NCiAgICAgICAgICAgIDwlPXRhTmFtZSU+OiAob2JqLCBlYUNvZGUsIHYpID0+IHsNCiAgICAgICAgICAgICAgICBpZih2ICYmIGJUeXBlZEF0dHJpYnV0ZXMpIG9iai5FbnRpdHlWYWx1ZXMucHVzaCh2Lm1hcChfdiA9PiAoew0KICAgICAgICAgICAgICAgICAgICBBY3RpdmU6IHRydWUsDQogICAgICAgICAgICAgICAgICAgIEVudGl0eUF0dHJpYnV0ZTogew0KICAgICAgICAgICAgICAgICAgICAgICAgSWQ6ICc8JT10YS5JZCU+JywNCiAgICAgICAgICAgICAgICAgICAgICAgIEFjdGl2ZTogdHJ1ZSwNCiAgICAgICAgICAgICAgICAgICAgICAgIE5hbWU6ICI8JT10YS5OYW1lJT4iLA0KICAgICAgICAgICAgICAgICAgICAgICAgRW50aXR5Q2xhc3M6IG5ldyA8JT1zY29wZSU+LjwlPW5OYW1lKHRhLkVudGl0eUNsYXNzLCB0cnVlKSU+KCkuX3ZhbHVlQ2xhc3MoKSwNCiAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAgICAgT2JqZWN0VmFsdWU6IF92LjwlPW1OYW1lJT4oYlF1ZXJ5LCBiVHlwZWRBdHRyaWJ1dGVzKSwNCiAgICAgICAgICAgICAgICB9KSkpOw0KICAgICAgICAgICAgfSwNCiAgICA8JSB9KSU+DQogICAgICAgIH0sICI8JT1tTmFtZSU+Iik7DQoNCiAgICAgICAgPCU9bG9nKCklPnJldCk7DQogICAgICAgIHJldHVybiByZXQ7DQogICAgfQ0KPCUgfSAlPg0KfQ0K",
	"__keys": ["name"],
	"active": true,
	"enabled": true,
	"__trMap": [{
		"id": "019579a8a9f975d28e899056446f9e82",
		"transform": "KiojJGZbaW50ZXJuYWxfbmFtZT1cXCciK2MuTmFtZSsiX2xvb2t1cFxcJyBhbmQgJG5vdCgkZXhpc3RzKGZsb3dfRmxvd19TbmFwc2hvdHMpKV0uc25hcHNob3RfRmxvd19Mb2dpY3MuKioucGFyZW50X0Zsb3dfSW5zdGFuY2VzIyRmaVskbnVtYmVyKG9yZGVyKTw9IitiT3JkZXIrIiBhbmQgc3ViZmxvdy5pbnRlcm5hbF9uYW1lPVxcJyIrZWEuRW50aXR5VHlwZS5OYW1lKyJfbG9va3VwXFwnXS51aV9pZA=="
	}, {
		"id": "019579a8a9f975d28e8996f3f8c94f2c",
		"transform": "JC5zeXNfc2NvcGUuc2NvcGU="
	}, {
		"id": "019579a8a9f975d28e899928109a1532",
		"transform": "W14="
	}, {
		"id": "019579a8a9f975d28e89a1efd1709cb1",
		"transform": "JywgJycpLnJlcGxhY2UoJw=="
	}]
}