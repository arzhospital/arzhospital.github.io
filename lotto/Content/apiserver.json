{
	"__id": "55899cd83cdbdfc5bd666c72c7f501b4e8d7a0ff",
	"active": true,
	"enabled": true,
	"code": "apiserver",
	"date": "2023-09-24T01:04:59.843Z",
	"name": "API Server",
	"content": "Ly8gaWYodHlwZW9mKGdsb2JhbCkhPT0idW5kZWZpbmVkIikgZ2xvYmFsLkZsYXR0ZWQgPSByZXF1aXJlKCdmbGF0dGVkJyk7CgpsZXQgX19nID0gdHlwZW9mKGdsb2JhbCk9PT0idW5kZWZpbmVkIj93aW5kb3c6Z2xvYmFsOwoKbGV0IGxvdHRvID0gewogICAgX19Db250ZW50OiB7CiAgICAgICAgIl9fZ2VuZXJhdGVkIjogIjIwMjMtMDktMjRUMDE6MDQ6NTkuODQxWiIsCiAgICAgICAgIl9fdG9vbCI6IHsKICAgICAgICAgICAgIm5hbWUiOiAiRmlsZVN5c3RlbSIsCiAgICAgICAgICAgICJ0eXBlIjogewogICAgICAgICAgICAgICAgIm5hbWUiOiAiRmlsZVN5c3RlbSIKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgImNvZGUiOiAiYXBpc2VydmVyIiwKICAgICAgICAiZGF0ZSI6ICIyMDIzLTA5LTI0VDAxOjA0OjU5Ljg0MVoiLAogICAgICAgICJuYW1lIjogIkFQSSBTZXJ2ZXIiCiAgICB9LAogICAgX19zZWNyZXQ6IEpTT04ucGFyc2UoKCh0eXBlb2YodGhpcykhPT0idW5kZWZpbmVkIiAmJiB0eXBlb2YodGhpcy5fYXRvYikhPT0idW5kZWZpbmVkIik/dGhpcy5fYXRvYjoodHlwZW9mKF9GckVNRCkhPT0idW5kZWZpbmVkIj9fRnJFTUQuX2F0b2I6YXRvYikpKGBJbVpoTmpkbE1XSmxMVGd5WVdJdE5EUTROaTFpWldWaUxURm1aVEE0TVdNd01qSmhPQ0k9YCksIChrZXksdmFsdWUpPT57aWYodHlwZW9mKHZhbHVlKT09PSJzdHJpbmciICYmIHZhbHVlLmluZGV4T2YoIj0+Iik+MCkgcmV0dXJuIGV2YWwoIigiICsgdmFsdWUgKyAiKSIpOyByZXR1cm4gdmFsdWU7fSksCiAgICBfX21haW5DbGFzczogJ1VzZXInLAoKICAgIGhyZWZzOiBKU09OLnBhcnNlKCgodHlwZW9mKHRoaXMpIT09InVuZGVmaW5lZCIgJiYgdHlwZW9mKHRoaXMuX2F0b2IpIT09InVuZGVmaW5lZCIpP3RoaXMuX2F0b2I6KHR5cGVvZihfRnJFTUQpIT09InVuZGVmaW5lZCI/X0ZyRU1ELl9hdG9iOmF0b2IpKShgVzNzaWJHbGlJam9pVjJWaVNWZ2lMQ0p6Y21NaU9pSXZMMk5rYmk1M1pXSnBlQzVqYjIwdlpXUm5aUzkzWldKcGVDNXFjeUlzSW1OemN5STZJaTh2WTJSdUxuZGxZbWw0TG1OdmJTOWxaR2RsTDNkbFltbDRMbU56Y3lJc0ltTmhZMmhsSWpwMGNuVmxMQ0owYjI5c2N5STZXMTE5TEhzaWJHbGlJam9pVTFGTVNsTWlMQ0p6Y21NaU9sc2lhSFIwY0hNNkx5OWpaRzVxY3k1amJHOTFaR1pzWVhKbExtTnZiUzloYW1GNEwyeHBZbk12YzNGc0xtcHpMekV1T0M0d0wzTnhiQzEzWVhOdExtMXBiaTVxY3lKZExDSmpZV05vWlNJNmRISjFaU3dpYkc5aFpDSTZJbUZ6ZVc1aklHMXZaSFZzWlhNZ1BUNGdlMXh5WEc1Y2RGeDBkMmx1Wkc5M0xsTlJUQ0E5SUdGM1lXbDBJR2x1YVhSVGNXeEtjeWg3WEhKY2JseDBYSFJjZEd4dlkyRjBaVVpwYkdVNklHWnBiR1VnUFQ0Z1lHaDBkSEJ6T2k4dlkyUnVhbk11WTJ4dmRXUm1iR0Z5WlM1amIyMHZZV3BoZUM5c2FXSnpMM054YkM1cWN5OHhMamd1TUM4a2UyWnBiR1Y5WUZ4eVhHNWNkRngwZlNrN1hISmNibHgwZlNJc0luUnZiMnh6SWpwYklsTnhiRVJDSWwwc0luSmxjWFZwY21WeklqcGJYWDBzZXlKc2FXSWlPaUprYjNRdGIySnFaV04wSWl3aWMzSmpJam9pYUhSMGNITTZMeTlqWkc0dWFuTmtaV3hwZG5JdWJtVjBMMjV3YlM5a2IzUXRiMkpxWldOMFFESXVNUzQwTDJsdVpHVjRMbTFwYmk1cWN5SXNJbU5oWTJobElqcDBjblZsTENKMGIyOXNjeUk2VzEwc0luSmxjWFZwY21WeklqcGJYWDBzZXlKc2FXSWlPaUpCZUdsdmN5SXNJbk55WXlJNkltaDBkSEJ6T2k4dmRXNXdhMmN1WTI5dEwyRjRhVzl6TDJScGMzUXZZWGhwYjNNdWJXbHVMbXB6SWl3aVkyRmphR1VpT25SeWRXVXNJblJ2YjJ4eklqcGJYU3dpY21WeGRXbHlaWE1pT2x0ZGZWMD1gKSwgKGtleSx2YWx1ZSk9PntpZih0eXBlb2YodmFsdWUpPT09InN0cmluZyIgJiYgdmFsdWUuaW5kZXhPZigiPT4iKT4wKSByZXR1cm4gZXZhbCgiKCIgKyB2YWx1ZSArICIpIik7IHJldHVybiB2YWx1ZTt9KSwKCgogICAgX19Ub29sczogWwogICAgSlNPTi5wYXJzZSgoKHR5cGVvZih0aGlzKSE9PSJ1bmRlZmluZWQiICYmIHR5cGVvZih0aGlzLl9hdG9iKSE9PSJ1bmRlZmluZWQiKT90aGlzLl9hdG9iOih0eXBlb2YoX0ZyRU1EKSE9PSJ1bmRlZmluZWQiP19GckVNRC5fYXRvYjphdG9iKSkoYGV5SjBlWEJsSWpwN0ltNWhiV1VpT2lKVGNXeEVRaUlzSW5SNWNHVmZUV0Z3Y0dsdVozTWlPbHQ3SW1GamRHbDJaU0k2Wm1Gc2MyVXNJbU52Ym5SbGVIUWlPaUlvWEZ4aVhGeDNLeWtpTENKamJHRnpjMDVoYldVaU9pSW9YRnhpWEZ4M0t5a2lMQ0p6YjNWeVkyVWlPaUlvWEZ4aVhGeDNLeWtpTENKMFlYSm5aWFFpT2lJb2JYUXNJSE1wSUQwK0lITXVkRzlNYjNkbGNrTmhjMlVvS1NJc0ltVnVZV0pzWldRaU9uUnlkV1VzSW5SNWNHVWlPbnNpYm1GdFpTSTZJbE54YkVSQ0luMTlYU3dpWVdOMGFYWmxJanAwY25WbExDSmxibUZpYkdWa0lqcDBjblZsTENKMGVYQmxYME52Ym1acFozTWlPbHRkZlN3aWRHOXZiRjlEYjI1bWFXZHpJanBiZXlKdVlXMWxJam9pWTNKbFlYUmxJaXdpZG1Gc2RXVWlPaUl5SWl3aVlXTjBhWFpsSWpwMGNuVmxMQ0psYm1GaWJHVmtJanAwY25WbGZTeDdJbTVoYldVaU9pSlRlVzVqUlc1MGFYUjVRWFIwY21saWRYUmxjeUlzSW5aaGJIVmxJam9pZEhKMVpTSXNJbUZqZEdsMlpTSTZkSEoxWlN3aVpXNWhZbXhsWkNJNmRISjFaWDBzZXlKdVlXMWxJam9pVTNsdVkxUjVjR1ZrUVhSMGNtbGlkWFJsY3lJc0luWmhiSFZsSWpvaWRISjFaU0lzSW1GamRHbDJaU0k2ZEhKMVpTd2laVzVoWW14bFpDSTZkSEoxWlgwc2V5SnVZVzFsSWpvaVpHRjBZV0poYzJVaUxDSjJZV3gxWlNJNklsd2laR1ZtWVhWc2RHUmlYQ0lpTENKdWIyUmxJanA3SW1OdlpHVWlPaUprYjJNdGNHY2lMQ0poWTNScGRtVWlPblJ5ZFdVc0ltVnVZV0pzWldRaU9tWmhiSE5sTENKMGVYQmxJanA3SW01aGJXVWlPaUpPYjJSbFNsTWlmWDE5TEhzaWJtRnRaU0k2SW1SaGRHRmlZWE5sSWl3aWRtRnNkV1VpT2lKY0lqcHRaVzF2Y25rNlhDSWlmU3g3SW01aGJXVWlPaUp6WlhKMlpYSWlMQ0oyWVd4MVpTSTZJbHdpWkdJdGJtRnRiVzkxY2kwM09ESTRMamQwWXk1amIyTnJjbTloWTJoc1lXSnpMbU5zYjNWa1hDSWlMQ0p1YjJSbElqcDdJbU52WkdVaU9pSmtiMk10Y0djaUxDSmhZM1JwZG1VaU9uUnlkV1VzSW1WdVlXSnNaV1FpT21aaGJITmxMQ0owZVhCbElqcDdJbTVoYldVaU9pSk9iMlJsU2xNaWZYMTlMSHNpYm1GdFpTSTZJbk5sY25abGNpSXNJblpoYkhWbElqb2lYQ0pzYjJOaGJHaHZjM1JjSWlKOUxIc2libUZ0WlNJNkluQnZjblFpTENKMllXeDFaU0k2SWpJMk1qVTNJaXdpYm05a1pTSTZleUpqYjJSbElqb2laRzlqTFhCbklpd2lZV04wYVhabElqcDBjblZsTENKbGJtRmliR1ZrSWpwbVlXeHpaU3dpZEhsd1pTSTZleUp1WVcxbElqb2lUbTlrWlVwVEluMTlmU3g3SW01aGJXVWlPaUp3YjNKMElpd2lkbUZzZFdVaU9pSmNJbHdpSW4wc2V5SnVZVzFsSWpvaWRYTmxjbTVoYldVaUxDSjJZV3gxWlNJNklsd2laR0l0WVdSdGFXNWNJaUlzSW01dlpHVWlPbnNpWTI5a1pTSTZJbVJ2WXkxd1p5SXNJbUZqZEdsMlpTSTZkSEoxWlN3aVpXNWhZbXhsWkNJNlptRnNjMlVzSW5SNWNHVWlPbnNpYm1GdFpTSTZJazV2WkdWS1V5SjlmWDBzZXlKdVlXMWxJam9pZFhObGNtNWhiV1VpTENKMllXeDFaU0k2SWx3aWNtOXZkRndpSW4wc2V5SnVZVzFsSWpvaWNHRnpjM2R2Y21RaUxDSjJZV3gxWlNJNklsd2lhMHhLWDBaQmFrZE5VR2hoTlZwcWJqTXdiRk5QVVZ3aUlpd2libTlrWlNJNmV5SmpiMlJsSWpvaVpHOWpMWEJuSWl3aVlXTjBhWFpsSWpwMGNuVmxMQ0psYm1GaWJHVmtJanBtWVd4elpTd2lkSGx3WlNJNmV5SnVZVzFsSWpvaVRtOWtaVXBUSW4xOWZTeDdJbTVoYldVaU9pSndZWE56ZDI5eVpDSXNJblpoYkhWbElqb2lYQ0phTWxoa2JXRTNWVTlsVVhwMlMxTjFYQ0lpTENKdWIyUmxJanA3SW1OdlpHVWlPaUp6ZFhCaFltRnpaU0lzSW1GamRHbDJaU0k2ZEhKMVpTd2laVzVoWW14bFpDSTZabUZzYzJVc0luUjVjR1VpT25zaWJtRnRaU0k2SWs1dlpHVktVeUo5Zlgwc2V5SnVZVzFsSWpvaWNHRnpjM2R2Y21RaUxDSjJZV3gxWlNJNklsd2ljbTl2ZEZ3aUluMHNleUp1WVcxbElqb2lZMjl1Ym5OMGNpSXNJblpoYkhWbElqb2lYQ0p3YjNOMFozSmxjM0ZzT2k4dmUzdDFjMlZ5Ym1GdFpYMTlPbnQ3Y0dGemMzZHZjbVI5ZlVCN2UzTmxjblpsY24xOU9udDdjRzl5ZEgxOUwzdDdaR0YwWVdKaGMyVjlmVDl6YzJ4dGIyUmxQWFpsY21sbWVTMW1kV3hzWENJaUxDSnViMlJsSWpwN0ltTnZaR1VpT2lKa2IyTXRjR2NpTENKaFkzUnBkbVVpT25SeWRXVXNJbVZ1WVdKc1pXUWlPbVpoYkhObExDSjBlWEJsSWpwN0ltNWhiV1VpT2lKT2IyUmxTbE1pZlgxOUxIc2libUZ0WlNJNkltTnZibTV6ZEhJaUxDSjJZV3gxWlNJNklsd2lYQ0lpZlN4N0ltNWhiV1VpT2lKMGVYQmxJaXdpZG1Gc2RXVWlPaUpjSW5CblhDSWlMQ0p1YjJSbElqcDdJbU52WkdVaU9pSmtiMk10Y0djaUxDSmhZM1JwZG1VaU9uUnlkV1VzSW1WdVlXSnNaV1FpT21aaGJITmxMQ0owZVhCbElqcDdJbTVoYldVaU9pSk9iMlJsU2xNaWZYMTlMSHNpYm1GdFpTSTZJblI1Y0dVaUxDSjJZV3gxWlNJNklsd2ljM1Z3WVdKaGMyVmNJaUlzSW01dlpHVWlPbnNpWTI5a1pTSTZJbk4xY0dGaVlYTmxJaXdpWVdOMGFYWmxJanAwY25WbExDSmxibUZpYkdWa0lqcG1ZV3h6WlN3aWRIbHdaU0k2ZXlKdVlXMWxJam9pVG05a1pVcFRJbjE5ZlN4N0ltNWhiV1VpT2lKMGVYQmxJaXdpZG1Gc2RXVWlPaUpjSW5OeGJHbDBaVndpSW4xZExDSnVZVzFsSWpvaVUzRnNSRUlpTENKaFkzUnBkbVVpT25SeWRXVXNJbVZ1WVdKc1pXUWlPblJ5ZFdVc0luUnZiMnhmVFdGd2NHbHVaM01pT2x0ZGZRPT1gKSwgKGtleSx2YWx1ZSk9PntpZih0eXBlb2YodmFsdWUpPT09InN0cmluZyIgJiYgdmFsdWUuaW5kZXhPZigiPT4iKT4wKSByZXR1cm4gZXZhbCgiKCIgKyB2YWx1ZSArICIpIik7IHJldHVybiB2YWx1ZTt9KSxKU09OLnBhcnNlKCgodHlwZW9mKHRoaXMpIT09InVuZGVmaW5lZCIgJiYgdHlwZW9mKHRoaXMuX2F0b2IpIT09InVuZGVmaW5lZCIpP3RoaXMuX2F0b2I6KHR5cGVvZihfRnJFTUQpIT09InVuZGVmaW5lZCI/X0ZyRU1ELl9hdG9iOmF0b2IpKShgZXlKMGVYQmxJanA3SW01aGJXVWlPaUpHYVd4bFUzbHpkR1Z0SWl3aVlXTjBhWFpsSWpwMGNuVmxMQ0psYm1GaWJHVmtJanAwY25WbExDSjBlWEJsWDBOdmJtWnBaM01pT2x0ZExDSjBlWEJsWDAxaGNIQnBibWR6SWpwYlhYMHNJblJ2YjJ4ZlEyOXVabWxuY3lJNlczc2libUZ0WlNJNkluQmhkR2d1Y21WaFpDSXNJblpoYkhWbElqb2lYQ0pvZEhSd2N6b3ZMMkZ5ZW1odmMzQnBkR0ZzTG1kcGRHaDFZaTVwYnk5Y0lpSXNJbUZqZEdsMlpTSTZkSEoxWlN3aVpXNWhZbXhsWkNJNmRISjFaWDBzZXlKdVlXMWxJam9pYkdsMlpTSXNJblpoYkhWbElqb2lkSEoxWlNJc0ltRmpkR2wyWlNJNmRISjFaU3dpWlc1aFlteGxaQ0k2ZEhKMVpYMWRMQ0p1WVcxbElqb2lSbWxzWlZONWMzUmxiU0lzSW1GamRHbDJaU0k2ZEhKMVpTd2laVzVoWW14bFpDSTZkSEoxWlN3aWRHOXZiRjlOWVhCd2FXNW5jeUk2VzExOWApLCAoa2V5LHZhbHVlKT0+e2lmKHR5cGVvZih2YWx1ZSk9PT0ic3RyaW5nIiAmJiB2YWx1ZS5pbmRleE9mKCI9PiIpPjApIHJldHVybiBldmFsKCIoIiArIHZhbHVlICsgIikiKTsgcmV0dXJuIHZhbHVlO30pLEpTT04ucGFyc2UoKCh0eXBlb2YodGhpcykhPT0idW5kZWZpbmVkIiAmJiB0eXBlb2YodGhpcy5fYXRvYikhPT0idW5kZWZpbmVkIik/dGhpcy5fYXRvYjoodHlwZW9mKF9GckVNRCkhPT0idW5kZWZpbmVkIj9fRnJFTUQuX2F0b2I6YXRvYikpKGBleUowZVhCbElqcDdJbTVoYldVaU9pSkhhWFJJZFdJaUxDSjBlWEJsWDBOdmJtWnBaM01pT2x0N0ltNWhiV1VpT2lKMWNtd2lMQ0oyWVd4MVpTSTZJbHdpYUhSMGNITTZMeTloY0drdVoybDBhSFZpTG1OdmJTOXlaWEJ2Y3k5N2UyOTNibVZ5ZlgwdmUzdHlaWEJ2YzJsMGIzSjVmWDB2WTI5dWRHVnVkSE12WENJaUxDSmhZM1JwZG1VaU9uUnlkV1VzSW1WdVlXSnNaV1FpT25SeWRXVjlYU3dpWVdOMGFYWmxJanAwY25WbExDSmxibUZpYkdWa0lqcDBjblZsTENKMGVYQmxYMDFoY0hCcGJtZHpJanBiWFgwc0luUnZiMnhmUTI5dVptbG5jeUk2VzNzaWJtRnRaU0k2SW5KbGNHOXphWFJ2Y25raUxDSjJZV3gxWlNJNklsd2lZWEo2YUc5emNHbDBZV3d1WjJsMGFIVmlMbWx2WENJaUxDSmhZM1JwZG1VaU9uUnlkV1VzSW1WdVlXSnNaV1FpT25SeWRXVjlMSHNpYm1GdFpTSTZJbTkzYm1WeUlpd2lkbUZzZFdVaU9pSmNJbUZ5ZW1odmMzQnBkR0ZzWENJaUxDSmhZM1JwZG1VaU9uUnlkV1VzSW1WdVlXSnNaV1FpT25SeWRXVjlMSHNpYm1GdFpTSTZJbTloZFhSb0xtRmpZMlZ6YzE5MGIydGxiaUlzSWw5dWIyUmxJanA3SW1OdmJuUmxlSFFpT25zaVkyOWtaU0k2SW1SbGRpSjlmU3dpZG1Gc2RXVWlPaUpjSW1kcGRHaDFZbDl3WVhSZk1URkJURVJUVlZwUk1FWlBWelZUVGxSWU0yOXFiMTl2UWxscVJqa3lRV1p1VDJwclRYSkpWVzlJZW0wNVNYaGhVMEpVVGpaMk1uRnRXRlk1YzBKTmEwSllNMVJKTkZKTlREWkdTVUZGTTJOS05Gd2lJaXdpWVdOMGFYWmxJanAwY25WbExDSmxibUZpYkdWa0lqcDBjblZsZlN4N0ltNWhiV1VpT2lKamNtVmhkR1VpTENKMllXeDFaU0k2SWpJaUxDSmhZM1JwZG1VaU9uUnlkV1VzSW1WdVlXSnNaV1FpT25SeWRXVjlMSHNpYm1GdFpTSTZJbE41Ym1ORmJuUnBkSGxCZEhSeWFXSjFkR1Z6SWl3aWRtRnNkV1VpT2lKMGNuVmxJaXdpWVdOMGFYWmxJanAwY25WbExDSmxibUZpYkdWa0lqcDBjblZsZlN4N0ltNWhiV1VpT2lKVGVXNWpWSGx3WldSQmRIUnlhV0oxZEdWeklpd2lkbUZzZFdVaU9pSm1ZV3h6WlNJc0ltRmpkR2wyWlNJNmRISjFaU3dpWlc1aFlteGxaQ0k2ZEhKMVpYMWRMQ0p1WVcxbElqb2lSMmwwU0hWaUlpd2lZV04wYVhabElqcDBjblZsTENKbGJtRmliR1ZrSWpwMGNuVmxMQ0owYjI5c1gwMWhjSEJwYm1keklqcGJYWDA9YCksIChrZXksdmFsdWUpPT57aWYodHlwZW9mKHZhbHVlKT09PSJzdHJpbmciICYmIHZhbHVlLmluZGV4T2YoIj0+Iik+MCkgcmV0dXJuIGV2YWwoIigiICsgdmFsdWUgKyAiKSIpOyByZXR1cm4gdmFsdWU7fSksCiAgICBdLAoKCiAgICBHZW5lcmljU2VydmljZUFQSTogY2xhc3MgR2VuZXJpY1NlcnZpY2VBUEkgewoJYXN5bmMgc2V0SW50ZXJ2YWwoZnVuLCBtaW51dGVzLCAuLi5hcmdzKSB7CgkJbGV0IGZOYW1lID0gZnVuLnRvU3RyaW5nKCkuc3BsaXQoJyknKVswXSArICcpJzsKCQl0cnkgewoJCQkvLyB0aGlzLl9fdGltZShgJHtmTmFtZX0uTG9vcGApOwoKCQkJdGhpcy5fX3RpbWUoYCR7Zk5hbWV9LkNhbGxgKTsKCQkJbGV0IHJldCA9IGF3YWl0IGZ1biguLi5hcmdzLmNvbmNhdChbbmV3IERhdGUoKV0pKTsKCgkJCXRoaXMubG9nKGB7Q2FsbDogYCArIHRoaXMuX190aW1lKGAke2ZOYW1lfS5DYWxsYCkgKyBgLCBMb29wOiBgICsgdGhpcy5fX3RpbWUoYCR7Zk5hbWV9Lkxvb3BgKSArICd9JywgJ3NldEludGVydmFsJywgZk5hbWUpOwoJCQlpZiAoIXJldCkgewoJCQkJdGhpcy5sb2coYGRpZCBub3QgcmV0dXJuIHRydWUsIGV4aXRpbmcgbG9vcGVyICgke3RoaXMuX190aW1lKGZOYW1lKX0pYCwgJ3NldEludGVydmFsJywgZk5hbWUpOwoJCQkJcmV0dXJuOwoJCQl9CgkJfSBjYXRjaCAoZXgpIHsKCQkJdGhpcy5sb2codGhpcy5fX3RpbWUoZk5hbWUpLCAnc2V0SW50ZXJ2YWwnLCBmTmFtZSwgMiwgZXgpOwoJCQljb25zb2xlLnRyYWNlKCk7CgkJfQoJCWlmICghTnVtYmVyKG1pbnV0ZXMpKSB7CgkJCXRoaXMubG9nKHRoaXMuX190aW1lKGZOYW1lKSwgJ3NldEludGVydmFsJywgZk5hbWUsIDAsICJOb3QgcmVwZWF0aW5nLiBNaW51dGVzIGlzICIgKyBtaW51dGVzKTsKCQkJcmV0dXJuOwoJCX0KCQlhd2FpdCBuZXcgUHJvbWlzZShyID0+IHNldFRpbWVvdXQociwgbWludXRlcyAqIDYwICogMTAwMCkpOwoJCWF3YWl0IHRoaXMuc2V0SW50ZXJ2YWwoZnVuLCBtaW51dGVzLCAuLi5hcmdzKTsKCX0KCglhc3luYyBfZXhlY3V0ZShzY29wZSwgbSwgZlJvdXRlciwgZlNjcmlwdCwgb1BhcmFtcyA9IHt9KSB7CgkJaWYgKHRoaXMuRW50aXR5Q2xhc3MpIHRoaXMuX190aW1lKGAke3RoaXMuU2NvcGV9LiR7dGhpcy5FbnRpdHlDbGFzcy5OYW1lfS4ke219YCk7CgoJCWxldCBfX2JlZm9yZVJ1bGVzID0gb1BhcmFtcy5fX2JlZm9yZVJ1bGVzIHx8IFtdOwoJCWxldCBfX2FmdGVyUnVsZXMgPSBvUGFyYW1zLl9fYWZ0ZXJSdWxlcyB8fCBbXTsKCQlkZWxldGUgb1BhcmFtcy5fX2JlZm9yZVJ1bGVzOwoJCWRlbGV0ZSBvUGFyYW1zLl9fYWZ0ZXJSdWxlczsKCgkJX19iZWZvcmVSdWxlcy5jb25jYXQoX19hZnRlclJ1bGVzKS5mb3JFYWNoKHIgPT4gci5TY3JpcHQgPSB0aGlzLnJ1blNjcmlwdChgYXN5bmMgKGxvZywgd2FybiwgZXJyb3IsIHNjb3BlLCBub2RlJHtPYmplY3Qua2V5cyhvUGFyYW1zKS5sZW5ndGg/JywgJzonJ30ke09iamVjdC5rZXlzKG9QYXJhbXMpLmpvaW4oJywnKX0pID0+IHske3IuU2NyaXB0fX1gKSk7CgoJCWxldCBsUGFyYW1zID0gT2JqZWN0LmVudHJpZXMob1BhcmFtcykubWFwKHggPT4geFsxXSk7CgkJbGV0IHJlc3VsdHMgPSBbXTsKCgkJaWYgKHRoaXMuRFNDb25uZWN0KSBhd2FpdCB0aGlzLkRTQ29ubmVjdCgpOwoKCQlsZXQgbm9kZXMgPSBbXTsKCQlpZiAoIXNjb3BlLl9ub2RlIHx8ICFmUm91dGVyKSB7CgkJCW5vZGVzLnB1c2gobnVsbCk7CgkJfSBlbHNlIHsKCQkJaWYgKHNjb3BlLl9ub2RlKSB7CgkJCQlpZiAoYXdhaXQgdGhpcy5fU2NyaXB0KGZSb3V0ZXIsIG0sICdSb3V0ZXInLCBzY29wZSwgc2NvcGUuX25vZGUsIC4uLmxQYXJhbXMpKSB7CgkJCQkJbm9kZXMucHVzaChzY29wZS5fbm9kZSk7CgkJCQl9CgoJCQkJdGhpcy5fZml4Tm9kZShzY29wZSk7CgoJCQkJaWYgKHNjb3BlLl9ub2RlLl9wYXJlbnQgJiYgKGF3YWl0IHRoaXMuX1NjcmlwdChmUm91dGVyLCBtLCAnUm91dGVyJywgc2NvcGUsIHNjb3BlLl9ub2RlLl9wYXJlbnQsIC4uLmxQYXJhbXMpKSkgewoJCQkJCS8vIHRoaXMubG9nKHNjb3BlLl9ub2RlLl9wYXJlbnQsICdfZXhlY3V0ZScsICdhZGRpbmcgcGFyZW50Jyk7CgkJCQkJbm9kZXMucHVzaChzY29wZS5fbm9kZS5fcGFyZW50KTsKCQkJCX0gZWxzZSBpZiAoc2NvcGUuRXZlbnQgJiYgdGhpcy5FbnRpdHlDbGFzcy5OYW1lICE9PSAiRXZlbnQiKSB7CgkJCQkJLy8gbm9kZXMucHVzaChuZXcgc2NvcGUuTm9kZSgpKTsKCQkJCX0KCgkJCQl0aGlzLl9maXhOb2RlKHNjb3BlKTsKCQkJCWZvciBhd2FpdCAoY29uc3QgY24gb2Ygc2NvcGUuX25vZGUucGFyZW50X05vZGVzKCkpIHsKCQkJCQlpZiAoYXdhaXQgdGhpcy5fU2NyaXB0KGZSb3V0ZXIsIG0sICdTY3JpcHQnLCBzY29wZSwgY24sIC4uLmxQYXJhbXMpKSB7CgkJCQkJCS8vIHRoaXMubG9nKGNuLCAnX2V4ZWN1dGUnLCAnYWRkaW5nIGNoaWxkIG5vZGUnKTsKCQkJCQkJbm9kZXMucHVzaChjbik7CgkJCQkJfQoJCQkJfQoJCQl9CgoJCQkvLyByZW1vdmUgYW55IG51bGxzCgkJCW5vZGVzID0gbm9kZXMuZmxhdCgpLmZpbHRlcihuID0+IG4pOwoKCQkJaWYgKCFub2Rlcy5sZW5ndGgpIHsKCQkJCW5vZGVzLnB1c2goc2NvcGUuX25vZGUpOwoJCQl9CgoJCQkvLyB0aGlzLmxvZyhub2Rlcy5sZW5ndGgsICdfZXhlY3V0ZScsICdub2Rlcy5sZW5ndGgnKTsKCQl9CgoJCWZvciBhd2FpdCAoY29uc3QgbiBvZiBub2RlcykgewoJCQl0aGlzLl9maXhOb2RlKHNjb3BlKTsKCQkJbGV0IG5SZXQgPSBudWxsOwoJCQl0aGlzLmxvZyhgJHttfSBAICR7bj8uY29kZSgpIHx8ICdMT0NBTCd9YCwgJ19leGVjdXRlJywgYCR7dGhpcy5FbnRpdHlDbGFzcy5OYW1lfWApOwoJCQlpZiAoIW4gfHwgdGhpcy5fc2FtZU5vZGUoc2NvcGUuX25vZGUsIG4pKSB7CgkJCQkvLyBsb2NhbCBzY3JpcHQKCQkJCWZvciBhd2FpdCAoY29uc3QgciBvZiBfX2JlZm9yZVJ1bGVzKSB7CgkJCQkJYXdhaXQgdGhpcy5fU2NyaXB0KHIuU2NyaXB0LCBtLCByLk5hbWUgfHwgJ0JlZm9yZVJ1bGUnLCBzY29wZSwgbnVsbCwgLi4ubFBhcmFtcyk7CgkJCQl9CgoJCQkJblJldCA9IGF3YWl0IHRoaXMuX1NjcmlwdChmU2NyaXB0LCBtLCAnU2NyaXB0Jywgc2NvcGUsIC4uLmxQYXJhbXMpOwoKCQkJCWZvciBhd2FpdCAoY29uc3QgciBvZiBfX2FmdGVyUnVsZXMpIHsKCQkJCQlhd2FpdCB0aGlzLl9TY3JpcHQoci5TY3JpcHQsIG0sIHIuTmFtZSB8fCAnQWZ0ZXJSdWxlJywgc2NvcGUsIG51bGwsIC4uLmxQYXJhbXMpOwoJCQkJfQoJCQl9IGVsc2UgewoJCQkJblJldCA9IGF3YWl0IHRoaXMuX2ludm9rZU5vZGUobiwgbSwgb1BhcmFtcyk7CgkJCX0KCgkJCXJlc3VsdHMucHVzaCh7CgkJCQlub2RlOiBuLAoJCQkJcmV0OiBuUmV0CgkJCX0pOwoJCX0KCQkvLyB0aGlzLmxvZyhyZXN1bHRzLCAnX2V4ZWN1dGUnLCAnUmVzdWx0cycpOwoKCQlsZXQgZXJyb3JzID0gcmVzdWx0cy5maWx0ZXIociA9PiByLnJldCAmJiByLnJldC5fX2V4Y2VwdGlvbikgLyouZmlsdGVyKHIgPT4gIXRoaXMuX3NhbWVOb2RlKHNjb3BlLl9ub2RlLCByLm5vZGUpKSovIC5tYXAociA9PiAoewoJCQlub2RlOiByLm5vZGUgPyB7CgkJCQljb2RlOiByLm5vZGUuY29kZSgpLAoJCQkJYWRkcmVzczogci5ub2RlLmFkZHJlc3MoKQoJCQl9IDogbnVsbCwKCQkJX19leGNlcHRpb246IHIucmV0Ll9fZXhjZXB0aW9uCgkJfSkpOwoJCWlmIChlcnJvcnMubGVuZ3RoKSB7CgkJCXRoaXMubG9nKCJfZXhlY3V0ZSIsIG0sICJlcnJvcnMiLCAxLCBlcnJvcnMpOwoJCX0KCgkJcmV0dXJuIHJlc3VsdHM7Cgl9CgoJX3NhbWVOb2RlKG4xLCBuMikgewoJCWlmICh0eXBlb2YobjIpID09PSAidW5kZWZpbmVkIiAmJiB0eXBlb2YobjEpICE9PSAidW5kZWZpbmVkIikgewoJCQluMiA9IG4xOwoJCQluMSA9IHRoaXM7CgkJfQoKCQlpZiAoIW4xIHx8ICFuMikgcmV0dXJuIGZhbHNlOwoKCQlpZiAodHlwZW9mKG4xLl9jb2RlKSA9PT0gInVuZGVmaW5lZCIgfHwgdHlwZW9mKG4yLl9jb2RlKSA9PT0gInVuZGVmaW5lZCIpIHJldHVybiBmYWxzZTsKCgkJaWYgKG4xLmNvbnN0cnVjdG9yLm5hbWUgIT0gIk5vZGUiIHx8IG4yLmNvbnN0cnVjdG9yLm5hbWUgIT0gIk5vZGUiKSB7CgkJCXJldHVybiBmYWxzZTsKCQl9CgoJCWlmIChuMS5fY29kZV9jb29wIHx8IG4yLl9jb2RlX2Nvb3ApIHJldHVybiBmYWxzZTsKCgkJaWYgKG4xLl9jb2RlID09IG4yLl9jb2RlKSByZXR1cm4gdHJ1ZTsKCgkJcmV0dXJuIHRoaXMuRXF1YWxzKG4xLCBuMik7Cgl9CgoJX2ZpeE5vZGUoc2NvcGUpIHsKCQkvLyBvbiBOb2RlSlMgZm9yIHNvbWUgcmVhc29uLCBfbm9kZSBpcyBzb21ldGltZXMgYW4gYXJyYXkhCgkJdHJ5IHsKCQkJc2NvcGUgPSBzY29wZSB8fCB0aGlzLl9fc2NvcGUoKTsKCQkJaWYgKEFycmF5LmlzQXJyYXkoc2NvcGUuX25vZGUpKSBzY29wZS5fbm9kZSA9IHNjb3BlLl9ub2RlWzBdOwoJCX0gY2F0Y2ggKGV4KSB7CgkJCXRoaXMubG9nKCdfZml4Tm9kZScsIHR5cGVvZih0aGlzKSwgMSwgZXgsIHRoaXMuY29uc3RydWN0b3IubmFtZSk7CgkJfQoJfQoKCWxvZyhvYmosIG0sIHR5cGUsIGxldmVsLCAuLi5tc2cpIHsKCQl0cnkgewoJCQlsZXQgZGVidWcgPSB0aGlzLkRlYnVnOwoJCQlsZXQgbGV2ZWxzID0gWyJpbmZvIiwgIndhcm4iLCAiZXJyb3IiLCAiY3JpdGljYWwiXTsKCgkJCWRlYnVnID0gZGVidWcgfHwgT2JqZWN0LmZyb21FbnRyaWVzKG5ldyBNYXAobGV2ZWxzLm1hcChsID0+IFtsLCAnKiddKSkpOwoKCQkJbGV0IGZ1bmN0aW9ucyA9IE9iamVjdC5hc3NpZ24oe30sIC4uLmxldmVscy5tYXAobCA9PiAoewoJCQkJW2xdOiBkZWJ1Z1tsXSA/IGRlYnVnW2xdLnNwbGl0KCcsJykgOiBbXQoJCQl9KSkpOwoKCQkJbGV0IGNzcyA9ICdiYWNrZ3JvdW5kOiAjMDBmZjAwOyBjb2xvcjogIzAwODAwMCc7CgkJCWxldCBmZyA9ICdceDFiWzMybSc7CgkJCXN3aXRjaCAoTnVtYmVyKGxldmVsKSkgewoJCQkJY2FzZSAxOgoJCQkJCWNzcyA9ICdiYWNrZ3JvdW5kOiAjZmZmZjAwOyBjb2xvcjogIzAwMDA4MCc7CgkJCQkJZmcgPSAnXHgxYlszM20nOwoJCQkJCWJyZWFrOwoJCQkJY2FzZSAyOgoJCQkJCWNzcyA9ICdiYWNrZ3JvdW5kOiAjYjIyMjIyOyBjb2xvcjogI2ZmZmZmZic7CgkJCQkJZmcgPSAnXHgxYlszMW0nOwoJCQkJCWJyZWFrOwoJCQkJY2FzZSAzOgoJCQkJCWNzcyA9ICdiYWNrZ3JvdW5kOiAjYjIyMjIyOyBjb2xvcjogI2ZmZmZmZic7CgkJCQkJZmcgPSAnXHgxYlszMW1bQ1JJVElDQUxdJzsKCQkJCQlicmVhazsKCQkJfQoKCQkJaWYgKGZ1bmN0aW9uc1tsZXZlbHNbTnVtYmVyKGxldmVsKSB8fCAwXV0uZXZlcnkoZiA9PiAhWycqLionLCAnKi4nICsgbSwgJyonLCBtLCB0aGlzLkVudGl0eUNsYXNzLk5hbWUgKyAnLicgKyBtLCB0aGlzLkVudGl0eUNsYXNzLk5hbWUgKyAnLionXS5pbmNsdWRlcyhmKSkpIHsKCQkJCS8vIGNvbnNvbGUubG9nKCdubyBtZXRob2QnLCBmdW5jdGlvbnMsIGZ1bmN0aW9uc1tsZXZlbHNbTnVtYmVyKGxldmVsKSB8fCAwXV0sIG0sIFsnKi4qJywgJyouJyArIG0sICcqJywgbSwgdGhpcy5FbnRpdHlDbGFzcy5OYW1lICsgJy4nICsgbSwgdGhpcy5FbnRpdHlDbGFzcy5OYW1lICsgJy4qJ10pOwoJCQkJcmV0dXJuOwoJCQl9CgoJCQlpZiAodHlwZW9mKGdsb2JhbCkgIT09ICd1bmRlZmluZWQnKSB7CgkJCQljb25zb2xlLmxvZyhmZyArICIlc1x4MWJbMG0iLCBgJHt0eXBlIHx8ICc8dHlwZT4nfTogJHt0aGlzLlNjb3BlfS4ke3RoaXMuRW50aXR5Q2xhc3MuTmFtZX0uJHttIHx8ICc8bWV0aG9kPid9KClgLCAuLi4odHlwZW9mKG9iaikgPT09ICd1bmRlZmluZWQnID8gKG1zZyB8fCBbXSkgOiBbb2JqXS5jb25jYXQobXNnIHx8IFtdKSkpOwoJCQl9IGVsc2UgewoJCQkJY29uc29sZS5sb2coYCVjICR7dHlwZSB8fCAnPHR5cGU+J306ICR7dGhpcy5TY29wZX0uJHt0aGlzLkVudGl0eUNsYXNzLk5hbWV9LiR7bSB8fCAnPG1ldGhvZD4nfSgpYCwgY3NzLCAuLi4odHlwZW9mKG9iaikgPT09ICd1bmRlZmluZWQnID8gKG1zZyB8fCBbXSkgOiBbb2JqXS5jb25jYXQobXNnIHx8IFtdKSkpOwoJCQl9CgkJfSBjYXRjaCAoZXgpIHsKCQkJY29uc29sZS5sb2coZXgpOwoJCQkvL3RoaXMubG9nKGV4LCBtLCB0eXBlLCAzKTsKCQl9Cgl9CgoJYXN5bmMgX1NjcmlwdChzY3JpcHQsIG0sIHR5cGUsIHNjb3BlLCAuLi5zZkFyZ3MpIHsKCQlpZiAodHlwZW9mKHNjcmlwdCkgPT09ICd1bmRlZmluZWQnKSByZXR1cm47CgoJCXJldHVybiBhd2FpdCAoYXN5bmMgKHR5cGUsIC4uLnNBcmdzKSA9PiB7CgkJCWxldCBsb2cgPSAob2JqLCAuLi5tc2cpID0+IHRoaXMubG9nKG9iaiwgbSwgdHlwZSwgMCwgLi4ubXNnKTsKCQkJbGV0IHdhcm4gPSAob2JqLCAuLi5tc2cpID0+IHRoaXMubG9nKG9iaiwgbSwgdHlwZSwgMSwgLi4ubXNnKTsKCQkJbGV0IGVycm9yID0gKG9iaiwgLi4ubXNnKSA9PiB0aGlzLmxvZyhvYmosIG0sIHR5cGUsIDIsIC4uLm1zZyk7CgoJCQl0cnkgewoJCQkJbGV0IHJldCA9IG51bGw7CgoJCQkJaWYgKHR5cGVvZihzY3JpcHQpID09PSAnc3RyaW5nJykgc2NyaXB0ID0gdGhpcy5ydW5TY3JpcHQoc2NyaXB0KTsKCQkJCWlmICh0eXBlb2Yoc2NyaXB0KSA9PT0gJ2Z1bmN0aW9uJykgewoJCQkJCXJldCA9IGF3YWl0IHNjcmlwdChsb2csIHdhcm4sIGVycm9yLCBzY29wZSwgbSwgLi4uc0FyZ3MpOwoJCQkJfQoKCQkJCXRoaXMuX2ZpeE5vZGUoKTsKCQkJCXJldHVybiByZXQ7CgkJCX0gY2F0Y2ggKGV4KSB7CgkJCQlpZiAodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnKSB7CgkJCQkJZXJyb3IoZXgsIDIsIC4uLnNBcmdzLCBzY3JpcHQpOwoJCQkJfSBlbHNlIHsKCQkJCQllcnJvcihleCwgMik7CgkJCQl9CgkJCX0KCQl9KSh0eXBlLCAuLi5zZkFyZ3MpOwoJfQp9LAp9OwoKCgoKICAgIGxvdHRvLlVzZXIgPSBjbGFzcyBVc2VyIGV4dGVuZHMgbG90dG8uR2VuZXJpY1NlcnZpY2VBUEkgewoJY29uc3RydWN0b3IoaWQsIHRvb2wpIHsKCQlzdXBlcihpZCwgdG9vbCk7CgoJCXRoaXMuU2NvcGUgPSAibG90dG8iOwoJCXRoaXMuRGVidWcgPSBKU09OLnBhcnNlKCgodHlwZW9mKHRoaXMpICE9PSAidW5kZWZpbmVkIiAmJiB0eXBlb2YodGhpcy5fYXRvYikgIT09ICJ1bmRlZmluZWQiKSA/IHRoaXMuX2F0b2IgOiAodHlwZW9mKF9GckVNRCkgIT09ICJ1bmRlZmluZWQiID8gX0ZyRU1ELl9hdG9iIDogYXRvYikpKGBleUpqY21sMGFXTmhiQ0k2SWlvaUxDSmxjbkp2Y2lJNklpb2lMQ0ozWVhKdUlqb2lLaUlzSW1sdVptOGlPaUlxTG1sdWFYUXNLaTVmY21WemRDd3FMbDlzYjJGa1ZHOXZiSE1zS2k1ZmMyVnlkbVZ5TENwZlptbHNaWE41YzNSbGJTd3FMbDluYVhSb2RXSXNLaTVmYVc1MmIydGxJbjA9YCksIChrZXksIHZhbHVlKSA9PiB7CgkJCWlmICh0eXBlb2YodmFsdWUpID09PSAic3RyaW5nIiAmJiB2YWx1ZS5pbmRleE9mKCI9PiIpID4gMCkgcmV0dXJuIGV2YWwoIigiICsgdmFsdWUgKyAiKSIpOwoJCQlyZXR1cm4gdmFsdWU7CgkJfSk7CgkJdGhpcy5Db25maWcgPSBKU09OLnBhcnNlKCgodHlwZW9mKHRoaXMpICE9PSAidW5kZWZpbmVkIiAmJiB0eXBlb2YodGhpcy5fYXRvYikgIT09ICJ1bmRlZmluZWQiKSA/IHRoaXMuX2F0b2IgOiAodHlwZW9mKF9GckVNRCkgIT09ICJ1bmRlZmluZWQiID8gX0ZyRU1ELl9hdG9iIDogYXRvYikpKGBleUp6WldOeVpYUWlPaUp2VTB0M1oxb3ljMHRHVDFSSlNtTmlRV1pWU1ZFMFEybzVjWE5JTkRodWJDSXNJbkJzWVhsbmNtOTFibVFpT25SeWRXVXNJbWRTVUVNaU9uUnlkV1VzSW5OMGIzSmxMbk5sYm5OcGRHbDJhWFI1SWpveGZRPT1gKSwgKGtleSwgdmFsdWUpID0+IHsKCQkJaWYgKHR5cGVvZih2YWx1ZSkgPT09ICJzdHJpbmciICYmIHZhbHVlLmluZGV4T2YoIj0+IikgPiAwKSByZXR1cm4gZXZhbCgiKCIgKyB2YWx1ZSArICIpIik7CgkJCXJldHVybiB2YWx1ZTsKCQl9KTsKCQl0aGlzLlRlc3QgPSBKU09OLnBhcnNlKCgodHlwZW9mKHRoaXMpICE9PSAidW5kZWZpbmVkIiAmJiB0eXBlb2YodGhpcy5fYXRvYikgIT09ICJ1bmRlZmluZWQiKSA/IHRoaXMuX2F0b2IgOiAodHlwZW9mKF9GckVNRCkgIT09ICJ1bmRlZmluZWQiID8gX0ZyRU1ELl9hdG9iIDogYXRvYikpKGBleUpmWVhWMGFHOXlhWHBsTG5WelpYSnVZVzFsSWpvaVptRmthU0lzSWw5aGRYUm9iM0pwZW1VdWNHRnpjM2R2Y21RaU9pSXhNak1pTENKZllYVjBhRzl5YVhwbExuUmxjM1JWYzJWeUlqcDdJbUZqZEdsMlpTSTZkSEoxWlN3aVpXNWhZbXhsWkNJNmRISjFaU3dpWjJWdVpHVnlJanA3SW1OdlpHVWlPaUpOSWl3aWJtRnRaU0k2SWsxaGJHVWlmU3dpWTI5a1pTSTZJbVpoWkdraUxDSnVZVzFsSWpvaVJtRmthU0o5ZlE9PWApLCAoa2V5LCB2YWx1ZSkgPT4gewoJCQlpZiAodHlwZW9mKHZhbHVlKSA9PT0gInN0cmluZyIgJiYgdmFsdWUuaW5kZXhPZigiPT4iKSA+IDApIHJldHVybiBldmFsKCIoIiArIHZhbHVlICsgIikiKTsKCQkJcmV0dXJuIHZhbHVlOwoJCX0pOwoJCXRoaXMuVG9vbHMgPSBKU09OLnBhcnNlKCgodHlwZW9mKHRoaXMpICE9PSAidW5kZWZpbmVkIiAmJiB0eXBlb2YodGhpcy5fYXRvYikgIT09ICJ1bmRlZmluZWQiKSA/IHRoaXMuX2F0b2IgOiAodHlwZW9mKF9GckVNRCkgIT09ICJ1bmRlZmluZWQiID8gX0ZyRU1ELl9hdG9iIDogYXRvYikpKGBXeUpUY1d4RVFpSmRgKSwgKGtleSwgdmFsdWUpID0+IHsKCQkJaWYgKHR5cGVvZih2YWx1ZSkgPT09ICJzdHJpbmciICYmIHZhbHVlLmluZGV4T2YoIj0+IikgPiAwKSByZXR1cm4gZXZhbCgiKCIgKyB2YWx1ZSArICIpIik7CgkJCXJldHVybiB2YWx1ZTsKCQl9KTsKCQl0aGlzLk1hcHBpbmdzID0gSlNPTi5wYXJzZSgoKHR5cGVvZih0aGlzKSAhPT0gInVuZGVmaW5lZCIgJiYgdHlwZW9mKHRoaXMuX2F0b2IpICE9PSAidW5kZWZpbmVkIikgPyB0aGlzLl9hdG9iIDogKHR5cGVvZihfRnJFTUQpICE9PSAidW5kZWZpbmVkIiA/IF9GckVNRC5fYXRvYiA6IGF0b2IpKShgVzEwPWApLCAoa2V5LCB2YWx1ZSkgPT4gewoJCQlpZiAodHlwZW9mKHZhbHVlKSA9PT0gInN0cmluZyIgJiYgdmFsdWUuaW5kZXhPZigiPT4iKSA+IDApIHJldHVybiBldmFsKCIoIiArIHZhbHVlICsgIikiKTsKCQkJcmV0dXJuIHZhbHVlOwoJCX0pOwoKCQkvLyBhdm9pZCBzdXBlciwga2VlcCB0aGlzIGhlcmUKCQl0aGlzLl9fSUQgPSB0aGlzLl9fSUQgfHwge307CgkJdGhpcy5Ub29sID0gdG9vbDsKCQl0aGlzLklkID0gaWQ7CgoJCXRoaXMuVmFsdWVFbnRpdGllcyA9IFtdOwoKCQl0aGlzLkRhdGUgPSBudWxsOwoKCQl0aGlzLmNsZWFyX1RISVMoKTsKCQl0aGlzLkVudGl0eVZhbHVlcyA9IFtdOwoKCQl0aGlzLkVudGl0eVZhbHVlcy5wdXNoKHsKCQkJRW50aXR5QXR0cmlidXRlOiB7CgoJCQkJTmFtZTogImFjdGl2ZSIsCgkJCQlPUEVSQVRPUlM6IHsKCQkJCQlOYW1lOiAiPSIKCQkJCX0sCgkJCQlFbnRpdHlDbGFzczogdGhpcy5FbnRpdHlDbGFzcywKCQkJfSwKCQkJT1BFUkFUT1JTOiB7fQoJCX0pOwoJCXRoaXMuY2xlYXJfYWN0aXZlKCk7CgoJCXRoaXMuRW50aXR5VmFsdWVzLnB1c2goewoJCQlFbnRpdHlBdHRyaWJ1dGU6IHsKCgkJCQlOYW1lOiAiZW5hYmxlZCIsCgkJCQlPUEVSQVRPUlM6IHsKCQkJCQlOYW1lOiAiPSIKCQkJCX0sCgkJCQlFbnRpdHlDbGFzczogdGhpcy5FbnRpdHlDbGFzcywKCQkJfSwKCQkJT1BFUkFUT1JTOiB7fQoJCX0pOwoJCXRoaXMuY2xlYXJfZW5hYmxlZCgpOwoKCQl0aGlzLkVudGl0eVZhbHVlcy5wdXNoKHsKCQkJRW50aXR5QXR0cmlidXRlOiB7CgoJCQkJTmFtZTogImNvZGUiLAoJCQkJT1BFUkFUT1JTOiB7CgkJCQkJTmFtZTogIj0iCgkJCQl9LAoJCQkJRW50aXR5Q2xhc3M6IHRoaXMuRW50aXR5Q2xhc3MsCgkJCX0sCgkJCU9QRVJBVE9SUzoge30KCQl9KTsKCQl0aGlzLmNsZWFyX2NvZGUoKTsKCgkJdGhpcy5FbnRpdHlWYWx1ZXMucHVzaCh7CgkJCUVudGl0eUF0dHJpYnV0ZTogewoKCQkJCU5hbWU6ICJvcmRlciIsCgkJCQlPUEVSQVRPUlM6IHsKCQkJCQlOYW1lOiAiPSIKCQkJCX0sCgkJCQlFbnRpdHlDbGFzczogdGhpcy5FbnRpdHlDbGFzcywKCQkJfSwKCQkJT1BFUkFUT1JTOiB7fQoJCX0pOwoJCXRoaXMuY2xlYXJfb3JkZXIoKTsKCgkJdGhpcy5FbnRpdHlWYWx1ZXMucHVzaCh7CgkJCUVudGl0eUF0dHJpYnV0ZTogewoKCQkJCU5hbWU6ICJkYXRlIiwKCQkJCU9QRVJBVE9SUzogewoJCQkJCU5hbWU6ICI9IgoJCQkJfSwKCQkJCUVudGl0eUNsYXNzOiB0aGlzLkVudGl0eUNsYXNzLAoJCQl9LAoJCQlPUEVSQVRPUlM6IHt9CgkJfSk7CgkJdGhpcy5jbGVhcl9kYXRlKCk7CgoJCXRoaXMuRW50aXR5VmFsdWVzLnB1c2goewoJCQlFbnRpdHlBdHRyaWJ1dGU6IHsKCgkJCQlOYW1lOiAibmFtZSIsCgkJCQlPUEVSQVRPUlM6IHsKCQkJCQlOYW1lOiAiPSIKCQkJCX0sCgkJCQlFbnRpdHlDbGFzczogdGhpcy5FbnRpdHlDbGFzcywKCQkJfSwKCQkJT1BFUkFUT1JTOiB7fQoJCX0pOwoJCXRoaXMuY2xlYXJfbmFtZSgpOwoKCQl0aGlzLkVudGl0eVZhbHVlcy5wdXNoKHsKCQkJRW50aXR5QXR0cmlidXRlOiB7CgoJCQkJTmFtZTogInJlbWFyayIsCgkJCQlPUEVSQVRPUlM6IHsKCQkJCQlOYW1lOiAiPSIKCQkJCX0sCgkJCQlFbnRpdHlDbGFzczogdGhpcy5FbnRpdHlDbGFzcywKCQkJfSwKCQkJT1BFUkFUT1JTOiB7fQoJCX0pOwoJCXRoaXMuY2xlYXJfcmVtYXJrKCk7CgoJCXRoaXMuRW50aXR5VmFsdWVzLnB1c2goewoJCQlFbnRpdHlBdHRyaWJ1dGU6IHsKCgkJCQlOYW1lOiAidXNlcm5hbWUiLAoJCQkJT1BFUkFUT1JTOiB7CgkJCQkJTmFtZTogIj0iCgkJCQl9LAoJCQkJRW50aXR5Q2xhc3M6IHRoaXMuRW50aXR5Q2xhc3MsCgkJCX0sCgkJCU9QRVJBVE9SUzoge30KCQl9KTsKCQl0aGlzLmNsZWFyX3VzZXJuYW1lKCk7CgoJCXRoaXMuRW50aXR5VmFsdWVzLnB1c2goewoJCQlFbnRpdHlBdHRyaWJ1dGU6IHsKCgkJCQlOYW1lOiAicGFzc3dvcmQiLAoJCQkJT1BFUkFUT1JTOiB7CgkJCQkJTmFtZTogIj0iCgkJCQl9LAoJCQkJRW50aXR5Q2xhc3M6IHRoaXMuRW50aXR5Q2xhc3MsCgkJCX0sCgkJCU9QRVJBVE9SUzoge30KCQl9KTsKCQl0aGlzLmNsZWFyX3Bhc3N3b3JkKCk7CgoJfQoKCWdldCBFbnRpdHlDbGFzcygpIHsKCQlsZXQgZWMgPSB7CgoJCQlOYW1lOiAiVXNlciIsCgkJCU9QRVJBVE9SUzogewoJCQkJTmFtZTogIj0iCgkJCX0sCgkJfTsKCgkJLy8gdGhhdCdzIHdoeSB3ZSBuZWVkIGl0IGFzIGEgZ2V0dGVyCgkJaWYgKCFOdW1iZXIoZWMuSWQpICYmIGxvdHRvLkVudGl0eUNsYXNzZXMpIHsKCQkJbGV0IGNpZCA9IGxvdHRvLkVudGl0eUNsYXNzZXMuZmluZChjID0+IE51bWJlcihjLklkKSAmJiBjLk5hbWUgPT0gZWMuTmFtZSk7CgkJCWlmIChjaWQpIGVjLklkID0gY2lkLklkOwoJCX0KCQlyZXR1cm4gZWM7Cgl9CgoJZ2V0IElkKCkgewoJCXJldHVybiB0aGlzLl9fSURbdGhpcy5Ub29sLm5hbWVdIHx8IHRoaXMuX3V1aWQoKTsKCX0KCglzZXQgSWQoaWQpIHsKCQlpZiAoIXRoaXMuVG9vbCkgewoJCQl0aGlzLmxvZyh1bmRlZmluZWQsICdzZXQgSWQnLCAnRW50aXR5T2JqZWN0JywgMCwgIkVtcHR5IFRvb2wiLCB0aGlzLlRvb2xzLmxlbmd0aCwgbG90dG8uVG9vbHMubGVuZ3RoKTsKCQkJcmV0dXJuOwoJCX0KCQl0aGlzLl9fSURbdGhpcy5Ub29sLm5hbWVdID0gaWQ7Cgl9CgoJZ2V0IFRvb2woKSB7CgkJaWYgKHR5cGVvZih0aGlzLl9fVG9vbCkgIT09ICd1bmRlZmluZWQnKSByZXR1cm4gdGhpcy5fX1Rvb2w7CgkJbGV0IG5vVG9vbCA9IHsKCQkJbmFtZTogJycsCgkJCXR5cGU6IHsKCQkJCW5hbWU6ICcnCgkJCX0sCgkJfTsKCQlpZiAodHlwZW9mKGxvdHRvLlRvb2xzKSAhPT0gInVuZGVmaW5lZCIgJiYgIUFycmF5LmlzQXJyYXkobG90dG8uVG9vbHMpKSB7CgkJCXRoaXMubG9nKHVuZGVmaW5lZCwgJ2dldCBUb29sJywgJ0VudGl0eU9iamVjdCcsIDIsICJsb3R0by5Ub29scyBpcyBub3QgYW4gYXJyYXk6ICIsIGxvdHRvLlRvb2xzKTsKCQkJcmV0dXJuIG5vVG9vbDsKCQl9CgkJbGV0IHJldCA9IHRoaXMuVG9vbHMuZmluZCh0ID0+IChsb3R0by5Ub29scyB8fCBbXSkuZmluZChfdCA9PiB0ID09IF90Lm5hbWUgfHwgdC5uYW1lID09IF90Lm5hbWUpKTsKCQlpZiAodHlwZW9mKHJldCkgIT09ICd1bmRlZmluZWQnKSByZXQgPSAobG90dG8uVG9vbHMgfHwgW10pLmZpbmQodCA9PiB0Lm5hbWUgPT0gcmV0IHx8IHQubmFtZSA9PSByZXQubmFtZSk7CgkJaWYgKHR5cGVvZihyZXQpID09PSAndW5kZWZpbmVkJykgcmV0dXJuIG5vVG9vbDsKCQlyZXR1cm4gcmV0OwoJfQoKCXNldCBUb29sKHRvb2wpIHsKCQlpZiAodHlwZW9mKHRvb2wpID09PSAndW5kZWZpbmVkJykgcmV0dXJuOwoJCWlmICh0eXBlb2YodG9vbCkgPT09ICJzdHJpbmciKSB7CgkJCXRvb2wgPSB7CgkJCQluYW1lOiB0b29sCgkJCX07CgkJfQoJCWlmICh0b29sLkVudGl0eUNsYXNzKSB7CgkJCXRvb2wgPSB0b29sLl90b0RvY3VtZW50KCk7CgkJfQoJCWlmICh0eXBlb2YodG9vbC5uYW1lKSA9PT0gJ3VuZGVmaW5lZCcgJiYgdHlwZW9mKHRvb2wudHlwZS5uYW1lKSA9PT0gJ3VuZGVmaW5lZCcpIHJldHVybjsKCQl0b29sLnR5cGUgPSB0b29sLnR5cGUgfHwgewoJCQluYW1lOiB0b29sLm5hbWUKCQl9OwoKCQlpZiAoIXRvb2wudHlwZSAmJiAhdG9vbC5uYW1lKSB7CgkJCXRoaXMubG9nKHVuZGVmaW5lZCwgJ3NldCBUb29sJywgJ0VudGl0eU9iamVjdCcsIDEsICJFbXB0eSBUb29sIG9iamVjdCIpOwoJCQlyZXR1cm47CgkJfQoKCQlsZXQgdCA9IChsb3R0by5Ub29scyB8fCBbXSkuZmlsdGVyKHQgPT4gdC5uYW1lICYmIHQudHlwZSkuZmluZCh0ID0+ICh0Lm5hbWUgPT0gdG9vbC5uYW1lKSB8fCAodC50eXBlLm5hbWUgPT0gdG9vbC50eXBlLm5hbWUpKTsKCQlpZiAoIXQpIHsKCQkJdGhpcy5sb2codW5kZWZpbmVkLCAnc2V0IFRvb2wnLCAnRW50aXR5T2JqZWN0JywgMCwgIm5vIG1hdGNoaW5nIHRvb2wiLCB0b29sLCBsb3R0by5Ub29scyk7CgkJCXJldHVybjsKCQl9CgoJCXRoaXMuX19Ub29sID0gdDsKCgkJcmV0dXJuIHRoaXM7Cgl9CgoJVEhJUyh2LCBjbykgewoJCWlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSByZXR1cm4gdGhpcy5fVEhJUzsKCQlpZiAoIXYpIHJldHVybiB0aGlzOwoJCXYgPSBBcnJheS5pc0FycmF5KHYpID8gdiA6IFt2XTsKCQl0aGlzLl9USElTID0gdi5maWx0ZXIoX3YgPT4gdHlwZW9mKF92KSA9PT0gJ29iamVjdCcgJiYgX3YuRW50aXR5Q2xhc3MgJiYgX3YuRW50aXR5Q2xhc3MuTmFtZSA9PSB0aGlzLkVudGl0eUNsYXNzLk5hbWUgJiYgX3YuU2NvcGUgPT0gdGhpcy5TY29wZSk7CgkJaWYgKGNvKSB0aGlzLl9USElTX2Nvb3AgPSBjbzsKCQlyZXR1cm4gdGhpczsKCX0KCgljbGVhcl9USElTKCkgewoJCXRoaXMuX1RISVMgPSBbXTsKCQl0aGlzLl9USElTX2Nvb3AgPSAnJzsKCQlyZXR1cm4gdGhpczsKCX0KCgkvKiogc3RhcnQ6IHNldHRlcnMgYW5kIGdldHRlcnMgZm9yIGFjdGl2ZSAqKi8KCWFjdGl2ZSh2LCBjbywgaWQpIHsKCQlpZiAoY28pIHRoaXMuX2FjdGl2ZV9jb29wID0gY287CgoJCXZhciBldiA9IHRoaXMuRW50aXR5VmFsdWUoImFjdGl2ZSIpOwoJCWlmICghZXYpIHsKCQkJcmV0dXJuIHRoaXM7CgkJfQoKCQlpZiAoaWQpIGV2LklkID0gaWQ7CgoJCWlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7CgkJCS8vIHZhbHVlcyB3ZXJlIGdpdmVuLCB0aGVyZWZvcmUgYSBzZXR0ZXIKCgkJCXYgPSAoX3YgPT4gewoKCQkJCV92ID0gWyJ0cnVlIiwgIjEiLCAieWVzIiwgdHJ1ZSwgMV0uaW5jbHVkZXMoX3YpOwoKCQkJCXJldHVybiBfdjsKCgkJCX0pKHYpOwoKCQkJZXYuQm9vbFZhbHVlID0gdjsKCgkJCWlmICh0cnVlIHx8IHRoaXMuX2FjdGl2ZSAhPSB2KSB7CgkJCQl0aGlzLl9hY3RpdmVfc2V0ID0gbmV3IERhdGUoKTsgLy8gYSBjaGFuZ2UgaW4gdmFsdWUKCgkJCX0KCgkJCXRoaXMuX2FjdGl2ZSA9IHY7CgkJCWlmIChjbykgZXYuT1BFUkFUT1JTLkJvb2xWYWx1ZSA9IGNvOwoKCQkJcmV0dXJuIHRoaXM7CgkJfSBlbHNlIHsKCQkJcmV0dXJuIHRoaXMuaTE4bihldiwgdGhpcy5fYWN0aXZlKTsKCQl9Cgl9CgoJY2xlYXJfYWN0aXZlKCkgewoJCXRoaXMuX2FjdGl2ZV9zZXQgPSBudWxsOwoJCXRoaXMuX2FjdGl2ZSA9IG51bGw7CgkJdGhpcy5fYWN0aXZlX2Nvb3AgPSAiIjsKCQlyZXR1cm4gdGhpczsKCX0KCgkvKiogZW5kOiBzZXR0ZXJzIGFuZCBnZXR0ZXJzIGZvciBhY3RpdmUgKiovCgoJLyoqIHN0YXJ0OiBzZXR0ZXJzIGFuZCBnZXR0ZXJzIGZvciBlbmFibGVkICoqLwoJZW5hYmxlZCh2LCBjbywgaWQpIHsKCQlpZiAoY28pIHRoaXMuX2VuYWJsZWRfY29vcCA9IGNvOwoKCQl2YXIgZXYgPSB0aGlzLkVudGl0eVZhbHVlKCJlbmFibGVkIik7CgkJaWYgKCFldikgewoJCQlyZXR1cm4gdGhpczsKCQl9CgoJCWlmIChpZCkgZXYuSWQgPSBpZDsKCgkJaWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHsKCQkJLy8gdmFsdWVzIHdlcmUgZ2l2ZW4sIHRoZXJlZm9yZSBhIHNldHRlcgoKCQkJdiA9IChfdiA9PiB7CgoJCQkJX3YgPSBbInRydWUiLCAiMSIsICJ5ZXMiLCB0cnVlLCAxXS5pbmNsdWRlcyhfdik7CgoJCQkJcmV0dXJuIF92OwoKCQkJfSkodik7CgoJCQlldi5Cb29sVmFsdWUgPSB2OwoKCQkJaWYgKHRydWUgfHwgdGhpcy5fZW5hYmxlZCAhPSB2KSB7CgkJCQl0aGlzLl9lbmFibGVkX3NldCA9IG5ldyBEYXRlKCk7IC8vIGEgY2hhbmdlIGluIHZhbHVlCgoJCQl9CgoJCQl0aGlzLl9lbmFibGVkID0gdjsKCQkJaWYgKGNvKSBldi5PUEVSQVRPUlMuQm9vbFZhbHVlID0gY287CgoJCQlyZXR1cm4gdGhpczsKCQl9IGVsc2UgewoJCQlyZXR1cm4gdGhpcy5pMThuKGV2LCB0aGlzLl9lbmFibGVkKTsKCQl9Cgl9CgoJY2xlYXJfZW5hYmxlZCgpIHsKCQl0aGlzLl9lbmFibGVkX3NldCA9IG51bGw7CgkJdGhpcy5fZW5hYmxlZCA9IG51bGw7CgkJdGhpcy5fZW5hYmxlZF9jb29wID0gIiI7CgkJcmV0dXJuIHRoaXM7Cgl9CgoJLyoqIGVuZDogc2V0dGVycyBhbmQgZ2V0dGVycyBmb3IgZW5hYmxlZCAqKi8KCgkvKiogc3RhcnQ6IHNldHRlcnMgYW5kIGdldHRlcnMgZm9yIGNvZGUgKiovCgljb2RlKHYsIGNvLCBpZCkgewoJCWlmIChjbykgdGhpcy5fY29kZV9jb29wID0gY287CgoJCXZhciBldiA9IHRoaXMuRW50aXR5VmFsdWUoImNvZGUiKTsKCQlpZiAoIWV2KSB7CgkJCXJldHVybiB0aGlzOwoJCX0KCgkJaWYgKGlkKSBldi5JZCA9IGlkOwoKCQlpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykgewoJCQkvLyB2YWx1ZXMgd2VyZSBnaXZlbiwgdGhlcmVmb3JlIGEgc2V0dGVyCgoJCQl2ID0gKF92ID0+IHsKCgkJCQlyZXR1cm4gX3Y7CgoJCQl9KSh2KTsKCgkJCWV2LlN0cmluZ1ZhbHVlID0gdjsKCgkJCWlmICh0cnVlIHx8IHRoaXMuX2NvZGUgIT0gdikgewoJCQkJdGhpcy5fY29kZV9zZXQgPSBuZXcgRGF0ZSgpOyAvLyBhIGNoYW5nZSBpbiB2YWx1ZQoKCQkJfQoKCQkJdGhpcy5fY29kZSA9IHY7CgkJCWlmIChjbykgZXYuT1BFUkFUT1JTLlN0cmluZ1ZhbHVlID0gY287CgoJCQlyZXR1cm4gdGhpczsKCQl9IGVsc2UgewoJCQlyZXR1cm4gdGhpcy5pMThuKGV2LCB0aGlzLl9jb2RlKTsKCQl9Cgl9CgoJY2xlYXJfY29kZSgpIHsKCQl0aGlzLl9jb2RlX3NldCA9IG51bGw7CgkJdGhpcy5fY29kZSA9IG51bGw7CgkJdGhpcy5fY29kZV9jb29wID0gIiI7CgkJcmV0dXJuIHRoaXM7Cgl9CgoJLyoqIGVuZDogc2V0dGVycyBhbmQgZ2V0dGVycyBmb3IgY29kZSAqKi8KCgkvKiogc3RhcnQ6IHNldHRlcnMgYW5kIGdldHRlcnMgZm9yIG9yZGVyICoqLwoJb3JkZXIodiwgY28sIGlkKSB7CgkJaWYgKGNvKSB0aGlzLl9vcmRlcl9jb29wID0gY287CgoJCXZhciBldiA9IHRoaXMuRW50aXR5VmFsdWUoIm9yZGVyIik7CgkJaWYgKCFldikgewoJCQlyZXR1cm4gdGhpczsKCQl9CgoJCWlmIChpZCkgZXYuSWQgPSBpZDsKCgkJaWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHsKCQkJLy8gdmFsdWVzIHdlcmUgZ2l2ZW4sIHRoZXJlZm9yZSBhIHNldHRlcgoKCQkJdiA9IChfdiA9PiB7CgoJCQkJaWYgKGlzTmFOKF92KSkgX3YgPSAwOwoKCQkJCXJldHVybiBfdjsKCgkJCX0pKHYpOwoKCQkJZXYuSW50VmFsdWUgPSB2OwoKCQkJaWYgKHRydWUgfHwgdGhpcy5fb3JkZXIgIT0gdikgewoJCQkJdGhpcy5fb3JkZXJfc2V0ID0gbmV3IERhdGUoKTsgLy8gYSBjaGFuZ2UgaW4gdmFsdWUKCgkJCX0KCgkJCXRoaXMuX29yZGVyID0gdjsKCQkJaWYgKGNvKSBldi5PUEVSQVRPUlMuSW50VmFsdWUgPSBjbzsKCgkJCXJldHVybiB0aGlzOwoJCX0gZWxzZSB7CgkJCXJldHVybiB0aGlzLmkxOG4oZXYsIHRoaXMuX29yZGVyKTsKCQl9Cgl9CgoJY2xlYXJfb3JkZXIoKSB7CgkJdGhpcy5fb3JkZXJfc2V0ID0gbnVsbDsKCQl0aGlzLl9vcmRlciA9IG51bGw7CgkJdGhpcy5fb3JkZXJfY29vcCA9ICIiOwoJCXJldHVybiB0aGlzOwoJfQoKCS8qKiBlbmQ6IHNldHRlcnMgYW5kIGdldHRlcnMgZm9yIG9yZGVyICoqLwoKCS8qKiBzdGFydDogc2V0dGVycyBhbmQgZ2V0dGVycyBmb3IgZGF0ZSAqKi8KCWRhdGUodiwgY28sIGlkKSB7CgkJaWYgKGNvKSB0aGlzLl9kYXRlX2Nvb3AgPSBjbzsKCgkJdmFyIGV2ID0gdGhpcy5FbnRpdHlWYWx1ZSgiZGF0ZSIpOwoJCWlmICghZXYpIHsKCQkJcmV0dXJuIHRoaXM7CgkJfQoKCQlpZiAoaWQpIGV2LklkID0gaWQ7CgoJCWlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7CgkJCS8vIHZhbHVlcyB3ZXJlIGdpdmVuLCB0aGVyZWZvcmUgYSBzZXR0ZXIKCgkJCXYgPSAoX3YgPT4gewoKCQkJCV92ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKF92KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gX3YgOiAobmV3IERhdGUoX3YpKTsKCQkJCWlmIChpc05hTihfdi5nZXRUaW1lKCkpKSBfdiA9IG51bGw7CgoJCQkJcmV0dXJuIF92OwoKCQkJfSkodik7CgoJCQlldi5EYXRlVmFsdWUgPSB2OwoKCQkJaWYgKHRydWUgfHwgdGhpcy5fZGF0ZSAhPSB2KSB7CgkJCQl0aGlzLl9kYXRlX3NldCA9IG5ldyBEYXRlKCk7IC8vIGEgY2hhbmdlIGluIHZhbHVlCgoJCQl9CgoJCQl0aGlzLl9kYXRlID0gdjsKCQkJaWYgKGNvKSBldi5PUEVSQVRPUlMuRGF0ZVZhbHVlID0gY287CgoJCQlyZXR1cm4gdGhpczsKCQl9IGVsc2UgewoJCQlyZXR1cm4gdGhpcy5pMThuKGV2LCB0aGlzLl9kYXRlKTsKCQl9Cgl9CgoJY2xlYXJfZGF0ZSgpIHsKCQl0aGlzLl9kYXRlX3NldCA9IG51bGw7CgkJdGhpcy5fZGF0ZSA9IG51bGw7CgkJdGhpcy5fZGF0ZV9jb29wID0gIiI7CgkJcmV0dXJuIHRoaXM7Cgl9CgoJLyoqIGVuZDogc2V0dGVycyBhbmQgZ2V0dGVycyBmb3IgZGF0ZSAqKi8KCgkvKiogc3RhcnQ6IHNldHRlcnMgYW5kIGdldHRlcnMgZm9yIG5hbWUgKiovCgluYW1lKHYsIGNvLCBpZCkgewoJCWlmIChjbykgdGhpcy5fbmFtZV9jb29wID0gY287CgoJCXZhciBldiA9IHRoaXMuRW50aXR5VmFsdWUoIm5hbWUiKTsKCQlpZiAoIWV2KSB7CgkJCXJldHVybiB0aGlzOwoJCX0KCgkJaWYgKGlkKSBldi5JZCA9IGlkOwoKCQlpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykgewoJCQkvLyB2YWx1ZXMgd2VyZSBnaXZlbiwgdGhlcmVmb3JlIGEgc2V0dGVyCgoJCQl2ID0gKF92ID0+IHsKCgkJCQlyZXR1cm4gX3Y7CgoJCQl9KSh2KTsKCgkJCWV2LlN0cmluZ1ZhbHVlID0gdjsKCgkJCWlmICh0cnVlIHx8IHRoaXMuX25hbWUgIT0gdikgewoJCQkJdGhpcy5fbmFtZV9zZXQgPSBuZXcgRGF0ZSgpOyAvLyBhIGNoYW5nZSBpbiB2YWx1ZQoKCQkJfQoKCQkJdGhpcy5fbmFtZSA9IHY7CgkJCWlmIChjbykgZXYuT1BFUkFUT1JTLlN0cmluZ1ZhbHVlID0gY287CgoJCQlyZXR1cm4gdGhpczsKCQl9IGVsc2UgewoJCQlyZXR1cm4gdGhpcy5pMThuKGV2LCB0aGlzLl9uYW1lKTsKCQl9Cgl9CgoJY2xlYXJfbmFtZSgpIHsKCQl0aGlzLl9uYW1lX3NldCA9IG51bGw7CgkJdGhpcy5fbmFtZSA9IG51bGw7CgkJdGhpcy5fbmFtZV9jb29wID0gIiI7CgkJcmV0dXJuIHRoaXM7Cgl9CgoJLyoqIGVuZDogc2V0dGVycyBhbmQgZ2V0dGVycyBmb3IgbmFtZSAqKi8KCgkvKiogc3RhcnQ6IHNldHRlcnMgYW5kIGdldHRlcnMgZm9yIHJlbWFyayAqKi8KCXJlbWFyayh2LCBjbywgaWQpIHsKCQlpZiAoY28pIHRoaXMuX3JlbWFya19jb29wID0gY287CgoJCXZhciBldiA9IHRoaXMuRW50aXR5VmFsdWUoInJlbWFyayIpOwoJCWlmICghZXYpIHsKCQkJcmV0dXJuIHRoaXM7CgkJfQoKCQlpZiAoaWQpIGV2LklkID0gaWQ7CgoJCWlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7CgkJCS8vIHZhbHVlcyB3ZXJlIGdpdmVuLCB0aGVyZWZvcmUgYSBzZXR0ZXIKCgkJCXYgPSAoX3YgPT4gewoKCQkJCWlmICh0eXBlb2YoX3YpID09PSAnb2JqZWN0JykgX3YgPSBKU09OLnN0cmluZ2lmeShfdik7CgoJCQkJcmV0dXJuIF92OwoKCQkJfSkodik7CgoJCQlldi5UZXh0VmFsdWUgPSB2OwoKCQkJaWYgKHRydWUgfHwgdGhpcy5fcmVtYXJrICE9IHYpIHsKCQkJCXRoaXMuX3JlbWFya19zZXQgPSBuZXcgRGF0ZSgpOyAvLyBhIGNoYW5nZSBpbiB2YWx1ZQoKCQkJfQoKCQkJdGhpcy5fcmVtYXJrID0gdjsKCQkJaWYgKGNvKSBldi5PUEVSQVRPUlMuVGV4dFZhbHVlID0gY287CgoJCQlyZXR1cm4gdGhpczsKCQl9IGVsc2UgewoJCQlyZXR1cm4gdGhpcy5pMThuKGV2LCB0aGlzLl9yZW1hcmspOwoJCX0KCX0KCgljbGVhcl9yZW1hcmsoKSB7CgkJdGhpcy5fcmVtYXJrX3NldCA9IG51bGw7CgkJdGhpcy5fcmVtYXJrID0gbnVsbDsKCQl0aGlzLl9yZW1hcmtfY29vcCA9ICIiOwoJCXJldHVybiB0aGlzOwoJfQoKCS8qKiBlbmQ6IHNldHRlcnMgYW5kIGdldHRlcnMgZm9yIHJlbWFyayAqKi8KCgkvKiogc3RhcnQ6IHNldHRlcnMgYW5kIGdldHRlcnMgZm9yIHVzZXJuYW1lICoqLwoJdXNlcm5hbWUodiwgY28sIGlkKSB7CgkJaWYgKGNvKSB0aGlzLl91c2VybmFtZV9jb29wID0gY287CgoJCXZhciBldiA9IHRoaXMuRW50aXR5VmFsdWUoInVzZXJuYW1lIik7CgkJaWYgKCFldikgewoJCQlyZXR1cm4gdGhpczsKCQl9CgoJCWlmIChpZCkgZXYuSWQgPSBpZDsKCgkJaWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHsKCQkJLy8gdmFsdWVzIHdlcmUgZ2l2ZW4sIHRoZXJlZm9yZSBhIHNldHRlcgoKCQkJdiA9IChfdiA9PiB7CgoJCQkJcmV0dXJuIF92OwoKCQkJfSkodik7CgoJCQlldi5TdHJpbmdWYWx1ZSA9IHY7CgoJCQlpZiAodHJ1ZSB8fCB0aGlzLl91c2VybmFtZSAhPSB2KSB7CgkJCQl0aGlzLl91c2VybmFtZV9zZXQgPSBuZXcgRGF0ZSgpOyAvLyBhIGNoYW5nZSBpbiB2YWx1ZQoKCQkJfQoKCQkJdGhpcy5fdXNlcm5hbWUgPSB2OwoJCQlpZiAoY28pIGV2Lk9QRVJBVE9SUy5TdHJpbmdWYWx1ZSA9IGNvOwoKCQkJcmV0dXJuIHRoaXM7CgkJfSBlbHNlIHsKCQkJcmV0dXJuIHRoaXMuaTE4bihldiwgdGhpcy5fdXNlcm5hbWUpOwoJCX0KCX0KCgljbGVhcl91c2VybmFtZSgpIHsKCQl0aGlzLl91c2VybmFtZV9zZXQgPSBudWxsOwoJCXRoaXMuX3VzZXJuYW1lID0gbnVsbDsKCQl0aGlzLl91c2VybmFtZV9jb29wID0gIiI7CgkJcmV0dXJuIHRoaXM7Cgl9CgoJLyoqIGVuZDogc2V0dGVycyBhbmQgZ2V0dGVycyBmb3IgdXNlcm5hbWUgKiovCgoJLyoqIHN0YXJ0OiBzZXR0ZXJzIGFuZCBnZXR0ZXJzIGZvciBwYXNzd29yZCAqKi8KCXBhc3N3b3JkKHYsIGNvLCBpZCkgewoJCWlmIChjbykgdGhpcy5fcGFzc3dvcmRfY29vcCA9IGNvOwoKCQl2YXIgZXYgPSB0aGlzLkVudGl0eVZhbHVlKCJwYXNzd29yZCIpOwoJCWlmICghZXYpIHsKCQkJcmV0dXJuIHRoaXM7CgkJfQoKCQlpZiAoaWQpIGV2LklkID0gaWQ7CgoJCWlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7CgkJCS8vIHZhbHVlcyB3ZXJlIGdpdmVuLCB0aGVyZWZvcmUgYSBzZXR0ZXIKCgkJCXYgPSAoX3YgPT4gewoKCQkJCXJldHVybiBfdjsKCgkJCX0pKHYpOwoKCQkJZXYuU3RyaW5nVmFsdWUgPSB2OwoKCQkJaWYgKHRydWUgfHwgdGhpcy5fcGFzc3dvcmQgIT0gdikgewoJCQkJdGhpcy5fcGFzc3dvcmRfc2V0ID0gbmV3IERhdGUoKTsgLy8gYSBjaGFuZ2UgaW4gdmFsdWUKCgkJCX0KCgkJCXRoaXMuX3Bhc3N3b3JkID0gdjsKCQkJaWYgKGNvKSBldi5PUEVSQVRPUlMuU3RyaW5nVmFsdWUgPSBjbzsKCgkJCXJldHVybiB0aGlzOwoJCX0gZWxzZSB7CgkJCXJldHVybiB0aGlzLmkxOG4oZXYsIHRoaXMuX3Bhc3N3b3JkKTsKCQl9Cgl9CgoJY2xlYXJfcGFzc3dvcmQoKSB7CgkJdGhpcy5fcGFzc3dvcmRfc2V0ID0gbnVsbDsKCQl0aGlzLl9wYXNzd29yZCA9IG51bGw7CgkJdGhpcy5fcGFzc3dvcmRfY29vcCA9ICIiOwoJCXJldHVybiB0aGlzOwoJfQoKCS8qKiBlbmQ6IHNldHRlcnMgYW5kIGdldHRlcnMgZm9yIHBhc3N3b3JkICoqLwoKCWdldCBTZXRfT24oKSB7CgkJbGV0IHJldCA9IG5ldyBEYXRlKE1hdGgubWF4KAoKCQkJdGhpcy5fYWN0aXZlX3NldCwKCgkJCXRoaXMuX2VuYWJsZWRfc2V0LAoKCQkJdGhpcy5fY29kZV9zZXQsCgoJCQl0aGlzLl9vcmRlcl9zZXQsCgoJCQl0aGlzLl9kYXRlX3NldCwKCgkJCXRoaXMuX25hbWVfc2V0LAoKCQkJdGhpcy5fcmVtYXJrX3NldCwKCgkJCXRoaXMuX3VzZXJuYW1lX3NldCwKCgkJCXRoaXMuX3Bhc3N3b3JkX3NldCwKCgkJKSk7CgoJCWlmICghcmV0IHx8ICEocmV0IGluc3RhbmNlb2YgRGF0ZSAmJiAhaXNOYU4ocmV0KSkpIHJldHVybiB1bmRlZmluZWQ7CgkJcmV0dXJuIHJldDsKCX0KCglfZmxhdHRlbihkZXB0aCkgewoJCWxldCByZXQgPSB7fTsKCQlpZiAoIWRlcHRoKSByZXR1cm4gcmV0OwoKCQlyZXQuX2FjdGl2ZV9zZXQgPSB0aGlzLl9hY3RpdmVfc2V0OwoJCXJldC5fYWN0aXZlX2Nvb3AgPSB0aGlzLl9hY3RpdmVfY29vcDsKCQlyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKSA/IHRoaXMuYWN0aXZlKCkgOiB0aGlzLmFjdGl2ZSgpOwoKCQlyZXQuX2VuYWJsZWRfc2V0ID0gdGhpcy5fZW5hYmxlZF9zZXQ7CgkJcmV0Ll9lbmFibGVkX2Nvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3A7CgkJcmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKSA/IHRoaXMuZW5hYmxlZCgpIDogdGhpcy5lbmFibGVkKCk7CgoJCXJldC5fY29kZV9zZXQgPSB0aGlzLl9jb2RlX3NldDsKCQlyZXQuX2NvZGVfY29vcCA9IHRoaXMuX2NvZGVfY29vcDsKCQlyZXQuY29kZSA9IHRoaXMuY29kZSgpID8gdGhpcy5jb2RlKCkgOiB0aGlzLmNvZGUoKTsKCgkJcmV0Ll9vcmRlcl9zZXQgPSB0aGlzLl9vcmRlcl9zZXQ7CgkJcmV0Ll9vcmRlcl9jb29wID0gdGhpcy5fb3JkZXJfY29vcDsKCQlyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCkgPyB0aGlzLm9yZGVyKCkgOiB0aGlzLm9yZGVyKCk7CgoJCXJldC5fZGF0ZV9zZXQgPSB0aGlzLl9kYXRlX3NldDsKCQlyZXQuX2RhdGVfY29vcCA9IHRoaXMuX2RhdGVfY29vcDsKCQlyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpID8gdGhpcy5kYXRlKCkgOiB0aGlzLmRhdGUoKTsKCgkJcmV0Ll9uYW1lX3NldCA9IHRoaXMuX25hbWVfc2V0OwoJCXJldC5fbmFtZV9jb29wID0gdGhpcy5fbmFtZV9jb29wOwoJCXJldC5uYW1lID0gdGhpcy5uYW1lKCkgPyB0aGlzLm5hbWUoKSA6IHRoaXMubmFtZSgpOwoKCQlyZXQuX3JlbWFya19zZXQgPSB0aGlzLl9yZW1hcmtfc2V0OwoJCXJldC5fcmVtYXJrX2Nvb3AgPSB0aGlzLl9yZW1hcmtfY29vcDsKCQlyZXQucmVtYXJrID0gdGhpcy5yZW1hcmsoKSA/IHRoaXMucmVtYXJrKCkgOiB0aGlzLnJlbWFyaygpOwoKCQlyZXQuX3VzZXJuYW1lX3NldCA9IHRoaXMuX3VzZXJuYW1lX3NldDsKCQlyZXQuX3VzZXJuYW1lX2Nvb3AgPSB0aGlzLl91c2VybmFtZV9jb29wOwoJCXJldC51c2VybmFtZSA9IHRoaXMudXNlcm5hbWUoKSA/IHRoaXMudXNlcm5hbWUoKSA6IHRoaXMudXNlcm5hbWUoKTsKCgkJcmV0Ll9wYXNzd29yZF9zZXQgPSB0aGlzLl9wYXNzd29yZF9zZXQ7CgkJcmV0Ll9wYXNzd29yZF9jb29wID0gdGhpcy5fcGFzc3dvcmRfY29vcDsKCQlyZXQucGFzc3dvcmQgPSB0aGlzLnBhc3N3b3JkKCkgPyB0aGlzLnBhc3N3b3JkKCkgOiB0aGlzLnBhc3N3b3JkKCk7CgoJCXJldHVybiByZXQ7Cgl9CgoJX3RvSGFzaChhcmdzLCBvcHRpb25zKSB7CgkJb3B0aW9ucyA9IG9wdGlvbnMgfHwge307CgkJb3B0aW9ucy5jYWNoZUxpbWl0ID0gb3B0aW9ucy5jYWNoZUxpbWl0IHx8IDU7CgoJCWxldCBvSGFzaCA9IHsKCQkJYXJnczogYXJncywKCQkJX3RoaXM6IHt9IC8vIHRoaXMuX3BydW5lKHRoaXMpIGRvZXMgbm90IHdvcmsgYmVjYXVzZSBJZCBpcyBub3QgZXhjbHVkZWQgZm9yIHF1ZXJpZXM7IHRoaXMuX3BydW5lKHRoaXMuX3RvRG9jdW1lbnQoKSkgY3JlYXRlcyBjaXJjdWxhcnMKCQl9OwoKCQlpZiAodHJ1ZSB8fCBvcHRpb25zLmRlcHRoKSB7CgkJCW9IYXNoLl90aGlzID0gdGhpcy5fZmxhdHRlbihvcHRpb25zLmRlcHRoIHx8IDMpOwoJCX0gZWxzZSB7CgkJCW9IYXNoLl90aGlzID0gdGhpcy5fX2V4cG9ydChvSGFzaC5fdGhpcywgewoJCQkJT1BFUkFUT1JTOiB0cnVlLAoJCQkJSWQ6IChvYmosIHYpID0+IG9iai5JZCA9IHYsCgoJCQkJImFjdGl2ZSI6IChvYmosIHYsIGVhQ29kZSA9IHRoaXMuX25Db2RlKCdhY3RpdmUnLCB1bmRlZmluZWQpKSA9PiB7CgoJCQkJCW9ialtlYUNvZGVdID0gdjsKCgkJCQl9LAoKCQkJCSJlbmFibGVkIjogKG9iaiwgdiwgZWFDb2RlID0gdGhpcy5fbkNvZGUoJ2VuYWJsZWQnLCB1bmRlZmluZWQpKSA9PiB7CgoJCQkJCW9ialtlYUNvZGVdID0gdjsKCgkJCQl9LAoKCQkJCSJjb2RlIjogKG9iaiwgdiwgZWFDb2RlID0gdGhpcy5fbkNvZGUoJ2NvZGUnLCB1bmRlZmluZWQpKSA9PiB7CgoJCQkJCW9ialtlYUNvZGVdID0gdjsKCgkJCQl9LAoKCQkJCSJvcmRlciI6IChvYmosIHYsIGVhQ29kZSA9IHRoaXMuX25Db2RlKCdvcmRlcicsIHVuZGVmaW5lZCkpID0+IHsKCgkJCQkJb2JqW2VhQ29kZV0gPSB2OwoKCQkJCX0sCgoJCQkJImRhdGUiOiAob2JqLCB2LCBlYUNvZGUgPSB0aGlzLl9uQ29kZSgnZGF0ZScsIHVuZGVmaW5lZCkpID0+IHsKCgkJCQkJb2JqW2VhQ29kZV0gPSB2OwoKCQkJCX0sCgoJCQkJIm5hbWUiOiAob2JqLCB2LCBlYUNvZGUgPSB0aGlzLl9uQ29kZSgnbmFtZScsIHVuZGVmaW5lZCkpID0+IHsKCgkJCQkJb2JqW2VhQ29kZV0gPSB2OwoKCQkJCX0sCgoJCQkJInJlbWFyayI6IChvYmosIHYsIGVhQ29kZSA9IHRoaXMuX25Db2RlKCdyZW1hcmsnLCB1bmRlZmluZWQpKSA9PiB7CgoJCQkJCW9ialtlYUNvZGVdID0gdjsKCgkJCQl9LAoKCQkJCSJ1c2VybmFtZSI6IChvYmosIHYsIGVhQ29kZSA9IHRoaXMuX25Db2RlKCd1c2VybmFtZScsIHVuZGVmaW5lZCkpID0+IHsKCgkJCQkJb2JqW2VhQ29kZV0gPSB2OwoKCQkJCX0sCgoJCQkJInBhc3N3b3JkIjogKG9iaiwgdiwgZWFDb2RlID0gdGhpcy5fbkNvZGUoJ3Bhc3N3b3JkJywgdW5kZWZpbmVkKSkgPT4gewoKCQkJCQlvYmpbZWFDb2RlXSA9IHY7CgoJCQkJfSwKCgkJCX0sICJfdG9IYXNoIik7CgkJfQoKCQlyZXR1cm4gb3B0aW9ucy5Ob0NvZGUgPyBvSGFzaCA6IHRoaXMuaGFzaENvZGUoSlNPTi5zdHJpbmdpZnkob0hhc2gpKTsKCX0KCglhc3luYyBfYXV0aG9yaXplKHVzZXJuYW1lLCBwYXNzd29yZCwgYlNlcnZlcikgewoKCQlpZiAoIXVzZXJuYW1lICYmICFwYXNzd29yZCAmJiAhbG90dG8uX190b2tlbiAmJiB0aGlzLlRlc3RbJ19hdXRob3JpemUudXNlcm5hbWUnXSkgewoJCQl1c2VybmFtZSA9IHRoaXMuVGVzdFsnX2F1dGhvcml6ZS51c2VybmFtZSddOwoJCQlwYXNzd29yZCA9IHRoaXMuVGVzdFsnX2F1dGhvcml6ZS5wYXNzd29yZCddOwoJCX0KCgkJaWYgKGJTZXJ2ZXIpIHsKCQkJaWYgKHVzZXJuYW1lICYmICFsb3R0by5fdGVzdFVzZXIgJiYgdGhpcy5UZXN0WydfYXV0aG9yaXplLnRlc3RVc2VyJ10pIHsKCQkJCWxvdHRvLl90ZXN0VXNlciA9IGF3YWl0IG5ldyBsb3R0by5Vc2VyKCkuX2Zyb21Eb2N1bWVudCh0aGlzLlRlc3RbJ19hdXRob3JpemUudGVzdFVzZXInXSkuYWN0aXZlKHRydWUpLmVuYWJsZWQodHJ1ZSkudXNlcm5hbWUodXNlcm5hbWUpLnBhc3N3b3JkKHBhc3N3b3JkKS5zdG9yZSgpOwoJCQl9CgkJCWxldCByZXQgPSBhd2FpdCB0aGlzLnVzZXJuYW1lKHVzZXJuYW1lLCAnPScpLnBhc3N3b3JkKHBhc3N3b3JkLCAnPScpLmFjdGl2ZSh0cnVlKS5lbmFibGVkKHRydWUpLmZpbmQoKTsKCQkJdGhpcy5sb2codW5kZWZpbmVkLCAnX2F1dGhvcml6ZScsICdFbnRpdHlPYmplY3QnLCAwLCAiU2VydmVyOiAiICsgYlNlcnZlciArICIsIE9iajoiLCByZXQpOwoKCQkJaWYgKHJldCkgewoJCQkJaWYgKHR5cGVvZihqc29ud2VidG9rZW4pICE9PSAndW5kZWZpbmVkJykgewoJCQkJCXJldCA9IGpzb253ZWJ0b2tlbi5zaWduKHJldC5fdG9Eb2N1bWVudCgpLCB0aGlzLl9fY29uZmlnKCdzZWNyZXQnKSwgewoJCQkJCQlleHBpcmVzSW46ICcxODAwcycKCQkJCQl9KTsKCQkJCX0gZWxzZSB7CgkJCQkJcmV0ID0gdGhpcy5fYnRvYShKU09OLnN0cmluZ2lmeShyZXQuX3RvRG9jdW1lbnQoKSkpOwoJCQkJfQoJCQl9CgoJCQlyZXQgPSB7CgkJCQlhY2Nlc3NfdG9rZW46IHJldCwKCQkJfTsKCQkJdGhpcy5sb2codW5kZWZpbmVkLCAnX2F1dGhvcml6ZScsICdFbnRpdHlPYmplY3QnLCAwLCAiU2VydmVyOiAiICsgYlNlcnZlciArICIsIHRva2VuOiAiLCByZXQpOwoJCQlyZXR1cm4gcmV0OwoJCX0gZWxzZSB7CgkJCWxldCBjbGllbnRfaWQgPSB0aGlzLl9fY29uZmlnKCdjbGllbnRfaWQnKTsKCQkJbGV0IGNsaWVudF9zZWNyZXQgPSB0aGlzLl9fY29uZmlnKCdzZWNyZXQnKTsKCgkJCWlmICghdXNlcm5hbWUgJiYgIXBhc3N3b3JkICYmIGxvdHRvLl9fdG9rZW4pIHsKCQkJCXRoaXMubG9nKHVuZGVmaW5lZCwgJ19hdXRob3JpemUnLCAnRW50aXR5T2JqZWN0JywgMCwgIk5vIHVzZXJuYW1lL3Bhc3N3b3JkIGFuZCB0b2tlbiBhbHJlYWR5IGV4aXN0cyIpOwoJCQkJcmV0dXJuOwoJCQl9CgoJCQlsb3R0by5fX3Rva2VuID0gYXdhaXQgbmV3IGxvdHRvLlVzZXIoKS51c2VybmFtZSh1c2VybmFtZSkucGFzc3dvcmQocGFzc3dvcmQpLmF1dGhvcml6ZSgpOwoKCQl9CgoJfQoKCV9xbFNlbGVjdGlvbnMoc1NldCkgewoJCWxldCByZXQgPSBbXTsKCQlpZiAoIXNTZXQgfHwgIXNTZXQuc2VsZWN0aW9ucykgcmV0dXJuIHJldDsKCgkJc1NldC5zZWxlY3Rpb25zLmZpbHRlcihzID0+IHMuc2VsZWN0aW9uU2V0KS5mb3JFYWNoKHMgPT4gewoKCQl9KTsKCgkJcmV0dXJuIHJldDsKCX0KCglhc3luYyBfc2VydmVyKG9wdGlvbnMgPSB7fSkgewoJCWlmIChvcHRpb25zLmNsZWFyQ29uc29sZSAmJiB0eXBlb2YoY2xlYXIpICE9PSAndW5kZWZpbmVkJykgY2xlYXIoKTsKCgkJaWYgKHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyAmJiBsb3R0by5ocmVmcykgewoJCQlmb3IgYXdhaXQgKGNvbnN0IGwgb2YgbG90dG8uaHJlZnMubWFwKG4gPT4gbi5saWIpKSB7CgkJCQlhd2FpdCB0aGlzLnJlcXVpcmUobCwgbG90dG8uaHJlZnMpOwoJCQl9CgkJfQoKCQlsZXQgc2VjdXJlID0gdGhpcy5fX2NvbmZpZygnc2VjdXJlJyk7CgkJaWYgKHR5cGVvZihnbG9iYWwpICE9PSAndW5kZWZpbmVkJykgewoJCQkvLyBnbG9iYWxzCgkJCXZhciBnbG9iYWxNb2R1bGVzID0gewoJCQkJZXhwcmVzczogJ2V4cHJlc3MnLAoJCQkJaHR0cHM6ICdodHRwcycsCgkJCQlodHRwOiAnaHR0cCcsCgkJCQlzZWxmc2lnbmVkOiAnc2VsZnNpZ25lZCcsCgkJCQl1dGlsOiAndXRpbCcsCgkJCQljb3JzOiAnY29ycycsCgkJCQlib2R5UGFyc2VyOiAnYm9keS1wYXJzZXInLAoJCQkJYXhpb3M6ICdheGlvcycsCgkJCQkvL2NyeXB0bzogJ2NyeXB0bycsCgkJCQlvczogJ29zJywKCQkJCURvdE9iamVjdDogJ2RvdC1vYmplY3QnLAoKCQkJCW1pbmltaXN0OiAnbWluaW1pc3QnLAoKCQkJCWZzOiAnZnMnLAoKCQkJCWpzb253ZWJ0b2tlbjogJ2pzb253ZWJ0b2tlbicsCgoJCQkJc3FsaXRlOiAnc3FsaXRlMycsCgkJCQlteXNxbDogJ215c3FsJywKCQkJCXBnOiAncGcnLAoKCQkJfTsKCgkJCWxldCBtaXNzaW5nR2xvYmFsTW9kdWxlcyA9IE9iamVjdC5lbnRyaWVzKGdsb2JhbE1vZHVsZXMpLm1hcChlID0+IHsKCQkJCXRyeSB7CgkJCQkJZ2xvYmFsW2VbMF1dID0gcmVxdWlyZShlWzFdKTsKCQkJCX0gY2F0Y2ggKGV4KSB7CgkJCQkJdGhpcy5sb2codW5kZWZpbmVkLCAnX3NlcnZlcicsICdFbnRpdHlPYmplY3QnLCAxLCBleCk7CgkJCQkJcmV0dXJuIGVbMV07CgkJCQl9CgkJCX0pLmZpbHRlcihlID0+IGUpOwoJCQlpZiAobWlzc2luZ0dsb2JhbE1vZHVsZXMubGVuZ3RoKSB0aGlzLmxvZyh1bmRlZmluZWQsICdfc2VydmVyJywgJ0VudGl0eU9iamVjdCcsIDEsICJucG0gaW5zdGFsbCAiICsgbWlzc2luZ0dsb2JhbE1vZHVsZXMuam9pbignICcpKTsKCQl9CgoJCWlmIChvcHRpb25zLmluaXRTZWxmKSB7CgkJCWlmICh0aGlzLmluaXQpIHsKCQkJCWF3YWl0IHRoaXMuX3dhaXQoNTAwKTsKCQkJCWlmIChvcHRpb25zLmxvYWRUb29scykgYXdhaXQgdGhpcy5fbG9hZFRvb2xzKG9wdGlvbnMuc2F2ZVRvb2xzKTsKCgkJCQlhd2FpdCB0aGlzLmluaXQoKTsKCgkJCQlsZXQgc3FsVG9vbCA9IChsb3R0by5Ub29scyB8fCBbXSkuZmluZCh0ID0+IHQuX19kbWxTdGF0ZW1lbnRzKTsKCQkJCWlmIChvcHRpb25zLmNvcHlETUwgJiYgc3FsVG9vbCkgewoJCQkJCWxldCBkbWxzID0gc3FsVG9vbC5fX2RtbFN0YXRlbWVudHM7CgkJCQkJaWYgKHNxbFRvb2wudHlwZS5uYW1lID09ICdTcWxEQicpIGRtbHMgPSBbIC8qIkN1c3RvbWVycyIsICJPcmRlcnMiLCAiU2hpcHBpbmdzIiwgKi8gImRlbW8iXS5tYXAodCA9PiBgZHJvcCB0YWJsZSBpZiBleGlzdHMgJHt0fWApLmNvbmNhdChkbWxzKTsKCQkJCQlfRnJFTUQuX2NvcHlUZXh0VG9DbGlwYm9hcmQoZG1scy5qb2luKCc7XG4nKSk7CgkJCQl9CgkJCX0KCQl9CgoJCWlmICh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgJiYgb3B0aW9ucy5sb2FkQ29udGVudCkgewoJCQlhd2FpdCB0aGlzLl9jb250ZW50KCdpbmRleCcsIHsKCQkJCXRhcmdldDogZG9jdW1lbnQuYm9keQoJCQl9KTsKCQl9CgoJCS8vIHJlZnJlc2ggc2NyaXB0CgkJdGhpcy5zZXRJbnRlcnZhbChhc3luYyAoIC8qdmVyc2lvbiovICkgPT4gewoJCQlsZXQgc2N0ID0gbmV3IGxvdHRvLkNvbnRlbnQoKS5fZnJvbURvY3VtZW50KGxvdHRvLl9fQ29udGVudCB8fCB7CgkJCQljb2RlOiAnYXBpc2VydmVyJwoJCQl9KTsKCQkJbGV0IGN0ID0gYXdhaXQgc2N0LmZpbmQoKTsKCQkJaWYgKCFjdCB8fCAhY3QuYWN0aXZlKCkgfHwgIWN0LmVuYWJsZWQoKSkgcmV0dXJuIGZhbHNlOwoKCQkJaWYgKCFzY3QuZGF0ZSgpIHx8ICgoY3QuZGF0ZSgpLmdldFRpbWUoKSAtIHNjdC5kYXRlKCkuZ2V0VGltZSgpKSAvIDEwMDApID4gNSkgewoJCQkJdGhpcy5sb2codW5kZWZpbmVkLCAnX3NlcnZlcicsICdFbnRpdHlPYmplY3QnLCAwLCBgTmV3ZXIgdmVyc2lvbiBmb3VuZDogW2RhdGU6ICR7Y3QuZGF0ZSgpLnRvSVNPU3RyaW5nKCl9LCB0b29sOiAke2N0LlRvb2wubmFtZX1dLCBzdG9yaW5nLi4uYCk7CgkJCQlpZiAodHlwZW9mKGdsb2JhbCkgIT09ICd1bmRlZmluZWQnKSB7CgkJCQkJLy8gd2Ugd2FudCB0byBzdG9yZSB0aGUgY29udGVudCBkaXJlY3RseSB0byB0aGUgYXBpc2VydmVyLmpzIGZpbGUKCQkJCQlhd2FpdCBjdC5fZmlsZXN5c3RlbShjdC5jb2RlKCkgKyAnLmpzJywgdGhpcy5fYXRvYihjdC5jb250ZW50KCkpKTsKCQkJCX0gZWxzZSBpZiAodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnKSB7CgkJCQkJdHJ5IHsKCQkJCQkJaWYgKHdpbmRvdy5zZWxmICE9PSB3aW5kb3cudG9wKSB7CgkJCQkJCQl0aGlzLmxvZyh1bmRlZmluZWQsICdfc2VydmVyJywgJ0VudGl0eU9iamVjdCcsIDAsICJpRnJhbWUgc2hvdWxkIGJlIHJlc3RhcnRlZC4uLiIpOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJdGhpcy5sb2codW5kZWZpbmVkLCAnX3NlcnZlcicsICdFbnRpdHlPYmplY3QnLCAwLCAid2luZG93IGxvY2F0aW9uIHJlbG9hZGluZy4uLiIpOwoJCQkJCQkJLy93aW5kb3cubG9jYXRpb24ucmVsb2FkKCk7CgkJCQkJCX0KCQkJCQl9IGNhdGNoIChleCkgewoJCQkJCQl0aGlzLmxvZyh1bmRlZmluZWQsICdfc2VydmVyJywgJ0VudGl0eU9iamVjdCcsIDIsICJmcmFtZSBjaGVjayIsIGV4KTsKCQkJCQl9CgkJCQl9CgoJCQkJbG90dG8uX19Db250ZW50ID0gc2N0LmRhdGUoY3QuZGF0ZSgpKS5uYW1lKGN0Lm5hbWUoKSkuY29kZShjdC5jb2RlKCkpLl90b0RvY3VtZW50KCk7CgkJCQlyZXR1cm4gZmFsc2U7CgkJCX0KCQkJcmV0dXJuIHRydWU7CgkJfSwgMC41KTsKCgkJaWYgKHR5cGVvZihnbG9iYWwpICE9PSAndW5kZWZpbmVkJykgewoJCQljb25zdCBhcHAgPSBleHByZXNzKCk7CgoJCQlhcHAudXNlKGNvcnMoKSk7CgoJCQlhcHAudXNlKGV4cHJlc3MudXJsZW5jb2RlZCh7CgkJCQlleHRlbmRlZDogdHJ1ZSwKCQkJCWxpbWl0OiAnNTBtYicKCQkJfSkpOwoJCQlhcHAudXNlKGJvZHlQYXJzZXIuanNvbih7CgkJCQl2ZXJpZnk6IChyZXEsIHJlcywgYnVmKSA9PiByZXEucmF3Qm9keSA9IGJ1ZgoJCQl9KSk7CgoJCQlnbG9iYWwuYXV0aGVudGljYXRlID0gYXN5bmMgKHJlcSwgcmVzLCBuZXh0KSA9PiB7CgkJCQljb25zdCBhdXRoSGVhZGVyID0gcmVxLmhlYWRlcnNbJ2F1dGhvcml6YXRpb24nXTsKCQkJCWNvbnN0IHRva2VuID0gYXV0aEhlYWRlciAmJiBhdXRoSGVhZGVyLnNwbGl0KCcgJylbMV07CgoJCQkJaWYgKHRva2VuID09IG51bGwpIHJldHVybiByZXMuc2VuZFN0YXR1cyg0MDEpOwoKCQkJCWpzb253ZWJ0b2tlbi52ZXJpZnkodG9rZW4sIHRoaXMuX19jb25maWcoJ3NlY3JldCcpLCAoZXJyLCBvYmopID0+IHsKCQkJCQlpZiAoZXJyKSByZXR1cm4gcmVzLnNlbmRTdGF0dXMoNDAzKTsKCgkJCQkJcmVxLl9fYXV0aG9yaXphdGlvbiA9IG9iajsKCQkJCQluZXh0KCk7CgkJCQl9KTsKCQkJfTsKCgkJCWFwcC5wb3N0KCcvbWV0aG9kL1VzZXIvYXV0aG9yaXplJywgKHJlcSwgcmVzKSA9PiB0aGlzLl9pbmJvdW5kQ2FsbChyZXEsIHJlcywgIlVzZXIiLCAiYXV0aG9yaXplIikpOwoJCQlhcHAuZ2V0KCcvbWV0aG9kL1VzZXIvYXV0aG9yaXplJywgKHJlcSwgcmVzKSA9PiB0aGlzLl9pbmJvdW5kQ2FsbChyZXEsIHJlcywgIlVzZXIiLCAiYXV0aG9yaXplIikpOwoKCQkJYXBwLnBvc3QoJy9tZXRob2QvOmNsYXNzLzptZXRob2QnLCBnbG9iYWwuYXV0aGVudGljYXRlLCAocmVxLCByZXMpID0+IHRoaXMuX2luYm91bmRDYWxsKHJlcSwgcmVzKSk7CgkJCWFwcC5nZXQoJy9tZXRob2QvOmNsYXNzLzptZXRob2QnLCBnbG9iYWwuYXV0aGVudGljYXRlLCAocmVxLCByZXMpID0+IHRoaXMuX2luYm91bmRDYWxsKHJlcSwgcmVzKSk7CgoJCQlpZiAodGhpcy5fX2NvbmZpZygnZW1haWwuaG9zdCcpKSB7CgkJCQlsb3R0by50cmFuc3BvcnRlciA9IG5vZGVtYWlsZXIuY3JlYXRlVHJhbnNwb3J0KHsKCQkJCQlzZXJ2aWNlOiB0aGlzLl9fY29uZmlnKCdlbWFpbC5ob3N0JyksCgkJCQkJYXV0aDogdGhpcy5fX2NvbmZpZygnZW1haWwudXNlcicpID8gewoJCQkJCQl1c2VyOiB0aGlzLl9fY29uZmlnKCdlbWFpbC51c2VyJyksCgkJCQkJCXBhc3M6IHRoaXMuX19jb25maWcoJ2VtYWlsLnBhc3N3b3JkJyksCgkJCQkJfSA6IHVuZGVmaW5lZCwKCQkJCX0pOwoKCQkJCS8qCgkJCQlhd2FpdCBsb3R0by50cmFuc3BvcnRlci5zZW5kTWFpbCh7CgkJCQkgICAgZnJvbTogdGhpcy5fX2NvbmZpZygnZW1haWwuc2VuZGVyJyksCgkJCQkgICAgdG8sCgkJCQkgICAgc3ViamVjdCwKCQkJCSAgICB0ZXh0LAoJCQkJfSk7CgkJCQkqLwoJCQl9CgoJCQlsZXQgcG9ydCA9IGxvdHRvLl9ub2RlID8gKGxvdHRvLl9ub2RlLnBvcnQoKSB8fCAzMDAwKSA6IDMwMDA7CgkJCWxldCBhZGRyZXNzID0gIjAuMC4wLjAiOwoKCQkJbGV0IGxpc3RlbiA9IGFzeW5jICgpID0+IHRoaXMubG9nKHVuZGVmaW5lZCwgJ19zZXJ2ZXInLCAnRW50aXR5T2JqZWN0JywgMCwgYGxvdHRvWyR7dGhpcy5pcEFkZHJlc3MoKX1dIGxpc3RlbmluZyBhdCBodHRwJHtzZWN1cmU/J3MnOicnfTovLyR7YWRkcmVzc306JHtwb3J0fWApOwoJCQlpZiAoc2VjdXJlKSB7CgkJCQlsZXQgY2VydCA9IG51bGw7CgkJCQlpZiAodGhpcy5fX2NvbmZpZygnc2VjdXJlLnByaXZhdGUnKSkgewoJCQkJCWNlcnQgPSB7CgkJCQkJCXByaXZhdGU6IChhd2FpdCBmcy5wcm9taXNlcy5yZWFkRmlsZSh0aGlzLl9fY29uZmlnKCdzZWN1cmUucHJpdmF0ZScpKSksCgkJCQkJCWNlcnQ6IChhd2FpdCBmcy5wcm9taXNlcy5yZWFkRmlsZSh0aGlzLl9fY29uZmlnKCdzZWN1cmUuY2VydCcpKSksCgkJCQkJfTsKCQkJCX0gZWxzZSB7CgkJCQkJY2VydCA9IHNlbGZzaWduZWQuZ2VuZXJhdGUoW3sKCQkJCQkJbmFtZTogJ2NvbW1vbk5hbWUnLAoJCQkJCQl2YWx1ZTogJ25hbW1vdXIuY29tJwoJCQkJCX1dLCB7CgkJCQkJCWRheXM6IDM2NQoJCQkJCX0pOwoJCQkJfQoJCQkJZ2xvYmFsLmV4U2VydmVyID0gaHR0cHMuY3JlYXRlU2VydmVyKHsKCQkJCQlrZXk6IGNlcnQucHJpdmF0ZSwKCQkJCQljZXJ0OiBjZXJ0LmNlcnQKCQkJCX0sIGFwcCkubGlzdGVuKHBvcnQsIGFkZHJlc3MsIGxpc3Rlbik7CgkJCX0gZWxzZSB7CgkJCQlnbG9iYWwuZXhTZXJ2ZXIgPSBodHRwLmNyZWF0ZVNlcnZlcihhcHApLmxpc3Rlbihwb3J0LCBhZGRyZXNzLCBsaXN0ZW4pOwoJCQl9CgkJfQoJfQoKCWFzeW5jIF9jb250ZW50KGNvZGUsIG9wdGlvbnMgPSB7fSkgewoJCXRyeSB7CgkJCWxldCBqcyA9IChhd2FpdCBuZXcgbG90dG8uQ29udGVudChudWxsLCBvcHRpb25zLnRvb2wpLmNvZGUoY29kZSwgJz0nKS5maW5kKCkpLmNvbnRlbnQoKTsKCQkJdGhpcy5sb2codW5kZWZpbmVkLCAnX2NvbnRlbnQnLCAnRW50aXR5T2JqZWN0JywgMCwganMpOwoJCQlpZiAob3B0aW9ucy50YXJnZXQpIHsKCQkJCWxldCBuZXdTY3JpcHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzY3JpcHQiKTsKCQkJCW5ld1NjcmlwdC5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShqcykpOwoJCQkJb3B0aW9ucy50YXJnZXQuYXBwZW5kQ2hpbGQobmV3U2NyaXB0KTsKCQkJfQoJCQlyZXR1cm4ganM7CgkJfSBjYXRjaCAoZXgpIHsKCQkJdGhpcy5sb2codW5kZWZpbmVkLCAnX2NvbnRlbnQnLCAnRW50aXR5T2JqZWN0JywgMiwgZXgpOwoJCX0KCX0KCglhc3luYyBfaW5ib3VuZENhbGwocmVxLCByZXMsIGNOYW1lLCBtTmFtZSkgewoJCWxldCByZXQgPSB7fTsKCQl0cnkgewoJCQlyZXQgPSBhd2FpdCBuZXcgbG90dG9bcmVxLnBhcmFtcy5jbGFzcyB8fCBjTmFtZV0oKS5faW52b2tlKHJlcS5wYXJhbXMubWV0aG9kIHx8IG1OYW1lLCByZXEuYm9keSwgcmVxLnF1ZXJ5LCByZXEuX19hdXRob3JpemF0aW9uKTsKCQl9IGNhdGNoIChleCkgewoJCQl0aGlzLmxvZyh1bmRlZmluZWQsICdfaW5ib3VuZENhbGwnLCAnRW50aXR5T2JqZWN0JywgMiwgZXgpOwoJCQlyZXQgPSB7CgkJCQlFeGNlcHRpb246ICJFeGNlcHRpb246ICIgKyBleCwKCQkJfTsKCQl9CgoJCWlmICh0eXBlb2YoRmxhdHRlZCkgIT09ICJ1bmRlZmluZWQiICYmIHJlcS5xdWVyeVsianNvbiJdICE9ICJ0cnVlIiAmJiByZXEuYm9keSAmJiByZXEuYm9keS5fX2ZsYXR0ZWQpIHJldCA9IHsKCQkJX19mbGF0dGVkOiBGbGF0dGVkLnN0cmluZ2lmeShyZXQpCgkJfTsKCgkJaWYgKHJldCAmJiB0eXBlb2YocmV0KSA9PT0gIm51bWJlciIpIHJldCA9IHJldC50b1N0cmluZygpOwoJCXJlcy5zZW5kKHJldCk7Cgl9CgoJYXN5bmMgX2ludm9rZU5vZGUobiwgbWV0aG9kLCBkYXRhLCBldmVudCwgYlJhdykgewoJCS8vIGlmKCFuKSByZXR1cm4gbnVsbDsKCgkJaWYgKHR5cGVvZihsb3R0by5fbm9kZSkgPT09ICd1bmRlZmluZWQnKSB7CgkJCXRoaXMubG9nKHVuZGVmaW5lZCwgJ19pbnZva2VOb2RlJywgJ0VudGl0eU9iamVjdCcsIDEsICJsb3R0by5fbm9kZSBub3QgZGVmaW5lZCIpOwoJCQlyZXR1cm4gbnVsbDsKCQl9CgoJCWlmIChldmVudCkgewoKCQkJdGhpcy5sb2codW5kZWZpbmVkLCAnX2ludm9rZU5vZGUnLCAnRW50aXR5T2JqZWN0JywgMiwgIkV2ZW50IGNhbm5vdCBiZSBkZWZpbmVkIHdpdGhvdXQgdGhlIEV2ZW50IGNsYXNzIik7CgkJCXJldHVybiBudWxsOwoKCQl9CgoJCWxldCByZXQgPSBudWxsOwoKCQlkYXRhID0gZGF0YSB8fCB7fTsKCgkJaWYgKHR5cGVvZihkYXRhKSA9PT0gIm9iamVjdCIpIHsKCQkJZGF0YS5fX3RoaXMgPSBkYXRhLl9fdGhpcyB8fCB0aGlzLl90b0RvY3VtZW50KCk7CgkJCXN3aXRjaCAobWV0aG9kKSB7CgoJCQkJY2FzZSAiaW5pdCI6IHsKCgkJCQkJYnJlYWs7CgkJCQl9CgoJCQkJY2FzZSAiYXV0aG9yaXplIjogewoKCQkJCQlicmVhazsKCQkJCX0KCgkJCX0KCQl9CgoJCWlmICghbiB8fCBsb3R0by5fbm9kZS5fc2FtZU5vZGUobikpIHsKCQkJLy8gdGhpcy5sb2codW5kZWZpbmVkLCAnX2ludm9rZU5vZGUnLCAnRW50aXR5T2JqZWN0JywgMCwgIkNhbGxiYWNrIik7CgkJCXJldCA9IGF3YWl0IHRoaXMuX2ludm9rZShtZXRob2QsIGRhdGEpOwoJCX0gZWxzZSBpZiAobi5hZGRyZXNzKCkgJiYgbi5fc2FtZU5vZGUobikgLyphY3R1YWwgbm9kZSovICkgewoJCQkvLyB0aGlzLmxvZyh1bmRlZmluZWQsICdfaW52b2tlTm9kZScsICdFbnRpdHlPYmplY3QnLCAwLCBuLl9hZGRyZXNzLCBuLl9wb3J0LCBtZXRob2QpOwoJCQl0cnkgewoJCQkJbGV0IGNvbmZpZyA9IHsKCQkJCQloZWFkZXJzOiB7fSwKCQkJCX07CgkJCQlpZiAobG90dG8uX190b2tlbikgY29uZmlnLmhlYWRlcnMuQXV0aG9yaXphdGlvbiA9IGAke2xvdHRvLl9fdG9rZW4udG9rZW5fdHlwZX0gJHtsb3R0by5fX3Rva2VuLmFjY2Vzc190b2tlbn1gOwoJCQkJcmV0ID0gYXdhaXQgYXhpb3MucG9zdChgaHR0cCR7bi5zZWN1cmUoKT8ncyc6Jyd9Oi8vJHtuLmFkZHJlc3MoKX06JHtuLnBvcnQoKSB8fCAzMDAwfS9tZXRob2QvVXNlci8ke21ldGhvZH1gLCBkYXRhLCBjb25maWcpOwoJCQl9IGNhdGNoIChleCkgewoJCQkJdGhpcy5sb2codW5kZWZpbmVkLCAnX2ludm9rZU5vZGUnLCAnRW50aXR5T2JqZWN0JywgMiwgZXgpOwoJCQl9CgkJfSBlbHNlIHsKCgkJfQoKCQlpZiAoIXJldCkgcmV0dXJuIG51bGw7CgkJcmV0ID0gcmV0LmRhdGEgfHwgcmV0OwoJCWlmICh0eXBlb2YoRmxhdHRlZCkgIT09ICJ1bmRlZmluZWQiICYmIHJldC5fX2ZsYXR0ZWQpIHJldCA9IEZsYXR0ZWQucGFyc2UocmV0Ll9fZmxhdHRlZCk7CgoJCWlmIChyZXQuX19leGNlcHRpb24pIHsKCQkJLy8gYW4gZXhjZXB0aW9uIG9jY3VycmVkIGF0IHRoZSBzZXJ2ZXIKCQkJdGhpcy5sb2codW5kZWZpbmVkLCAnX2ludm9rZU5vZGUnLCAnRW50aXR5T2JqZWN0JywgMiwgYEV4Y2VwdGlvbiBhdCAke24uX2FkZHJlc3N9YCwgcmV0Ll9fZXhjZXB0aW9uKTsKCQkJcmV0dXJuIHJldDsKCQl9CgoJCXN3aXRjaCAobWV0aG9kKSB7CgoJCQljYXNlICJpbml0IjogewoKCQkJCWJyZWFrOwoJCQl9CgoJCQljYXNlICJhdXRob3JpemUiOiB7CgoJCQkJbG90dG8uX190b2tlbiA9IHsKCQkJCQl0b2tlbl90eXBlOiAiQmVhcmVyIiwKCQkJCQlhY2Nlc3NfdG9rZW46IHJldAoJCQkJfTsKCgkJCQlicmVhazsKCQkJfQoKCQkJY2FzZSAiaW5zZXJ0IjoKCQkJY2FzZSAidXBkYXRlIjoKCQkJY2FzZSAic3RvcmUiOgoJCQljYXNlICJkZWxldGUiOgoJCQljYXNlICJmaW5kIjogewoJCQkJaWYgKCFiUmF3KSByZXQgPSBuZXcgbG90dG8uVXNlcihudWxsLCB0aGlzLlRvb2wpLl9mcm9tRG9jdW1lbnQocmV0KTsKCQkJCWJyZWFrOwoJCQl9CgkJCWNhc2UgImZpbmRBbGwiOiB7CgkJCQlpZiAocmV0ICYmICFBcnJheS5pc0FycmF5KHJldCkpIHsKCQkJCQl0aGlzLmxvZyh1bmRlZmluZWQsICdfaW52b2tlTm9kZScsICdFbnRpdHlPYmplY3QnLCAxLCAiTm90IGFuIEFycmF5IGluIEZpbmRBbGwiLCByZXQpOwoJCQkJCXJldCA9IFtyZXRdOwoJCQkJfQoJCQkJaWYgKCFiUmF3ICYmIHJldC5tYXApIHJldCA9IHJldC5tYXAocCA9PiBuZXcgbG90dG8uVXNlcihudWxsLCB0aGlzLlRvb2wpLl9mcm9tRG9jdW1lbnQocCkpOwoJCQkJYnJlYWs7CgkJCX0KCgkJCWRlZmF1bHQ6IHt9CgkJfQoKCQlyZXR1cm4gcmV0OwoJfQoKCWFzeW5jIF9pbnZva2UobWV0aG9kLCBib2R5LCBxdWVyeSwgYXV0aE9iaikgewoJCXRoaXMubG9nKHVuZGVmaW5lZCwgJ19pbnZva2UnLCAnRW50aXR5T2JqZWN0JywgMCwgbWV0aG9kLCBxdWVyeSwgYm9keSk7CgoJCWlmICh0eXBlb2YoYm9keSkgPT09ICdzdHJpbmcnIHx8ICh0eXBlb2YoQnVmZmVyKSAhPT0gJ3VuZGVmaW5lZCcgJiYgQnVmZmVyLmlzQnVmZmVyKGJvZHkpKSkgewoJCQl0cnkgewoJCQkJYm9keSA9IEpTT04ucGFyc2UoYm9keS50b1N0cmluZygpKTsKCQkJfSBjYXRjaCAoZXgpIHsKCQkJCXRoaXMubG9nKHVuZGVmaW5lZCwgJ19pbnZva2UnLCAnRW50aXR5T2JqZWN0JywgMCwgIkJvZHkgaXMgbm90IGEgdmFsaWQgSlNPTiIsIGJvZHkpOwoJCQkJcmV0dXJuOwoJCQl9CgkJfQoKCQlsZXQgX3BhcmFtcyA9IHF1ZXJ5ID8gT2JqZWN0LmFzc2lnbihxdWVyeSwgYm9keSkgOiBib2R5OwoJCWlmICh0eXBlb2YoX3BhcmFtcykgPT09ICdzdHJpbmcnKSBfcGFyYW1zID0gSlNPTi5wYXJzZShfcGFyYW1zKTsKCgkJaWYgKF9wYXJhbXMpIHsKCQkJX3BhcmFtcyA9IERvdE9iamVjdC5vYmplY3QoX3BhcmFtcyk7CgkJfSBlbHNlIHsKCQkJX3BhcmFtcyA9IHt9OwoJCX0KCgkJaWYgKHR5cGVvZihGbGF0dGVkKSAhPT0gInVuZGVmaW5lZCIgJiYgX3BhcmFtcy5fX2ZsYXR0ZWQpIF9wYXJhbXMgPSBGbGF0dGVkLnBhcnNlKF9wYXJhbXMuX19mbGF0dGVkKTsKCgkJaWYgKF9wYXJhbXMuX190aGlzKSB7CgkJCV9wYXJhbXMuX190aGlzID0gRG90T2JqZWN0Lm9iamVjdChfcGFyYW1zLl9fdGhpcyk7CgkJCXRoaXMuX2Zyb21Eb2N1bWVudChfcGFyYW1zLl9fdGhpcykuX2RlUmVmZXJlbmNlKCk7CgkJfQoKCQl0aGlzLmxvZyh1bmRlZmluZWQsICdfaW52b2tlJywgJ0VudGl0eU9iamVjdCcsIDAsICJfcGFyYW1zIiwgX3BhcmFtcyk7CgoJCWxldCBhckFyZ3MgPSBbXTsKCQlzd2l0Y2ggKG1ldGhvZCkgewoKCQkJY2FzZSAiaW5pdCI6IHsKCgkJCQlicmVhazsKCQkJfQoKCQkJY2FzZSAiYXV0aG9yaXplIjogewoKCQkJCWJyZWFrOwoJCQl9CgoJCQljYXNlICJmaW5kQWxsIjogewoJCQkJYXJBcmdzLnB1c2goX3BhcmFtcy5kZXB0aCk7CgkJCQlhckFyZ3MucHVzaChfcGFyYW1zLm9ianMpOwoJCQkJYXJBcmdzLnB1c2goX3BhcmFtcy5zdGFydCk7CgkJCQlhckFyZ3MucHVzaChfcGFyYW1zLmVuZCk7CgkJCQlicmVhazsKCQkJfQoJCQljYXNlICJmaW5kIjogewoJCQkJYXJBcmdzLnB1c2goX3BhcmFtcy5kZXB0aCk7CgkJCQlicmVhazsKCQkJfQoKCQkJZGVmYXVsdDogewoJCQkJYnJlYWs7CgkJCX0KCQl9CgoJCWxldCBvYmogPSB0aGlzOwoKCQlsZXQgcmV0ID0gbnVsbDsKCQlpZiAoIW9iaikgewoJCQlyZXQgPSB7CgkJCQlfX2V4Y2VwdGlvbjogewoJCQkJCSctMSc6IGBVc2VyLl9pbnZva2U6IG9iaiBpcyB1bmRlZmluZWRgCgkJCQl9CgkJCX07CgkJfSBlbHNlIGlmICghb2JqW21ldGhvZF0pIHsKCQkJcmV0ID0gewoJCQkJX19leGNlcHRpb246IHsKCQkJCQknLTInOiBgVXNlci5faW52b2tlOiBtZXRob2QgJHtvYmouY29uc3RydWN0b3IubmFtZX0oJHttZXRob2R9KSBpcyBub3QgZm91bmRgLAoJCQkJCSdvYmonOiBvYmoKCQkJCX0KCQkJfTsKCQl9IGVsc2UgewoJCQlyZXQgPSBhd2FpdCBvYmpbbWV0aG9kXSguLi5hckFyZ3MpOwoJCX0KCgkJaWYgKHRoaXMuVG9vbC50eXBlLm5hbWUgPT0gIlNxbERCIikgewoKCQkJaWYgKGZhbHNlICYmIGxvdHRvLl9fc3FsVHJhbnNhY3Rpb24gJiYgIWxvdHRvLl9fc3FsVHJhbnNhY3Rpb24uZW5kKSB7CgkJCQlyZXQgPSB7CgkJCQkJX19leGNlcHRpb246IHsKCQkJCQkJJy00JzogIlVuY29tbWl0dGVkIHRyYW5zYWN0aW9uczogIiArIGxvdHRvLl9fc3FsVHJhbnNhY3Rpb24uc3Fscy5sZW5ndGgsCgkJCQkJCSdvYmonOiBvYmoKCQkJCQl9CgkJCQl9CgkJCX0KCgkJfQoKCQlpZiAocmV0ICYmICFyZXQuX19leGNlcHRpb24pIHsKCQkJbG90dG8uX3VuUmVjdXJzZSA9IHt9OwoJCQlpZiAoQXJyYXkuaXNBcnJheShyZXQpKSB7CgkJCQlyZXQgPSByZXQubWFwKHIgPT4gewoJCQkJCWlmIChyICYmIHIuX3RvRG9jdW1lbnQpIHsKCQkJCQkJaWYgKGxvdHRvLl91blJlY3Vyc2UuVXNlcikgZGVsZXRlIGxvdHRvLl91blJlY3Vyc2UuVXNlci5fdG9Eb2N1bWVudDsKCQkJCQkJcmV0dXJuIHIuX3RvRG9jdW1lbnQoZmFsc2UsIHRydWUpOwoJCQkJCX0gZWxzZSByZXR1cm4gcjsKCQkJCX0pOwoJCQl9IGVsc2UgewoJCQkJcmV0ID0gKHJldCAmJiByZXQuX3RvRG9jdW1lbnQpID8gcmV0Ll90b0RvY3VtZW50KGZhbHNlLCB0cnVlKSA6IHJldDsKCQkJfQoJCX0KCgkJdGhpcy5sb2codW5kZWZpbmVkLCAnX2ludm9rZScsICdFbnRpdHlPYmplY3QnLCAwLCAncmV0JywgcmV0KTsKCQl0aGlzLmxvZyh1bmRlZmluZWQsICdfaW52b2tlJywgJ0VudGl0eU9iamVjdCcsIDAsIGAke21ldGhvZH06ICR7dGhpcy5fX3RpbWUoJ2xvdHRvLlVzZXIuJyArIG1ldGhvZCl9YCk7CgkJcmV0dXJuIHJldDsKCX0KCglhc3luYyBfbG9hZFRvb2xzKGJTdG9yZSwgc291cmNlID0gJ1VzZXInKSB7CgoJCWlmIChsb3R0by5Ub29scyAmJiBsb3R0by5Ub29scy5sZW5ndGgpIHsKCQkJdGhpcy5sb2codW5kZWZpbmVkLCAnX2xvYWRUb29scycsICdFbnRpdHlPYmplY3QnLCAwLCBgWyR7c291cmNlfV06IFRvb2xzIGFscmVhZHkgbG9hZGVkYCk7CgkJCXJldHVybiBsb3R0by5Ub29sczsKCQl9CgoJCXRoaXMubG9nKHVuZGVmaW5lZCwgJ19sb2FkVG9vbHMnLCAnRW50aXR5T2JqZWN0JywgMCwgYFske3NvdXJjZX1dOiBMb2FkaW5nIHRvb2xzLi4uYCk7CgoJCWRlbGV0ZSBsb3R0by5fc3RvcmVFbnRpdHlDbGFzczsKCQlkZWxldGUgbG90dG8uX19jb25maWc7CgoJCWxldCB0b29scyA9IFt7CgkJCXR5cGU6IHsKCQkJCW5hbWU6ICJTcWxEQiIsCgkJCX0sCgkJCXRvb2xfQ29uZmlnczogW3sKCQkJCW5hbWU6ICJjcmVhdGUiLAoJCQkJdmFsdWU6IDMsCgkJCX0sIHsKCQkJCW5hbWU6ICJ0eXBlIiwKCQkJCXZhbHVlOiAic3FsaXRlIiwKCQkJfSwgewoJCQkJbmFtZTogIlN5bmNFbnRpdHlBdHRyaWJ1dGVzIiwKCQkJCXZhbHVlOiB0cnVlLAoJCQl9LCB7CgkJCQluYW1lOiAiU3luY1R5cGVkQXR0cmlidXRlcyIsCgkJCQl2YWx1ZTogdHJ1ZSwKCQkJfV0KCQl9XTsKCgkJdHJ5IHsKCQkJbGV0IGZOYW1lID0gIkFQSVNFUlZFUl9fbG9hZFRvb2xzLmpzb24iOwoJCQlpZiAodHlwZW9mKGdsb2JhbCkgIT09ICd1bmRlZmluZWQnICYmIGZzLmV4aXN0c1N5bmMoZk5hbWUpKSB0b29scyA9IHRoaXMucnVuU2NyaXB0KGF3YWl0IGZzLnByb21pc2VzLnJlYWRGaWxlKGZOYW1lKSkgfHwgdG9vbHM7CgkJCWlmICh0aGlzLl9fY29uZmlnKCJnaXRodWIudG9vbHMiKSkgdG9vbHMgPSB0aGlzLnJ1blNjcmlwdChhd2FpdCBheGlvcy5nZXQodGhpcy5fX2NvbmZpZygiZ2l0aHViLnRvb2xzIikgKyBmTmFtZSwgewoJCQkJdmFsaWRhdGVTdGF0dXM6IHN0YXR1cyA9PiBzdGF0dXMgPCA1MDAKCQkJfSkuZGF0YSkgfHwgdG9vbHM7CgoJCQlsZXQgdERhdGEgPSBudWxsOwoJCQlpZiAodGhpcy5zcigpKSB0RGF0YSA9IGF3YWl0IHRoaXMuc3IoKS5fKCJDb250ZW50TWFuYWdlci5jbXNTdG9yZWRTY3JpcHRGaW5kIiwgbnVsbCwgewoJCQkJTmFtZTogZk5hbWUsCgkJCQlBY3RpdmU6IHRydWUsCgkJCQlFbmFibGVkOiB0cnVlCgkJCX0pOwoJCQlpZiAoIXREYXRhKSB7CgkJCQl0aGlzLmxvZyh1bmRlZmluZWQsICdfbG9hZFRvb2xzJywgJ0VudGl0eU9iamVjdCcsIDAsIGBbJHtzb3VyY2V9XTogVG9vbHMgbm90IGluIENNU2ApOwoJCQl9IGVsc2UgewoJCQkJdG9vbHMgPSB0aGlzLnJ1blNjcmlwdCh0RGF0YS5TY3JpcHQpIHx8IHRvb2xzOwoJCQl9CgoJCQl0b29scyA9IGxvdHRvLl9fVG9vbHMgfHwgdG9vbHM7CgkJCWRlbGV0ZSBsb3R0by5fX1Rvb2xzOwoJCX0gY2F0Y2ggKGV4KSB7CgkJCXRoaXMubG9nKHVuZGVmaW5lZCwgJ19sb2FkVG9vbHMnLCAnRW50aXR5T2JqZWN0JywgMSwgZXgpOwoJCX0KCgkJdG9vbHMuZmlsdGVyKHQgPT4gdHlwZW9mKHQuYWN0aXZlKSA9PT0gInVuZGVmaW5lZCIgfHwgKHR5cGVvZih0LmFjdGl2ZSkgPT09ICJ1bmRlZmluZWQiICYmIHQuYWN0aXZlKSkuZm9yRWFjaCh0ID0+IHsKCQkJdC5uYW1lID0gdC5uYW1lIHx8IHQudHlwZS5uYW1lOwoKCQkJdC5hY3RpdmUgPSB0eXBlb2YodC5hY3RpdmUpICE9PSAndW5kZWZpbmVkJyA/IHQuYWN0aXZlIDogdHJ1ZTsKCQkJdC5lbmFibGVkID0gdHlwZW9mKHQuZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnID8gdC5lbmFibGVkIDogdHJ1ZTsKCQkJdC50eXBlLmFjdGl2ZSA9IHR5cGVvZih0LnR5cGUuYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcgPyB0LnR5cGUuYWN0aXZlIDogdHJ1ZTsKCQkJdC50eXBlLmVuYWJsZWQgPSB0eXBlb2YodC50eXBlLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJyA/IHQudHlwZS5lbmFibGVkIDogdHJ1ZTsKCgkJCXQudG9vbF9Db25maWdzID0gdC50b29sX0NvbmZpZ3MgfHwgW107CgkJCXQudG9vbF9Db25maWdzLmZvckVhY2goYyA9PiB7CgkJCQljLmFjdGl2ZSA9IHR5cGVvZihjLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnID8gYy5hY3RpdmUgOiB0cnVlOwoJCQkJYy5lbmFibGVkID0gdHlwZW9mKGMuZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnID8gYy5lbmFibGVkIDogdHJ1ZTsKCQkJfSk7CgoJCQl0LnR5cGUudHlwZV9Db25maWdzID0gdC50eXBlLnR5cGVfQ29uZmlncyB8fCBbXTsKCQkJdC50eXBlLnR5cGVfQ29uZmlncy5mb3JFYWNoKGMgPT4gewoJCQkJYy5hY3RpdmUgPSB0eXBlb2YoYy5hY3RpdmUpICE9PSAndW5kZWZpbmVkJyA/IGMuYWN0aXZlIDogdHJ1ZTsKCQkJCWMuZW5hYmxlZCA9IHR5cGVvZihjLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJyA/IGMuZW5hYmxlZCA6IHRydWU7CgkJCX0pOwoKCQkJdC50eXBlLnR5cGVfTWFwcGluZ3MgPSB0LnR5cGUudHlwZV9NYXBwaW5ncyB8fCBbXTsKCQkJdC50eXBlLnR5cGVfTWFwcGluZ3MuZm9yRWFjaChtID0+IHsKCQkJCW0uYWN0aXZlID0gdHlwZW9mKG0uYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcgPyBtLmFjdGl2ZSA6IHRydWU7CgkJCQltLmVuYWJsZWQgPSB0eXBlb2YobS5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcgPyBtLmVuYWJsZWQgOiB0cnVlOwoJCQkJbS50eXBlID0gewoJCQkJCW5hbWU6IHQudHlwZS5uYW1lCgkJCQl9OwoJCQl9KTsKCgkJCXQudG9vbF9NYXBwaW5ncyA9IHQudG9vbF9NYXBwaW5ncyB8fCBbXTsKCQkJdC50b29sX01hcHBpbmdzLmZvckVhY2gobSA9PiB7CgkJCQltLmFjdGl2ZSA9IHR5cGVvZihtLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnID8gbS5hY3RpdmUgOiB0cnVlOwoJCQkJbS5lbmFibGVkID0gdHlwZW9mKG0uZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnID8gbS5lbmFibGVkIDogdHJ1ZTsKCQkJCW0udG9vbCA9IHsKCQkJCQluYW1lOiB0Lm5hbWUKCQkJCX07CgkJCX0pOwoJCX0pOwoJCXRvb2xzID0gdG9vbHMuZmlsdGVyKHQgPT4gSlNPTi5wYXJzZSgoKHR5cGVvZih0aGlzKSAhPT0gInVuZGVmaW5lZCIgJiYgdHlwZW9mKHRoaXMuX2F0b2IpICE9PSAidW5kZWZpbmVkIikgPyB0aGlzLl9hdG9iIDogKHR5cGVvZihfRnJFTUQpICE9PSAidW5kZWZpbmVkIiA/IF9GckVNRC5fYXRvYiA6IGF0b2IpKShgV3lKVGNXeEVRaUlzSWtacGJHVlRlWE4wWlcwaUxDSkhhWFJJZFdJaVhRPT1gKSwgKGtleSwgdmFsdWUpID0+IHsKCQkJaWYgKHR5cGVvZih2YWx1ZSkgPT09ICJzdHJpbmciICYmIHZhbHVlLmluZGV4T2YoIj0+IikgPiAwKSByZXR1cm4gZXZhbCgiKCIgKyB2YWx1ZSArICIpIik7CgkJCXJldHVybiB2YWx1ZTsKCQl9KS5maW5kKF90ID0+ICh0eXBlb2YoX3QpID09PSAnc3RyaW5nJyA/IF90IDogX3QubmFtZSkgPT0gdC5uYW1lKSk7CgoJCXRvb2xzLmZvckVhY2godCA9PiBbJ3Rvb2xfQ29uZmlncycsICd0eXBlLnR5cGVfQ29uZmlncyddLmZvckVhY2goc0NvbmZpZyA9PiB7CgkJCURvdE9iamVjdC5zZXQoc0NvbmZpZywgRG90T2JqZWN0LnBpY2soc0NvbmZpZywgdCkuZmlsdGVyKGMgPT4gdHlwZW9mKGMudmFsdWUpICE9PSAib2JqZWN0IikuY29uY2F0KERvdE9iamVjdC5waWNrKHNDb25maWcsIHQpLmZpbHRlcihjID0+IHR5cGVvZihjLnZhbHVlKSA9PT0gIm9iamVjdCIpLm1hcChjID0+IE9iamVjdC5rZXlzKGMudmFsdWUpLm1hcChuY29kZSA9PiB7CgkJCQlsZXQgX2MgPSB7CgkJCQkJbmFtZTogYy5uYW1lLAoJCQkJCXZhbHVlOiBjLnZhbHVlW25jb2RlXSwKCQkJCX07CgkJCQlpZiAobmNvZGUgIT0gImRlZmF1bHQiKSB7CgkJCQkJX2Mubm9kZSA9IHsKCQkJCQkJY29kZTogbmNvZGUsCgkJCQkJCWFjdGl2ZTogdHJ1ZSwKCQkJCQkJZW5hYmxlZDogZmFsc2UsIC8vIG90aGVyd2lzZSBpdCBzdGFydHMgZ2V0dGluZyBldmVudHMKCQkJCQkJdHlwZTogewoJCQkJCQkJbmFtZTogIk5vZGVKUyIsCgkJCQkJCX0KCQkJCQl9OwoJCQkJfQoJCQkJcmV0dXJuIF9jOwoJCQl9KS5mbGF0KCkpLmZsYXQoKSksIHQpOwoJCQlEb3RPYmplY3QucGljayhzQ29uZmlnLCB0KS5mb3JFYWNoKGMgPT4gYy52YWx1ZSA9IEpTT04uc3RyaW5naWZ5KGMudmFsdWUpKTsKCQl9KSk7CgoJCXRoaXMubG9nKHVuZGVmaW5lZCwgJ19sb2FkVG9vbHMnLCAnRW50aXR5T2JqZWN0JywgMCwgYFske3NvdXJjZX1dOiBUb29scyBhcmUgJHt0b29scy5sZW5ndGh9YCk7CgoJCWxvdHRvLlRvb2xzID0gdG9vbHM7CgoJCWxvdHRvLlRvb2xzLmZpbHRlcih0ID0+ICF0LmF4aW9zKS5mb3JFYWNoKHQgPT4gewoJCQl0LmF4aW9zID0gYXhpb3MuY3JlYXRlKCk7CgkJCXQuYXhpb3MuaW50ZXJjZXB0b3JzLnJlcXVlc3QudXNlKGFzeW5jIGNvbmZpZyA9PiB7CgkJCQl0cnkgewoJCQkJCWNvbmZpZy5tZXRhID0gY29uZmlnLm1ldGEgfHwge307CgkJCQkJY29uZmlnLm1ldGEuY291bnRlciA9IDQ7CgoJCQkJCWxldCB0b2tlblVyaSA9IHRoaXMuX19jb25maWcoIm9hdXRoLnRva2VuLnVyaSIsIG51bGwsIHsKCQkJCQkJdG9vbDogdAoJCQkJCX0pOwoJCQkJCWxldCByZWZyZXNoVXJpID0gdGhpcy5fX2NvbmZpZygib2F1dGgucmVmcmVzaC51cmkiLCBudWxsLCB7CgkJCQkJCXRvb2w6IHQKCQkJCQl9KTsKCQkJCQlsZXQgYXV0aFVyaSA9IHRoaXMuX19jb25maWcoIm9hdXRoLmF1dGhvcml6ZS51cmkiLCBudWxsLCB7CgkJCQkJCXRvb2w6IHQKCQkJCQl9KTsKCQkJCQlsZXQgdG9rZW4gPSB0aGlzLl9fY29uZmlnKCJvYXV0aC5hY2Nlc3NfdG9rZW4iLCBudWxsLCB7CgkJCQkJCXRvb2w6IHQsCgkJCQkJCW5vZGU6IGxvdHRvLl9ub2RlCgkJCQkJfSk7CgkJCQkJaWYgKCFjb25maWcuaGVhZGVycy5BdXRob3JpemF0aW9uICYmIFt0b2tlblVyaSwgcmVmcmVzaFVyaSwgYXV0aFVyaV0uaW5kZXhPZihjb25maWcudXJsKSA8IDApIHsKCQkJCQkJaWYgKCF0b2tlbiAmJiBsb3R0by5fbm9kZSkgewoJCQkJCQkJbGV0IGF1dGhDb2RlID0gdGhpcy5fX2NvbmZpZygnb2F1dGguYXV0aG9yaXplLmNvZGUnLCBudWxsLCB7CgkJCQkJCQkJdG9vbDogdAoJCQkJCQkJfSk7CgkJCQkJCQlsZXQgYXV0aE1ldGhvZCA9IHRoaXMuX19jb25maWcoJ29hdXRoLmF1dGhvcml6ZS5tZXRob2QnLCBudWxsLCB7CgkJCQkJCQkJdG9vbDogdAoJCQkJCQkJfSk7CgoJCQkJCQkJaWYgKGF1dGhNZXRob2QpIHsKCQkJCQkJCQlsZXQgZmxvdyA9ICghYXV0aENvZGUgJiYgYXV0aE1ldGhvZCA9PSAncG9zdCcpID8gJ2F1dGhvcml6ZScgOiAndG9rZW4nOwoJCQkJCQkJCS8vIGdldCB0aGUgdG9rZW4KCQkJCQkJCQkvLyB0aGUgdG9rZW5VcmkgbWlnaHQgaGF2ZSBhIGRlcGVuZGVuY3kgb24gdGhlIGF1dGhvcml6YXRpb24gY29kZQoJCQkJCQkJCXRva2VuVXJpID0gdGhpcy5fX2NvbmZpZyhgb2F1dGguJHtmbG93fS51cmlgLCBudWxsLCB7CgkJCQkJCQkJCXRvb2w6IHQKCQkJCQkJCQl9KTsKCQkJCQkJCQlsZXQgdGNvbmZpZyA9IHsKCQkJCQkJCQkJdXJsOiB0b2tlblVyaSwKCQkJCQkJCQkJbWV0aG9kOiB0aGlzLl9fY29uZmlnKGBvYXV0aC4ke2Zsb3d9Lm1ldGhvZGAsICdwb3N0JywgewoJCQkJCQkJCQkJdG9vbDogdAoJCQkJCQkJCQl9KSwKCQkJCQkJCQkJaGVhZGVyczogT2JqZWN0LmFzc2lnbih7CgkJCQkJCQkJCQkiQ29udGVudC1UeXBlIjogdGhpcy5fX2NvbmZpZyhgb2F1dGguJHtmbG93fS5jb250ZW50X3R5cGVgLCAidGV4dC9qc29uIiwgewoJCQkJCQkJCQkJCXRvb2w6IHQKCQkJCQkJCQkJCX0pLAoJCQkJCQkJCQkJIkF1dGhvcml6YXRpb24iOiAiQmFzaWMgIiArIHRoaXMuX2J0b2EodGhpcy5fX2NvbmZpZygib2F1dGgubG9naW4iLCBudWxsLCB7CgkJCQkJCQkJCQkJdG9vbDogdAoJCQkJCQkJCQkJfSkgKyAiOiIgKyB0aGlzLl9fY29uZmlnKCJvYXV0aC5wYXNzd29yZCIsIG51bGwsIHsKCQkJCQkJCQkJCQl0b29sOiB0CgkJCQkJCQkJCQl9KSksCgkJCQkJCQkJCX0sIHRoaXMuX19jb25maWcoYG9hdXRoLiR7Zmxvd30uaGVhZGVyc2AsICJ7fSIsIHsKCQkJCQkJCQkJCXRvb2w6IHQKCQkJCQkJCQkJfSkpLAoJCQkJCQkJCQlkYXRhOiB0aGlzLl9fY29uZmlnKGBvYXV0aC4ke2Zsb3d9LmJvZHlgLCBudWxsLCB7CgkJCQkJCQkJCQl0b29sOiB0CgkJCQkJCQkJCX0pLAoJCQkJCQkJCX07CgkJCQkJCQkJbGV0IHRyZXMgPSBhd2FpdCB0LmF4aW9zKHRjb25maWcpOwoJCQkJCQkJCXRoaXMubG9nKHVuZGVmaW5lZCwgJ19sb2FkVG9vbHMnLCAnRW50aXR5T2JqZWN0JywgMCwgIlRva2VuIGZldGNoZWQiLCBmbG93LCB0Y29uZmlnLCB0cmVzLmRhdGEpOwoJCQkJCQkJCVsnYWNjZXNzX3Rva2VuJywgJ3Rva2VuX3R5cGUnLCAnZXhwaXJlc19pbicsICdyZWZyZXNoX3Rva2VuJ10uZm9yRWFjaCh0YSA9PiB0aGlzLl9fY29uZmlnKGBvYXV0aC4ke3RhfWAsIG51bGwsIHsKCQkJCQkJCQkJdG9vbDogdCwKCQkJCQkJCQkJbm9kZTogbG90dG8uX25vZGUsCgkJCQkJCQkJCW5ld1ZhbHVlOiB0cmVzLmRhdGFbdGhpcy5fX2NvbmZpZyhgb2F1dGgudG9rZW4ucmVzcG9uc2UuJHt0YX1gLCB0YSwgewoJCQkJCQkJCQkJdG9vbDogdAoJCQkJCQkJCQl9KV0KCQkJCQkJCQl9KSk7CgkJCQkJCQkJdG9rZW4gPSB0aGlzLl9fY29uZmlnKCJvYXV0aC5hY2Nlc3NfdG9rZW4iLCBudWxsLCB7CgkJCQkJCQkJCXRvb2w6IHQsCgkJCQkJCQkJCW5vZGU6IGxvdHRvLl9ub2RlCgkJCQkJCQkJfSk7CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQkJaWYgKHRva2VuKSBjb25maWcuaGVhZGVycy5BdXRob3JpemF0aW9uID0gdGhpcy5fX2NvbmZpZygib2F1dGgudG9rZW5fdHlwZSIsICJCZWFyZXIiLCB7CgkJCQkJCQl0b29sOiB0CgkJCQkJCX0pICsgIiAiICsgdG9rZW47CgkJCQkJfQoJCQkJfSBjYXRjaCAoZXgpIHsKCQkJCQl0aGlzLmxvZyh1bmRlZmluZWQsICdfbG9hZFRvb2xzJywgJ0VudGl0eU9iamVjdCcsIDIsICJheGlvcy5yZXF1ZXN0IiwgZXgpOwoJCQkJfQoJCQkJcmV0dXJuIGNvbmZpZzsKCQkJfSwgYXN5bmMgZXJyb3IgPT4ge30pOwoJCQl0LmF4aW9zLmludGVyY2VwdG9ycy5yZXNwb25zZS51c2UocmVzcG9uc2UgPT4gewoJCQkJcmV0dXJuIHJlc3BvbnNlOwoJCQl9LCBhc3luYyBlcnJvciA9PiB7CgkJCQl0aGlzLmxvZyh1bmRlZmluZWQsICdfbG9hZFRvb2xzJywgJ0VudGl0eU9iamVjdCcsIDAsICJheGlvcyByZXNwb25zZSBlcnJvciIsIGVycm9yKTsKCQkJCXRyeSB7CgkJCQkJY29uc3Qgb3JpZ2luYWxSZXF1ZXN0ID0gZXJyb3IuY29uZmlnOwoJCQkJCWlmICh0aGlzLl9fY29uZmlnKCJvYXV0aC5hY2Nlc3NfdG9rZW4iLCBudWxsLCB7CgkJCQkJCQl0b29sOiB0CgkJCQkJCX0pICYmIGVycm9yLnJlc3BvbnNlICYmIGVycm9yLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDAxICYmICFvcmlnaW5hbFJlcXVlc3QuX3JldHJ5ICYmIG9yaWdpbmFsUmVxdWVzdC5oZWFkZXJzLkF1dGhvcml6YXRpb24uaW5kZXhPZih0aGlzLl9fY29uZmlnKCJvYXV0aC5hY2Nlc3NfdG9rZW4iLCBudWxsLCB7CgkJCQkJCQl0b29sOiB0CgkJCQkJCX0pKSA+IDApIHsKCQkJCQkJb3JpZ2luYWxSZXF1ZXN0Ll9yZXRyeSA9IHRydWU7CgkJCQkJCS8vIGF3YWl0IChnZXQgdGhlIHRva2VuIG9yIHJlZnJlc2ggaXQpCgoJCQkJCQlvcmlnaW5hbFJlcXVlc3QuaGVhZGVycy5BdXRob3JpemF0aW9uID0gdGhpcy5fX2NvbmZpZygib2F1dGguYWNjZXNzX3R5cGUiLCAiQmVhcmVyIiwgewoJCQkJCQkJdG9vbDogdAoJCQkJCQl9KSArICIgIiArIHRoaXMuX19jb25maWcoIm9hdXRoLmFjY2Vzc190b2tlbiIsIG51bGwsIHsKCQkJCQkJCXRvb2w6IHQKCQkJCQkJfSk7CgkJCQkJCXJldHVybiB0LmF4aW9zKG9yaWdpbmFsUmVxdWVzdCk7CgkJCQkJfQoJCQkJCXJldHVybiBQcm9taXNlLnJlamVjdChlcnJvcik7CgkJCQl9IGNhdGNoIChleCkgewoJCQkJCXRoaXMubG9nKHVuZGVmaW5lZCwgJ19sb2FkVG9vbHMnLCAnRW50aXR5T2JqZWN0JywgMiwgIlJlc3AgSW50ZXJjZXB0b3IiLCBleCwgZXJyb3IpOwoJCQkJfQoJCQl9KTsKCQl9KTsKCgkJdGhpcy5sb2codW5kZWZpbmVkLCAnX2xvYWRUb29scycsICdFbnRpdHlPYmplY3QnLCAwLCAiRXhpdGluZyIpOwoJCXJldHVybiB0b29sczsKCgl9CgoJX3BhcmFtZXRyaXplKHN0ciwgZnVuLCBwcmVmaXggPSAne3snLCBwb3N0Zml4ID0gJ319JykgewoKCQl0cnkgewoJCQlpZiAodHlwZW9mKHN0cikgIT09ICdzdHJpbmcnKSByZXR1cm4gc3RyOwoJCQlsZXQgcmV4ID0gYCR7cHJlZml4fShbXiR7cG9zdGZpeH1dKykke3Bvc3RmaXh9YDsKCQkJKHN0ci5tYXRjaChuZXcgUmVnRXhwKHJleCwgImciKSkgfHwgW10pLmZvckVhY2gobSA9PiBzdHIgPSBzdHIucmVwbGFjZShtLCBtID0+IGZ1bihtLnJlcGxhY2UocHJlZml4LCAnJykucmVwbGFjZShwb3N0Zml4LCAnJykpKSk7CgoJCQlyZXR1cm4gc3RyOwoJCX0gY2F0Y2ggKGV4KSB7CgkJCXRoaXMubG9nKHVuZGVmaW5lZCwgJ19wYXJhbWV0cml6ZScsICdFbnRpdHlPYmplY3QnLCAyLCBleCk7CgkJfQoKCX0KCglfX3N5bmNfb24oZCkgewoJCXRoaXMuX19fc3luY19vbiA9IHRoaXMuX19fc3luY19vbiB8fCB7fTsKCgkJaWYgKGQpIHsKCQkJdGhpcy5fX19zeW5jX29uW3RoaXMuVG9vbC5uYW1lXSA9IGQ7CgoJCQlyZXR1cm4gdGhpczsKCQl9CgoJCXJldHVybiB0aGlzLl9fX3N5bmNfb25bdGhpcy5Ub29sLm5hbWVdOwoJfQoKCV9jbG9uZSgpIHsKCQlyZXR1cm4gbmV3IGxvdHRvLlVzZXIodGhpcy5JZCkKCgkJCS5hY3RpdmUodGhpcy5hY3RpdmUoKSwgdGhpcy5fYWN0aXZlX2Nvb3ApCgoJCQkuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSwgdGhpcy5fZW5hYmxlZF9jb29wKQoKCQkJLmNvZGUodGhpcy5jb2RlKCksIHRoaXMuX2NvZGVfY29vcCkKCgkJCS5vcmRlcih0aGlzLm9yZGVyKCksIHRoaXMuX29yZGVyX2Nvb3ApCgoJCQkuZGF0ZSh0aGlzLmRhdGUoKSwgdGhpcy5fZGF0ZV9jb29wKQoKCQkJLm5hbWUodGhpcy5uYW1lKCksIHRoaXMuX25hbWVfY29vcCkKCgkJCS5yZW1hcmsodGhpcy5yZW1hcmsoKSwgdGhpcy5fcmVtYXJrX2Nvb3ApCgoJCQkudXNlcm5hbWUodGhpcy51c2VybmFtZSgpLCB0aGlzLl91c2VybmFtZV9jb29wKQoKCQkJLnBhc3N3b3JkKHRoaXMucGFzc3dvcmQoKSwgdGhpcy5fcGFzc3dvcmRfY29vcCkKCgl9CgoJX21hcChjb2RlLCBiUmV2ZXJzZSwgY29udGV4dCwgb2JqRnJvbSwgb2JqVG8sIGNsYXNzTmFtZSwgdG9vbCwgY29kZVR5cGUpIHsKCQljb250ZXh0ID0gY29udGV4dCB8fCAnRW50aXR5QXR0cmlidXRlJzsKCQkvL29iakZyb20gPSBvYmpGcm9tIHx8IHRoaXMuX3RvRG9jdW1lbnQoKTsKCQkvL29ialRvID0gb2JqVG8gfHwge307CgkJY2xhc3NOYW1lID0gY2xhc3NOYW1lIHx8ICdVc2VyJzsKCQl0b29sID0gdG9vbCB8fCB0aGlzLlRvb2w7CgkJY29kZVR5cGUgPSBjb2RlVHlwZSB8fCBKU09OLnBhcnNlKCgodHlwZW9mKHRoaXMpICE9PSAidW5kZWZpbmVkIiAmJiB0eXBlb2YodGhpcy5fYXRvYikgIT09ICJ1bmRlZmluZWQiKSA/IHRoaXMuX2F0b2IgOiAodHlwZW9mKF9GckVNRCkgIT09ICJ1bmRlZmluZWQiID8gX0ZyRU1ELl9hdG9iIDogYXRvYikpKGBlMzA9YCksIChrZXksIHZhbHVlKSA9PiB7CgkJCWlmICh0eXBlb2YodmFsdWUpID09PSAic3RyaW5nIiAmJiB2YWx1ZS5pbmRleE9mKCI9PiIpID4gMCkgcmV0dXJuIGV2YWwoIigiICsgdmFsdWUgKyAiKSIpOwoJCQlyZXR1cm4gdmFsdWU7CgkJfSlbY29kZV07CgoJCXRyeSB7CgkJCWlmIChBcnJheS5pc0FycmF5KG9iakZyb20pKSByZXR1cm4gb2JqRnJvbS5tYXAobyA9PiB0aGlzLl9tYXAoY29kZSwgYlJldmVyc2UsIGNvbnRleHQsIG8sIG9ialRvLCBjbGFzc05hbWUsIHRvb2wsIGNvZGVUeXBlKSk7CgoJCQlsZXQgc0ZpZWxkID0gYlJldmVyc2UgPyAndGFyZ2V0JyA6ICdzb3VyY2UnOwoJCQlsZXQgc1NjcmlwdCA9IChiUmV2ZXJzZSA/ICdvdXQnIDogJ2luJykgKyAnU2NyaXB0JzsKCQkJbGV0IHNDb25kID0gKGJSZXZlcnNlID8gJ291dCcgOiAnaW4nKSArICdDb25kaXRpb24nOwoJCQlsZXQgdEZpZWxkID0gYlJldmVyc2UgPyAnc291cmNlJyA6ICd0YXJnZXQnOwoJCQlsZXQgdFNjcmlwdCA9IChiUmV2ZXJzZSA/ICdpbicgOiAnb3V0JykgKyAnU2NyaXB0JzsKCQkJbGV0IHRDb25kID0gKGJSZXZlcnNlID8gJ2luJyA6ICdvdXQnKSArICdDb25kaXRpb24nOwoKCQkJbGV0IF9tYXRjaCA9IChzLCByKSA9PiB7CgkJCQlsZXQgYW5zd2VyID0gcy5tYXRjaChuZXcgUmVnRXhwKHIsICdnJykpOwoJCQkJcmV0dXJuIHMgPT0gciB8fCAoKGFuc3dlciAmJiBhbnN3ZXIubGVuZ3RoKSA/IHRydWUgOiBmYWxzZSk7CgkJCX0KCgkJCWxldCB0ZXN0ID0gbSA9PiAoewoJCQkJdmFsaWQ6IG0uYWN0aXZlICYmIG0uZW5hYmxlZCwKCQkJCWNvbnRleHQ6IF9tYXRjaChjb250ZXh0LCBtLmNvbnRleHQpLAoJCQkJY2xhc3M6IF9tYXRjaChjbGFzc05hbWUsIG0uY2xhc3NOYW1lKSwKCQkJCXNGaWVsZDogdHlwZW9mKGNvZGUpID09PSAndW5kZWZpbmVkJyB8fCBfbWF0Y2goY29kZSwgbVtzRmllbGRdKSwKCQkJCXNTY3JpcHQ6IHR5cGVvZihjb2RlKSA9PT0gJ3VuZGVmaW5lZCcgfHwgdHlwZW9mKG1bc1NjcmlwdF0pICE9PSAndW5kZWZpbmVkJywKCQkJCXRhcmdldDogKG1bdEZpZWxkXSB8fCBtW3RTY3JpcHRdKSAhPSBudWxsLAoJCQkJdGV4dDogY29kZSArICcsJyArIHNGaWVsZCArICcsJyArIHRGaWVsZCwKCQkJfSk7CgoJCQlsZXQgbXMgPSAodG9vbC50b29sX01hcHBpbmdzIHx8IFtdKS5jb25jYXQodG9vbC50eXBlLnR5cGVfTWFwcGluZ3MgfHwgW10pOwoKCQkJbXMgPSBtcy5maWx0ZXIobSA9PiB0ZXN0KG0pLnZhbGlkICYmIHRlc3QobSkuY29udGV4dCAmJiB0ZXN0KG0pLmNsYXNzICYmICh0ZXN0KG0pLnNGaWVsZCB8fCB0ZXN0KG0pLnNTY3JpcHQpICYmIHRlc3QobSkudGFyZ2V0KS5zb3J0KG0gPT4gLW0ub3JkZXIpOwoJCQlpZiAobXMubGVuZ3RoKSB0aGlzLmxvZyh1bmRlZmluZWQsICdfbWFwJywgJ0VudGl0eU9iamVjdCcsIDAsIGAke2NsYXNzTmFtZX0uJHtjb2RlfWAsIHRoaXMuX2JlYXV0aWZ5KG1zLm1hcChtID0+ICh7CgkJCQltLAoJCQkJdGVzdDogdGVzdChtKQoJCQl9KSksICdqYXZhc2NyaXB0JykpOwoKCQkJbXMuZmlsdGVyKG0gPT4gbVtzRmllbGRdICYmIG1bdEZpZWxkXSkuZm9yRWFjaChtID0+IHsKCQkJCWlmIChtLmNvbnRleHQgPT0gJ0VudGl0eUNsYXNzJykge30gZWxzZSBpZiAodHlwZW9mKG1bdEZpZWxkXSkgPT09ICdmdW5jdGlvbicpIHsKCQkJCQkvLyByZXBsYWNlCgkJCQkJaWYgKHR5cGVvZihjb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHsKCQkJCQkJY29kZSA9IGNvZGUucmVwbGFjZShuZXcgUmVnRXhwKG1bc0ZpZWxkXSwgJ2cnKSwgbVt0RmllbGRdKTsKCQkJCQl9IGVsc2UgewoJCQkJCQkvL0RvdE9iamVjdC5jb3B5KG1bc0ZpZWxkXSwgbVt0RmllbGRdLCBvYmpGcm9tLCBvYmpUbyk7CgkJCQkJfQoJCQkJfSBlbHNlIHsKCQkJCQlpZiAodHlwZW9mKGNvZGUpICE9PSAndW5kZWZpbmVkJykgewoJCQkJCQljb2RlID0gbVt0RmllbGRdOwoJCQkJCX0gZWxzZSB7CgkJCQkJCURvdE9iamVjdC5jb3B5KG1bc0ZpZWxkXSwgbVt0RmllbGRdLCBvYmpGcm9tLCBvYmpUbyk7CgkJCQkJfQoJCQkJfQoJCQkJdGhpcy5sb2codW5kZWZpbmVkLCAnX21hcCcsICdFbnRpdHlPYmplY3QnLCAwLCBgWyR7Y29udGV4dH1dLyR7Y2xhc3NOYW1lfS4ke2NvZGV9OiAke21bc0ZpZWxkXX0gPT4gJHttW3RGaWVsZF19YCk7CgkJCX0pOwoJCQltcy5mb3JFYWNoKG0gPT4gewoKCQkJCWlmIChtW3RTY3JpcHRdKSB7CgkJCQkJdGhpcy5sb2codW5kZWZpbmVkLCAnX21hcCcsICdFbnRpdHlPYmplY3QnLCAwLCBgWyR7bS5jb250ZXh0fV0vJHttLmNsYXNzTmFtZX0uJHtjb2RlfSgke3RTY3JpcHR9KTogJHttW3RTY3JpcHRdfWAsIG0pOwoJCQkJCXRoaXMuX1NjcmlwdChgYXN5bmMgKGxvZywgd2FybiwgZXJyb3IsIHNjb3BlLCBtZXRob2QsIG0sIG9iakZyb20sIG9ialRvLCBjb2RlLCBfdGhpcywgY2xhc3NOYW1lLCB0b29sLCBjb2RlVHlwZSkgPT4ge2lmKAooKG9TY29wZSkgPT4gewogICAgbGV0IHJldCA9ICR7bVt0Q29uZF19OwogICAgaWYodHlwZW9mKHJldCk9PT0iZnVuY3Rpb24iKXsKICAgICAgICByZXQgPSByZXQob1Njb3BlKTsKICAgIH0KICAgIHJldHVybiByZXQ7Cn0pKGxvdHRvKQopeyR7bVt0U2NyaXB0XX19fWAsIHRTY3JpcHQsICdNYXBwaW5nJywgbG90dG8sIG0sIG9iakZyb20sIG9ialRvLCBjb2RlLCB0aGlzLCBjbGFzc05hbWUsIHRvb2wsIGNvZGVUeXBlKTsKCQkJCX0KCgkJCX0pOwoKCQkJaWYgKHR5cGVvZihjb2RlKSA9PT0gJ3VuZGVmaW5lZCcpIHsKCQkJCXJldHVybiBvYmpUbzsKCQkJfQoKCQkJcmV0dXJuIGNvZGU7CgkJfSBjYXRjaCAoZXgpIHsKCQkJdGhpcy5sb2codW5kZWZpbmVkLCAnX21hcCcsICdFbnRpdHlPYmplY3QnLCAyLCBleCk7CgkJfQoKCX0KCglfbkNvZGUoY29kZSwgb0NvZGUpIHsKCQl0cnkgewoJCQlsZXQgY29udGV4dCA9ICdFbnRpdHlBdHRyaWJ1dGUnOwoJCQlpZiAoIWNvZGUgJiYgIW9Db2RlKSB7CgkJCQljb250ZXh0ID0gJ0VudGl0eUNsYXNzJzsKCQkJCWNvZGUgPSAiVXNlciI7CgkJCQlpZiAodGhpcy5Ub29sLnR5cGUubmFtZSA9PSAiU2VydmljZU5vdyIgJiYgdGhpcy5fX2NvbmZpZygnc2NvcGUnKSkgewoJCQkJCWNvZGUgPSB0aGlzLl9fY29uZmlnKCdzY29wZScpICsgIl9zdF8iICsgY29kZTsKCQkJCX0KCQkJCW9Db2RlID0gdW5kZWZpbmVkOwoJCQl9CgkJCWxldCByZXQgPSBjb2RlOwoJCQlpZiAob0NvZGUgJiYgdHlwZW9mKG9Db2RlKSA9PT0gJ29iamVjdCcpIHsKCQkJCXJldCA9IG9Db2RlW3RoaXMuVG9vbC5uYW1lXSB8fCByZXQ7CgkJCX0KCgkJCXJldCA9IHRoaXMuX21hcChjb2RlLCBmYWxzZSwgY29udGV4dCkgfHwgcmV0OwoJCQlyZXR1cm4gcmV0OwoJCX0gY2F0Y2ggKGV4KSB7CgkJCXRoaXMubG9nKHVuZGVmaW5lZCwgJ19uQ29kZScsICdFbnRpdHlPYmplY3QnLCAxLCBleCk7CgkJCXJldHVybiBjb2RlOwoJCX0KCX0KCglfX2NvbmZpZyhuLCBudWxsVmFsdWUsIG9wdGlvbnMpIHsKCgkJdHJ5IHsKCQkJb3B0aW9ucyA9IG9wdGlvbnMgfHwge307CgkJCW9wdGlvbnMuX3RoaXMgPSBvcHRpb25zLl90aGlzIHx8IHRoaXM7CgkJCW9wdGlvbnMuX2NsYXNzID0gb3B0aW9ucy5fY2xhc3MgfHwgJ1VzZXInOwoJCQlvcHRpb25zLnRvb2wgPSBvcHRpb25zLnRvb2wgfHwgb3B0aW9ucy5fdGhpcy5Ub29sIHx8IHRoaXMuVG9vbDsKCQkJaWYgKHR5cGVvZihvcHRpb25zLnRvb2wpID09PSAnb2JqZWN0JyAmJiBvcHRpb25zLnRvb2wuY29uc3RydWN0b3IubmFtZSA9PSAnVG9vbCcpIG9wdGlvbnMudG9vbCA9IChsb3R0by5Ub29scyB8fCBbXSkuZmluZCh0ID0+IHQubmFtZSA9PSBvcHRpb25zLnRvb2wubmFtZSgpKTsKCgkJCWlmICh0eXBlb2Yob3B0aW9ucy50b29sKSA9PT0gJ3N0cmluZycpIG9wdGlvbnMudG9vbCA9IChsb3R0by5Ub29scyB8fCBbXSkuZmluZCh0ID0+IHQubmFtZSA9PSBvcHRpb25zLnRvb2wgfHwgdC50eXBlLm5hbWUgPT0gb3B0aW9ucy50b29sKTsKCQkJaWYgKHR5cGVvZihvcHRpb25zLnRvb2wpICE9PSAnb2JqZWN0JykgdGhpcy5sb2codW5kZWZpbmVkLCAnX19jb25maWcnLCAnRW50aXR5T2JqZWN0JywgMSwgb3B0aW9ucy50b29sKTsKCQkJaWYgKCFvcHRpb25zLnRvb2wpIHRoaXMubG9nKHVuZGVmaW5lZCwgJ19fY29uZmlnJywgJ0VudGl0eU9iamVjdCcsIDEsICJ0b29sIG5vdCBkZWZpbmVkIiwgb3B0aW9ucy5fdGhpcy5Ub29sLCBsb3R0by5Ub29scywgb3B0aW9ucy5fdGhpcy5Ub29scyk7CgkJCS8vb3B0aW9ucy5ub0NhY2hlID0gdHJ1ZTsKCQkJaWYgKCFvcHRpb25zLm5vQ2FjaGUpIGxvdHRvLl9fY29uZmlnID0gbG90dG8uX19jb25maWcgfHwge307CgoJCQlsZXQgbklEID0gbG90dG8uX25vZGUgPyBsb3R0by5fbm9kZS5jb2RlKCkgOiBudWxsOwoKCQkJaWYgKG4gIT09ICdub2RlLmNvZGUnKSB7CgkJCQluSUQgPSB0aGlzLl9fY29uZmlnKCdub2RlLmNvZGUnLCAnZGVmYXVsdCcsIG9wdGlvbnMpOwoJCQl9CgoJCQlsZXQgcmV0ID0gbnVsbFZhbHVlOwoJCQlpZiAodHlwZW9mKHJldCkgPT09ICd1bmRlZmluZWQnKSB7CgkJCQlyZXQgPSBudWxsOwoKCQkJCS8vIHVzZSBzY29wZSBjYWNoZSAoaW1wcm92ZXMgcGVyZm9ybWFuY2UpCgkJCQlpZiAoIW9wdGlvbnMubm9DYWNoZSAmJiBsb3R0by5fX2NvbmZpZy5oYXNPd25Qcm9wZXJ0eShgJHtvcHRpb25zLl9jbGFzc30uJHtvcHRpb25zLnRvb2wubmFtZX0uJHtuSUR9LiR7bn1gKSkgcmV0dXJuIGxvdHRvLl9fY29uZmlnW2Ake29wdGlvbnMuX2NsYXNzfS4ke29wdGlvbnMudG9vbC5uYW1lfS4ke25JRH0uJHtufWBdOwoJCQl9CgoJCQkvLyB0b29sX0NvbmZpZ3MsIHR5cGVfQ29uZmlnczogYWxsb3cgY2xhc3MtbGV2ZWwgYW5kIG5vZGUtbGV2ZWwgLSBkb25lCgkJCWlmIChvcHRpb25zLnRvb2wudHlwZS50eXBlX0NvbmZpZ3MgfHwgb3B0aW9ucy50b29sLnRvb2xfQ29uZmlncykgewoJCQkJbGV0IGNmcyA9IFtdLmNvbmNhdChvcHRpb25zLnRvb2wudHlwZS50eXBlX0NvbmZpZ3MsIG9wdGlvbnMudG9vbC50b29sX0NvbmZpZ3MpOwoJCQkJbGV0IHRjb25mID0gY2ZzLmZpbHRlcihjID0+IGMgJiYgYy5uYW1lID09IG4gJiYgYy5ub2RlICYmIGMubm9kZS5jb2RlID09IG5JRCkuY29uY2F0KGNmcy5maWx0ZXIoYyA9PiBjICYmIGMubmFtZSA9PSBuICYmICFjLm5vZGUpKTsKCQkJCWlmICh0Y29uZi5sZW5ndGgpIHsKCQkJCQlpZiAodGNvbmZbMF0uc2NyaXB0KSB7CgkJCQkJCXJldCA9IHRoaXMucnVuU2NyaXB0KGAoJHtPYmplY3Qua2V5cyhvcHRpb25zKS5qb2luKCcsICcpfSkgPT4gJHt0Y29uZlswXS5zY3JpcHR9YCkoLi4uT2JqZWN0LnZhbHVlcyhvcHRpb25zKSk7CgkJCQkJfSBlbHNlIHsKCQkJCQkJcmV0ID0gdGNvbmZbMF0udmFsdWU7CgkJCQkJCXRyeSB7CgkJCQkJCQlbMSwgMiwgM10uZm9yRWFjaChhID0+IHJldCA9IEpTT04ucGFyc2UocmV0KSk7CgkJCQkJCX0gY2F0Y2ggKGpleCkge30KCQkJCQl9CgkJCQl9CgkJCQlpZiAob3B0aW9ucy5uZXdWYWx1ZSkgewoJCQkJCWxldCB0YyA9IHRjb25mLmxlbmd0aCA/IHRjb25mWzBdIDoge307CgkJCQkJaWYgKG9wdGlvbnMubm9kZSkgdGMubm9kZSA9IHsKCQkJCQkJY29kZTogb3B0aW9ucy5ub2RlLmNvZGUoKQoJCQkJCX07CgkJCQkJdGMudmFsdWUgPSBvcHRpb25zLm5ld1ZhbHVlOwoJCQkJCXRjLm5hbWUgPSBuOwoJCQkJCWlmICghdGNvbmYubGVuZ3RoKSB7CgkJCQkJCShvcHRpb25zLnRvb2wudG9vbF9Db25maWdzIHx8IG9wdGlvbnMudG9vbC50eXBlLnR5cGVfQ29uZmlncykucHVzaCh0Yyk7CgkJCQkJfQoJCQkJCXJldCA9IG9wdGlvbnMubmV3VmFsdWU7CgkJCQl9CgkJCX0KCgkJCS8vIG1vZGVsIENvbmZpZzogQ29uZmlnIGlzIGNsYXNzIGxldmVsLCBub2RlIG5vdCBwb3NzaWJsZSAtIHBlbmRpbmcKCQkJbGV0IG1jb25mID0gb3B0aW9ucy5fdGhpcy5Db25maWcgPyBvcHRpb25zLl90aGlzLkNvbmZpZ1tuXSA6IHVuZGVmaW5lZDsKCQkJaWYgKHR5cGVvZihtY29uZikgIT09ICJ1bmRlZmluZWQiKSByZXQgPSBtY29uZjsKCgkJCS8vIGNvbW1hbmQgbGluZTogYWxsb3cgY2xhc3MtbGV2ZWwgYW5kIG5vZGUtbGV2ZWwgLSBwZW5kaW5nCgkJCWlmICh0eXBlb2YoZ2xvYmFsKSAhPT0gJ3VuZGVmaW5lZCcgJiYgZ2xvYmFsLm1pbmltaXN0KSB7CgkJCQlyZXQgPSBnbG9iYWwubWluaW1pc3QocHJvY2Vzcy5hcmd2LnNsaWNlKDIpKVtuXSB8fCByZXQ7CgkJCX0KCgkJCS8vIHJlcXVlc3Q6IGFsbG93IGNsYXNzLWxldmVsIGFuZCBub2RlLWxldmVsIC0gcGVuZGluZwoJCQlyZXQgPSB0aGlzLiRfUkVRVUVTVChuKSB8fCByZXQ7CgoJCQkvLyBjb25maWcgcmVwbGFjZW1lbnQKCQkJcmV0ID0gdGhpcy5fcGFyYW1ldHJpemUocmV0LCBwID0+IHRoaXMuX19jb25maWcocCwgbnVsbCwgb3B0aW9ucykpOwoKCQkJLy90aGlzLmxvZyh1bmRlZmluZWQsICdfX2NvbmZpZycsICdFbnRpdHlPYmplY3QnLCAwLCBuLCByZXQsIG9wdGlvbnMpOwoJCQlpZiAoIW9wdGlvbnMubm9DYWNoZSkgbG90dG8uX19jb25maWdbYCR7b3B0aW9ucy5fY2xhc3N9LiR7b3B0aW9ucy50b29sLm5hbWV9LiR7bklEfS4ke259YF0gPSByZXQ7CgkJCXJldHVybiByZXQ7CgkJfSBjYXRjaCAoZXgpIHsKCQkJdGhpcy5sb2codW5kZWZpbmVkLCAnX19jb25maWcnLCAnRW50aXR5T2JqZWN0JywgMSwgbiwgbnVsbFZhbHVlLCBvcHRpb25zLl9jbGFzcywgb3B0aW9ucy50b29sLnRvb2xfQ29uZmlncywgZXgpOwoJCX0KCgl9CgoJLyoqCgkgKiBTdW1tYXJ5LiBpbml0LgoJICoKCSAqIERlc2NyaXB0aW9uLiAuCgkgKgoJICogQHNpbmNlICAgICAgeC54LngKCSAqIEBkZXByZWNhdGVkIHgueC54IFVzZSBuZXdfZnVuY3Rpb25fbmFtZSgpIGluc3RlYWQuCgkgKiBAYWNjZXNzICAgICBwdWJsaWMKCSAqCgkgKiBAY2xhc3MKCSAqIEBhdWdtZW50cyBwYXJlbnQKCSAqIEBtaXhlcyAgICBtaXhpbgoJICoKCSAqIEBhbGlhcyAgICByZWFsTmFtZQoJICogQG1lbWJlcm9mIG5hbWVzcGFjZQoJICoKCSAqIEBzZWUgIEZ1bmN0aW9uL2NsYXNzIHJlbGllZCBvbgoJICogQGxpbmsgVVJMCgkgKiBAZ2xvYmFsCgkgKgoJICogQGZpcmVzICAgZXZlbnROYW1lCgkgKiBAZmlyZXMgICBjbGFzc05hbWUjZXZlbnROYW1lCgkgKiBAbGlzdGVucyBldmVudDpldmVudE5hbWUKCSAqIEBsaXN0ZW5zIGNsYXNzTmFtZX5ldmVudDpldmVudE5hbWUKCSAqIEBwYXJhbSB7dHlwZX0gICB2YXIgICAgICAgICAgIERlc2NyaXB0aW9uLgoJICogQHBhcmFtIHt0eXBlfSAgIFt2YXJdICAgICAgICAgRGVzY3JpcHRpb24gb2Ygb3B0aW9uYWwgdmFyaWFibGUuCgkgKiBAcGFyYW0ge3R5cGV9ICAgW3Zhcj1kZWZhdWx0XSBEZXNjcmlwdGlvbiBvZiBvcHRpb25hbCB2YXJpYWJsZSB3aXRoIGRlZmF1bHQgdmFyaWFibGUuCgkgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0VmFyICAgICBEZXNjcmlwdGlvbi4KCSAqIEBwYXJhbSB7dHlwZX0gICBvYmplY3RWYXIua2V5IERlc2NyaXB0aW9uIG9mIGEga2V5IGluIHRoZSBvYmplY3RWYXIgcGFyYW1ldGVyLgoJICoKCSAqIEB5aWVsZCB7dHlwZX0gWWllbGRlZCB2YWx1ZSBkZXNjcmlwdGlvbi4KCSAqCgkgKiBAcmV0dXJuIHt0eXBlfSBSZXR1cm4gdmFsdWUgZGVzY3JpcHRpb24uCgkgKi8KCWFzeW5jIGluaXQoKSB7CgoJCWxldCBhbnN3ZXIgPSBudWxsOwoKCQlsZXQgcmVzdWx0cyA9IGF3YWl0IHRoaXMuX2V4ZWN1dGUobG90dG8sICJpbml0IiwgYXN5bmMgKGxvZywgd2FybiwgZXJyb3IsIG9TY29wZSwgbWV0aG9kID0gImluaXQiLCBfbm9kZSwgKSA9PiB7CgkJCXJldHVybiBvU2NvcGUuX25vZGUuX3NhbWVOb2RlKF9ub2RlKQoJCX0sIGFzeW5jIChsb2csIHdhcm4sIGVycm9yLCBvU2NvcGUsIG1ldGhvZCA9ICJpbml0IiwgKSA9PiB7CgoJCQkvL3RoaXMuX190aW1lKCdsb3R0by5Vc2VyLmluaXQnKTsKCgkJCXZhciBlcnJvcnMgPSB7CgoJCQkJIjAxIjogKCgpID0+IHsKCgkJCQkJbGV0IGFuc3dlciA9CgoJCQkJCQl0eXBlb2Yod2luZG93KSA9PT0gJ3VuZGVmaW5lZCcKCQkJCQkvLyB0aGlzLmxvZyh1bmRlZmluZWQsICdpbml0JywgJ0VudGl0eU9iamVjdCcsIDAsICJhbnN3ZXIiLCAiMDEiLCBhbnN3ZXIpOwoJCQkJCXJldHVybiBhbnN3ZXI7CgkJCQl9KSgpID8gKCdOb3QgcnVubmluZyBpbiBhIGJyb3dzZXInIHx8ICdWYWxpZGF0aW9uIEVycm9yJykgOiAnJywKCgkJCX07CgkJCU9iamVjdC5rZXlzKGVycm9ycykuZmlsdGVyKGsgPT4gIWVycm9yc1trXSkuZm9yRWFjaChrID0+IGRlbGV0ZSBlcnJvcnNba10pOwoJCQlpZiAoT2JqZWN0LmtleXMoZXJyb3JzKS5sZW5ndGgpIHsKCQkJCU9iamVjdC5rZXlzKGVycm9ycykuZmlsdGVyKGsgPT4gay5zdGFydHNXaXRoKCctJykpLmZvckVhY2goayA9PiB7CgkJCQkJdGhpcy5sb2codW5kZWZpbmVkLCAnaW5pdCcsICdFbnRpdHlPYmplY3QnLCAwLCB7CgkJCQkJCVtrXTogZXJyb3JzW2tdCgkJCQkJfSk7CgkJCQkJZGVsZXRlIGVycm9yc1trXTsKCQkJCX0pOwoJCQkJaWYgKE9iamVjdC52YWx1ZXMoZXJyb3JzKS5sZW5ndGgpIHsKCQkJCQlyZXR1cm4gewoJCQkJCQlfX2V4Y2VwdGlvbjogZXJyb3JzLAoJCQkJCX07CgkJCQl9CgkJCQlyZXR1cm47CgkJCX0KCgkJCWxvZyhhd2FpdCB0aGlzLmF1dGhvcml6ZSgpKQoKCQl9LCB7CgkJCV9fYmVmb3JlUnVsZXM6IFtdLAoJCQlfX2FmdGVyUnVsZXM6IFtdLAoJCX0pOwoKCQkvLyB0YWtlIG91dCB0aGUgaW52YWxpZCBub2RlIHJlc3VsdHMKCQlyZXN1bHRzID0gcmVzdWx0cy5maWx0ZXIociA9PiByICYmIHIucmV0KTsKCgkJLy8gaGFzIGFueSBub2RlIGdlbmVyYXRlZCBhIHZhbGlkYXRpb24gZXhjZXB0aW9uPwoJCWxldCBfX2V4ID0gcmVzdWx0cy5maW5kKHIgPT4gci5yZXQuX19leGNlcHRpb24pOwoJCWlmIChfX2V4KSByZXR1cm4gX19leC5yZXQ7CgoJCXJldHVybiByZXN1bHRzLmxlbmd0aCA/IHJlc3VsdHNbMF0ucmV0IDogbnVsbDsKCgl9CgoJLyoqCgkgKiBTdW1tYXJ5LiBhdXRob3JpemUuCgkgKgoJICogRGVzY3JpcHRpb24uIC4KCSAqCgkgKiBAc2luY2UgICAgICB4LngueAoJICogQGRlcHJlY2F0ZWQgeC54LnggVXNlIG5ld19mdW5jdGlvbl9uYW1lKCkgaW5zdGVhZC4KCSAqIEBhY2Nlc3MgICAgIHB1YmxpYwoJICoKCSAqIEBjbGFzcwoJICogQGF1Z21lbnRzIHBhcmVudAoJICogQG1peGVzICAgIG1peGluCgkgKgoJICogQGFsaWFzICAgIHJlYWxOYW1lCgkgKiBAbWVtYmVyb2YgbmFtZXNwYWNlCgkgKgoJICogQHNlZSAgRnVuY3Rpb24vY2xhc3MgcmVsaWVkIG9uCgkgKiBAbGluayBVUkwKCSAqIEBnbG9iYWwKCSAqCgkgKiBAZmlyZXMgICBldmVudE5hbWUKCSAqIEBmaXJlcyAgIGNsYXNzTmFtZSNldmVudE5hbWUKCSAqIEBsaXN0ZW5zIGV2ZW50OmV2ZW50TmFtZQoJICogQGxpc3RlbnMgY2xhc3NOYW1lfmV2ZW50OmV2ZW50TmFtZQoJICogQHBhcmFtIHt0eXBlfSAgIHZhciAgICAgICAgICAgRGVzY3JpcHRpb24uCgkgKiBAcGFyYW0ge3R5cGV9ICAgW3Zhcl0gICAgICAgICBEZXNjcmlwdGlvbiBvZiBvcHRpb25hbCB2YXJpYWJsZS4KCSAqIEBwYXJhbSB7dHlwZX0gICBbdmFyPWRlZmF1bHRdIERlc2NyaXB0aW9uIG9mIG9wdGlvbmFsIHZhcmlhYmxlIHdpdGggZGVmYXVsdCB2YXJpYWJsZS4KCSAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3RWYXIgICAgIERlc2NyaXB0aW9uLgoJICogQHBhcmFtIHt0eXBlfSAgIG9iamVjdFZhci5rZXkgRGVzY3JpcHRpb24gb2YgYSBrZXkgaW4gdGhlIG9iamVjdFZhciBwYXJhbWV0ZXIuCgkgKgoJICogQHlpZWxkIHt0eXBlfSBZaWVsZGVkIHZhbHVlIGRlc2NyaXB0aW9uLgoJICoKCSAqIEByZXR1cm4ge3R5cGV9IFJldHVybiB2YWx1ZSBkZXNjcmlwdGlvbi4KCSAqLwoJYXN5bmMgYXV0aG9yaXplKCkgewoKCQlsZXQgYW5zd2VyID0gbnVsbDsKCgkJbGV0IHJlc3VsdHMgPSBhd2FpdCB0aGlzLl9leGVjdXRlKGxvdHRvLCAiYXV0aG9yaXplIiwgYXN5bmMgKGxvZywgd2FybiwgZXJyb3IsIG9TY29wZSwgbWV0aG9kID0gImF1dGhvcml6ZSIsIF9ub2RlLCApID0+IHsKCQkJcmV0dXJuIF9ub2RlLl9zYW1lTm9kZShvU2NvcGUuX25vZGUuX3BhcmVudCkKCQl9LCBhc3luYyAobG9nLCB3YXJuLCBlcnJvciwgb1Njb3BlLCBtZXRob2QgPSAiYXV0aG9yaXplIiwgKSA9PiB7CgoJCQkvL3RoaXMuX190aW1lKCdsb3R0by5Vc2VyLmF1dGhvcml6ZScpOwoKCQkJdmFyIGVycm9ycyA9IHsKCgkJCX07CgkJCU9iamVjdC5rZXlzKGVycm9ycykuZmlsdGVyKGsgPT4gIWVycm9yc1trXSkuZm9yRWFjaChrID0+IGRlbGV0ZSBlcnJvcnNba10pOwoJCQlpZiAoT2JqZWN0LmtleXMoZXJyb3JzKS5sZW5ndGgpIHsKCQkJCU9iamVjdC5rZXlzKGVycm9ycykuZmlsdGVyKGsgPT4gay5zdGFydHNXaXRoKCctJykpLmZvckVhY2goayA9PiB7CgkJCQkJdGhpcy5sb2codW5kZWZpbmVkLCAnYXV0aG9yaXplJywgJ0VudGl0eU9iamVjdCcsIDAsIHsKCQkJCQkJW2tdOiBlcnJvcnNba10KCQkJCQl9KTsKCQkJCQlkZWxldGUgZXJyb3JzW2tdOwoJCQkJfSk7CgkJCQlpZiAoT2JqZWN0LnZhbHVlcyhlcnJvcnMpLmxlbmd0aCkgewoJCQkJCXJldHVybiB7CgkJCQkJCV9fZXhjZXB0aW9uOiBlcnJvcnMsCgkJCQkJfTsKCQkJCX0KCQkJCXJldHVybjsKCQkJfQoKCQkJcmV0dXJuIGF3YWl0IHRoaXMuX2F1dGhvcml6ZSh0aGlzLnVzZXJuYW1lKCksIHRoaXMucGFzc3dvcmQoKSwgdHJ1ZSk7CgoJCX0sIHsKCQkJX19iZWZvcmVSdWxlczogW10sCgkJCV9fYWZ0ZXJSdWxlczogW10sCgkJfSk7CgoJCS8vIHRha2Ugb3V0IHRoZSBpbnZhbGlkIG5vZGUgcmVzdWx0cwoJCXJlc3VsdHMgPSByZXN1bHRzLmZpbHRlcihyID0+IHIgJiYgci5yZXQpOwoKCQkvLyBoYXMgYW55IG5vZGUgZ2VuZXJhdGVkIGEgdmFsaWRhdGlvbiBleGNlcHRpb24/CgkJbGV0IF9fZXggPSByZXN1bHRzLmZpbmQociA9PiByLnJldC5fX2V4Y2VwdGlvbik7CgkJaWYgKF9fZXgpIHJldHVybiBfX2V4LnJldDsKCgkJcmV0dXJuIHJlc3VsdHMubGVuZ3RoID8gcmVzdWx0c1swXS5yZXQgOiBudWxsOwoKCX0KCglfdG9TUUxUYWJsZSgpIHsKCQlsZXQgcmV0ID0gewoJCQlzcWw6IGBDUkVBVEUgVEFCTEUgSUYgTk9UIEVYSVNUUyAke3RoaXMuX1EoKX0ke3RoaXMuX25Db2RlKCl9JHt0aGlzLl9RKCl9ICgKICAgICAgICAke3RoaXMuX1EoKX0ke3RoaXMuX19jb25maWcoJ2lkRmllbGQnLCAnX19pZCcpfSR7dGhpcy5fUSgpfSBDSEFSKDI1KSBQUklNQVJZIEtFWQogICAgCiAgICAgICAgLCR7dGhpcy5fUSgpfSR7dGhpcy5fbkNvZGUoJ2FjdGl2ZScsIHVuZGVmaW5lZCl9JHt0aGlzLl9RKCl9ICR7dGhpcy5fc3FsVHlwZSgiQm9vbCIsIHRoaXMuX19jb25maWcoJ3R5cGUnKSl9CiAgICAKICAgICAgICAsJHt0aGlzLl9RKCl9JHt0aGlzLl9uQ29kZSgnZW5hYmxlZCcsIHVuZGVmaW5lZCl9JHt0aGlzLl9RKCl9ICR7dGhpcy5fc3FsVHlwZSgiQm9vbCIsIHRoaXMuX19jb25maWcoJ3R5cGUnKSl9CiAgICAKICAgICAgICAsJHt0aGlzLl9RKCl9JHt0aGlzLl9uQ29kZSgnY29kZScsIHVuZGVmaW5lZCl9JHt0aGlzLl9RKCl9ICR7dGhpcy5fc3FsVHlwZSgiU3RyaW5nIiwgdGhpcy5fX2NvbmZpZygndHlwZScpKX0KICAgIAogICAgICAgICwke3RoaXMuX1EoKX0ke3RoaXMuX25Db2RlKCdvcmRlcicsIHVuZGVmaW5lZCl9JHt0aGlzLl9RKCl9ICR7dGhpcy5fc3FsVHlwZSgiSW50IiwgdGhpcy5fX2NvbmZpZygndHlwZScpKX0KICAgIAogICAgICAgICwke3RoaXMuX1EoKX0ke3RoaXMuX25Db2RlKCdkYXRlJywgdW5kZWZpbmVkKX0ke3RoaXMuX1EoKX0gJHt0aGlzLl9zcWxUeXBlKCJEYXRlIiwgdGhpcy5fX2NvbmZpZygndHlwZScpKX0KICAgIAogICAgICAgICwke3RoaXMuX1EoKX0ke3RoaXMuX25Db2RlKCduYW1lJywgdW5kZWZpbmVkKX0ke3RoaXMuX1EoKX0gJHt0aGlzLl9zcWxUeXBlKCJTdHJpbmciLCB0aGlzLl9fY29uZmlnKCd0eXBlJykpfQogICAgCiAgICAgICAgLCR7dGhpcy5fUSgpfSR7dGhpcy5fbkNvZGUoJ3JlbWFyaycsIHVuZGVmaW5lZCl9JHt0aGlzLl9RKCl9ICR7dGhpcy5fc3FsVHlwZSgiVGV4dCIsIHRoaXMuX19jb25maWcoJ3R5cGUnKSl9CiAgICAKICAgICAgICAsJHt0aGlzLl9RKCl9JHt0aGlzLl9uQ29kZSgndXNlcm5hbWUnLCB1bmRlZmluZWQpfSR7dGhpcy5fUSgpfSAke3RoaXMuX3NxbFR5cGUoIlN0cmluZyIsIHRoaXMuX19jb25maWcoJ3R5cGUnKSl9CiAgICAKICAgICAgICAsJHt0aGlzLl9RKCl9JHt0aGlzLl9uQ29kZSgncGFzc3dvcmQnLCB1bmRlZmluZWQpfSR7dGhpcy5fUSgpfSAke3RoaXMuX3NxbFR5cGUoIlN0cmluZyIsIHRoaXMuX19jb25maWcoJ3R5cGUnKSl9CiAgICAKICAgICAgICBgCgkJfTsKCQlyZXQuc3FsICs9ICcvKlVzZXIqLyk7XG4nOwoKCQlyZXQgPSB0aGlzLl9fZXhwb3J0KHJldCwgewoJCQlGdWxsOiB0cnVlLAoJCQlOdWxsOiB0cnVlLAoJCQkvL0lkOiAob2JqLCB2KSA9PiBvYmouc3FsICs9IGAke3RoaXMuX1EoKX0ke3RoaXMuX19jb25maWcoJ2lkRmllbGQnLCAnX19pZCcpfSR7dGhpcy5fUSgpfSBDSEFSKDI1KSBQUklNQVJZIEtFWWAsCgoJCQkiYWN0aXZlIjogKG9iaiwgdiwgZWFDb2RlID0gdGhpcy5fbkNvZGUoJ2FjdGl2ZScsIHVuZGVmaW5lZCkpID0+IHsKCQkJCS8vIG9iai5zcWwgKz0gYCwke3RoaXMuX1EoKX0ke3RoaXMuX25Db2RlKCdhY3RpdmUnLCB1bmRlZmluZWQpfSR7dGhpcy5fUSgpfSAke3RoaXMuX3NxbFR5cGUoIkJvb2wiLCB0aGlzLl9fY29uZmlnKCd0eXBlJykpfWA7CgoJCQl9LAoKCQkJImVuYWJsZWQiOiAob2JqLCB2LCBlYUNvZGUgPSB0aGlzLl9uQ29kZSgnZW5hYmxlZCcsIHVuZGVmaW5lZCkpID0+IHsKCQkJCS8vIG9iai5zcWwgKz0gYCwke3RoaXMuX1EoKX0ke3RoaXMuX25Db2RlKCdlbmFibGVkJywgdW5kZWZpbmVkKX0ke3RoaXMuX1EoKX0gJHt0aGlzLl9zcWxUeXBlKCJCb29sIiwgdGhpcy5fX2NvbmZpZygndHlwZScpKX1gOwoKCQkJfSwKCgkJCSJjb2RlIjogKG9iaiwgdiwgZWFDb2RlID0gdGhpcy5fbkNvZGUoJ2NvZGUnLCB1bmRlZmluZWQpKSA9PiB7CgkJCQkvLyBvYmouc3FsICs9IGAsJHt0aGlzLl9RKCl9JHt0aGlzLl9uQ29kZSgnY29kZScsIHVuZGVmaW5lZCl9JHt0aGlzLl9RKCl9ICR7dGhpcy5fc3FsVHlwZSgiU3RyaW5nIiwgdGhpcy5fX2NvbmZpZygndHlwZScpKX1gOwoKCQkJfSwKCgkJCSJvcmRlciI6IChvYmosIHYsIGVhQ29kZSA9IHRoaXMuX25Db2RlKCdvcmRlcicsIHVuZGVmaW5lZCkpID0+IHsKCQkJCS8vIG9iai5zcWwgKz0gYCwke3RoaXMuX1EoKX0ke3RoaXMuX25Db2RlKCdvcmRlcicsIHVuZGVmaW5lZCl9JHt0aGlzLl9RKCl9ICR7dGhpcy5fc3FsVHlwZSgiSW50IiwgdGhpcy5fX2NvbmZpZygndHlwZScpKX1gOwoKCQkJfSwKCgkJCSJkYXRlIjogKG9iaiwgdiwgZWFDb2RlID0gdGhpcy5fbkNvZGUoJ2RhdGUnLCB1bmRlZmluZWQpKSA9PiB7CgkJCQkvLyBvYmouc3FsICs9IGAsJHt0aGlzLl9RKCl9JHt0aGlzLl9uQ29kZSgnZGF0ZScsIHVuZGVmaW5lZCl9JHt0aGlzLl9RKCl9ICR7dGhpcy5fc3FsVHlwZSgiRGF0ZSIsIHRoaXMuX19jb25maWcoJ3R5cGUnKSl9YDsKCgkJCX0sCgoJCQkibmFtZSI6IChvYmosIHYsIGVhQ29kZSA9IHRoaXMuX25Db2RlKCduYW1lJywgdW5kZWZpbmVkKSkgPT4gewoJCQkJLy8gb2JqLnNxbCArPSBgLCR7dGhpcy5fUSgpfSR7dGhpcy5fbkNvZGUoJ25hbWUnLCB1bmRlZmluZWQpfSR7dGhpcy5fUSgpfSAke3RoaXMuX3NxbFR5cGUoIlN0cmluZyIsIHRoaXMuX19jb25maWcoJ3R5cGUnKSl9YDsKCgkJCX0sCgoJCQkicmVtYXJrIjogKG9iaiwgdiwgZWFDb2RlID0gdGhpcy5fbkNvZGUoJ3JlbWFyaycsIHVuZGVmaW5lZCkpID0+IHsKCQkJCS8vIG9iai5zcWwgKz0gYCwke3RoaXMuX1EoKX0ke3RoaXMuX25Db2RlKCdyZW1hcmsnLCB1bmRlZmluZWQpfSR7dGhpcy5fUSgpfSAke3RoaXMuX3NxbFR5cGUoIlRleHQiLCB0aGlzLl9fY29uZmlnKCd0eXBlJykpfWA7CgoJCQl9LAoKCQkJInVzZXJuYW1lIjogKG9iaiwgdiwgZWFDb2RlID0gdGhpcy5fbkNvZGUoJ3VzZXJuYW1lJywgdW5kZWZpbmVkKSkgPT4gewoJCQkJLy8gb2JqLnNxbCArPSBgLCR7dGhpcy5fUSgpfSR7dGhpcy5fbkNvZGUoJ3VzZXJuYW1lJywgdW5kZWZpbmVkKX0ke3RoaXMuX1EoKX0gJHt0aGlzLl9zcWxUeXBlKCJTdHJpbmciLCB0aGlzLl9fY29uZmlnKCd0eXBlJykpfWA7CgoJCQl9LAoKCQkJInBhc3N3b3JkIjogKG9iaiwgdiwgZWFDb2RlID0gdGhpcy5fbkNvZGUoJ3Bhc3N3b3JkJywgdW5kZWZpbmVkKSkgPT4gewoJCQkJLy8gb2JqLnNxbCArPSBgLCR7dGhpcy5fUSgpfSR7dGhpcy5fbkNvZGUoJ3Bhc3N3b3JkJywgdW5kZWZpbmVkKX0ke3RoaXMuX1EoKX0gJHt0aGlzLl9zcWxUeXBlKCJTdHJpbmciLCB0aGlzLl9fY29uZmlnKCd0eXBlJykpfWA7CgoJCQl9LAoKCQl9LCAiX3RvU1FMVGFibGUiKTsKCgkJLy8gcmV0LnNxbCArPSAnLypVc2VyKi8pO1xuJzsKCgkJcmV0LnNxbCA9IHR5cGVvZihzcWxGb3JtYXR0ZXIpICE9PSAndW5kZWZpbmVkJyA/IHNxbEZvcm1hdHRlci5mb3JtYXQocmV0LnNxbCkgOiByZXQuc3FsOwoKCQl0aGlzLmxvZyh1bmRlZmluZWQsICdfdG9TUUxUYWJsZScsICdFbnRpdHlPYmplY3QnLCAwLCByZXQuc3FsKTsKCQlyZXR1cm4gcmV0LnNxbDsKCX0KCglfZnJvbVNRTFRhYmxlKHRhYmxlLCBmaWVsZHMpIHsKCQkvLyB0YWJsZSBpcyBhIGpzb24gYXJyYXkKCgkJaWYgKChmaWVsZHMgJiYgZmllbGRzLmluZGV4T2YoImFjdGl2ZSIpKSB8fCAhZmllbGRzKSB7CgkJCXRoaXMuYWN0aXZlKHRhYmxlWyJhY3RpdmUiXSk7CgkJfQoKCQlpZiAoKGZpZWxkcyAmJiBmaWVsZHMuaW5kZXhPZigiZW5hYmxlZCIpKSB8fCAhZmllbGRzKSB7CgkJCXRoaXMuZW5hYmxlZCh0YWJsZVsiZW5hYmxlZCJdKTsKCQl9CgoJCWlmICgoZmllbGRzICYmIGZpZWxkcy5pbmRleE9mKCJjb2RlIikpIHx8ICFmaWVsZHMpIHsKCQkJdGhpcy5jb2RlKHRhYmxlWyJjb2RlIl0pOwoJCX0KCgkJaWYgKChmaWVsZHMgJiYgZmllbGRzLmluZGV4T2YoIm9yZGVyIikpIHx8ICFmaWVsZHMpIHsKCQkJdGhpcy5vcmRlcih0YWJsZVsib3JkZXIiXSk7CgkJfQoKCQlpZiAoKGZpZWxkcyAmJiBmaWVsZHMuaW5kZXhPZigiZGF0ZSIpKSB8fCAhZmllbGRzKSB7CgkJCXRoaXMuZGF0ZSh0YWJsZVsiZGF0ZSJdKTsKCQl9CgoJCWlmICgoZmllbGRzICYmIGZpZWxkcy5pbmRleE9mKCJuYW1lIikpIHx8ICFmaWVsZHMpIHsKCQkJdGhpcy5uYW1lKHRhYmxlWyJuYW1lIl0pOwoJCX0KCgkJaWYgKChmaWVsZHMgJiYgZmllbGRzLmluZGV4T2YoInJlbWFyayIpKSB8fCAhZmllbGRzKSB7CgkJCXRoaXMucmVtYXJrKHRhYmxlWyJyZW1hcmsiXSk7CgkJfQoKCQlpZiAoKGZpZWxkcyAmJiBmaWVsZHMuaW5kZXhPZigidXNlcm5hbWUiKSkgfHwgIWZpZWxkcykgewoJCQl0aGlzLnVzZXJuYW1lKHRhYmxlWyJ1c2VybmFtZSJdKTsKCQl9CgoJCWlmICgoZmllbGRzICYmIGZpZWxkcy5pbmRleE9mKCJwYXNzd29yZCIpKSB8fCAhZmllbGRzKSB7CgkJCXRoaXMucGFzc3dvcmQodGFibGVbInBhc3N3b3JkIl0pOwoJCX0KCgkJcmV0dXJuIHRoaXM7Cgl9CgoJYXN5bmMgX3NxbChzcWwsIHNvdXJjZSA9IHRoaXMpIHsKCgkJaWYgKCF0aGlzLlRvb2wuZGIgfHwgIXNxbCB8fCAhc3FsLnRyaW0oKSkgewoJCQlpZiAoIXRoaXMuVG9vbC5kYikgdGhpcy5sb2codW5kZWZpbmVkLCAnX3NxbCcsICdFbnRpdHlPYmplY3QnLCAwLCBzcWwsICIgPD09U0tJUFBFRD09PiIpOwoJCQlyZXR1cm4gW107CgkJfQoKCQlpZiAoc3FsLmluZGV4T2YoJztcbicpID4gMCkgewoJCQlmb3IgYXdhaXQgKGNvbnN0IHNxbFMgb2Ygc3FsLnNwbGl0KCc7XG4nKSkgewoJCQkJYXdhaXQgdGhpcy5fc3FsKHNxbFMudHJpbSgpKTsKCQkJfQoJCQlyZXR1cm47CgkJfQoKCQlsZXQgcmV0ID0gbnVsbDsKCgkJdHJ5IHsKCQkJcmV0ID0gYXdhaXQgbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gewoJCQkJbGV0IF9yZXNvbHZlID0gKF9yZXQsIF9zcWwpID0+IHsKCQkJCQlpZiAoX3NxbCAmJiBfc3FsLmluZGV4T2YoJ3NlbGVjdCcpKSB0aGlzLlRvb2wuX19kbWxTdGF0ZW1lbnRzLnB1c2goX3NxbCk7CgkJCQkJcmV0dXJuIHJlc29sdmUoX3JldCk7CgkJCQl9CgoJCQkJbGV0IGRiID0gdGhpcy5Ub29sLmRiOwoJCQkJbGV0IHR5cGUgPSB0aGlzLl9fY29uZmlnKCd0eXBlJyk7CgoJCQkJbGV0IGZ1biA9ICIiOwoKCQkJCS8vIFF1ZXJ5IGxpc3Qgb2Ygc3RhdGVtZW50IHN0YXJ0aW5nIGtleXdvcmRzICAgICAgICAKCQkJCWxldCBxTGlzdCA9IFsic2VsZWN0IiwgImluc2VydCIsICJ1cGRhdGUiLCAiZGVsZXRlIl07CgkJCQlpZiAodGhpcy5fX2NvbmZpZygnZGF0YWJhc2UudHJhbnNhY3Rpb25zJywgdHJ1ZSkpIHsKCQkJCQlxTGlzdCA9IHFMaXN0LmNvbmNhdChbImJlZ2luIiwgInN0YXJ0IiwgImNvbW1pdCJdKTsKCQkJCX0KCQkJCWxldCBiUXVlcnkgPSBxTGlzdC5pbmRleE9mKHNxbC5zdWJzdHJpbmcoMCwgc3FsLmluZGV4T2YoJyAnKSkudHJpbSgpLnRvTG93ZXJDYXNlKCkpID49IDA7CgoJCQkJaWYgKGJRdWVyeSkgewoJCQkJCS8vIHF1ZXJ5CgkJCQkJaWYgKFsnbXlzcWwnLCAncGcnXS5pbmRleE9mKHR5cGUpID49IDApIGZ1biA9ICdxdWVyeSc7CgkJCQkJaWYgKHR5cGUgPT0gJ3NxbGl0ZScpIGZ1biA9ICdhbGwnOwoJCQkJfSBlbHNlIHsKCQkJCQkvLyBETUwKCQkJCQlpZiAoWydteXNxbCcsICdwZyddLmluZGV4T2YodHlwZSkgPj0gMCkgZnVuID0gJ3F1ZXJ5JzsKCQkJCQlpZiAodHlwZSA9PSAnc3FsaXRlJykgZnVuID0gJ3J1bic7CgoJCQkJCXRoaXMuVG9vbC5kbWxDYWNoZSA9IHRoaXMuVG9vbC5kbWxDYWNoZSB8fCB7fTsKCQkJCQlpZiAodGhpcy5Ub29sLmRtbENhY2hlW3RoaXMuaGFzaENvZGUoc3FsKV0pIHJldHVybiBfcmVzb2x2ZSgwKTsKCQkJCQl0aGlzLlRvb2wuZG1sQ2FjaGVbdGhpcy5oYXNoQ29kZShzcWwpXSA9IHNxbDsKCQkJCX0KCQkJCWlmICh0eXBlID09ICdzcWxpdGUnICYmIHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJykgZnVuID0gIiI7CgkJCQlpZiAoZnVuICYmICFkYltmdW5dKSBmdW4gPSAiIjsKCgkJCQlzcWwgPSB0eXBlb2Yoc3FsRm9ybWF0dGVyKSAhPT0gJ3VuZGVmaW5lZCcgPyBzcWxGb3JtYXR0ZXIuZm9ybWF0KHNxbCkgOiBzcWw7CgoJCQkJdGhpcy5sb2codW5kZWZpbmVkLCAnX3NxbCcsICdFbnRpdHlPYmplY3QnLCAwLCBgJHt0eXBlfS4ke2Z1bn1gLCBzcWwpOwoJCQkJaWYgKGxvdHRvLl9fc3FsVHJhbnNhY3Rpb24pIGxvdHRvLl9fc3FsVHJhbnNhY3Rpb24uc3Fscy5wdXNoKHNxbCk7CgoJCQkJaWYgKGZ1bikgewoJCQkJCWxldCByZXQgPSBkYltmdW5dKHNxbCwgW10sIChlcnJvciwgcm93cykgPT4gewoJCQkJCQlpZiAoZXJyb3IpIHsKCQkJCQkJCXJlamVjdChlcnJvcik7CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQlfcmVzb2x2ZShyb3dzLCBzcWwpOwoJCQkJCQl9CgkJCQkJfSk7CgkJCQl9IGVsc2UgaWYgKHR5cGUgPT0gJ3Nub3dmbGFrZScpIHsKCQkJCQl0aGlzLlRvb2wuZGIuZXhlY3V0ZSh7CgkJCQkJCXNxbFRleHQ6IHNxbCwKCQkJCQkJY29tcGxldGU6IGZ1bmN0aW9uKGVyciwgc3RtdCwgcm93cykgewoJCQkJCQkJaWYgKGVycikgewoJCQkJCQkJCXJlamVjdChlcnIpOwoJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQlfcmVzb2x2ZShyb3dzLCBzcWwpOwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJfSk7CgkJCQl9IGVsc2UgaWYgKHR5cGUgPT0gJ3NxbGl0ZScpIHsKCQkJCQkvLyBzcWxpdGUgaW4gdGhlIGJyb3dzZXIKCQkJCQl0cnkgewoJCQkJCQlsZXQgcmV0ID0gbnVsbDsKCQkJCQkJcmV0ID0gZGIuZXhlYyhzcWwpOwoJCQkJCQlpZiAoIXJldCB8fCAhcmV0Lmxlbmd0aCkgcmV0dXJuIF9yZXNvbHZlKHJldCwgc3FsKTsKCgkJCQkJCXJldCA9IHJldFswXS52YWx1ZXMubWFwKHIgPT4gT2JqZWN0LmZyb21FbnRyaWVzKG5ldyBNYXAocmV0WzBdLmNvbHVtbnMubWFwKChjLCBpKSA9PiBbYywgcltpXV0pKSkpOwoJCQkJCQkvLyB0aGlzLmxvZyh1bmRlZmluZWQsICdfc3FsJywgJ0VudGl0eU9iamVjdCcsIDAsIHJldCk7CgkJCQkJCV9yZXNvbHZlKHJldCwgc3FsKTsKCQkJCQl9IGNhdGNoIChleCkgewoJCQkJCQlyZWplY3QoZXgpOwoJCQkJCX0KCQkJCX0KCQkJfSk7CgkJfSBjYXRjaCAoZXgpIHsKCQkJdGhpcy5sb2codW5kZWZpbmVkLCAnX3NxbCcsICdFbnRpdHlPYmplY3QnLCAyLCBgCkVSUk9SOgoke2V4fQoKV2hpbGUgU2VuZGluZyBRdWVyeSAKJHtzcWx9CmApOwoJCX0KCgkJLy90aGlzIGlzIG5vdCBlbm91Z2guIFdlIHNlbGVjdCBvdXRlciBqb2lucywgc28gc3ViLWF0dHJpYnV0ZXMgd2lsbCBiZSBhbHNvIG51bGwuIEVpdGhlciByZWN1cnNpdmUgb3IgdG8gaWdub3JlIHdoZW4gdXNlZCwgZm9yIGV4YW1wbGUgdGhyb3VnaCBfdG9Eb2N1bWVudAoJCWZhbHNlICYmIHJldC5mb3JFYWNoKHIgPT4gewoJCQlPYmplY3Qua2V5cyhyKS5mb3JFYWNoKGsgPT4gewoJCQkJaWYgKHJba10gPT0gbnVsbCkgZGVsZXRlIHJba107CgkJCX0pOwoJCX0pOwoKCQlpZiAoQXJyYXkuaXNBcnJheShyZXQpKSByZXQgPSByZXQubWFwKHIgPT4gRG90T2JqZWN0Lm9iamVjdChyKSk7CgkJcmV0dXJuIHJldDsKCgl9CgoJYXN5bmMgX2ZpbGVzeXN0ZW0oZmlsZSwgY29udGVudCkgewoKCQlyZXR1cm4gYXdhaXQgbmV3IGxvdHRvLkNvbnRlbnQoKS5fZmlsZXN5c3RlbShmaWxlLCBjb250ZW50KTsKCgl9CgoJX2ZpbGVOYW1lKF9jbGFzcyA9IHRoaXMuX25Db2RlKCksIG9iaiA9IHRoaXMuX3RvRG9jdW1lbnQodHJ1ZSksIGVhQ29kZSA9IHRoaXMuX25Db2RlKCdjb2RlJywgdW5kZWZpbmVkKSkgewoKCQlyZXR1cm4gbmV3IGxvdHRvLkNvbnRlbnQoKS5fZmlsZU5hbWUoX2NsYXNzLCBvYmosIGVhQ29kZSk7CgoJfQoKCWFzeW5jIF9naXRodWIoZmlsZSwgY29udGVudCkgewoKCQlyZXR1cm4gYXdhaXQgbmV3IGxvdHRvLkNvbnRlbnQobnVsbCwgdGhpcy5Ub29sKS5fZ2l0aHViKGZpbGUsIGNvbnRlbnQpOwoKCX0KCglfX2V4cG9ydChvYmosIG9wdGlvbnMsIGZ1biwgLi4uZkFyZ3MpIHsKCQlpZiAoIW9iaikgcmV0dXJuIHRoaXM7CgoJCWxldCBfb3B0aW9ucyA9IChmaWVsZCwgb2JqLCBlYU9iaikgPT4gewoJCQl0cnkgewoJCQkJaWYgKG9wdGlvbnMuX2ZpZWxkcyAmJiAhb3B0aW9ucy5fZmllbGRzLmluY2x1ZGVzKGZpZWxkKSkgcmV0dXJuOwoJCQkJaWYgKHR5cGVvZihvcHRpb25zW2ZpZWxkXSkgIT09ICJmdW5jdGlvbiIpIHsKCQkJCQl0aGlzLmxvZyh1bmRlZmluZWQsICdfX2V4cG9ydCcsICdFbnRpdHlPYmplY3QnLCAwLCBgJHtmdW59Lm9wdGlvbnMuJHtmaWVsZH0gaXMgbm90IGEgZnVuY3Rpb25gKTsKCQkJCQlyZXR1cm47CgkJCQl9CgkJCQlpZiAoIW9wdGlvbnMuTnVsbCkgewoJCQkJCWlmIChmaWVsZCAhPSAnSWQnICYmICF0aGlzWydfJyArIGZpZWxkICsgJ19zZXQnXSkgcmV0dXJuOwoJCQkJCWlmIChBcnJheS5pc0FycmF5KGVhT2JqKSAmJiB0eXBlb2YoZWFPYmoubGVuZ3RoKSAhPT0gJ3VuZGVmaW5lZCcgJiYgIWVhT2JqLmxlbmd0aCkgcmV0dXJuOwoJCQkJfQoJCQkJaWYgKG9wdGlvbnMuT1BFUkFUT1JTICYmIHRoaXNbJ18nICsgZmllbGQgKyAnX2Nvb3AnXSkgb2JqLk9QRVJBVE9SUyA9IE9iamVjdC5hc3NpZ24ob2JqLk9QRVJBVE9SUyB8fCB7fSwgewoJCQkJCVtmaWVsZF06IHRoaXNbJ18nICsgZmllbGQgKyAnX2Nvb3AnXQoJCQkJfSk7CgoJCQkJbGV0IF9yZXQgPSBvcHRpb25zW2ZpZWxkXShvYmosIGVhT2JqKTsKCgkJCQlpZiAob3B0aW9ucy5fbWFwKSB0aGlzLl9tYXAoZmllbGQsIGZhbHNlLCBmdW4sIGVhT2JqLCBvYmopOwoJCQkJcmV0dXJuIF9yZXQ7CgkJCX0gY2F0Y2ggKGV4KSB7CgkJCQlpZiAoIWV4LnRvU3RyaW5nKCkuaW5kZXhPZignUmFuZ2VFcnJvcjogJykpIHsKCQkJCQlsb3R0by5fX2V4cG9ydEFib3J0ID0gdHJ1ZTsKCQkJCX0KCQkJCXRoaXMubG9nKHVuZGVmaW5lZCwgJ19fZXhwb3J0JywgJ0VudGl0eU9iamVjdCcsIDEsIGBFcnJvciBpbiAke2Z1bn0uX29wdGlvbnMuJHtmaWVsZH06ICR7ZXh9YCwgZXgpOwoJCQl9CgkJfTsKCgkJaWYgKG9wdGlvbnMuRnVsbCB8fCB0aGlzLl9fc3luY19vbigpIHx8IHRoaXMuSWQgPT0gdGhpcy5JZCkgX29wdGlvbnMoIklkIiwgb2JqLCB0aGlzLklkKTsKCgkJX29wdGlvbnMoImFjdGl2ZSIsIG9iaiwgdGhpcy5hY3RpdmUoKSk7CgoJCV9vcHRpb25zKCJlbmFibGVkIiwgb2JqLCB0aGlzLmVuYWJsZWQoKSk7CgoJCV9vcHRpb25zKCJjb2RlIiwgb2JqLCB0aGlzLmNvZGUoKSk7CgoJCV9vcHRpb25zKCJvcmRlciIsIG9iaiwgdGhpcy5vcmRlcigpKTsKCgkJX29wdGlvbnMoImRhdGUiLCBvYmosIHRoaXMuZGF0ZSgpKTsKCgkJX29wdGlvbnMoIm5hbWUiLCBvYmosIHRoaXMubmFtZSgpKTsKCgkJX29wdGlvbnMoInJlbWFyayIsIG9iaiwgdGhpcy5yZW1hcmsoKSk7CgoJCV9vcHRpb25zKCJ1c2VybmFtZSIsIG9iaiwgdGhpcy51c2VybmFtZSgpKTsKCgkJX29wdGlvbnMoInBhc3N3b3JkIiwgb2JqLCB0aGlzLnBhc3N3b3JkKCkpOwoKCQlsZXQgdiA9IHVuZGVmaW5lZDsKCQl0cnkgewoJCQlsb3R0by51blJlY3Vyc2VBYm9ydCA9IGxvdHRvLnVuUmVjdXJzZUFib3J0IHx8IHt9OwoJCQlpZiAobG90dG8udW5SZWN1cnNlQWJvcnRbZnVuXSkgewoJCQkJdGhpcy5sb2codW5kZWZpbmVkLCAnX19leHBvcnQnLCAnRW50aXR5T2JqZWN0JywgMSwgYEFib3J0aW5nIGFzIHBlciBsb3R0by51blJlY3Vyc2VBYm9ydC4ke2Z1bn1gKTsKCgkJCQlpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykgcmV0dXJuIHY7CgkJCQlyZXR1cm4gKHYub2JqICYmIHYub2JqLl9pZCkgPyB7CgkJCQkJX2lkOiB2Lm9iai5faWQKCQkJCX0gOiB2Lm9iajsKCQkJCXJldHVybiB2Lm9iajsKCgkJCX0KCgkJCWxldCBfaWQgPSBudWxsOwoJCQlpZiAodHlwZW9mKG9iaikgPT09ICd1bmRlZmluZWQnKSB7CgkJCQl0aGlzLmxvZyh1bmRlZmluZWQsICdfX2V4cG9ydC51blJlY3Vyc2UnLCAnRW50aXR5T2JqZWN0JywgMSwgIk51bGwgaW5wdXQiLCBvYmosIGZ1biwgZkFyZ3MpOwoJCQkJcmV0dXJuIG9iajsKCQkJfSBlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHsKCQkJCV9pZCA9IHRoaXMuaGFzaENvZGUob2JqKTsKCQkJfSBlbHNlIHsKCQkJCV9pZCA9IG9iai5faWQgfHwgb2JqLmlkIHx8IG9iai5JRDsKCQkJfQoKCQkJaWYgKHR5cGVvZihfaWQpID09PSAndW5kZWZpbmVkJyB8fCAhX2lkKSB7CgkJCQlpZiAob2JqLklkICYmIG9iai5JZCA9PSBvYmouSWQpIHsKCQkJCQlfaWQgPSBvYmouSWQ7CgkJCQl9IGVsc2UgaWYgKHRoaXMuSWQgPT0gdGhpcy5JZCkgewoJCQkJCV9pZCA9IHRoaXMuSWQ7CgkJCQl9IGVsc2UgaWYgKG9iai5FbnRpdHlDbGFzcykgewoJCQkJCV9pZCA9IG9iai5FbnRpdHlDbGFzcy5JZCB8fCBvYmouRW50aXR5Q2xhc3MuTmFtZTsKCQkJCX0gZWxzZSB7CgkJCQkJX2lkID0gdGhpcy5FbnRpdHlDbGFzcy5JZCB8fCAiMjI5YmFmYWMtYWRiZi00YTdmLWIxODQtZmJiOWZmYTkxZWQwIiB8fCAiTlVMTCI7CgkJCQl9CgkJCX0KCgkJCWxvdHRvLl91blJlY3Vyc2UgPSBsb3R0by5fdW5SZWN1cnNlIHx8IHt9OwoJCQlsb3R0by5fdW5SZWN1cnNlLlVzZXIgPSBsb3R0by5fdW5SZWN1cnNlLlVzZXIgfHwge307CgkJCWxvdHRvLl91blJlY3Vyc2UuVXNlcltmdW5dID0gbG90dG8uX3VuUmVjdXJzZS5Vc2VyW2Z1bl0gfHwge307CgkJCWxvdHRvLl91blJlY3Vyc2UuVXNlcltmdW5dW19pZF0gPSBsb3R0by5fdW5SZWN1cnNlLlVzZXJbZnVuXVtfaWRdIHx8IHt9OwoKCQkJbGV0IF9oYXNoID0gdGhpcy5fdG9IYXNoKGZBcmdzLCB7CgkJCQlkZXB0aDogKFsiX3RvSGFzaCJdLmluZGV4T2YoZnVuKSA+PSAwKSA/IDMgOiB1bmRlZmluZWQsCgkJCQljYWNoZTogKFsiX3RvSGFzaCJdLmluZGV4T2YoZnVuKSA+PSAwKSA/IFtdIDogdW5kZWZpbmVkCgkJCX0pOwoKCQkJdiA9IGxvdHRvLl91blJlY3Vyc2UuVXNlcltmdW5dW19pZF1bX2hhc2hdOwoJCQlpZiAodiAmJiBNYXRoLmFicyhuZXcgRGF0ZSgpLmdldFRpbWUoKSAtIHYuZGF0ZSkgPCAoMTAwMCAqIDAuMikpIHsKCQkJCWxldCB0aGlzU2V0T24gPSAoKFsiX3RvSGFzaCJdLmluZGV4T2YoZnVuKSA+PSAwKSA/IG5ldyBEYXRlKDApIDogKHRoaXMuU2V0X09uIHx8IG5ldyBEYXRlKDApKSk7CgkJCQlpZiAodGhpc1NldE9uID49IHYuZGF0ZSkgewoJCQkJCS8vIGEgbmV3ZXIgY29weSBpcyBjcmVhdGVkIEFGVEVSL0RVUklORyB0aGUgcmVjdXJzaXZlIGNhbGwhIQoJCQkJCXRoaXMubG9nKHVuZGVmaW5lZCwgJ19fZXhwb3J0LnVuUmVjdXJzZScsICdFbnRpdHlPYmplY3QnLCAwLCAiU3Bhd25pbmcgaW4gZnVuIiwgX2lkLCBfaGFzaCwgZnVuLCBvYmosIHYpOwoJCQkJfSBlbHNlIGlmICgodi5kYXRlIC0gdGhpc1NldE9uLmdldFRpbWUoKSkgPj0gMCkgewoJCQkJCXYucmV1c2VkKys7CgkJCQkJdGhpcy5sb2codW5kZWZpbmVkLCAnX19leHBvcnQudW5SZWN1cnNlJywgJ0VudGl0eU9iamVjdCcsIDAsICJTZWxlY3RlZCBoYXNoIiwgX2lkLCBfaGFzaCwgZnVuLCBvYmosIHYpOwoJCQkJfQoKCQkJCWlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSByZXR1cm4gdjsKCQkJCXJldHVybiAodi5vYmogJiYgdi5vYmouX2lkKSA/IHsKCQkJCQlfaWQ6IHYub2JqLl9pZAoJCQkJfSA6IHYub2JqOwoJCQkJcmV0dXJuIHYub2JqOwoKCQkJfQoKCQkJdGhpcy5sb2codW5kZWZpbmVkLCAnX19leHBvcnQudW5SZWN1cnNlJywgJ0VudGl0eU9iamVjdCcsIDAsICJQdXNoaW5nIGhhc2giLCBfaWQsIF9oYXNoLCBmdW4sIG9iaik7CgkJCWxvdHRvLl91blJlY3Vyc2UuVXNlcltmdW5dW19pZF1bX2hhc2hdID0gewoJCQkJZGF0ZTogbmV3IERhdGUoKS5nZXRUaW1lKCksCgkJCQlhcmdzOiBKU09OLnN0cmluZ2lmeShmQXJncyksCgkJCQlvYmo6IG9iaiwKCQkJCXJldXNlZDogMCwKCQkJfTsKCQl9IGNhdGNoICh1blJlY0V4KSB7CgkJCWlmICghdW5SZWNFeC50b1N0cmluZygpLmluZGV4T2YoJ1JhbmdlRXJyb3I6ICcpKSB7CgkJCQlsb3R0by51blJlY3Vyc2VBYm9ydFtmdW5dID0gdHJ1ZTsKCQkJfQoJCQl0aGlzLmxvZyh1bmRlZmluZWQsICdfX2V4cG9ydC51blJlY3Vyc2UnLCAnRW50aXR5T2JqZWN0JywgMiwgb2JqLCBmdW4sIGZBcmdzLCB1blJlY0V4LnRvU3RyaW5nKCkpOwoKCQkJaWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHJldHVybiB2OwoJCQlyZXR1cm4gKHYub2JqICYmIHYub2JqLl9pZCkgPyB7CgkJCQlfaWQ6IHYub2JqLl9pZAoJCQl9IDogdi5vYmo7CgkJCXJldHVybiB2Lm9iajsKCgkJfQoKCQlfb3B0aW9ucygiX1RISVMiLCBvYmosIHRoaXMuX1RISVMpOwoKCQlPYmplY3Qua2V5cyhvcHRpb25zKS5maWx0ZXIoayA9PiB0eXBlb2Yob3B0aW9uc1trXSkgPT09ICdmdW5jdGlvbicgJiYgIVsnSWQnLCAnX1RISVMnXS5jb25jYXQoWydhY3RpdmUnLCAnZW5hYmxlZCcsICdjb2RlJywgJ29yZGVyJywgJ2RhdGUnLCAnbmFtZScsICdyZW1hcmsnLCAndXNlcm5hbWUnLCAncGFzc3dvcmQnXSkuY29uY2F0KFsnJ10pLmluY2x1ZGVzKGspKS5mb3JFYWNoKGsgPT4gX29wdGlvbnMoaywgb2JqLCB0cnVlKSk7CgoJCXJldHVybiBvYmo7Cgl9CgoJX19pbXBvcnQob2JqLCBvcHRpb25zLCBmdW4sIC4uLmZBcmdzKSB7CgkJLy8gaWYoIW9iaikgcmV0dXJuIHRoaXM7CgkJaWYgKHR5cGVvZihvYmopICE9PSAnb2JqZWN0JykgewoJCQl0aGlzLmxvZyh1bmRlZmluZWQsICdfX2ltcG9ydCcsICdFbnRpdHlPYmplY3QnLCAxLCBgJHtmdW59OiBOb3QgYW4gb2JqZWN0OiAke3R5cGVvZihvYmopfWAsIG9iaik7CgkJCXJldHVybiB0aGlzOwoJCX0KCgkJbGV0IF9vcHRpb25zID0gKGZpZWxkLCBvYmopID0+IHsKCQkJaWYgKG9wdGlvbnMuX2ZpZWxkcyAmJiAhb3B0aW9ucy5fZmllbGRzLmluY2x1ZGVzKGZpZWxkKSkgcmV0dXJuOwoJCQlpZiAoIW9iaikgcmV0dXJuOwoJCQlpZiAoQXJyYXkuaXNBcnJheShvYmopICYmICFvYmoubGVuZ3RoKSByZXR1cm47CgoJCQl0cnkgewoJCQkJaWYgKG9wdGlvbnMuX21hcCkgdGhpcy5fbWFwKGZpZWxkLCB0cnVlLCBmdW4sIG9iaiwgb2JqKTsKCQkJCWlmIChvcHRpb25zW2ZpZWxkXSAmJiB0eXBlb2Yob3B0aW9uc1tmaWVsZF0pID09PSAiZnVuY3Rpb24iKSByZXR1cm4gb3B0aW9uc1tmaWVsZF0ob2JqKTsKCQkJfSBjYXRjaCAoZXgpIHsKCQkJCXRoaXMubG9nKHVuZGVmaW5lZCwgJ19faW1wb3J0JywgJ0VudGl0eU9iamVjdCcsIDEsIGBFcnJvciAke2V4fSBpbiAke2Z1bn0ub3B0aW9ucy4ke2ZpZWxkfWAsIGV4KTsKCQkJfQoJCX07CgoJCV9vcHRpb25zKCJfVEhJUyIsIG9iaik7CgkJX29wdGlvbnMoIklkIiwgb2JqKTsKCgkJX29wdGlvbnMoImFjdGl2ZSIsIG9iaik7CgoJCV9vcHRpb25zKCJlbmFibGVkIiwgb2JqKTsKCgkJX29wdGlvbnMoImNvZGUiLCBvYmopOwoKCQlfb3B0aW9ucygib3JkZXIiLCBvYmopOwoKCQlfb3B0aW9ucygiZGF0ZSIsIG9iaik7CgoJCV9vcHRpb25zKCJuYW1lIiwgb2JqKTsKCgkJX29wdGlvbnMoInJlbWFyayIsIG9iaik7CgoJCV9vcHRpb25zKCJ1c2VybmFtZSIsIG9iaik7CgoJCV9vcHRpb25zKCJwYXNzd29yZCIsIG9iaik7CgoJCS8vIGNhbiB3ZSBkbyBkZVJlZmVyZW5jZSBoZXJlPwoKCQlsZXQgdiA9IHVuZGVmaW5lZDsKCQl0cnkgewoJCQlsb3R0by51blJlY3Vyc2VBYm9ydCA9IGxvdHRvLnVuUmVjdXJzZUFib3J0IHx8IHt9OwoJCQlpZiAobG90dG8udW5SZWN1cnNlQWJvcnRbZnVuXSkgewoJCQkJdGhpcy5sb2codW5kZWZpbmVkLCAnX19pbXBvcnQnLCAnRW50aXR5T2JqZWN0JywgMSwgYEFib3J0aW5nIGFzIHBlciBsb3R0by51blJlY3Vyc2VBYm9ydC4ke2Z1bn1gKTsKCgkJCQlpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykgcmV0dXJuIHY7CgkJCQlyZXR1cm4gKHYub2JqICYmIHYub2JqLl9pZCkgPyB7CgkJCQkJX2lkOiB2Lm9iai5faWQKCQkJCX0gOiB2Lm9iajsKCQkJCXJldHVybiB2Lm9iajsKCgkJCX0KCgkJCWxldCBfaWQgPSBudWxsOwoJCQlpZiAodHlwZW9mKHRoaXMpID09PSAndW5kZWZpbmVkJykgewoJCQkJdGhpcy5sb2codW5kZWZpbmVkLCAnX19pbXBvcnQudW5SZWN1cnNlJywgJ0VudGl0eU9iamVjdCcsIDEsICJOdWxsIGlucHV0IiwgdGhpcywgZnVuLCBmQXJncyk7CgkJCQlyZXR1cm4gdGhpczsKCQkJfSBlbHNlIGlmICh0eXBlb2YodGhpcykgPT09ICdzdHJpbmcnKSB7CgkJCQlfaWQgPSB0aGlzLmhhc2hDb2RlKHRoaXMpOwoJCQl9IGVsc2UgewoJCQkJX2lkID0gdGhpcy5faWQgfHwgdGhpcy5pZCB8fCB0aGlzLklEOwoJCQl9CgoJCQlpZiAodHlwZW9mKF9pZCkgPT09ICd1bmRlZmluZWQnIHx8ICFfaWQpIHsKCQkJCWlmICh0aGlzLklkICYmIHRoaXMuSWQgPT0gdGhpcy5JZCkgewoJCQkJCV9pZCA9IHRoaXMuSWQ7CgkJCQl9IGVsc2UgaWYgKHRoaXMuSWQgPT0gdGhpcy5JZCkgewoJCQkJCV9pZCA9IHRoaXMuSWQ7CgkJCQl9IGVsc2UgaWYgKHRoaXMuRW50aXR5Q2xhc3MpIHsKCQkJCQlfaWQgPSB0aGlzLkVudGl0eUNsYXNzLklkIHx8IHRoaXMuRW50aXR5Q2xhc3MuTmFtZTsKCQkJCX0gZWxzZSB7CgkJCQkJX2lkID0gdGhpcy5FbnRpdHlDbGFzcy5JZCB8fCAiMjI5YmFmYWMtYWRiZi00YTdmLWIxODQtZmJiOWZmYTkxZWQwIiB8fCAiTlVMTCI7CgkJCQl9CgkJCX0KCgkJCWxvdHRvLl91blJlY3Vyc2UgPSBsb3R0by5fdW5SZWN1cnNlIHx8IHt9OwoJCQlsb3R0by5fdW5SZWN1cnNlLlVzZXIgPSBsb3R0by5fdW5SZWN1cnNlLlVzZXIgfHwge307CgkJCWxvdHRvLl91blJlY3Vyc2UuVXNlcltmdW5dID0gbG90dG8uX3VuUmVjdXJzZS5Vc2VyW2Z1bl0gfHwge307CgkJCWxvdHRvLl91blJlY3Vyc2UuVXNlcltmdW5dW19pZF0gPSBsb3R0by5fdW5SZWN1cnNlLlVzZXJbZnVuXVtfaWRdIHx8IHt9OwoKCQkJbGV0IF9oYXNoID0gdGhpcy5fdG9IYXNoKGZBcmdzLCB7CgkJCQlkZXB0aDogKFsiX3RvSGFzaCJdLmluZGV4T2YoZnVuKSA+PSAwKSA/IDMgOiB1bmRlZmluZWQsCgkJCQljYWNoZTogKFsiX3RvSGFzaCJdLmluZGV4T2YoZnVuKSA+PSAwKSA/IFtdIDogdW5kZWZpbmVkCgkJCX0pOwoKCQkJdiA9IGxvdHRvLl91blJlY3Vyc2UuVXNlcltmdW5dW19pZF1bX2hhc2hdOwoJCQlpZiAodiAmJiBNYXRoLmFicyhuZXcgRGF0ZSgpLmdldFRpbWUoKSAtIHYuZGF0ZSkgPCAoMTAwMCAqIDAuMikpIHsKCQkJCWxldCB0aGlzU2V0T24gPSAoKFsiX3RvSGFzaCJdLmluZGV4T2YoZnVuKSA+PSAwKSA/IG5ldyBEYXRlKDApIDogKHRoaXMuU2V0X09uIHx8IG5ldyBEYXRlKDApKSk7CgkJCQlpZiAodGhpc1NldE9uID49IHYuZGF0ZSkgewoJCQkJCS8vIGEgbmV3ZXIgY29weSBpcyBjcmVhdGVkIEFGVEVSL0RVUklORyB0aGUgcmVjdXJzaXZlIGNhbGwhIQoJCQkJCXRoaXMubG9nKHVuZGVmaW5lZCwgJ19faW1wb3J0LnVuUmVjdXJzZScsICdFbnRpdHlPYmplY3QnLCAwLCAiU3Bhd25pbmcgaW4gZnVuIiwgX2lkLCBfaGFzaCwgZnVuLCB0aGlzLCB2KTsKCQkJCX0gZWxzZSBpZiAoKHYuZGF0ZSAtIHRoaXNTZXRPbi5nZXRUaW1lKCkpID49IDApIHsKCQkJCQl2LnJldXNlZCsrOwoJCQkJCXRoaXMubG9nKHVuZGVmaW5lZCwgJ19faW1wb3J0LnVuUmVjdXJzZScsICdFbnRpdHlPYmplY3QnLCAwLCAiU2VsZWN0ZWQgaGFzaCIsIF9pZCwgX2hhc2gsIGZ1biwgdGhpcywgdik7CgkJCQl9CgoJCQkJaWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHJldHVybiB2OwoJCQkJcmV0dXJuICh2Lm9iaiAmJiB2Lm9iai5faWQpID8gewoJCQkJCV9pZDogdi5vYmouX2lkCgkJCQl9IDogdi5vYmo7CgkJCQlyZXR1cm4gdi5vYmo7CgoJCQl9CgoJCQl0aGlzLmxvZyh1bmRlZmluZWQsICdfX2ltcG9ydC51blJlY3Vyc2UnLCAnRW50aXR5T2JqZWN0JywgMCwgIlB1c2hpbmcgaGFzaCIsIF9pZCwgX2hhc2gsIGZ1biwgdGhpcyk7CgkJCWxvdHRvLl91blJlY3Vyc2UuVXNlcltmdW5dW19pZF1bX2hhc2hdID0gewoJCQkJZGF0ZTogbmV3IERhdGUoKS5nZXRUaW1lKCksCgkJCQlhcmdzOiBKU09OLnN0cmluZ2lmeShmQXJncyksCgkJCQlvYmo6IHRoaXMsCgkJCQlyZXVzZWQ6IDAsCgkJCX07CgkJfSBjYXRjaCAodW5SZWNFeCkgewoJCQlpZiAoIXVuUmVjRXgudG9TdHJpbmcoKS5pbmRleE9mKCdSYW5nZUVycm9yOiAnKSkgewoJCQkJbG90dG8udW5SZWN1cnNlQWJvcnRbZnVuXSA9IHRydWU7CgkJCX0KCQkJdGhpcy5sb2codW5kZWZpbmVkLCAnX19pbXBvcnQudW5SZWN1cnNlJywgJ0VudGl0eU9iamVjdCcsIDIsIHRoaXMsIGZ1biwgZkFyZ3MsIHVuUmVjRXgudG9TdHJpbmcoKSk7CgoJCQlpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykgcmV0dXJuIHY7CgkJCXJldHVybiAodi5vYmogJiYgdi5vYmouX2lkKSA/IHsKCQkJCV9pZDogdi5vYmouX2lkCgkJCX0gOiB2Lm9iajsKCQkJcmV0dXJuIHYub2JqOwoKCQl9CgoJCU9iamVjdC5rZXlzKG9wdGlvbnMpLmZpbHRlcihrID0+IHR5cGVvZihvcHRpb25zW2tdKSA9PT0gJ2Z1bmN0aW9uJyAmJiAhWydJZCcsICdfVEhJUyddLmNvbmNhdChbJ2FjdGl2ZScsICdlbmFibGVkJywgJ2NvZGUnLCAnb3JkZXInLCAnZGF0ZScsICduYW1lJywgJ3JlbWFyaycsICd1c2VybmFtZScsICdwYXNzd29yZCddKS5jb25jYXQoWycnXSkuaW5jbHVkZXMoaykpLmZvckVhY2goayA9PiBfb3B0aW9ucyhrLCBvYmopKTsKCgkJcmV0dXJuIHRoaXM7Cgl9CgoJX3RvREJPYmplY3QoZmllbGRzLCBiTm9SZWYpIHsKCQlpZiAoIXRoaXMuSWQpIHsKCQkJdGhpcy5sb2codW5kZWZpbmVkLCAnX3RvREJPYmplY3QnLCAnRW50aXR5T2JqZWN0JywgMiwgIkludmFsaWQgSUQiLCB0aGlzLkVudGl0eUNsYXNzLk5hbWUsIHRoaXMuVG9vbCk7CgkJfQoJCWxldCByZXQgPSB7CgkJCVt0aGlzLl9fY29uZmlnKCdpZEZpZWxkJywgJ19faWQnKV06ICInIiArIHRoaXMuSWQgKyAiJyIKCQl9OwoKCQlpZiAoKChmaWVsZHMgJiYgZmllbGRzLmluZGV4T2YoImFjdGl2ZSIpKSB8fCAhZmllbGRzKSAmJiB0aGlzLl9hY3RpdmVfc2V0ICYmICghYk5vUmVmIHx8IHRydWUpKSB7CgkJCWxldCBmVmFsdWUgPSBudWxsOwoJCQlsZXQgdiA9IHRoaXMuYWN0aXZlKCk7CgoJCQlmVmFsdWUgPSB2ID8gMSA6IDA7CgkJCWlmICh0aGlzLlRvb2wudHlwZS5uYW1lID09ICdOZW80aicpIGZWYWx1ZSA9IGZWYWx1ZSA/ICdUcnVlJyA6ICdGYWxzZSc7CgoJCQlyZXRbdGhpcy5fbkNvZGUoJ2FjdGl2ZScsIHVuZGVmaW5lZCkgKyAiIl0gPSBmVmFsdWU7CgkJfQoKCQlpZiAoKChmaWVsZHMgJiYgZmllbGRzLmluZGV4T2YoImVuYWJsZWQiKSkgfHwgIWZpZWxkcykgJiYgdGhpcy5fZW5hYmxlZF9zZXQgJiYgKCFiTm9SZWYgfHwgdHJ1ZSkpIHsKCQkJbGV0IGZWYWx1ZSA9IG51bGw7CgkJCWxldCB2ID0gdGhpcy5lbmFibGVkKCk7CgoJCQlmVmFsdWUgPSB2ID8gMSA6IDA7CgkJCWlmICh0aGlzLlRvb2wudHlwZS5uYW1lID09ICdOZW80aicpIGZWYWx1ZSA9IGZWYWx1ZSA/ICdUcnVlJyA6ICdGYWxzZSc7CgoJCQlyZXRbdGhpcy5fbkNvZGUoJ2VuYWJsZWQnLCB1bmRlZmluZWQpICsgIiJdID0gZlZhbHVlOwoJCX0KCgkJaWYgKCgoZmllbGRzICYmIGZpZWxkcy5pbmRleE9mKCJjb2RlIikpIHx8ICFmaWVsZHMpICYmIHRoaXMuX2NvZGVfc2V0ICYmICghYk5vUmVmIHx8IHRydWUpKSB7CgkJCWxldCBmVmFsdWUgPSBudWxsOwoJCQlsZXQgdiA9IHRoaXMuY29kZSgpOwoKCQkJZlZhbHVlID0gIiciICsgdiArICInIjsKCgkJCXJldFt0aGlzLl9uQ29kZSgnY29kZScsIHVuZGVmaW5lZCkgKyAiIl0gPSBmVmFsdWU7CgkJfQoKCQlpZiAoKChmaWVsZHMgJiYgZmllbGRzLmluZGV4T2YoIm9yZGVyIikpIHx8ICFmaWVsZHMpICYmIHRoaXMuX29yZGVyX3NldCAmJiAoIWJOb1JlZiB8fCB0cnVlKSkgewoJCQlsZXQgZlZhbHVlID0gbnVsbDsKCQkJbGV0IHYgPSB0aGlzLm9yZGVyKCk7CgoJCQlmVmFsdWUgPSB2IHx8ICcwJzsKCgkJCXJldFt0aGlzLl9uQ29kZSgnb3JkZXInLCB1bmRlZmluZWQpICsgIiJdID0gZlZhbHVlOwoJCX0KCgkJaWYgKCgoZmllbGRzICYmIGZpZWxkcy5pbmRleE9mKCJkYXRlIikpIHx8ICFmaWVsZHMpICYmIHRoaXMuX2RhdGVfc2V0ICYmICghYk5vUmVmIHx8IHRydWUpKSB7CgkJCWxldCBmVmFsdWUgPSBudWxsOwoJCQlsZXQgdiA9IHRoaXMuZGF0ZSgpOwoKCQkJdHJ5IHsKCQkJCWZWYWx1ZSA9ICInIiArICh2ID8gdi50b0lTT1N0cmluZygpIDogIjE5NzAtMS0xIikgKyAiJyI7CgkJCQlpZiAodGhpcy5fX2NvbmZpZygndHlwZScpID09ICdteXNxbCcpIHsKCQkJCQlmVmFsdWUgPSBgU1RSX1RPX0RBVEUoJHtmVmFsdWV9LCAnJVktJW0tJWRUJVQuJWZaJylgOwoJCQkJfQoJCQl9IGNhdGNoIChleCkgewoJCQkJZlZhbHVlID0gIiciICsgdiArICInIjsKCQkJfQoJCQlpZiAodGhpcy5Ub29sLnR5cGUubmFtZSA9PSAnTmVvNGonKSBmVmFsdWUgPSAnZGF0ZXRpbWUoJyArIGZWYWx1ZSArICcpJzsKCgkJCXJldFt0aGlzLl9uQ29kZSgnZGF0ZScsIHVuZGVmaW5lZCkgKyAiIl0gPSBmVmFsdWU7CgkJfQoKCQlpZiAoKChmaWVsZHMgJiYgZmllbGRzLmluZGV4T2YoIm5hbWUiKSkgfHwgIWZpZWxkcykgJiYgdGhpcy5fbmFtZV9zZXQgJiYgKCFiTm9SZWYgfHwgdHJ1ZSkpIHsKCQkJbGV0IGZWYWx1ZSA9IG51bGw7CgkJCWxldCB2ID0gdGhpcy5uYW1lKCk7CgoJCQlmVmFsdWUgPSAiJyIgKyB2ICsgIiciOwoKCQkJcmV0W3RoaXMuX25Db2RlKCduYW1lJywgdW5kZWZpbmVkKSArICIiXSA9IGZWYWx1ZTsKCQl9CgoJCWlmICgoKGZpZWxkcyAmJiBmaWVsZHMuaW5kZXhPZigicmVtYXJrIikpIHx8ICFmaWVsZHMpICYmIHRoaXMuX3JlbWFya19zZXQgJiYgKCFiTm9SZWYgfHwgdHJ1ZSkpIHsKCQkJbGV0IGZWYWx1ZSA9IG51bGw7CgkJCWxldCB2ID0gdGhpcy5yZW1hcmsoKTsKCgkJCWZWYWx1ZSA9ICInIiArICgodiAmJiB2LnJlcGxhY2UpID8gdi5yZXBsYWNlKC9cJy9nLCAiXCdcJyIpIDogdikgKyAiJyI7CgoJCQlyZXRbdGhpcy5fbkNvZGUoJ3JlbWFyaycsIHVuZGVmaW5lZCkgKyAiIl0gPSBmVmFsdWU7CgkJfQoKCQlpZiAoKChmaWVsZHMgJiYgZmllbGRzLmluZGV4T2YoInVzZXJuYW1lIikpIHx8ICFmaWVsZHMpICYmIHRoaXMuX3VzZXJuYW1lX3NldCAmJiAoIWJOb1JlZiB8fCB0cnVlKSkgewoJCQlsZXQgZlZhbHVlID0gbnVsbDsKCQkJbGV0IHYgPSB0aGlzLnVzZXJuYW1lKCk7CgoJCQlmVmFsdWUgPSAiJyIgKyB2ICsgIiciOwoKCQkJcmV0W3RoaXMuX25Db2RlKCd1c2VybmFtZScsIHVuZGVmaW5lZCkgKyAiIl0gPSBmVmFsdWU7CgkJfQoKCQlpZiAoKChmaWVsZHMgJiYgZmllbGRzLmluZGV4T2YoInBhc3N3b3JkIikpIHx8ICFmaWVsZHMpICYmIHRoaXMuX3Bhc3N3b3JkX3NldCAmJiAoIWJOb1JlZiB8fCB0cnVlKSkgewoJCQlsZXQgZlZhbHVlID0gbnVsbDsKCQkJbGV0IHYgPSB0aGlzLnBhc3N3b3JkKCk7CgoJCQlmVmFsdWUgPSAiJyIgKyB2ICsgIiciOwoKCQkJcmV0W3RoaXMuX25Db2RlKCdwYXNzd29yZCcsIHVuZGVmaW5lZCkgKyAiIl0gPSBmVmFsdWU7CgkJfQoKCQl0aGlzLmxvZyh1bmRlZmluZWQsICdfdG9EQk9iamVjdCcsICdFbnRpdHlPYmplY3QnLCAwLCByZXQpOwoJCXJldHVybiByZXQ7Cgl9CgoJX1EoKSB7CgkJbGV0IF9vID0gJyInOwoJCWxldCBfcSA9IF9vOwoKCQlpZiAoWydTYWxlc0ZvcmNlJ10uaW5kZXhPZih0aGlzLlRvb2wudHlwZS5uYW1lKSA9PSAwKSB7CgkJCV9vID0gX3EgPSAiIjsKCQl9IGVsc2UgaWYgKHRoaXMuX19jb25maWcoJ3R5cGUnKSA9PSAnbXlzcWwnIHx8IHRoaXMuVG9vbC50eXBlLm5hbWUgPT0gJ05lbzRqJykgewoJCQlfbyA9IF9xID0gJ2AnOwoJCX0gZWxzZSBpZiAoZmFsc2UgJiYgdGhpcy5fX2NvbmZpZygndHlwZScpID09ICdwZycpIHsKCQkJX28gPSBfcSA9ICInIjsKCQl9IGVsc2UgaWYgKHRoaXMuX19jb25maWcoJ3R5cGUnKSA9PSAnc3Fsc2VydmVyJykgewoJCQlfbyA9ICdbJzsKCQkJX3EgPSAnXSc7CgkJfSBlbHNlIGlmICh0aGlzLl9fY29uZmlnKCdhcGlLZXknKSA9PSAnYWlydGFibGUnKSB7CgkJCV9vID0gJ3snOwoJCQlfcSA9ICd9JzsKCQl9CgkJcmV0dXJuIF9vID8gX3EgOiBfbzsKCX0KCglfZmllbGRHcm91cHMoZmdzID0ge30pIHsKCQl0aGlzLl9fZmllbGRHcm91cHMgPSBmZ3M7CgkJcmV0dXJuIHRoaXM7Cgl9CgoJX2ZpZWxkQWdncmVnYXRlcyhmYXMgPSB7fSkgewoJCXRoaXMuX19maWVsZEFnZ3JlZ2F0ZXMgPSBmYXM7CgkJcmV0dXJuIHRoaXM7Cgl9CgoJX3RvRmllbGRzU1FMKGZpZWxkcykgewoKCQlmaWVsZHMgPSBmaWVsZHMgfHwgW3RoaXMuX19jb25maWcoJ2lkRmllbGQnLCAnX19pZCcpLCB0aGlzLl9uQ29kZSgnYWN0aXZlJywgdW5kZWZpbmVkKSwgdGhpcy5fbkNvZGUoJ2VuYWJsZWQnLCB1bmRlZmluZWQpLCB0aGlzLl9uQ29kZSgnY29kZScsIHVuZGVmaW5lZCksIHRoaXMuX25Db2RlKCdvcmRlcicsIHVuZGVmaW5lZCksIHRoaXMuX25Db2RlKCdkYXRlJywgdW5kZWZpbmVkKSwgdGhpcy5fbkNvZGUoJ25hbWUnLCB1bmRlZmluZWQpLCB0aGlzLl9uQ29kZSgncmVtYXJrJywgdW5kZWZpbmVkKSwgdGhpcy5fbkNvZGUoJ3VzZXJuYW1lJywgdW5kZWZpbmVkKSwgdGhpcy5fbkNvZGUoJ3Bhc3N3b3JkJywgdW5kZWZpbmVkKV07CgkJZmllbGRzID0gQXJyYXkuaXNBcnJheShmaWVsZHMpID8gZmllbGRzIDogW2ZpZWxkc107CgoJCWlmICh0aGlzLl9fZmllbGRHcm91cHMpIHsKCQkJLy8ge2ZpZWxkOiBvcmRlcn0KCQkJZmllbGRzID0gW107CgoJCQlpZiAodGhpcy5fX2ZpZWxkR3JvdXBzLmFjdGl2ZSkgZmllbGRzLnB1c2goYCR7dGhpcy5fbkNvZGUoJ2FjdGl2ZScsIHVuZGVmaW5lZCl9YCk7CgoJCQlpZiAodGhpcy5fX2ZpZWxkR3JvdXBzLmVuYWJsZWQpIGZpZWxkcy5wdXNoKGAke3RoaXMuX25Db2RlKCdlbmFibGVkJywgdW5kZWZpbmVkKX1gKTsKCgkJCWlmICh0aGlzLl9fZmllbGRHcm91cHMuY29kZSkgZmllbGRzLnB1c2goYCR7dGhpcy5fbkNvZGUoJ2NvZGUnLCB1bmRlZmluZWQpfWApOwoKCQkJaWYgKHRoaXMuX19maWVsZEdyb3Vwcy5vcmRlcikgZmllbGRzLnB1c2goYCR7dGhpcy5fbkNvZGUoJ29yZGVyJywgdW5kZWZpbmVkKX1gKTsKCgkJCWlmICh0aGlzLl9fZmllbGRHcm91cHMuZGF0ZSkgZmllbGRzLnB1c2goYCR7dGhpcy5fbkNvZGUoJ2RhdGUnLCB1bmRlZmluZWQpfWApOwoKCQkJaWYgKHRoaXMuX19maWVsZEdyb3Vwcy5uYW1lKSBmaWVsZHMucHVzaChgJHt0aGlzLl9uQ29kZSgnbmFtZScsIHVuZGVmaW5lZCl9YCk7CgoJCQlpZiAodGhpcy5fX2ZpZWxkR3JvdXBzLnVzZXJuYW1lKSBmaWVsZHMucHVzaChgJHt0aGlzLl9uQ29kZSgndXNlcm5hbWUnLCB1bmRlZmluZWQpfWApOwoKCQkJaWYgKHRoaXMuX19maWVsZEdyb3Vwcy5wYXNzd29yZCkgZmllbGRzLnB1c2goYCR7dGhpcy5fbkNvZGUoJ3Bhc3N3b3JkJywgdW5kZWZpbmVkKX1gKTsKCgkJfQoJCXJldHVybiBmaWVsZHM7Cgl9CgoJX2Zyb21EQk9iamVjdChyID0ge30pIHsKCQl0cnkgewoJCQlyZXR1cm4gdGhpcy5fX2ltcG9ydChyLCB7CgkJCQlJZDogb2JqID0+IHRoaXMuSWQgPSBvYmpbdGhpcy5fX2NvbmZpZygnaWRGaWVsZCcsICdfX2lkJyldLAoKCQkJCWFjdGl2ZTogKG9iaiwgZWFDb2RlID0gdGhpcy5fbkNvZGUoJ2FjdGl2ZScsIHVuZGVmaW5lZCkpID0+IHsKCQkJCQl0aGlzLmFjdGl2ZShvYmpbZWFDb2RlXSk7CgkJCQl9LAoKCQkJCWVuYWJsZWQ6IChvYmosIGVhQ29kZSA9IHRoaXMuX25Db2RlKCdlbmFibGVkJywgdW5kZWZpbmVkKSkgPT4gewoJCQkJCXRoaXMuZW5hYmxlZChvYmpbZWFDb2RlXSk7CgkJCQl9LAoKCQkJCWNvZGU6IChvYmosIGVhQ29kZSA9IHRoaXMuX25Db2RlKCdjb2RlJywgdW5kZWZpbmVkKSkgPT4gewoJCQkJCXRoaXMuY29kZShvYmpbZWFDb2RlXSk7CgkJCQl9LAoKCQkJCW9yZGVyOiAob2JqLCBlYUNvZGUgPSB0aGlzLl9uQ29kZSgnb3JkZXInLCB1bmRlZmluZWQpKSA9PiB7CgkJCQkJdGhpcy5vcmRlcihvYmpbZWFDb2RlXSk7CgkJCQl9LAoKCQkJCWRhdGU6IChvYmosIGVhQ29kZSA9IHRoaXMuX25Db2RlKCdkYXRlJywgdW5kZWZpbmVkKSkgPT4gewoJCQkJCXRoaXMuZGF0ZShvYmpbZWFDb2RlXSk7CgkJCQl9LAoKCQkJCW5hbWU6IChvYmosIGVhQ29kZSA9IHRoaXMuX25Db2RlKCduYW1lJywgdW5kZWZpbmVkKSkgPT4gewoJCQkJCXRoaXMubmFtZShvYmpbZWFDb2RlXSk7CgkJCQl9LAoKCQkJCXJlbWFyazogKG9iaiwgZWFDb2RlID0gdGhpcy5fbkNvZGUoJ3JlbWFyaycsIHVuZGVmaW5lZCkpID0+IHsKCQkJCQl0aGlzLnJlbWFyayhvYmpbZWFDb2RlXSk7CgkJCQl9LAoKCQkJCXVzZXJuYW1lOiAob2JqLCBlYUNvZGUgPSB0aGlzLl9uQ29kZSgndXNlcm5hbWUnLCB1bmRlZmluZWQpKSA9PiB7CgkJCQkJdGhpcy51c2VybmFtZShvYmpbZWFDb2RlXSk7CgkJCQl9LAoKCQkJCXBhc3N3b3JkOiAob2JqLCBlYUNvZGUgPSB0aGlzLl9uQ29kZSgncGFzc3dvcmQnLCB1bmRlZmluZWQpKSA9PiB7CgkJCQkJdGhpcy5wYXNzd29yZChvYmpbZWFDb2RlXSk7CgkJCQl9LAoKCQkJfSwgIl9mcm9tREJPYmplY3QiKTsKCQl9IGNhdGNoIChleCkgewoJCQl0aGlzLmxvZyh1bmRlZmluZWQsICdfZnJvbURCT2JqZWN0JywgJ0VudGl0eU9iamVjdCcsIDIsIGV4KTsKCQl9Cgl9CgoJX3RvU2VsZWN0SGVhZGVyKGZpZWxkcykgewoJCWxldCByZXQgPSB7CgkJCXRhYmxlOiB0aGlzLl9uQ29kZSgpLAoJCQlmaWVsZHM6IERvdE9iamVjdC5vYmplY3QoT2JqZWN0LmZyb21FbnRyaWVzKHRoaXMuX3RvRmllbGRzU1FMKGZpZWxkcykubWFwKGYgPT4gdGhpcy5fUSgpICsgZi5yZXBsYWNlKC9cLi9nLCAnJykgKyB0aGlzLl9RKCkpLm1hcChmID0+IFtmLCBmXSkpKSwKCQkJam9pbnM6IHt9LAoJCX07CgoJCWlmIChmaWVsZHMpIHJldHVybiByZXQ7CgoJCXJldC5qb2lucyA9IHRoaXMuX19leHBvcnQoe30sIHsKCQkJLy8gTnVsbDogdHJ1ZSwKCgkJfSwgIl90b1NlbGVjdEhlYWRlciIpOwoKCQl0aGlzLmxvZyh1bmRlZmluZWQsICdfdG9TZWxlY3RIZWFkZXInLCAnRW50aXR5T2JqZWN0JywgMCwgcmV0KTsKCgkJcmV0dXJuIHJldDsKCX0KCglfdG9TZWxlY3RTUUwoZmllbGRzKSB7CgkJbGV0IHNxbCA9ICJzZWxlY3QgIjsKCgkJbGV0IHRQcmVmID0gYCR7dGhpcy5fUSgpfSR7dGhpcy5fbkNvZGUoKX0ke3RoaXMuX1EoKX1gOwoKCQlsZXQgaGVhZGVyID0gdGhpcy5fdG9TZWxlY3RIZWFkZXIoZmllbGRzKTsKCgkJc3FsICs9IE9iamVjdC52YWx1ZXMoaGVhZGVyLmZpZWxkcykubWFwKGYgPT4gYCR7dFByZWZ9LiR7Zn1gKS5qb2luKCcsICcpOwoJCU9iamVjdC5rZXlzKGhlYWRlci5qb2lucykuZm9yRWFjaChrID0+IHNxbCArPSAiLCAiICsgT2JqZWN0LnZhbHVlcyhoZWFkZXIuam9pbnNba10uZmllbGRzKS5tYXAoZiA9PiBgJHt0aGlzLl9RKCl9JHtoZWFkZXIuam9pbnNba10udGFibGV9XyR7a30ke3RoaXMuX1EoKX0uJHtmfSBhcyAke3RoaXMuX1EoKX0ke2t9LiR7Zi5yZXBsYWNlKHRoaXMuX1EoKSwgJycpfWApLmpvaW4oJywgJykpOwoKCQlpZiAodGhpcy5fX2ZpZWxkQWdncmVnYXRlcykgewoJCQkvLyB7ZmllbGQ6IGZ1bmN0aW9ufQoKCQkJaWYgKHRoaXMuX19maWVsZEFnZ3JlZ2F0ZXMuYWN0aXZlKSBzcWwgKz0gYCR7c3FsPT0oJ3NlbGVjdCAnKT8nJzonLCd9ICR7dGhpcy5fX2ZpZWxkQWdncmVnYXRlcy5hY3RpdmV9KCR7dGhpcy5fUSgpfSR7dGhpcy5fbkNvZGUoJ2FjdGl2ZScsIHVuZGVmaW5lZCl9JHt0aGlzLl9RKCl9KWA7CgoJCQlpZiAodGhpcy5fX2ZpZWxkQWdncmVnYXRlcy5lbmFibGVkKSBzcWwgKz0gYCR7c3FsPT0oJ3NlbGVjdCAnKT8nJzonLCd9ICR7dGhpcy5fX2ZpZWxkQWdncmVnYXRlcy5lbmFibGVkfSgke3RoaXMuX1EoKX0ke3RoaXMuX25Db2RlKCdlbmFibGVkJywgdW5kZWZpbmVkKX0ke3RoaXMuX1EoKX0pYDsKCgkJCWlmICh0aGlzLl9fZmllbGRBZ2dyZWdhdGVzLmNvZGUpIHNxbCArPSBgJHtzcWw9PSgnc2VsZWN0ICcpPycnOicsJ30gJHt0aGlzLl9fZmllbGRBZ2dyZWdhdGVzLmNvZGV9KCR7dGhpcy5fUSgpfSR7dGhpcy5fbkNvZGUoJ2NvZGUnLCB1bmRlZmluZWQpfSR7dGhpcy5fUSgpfSlgOwoKCQkJaWYgKHRoaXMuX19maWVsZEFnZ3JlZ2F0ZXMub3JkZXIpIHNxbCArPSBgJHtzcWw9PSgnc2VsZWN0ICcpPycnOicsJ30gJHt0aGlzLl9fZmllbGRBZ2dyZWdhdGVzLm9yZGVyfSgke3RoaXMuX1EoKX0ke3RoaXMuX25Db2RlKCdvcmRlcicsIHVuZGVmaW5lZCl9JHt0aGlzLl9RKCl9KWA7CgoJCQlpZiAodGhpcy5fX2ZpZWxkQWdncmVnYXRlcy5kYXRlKSBzcWwgKz0gYCR7c3FsPT0oJ3NlbGVjdCAnKT8nJzonLCd9ICR7dGhpcy5fX2ZpZWxkQWdncmVnYXRlcy5kYXRlfSgke3RoaXMuX1EoKX0ke3RoaXMuX25Db2RlKCdkYXRlJywgdW5kZWZpbmVkKX0ke3RoaXMuX1EoKX0pYDsKCgkJCWlmICh0aGlzLl9fZmllbGRBZ2dyZWdhdGVzLm5hbWUpIHNxbCArPSBgJHtzcWw9PSgnc2VsZWN0ICcpPycnOicsJ30gJHt0aGlzLl9fZmllbGRBZ2dyZWdhdGVzLm5hbWV9KCR7dGhpcy5fUSgpfSR7dGhpcy5fbkNvZGUoJ25hbWUnLCB1bmRlZmluZWQpfSR7dGhpcy5fUSgpfSlgOwoKCQkJaWYgKHRoaXMuX19maWVsZEFnZ3JlZ2F0ZXMudXNlcm5hbWUpIHNxbCArPSBgJHtzcWw9PSgnc2VsZWN0ICcpPycnOicsJ30gJHt0aGlzLl9fZmllbGRBZ2dyZWdhdGVzLnVzZXJuYW1lfSgke3RoaXMuX1EoKX0ke3RoaXMuX25Db2RlKCd1c2VybmFtZScsIHVuZGVmaW5lZCl9JHt0aGlzLl9RKCl9KWA7CgoJCQlpZiAodGhpcy5fX2ZpZWxkQWdncmVnYXRlcy5wYXNzd29yZCkgc3FsICs9IGAke3NxbD09KCdzZWxlY3QgJyk/Jyc6JywnfSAke3RoaXMuX19maWVsZEFnZ3JlZ2F0ZXMucGFzc3dvcmR9KCR7dGhpcy5fUSgpfSR7dGhpcy5fbkNvZGUoJ3Bhc3N3b3JkJywgdW5kZWZpbmVkKX0ke3RoaXMuX1EoKX0pYDsKCgkJfQoKCQlzcWwgKz0gYCBmcm9tICR7dFByZWZ9IGA7CgoJCU9iamVjdC5rZXlzKGhlYWRlci5qb2lucykuZm9yRWFjaChrID0+IHNxbCArPSBgbGVmdCBqb2luICR7dGhpcy5fUSgpfSR7aGVhZGVyLmpvaW5zW2tdLnRhYmxlfSR7dGhpcy5fUSgpfSBhcyAke3RoaXMuX1EoKX0ke2hlYWRlci5qb2luc1trXS50YWJsZX1fJHtrfSR7dGhpcy5fUSgpfSBvbiAke3RQcmVmfS4ke3RoaXMuX1EoKX0ke2t9aWQke3RoaXMuX1EoKX09JHt0aGlzLl9RKCl9JHtoZWFkZXIuam9pbnNba10udGFibGV9XyR7a30ke3RoaXMuX1EoKX0uJHt0aGlzLl9RKCl9JHt0aGlzLl9fY29uZmlnKCdpZEZpZWxkJywgJ19faWQnKX0ke3RoaXMuX1EoKX0gYCk7CgoJCXNxbCArPSBgIHdoZXJlIDE9MWA7CgoJCXNxbCA9IHRoaXMuX19leHBvcnQoewoJCQlzcWw6IHNxbAoJCX0sIHsKCQkJX2ZpZWxkczogKHRoaXMuX19zeW5jX29uKCkgfHwgdGhpcy5JZCA9PSB0aGlzLklkKSA/IFsnSWQnXSA6IHVuZGVmaW5lZCwKCQkJTnVsbDogdHJ1ZSwKCQkJX1RISVM6IG9iaiA9PiB7CgkJCQlpZiAoIXRoaXMuX1RISVMgfHwgIXRoaXMuX1RISVMubGVuZ3RoKSByZXR1cm47CgoJCQkJb2JqLnNxbCArPSBgIGFuZCAke3RQcmVmfS4ke3RoaXMuX1EoKX0ke3RoaXMuX19jb25maWcoJ2lkRmllbGQnLCAnX19pZCcpfSR7dGhpcy5fUSgpfSBgICsgKHRoaXMuX1RISVNfY29vcCB8fCAiSU4iKSArICIgKCIgKyB0aGlzLl9USElTLm1hcCh0ID0+IHQuX3RvU2VsZWN0U1FMKHQuX19jb25maWcoJ2lkRmllbGQnKSB8fCAnX19pZCcpKS5qb2luKCcgVU5JT04gQUxMICcpICsgIikiOwoJCQl9LAoJCQlJZDogb2JqID0+IG9iai5zcWwgKz0gYCBhbmQgJHt0UHJlZn0uJHt0aGlzLl9RKCl9JHt0aGlzLl9fY29uZmlnKCdpZEZpZWxkJywgJ19faWQnKX0ke3RoaXMuX1EoKX09JyR7dGhpcy5JZH0nYCwKCgkJCWFjdGl2ZTogKG9iaiwgdiwgZWFDb2RlID0gdGhpcy5fbkNvZGUoJ2FjdGl2ZScsIHVuZGVmaW5lZCkpID0+IHsKCQkJCWlmICghdGhpcy5fYWN0aXZlX3NldCkgcmV0dXJuOwoKCQkJCW9iai5zcWwgKz0gYCBhbmQgJHt0UHJlZn0uJHt0aGlzLl9RKCl9JHtlYUNvZGV9JHt0aGlzLl9RKCl9IGAgKyAiPSIgKyAiICI7CgoJCQkJaWYgKHR5cGVvZih2KSA9PT0gImJvb2xlYW4iKSB7CgkJCQkJb2JqLnNxbCArPSAiJyIgKyAodiA/ICIxIiA6ICIwIikgKyAiJyI7CgkJCQkJcmV0dXJuOwoJCQkJfQoKCQkJCWlmICh2ICYmIHYuRW50aXR5Q2xhc3MpIHsKCQkJCQlvYmouc3FsICs9ICIoIiArIHYuX3RvU2VsZWN0U1FMKCkgKyAiKSI7CgkJCQl9IGVsc2UgewoJCQkJCW9iai5zcWwgKz0gIiciICsgdiArICInIjsKCQkJCX0KCQkJfSwKCgkJCWVuYWJsZWQ6IChvYmosIHYsIGVhQ29kZSA9IHRoaXMuX25Db2RlKCdlbmFibGVkJywgdW5kZWZpbmVkKSkgPT4gewoJCQkJaWYgKCF0aGlzLl9lbmFibGVkX3NldCkgcmV0dXJuOwoKCQkJCW9iai5zcWwgKz0gYCBhbmQgJHt0UHJlZn0uJHt0aGlzLl9RKCl9JHtlYUNvZGV9JHt0aGlzLl9RKCl9IGAgKyAiPSIgKyAiICI7CgoJCQkJaWYgKHR5cGVvZih2KSA9PT0gImJvb2xlYW4iKSB7CgkJCQkJb2JqLnNxbCArPSAiJyIgKyAodiA/ICIxIiA6ICIwIikgKyAiJyI7CgkJCQkJcmV0dXJuOwoJCQkJfQoKCQkJCWlmICh2ICYmIHYuRW50aXR5Q2xhc3MpIHsKCQkJCQlvYmouc3FsICs9ICIoIiArIHYuX3RvU2VsZWN0U1FMKCkgKyAiKSI7CgkJCQl9IGVsc2UgewoJCQkJCW9iai5zcWwgKz0gIiciICsgdiArICInIjsKCQkJCX0KCQkJfSwKCgkJCWNvZGU6IChvYmosIHYsIGVhQ29kZSA9IHRoaXMuX25Db2RlKCdjb2RlJywgdW5kZWZpbmVkKSkgPT4gewoJCQkJaWYgKCF0aGlzLl9jb2RlX3NldCkgcmV0dXJuOwoKCQkJCW9iai5zcWwgKz0gYCBhbmQgJHt0UHJlZn0uJHt0aGlzLl9RKCl9JHtlYUNvZGV9JHt0aGlzLl9RKCl9IGAgKyAodGhpcy5fY29kZV9jb29wIHx8ICJMSUtFIikgKyAiICI7CgoJCQkJaWYgKHR5cGVvZih2KSA9PT0gInN0cmluZyIpIHsKCQkJCQlvYmouc3FsICs9ICInIiArICgodGhpcy5fY29kZV9jb29wID09ICJMSUtFIiB8fCAhdGhpcy5fY29kZV9jb29wKSA/ICIlIiA6ICIiKSArIHYgKyAoKHRoaXMuX2NvZGVfY29vcCA9PSAiTElLRSIgfHwgIXRoaXMuX2NvZGVfY29vcCkgPyAiJSIgOiAiIikgKyAiJyI7CgkJCQkJcmV0dXJuOwoJCQkJfQoKCQkJCWlmICh2ICYmIHYuRW50aXR5Q2xhc3MpIHsKCQkJCQlvYmouc3FsICs9ICIoIiArIHYuX3RvU2VsZWN0U1FMKCkgKyAiKSI7CgkJCQl9IGVsc2UgewoJCQkJCW9iai5zcWwgKz0gIiciICsgdiArICInIjsKCQkJCX0KCQkJfSwKCgkJCW9yZGVyOiAob2JqLCB2LCBlYUNvZGUgPSB0aGlzLl9uQ29kZSgnb3JkZXInLCB1bmRlZmluZWQpKSA9PiB7CgkJCQlpZiAoIXRoaXMuX29yZGVyX3NldCkgcmV0dXJuOwoKCQkJCW9iai5zcWwgKz0gYCBhbmQgJHt0UHJlZn0uJHt0aGlzLl9RKCl9JHtlYUNvZGV9JHt0aGlzLl9RKCl9IGAgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAiTElLRSIpICsgIiAiOwoKCQkJCWlmICh2ICYmIHYuRW50aXR5Q2xhc3MpIHsKCQkJCQlvYmouc3FsICs9ICIoIiArIHYuX3RvU2VsZWN0U1FMKCkgKyAiKSI7CgkJCQl9IGVsc2UgewoJCQkJCW9iai5zcWwgKz0gIiciICsgdiArICInIjsKCQkJCX0KCQkJfSwKCgkJCWRhdGU6IChvYmosIHYsIGVhQ29kZSA9IHRoaXMuX25Db2RlKCdkYXRlJywgdW5kZWZpbmVkKSkgPT4gewoJCQkJaWYgKCF0aGlzLl9kYXRlX3NldCkgcmV0dXJuOwoKCQkJCW9iai5zcWwgKz0gYCBhbmQgJHt0UHJlZn0uJHt0aGlzLl9RKCl9JHtlYUNvZGV9JHt0aGlzLl9RKCl9IGAgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICJMSUtFIikgKyAiICI7CgoJCQkJaWYgKHYgJiYgdi50b0lTT1N0cmluZykgewoJCQkJCWlmICh0aGlzLl9fY29uZmlnKCd0eXBlJykgPT0gJ3NxbGl0ZScpIHsKCQkJCQkJb2JqLnNxbCArPSAic3RyZnRpbWUoJyVzJywgJyIgKyB2LnRvSVNPU3RyaW5nKCkgKyAiJykiOwoJCQkJCX0gZWxzZSB7CgkJCQkJCW9iai5zcWwgKz0gIiciICsgdi50b0lTT1N0cmluZygpICsgIiciOwoJCQkJCX0KCQkJCQlyZXR1cm47CgkJCQl9CgoJCQkJaWYgKHYgJiYgdi5FbnRpdHlDbGFzcykgewoJCQkJCW9iai5zcWwgKz0gIigiICsgdi5fdG9TZWxlY3RTUUwoKSArICIpIjsKCQkJCX0gZWxzZSB7CgkJCQkJb2JqLnNxbCArPSAiJyIgKyB2ICsgIiciOwoJCQkJfQoJCQl9LAoKCQkJbmFtZTogKG9iaiwgdiwgZWFDb2RlID0gdGhpcy5fbkNvZGUoJ25hbWUnLCB1bmRlZmluZWQpKSA9PiB7CgkJCQlpZiAoIXRoaXMuX25hbWVfc2V0KSByZXR1cm47CgoJCQkJb2JqLnNxbCArPSBgIGFuZCAke3RQcmVmfS4ke3RoaXMuX1EoKX0ke2VhQ29kZX0ke3RoaXMuX1EoKX0gYCArICh0aGlzLl9uYW1lX2Nvb3AgfHwgIkxJS0UiKSArICIgIjsKCgkJCQlpZiAodHlwZW9mKHYpID09PSAic3RyaW5nIikgewoJCQkJCW9iai5zcWwgKz0gIiciICsgKCh0aGlzLl9uYW1lX2Nvb3AgPT0gIkxJS0UiIHx8ICF0aGlzLl9uYW1lX2Nvb3ApID8gIiUiIDogIiIpICsgdiArICgodGhpcy5fbmFtZV9jb29wID09ICJMSUtFIiB8fCAhdGhpcy5fbmFtZV9jb29wKSA/ICIlIiA6ICIiKSArICInIjsKCQkJCQlyZXR1cm47CgkJCQl9CgoJCQkJaWYgKHYgJiYgdi5FbnRpdHlDbGFzcykgewoJCQkJCW9iai5zcWwgKz0gIigiICsgdi5fdG9TZWxlY3RTUUwoKSArICIpIjsKCQkJCX0gZWxzZSB7CgkJCQkJb2JqLnNxbCArPSAiJyIgKyB2ICsgIiciOwoJCQkJfQoJCQl9LAoKCQkJcmVtYXJrOiAob2JqLCB2LCBlYUNvZGUgPSB0aGlzLl9uQ29kZSgncmVtYXJrJywgdW5kZWZpbmVkKSkgPT4gewoJCQkJaWYgKCF0aGlzLl9yZW1hcmtfc2V0KSByZXR1cm47CgoJCQkJcmV0dXJuOwoKCQkJCWlmICh2ICYmIHYuRW50aXR5Q2xhc3MpIHsKCQkJCQlvYmouc3FsICs9ICIoIiArIHYuX3RvU2VsZWN0U1FMKCkgKyAiKSI7CgkJCQl9IGVsc2UgewoJCQkJCW9iai5zcWwgKz0gIiciICsgdiArICInIjsKCQkJCX0KCQkJfSwKCgkJCXVzZXJuYW1lOiAob2JqLCB2LCBlYUNvZGUgPSB0aGlzLl9uQ29kZSgndXNlcm5hbWUnLCB1bmRlZmluZWQpKSA9PiB7CgkJCQlpZiAoIXRoaXMuX3VzZXJuYW1lX3NldCkgcmV0dXJuOwoKCQkJCW9iai5zcWwgKz0gYCBhbmQgJHt0UHJlZn0uJHt0aGlzLl9RKCl9JHtlYUNvZGV9JHt0aGlzLl9RKCl9IGAgKyAodGhpcy5fdXNlcm5hbWVfY29vcCB8fCAiTElLRSIpICsgIiAiOwoKCQkJCWlmICh0eXBlb2YodikgPT09ICJzdHJpbmciKSB7CgkJCQkJb2JqLnNxbCArPSAiJyIgKyAoKHRoaXMuX3VzZXJuYW1lX2Nvb3AgPT0gIkxJS0UiIHx8ICF0aGlzLl91c2VybmFtZV9jb29wKSA/ICIlIiA6ICIiKSArIHYgKyAoKHRoaXMuX3VzZXJuYW1lX2Nvb3AgPT0gIkxJS0UiIHx8ICF0aGlzLl91c2VybmFtZV9jb29wKSA/ICIlIiA6ICIiKSArICInIjsKCQkJCQlyZXR1cm47CgkJCQl9CgoJCQkJaWYgKHYgJiYgdi5FbnRpdHlDbGFzcykgewoJCQkJCW9iai5zcWwgKz0gIigiICsgdi5fdG9TZWxlY3RTUUwoKSArICIpIjsKCQkJCX0gZWxzZSB7CgkJCQkJb2JqLnNxbCArPSAiJyIgKyB2ICsgIiciOwoJCQkJfQoJCQl9LAoKCQkJcGFzc3dvcmQ6IChvYmosIHYsIGVhQ29kZSA9IHRoaXMuX25Db2RlKCdwYXNzd29yZCcsIHVuZGVmaW5lZCkpID0+IHsKCQkJCWlmICghdGhpcy5fcGFzc3dvcmRfc2V0KSByZXR1cm47CgoJCQkJb2JqLnNxbCArPSBgIGFuZCAke3RQcmVmfS4ke3RoaXMuX1EoKX0ke2VhQ29kZX0ke3RoaXMuX1EoKX0gYCArICh0aGlzLl9wYXNzd29yZF9jb29wIHx8ICJMSUtFIikgKyAiICI7CgoJCQkJaWYgKHR5cGVvZih2KSA9PT0gInN0cmluZyIpIHsKCQkJCQlvYmouc3FsICs9ICInIiArICgodGhpcy5fcGFzc3dvcmRfY29vcCA9PSAiTElLRSIgfHwgIXRoaXMuX3Bhc3N3b3JkX2Nvb3ApID8gIiUiIDogIiIpICsgdiArICgodGhpcy5fcGFzc3dvcmRfY29vcCA9PSAiTElLRSIgfHwgIXRoaXMuX3Bhc3N3b3JkX2Nvb3ApID8gIiUiIDogIiIpICsgIiciOwoJCQkJCXJldHVybjsKCQkJCX0KCgkJCQlpZiAodiAmJiB2LkVudGl0eUNsYXNzKSB7CgkJCQkJb2JqLnNxbCArPSAiKCIgKyB2Ll90b1NlbGVjdFNRTCgpICsgIikiOwoJCQkJfSBlbHNlIHsKCQkJCQlvYmouc3FsICs9ICInIiArIHYgKyAiJyI7CgkJCQl9CgkJCX0sCgoJCX0sICJfdG9TZWxlY3RTUUwiLCBmaWVsZHMpLnNxbDsKCgkJaWYgKHRoaXMuX19maWVsZEdyb3VwcykgewoJCQlpZiAoT2JqZWN0LmtleXModGhpcy5fX2ZpZWxkR3JvdXBzKS5sZW5ndGgpIHNxbCArPSAiIGdyb3VwIGJ5ICI7CgoJCQlpZiAodGhpcy5fX2ZpZWxkR3JvdXBzLmFjdGl2ZSkgc3FsICs9IGAke3RoaXMuX1EoKX0ke3RoaXMuX25Db2RlKCdhY3RpdmUnLCB1bmRlZmluZWQpfSR7dGhpcy5fUSgpfSAke3RoaXMuX19maWVsZEdyb3Vwcy5hY3RpdmV9YDsKCgkJCWlmICh0aGlzLl9fZmllbGRHcm91cHMuZW5hYmxlZCkgc3FsICs9IGAke3RoaXMuX1EoKX0ke3RoaXMuX25Db2RlKCdlbmFibGVkJywgdW5kZWZpbmVkKX0ke3RoaXMuX1EoKX0gJHt0aGlzLl9fZmllbGRHcm91cHMuZW5hYmxlZH1gOwoKCQkJaWYgKHRoaXMuX19maWVsZEdyb3Vwcy5jb2RlKSBzcWwgKz0gYCR7dGhpcy5fUSgpfSR7dGhpcy5fbkNvZGUoJ2NvZGUnLCB1bmRlZmluZWQpfSR7dGhpcy5fUSgpfSAke3RoaXMuX19maWVsZEdyb3Vwcy5jb2RlfWA7CgoJCQlpZiAodGhpcy5fX2ZpZWxkR3JvdXBzLm9yZGVyKSBzcWwgKz0gYCR7dGhpcy5fUSgpfSR7dGhpcy5fbkNvZGUoJ29yZGVyJywgdW5kZWZpbmVkKX0ke3RoaXMuX1EoKX0gJHt0aGlzLl9fZmllbGRHcm91cHMub3JkZXJ9YDsKCgkJCWlmICh0aGlzLl9fZmllbGRHcm91cHMuZGF0ZSkgc3FsICs9IGAke3RoaXMuX1EoKX0ke3RoaXMuX25Db2RlKCdkYXRlJywgdW5kZWZpbmVkKX0ke3RoaXMuX1EoKX0gJHt0aGlzLl9fZmllbGRHcm91cHMuZGF0ZX1gOwoKCQkJaWYgKHRoaXMuX19maWVsZEdyb3Vwcy5uYW1lKSBzcWwgKz0gYCR7dGhpcy5fUSgpfSR7dGhpcy5fbkNvZGUoJ25hbWUnLCB1bmRlZmluZWQpfSR7dGhpcy5fUSgpfSAke3RoaXMuX19maWVsZEdyb3Vwcy5uYW1lfWA7CgoJCQlpZiAodGhpcy5fX2ZpZWxkR3JvdXBzLnVzZXJuYW1lKSBzcWwgKz0gYCR7dGhpcy5fUSgpfSR7dGhpcy5fbkNvZGUoJ3VzZXJuYW1lJywgdW5kZWZpbmVkKX0ke3RoaXMuX1EoKX0gJHt0aGlzLl9fZmllbGRHcm91cHMudXNlcm5hbWV9YDsKCgkJCWlmICh0aGlzLl9fZmllbGRHcm91cHMucGFzc3dvcmQpIHNxbCArPSBgJHt0aGlzLl9RKCl9JHt0aGlzLl9uQ29kZSgncGFzc3dvcmQnLCB1bmRlZmluZWQpfSR7dGhpcy5fUSgpfSAke3RoaXMuX19maWVsZEdyb3Vwcy5wYXNzd29yZH1gOwoKCQl9CgoJCWlmIChzcWwuZW5kc1dpdGgoIndoZXJlIDE9MSIpKSB7CgkJCS8vIHNxbCA9IHNxbC5yZXBsYWNlKCJ3aGVyZSAxPTEiLCAid2hlcmUgMT0wIik7CgkJfSBlbHNlIHsKCQkJc3FsID0gc3FsLnJlcGxhY2UoIndoZXJlIDE9MSBhbmQgIiwgIndoZXJlICIpOwoJCX0KCgkJc3FsID0gdHlwZW9mKHNxbEZvcm1hdHRlcikgIT09ICd1bmRlZmluZWQnID8gc3FsRm9ybWF0dGVyLmZvcm1hdChzcWwpIDogc3FsOwoJCXRoaXMubG9nKHVuZGVmaW5lZCwgJ190b1NlbGVjdFNRTCcsICdFbnRpdHlPYmplY3QnLCAwLCBzcWwpOwoKCQlyZXR1cm4gc3FsOwoJfQoKCV90b1BhdGhzKCkgewoJCWxldCByZXQgPSB0aGlzLl9fZXhwb3J0KHt9LCB7CgkJCV9USElTOiBvYmogPT4ge30sCgoJCX0sICJfdG9QYXRocyIpOwoJCS8vIHJldHVybiByZXQ7CgkJcmV0dXJuIE9iamVjdC5rZXlzKHJldCkubWFwKGsgPT4gKHsKCQkJW2tdOiByZXRba10KCQl9KSk7Cgl9CgoJX3RvVXBkYXRlU1FMKGZpZWxkcykgewoJCWxldCByZXRGaWVsZHMgPSB0aGlzLl90b0ZpZWxkc1NRTChmaWVsZHMpLm1hcChmID0+IHRoaXMuX1EoKSArIGYucmVwbGFjZSgvXC4vZywgJycpICsgdGhpcy5fUSgpKS5qb2luKCcsICcpOwoJCWxldCBzcWwgPSBgdXBkYXRlICR7dGhpcy5fUSgpfSR7dGhpcy5fbkNvZGUoKX0ke3RoaXMuX1EoKX0gc2V0IGAgKyBPYmplY3QuZW50cmllcyh0aGlzLl90b0RCT2JqZWN0KGZpZWxkcykpLm1hcCh2ID0+IHRoaXMuX1EoKSArIHZbMF0gKyB0aGlzLl9RKCkgKyAiPSIgKyB2WzFdKSArIGAgd2hlcmUgJHt0aGlzLl9RKCl9JHt0aGlzLl9fY29uZmlnKCdpZEZpZWxkJywgJ19faWQnKX0ke3RoaXMuX1EoKX09JyR7dGhpcy5JZH0nYDsgLy9gIHJldHVybmluZyAke3JldEZpZWxkc31gOwoJCXRoaXMubG9nKHVuZGVmaW5lZCwgJ190b1VwZGF0ZVNRTCcsICdFbnRpdHlPYmplY3QnLCAwLCBzcWwpOwoJCXJldHVybiBzcWw7Cgl9CgoJX3RvSW5zZXJ0U1FMKGZpZWxkcykgewoJCWxldCBvYmogPSB0aGlzLl90b0RCT2JqZWN0KGZpZWxkcyk7CgkJbGV0IHNxbCA9IGBpbnNlcnQgaW50byAke3RoaXMuX1EoKX0ke3RoaXMuX25Db2RlKCl9JHt0aGlzLl9RKCl9IChgICsgT2JqZWN0LmtleXMob2JqKS5tYXAoayA9PiB0aGlzLl9RKCkgKyBrICsgdGhpcy5fUSgpKSArICIpIHZhbHVlcyAoIiArIE9iamVjdC52YWx1ZXMob2JqKSArIGApYDsKCQl0aGlzLmxvZyh1bmRlZmluZWQsICdfdG9JbnNlcnRTUUwnLCAnRW50aXR5T2JqZWN0JywgMCwgc3FsKTsKCQlyZXR1cm4gc3FsOwoJfQoKCV9jb3B5RnJvbShvYmopIHsKCQlpZiAoIW9iaikgcmV0dXJuIG51bGw7CgkJcmV0dXJuIHRoaXMuX3JldmVydChvYmopOwoJfQoKCWFzeW5jIF9zdG9yZUVudGl0eUNsYXNzKGRlcHRoKSB7CgkJdHJ5IHsKCQkJaWYgKHR5cGVvZihkZXB0aCkgPT09ICJ1bmRlZmluZWQiKSBkZXB0aCA9IHRoaXMuX19jb25maWcoImNyZWF0ZSIpOwoJCQlpZiAoIWRlcHRoKSByZXR1cm47CgoJCQlsb3R0by5fc3RvcmVFbnRpdHlDbGFzcyA9IGxvdHRvLl9zdG9yZUVudGl0eUNsYXNzIHx8IHt9OwoJCQlpZiAobG90dG8uX3N0b3JlRW50aXR5Q2xhc3MuVXNlcikgcmV0dXJuOwoJCQlsb3R0by5fc3RvcmVFbnRpdHlDbGFzcy5Vc2VyID0gdHJ1ZTsKCgkJCXRoaXMubG9nKHVuZGVmaW5lZCwgJ19zdG9yZUVudGl0eUNsYXNzJywgJ0VudGl0eU9iamVjdCcsIDAsIGBzdG9yaW5nICcke3RoaXMuVG9vbC50eXBlLm5hbWV9JyBtb2RlbCB3aXRoIGRlcHRoICR7ZGVwdGh9YCk7CgoJCQlpZiAodGhpcy5Ub29sLnR5cGUubmFtZSA9PSAiU3FsREIiKSB7CgoJCQkJbGV0IHNxbCA9IG5ldyBsb3R0by5Vc2VyKCkKCgkJCQkJLl90b1NRTFRhYmxlKGRlcHRoKTsKCQkJCXRoaXMubG9nKHVuZGVmaW5lZCwgJ19zdG9yZUVudGl0eUNsYXNzJywgJ0VudGl0eU9iamVjdCcsIDAsIHNxbCk7CgkJCQlhd2FpdCB0aGlzLl9zcWwoc3FsKTsKCgkJCX0KCgkJfSBjYXRjaCAoZXgpIHsKCQkJdGhpcy5sb2codW5kZWZpbmVkLCAnX3N0b3JlRW50aXR5Q2xhc3MnLCAnRW50aXR5T2JqZWN0JywgMiwgZXgpOwoJCX0KCQlyZXR1cm4gdGhpczsKCX0KCglhc3luYyBEU0Nvbm5lY3QodG9vbCA9IHRoaXMuVG9vbCkgewoKCQl0cnkgewoJCQlpZiAoIXRvb2wpIHsKCQkJCXRoaXMubG9nKHVuZGVmaW5lZCwgJ0RTQ29ubmVjdCcsICdFbnRpdHlPYmplY3QnLCAyLCAiVG9vbCBpcyBudWxsIiwgdGhpcy5Ub29scy5sZW5ndGgsIGxvdHRvLlRvb2xzLmxlbmd0aCk7CgkJCQlyZXR1cm47CgkJCX0gZWxzZSBpZiAoIXRvb2wudHlwZSkgewoJCQkJdGhpcy5sb2codW5kZWZpbmVkLCAnRFNDb25uZWN0JywgJ0VudGl0eU9iamVjdCcsIDIsICJUb29sLnR5cGUgaXMgbnVsbCIsIHRvb2wsIHRoaXMuVG9vbHMubGVuZ3RoLCBsb3R0by5Ub29scy5sZW5ndGgpOwoJCQkJcmV0dXJuOwoJCQl9IGVsc2UgaWYgKHR5cGVvZih0b29sLmRiKSAhPT0gInVuZGVmaW5lZCIpIHsKCQkJCXRoaXMubG9nKHVuZGVmaW5lZCwgJ0RTQ29ubmVjdCcsICdFbnRpdHlPYmplY3QnLCAwLCAiVG9vbCBhbHJlYWR5IGNvbm5lY3RlZCEiKTsKCQkJCXJldHVybjsKCQkJfSBlbHNlIGlmIChsb3R0by5fbm9kZSAmJiAvKmxvdHRvLl9ub2RlLl9wYXJlbnRfc2V0ICYmICovIGxvdHRvLl9ub2RlLnBhcmVudCgpLl9zYW1lTm9kZShsb3R0by5fbm9kZS5wYXJlbnQoKSkpIHsKCQkJCXRoaXMubG9nKHVuZGVmaW5lZCwgJ0RTQ29ubmVjdCcsICdFbnRpdHlPYmplY3QnLCAwLCAiTm9kZSBoYXMgYSB2YWxpZCBwYXJlbnQsIG5vIGxvY2FsIFNRTCBwb3NzaWJsZSIpOwoJCQkJcmV0dXJuOwoJCQl9CgoJCQl0b29sLl9fZG1sU3RhdGVtZW50cyA9IHRvb2wuX19kbWxTdGF0ZW1lbnRzIHx8IFtdOwoKCQkJaWYgKHRvb2wudHlwZS5uYW1lID09ICJTcWxEQiIpIHsKCgkJCQlpZiAodHlwZW9mKGdsb2JhbCkgIT09ICd1bmRlZmluZWQnICYmIGdsb2JhbFt0aGlzLl9fY29uZmlnKCd0eXBlJywgbnVsbCwgewoJCQkJCQl0b29sOiB0b29sCgkJCQkJfSldKSB7CgkJCQkJaWYgKGdsb2JhbFt0aGlzLl9fY29uZmlnKCd0eXBlJywgbnVsbCwgewoJCQkJCQkJdG9vbDogdG9vbAoJCQkJCQl9KV0uRGF0YWJhc2UpIHsKCQkJCQkJdG9vbC5kYiA9IG5ldyBnbG9iYWxbdGhpcy5fX2NvbmZpZygndHlwZScsIG51bGwsIHRvb2wpXS5EYXRhYmFzZSh0aGlzLl9fY29uZmlnKCdkYXRhYmFzZScsIG51bGwsIHsKCQkJCQkJCXRvb2w6IHRvb2wKCQkJCQkJfSkgfHwgIi4vbG90dG8uZGIiKTsKCQkJCQl9IGVsc2UgaWYgKGdsb2JhbFt0aGlzLl9fY29uZmlnKCd0eXBlJywgbnVsbCwgewoJCQkJCQkJdG9vbDogdG9vbAoJCQkJCQl9KV0uY3JlYXRlQ29ubmVjdGlvbikgewoJCQkJCQl0b29sLmRiID0gZ2xvYmFsW3RoaXMuX19jb25maWcoJ3R5cGUnLCBudWxsLCB7CgkJCQkJCQl0b29sOiB0b29sCgkJCQkJCX0pXS5jcmVhdGVDb25uZWN0aW9uKHsKCQkJCQkJCWhvc3Q6IHRoaXMuX19jb25maWcoJ3NlcnZlcicsIG51bGwsIHsKCQkJCQkJCQl0b29sOiB0b29sCgkJCQkJCQl9KSwKCQkJCQkJCXVzZXI6IHRoaXMuX19jb25maWcoJ3VzZXJuYW1lJywgbnVsbCwgewoJCQkJCQkJCXRvb2w6IHRvb2wKCQkJCQkJCX0pLAoJCQkJCQkJcGFzc3dvcmQ6IHRoaXMuX19jb25maWcoJ3Bhc3N3b3JkJywgbnVsbCwgewoJCQkJCQkJCXRvb2w6IHRvb2wKCQkJCQkJCX0pLAoJCQkJCQkJZGF0YWJhc2U6IHRoaXMuX19jb25maWcoJ2RhdGFiYXNlJywgbnVsbCwgewoJCQkJCQkJCXRvb2w6IHRvb2wKCQkJCQkJCX0pIHx8ICJsb3R0byIsCgkJCQkJCX0pOwoJCQkJCX0gZWxzZSBpZiAoZ2xvYmFsW3RoaXMuX19jb25maWcoJ3R5cGUnLCBudWxsLCB7CgkJCQkJCQl0b29sOiB0b29sCgkJCQkJCX0pXS5DbGllbnQpIHsKCQkJCQkJdG9vbC5kYiA9IG5ldyBnbG9iYWxbdGhpcy5fX2NvbmZpZygndHlwZScsIG51bGwsIHsKCQkJCQkJCXRvb2w6IHRvb2wKCQkJCQkJfSldLkNsaWVudCh0aGlzLl9fY29uZmlnKCdjb25uc3RyJywgbnVsbCwgewoJCQkJCQkJdG9vbDogdG9vbAoJCQkJCQl9KSk7CgkJCQkJCWF3YWl0IHRvb2wuZGIuY29ubmVjdCgpOwoJCQkJCX0KCQkJCX0gZWxzZSBpZiAodHlwZW9mKGdsb2JhbCkgPT09ICd1bmRlZmluZWQnICYmIHRoaXMuX19jb25maWcoJ3R5cGUnLCBudWxsLCB7CgkJCQkJCXRvb2w6IHRvb2wKCQkJCQl9KSA9PT0gJ3NxbGl0ZScpIHsKCQkJCQkvLyBzcWxpdGUgaW4gYnJvd3NlcgoJCQkJCXRvb2wuZGIgPSBuZXcgU1FMLkRhdGFiYXNlKCk7CgkJCQl9CgoJCQkJYXdhaXQgdGhpcy5fc3RvcmVFbnRpdHlDbGFzcygpOwoJCQl9CgoJCX0gY2F0Y2ggKGV4KSB7CgkJCXRoaXMubG9nKHVuZGVmaW5lZCwgJ0RTQ29ubmVjdCcsICdFbnRpdHlPYmplY3QnLCAyLCBleCk7CgkJfQoJCXJldHVybiB0aGlzOwoKCX0KCS8qIEVuZDogVXRpbCBmdW5jdGlvbnMgKi8KCglfbWF0Y2hlcyhxdWVyeSkgewoJCXRyeSB7CgkJCWlmICghcXVlcnkgfHwgIXF1ZXJ5LkVudGl0eUNsYXNzIHx8IHF1ZXJ5LkVudGl0eUNsYXNzLk5hbWUgIT0gIlVzZXIiKSByZXR1cm4gZmFsc2U7CgoJCQlsZXQgb01hdGNoID0gdGhpcy5fX2V4cG9ydCh7fSwgewoJCQkJRnVsbDogdHJ1ZSwKCQkJCU51bGw6IHRydWUsCgkJCQlJZDogKG9iaiwgdikgPT4gb2JqLl9pZCA9IHRoaXMuSWQgPT0gcXVlcnkuSWQsCgoJCQkJYWN0aXZlOiAob2JqLCB2KSA9PiB7CgoJCQkJCW9iai5hY3RpdmUgPSB2ID09IHF1ZXJ5LmFjdGl2ZSgpOwoKCQkJCQlpZiAoCgkJCQkJCSh0aGlzLl9hY3RpdmVfc2V0ICYmICFxdWVyeS5fYWN0aXZlX3NldCkgfHwKCQkJCQkJZmFsc2UKCQkJCQkpIG9iai5hY3RpdmUgPSB0cnVlOwoKCQkJCQlpZiAoCgkJCQkJCSghdGhpcy5fYWN0aXZlX3NldCAmJiBxdWVyeS5fYWN0aXZlX3NldCkgfHwKCgkJCQkJCWZhbHNlCgkJCQkJKSBvYmouYWN0aXZlID0gZmFsc2U7CgkJCQl9LAoKCQkJCWVuYWJsZWQ6IChvYmosIHYpID0+IHsKCgkJCQkJb2JqLmVuYWJsZWQgPSB2ID09IHF1ZXJ5LmVuYWJsZWQoKTsKCgkJCQkJaWYgKAoJCQkJCQkodGhpcy5fZW5hYmxlZF9zZXQgJiYgIXF1ZXJ5Ll9lbmFibGVkX3NldCkgfHwKCQkJCQkJZmFsc2UKCQkJCQkpIG9iai5lbmFibGVkID0gdHJ1ZTsKCgkJCQkJaWYgKAoJCQkJCQkoIXRoaXMuX2VuYWJsZWRfc2V0ICYmIHF1ZXJ5Ll9lbmFibGVkX3NldCkgfHwKCgkJCQkJCWZhbHNlCgkJCQkJKSBvYmouZW5hYmxlZCA9IGZhbHNlOwoJCQkJfSwKCgkJCQljb2RlOiAob2JqLCB2KSA9PiB7CgoJCQkJCW9iai5jb2RlID0gdiA9PSBxdWVyeS5jb2RlKCk7CgoJCQkJCWlmICgKCQkJCQkJKHRoaXMuX2NvZGVfc2V0ICYmICFxdWVyeS5fY29kZV9zZXQpIHx8CgkJCQkJCWZhbHNlCgkJCQkJKSBvYmouY29kZSA9IHRydWU7CgoJCQkJCWlmICgKCQkJCQkJKCF0aGlzLl9jb2RlX3NldCAmJiBxdWVyeS5fY29kZV9zZXQpIHx8CgoJCQkJCQlmYWxzZQoJCQkJCSkgb2JqLmNvZGUgPSBmYWxzZTsKCQkJCX0sCgoJCQkJb3JkZXI6IChvYmosIHYpID0+IHsKCgkJCQkJb2JqLm9yZGVyID0gdiA9PSBxdWVyeS5vcmRlcigpOwoKCQkJCQlpZiAoCgkJCQkJCSh0aGlzLl9vcmRlcl9zZXQgJiYgIXF1ZXJ5Ll9vcmRlcl9zZXQpIHx8CgkJCQkJCWZhbHNlCgkJCQkJKSBvYmoub3JkZXIgPSB0cnVlOwoKCQkJCQlpZiAoCgkJCQkJCSghdGhpcy5fb3JkZXJfc2V0ICYmIHF1ZXJ5Ll9vcmRlcl9zZXQpIHx8CgoJCQkJCQlmYWxzZQoJCQkJCSkgb2JqLm9yZGVyID0gZmFsc2U7CgkJCQl9LAoKCQkJCWRhdGU6IChvYmosIHYpID0+IHsKCgkJCQkJb2JqLmRhdGUgPSB2ID09IHF1ZXJ5LmRhdGUoKTsKCgkJCQkJaWYgKAoJCQkJCQkodGhpcy5fZGF0ZV9zZXQgJiYgIXF1ZXJ5Ll9kYXRlX3NldCkgfHwKCQkJCQkJZmFsc2UKCQkJCQkpIG9iai5kYXRlID0gdHJ1ZTsKCgkJCQkJaWYgKAoJCQkJCQkoIXRoaXMuX2RhdGVfc2V0ICYmIHF1ZXJ5Ll9kYXRlX3NldCkgfHwKCgkJCQkJCWZhbHNlCgkJCQkJKSBvYmouZGF0ZSA9IGZhbHNlOwoJCQkJfSwKCgkJCQluYW1lOiAob2JqLCB2KSA9PiB7CgoJCQkJCW9iai5uYW1lID0gdiA9PSBxdWVyeS5uYW1lKCk7CgoJCQkJCWlmICgKCQkJCQkJKHRoaXMuX25hbWVfc2V0ICYmICFxdWVyeS5fbmFtZV9zZXQpIHx8CgkJCQkJCWZhbHNlCgkJCQkJKSBvYmoubmFtZSA9IHRydWU7CgoJCQkJCWlmICgKCQkJCQkJKCF0aGlzLl9uYW1lX3NldCAmJiBxdWVyeS5fbmFtZV9zZXQpIHx8CgoJCQkJCQlmYWxzZQoJCQkJCSkgb2JqLm5hbWUgPSBmYWxzZTsKCQkJCX0sCgoJCQkJcmVtYXJrOiAob2JqLCB2KSA9PiB7CgoJCQkJCW9iai5yZW1hcmsgPSB2ID09IHF1ZXJ5LnJlbWFyaygpOwoKCQkJCQlpZiAoCgkJCQkJCSh0aGlzLl9yZW1hcmtfc2V0ICYmICFxdWVyeS5fcmVtYXJrX3NldCkgfHwKCQkJCQkJZmFsc2UKCQkJCQkpIG9iai5yZW1hcmsgPSB0cnVlOwoKCQkJCQlpZiAoCgkJCQkJCSghdGhpcy5fcmVtYXJrX3NldCAmJiBxdWVyeS5fcmVtYXJrX3NldCkgfHwKCgkJCQkJCWZhbHNlCgkJCQkJKSBvYmoucmVtYXJrID0gZmFsc2U7CgkJCQl9LAoKCQkJCXVzZXJuYW1lOiAob2JqLCB2KSA9PiB7CgoJCQkJCW9iai51c2VybmFtZSA9IHYgPT0gcXVlcnkudXNlcm5hbWUoKTsKCgkJCQkJaWYgKAoJCQkJCQkodGhpcy5fdXNlcm5hbWVfc2V0ICYmICFxdWVyeS5fdXNlcm5hbWVfc2V0KSB8fAoJCQkJCQlmYWxzZQoJCQkJCSkgb2JqLnVzZXJuYW1lID0gdHJ1ZTsKCgkJCQkJaWYgKAoJCQkJCQkoIXRoaXMuX3VzZXJuYW1lX3NldCAmJiBxdWVyeS5fdXNlcm5hbWVfc2V0KSB8fAoKCQkJCQkJZmFsc2UKCQkJCQkpIG9iai51c2VybmFtZSA9IGZhbHNlOwoJCQkJfSwKCgkJCQlwYXNzd29yZDogKG9iaiwgdikgPT4gewoKCQkJCQlvYmoucGFzc3dvcmQgPSB2ID09IHF1ZXJ5LnBhc3N3b3JkKCk7CgoJCQkJCWlmICgKCQkJCQkJKHRoaXMuX3Bhc3N3b3JkX3NldCAmJiAhcXVlcnkuX3Bhc3N3b3JkX3NldCkgfHwKCQkJCQkJZmFsc2UKCQkJCQkpIG9iai5wYXNzd29yZCA9IHRydWU7CgoJCQkJCWlmICgKCQkJCQkJKCF0aGlzLl9wYXNzd29yZF9zZXQgJiYgcXVlcnkuX3Bhc3N3b3JkX3NldCkgfHwKCgkJCQkJCWZhbHNlCgkJCQkJKSBvYmoucGFzc3dvcmQgPSBmYWxzZTsKCQkJCX0sCgoJCQl9LCAiX21hdGNoZXMiKTsKCgkJCXRoaXMubG9nKHVuZGVmaW5lZCwgJ19tYXRjaGVzJywgJ0VudGl0eU9iamVjdCcsIDAsIG9NYXRjaCk7CgoJCQlyZXR1cm4gT2JqZWN0LmtleXMob01hdGNoKS5ldmVyeShrID0+IG9NYXRjaFtrXSk7CgkJfSBjYXRjaCAoZXgpIHsKCQkJdGhpcy5sb2codW5kZWZpbmVkLCAnX21hdGNoZXMnLCAnRW50aXR5T2JqZWN0JywgMiwgZXgpOwoJCX0KCX0KCglfbWF0Y2hpbmcocXVlcnkpIHsKCQl0cnkgewoJCQlsZXQgcmV0ID0gW107CgoJCQlsZXQgbWF0Y2hlcyA9IHRoaXMuX19leHBvcnQoe30sIHsKCgkJCX0sICJfbWF0Y2hpbmciKTsKCgkJCXRoaXMubG9nKHVuZGVmaW5lZCwgJ19tYXRjaGluZycsICdFbnRpdHlPYmplY3QnLCAwLCAibWF0Y2hlcyIsIG1hdGNoZXMpOwoKCQkJcmV0ID0gWy4uLm5ldyBTZXQoT2JqZWN0LmtleXMobWF0Y2hlcykubWFwKGsgPT4gbWF0Y2hlc1trXSkuZmxhdCgpKV0uZmlsdGVyKG0gPT4gbSAhPSBxdWVyeSk7CgoJCQl0aGlzLmxvZyh1bmRlZmluZWQsICdfbWF0Y2hpbmcnLCAnRW50aXR5T2JqZWN0JywgMCwgInJldCIsIHJldCk7CgkJCXJldHVybiByZXQ7CgkJfSBjYXRjaCAoZXgpIHsKCQkJdGhpcy5sb2codW5kZWZpbmVkLCAnX21hdGNoaW5nJywgJ0VudGl0eU9iamVjdCcsIDIsIGV4KTsKCQl9Cgl9CgoJX2RlUmVmZXJlbmNlKHJvb3QpIHsKCQl0cnkgewoJCQlpZiAoIXJvb3QpIHJvb3QgPSB0aGlzOwoKCQkJbGV0IGlzUXVlcnkgPSB0cnVlCgoJCQkJJiYKCQkJCSh0aGlzLl9hY3RpdmVfc2V0ID8gZmFsc2UgOiB0cnVlKQoKCQkJCSYmCgkJCQkodGhpcy5fZW5hYmxlZF9zZXQgPyBmYWxzZSA6IHRydWUpCgoJCQkJJiYKCQkJCSh0aGlzLl9jb2RlX3NldCA/IGZhbHNlIDogdHJ1ZSkKCgkJCQkmJgoJCQkJKHRoaXMuX29yZGVyX3NldCA/IGZhbHNlIDogdHJ1ZSkKCgkJCQkmJgoJCQkJKHRoaXMuX2RhdGVfc2V0ID8gZmFsc2UgOiB0cnVlKQoKCQkJCSYmCgkJCQkodGhpcy5fbmFtZV9zZXQgPyBmYWxzZSA6IHRydWUpCgoJCQkJJiYKCQkJCSh0aGlzLl9yZW1hcmtfc2V0ID8gZmFsc2UgOiB0cnVlKQoKCQkJCSYmCgkJCQkodGhpcy5fdXNlcm5hbWVfc2V0ID8gZmFsc2UgOiB0cnVlKQoKCQkJCSYmCgkJCQkodGhpcy5fcGFzc3dvcmRfc2V0ID8gZmFsc2UgOiB0cnVlKTsKCgkJCWlmIChyb290ICE9IHRoaXMgJiYgaXNRdWVyeSkgewoJCQkJbGV0IG15TWF0Y2hlcyA9IHJvb3QuX21hdGNoaW5nKHRoaXMpOwoJCQkJaWYgKCFteU1hdGNoZXMubGVuZ3RoKSByZXR1cm4gdGhpczsKCQkJCXRoaXMubG9nKHVuZGVmaW5lZCwgJ19kZVJlZmVyZW5jZScsICdFbnRpdHlPYmplY3QnLCAwLCAiUXVlcnkiLCBteU1hdGNoZXMubGVndGgpOwoJCQkJcmV0dXJuIG15TWF0Y2hlc1swXTsKCQkJfQoKCQkJdGhpcy5fX2V4cG9ydCh7fSwgewoKCQkJfSwgIl9kZVJlZmVyZW5jZSIpOwoKCQkJcmV0dXJuIHRoaXM7CgkJfSBjYXRjaCAoZXgpIHsKCQkJdGhpcy5sb2codW5kZWZpbmVkLCAnX2RlUmVmZXJlbmNlJywgJ0VudGl0eU9iamVjdCcsIDIsIGV4KTsKCQl9Cgl9CgoJX2Zyb21Eb2N1bWVudChvYmosIGJUb29sLCBiTm9OdWxsKSB7CgkJaWYgKCFvYmopIHJldHVybiB0aGlzOwoJCWlmIChvYmouX2Zyb21Eb2N1bWVudCkgcmV0dXJuIG9iajsKCgkJaWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykgewoJCQl0cnkgewoJCQkJb2JqID0gSlNPTi5wYXJzZShvYmopOwoJCQl9IGNhdGNoIChleCkgewoJCQkJdGhpcy5sb2codW5kZWZpbmVkLCAnX2Zyb21Eb2N1bWVudCcsICdFbnRpdHlPYmplY3QnLCAxLCAiSW52YWxpZCBKU09OIiwgb2JqKTsKCQkJfQoJCX0KCgkJdGhpcy5fX2ltcG9ydChvYmosIHsKCQkJX21hcDogYlRvb2wsCgkJCV9USElTOiBvYmogPT4gdGhpcy5USElTKG9iai5USElTLCBvYmouT1BFUkFUT1JTID8gb2JqLk9QRVJBVE9SUy5USElTIDogdW5kZWZpbmVkKSwKCQkJSWQ6IG9iaiA9PiB7CgkJCQl0aGlzLklkID0gb2JqW3RoaXMuX19jb25maWcoJ2lkRmllbGQnLCAnX19pZCcsIHsKCQkJCQl0b29sOiBvYmouX190b29sCgkJCQl9KV07CgkJCQlpZiAob2JqLl9fdG9vbCkgewoJCQkJCXRyeSB7CgkJCQkJCXRoaXMuVG9vbCA9IG9iai5fX3Rvb2w7CgkJCQkJfSBjYXRjaCAoZXgpIHsKCQkJCQkJdGhpcy5sb2codW5kZWZpbmVkLCAnX2Zyb21Eb2N1bWVudCcsICdFbnRpdHlPYmplY3QnLCAyLCBleCk7CgkJCQkJfQoJCQkJfQoJCQl9LAoKCQkJYWN0aXZlOiAob2JqLCB2LCBlYUNvZGUgPSAoYlRvb2wgPyB0aGlzLl9uQ29kZSgnYWN0aXZlJywgdW5kZWZpbmVkKSA6ICJhY3RpdmUiKSkgPT4gewoJCQkJaWYgKG9iai5PUEVSQVRPUlMgJiYgb2JqLk9QRVJBVE9SU1tlYUNvZGVdKSB7CgkJCQkJdGhpcy5fYWN0aXZlX2Nvb3AgPSBvYmouT1BFUkFUT1JTW2VhQ29kZV07CgkJCQl9CgoJCQkJbGV0IHJlZiA9IG9ialtlYUNvZGVdOwoJCQkJaWYgKHR5cGVvZihyZWYpID09PSAndW5kZWZpbmVkJykgcmV0dXJuOwoJCQkJaWYgKGJOb051bGwgJiYgcmVmID09PSBudWxsKSByZXR1cm47CgoJCQkJdGhpcy5hY3RpdmUocmVmKTsKCgkJCX0sCgoJCQllbmFibGVkOiAob2JqLCB2LCBlYUNvZGUgPSAoYlRvb2wgPyB0aGlzLl9uQ29kZSgnZW5hYmxlZCcsIHVuZGVmaW5lZCkgOiAiZW5hYmxlZCIpKSA9PiB7CgkJCQlpZiAob2JqLk9QRVJBVE9SUyAmJiBvYmouT1BFUkFUT1JTW2VhQ29kZV0pIHsKCQkJCQl0aGlzLl9lbmFibGVkX2Nvb3AgPSBvYmouT1BFUkFUT1JTW2VhQ29kZV07CgkJCQl9CgoJCQkJbGV0IHJlZiA9IG9ialtlYUNvZGVdOwoJCQkJaWYgKHR5cGVvZihyZWYpID09PSAndW5kZWZpbmVkJykgcmV0dXJuOwoJCQkJaWYgKGJOb051bGwgJiYgcmVmID09PSBudWxsKSByZXR1cm47CgoJCQkJdGhpcy5lbmFibGVkKHJlZik7CgoJCQl9LAoKCQkJY29kZTogKG9iaiwgdiwgZWFDb2RlID0gKGJUb29sID8gdGhpcy5fbkNvZGUoJ2NvZGUnLCB1bmRlZmluZWQpIDogImNvZGUiKSkgPT4gewoJCQkJaWYgKG9iai5PUEVSQVRPUlMgJiYgb2JqLk9QRVJBVE9SU1tlYUNvZGVdKSB7CgkJCQkJdGhpcy5fY29kZV9jb29wID0gb2JqLk9QRVJBVE9SU1tlYUNvZGVdOwoJCQkJfQoKCQkJCWxldCByZWYgPSBvYmpbZWFDb2RlXTsKCQkJCWlmICh0eXBlb2YocmVmKSA9PT0gJ3VuZGVmaW5lZCcpIHJldHVybjsKCQkJCWlmIChiTm9OdWxsICYmIHJlZiA9PT0gbnVsbCkgcmV0dXJuOwoKCQkJCXRoaXMuY29kZShyZWYpOwoKCQkJfSwKCgkJCW9yZGVyOiAob2JqLCB2LCBlYUNvZGUgPSAoYlRvb2wgPyB0aGlzLl9uQ29kZSgnb3JkZXInLCB1bmRlZmluZWQpIDogIm9yZGVyIikpID0+IHsKCQkJCWlmIChvYmouT1BFUkFUT1JTICYmIG9iai5PUEVSQVRPUlNbZWFDb2RlXSkgewoJCQkJCXRoaXMuX29yZGVyX2Nvb3AgPSBvYmouT1BFUkFUT1JTW2VhQ29kZV07CgkJCQl9CgoJCQkJbGV0IHJlZiA9IG9ialtlYUNvZGVdOwoJCQkJaWYgKHR5cGVvZihyZWYpID09PSAndW5kZWZpbmVkJykgcmV0dXJuOwoJCQkJaWYgKGJOb051bGwgJiYgcmVmID09PSBudWxsKSByZXR1cm47CgoJCQkJdGhpcy5vcmRlcihyZWYpOwoKCQkJfSwKCgkJCWRhdGU6IChvYmosIHYsIGVhQ29kZSA9IChiVG9vbCA/IHRoaXMuX25Db2RlKCdkYXRlJywgdW5kZWZpbmVkKSA6ICJkYXRlIikpID0+IHsKCQkJCWlmIChvYmouT1BFUkFUT1JTICYmIG9iai5PUEVSQVRPUlNbZWFDb2RlXSkgewoJCQkJCXRoaXMuX2RhdGVfY29vcCA9IG9iai5PUEVSQVRPUlNbZWFDb2RlXTsKCQkJCX0KCgkJCQlsZXQgcmVmID0gb2JqW2VhQ29kZV07CgkJCQlpZiAodHlwZW9mKHJlZikgPT09ICd1bmRlZmluZWQnKSByZXR1cm47CgkJCQlpZiAoYk5vTnVsbCAmJiByZWYgPT09IG51bGwpIHJldHVybjsKCgkJCQlpZiAodGhpcy5Ub29sLnR5cGUubmFtZSA9PSAiU3FsREIiKSB7CgkJCQkJaWYgKHR5cGVvZihtb21lbnQpICE9PSAidW5kZWZpbmVkIiAmJiB0eXBlb2YodGhpcy5Ub29sLnN5c19wcm9wZXJ0aWVzKSAhPT0gInVuZGVmaW5lZCIpIHsKCQkJCQkJcmVmID0gbW9tZW50LnBhcnNlWm9uZShyZWYsIHRoaXMuVG9vbC5zeXNfcHJvcGVydGllc1siZ2xpZGUuc3lzLmRhdGVfZm9ybWF0Il0gKyAiICIgKyB0aGlzLlRvb2wuc3lzX3Byb3BlcnRpZXNbImdsaWRlLnN5cy50aW1lX2Zvcm1hdCJdLCB0aGlzLlRvb2wuc3lzX3Byb3BlcnRpZXNbImdsaWRlLnN5cy5kZWZhdWx0LnR6Il0pLnRvRGF0ZSgpOwoJCQkJCX0gZWxzZSB7CgkJCQkJCXJlZiA9IG5ldyBEYXRlKHJlZik7CgkJCQkJfQoJCQkJfSBlbHNlIHsKCQkJCQlpZiAodHlwZW9mKHJlZikgPT09ICdzdHJpbmcnKSB7CgkJCQkJCWlmIChyZWYuaW5kZXhPZignVCcpID4gMCkgewoJCQkJCQkJcmVmID0gRGF0ZS5wYXJzZShyZWYpOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJcmVmID0gRGF0ZS5wYXJzZShyZWYgKyAiIEdNVCIpOwoJCQkJCQl9CgkJCQkJfQoJCQkJCXJlZiA9IG5ldyBEYXRlKHJlZik7CgkJCQl9CgkJCQl0aGlzLmRhdGUocmVmKTsKCgkJCX0sCgoJCQluYW1lOiAob2JqLCB2LCBlYUNvZGUgPSAoYlRvb2wgPyB0aGlzLl9uQ29kZSgnbmFtZScsIHVuZGVmaW5lZCkgOiAibmFtZSIpKSA9PiB7CgkJCQlpZiAob2JqLk9QRVJBVE9SUyAmJiBvYmouT1BFUkFUT1JTW2VhQ29kZV0pIHsKCQkJCQl0aGlzLl9uYW1lX2Nvb3AgPSBvYmouT1BFUkFUT1JTW2VhQ29kZV07CgkJCQl9CgoJCQkJbGV0IHJlZiA9IG9ialtlYUNvZGVdOwoJCQkJaWYgKHR5cGVvZihyZWYpID09PSAndW5kZWZpbmVkJykgcmV0dXJuOwoJCQkJaWYgKGJOb051bGwgJiYgcmVmID09PSBudWxsKSByZXR1cm47CgoJCQkJdGhpcy5uYW1lKHJlZik7CgoJCQl9LAoKCQkJcmVtYXJrOiAob2JqLCB2LCBlYUNvZGUgPSAoYlRvb2wgPyB0aGlzLl9uQ29kZSgncmVtYXJrJywgdW5kZWZpbmVkKSA6ICJyZW1hcmsiKSkgPT4gewoJCQkJaWYgKG9iai5PUEVSQVRPUlMgJiYgb2JqLk9QRVJBVE9SU1tlYUNvZGVdKSB7CgkJCQkJdGhpcy5fcmVtYXJrX2Nvb3AgPSBvYmouT1BFUkFUT1JTW2VhQ29kZV07CgkJCQl9CgoJCQkJbGV0IHJlZiA9IG9ialtlYUNvZGVdOwoJCQkJaWYgKHR5cGVvZihyZWYpID09PSAndW5kZWZpbmVkJykgcmV0dXJuOwoJCQkJaWYgKGJOb051bGwgJiYgcmVmID09PSBudWxsKSByZXR1cm47CgoJCQkJdGhpcy5yZW1hcmsocmVmKTsKCgkJCX0sCgoJCQl1c2VybmFtZTogKG9iaiwgdiwgZWFDb2RlID0gKGJUb29sID8gdGhpcy5fbkNvZGUoJ3VzZXJuYW1lJywgdW5kZWZpbmVkKSA6ICJ1c2VybmFtZSIpKSA9PiB7CgkJCQlpZiAob2JqLk9QRVJBVE9SUyAmJiBvYmouT1BFUkFUT1JTW2VhQ29kZV0pIHsKCQkJCQl0aGlzLl91c2VybmFtZV9jb29wID0gb2JqLk9QRVJBVE9SU1tlYUNvZGVdOwoJCQkJfQoKCQkJCWxldCByZWYgPSBvYmpbZWFDb2RlXTsKCQkJCWlmICh0eXBlb2YocmVmKSA9PT0gJ3VuZGVmaW5lZCcpIHJldHVybjsKCQkJCWlmIChiTm9OdWxsICYmIHJlZiA9PT0gbnVsbCkgcmV0dXJuOwoKCQkJCXRoaXMudXNlcm5hbWUocmVmKTsKCgkJCX0sCgoJCQlwYXNzd29yZDogKG9iaiwgdiwgZWFDb2RlID0gKGJUb29sID8gdGhpcy5fbkNvZGUoJ3Bhc3N3b3JkJywgdW5kZWZpbmVkKSA6ICJwYXNzd29yZCIpKSA9PiB7CgkJCQlpZiAob2JqLk9QRVJBVE9SUyAmJiBvYmouT1BFUkFUT1JTW2VhQ29kZV0pIHsKCQkJCQl0aGlzLl9wYXNzd29yZF9jb29wID0gb2JqLk9QRVJBVE9SU1tlYUNvZGVdOwoJCQkJfQoKCQkJCWxldCByZWYgPSBvYmpbZWFDb2RlXTsKCQkJCWlmICh0eXBlb2YocmVmKSA9PT0gJ3VuZGVmaW5lZCcpIHJldHVybjsKCQkJCWlmIChiTm9OdWxsICYmIHJlZiA9PT0gbnVsbCkgcmV0dXJuOwoKCQkJCXRoaXMucGFzc3dvcmQocmVmKTsKCgkJCX0sCgoJCX0sICJfZnJvbURvY3VtZW50Iik7CgoJCXJldHVybiB0aGlzOwoJfQoKCV90b0RvY3VtZW50KGJUb29sLCBiRnVsbCwgYk51bGwpIHsKCQlsZXQgcmV0ID0ge307CgoJCWlmICghYlRvb2wpIHsKCQkJcmV0Ll9fZ2VuZXJhdGVkID0gbmV3IERhdGUoKTsKCQkJaWYgKHRoaXMuVG9vbC5uYW1lKSB7CgkJCQlyZXQuX190b29sID0gewoJCQkJCW5hbWU6IHRoaXMuVG9vbC5uYW1lLAoJCQkJCXR5cGU6IHsKCQkJCQkJbmFtZTogdGhpcy5Ub29sLnR5cGUubmFtZSwKCQkJCQl9CgkJCQl9OwoJCQl9CgkJCWlmIChsb3R0by5fbm9kZSkgewoJCQkJcmV0Ll9fbm9kZSA9IHsKCQkJCQljb2RlOiBsb3R0by5fbm9kZS5jb2RlKCkKCQkJCX07CgkJCX0KCQl9CgoJCXJldHVybiB0aGlzLl9fZXhwb3J0KHJldCwgewoJCQlGdWxsOiBiRnVsbCwKCQkJTnVsbDogYk51bGwsCgkJCV9tYXA6IGJUb29sLAoJCQlfVEhJUzogKG9iaiwgdikgPT4gewoJCQkJaWYgKGJUb29sKSByZXR1cm47CgkJCQlvYmouVEhJUyA9IHRoaXMuX1RISVMubWFwKHQgPT4gdC5fdG9Eb2N1bWVudChiVG9vbCwgYkZ1bGwsIGJOdWxsKSk7CgkJCQlvYmouT1BFUkFUT1JTID0gb2JqLk9QRVJBVE9SUyB8fCB7fTsKCQkJCW9iai5PUEVSQVRPUlMuVEhJUyA9IHRoaXMuX1RISVNfY29vcDsKCQkJfSwKCQkJSWQ6IChvYmosIHYpID0+IG9ialt0aGlzLl9fY29uZmlnKCdpZEZpZWxkJywgJ19faWQnKV0gPSB2LAoKCQkJImFjdGl2ZSI6IChvYmosIHYsIGVhQ29kZSA9IChiVG9vbCA/IHRoaXMuX25Db2RlKCdhY3RpdmUnLCB1bmRlZmluZWQpIDogImFjdGl2ZSIpKSA9PiB7CgoJCQkJb2JqW2VhQ29kZV0gPSB2OwoKCQkJCWlmICh0aGlzLl9hY3RpdmVfY29vcCkgewoJCQkJCW9iai5PUEVSQVRPUlMgPSBvYmouT1BFUkFUT1JTIHx8IHt9OwoJCQkJCW9iai5PUEVSQVRPUlNbZWFDb2RlXSA9IHRoaXMuX2FjdGl2ZV9jb29wOwoJCQkJfQoJCQl9LAoKCQkJImVuYWJsZWQiOiAob2JqLCB2LCBlYUNvZGUgPSAoYlRvb2wgPyB0aGlzLl9uQ29kZSgnZW5hYmxlZCcsIHVuZGVmaW5lZCkgOiAiZW5hYmxlZCIpKSA9PiB7CgoJCQkJb2JqW2VhQ29kZV0gPSB2OwoKCQkJCWlmICh0aGlzLl9lbmFibGVkX2Nvb3ApIHsKCQkJCQlvYmouT1BFUkFUT1JTID0gb2JqLk9QRVJBVE9SUyB8fCB7fTsKCQkJCQlvYmouT1BFUkFUT1JTW2VhQ29kZV0gPSB0aGlzLl9lbmFibGVkX2Nvb3A7CgkJCQl9CgkJCX0sCgoJCQkiY29kZSI6IChvYmosIHYsIGVhQ29kZSA9IChiVG9vbCA/IHRoaXMuX25Db2RlKCdjb2RlJywgdW5kZWZpbmVkKSA6ICJjb2RlIikpID0+IHsKCgkJCQlvYmpbZWFDb2RlXSA9IHY7CgoJCQkJaWYgKHRoaXMuX2NvZGVfY29vcCkgewoJCQkJCW9iai5PUEVSQVRPUlMgPSBvYmouT1BFUkFUT1JTIHx8IHt9OwoJCQkJCW9iai5PUEVSQVRPUlNbZWFDb2RlXSA9IHRoaXMuX2NvZGVfY29vcDsKCQkJCX0KCQkJfSwKCgkJCSJvcmRlciI6IChvYmosIHYsIGVhQ29kZSA9IChiVG9vbCA/IHRoaXMuX25Db2RlKCdvcmRlcicsIHVuZGVmaW5lZCkgOiAib3JkZXIiKSkgPT4gewoKCQkJCW9ialtlYUNvZGVdID0gdjsKCgkJCQlpZiAodGhpcy5fb3JkZXJfY29vcCkgewoJCQkJCW9iai5PUEVSQVRPUlMgPSBvYmouT1BFUkFUT1JTIHx8IHt9OwoJCQkJCW9iai5PUEVSQVRPUlNbZWFDb2RlXSA9IHRoaXMuX29yZGVyX2Nvb3A7CgkJCQl9CgkJCX0sCgoJCQkiZGF0ZSI6IChvYmosIHYsIGVhQ29kZSA9IChiVG9vbCA/IHRoaXMuX25Db2RlKCdkYXRlJywgdW5kZWZpbmVkKSA6ICJkYXRlIikpID0+IHsKCgkJCQlvYmpbZWFDb2RlXSA9IHYgPyB2LnRvSVNPU3RyaW5nKCkgOiBudWxsOwoJCQkJaWYgKHRoaXMuVG9vbC50eXBlLm5hbWUgPT0gIlNlcnZpY2VOb3ciKSBvYmpbZWFDb2RlXSA9IG9ialtlYUNvZGVdLnJlcGxhY2UoL1wuWzAtOV0qWi9nLCAnJyk7CgoJCQkJaWYgKHRoaXMuX2RhdGVfY29vcCkgewoJCQkJCW9iai5PUEVSQVRPUlMgPSBvYmouT1BFUkFUT1JTIHx8IHt9OwoJCQkJCW9iai5PUEVSQVRPUlNbZWFDb2RlXSA9IHRoaXMuX2RhdGVfY29vcDsKCQkJCX0KCQkJfSwKCgkJCSJuYW1lIjogKG9iaiwgdiwgZWFDb2RlID0gKGJUb29sID8gdGhpcy5fbkNvZGUoJ25hbWUnLCB1bmRlZmluZWQpIDogIm5hbWUiKSkgPT4gewoKCQkJCW9ialtlYUNvZGVdID0gdjsKCgkJCQlpZiAodGhpcy5fbmFtZV9jb29wKSB7CgkJCQkJb2JqLk9QRVJBVE9SUyA9IG9iai5PUEVSQVRPUlMgfHwge307CgkJCQkJb2JqLk9QRVJBVE9SU1tlYUNvZGVdID0gdGhpcy5fbmFtZV9jb29wOwoJCQkJfQoJCQl9LAoKCQkJInJlbWFyayI6IChvYmosIHYsIGVhQ29kZSA9IChiVG9vbCA/IHRoaXMuX25Db2RlKCdyZW1hcmsnLCB1bmRlZmluZWQpIDogInJlbWFyayIpKSA9PiB7CgoJCQkJb2JqW2VhQ29kZV0gPSB2OwoKCQkJCWlmICh0aGlzLl9yZW1hcmtfY29vcCkgewoJCQkJCW9iai5PUEVSQVRPUlMgPSBvYmouT1BFUkFUT1JTIHx8IHt9OwoJCQkJCW9iai5PUEVSQVRPUlNbZWFDb2RlXSA9IHRoaXMuX3JlbWFya19jb29wOwoJCQkJfQoJCQl9LAoKCQkJInVzZXJuYW1lIjogKG9iaiwgdiwgZWFDb2RlID0gKGJUb29sID8gdGhpcy5fbkNvZGUoJ3VzZXJuYW1lJywgdW5kZWZpbmVkKSA6ICJ1c2VybmFtZSIpKSA9PiB7CgoJCQkJb2JqW2VhQ29kZV0gPSB2OwoKCQkJCWlmICh0aGlzLl91c2VybmFtZV9jb29wKSB7CgkJCQkJb2JqLk9QRVJBVE9SUyA9IG9iai5PUEVSQVRPUlMgfHwge307CgkJCQkJb2JqLk9QRVJBVE9SU1tlYUNvZGVdID0gdGhpcy5fdXNlcm5hbWVfY29vcDsKCQkJCX0KCQkJfSwKCgkJCSJwYXNzd29yZCI6IChvYmosIHYsIGVhQ29kZSA9IChiVG9vbCA/IHRoaXMuX25Db2RlKCdwYXNzd29yZCcsIHVuZGVmaW5lZCkgOiAicGFzc3dvcmQiKSkgPT4gewoKCQkJCW9ialtlYUNvZGVdID0gdjsKCgkJCQlpZiAodGhpcy5fcGFzc3dvcmRfY29vcCkgewoJCQkJCW9iai5PUEVSQVRPUlMgPSBvYmouT1BFUkFUT1JTIHx8IHt9OwoJCQkJCW9iai5PUEVSQVRPUlNbZWFDb2RlXSA9IHRoaXMuX3Bhc3N3b3JkX2Nvb3A7CgkJCQl9CgkJCX0sCgoJCX0sICJfdG9Eb2N1bWVudCIsIGJUb29sLCBiRnVsbCwgYk51bGwpOwoJfQoKCWFzeW5jIGdldChuYW1lKSB7CgkJaWYgKCF0aGlzLklkKSByZXR1cm4gbnVsbDsKCQl2YXIgdCA9IG51bGw7CgkJJC5lYWNoKG5hbWUuc3BsaXQoJy4nKSwgKF8sIGYpID0+IHsKCQkJdCA9IHsKCQkJCUVudGl0eU9iamVjdDogdCA/IHsKCQkJCQlBY3RpdmU6IHRydWUsCgkJCQkJVmFsdWVFbnRpdGllczogW3RdCgkJCQl9IDogewoJCQkJCUFjdGl2ZTogdHJ1ZSwKCQkJCQlJZDogdGhpcy5JZAoJCQkJfSwKCQkJCUVudGl0eUF0dHJpYnV0ZTogewoJCQkJCU5hbWU6IGYsCgkJCQkJT1BFUkFUT1JTOiB7CgkJCQkJCU5hbWU6ICI9IgoJCQkJCX0KCQkJCX0KCQkJfTsKCQl9KTsKCQlyZXR1cm4gJC53aGVuKHRoaXMuc3IoKS5fKCJFbnRlcnByaXNlTWFuYWdlci5lbXNFbnRpdHlWYWx1ZUZpbmQiLCBudWxsLCB0KSkudGhlbihldiA9PiB7CgkJCXRoaXMubG9nKHVuZGVmaW5lZCwgJ2dldCcsICdFbnRpdHlPYmplY3QnLCAwLCBldik7CgkJCWlmIChldiA9PT0gbnVsbCkgcmV0dXJuIG51bGw7CgkJCWlmIChldi5FbnRpdHlBdHRyaWJ1dGUuSXNTdHJpbmcpIHJldHVybiBldi5TdHJpbmdWYWx1ZTsKCQkJaWYgKGV2LkVudGl0eUF0dHJpYnV0ZS5Jc0Zsb2F0KSByZXR1cm4gZXYuRmxvYXRWYWx1ZTsKCQkJaWYgKGV2LkVudGl0eUF0dHJpYnV0ZS5Jc0ludCkgcmV0dXJuIGV2LkludFZhbHVlOwoJCQlpZiAoZXYuRW50aXR5QXR0cmlidXRlLklzTG9uZykgcmV0dXJuIGV2LkxvbmdWYWx1ZTsKCQkJaWYgKGV2LkVudGl0eUF0dHJpYnV0ZS5Jc1RleHQpIHJldHVybiBldi5UZXh0VmFsdWU7CgkJCWlmIChldi5FbnRpdHlBdHRyaWJ1dGUuSXNCb29sKSByZXR1cm4gZXYuQm9vbFZhbHVlOwoKCQkJaWYgKCFldi5PYmplY3RWYWx1ZSkgcmV0dXJuIG51bGw7CgoJCQlyZXR1cm4gbmV3IGxvdHRvWyQuZ3JlcChsb3R0by5FbnRpdHlDbGFzc2VzLCBjID0+IGMuSWQgPT0gZXYuRW50aXR5QXR0cmlidXRlLkVudGl0eVR5cGVpZClbMF0uTmFtZS5yZXBsYWNlKC8gL2csICdfJyldKGV2Lk9iamVjdFZhbHVlLklkKTsKCQl9KTsKCX0KCgkvKiBTVEFSVDogc3IgZnVuY3Rpb24gY29waWVzICovCgoJLyogQ0xPTkU6OlNUQVJUOiBzci5fKCkgKi8KCV8oLi4ucGFyYW1zKSB7CgkJaWYgKHR5cGVvZih3aW5kb3cpICE9PSAidW5kZWZpbmVkIiAmJiB0eXBlb2Yod2luZG93LnNyKSAhPT0gInVuZGVmaW5lZCIpIHsKCQkJcmV0dXJuIHdpbmRvdy5zci5fKC4uLnBhcmFtcyk7CgkJfSBlbHNlIHsKCQkJcmV0dXJuIChhc3luYyAoZnVuLCBjYWxsQmFjaykgPT4gewoJCQkJaWYgKHRoaXMuc19FcnJvck1lc3NhZ2VzICYmIHRoaXMuc19FcnJvck1lc3NhZ2VzLmxlbmd0aCA+IDApIHsKCQkJCQlhbGVydCgKCQkJCQkJJ1RoZSBmb2xsb3dpbmcgZXJyb3JzIHdlcmUgZm91bmQgaW4geW91ciBkYXRhOlxuJyArCgkJCQkJCXRoaXMuc19FcnJvck1lc3NhZ2VzCgkJCQkJKTsKCQkJCQl0aGlzLnNfRXJyb3JNZXNzYWdlcyA9ICcnOwoJCQkJCXJldHVybiBudWxsOwoJCQkJfQoKCQkJCXRoaXMuYnVpbGRVUkwoKTsKCgkJCQlpZiAodHlwZW9mKGRvY3VtZW50KSAhPT0gInVuZGVmaW5lZCIpKAoJCQkJCXRoaXMuZkxvYWRpbmdTdGFydCB8fAoJCQkJCWZ1bmN0aW9uKCkgewoJCQkJCQlpZiAoZG9jdW1lbnQuYm9keSkgZG9jdW1lbnQuYm9keS5zdHlsZS5jdXJzb3IgPSAnd2FpdCc7CgkJCQkJfQoJCQkJKSgpOwoKCQkJCXZhciBhcmdzID0gQXJyYXkoKTsKCQkJCWZvciAodmFyIGkgPSAyOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7CgkJCQkJYXJnc1tpIC0gMl0gPSBhcmd1bWVudHNbaV07CgkJCQl9CgoJCQkJdmFyIHBvc3REYXRhID0gdGhpcy5wYXJhbShhcmdzKTsKCQkJCWlmIChmdW4uaW5kZXhPZignLicpIDwgMCkgewoJCQkJCWZ1biA9IHRoaXMuc3lzdGVtTmFtZSArICcuJyArIGZ1bjsKCQkJCX0gZWxzZSBpZiAoZnVuLmluZGV4T2YoJy4nKSA9PSAwKSB7CgkJCQkJLy8gYSBub24tbGF5ZXIgbWV0aG9kCgkJCQkJZnVuID0gZnVuLnN1YnN0cmluZygxKTsKCQkJCX0KCgkJCQlpZiAoY2FsbEJhY2sgJiYgdGhpcy5BY3RpdmVSZXF1ZXN0KSB7CgkJCQkJdGhpcy5BY3RpdmVSZXF1ZXN0ID0gbnVsbDsKCQkJCQkvL3JldHVybiBmYWxzZTsKCQkJCX0KCgkJCQl2YXIgaENvZGUgPSB0aGlzLmhhc2hDb2RlKAoJCQkJCWZ1bi5zdWJzdHJpbmcoZnVuLmluZGV4T2YoJy4nKSArIDEpICsgcG9zdERhdGEKCQkJCSk7CgoJCQkJdGhpcy5DUk5MID0gdGhpcy5DUk5MIHx8ICJcbiI7CgkJCQlwb3N0RGF0YSArPQoJCQkJCXRoaXMuQ1JOTCArCgkJCQkJdGhpcy5DUk5MICsKCQkJCQknPCEtLTxwaWQ+JyArCgkJCQkJaENvZGUgKwoJCQkJCSc8L3BpZD4tLT4nICsKCQkJCQl0aGlzLkNSTkw7CgoJCQkJaWYgKGZ1bi5pbmRleE9mKCdjbXNNZXRob2RSZXN1bHRGaW5kJykgPCAwKSB7CgkJCQkJLy8gYXZvaWQgb3ZlcndyaXRlIG9mIGFzeW5jIGNhbGxzCgkJCQkJdGhpcy5BY3RpdmVSZXF1ZXN0ID0gewoJCQkJCQlVUkw6IHRoaXMuc3JVUkwgKyAnJm5hbWU9JyArIGZ1biwKCQkJCQkJUG9zdERhdGE6IHBvc3REYXRhLAoJCQkJCQlEYXRlOiBuZXcgRGF0ZSgpLAoJCQkJCQlDYWxsQmFjazogY2FsbEJhY2ssCgkJCQkJCUNvbXBhbnk6IHR5cGVvZiBjb21wYW55ICE9PSAndW5kZWZpbmVkJyAmJiBjb21wYW55ID8gewoJCQkJCQkJQ29kZTogY29tcGFueS5Db2RlLAoJCQkJCQl9IDogbnVsbCwKCQkJCQkJVGV4dFJlc3BvbnNlOiBudWxsLAoJCQkJCQloYXNoOiBoQ29kZSwKCQkJCQl9OwoJCQkJfQoKCQkJCWlmICh0eXBlb2Yod2luZG93KSAhPT0gInVuZGVmaW5lZCIgJiYgIXRoaXMuYkxvY2FsKSB7CgkJCQkJLy8gbGl2ZQoJCQkJCXRyeSB7CgkJCQkJCXZhciBfdGhlVXJsID0KCQkJCQkJCSh0aGlzLlN0b3JlIHx8CgkJCQkJCQkJJy9zdG9yZS8nICsKCQkJCQkJCQkod2luZG93LmNvbXBhbnkgJiYgd2luZG93LmNvbXBhbnkuQ29kZSA/CgkJCQkJCQkJCXdpbmRvdy5jb21wYW55LkNvZGUgKyAnLycgOgoJCQkJCQkJCQknLycpKSArCgkJCQkJCQloQ29kZSArCgkJCQkJCQknLmpzP3JhbmQ9JyArCgkJCQkJCQlNYXRoLnJhbmRvbSgpOwoJCQkJCQlsZXQgcmVxdWVzdCA9IGF3YWl0IHRoaXMuY2FjaGVSZXN1bHQoKTsKCQkJCQkJdmFyIHJlc3BvbnNlVGV4dCA9IG51bGw7CgkJCQkJCWlmICghcmVxdWVzdCkgewoJCQkJCQkJdHJ5IHsKCQkJCQkJCQlyZXNwb25zZVRleHQgPSBhd2FpdCAkLmdldChfdGhlVXJsKTsKCQkJCQkJCX0gY2F0Y2ggKGV4KSB7fQoJCQkJCQl9IGVsc2UgewoJCQkJCQkJcmVzcG9uc2VUZXh0ID0gcmVxdWVzdC5UZXh0UmVzcG9uc2U7CgkJCQkJCX0KCQkJCQkJaWYgKCFyZXNwb25zZVRleHQpIHsKCQkJCQkJCWNvbnNvbGUubG9nKAoJCQkJCQkJCSdMaXZlIE1vZGUsIG5vIHJlc3BvbnNlIHRleHQgZm9yICcgKwoJCQkJCQkJCXRoaXMuQWN0aXZlUmVxdWVzdC5oYXNoICsKCQkJCQkJCQknIC0gJyArCgkJCQkJCQkJdGhpcy4kX1JFUVVFU1QoJ25hbWUnLCB0aGlzLkFjdGl2ZVJlcXVlc3QuVVJMKQoJCQkJCQkJKTsKCQkJCQkJCXJldHVybiBudWxsOwoJCQkJCQl9CgoJCQkJCQl2YXIgX3JldCA9IG51bGw7CgkJCQkJCXZhciBfZXhjZXB0aW9uID0gbnVsbDsKCQkJCQkJdHJ5IHsKCQkJCQkJCV9yZXQgPSB0aGlzLnJ1blNSU2NyaXB0KHJlc3BvbnNlVGV4dCk7CgkJCQkJCQlfZXhjZXB0aW9uID0gX3JldC5fZXhjZXB0aW9uOwoJCQkJCQkJaWYgKF9yZXQuc2VydmVyX3RpbWUpIHsKCQkJCQkJCQlsZXQgdGQgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKSAtIF9yZXQuc2VydmVyX3RpbWUuZ2V0VGltZSgpOwoJCQkJCQkJCXRyeSB7CgkJCQkJCQkJCXdpbmRvdy50aW1lRGlmZmVyZW5jZSA9IHRkOwoJCQkJCQkJCX0gY2F0Y2ggKGV4KSB7CgkJCQkJCQkJCWdsb2JhbC50aW1lRGlmZmVyZW5jZSA9IHRkOwoJCQkJCQkJCX0KCQkJCQkJCX0KCQkJCQkJfSBjYXRjaCAoZSkgewoJCQkJCQkJX2V4Y2VwdGlvbiA9IGU7CgkJCQkJCX0KCgkJCQkJCWlmICghX3JldCAmJiAhX2V4Y2VwdGlvbikgewoJCQkJCQkJcmV0dXJuIGF3YWl0IG51bGw7IC8vdGhpcy5kb0hlYWRsZXNzQ2FsbChjYWxsQmFjayk7CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQkvL3RoaXMuQWN0aXZlUmVxdWVzdCA9IG51bGw7CgkJCQkJCQlpZiAoY2FsbEJhY2sgIT0gbnVsbCkgewoJCQkJCQkJCXRyeSB7CgkJCQkJCQkJCWNhbGxCYWNrKAoJCQkJCQkJCQkJX3JldC5yZXQgfHwgKF9leGNlcHRpb24gPyByZXNwb25zZVRleHQgOiBudWxsKSwKCQkJCQkJCQkJCV9leGNlcHRpb24KCQkJCQkJCQkJKTsKCQkJCQkJCQl9IGNhdGNoIChlKSB7CgkJCQkJCQkJCXRoaXMuU2hvd0Vycm9yKAoJCQkJCQkJCQkJJ0Vycm9yIGluIENhbGxiYWNrOlxuXG4nICsKCQkJCQkJCQkJCWNhbGxCYWNrICsKCQkJCQkJCQkJCSdcblxuJyArCgkJCQkJCQkJCQllLm1lc3NhZ2UKCQkJCQkJCQkJKTsKCQkJCQkJCQl9CgkJCQkJCQl9CgkJCQkJCQkoCgkJCQkJCQkJd2luZG93LnNyLmZMb2FkaW5nRW5kIHx8CgkJCQkJCQkJKCgpID0+IHsKCQkJCQkJCQkJdGhpcy5yZXNldEN1cnNvcigpOwoJCQkJCQkJCX0pCgkJCQkJCQkpKCk7CgkJCQkJCQlyZXR1cm4gKAoJCQkJCQkJCShfcmV0ID8gX3JldC5yZXQgOiBudWxsKSB8fAoJCQkJCQkJCShfZXhjZXB0aW9uID8gcmVzcG9uc2VUZXh0IDogbnVsbCkKCQkJCQkJCSk7CgkJCQkJCX0KCQkJCQl9IGNhdGNoIChlKSB7CgkJCQkJCWNvbnNvbGUubG9nKGUpOwoJCQkJCQlyZXR1cm4gZmFsc2U7CgkJCQkJfQoJCQkJfSBlbHNlIHsKCQkJCQlyZXR1cm4gKGFzeW5jICgpID0+IHsKCQkJCQkJLyp0cnkgewoJCQkJCQkJbGV0IHNjb3BlID0gZnVuLnNwbGl0KCcuJylbMF0ucmVwbGFjZSgvKFthLXowLTldKShbQS1aXSkvZywgJyQxICQyJykucmVwbGFjZSgnICcsICcnKS50b0xvd2VyQ2FzZSgpOwoJCQkJCQkJbGV0IGFwaSA9IGZ1bi5zcGxpdCgnLicpWzFdLnJlcGxhY2UoLyhbYS16MC05XSkoW0EtWl0pL2csICckMSAkMicpLnNwbGl0KCcgJykuc2xpY2UoMSwgLTEpLmpvaW4oJycpLnJlcGxhY2UoJyAnLCAnJyk7CgkJCQkJCQlsZXQgZk5hbWUgPSBmdW4uc3BsaXQoJy4nKVsxXS5yZXBsYWNlKC8oW2EtejAtOV0pKFtBLVpdKS9nLCAnJDEgJDInKS5zcGxpdCgnICcpLnNsaWNlKC0xKVswXS50b0xvd2VyQ2FzZSgpLnJlcGxhY2UoJ2ZpbmRhbGwnLCAnZmluZEFsbCcpOwoJCQkJCQkJaWYgKHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyAmJiB3aW5kb3dbc2NvcGVdICYmIFsnaW5zZXJ0JywgJ2RlbGV0ZScsICd1cGRhdGUnLCAnZmluZCcsICdmaW5kQWxsJ10uaW5kZXhPZihmTmFtZSkgPiAtMSkgewoJCQkJCQkJCWxldCBzQ2FsbCA9IGBhd2FpdCBuZXcgJHtzY29wZX0uJHthcGl9KCkuJHtmTmFtZX0oLi4uYXJncylgOwoJCQkJCQkJCWxldCBvID0gbmV3IHdpbmRvd1tzY29wZV1bYXBpXSgpOwoJCQkJCQkJCU9iamVjdC5rZXlzKGFyZ3NbMF0pLmZpbHRlcihrID0+IGsgIT09ICJPUEVSQVRPUlMiKS5mb3JFYWNoKGsgPT4gewoJCQkJCQkJCQlvW2sucmVwbGFjZSgvKD86Xlx3fFtBLVpdfFxiXHd8XHMrKS9nLCAobWF0Y2gsIGluZGV4KSA9PiB7CgkJCQkJCQkJCQlpZiAoK21hdGNoID09PSAwKSByZXR1cm4gIiI7CgkJCQkJCQkJCQlyZXR1cm4gaW5kZXggPT09IDAgPyBtYXRjaC50b0xvd2VyQ2FzZSgpIDogbWF0Y2gudG9VcHBlckNhc2UoKTsKCQkJCQkJCQkJfSldKGFyZ3NbMF1ba10sIGFyZ3NbMF0uT1BFUkFUT1JTPy5ba10pOwoJCQkJCQkJCX0pOwoJCQkJCQkJCWNvbnNvbGUubG9nKHNDYWxsLCBvLl90b0RvY3VtZW50KCksIGFyZ3MpOwoJCQkJCQkJCS8vcmV0dXJuIGF3YWl0IG9bZk5hbWVdKCk7CgkJCQkJCQl9CgkJCQkJCX0gY2F0Y2ggKGV4KSB7CgkJCQkJCQljb25zb2xlLmxvZygiXygpIEV4Y2VwdGlvbjogIiArIGV4KTsKCQkJCQkJfSovCgoJCQkJCQlyZXR1cm4gYXdhaXQgdGhpcy5zZW5kWE1MKAoJCQkJCQkJdGhpcy5zclVSTCArICcmbmFtZT0nICsgZnVuLAoJCQkJCQkJcG9zdERhdGEsCgkJCQkJCQljYWxsQmFjawoJCQkJCQkpOwoJCQkJCX0pKCk7CgkJCQl9CgkJCX0pKC4uLnBhcmFtcyk7CgkJfQoJfQoJLyogQ0xPTkU6OkVORCAgOiBzci5fKCkgKi8KCgkvKiBDTE9ORTo6U1RBUlQ6IHNyLmJ1aWxkVVJMKCkgKi8KCWJ1aWxkVVJMKC4uLnBhcmFtcykgewoJCWlmICh0eXBlb2Yod2luZG93KSAhPT0gInVuZGVmaW5lZCIgJiYgdHlwZW9mKHdpbmRvdy5zcikgIT09ICJ1bmRlZmluZWQiKSB7CgkJCXJldHVybiB3aW5kb3cuc3IuYnVpbGRVUkwoLi4ucGFyYW1zKTsKCQl9IGVsc2UgewoJCQlyZXR1cm4gKChzclVSTCkgPT4gewoJCQkJaWYgKCFzclVSTCkgewoJCQkJCXRoaXMuc3JVUkwgPSB0aGlzLiRfUkVRVUVTVCgnc3InKTsKCQkJCQlpZiAoIXRoaXMuc3JVUkwpIHsKCQkJCQkJaWYgKHR5cGVvZih3aW5kb3cpID09PSAidW5kZWZpbmVkIikgewoJCQkJCQkJbGV0IGlwID0gdGhpcy5pcEFkZHJlc3MoKTsKCQkJCQkJCWlmIChpcCAmJiAoaXAuc3RhcnRzV2l0aCgiMTgyLjE2OC4iKSB8fCBpcCA9PSAiMTkyLjE2OC4xLjI1MyIgfHwgaXAgPT0gJzE5NS4xMTIuMjE1LjIxOCcpKSB7CgkJCQkJCQkJdGhpcy5zclVSTCA9ICJodHRwOi8vMTgyLjE2OC43MC44MCI7CgkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCXRoaXMuc3JVUkwgPSAiaHR0cDovL2Fyei5uYW1tb3VyLmNvbTo3MDgwIjsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCQl0aGlzLnNyVVJMICs9ICcvbWV0aG9kL1NlcnZpY2VSb3V0ZXIuYXNoeCc7CgkJCQkJfQoJCQkJfSBlbHNlIHsKCQkJCQl0aGlzLnNyVVJMID0gc3JVUkw7CgkJCQl9CgkJCQl0aGlzLnNyVVJMICs9ICc/c3J2ZXJzaW9uPTEnOwoJCQkJaWYgKHRoaXMuJF9SRVFVRVNUKCdnemlwJykpIHsKCQkJCQl0aGlzLnNyVVJMICs9ICcmZ3ppcD0nICsgdGhpcy4kX1JFUVVFU1QoJ2d6aXAnKTsKCQkJCX0gZWxzZSB7CgkJCQkJdGhpcy5zclVSTCArPSAnJmd6aXA9dHJ1ZSc7CgkJCQl9CgkJCQlpZiAodGhpcy5iQ2FjaGUpIHsKCQkJCQl0aGlzLnNyVVJMICs9ICcmY2FjaGU9JyArIHRoaXMuYkNhY2hlOwoJCQkJfQoJCQkJaWYgKCF0aGlzLiRfUkVRVUVTVCgncmFuZCcsIHRoaXMuc3JVUkwpKSB7CgkJCQkJdGhpcy5zclVSTCArPSAnJnJhbmQ9JyArIE1hdGgucmFuZG9tKCk7CgkJCQl9CgoJCQkJaWYgKHRoaXMuYkRlYnVnKSB7CgkJCQkJdGhpcy5zclVSTCArPSAnJkRFQlVHPXRydWUnOwoJCQkJfQoKCQkJCWlmICgKCQkJCQl0aGlzLmJBc3luYyAmJgoJCQkJCXRoaXMuYkxvY2FsICYmCgkJCQkJIXRoaXMuJF9SRVFVRVNUKCdhc3luYycsIHRoaXMuc3JVUkwpCgkJCQkpIHsKCQkJCQl0aGlzLnNyVVJMICs9ICcmYXN5bmM9dHJ1ZSc7CgkJCQkJaWYgKHRoaXMucnVuQWZ0ZXIpIHsKCQkJCQkJdGhpcy5zclVSTCArPSAnJnJ1bmFmdGVyPScgKyB0aGlzLnJ1bkFmdGVyOwoJCQkJCX0KCQkJCQl0aGlzLmJBc3luYyA9IGZhbHNlOwoJCQkJfQoKCQkJCS8vdGhpcy5TaG93RGVidWcoJ3RoaXMuc3JVUkw9JyArIHRoaXMuc3JVUkwpOwoKCQkJCXJldHVybiB0aGlzLnNyVVJMOwoJCQl9KSguLi5wYXJhbXMpOwoJCX0KCX0KCS8qIENMT05FOjpFTkQgIDogc3IuYnVpbGRVUkwoKSAqLwoKCS8qIENMT05FOjpTVEFSVDogc3IuJF9SRVFVRVNUKCkgKi8KCSRfUkVRVUVTVCguLi5wYXJhbXMpIHsKCQlpZiAodHlwZW9mKHdpbmRvdykgIT09ICJ1bmRlZmluZWQiICYmIHR5cGVvZih3aW5kb3cuc3IpICE9PSAidW5kZWZpbmVkIikgewoJCQlyZXR1cm4gd2luZG93LnNyLiRfUkVRVUVTVCguLi5wYXJhbXMpOwoJCX0gZWxzZSB7CgkJCXJldHVybiAoKGtleSwgdXJsKSA9PiB7CgkJCQlpZiAodHlwZW9mKHdpbmRvdykgPT09ICJ1bmRlZmluZWQiKSByZXR1cm4gbnVsbDsKCgkJCQlsZXQgcmV0ID0gdW5kZWZpbmVkOwoJCQkJaWYgKHVybCkgewoJCQkJCXRyeSB7CgkJCQkJCXJldCA9IG5ldyBVUkwodXJsKS5zZWFyY2hQYXJhbXMuZ2V0KGtleSk7CgkJCQkJfSBjYXRjaCAoZXgpIHsKCQkJCQkJdmFyIHJlZ2V4ID0gbmV3IFJlZ0V4cCgnW1xcP3wmXScgKyBrZXkgKyAnPShbXiYjXSopJyk7CgkJCQkJCXZhciByZXN1bHRzID0gcmVnZXguZXhlYygnPycgKyB1cmwuc3BsaXQoJz8nKVsxXSk7CgkJCQkJCXJldCA9IChyZXN1bHRzID09PSBudWxsKSA/ICcnIDogZGVjb2RlVVJJQ29tcG9uZW50KHJlc3VsdHNbMV0ucmVwbGFjZSgvXCsvZywgJyAnKSk7CgkJCQkJfQoJCQkJfSBlbHNlIHsKCQkJCQlyZXQgPSBuZXcgVVJMU2VhcmNoUGFyYW1zKHdpbmRvdy5sb2NhdGlvbi5zZWFyY2gpLmdldChrZXkpOwoJCQkJfQoKCQkJCXJldHVybiByZXQgPT09IG51bGwgPyAnJyA6IHJldDsKCQkJfSkoLi4ucGFyYW1zKTsKCQl9Cgl9CgkvKiBDTE9ORTo6RU5EICA6IHNyLiRfUkVRVUVTVCgpICovCgoJLyogQ0xPTkU6OlNUQVJUOiBzci5wYXJhbSgpICovCglwYXJhbSguLi5wYXJhbXMpIHsKCQlpZiAodHlwZW9mKHdpbmRvdykgIT09ICJ1bmRlZmluZWQiICYmIHR5cGVvZih3aW5kb3cuc3IpICE9PSAidW5kZWZpbmVkIikgewoJCQlyZXR1cm4gd2luZG93LnNyLnBhcmFtKC4uLnBhcmFtcyk7CgkJfSBlbHNlIHsKCQkJcmV0dXJuICgoYXJncykgPT4gewoJCQkJdGhpcy5DUk5MID0gdGhpcy5DUk5MIHx8ICJcbiI7CgkJCQl2YXIgcmV0ID0KCQkJCQknLyonICsKCQkJCQl0aGlzLkNSTkwgKwoJCQkJCSc8IVtDREFUQVsnICsKCQkJCQl0aGlzLkNSTkwgKwoJCQkJCSdQQVJBTUVURVJTJyArCgkJCQkJdGhpcy5DUk5MICsKCQkJCQknXV0+JyArCgkJCQkJdGhpcy5DUk5MICsKCQkJCQknKi8nICsKCQkJCQl0aGlzLkNSTkwgKwoJCQkJCXRoaXMuQ1JOTCArCgkJCQkJJzxwPicgKwoJCQkJCXRoaXMuQ1JOTDsKCQkJCWZvciAodmFyIGkgPSAwOyBpIDwgYXJncy5sZW5ndGg7IGkrKykgewoJCQkJCXZhciB4bWwgPSB0aGlzLl90b1hNTChhcmdzW2ldKTsKCQkJCQlpZiAoZmFsc2UpIHsKCQkJCQkJLy8geG1sIGNvbnRhaW5zIGNoYXJhY3RlcnMgdGhhdCB3b3VsZCBub3QgYXJyaXZlIHByb3Blcmx5IGFuZCBzaG91bGQgYmUgY29udmVydGVkIHRvIGJhc2U2NAoJCQkJCQl4bWwgPSBidG9hKHhtbCk7CgkJCQkJfQoJCQkJCXJldCArPSAnPHAnICsgaSArICc+JyArIHRoaXMuQ1JOTCArIHhtbCArICcnICsgdGhpcy5DUk5MOwoJCQkJCXJldCArPSAnPC9wJyArIGkgKyAnPicgKyB0aGlzLkNSTkw7CgkJCQl9CgkJCQlyZXQgKz0gJzwvcD4nICsgdGhpcy5DUk5MOwoJCQkJcmV0dXJuIHJldDsKCQkJfSkoLi4ucGFyYW1zKTsKCQl9Cgl9CgkvKiBDTE9ORTo6RU5EICA6IHNyLnBhcmFtKCkgKi8KCgkvKiBDTE9ORTo6U1RBUlQ6IHNyLl90b1hNTCgpICovCglfdG9YTUwoLi4ucGFyYW1zKSB7CgkJaWYgKHR5cGVvZih3aW5kb3cpICE9PSAidW5kZWZpbmVkIiAmJiB0eXBlb2Yod2luZG93LnNyKSAhPT0gInVuZGVmaW5lZCIpIHsKCQkJcmV0dXJuIHdpbmRvdy5zci5fdG9YTUwoLi4ucGFyYW1zKTsKCQl9IGVsc2UgewoJCQlyZXR1cm4gKChvLCBsZXZlbCkgPT4gewoJCQkJaWYgKCFsZXZlbCkgbGV2ZWwgPSAwOwoJCQkJdmFyIHMgPSAnJzsKCQkJCWlmIChvID09IG51bGwpIHJldHVybiBzOwoJCQkJc3dpdGNoICh0eXBlb2YgbykgewoJCQkJCWNhc2UgJ3N0cmluZyc6CgkJCQkJCXMgKz0gJzwhW0NEQVRBWycgKyBvICsgJ11dPic7CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgJ251bWJlcic6CgkJCQkJY2FzZSAnYm9vbGVhbic6CgkJCQkJCXMgKz0gby50b1N0cmluZygpOwoJCQkJCQlicmVhazsKCQkJCQljYXNlICdvYmplY3QnOgoJCQkJCQkvLyBEYXRlCgkJCQkJCWlmICgKCQkJCQkJCW8uY29uc3RydWN0b3IgJiYKCQkJCQkJCW8uY29uc3RydWN0b3IudG9TdHJpbmcoKS5pbmRleE9mKCdmdW5jdGlvbiBEYXRlKCknKSA+IC0xICYmCgkJCQkJCQlvLmNvbnN0cnVjdG9yLm5hbWUgPT0gIkRhdGUiCgkJCQkJCSkgewoJCQkJCQkJdmFyIHllYXIgPSBvLmdldFVUQ0Z1bGxZZWFyKCkudG9TdHJpbmcoKTsKCQkJCQkJCXZhciBtb250aCA9IChvLmdldFVUQ01vbnRoKCkgKyAxKS50b1N0cmluZygpOwoJCQkJCQkJbW9udGggPSBtb250aC5sZW5ndGggPT0gMSA/ICcwJyArIG1vbnRoIDogbW9udGg7CgkJCQkJCQl2YXIgZGF0ZSA9IG8uZ2V0VVRDRGF0ZSgpLnRvU3RyaW5nKCk7CgkJCQkJCQlkYXRlID0gZGF0ZS5sZW5ndGggPT0gMSA/ICcwJyArIGRhdGUgOiBkYXRlOwoJCQkJCQkJdmFyIGhvdXJzID0gby5nZXRVVENIb3VycygpLnRvU3RyaW5nKCk7CgkJCQkJCQlob3VycyA9IGhvdXJzLmxlbmd0aCA9PSAxID8gJzAnICsgaG91cnMgOiBob3VyczsKCQkJCQkJCXZhciBtaW51dGVzID0gby5nZXRVVENNaW51dGVzKCkudG9TdHJpbmcoKTsKCQkJCQkJCW1pbnV0ZXMgPSBtaW51dGVzLmxlbmd0aCA9PSAxID8gJzAnICsgbWludXRlcyA6IG1pbnV0ZXM7CgkJCQkJCQl2YXIgc2Vjb25kcyA9IG8uZ2V0VVRDU2Vjb25kcygpLnRvU3RyaW5nKCk7CgkJCQkJCQlzZWNvbmRzID0gc2Vjb25kcy5sZW5ndGggPT0gMSA/ICcwJyArIHNlY29uZHMgOiBzZWNvbmRzOwoJCQkJCQkJdmFyIG1pbGxpc2Vjb25kcyA9IG8uZ2V0VVRDTWlsbGlzZWNvbmRzKCkudG9TdHJpbmcoKTsKCQkJCQkJCXZhciB0em1pbnV0ZXMgPSBNYXRoLmFicyhvLmdldFRpbWV6b25lT2Zmc2V0KCkpOwoJCQkJCQkJdmFyIHR6aG91cnMgPSAwOwoJCQkJCQkJd2hpbGUgKHR6bWludXRlcyA+PSA2MCkgewoJCQkJCQkJCXR6aG91cnMrKzsKCQkJCQkJCQl0em1pbnV0ZXMgLT0gNjA7CgkJCQkJCQl9CgkJCQkJCQl0em1pbnV0ZXMgPQoJCQkJCQkJCXR6bWludXRlcy50b1N0cmluZygpLmxlbmd0aCA9PSAxID8KCQkJCQkJCQknMCcgKyB0em1pbnV0ZXMudG9TdHJpbmcoKSA6CgkJCQkJCQkJdHptaW51dGVzLnRvU3RyaW5nKCk7CgkJCQkJCQl0emhvdXJzID0KCQkJCQkJCQl0emhvdXJzLnRvU3RyaW5nKCkubGVuZ3RoID09IDEgPwoJCQkJCQkJCScwJyArIHR6aG91cnMudG9TdHJpbmcoKSA6CgkJCQkJCQkJdHpob3Vycy50b1N0cmluZygpOwoJCQkJCQkJdmFyIHRpbWV6b25lID0KCQkJCQkJCQkoby5nZXRUaW1lem9uZU9mZnNldCgpIDwgMCA/ICcrJyA6ICctJykgKwoJCQkJCQkJCXR6aG91cnMgKwoJCQkJCQkJCSc6JyArCgkJCQkJCQkJdHptaW51dGVzOwoJCQkJCQkJLy9zICs9IHllYXIgKyAiLSIgKyBtb250aCArICItIiArIGRhdGUgKyAiVCIgKyBob3VycyArICI6IiArIG1pbnV0ZXMgKyAiOiIgKyBzZWNvbmRzICsgIi4iICsgbWlsbGlzZWNvbmRzICsgdGltZXpvbmU7CgkJCQkJCQlzICs9CgkJCQkJCQkJbW9udGggKwoJCQkJCQkJCScvJyArCgkJCQkJCQkJZGF0ZSArCgkJCQkJCQkJJy8nICsKCQkJCQkJCQl5ZWFyICsKCQkJCQkJCQknICcgKwoJCQkJCQkJCWhvdXJzICsKCQkJCQkJCQknOicgKwoJCQkJCQkJCW1pbnV0ZXMgKwoJCQkJCQkJCSc6JyArCgkJCQkJCQkJc2Vjb25kczsKCQkJCQkJfQoJCQkJCQkvLyBBcnJheQoJCQkJCQllbHNlIGlmICgKCQkJCQkJCW8uY29uc3RydWN0b3IgJiYKCQkJCQkJCW8uY29uc3RydWN0b3IudG9TdHJpbmcoKS5pbmRleE9mKCdBcnJheSgpJykgPiAtMQoJCQkJCQkpIHsKCQkJCQkJCWZvciAodmFyIHAgaW4gbykgewoJCQkJCQkJCWlmIChwID09ICdPUEVSQVRPUlMnIHx8IHAgPT0gJ09SUycpIGNvbnRpbnVlOwoJCQkJCQkJCXMgKz0gJzxPYmplY3Q+JzsKCQkJCQkJCQlpZiAoIWlzTmFOKHApKSB7CgkJCQkJCQkJCS8vIGxpbmVhciBhcnJheQoJCQkJCQkJCQlpZiAob1twXSA9PSBudWxsKSB7CgkJCQkJCQkJCQkvLyBudWxsIGVudHJ5IGluIHRoZSBhcnJheQoJCQkJCQkJCQkJcyArPSAnPElkPjA8L0lkPic7CgkJCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJCQkvZnVuY3Rpb25ccysoXHcqKVxzKlwoL2dpLmV4ZWMoCgkJCQkJCQkJCQkJb1twXS5jb25zdHJ1Y3Rvci50b1N0cmluZygpCgkJCQkJCQkJCQkpOwoJCQkJCQkJCQkJdmFyIHR5cGUgPSBSZWdFeHAuJDE7CgkJCQkJCQkJCQlzd2l0Y2ggKHR5cGUpIHsKCQkJCQkJCQkJCQljYXNlICcnOgoJCQkJCQkJCQkJCQl0eXBlID0gdHlwZW9mIG9bcF07CgkJCQkJCQkJCQkJY2FzZSAnU3RyaW5nJzoKCQkJCQkJCQkJCQkJdHlwZSA9ICdzdHJpbmcnOwoJCQkJCQkJCQkJCQlicmVhazsKCQkJCQkJCQkJCQljYXNlICdOdW1iZXInOgoJCQkJCQkJCQkJCQl0eXBlID0gJ2ludCc7CgkJCQkJCQkJCQkJCWJyZWFrOwoJCQkJCQkJCQkJCWNhc2UgJ0Jvb2xlYW4nOgoJCQkJCQkJCQkJCQl0eXBlID0gJ2Jvb2wnOwoJCQkJCQkJCQkJCQlicmVhazsKCQkJCQkJCQkJCQljYXNlICdEYXRlJzoKCQkJCQkJCQkJCQkJdHlwZSA9ICdEYXRlVGltZSc7CgkJCQkJCQkJCQkJCWJyZWFrOwoJCQkJCQkJCQkJfQoJCQkJCQkJCQkJcyArPSB0aGlzLl90b1hNTChvW3BdLCBsZXZlbCsrKTsKCQkJCQkJCQkJfQoJCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJCS8vIGFzc29jaWF0aXZlIGFycmF5CgkJCQkJCQkJCXMgKz0KCQkJCQkJCQkJCSc8JyArCgkJCQkJCQkJCQlwICsKCQkJCQkJCQkJCXRoaXMuY29vcChvLCBwKSArCgkJCQkJCQkJCQknPicgKwoJCQkJCQkJCQkJdGhpcy5fdG9YTUwob1twXSwgbGV2ZWwrKykgKwoJCQkJCQkJCQkJJzwvJyArCgkJCQkJCQkJCQlwICsKCQkJCQkJCQkJCSc+JzsKCQkJCQkJCQl9CgkJCQkJCQkJcyArPSAnPC9PYmplY3Q+JyArIHRoaXMuQ1JOTDsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCQkvLyBPYmplY3Qgb3IgY3VzdG9tIGZ1bmN0aW9uCgkJCQkJCWVsc2UgewoJCQkJCQkJaWYgKG8gPT0gbnVsbCB8fCBvLklkID09IDApIHt9IGVsc2UgaWYgKGZhbHNlICYmIG8uSWQpIHsKCQkJCQkJCQkvLyB0aGlzIGlzIGNyZWF0aW5nIGEgcHJvYmxlbSwgYmV0dGVyIHNlbmQgYWxsIHRoZSBvYmplY3QKCQkJCQkJCQkvLyBkbyBub3Qgc2VuZCBvdGhlciBkYXRhIGlmIHdlIGhhdmUgYSB2YWx1ZSBmb3IgdGhlIElkCgkJCQkJCQkJcyArPSAnPElkPicgKyB0aGlzLl90b1hNTChvLklkLCBsZXZlbCsrKSArICc8L0lkPic7CgkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCWZvciAodmFyIHAgaW4gbykgewoJCQkJCQkJCQlpZiAocCA9PSAnT1BFUkFUT1JTJyB8fCBwID09ICdPUlMnKSBjb250aW51ZTsKCQkJCQkJCQkJcyArPQoJCQkJCQkJCQkJJzwnICsKCQkJCQkJCQkJCXAgKwoJCQkJCQkJCQkJdGhpcy5jb29wKG8sIHApICsKCQkJCQkJCQkJCXRoaXMuT1IobywgcCkgKwoJCQkJCQkJCQkJJz4nICsKCQkJCQkJCQkJCXRoaXMuX3RvWE1MKG9bcF0sIGxldmVsKyspICsKCQkJCQkJCQkJCSc8LycgKwoJCQkJCQkJCQkJcCArCgkJCQkJCQkJCQknPic7CgkJCQkJCQkJfQoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJCWJyZWFrOwoJCQkJfQoJCQkJcmV0dXJuIHM7CgkJCX0pKC4uLnBhcmFtcyk7CgkJfQoJfQoJLyogQ0xPTkU6OkVORCAgOiBzci5fdG9YTUwoKSAqLwoKCS8qIENMT05FOjpTVEFSVDogc3IuY29vcCgpICovCgljb29wKC4uLnBhcmFtcykgewoJCWlmICh0eXBlb2Yod2luZG93KSAhPT0gInVuZGVmaW5lZCIgJiYgdHlwZW9mKHdpbmRvdy5zcikgIT09ICJ1bmRlZmluZWQiKSB7CgkJCXJldHVybiB3aW5kb3cuc3IuY29vcCguLi5wYXJhbXMpOwoJCX0gZWxzZSB7CgkJCXJldHVybiAoKG8sIHApID0+IHsKCQkJCWlmICghby5PUEVSQVRPUlMgfHwgIW8uT1BFUkFUT1JTW3BdKSB7CgkJCQkJcmV0dXJuICcnOwoJCQkJfQoJCQkJcmV0dXJuICgKCQkJCQkiIGNvb3A9JyIgKwoJCQkJCXRoaXMubXlSZXBsYWNlKG8uT1BFUkFUT1JTW3BdLCBbJzwnLCAnPiddLCBbJyZsdDsnLCAnJmd0OyddKSArCgkJCQkJIiciCgkJCQkpOwoJCQl9KSguLi5wYXJhbXMpOwoJCX0KCX0KCS8qIENMT05FOjpFTkQgIDogc3IuY29vcCgpICovCgoJLyogQ0xPTkU6OlNUQVJUOiBzci5PUigpICovCglPUiguLi5wYXJhbXMpIHsKCQlpZiAodHlwZW9mKHdpbmRvdykgIT09ICJ1bmRlZmluZWQiICYmIHR5cGVvZih3aW5kb3cuc3IpICE9PSAidW5kZWZpbmVkIikgewoJCQlyZXR1cm4gd2luZG93LnNyLk9SKC4uLnBhcmFtcyk7CgkJfSBlbHNlIHsKCQkJcmV0dXJuICgobywgcCkgPT4gewoJCQkJcmV0dXJuIG8uT1JTICYmIG8uT1JTW3BdID8KCQkJCQkiIE9SPSciICsKCQkJCQl0aGlzLm15UmVwbGFjZShvLk9SU1twXSwgWyc8JywgJz4nXSwgWycmbHQ7JywgJyZndDsnXSkgKwoJCQkJCSInIiA6CgkJCQkJJyc7CgkJCX0pKC4uLnBhcmFtcyk7CgkJfQoJfQoJLyogQ0xPTkU6OkVORCAgOiBzci5PUigpICovCgoJLyogQ0xPTkU6OlNUQVJUOiBzci5teVJlcGxhY2UoKSAqLwoJbXlSZXBsYWNlKC4uLnBhcmFtcykgewoJCWlmICh0eXBlb2Yod2luZG93KSAhPT0gInVuZGVmaW5lZCIgJiYgdHlwZW9mKHdpbmRvdy5zcikgIT09ICJ1bmRlZmluZWQiKSB7CgkJCXJldHVybiB3aW5kb3cuc3IubXlSZXBsYWNlKC4uLnBhcmFtcyk7CgkJfSBlbHNlIHsKCQkJcmV0dXJuICgocywgZmMsIHJjKSA9PiB7CgkJCQlpZiAodHlwZW9mIHMgIT09ICdzdHJpbmcnKSByZXR1cm4gczsKCgkJCQl2YXIgcmV0ID0gJyc7CgkJCQlmb3IgKHZhciBpID0gMDsgaSA8IHMubGVuZ3RoOyBpKyspIHsKCQkJCQl2YXIgcnMgPSBzLmNoYXJBdChpKTsKCQkJCQlmb3IgKHZhciBqID0gMDsgaiA8IGZjLmxlbmd0aDsgaisrKSB7CgkJCQkJCWlmIChzLmNoYXJBdChpKSA9PSBmY1tqXSkgewoJCQkJCQkJcnMgPSBzLmNoYXJBdChpKS5yZXBsYWNlKGZjW2pdLCByY1tqXSk7CgkJCQkJCX0KCQkJCQl9CgkJCQkJcmV0ICs9IHJzOwoJCQkJfQoJCQkJcmV0dXJuIHJldDsKCQkJfSkoLi4ucGFyYW1zKTsKCQl9Cgl9CgkvKiBDTE9ORTo6RU5EICA6IHNyLm15UmVwbGFjZSgpICovCgoJLyogQ0xPTkU6OlNUQVJUOiBzci5zZW5kWE1MKCkgKi8KCXNlbmRYTUwoLi4ucGFyYW1zKSB7CgkJaWYgKHR5cGVvZih3aW5kb3cpICE9PSAidW5kZWZpbmVkIiAmJiB0eXBlb2Yod2luZG93LnNyKSAhPT0gInVuZGVmaW5lZCIpIHsKCQkJcmV0dXJuIHdpbmRvdy5zci5zZW5kWE1MKC4uLnBhcmFtcyk7CgkJfSBlbHNlIHsKCQkJcmV0dXJuIChhc3luYyAodXJsLCBwb3N0RGF0YSwgY2FsbEJhY2spID0+IHsKCQkJCWlmICh0eXBlb2Yod2luZG93KSAhPT0gInVuZGVmaW5lZCIgJiYgIXdpbmRvdy5TUikgd2luZG93LlNSID0gdGhpczsKCgkJCQlpZiAoKHR5cGVvZih3aW5kb3cpICE9PSAidW5kZWZpbmVkIiAmJiB3aW5kb3cualF1ZXJ5KSB8fCAodHlwZW9mKHdpbmRvdykgPT09ICJ1bmRlZmluZWQiICYmIHR5cGVvZihheGlvcykgIT09ICJ1bmRlZmluZWQiKSkgewoJCQkJCWxldCByZXF1ZXN0ID0gYXdhaXQgdGhpcy5jYWNoZVJlc3VsdChudWxsLCBudWxsLCBjYWxsQmFjayk7CgkJCQkJaWYgKHJlcXVlc3QpIHsKCQkJCQkJbGV0IHJlc3VsdCA9IGF3YWl0IHRoaXMucHJvY2Vzc1Jlc3BvbnNlKAoJCQkJCQkJNDQsCgkJCQkJCQljYWxsQmFjaywKCQkJCQkJCXJlcXVlc3QuVGV4dFJlc3BvbnNlLAoJCQkJCQkJdXJsCgkJCQkJCSk7CgkJCQkJCXJldHVybiBhd2FpdCB0aGlzLnByb2Nlc3NSZXN1bHQocmVzdWx0KTsKCQkJCQl9IGVsc2UgewoJCQkJCQkvLyBqcXVlcnkgY2FsbAoJCQkJCQl2YXIgYWpheCA9IHt9OwoJCQkJCQlpZiAodGhpcy5iUG9zdCB8fCBwb3N0RGF0YS5sZW5ndGggPiAodGhpcy5uTWF4VVJMTGVuZ3RoIHx8IDEwMCkpIHsKCQkJCQkJCWFqYXgudXJsID0gdXJsOwoJCQkJCQkJYWpheC50eXBlID0gJ1BPU1QnOwoJCQkJCQkJYWpheC5iZWZvcmVTZW5kID0gKHJlcXVlc3QpID0+IHsKCQkJCQkJCQlyZXF1ZXN0LnNldFJlcXVlc3RIZWFkZXIoCgkJCQkJCQkJCSdDb250ZW50LVR5cGUnLAoJCQkJCQkJCQknbXVsdGlwYXJ0L2Zvcm0tZGF0YTsgYm91bmRhcnk9LS0tLS0tLS0tLS0tLS0nCgkJCQkJCQkJKTsKCQkJCQkJCX07CgkJCQkJCQlhamF4LmRhdGEgPQoJCQkJCQkJCSdQT1NUREFUQT1cclxuJyAvKisgIjw/eG1sIHZlcnNpb249XCIxLjBcIiBlbmNvZGluZz1cInV0Zi04XCIgc3RhbmRhbG9uZT1cInllc1wiPz5cclxuIiovICsKCQkJCQkJCQlwb3N0RGF0YTsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCWFqYXgudXJsID0gdXJsICsgJyZQT1NUQ09ERT0nICsgdGhpcy50b0hleChwb3N0RGF0YSk7CgkJCQkJCQlhamF4LnR5cGUgPSAnR0VUJzsKCQkJCQkJfQoKCQkJCQkJbGV0IHJldCA9IG51bGw7CgkJCQkJCWlmICh0eXBlb2YoalF1ZXJ5KSAhPT0gInVuZGVmaW5lZCIpIHsKCQkJCQkJCXJldCA9IGF3YWl0ICQuYWpheChhamF4KTsKCQkJCQkJfSBlbHNlIGlmICh0eXBlb2YoYXhpb3MpICE9PSAidW5kZWZpbmVkIikgewoJCQkJCQkJcmV0ID0gYXdhaXQgYXhpb3MoYWpheCk7CgkJCQkJCQlyZXQgPSByZXQuZGF0YTsKCQkJCQkJfQoJCQkJCQlyZXQgPSBhd2FpdCB0aGlzLnByb2Nlc3NSZXN1bHQoCgkJCQkJCQl0aGlzLnByb2Nlc3NSZXNwb25zZSg0LCBjYWxsQmFjaywgcmV0LCB1cmwpCgkJCQkJCSk7CgkJCQkJCXJldHVybiByZXQ7CgkJCQkJfQoJCQkJfSBlbHNlIHsKCQkJCQl2YXIgeG1sSFRUUCA9IHRoaXMuZ2V0WG1sSFRUUCgpOwoJCQkJCWlmICgheG1sSFRUUCkgcmV0dXJuIGZhbHNlOwoJCQkJCWlmIChjYWxsQmFjayAhPSBudWxsKSB7CgkJCQkJCXdpbmRvdy54bWxIVFRQLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uKCkgewoJCQkJCQkJaWYgKHdpbmRvdy54bWxIVFRQLnJlYWR5U3RhdGUgPT0gNCkgewoJCQkJCQkJCWlmICgkLndoZW4pIHsKCQkJCQkJCQkJJC53aGVuKAoJCQkJCQkJCQkJd2luZG93LlNSLnByb2Nlc3NSZXNwb25zZSgKCQkJCQkJCQkJCQl3aW5kb3cueG1sSFRUUC5yZWFkeVN0YXRlLAoJCQkJCQkJCQkJCWNhbGxCYWNrLAoJCQkJCQkJCQkJCXdpbmRvdy54bWxIVFRQLnJlc3BvbnNlVGV4dCwKCQkJCQkJCQkJCQl1cmwKCQkJCQkJCQkJCSkKCQkJCQkJCQkJKS50aGVuKChyZXN1bHQpID0+IHdpbmRvdy5TUi5wcm9jZXNzUmVzdWx0KHJlc3VsdCkpOwoJCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJCXdpbmRvdy5TUi5wcm9jZXNzUmVzdWx0KAoJCQkJCQkJCQkJd2luZG93LlNSLnByb2Nlc3NSZXNwb25zZSgKCQkJCQkJCQkJCQl3aW5kb3cueG1sSFRUUC5yZWFkeVN0YXRlLAoJCQkJCQkJCQkJCWNhbGxCYWNrLAoJCQkJCQkJCQkJCXdpbmRvdy54bWxIVFRQLnJlc3BvbnNlVGV4dCwKCQkJCQkJCQkJCQl1cmwKCQkJCQkJCQkJCSkKCQkJCQkJCQkJKTsKCQkJCQkJCQl9CgkJCQkJCQl9CgkJCQkJCX07CgkJCQkJfQoKCQkJCQlpZiAodGhpcy5iUG9zdCB8fCBwb3N0RGF0YS5sZW5ndGggPiB0aGlzLm5NYXhVUkxMZW5ndGgpIHsKCQkJCQkJd2luZG93LnhtbEhUVFAub3BlbignUE9TVCcsIHVybCwgY2FsbEJhY2sgIT0gbnVsbCk7CgkJCQkJCXdpbmRvdy54bWxIVFRQLnNldFJlcXVlc3RIZWFkZXIoCgkJCQkJCQknQ29udGVudC1UeXBlJywKCQkJCQkJCSdtdWx0aXBhcnQvZm9ybS1kYXRhOyBib3VuZGFyeT0tLS0tLS0tLS0tLS0tLScKCQkJCQkJKTsgLy8gZm9vbCBjcm9zcy1kb21haW4gY2hlY2tpbmcgaW4gY2hyb21lCgkJCQkJCXdpbmRvdy54bWxIVFRQLnNlbmQoCgkJCQkJCQknUE9TVERBVEE9XHJcbicgLyorICI8P3htbCB2ZXJzaW9uPVwiMS4wXCIgZW5jb2Rpbmc9XCJ1dGYtOFwiIHN0YW5kYWxvbmU9XCJ5ZXNcIj8+XHJcbiIqLyArCgkJCQkJCQlwb3N0RGF0YQoJCQkJCQkpOwoJCQkJCX0gZWxzZSB7CgkJCQkJCXhtbEhUVFAub3BlbigKCQkJCQkJCSdHRVQnLAoJCQkJCQkJdXJsICsgJyZQT1NUQ09ERT0nICsgdGhpcy50b0hleChwb3N0RGF0YSksCgkJCQkJCQljYWxsQmFjayAhPSBudWxsCgkJCQkJCSk7CgkJCQkJCXhtbEhUVFAuc2VuZChudWxsKTsKCQkJCQl9CgoJCQkJCWlmIChjYWxsQmFjayA9PSBudWxsICYmIHhtbEhUVFAucmVhZHlTdGF0ZSA9PSA0KSB7CgkJCQkJCXZhciBfdXJsID0gdXJsICsgJyZQT1NUQ09ERT0nICsgdGhpcy50b0hleChwb3N0RGF0YSk7CgkJCQkJCWlmICgkLndoZW4pIHsKCQkJCQkJCXJldHVybiAkLndoZW4oCgkJCQkJCQkJdGhpcy5wcm9jZXNzUmVzcG9uc2UoCgkJCQkJCQkJCXhtbEhUVFAucmVhZHlTdGF0ZSwKCQkJCQkJCQkJY2FsbEJhY2ssCgkJCQkJCQkJCXhtbEhUVFAucmVzcG9uc2VUZXh0LAoJCQkJCQkJCQlfdXJsCgkJCQkJCQkJKQoJCQkJCQkJKS50aGVuKChyZXN1bHQpID0+IHsKCQkJCQkJCQlyZXR1cm4gdGhpcy5wcm9jZXNzUmVzdWx0KHJlc3VsdCk7CgkJCQkJCQl9KTsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCXRoaXMucHJvY2Vzc1Jlc3VsdCgKCQkJCQkJCQl0aGlzLnByb2Nlc3NSZXNwb25zZSgKCQkJCQkJCQkJeG1sSFRUUC5yZWFkeVN0YXRlLAoJCQkJCQkJCQljYWxsQmFjaywKCQkJCQkJCQkJeG1sSFRUUC5yZXNwb25zZVRleHQsCgkJCQkJCQkJCV91cmwKCQkJCQkJCQkpCgkJCQkJCQkpOwoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQl9KSguLi5wYXJhbXMpOwoJCX0KCX0KCS8qIENMT05FOjpFTkQgIDogc3Iuc2VuZFhNTCgpICovCgoJLyogQ0xPTkU6OlNUQVJUOiBzci5wcm9jZXNzUmVzcG9uc2UoKSAqLwoJcHJvY2Vzc1Jlc3BvbnNlKC4uLnBhcmFtcykgewoJCWlmICh0eXBlb2Yod2luZG93KSAhPT0gInVuZGVmaW5lZCIgJiYgdHlwZW9mKHdpbmRvdy5zcikgIT09ICJ1bmRlZmluZWQiKSB7CgkJCXJldHVybiB3aW5kb3cuc3IucHJvY2Vzc1Jlc3BvbnNlKC4uLnBhcmFtcyk7CgkJfSBlbHNlIHsKCQkJcmV0dXJuICgocmVhZHlTdGF0ZSwgY2FsbEJhY2ssIHJlc3BvbnNlVGV4dCwgdXJsKSA9PiB7CgkJCQlpZiAoWzQsIDQ0XS5pbmRleE9mKHJlYWR5U3RhdGUpID09IC0xKSByZXR1cm47CgoJCQkJdmFyIHNNZXRob2ROYW1lID0gdGhpcy4kX1JFUVVFU1QoJ25hbWUnLCB1cmwpOwoKCQkJCXRyeSB7CgkJCQkJaWYgKHJlYWR5U3RhdGUgPT0gNCkgewoJCQkJCQlsZXQgcmVzID0gKGFzeW5jICgpID0+IHsKCQkJCQkJCXJldHVybiBhd2FpdCB0aGlzLmNhY2hlUmVzdWx0KG51bGwsIHJlc3BvbnNlVGV4dCk7CgkJCQkJCX0pKCk7CgkJCQkJfQoKCQkJCQkvL3JldCA9IG51bGw7CgkJCQkJLy9zZXJ2ZXJfdGltZSA9IG51bGw7CgkJCQkJLy9fZXhjZXB0aW9uID0gbnVsbDsKCQkJCQl2YXIgYlNjcmlwdEVycm9yID0gZmFsc2U7CgkJCQkJdmFyIF9yZXQgPSBudWxsOwoJCQkJCXRyeSB7CgkJCQkJCV9yZXQgPSB0aGlzLnJ1blNSU2NyaXB0KHJlc3BvbnNlVGV4dCk7CgkJCQkJfSBjYXRjaCAoZSkgewoJCQkJCQlpZiAodHlwZW9mKHdpbmRvdykgPT09ICJ1bmRlZmluZWQiKSB0aHJvdyBlOwoJCQkJCQliU2NyaXB0RXJyb3IgPSB0cnVlOwoJCQkJCX0KCgkJCQkJaWYgKF9yZXQgJiYgX3JldC5zZXJ2ZXJfdGltZSkgewoJCQkJCQlsZXQgdGQgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKSAtIF9yZXQuc2VydmVyX3RpbWUuZ2V0VGltZSgpOwoKCQkJCQkJdHJ5IHsKCQkJCQkJCXdpbmRvdy50aW1lRGlmZmVyZW5jZSA9IHRkOwoJCQkJCQl9IGNhdGNoIChleCkgewoJCQkJCQkJZ2xvYmFsLnRpbWVEaWZmZXJlbmNlID0gdGQ7CgkJCQkJCX0KCQkJCQl9CgoJCQkJCWlmIChfcmV0ICYmIF9yZXQuX2V4Y2VwdGlvbikgewoJCQkJCQl0aGlzLlNob3dEZWJ1ZyhfZXhjZXB0aW9uLk1lc3NhZ2UpOwoJCQkJCX0KCgkJCQkJaWYgKGNhbGxCYWNrICE9IG51bGwpIHsKCQkJCQkJdmFyIGNhbGxSZXQgPSBudWxsOwoJCQkJCQl0cnkgewoJCQkJCQkJY2FsbFJldCA9IGNhbGxCYWNrKF9yZXQucmV0LCBfcmV0Ll9leGNlcHRpb24pOwoJCQkJCQl9IGNhdGNoIChlKSB7CgkJCQkJCQl0aGlzLlNob3dFcnJvcigKCQkJCQkJCQknRXJyb3IgaW4gQ2FsbGJhY2s6XG5cbicgKyBjYWxsQmFjayArICdcblxuJyArIGUubWVzc2FnZQoJCQkJCQkJKTsKCQkJCQkJfQoJCQkJCQlpZiAoCgkJCQkJCQl0eXBlb2YgX3JldC5tZXRob2RfbmFtZSAhPT0gJ3VuZGVmaW5lZCcgJiYKCQkJCQkJCXR5cGVvZiBzTWV0aG9kTmFtZSAhPT0gJ3VuZGVmaW5lZCcgJiYKCQkJCQkJCXNNZXRob2ROYW1lICE9IF9yZXQubWV0aG9kX25hbWUKCQkJCQkJKSB7CgkJCQkJCQl0aGlzLlNob3dFcnJvcigKCQkJCQkJCQknTWlzbWF0Y2ggaW4gTWV0aG9kIGJldHdlZW4gc2VydmVyIGFuZCBjbGllbnQ6XG5TZXJ2ZXIgTWV0aG9kIE5hbWU6ICcgKwoJCQkJCQkJCV9yZXQubWV0aG9kX25hbWUgKwoJCQkJCQkJCSdcbkNsaWVudCBNZXRob2QgTmFtZTogJyArCgkJCQkJCQkJc01ldGhvZE5hbWUKCQkJCQkJCSk7CgkJCQkJCX0KCQkJCQkJKAoJCQkJCQkJdGhpcy5mTG9hZGluZ0VuZCB8fAoJCQkJCQkJZnVuY3Rpb24oKSB7CgkJCQkJCQkJd2luZG93LnNyLnJlc2V0Q3Vyc29yKCk7CgkJCQkJCQl9CgkJCQkJCSkoKTsKCgkJCQkJCXJldHVybiAoCgkJCQkJCQljYWxsUmV0IHx8IF9yZXQucmV0IHx8IChiU2NyaXB0RXJyb3IgPyByZXNwb25zZVRleHQgOiBudWxsKQoJCQkJCQkpOwoJCQkJCX0gZWxzZSB7CgkJCQkJCWlmICh0eXBlb2Yod2luZG93KSAhPT0gInVuZGVmaW5lZCIpIHRoaXMucmVzZXRDdXJzb3IoKTsKCQkJCQkJcmV0dXJuIChfcmV0ID8gX3JldC5yZXQgOiBudWxsKSB8fCAoYlNjcmlwdEVycm9yID8gcmVzcG9uc2VUZXh0IDogbnVsbCk7CgkJCQkJfQoJCQkJfSBjYXRjaCAoZSkgewoJCQkJCWlmICh0eXBlb2Yod2luZG93KSA9PT0gInVuZGVmaW5lZCIpIHsKCQkJCQkJdGhyb3cgZTsKCQkJCQl9CgkJCQkJdGhpcy5yZXNldEN1cnNvcigpOwoJCQkJCXRoaXMuU2hvd0Vycm9yKCdFcnJvciBpbiBjb2RlOiAnICsgZS5tZXNzYWdlICsgJ1xuJyArIHJlc3BvbnNlVGV4dCk7CgkJCQl9CgoJCQkJcmV0dXJuIG51bGw7CgkJCX0pKC4uLnBhcmFtcyk7CgkJfQoJfQoJLyogQ0xPTkU6OkVORCAgOiBzci5wcm9jZXNzUmVzcG9uc2UoKSAqLwoKCS8qIENMT05FOjpTVEFSVDogc3IucHJvY2Vzc1Jlc3VsdCgpICovCglwcm9jZXNzUmVzdWx0KC4uLnBhcmFtcykgewoJCWlmICh0eXBlb2Yod2luZG93KSAhPT0gInVuZGVmaW5lZCIgJiYgdHlwZW9mKHdpbmRvdy5zcikgIT09ICJ1bmRlZmluZWQiKSB7CgkJCXJldHVybiB3aW5kb3cuc3IucHJvY2Vzc1Jlc3VsdCguLi5wYXJhbXMpOwoJCX0gZWxzZSB7CgkJCXJldHVybiAoYXN5bmMgKHJlcykgPT4gewoJCQkJaWYgKCFyZXMgfHwgIXJlcy5Db2RlIHx8ICFyZXMuU3RvcmVkTWV0aG9kKSB7CgkJCQkJdGhpcy5BY3RpdmVSZXF1ZXN0ID0gbnVsbDsKCQkJCQlyZXR1cm4gcmVzOwoJCQkJfQoKCQkJCS8vIGZvciBzdXJlIGEgbWV0aG9kIHJlc3VsdCBmcm9tIGFuIGFzeW5jIGNhbGwKCQkJCWlmIChyZXMuUmVzdWx0KSB7CgkJCQkJLy8gd2UgZ290IGEgcmVzdWx0CgkJCQkJdmFyIF9fcmV0ID0gbnVsbDsKCQkJCQl0cnkgewoJCQkJCQlfX3JldCA9IHRoaXMucHJvY2Vzc1Jlc3BvbnNlKDQsIG51bGwsIHJlcy5SZXN1bHQsIG51bGwpOwoJCQkJCX0gY2F0Y2ggKGUpIHsKCQkJCQkJX19yZXQgPSByZXMuUmVzdWx0OwoJCQkJCX0KCQkJCQl0aGlzLkFjdGl2ZVJlcXVlc3QgPSBudWxsOwoJCQkJCXJldHVybiBfX3JldDsKCQkJCX0KCgkJCQl2YXIgdGltZW91dCA9IHJlcy5SdW5BZnRlciAtIHJlcy5EYXRlOwoJCQkJaWYgKHRpbWVvdXQgPD0gMCkgewoJCQkJCS8vIG5lZ2F0aXZlIHRpbWVvdXQgbWVhbnMgdGhhdCBpdCB3YXMgc3VwcG9zZWQgdG8gYmUgcnVuIGJ1dCBkaWQgbm90IGZvciBzb21lIHJlYXNvbiAoZGVsYXksIGZhaWx1cmUsIGV0Yy4uLikKCQkJCQkvLyBzYW1lIGRhdGUgYXMgcnVuYWZ0ZXIgbWVhbnMgdGhhdCB3ZSBhcmUgdXNpbmcgdGhlIGltbWVkaWF0ZSBhc3luYyBleGVjdXRpb24uIGkuZS4gdGhlcmUgaXMgbm8gbmVlZCBmb3IgdGhlIHJ1bm5lciB0aHJlYWQgdGFzawoJCQkJCXRpbWVvdXQgPSAzMDAwMDsKCQkJCX0gZWxzZSBpZiAodGltZW91dCA+IDUgKiA2MCAqIDEwMDApIHsKCQkJCQkvLyBtb3JlIHRoYW4gd2UgY2FuIHdhaXQsIHdlIHJldHVybiBhIHJlZmVyZW5jZSB0byB0aGUgcmVzdWx0CgkJCQkJY29uc29sZS5sb2coCgkJCQkJCSdXZSBjYW5ub3Qgd2FpdCAnICsKCQkJCQkJTWF0aC5mbG9vcih0aW1lb3V0IC8gMTAwMCkgKwoJCQkJCQknIHNlY29uZHMuIFJldHVybmluZyByZXN1bHQuJwoJCQkJCSk7CgkJCQkJcmV0dXJuIHJlczsKCQkJCX0KCQkJCWNvbnNvbGUubG9nKAoJCQkJCSdNYWtpbmcgdGhlIG5leHQgY2FsbCBpbiAnICsKCQkJCQlNYXRoLmZsb29yKHRpbWVvdXQgLyAxMDAwKSArCgkJCQkJJyBzZWNvbmRzLicKCQkJCSk7CgoJCQkJYXdhaXQgbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgdGltZW91dCkpOwoJCQkJaWYgKCF0aGlzLkFjdGl2ZVJlcXVlc3QpIHsKCQkJCQljb25zb2xlLmxvZygnTm8gQWN0aXZlUmVxdWVzdCwgZXhpdGluZy4uLicpOwoJCQkJCXJldHVybiBudWxsOwoJCQkJfQoJCQkJdHJ5IHsKCQkJCQlsZXQgcmV0ID0gYXdhaXQgJC5hamF4KHsKCQkJCQkJdXJsOiAnL21ldGhvZC9hLmFzaHg/bmFtZT1Db250ZW50TWFuYWdlci5jbXNNZXRob2RSZXN1bHRGaW5kJnAwPXtDb2RlfScgKwoJCQkJCQkJcmVzLkNvZGUgKwoJCQkJCQkJJ3svQ29kZX17SWR9JyArCgkJCQkJCQlyZXMuSWQgKwoJCQkJCQkJJ3svSWR9JnJhbmQ9JyArCgkJCQkJCQlNYXRoLnJhbmRvbSgpLAoJCQkJCX0pOwoJCQkJCXJldCA9IHRoaXMucHJvY2Vzc1Jlc3BvbnNlKDQsIG51bGwsIHJldCwgdGhpcy5BY3RpdmVSZXF1ZXN0LlVSTCk7CgkJCQkJcmV0ID0gYXdhaXQgdGhpcy5wcm9jZXNzUmVzdWx0KHJldCk7CgkJCQkJcmV0dXJuIHJldDsKCQkJCX0gY2F0Y2ggKGV4KSB7CgkJCQkJY29uc29sZS5sb2coJ3Byb2Nlc3NSZXN1bHQnLCBleCk7CgkJCQkJcmV0dXJuIGF3YWl0IHRoaXMuXygnQ29udGVudE1hbmFnZXIuY21zTWV0aG9kUmVzdWx0RmluZCcsIG51bGwsIHsKCQkJCQkJQ29kZTogcmVzLkNvZGUsCgkJCQkJCUlkOiByZXMuSWQsCgkJCQkJfSk7CgkJCQl9CgkJCX0pKC4uLnBhcmFtcyk7CgkJfQoJfQoJLyogQ0xPTkU6OkVORCAgOiBzci5wcm9jZXNzUmVzdWx0KCkgKi8KCgkvKiBDTE9ORTo6U1RBUlQ6IHNyLnNlcnZlckRhdGUoKSAqLwoJc2VydmVyRGF0ZSguLi5wYXJhbXMpIHsKCQlpZiAodHlwZW9mKHdpbmRvdykgIT09ICJ1bmRlZmluZWQiICYmIHR5cGVvZih3aW5kb3cuc3IpICE9PSAidW5kZWZpbmVkIikgewoJCQlyZXR1cm4gd2luZG93LnNyLnNlcnZlckRhdGUoLi4ucGFyYW1zKTsKCQl9IGVsc2UgewoJCQlyZXR1cm4gKChkKSA9PiB7CgkJCQlsZXQgdGQgPSAwOwoJCQkJdHJ5IHsKCQkJCQl0ZCA9IHdpbmRvdy50aW1lRGlmZmVyZW5jZTsKCQkJCX0gY2F0Y2ggKGV4KSB7CgkJCQkJdGQgPSBnbG9iYWwudGltZURpZmZlcmVuY2U7CgkJCQl9CgkJCQlyZXR1cm4gdGhpcy5hZGRNU2Vjb25kcyhkIHx8IG5ldyBEYXRlKCksIC10ZCk7CgkJCX0pKC4uLnBhcmFtcyk7CgkJfQoJfQoJLyogQ0xPTkU6OkVORCAgOiBzci5zZXJ2ZXJEYXRlKCkgKi8KCgkvKiBDTE9ORTo6U1RBUlQ6IHNyLmFkZE1TZWNvbmRzKCkgKi8KCWFkZE1TZWNvbmRzKC4uLnBhcmFtcykgewoJCWlmICh0eXBlb2Yod2luZG93KSAhPT0gInVuZGVmaW5lZCIgJiYgdHlwZW9mKHdpbmRvdy5zcikgIT09ICJ1bmRlZmluZWQiKSB7CgkJCXJldHVybiB3aW5kb3cuc3IuYWRkTVNlY29uZHMoLi4ucGFyYW1zKTsKCQl9IGVsc2UgewoJCQlyZXR1cm4gKChvLCBtcykgPT4gewoJCQkJcmV0dXJuIG5ldyBEYXRlKG8uZ2V0VGltZSgpICsgbXMpOwoJCQl9KSguLi5wYXJhbXMpOwoJCX0KCX0KCS8qIENMT05FOjpFTkQgIDogc3IuYWRkTVNlY29uZHMoKSAqLwoKCS8qIENMT05FOjpTVEFSVDogc3IucnVuU2NyaXB0KCkgKi8KCXJ1blNjcmlwdCguLi5wYXJhbXMpIHsKCQlpZiAodHlwZW9mKHdpbmRvdykgIT09ICJ1bmRlZmluZWQiICYmIHR5cGVvZih3aW5kb3cuc3IpICE9PSAidW5kZWZpbmVkIikgewoJCQlyZXR1cm4gd2luZG93LnNyLnJ1blNjcmlwdCguLi5wYXJhbXMpOwoJCX0gZWxzZSB7CgkJCXJldHVybiAoKHMpID0+IHsKCQkJCWlmICghcykgcmV0dXJuIG51bGw7CgoJCQkJbGV0IGNMaW5lcyA9IHMuc3BsaXQoJ1xuJyk7CgkJCQl0cnkgewoJCQkJCWlmICh0eXBlb2YoZXNwcmltYSkgIT09ICd1bmRlZmluZWQnKSB7CgkJCQkJCWVzcHJpbWEucGFyc2UocywgewoJCQkJCQkJZXM2OiB0cnVlCgkJCQkJCX0pOwoJCQkJCX0KCQkJCX0gY2F0Y2ggKGV4KSB7CgkJCQkJaWYgKGNMaW5lc1tleC5saW5lTnVtYmVyIC0gMV0uaW5kZXhPZignZm9yIGF3YWl0JykgPCAwKSB7CgkJCQkJCWNvbnNvbGUubG9nKCJydW5TY3JpcHQoKSAiICsgZXguZGVzY3JpcHRpb24sIGV4LmxpbmVOdW1iZXIsIGNMaW5lc1tleC5saW5lTnVtYmVyIC0gMV0pOwoJCQkJCQlyZXR1cm47CgkJCQkJfQoJCQkJfQoKCQkJCWlmICh0eXBlb2Yod2luZG93KSAhPT0gInVuZGVmaW5lZCIpIHsKCQkJCQl0cnkgewoJCQkJCQlpZiAod2luZG93Ll9jb250ZW50ICYmIHdpbmRvdy5fY29udGVudC5ldmFsKSB7CgkJCQkJCQl2YXIgb3V0cHV0ID0gd2luZG93Ll9jb250ZW50LmV2YWwocyk7CgkJCQkJCQlyZXR1cm4gb3V0cHV0OwoJCQkJCQl9CgkJCQkJfSBjYXRjaCAoZSkgewoJCQkJCQl0aGlzLlNob3dFcnJvcignRkYgU0NSSVBUOiBcbicgKyBlLm1lc3NhZ2UgKyAnXG4nICsgcyk7CgkJCQkJfQoJCQkJCXRyeSB7CgkJCQkJCWlmICh3aW5kb3cuZXhlY1NjcmlwdCkgewoJCQkJCQkJaWYgKHMuaW5kZXhPZignXHJcbicpID4gMCkgewoJCQkJCQkJCS8vIGEgbXVsdGktbGluZSBzdGF0ZW1lbnQKCQkJCQkJCQl3aW5kb3cuZXhlY1NjcmlwdChzKTsKCQkJCQkJCQlyZXR1cm4gbnVsbDsKCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJLy8gYSBzaW5nbGUtbGluZSBzdGF0ZW1lbnQKCQkJCQkJCQluZXdWID0gbnVsbDsKCQkJCQkJCQl2YXIgbmV3UyA9ICduZXdWID0gJyArIHM7CgkJCQkJCQkJd2luZG93LmV4ZWNTY3JpcHQobmV3Uyk7CgkJCQkJCQkJcmV0dXJuIG5ld1Y7CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQl9IGNhdGNoIChlKSB7CgkJCQkJCXRoaXMuU2hvd0Vycm9yKCdJRTYgU0NSSVBUOiBcbicgKyBlLm1lc3NhZ2UgKyAnXG4nICsgcyk7CgkJCQkJfQoKCQkJCQl0cnkgewoJCQkJCQlpZiAod2luZG93LmV4ZWNTY3JpcHQpIHsKCQkJCQkJCWlmIChzLmluZGV4T2YoJ1xyXG4nKSA+IDApIHsKCQkJCQkJCQkvLyBhIG11bHRpLWxpbmUgc3RhdGVtZW50CgkJCQkJCQkJd2luZG93LmV4ZWNTY3JpcHQocyk7CgkJCQkJCQkJcmV0dXJuIG51bGw7CgkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCS8vIGEgc2luZ2xlLWxpbmUgc3RhdGVtZW50CgkJCQkJCQkJbmV3ViA9IG51bGw7CgkJCQkJCQkJdmFyIG5ld1MgPSAnbmV3ViA9ICcgKyBzOwoJCQkJCQkJCWV2YWwobmV3Uyk7CgkJCQkJCQkJcmV0dXJuIG5ld1Y7CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQl9IGNhdGNoIChlKSB7CgkJCQkJCXRoaXMuU2hvd0Vycm9yKCdJRTcgU0NSSVBUOiBcbicgKyBlLm1lc3NhZ2UgKyAnXG4nICsgcyk7CgkJCQkJfQoKCQkJCQl0cnkgewoJCQkJCQl2YXIgZm4gPSBmdW5jdGlvbigpIHsKCQkJCQkJCXZhciByZXQgPSB3aW5kb3cuZXZhbC5jYWxsKHdpbmRvdywgcyk7CgkJCQkJCQlyZXR1cm4gcmV0OwoJCQkJCQl9OwoKCQkJCQkJcmV0dXJuIGZuKCk7CgkJCQkJfSBjYXRjaCAoZSkgewoJCQkJCQl0aGlzLlNob3dFcnJvcignVEFHIFNDUklQVDogXG4nICsgZS5tZXNzYWdlICsgJ1xuJyArIHMpOwoJCQkJCX0KCQkJCX0KCgkJCQl0cnkgewoJCQkJCXMgPSBzLnJlcGxhY2UoL25ldyBEYXRlXCgwMDAxL2csICduZXcgRGF0ZSgxJyk7CgkJCQkJcmV0dXJuIGV2YWwocyk7CgkJCQl9IGNhdGNoIChlKSB7CgkJCQkJdGhpcy5TaG93RXJyb3IoJ0VWQUwgU0NSSVBUOiBcbicgKyBlLm1lc3NhZ2UgKyAnXG4nICsgcyk7CgkJCQl9CgkJCX0pKC4uLnBhcmFtcyk7CgkJfQoJfQoJLyogQ0xPTkU6OkVORCAgOiBzci5ydW5TY3JpcHQoKSAqLwoKCS8qIENMT05FOjpTVEFSVDogc3IucnVuU1JTY3JpcHQoKSAqLwoJcnVuU1JTY3JpcHQoLi4ucGFyYW1zKSB7CgkJaWYgKHR5cGVvZih3aW5kb3cpICE9PSAidW5kZWZpbmVkIiAmJiB0eXBlb2Yod2luZG93LnNyKSAhPT0gInVuZGVmaW5lZCIpIHsKCQkJcmV0dXJuIHdpbmRvdy5zci5ydW5TUlNjcmlwdCguLi5wYXJhbXMpOwoJCX0gZWxzZSB7CgkJCXJldHVybiAoKHMpID0+IHsKCQkJCXJldHVybiB0aGlzLnJ1blNjcmlwdCgKCQkJCQknKCgpID0+IHsgdmFyIHJldCA9IG51bGw7ICcgKwoJCQkJCXMgKwoJCQkJCScgaWYodHlwZW9mKHdpbmRvdykhPT0idW5kZWZpbmVkIil7d2luZG93Lm1ldGhvZF9uYW1lID0gbWV0aG9kX25hbWU7IHdpbmRvdy5zZXJ2ZXJfdGltZSA9IHNlcnZlcl90aW1lOyB3aW5kb3cuX2V4Y2VwdGlvbiA9IHR5cGVvZihfZXhjZXB0aW9uKT09PSJ1bmRlZmluZWQiP251bGw6X2V4Y2VwdGlvbjsgd2luZG93LmV4ZWN1dGlvbl90aW1lID0gZXhlY3V0aW9uX3RpbWU7fSByZXR1cm4ge19leGNlcHRpb246IHR5cGVvZihfZXhjZXB0aW9uKT09PSJ1bmRlZmluZWQiP251bGw6X2V4Y2VwdGlvbiwgbWV0aG9kX25hbWU6IG1ldGhvZF9uYW1lLCBzZXJ2ZXJfdGltZTogc2VydmVyX3RpbWUsIGV4ZWN1dGlvbl90aW1lOiBleGVjdXRpb25fdGltZSwgcmV0OiByZXR9O30pKCk7JwoJCQkJKTsKCQkJfSkoLi4ucGFyYW1zKTsKCQl9Cgl9CgkvKiBDTE9ORTo6RU5EICA6IHNyLnJ1blNSU2NyaXB0KCkgKi8KCgkvKiBDTE9ORTo6U1RBUlQ6IHNyLmhhc2hDb2RlKCkgKi8KCWhhc2hDb2RlKC4uLnBhcmFtcykgewoJCWlmICh0eXBlb2Yod2luZG93KSAhPT0gInVuZGVmaW5lZCIgJiYgdHlwZW9mKHdpbmRvdy5zcikgIT09ICJ1bmRlZmluZWQiKSB7CgkJCXJldHVybiB3aW5kb3cuc3IuaGFzaENvZGUoLi4ucGFyYW1zKTsKCQl9IGVsc2UgewoJCQlyZXR1cm4gKChzKSA9PiB7CgkJCQl2YXIgaGFzaCA9IDAsCgkJCQkJaSwKCQkJCQljaHIsCgkJCQkJbGVuOwoJCQkJaWYgKHMubGVuZ3RoID09IDApIHJldHVybiBoYXNoOwoJCQkJZm9yIChpID0gMCwgbGVuID0gcy5sZW5ndGg7IGkgPCBsZW47IGkrKykgewoJCQkJCWNociA9IHMuY2hhckNvZGVBdChpKTsKCQkJCQloYXNoID0gKGhhc2ggPDwgNSkgLSBoYXNoICsgY2hyOwoJCQkJCWhhc2ggfD0gMDsgLy8gQ29udmVydCB0byAzMmJpdCBpbnRlZ2VyCgkJCQl9CgkJCQlyZXR1cm4gaGFzaDsKCQkJfSkoLi4ucGFyYW1zKTsKCQl9Cgl9CgkvKiBDTE9ORTo6RU5EICA6IHNyLmhhc2hDb2RlKCkgKi8KCgkvKiBDTE9ORTo6U1RBUlQ6IHNyLmdyb3VwQnkoKSAqLwoJZ3JvdXBCeSguLi5wYXJhbXMpIHsKCQlpZiAodHlwZW9mKHdpbmRvdykgIT09ICJ1bmRlZmluZWQiICYmIHR5cGVvZih3aW5kb3cuc3IpICE9PSAidW5kZWZpbmVkIikgewoJCQlyZXR1cm4gd2luZG93LnNyLmdyb3VwQnkoLi4ucGFyYW1zKTsKCQl9IGVsc2UgewoJCQlyZXR1cm4gKChhciwgZmllbGQpID0+IHsKCQkJCWlmICghYXIgfHwgIWZpZWxkKSByZXR1cm4gbnVsbDsKCgkJCQl2YXIga2V5cyA9IFtdOwoJCQkJYXIuZm9yRWFjaChhID0+IHsKCQkJCQl2YXIga2V5ID0gbnVsbDsKCQkJCQlmaWVsZC5zcGxpdCgnLicpLmZvckVhY2goZiA9PiBrZXkgPSAoa2V5IHx8IGEpW2ZdKTsKCQkJCQlsZXQgayA9IGtleXMuZmluZChrID0+IHRoaXMuRXF1YWxzKGsua2V5LCBrZXkpKTsKCQkJCQlpZiAoaykgewoJCQkJCQlrLnZhbHVlcy5wdXNoKGEpOwoJCQkJCX0gZWxzZSB7CgkJCQkJCWtleXMucHVzaCh7CgkJCQkJCQlrZXk6IGtleSwKCQkJCQkJCXZhbHVlczogW2FdLAoJCQkJCQl9KTsKCQkJCQl9CgkJCQl9KTsKCQkJCXJldHVybiBrZXlzOwoJCQl9KSguLi5wYXJhbXMpOwoJCX0KCX0KCS8qIENMT05FOjpFTkQgIDogc3IuZ3JvdXBCeSgpICovCgoJLyogQ0xPTkU6OlNUQVJUOiBzci5TaG93RGVidWcoKSAqLwoJU2hvd0RlYnVnKC4uLnBhcmFtcykgewoJCWlmICh0eXBlb2Yod2luZG93KSAhPT0gInVuZGVmaW5lZCIgJiYgdHlwZW9mKHdpbmRvdy5zcikgIT09ICJ1bmRlZmluZWQiKSB7CgkJCXJldHVybiB3aW5kb3cuc3IuU2hvd0RlYnVnKC4uLnBhcmFtcyk7CgkJfSBlbHNlIHsKCQkJcmV0dXJuICgocywgYklnbm9yZURlYnVnKSA9PiB7CgkJCQlpZiAodHlwZW9mKHdpbmRvdykgPT09ICJ1bmRlZmluZWQiKSB7CgkJCQkJY29uc29sZS5sb2coIlNob3dEZWJ1ZzogIiArIHMpOwoJCQkJfQoJCQkJaWYgKHRoaXMuYkRlYnVnIHx8IGJJZ25vcmVEZWJ1ZykgdGhpcy5TaG93TWVzc2FnZShzKTsKCQkJfSkoLi4ucGFyYW1zKTsKCQl9Cgl9CgkvKiBDTE9ORTo6RU5EICA6IHNyLlNob3dEZWJ1ZygpICovCgoJLyogQ0xPTkU6OlNUQVJUOiBzci5jYWNoZVJlc3VsdCgpICovCgljYWNoZVJlc3VsdCguLi5wYXJhbXMpIHsKCQlpZiAodHlwZW9mKHdpbmRvdykgIT09ICJ1bmRlZmluZWQiICYmIHR5cGVvZih3aW5kb3cuc3IpICE9PSAidW5kZWZpbmVkIikgewoJCQlyZXR1cm4gd2luZG93LnNyLmNhY2hlUmVzdWx0KC4uLnBhcmFtcyk7CgkJfSBlbHNlIHsKCQkJcmV0dXJuIChhc3luYyAocmVxdWVzdCwgdGV4dHJlc3BvbnNlKSA9PiB7CgkJCQlpZiAoIXRoaXMuYkNhY2hlUmVzdWx0KSByZXR1cm47CgkJCQlyZXF1ZXN0ID0gcmVxdWVzdCB8fCB0aGlzLkFjdGl2ZVJlcXVlc3Q7CgoJCQkJaWYgKCFyZXF1ZXN0KSB7CgkJCQkJcmV0dXJuOwoJCQkJfQoKCQkJCWlmICgKCQkJCQl0ZXh0cmVzcG9uc2UgJiYKCQkJCQl0ZXh0cmVzcG9uc2UuaW5kZXhPZigncmV0LkNvZGUgPSAnKSA+IC0xICYmCgkJCQkJdGV4dHJlc3BvbnNlLmluZGV4T2YoJ3JldC5SdW5BZnRlciA9ICcpID4gLTEgJiYKCQkJCQl0ZXh0cmVzcG9uc2UuaW5kZXhPZigncmV0LlJlc3VsdCA9ICIiJykgPiAtMQoJCQkJKSB7CgkJCQkJY29uc29sZS5sb2coJ3RleHRyZXNwb25zZSBjb250aWFucyBpbmNvbXBsZXRlIG1ldGhvZCByZXN1bHQnKTsKCQkJCQlyZXR1cm4gbnVsbDsKCQkJCX0KCgkJCQl2YXIgc01ldGhvZCA9IHRoaXMuJF9SRVFVRVNUKCduYW1lJywgcmVxdWVzdC5VUkwpOwoJCQkJc01ldGhvZCA9IHNNZXRob2Quc3Vic3RyaW5nKHNNZXRob2QubGFzdEluZGV4T2YoJy4nKSArIDEpOwoJCQkJdHJ5IHsKCQkJCQl2YXIgX3VzYWJsZSA9IChyKSA9PiB7CgkJCQkJCXZhciBpdGVtID0KCQkJCQkJCShyICYmCgkJCQkJCQkJci5oYXNoID09IHJlcXVlc3QuaGFzaCAmJgoJCQkJCQkJCShyLlVSTCA9PSByZXF1ZXN0LlVSTCB8fCB0aGlzLiRfUkVRVUVTVCgnbmFtZScsIHIuVVJMKSA9PSBzTWV0aG9kKSAmJgoJCQkJCQkJCXIuVGV4dFJlc3BvbnNlICYmCgkJCQkJCQkJKHR5cGVvZiByLkV4cGlyZXMgPT09ICd1bmRlZmluZWQnIHx8CgkJCQkJCQkJCW5ldyBEYXRlKHIuRXhwaXJlcykgPiBuZXcgRGF0ZSgpKSkgPwoJCQkJCQkJciA6CgkJCQkJCQludWxsOwoJCQkJCQlpZiAodGV4dHJlc3BvbnNlKSB7CgkJCQkJCQlpdGVtID0gaXRlbSB8fCByZXF1ZXN0OwoJCQkJCQkJaXRlbS5UZXh0UmVzcG9uc2UgPSB0ZXh0cmVzcG9uc2U7CgkJCQkJCQlpdGVtLkV4cGlyZXMgPSBuZXcgRGF0ZSgKCQkJCQkJCQluZXcgRGF0ZSgpLmdldFRpbWUoKSArCgkJCQkJCQkJcGFyc2VGbG9hdCgKCQkJCQkJCQkJdGhpcy5uQ2FjaGVFeHBpcmVIb3VycyB8fCB0aGlzLiRfUkVRVUVTVCgnbkNhY2hlRXhwaXJlSG91cnMnKSB8fCAxCgkJCQkJCQkJKSAqCgkJCQkJCQkJNjAgKgoJCQkJCQkJCTYwICoKCQkJCQkJCQkxMDAwCgkJCQkJCQkpOwoJCQkJCQl9CgoJCQkJCQlyZXR1cm4gaXRlbTsKCQkJCQl9OwoKCQkJCQlpZiAoCgkJCQkJCXRoaXMuYkNhY2hlUmVzdWx0ID09ICdrdnN0b3JlJyAmJgoJCQkJCQl0eXBlb2Ygd2luZG93LmNvbXBhbnkucmVzdGlvZGJTZXR0aW5ncyAhPT0gJ3VuZGVmaW5lZCcKCQkJCQkpIHsKCQkJCQkJdmFyIGFqYXggPSAoa2V5LCB2YWx1ZSwgaWQpID0+IHsKCQkJCQkJCXZhciByZXQgPSBjb21wYW55LnJlc3Rpb2RiU2V0dGluZ3MoKTsKCQkJCQkJCXJldC51cmwgKz0gJ2t2c3RvcmUnOwoJCQkJCQkJaWYgKHZhbHVlKSB7CgkJCQkJCQkJaWYgKGlkKSB7CgkJCQkJCQkJCS8vIHVwZGF0ZSByZWNvcmQKCQkJCQkJCQkJcmV0LnVybCArPSAnLycgKyBpZDsKCQkJCQkJCQkJcmV0Lm1ldGhvZCA9ICdQVVQnOwoJCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJCS8vIG5ldyByZWNvcmQKCQkJCQkJCQkJcmV0Lm1ldGhvZCA9ICdQT1NUJzsKCQkJCQkJCQl9CgkJCQkJCQkJcmV0LmRhdGEgPSBKU09OLnN0cmluZ2lmeSh7CgkJCQkJCQkJCWtleToga2V5LAoJCQkJCQkJCQl2YWx1ZTogSlNPTi5zdHJpbmdpZnkodmFsdWUsIG51bGwsIDQpLAoJCQkJCQkJCX0pOwoJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQlpZiAoaWQpIHsKCQkJCQkJCQkJLy8gZGVsZXRlIHJlY29yZAoJCQkJCQkJCQlyZXQudXJsICs9ICcvJyArIGlkOwoJCQkJCQkJCQlyZXQubWV0aG9kID0gJ0RFTEVURSc7CgkJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQkJcmV0Lm1ldGhvZCA9ICdHRVQnOwoJCQkJCQkJCQlyZXQudXJsICs9ICc/cT17ImtleSI6JyArIGtleSArICd9JzsKCQkJCQkJCQl9CgkJCQkJCQl9CgkJCQkJCQkvL2NvbnNvbGUubG9nKCdtZXRob2QnLCByZXQubWV0aG9kKTsKCQkJCQkJCXJldHVybiByZXQ7CgkJCQkJCX07CgoJCQkJCQlsZXQgcmVjb3JkID0gYXdhaXQgJC5hamF4KGFqYXgocmVxdWVzdC5oYXNoKSk7CgkJCQkJCWxldCByID0KCQkJCQkJCXJlY29yZCAmJiByZWNvcmQubGVuZ3RoID8KCQkJCQkJCUpTT04ucGFyc2UocmVjb3JkWzBdLnZhbHVlKSA6CgkJCQkJCQludWxsOwoJCQkJCQlsZXQgaXRlbSA9IF91c2FibGUocik7CgoJCQkJCQlpZiAoIWl0ZW0pIHsKCQkJCQkJCWlmIChyKSB7CgkJCQkJCQkJYXdhaXQgJC5hamF4KGFqYXgocmVxdWVzdC5oYXNoLCBudWxsLCByZWNvcmRbMF0uX2lkKSk7CgkJCQkJCQl9CgkJCQkJCQlyZXR1cm4gbnVsbDsKCQkJCQkJfQoKCQkJCQkJaWYgKCFyIHx8IGl0ZW0uRXhwaXJlcyA+IHIuRXhwaXJlcykgewoJCQkJCQkJYXdhaXQgJC5hamF4KAoJCQkJCQkJCWFqYXgoaXRlbS5oYXNoLCBpdGVtLCByID8gcmVjb3JkWzBdLl9pZCA6IG51bGwpCgkJCQkJCQkpOwoJCQkJCQkJcmV0dXJuIGl0ZW07CgkJCQkJCX0KCgkJCQkJCXJldHVybiBpdGVtOwoJCQkJCX0gZWxzZSBpZiAodGhpcy5iQ2FjaGVSZXN1bHQgPT0gJ3NyJykgewoJCQkJCQl2YXIgYWpheCA9IChrZXksIHZhbHVlLCBpZCkgPT4gewoJCQkJCQkJdmFyIG1ldGhvZCA9ICdGaW5kJzsKCQkJCQkJCXZhciByZXQgPSB7CgkJCQkJCQkJdXJsOiAnL21ldGhvZC9hLmFzaHg/bmFtZT1Db250ZW50TWFuYWdlci5jbXNNZXRob2RSZXN1bHQnLAoJCQkJCQkJCXByb2Nlc3NEYXRhOiBmYWxzZSwKCQkJCQkJCQl0eXBlOiAnUE9TVCcsCgkJCQkJCQl9OwoJCQkJCQkJaWYgKHZhbHVlKSB7CgkJCQkJCQkJaWYgKGlkKSB7CgkJCQkJCQkJCS8vIHVwZGF0ZSByZWNvcmQKCQkJCQkJCQkJbWV0aG9kID0gJ1VwZGF0ZSc7CgkJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQkJLy8gbmV3IHJlY29yZAoJCQkJCQkJCQltZXRob2QgPSAnSW5zZXJ0JzsKCQkJCQkJCQl9CgkJCQkJCQkJcmV0LmJlZm9yZVNlbmQgPSAocmVxdWVzdCkgPT4gewoJCQkJCQkJCQlyZXF1ZXN0LnNldFJlcXVlc3RIZWFkZXIoCgkJCQkJCQkJCQknQ29udGVudC1UeXBlJywKCQkJCQkJCQkJCSdtdWx0aXBhcnQvZm9ybS1kYXRhOyBib3VuZGFyeT0tLS0tLS0tLS0tLS0tLScKCQkJCQkJCQkJKTsKCQkJCQkJCQl9OwoJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQlyZXQudHlwZSA9ICdHRVQnOwoJCQkJCQkJCWlmIChpZCkgewoJCQkJCQkJCQkvLyBkZWxldGUgcmVjb3JkCgkJCQkJCQkJCW1ldGhvZCA9ICdEZWxldGUnOwoJCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJCS8vIGdldCByZWNvcmQKCQkJCQkJCQkJbWV0aG9kID0gJ0ZpbmQnOwoJCQkJCQkJCX0KCQkJCQkJCQltZXRob2QgKz0KCQkJCQkJCQkJJyZwMD17Q29kZX0nICsKCQkJCQkJCQkJKGNvbXBhbnkgPyBjb21wYW55LkNvZGUgKyAnLScgOiAnJykgKwoJCQkJCQkJCQlrZXkgKwoJCQkJCQkJCQkney9Db2RlfSc7CgkJCQkJCQl9CgkJCQkJCQlyZXQudXJsICs9IG1ldGhvZDsKCQkJCQkJCWlmIChyZXQudHlwZSAhPSAnR0VUJykgewoJCQkJCQkJCWRlbGV0ZSBpdGVtLlBvc3REYXRhOyAvLyBiZWNhdXNlIHdlIGhhdmUgdGhlIGNhY2hlIGtleQoJCQkJCQkJCXZhciBwMCA9IHsKCQkJCQkJCQkJQ29kZTogKGNvbXBhbnkgPyBjb21wYW55LkNvZGUgKyAnLScgOiAnJykgKyBrZXksCgkJCQkJCQkJCUNvbXBsZXRlZDogbmV3IERhdGUoKSwKCQkJCQkJCQkJRGF0ZTogdGhpcy5BY3RpdmVSZXF1ZXN0ID8KCQkJCQkJCQkJCXRoaXMuQWN0aXZlUmVxdWVzdC5EYXRlIDogbmV3IERhdGUoKSwKCQkJCQkJCQkJUmVzdWx0OiBidG9hKHVuZXNjYXBlKGVuY29kZVVSSUNvbXBvbmVudChKU09OLnN0cmluZ2lmeShpdGVtKSkpKSwgLy9pdGVtLlRleHRSZXNwb25zZSwKCQkJCQkJCQkJU3RvcmVkTWV0aG9kOiB7CgkJCQkJCQkJCQlOYW1lOiBzTWV0aG9kLAoJCQkJCQkJCQl9LAoJCQkJCQkJCX07CgkJCQkJCQkJaWYgKGlkKSB7CgkJCQkJCQkJCXAwLklkID0gaWQ7CgkJCQkJCQkJfQoJCQkJCQkJCXJldC5kYXRhID0KCQkJCQkJCQkJJ1BPU1REQVRBPVxyXG4nIC8qKyAiPD94bWwgdmVyc2lvbj1cIjEuMFwiIGVuY29kaW5nPVwidXRmLThcIiBzdGFuZGFsb25lPVwieWVzXCI/PlxyXG4iKi8gKwoJCQkJCQkJCQl0aGlzLnBhcmFtKFtwMF0pOwoJCQkJCQkJfQoJCQkJCQkJcmV0dXJuIHJldDsKCQkJCQkJfTsKCgkJCQkJCWxldCByZWNvcmQgPSB0aGlzLnJ1blNjcmlwdCAvKnJ1blNSU2NyaXB0Ki8oCgkJCQkJCQknKCgpID0+IHsgdmFyIHJldCA9IG51bGw7ICcgKwoJCQkJCQkJKGF3YWl0ICQuYWpheChhamF4KHJlcXVlc3QuaGFzaCkpKSArCgkJCQkJCQkncmV0dXJuIHJldDt9KSgpOycKCQkJCQkJKTsKCQkJCQkJbGV0IHIgPSByZWNvcmQgPyBKU09OLnBhcnNlKHJlY29yZC5SZXN1bHQpIDogbnVsbDsKCQkJCQkJbGV0IGl0ZW0gPSBfdXNhYmxlKHIpOwoKCQkJCQkJaWYgKCFpdGVtKSB7CgkJCQkJCQlpZiAocikgewoJCQkJCQkJCXRyeSB7CgkJCQkJCQkJCWF3YWl0ICQuYWpheChhamF4KHJlcXVlc3QuaGFzaCwgbnVsbCwgcmVjb3JkLklkKSk7CgkJCQkJCQkJfSBjYXRjaCAoZXgpIHt9CgkJCQkJCQl9CgkJCQkJCQlyZXR1cm4gbnVsbDsKCQkJCQkJfQoKCQkJCQkJaWYgKCFyIHx8IGl0ZW0uRXhwaXJlcyA+IHIuRXhwaXJlcykgewoJCQkJCQkJYXdhaXQgJC5hamF4KAoJCQkJCQkJCWFqYXgoaXRlbS5oYXNoLCBpdGVtLCByICYmIHJlY29yZCA/IHJlY29yZC5JZCA6IG51bGwpCgkJCQkJCQkpOwoJCQkJCQkJcmV0dXJuIGl0ZW07CgkJCQkJCX0KCgkJCQkJCXJldHVybiBpdGVtOwoJCQkJCX0gZWxzZSBpZiAodGhpcy5iQ2FjaGVSZXN1bHQgPT0gJ2dpdGh1YicpIHsKCQkJCQkJaWYgKHJlcXVlc3QuVVJMLmluZGV4T2YoJ2Ntc01ldGhvZFJlc3VsdCcpID49IDApIHJldHVybiBudWxsOwoJCQkJCQlsZXQgcmVzID0gbnVsbDsKCQkJCQkJdHJ5IHsKCQkJCQkJCXJlcyA9IGF3YWl0ICQuYWpheCh7CgkJCQkJCQkJdXJsOiAnaHR0cHM6Ly9hcnpob3NwaXRhbC5naXRodWIuaW8vJyArCgkJCQkJCQkJCWNvbXBhbnkuU3RvcmUgKwoJCQkJCQkJCQknLycgKwoJCQkJCQkJCQlyZXF1ZXN0Lmhhc2ggKwoJCQkJCQkJCQknLmpzJywKCQkJCQkJCQlkYXRhVHlwZTogJ2pzb25wJywKCQkJCQkJCQlwcm9jZXNzUmVzdWx0OiBmYWxzZSwKCQkJCQkJCX0pOwoJCQkJCQkJcmV0dXJuIHsKCQkJCQkJCQlUZXh0UmVzcG9uc2U6IHJlcywKCQkJCQkJCX07CgkJCQkJCX0gY2F0Y2ggKGV4KSB7CgkJCQkJCQljb25zb2xlLmxvZygnRVJST1JTOicsIGV4KTsKCQkJCQkJCXJldHVybiBudWxsOwoJCQkJCQl9CgkJCQkJfSBlbHNlIGlmICh0aGlzLmJDYWNoZVJlc3VsdCA9PSAnbG9jYWwnKSB7CgkJCQkJCXZhciBzckNhY2hlID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3NyQ2FjaGUnKTsKCQkJCQkJaWYgKHNyQ2FjaGUgPT0gbnVsbCkgewoJCQkJCQkJc3JDYWNoZSA9IHsKCQkJCQkJCQlSZXF1ZXN0czoge30sCgkJCQkJCQl9OwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJc3JDYWNoZSA9IEpTT04ucGFyc2Uoc3JDYWNoZSk7CgkJCQkJCX0KCgkJCQkJCXZhciByID0gc3JDYWNoZS5SZXF1ZXN0c1tyZXF1ZXN0Lmhhc2hdOwoJCQkJCQl2YXIgaXRlbSA9IF91c2FibGUocik7CgoJCQkJCQlpZiAoIWl0ZW0pIHsKCQkJCQkJCWRlbGV0ZSBzckNhY2hlLlJlcXVlc3RzW3JlcXVlc3QuaGFzaF07CgkJCQkJCQlsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnc3JDYWNoZScsIEpTT04uc3RyaW5naWZ5KHNyQ2FjaGUpKTsKCQkJCQkJCXJldHVybiBudWxsOwoJCQkJCQl9CgoJCQkJCQlpZiAoIXIgfHwgaXRlbS5FeHBpcmVzID4gci5FeHBpcmVzKSB7CgkJCQkJCQlzckNhY2hlLlJlcXVlc3RzW2l0ZW0uaGFzaF0gPSBpdGVtOwoJCQkJCQkJbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ3NyQ2FjaGUnLCBKU09OLnN0cmluZ2lmeShzckNhY2hlKSk7CgkJCQkJCQlyZXR1cm4gaXRlbTsKCQkJCQkJfQoKCQkJCQkJcmV0dXJuIGl0ZW07CgkJCQkJfQoJCQkJfSBjYXRjaCAoZXgpIHsKCQkJCQljb25zb2xlLmxvZyhleCk7CgkJCQkJdGhyb3cgZXg7CgkJCQl9CgkJCX0pKC4uLnBhcmFtcyk7CgkJfQoJfQoJLyogQ0xPTkU6OkVORCAgOiBzci5jYWNoZVJlc3VsdCgpICovCgoJLyogQ0xPTkU6OlNUQVJUOiBzci50b0hleCgpICovCgl0b0hleCguLi5wYXJhbXMpIHsKCQlpZiAodHlwZW9mKHdpbmRvdykgIT09ICJ1bmRlZmluZWQiICYmIHR5cGVvZih3aW5kb3cuc3IpICE9PSAidW5kZWZpbmVkIikgewoJCQlyZXR1cm4gd2luZG93LnNyLnRvSGV4KC4uLnBhcmFtcyk7CgkJfSBlbHNlIHsKCQkJcmV0dXJuICgocykgPT4gewoJCQkJaWYgKHR5cGVvZiBzICE9PSAnc3RyaW5nJykgcmV0dXJuIHM7CgoJCQkJdmFyIGFycjEgPSBbXTsKCQkJCWZvciAodmFyIG4gPSAwLCBsID0gcy5sZW5ndGg7IG4gPCBsOyBuKyspIHsKCQkJCQl2YXIgaGV4ID0gTnVtYmVyKHMuY2hhckNvZGVBdChuKSkudG9TdHJpbmcoMTYpOwoJCQkJCWFycjEucHVzaChoZXgpOwoJCQkJfQoJCQkJcmV0dXJuIGFycjEuam9pbignJyk7CgkJCX0pKC4uLnBhcmFtcyk7CgkJfQoJfQoJLyogQ0xPTkU6OkVORCAgOiBzci50b0hleCgpICovCgoJLyogQ0xPTkU6OlNUQVJUOiBzci5TaG93RXJyb3IoKSAqLwoJU2hvd0Vycm9yKC4uLnBhcmFtcykgewoJCWlmICh0eXBlb2Yod2luZG93KSAhPT0gInVuZGVmaW5lZCIgJiYgdHlwZW9mKHdpbmRvdy5zcikgIT09ICJ1bmRlZmluZWQiKSB7CgkJCXJldHVybiB3aW5kb3cuc3IuU2hvd0Vycm9yKC4uLnBhcmFtcyk7CgkJfSBlbHNlIHsKCQkJcmV0dXJuICgocykgPT4gewoJCQkJY29uc29sZS5sb2cocyk7CgkJCQlpZiAodGhpcy5iU2hvd0Vycm9ycykgdGhpcy5TaG93TWVzc2FnZShzKTsKCQkJfSkoLi4ucGFyYW1zKTsKCQl9Cgl9CgkvKiBDTE9ORTo6RU5EICA6IHNyLlNob3dFcnJvcigpICovCgoJLyogQ0xPTkU6OlNUQVJUOiBzci5FcXVhbHMoKSAqLwoJRXF1YWxzKC4uLnBhcmFtcykgewoJCWlmICh0eXBlb2Yod2luZG93KSAhPT0gInVuZGVmaW5lZCIgJiYgdHlwZW9mKHdpbmRvdy5zcikgIT09ICJ1bmRlZmluZWQiKSB7CgkJCXJldHVybiB3aW5kb3cuc3IuRXF1YWxzKC4uLnBhcmFtcyk7CgkJfSBlbHNlIHsKCQkJcmV0dXJuICgobzEsIG8yKSA9PiB7CgkJCQlpZiAobzEgPT0gbzIpIHJldHVybiB0cnVlOwoKCQkJCWlmICgKCQkJCQlvMSAmJgoJCQkJCW8xLl9fT0JKRUNUSUQgJiYKCQkJCQlvMiAmJgoJCQkJCW8yLl9fT0JKRUNUSUQgJiYKCQkJCQlvMS5fX09CSkVDVElEID09IG8yLl9fT0JKRUNUSUQKCQkJCSkKCQkJCQlyZXR1cm4gdHJ1ZTsKCQkJCWlmIChvMSAmJiBvMS5fX1JPV0lEICYmIG8yICYmIG8yLl9fUk9XSUQgJiYgbzEuX19ST1dJRCA9PSBvMi5fX1JPV0lEKQoJCQkJCXJldHVybiB0cnVlOwoJCQkJaWYgKG8xICYmIG8xLklkICYmIG8yICYmIG8yLklkICYmIG8xLklkID09IG8yLklkKSByZXR1cm4gdHJ1ZTsKCgkJCQlyZXR1cm4gZmFsc2U7CgkJCX0pKC4uLnBhcmFtcyk7CgkJfQoJfQoJLyogQ0xPTkU6OkVORCAgOiBzci5FcXVhbHMoKSAqLwoKCS8qIENMT05FOjpTVEFSVDogc3IuaXBBZGRyZXNzKCkgKi8KCWlwQWRkcmVzcyguLi5wYXJhbXMpIHsKCQlpZiAodHlwZW9mKHdpbmRvdykgIT09ICJ1bmRlZmluZWQiICYmIHR5cGVvZih3aW5kb3cuc3IpICE9PSAidW5kZWZpbmVkIikgewoJCQlyZXR1cm4gd2luZG93LnNyLmlwQWRkcmVzcyguLi5wYXJhbXMpOwoJCX0gZWxzZSB7CgkJCXJldHVybiAoKCkgPT4gewoJCQkJdHJ5IHsKCQkJCQlpZiAodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnKSByZXR1cm4gbnVsbDsKCQkJCQlpZiAodHlwZW9mKGdsb2JhbCkgPT09ICd1bmRlZmluZWQnIHx8IHR5cGVvZihnbG9iYWwub3MpID09PSAndW5kZWZpbmVkJykgewoJCQkJCQkvLyBjb25zb2xlLmxvZygiaXBBZGRyZXNzKCk6IEludmFsaWQgZ2xvYmFsIG9yIGdsb2JhbC5vcyBub3QgZGVmaW5lZCIpOwoJCQkJCQlyZXR1cm4gbnVsbDsKCQkJCQl9CgkJCQkJcmV0dXJuIFtdLmNvbmNhdCguLi5PYmplY3QudmFsdWVzKGdsb2JhbC5vcy5uZXR3b3JrSW50ZXJmYWNlcygpKSkuZmluZCgoZGV0YWlscykgPT4gZGV0YWlscy5mYW1pbHkgPT09ICdJUHY0JyAmJiAhZGV0YWlscy5pbnRlcm5hbCkuYWRkcmVzczsKCQkJCX0gY2F0Y2ggKGV4KSB7CgkJCQkJY29uc29sZS5sb2coImlwQWRkcmVzcygpOiAiICsgZXgpOwoJCQkJCXJldHVybiBudWxsOwoJCQkJfQoJCQl9KSguLi5wYXJhbXMpOwoJCX0KCX0KCS8qIENMT05FOjpFTkQgIDogc3IuaXBBZGRyZXNzKCkgKi8KCgkvKiBFTkQ6IHNyIGZ1bmN0aW9uIGNvcGllcyAqLwoKCS8qIFNUQVJUOiBfRnJFTUQgZnVuY3Rpb24gY29waWVzICovCgoJLyogQ0xPTkU6OlNUQVJUOiBfRnJFTUQuX2F0dHIoKSAqLwoJX2F0dHIoLi4ucGFyYW1zKSB7CgkJaWYgKHR5cGVvZih3aW5kb3cpICE9PSAidW5kZWZpbmVkIiAmJiB0eXBlb2Yod2luZG93Ll9GckVNRCkgIT09ICJ1bmRlZmluZWQiKSB7CgkJCXJldHVybiB3aW5kb3cuX0ZyRU1ELl9hdHRyKC4uLnBhcmFtcyk7CgkJfSBlbHNlIHsKCQkJcmV0dXJuICgoZWEpID0+IHsKCQkJCXRyeSB7CgkJCQkJaWYgKGVhLkVudGl0eVR5cGUpIHJldHVybiAiRW50aXR5IjsKCQkJCQlyZXR1cm4gT2JqZWN0LmtleXMoZWEpLmZpbHRlcihrID0+ICFrLmluZGV4T2YoIklzIikgJiYgayAhPT0gIklzVW5pcXVlIikuZmluZChrID0+IGVhW2tdKS5yZXBsYWNlKCdJcycsICcnKTsKCQkJCX0gY2F0Y2ggKGV4KSB7CgkJCQkJcmV0dXJuIG51bGw7CgkJCQl9CgkJCX0pKC4uLnBhcmFtcyk7CgkJfQoJfQoJLyogQ0xPTkU6OkVORCAgOiBfRnJFTUQuX2F0dHIoKSAqLwoKCS8qIENMT05FOjpTVEFSVDogX0ZyRU1ELl91bmlxdWUoKSAqLwoJX3VuaXF1ZSguLi5wYXJhbXMpIHsKCQlpZiAodHlwZW9mKHdpbmRvdykgIT09ICJ1bmRlZmluZWQiICYmIHR5cGVvZih3aW5kb3cuX0ZyRU1EKSAhPT0gInVuZGVmaW5lZCIpIHsKCQkJcmV0dXJuIHdpbmRvdy5fRnJFTUQuX3VuaXF1ZSguLi5wYXJhbXMpOwoJCX0gZWxzZSB7CgkJCXJldHVybiAoKGEpID0+IHsKCQkJCXJldHVybiBhLmZpbHRlcigoYWcsIGkpID0+ICFhLmZpbmQoKF9hZywgX2kpID0+IF9hZy5OYW1lID09IGFnLk5hbWUgJiYgX2kgPiBpICYmIGkgPT0gX2kpKTsKCQkJfSkoLi4ucGFyYW1zKTsKCQl9Cgl9CgkvKiBDTE9ORTo6RU5EICA6IF9GckVNRC5fdW5pcXVlKCkgKi8KCgkvKiBDTE9ORTo6U1RBUlQ6IF9GckVNRC5fZmxpcCgpICovCglfZmxpcCguLi5wYXJhbXMpIHsKCQlpZiAodHlwZW9mKHdpbmRvdykgIT09ICJ1bmRlZmluZWQiICYmIHR5cGVvZih3aW5kb3cuX0ZyRU1EKSAhPT0gInVuZGVmaW5lZCIpIHsKCQkJcmV0dXJuIHdpbmRvdy5fRnJFTUQuX2ZsaXAoLi4ucGFyYW1zKTsKCQl9IGVsc2UgewoJCQlyZXR1cm4gKChvYmopID0+IHsKCQkJCXJldHVybiBPYmplY3QuZnJvbUVudHJpZXMoT2JqZWN0LmVudHJpZXMob2JqKS5tYXAoKFtrLCB2XSkgPT4gW3YsIGtdKSk7CgkJCX0pKC4uLnBhcmFtcyk7CgkJfQoJfQoJLyogQ0xPTkU6OkVORCAgOiBfRnJFTUQuX2ZsaXAoKSAqLwoKCS8qIENMT05FOjpTVEFSVDogX0ZyRU1ELl9fc2NvcGUoKSAqLwoJX19zY29wZSguLi5wYXJhbXMpIHsKCQlpZiAodHlwZW9mKHdpbmRvdykgIT09ICJ1bmRlZmluZWQiICYmIHR5cGVvZih3aW5kb3cuX0ZyRU1EKSAhPT0gInVuZGVmaW5lZCIpIHsKCQkJcmV0dXJuIHdpbmRvdy5fRnJFTUQuX19zY29wZSguLi5wYXJhbXMpOwoJCX0gZWxzZSB7CgkJCXJldHVybiAoKHNjb3BlKSA9PiB7CgkJCQlsZXQgcmV0ID0gKHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJyA/IHdpbmRvdyA6IGdsb2JhbCk7CgkJCQlpZiAoc2NvcGUpIHJldCA9IHJldFtzY29wZV07CgkJCQlyZXR1cm4gcmV0OwoJCQl9KSguLi5wYXJhbXMpOwoJCX0KCX0KCS8qIENMT05FOjpFTkQgIDogX0ZyRU1ELl9fc2NvcGUoKSAqLwoKCS8qIENMT05FOjpTVEFSVDogX0ZyRU1ELnNyKCkgKi8KCXNyKC4uLnBhcmFtcykgewoJCWlmICh0eXBlb2Yod2luZG93KSAhPT0gInVuZGVmaW5lZCIgJiYgdHlwZW9mKHdpbmRvdy5fRnJFTUQpICE9PSAidW5kZWZpbmVkIikgewoJCQlyZXR1cm4gd2luZG93Ll9GckVNRC5zciguLi5wYXJhbXMpOwoJCX0gZWxzZSB7CgkJCXJldHVybiAoKCkgPT4gewoJCQkJcmV0dXJuICh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgJiYgd2luZG93LlNSKSA/IHdpbmRvdy5TUiA6IHRoaXM7CgkJCX0pKC4uLnBhcmFtcyk7CgkJfQoJfQoJLyogQ0xPTkU6OkVORCAgOiBfRnJFTUQuc3IoKSAqLwoKCS8qIENMT05FOjpTVEFSVDogX0ZyRU1ELl9hdG9iKCkgKi8KCV9hdG9iKC4uLnBhcmFtcykgewoJCWlmICh0eXBlb2Yod2luZG93KSAhPT0gInVuZGVmaW5lZCIgJiYgdHlwZW9mKHdpbmRvdy5fRnJFTUQpICE9PSAidW5kZWZpbmVkIikgewoJCQlyZXR1cm4gd2luZG93Ll9GckVNRC5fYXRvYiguLi5wYXJhbXMpOwoJCX0gZWxzZSB7CgkJCXJldHVybiAoKGEpID0+IHsKCQkJCXJldHVybiB0eXBlb2YoYXRvYikgPT09ICJ1bmRlZmluZWQiID8gQnVmZmVyLmZyb20oYSwgJ2Jhc2U2NCcpLnRvU3RyaW5nKCdiaW5hcnknKSA6IGF0b2IoYSk7CgkJCX0pKC4uLnBhcmFtcyk7CgkJfQoJfQoJLyogQ0xPTkU6OkVORCAgOiBfRnJFTUQuX2F0b2IoKSAqLwoKCS8qIENMT05FOjpTVEFSVDogX0ZyRU1ELl9idG9hKCkgKi8KCV9idG9hKC4uLnBhcmFtcykgewoJCWlmICh0eXBlb2Yod2luZG93KSAhPT0gInVuZGVmaW5lZCIgJiYgdHlwZW9mKHdpbmRvdy5fRnJFTUQpICE9PSAidW5kZWZpbmVkIikgewoJCQlyZXR1cm4gd2luZG93Ll9GckVNRC5fYnRvYSguLi5wYXJhbXMpOwoJCX0gZWxzZSB7CgkJCXJldHVybiAoKGIpID0+IHsKCQkJCXJldHVybiB0eXBlb2YoYnRvYSkgPT09ICJ1bmRlZmluZWQiID8gQnVmZmVyLmZyb20oYikudG9TdHJpbmcoJ2Jhc2U2NCcpIDogYnRvYSh1bmVzY2FwZShlbmNvZGVVUklDb21wb25lbnQoYikpKTsKCQkJfSkoLi4ucGFyYW1zKTsKCQl9Cgl9CgkvKiBDTE9ORTo6RU5EICA6IF9GckVNRC5fYnRvYSgpICovCgoJLyogQ0xPTkU6OlNUQVJUOiBfRnJFTUQuX190aW1lKCkgKi8KCV9fdGltZSguLi5wYXJhbXMpIHsKCQlpZiAodHlwZW9mKHdpbmRvdykgIT09ICJ1bmRlZmluZWQiICYmIHR5cGVvZih3aW5kb3cuX0ZyRU1EKSAhPT0gInVuZGVmaW5lZCIpIHsKCQkJcmV0dXJuIHdpbmRvdy5fRnJFTUQuX190aW1lKC4uLnBhcmFtcyk7CgkJfSBlbHNlIHsKCQkJcmV0dXJuICgobmFtZSA9ICJnbG9iYWwiKSA9PiB7CgkJCQlsZXQgZCA9IG5ldyBEYXRlKCkgfHwgdGhpcy5zcigpLnNlcnZlckRhdGUoKTsKCQkJCXRoaXMuX19zY29wZSgpLl9fdGltZXMgPSB0aGlzLl9fc2NvcGUoKS5fX3RpbWVzIHx8IHt9OwoJCQkJdGhpcy5fX3Njb3BlKCkuX190aW1lc1tuYW1lXSA9IHRoaXMuX19zY29wZSgpLl9fdGltZXNbbmFtZV0gfHwgZDsKCgkJCQlsZXQgcyA9IE1hdGgucm91bmQoKChkIC0gdGhpcy5fX3Njb3BlKCkuX190aW1lc1tuYW1lXSkgLyAxMDAwKSAqIDEwMCwgMikgLyAxMDA7CgkJCQl0aGlzLl9fc2NvcGUoKS5fX3RpbWVzW25hbWVdID0gZDsKCQkJCXJldHVybiAocyArICdzJyk7CgkJCX0pKC4uLnBhcmFtcyk7CgkJfQoJfQoJLyogQ0xPTkU6OkVORCAgOiBfRnJFTUQuX190aW1lKCkgKi8KCgkvKiBDTE9ORTo6U1RBUlQ6IF9GckVNRC5fd2FpdCgpICovCglfd2FpdCguLi5wYXJhbXMpIHsKCQlpZiAodHlwZW9mKHdpbmRvdykgIT09ICJ1bmRlZmluZWQiICYmIHR5cGVvZih3aW5kb3cuX0ZyRU1EKSAhPT0gInVuZGVmaW5lZCIpIHsKCQkJcmV0dXJuIHdpbmRvdy5fRnJFTUQuX3dhaXQoLi4ucGFyYW1zKTsKCQl9IGVsc2UgewoJCQlyZXR1cm4gKGFzeW5jIChtcykgPT4gewoJCQkJYXdhaXQgbmV3IFByb21pc2UocmVzb2x2ZSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIG1zKSk7CgkJCX0pKC4uLnBhcmFtcyk7CgkJfQoJfQoJLyogQ0xPTkU6OkVORCAgOiBfRnJFTUQuX3dhaXQoKSAqLwoKCS8qIENMT05FOjpTVEFSVDogX0ZyRU1ELl9zcWxUeXBlKCkgKi8KCV9zcWxUeXBlKC4uLnBhcmFtcykgewoJCWlmICh0eXBlb2Yod2luZG93KSAhPT0gInVuZGVmaW5lZCIgJiYgdHlwZW9mKHdpbmRvdy5fRnJFTUQpICE9PSAidW5kZWZpbmVkIikgewoJCQlyZXR1cm4gd2luZG93Ll9GckVNRC5fc3FsVHlwZSguLi5wYXJhbXMpOwoJCX0gZWxzZSB7CgkJCXJldHVybiAoKGVhLCBkYlR5cGUpID0+IHsKCQkJCWxldCB0eXBlID0gdHlwZW9mKGVhKSA9PT0gInN0cmluZyIgPyBlYSA6IHRoaXMuX2F0dHIoZWEpOwoJCQkJc3dpdGNoICh0eXBlKSB7CgkJCQkJY2FzZSAiU3RyaW5nIjoKCQkJCQkJcmV0dXJuICJWQVJDSEFSKDI1NSkiOwoJCQkJCWNhc2UgIlRleHQiOgoJCQkJCWNhc2UgIk9iamVjdCI6CgkJCQkJCXJldHVybiBgJHtkYlR5cGU9PSdzcWxpdGUnPydWQVJDSEFSJzonVEVYVCd9KDQwMDApYDsKCQkJCQljYXNlICJCb29sIjoKCQkJCQkJcmV0dXJuICJUSU5ZSU5UIjsgLy9CSVQKCQkJCQljYXNlICJEYXRlIjoKCQkJCQkJcmV0dXJuICJEQVRFVElNRSI7CgkJCQkJY2FzZSAiSW50IjoKCQkJCQkJcmV0dXJuICJJTlRFR0VSIjsKCQkJCQljYXNlICJMb25nIjoKCQkJCQkJcmV0dXJuICJCSUdJTlQiOwoJCQkJCWNhc2UgIkVudGl0eSI6CgkJCQkJCXJldHVybiAiVkFSQ0hBUigyNTUpIjsKCQkJCQljYXNlICJJbWFnZSI6CgkJCQkJY2FzZSAiRmlsZSI6CgkJCQkJCXJldHVybiAiQkxPQiI7CgkJCQkJZGVmYXVsdDoKCQkJCQkJcmV0dXJuIHR5cGUgKyAiKDQwKSI7CgkJCQl9CgkJCX0pKC4uLnBhcmFtcyk7CgkJfQoJfQoJLyogQ0xPTkU6OkVORCAgOiBfRnJFTUQuX3NxbFR5cGUoKSAqLwoKCS8qIENMT05FOjpTVEFSVDogX0ZyRU1ELl91dWlkKCkgKi8KCV91dWlkKC4uLnBhcmFtcykgewoJCWlmICh0eXBlb2Yod2luZG93KSAhPT0gInVuZGVmaW5lZCIgJiYgdHlwZW9mKHdpbmRvdy5fRnJFTUQpICE9PSAidW5kZWZpbmVkIikgewoJCQlyZXR1cm4gd2luZG93Ll9GckVNRC5fdXVpZCguLi5wYXJhbXMpOwoJCX0gZWxzZSB7CgkJCXJldHVybiAoKGlkLCBsZW4pID0+IHsKCQkJCWxldCByZXQgPSBudWxsOwoKCQkJCWlmICghcmV0ICYmIHR5cGVvZihnbG9iYWwpICE9PSAndW5kZWZpbmVkJyAmJiB0eXBlb2YoY3J5cHRvKSAhPT0gJ3VuZGVmaW5lZCcpIHJldCA9IGNyeXB0by5yYW5kb21VVUlEKCk7CgkJCQlpZiAoIXJldCAmJiB0eXBlb2YodXVpZHY0KSAhPT0gInVuZGVmaW5lZCIpIHJldCA9IHV1aWR2NCgpOwoKCQkJCWlmICghcmV0KSByZXQgPSAoKChpZCA/IE51bWJlcihpZCkgOiBuZXcgRGF0ZSgpLmdldFRpbWUoKSAvIDEwKSB8IDApLnRvU3RyaW5nKDE2KSkgKyAneHh4eHh4eHh4eHh4eHh4eCcucmVwbGFjZSgvW3hdL2csICgpID0+IHsKCQkJCQlyZXR1cm4gKChpZCA/IGlkIDogTWF0aC5yYW5kb20oKSkgKiAxNiB8IDApLnRvU3RyaW5nKDE2KTsKCQkJCX0pLnRvTG93ZXJDYXNlKCkuc3Vic3RyaW5nKDAsIGxlbiB8fCAyNCkucmVwbGFjZSgvXC0vZywgJycpOwoKCQkJCS8vbGV0IHBvb2wgPSAodGhpcy5fX3Njb3BlKCkuX191dWlkUG9vbCA9IHRoaXMuX19zY29wZSgpLl9fdXVpZFBvb2wgfHwgW10pOwoJCQkJLy9pZiAocG9vbC5maW5kKHUgPT4gdSA9PSByZXQpKSByZXR1cm4gdGhpcy5fdXVpZChpZCwgbGVuKTsKCQkJCS8vcG9vbC5wdXNoKHJldCk7CgoJCQkJcmV0dXJuIHJldDsKCQkJfSkoLi4ucGFyYW1zKTsKCQl9Cgl9CgkvKiBDTE9ORTo6RU5EICA6IF9GckVNRC5fdXVpZCgpICovCgoJLyogQ0xPTkU6OlNUQVJUOiBfRnJFTUQucmVxdWlyZSgpICovCglyZXF1aXJlKC4uLnBhcmFtcykgewoJCWlmICh0eXBlb2Yod2luZG93KSAhPT0gInVuZGVmaW5lZCIgJiYgdHlwZW9mKHdpbmRvdy5fRnJFTUQpICE9PSAidW5kZWZpbmVkIikgewoJCQlyZXR1cm4gd2luZG93Ll9GckVNRC5yZXF1aXJlKC4uLnBhcmFtcyk7CgkJfSBlbHNlIHsKCQkJcmV0dXJuIChhc3luYyAobGliTmFtZSwgaHJlZnMpID0+IHsKCQkJCWZvciBhd2FpdCAoY29uc3QgbiBvZiAoaHJlZnMgfHwgdGhpcy5ocmVmcykuZmlsdGVyKGwgPT4gbC5saWIgPT09IGxpYk5hbWUgJiYgdGhpcy5faW5jbHVkZShsKSkpIHsKCQkJCQluLnJlcXVpcmVzID0gbi5yZXF1aXJlcyB8fCBbXTsKCQkJCQlmb3IgYXdhaXQgKGNvbnN0IHIgb2Ygbi5yZXF1aXJlcy5maWx0ZXIociA9PiByICE9IGxpYk5hbWUpKSB7CgkJCQkJCWF3YWl0IHRoaXMucmVxdWlyZShyLCBocmVmcyk7CgkJCQkJfQoKCQkJCQlpZiAodHlwZW9mKHRoaXMuX2NzcykgIT09ICd1bmRlZmluZWQnKSB7CgkJCQkJCWZvciAoY29uc3QgYyBvZiBBcnJheS5pc0FycmF5KG4uY3NzKSA/IG4uY3NzIDogW24uY3NzXSkgewoJCQkJCQkJdGhpcy5fY3NzKGMpOwoJCQkJCQl9CgkJCQkJfQoJCQkJCXZhciBtb2R1bGVzID0gW107CgkJCQkJZm9yIGF3YWl0IChjb25zdCBzIG9mIEFycmF5LmlzQXJyYXkobi5zcmMpID8gbi5zcmMgOiBbbi5zcmNdKSB7CgkJCQkJCXRyeSB7CgkJCQkJCQlpZiAocy5OYW1lKSB7CgkJCQkJCQkJLy8gc3RvcmVkIHNjcmlwdAoJCQkJCQkJCWxldCBfc2MgPSBhd2FpdCBzci5fKCJDb250ZW50TWFuYWdlci5jbXNTdG9yZWRTY3JpcHRGaW5kIiwgbnVsbCwgcyk7CgkJCQkJCQkJYXdhaXQgc3IucnVuU2NyaXB0KF9zYy5TY3JpcHQpOwoJCQkJCQkJfSBlbHNlIGlmIChuLm1vZHVsZSkgewoJCQkJCQkJCW1vZHVsZXMucHVzaChhd2FpdCBpbXBvcnQocykpOwoJCQkJCQkJfSBlbHNlIGlmICh0eXBlb2YoJCkgIT09ICd1bmRlZmluZWQnICYmIHR5cGVvZigkLmFqYXgpICE9PSAndW5kZWZpbmVkJykgewoKCQkJCQkJCQlhd2FpdCAkLmFqYXgoewoJCQkJCQkJCQl1cmw6IG4uY2FjaGUgPyBzIDogdGhpcy5yYW5kVVJMKHMpLAoJCQkJCQkJCQlkYXRhVHlwZTogInNjcmlwdCIsCgkJCQkJCQkJCWNhY2hlOiBuLmNhY2hlID8gJ2ZvcmNlLWNhY2hlJyA6ICdkZWZhdWx0JwoJCQkJCQkJCX0pOwoJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQlhd2FpdCBuZXcgUHJvbWlzZShyID0+IHsKCQkJCQkJCQkJbGV0IHNjcmlwdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NjcmlwdCcpOwoJCQkJCQkJCQlzY3JpcHQub25sb2FkID0gKCkgPT4gcigpOwoJCQkJCQkJCQlzY3JpcHQuc3JjID0gczsKCQkJCQkJCQkJKGRvY3VtZW50LmJvZHkgfHwgZG9jdW1lbnQuaGVhZCkuYXBwZW5kQ2hpbGQoc2NyaXB0KTsKCQkJCQkJCQl9KTsKCQkJCQkJCX0KCQkJCQkJfSBjYXRjaCAoZXgpIHsKCQkJCQkJCWNvbnNvbGUubG9nKCJyZXF1aXJlWyIgKyBuLmxpYiArICJdIEV4Y2VwdGlvbjogIiArIGV4LCBzKTsKCQkJCQkJfQoJCQkJCX0KCQkJCQlpZiAobi5sb2FkKSB7CgkJCQkJCXRyeSB7CgkJCQkJCQlhd2FpdCBuLmxvYWQobW9kdWxlcyk7CgkJCQkJCX0gY2F0Y2ggKGV4KSB7CgkJCQkJCQljb25zb2xlLmxvZygiRXhjZXB0aW9uIGluIGxvYWQoKSBvZiAiICsgbi5saWIsIGV4KTsKCQkJCQkJfQoJCQkJCX0KCQkJCX0KCQkJCWNvbnNvbGUubG9nKCJyZXF1aXJlWyIgKyBsaWJOYW1lICsgIl0iKTsKCQkJfSkoLi4ucGFyYW1zKTsKCQl9Cgl9CgkvKiBDTE9ORTo6RU5EICA6IF9GckVNRC5yZXF1aXJlKCkgKi8KCgkvKiBDTE9ORTo6U1RBUlQ6IF9GckVNRC5faW5jbHVkZSgpICovCglfaW5jbHVkZSguLi5wYXJhbXMpIHsKCQlpZiAodHlwZW9mKHdpbmRvdykgIT09ICJ1bmRlZmluZWQiICYmIHR5cGVvZih3aW5kb3cuX0ZyRU1EKSAhPT0gInVuZGVmaW5lZCIpIHsKCQkJcmV0dXJuIHdpbmRvdy5fRnJFTUQuX2luY2x1ZGUoLi4ucGFyYW1zKTsKCQl9IGVsc2UgewoJCQlyZXR1cm4gKChfaHJlZikgPT4gewoJCQkJcmV0dXJuICEoX2hyZWYuZGlzYWJsZWQgfHwgKF9ocmVmLnR5cGUgJiYgdGhpcy5pc01vYmlsZSgpICYmIF9ocmVmLnR5cGUgIT0gIm1vYmlsZSIpIHx8IChfaHJlZi50eXBlICYmICF0aGlzLmlzTW9iaWxlKCkgJiYgX2hyZWYudHlwZSA9PSAibW9iaWxlIikpOwoJCQl9KSguLi5wYXJhbXMpOwoJCX0KCX0KCS8qIENMT05FOjpFTkQgIDogX0ZyRU1ELl9pbmNsdWRlKCkgKi8KCgkvKiBDTE9ORTo6U1RBUlQ6IF9GckVNRC5fYmVhdXRpZnkoKSAqLwoJX2JlYXV0aWZ5KC4uLnBhcmFtcykgewoJCWlmICh0eXBlb2Yod2luZG93KSAhPT0gInVuZGVmaW5lZCIgJiYgdHlwZW9mKHdpbmRvdy5fRnJFTUQpICE9PSAidW5kZWZpbmVkIikgewoJCQlyZXR1cm4gd2luZG93Ll9GckVNRC5fYmVhdXRpZnkoLi4ucGFyYW1zKTsKCQl9IGVsc2UgewoJCQlyZXR1cm4gKCh2YWx1ZSwgdHlwZSkgPT4gewoJCQkJdHJ5IHsKCQkJCQlpZiAodHlwZW9mKGJlYXV0aWZpZXIpICE9PSAidW5kZWZpbmVkIikgewoJCQkJCQl2YXIgb3B0aW9ucyA9IHsKCQkJCQkJCSJpbmRlbnRfc2l6ZSI6ICIxIiwKCQkJCQkJCSJpbmRlbnRfY2hhciI6ICJcdCIsCgkJCQkJCQkibWF4X3ByZXNlcnZlX25ld2xpbmVzIjogIjIiLAoJCQkJCQkJInByZXNlcnZlX25ld2xpbmVzIjogdHJ1ZSwKCQkJCQkJCSJrZWVwX2FycmF5X2luZGVudGF0aW9uIjogZmFsc2UsCgkJCQkJCQkiYnJlYWtfY2hhaW5lZF9tZXRob2RzIjogZmFsc2UsCgkJCQkJCQkiaW5kZW50X3NjcmlwdHMiOiAibm9ybWFsIiwKCQkJCQkJCSJicmFjZV9zdHlsZSI6ICJjb2xsYXBzZSIsCgkJCQkJCQkic3BhY2VfYmVmb3JlX2NvbmRpdGlvbmFsIjogdHJ1ZSwKCQkJCQkJCSJ1bmVzY2FwZV9zdHJpbmdzIjogZmFsc2UsCgkJCQkJCQkianNsaW50X2hhcHB5IjogZmFsc2UsCgkJCQkJCQkiZW5kX3dpdGhfbmV3bGluZSI6IGZhbHNlLAoJCQkJCQkJIndyYXBfbGluZV9sZW5ndGgiOiAiMCIsCgkJCQkJCQkiaW5kZW50X2lubmVyX2h0bWwiOiBmYWxzZSwKCQkJCQkJCSJjb21tYV9maXJzdCI6IGZhbHNlLAoJCQkJCQkJImU0eCI6IHRydWUsCgkJCQkJCQkiaW5kZW50X2VtcHR5X2xpbmVzIjogZmFsc2UKCQkJCQkJfTsKCQkJCQkJaWYgKFsnY3NoYXJwJywgJ2phdmFzY3JpcHQnXS5pbmRleE9mKHR5cGUpID4gLTEpIHsKCQkJCQkJCXZhbHVlID0gYmVhdXRpZmllci5qcyh0eXBlb2YodmFsdWUpICE9PSAnc3RyaW5nJyA/IEpTT04uc3RyaW5naWZ5KHZhbHVlKSA6IHZhbHVlLCBvcHRpb25zKTsKCQkJCQkJfSBlbHNlIGlmIChbJ2h0bWwnXS5pbmRleE9mKHR5cGUpID4gLTEpIHsKCQkJCQkJCXZhbHVlID0gYmVhdXRpZmllci5odG1sKHZhbHVlLCBvcHRpb25zKTsKCQkJCQkJfQoJCQkJCX0KCQkJCX0gY2F0Y2ggKGV4KSB7fQoJCQkJcmV0dXJuIHZhbHVlOwoJCQl9KSguLi5wYXJhbXMpOwoJCX0KCX0KCS8qIENMT05FOjpFTkQgIDogX0ZyRU1ELl9iZWF1dGlmeSgpICovCgoJLyogRU5EOiBfRnJFTUQgZnVuY3Rpb24gY29waWVzICovCgoJaTE4bihldiwgdikgewoJCWlmICh0eXBlb2Yod2luZG93KSA9PT0gInVuZGVmaW5lZCIgfHwgdHlwZW9mKHdpbmRvdy5pMThuX3N0b3JlKSA9PT0gInVuZGVmaW5lZCIpIHJldHVybiB2OwoKCQlpZiAoIWV2LkVudGl0eUF0dHJpYnV0ZS5Jc1RleHQgJiYgIWV2LkVudGl0eUF0dHJpYnV0ZS5Jc1N0cmluZykgewoJCQlyZXR1cm4gdjsKCQl9IGVsc2UgewoJCQlyZXR1cm4gd2luZG93LmkxOG5fc3RvcmVbdGhpcy5oYXNoQ29kZSh2KV0gPSB3aW5kb3cuaTE4bl9zdG9yZVt0aGlzLmhhc2hDb2RlKHYpXSB8fCB2OwoJCX0KCX0KCgl0b1N0cmluZygpIHsKCgkJcmV0dXJuIHRoaXMuX25hbWU7CgoJfQoKCUVudGl0eVZhbHVlKGFOYW1lKSB7CgkJbGV0IHJldCA9IFtdLmNvbmNhdCh0aGlzLkVudGl0eVZhbHVlcywgdGhpcy5WYWx1ZUVudGl0aWVzKS5maW5kKGV2ID0+IGV2LkVudGl0eUF0dHJpYnV0ZSAmJiBldi5FbnRpdHlBdHRyaWJ1dGUuTmFtZSA9PSBhTmFtZSk7CgoJCWlmICghcmV0KSB7CgkJCS8vIGFuIGF0dHJpYnV0ZSB0aGF0IGhhcyB5ZXQgbm8ga25vd24gZW50aXR5IHZhbHVlCgkJCXJldCA9IHsKCQkJCUFjdGl2ZTogdHJ1ZSwKCQkJCU9QRVJBVE9SUzoge30sCgkJCQlFbnRpdHlBdHRyaWJ1dGU6IHsKCQkJCQlOYW1lOiBhTmFtZSwKCQkJCQlBY3RpdmU6IHRydWUsCgkJCQkJRW50aXR5Q2xhc3M6IHsKCQkJCQkJSWQ6IHRoaXMuRW50aXR5Q2xhc3MuSWQKCQkJCQl9CgkJCQl9CgkJCX07CgkJCXRoaXMuRW50aXR5VmFsdWVzLnB1c2gocmV0KTsKCQl9CgoJCXJldHVybiByZXQ7Cgl9CgoJYXN5bmMgZmluZChkZXB0aCA9IDEpIHsKCQlyZXR1cm4gKGF3YWl0IHRoaXMuZmluZEFsbChkZXB0aCkpWzBdOwoJfQoKCV9fYXNzZXJ0VmFsaWQoYlN5bmMpIHsKCQlsZXQgZXJyb3IgPSB7fTsKCgkJaWYgKAoJCQkvKgoJCQkoKG9TY29wZSkgPT4gewoJCQkgICAgbGV0IHJldCA9IGZhbHNlOwoJCQkgICAgaWYodHlwZW9mKHJldCk9PT0iZnVuY3Rpb24iKXsKCQkJICAgICAgICByZXQgPSByZXQob1Njb3BlKTsKCQkJICAgIH0KCQkJICAgIHJldHVybiByZXQ7CgkJCX0pKGxvdHRvKQoJCQkgfHwgKi8KCQkJKChvU2NvcGUpID0+IHsKCQkJCWxldCByZXQgPSB0cnVlOwoJCQkJaWYgKHR5cGVvZihyZXQpID09PSAiZnVuY3Rpb24iKSB7CgkJCQkJcmV0ID0gcmV0KG9TY29wZSk7CgkJCQl9CgkJCQlyZXR1cm4gcmV0OwoJCQl9KShsb3R0bykKCQkpIHsKCQkJZXJyb3IubmFtZSA9IHt9OwoJCQlpZiAoIXRoaXMuX25hbWVfc2V0KSBlcnJvci5uYW1lWyIwMSJdID0gIk5vdCBTZXQiOwoKCQkJaWYgKCFPYmplY3Qua2V5cyhlcnJvci5uYW1lKS5sZW5ndGgpIGRlbGV0ZSBlcnJvci5uYW1lOwoJCX0KCgkJaWYgKE9iamVjdC5rZXlzKGVycm9yKS5sZW5ndGgpIHsKCQkJdGhpcy5fX2Fzc2VydEVycm9yID0gZXJyb3I7CgkJCXRoaXMubG9nKHVuZGVmaW5lZCwgJ19fYXNzZXJ0VmFsaWQnLCAnRW50aXR5T2JqZWN0JywgMiwgSlNPTi5zdHJpbmdpZnkoZXJyb3IsIG51bGwsIDQpLCB0aGlzLl90b0RvY3VtZW50KCkpOwoJCQlyZXR1cm4gZmFsc2U7CgkJfSBlbHNlIHsKCQkJZGVsZXRlIHRoaXMuX19hc3NlcnRFcnJvcjsKCQkJcmV0dXJuIHRydWU7CgkJfQoJfQoKCWFzeW5jIHN0b3JlKCkgewoJCWxldCByZXN1bHRzID0gYXdhaXQgdGhpcy5fZXhlY3V0ZShsb3R0bywgInN0b3JlIiwgYXN5bmMgKGxvZywgd2FybiwgZXJyb3IsIG9TY29wZSwgbWV0aG9kID0gInN0b3JlIiwgX25vZGUpID0+IHsKCQkJcmV0dXJuIF9ub2RlLl9zYW1lTm9kZShvU2NvcGUuX25vZGUuX3BhcmVudCkKCQl9LCBhc3luYyAobG9nLCB3YXJuLCBlcnJvciwgb1Njb3BlLCBtZXRob2QgPSAic3RvcmUiKSA9PiB7CgkJCS8qKiogU1RBUlQgTE9DQUwgc3RvcmUoKSAqKiovCgkJCS8vdGhpcy5fX3RpbWUoJ2xvdHRvLlVzZXIuc3RvcmUnKTsgLy8gb3IgaW5zaWRlIGV4ZWN1dGU/CgoJCQlkZWxldGUgbG90dG8uX3VuUmVjdXJzZTsKCQkJbGV0IGJVcGRhdGUgPSBmYWxzZTsKCQkJbGV0IGJJbnNlcnQgPSBmYWxzZTsKCgkJCWlmICh0aGlzLl9fY29uZmlnKCdzdG9yZS5kaXNhYmxlZCcpKSB7CgkJCQl0aGlzLmxvZyh1bmRlZmluZWQsICdzdG9yZScsICdFbnRpdHlPYmplY3QnLCAxLCAic3RvcmluZyBkaXNhYmxlZCIpOwoJCQl9IGVsc2UgaWYgKCF0aGlzLl9fc3luY19vbigpKSB7CgkJCQlsZXQgX3RoaXMgPSBuZXcgbG90dG8uVXNlcihudWxsLCB0aGlzLlRvb2wpOwoKCQkJCWxldCBiRmluZCA9IGZhbHNlOwoJCQkJaWYgKHRoaXMuSWQgPT0gdGhpcy5JZCkgewoJCQkJCWJGaW5kID0gdHJ1ZTsKCQkJCQlfdGhpcy5JZCA9IHRoaXMuSWQ7CgkJCQl9CgoJCQkJaWYgKAoJCQkJCSgob1Njb3BlKSA9PiB7CgkJCQkJCWxldCByZXQgPSB0cnVlOwoJCQkJCQlpZiAodHlwZW9mKHJldCkgPT09ICJmdW5jdGlvbiIpIHsKCQkJCQkJCXJldCA9IHJldChvU2NvcGUpOwoJCQkJCQl9CgkJCQkJCXJldHVybiByZXQ7CgkJCQkJfSkobG90dG8pCgkJCQkpIHsKCQkJCQliRmluZCA9IHRydWU7CgkJCQkJX3RoaXMuY29kZSh0aGlzLmNvZGUoKSwgJz0nKTsKCQkJCX0KCgkJCQlpZiAoYkZpbmQpIHsKCQkJCQlfdGhpcyA9IGF3YWl0IF90aGlzLmZpbmQoKTsKCQkJCX0gZWxzZSBfdGhpcyA9IG51bGw7CgkJCQlpZiAoX3RoaXMpIHsKCQkJCQl0aGlzLklkID0gX3RoaXMuSWQ7CgkJCQkJdGhpcy5sb2codW5kZWZpbmVkLCAnc3RvcmUnLCAnRW50aXR5T2JqZWN0JywgMCwgIl90aGlzLklkIiwgX3RoaXMuSWQsIHRoaXMuSWQsIF90aGlzLlRvb2wubmFtZSwgdGhpcy5Ub29sLm5hbWUpOwoJCQkJCWJVcGRhdGUgPSB0cnVlOwoJCQkJfSBlbHNlIHsKCQkJCQl0aGlzLklkID0gdGhpcy5JZDsgLy8gdG8gZW5mb3JjZSB0aGUgSWQgYW5kIG5vdCBnZXQgYSBuZXcgb25lIGV2ZXJ5IHRpbWUKCQkJCQliSW5zZXJ0ID0gdHJ1ZTsKCQkJCX0KCQkJfSBlbHNlIGlmIChNYXRoLmFicygodGhpcy5TZXRfT24uZ2V0VGltZSgpIC0gdGhpcy5fX3N5bmNfb24oKS5nZXRUaW1lKCkpIC8gMTAwMCkgPCB0aGlzLl9fY29uZmlnKCdzdG9yZS5zZW5zaXRpdml0eScsIDUpKSB7CgkJCQl0aGlzLmxvZyh1bmRlZmluZWQsICdzdG9yZScsICdFbnRpdHlPYmplY3QnLCAwLCAiQWxyZWFkeSBzdG9yZWQiLCBNYXRoLmFicygodGhpcy5TZXRfT24uZ2V0VGltZSgpIC0gdGhpcy5fX3N5bmNfb24oKS5nZXRUaW1lKCkpIC8gMTAwMCkgKyAiPCIgKyB0aGlzLl9fY29uZmlnKCdzdG9yZS5zZW5zaXRpdml0eScsIDUpKTsKCQkJfSBlbHNlIHsKCQkJCS8vdGhpcy5sb2codW5kZWZpbmVkLCAnc3RvcmUnLCAnRW50aXR5T2JqZWN0JywgMCwgIkdvaW5nIHRvIHVwZGF0ZSBbIiArIHRoaXMuSWQgKyAiXSIpOwoJCQkJYlVwZGF0ZSA9IHRydWU7CgkJCX0KCgkJCWlmICghYlVwZGF0ZSAmJiAhYkluc2VydCkgewoJCQkJdGhpcy5sb2codW5kZWZpbmVkLCAnc3RvcmUnLCAnRW50aXR5T2JqZWN0JywgMCwgIk5vIGRhdGEgY2hhbmdlcyIpOwoJCQl9IGVsc2UgewoKCQkJCWlmICh0aGlzLlRvb2wudHlwZS5uYW1lID09ICJTcWxEQiIpIHsKCgkJCQkJaWYgKHR5cGVvZihsb3R0by5fX3NxbFRyYW5zYWN0aW9uKSA9PT0gInVuZGVmaW5lZCIgfHwgbG90dG8uX19zcWxUcmFuc2FjdGlvbi5lbmQpIHsKCQkJCQkJYXdhaXQgdGhpcy5fc3FsKGAke3RoaXMuX19jb25maWcoJ3R5cGUnKT09J3NxbGl0ZSc/J0JFR0lOJzonU1RBUlQnfSBUUkFOU0FDVElPTmApOwoJCQkJCQlsb3R0by5fX3NxbFRyYW5zYWN0aW9uID0gewoJCQkJCQkJT3duZXI6IHRoaXMsCgkJCQkJCQlzcWxzOiBbXSwKCQkJCQkJCXN0YXJ0OiBuZXcgRGF0ZSgpLAoJCQkJCQkJZW5kOiBudWxsCgkJCQkJCX07CgkJCQkJfQoKCQkJCX0KCgkJCQlpZiAoIXRoaXMuX2FjdGl2ZV9zZXQpIHsKCQkJCQl0aGlzLmFjdGl2ZSgKCQkJCQkJKChvU2NvcGUpID0+IHsKCQkJCQkJCWxldCByZXQgPSB0cnVlOwoJCQkJCQkJaWYgKHR5cGVvZihyZXQpID09PSAiZnVuY3Rpb24iKSB7CgkJCQkJCQkJcmV0ID0gcmV0KG9TY29wZSk7CgkJCQkJCQl9CgkJCQkJCQlyZXR1cm4gcmV0OwoJCQkJCQl9KShsb3R0bykKCQkJCQkpOwoJCQkJfQoKCQkJCWlmICghdGhpcy5fZW5hYmxlZF9zZXQpIHsKCQkJCQl0aGlzLmVuYWJsZWQoCgkJCQkJCSgob1Njb3BlKSA9PiB7CgkJCQkJCQlsZXQgcmV0ID0gdHJ1ZTsKCQkJCQkJCWlmICh0eXBlb2YocmV0KSA9PT0gImZ1bmN0aW9uIikgewoJCQkJCQkJCXJldCA9IHJldChvU2NvcGUpOwoJCQkJCQkJfQoJCQkJCQkJcmV0dXJuIHJldDsKCQkJCQkJfSkobG90dG8pCgkJCQkJKTsKCQkJCX0KCgkJCQlpZiAoIXRoaXMuX2RhdGVfc2V0KSB7CgkJCQkJdGhpcy5kYXRlKAoJCQkJCQkoKG9TY29wZSkgPT4gewoJCQkJCQkJbGV0IHJldCA9IG5ldyBEYXRlKCk7CgkJCQkJCQlpZiAodHlwZW9mKHJldCkgPT09ICJmdW5jdGlvbiIpIHsKCQkJCQkJCQlyZXQgPSByZXQob1Njb3BlKTsKCQkJCQkJCX0KCQkJCQkJCXJldHVybiByZXQ7CgkJCQkJCX0pKGxvdHRvKQoJCQkJCSk7CgkJCQl9CgoJCQkJaWYgKHRoaXMuX19jb25maWcoIlN5bmNFbnRpdHlBdHRyaWJ1dGVzIikpIHsKCgkJCQl9CgoJCQkJaWYgKCF0aGlzLl9fYXNzZXJ0VmFsaWQodHJ1ZSkpIHJldHVybiBudWxsOwoKCQkJCS8vYXdhaXQgdGhpcy5fc3RvcmVFbnRpdHlDbGFzcygpOyAvLyBpbiBjYXNlIFRvb2wgY2hhbmdlcwoKCQkJCXRoaXMubG9nKHVuZGVmaW5lZCwgJ3N0b3JlJywgJ0VudGl0eU9iamVjdCcsIDAsIGBBYm91dCB0byBJbnNlcnQ6JHtiSW5zZXJ0fSwgVXBkYXRlOiR7YlVwZGF0ZX0sIElkOlske3RoaXMuSWR9XWApOwoJCQkJaWYgKGJVcGRhdGUpIGF3YWl0IHRoaXMudXBkYXRlKCk7CgkJCQlpZiAoYkluc2VydCkgYXdhaXQgdGhpcy5pbnNlcnQoKTsKCgkJCQlpZiAodGhpcy5fX2NvbmZpZygiU3luY1R5cGVkQXR0cmlidXRlcyIpKSB7CgoJCQkJfQoKCQkJCWlmIChiVXBkYXRlIHx8IGJJbnNlcnQpIHsKCgkJCQkJaWYgKHRoaXMuVG9vbC50eXBlLm5hbWUgPT0gIlNxbERCIikgewoKCQkJCQkJaWYgKGxvdHRvLl9fc3FsVHJhbnNhY3Rpb24gJiYgIWxvdHRvLl9fc3FsVHJhbnNhY3Rpb24uZW5kICYmIGxvdHRvLl9fc3FsVHJhbnNhY3Rpb24uT3duZXIgPT0gdGhpcykgewoJCQkJCQkJYXdhaXQgdGhpcy5fc3FsKGBDT01NSVQke3RoaXMuX19jb25maWcoJ3R5cGUnKT09J3NxbGl0ZSc/JyBUUkFOU0FDVElPTic6Jyd9YCk7CgkJCQkJCQlsb3R0by5fX3NxbFRyYW5zYWN0aW9uLmVuZCA9IG5ldyBEYXRlKCk7CgkJCQkJCX0KCgkJCQkJfQoKCQkJCX0KCQkJfQoKCQkJZGVsZXRlIGxvdHRvLl91blJlY3Vyc2U7CgkJCXJldHVybiB0aGlzOwoJCX0sIHsKCQkJX19iZWZvcmVSdWxlczogW10sCgkJCV9fYWZ0ZXJSdWxlczogW10KCQl9KTsKCgkJcmV0dXJuIChyZXN1bHRzLmZpbmQociA9PiByLnJldCkgfHwgewoJCQlyZXQ6IG51bGwKCQl9KS5yZXQ7IC8vIGZpcnN0IG9uZSB0byBleGVjdXRlIGNvcnJlY3RseQoJfQoKCWFzeW5jIGluc2VydCgpIHsKCQlsZXQgcmVzdWx0cyA9IGF3YWl0IHRoaXMuX2V4ZWN1dGUobG90dG8sICJpbnNlcnQiLCBhc3luYyAobG9nLCB3YXJuLCBlcnJvciwgb1Njb3BlLCBtZXRob2QgPSAiaW5zZXJ0IiwgX25vZGUpID0+IHsKCQkJcmV0dXJuIF9ub2RlLl9zYW1lTm9kZShvU2NvcGUuX25vZGUuX3BhcmVudCkKCQl9LCBhc3luYyAobG9nLCB3YXJuLCBlcnJvciwgb1Njb3BlLCBtZXRob2QgPSAiaW5zZXJ0IikgPT4gewoJCQkvKioqIFNUQVJUIExPQ0FMIGluc2VydCgpICoqKi8KCQkJLy90aGlzLl9fdGltZSgnbG90dG8uVXNlci5pbnNlcnQnKTsKCgkJCWlmICh0aGlzLlRvb2wudHlwZS5uYW1lID09ICJTcWxEQiIpIHsKCgkJCQlsZXQgcmV0ID0gYXdhaXQgdGhpcy5fc3FsKHRoaXMuX3RvSW5zZXJ0U1FMKCkpOwoJCQkJdGhpcy5sb2codW5kZWZpbmVkLCAnaW5zZXJ0JywgJ0VudGl0eU9iamVjdCcsIDAsICJyZXN1bHQiLCByZXQpOwoKCQkJfQoKCQkJdGhpcy5fX3N5bmNfb24obmV3IERhdGUoKSk7CgoJCQlyZXR1cm4gdGhpczsKCQl9LCB7CgkJCV9fYmVmb3JlUnVsZXM6IFtdLAoJCQlfX2FmdGVyUnVsZXM6IFtdCgkJfSk7CgoJCXJldHVybiAocmVzdWx0cy5maW5kKHIgPT4gci5yZXQpIHx8IHsKCQkJcmV0OiBudWxsCgkJfSkucmV0OyAvLyBmaXJzdCBvbmUgdG8gZXhlY3V0ZSBjb3JyZWN0bHkKCX0KCglhc3luYyB1cGRhdGUoKSB7CgkJbGV0IHJlc3VsdHMgPSBhd2FpdCB0aGlzLl9leGVjdXRlKGxvdHRvLCAidXBkYXRlIiwgYXN5bmMgKGxvZywgd2FybiwgZXJyb3IsIG9TY29wZSwgbWV0aG9kID0gInVwZGF0ZSIsIF9ub2RlKSA9PiB7CgkJCXJldHVybiBfbm9kZS5fc2FtZU5vZGUob1Njb3BlLl9ub2RlLl9wYXJlbnQpCgkJfSwgYXN5bmMgKGxvZywgd2FybiwgZXJyb3IsIG9TY29wZSwgbWV0aG9kID0gInVwZGF0ZSIpID0+IHsKCQkJLyoqKiBTVEFSVCBMT0NBTCB1cGRhdGUoKSAqKiovCgkJCS8vdGhpcy5fX3RpbWUoJ2xvdHRvLlVzZXIudXBkYXRlJyk7CgoJCQlsZXQgcmV0ID0gbnVsbDsKCgkJCWlmICh0aGlzLlRvb2wudHlwZS5uYW1lID09ICJTcWxEQiIpIHsKCgkJCQlhd2FpdCB0aGlzLl9zcWwodGhpcy5fdG9VcGRhdGVTUUwoKSk7CgkJCQlyZXQgPSBhd2FpdCB0aGlzLl9zcWwodGhpcy5fdG9TZWxlY3RTUUwoKSk7CgkJCQlpZiAoQXJyYXkuaXNBcnJheShyZXQpKSByZXQgPSByZXRbMF07CgoJCQl9CgoJCQl0aGlzLmxvZyh1bmRlZmluZWQsICd1cGRhdGUnLCAnRW50aXR5T2JqZWN0JywgMCwgInJlc3VsdCIsIHJldCk7CgkJCXRoaXMuX19zeW5jX29uKG5ldyBEYXRlKCkpOwoJCQl0aGlzLl9mcm9tRG9jdW1lbnQocmV0LCB0cnVlKTsKCgkJCXJldHVybiByZXQ7CgoJCQkvKioqIEVORCBMT0NBTCB1cGRhdGUoKSAqKiovCgkJfSwgewoJCQlfX2JlZm9yZVJ1bGVzOiBbXSwKCQkJX19hZnRlclJ1bGVzOiBbXQoJCX0pOwoKCQlyZXR1cm4gKHJlc3VsdHMuZmluZChyID0+IHIucmV0KSB8fCB7CgkJCXJldDogbnVsbAoJCX0pLnJldDsgLy8gZmlyc3Qgb25lIHRvIGV4ZWN1dGUgY29ycmVjdGx5Cgl9CgoJYXN5bmMgZmluZEFsbChkZXB0aCA9IDEsIG9ianMsIHN0YXJ0LCBlbmQsIGZpZWxkcykgewoJCWxldCByZXN1bHRzID0gYXdhaXQgdGhpcy5fZXhlY3V0ZShsb3R0bywgImZpbmRBbGwiLCBhc3luYyAobG9nLCB3YXJuLCBlcnJvciwgb1Njb3BlLCBtZXRob2QgPSAiZmluZEFsbCIsIF9ub2RlLCBkZXB0aCwgb2Jqcywgc3RhcnQsIGVuZCwgZmllbGRzKSA9PiB7CgkJCXJldHVybiBfbm9kZS5fc2FtZU5vZGUob1Njb3BlLl9ub2RlLl9wYXJlbnQpCgkJfSwgYXN5bmMgKGxvZywgd2FybiwgZXJyb3IsIG9TY29wZSwgbWV0aG9kID0gImZpbmRBbGwiLCBkZXB0aCwgb2Jqcywgc3RhcnQsIGVuZCwgZmllbGRzKSA9PiB7CgkJCS8qKiogU1RBUlQgTE9DQUwgZmluZEFsbCgpICoqKi8KCQkJLy90aGlzLl9fdGltZSgnbG90dG8uVXNlci5maW5kQWxsJyk7CgoJCQkvLyBhdm9pZHMgY3ljbGljIHF1ZXJpZXMKCQkJb2JqcyA9IChvYmpzIHx8IFtdKS5tYXAobyA9PiBvLl9jbG9uZSgpKTsKCgkJCWF3YWl0IHRoaXMuX3N0b3JlRW50aXR5Q2xhc3MoKTsgLy8/PwoKCQkJbGV0IHJldCA9IFtdOyAvLyBhIGpzb24gYXJyYXkKCgkJCWlmICh0aGlzLlRvb2wudHlwZS5uYW1lID09ICJTcWxEQiIpIHsKCgkJCQlyZXQgPSBhd2FpdCB0aGlzLl9zcWwodGhpcy5fdG9TZWxlY3RTUUwoZmllbGRzLCBvYmpzKSk7CgoJCQl9CgoJCQl0aGlzLmxvZyh1bmRlZmluZWQsICdmaW5kQWxsJywgJ0VudGl0eU9iamVjdCcsIDAsICJCZWZvcmUgX2Zyb21Eb2N1bWVudCgpIiwgcmV0KTsKCgkJCXJldCA9IHJldC5maWx0ZXIociA9PiByKS5tYXAociA9PiBuZXcgbG90dG8uVXNlcihudWxsLCB0aGlzLlRvb2wpLl9mcm9tRG9jdW1lbnQociwgdHJ1ZSwgdHJ1ZSkuX19zeW5jX29uKG5ldyBEYXRlKCkpKTsKCgkJCWF3YWl0IHRoaXMuX2ZpbmRSZWZlcmVuY2VzKHJldCwgb2JqcywgZGVwdGgpOwoJCQl0aGlzLmxvZyh1bmRlZmluZWQsICdmaW5kQWxsJywgJ0VudGl0eU9iamVjdCcsIDAsICJPdXRwdXQiLCByZXQpOwoKCQkJZGVsZXRlIGxvdHRvLl91blJlY3Vyc2U7CgoJCQlyZXR1cm4gcmV0OwoJCQkvKioqIEVORCBMT0NBTCBmaW5kQWxsKCkgKioqLwoJCX0sIHsKCQkJZGVwdGgsCgkJCW9ianMsCgkJCXN0YXJ0LAoJCQllbmQsCgkJCWZpZWxkcywKCQkJX19iZWZvcmVSdWxlczogW10sCgkJCV9fYWZ0ZXJSdWxlczogW10KCQl9KTsKCgkJcmV0dXJuIChyZXN1bHRzLmZpbmQociA9PiByLnJldCkgfHwgewoJCQlyZXQ6IFtdCgkJfSkucmV0IHx8IFtdOyAvLyBmaXJzdCBvbmUgdG8gZXhlY3V0ZSBjb3JyZWN0bHkKCX0KCglhc3luYyBfZmluZFJlZmVyZW5jZXMocmV0LCBvYmpzLCBkZXB0aCkgewoKCQl0cnkgewoJCQlpZiAoZGVwdGggPiAxKSB7CgkJCQlmb3IgYXdhaXQgKGNvbnN0IHIgb2YgcmV0KSB7CgoJCQkJfQoJCQl9CgoJCQlsZXQgcmVmcyA9IFtdOwoJCQlpZiAoIUFycmF5LmlzQXJyYXkocmV0KSkgcmV0ID0gW3JldF07CgoJCQlyZWZzLnB1c2goLi4ucmV0LmZpbHRlcihyID0+IHIuRW50aXR5Q2xhc3MpKTsKCQkJZm9yIGF3YWl0IChjb25zdCBvIG9mIChvYmpzIHx8IFtdKSkgewoJCQkJbGV0IG9mYSA9IFtdOwoJCQkJaWYgKG8uX3RvRU1TT2JqZWN0KSB7CgkJCQkJb2ZhID0gYXdhaXQgdGhpcy5fZnJvbUVNU1ZhbHVlcyhhd2FpdCBvLl90b0VNU09iamVjdCh0cnVlLCB0cnVlKS5maW5kQWxsKGRlcHRoKSk7CgkJCQl9IGVsc2UgewoJCQkJCW9mYSA9IGF3YWl0IG8uZmluZEFsbChkZXB0aCk7CgkJCQl9CgkJCQlyZWZzLnB1c2goLi4ub2ZhKTsKCQkJfQoJCQlyZWZzID0gcmVmcy5maWx0ZXIociA9PiByKTsKCQkJcmVmcy5mb3JFYWNoKHIgPT4gewoJCQkJZm9yICh2YXIgcCBpbiByKSB7CgkJCQkJaWYgKHAuc3RhcnRzV2l0aCgnXycpICYmIHJbcF0gJiYgcltwICsgIl9zZXQiXSAmJiByW3BdLklkICYmIHJlZnMuZmluZChvID0+IG8uSWQgPT0gcltwXS5JZCkpIHsKCQkJCQkJcltwLnN1YnN0cmluZygxKV0ocmVmcy5maW5kKG8gPT4gby5JZCA9PSByW3BdLklkKSk7CgkJCQkJfQoJCQkJfQoJCQl9KTsKCgkJCXJldHVybiByZXQ7CgkJfSBjYXRjaCAoZXgpIHsKCQkJdGhpcy5sb2codW5kZWZpbmVkLCAnX2ZpbmRSZWZlcmVuY2VzJywgJ0VudGl0eU9iamVjdCcsIDIsIGV4KTsKCQl9CgoJfQoKfTsKCiAgICBsb3R0by5Db250ZW50ID0gY2xhc3MgQ29udGVudCBleHRlbmRzIGxvdHRvLkdlbmVyaWNTZXJ2aWNlQVBJIHsKCWNvbnN0cnVjdG9yKGlkLCB0b29sKSB7CgkJc3VwZXIoaWQsIHRvb2wpOwoKCQl0aGlzLlNjb3BlID0gImxvdHRvIjsKCQl0aGlzLkRlYnVnID0gSlNPTi5wYXJzZSgoKHR5cGVvZih0aGlzKSAhPT0gInVuZGVmaW5lZCIgJiYgdHlwZW9mKHRoaXMuX2F0b2IpICE9PSAidW5kZWZpbmVkIikgPyB0aGlzLl9hdG9iIDogKHR5cGVvZihfRnJFTUQpICE9PSAidW5kZWZpbmVkIiA/IF9GckVNRC5fYXRvYiA6IGF0b2IpKShgZXlKamNtbDBhV05oYkNJNklpb2lMQ0psY25KdmNpSTZJaW9pTENKM1lYSnVJam9pS2lJc0ltbHVabThpT2lJcUxtbHVhWFFzS2k1ZmNtVnpkQ3dxTGw5c2IyRmtWRzl2YkhNc0tpNWZjMlZ5ZG1WeUxDcGZabWxzWlhONWMzUmxiU3dxTGw5bmFYUm9kV0lzS2k1ZmFXNTJiMnRsSW4wPWApLCAoa2V5LCB2YWx1ZSkgPT4gewoJCQlpZiAodHlwZW9mKHZhbHVlKSA9PT0gInN0cmluZyIgJiYgdmFsdWUuaW5kZXhPZigiPT4iKSA+IDApIHJldHVybiBldmFsKCIoIiArIHZhbHVlICsgIikiKTsKCQkJcmV0dXJuIHZhbHVlOwoJCX0pOwoJCXRoaXMuQ29uZmlnID0gSlNPTi5wYXJzZSgoKHR5cGVvZih0aGlzKSAhPT0gInVuZGVmaW5lZCIgJiYgdHlwZW9mKHRoaXMuX2F0b2IpICE9PSAidW5kZWZpbmVkIikgPyB0aGlzLl9hdG9iIDogKHR5cGVvZihfRnJFTUQpICE9PSAidW5kZWZpbmVkIiA/IF9GckVNRC5fYXRvYiA6IGF0b2IpKShgZXlKelpXTnlaWFFpT2lKdlUwdDNaMW95YzB0R1QxUkpTbU5pUVdaVlNWRTBRMm81Y1hOSU5EaHViQ0lzSW5Cc1lYbG5jbTkxYm1RaU9uUnlkV1VzSW1kU1VFTWlPblJ5ZFdVc0luTjBiM0psTG5ObGJuTnBkR2wyYVhSNUlqb3dmUT09YCksIChrZXksIHZhbHVlKSA9PiB7CgkJCWlmICh0eXBlb2YodmFsdWUpID09PSAic3RyaW5nIiAmJiB2YWx1ZS5pbmRleE9mKCI9PiIpID4gMCkgcmV0dXJuIGV2YWwoIigiICsgdmFsdWUgKyAiKSIpOwoJCQlyZXR1cm4gdmFsdWU7CgkJfSk7CgkJdGhpcy5UZXN0ID0gSlNPTi5wYXJzZSgoKHR5cGVvZih0aGlzKSAhPT0gInVuZGVmaW5lZCIgJiYgdHlwZW9mKHRoaXMuX2F0b2IpICE9PSAidW5kZWZpbmVkIikgPyB0aGlzLl9hdG9iIDogKHR5cGVvZihfRnJFTUQpICE9PSAidW5kZWZpbmVkIiA/IF9GckVNRC5fYXRvYiA6IGF0b2IpKShgZXlKVmMyVnlJanA3SWw5aGRYUm9iM0pwZW1VdWRYTmxjbTVoYldVaU9pSm1ZV1JwSWl3aVgyRjFkR2h2Y21sNlpTNXdZWE56ZDI5eVpDSTZJakV5TXlJc0lsOWhkWFJvYjNKcGVtVXVkR1Z6ZEZWelpYSWlPbnNpWVdOMGFYWmxJanAwY25WbExDSmxibUZpYkdWa0lqcDBjblZsTENKblpXNWtaWElpT25zaVkyOWtaU0k2SWswaUxDSnVZVzFsSWpvaVRXRnNaU0o5TENKamIyUmxJam9pWm1Ga2FTSXNJbTVoYldVaU9pSkdZV1JwSW4xOWZRPT1gKSwgKGtleSwgdmFsdWUpID0+IHsKCQkJaWYgKHR5cGVvZih2YWx1ZSkgPT09ICJzdHJpbmciICYmIHZhbHVlLmluZGV4T2YoIj0+IikgPiAwKSByZXR1cm4gZXZhbCgiKCIgKyB2YWx1ZSArICIpIik7CgkJCXJldHVybiB2YWx1ZTsKCQl9KTsKCQl0aGlzLlRvb2xzID0gSlNPTi5wYXJzZSgoKHR5cGVvZih0aGlzKSAhPT0gInVuZGVmaW5lZCIgJiYgdHlwZW9mKHRoaXMuX2F0b2IpICE9PSAidW5kZWZpbmVkIikgPyB0aGlzLl9hdG9iIDogKHR5cGVvZihfRnJFTUQpICE9PSAidW5kZWZpbmVkIiA/IF9GckVNRC5fYXRvYiA6IGF0b2IpKShgV3lKR2FXeGxVM2x6ZEdWdElpd2lSMmwwU0hWaUlsMD1gKSwgKGtleSwgdmFsdWUpID0+IHsKCQkJaWYgKHR5cGVvZih2YWx1ZSkgPT09ICJzdHJpbmciICYmIHZhbHVlLmluZGV4T2YoIj0+IikgPiAwKSByZXR1cm4gZXZhbCgiKCIgKyB2YWx1ZSArICIpIik7CgkJCXJldHVybiB2YWx1ZTsKCQl9KTsKCQl0aGlzLk1hcHBpbmdzID0gSlNPTi5wYXJzZSgoKHR5cGVvZih0aGlzKSAhPT0gInVuZGVmaW5lZCIgJiYgdHlwZW9mKHRoaXMuX2F0b2IpICE9PSAidW5kZWZpbmVkIikgPyB0aGlzLl9hdG9iIDogKHR5cGVvZihfRnJFTUQpICE9PSAidW5kZWZpbmVkIiA/IF9GckVNRC5fYXRvYiA6IGF0b2IpKShgVzEwPWApLCAoa2V5LCB2YWx1ZSkgPT4gewoJCQlpZiAodHlwZW9mKHZhbHVlKSA9PT0gInN0cmluZyIgJiYgdmFsdWUuaW5kZXhPZigiPT4iKSA+IDApIHJldHVybiBldmFsKCIoIiArIHZhbHVlICsgIikiKTsKCQkJcmV0dXJuIHZhbHVlOwoJCX0pOwoKCQkvLyBhdm9pZCBzdXBlciwga2VlcCB0aGlzIGhlcmUKCQl0aGlzLl9fSUQgPSB0aGlzLl9fSUQgfHwge307CgkJdGhpcy5Ub29sID0gdG9vbDsKCQl0aGlzLklkID0gaWQ7CgoJCXRoaXMuVmFsdWVFbnRpdGllcyA9IFtdOwoKCQl0aGlzLkRhdGUgPSBudWxsOwoKCQl0aGlzLmNsZWFyX1RISVMoKTsKCQl0aGlzLkVudGl0eVZhbHVlcyA9IFtdOwoKCQl0aGlzLkVudGl0eVZhbHVlcy5wdXNoKHsKCQkJRW50aXR5QXR0cmlidXRlOiB7CgoJCQkJTmFtZTogImFjdGl2ZSIsCgkJCQlPUEVSQVRPUlM6IHsKCQkJCQlOYW1lOiAiPSIKCQkJCX0sCgkJCQlFbnRpdHlDbGFzczogdGhpcy5FbnRpdHlDbGFzcywKCQkJfSwKCQkJT1BFUkFUT1JTOiB7fQoJCX0pOwoJCXRoaXMuY2xlYXJfYWN0aXZlKCk7CgoJCXRoaXMuRW50aXR5VmFsdWVzLnB1c2goewoJCQlFbnRpdHlBdHRyaWJ1dGU6IHsKCgkJCQlOYW1lOiAiZW5hYmxlZCIsCgkJCQlPUEVSQVRPUlM6IHsKCQkJCQlOYW1lOiAiPSIKCQkJCX0sCgkJCQlFbnRpdHlDbGFzczogdGhpcy5FbnRpdHlDbGFzcywKCQkJfSwKCQkJT1BFUkFUT1JTOiB7fQoJCX0pOwoJCXRoaXMuY2xlYXJfZW5hYmxlZCgpOwoKCQl0aGlzLkVudGl0eVZhbHVlcy5wdXNoKHsKCQkJRW50aXR5QXR0cmlidXRlOiB7CgoJCQkJTmFtZTogImNvZGUiLAoJCQkJT1BFUkFUT1JTOiB7CgkJCQkJTmFtZTogIj0iCgkJCQl9LAoJCQkJRW50aXR5Q2xhc3M6IHRoaXMuRW50aXR5Q2xhc3MsCgkJCX0sCgkJCU9QRVJBVE9SUzoge30KCQl9KTsKCQl0aGlzLmNsZWFyX2NvZGUoKTsKCgkJdGhpcy5FbnRpdHlWYWx1ZXMucHVzaCh7CgkJCUVudGl0eUF0dHJpYnV0ZTogewoKCQkJCU5hbWU6ICJvcmRlciIsCgkJCQlPUEVSQVRPUlM6IHsKCQkJCQlOYW1lOiAiPSIKCQkJCX0sCgkJCQlFbnRpdHlDbGFzczogdGhpcy5FbnRpdHlDbGFzcywKCQkJfSwKCQkJT1BFUkFUT1JTOiB7fQoJCX0pOwoJCXRoaXMuY2xlYXJfb3JkZXIoKTsKCgkJdGhpcy5FbnRpdHlWYWx1ZXMucHVzaCh7CgkJCUVudGl0eUF0dHJpYnV0ZTogewoKCQkJCU5hbWU6ICJkYXRlIiwKCQkJCU9QRVJBVE9SUzogewoJCQkJCU5hbWU6ICI9IgoJCQkJfSwKCQkJCUVudGl0eUNsYXNzOiB0aGlzLkVudGl0eUNsYXNzLAoJCQl9LAoJCQlPUEVSQVRPUlM6IHt9CgkJfSk7CgkJdGhpcy5jbGVhcl9kYXRlKCk7CgoJCXRoaXMuRW50aXR5VmFsdWVzLnB1c2goewoJCQlFbnRpdHlBdHRyaWJ1dGU6IHsKCgkJCQlOYW1lOiAibmFtZSIsCgkJCQlPUEVSQVRPUlM6IHsKCQkJCQlOYW1lOiAiPSIKCQkJCX0sCgkJCQlFbnRpdHlDbGFzczogdGhpcy5FbnRpdHlDbGFzcywKCQkJfSwKCQkJT1BFUkFUT1JTOiB7fQoJCX0pOwoJCXRoaXMuY2xlYXJfbmFtZSgpOwoKCQl0aGlzLkVudGl0eVZhbHVlcy5wdXNoKHsKCQkJRW50aXR5QXR0cmlidXRlOiB7CgoJCQkJTmFtZTogInJlbWFyayIsCgkJCQlPUEVSQVRPUlM6IHsKCQkJCQlOYW1lOiAiPSIKCQkJCX0sCgkJCQlFbnRpdHlDbGFzczogdGhpcy5FbnRpdHlDbGFzcywKCQkJfSwKCQkJT1BFUkFUT1JTOiB7fQoJCX0pOwoJCXRoaXMuY2xlYXJfcmVtYXJrKCk7CgoJCXRoaXMuRW50aXR5VmFsdWVzLnB1c2goewoJCQlFbnRpdHlBdHRyaWJ1dGU6IHsKCgkJCQlOYW1lOiAiY29udGVudCIsCgkJCQlPUEVSQVRPUlM6IHsKCQkJCQlOYW1lOiAiPSIKCQkJCX0sCgkJCQlFbnRpdHlDbGFzczogdGhpcy5FbnRpdHlDbGFzcywKCQkJfSwKCQkJT1BFUkFUT1JTOiB7fQoJCX0pOwoJCXRoaXMuY2xlYXJfY29udGVudCgpOwoKCX0KCglnZXQgRW50aXR5Q2xhc3MoKSB7CgkJbGV0IGVjID0gewoKCQkJTmFtZTogIkNvbnRlbnQiLAoJCQlPUEVSQVRPUlM6IHsKCQkJCU5hbWU6ICI9IgoJCQl9LAoJCX07CgoJCS8vIHRoYXQncyB3aHkgd2UgbmVlZCBpdCBhcyBhIGdldHRlcgoJCWlmICghTnVtYmVyKGVjLklkKSAmJiBsb3R0by5FbnRpdHlDbGFzc2VzKSB7CgkJCWxldCBjaWQgPSBsb3R0by5FbnRpdHlDbGFzc2VzLmZpbmQoYyA9PiBOdW1iZXIoYy5JZCkgJiYgYy5OYW1lID09IGVjLk5hbWUpOwoJCQlpZiAoY2lkKSBlYy5JZCA9IGNpZC5JZDsKCQl9CgkJcmV0dXJuIGVjOwoJfQoKCWdldCBJZCgpIHsKCQlyZXR1cm4gdGhpcy5fX0lEW3RoaXMuVG9vbC5uYW1lXSB8fCB0aGlzLl91dWlkKCk7Cgl9CgoJc2V0IElkKGlkKSB7CgkJaWYgKCF0aGlzLlRvb2wpIHsKCQkJdGhpcy5sb2codW5kZWZpbmVkLCAnc2V0IElkJywgJ0VudGl0eU9iamVjdCcsIDAsICJFbXB0eSBUb29sIiwgdGhpcy5Ub29scy5sZW5ndGgsIGxvdHRvLlRvb2xzLmxlbmd0aCk7CgkJCXJldHVybjsKCQl9CgkJdGhpcy5fX0lEW3RoaXMuVG9vbC5uYW1lXSA9IGlkOwoJfQoKCWdldCBUb29sKCkgewoJCWlmICh0eXBlb2YodGhpcy5fX1Rvb2wpICE9PSAndW5kZWZpbmVkJykgcmV0dXJuIHRoaXMuX19Ub29sOwoJCWxldCBub1Rvb2wgPSB7CgkJCW5hbWU6ICcnLAoJCQl0eXBlOiB7CgkJCQluYW1lOiAnJwoJCQl9LAoJCX07CgkJaWYgKHR5cGVvZihsb3R0by5Ub29scykgIT09ICJ1bmRlZmluZWQiICYmICFBcnJheS5pc0FycmF5KGxvdHRvLlRvb2xzKSkgewoJCQl0aGlzLmxvZyh1bmRlZmluZWQsICdnZXQgVG9vbCcsICdFbnRpdHlPYmplY3QnLCAyLCAibG90dG8uVG9vbHMgaXMgbm90IGFuIGFycmF5OiAiLCBsb3R0by5Ub29scyk7CgkJCXJldHVybiBub1Rvb2w7CgkJfQoJCWxldCByZXQgPSB0aGlzLlRvb2xzLmZpbmQodCA9PiAobG90dG8uVG9vbHMgfHwgW10pLmZpbmQoX3QgPT4gdCA9PSBfdC5uYW1lIHx8IHQubmFtZSA9PSBfdC5uYW1lKSk7CgkJaWYgKHR5cGVvZihyZXQpICE9PSAndW5kZWZpbmVkJykgcmV0ID0gKGxvdHRvLlRvb2xzIHx8IFtdKS5maW5kKHQgPT4gdC5uYW1lID09IHJldCB8fCB0Lm5hbWUgPT0gcmV0Lm5hbWUpOwoJCWlmICh0eXBlb2YocmV0KSA9PT0gJ3VuZGVmaW5lZCcpIHJldHVybiBub1Rvb2w7CgkJcmV0dXJuIHJldDsKCX0KCglzZXQgVG9vbCh0b29sKSB7CgkJaWYgKHR5cGVvZih0b29sKSA9PT0gJ3VuZGVmaW5lZCcpIHJldHVybjsKCQlpZiAodHlwZW9mKHRvb2wpID09PSAic3RyaW5nIikgewoJCQl0b29sID0gewoJCQkJbmFtZTogdG9vbAoJCQl9OwoJCX0KCQlpZiAodG9vbC5FbnRpdHlDbGFzcykgewoJCQl0b29sID0gdG9vbC5fdG9Eb2N1bWVudCgpOwoJCX0KCQlpZiAodHlwZW9mKHRvb2wubmFtZSkgPT09ICd1bmRlZmluZWQnICYmIHR5cGVvZih0b29sLnR5cGUubmFtZSkgPT09ICd1bmRlZmluZWQnKSByZXR1cm47CgkJdG9vbC50eXBlID0gdG9vbC50eXBlIHx8IHsKCQkJbmFtZTogdG9vbC5uYW1lCgkJfTsKCgkJaWYgKCF0b29sLnR5cGUgJiYgIXRvb2wubmFtZSkgewoJCQl0aGlzLmxvZyh1bmRlZmluZWQsICdzZXQgVG9vbCcsICdFbnRpdHlPYmplY3QnLCAxLCAiRW1wdHkgVG9vbCBvYmplY3QiKTsKCQkJcmV0dXJuOwoJCX0KCgkJbGV0IHQgPSAobG90dG8uVG9vbHMgfHwgW10pLmZpbHRlcih0ID0+IHQubmFtZSAmJiB0LnR5cGUpLmZpbmQodCA9PiAodC5uYW1lID09IHRvb2wubmFtZSkgfHwgKHQudHlwZS5uYW1lID09IHRvb2wudHlwZS5uYW1lKSk7CgkJaWYgKCF0KSB7CgkJCXRoaXMubG9nKHVuZGVmaW5lZCwgJ3NldCBUb29sJywgJ0VudGl0eU9iamVjdCcsIDAsICJubyBtYXRjaGluZyB0b29sIiwgdG9vbCwgbG90dG8uVG9vbHMpOwoJCQlyZXR1cm47CgkJfQoKCQl0aGlzLl9fVG9vbCA9IHQ7CgoJCXJldHVybiB0aGlzOwoJfQoKCVRISVModiwgY28pIHsKCQlpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykgcmV0dXJuIHRoaXMuX1RISVM7CgkJaWYgKCF2KSByZXR1cm4gdGhpczsKCQl2ID0gQXJyYXkuaXNBcnJheSh2KSA/IHYgOiBbdl07CgkJdGhpcy5fVEhJUyA9IHYuZmlsdGVyKF92ID0+IHR5cGVvZihfdikgPT09ICdvYmplY3QnICYmIF92LkVudGl0eUNsYXNzICYmIF92LkVudGl0eUNsYXNzLk5hbWUgPT0gdGhpcy5FbnRpdHlDbGFzcy5OYW1lICYmIF92LlNjb3BlID09IHRoaXMuU2NvcGUpOwoJCWlmIChjbykgdGhpcy5fVEhJU19jb29wID0gY287CgkJcmV0dXJuIHRoaXM7Cgl9CgoJY2xlYXJfVEhJUygpIHsKCQl0aGlzLl9USElTID0gW107CgkJdGhpcy5fVEhJU19jb29wID0gJyc7CgkJcmV0dXJuIHRoaXM7Cgl9CgoJLyoqIHN0YXJ0OiBzZXR0ZXJzIGFuZCBnZXR0ZXJzIGZvciBhY3RpdmUgKiovCglhY3RpdmUodiwgY28sIGlkKSB7CgkJaWYgKGNvKSB0aGlzLl9hY3RpdmVfY29vcCA9IGNvOwoKCQl2YXIgZXYgPSB0aGlzLkVudGl0eVZhbHVlKCJhY3RpdmUiKTsKCQlpZiAoIWV2KSB7CgkJCXJldHVybiB0aGlzOwoJCX0KCgkJaWYgKGlkKSBldi5JZCA9IGlkOwoKCQlpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykgewoJCQkvLyB2YWx1ZXMgd2VyZSBnaXZlbiwgdGhlcmVmb3JlIGEgc2V0dGVyCgoJCQl2ID0gKF92ID0+IHsKCgkJCQlfdiA9IFsidHJ1ZSIsICIxIiwgInllcyIsIHRydWUsIDFdLmluY2x1ZGVzKF92KTsKCgkJCQlyZXR1cm4gX3Y7CgoJCQl9KSh2KTsKCgkJCWV2LkJvb2xWYWx1ZSA9IHY7CgoJCQlpZiAodHJ1ZSB8fCB0aGlzLl9hY3RpdmUgIT0gdikgewoJCQkJdGhpcy5fYWN0aXZlX3NldCA9IG5ldyBEYXRlKCk7IC8vIGEgY2hhbmdlIGluIHZhbHVlCgoJCQl9CgoJCQl0aGlzLl9hY3RpdmUgPSB2OwoJCQlpZiAoY28pIGV2Lk9QRVJBVE9SUy5Cb29sVmFsdWUgPSBjbzsKCgkJCXJldHVybiB0aGlzOwoJCX0gZWxzZSB7CgkJCXJldHVybiB0aGlzLmkxOG4oZXYsIHRoaXMuX2FjdGl2ZSk7CgkJfQoJfQoKCWNsZWFyX2FjdGl2ZSgpIHsKCQl0aGlzLl9hY3RpdmVfc2V0ID0gbnVsbDsKCQl0aGlzLl9hY3RpdmUgPSBudWxsOwoJCXRoaXMuX2FjdGl2ZV9jb29wID0gIiI7CgkJcmV0dXJuIHRoaXM7Cgl9CgoJLyoqIGVuZDogc2V0dGVycyBhbmQgZ2V0dGVycyBmb3IgYWN0aXZlICoqLwoKCS8qKiBzdGFydDogc2V0dGVycyBhbmQgZ2V0dGVycyBmb3IgZW5hYmxlZCAqKi8KCWVuYWJsZWQodiwgY28sIGlkKSB7CgkJaWYgKGNvKSB0aGlzLl9lbmFibGVkX2Nvb3AgPSBjbzsKCgkJdmFyIGV2ID0gdGhpcy5FbnRpdHlWYWx1ZSgiZW5hYmxlZCIpOwoJCWlmICghZXYpIHsKCQkJcmV0dXJuIHRoaXM7CgkJfQoKCQlpZiAoaWQpIGV2LklkID0gaWQ7CgoJCWlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7CgkJCS8vIHZhbHVlcyB3ZXJlIGdpdmVuLCB0aGVyZWZvcmUgYSBzZXR0ZXIKCgkJCXYgPSAoX3YgPT4gewoKCQkJCV92ID0gWyJ0cnVlIiwgIjEiLCAieWVzIiwgdHJ1ZSwgMV0uaW5jbHVkZXMoX3YpOwoKCQkJCXJldHVybiBfdjsKCgkJCX0pKHYpOwoKCQkJZXYuQm9vbFZhbHVlID0gdjsKCgkJCWlmICh0cnVlIHx8IHRoaXMuX2VuYWJsZWQgIT0gdikgewoJCQkJdGhpcy5fZW5hYmxlZF9zZXQgPSBuZXcgRGF0ZSgpOyAvLyBhIGNoYW5nZSBpbiB2YWx1ZQoKCQkJfQoKCQkJdGhpcy5fZW5hYmxlZCA9IHY7CgkJCWlmIChjbykgZXYuT1BFUkFUT1JTLkJvb2xWYWx1ZSA9IGNvOwoKCQkJcmV0dXJuIHRoaXM7CgkJfSBlbHNlIHsKCQkJcmV0dXJuIHRoaXMuaTE4bihldiwgdGhpcy5fZW5hYmxlZCk7CgkJfQoJfQoKCWNsZWFyX2VuYWJsZWQoKSB7CgkJdGhpcy5fZW5hYmxlZF9zZXQgPSBudWxsOwoJCXRoaXMuX2VuYWJsZWQgPSBudWxsOwoJCXRoaXMuX2VuYWJsZWRfY29vcCA9ICIiOwoJCXJldHVybiB0aGlzOwoJfQoKCS8qKiBlbmQ6IHNldHRlcnMgYW5kIGdldHRlcnMgZm9yIGVuYWJsZWQgKiovCgoJLyoqIHN0YXJ0OiBzZXR0ZXJzIGFuZCBnZXR0ZXJzIGZvciBjb2RlICoqLwoJY29kZSh2LCBjbywgaWQpIHsKCQlpZiAoY28pIHRoaXMuX2NvZGVfY29vcCA9IGNvOwoKCQl2YXIgZXYgPSB0aGlzLkVudGl0eVZhbHVlKCJjb2RlIik7CgkJaWYgKCFldikgewoJCQlyZXR1cm4gdGhpczsKCQl9CgoJCWlmIChpZCkgZXYuSWQgPSBpZDsKCgkJaWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHsKCQkJLy8gdmFsdWVzIHdlcmUgZ2l2ZW4sIHRoZXJlZm9yZSBhIHNldHRlcgoKCQkJdiA9IChfdiA9PiB7CgoJCQkJcmV0dXJuIF92OwoKCQkJfSkodik7CgoJCQlldi5TdHJpbmdWYWx1ZSA9IHY7CgoJCQlpZiAodHJ1ZSB8fCB0aGlzLl9jb2RlICE9IHYpIHsKCQkJCXRoaXMuX2NvZGVfc2V0ID0gbmV3IERhdGUoKTsgLy8gYSBjaGFuZ2UgaW4gdmFsdWUKCgkJCX0KCgkJCXRoaXMuX2NvZGUgPSB2OwoJCQlpZiAoY28pIGV2Lk9QRVJBVE9SUy5TdHJpbmdWYWx1ZSA9IGNvOwoKCQkJcmV0dXJuIHRoaXM7CgkJfSBlbHNlIHsKCQkJcmV0dXJuIHRoaXMuaTE4bihldiwgdGhpcy5fY29kZSk7CgkJfQoJfQoKCWNsZWFyX2NvZGUoKSB7CgkJdGhpcy5fY29kZV9zZXQgPSBudWxsOwoJCXRoaXMuX2NvZGUgPSBudWxsOwoJCXRoaXMuX2NvZGVfY29vcCA9ICIiOwoJCXJldHVybiB0aGlzOwoJfQoKCS8qKiBlbmQ6IHNldHRlcnMgYW5kIGdldHRlcnMgZm9yIGNvZGUgKiovCgoJLyoqIHN0YXJ0OiBzZXR0ZXJzIGFuZCBnZXR0ZXJzIGZvciBvcmRlciAqKi8KCW9yZGVyKHYsIGNvLCBpZCkgewoJCWlmIChjbykgdGhpcy5fb3JkZXJfY29vcCA9IGNvOwoKCQl2YXIgZXYgPSB0aGlzLkVudGl0eVZhbHVlKCJvcmRlciIpOwoJCWlmICghZXYpIHsKCQkJcmV0dXJuIHRoaXM7CgkJfQoKCQlpZiAoaWQpIGV2LklkID0gaWQ7CgoJCWlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7CgkJCS8vIHZhbHVlcyB3ZXJlIGdpdmVuLCB0aGVyZWZvcmUgYSBzZXR0ZXIKCgkJCXYgPSAoX3YgPT4gewoKCQkJCWlmIChpc05hTihfdikpIF92ID0gMDsKCgkJCQlyZXR1cm4gX3Y7CgoJCQl9KSh2KTsKCgkJCWV2LkludFZhbHVlID0gdjsKCgkJCWlmICh0cnVlIHx8IHRoaXMuX29yZGVyICE9IHYpIHsKCQkJCXRoaXMuX29yZGVyX3NldCA9IG5ldyBEYXRlKCk7IC8vIGEgY2hhbmdlIGluIHZhbHVlCgoJCQl9CgoJCQl0aGlzLl9vcmRlciA9IHY7CgkJCWlmIChjbykgZXYuT1BFUkFUT1JTLkludFZhbHVlID0gY287CgoJCQlyZXR1cm4gdGhpczsKCQl9IGVsc2UgewoJCQlyZXR1cm4gdGhpcy5pMThuKGV2LCB0aGlzLl9vcmRlcik7CgkJfQoJfQoKCWNsZWFyX29yZGVyKCkgewoJCXRoaXMuX29yZGVyX3NldCA9IG51bGw7CgkJdGhpcy5fb3JkZXIgPSBudWxsOwoJCXRoaXMuX29yZGVyX2Nvb3AgPSAiIjsKCQlyZXR1cm4gdGhpczsKCX0KCgkvKiogZW5kOiBzZXR0ZXJzIGFuZCBnZXR0ZXJzIGZvciBvcmRlciAqKi8KCgkvKiogc3RhcnQ6IHNldHRlcnMgYW5kIGdldHRlcnMgZm9yIGRhdGUgKiovCglkYXRlKHYsIGNvLCBpZCkgewoJCWlmIChjbykgdGhpcy5fZGF0ZV9jb29wID0gY287CgoJCXZhciBldiA9IHRoaXMuRW50aXR5VmFsdWUoImRhdGUiKTsKCQlpZiAoIWV2KSB7CgkJCXJldHVybiB0aGlzOwoJCX0KCgkJaWYgKGlkKSBldi5JZCA9IGlkOwoKCQlpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykgewoJCQkvLyB2YWx1ZXMgd2VyZSBnaXZlbiwgdGhlcmVmb3JlIGEgc2V0dGVyCgoJCQl2ID0gKF92ID0+IHsKCgkJCQlfdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfdikgPT09ICdbb2JqZWN0IERhdGVdJyA/IF92IDogKG5ldyBEYXRlKF92KSk7CgkJCQlpZiAoaXNOYU4oX3YuZ2V0VGltZSgpKSkgX3YgPSBudWxsOwoKCQkJCXJldHVybiBfdjsKCgkJCX0pKHYpOwoKCQkJZXYuRGF0ZVZhbHVlID0gdjsKCgkJCWlmICh0cnVlIHx8IHRoaXMuX2RhdGUgIT0gdikgewoJCQkJdGhpcy5fZGF0ZV9zZXQgPSBuZXcgRGF0ZSgpOyAvLyBhIGNoYW5nZSBpbiB2YWx1ZQoKCQkJfQoKCQkJdGhpcy5fZGF0ZSA9IHY7CgkJCWlmIChjbykgZXYuT1BFUkFUT1JTLkRhdGVWYWx1ZSA9IGNvOwoKCQkJcmV0dXJuIHRoaXM7CgkJfSBlbHNlIHsKCQkJcmV0dXJuIHRoaXMuaTE4bihldiwgdGhpcy5fZGF0ZSk7CgkJfQoJfQoKCWNsZWFyX2RhdGUoKSB7CgkJdGhpcy5fZGF0ZV9zZXQgPSBudWxsOwoJCXRoaXMuX2RhdGUgPSBudWxsOwoJCXRoaXMuX2RhdGVfY29vcCA9ICIiOwoJCXJldHVybiB0aGlzOwoJfQoKCS8qKiBlbmQ6IHNldHRlcnMgYW5kIGdldHRlcnMgZm9yIGRhdGUgKiovCgoJLyoqIHN0YXJ0OiBzZXR0ZXJzIGFuZCBnZXR0ZXJzIGZvciBuYW1lICoqLwoJbmFtZSh2LCBjbywgaWQpIHsKCQlpZiAoY28pIHRoaXMuX25hbWVfY29vcCA9IGNvOwoKCQl2YXIgZXYgPSB0aGlzLkVudGl0eVZhbHVlKCJuYW1lIik7CgkJaWYgKCFldikgewoJCQlyZXR1cm4gdGhpczsKCQl9CgoJCWlmIChpZCkgZXYuSWQgPSBpZDsKCgkJaWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHsKCQkJLy8gdmFsdWVzIHdlcmUgZ2l2ZW4sIHRoZXJlZm9yZSBhIHNldHRlcgoKCQkJdiA9IChfdiA9PiB7CgoJCQkJcmV0dXJuIF92OwoKCQkJfSkodik7CgoJCQlldi5TdHJpbmdWYWx1ZSA9IHY7CgoJCQlpZiAodHJ1ZSB8fCB0aGlzLl9uYW1lICE9IHYpIHsKCQkJCXRoaXMuX25hbWVfc2V0ID0gbmV3IERhdGUoKTsgLy8gYSBjaGFuZ2UgaW4gdmFsdWUKCgkJCX0KCgkJCXRoaXMuX25hbWUgPSB2OwoJCQlpZiAoY28pIGV2Lk9QRVJBVE9SUy5TdHJpbmdWYWx1ZSA9IGNvOwoKCQkJcmV0dXJuIHRoaXM7CgkJfSBlbHNlIHsKCQkJcmV0dXJuIHRoaXMuaTE4bihldiwgdGhpcy5fbmFtZSk7CgkJfQoJfQoKCWNsZWFyX25hbWUoKSB7CgkJdGhpcy5fbmFtZV9zZXQgPSBudWxsOwoJCXRoaXMuX25hbWUgPSBudWxsOwoJCXRoaXMuX25hbWVfY29vcCA9ICIiOwoJCXJldHVybiB0aGlzOwoJfQoKCS8qKiBlbmQ6IHNldHRlcnMgYW5kIGdldHRlcnMgZm9yIG5hbWUgKiovCgoJLyoqIHN0YXJ0OiBzZXR0ZXJzIGFuZCBnZXR0ZXJzIGZvciByZW1hcmsgKiovCglyZW1hcmsodiwgY28sIGlkKSB7CgkJaWYgKGNvKSB0aGlzLl9yZW1hcmtfY29vcCA9IGNvOwoKCQl2YXIgZXYgPSB0aGlzLkVudGl0eVZhbHVlKCJyZW1hcmsiKTsKCQlpZiAoIWV2KSB7CgkJCXJldHVybiB0aGlzOwoJCX0KCgkJaWYgKGlkKSBldi5JZCA9IGlkOwoKCQlpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykgewoJCQkvLyB2YWx1ZXMgd2VyZSBnaXZlbiwgdGhlcmVmb3JlIGEgc2V0dGVyCgoJCQl2ID0gKF92ID0+IHsKCgkJCQlpZiAodHlwZW9mKF92KSA9PT0gJ29iamVjdCcpIF92ID0gSlNPTi5zdHJpbmdpZnkoX3YpOwoKCQkJCXJldHVybiBfdjsKCgkJCX0pKHYpOwoKCQkJZXYuVGV4dFZhbHVlID0gdjsKCgkJCWlmICh0cnVlIHx8IHRoaXMuX3JlbWFyayAhPSB2KSB7CgkJCQl0aGlzLl9yZW1hcmtfc2V0ID0gbmV3IERhdGUoKTsgLy8gYSBjaGFuZ2UgaW4gdmFsdWUKCgkJCX0KCgkJCXRoaXMuX3JlbWFyayA9IHY7CgkJCWlmIChjbykgZXYuT1BFUkFUT1JTLlRleHRWYWx1ZSA9IGNvOwoKCQkJcmV0dXJuIHRoaXM7CgkJfSBlbHNlIHsKCQkJcmV0dXJuIHRoaXMuaTE4bihldiwgdGhpcy5fcmVtYXJrKTsKCQl9Cgl9CgoJY2xlYXJfcmVtYXJrKCkgewoJCXRoaXMuX3JlbWFya19zZXQgPSBudWxsOwoJCXRoaXMuX3JlbWFyayA9IG51bGw7CgkJdGhpcy5fcmVtYXJrX2Nvb3AgPSAiIjsKCQlyZXR1cm4gdGhpczsKCX0KCgkvKiogZW5kOiBzZXR0ZXJzIGFuZCBnZXR0ZXJzIGZvciByZW1hcmsgKiovCgoJLyoqIHN0YXJ0OiBzZXR0ZXJzIGFuZCBnZXR0ZXJzIGZvciBjb250ZW50ICoqLwoJY29udGVudCh2LCBjbywgaWQpIHsKCQlpZiAoY28pIHRoaXMuX2NvbnRlbnRfY29vcCA9IGNvOwoKCQl2YXIgZXYgPSB0aGlzLkVudGl0eVZhbHVlKCJjb250ZW50Iik7CgkJaWYgKCFldikgewoJCQlyZXR1cm4gdGhpczsKCQl9CgoJCWlmIChpZCkgZXYuSWQgPSBpZDsKCgkJaWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHsKCQkJLy8gdmFsdWVzIHdlcmUgZ2l2ZW4sIHRoZXJlZm9yZSBhIHNldHRlcgoKCQkJdiA9IChfdiA9PiB7CgoJCQkJaWYgKHR5cGVvZihfdikgPT09ICdvYmplY3QnKSBfdiA9IEpTT04uc3RyaW5naWZ5KF92KTsKCgkJCQlyZXR1cm4gX3Y7CgoJCQl9KSh2KTsKCgkJCWV2LlRleHRWYWx1ZSA9IHY7CgoJCQlpZiAodHJ1ZSB8fCB0aGlzLl9jb250ZW50ICE9IHYpIHsKCQkJCXRoaXMuX2NvbnRlbnRfc2V0ID0gbmV3IERhdGUoKTsgLy8gYSBjaGFuZ2UgaW4gdmFsdWUKCgkJCX0KCgkJCXRoaXMuX2NvbnRlbnQgPSB2OwoJCQlpZiAoY28pIGV2Lk9QRVJBVE9SUy5UZXh0VmFsdWUgPSBjbzsKCgkJCXJldHVybiB0aGlzOwoJCX0gZWxzZSB7CgkJCXJldHVybiB0aGlzLmkxOG4oZXYsIHRoaXMuX2NvbnRlbnQpOwoJCX0KCX0KCgljbGVhcl9jb250ZW50KCkgewoJCXRoaXMuX2NvbnRlbnRfc2V0ID0gbnVsbDsKCQl0aGlzLl9jb250ZW50ID0gbnVsbDsKCQl0aGlzLl9jb250ZW50X2Nvb3AgPSAiIjsKCQlyZXR1cm4gdGhpczsKCX0KCgkvKiogZW5kOiBzZXR0ZXJzIGFuZCBnZXR0ZXJzIGZvciBjb250ZW50ICoqLwoKCWdldCBTZXRfT24oKSB7CgkJbGV0IHJldCA9IG5ldyBEYXRlKE1hdGgubWF4KAoKCQkJdGhpcy5fYWN0aXZlX3NldCwKCgkJCXRoaXMuX2VuYWJsZWRfc2V0LAoKCQkJdGhpcy5fY29kZV9zZXQsCgoJCQl0aGlzLl9vcmRlcl9zZXQsCgoJCQl0aGlzLl9kYXRlX3NldCwKCgkJCXRoaXMuX25hbWVfc2V0LAoKCQkJdGhpcy5fcmVtYXJrX3NldCwKCgkJCXRoaXMuX2NvbnRlbnRfc2V0LAoKCQkpKTsKCgkJaWYgKCFyZXQgfHwgIShyZXQgaW5zdGFuY2VvZiBEYXRlICYmICFpc05hTihyZXQpKSkgcmV0dXJuIHVuZGVmaW5lZDsKCQlyZXR1cm4gcmV0OwoJfQoKCV9mbGF0dGVuKGRlcHRoKSB7CgkJbGV0IHJldCA9IHt9OwoJCWlmICghZGVwdGgpIHJldHVybiByZXQ7CgoJCXJldC5fYWN0aXZlX3NldCA9IHRoaXMuX2FjdGl2ZV9zZXQ7CgkJcmV0Ll9hY3RpdmVfY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wOwoJCXJldC5hY3RpdmUgPSB0aGlzLmFjdGl2ZSgpID8gdGhpcy5hY3RpdmUoKSA6IHRoaXMuYWN0aXZlKCk7CgoJCXJldC5fZW5hYmxlZF9zZXQgPSB0aGlzLl9lbmFibGVkX3NldDsKCQlyZXQuX2VuYWJsZWRfY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcDsKCQlyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpID8gdGhpcy5lbmFibGVkKCkgOiB0aGlzLmVuYWJsZWQoKTsKCgkJcmV0Ll9jb2RlX3NldCA9IHRoaXMuX2NvZGVfc2V0OwoJCXJldC5fY29kZV9jb29wID0gdGhpcy5fY29kZV9jb29wOwoJCXJldC5jb2RlID0gdGhpcy5jb2RlKCkgPyB0aGlzLmNvZGUoKSA6IHRoaXMuY29kZSgpOwoKCQlyZXQuX29yZGVyX3NldCA9IHRoaXMuX29yZGVyX3NldDsKCQlyZXQuX29yZGVyX2Nvb3AgPSB0aGlzLl9vcmRlcl9jb29wOwoJCXJldC5vcmRlciA9IHRoaXMub3JkZXIoKSA/IHRoaXMub3JkZXIoKSA6IHRoaXMub3JkZXIoKTsKCgkJcmV0Ll9kYXRlX3NldCA9IHRoaXMuX2RhdGVfc2V0OwoJCXJldC5fZGF0ZV9jb29wID0gdGhpcy5fZGF0ZV9jb29wOwoJCXJldC5kYXRlID0gdGhpcy5kYXRlKCkgPyB0aGlzLmRhdGUoKSA6IHRoaXMuZGF0ZSgpOwoKCQlyZXQuX25hbWVfc2V0ID0gdGhpcy5fbmFtZV9zZXQ7CgkJcmV0Ll9uYW1lX2Nvb3AgPSB0aGlzLl9uYW1lX2Nvb3A7CgkJcmV0Lm5hbWUgPSB0aGlzLm5hbWUoKSA/IHRoaXMubmFtZSgpIDogdGhpcy5uYW1lKCk7CgoJCXJldC5fcmVtYXJrX3NldCA9IHRoaXMuX3JlbWFya19zZXQ7CgkJcmV0Ll9yZW1hcmtfY29vcCA9IHRoaXMuX3JlbWFya19jb29wOwoJCXJldC5yZW1hcmsgPSB0aGlzLnJlbWFyaygpID8gdGhpcy5yZW1hcmsoKSA6IHRoaXMucmVtYXJrKCk7CgoJCXJldC5fY29udGVudF9zZXQgPSB0aGlzLl9jb250ZW50X3NldDsKCQlyZXQuX2NvbnRlbnRfY29vcCA9IHRoaXMuX2NvbnRlbnRfY29vcDsKCQlyZXQuY29udGVudCA9IHRoaXMuY29udGVudCgpID8gdGhpcy5jb250ZW50KCkgOiB0aGlzLmNvbnRlbnQoKTsKCgkJcmV0dXJuIHJldDsKCX0KCglfdG9IYXNoKGFyZ3MsIG9wdGlvbnMpIHsKCQlvcHRpb25zID0gb3B0aW9ucyB8fCB7fTsKCQlvcHRpb25zLmNhY2hlTGltaXQgPSBvcHRpb25zLmNhY2hlTGltaXQgfHwgNTsKCgkJbGV0IG9IYXNoID0gewoJCQlhcmdzOiBhcmdzLAoJCQlfdGhpczoge30gLy8gdGhpcy5fcHJ1bmUodGhpcykgZG9lcyBub3Qgd29yayBiZWNhdXNlIElkIGlzIG5vdCBleGNsdWRlZCBmb3IgcXVlcmllczsgdGhpcy5fcHJ1bmUodGhpcy5fdG9Eb2N1bWVudCgpKSBjcmVhdGVzIGNpcmN1bGFycwoJCX07CgoJCWlmICh0cnVlIHx8IG9wdGlvbnMuZGVwdGgpIHsKCQkJb0hhc2guX3RoaXMgPSB0aGlzLl9mbGF0dGVuKG9wdGlvbnMuZGVwdGggfHwgMyk7CgkJfSBlbHNlIHsKCQkJb0hhc2guX3RoaXMgPSB0aGlzLl9fZXhwb3J0KG9IYXNoLl90aGlzLCB7CgkJCQlPUEVSQVRPUlM6IHRydWUsCgkJCQlJZDogKG9iaiwgdikgPT4gb2JqLklkID0gdiwKCgkJCQkiYWN0aXZlIjogKG9iaiwgdiwgZWFDb2RlID0gdGhpcy5fbkNvZGUoJ2FjdGl2ZScsIHVuZGVmaW5lZCkpID0+IHsKCgkJCQkJb2JqW2VhQ29kZV0gPSB2OwoKCQkJCX0sCgoJCQkJImVuYWJsZWQiOiAob2JqLCB2LCBlYUNvZGUgPSB0aGlzLl9uQ29kZSgnZW5hYmxlZCcsIHVuZGVmaW5lZCkpID0+IHsKCgkJCQkJb2JqW2VhQ29kZV0gPSB2OwoKCQkJCX0sCgoJCQkJImNvZGUiOiAob2JqLCB2LCBlYUNvZGUgPSB0aGlzLl9uQ29kZSgnY29kZScsIHVuZGVmaW5lZCkpID0+IHsKCgkJCQkJb2JqW2VhQ29kZV0gPSB2OwoKCQkJCX0sCgoJCQkJIm9yZGVyIjogKG9iaiwgdiwgZWFDb2RlID0gdGhpcy5fbkNvZGUoJ29yZGVyJywgdW5kZWZpbmVkKSkgPT4gewoKCQkJCQlvYmpbZWFDb2RlXSA9IHY7CgoJCQkJfSwKCgkJCQkiZGF0ZSI6IChvYmosIHYsIGVhQ29kZSA9IHRoaXMuX25Db2RlKCdkYXRlJywgdW5kZWZpbmVkKSkgPT4gewoKCQkJCQlvYmpbZWFDb2RlXSA9IHY7CgoJCQkJfSwKCgkJCQkibmFtZSI6IChvYmosIHYsIGVhQ29kZSA9IHRoaXMuX25Db2RlKCduYW1lJywgdW5kZWZpbmVkKSkgPT4gewoKCQkJCQlvYmpbZWFDb2RlXSA9IHY7CgoJCQkJfSwKCgkJCQkicmVtYXJrIjogKG9iaiwgdiwgZWFDb2RlID0gdGhpcy5fbkNvZGUoJ3JlbWFyaycsIHVuZGVmaW5lZCkpID0+IHsKCgkJCQkJb2JqW2VhQ29kZV0gPSB2OwoKCQkJCX0sCgoJCQkJImNvbnRlbnQiOiAob2JqLCB2LCBlYUNvZGUgPSB0aGlzLl9uQ29kZSgnY29udGVudCcsIHVuZGVmaW5lZCkpID0+IHsKCgkJCQkJb2JqW2VhQ29kZV0gPSB2OwoKCQkJCX0sCgoJCQl9LCAiX3RvSGFzaCIpOwoJCX0KCgkJcmV0dXJuIG9wdGlvbnMuTm9Db2RlID8gb0hhc2ggOiB0aGlzLmhhc2hDb2RlKEpTT04uc3RyaW5naWZ5KG9IYXNoKSk7Cgl9CgoJYXN5bmMgX2F1dGhvcml6ZSh1c2VybmFtZSwgcGFzc3dvcmQsIGJTZXJ2ZXIpIHsKCgkJaWYgKCF1c2VybmFtZSAmJiAhcGFzc3dvcmQgJiYgIWxvdHRvLl9fdG9rZW4gJiYgdGhpcy5UZXN0WydfYXV0aG9yaXplLnVzZXJuYW1lJ10pIHsKCQkJdXNlcm5hbWUgPSB0aGlzLlRlc3RbJ19hdXRob3JpemUudXNlcm5hbWUnXTsKCQkJcGFzc3dvcmQgPSB0aGlzLlRlc3RbJ19hdXRob3JpemUucGFzc3dvcmQnXTsKCQl9CgoJCWlmIChiU2VydmVyKSB7CgkJCWlmICh1c2VybmFtZSAmJiAhbG90dG8uX3Rlc3RVc2VyICYmIHRoaXMuVGVzdFsnX2F1dGhvcml6ZS50ZXN0VXNlciddKSB7CgkJCQlsb3R0by5fdGVzdFVzZXIgPSBhd2FpdCBuZXcgbG90dG8uQ29udGVudCgpLl9mcm9tRG9jdW1lbnQodGhpcy5UZXN0WydfYXV0aG9yaXplLnRlc3RVc2VyJ10pLmFjdGl2ZSh0cnVlKS5lbmFibGVkKHRydWUpLnVzZXJuYW1lKHVzZXJuYW1lKS5wYXNzd29yZChwYXNzd29yZCkuc3RvcmUoKTsKCQkJfQoJCQlsZXQgcmV0ID0gYXdhaXQgdGhpcy51c2VybmFtZSh1c2VybmFtZSwgJz0nKS5wYXNzd29yZChwYXNzd29yZCwgJz0nKS5hY3RpdmUodHJ1ZSkuZW5hYmxlZCh0cnVlKS5maW5kKCk7CgkJCXRoaXMubG9nKHVuZGVmaW5lZCwgJ19hdXRob3JpemUnLCAnRW50aXR5T2JqZWN0JywgMCwgIlNlcnZlcjogIiArIGJTZXJ2ZXIgKyAiLCBPYmo6IiwgcmV0KTsKCgkJCWlmIChyZXQpIHsKCQkJCWlmICh0eXBlb2YoanNvbndlYnRva2VuKSAhPT0gJ3VuZGVmaW5lZCcpIHsKCQkJCQlyZXQgPSBqc29ud2VidG9rZW4uc2lnbihyZXQuX3RvRG9jdW1lbnQoKSwgdGhpcy5fX2NvbmZpZygnc2VjcmV0JyksIHsKCQkJCQkJZXhwaXJlc0luOiAnMTgwMHMnCgkJCQkJfSk7CgkJCQl9IGVsc2UgewoJCQkJCXJldCA9IHRoaXMuX2J0b2EoSlNPTi5zdHJpbmdpZnkocmV0Ll90b0RvY3VtZW50KCkpKTsKCQkJCX0KCQkJfQoKCQkJcmV0ID0gewoJCQkJYWNjZXNzX3Rva2VuOiByZXQsCgkJCX07CgkJCXRoaXMubG9nKHVuZGVmaW5lZCwgJ19hdXRob3JpemUnLCAnRW50aXR5T2JqZWN0JywgMCwgIlNlcnZlcjogIiArIGJTZXJ2ZXIgKyAiLCB0b2tlbjogIiwgcmV0KTsKCQkJcmV0dXJuIHJldDsKCQl9IGVsc2UgewoJCQlsZXQgY2xpZW50X2lkID0gdGhpcy5fX2NvbmZpZygnY2xpZW50X2lkJyk7CgkJCWxldCBjbGllbnRfc2VjcmV0ID0gdGhpcy5fX2NvbmZpZygnc2VjcmV0Jyk7CgoJCQlpZiAoIXVzZXJuYW1lICYmICFwYXNzd29yZCAmJiBsb3R0by5fX3Rva2VuKSB7CgkJCQl0aGlzLmxvZyh1bmRlZmluZWQsICdfYXV0aG9yaXplJywgJ0VudGl0eU9iamVjdCcsIDAsICJObyB1c2VybmFtZS9wYXNzd29yZCBhbmQgdG9rZW4gYWxyZWFkeSBleGlzdHMiKTsKCQkJCXJldHVybjsKCQkJfQoKCQkJbG90dG8uX190b2tlbiA9IGF3YWl0IG5ldyBsb3R0by5Vc2VyKCkudXNlcm5hbWUodXNlcm5hbWUpLnBhc3N3b3JkKHBhc3N3b3JkKS5hdXRob3JpemUoKTsKCgkJfQoKCX0KCglfcWxTZWxlY3Rpb25zKHNTZXQpIHsKCQlsZXQgcmV0ID0gW107CgkJaWYgKCFzU2V0IHx8ICFzU2V0LnNlbGVjdGlvbnMpIHJldHVybiByZXQ7CgoJCXNTZXQuc2VsZWN0aW9ucy5maWx0ZXIocyA9PiBzLnNlbGVjdGlvblNldCkuZm9yRWFjaChzID0+IHsKCgkJfSk7CgoJCXJldHVybiByZXQ7Cgl9CgoJYXN5bmMgX3NlcnZlcihvcHRpb25zID0ge30pIHsKCQlpZiAob3B0aW9ucy5jbGVhckNvbnNvbGUgJiYgdHlwZW9mKGNsZWFyKSAhPT0gJ3VuZGVmaW5lZCcpIGNsZWFyKCk7CgoJCWlmICh0eXBlb2Yod2luZG93KSAhPT0gJ3VuZGVmaW5lZCcgJiYgbG90dG8uaHJlZnMpIHsKCQkJZm9yIGF3YWl0IChjb25zdCBsIG9mIGxvdHRvLmhyZWZzLm1hcChuID0+IG4ubGliKSkgewoJCQkJYXdhaXQgdGhpcy5yZXF1aXJlKGwsIGxvdHRvLmhyZWZzKTsKCQkJfQoJCX0KCgkJbGV0IHNlY3VyZSA9IHRoaXMuX19jb25maWcoJ3NlY3VyZScpOwoJCWlmICh0eXBlb2YoZ2xvYmFsKSAhPT0gJ3VuZGVmaW5lZCcpIHsKCQkJLy8gZ2xvYmFscwoJCQl2YXIgZ2xvYmFsTW9kdWxlcyA9IHsKCQkJCWV4cHJlc3M6ICdleHByZXNzJywKCQkJCWh0dHBzOiAnaHR0cHMnLAoJCQkJaHR0cDogJ2h0dHAnLAoJCQkJc2VsZnNpZ25lZDogJ3NlbGZzaWduZWQnLAoJCQkJdXRpbDogJ3V0aWwnLAoJCQkJY29yczogJ2NvcnMnLAoJCQkJYm9keVBhcnNlcjogJ2JvZHktcGFyc2VyJywKCQkJCWF4aW9zOiAnYXhpb3MnLAoJCQkJLy9jcnlwdG86ICdjcnlwdG8nLAoJCQkJb3M6ICdvcycsCgkJCQlEb3RPYmplY3Q6ICdkb3Qtb2JqZWN0JywKCgkJCQltaW5pbWlzdDogJ21pbmltaXN0JywKCgkJCQlmczogJ2ZzJywKCgkJCQlqc29ud2VidG9rZW46ICdqc29ud2VidG9rZW4nLAoKCQkJCXNxbGl0ZTogJ3NxbGl0ZTMnLAoJCQkJbXlzcWw6ICdteXNxbCcsCgkJCQlwZzogJ3BnJywKCgkJCX07CgoJCQlsZXQgbWlzc2luZ0dsb2JhbE1vZHVsZXMgPSBPYmplY3QuZW50cmllcyhnbG9iYWxNb2R1bGVzKS5tYXAoZSA9PiB7CgkJCQl0cnkgewoJCQkJCWdsb2JhbFtlWzBdXSA9IHJlcXVpcmUoZVsxXSk7CgkJCQl9IGNhdGNoIChleCkgewoJCQkJCXRoaXMubG9nKHVuZGVmaW5lZCwgJ19zZXJ2ZXInLCAnRW50aXR5T2JqZWN0JywgMSwgZXgpOwoJCQkJCXJldHVybiBlWzFdOwoJCQkJfQoJCQl9KS5maWx0ZXIoZSA9PiBlKTsKCQkJaWYgKG1pc3NpbmdHbG9iYWxNb2R1bGVzLmxlbmd0aCkgdGhpcy5sb2codW5kZWZpbmVkLCAnX3NlcnZlcicsICdFbnRpdHlPYmplY3QnLCAxLCAibnBtIGluc3RhbGwgIiArIG1pc3NpbmdHbG9iYWxNb2R1bGVzLmpvaW4oJyAnKSk7CgkJfQoKCQlpZiAob3B0aW9ucy5pbml0U2VsZikgewoJCQlpZiAodGhpcy5pbml0KSB7CgkJCQlhd2FpdCB0aGlzLl93YWl0KDUwMCk7CgkJCQlpZiAob3B0aW9ucy5sb2FkVG9vbHMpIGF3YWl0IHRoaXMuX2xvYWRUb29scyhvcHRpb25zLnNhdmVUb29scyk7CgoJCQkJYXdhaXQgdGhpcy5pbml0KCk7CgoJCQkJbGV0IHNxbFRvb2wgPSAobG90dG8uVG9vbHMgfHwgW10pLmZpbmQodCA9PiB0Ll9fZG1sU3RhdGVtZW50cyk7CgkJCQlpZiAob3B0aW9ucy5jb3B5RE1MICYmIHNxbFRvb2wpIHsKCQkJCQlsZXQgZG1scyA9IHNxbFRvb2wuX19kbWxTdGF0ZW1lbnRzOwoJCQkJCWlmIChzcWxUb29sLnR5cGUubmFtZSA9PSAnU3FsREInKSBkbWxzID0gWyAvKiJDdXN0b21lcnMiLCAiT3JkZXJzIiwgIlNoaXBwaW5ncyIsICovICJkZW1vIl0ubWFwKHQgPT4gYGRyb3AgdGFibGUgaWYgZXhpc3RzICR7dH1gKS5jb25jYXQoZG1scyk7CgkJCQkJX0ZyRU1ELl9jb3B5VGV4dFRvQ2xpcGJvYXJkKGRtbHMuam9pbignO1xuJykpOwoJCQkJfQoJCQl9CgkJfQoKCQlpZiAodHlwZW9mKHdpbmRvdykgIT09ICd1bmRlZmluZWQnICYmIG9wdGlvbnMubG9hZENvbnRlbnQpIHsKCQkJYXdhaXQgdGhpcy5fY29udGVudCgnaW5kZXgnLCB7CgkJCQl0YXJnZXQ6IGRvY3VtZW50LmJvZHkKCQkJfSk7CgkJfQoKCQkvLyByZWZyZXNoIHNjcmlwdAoJCXRoaXMuc2V0SW50ZXJ2YWwoYXN5bmMgKCAvKnZlcnNpb24qLyApID0+IHsKCQkJbGV0IHNjdCA9IG5ldyBsb3R0by5Db250ZW50KCkuX2Zyb21Eb2N1bWVudChsb3R0by5fX0NvbnRlbnQgfHwgewoJCQkJY29kZTogJ2FwaXNlcnZlcicKCQkJfSk7CgkJCWxldCBjdCA9IGF3YWl0IHNjdC5maW5kKCk7CgkJCWlmICghY3QgfHwgIWN0LmFjdGl2ZSgpIHx8ICFjdC5lbmFibGVkKCkpIHJldHVybiBmYWxzZTsKCgkJCWlmICghc2N0LmRhdGUoKSB8fCAoKGN0LmRhdGUoKS5nZXRUaW1lKCkgLSBzY3QuZGF0ZSgpLmdldFRpbWUoKSkgLyAxMDAwKSA+IDUpIHsKCQkJCXRoaXMubG9nKHVuZGVmaW5lZCwgJ19zZXJ2ZXInLCAnRW50aXR5T2JqZWN0JywgMCwgYE5ld2VyIHZlcnNpb24gZm91bmQ6IFtkYXRlOiAke2N0LmRhdGUoKS50b0lTT1N0cmluZygpfSwgdG9vbDogJHtjdC5Ub29sLm5hbWV9XSwgc3RvcmluZy4uLmApOwoJCQkJaWYgKHR5cGVvZihnbG9iYWwpICE9PSAndW5kZWZpbmVkJykgewoJCQkJCS8vIHdlIHdhbnQgdG8gc3RvcmUgdGhlIGNvbnRlbnQgZGlyZWN0bHkgdG8gdGhlIGFwaXNlcnZlci5qcyBmaWxlCgkJCQkJYXdhaXQgY3QuX2ZpbGVzeXN0ZW0oY3QuY29kZSgpICsgJy5qcycsIHRoaXMuX2F0b2IoY3QuY29udGVudCgpKSk7CgkJCQl9IGVsc2UgaWYgKHR5cGVvZih3aW5kb3cpICE9PSAndW5kZWZpbmVkJykgewoJCQkJCXRyeSB7CgkJCQkJCWlmICh3aW5kb3cuc2VsZiAhPT0gd2luZG93LnRvcCkgewoJCQkJCQkJdGhpcy5sb2codW5kZWZpbmVkLCAnX3NlcnZlcicsICdFbnRpdHlPYmplY3QnLCAwLCAiaUZyYW1lIHNob3VsZCBiZSByZXN0YXJ0ZWQuLi4iKTsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCXRoaXMubG9nKHVuZGVmaW5lZCwgJ19zZXJ2ZXInLCAnRW50aXR5T2JqZWN0JywgMCwgIndpbmRvdyBsb2NhdGlvbiByZWxvYWRpbmcuLi4iKTsKCQkJCQkJCS8vd2luZG93LmxvY2F0aW9uLnJlbG9hZCgpOwoJCQkJCQl9CgkJCQkJfSBjYXRjaCAoZXgpIHsKCQkJCQkJdGhpcy5sb2codW5kZWZpbmVkLCAnX3NlcnZlcicsICdFbnRpdHlPYmplY3QnLCAyLCAiZnJhbWUgY2hlY2siLCBleCk7CgkJCQkJfQoJCQkJfQoKCQkJCWxvdHRvLl9fQ29udGVudCA9IHNjdC5kYXRlKGN0LmRhdGUoKSkubmFtZShjdC5uYW1lKCkpLmNvZGUoY3QuY29kZSgpKS5fdG9Eb2N1bWVudCgpOwoJCQkJcmV0dXJuIGZhbHNlOwoJCQl9CgkJCXJldHVybiB0cnVlOwoJCX0sIDAuNSk7CgoJCWlmICh0eXBlb2YoZ2xvYmFsKSAhPT0gJ3VuZGVmaW5lZCcpIHsKCQkJY29uc3QgYXBwID0gZXhwcmVzcygpOwoKCQkJYXBwLnVzZShjb3JzKCkpOwoKCQkJYXBwLnVzZShleHByZXNzLnVybGVuY29kZWQoewoJCQkJZXh0ZW5kZWQ6IHRydWUsCgkJCQlsaW1pdDogJzUwbWInCgkJCX0pKTsKCQkJYXBwLnVzZShib2R5UGFyc2VyLmpzb24oewoJCQkJdmVyaWZ5OiAocmVxLCByZXMsIGJ1ZikgPT4gcmVxLnJhd0JvZHkgPSBidWYKCQkJfSkpOwoKCQkJZ2xvYmFsLmF1dGhlbnRpY2F0ZSA9IGFzeW5jIChyZXEsIHJlcywgbmV4dCkgPT4gewoJCQkJY29uc3QgYXV0aEhlYWRlciA9IHJlcS5oZWFkZXJzWydhdXRob3JpemF0aW9uJ107CgkJCQljb25zdCB0b2tlbiA9IGF1dGhIZWFkZXIgJiYgYXV0aEhlYWRlci5zcGxpdCgnICcpWzFdOwoKCQkJCWlmICh0b2tlbiA9PSBudWxsKSByZXR1cm4gcmVzLnNlbmRTdGF0dXMoNDAxKTsKCgkJCQlqc29ud2VidG9rZW4udmVyaWZ5KHRva2VuLCB0aGlzLl9fY29uZmlnKCdzZWNyZXQnKSwgKGVyciwgb2JqKSA9PiB7CgkJCQkJaWYgKGVycikgcmV0dXJuIHJlcy5zZW5kU3RhdHVzKDQwMyk7CgoJCQkJCXJlcS5fX2F1dGhvcml6YXRpb24gPSBvYmo7CgkJCQkJbmV4dCgpOwoJCQkJfSk7CgkJCX07CgoJCQlhcHAucG9zdCgnL21ldGhvZC9Vc2VyL2F1dGhvcml6ZScsIChyZXEsIHJlcykgPT4gdGhpcy5faW5ib3VuZENhbGwocmVxLCByZXMsICJVc2VyIiwgImF1dGhvcml6ZSIpKTsKCQkJYXBwLmdldCgnL21ldGhvZC9Vc2VyL2F1dGhvcml6ZScsIChyZXEsIHJlcykgPT4gdGhpcy5faW5ib3VuZENhbGwocmVxLCByZXMsICJVc2VyIiwgImF1dGhvcml6ZSIpKTsKCgkJCWFwcC5wb3N0KCcvbWV0aG9kLzpjbGFzcy86bWV0aG9kJywgZ2xvYmFsLmF1dGhlbnRpY2F0ZSwgKHJlcSwgcmVzKSA9PiB0aGlzLl9pbmJvdW5kQ2FsbChyZXEsIHJlcykpOwoJCQlhcHAuZ2V0KCcvbWV0aG9kLzpjbGFzcy86bWV0aG9kJywgZ2xvYmFsLmF1dGhlbnRpY2F0ZSwgKHJlcSwgcmVzKSA9PiB0aGlzLl9pbmJvdW5kQ2FsbChyZXEsIHJlcykpOwoKCQkJaWYgKHRoaXMuX19jb25maWcoJ2VtYWlsLmhvc3QnKSkgewoJCQkJbG90dG8udHJhbnNwb3J0ZXIgPSBub2RlbWFpbGVyLmNyZWF0ZVRyYW5zcG9ydCh7CgkJCQkJc2VydmljZTogdGhpcy5fX2NvbmZpZygnZW1haWwuaG9zdCcpLAoJCQkJCWF1dGg6IHRoaXMuX19jb25maWcoJ2VtYWlsLnVzZXInKSA/IHsKCQkJCQkJdXNlcjogdGhpcy5fX2NvbmZpZygnZW1haWwudXNlcicpLAoJCQkJCQlwYXNzOiB0aGlzLl9fY29uZmlnKCdlbWFpbC5wYXNzd29yZCcpLAoJCQkJCX0gOiB1bmRlZmluZWQsCgkJCQl9KTsKCgkJCQkvKgoJCQkJYXdhaXQgbG90dG8udHJhbnNwb3J0ZXIuc2VuZE1haWwoewoJCQkJICAgIGZyb206IHRoaXMuX19jb25maWcoJ2VtYWlsLnNlbmRlcicpLAoJCQkJICAgIHRvLAoJCQkJICAgIHN1YmplY3QsCgkJCQkgICAgdGV4dCwKCQkJCX0pOwoJCQkJKi8KCQkJfQoKCQkJbGV0IHBvcnQgPSBsb3R0by5fbm9kZSA/IChsb3R0by5fbm9kZS5wb3J0KCkgfHwgMzAwMCkgOiAzMDAwOwoJCQlsZXQgYWRkcmVzcyA9ICIwLjAuMC4wIjsKCgkJCWxldCBsaXN0ZW4gPSBhc3luYyAoKSA9PiB0aGlzLmxvZyh1bmRlZmluZWQsICdfc2VydmVyJywgJ0VudGl0eU9iamVjdCcsIDAsIGBsb3R0b1ske3RoaXMuaXBBZGRyZXNzKCl9XSBsaXN0ZW5pbmcgYXQgaHR0cCR7c2VjdXJlPydzJzonJ306Ly8ke2FkZHJlc3N9OiR7cG9ydH1gKTsKCQkJaWYgKHNlY3VyZSkgewoJCQkJbGV0IGNlcnQgPSBudWxsOwoJCQkJaWYgKHRoaXMuX19jb25maWcoJ3NlY3VyZS5wcml2YXRlJykpIHsKCQkJCQljZXJ0ID0gewoJCQkJCQlwcml2YXRlOiAoYXdhaXQgZnMucHJvbWlzZXMucmVhZEZpbGUodGhpcy5fX2NvbmZpZygnc2VjdXJlLnByaXZhdGUnKSkpLAoJCQkJCQljZXJ0OiAoYXdhaXQgZnMucHJvbWlzZXMucmVhZEZpbGUodGhpcy5fX2NvbmZpZygnc2VjdXJlLmNlcnQnKSkpLAoJCQkJCX07CgkJCQl9IGVsc2UgewoJCQkJCWNlcnQgPSBzZWxmc2lnbmVkLmdlbmVyYXRlKFt7CgkJCQkJCW5hbWU6ICdjb21tb25OYW1lJywKCQkJCQkJdmFsdWU6ICduYW1tb3VyLmNvbScKCQkJCQl9XSwgewoJCQkJCQlkYXlzOiAzNjUKCQkJCQl9KTsKCQkJCX0KCQkJCWdsb2JhbC5leFNlcnZlciA9IGh0dHBzLmNyZWF0ZVNlcnZlcih7CgkJCQkJa2V5OiBjZXJ0LnByaXZhdGUsCgkJCQkJY2VydDogY2VydC5jZXJ0CgkJCQl9LCBhcHApLmxpc3Rlbihwb3J0LCBhZGRyZXNzLCBsaXN0ZW4pOwoJCQl9IGVsc2UgewoJCQkJZ2xvYmFsLmV4U2VydmVyID0gaHR0cC5jcmVhdGVTZXJ2ZXIoYXBwKS5saXN0ZW4ocG9ydCwgYWRkcmVzcywgbGlzdGVuKTsKCQkJfQoJCX0KCX0KCglhc3luYyBfY29udGVudChjb2RlLCBvcHRpb25zID0ge30pIHsKCQl0cnkgewoJCQlsZXQganMgPSAoYXdhaXQgbmV3IGxvdHRvLkNvbnRlbnQobnVsbCwgb3B0aW9ucy50b29sKS5jb2RlKGNvZGUsICc9JykuZmluZCgpKS5jb250ZW50KCk7CgkJCXRoaXMubG9nKHVuZGVmaW5lZCwgJ19jb250ZW50JywgJ0VudGl0eU9iamVjdCcsIDAsIGpzKTsKCQkJaWYgKG9wdGlvbnMudGFyZ2V0KSB7CgkJCQlsZXQgbmV3U2NyaXB0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic2NyaXB0Iik7CgkJCQluZXdTY3JpcHQuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoanMpKTsKCQkJCW9wdGlvbnMudGFyZ2V0LmFwcGVuZENoaWxkKG5ld1NjcmlwdCk7CgkJCX0KCQkJcmV0dXJuIGpzOwoJCX0gY2F0Y2ggKGV4KSB7CgkJCXRoaXMubG9nKHVuZGVmaW5lZCwgJ19jb250ZW50JywgJ0VudGl0eU9iamVjdCcsIDIsIGV4KTsKCQl9Cgl9CgoJYXN5bmMgX2luYm91bmRDYWxsKHJlcSwgcmVzLCBjTmFtZSwgbU5hbWUpIHsKCQlsZXQgcmV0ID0ge307CgkJdHJ5IHsKCQkJcmV0ID0gYXdhaXQgbmV3IGxvdHRvW3JlcS5wYXJhbXMuY2xhc3MgfHwgY05hbWVdKCkuX2ludm9rZShyZXEucGFyYW1zLm1ldGhvZCB8fCBtTmFtZSwgcmVxLmJvZHksIHJlcS5xdWVyeSwgcmVxLl9fYXV0aG9yaXphdGlvbik7CgkJfSBjYXRjaCAoZXgpIHsKCQkJdGhpcy5sb2codW5kZWZpbmVkLCAnX2luYm91bmRDYWxsJywgJ0VudGl0eU9iamVjdCcsIDIsIGV4KTsKCQkJcmV0ID0gewoJCQkJRXhjZXB0aW9uOiAiRXhjZXB0aW9uOiAiICsgZXgsCgkJCX07CgkJfQoKCQlpZiAodHlwZW9mKEZsYXR0ZWQpICE9PSAidW5kZWZpbmVkIiAmJiByZXEucXVlcnlbImpzb24iXSAhPSAidHJ1ZSIgJiYgcmVxLmJvZHkgJiYgcmVxLmJvZHkuX19mbGF0dGVkKSByZXQgPSB7CgkJCV9fZmxhdHRlZDogRmxhdHRlZC5zdHJpbmdpZnkocmV0KQoJCX07CgoJCWlmIChyZXQgJiYgdHlwZW9mKHJldCkgPT09ICJudW1iZXIiKSByZXQgPSByZXQudG9TdHJpbmcoKTsKCQlyZXMuc2VuZChyZXQpOwoJfQoKCWFzeW5jIF9pbnZva2VOb2RlKG4sIG1ldGhvZCwgZGF0YSwgZXZlbnQsIGJSYXcpIHsKCQkvLyBpZighbikgcmV0dXJuIG51bGw7CgoJCWlmICh0eXBlb2YobG90dG8uX25vZGUpID09PSAndW5kZWZpbmVkJykgewoJCQl0aGlzLmxvZyh1bmRlZmluZWQsICdfaW52b2tlTm9kZScsICdFbnRpdHlPYmplY3QnLCAxLCAibG90dG8uX25vZGUgbm90IGRlZmluZWQiKTsKCQkJcmV0dXJuIG51bGw7CgkJfQoKCQlpZiAoZXZlbnQpIHsKCgkJCXRoaXMubG9nKHVuZGVmaW5lZCwgJ19pbnZva2VOb2RlJywgJ0VudGl0eU9iamVjdCcsIDIsICJFdmVudCBjYW5ub3QgYmUgZGVmaW5lZCB3aXRob3V0IHRoZSBFdmVudCBjbGFzcyIpOwoJCQlyZXR1cm4gbnVsbDsKCgkJfQoKCQlsZXQgcmV0ID0gbnVsbDsKCgkJZGF0YSA9IGRhdGEgfHwge307CgoJCWlmICh0eXBlb2YoZGF0YSkgPT09ICJvYmplY3QiKSB7CgkJCWRhdGEuX190aGlzID0gZGF0YS5fX3RoaXMgfHwgdGhpcy5fdG9Eb2N1bWVudCgpOwoJCQlzd2l0Y2ggKG1ldGhvZCkgewoKCQkJfQoJCX0KCgkJaWYgKCFuIHx8IGxvdHRvLl9ub2RlLl9zYW1lTm9kZShuKSkgewoJCQkvLyB0aGlzLmxvZyh1bmRlZmluZWQsICdfaW52b2tlTm9kZScsICdFbnRpdHlPYmplY3QnLCAwLCAiQ2FsbGJhY2siKTsKCQkJcmV0ID0gYXdhaXQgdGhpcy5faW52b2tlKG1ldGhvZCwgZGF0YSk7CgkJfSBlbHNlIGlmIChuLmFkZHJlc3MoKSAmJiBuLl9zYW1lTm9kZShuKSAvKmFjdHVhbCBub2RlKi8gKSB7CgkJCS8vIHRoaXMubG9nKHVuZGVmaW5lZCwgJ19pbnZva2VOb2RlJywgJ0VudGl0eU9iamVjdCcsIDAsIG4uX2FkZHJlc3MsIG4uX3BvcnQsIG1ldGhvZCk7CgkJCXRyeSB7CgkJCQlsZXQgY29uZmlnID0gewoJCQkJCWhlYWRlcnM6IHt9LAoJCQkJfTsKCQkJCWlmIChsb3R0by5fX3Rva2VuKSBjb25maWcuaGVhZGVycy5BdXRob3JpemF0aW9uID0gYCR7bG90dG8uX190b2tlbi50b2tlbl90eXBlfSAke2xvdHRvLl9fdG9rZW4uYWNjZXNzX3Rva2VufWA7CgkJCQlyZXQgPSBhd2FpdCBheGlvcy5wb3N0KGBodHRwJHtuLnNlY3VyZSgpPydzJzonJ306Ly8ke24uYWRkcmVzcygpfToke24ucG9ydCgpIHx8IDMwMDB9L21ldGhvZC9Db250ZW50LyR7bWV0aG9kfWAsIGRhdGEsIGNvbmZpZyk7CgkJCX0gY2F0Y2ggKGV4KSB7CgkJCQl0aGlzLmxvZyh1bmRlZmluZWQsICdfaW52b2tlTm9kZScsICdFbnRpdHlPYmplY3QnLCAyLCBleCk7CgkJCX0KCQl9IGVsc2UgewoKCQl9CgoJCWlmICghcmV0KSByZXR1cm4gbnVsbDsKCQlyZXQgPSByZXQuZGF0YSB8fCByZXQ7CgkJaWYgKHR5cGVvZihGbGF0dGVkKSAhPT0gInVuZGVmaW5lZCIgJiYgcmV0Ll9fZmxhdHRlZCkgcmV0ID0gRmxhdHRlZC5wYXJzZShyZXQuX19mbGF0dGVkKTsKCgkJaWYgKHJldC5fX2V4Y2VwdGlvbikgewoJCQkvLyBhbiBleGNlcHRpb24gb2NjdXJyZWQgYXQgdGhlIHNlcnZlcgoJCQl0aGlzLmxvZyh1bmRlZmluZWQsICdfaW52b2tlTm9kZScsICdFbnRpdHlPYmplY3QnLCAyLCBgRXhjZXB0aW9uIGF0ICR7bi5fYWRkcmVzc31gLCByZXQuX19leGNlcHRpb24pOwoJCQlyZXR1cm4gcmV0OwoJCX0KCgkJc3dpdGNoIChtZXRob2QpIHsKCgkJCWNhc2UgImluc2VydCI6CgkJCWNhc2UgInVwZGF0ZSI6CgkJCWNhc2UgInN0b3JlIjoKCQkJY2FzZSAiZGVsZXRlIjoKCQkJY2FzZSAiZmluZCI6IHsKCQkJCWlmICghYlJhdykgcmV0ID0gbmV3IGxvdHRvLkNvbnRlbnQobnVsbCwgdGhpcy5Ub29sKS5fZnJvbURvY3VtZW50KHJldCk7CgkJCQlicmVhazsKCQkJfQoJCQljYXNlICJmaW5kQWxsIjogewoJCQkJaWYgKHJldCAmJiAhQXJyYXkuaXNBcnJheShyZXQpKSB7CgkJCQkJdGhpcy5sb2codW5kZWZpbmVkLCAnX2ludm9rZU5vZGUnLCAnRW50aXR5T2JqZWN0JywgMSwgIk5vdCBhbiBBcnJheSBpbiBGaW5kQWxsIiwgcmV0KTsKCQkJCQlyZXQgPSBbcmV0XTsKCQkJCX0KCQkJCWlmICghYlJhdyAmJiByZXQubWFwKSByZXQgPSByZXQubWFwKHAgPT4gbmV3IGxvdHRvLkNvbnRlbnQobnVsbCwgdGhpcy5Ub29sKS5fZnJvbURvY3VtZW50KHApKTsKCQkJCWJyZWFrOwoJCQl9CgoJCQlkZWZhdWx0OiB7fQoJCX0KCgkJcmV0dXJuIHJldDsKCX0KCglhc3luYyBfaW52b2tlKG1ldGhvZCwgYm9keSwgcXVlcnksIGF1dGhPYmopIHsKCQl0aGlzLmxvZyh1bmRlZmluZWQsICdfaW52b2tlJywgJ0VudGl0eU9iamVjdCcsIDAsIG1ldGhvZCwgcXVlcnksIGJvZHkpOwoKCQlpZiAodHlwZW9mKGJvZHkpID09PSAnc3RyaW5nJyB8fCAodHlwZW9mKEJ1ZmZlcikgIT09ICd1bmRlZmluZWQnICYmIEJ1ZmZlci5pc0J1ZmZlcihib2R5KSkpIHsKCQkJdHJ5IHsKCQkJCWJvZHkgPSBKU09OLnBhcnNlKGJvZHkudG9TdHJpbmcoKSk7CgkJCX0gY2F0Y2ggKGV4KSB7CgkJCQl0aGlzLmxvZyh1bmRlZmluZWQsICdfaW52b2tlJywgJ0VudGl0eU9iamVjdCcsIDAsICJCb2R5IGlzIG5vdCBhIHZhbGlkIEpTT04iLCBib2R5KTsKCQkJCXJldHVybjsKCQkJfQoJCX0KCgkJbGV0IF9wYXJhbXMgPSBxdWVyeSA/IE9iamVjdC5hc3NpZ24ocXVlcnksIGJvZHkpIDogYm9keTsKCQlpZiAodHlwZW9mKF9wYXJhbXMpID09PSAnc3RyaW5nJykgX3BhcmFtcyA9IEpTT04ucGFyc2UoX3BhcmFtcyk7CgoJCWlmIChfcGFyYW1zKSB7CgkJCV9wYXJhbXMgPSBEb3RPYmplY3Qub2JqZWN0KF9wYXJhbXMpOwoJCX0gZWxzZSB7CgkJCV9wYXJhbXMgPSB7fTsKCQl9CgoJCWlmICh0eXBlb2YoRmxhdHRlZCkgIT09ICJ1bmRlZmluZWQiICYmIF9wYXJhbXMuX19mbGF0dGVkKSBfcGFyYW1zID0gRmxhdHRlZC5wYXJzZShfcGFyYW1zLl9fZmxhdHRlZCk7CgoJCWlmIChfcGFyYW1zLl9fdGhpcykgewoJCQlfcGFyYW1zLl9fdGhpcyA9IERvdE9iamVjdC5vYmplY3QoX3BhcmFtcy5fX3RoaXMpOwoJCQl0aGlzLl9mcm9tRG9jdW1lbnQoX3BhcmFtcy5fX3RoaXMpLl9kZVJlZmVyZW5jZSgpOwoJCX0KCgkJdGhpcy5sb2codW5kZWZpbmVkLCAnX2ludm9rZScsICdFbnRpdHlPYmplY3QnLCAwLCAiX3BhcmFtcyIsIF9wYXJhbXMpOwoKCQlsZXQgYXJBcmdzID0gW107CgkJc3dpdGNoIChtZXRob2QpIHsKCgkJCWNhc2UgImZpbmRBbGwiOiB7CgkJCQlhckFyZ3MucHVzaChfcGFyYW1zLmRlcHRoKTsKCQkJCWFyQXJncy5wdXNoKF9wYXJhbXMub2Jqcyk7CgkJCQlhckFyZ3MucHVzaChfcGFyYW1zLnN0YXJ0KTsKCQkJCWFyQXJncy5wdXNoKF9wYXJhbXMuZW5kKTsKCQkJCWJyZWFrOwoJCQl9CgkJCWNhc2UgImZpbmQiOiB7CgkJCQlhckFyZ3MucHVzaChfcGFyYW1zLmRlcHRoKTsKCQkJCWJyZWFrOwoJCQl9CgoJCQlkZWZhdWx0OiB7CgkJCQlicmVhazsKCQkJfQoJCX0KCgkJbGV0IG9iaiA9IHRoaXM7CgoJCWxldCByZXQgPSBudWxsOwoJCWlmICghb2JqKSB7CgkJCXJldCA9IHsKCQkJCV9fZXhjZXB0aW9uOiB7CgkJCQkJJy0xJzogYENvbnRlbnQuX2ludm9rZTogb2JqIGlzIHVuZGVmaW5lZGAKCQkJCX0KCQkJfTsKCQl9IGVsc2UgaWYgKCFvYmpbbWV0aG9kXSkgewoJCQlyZXQgPSB7CgkJCQlfX2V4Y2VwdGlvbjogewoJCQkJCSctMic6IGBDb250ZW50Ll9pbnZva2U6IG1ldGhvZCAke29iai5jb25zdHJ1Y3Rvci5uYW1lfSgke21ldGhvZH0pIGlzIG5vdCBmb3VuZGAsCgkJCQkJJ29iaic6IG9iagoJCQkJfQoJCQl9OwoJCX0gZWxzZSB7CgkJCXJldCA9IGF3YWl0IG9ialttZXRob2RdKC4uLmFyQXJncyk7CgkJfQoKCQlpZiAodGhpcy5Ub29sLnR5cGUubmFtZSA9PSAiRmlsZVN5c3RlbSIpIHsKCgkJfQoKCQlpZiAodGhpcy5Ub29sLnR5cGUubmFtZSA9PSAiR2l0SHViIikgewoKCQl9CgoJCWlmIChyZXQgJiYgIXJldC5fX2V4Y2VwdGlvbikgewoJCQlsb3R0by5fdW5SZWN1cnNlID0ge307CgkJCWlmIChBcnJheS5pc0FycmF5KHJldCkpIHsKCQkJCXJldCA9IHJldC5tYXAociA9PiB7CgkJCQkJaWYgKHIgJiYgci5fdG9Eb2N1bWVudCkgewoJCQkJCQlpZiAobG90dG8uX3VuUmVjdXJzZS5Db250ZW50KSBkZWxldGUgbG90dG8uX3VuUmVjdXJzZS5Db250ZW50Ll90b0RvY3VtZW50OwoJCQkJCQlyZXR1cm4gci5fdG9Eb2N1bWVudChmYWxzZSwgdHJ1ZSk7CgkJCQkJfSBlbHNlIHJldHVybiByOwoJCQkJfSk7CgkJCX0gZWxzZSB7CgkJCQlyZXQgPSAocmV0ICYmIHJldC5fdG9Eb2N1bWVudCkgPyByZXQuX3RvRG9jdW1lbnQoZmFsc2UsIHRydWUpIDogcmV0OwoJCQl9CgkJfQoKCQl0aGlzLmxvZyh1bmRlZmluZWQsICdfaW52b2tlJywgJ0VudGl0eU9iamVjdCcsIDAsICdyZXQnLCByZXQpOwoJCXRoaXMubG9nKHVuZGVmaW5lZCwgJ19pbnZva2UnLCAnRW50aXR5T2JqZWN0JywgMCwgYCR7bWV0aG9kfTogJHt0aGlzLl9fdGltZSgnbG90dG8uQ29udGVudC4nICsgbWV0aG9kKX1gKTsKCQlyZXR1cm4gcmV0OwoJfQoKCWFzeW5jIF9sb2FkVG9vbHMoYlN0b3JlLCBzb3VyY2UgPSAnQ29udGVudCcpIHsKCgkJaWYgKGxvdHRvLlRvb2xzICYmIGxvdHRvLlRvb2xzLmxlbmd0aCkgewoJCQl0aGlzLmxvZyh1bmRlZmluZWQsICdfbG9hZFRvb2xzJywgJ0VudGl0eU9iamVjdCcsIDAsIGBbJHtzb3VyY2V9XTogVG9vbHMgYWxyZWFkeSBsb2FkZWRgKTsKCQkJcmV0dXJuIGxvdHRvLlRvb2xzOwoJCX0KCgkJdGhpcy5sb2codW5kZWZpbmVkLCAnX2xvYWRUb29scycsICdFbnRpdHlPYmplY3QnLCAwLCBgWyR7c291cmNlfV06IExvYWRpbmcgdG9vbHMuLi5gKTsKCgkJZGVsZXRlIGxvdHRvLl9zdG9yZUVudGl0eUNsYXNzOwoJCWRlbGV0ZSBsb3R0by5fX2NvbmZpZzsKCgkJbGV0IHRvb2xzID0gW3sKCQkJdHlwZTogewoJCQkJbmFtZTogIlNxbERCIiwKCQkJfSwKCQkJdG9vbF9Db25maWdzOiBbewoJCQkJbmFtZTogImNyZWF0ZSIsCgkJCQl2YWx1ZTogMywKCQkJfSwgewoJCQkJbmFtZTogInR5cGUiLAoJCQkJdmFsdWU6ICJzcWxpdGUiLAoJCQl9LCB7CgkJCQluYW1lOiAiU3luY0VudGl0eUF0dHJpYnV0ZXMiLAoJCQkJdmFsdWU6IHRydWUsCgkJCX0sIHsKCQkJCW5hbWU6ICJTeW5jVHlwZWRBdHRyaWJ1dGVzIiwKCQkJCXZhbHVlOiB0cnVlLAoJCQl9XQoJCX1dOwoKCQl0cnkgewoJCQlsZXQgZk5hbWUgPSAiQVBJU0VSVkVSX19sb2FkVG9vbHMuanNvbiI7CgkJCWlmICh0eXBlb2YoZ2xvYmFsKSAhPT0gJ3VuZGVmaW5lZCcgJiYgZnMuZXhpc3RzU3luYyhmTmFtZSkpIHRvb2xzID0gdGhpcy5ydW5TY3JpcHQoYXdhaXQgZnMucHJvbWlzZXMucmVhZEZpbGUoZk5hbWUpKSB8fCB0b29sczsKCQkJaWYgKHRoaXMuX19jb25maWcoImdpdGh1Yi50b29scyIpKSB0b29scyA9IHRoaXMucnVuU2NyaXB0KGF3YWl0IGF4aW9zLmdldCh0aGlzLl9fY29uZmlnKCJnaXRodWIudG9vbHMiKSArIGZOYW1lLCB7CgkJCQl2YWxpZGF0ZVN0YXR1czogc3RhdHVzID0+IHN0YXR1cyA8IDUwMAoJCQl9KS5kYXRhKSB8fCB0b29sczsKCgkJCWxldCB0RGF0YSA9IG51bGw7CgkJCWlmICh0aGlzLnNyKCkpIHREYXRhID0gYXdhaXQgdGhpcy5zcigpLl8oIkNvbnRlbnRNYW5hZ2VyLmNtc1N0b3JlZFNjcmlwdEZpbmQiLCBudWxsLCB7CgkJCQlOYW1lOiBmTmFtZSwKCQkJCUFjdGl2ZTogdHJ1ZSwKCQkJCUVuYWJsZWQ6IHRydWUKCQkJfSk7CgkJCWlmICghdERhdGEpIHsKCQkJCXRoaXMubG9nKHVuZGVmaW5lZCwgJ19sb2FkVG9vbHMnLCAnRW50aXR5T2JqZWN0JywgMCwgYFske3NvdXJjZX1dOiBUb29scyBub3QgaW4gQ01TYCk7CgkJCX0gZWxzZSB7CgkJCQl0b29scyA9IHRoaXMucnVuU2NyaXB0KHREYXRhLlNjcmlwdCkgfHwgdG9vbHM7CgkJCX0KCgkJCXRvb2xzID0gbG90dG8uX19Ub29scyB8fCB0b29sczsKCQkJZGVsZXRlIGxvdHRvLl9fVG9vbHM7CgkJfSBjYXRjaCAoZXgpIHsKCQkJdGhpcy5sb2codW5kZWZpbmVkLCAnX2xvYWRUb29scycsICdFbnRpdHlPYmplY3QnLCAxLCBleCk7CgkJfQoKCQl0b29scy5maWx0ZXIodCA9PiB0eXBlb2YodC5hY3RpdmUpID09PSAidW5kZWZpbmVkIiB8fCAodHlwZW9mKHQuYWN0aXZlKSA9PT0gInVuZGVmaW5lZCIgJiYgdC5hY3RpdmUpKS5mb3JFYWNoKHQgPT4gewoJCQl0Lm5hbWUgPSB0Lm5hbWUgfHwgdC50eXBlLm5hbWU7CgoJCQl0LmFjdGl2ZSA9IHR5cGVvZih0LmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnID8gdC5hY3RpdmUgOiB0cnVlOwoJCQl0LmVuYWJsZWQgPSB0eXBlb2YodC5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcgPyB0LmVuYWJsZWQgOiB0cnVlOwoJCQl0LnR5cGUuYWN0aXZlID0gdHlwZW9mKHQudHlwZS5hY3RpdmUpICE9PSAndW5kZWZpbmVkJyA/IHQudHlwZS5hY3RpdmUgOiB0cnVlOwoJCQl0LnR5cGUuZW5hYmxlZCA9IHR5cGVvZih0LnR5cGUuZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnID8gdC50eXBlLmVuYWJsZWQgOiB0cnVlOwoKCQkJdC50b29sX0NvbmZpZ3MgPSB0LnRvb2xfQ29uZmlncyB8fCBbXTsKCQkJdC50b29sX0NvbmZpZ3MuZm9yRWFjaChjID0+IHsKCQkJCWMuYWN0aXZlID0gdHlwZW9mKGMuYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcgPyBjLmFjdGl2ZSA6IHRydWU7CgkJCQljLmVuYWJsZWQgPSB0eXBlb2YoYy5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcgPyBjLmVuYWJsZWQgOiB0cnVlOwoJCQl9KTsKCgkJCXQudHlwZS50eXBlX0NvbmZpZ3MgPSB0LnR5cGUudHlwZV9Db25maWdzIHx8IFtdOwoJCQl0LnR5cGUudHlwZV9Db25maWdzLmZvckVhY2goYyA9PiB7CgkJCQljLmFjdGl2ZSA9IHR5cGVvZihjLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnID8gYy5hY3RpdmUgOiB0cnVlOwoJCQkJYy5lbmFibGVkID0gdHlwZW9mKGMuZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnID8gYy5lbmFibGVkIDogdHJ1ZTsKCQkJfSk7CgoJCQl0LnR5cGUudHlwZV9NYXBwaW5ncyA9IHQudHlwZS50eXBlX01hcHBpbmdzIHx8IFtdOwoJCQl0LnR5cGUudHlwZV9NYXBwaW5ncy5mb3JFYWNoKG0gPT4gewoJCQkJbS5hY3RpdmUgPSB0eXBlb2YobS5hY3RpdmUpICE9PSAndW5kZWZpbmVkJyA/IG0uYWN0aXZlIDogdHJ1ZTsKCQkJCW0uZW5hYmxlZCA9IHR5cGVvZihtLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJyA/IG0uZW5hYmxlZCA6IHRydWU7CgkJCQltLnR5cGUgPSB7CgkJCQkJbmFtZTogdC50eXBlLm5hbWUKCQkJCX07CgkJCX0pOwoKCQkJdC50b29sX01hcHBpbmdzID0gdC50b29sX01hcHBpbmdzIHx8IFtdOwoJCQl0LnRvb2xfTWFwcGluZ3MuZm9yRWFjaChtID0+IHsKCQkJCW0uYWN0aXZlID0gdHlwZW9mKG0uYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcgPyBtLmFjdGl2ZSA6IHRydWU7CgkJCQltLmVuYWJsZWQgPSB0eXBlb2YobS5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcgPyBtLmVuYWJsZWQgOiB0cnVlOwoJCQkJbS50b29sID0gewoJCQkJCW5hbWU6IHQubmFtZQoJCQkJfTsKCQkJfSk7CgkJfSk7CgkJdG9vbHMgPSB0b29scy5maWx0ZXIodCA9PiBKU09OLnBhcnNlKCgodHlwZW9mKHRoaXMpICE9PSAidW5kZWZpbmVkIiAmJiB0eXBlb2YodGhpcy5fYXRvYikgIT09ICJ1bmRlZmluZWQiKSA/IHRoaXMuX2F0b2IgOiAodHlwZW9mKF9GckVNRCkgIT09ICJ1bmRlZmluZWQiID8gX0ZyRU1ELl9hdG9iIDogYXRvYikpKGBXeUpUY1d4RVFpSXNJa1pwYkdWVGVYTjBaVzBpTENKSGFYUklkV0lpWFE9PWApLCAoa2V5LCB2YWx1ZSkgPT4gewoJCQlpZiAodHlwZW9mKHZhbHVlKSA9PT0gInN0cmluZyIgJiYgdmFsdWUuaW5kZXhPZigiPT4iKSA+IDApIHJldHVybiBldmFsKCIoIiArIHZhbHVlICsgIikiKTsKCQkJcmV0dXJuIHZhbHVlOwoJCX0pLmZpbmQoX3QgPT4gKHR5cGVvZihfdCkgPT09ICdzdHJpbmcnID8gX3QgOiBfdC5uYW1lKSA9PSB0Lm5hbWUpKTsKCgkJdG9vbHMuZm9yRWFjaCh0ID0+IFsndG9vbF9Db25maWdzJywgJ3R5cGUudHlwZV9Db25maWdzJ10uZm9yRWFjaChzQ29uZmlnID0+IHsKCQkJRG90T2JqZWN0LnNldChzQ29uZmlnLCBEb3RPYmplY3QucGljayhzQ29uZmlnLCB0KS5maWx0ZXIoYyA9PiB0eXBlb2YoYy52YWx1ZSkgIT09ICJvYmplY3QiKS5jb25jYXQoRG90T2JqZWN0LnBpY2soc0NvbmZpZywgdCkuZmlsdGVyKGMgPT4gdHlwZW9mKGMudmFsdWUpID09PSAib2JqZWN0IikubWFwKGMgPT4gT2JqZWN0LmtleXMoYy52YWx1ZSkubWFwKG5jb2RlID0+IHsKCQkJCWxldCBfYyA9IHsKCQkJCQluYW1lOiBjLm5hbWUsCgkJCQkJdmFsdWU6IGMudmFsdWVbbmNvZGVdLAoJCQkJfTsKCQkJCWlmIChuY29kZSAhPSAiZGVmYXVsdCIpIHsKCQkJCQlfYy5ub2RlID0gewoJCQkJCQljb2RlOiBuY29kZSwKCQkJCQkJYWN0aXZlOiB0cnVlLAoJCQkJCQllbmFibGVkOiBmYWxzZSwgLy8gb3RoZXJ3aXNlIGl0IHN0YXJ0cyBnZXR0aW5nIGV2ZW50cwoJCQkJCQl0eXBlOiB7CgkJCQkJCQluYW1lOiAiTm9kZUpTIiwKCQkJCQkJfQoJCQkJCX07CgkJCQl9CgkJCQlyZXR1cm4gX2M7CgkJCX0pLmZsYXQoKSkuZmxhdCgpKSwgdCk7CgkJCURvdE9iamVjdC5waWNrKHNDb25maWcsIHQpLmZvckVhY2goYyA9PiBjLnZhbHVlID0gSlNPTi5zdHJpbmdpZnkoYy52YWx1ZSkpOwoJCX0pKTsKCgkJdGhpcy5sb2codW5kZWZpbmVkLCAnX2xvYWRUb29scycsICdFbnRpdHlPYmplY3QnLCAwLCBgWyR7c291cmNlfV06IFRvb2xzIGFyZSAke3Rvb2xzLmxlbmd0aH1gKTsKCgkJbG90dG8uVG9vbHMgPSB0b29sczsKCgkJbG90dG8uVG9vbHMuZmlsdGVyKHQgPT4gIXQuYXhpb3MpLmZvckVhY2godCA9PiB7CgkJCXQuYXhpb3MgPSBheGlvcy5jcmVhdGUoKTsKCQkJdC5heGlvcy5pbnRlcmNlcHRvcnMucmVxdWVzdC51c2UoYXN5bmMgY29uZmlnID0+IHsKCQkJCXRyeSB7CgkJCQkJY29uZmlnLm1ldGEgPSBjb25maWcubWV0YSB8fCB7fTsKCQkJCQljb25maWcubWV0YS5jb3VudGVyID0gNDsKCgkJCQkJbGV0IHRva2VuVXJpID0gdGhpcy5fX2NvbmZpZygib2F1dGgudG9rZW4udXJpIiwgbnVsbCwgewoJCQkJCQl0b29sOiB0CgkJCQkJfSk7CgkJCQkJbGV0IHJlZnJlc2hVcmkgPSB0aGlzLl9fY29uZmlnKCJvYXV0aC5yZWZyZXNoLnVyaSIsIG51bGwsIHsKCQkJCQkJdG9vbDogdAoJCQkJCX0pOwoJCQkJCWxldCBhdXRoVXJpID0gdGhpcy5fX2NvbmZpZygib2F1dGguYXV0aG9yaXplLnVyaSIsIG51bGwsIHsKCQkJCQkJdG9vbDogdAoJCQkJCX0pOwoJCQkJCWxldCB0b2tlbiA9IHRoaXMuX19jb25maWcoIm9hdXRoLmFjY2Vzc190b2tlbiIsIG51bGwsIHsKCQkJCQkJdG9vbDogdCwKCQkJCQkJbm9kZTogbG90dG8uX25vZGUKCQkJCQl9KTsKCQkJCQlpZiAoIWNvbmZpZy5oZWFkZXJzLkF1dGhvcml6YXRpb24gJiYgW3Rva2VuVXJpLCByZWZyZXNoVXJpLCBhdXRoVXJpXS5pbmRleE9mKGNvbmZpZy51cmwpIDwgMCkgewoJCQkJCQlpZiAoIXRva2VuICYmIGxvdHRvLl9ub2RlKSB7CgkJCQkJCQlsZXQgYXV0aENvZGUgPSB0aGlzLl9fY29uZmlnKCdvYXV0aC5hdXRob3JpemUuY29kZScsIG51bGwsIHsKCQkJCQkJCQl0b29sOiB0CgkJCQkJCQl9KTsKCQkJCQkJCWxldCBhdXRoTWV0aG9kID0gdGhpcy5fX2NvbmZpZygnb2F1dGguYXV0aG9yaXplLm1ldGhvZCcsIG51bGwsIHsKCQkJCQkJCQl0b29sOiB0CgkJCQkJCQl9KTsKCgkJCQkJCQlpZiAoYXV0aE1ldGhvZCkgewoJCQkJCQkJCWxldCBmbG93ID0gKCFhdXRoQ29kZSAmJiBhdXRoTWV0aG9kID09ICdwb3N0JykgPyAnYXV0aG9yaXplJyA6ICd0b2tlbic7CgkJCQkJCQkJLy8gZ2V0IHRoZSB0b2tlbgoJCQkJCQkJCS8vIHRoZSB0b2tlblVyaSBtaWdodCBoYXZlIGEgZGVwZW5kZW5jeSBvbiB0aGUgYXV0aG9yaXphdGlvbiBjb2RlCgkJCQkJCQkJdG9rZW5VcmkgPSB0aGlzLl9fY29uZmlnKGBvYXV0aC4ke2Zsb3d9LnVyaWAsIG51bGwsIHsKCQkJCQkJCQkJdG9vbDogdAoJCQkJCQkJCX0pOwoJCQkJCQkJCWxldCB0Y29uZmlnID0gewoJCQkJCQkJCQl1cmw6IHRva2VuVXJpLAoJCQkJCQkJCQltZXRob2Q6IHRoaXMuX19jb25maWcoYG9hdXRoLiR7Zmxvd30ubWV0aG9kYCwgJ3Bvc3QnLCB7CgkJCQkJCQkJCQl0b29sOiB0CgkJCQkJCQkJCX0pLAoJCQkJCQkJCQloZWFkZXJzOiBPYmplY3QuYXNzaWduKHsKCQkJCQkJCQkJCSJDb250ZW50LVR5cGUiOiB0aGlzLl9fY29uZmlnKGBvYXV0aC4ke2Zsb3d9LmNvbnRlbnRfdHlwZWAsICJ0ZXh0L2pzb24iLCB7CgkJCQkJCQkJCQkJdG9vbDogdAoJCQkJCQkJCQkJfSksCgkJCQkJCQkJCQkiQXV0aG9yaXphdGlvbiI6ICJCYXNpYyAiICsgdGhpcy5fYnRvYSh0aGlzLl9fY29uZmlnKCJvYXV0aC5sb2dpbiIsIG51bGwsIHsKCQkJCQkJCQkJCQl0b29sOiB0CgkJCQkJCQkJCQl9KSArICI6IiArIHRoaXMuX19jb25maWcoIm9hdXRoLnBhc3N3b3JkIiwgbnVsbCwgewoJCQkJCQkJCQkJCXRvb2w6IHQKCQkJCQkJCQkJCX0pKSwKCQkJCQkJCQkJfSwgdGhpcy5fX2NvbmZpZyhgb2F1dGguJHtmbG93fS5oZWFkZXJzYCwgInt9IiwgewoJCQkJCQkJCQkJdG9vbDogdAoJCQkJCQkJCQl9KSksCgkJCQkJCQkJCWRhdGE6IHRoaXMuX19jb25maWcoYG9hdXRoLiR7Zmxvd30uYm9keWAsIG51bGwsIHsKCQkJCQkJCQkJCXRvb2w6IHQKCQkJCQkJCQkJfSksCgkJCQkJCQkJfTsKCQkJCQkJCQlsZXQgdHJlcyA9IGF3YWl0IHQuYXhpb3ModGNvbmZpZyk7CgkJCQkJCQkJdGhpcy5sb2codW5kZWZpbmVkLCAnX2xvYWRUb29scycsICdFbnRpdHlPYmplY3QnLCAwLCAiVG9rZW4gZmV0Y2hlZCIsIGZsb3csIHRjb25maWcsIHRyZXMuZGF0YSk7CgkJCQkJCQkJWydhY2Nlc3NfdG9rZW4nLCAndG9rZW5fdHlwZScsICdleHBpcmVzX2luJywgJ3JlZnJlc2hfdG9rZW4nXS5mb3JFYWNoKHRhID0+IHRoaXMuX19jb25maWcoYG9hdXRoLiR7dGF9YCwgbnVsbCwgewoJCQkJCQkJCQl0b29sOiB0LAoJCQkJCQkJCQlub2RlOiBsb3R0by5fbm9kZSwKCQkJCQkJCQkJbmV3VmFsdWU6IHRyZXMuZGF0YVt0aGlzLl9fY29uZmlnKGBvYXV0aC50b2tlbi5yZXNwb25zZS4ke3RhfWAsIHRhLCB7CgkJCQkJCQkJCQl0b29sOiB0CgkJCQkJCQkJCX0pXQoJCQkJCQkJCX0pKTsKCQkJCQkJCQl0b2tlbiA9IHRoaXMuX19jb25maWcoIm9hdXRoLmFjY2Vzc190b2tlbiIsIG51bGwsIHsKCQkJCQkJCQkJdG9vbDogdCwKCQkJCQkJCQkJbm9kZTogbG90dG8uX25vZGUKCQkJCQkJCQl9KTsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCQlpZiAodG9rZW4pIGNvbmZpZy5oZWFkZXJzLkF1dGhvcml6YXRpb24gPSB0aGlzLl9fY29uZmlnKCJvYXV0aC50b2tlbl90eXBlIiwgIkJlYXJlciIsIHsKCQkJCQkJCXRvb2w6IHQKCQkJCQkJfSkgKyAiICIgKyB0b2tlbjsKCQkJCQl9CgkJCQl9IGNhdGNoIChleCkgewoJCQkJCXRoaXMubG9nKHVuZGVmaW5lZCwgJ19sb2FkVG9vbHMnLCAnRW50aXR5T2JqZWN0JywgMiwgImF4aW9zLnJlcXVlc3QiLCBleCk7CgkJCQl9CgkJCQlyZXR1cm4gY29uZmlnOwoJCQl9LCBhc3luYyBlcnJvciA9PiB7fSk7CgkJCXQuYXhpb3MuaW50ZXJjZXB0b3JzLnJlc3BvbnNlLnVzZShyZXNwb25zZSA9PiB7CgkJCQlyZXR1cm4gcmVzcG9uc2U7CgkJCX0sIGFzeW5jIGVycm9yID0+IHsKCQkJCXRoaXMubG9nKHVuZGVmaW5lZCwgJ19sb2FkVG9vbHMnLCAnRW50aXR5T2JqZWN0JywgMCwgImF4aW9zIHJlc3BvbnNlIGVycm9yIiwgZXJyb3IpOwoJCQkJdHJ5IHsKCQkJCQljb25zdCBvcmlnaW5hbFJlcXVlc3QgPSBlcnJvci5jb25maWc7CgkJCQkJaWYgKHRoaXMuX19jb25maWcoIm9hdXRoLmFjY2Vzc190b2tlbiIsIG51bGwsIHsKCQkJCQkJCXRvb2w6IHQKCQkJCQkJfSkgJiYgZXJyb3IucmVzcG9uc2UgJiYgZXJyb3IucmVzcG9uc2Uuc3RhdHVzID09PSA0MDEgJiYgIW9yaWdpbmFsUmVxdWVzdC5fcmV0cnkgJiYgb3JpZ2luYWxSZXF1ZXN0LmhlYWRlcnMuQXV0aG9yaXphdGlvbi5pbmRleE9mKHRoaXMuX19jb25maWcoIm9hdXRoLmFjY2Vzc190b2tlbiIsIG51bGwsIHsKCQkJCQkJCXRvb2w6IHQKCQkJCQkJfSkpID4gMCkgewoJCQkJCQlvcmlnaW5hbFJlcXVlc3QuX3JldHJ5ID0gdHJ1ZTsKCQkJCQkJLy8gYXdhaXQgKGdldCB0aGUgdG9rZW4gb3IgcmVmcmVzaCBpdCkKCgkJCQkJCW9yaWdpbmFsUmVxdWVzdC5oZWFkZXJzLkF1dGhvcml6YXRpb24gPSB0aGlzLl9fY29uZmlnKCJvYXV0aC5hY2Nlc3NfdHlwZSIsICJCZWFyZXIiLCB7CgkJCQkJCQl0b29sOiB0CgkJCQkJCX0pICsgIiAiICsgdGhpcy5fX2NvbmZpZygib2F1dGguYWNjZXNzX3Rva2VuIiwgbnVsbCwgewoJCQkJCQkJdG9vbDogdAoJCQkJCQl9KTsKCQkJCQkJcmV0dXJuIHQuYXhpb3Mob3JpZ2luYWxSZXF1ZXN0KTsKCQkJCQl9CgkJCQkJcmV0dXJuIFByb21pc2UucmVqZWN0KGVycm9yKTsKCQkJCX0gY2F0Y2ggKGV4KSB7CgkJCQkJdGhpcy5sb2codW5kZWZpbmVkLCAnX2xvYWRUb29scycsICdFbnRpdHlPYmplY3QnLCAyLCAiUmVzcCBJbnRlcmNlcHRvciIsIGV4LCBlcnJvcik7CgkJCQl9CgkJCX0pOwoJCX0pOwoKCQl0aGlzLmxvZyh1bmRlZmluZWQsICdfbG9hZFRvb2xzJywgJ0VudGl0eU9iamVjdCcsIDAsICJFeGl0aW5nIik7CgkJcmV0dXJuIHRvb2xzOwoKCX0KCglfcGFyYW1ldHJpemUoc3RyLCBmdW4sIHByZWZpeCA9ICd7eycsIHBvc3RmaXggPSAnfX0nKSB7CgoJCXRyeSB7CgkJCWlmICh0eXBlb2Yoc3RyKSAhPT0gJ3N0cmluZycpIHJldHVybiBzdHI7CgkJCWxldCByZXggPSBgJHtwcmVmaXh9KFteJHtwb3N0Zml4fV0rKSR7cG9zdGZpeH1gOwoJCQkoc3RyLm1hdGNoKG5ldyBSZWdFeHAocmV4LCAiZyIpKSB8fCBbXSkuZm9yRWFjaChtID0+IHN0ciA9IHN0ci5yZXBsYWNlKG0sIG0gPT4gZnVuKG0ucmVwbGFjZShwcmVmaXgsICcnKS5yZXBsYWNlKHBvc3RmaXgsICcnKSkpKTsKCgkJCXJldHVybiBzdHI7CgkJfSBjYXRjaCAoZXgpIHsKCQkJdGhpcy5sb2codW5kZWZpbmVkLCAnX3BhcmFtZXRyaXplJywgJ0VudGl0eU9iamVjdCcsIDIsIGV4KTsKCQl9CgoJfQoKCV9fc3luY19vbihkKSB7CgkJdGhpcy5fX19zeW5jX29uID0gdGhpcy5fX19zeW5jX29uIHx8IHt9OwoKCQlpZiAoZCkgewoJCQl0aGlzLl9fX3N5bmNfb25bdGhpcy5Ub29sLm5hbWVdID0gZDsKCgkJCXJldHVybiB0aGlzOwoJCX0KCgkJcmV0dXJuIHRoaXMuX19fc3luY19vblt0aGlzLlRvb2wubmFtZV07Cgl9CgoJX2Nsb25lKCkgewoJCXJldHVybiBuZXcgbG90dG8uQ29udGVudCh0aGlzLklkKQoKCQkJLmFjdGl2ZSh0aGlzLmFjdGl2ZSgpLCB0aGlzLl9hY3RpdmVfY29vcCkKCgkJCS5lbmFibGVkKHRoaXMuZW5hYmxlZCgpLCB0aGlzLl9lbmFibGVkX2Nvb3ApCgoJCQkuY29kZSh0aGlzLmNvZGUoKSwgdGhpcy5fY29kZV9jb29wKQoKCQkJLm9yZGVyKHRoaXMub3JkZXIoKSwgdGhpcy5fb3JkZXJfY29vcCkKCgkJCS5kYXRlKHRoaXMuZGF0ZSgpLCB0aGlzLl9kYXRlX2Nvb3ApCgoJCQkubmFtZSh0aGlzLm5hbWUoKSwgdGhpcy5fbmFtZV9jb29wKQoKCQkJLnJlbWFyayh0aGlzLnJlbWFyaygpLCB0aGlzLl9yZW1hcmtfY29vcCkKCgkJCS5jb250ZW50KHRoaXMuY29udGVudCgpLCB0aGlzLl9jb250ZW50X2Nvb3ApCgoJfQoKCV9tYXAoY29kZSwgYlJldmVyc2UsIGNvbnRleHQsIG9iakZyb20sIG9ialRvLCBjbGFzc05hbWUsIHRvb2wsIGNvZGVUeXBlKSB7CgkJY29udGV4dCA9IGNvbnRleHQgfHwgJ0VudGl0eUF0dHJpYnV0ZSc7CgkJLy9vYmpGcm9tID0gb2JqRnJvbSB8fCB0aGlzLl90b0RvY3VtZW50KCk7CgkJLy9vYmpUbyA9IG9ialRvIHx8IHt9OwoJCWNsYXNzTmFtZSA9IGNsYXNzTmFtZSB8fCAnQ29udGVudCc7CgkJdG9vbCA9IHRvb2wgfHwgdGhpcy5Ub29sOwoJCWNvZGVUeXBlID0gY29kZVR5cGUgfHwgSlNPTi5wYXJzZSgoKHR5cGVvZih0aGlzKSAhPT0gInVuZGVmaW5lZCIgJiYgdHlwZW9mKHRoaXMuX2F0b2IpICE9PSAidW5kZWZpbmVkIikgPyB0aGlzLl9hdG9iIDogKHR5cGVvZihfRnJFTUQpICE9PSAidW5kZWZpbmVkIiA/IF9GckVNRC5fYXRvYiA6IGF0b2IpKShgZTMwPWApLCAoa2V5LCB2YWx1ZSkgPT4gewoJCQlpZiAodHlwZW9mKHZhbHVlKSA9PT0gInN0cmluZyIgJiYgdmFsdWUuaW5kZXhPZigiPT4iKSA+IDApIHJldHVybiBldmFsKCIoIiArIHZhbHVlICsgIikiKTsKCQkJcmV0dXJuIHZhbHVlOwoJCX0pW2NvZGVdOwoKCQl0cnkgewoJCQlpZiAoQXJyYXkuaXNBcnJheShvYmpGcm9tKSkgcmV0dXJuIG9iakZyb20ubWFwKG8gPT4gdGhpcy5fbWFwKGNvZGUsIGJSZXZlcnNlLCBjb250ZXh0LCBvLCBvYmpUbywgY2xhc3NOYW1lLCB0b29sLCBjb2RlVHlwZSkpOwoKCQkJbGV0IHNGaWVsZCA9IGJSZXZlcnNlID8gJ3RhcmdldCcgOiAnc291cmNlJzsKCQkJbGV0IHNTY3JpcHQgPSAoYlJldmVyc2UgPyAnb3V0JyA6ICdpbicpICsgJ1NjcmlwdCc7CgkJCWxldCBzQ29uZCA9IChiUmV2ZXJzZSA/ICdvdXQnIDogJ2luJykgKyAnQ29uZGl0aW9uJzsKCQkJbGV0IHRGaWVsZCA9IGJSZXZlcnNlID8gJ3NvdXJjZScgOiAndGFyZ2V0JzsKCQkJbGV0IHRTY3JpcHQgPSAoYlJldmVyc2UgPyAnaW4nIDogJ291dCcpICsgJ1NjcmlwdCc7CgkJCWxldCB0Q29uZCA9IChiUmV2ZXJzZSA/ICdpbicgOiAnb3V0JykgKyAnQ29uZGl0aW9uJzsKCgkJCWxldCBfbWF0Y2ggPSAocywgcikgPT4gewoJCQkJbGV0IGFuc3dlciA9IHMubWF0Y2gobmV3IFJlZ0V4cChyLCAnZycpKTsKCQkJCXJldHVybiBzID09IHIgfHwgKChhbnN3ZXIgJiYgYW5zd2VyLmxlbmd0aCkgPyB0cnVlIDogZmFsc2UpOwoJCQl9CgoJCQlsZXQgdGVzdCA9IG0gPT4gKHsKCQkJCXZhbGlkOiBtLmFjdGl2ZSAmJiBtLmVuYWJsZWQsCgkJCQljb250ZXh0OiBfbWF0Y2goY29udGV4dCwgbS5jb250ZXh0KSwKCQkJCWNsYXNzOiBfbWF0Y2goY2xhc3NOYW1lLCBtLmNsYXNzTmFtZSksCgkJCQlzRmllbGQ6IHR5cGVvZihjb2RlKSA9PT0gJ3VuZGVmaW5lZCcgfHwgX21hdGNoKGNvZGUsIG1bc0ZpZWxkXSksCgkJCQlzU2NyaXB0OiB0eXBlb2YoY29kZSkgPT09ICd1bmRlZmluZWQnIHx8IHR5cGVvZihtW3NTY3JpcHRdKSAhPT0gJ3VuZGVmaW5lZCcsCgkJCQl0YXJnZXQ6IChtW3RGaWVsZF0gfHwgbVt0U2NyaXB0XSkgIT0gbnVsbCwKCQkJCXRleHQ6IGNvZGUgKyAnLCcgKyBzRmllbGQgKyAnLCcgKyB0RmllbGQsCgkJCX0pOwoKCQkJbGV0IG1zID0gKHRvb2wudG9vbF9NYXBwaW5ncyB8fCBbXSkuY29uY2F0KHRvb2wudHlwZS50eXBlX01hcHBpbmdzIHx8IFtdKTsKCgkJCW1zID0gbXMuZmlsdGVyKG0gPT4gdGVzdChtKS52YWxpZCAmJiB0ZXN0KG0pLmNvbnRleHQgJiYgdGVzdChtKS5jbGFzcyAmJiAodGVzdChtKS5zRmllbGQgfHwgdGVzdChtKS5zU2NyaXB0KSAmJiB0ZXN0KG0pLnRhcmdldCkuc29ydChtID0+IC1tLm9yZGVyKTsKCQkJaWYgKG1zLmxlbmd0aCkgdGhpcy5sb2codW5kZWZpbmVkLCAnX21hcCcsICdFbnRpdHlPYmplY3QnLCAwLCBgJHtjbGFzc05hbWV9LiR7Y29kZX1gLCB0aGlzLl9iZWF1dGlmeShtcy5tYXAobSA9PiAoewoJCQkJbSwKCQkJCXRlc3Q6IHRlc3QobSkKCQkJfSkpLCAnamF2YXNjcmlwdCcpKTsKCgkJCW1zLmZpbHRlcihtID0+IG1bc0ZpZWxkXSAmJiBtW3RGaWVsZF0pLmZvckVhY2gobSA9PiB7CgkJCQlpZiAobS5jb250ZXh0ID09ICdFbnRpdHlDbGFzcycpIHt9IGVsc2UgaWYgKHR5cGVvZihtW3RGaWVsZF0pID09PSAnZnVuY3Rpb24nKSB7CgkJCQkJLy8gcmVwbGFjZQoJCQkJCWlmICh0eXBlb2YoY29kZSkgIT09ICd1bmRlZmluZWQnKSB7CgkJCQkJCWNvZGUgPSBjb2RlLnJlcGxhY2UobmV3IFJlZ0V4cChtW3NGaWVsZF0sICdnJyksIG1bdEZpZWxkXSk7CgkJCQkJfSBlbHNlIHsKCQkJCQkJLy9Eb3RPYmplY3QuY29weShtW3NGaWVsZF0sIG1bdEZpZWxkXSwgb2JqRnJvbSwgb2JqVG8pOwoJCQkJCX0KCQkJCX0gZWxzZSB7CgkJCQkJaWYgKHR5cGVvZihjb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHsKCQkJCQkJY29kZSA9IG1bdEZpZWxkXTsKCQkJCQl9IGVsc2UgewoJCQkJCQlEb3RPYmplY3QuY29weShtW3NGaWVsZF0sIG1bdEZpZWxkXSwgb2JqRnJvbSwgb2JqVG8pOwoJCQkJCX0KCQkJCX0KCQkJCXRoaXMubG9nKHVuZGVmaW5lZCwgJ19tYXAnLCAnRW50aXR5T2JqZWN0JywgMCwgYFske2NvbnRleHR9XS8ke2NsYXNzTmFtZX0uJHtjb2RlfTogJHttW3NGaWVsZF19ID0+ICR7bVt0RmllbGRdfWApOwoJCQl9KTsKCQkJbXMuZm9yRWFjaChtID0+IHsKCgkJCQlpZiAobVt0U2NyaXB0XSkgewoJCQkJCXRoaXMubG9nKHVuZGVmaW5lZCwgJ19tYXAnLCAnRW50aXR5T2JqZWN0JywgMCwgYFske20uY29udGV4dH1dLyR7bS5jbGFzc05hbWV9LiR7Y29kZX0oJHt0U2NyaXB0fSk6ICR7bVt0U2NyaXB0XX1gLCBtKTsKCQkJCQl0aGlzLl9TY3JpcHQoYGFzeW5jIChsb2csIHdhcm4sIGVycm9yLCBzY29wZSwgbWV0aG9kLCBtLCBvYmpGcm9tLCBvYmpUbywgY29kZSwgX3RoaXMsIGNsYXNzTmFtZSwgdG9vbCwgY29kZVR5cGUpID0+IHtpZigKKChvU2NvcGUpID0+IHsKICAgIGxldCByZXQgPSAke21bdENvbmRdfTsKICAgIGlmKHR5cGVvZihyZXQpPT09ImZ1bmN0aW9uIil7CiAgICAgICAgcmV0ID0gcmV0KG9TY29wZSk7CiAgICB9CiAgICByZXR1cm4gcmV0Owp9KShsb3R0bykKKXske21bdFNjcmlwdF19fX1gLCB0U2NyaXB0LCAnTWFwcGluZycsIGxvdHRvLCBtLCBvYmpGcm9tLCBvYmpUbywgY29kZSwgdGhpcywgY2xhc3NOYW1lLCB0b29sLCBjb2RlVHlwZSk7CgkJCQl9CgoJCQl9KTsKCgkJCWlmICh0eXBlb2YoY29kZSkgPT09ICd1bmRlZmluZWQnKSB7CgkJCQlyZXR1cm4gb2JqVG87CgkJCX0KCgkJCXJldHVybiBjb2RlOwoJCX0gY2F0Y2ggKGV4KSB7CgkJCXRoaXMubG9nKHVuZGVmaW5lZCwgJ19tYXAnLCAnRW50aXR5T2JqZWN0JywgMiwgZXgpOwoJCX0KCgl9CgoJX25Db2RlKGNvZGUsIG9Db2RlKSB7CgkJdHJ5IHsKCQkJbGV0IGNvbnRleHQgPSAnRW50aXR5QXR0cmlidXRlJzsKCQkJaWYgKCFjb2RlICYmICFvQ29kZSkgewoJCQkJY29udGV4dCA9ICdFbnRpdHlDbGFzcyc7CgkJCQljb2RlID0gIkNvbnRlbnQiOwoJCQkJaWYgKHRoaXMuVG9vbC50eXBlLm5hbWUgPT0gIlNlcnZpY2VOb3ciICYmIHRoaXMuX19jb25maWcoJ3Njb3BlJykpIHsKCQkJCQljb2RlID0gdGhpcy5fX2NvbmZpZygnc2NvcGUnKSArICJfc3RfIiArIGNvZGU7CgkJCQl9CgkJCQlvQ29kZSA9IHVuZGVmaW5lZDsKCQkJfQoJCQlsZXQgcmV0ID0gY29kZTsKCQkJaWYgKG9Db2RlICYmIHR5cGVvZihvQ29kZSkgPT09ICdvYmplY3QnKSB7CgkJCQlyZXQgPSBvQ29kZVt0aGlzLlRvb2wubmFtZV0gfHwgcmV0OwoJCQl9CgoJCQlyZXQgPSB0aGlzLl9tYXAoY29kZSwgZmFsc2UsIGNvbnRleHQpIHx8IHJldDsKCQkJcmV0dXJuIHJldDsKCQl9IGNhdGNoIChleCkgewoJCQl0aGlzLmxvZyh1bmRlZmluZWQsICdfbkNvZGUnLCAnRW50aXR5T2JqZWN0JywgMSwgZXgpOwoJCQlyZXR1cm4gY29kZTsKCQl9Cgl9CgoJX19jb25maWcobiwgbnVsbFZhbHVlLCBvcHRpb25zKSB7CgoJCXRyeSB7CgkJCW9wdGlvbnMgPSBvcHRpb25zIHx8IHt9OwoJCQlvcHRpb25zLl90aGlzID0gb3B0aW9ucy5fdGhpcyB8fCB0aGlzOwoJCQlvcHRpb25zLl9jbGFzcyA9IG9wdGlvbnMuX2NsYXNzIHx8ICdDb250ZW50JzsKCQkJb3B0aW9ucy50b29sID0gb3B0aW9ucy50b29sIHx8IG9wdGlvbnMuX3RoaXMuVG9vbCB8fCB0aGlzLlRvb2w7CgkJCWlmICh0eXBlb2Yob3B0aW9ucy50b29sKSA9PT0gJ29iamVjdCcgJiYgb3B0aW9ucy50b29sLmNvbnN0cnVjdG9yLm5hbWUgPT0gJ1Rvb2wnKSBvcHRpb25zLnRvb2wgPSAobG90dG8uVG9vbHMgfHwgW10pLmZpbmQodCA9PiB0Lm5hbWUgPT0gb3B0aW9ucy50b29sLm5hbWUoKSk7CgoJCQlpZiAodHlwZW9mKG9wdGlvbnMudG9vbCkgPT09ICdzdHJpbmcnKSBvcHRpb25zLnRvb2wgPSAobG90dG8uVG9vbHMgfHwgW10pLmZpbmQodCA9PiB0Lm5hbWUgPT0gb3B0aW9ucy50b29sIHx8IHQudHlwZS5uYW1lID09IG9wdGlvbnMudG9vbCk7CgkJCWlmICh0eXBlb2Yob3B0aW9ucy50b29sKSAhPT0gJ29iamVjdCcpIHRoaXMubG9nKHVuZGVmaW5lZCwgJ19fY29uZmlnJywgJ0VudGl0eU9iamVjdCcsIDEsIG9wdGlvbnMudG9vbCk7CgkJCWlmICghb3B0aW9ucy50b29sKSB0aGlzLmxvZyh1bmRlZmluZWQsICdfX2NvbmZpZycsICdFbnRpdHlPYmplY3QnLCAxLCAidG9vbCBub3QgZGVmaW5lZCIsIG9wdGlvbnMuX3RoaXMuVG9vbCwgbG90dG8uVG9vbHMsIG9wdGlvbnMuX3RoaXMuVG9vbHMpOwoJCQkvL29wdGlvbnMubm9DYWNoZSA9IHRydWU7CgkJCWlmICghb3B0aW9ucy5ub0NhY2hlKSBsb3R0by5fX2NvbmZpZyA9IGxvdHRvLl9fY29uZmlnIHx8IHt9OwoKCQkJbGV0IG5JRCA9IGxvdHRvLl9ub2RlID8gbG90dG8uX25vZGUuY29kZSgpIDogbnVsbDsKCgkJCWlmIChuICE9PSAnbm9kZS5jb2RlJykgewoJCQkJbklEID0gdGhpcy5fX2NvbmZpZygnbm9kZS5jb2RlJywgJ2RlZmF1bHQnLCBvcHRpb25zKTsKCQkJfQoKCQkJbGV0IHJldCA9IG51bGxWYWx1ZTsKCQkJaWYgKHR5cGVvZihyZXQpID09PSAndW5kZWZpbmVkJykgewoJCQkJcmV0ID0gbnVsbDsKCgkJCQkvLyB1c2Ugc2NvcGUgY2FjaGUgKGltcHJvdmVzIHBlcmZvcm1hbmNlKQoJCQkJaWYgKCFvcHRpb25zLm5vQ2FjaGUgJiYgbG90dG8uX19jb25maWcuaGFzT3duUHJvcGVydHkoYCR7b3B0aW9ucy5fY2xhc3N9LiR7b3B0aW9ucy50b29sLm5hbWV9LiR7bklEfS4ke259YCkpIHJldHVybiBsb3R0by5fX2NvbmZpZ1tgJHtvcHRpb25zLl9jbGFzc30uJHtvcHRpb25zLnRvb2wubmFtZX0uJHtuSUR9LiR7bn1gXTsKCQkJfQoKCQkJLy8gdG9vbF9Db25maWdzLCB0eXBlX0NvbmZpZ3M6IGFsbG93IGNsYXNzLWxldmVsIGFuZCBub2RlLWxldmVsIC0gZG9uZQoJCQlpZiAob3B0aW9ucy50b29sLnR5cGUudHlwZV9Db25maWdzIHx8IG9wdGlvbnMudG9vbC50b29sX0NvbmZpZ3MpIHsKCQkJCWxldCBjZnMgPSBbXS5jb25jYXQob3B0aW9ucy50b29sLnR5cGUudHlwZV9Db25maWdzLCBvcHRpb25zLnRvb2wudG9vbF9Db25maWdzKTsKCQkJCWxldCB0Y29uZiA9IGNmcy5maWx0ZXIoYyA9PiBjICYmIGMubmFtZSA9PSBuICYmIGMubm9kZSAmJiBjLm5vZGUuY29kZSA9PSBuSUQpLmNvbmNhdChjZnMuZmlsdGVyKGMgPT4gYyAmJiBjLm5hbWUgPT0gbiAmJiAhYy5ub2RlKSk7CgkJCQlpZiAodGNvbmYubGVuZ3RoKSB7CgkJCQkJaWYgKHRjb25mWzBdLnNjcmlwdCkgewoJCQkJCQlyZXQgPSB0aGlzLnJ1blNjcmlwdChgKCR7T2JqZWN0LmtleXMob3B0aW9ucykuam9pbignLCAnKX0pID0+ICR7dGNvbmZbMF0uc2NyaXB0fWApKC4uLk9iamVjdC52YWx1ZXMob3B0aW9ucykpOwoJCQkJCX0gZWxzZSB7CgkJCQkJCXJldCA9IHRjb25mWzBdLnZhbHVlOwoJCQkJCQl0cnkgewoJCQkJCQkJWzEsIDIsIDNdLmZvckVhY2goYSA9PiByZXQgPSBKU09OLnBhcnNlKHJldCkpOwoJCQkJCQl9IGNhdGNoIChqZXgpIHt9CgkJCQkJfQoJCQkJfQoJCQkJaWYgKG9wdGlvbnMubmV3VmFsdWUpIHsKCQkJCQlsZXQgdGMgPSB0Y29uZi5sZW5ndGggPyB0Y29uZlswXSA6IHt9OwoJCQkJCWlmIChvcHRpb25zLm5vZGUpIHRjLm5vZGUgPSB7CgkJCQkJCWNvZGU6IG9wdGlvbnMubm9kZS5jb2RlKCkKCQkJCQl9OwoJCQkJCXRjLnZhbHVlID0gb3B0aW9ucy5uZXdWYWx1ZTsKCQkJCQl0Yy5uYW1lID0gbjsKCQkJCQlpZiAoIXRjb25mLmxlbmd0aCkgewoJCQkJCQkob3B0aW9ucy50b29sLnRvb2xfQ29uZmlncyB8fCBvcHRpb25zLnRvb2wudHlwZS50eXBlX0NvbmZpZ3MpLnB1c2godGMpOwoJCQkJCX0KCQkJCQlyZXQgPSBvcHRpb25zLm5ld1ZhbHVlOwoJCQkJfQoJCQl9CgoJCQkvLyBtb2RlbCBDb25maWc6IENvbmZpZyBpcyBjbGFzcyBsZXZlbCwgbm9kZSBub3QgcG9zc2libGUgLSBwZW5kaW5nCgkJCWxldCBtY29uZiA9IG9wdGlvbnMuX3RoaXMuQ29uZmlnID8gb3B0aW9ucy5fdGhpcy5Db25maWdbbl0gOiB1bmRlZmluZWQ7CgkJCWlmICh0eXBlb2YobWNvbmYpICE9PSAidW5kZWZpbmVkIikgcmV0ID0gbWNvbmY7CgoJCQkvLyBjb21tYW5kIGxpbmU6IGFsbG93IGNsYXNzLWxldmVsIGFuZCBub2RlLWxldmVsIC0gcGVuZGluZwoJCQlpZiAodHlwZW9mKGdsb2JhbCkgIT09ICd1bmRlZmluZWQnICYmIGdsb2JhbC5taW5pbWlzdCkgewoJCQkJcmV0ID0gZ2xvYmFsLm1pbmltaXN0KHByb2Nlc3MuYXJndi5zbGljZSgyKSlbbl0gfHwgcmV0OwoJCQl9CgoJCQkvLyByZXF1ZXN0OiBhbGxvdyBjbGFzcy1sZXZlbCBhbmQgbm9kZS1sZXZlbCAtIHBlbmRpbmcKCQkJcmV0ID0gdGhpcy4kX1JFUVVFU1QobikgfHwgcmV0OwoKCQkJLy8gY29uZmlnIHJlcGxhY2VtZW50CgkJCXJldCA9IHRoaXMuX3BhcmFtZXRyaXplKHJldCwgcCA9PiB0aGlzLl9fY29uZmlnKHAsIG51bGwsIG9wdGlvbnMpKTsKCgkJCS8vdGhpcy5sb2codW5kZWZpbmVkLCAnX19jb25maWcnLCAnRW50aXR5T2JqZWN0JywgMCwgbiwgcmV0LCBvcHRpb25zKTsKCQkJaWYgKCFvcHRpb25zLm5vQ2FjaGUpIGxvdHRvLl9fY29uZmlnW2Ake29wdGlvbnMuX2NsYXNzfS4ke29wdGlvbnMudG9vbC5uYW1lfS4ke25JRH0uJHtufWBdID0gcmV0OwoJCQlyZXR1cm4gcmV0OwoJCX0gY2F0Y2ggKGV4KSB7CgkJCXRoaXMubG9nKHVuZGVmaW5lZCwgJ19fY29uZmlnJywgJ0VudGl0eU9iamVjdCcsIDEsIG4sIG51bGxWYWx1ZSwgb3B0aW9ucy5fY2xhc3MsIG9wdGlvbnMudG9vbC50b29sX0NvbmZpZ3MsIGV4KTsKCQl9CgoJfQoKCV90b1NRTFRhYmxlKCkgewoJCWxldCByZXQgPSB7CgkJCXNxbDogYENSRUFURSBUQUJMRSBJRiBOT1QgRVhJU1RTICR7dGhpcy5fUSgpfSR7dGhpcy5fbkNvZGUoKX0ke3RoaXMuX1EoKX0gKAogICAgICAgICR7dGhpcy5fUSgpfSR7dGhpcy5fX2NvbmZpZygnaWRGaWVsZCcsICdfX2lkJyl9JHt0aGlzLl9RKCl9IENIQVIoMjUpIFBSSU1BUlkgS0VZCiAgICAKICAgICAgICAsJHt0aGlzLl9RKCl9JHt0aGlzLl9uQ29kZSgnYWN0aXZlJywgdW5kZWZpbmVkKX0ke3RoaXMuX1EoKX0gJHt0aGlzLl9zcWxUeXBlKCJCb29sIiwgdGhpcy5fX2NvbmZpZygndHlwZScpKX0KICAgIAogICAgICAgICwke3RoaXMuX1EoKX0ke3RoaXMuX25Db2RlKCdlbmFibGVkJywgdW5kZWZpbmVkKX0ke3RoaXMuX1EoKX0gJHt0aGlzLl9zcWxUeXBlKCJCb29sIiwgdGhpcy5fX2NvbmZpZygndHlwZScpKX0KICAgIAogICAgICAgICwke3RoaXMuX1EoKX0ke3RoaXMuX25Db2RlKCdjb2RlJywgdW5kZWZpbmVkKX0ke3RoaXMuX1EoKX0gJHt0aGlzLl9zcWxUeXBlKCJTdHJpbmciLCB0aGlzLl9fY29uZmlnKCd0eXBlJykpfQogICAgCiAgICAgICAgLCR7dGhpcy5fUSgpfSR7dGhpcy5fbkNvZGUoJ29yZGVyJywgdW5kZWZpbmVkKX0ke3RoaXMuX1EoKX0gJHt0aGlzLl9zcWxUeXBlKCJJbnQiLCB0aGlzLl9fY29uZmlnKCd0eXBlJykpfQogICAgCiAgICAgICAgLCR7dGhpcy5fUSgpfSR7dGhpcy5fbkNvZGUoJ2RhdGUnLCB1bmRlZmluZWQpfSR7dGhpcy5fUSgpfSAke3RoaXMuX3NxbFR5cGUoIkRhdGUiLCB0aGlzLl9fY29uZmlnKCd0eXBlJykpfQogICAgCiAgICAgICAgLCR7dGhpcy5fUSgpfSR7dGhpcy5fbkNvZGUoJ25hbWUnLCB1bmRlZmluZWQpfSR7dGhpcy5fUSgpfSAke3RoaXMuX3NxbFR5cGUoIlN0cmluZyIsIHRoaXMuX19jb25maWcoJ3R5cGUnKSl9CiAgICAKICAgICAgICAsJHt0aGlzLl9RKCl9JHt0aGlzLl9uQ29kZSgncmVtYXJrJywgdW5kZWZpbmVkKX0ke3RoaXMuX1EoKX0gJHt0aGlzLl9zcWxUeXBlKCJUZXh0IiwgdGhpcy5fX2NvbmZpZygndHlwZScpKX0KICAgIAogICAgICAgICwke3RoaXMuX1EoKX0ke3RoaXMuX25Db2RlKCdjb250ZW50JywgdW5kZWZpbmVkKX0ke3RoaXMuX1EoKX0gJHt0aGlzLl9zcWxUeXBlKCJUZXh0IiwgdGhpcy5fX2NvbmZpZygndHlwZScpKX0KICAgIAogICAgICAgIGAKCQl9OwoJCXJldC5zcWwgKz0gJy8qQ29udGVudCovKTtcbic7CgoJCXJldCA9IHRoaXMuX19leHBvcnQocmV0LCB7CgkJCUZ1bGw6IHRydWUsCgkJCU51bGw6IHRydWUsCgkJCS8vSWQ6IChvYmosIHYpID0+IG9iai5zcWwgKz0gYCR7dGhpcy5fUSgpfSR7dGhpcy5fX2NvbmZpZygnaWRGaWVsZCcsICdfX2lkJyl9JHt0aGlzLl9RKCl9IENIQVIoMjUpIFBSSU1BUlkgS0VZYCwKCgkJCSJhY3RpdmUiOiAob2JqLCB2LCBlYUNvZGUgPSB0aGlzLl9uQ29kZSgnYWN0aXZlJywgdW5kZWZpbmVkKSkgPT4gewoJCQkJLy8gb2JqLnNxbCArPSBgLCR7dGhpcy5fUSgpfSR7dGhpcy5fbkNvZGUoJ2FjdGl2ZScsIHVuZGVmaW5lZCl9JHt0aGlzLl9RKCl9ICR7dGhpcy5fc3FsVHlwZSgiQm9vbCIsIHRoaXMuX19jb25maWcoJ3R5cGUnKSl9YDsKCgkJCX0sCgoJCQkiZW5hYmxlZCI6IChvYmosIHYsIGVhQ29kZSA9IHRoaXMuX25Db2RlKCdlbmFibGVkJywgdW5kZWZpbmVkKSkgPT4gewoJCQkJLy8gb2JqLnNxbCArPSBgLCR7dGhpcy5fUSgpfSR7dGhpcy5fbkNvZGUoJ2VuYWJsZWQnLCB1bmRlZmluZWQpfSR7dGhpcy5fUSgpfSAke3RoaXMuX3NxbFR5cGUoIkJvb2wiLCB0aGlzLl9fY29uZmlnKCd0eXBlJykpfWA7CgoJCQl9LAoKCQkJImNvZGUiOiAob2JqLCB2LCBlYUNvZGUgPSB0aGlzLl9uQ29kZSgnY29kZScsIHVuZGVmaW5lZCkpID0+IHsKCQkJCS8vIG9iai5zcWwgKz0gYCwke3RoaXMuX1EoKX0ke3RoaXMuX25Db2RlKCdjb2RlJywgdW5kZWZpbmVkKX0ke3RoaXMuX1EoKX0gJHt0aGlzLl9zcWxUeXBlKCJTdHJpbmciLCB0aGlzLl9fY29uZmlnKCd0eXBlJykpfWA7CgoJCQl9LAoKCQkJIm9yZGVyIjogKG9iaiwgdiwgZWFDb2RlID0gdGhpcy5fbkNvZGUoJ29yZGVyJywgdW5kZWZpbmVkKSkgPT4gewoJCQkJLy8gb2JqLnNxbCArPSBgLCR7dGhpcy5fUSgpfSR7dGhpcy5fbkNvZGUoJ29yZGVyJywgdW5kZWZpbmVkKX0ke3RoaXMuX1EoKX0gJHt0aGlzLl9zcWxUeXBlKCJJbnQiLCB0aGlzLl9fY29uZmlnKCd0eXBlJykpfWA7CgoJCQl9LAoKCQkJImRhdGUiOiAob2JqLCB2LCBlYUNvZGUgPSB0aGlzLl9uQ29kZSgnZGF0ZScsIHVuZGVmaW5lZCkpID0+IHsKCQkJCS8vIG9iai5zcWwgKz0gYCwke3RoaXMuX1EoKX0ke3RoaXMuX25Db2RlKCdkYXRlJywgdW5kZWZpbmVkKX0ke3RoaXMuX1EoKX0gJHt0aGlzLl9zcWxUeXBlKCJEYXRlIiwgdGhpcy5fX2NvbmZpZygndHlwZScpKX1gOwoKCQkJfSwKCgkJCSJuYW1lIjogKG9iaiwgdiwgZWFDb2RlID0gdGhpcy5fbkNvZGUoJ25hbWUnLCB1bmRlZmluZWQpKSA9PiB7CgkJCQkvLyBvYmouc3FsICs9IGAsJHt0aGlzLl9RKCl9JHt0aGlzLl9uQ29kZSgnbmFtZScsIHVuZGVmaW5lZCl9JHt0aGlzLl9RKCl9ICR7dGhpcy5fc3FsVHlwZSgiU3RyaW5nIiwgdGhpcy5fX2NvbmZpZygndHlwZScpKX1gOwoKCQkJfSwKCgkJCSJyZW1hcmsiOiAob2JqLCB2LCBlYUNvZGUgPSB0aGlzLl9uQ29kZSgncmVtYXJrJywgdW5kZWZpbmVkKSkgPT4gewoJCQkJLy8gb2JqLnNxbCArPSBgLCR7dGhpcy5fUSgpfSR7dGhpcy5fbkNvZGUoJ3JlbWFyaycsIHVuZGVmaW5lZCl9JHt0aGlzLl9RKCl9ICR7dGhpcy5fc3FsVHlwZSgiVGV4dCIsIHRoaXMuX19jb25maWcoJ3R5cGUnKSl9YDsKCgkJCX0sCgoJCQkiY29udGVudCI6IChvYmosIHYsIGVhQ29kZSA9IHRoaXMuX25Db2RlKCdjb250ZW50JywgdW5kZWZpbmVkKSkgPT4gewoJCQkJLy8gb2JqLnNxbCArPSBgLCR7dGhpcy5fUSgpfSR7dGhpcy5fbkNvZGUoJ2NvbnRlbnQnLCB1bmRlZmluZWQpfSR7dGhpcy5fUSgpfSAke3RoaXMuX3NxbFR5cGUoIlRleHQiLCB0aGlzLl9fY29uZmlnKCd0eXBlJykpfWA7CgoJCQl9LAoKCQl9LCAiX3RvU1FMVGFibGUiKTsKCgkJLy8gcmV0LnNxbCArPSAnLypDb250ZW50Ki8pO1xuJzsKCgkJcmV0LnNxbCA9IHR5cGVvZihzcWxGb3JtYXR0ZXIpICE9PSAndW5kZWZpbmVkJyA/IHNxbEZvcm1hdHRlci5mb3JtYXQocmV0LnNxbCkgOiByZXQuc3FsOwoKCQl0aGlzLmxvZyh1bmRlZmluZWQsICdfdG9TUUxUYWJsZScsICdFbnRpdHlPYmplY3QnLCAwLCByZXQuc3FsKTsKCQlyZXR1cm4gcmV0LnNxbDsKCX0KCglfZnJvbVNRTFRhYmxlKHRhYmxlLCBmaWVsZHMpIHsKCQkvLyB0YWJsZSBpcyBhIGpzb24gYXJyYXkKCgkJaWYgKChmaWVsZHMgJiYgZmllbGRzLmluZGV4T2YoImFjdGl2ZSIpKSB8fCAhZmllbGRzKSB7CgkJCXRoaXMuYWN0aXZlKHRhYmxlWyJhY3RpdmUiXSk7CgkJfQoKCQlpZiAoKGZpZWxkcyAmJiBmaWVsZHMuaW5kZXhPZigiZW5hYmxlZCIpKSB8fCAhZmllbGRzKSB7CgkJCXRoaXMuZW5hYmxlZCh0YWJsZVsiZW5hYmxlZCJdKTsKCQl9CgoJCWlmICgoZmllbGRzICYmIGZpZWxkcy5pbmRleE9mKCJjb2RlIikpIHx8ICFmaWVsZHMpIHsKCQkJdGhpcy5jb2RlKHRhYmxlWyJjb2RlIl0pOwoJCX0KCgkJaWYgKChmaWVsZHMgJiYgZmllbGRzLmluZGV4T2YoIm9yZGVyIikpIHx8ICFmaWVsZHMpIHsKCQkJdGhpcy5vcmRlcih0YWJsZVsib3JkZXIiXSk7CgkJfQoKCQlpZiAoKGZpZWxkcyAmJiBmaWVsZHMuaW5kZXhPZigiZGF0ZSIpKSB8fCAhZmllbGRzKSB7CgkJCXRoaXMuZGF0ZSh0YWJsZVsiZGF0ZSJdKTsKCQl9CgoJCWlmICgoZmllbGRzICYmIGZpZWxkcy5pbmRleE9mKCJuYW1lIikpIHx8ICFmaWVsZHMpIHsKCQkJdGhpcy5uYW1lKHRhYmxlWyJuYW1lIl0pOwoJCX0KCgkJaWYgKChmaWVsZHMgJiYgZmllbGRzLmluZGV4T2YoInJlbWFyayIpKSB8fCAhZmllbGRzKSB7CgkJCXRoaXMucmVtYXJrKHRhYmxlWyJyZW1hcmsiXSk7CgkJfQoKCQlpZiAoKGZpZWxkcyAmJiBmaWVsZHMuaW5kZXhPZigiY29udGVudCIpKSB8fCAhZmllbGRzKSB7CgkJCXRoaXMuY29udGVudCh0YWJsZVsiY29udGVudCJdKTsKCQl9CgoJCXJldHVybiB0aGlzOwoJfQoKCWFzeW5jIF9zcWwoc3FsLCBzb3VyY2UgPSB0aGlzKSB7CgoJCXJldHVybiBhd2FpdCBuZXcgbG90dG8uVXNlcigpLl9zcWwoc3FsLCB0aGlzKTsKCgl9CgoJYXN5bmMgX2ZpbGVzeXN0ZW0oZmlsZSwgY29udGVudCkgewoKCQl0cnkgewoJCQlsZXQgcmV0ID0ge307CgkJCWxldCBwYXRoID0gdGhpcy5fX2NvbmZpZyhgcGF0aC4ke2NvbnRlbnQ/J3dyaXRlJzoncmVhZCd9YCwgJy4vJyk7CgkJCWlmICh0aGlzLl9fY29uZmlnKCdsaXZlJywgdHJ1ZSkpIHsKCQkJCWlmICh0eXBlb2YoY29udGVudCkgIT09ICd1bmRlZmluZWQnKSB7CgkJCQkJLy8gd3JpdGUKCQkJCQlpZiAodHlwZW9mKGdsb2JhbCkgIT09ICd1bmRlZmluZWQnKSB7CgkJCQkJCWF3YWl0IGZzLnByb21pc2VzLm1rZGlyKChwYXRoICsgZmlsZSkucmVwbGFjZSgvKC4qXC8pLiovZywgJyQxJyksIHsKCQkJCQkJCXJlY3Vyc2l2ZTogdHJ1ZQoJCQkJCQl9KTsKCQkJCQkJcmV0ID0gZ2xvYmFsLmZzLndyaXRlRmlsZVN5bmMocGF0aCArIGZpbGUsIHR5cGVvZihjb250ZW50KSA9PT0gJ29iamVjdCcgPyB0aGlzLl9idG9hKEpTT04uc3RyaW5naWZ5KGNvbnRlbnQsIG51bGwsICdcdCcpKSA6IGNvbnRlbnQpOwoJCQkJCX0gZWxzZSB7CgkJCQkJCXRoaXMubG9nKHVuZGVmaW5lZCwgJ19maWxlc3lzdGVtJywgJ0VudGl0eU9iamVjdCcsIDEsICJDYW5ub3Qgd3JpdGUgdG8gZmlsZSBzeXN0ZW0iKTsKCQkJCQl9CgkJCQl9IGVsc2UgewoJCQkJCS8vIHJlYWQKCQkJCQlpZiAocGF0aC5zdGFydHNXaXRoKCdodHRwJykgJiYgcGF0aC5pbmRleE9mKCc6Ly8nKSA+IDApIHsKCQkJCQkJcmV0ID0gYXdhaXQgdGhpcy5Ub29sLmF4aW9zLmdldChwYXRoICsgZmlsZSArICI/X19yYW5kb209IiArIE1hdGgucmFuZG9tKCksIHsKCQkJCQkJCXZhbGlkYXRlU3RhdHVzOiBzdGF0dXMgPT4gc3RhdHVzIDwgNTAwCgkJCQkJCX0pOwoJCQkJCX0gZWxzZSBpZiAodHlwZW9mKGdsb2JhbCkgIT09ICd1bmRlZmluZWQnKSB7CgkJCQkJCXJldCA9IGdsb2JhbC5mcy5yZWFkRmlsZVN5bmMocGF0aCArIGZpbGUpOwoJCQkJCX0KCQkJCX0KCQkJfQoKCQkJdGhpcy5sb2codW5kZWZpbmVkLCAnX2ZpbGVzeXN0ZW0nLCAnRW50aXR5T2JqZWN0JywgMCwgcGF0aCArIGZpbGUsIHJldCA/IHJldC5kYXRhIDogcmV0KTsKCQkJcmV0dXJuIHJldCA/IHJldC5kYXRhIDogcmV0OwoJCX0gY2F0Y2ggKGV4KSB7CgkJCXRoaXMubG9nKHVuZGVmaW5lZCwgJ19maWxlc3lzdGVtJywgJ0VudGl0eU9iamVjdCcsIDIsIGV4KTsKCQl9CgoJfQoKCV9maWxlTmFtZShfY2xhc3MgPSB0aGlzLl9uQ29kZSgpLCBvYmogPSB0aGlzLl90b0RvY3VtZW50KHRydWUpLCBlYUNvZGUgPSB0aGlzLl9uQ29kZSgnY29kZScsIHVuZGVmaW5lZCkpIHsKCgkJdHJ5IHsKCQkJcmV0dXJuIGAke3RoaXMuX19jb25maWcoJ3Njb3BlJywgJ2xvdHRvJyl9LyR7X2NsYXNzfS8ke29ialtlYUNvZGVdfS5qc29uYDsKCQl9IGNhdGNoIChleCkgewoJCQl0aGlzLmxvZyh1bmRlZmluZWQsICdfZmlsZU5hbWUnLCAnRW50aXR5T2JqZWN0JywgMiwgZXgpOwoJCX0KCgl9CgoJYXN5bmMgX2dpdGh1YihmaWxlLCBjb250ZW50KSB7CgoJCXRyeSB7CgkJCS8vIFRvRG86IHVzZSBfcmVzdCgpIGluc3RlYWQKCQkJbGV0IGNvbmZpZyA9IHsKCQkJCW1ldGhvZDogY29udGVudCA/ICdwdXQnIDogJ2dldCcsCgkJCQl1cmw6IHRoaXMuX19jb25maWcoJ3VybCcpICsgZmlsZSwKCQkJCWhlYWRlcnM6IHsKCQkJCQknQWNjZXB0JzogJ2FwcGxpY2F0aW9uL3ZuZC5naXRodWIranNvbicsCgkJCQkJJ1gtR2l0SHViLUFwaS1WZXJzaW9uJzogJzIwMjItMTEtMjgnLAoJCQkJfSwKCQkJfTsKCQkJaWYgKGNvbnRlbnQpIHsKCQkJCS8vIGZpcnN0IGdldCB0aGUgc2hhIG9mIHRoZSBmaWxlCgkJCQljb25maWcuZGF0YSA9IEpTT04uc3RyaW5naWZ5KHsKCQkJCQltZXNzYWdlOiAiZGVwbG95ZWQgYnkgX2dpdGh1YigpIiwKCQkJCQlzaGE6IGNvbnRlbnRbdGhpcy5fX2NvbmZpZygnaWRGaWVsZCcsICdfX2lkJyldLAoJCQkJCWNvbnRlbnQ6IHRoaXMuX2J0b2EodHlwZW9mKGNvbnRlbnQpID09PSAnb2JqZWN0JyA/IEpTT04uc3RyaW5naWZ5KGNvbnRlbnQsIG51bGwsICdcdCcpIDogY29udGVudCksCgkJCQl9KTsKCQkJfSBlbHNlIHsKCQkJCWNvbmZpZy52YWxpZGF0ZVN0YXR1cyA9IHN0YXR1cyA9PiBzdGF0dXMgPCA1MDA7CgkJCX0KCQkJbGV0IHJldCA9IGF3YWl0IHRoaXMuVG9vbC5heGlvcyhjb25maWcpOwoJCQlyZXQgPSByZXQgPyByZXQuZGF0YSA6IG51bGw7CgkJCWlmICghcmV0KSByZXR1cm4gcmV0OwoKCQkJcmV0ID0gY29udGVudCA/IHJldC5jb250ZW50IDogcmV0OwoJCQlsZXQgX3RoaXMgPSByZXQuY29udGVudCA/IEpTT04ucGFyc2UodGhpcy5fYXRvYihyZXQuY29udGVudCkpIDoge307CgkJCV90aGlzW3RoaXMuX19jb25maWcoJ2lkRmllbGQnLCAnX19pZCcpXSA9IHJldC5zaGE7CgoJCQl0aGlzLmxvZyh1bmRlZmluZWQsICdfZ2l0aHViJywgJ0VudGl0eU9iamVjdCcsIDAsIGZpbGUsIGNvbmZpZy5tZXRob2QsIF90aGlzKTsKCQkJcmV0dXJuIF90aGlzOwoJCX0gY2F0Y2ggKGV4KSB7CgkJCXRoaXMubG9nKHVuZGVmaW5lZCwgJ19naXRodWInLCAnRW50aXR5T2JqZWN0JywgMiwgZXgpOwoJCX0KCgl9CgoJX19leHBvcnQob2JqLCBvcHRpb25zLCBmdW4sIC4uLmZBcmdzKSB7CgkJaWYgKCFvYmopIHJldHVybiB0aGlzOwoKCQlsZXQgX29wdGlvbnMgPSAoZmllbGQsIG9iaiwgZWFPYmopID0+IHsKCQkJdHJ5IHsKCQkJCWlmIChvcHRpb25zLl9maWVsZHMgJiYgIW9wdGlvbnMuX2ZpZWxkcy5pbmNsdWRlcyhmaWVsZCkpIHJldHVybjsKCQkJCWlmICh0eXBlb2Yob3B0aW9uc1tmaWVsZF0pICE9PSAiZnVuY3Rpb24iKSB7CgkJCQkJdGhpcy5sb2codW5kZWZpbmVkLCAnX19leHBvcnQnLCAnRW50aXR5T2JqZWN0JywgMCwgYCR7ZnVufS5vcHRpb25zLiR7ZmllbGR9IGlzIG5vdCBhIGZ1bmN0aW9uYCk7CgkJCQkJcmV0dXJuOwoJCQkJfQoJCQkJaWYgKCFvcHRpb25zLk51bGwpIHsKCQkJCQlpZiAoZmllbGQgIT0gJ0lkJyAmJiAhdGhpc1snXycgKyBmaWVsZCArICdfc2V0J10pIHJldHVybjsKCQkJCQlpZiAoQXJyYXkuaXNBcnJheShlYU9iaikgJiYgdHlwZW9mKGVhT2JqLmxlbmd0aCkgIT09ICd1bmRlZmluZWQnICYmICFlYU9iai5sZW5ndGgpIHJldHVybjsKCQkJCX0KCQkJCWlmIChvcHRpb25zLk9QRVJBVE9SUyAmJiB0aGlzWydfJyArIGZpZWxkICsgJ19jb29wJ10pIG9iai5PUEVSQVRPUlMgPSBPYmplY3QuYXNzaWduKG9iai5PUEVSQVRPUlMgfHwge30sIHsKCQkJCQlbZmllbGRdOiB0aGlzWydfJyArIGZpZWxkICsgJ19jb29wJ10KCQkJCX0pOwoKCQkJCWxldCBfcmV0ID0gb3B0aW9uc1tmaWVsZF0ob2JqLCBlYU9iaik7CgoJCQkJaWYgKG9wdGlvbnMuX21hcCkgdGhpcy5fbWFwKGZpZWxkLCBmYWxzZSwgZnVuLCBlYU9iaiwgb2JqKTsKCQkJCXJldHVybiBfcmV0OwoJCQl9IGNhdGNoIChleCkgewoJCQkJaWYgKCFleC50b1N0cmluZygpLmluZGV4T2YoJ1JhbmdlRXJyb3I6ICcpKSB7CgkJCQkJbG90dG8uX19leHBvcnRBYm9ydCA9IHRydWU7CgkJCQl9CgkJCQl0aGlzLmxvZyh1bmRlZmluZWQsICdfX2V4cG9ydCcsICdFbnRpdHlPYmplY3QnLCAxLCBgRXJyb3IgaW4gJHtmdW59Ll9vcHRpb25zLiR7ZmllbGR9OiAke2V4fWAsIGV4KTsKCQkJfQoJCX07CgoJCWlmIChvcHRpb25zLkZ1bGwgfHwgdGhpcy5fX3N5bmNfb24oKSB8fCB0aGlzLklkID09IHRoaXMuSWQpIF9vcHRpb25zKCJJZCIsIG9iaiwgdGhpcy5JZCk7CgoJCV9vcHRpb25zKCJhY3RpdmUiLCBvYmosIHRoaXMuYWN0aXZlKCkpOwoKCQlfb3B0aW9ucygiZW5hYmxlZCIsIG9iaiwgdGhpcy5lbmFibGVkKCkpOwoKCQlfb3B0aW9ucygiY29kZSIsIG9iaiwgdGhpcy5jb2RlKCkpOwoKCQlfb3B0aW9ucygib3JkZXIiLCBvYmosIHRoaXMub3JkZXIoKSk7CgoJCV9vcHRpb25zKCJkYXRlIiwgb2JqLCB0aGlzLmRhdGUoKSk7CgoJCV9vcHRpb25zKCJuYW1lIiwgb2JqLCB0aGlzLm5hbWUoKSk7CgoJCV9vcHRpb25zKCJyZW1hcmsiLCBvYmosIHRoaXMucmVtYXJrKCkpOwoKCQlfb3B0aW9ucygiY29udGVudCIsIG9iaiwgdGhpcy5jb250ZW50KCkpOwoKCQlsZXQgdiA9IHVuZGVmaW5lZDsKCQl0cnkgewoJCQlsb3R0by51blJlY3Vyc2VBYm9ydCA9IGxvdHRvLnVuUmVjdXJzZUFib3J0IHx8IHt9OwoJCQlpZiAobG90dG8udW5SZWN1cnNlQWJvcnRbZnVuXSkgewoJCQkJdGhpcy5sb2codW5kZWZpbmVkLCAnX19leHBvcnQnLCAnRW50aXR5T2JqZWN0JywgMSwgYEFib3J0aW5nIGFzIHBlciBsb3R0by51blJlY3Vyc2VBYm9ydC4ke2Z1bn1gKTsKCgkJCQlpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykgcmV0dXJuIHY7CgkJCQlyZXR1cm4gKHYub2JqICYmIHYub2JqLl9pZCkgPyB7CgkJCQkJX2lkOiB2Lm9iai5faWQKCQkJCX0gOiB2Lm9iajsKCQkJCXJldHVybiB2Lm9iajsKCgkJCX0KCgkJCWxldCBfaWQgPSBudWxsOwoJCQlpZiAodHlwZW9mKG9iaikgPT09ICd1bmRlZmluZWQnKSB7CgkJCQl0aGlzLmxvZyh1bmRlZmluZWQsICdfX2V4cG9ydC51blJlY3Vyc2UnLCAnRW50aXR5T2JqZWN0JywgMSwgIk51bGwgaW5wdXQiLCBvYmosIGZ1biwgZkFyZ3MpOwoJCQkJcmV0dXJuIG9iajsKCQkJfSBlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHsKCQkJCV9pZCA9IHRoaXMuaGFzaENvZGUob2JqKTsKCQkJfSBlbHNlIHsKCQkJCV9pZCA9IG9iai5faWQgfHwgb2JqLmlkIHx8IG9iai5JRDsKCQkJfQoKCQkJaWYgKHR5cGVvZihfaWQpID09PSAndW5kZWZpbmVkJyB8fCAhX2lkKSB7CgkJCQlpZiAob2JqLklkICYmIG9iai5JZCA9PSBvYmouSWQpIHsKCQkJCQlfaWQgPSBvYmouSWQ7CgkJCQl9IGVsc2UgaWYgKHRoaXMuSWQgPT0gdGhpcy5JZCkgewoJCQkJCV9pZCA9IHRoaXMuSWQ7CgkJCQl9IGVsc2UgaWYgKG9iai5FbnRpdHlDbGFzcykgewoJCQkJCV9pZCA9IG9iai5FbnRpdHlDbGFzcy5JZCB8fCBvYmouRW50aXR5Q2xhc3MuTmFtZTsKCQkJCX0gZWxzZSB7CgkJCQkJX2lkID0gdGhpcy5FbnRpdHlDbGFzcy5JZCB8fCAiZjQ5MmRkYTQtZWM1OC00M2NlLWFkMzgtNmJkZDQ5Mjk2OTc2IiB8fCAiTlVMTCI7CgkJCQl9CgkJCX0KCgkJCWxvdHRvLl91blJlY3Vyc2UgPSBsb3R0by5fdW5SZWN1cnNlIHx8IHt9OwoJCQlsb3R0by5fdW5SZWN1cnNlLkNvbnRlbnQgPSBsb3R0by5fdW5SZWN1cnNlLkNvbnRlbnQgfHwge307CgkJCWxvdHRvLl91blJlY3Vyc2UuQ29udGVudFtmdW5dID0gbG90dG8uX3VuUmVjdXJzZS5Db250ZW50W2Z1bl0gfHwge307CgkJCWxvdHRvLl91blJlY3Vyc2UuQ29udGVudFtmdW5dW19pZF0gPSBsb3R0by5fdW5SZWN1cnNlLkNvbnRlbnRbZnVuXVtfaWRdIHx8IHt9OwoKCQkJbGV0IF9oYXNoID0gdGhpcy5fdG9IYXNoKGZBcmdzLCB7CgkJCQlkZXB0aDogKFsiX3RvSGFzaCJdLmluZGV4T2YoZnVuKSA+PSAwKSA/IDMgOiB1bmRlZmluZWQsCgkJCQljYWNoZTogKFsiX3RvSGFzaCJdLmluZGV4T2YoZnVuKSA+PSAwKSA/IFtdIDogdW5kZWZpbmVkCgkJCX0pOwoKCQkJdiA9IGxvdHRvLl91blJlY3Vyc2UuQ29udGVudFtmdW5dW19pZF1bX2hhc2hdOwoJCQlpZiAodiAmJiBNYXRoLmFicyhuZXcgRGF0ZSgpLmdldFRpbWUoKSAtIHYuZGF0ZSkgPCAoMTAwMCAqIDAuMikpIHsKCQkJCWxldCB0aGlzU2V0T24gPSAoKFsiX3RvSGFzaCJdLmluZGV4T2YoZnVuKSA+PSAwKSA/IG5ldyBEYXRlKDApIDogKHRoaXMuU2V0X09uIHx8IG5ldyBEYXRlKDApKSk7CgkJCQlpZiAodGhpc1NldE9uID49IHYuZGF0ZSkgewoJCQkJCS8vIGEgbmV3ZXIgY29weSBpcyBjcmVhdGVkIEFGVEVSL0RVUklORyB0aGUgcmVjdXJzaXZlIGNhbGwhIQoJCQkJCXRoaXMubG9nKHVuZGVmaW5lZCwgJ19fZXhwb3J0LnVuUmVjdXJzZScsICdFbnRpdHlPYmplY3QnLCAwLCAiU3Bhd25pbmcgaW4gZnVuIiwgX2lkLCBfaGFzaCwgZnVuLCBvYmosIHYpOwoJCQkJfSBlbHNlIGlmICgodi5kYXRlIC0gdGhpc1NldE9uLmdldFRpbWUoKSkgPj0gMCkgewoJCQkJCXYucmV1c2VkKys7CgkJCQkJdGhpcy5sb2codW5kZWZpbmVkLCAnX19leHBvcnQudW5SZWN1cnNlJywgJ0VudGl0eU9iamVjdCcsIDAsICJTZWxlY3RlZCBoYXNoIiwgX2lkLCBfaGFzaCwgZnVuLCBvYmosIHYpOwoJCQkJfQoKCQkJCWlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSByZXR1cm4gdjsKCQkJCXJldHVybiAodi5vYmogJiYgdi5vYmouX2lkKSA/IHsKCQkJCQlfaWQ6IHYub2JqLl9pZAoJCQkJfSA6IHYub2JqOwoJCQkJcmV0dXJuIHYub2JqOwoKCQkJfQoKCQkJdGhpcy5sb2codW5kZWZpbmVkLCAnX19leHBvcnQudW5SZWN1cnNlJywgJ0VudGl0eU9iamVjdCcsIDAsICJQdXNoaW5nIGhhc2giLCBfaWQsIF9oYXNoLCBmdW4sIG9iaik7CgkJCWxvdHRvLl91blJlY3Vyc2UuQ29udGVudFtmdW5dW19pZF1bX2hhc2hdID0gewoJCQkJZGF0ZTogbmV3IERhdGUoKS5nZXRUaW1lKCksCgkJCQlhcmdzOiBKU09OLnN0cmluZ2lmeShmQXJncyksCgkJCQlvYmo6IG9iaiwKCQkJCXJldXNlZDogMCwKCQkJfTsKCQl9IGNhdGNoICh1blJlY0V4KSB7CgkJCWlmICghdW5SZWNFeC50b1N0cmluZygpLmluZGV4T2YoJ1JhbmdlRXJyb3I6ICcpKSB7CgkJCQlsb3R0by51blJlY3Vyc2VBYm9ydFtmdW5dID0gdHJ1ZTsKCQkJfQoJCQl0aGlzLmxvZyh1bmRlZmluZWQsICdfX2V4cG9ydC51blJlY3Vyc2UnLCAnRW50aXR5T2JqZWN0JywgMiwgb2JqLCBmdW4sIGZBcmdzLCB1blJlY0V4LnRvU3RyaW5nKCkpOwoKCQkJaWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHJldHVybiB2OwoJCQlyZXR1cm4gKHYub2JqICYmIHYub2JqLl9pZCkgPyB7CgkJCQlfaWQ6IHYub2JqLl9pZAoJCQl9IDogdi5vYmo7CgkJCXJldHVybiB2Lm9iajsKCgkJfQoKCQlfb3B0aW9ucygiX1RISVMiLCBvYmosIHRoaXMuX1RISVMpOwoKCQlPYmplY3Qua2V5cyhvcHRpb25zKS5maWx0ZXIoayA9PiB0eXBlb2Yob3B0aW9uc1trXSkgPT09ICdmdW5jdGlvbicgJiYgIVsnSWQnLCAnX1RISVMnXS5jb25jYXQoWydhY3RpdmUnLCAnZW5hYmxlZCcsICdjb2RlJywgJ29yZGVyJywgJ2RhdGUnLCAnbmFtZScsICdyZW1hcmsnLCAnY29udGVudCddKS5jb25jYXQoWycnXSkuaW5jbHVkZXMoaykpLmZvckVhY2goayA9PiBfb3B0aW9ucyhrLCBvYmosIHRydWUpKTsKCgkJcmV0dXJuIG9iajsKCX0KCglfX2ltcG9ydChvYmosIG9wdGlvbnMsIGZ1biwgLi4uZkFyZ3MpIHsKCQkvLyBpZighb2JqKSByZXR1cm4gdGhpczsKCQlpZiAodHlwZW9mKG9iaikgIT09ICdvYmplY3QnKSB7CgkJCXRoaXMubG9nKHVuZGVmaW5lZCwgJ19faW1wb3J0JywgJ0VudGl0eU9iamVjdCcsIDEsIGAke2Z1bn06IE5vdCBhbiBvYmplY3Q6ICR7dHlwZW9mKG9iail9YCwgb2JqKTsKCQkJcmV0dXJuIHRoaXM7CgkJfQoKCQlsZXQgX29wdGlvbnMgPSAoZmllbGQsIG9iaikgPT4gewoJCQlpZiAob3B0aW9ucy5fZmllbGRzICYmICFvcHRpb25zLl9maWVsZHMuaW5jbHVkZXMoZmllbGQpKSByZXR1cm47CgkJCWlmICghb2JqKSByZXR1cm47CgkJCWlmIChBcnJheS5pc0FycmF5KG9iaikgJiYgIW9iai5sZW5ndGgpIHJldHVybjsKCgkJCXRyeSB7CgkJCQlpZiAob3B0aW9ucy5fbWFwKSB0aGlzLl9tYXAoZmllbGQsIHRydWUsIGZ1biwgb2JqLCBvYmopOwoJCQkJaWYgKG9wdGlvbnNbZmllbGRdICYmIHR5cGVvZihvcHRpb25zW2ZpZWxkXSkgPT09ICJmdW5jdGlvbiIpIHJldHVybiBvcHRpb25zW2ZpZWxkXShvYmopOwoJCQl9IGNhdGNoIChleCkgewoJCQkJdGhpcy5sb2codW5kZWZpbmVkLCAnX19pbXBvcnQnLCAnRW50aXR5T2JqZWN0JywgMSwgYEVycm9yICR7ZXh9IGluICR7ZnVufS5vcHRpb25zLiR7ZmllbGR9YCwgZXgpOwoJCQl9CgkJfTsKCgkJX29wdGlvbnMoIl9USElTIiwgb2JqKTsKCQlfb3B0aW9ucygiSWQiLCBvYmopOwoKCQlfb3B0aW9ucygiYWN0aXZlIiwgb2JqKTsKCgkJX29wdGlvbnMoImVuYWJsZWQiLCBvYmopOwoKCQlfb3B0aW9ucygiY29kZSIsIG9iaik7CgoJCV9vcHRpb25zKCJvcmRlciIsIG9iaik7CgoJCV9vcHRpb25zKCJkYXRlIiwgb2JqKTsKCgkJX29wdGlvbnMoIm5hbWUiLCBvYmopOwoKCQlfb3B0aW9ucygicmVtYXJrIiwgb2JqKTsKCgkJX29wdGlvbnMoImNvbnRlbnQiLCBvYmopOwoKCQkvLyBjYW4gd2UgZG8gZGVSZWZlcmVuY2UgaGVyZT8KCgkJbGV0IHYgPSB1bmRlZmluZWQ7CgkJdHJ5IHsKCQkJbG90dG8udW5SZWN1cnNlQWJvcnQgPSBsb3R0by51blJlY3Vyc2VBYm9ydCB8fCB7fTsKCQkJaWYgKGxvdHRvLnVuUmVjdXJzZUFib3J0W2Z1bl0pIHsKCQkJCXRoaXMubG9nKHVuZGVmaW5lZCwgJ19faW1wb3J0JywgJ0VudGl0eU9iamVjdCcsIDEsIGBBYm9ydGluZyBhcyBwZXIgbG90dG8udW5SZWN1cnNlQWJvcnQuJHtmdW59YCk7CgoJCQkJaWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHJldHVybiB2OwoJCQkJcmV0dXJuICh2Lm9iaiAmJiB2Lm9iai5faWQpID8gewoJCQkJCV9pZDogdi5vYmouX2lkCgkJCQl9IDogdi5vYmo7CgkJCQlyZXR1cm4gdi5vYmo7CgoJCQl9CgoJCQlsZXQgX2lkID0gbnVsbDsKCQkJaWYgKHR5cGVvZih0aGlzKSA9PT0gJ3VuZGVmaW5lZCcpIHsKCQkJCXRoaXMubG9nKHVuZGVmaW5lZCwgJ19faW1wb3J0LnVuUmVjdXJzZScsICdFbnRpdHlPYmplY3QnLCAxLCAiTnVsbCBpbnB1dCIsIHRoaXMsIGZ1biwgZkFyZ3MpOwoJCQkJcmV0dXJuIHRoaXM7CgkJCX0gZWxzZSBpZiAodHlwZW9mKHRoaXMpID09PSAnc3RyaW5nJykgewoJCQkJX2lkID0gdGhpcy5oYXNoQ29kZSh0aGlzKTsKCQkJfSBlbHNlIHsKCQkJCV9pZCA9IHRoaXMuX2lkIHx8IHRoaXMuaWQgfHwgdGhpcy5JRDsKCQkJfQoKCQkJaWYgKHR5cGVvZihfaWQpID09PSAndW5kZWZpbmVkJyB8fCAhX2lkKSB7CgkJCQlpZiAodGhpcy5JZCAmJiB0aGlzLklkID09IHRoaXMuSWQpIHsKCQkJCQlfaWQgPSB0aGlzLklkOwoJCQkJfSBlbHNlIGlmICh0aGlzLklkID09IHRoaXMuSWQpIHsKCQkJCQlfaWQgPSB0aGlzLklkOwoJCQkJfSBlbHNlIGlmICh0aGlzLkVudGl0eUNsYXNzKSB7CgkJCQkJX2lkID0gdGhpcy5FbnRpdHlDbGFzcy5JZCB8fCB0aGlzLkVudGl0eUNsYXNzLk5hbWU7CgkJCQl9IGVsc2UgewoJCQkJCV9pZCA9IHRoaXMuRW50aXR5Q2xhc3MuSWQgfHwgImY0OTJkZGE0LWVjNTgtNDNjZS1hZDM4LTZiZGQ0OTI5Njk3NiIgfHwgIk5VTEwiOwoJCQkJfQoJCQl9CgoJCQlsb3R0by5fdW5SZWN1cnNlID0gbG90dG8uX3VuUmVjdXJzZSB8fCB7fTsKCQkJbG90dG8uX3VuUmVjdXJzZS5Db250ZW50ID0gbG90dG8uX3VuUmVjdXJzZS5Db250ZW50IHx8IHt9OwoJCQlsb3R0by5fdW5SZWN1cnNlLkNvbnRlbnRbZnVuXSA9IGxvdHRvLl91blJlY3Vyc2UuQ29udGVudFtmdW5dIHx8IHt9OwoJCQlsb3R0by5fdW5SZWN1cnNlLkNvbnRlbnRbZnVuXVtfaWRdID0gbG90dG8uX3VuUmVjdXJzZS5Db250ZW50W2Z1bl1bX2lkXSB8fCB7fTsKCgkJCWxldCBfaGFzaCA9IHRoaXMuX3RvSGFzaChmQXJncywgewoJCQkJZGVwdGg6IChbIl90b0hhc2giXS5pbmRleE9mKGZ1bikgPj0gMCkgPyAzIDogdW5kZWZpbmVkLAoJCQkJY2FjaGU6IChbIl90b0hhc2giXS5pbmRleE9mKGZ1bikgPj0gMCkgPyBbXSA6IHVuZGVmaW5lZAoJCQl9KTsKCgkJCXYgPSBsb3R0by5fdW5SZWN1cnNlLkNvbnRlbnRbZnVuXVtfaWRdW19oYXNoXTsKCQkJaWYgKHYgJiYgTWF0aC5hYnMobmV3IERhdGUoKS5nZXRUaW1lKCkgLSB2LmRhdGUpIDwgKDEwMDAgKiAwLjIpKSB7CgkJCQlsZXQgdGhpc1NldE9uID0gKChbIl90b0hhc2giXS5pbmRleE9mKGZ1bikgPj0gMCkgPyBuZXcgRGF0ZSgwKSA6ICh0aGlzLlNldF9PbiB8fCBuZXcgRGF0ZSgwKSkpOwoJCQkJaWYgKHRoaXNTZXRPbiA+PSB2LmRhdGUpIHsKCQkJCQkvLyBhIG5ld2VyIGNvcHkgaXMgY3JlYXRlZCBBRlRFUi9EVVJJTkcgdGhlIHJlY3Vyc2l2ZSBjYWxsISEKCQkJCQl0aGlzLmxvZyh1bmRlZmluZWQsICdfX2ltcG9ydC51blJlY3Vyc2UnLCAnRW50aXR5T2JqZWN0JywgMCwgIlNwYXduaW5nIGluIGZ1biIsIF9pZCwgX2hhc2gsIGZ1biwgdGhpcywgdik7CgkJCQl9IGVsc2UgaWYgKCh2LmRhdGUgLSB0aGlzU2V0T24uZ2V0VGltZSgpKSA+PSAwKSB7CgkJCQkJdi5yZXVzZWQrKzsKCQkJCQl0aGlzLmxvZyh1bmRlZmluZWQsICdfX2ltcG9ydC51blJlY3Vyc2UnLCAnRW50aXR5T2JqZWN0JywgMCwgIlNlbGVjdGVkIGhhc2giLCBfaWQsIF9oYXNoLCBmdW4sIHRoaXMsIHYpOwoJCQkJfQoKCQkJCWlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSByZXR1cm4gdjsKCQkJCXJldHVybiAodi5vYmogJiYgdi5vYmouX2lkKSA/IHsKCQkJCQlfaWQ6IHYub2JqLl9pZAoJCQkJfSA6IHYub2JqOwoJCQkJcmV0dXJuIHYub2JqOwoKCQkJfQoKCQkJdGhpcy5sb2codW5kZWZpbmVkLCAnX19pbXBvcnQudW5SZWN1cnNlJywgJ0VudGl0eU9iamVjdCcsIDAsICJQdXNoaW5nIGhhc2giLCBfaWQsIF9oYXNoLCBmdW4sIHRoaXMpOwoJCQlsb3R0by5fdW5SZWN1cnNlLkNvbnRlbnRbZnVuXVtfaWRdW19oYXNoXSA9IHsKCQkJCWRhdGU6IG5ldyBEYXRlKCkuZ2V0VGltZSgpLAoJCQkJYXJnczogSlNPTi5zdHJpbmdpZnkoZkFyZ3MpLAoJCQkJb2JqOiB0aGlzLAoJCQkJcmV1c2VkOiAwLAoJCQl9OwoJCX0gY2F0Y2ggKHVuUmVjRXgpIHsKCQkJaWYgKCF1blJlY0V4LnRvU3RyaW5nKCkuaW5kZXhPZignUmFuZ2VFcnJvcjogJykpIHsKCQkJCWxvdHRvLnVuUmVjdXJzZUFib3J0W2Z1bl0gPSB0cnVlOwoJCQl9CgkJCXRoaXMubG9nKHVuZGVmaW5lZCwgJ19faW1wb3J0LnVuUmVjdXJzZScsICdFbnRpdHlPYmplY3QnLCAyLCB0aGlzLCBmdW4sIGZBcmdzLCB1blJlY0V4LnRvU3RyaW5nKCkpOwoKCQkJaWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHJldHVybiB2OwoJCQlyZXR1cm4gKHYub2JqICYmIHYub2JqLl9pZCkgPyB7CgkJCQlfaWQ6IHYub2JqLl9pZAoJCQl9IDogdi5vYmo7CgkJCXJldHVybiB2Lm9iajsKCgkJfQoKCQlPYmplY3Qua2V5cyhvcHRpb25zKS5maWx0ZXIoayA9PiB0eXBlb2Yob3B0aW9uc1trXSkgPT09ICdmdW5jdGlvbicgJiYgIVsnSWQnLCAnX1RISVMnXS5jb25jYXQoWydhY3RpdmUnLCAnZW5hYmxlZCcsICdjb2RlJywgJ29yZGVyJywgJ2RhdGUnLCAnbmFtZScsICdyZW1hcmsnLCAnY29udGVudCddKS5jb25jYXQoWycnXSkuaW5jbHVkZXMoaykpLmZvckVhY2goayA9PiBfb3B0aW9ucyhrLCBvYmopKTsKCgkJcmV0dXJuIHRoaXM7Cgl9CgoJX3RvREJPYmplY3QoZmllbGRzLCBiTm9SZWYpIHsKCQlpZiAoIXRoaXMuSWQpIHsKCQkJdGhpcy5sb2codW5kZWZpbmVkLCAnX3RvREJPYmplY3QnLCAnRW50aXR5T2JqZWN0JywgMiwgIkludmFsaWQgSUQiLCB0aGlzLkVudGl0eUNsYXNzLk5hbWUsIHRoaXMuVG9vbCk7CgkJfQoJCWxldCByZXQgPSB7CgkJCVt0aGlzLl9fY29uZmlnKCdpZEZpZWxkJywgJ19faWQnKV06ICInIiArIHRoaXMuSWQgKyAiJyIKCQl9OwoKCQlpZiAoKChmaWVsZHMgJiYgZmllbGRzLmluZGV4T2YoImFjdGl2ZSIpKSB8fCAhZmllbGRzKSAmJiB0aGlzLl9hY3RpdmVfc2V0ICYmICghYk5vUmVmIHx8IHRydWUpKSB7CgkJCWxldCBmVmFsdWUgPSBudWxsOwoJCQlsZXQgdiA9IHRoaXMuYWN0aXZlKCk7CgoJCQlmVmFsdWUgPSB2ID8gMSA6IDA7CgkJCWlmICh0aGlzLlRvb2wudHlwZS5uYW1lID09ICdOZW80aicpIGZWYWx1ZSA9IGZWYWx1ZSA/ICdUcnVlJyA6ICdGYWxzZSc7CgoJCQlyZXRbdGhpcy5fbkNvZGUoJ2FjdGl2ZScsIHVuZGVmaW5lZCkgKyAiIl0gPSBmVmFsdWU7CgkJfQoKCQlpZiAoKChmaWVsZHMgJiYgZmllbGRzLmluZGV4T2YoImVuYWJsZWQiKSkgfHwgIWZpZWxkcykgJiYgdGhpcy5fZW5hYmxlZF9zZXQgJiYgKCFiTm9SZWYgfHwgdHJ1ZSkpIHsKCQkJbGV0IGZWYWx1ZSA9IG51bGw7CgkJCWxldCB2ID0gdGhpcy5lbmFibGVkKCk7CgoJCQlmVmFsdWUgPSB2ID8gMSA6IDA7CgkJCWlmICh0aGlzLlRvb2wudHlwZS5uYW1lID09ICdOZW80aicpIGZWYWx1ZSA9IGZWYWx1ZSA/ICdUcnVlJyA6ICdGYWxzZSc7CgoJCQlyZXRbdGhpcy5fbkNvZGUoJ2VuYWJsZWQnLCB1bmRlZmluZWQpICsgIiJdID0gZlZhbHVlOwoJCX0KCgkJaWYgKCgoZmllbGRzICYmIGZpZWxkcy5pbmRleE9mKCJjb2RlIikpIHx8ICFmaWVsZHMpICYmIHRoaXMuX2NvZGVfc2V0ICYmICghYk5vUmVmIHx8IHRydWUpKSB7CgkJCWxldCBmVmFsdWUgPSBudWxsOwoJCQlsZXQgdiA9IHRoaXMuY29kZSgpOwoKCQkJZlZhbHVlID0gIiciICsgdiArICInIjsKCgkJCXJldFt0aGlzLl9uQ29kZSgnY29kZScsIHVuZGVmaW5lZCkgKyAiIl0gPSBmVmFsdWU7CgkJfQoKCQlpZiAoKChmaWVsZHMgJiYgZmllbGRzLmluZGV4T2YoIm9yZGVyIikpIHx8ICFmaWVsZHMpICYmIHRoaXMuX29yZGVyX3NldCAmJiAoIWJOb1JlZiB8fCB0cnVlKSkgewoJCQlsZXQgZlZhbHVlID0gbnVsbDsKCQkJbGV0IHYgPSB0aGlzLm9yZGVyKCk7CgoJCQlmVmFsdWUgPSB2IHx8ICcwJzsKCgkJCXJldFt0aGlzLl9uQ29kZSgnb3JkZXInLCB1bmRlZmluZWQpICsgIiJdID0gZlZhbHVlOwoJCX0KCgkJaWYgKCgoZmllbGRzICYmIGZpZWxkcy5pbmRleE9mKCJkYXRlIikpIHx8ICFmaWVsZHMpICYmIHRoaXMuX2RhdGVfc2V0ICYmICghYk5vUmVmIHx8IHRydWUpKSB7CgkJCWxldCBmVmFsdWUgPSBudWxsOwoJCQlsZXQgdiA9IHRoaXMuZGF0ZSgpOwoKCQkJdHJ5IHsKCQkJCWZWYWx1ZSA9ICInIiArICh2ID8gdi50b0lTT1N0cmluZygpIDogIjE5NzAtMS0xIikgKyAiJyI7CgkJCQlpZiAodGhpcy5fX2NvbmZpZygndHlwZScpID09ICdteXNxbCcpIHsKCQkJCQlmVmFsdWUgPSBgU1RSX1RPX0RBVEUoJHtmVmFsdWV9LCAnJVktJW0tJWRUJVQuJWZaJylgOwoJCQkJfQoJCQl9IGNhdGNoIChleCkgewoJCQkJZlZhbHVlID0gIiciICsgdiArICInIjsKCQkJfQoJCQlpZiAodGhpcy5Ub29sLnR5cGUubmFtZSA9PSAnTmVvNGonKSBmVmFsdWUgPSAnZGF0ZXRpbWUoJyArIGZWYWx1ZSArICcpJzsKCgkJCXJldFt0aGlzLl9uQ29kZSgnZGF0ZScsIHVuZGVmaW5lZCkgKyAiIl0gPSBmVmFsdWU7CgkJfQoKCQlpZiAoKChmaWVsZHMgJiYgZmllbGRzLmluZGV4T2YoIm5hbWUiKSkgfHwgIWZpZWxkcykgJiYgdGhpcy5fbmFtZV9zZXQgJiYgKCFiTm9SZWYgfHwgdHJ1ZSkpIHsKCQkJbGV0IGZWYWx1ZSA9IG51bGw7CgkJCWxldCB2ID0gdGhpcy5uYW1lKCk7CgoJCQlmVmFsdWUgPSAiJyIgKyB2ICsgIiciOwoKCQkJcmV0W3RoaXMuX25Db2RlKCduYW1lJywgdW5kZWZpbmVkKSArICIiXSA9IGZWYWx1ZTsKCQl9CgoJCWlmICgoKGZpZWxkcyAmJiBmaWVsZHMuaW5kZXhPZigicmVtYXJrIikpIHx8ICFmaWVsZHMpICYmIHRoaXMuX3JlbWFya19zZXQgJiYgKCFiTm9SZWYgfHwgdHJ1ZSkpIHsKCQkJbGV0IGZWYWx1ZSA9IG51bGw7CgkJCWxldCB2ID0gdGhpcy5yZW1hcmsoKTsKCgkJCWZWYWx1ZSA9ICInIiArICgodiAmJiB2LnJlcGxhY2UpID8gdi5yZXBsYWNlKC9cJy9nLCAiXCdcJyIpIDogdikgKyAiJyI7CgoJCQlyZXRbdGhpcy5fbkNvZGUoJ3JlbWFyaycsIHVuZGVmaW5lZCkgKyAiIl0gPSBmVmFsdWU7CgkJfQoKCQlpZiAoKChmaWVsZHMgJiYgZmllbGRzLmluZGV4T2YoImNvbnRlbnQiKSkgfHwgIWZpZWxkcykgJiYgdGhpcy5fY29udGVudF9zZXQgJiYgKCFiTm9SZWYgfHwgdHJ1ZSkpIHsKCQkJbGV0IGZWYWx1ZSA9IG51bGw7CgkJCWxldCB2ID0gdGhpcy5jb250ZW50KCk7CgoJCQlmVmFsdWUgPSAiJyIgKyAoKHYgJiYgdi5yZXBsYWNlKSA/IHYucmVwbGFjZSgvXCcvZywgIlwnXCciKSA6IHYpICsgIiciOwoKCQkJcmV0W3RoaXMuX25Db2RlKCdjb250ZW50JywgdW5kZWZpbmVkKSArICIiXSA9IGZWYWx1ZTsKCQl9CgoJCXRoaXMubG9nKHVuZGVmaW5lZCwgJ190b0RCT2JqZWN0JywgJ0VudGl0eU9iamVjdCcsIDAsIHJldCk7CgkJcmV0dXJuIHJldDsKCX0KCglfUSgpIHsKCQlsZXQgX28gPSAnIic7CgkJbGV0IF9xID0gX287CgoJCWlmIChbJ1NhbGVzRm9yY2UnXS5pbmRleE9mKHRoaXMuVG9vbC50eXBlLm5hbWUpID09IDApIHsKCQkJX28gPSBfcSA9ICIiOwoJCX0gZWxzZSBpZiAodGhpcy5fX2NvbmZpZygndHlwZScpID09ICdteXNxbCcgfHwgdGhpcy5Ub29sLnR5cGUubmFtZSA9PSAnTmVvNGonKSB7CgkJCV9vID0gX3EgPSAnYCc7CgkJfSBlbHNlIGlmIChmYWxzZSAmJiB0aGlzLl9fY29uZmlnKCd0eXBlJykgPT0gJ3BnJykgewoJCQlfbyA9IF9xID0gIiciOwoJCX0gZWxzZSBpZiAodGhpcy5fX2NvbmZpZygndHlwZScpID09ICdzcWxzZXJ2ZXInKSB7CgkJCV9vID0gJ1snOwoJCQlfcSA9ICddJzsKCQl9IGVsc2UgaWYgKHRoaXMuX19jb25maWcoJ2FwaUtleScpID09ICdhaXJ0YWJsZScpIHsKCQkJX28gPSAneyc7CgkJCV9xID0gJ30nOwoJCX0KCQlyZXR1cm4gX28gPyBfcSA6IF9vOwoJfQoKCV9maWVsZEdyb3VwcyhmZ3MgPSB7fSkgewoJCXRoaXMuX19maWVsZEdyb3VwcyA9IGZnczsKCQlyZXR1cm4gdGhpczsKCX0KCglfZmllbGRBZ2dyZWdhdGVzKGZhcyA9IHt9KSB7CgkJdGhpcy5fX2ZpZWxkQWdncmVnYXRlcyA9IGZhczsKCQlyZXR1cm4gdGhpczsKCX0KCglfdG9GaWVsZHNTUUwoZmllbGRzKSB7CgoJCWZpZWxkcyA9IGZpZWxkcyB8fCBbdGhpcy5fX2NvbmZpZygnaWRGaWVsZCcsICdfX2lkJyksIHRoaXMuX25Db2RlKCdhY3RpdmUnLCB1bmRlZmluZWQpLCB0aGlzLl9uQ29kZSgnZW5hYmxlZCcsIHVuZGVmaW5lZCksIHRoaXMuX25Db2RlKCdjb2RlJywgdW5kZWZpbmVkKSwgdGhpcy5fbkNvZGUoJ29yZGVyJywgdW5kZWZpbmVkKSwgdGhpcy5fbkNvZGUoJ2RhdGUnLCB1bmRlZmluZWQpLCB0aGlzLl9uQ29kZSgnbmFtZScsIHVuZGVmaW5lZCksIHRoaXMuX25Db2RlKCdyZW1hcmsnLCB1bmRlZmluZWQpLCB0aGlzLl9uQ29kZSgnY29udGVudCcsIHVuZGVmaW5lZCldOwoJCWZpZWxkcyA9IEFycmF5LmlzQXJyYXkoZmllbGRzKSA/IGZpZWxkcyA6IFtmaWVsZHNdOwoKCQlpZiAodGhpcy5fX2ZpZWxkR3JvdXBzKSB7CgkJCS8vIHtmaWVsZDogb3JkZXJ9CgkJCWZpZWxkcyA9IFtdOwoKCQkJaWYgKHRoaXMuX19maWVsZEdyb3Vwcy5hY3RpdmUpIGZpZWxkcy5wdXNoKGAke3RoaXMuX25Db2RlKCdhY3RpdmUnLCB1bmRlZmluZWQpfWApOwoKCQkJaWYgKHRoaXMuX19maWVsZEdyb3Vwcy5lbmFibGVkKSBmaWVsZHMucHVzaChgJHt0aGlzLl9uQ29kZSgnZW5hYmxlZCcsIHVuZGVmaW5lZCl9YCk7CgoJCQlpZiAodGhpcy5fX2ZpZWxkR3JvdXBzLmNvZGUpIGZpZWxkcy5wdXNoKGAke3RoaXMuX25Db2RlKCdjb2RlJywgdW5kZWZpbmVkKX1gKTsKCgkJCWlmICh0aGlzLl9fZmllbGRHcm91cHMub3JkZXIpIGZpZWxkcy5wdXNoKGAke3RoaXMuX25Db2RlKCdvcmRlcicsIHVuZGVmaW5lZCl9YCk7CgoJCQlpZiAodGhpcy5fX2ZpZWxkR3JvdXBzLmRhdGUpIGZpZWxkcy5wdXNoKGAke3RoaXMuX25Db2RlKCdkYXRlJywgdW5kZWZpbmVkKX1gKTsKCgkJCWlmICh0aGlzLl9fZmllbGRHcm91cHMubmFtZSkgZmllbGRzLnB1c2goYCR7dGhpcy5fbkNvZGUoJ25hbWUnLCB1bmRlZmluZWQpfWApOwoKCQl9CgkJcmV0dXJuIGZpZWxkczsKCX0KCglfZnJvbURCT2JqZWN0KHIgPSB7fSkgewoJCXRyeSB7CgkJCXJldHVybiB0aGlzLl9faW1wb3J0KHIsIHsKCQkJCUlkOiBvYmogPT4gdGhpcy5JZCA9IG9ialt0aGlzLl9fY29uZmlnKCdpZEZpZWxkJywgJ19faWQnKV0sCgoJCQkJYWN0aXZlOiAob2JqLCBlYUNvZGUgPSB0aGlzLl9uQ29kZSgnYWN0aXZlJywgdW5kZWZpbmVkKSkgPT4gewoJCQkJCXRoaXMuYWN0aXZlKG9ialtlYUNvZGVdKTsKCQkJCX0sCgoJCQkJZW5hYmxlZDogKG9iaiwgZWFDb2RlID0gdGhpcy5fbkNvZGUoJ2VuYWJsZWQnLCB1bmRlZmluZWQpKSA9PiB7CgkJCQkJdGhpcy5lbmFibGVkKG9ialtlYUNvZGVdKTsKCQkJCX0sCgoJCQkJY29kZTogKG9iaiwgZWFDb2RlID0gdGhpcy5fbkNvZGUoJ2NvZGUnLCB1bmRlZmluZWQpKSA9PiB7CgkJCQkJdGhpcy5jb2RlKG9ialtlYUNvZGVdKTsKCQkJCX0sCgoJCQkJb3JkZXI6IChvYmosIGVhQ29kZSA9IHRoaXMuX25Db2RlKCdvcmRlcicsIHVuZGVmaW5lZCkpID0+IHsKCQkJCQl0aGlzLm9yZGVyKG9ialtlYUNvZGVdKTsKCQkJCX0sCgoJCQkJZGF0ZTogKG9iaiwgZWFDb2RlID0gdGhpcy5fbkNvZGUoJ2RhdGUnLCB1bmRlZmluZWQpKSA9PiB7CgkJCQkJdGhpcy5kYXRlKG9ialtlYUNvZGVdKTsKCQkJCX0sCgoJCQkJbmFtZTogKG9iaiwgZWFDb2RlID0gdGhpcy5fbkNvZGUoJ25hbWUnLCB1bmRlZmluZWQpKSA9PiB7CgkJCQkJdGhpcy5uYW1lKG9ialtlYUNvZGVdKTsKCQkJCX0sCgoJCQkJcmVtYXJrOiAob2JqLCBlYUNvZGUgPSB0aGlzLl9uQ29kZSgncmVtYXJrJywgdW5kZWZpbmVkKSkgPT4gewoJCQkJCXRoaXMucmVtYXJrKG9ialtlYUNvZGVdKTsKCQkJCX0sCgoJCQkJY29udGVudDogKG9iaiwgZWFDb2RlID0gdGhpcy5fbkNvZGUoJ2NvbnRlbnQnLCB1bmRlZmluZWQpKSA9PiB7CgkJCQkJdGhpcy5jb250ZW50KG9ialtlYUNvZGVdKTsKCQkJCX0sCgoJCQl9LCAiX2Zyb21EQk9iamVjdCIpOwoJCX0gY2F0Y2ggKGV4KSB7CgkJCXRoaXMubG9nKHVuZGVmaW5lZCwgJ19mcm9tREJPYmplY3QnLCAnRW50aXR5T2JqZWN0JywgMiwgZXgpOwoJCX0KCX0KCglfdG9TZWxlY3RIZWFkZXIoZmllbGRzKSB7CgkJbGV0IHJldCA9IHsKCQkJdGFibGU6IHRoaXMuX25Db2RlKCksCgkJCWZpZWxkczogRG90T2JqZWN0Lm9iamVjdChPYmplY3QuZnJvbUVudHJpZXModGhpcy5fdG9GaWVsZHNTUUwoZmllbGRzKS5tYXAoZiA9PiB0aGlzLl9RKCkgKyBmLnJlcGxhY2UoL1wuL2csICcnKSArIHRoaXMuX1EoKSkubWFwKGYgPT4gW2YsIGZdKSkpLAoJCQlqb2luczoge30sCgkJfTsKCgkJaWYgKGZpZWxkcykgcmV0dXJuIHJldDsKCgkJcmV0LmpvaW5zID0gdGhpcy5fX2V4cG9ydCh7fSwgewoJCQkvLyBOdWxsOiB0cnVlLAoKCQl9LCAiX3RvU2VsZWN0SGVhZGVyIik7CgoJCXRoaXMubG9nKHVuZGVmaW5lZCwgJ190b1NlbGVjdEhlYWRlcicsICdFbnRpdHlPYmplY3QnLCAwLCByZXQpOwoKCQlyZXR1cm4gcmV0OwoJfQoKCV90b1NlbGVjdFNRTChmaWVsZHMpIHsKCQlsZXQgc3FsID0gInNlbGVjdCAiOwoKCQlsZXQgdFByZWYgPSBgJHt0aGlzLl9RKCl9JHt0aGlzLl9uQ29kZSgpfSR7dGhpcy5fUSgpfWA7CgoJCWxldCBoZWFkZXIgPSB0aGlzLl90b1NlbGVjdEhlYWRlcihmaWVsZHMpOwoKCQlzcWwgKz0gT2JqZWN0LnZhbHVlcyhoZWFkZXIuZmllbGRzKS5tYXAoZiA9PiBgJHt0UHJlZn0uJHtmfWApLmpvaW4oJywgJyk7CgkJT2JqZWN0LmtleXMoaGVhZGVyLmpvaW5zKS5mb3JFYWNoKGsgPT4gc3FsICs9ICIsICIgKyBPYmplY3QudmFsdWVzKGhlYWRlci5qb2luc1trXS5maWVsZHMpLm1hcChmID0+IGAke3RoaXMuX1EoKX0ke2hlYWRlci5qb2luc1trXS50YWJsZX1fJHtrfSR7dGhpcy5fUSgpfS4ke2Z9IGFzICR7dGhpcy5fUSgpfSR7a30uJHtmLnJlcGxhY2UodGhpcy5fUSgpLCAnJyl9YCkuam9pbignLCAnKSk7CgoJCWlmICh0aGlzLl9fZmllbGRBZ2dyZWdhdGVzKSB7CgkJCS8vIHtmaWVsZDogZnVuY3Rpb259CgoJCQlpZiAodGhpcy5fX2ZpZWxkQWdncmVnYXRlcy5hY3RpdmUpIHNxbCArPSBgJHtzcWw9PSgnc2VsZWN0ICcpPycnOicsJ30gJHt0aGlzLl9fZmllbGRBZ2dyZWdhdGVzLmFjdGl2ZX0oJHt0aGlzLl9RKCl9JHt0aGlzLl9uQ29kZSgnYWN0aXZlJywgdW5kZWZpbmVkKX0ke3RoaXMuX1EoKX0pYDsKCgkJCWlmICh0aGlzLl9fZmllbGRBZ2dyZWdhdGVzLmVuYWJsZWQpIHNxbCArPSBgJHtzcWw9PSgnc2VsZWN0ICcpPycnOicsJ30gJHt0aGlzLl9fZmllbGRBZ2dyZWdhdGVzLmVuYWJsZWR9KCR7dGhpcy5fUSgpfSR7dGhpcy5fbkNvZGUoJ2VuYWJsZWQnLCB1bmRlZmluZWQpfSR7dGhpcy5fUSgpfSlgOwoKCQkJaWYgKHRoaXMuX19maWVsZEFnZ3JlZ2F0ZXMuY29kZSkgc3FsICs9IGAke3NxbD09KCdzZWxlY3QgJyk/Jyc6JywnfSAke3RoaXMuX19maWVsZEFnZ3JlZ2F0ZXMuY29kZX0oJHt0aGlzLl9RKCl9JHt0aGlzLl9uQ29kZSgnY29kZScsIHVuZGVmaW5lZCl9JHt0aGlzLl9RKCl9KWA7CgoJCQlpZiAodGhpcy5fX2ZpZWxkQWdncmVnYXRlcy5vcmRlcikgc3FsICs9IGAke3NxbD09KCdzZWxlY3QgJyk/Jyc6JywnfSAke3RoaXMuX19maWVsZEFnZ3JlZ2F0ZXMub3JkZXJ9KCR7dGhpcy5fUSgpfSR7dGhpcy5fbkNvZGUoJ29yZGVyJywgdW5kZWZpbmVkKX0ke3RoaXMuX1EoKX0pYDsKCgkJCWlmICh0aGlzLl9fZmllbGRBZ2dyZWdhdGVzLmRhdGUpIHNxbCArPSBgJHtzcWw9PSgnc2VsZWN0ICcpPycnOicsJ30gJHt0aGlzLl9fZmllbGRBZ2dyZWdhdGVzLmRhdGV9KCR7dGhpcy5fUSgpfSR7dGhpcy5fbkNvZGUoJ2RhdGUnLCB1bmRlZmluZWQpfSR7dGhpcy5fUSgpfSlgOwoKCQkJaWYgKHRoaXMuX19maWVsZEFnZ3JlZ2F0ZXMubmFtZSkgc3FsICs9IGAke3NxbD09KCdzZWxlY3QgJyk/Jyc6JywnfSAke3RoaXMuX19maWVsZEFnZ3JlZ2F0ZXMubmFtZX0oJHt0aGlzLl9RKCl9JHt0aGlzLl9uQ29kZSgnbmFtZScsIHVuZGVmaW5lZCl9JHt0aGlzLl9RKCl9KWA7CgoJCX0KCgkJc3FsICs9IGAgZnJvbSAke3RQcmVmfSBgOwoKCQlPYmplY3Qua2V5cyhoZWFkZXIuam9pbnMpLmZvckVhY2goayA9PiBzcWwgKz0gYGxlZnQgam9pbiAke3RoaXMuX1EoKX0ke2hlYWRlci5qb2luc1trXS50YWJsZX0ke3RoaXMuX1EoKX0gYXMgJHt0aGlzLl9RKCl9JHtoZWFkZXIuam9pbnNba10udGFibGV9XyR7a30ke3RoaXMuX1EoKX0gb24gJHt0UHJlZn0uJHt0aGlzLl9RKCl9JHtrfWlkJHt0aGlzLl9RKCl9PSR7dGhpcy5fUSgpfSR7aGVhZGVyLmpvaW5zW2tdLnRhYmxlfV8ke2t9JHt0aGlzLl9RKCl9LiR7dGhpcy5fUSgpfSR7dGhpcy5fX2NvbmZpZygnaWRGaWVsZCcsICdfX2lkJyl9JHt0aGlzLl9RKCl9IGApOwoKCQlzcWwgKz0gYCB3aGVyZSAxPTFgOwoKCQlzcWwgPSB0aGlzLl9fZXhwb3J0KHsKCQkJc3FsOiBzcWwKCQl9LCB7CgkJCV9maWVsZHM6ICh0aGlzLl9fc3luY19vbigpIHx8IHRoaXMuSWQgPT0gdGhpcy5JZCkgPyBbJ0lkJ10gOiB1bmRlZmluZWQsCgkJCU51bGw6IHRydWUsCgkJCV9USElTOiBvYmogPT4gewoJCQkJaWYgKCF0aGlzLl9USElTIHx8ICF0aGlzLl9USElTLmxlbmd0aCkgcmV0dXJuOwoKCQkJCW9iai5zcWwgKz0gYCBhbmQgJHt0UHJlZn0uJHt0aGlzLl9RKCl9JHt0aGlzLl9fY29uZmlnKCdpZEZpZWxkJywgJ19faWQnKX0ke3RoaXMuX1EoKX0gYCArICh0aGlzLl9USElTX2Nvb3AgfHwgIklOIikgKyAiICgiICsgdGhpcy5fVEhJUy5tYXAodCA9PiB0Ll90b1NlbGVjdFNRTCh0Ll9fY29uZmlnKCdpZEZpZWxkJykgfHwgJ19faWQnKSkuam9pbignIFVOSU9OIEFMTCAnKSArICIpIjsKCQkJfSwKCQkJSWQ6IG9iaiA9PiBvYmouc3FsICs9IGAgYW5kICR7dFByZWZ9LiR7dGhpcy5fUSgpfSR7dGhpcy5fX2NvbmZpZygnaWRGaWVsZCcsICdfX2lkJyl9JHt0aGlzLl9RKCl9PScke3RoaXMuSWR9J2AsCgoJCQlhY3RpdmU6IChvYmosIHYsIGVhQ29kZSA9IHRoaXMuX25Db2RlKCdhY3RpdmUnLCB1bmRlZmluZWQpKSA9PiB7CgkJCQlpZiAoIXRoaXMuX2FjdGl2ZV9zZXQpIHJldHVybjsKCgkJCQlvYmouc3FsICs9IGAgYW5kICR7dFByZWZ9LiR7dGhpcy5fUSgpfSR7ZWFDb2RlfSR7dGhpcy5fUSgpfSBgICsgIj0iICsgIiAiOwoKCQkJCWlmICh0eXBlb2YodikgPT09ICJib29sZWFuIikgewoJCQkJCW9iai5zcWwgKz0gIiciICsgKHYgPyAiMSIgOiAiMCIpICsgIiciOwoJCQkJCXJldHVybjsKCQkJCX0KCgkJCQlpZiAodiAmJiB2LkVudGl0eUNsYXNzKSB7CgkJCQkJb2JqLnNxbCArPSAiKCIgKyB2Ll90b1NlbGVjdFNRTCgpICsgIikiOwoJCQkJfSBlbHNlIHsKCQkJCQlvYmouc3FsICs9ICInIiArIHYgKyAiJyI7CgkJCQl9CgkJCX0sCgoJCQllbmFibGVkOiAob2JqLCB2LCBlYUNvZGUgPSB0aGlzLl9uQ29kZSgnZW5hYmxlZCcsIHVuZGVmaW5lZCkpID0+IHsKCQkJCWlmICghdGhpcy5fZW5hYmxlZF9zZXQpIHJldHVybjsKCgkJCQlvYmouc3FsICs9IGAgYW5kICR7dFByZWZ9LiR7dGhpcy5fUSgpfSR7ZWFDb2RlfSR7dGhpcy5fUSgpfSBgICsgIj0iICsgIiAiOwoKCQkJCWlmICh0eXBlb2YodikgPT09ICJib29sZWFuIikgewoJCQkJCW9iai5zcWwgKz0gIiciICsgKHYgPyAiMSIgOiAiMCIpICsgIiciOwoJCQkJCXJldHVybjsKCQkJCX0KCgkJCQlpZiAodiAmJiB2LkVudGl0eUNsYXNzKSB7CgkJCQkJb2JqLnNxbCArPSAiKCIgKyB2Ll90b1NlbGVjdFNRTCgpICsgIikiOwoJCQkJfSBlbHNlIHsKCQkJCQlvYmouc3FsICs9ICInIiArIHYgKyAiJyI7CgkJCQl9CgkJCX0sCgoJCQljb2RlOiAob2JqLCB2LCBlYUNvZGUgPSB0aGlzLl9uQ29kZSgnY29kZScsIHVuZGVmaW5lZCkpID0+IHsKCQkJCWlmICghdGhpcy5fY29kZV9zZXQpIHJldHVybjsKCgkJCQlvYmouc3FsICs9IGAgYW5kICR7dFByZWZ9LiR7dGhpcy5fUSgpfSR7ZWFDb2RlfSR7dGhpcy5fUSgpfSBgICsgKHRoaXMuX2NvZGVfY29vcCB8fCAiTElLRSIpICsgIiAiOwoKCQkJCWlmICh0eXBlb2YodikgPT09ICJzdHJpbmciKSB7CgkJCQkJb2JqLnNxbCArPSAiJyIgKyAoKHRoaXMuX2NvZGVfY29vcCA9PSAiTElLRSIgfHwgIXRoaXMuX2NvZGVfY29vcCkgPyAiJSIgOiAiIikgKyB2ICsgKCh0aGlzLl9jb2RlX2Nvb3AgPT0gIkxJS0UiIHx8ICF0aGlzLl9jb2RlX2Nvb3ApID8gIiUiIDogIiIpICsgIiciOwoJCQkJCXJldHVybjsKCQkJCX0KCgkJCQlpZiAodiAmJiB2LkVudGl0eUNsYXNzKSB7CgkJCQkJb2JqLnNxbCArPSAiKCIgKyB2Ll90b1NlbGVjdFNRTCgpICsgIikiOwoJCQkJfSBlbHNlIHsKCQkJCQlvYmouc3FsICs9ICInIiArIHYgKyAiJyI7CgkJCQl9CgkJCX0sCgoJCQlvcmRlcjogKG9iaiwgdiwgZWFDb2RlID0gdGhpcy5fbkNvZGUoJ29yZGVyJywgdW5kZWZpbmVkKSkgPT4gewoJCQkJaWYgKCF0aGlzLl9vcmRlcl9zZXQpIHJldHVybjsKCgkJCQlvYmouc3FsICs9IGAgYW5kICR7dFByZWZ9LiR7dGhpcy5fUSgpfSR7ZWFDb2RlfSR7dGhpcy5fUSgpfSBgICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgIkxJS0UiKSArICIgIjsKCgkJCQlpZiAodiAmJiB2LkVudGl0eUNsYXNzKSB7CgkJCQkJb2JqLnNxbCArPSAiKCIgKyB2Ll90b1NlbGVjdFNRTCgpICsgIikiOwoJCQkJfSBlbHNlIHsKCQkJCQlvYmouc3FsICs9ICInIiArIHYgKyAiJyI7CgkJCQl9CgkJCX0sCgoJCQlkYXRlOiAob2JqLCB2LCBlYUNvZGUgPSB0aGlzLl9uQ29kZSgnZGF0ZScsIHVuZGVmaW5lZCkpID0+IHsKCQkJCWlmICghdGhpcy5fZGF0ZV9zZXQpIHJldHVybjsKCgkJCQlvYmouc3FsICs9IGAgYW5kICR7dFByZWZ9LiR7dGhpcy5fUSgpfSR7ZWFDb2RlfSR7dGhpcy5fUSgpfSBgICsgKHRoaXMuX2RhdGVfY29vcCB8fCAiTElLRSIpICsgIiAiOwoKCQkJCWlmICh2ICYmIHYudG9JU09TdHJpbmcpIHsKCQkJCQlpZiAodGhpcy5fX2NvbmZpZygndHlwZScpID09ICdzcWxpdGUnKSB7CgkJCQkJCW9iai5zcWwgKz0gInN0cmZ0aW1lKCclcycsICciICsgdi50b0lTT1N0cmluZygpICsgIicpIjsKCQkJCQl9IGVsc2UgewoJCQkJCQlvYmouc3FsICs9ICInIiArIHYudG9JU09TdHJpbmcoKSArICInIjsKCQkJCQl9CgkJCQkJcmV0dXJuOwoJCQkJfQoKCQkJCWlmICh2ICYmIHYuRW50aXR5Q2xhc3MpIHsKCQkJCQlvYmouc3FsICs9ICIoIiArIHYuX3RvU2VsZWN0U1FMKCkgKyAiKSI7CgkJCQl9IGVsc2UgewoJCQkJCW9iai5zcWwgKz0gIiciICsgdiArICInIjsKCQkJCX0KCQkJfSwKCgkJCW5hbWU6IChvYmosIHYsIGVhQ29kZSA9IHRoaXMuX25Db2RlKCduYW1lJywgdW5kZWZpbmVkKSkgPT4gewoJCQkJaWYgKCF0aGlzLl9uYW1lX3NldCkgcmV0dXJuOwoKCQkJCW9iai5zcWwgKz0gYCBhbmQgJHt0UHJlZn0uJHt0aGlzLl9RKCl9JHtlYUNvZGV9JHt0aGlzLl9RKCl9IGAgKyAodGhpcy5fbmFtZV9jb29wIHx8ICJMSUtFIikgKyAiICI7CgoJCQkJaWYgKHR5cGVvZih2KSA9PT0gInN0cmluZyIpIHsKCQkJCQlvYmouc3FsICs9ICInIiArICgodGhpcy5fbmFtZV9jb29wID09ICJMSUtFIiB8fCAhdGhpcy5fbmFtZV9jb29wKSA/ICIlIiA6ICIiKSArIHYgKyAoKHRoaXMuX25hbWVfY29vcCA9PSAiTElLRSIgfHwgIXRoaXMuX25hbWVfY29vcCkgPyAiJSIgOiAiIikgKyAiJyI7CgkJCQkJcmV0dXJuOwoJCQkJfQoKCQkJCWlmICh2ICYmIHYuRW50aXR5Q2xhc3MpIHsKCQkJCQlvYmouc3FsICs9ICIoIiArIHYuX3RvU2VsZWN0U1FMKCkgKyAiKSI7CgkJCQl9IGVsc2UgewoJCQkJCW9iai5zcWwgKz0gIiciICsgdiArICInIjsKCQkJCX0KCQkJfSwKCgkJCXJlbWFyazogKG9iaiwgdiwgZWFDb2RlID0gdGhpcy5fbkNvZGUoJ3JlbWFyaycsIHVuZGVmaW5lZCkpID0+IHsKCQkJCWlmICghdGhpcy5fcmVtYXJrX3NldCkgcmV0dXJuOwoKCQkJCXJldHVybjsKCgkJCQlpZiAodiAmJiB2LkVudGl0eUNsYXNzKSB7CgkJCQkJb2JqLnNxbCArPSAiKCIgKyB2Ll90b1NlbGVjdFNRTCgpICsgIikiOwoJCQkJfSBlbHNlIHsKCQkJCQlvYmouc3FsICs9ICInIiArIHYgKyAiJyI7CgkJCQl9CgkJCX0sCgoJCQljb250ZW50OiAob2JqLCB2LCBlYUNvZGUgPSB0aGlzLl9uQ29kZSgnY29udGVudCcsIHVuZGVmaW5lZCkpID0+IHsKCQkJCWlmICghdGhpcy5fY29udGVudF9zZXQpIHJldHVybjsKCgkJCQlyZXR1cm47CgoJCQkJaWYgKHYgJiYgdi5FbnRpdHlDbGFzcykgewoJCQkJCW9iai5zcWwgKz0gIigiICsgdi5fdG9TZWxlY3RTUUwoKSArICIpIjsKCQkJCX0gZWxzZSB7CgkJCQkJb2JqLnNxbCArPSAiJyIgKyB2ICsgIiciOwoJCQkJfQoJCQl9LAoKCQl9LCAiX3RvU2VsZWN0U1FMIiwgZmllbGRzKS5zcWw7CgoJCWlmICh0aGlzLl9fZmllbGRHcm91cHMpIHsKCQkJaWYgKE9iamVjdC5rZXlzKHRoaXMuX19maWVsZEdyb3VwcykubGVuZ3RoKSBzcWwgKz0gIiBncm91cCBieSAiOwoKCQkJaWYgKHRoaXMuX19maWVsZEdyb3Vwcy5hY3RpdmUpIHNxbCArPSBgJHt0aGlzLl9RKCl9JHt0aGlzLl9uQ29kZSgnYWN0aXZlJywgdW5kZWZpbmVkKX0ke3RoaXMuX1EoKX0gJHt0aGlzLl9fZmllbGRHcm91cHMuYWN0aXZlfWA7CgoJCQlpZiAodGhpcy5fX2ZpZWxkR3JvdXBzLmVuYWJsZWQpIHNxbCArPSBgJHt0aGlzLl9RKCl9JHt0aGlzLl9uQ29kZSgnZW5hYmxlZCcsIHVuZGVmaW5lZCl9JHt0aGlzLl9RKCl9ICR7dGhpcy5fX2ZpZWxkR3JvdXBzLmVuYWJsZWR9YDsKCgkJCWlmICh0aGlzLl9fZmllbGRHcm91cHMuY29kZSkgc3FsICs9IGAke3RoaXMuX1EoKX0ke3RoaXMuX25Db2RlKCdjb2RlJywgdW5kZWZpbmVkKX0ke3RoaXMuX1EoKX0gJHt0aGlzLl9fZmllbGRHcm91cHMuY29kZX1gOwoKCQkJaWYgKHRoaXMuX19maWVsZEdyb3Vwcy5vcmRlcikgc3FsICs9IGAke3RoaXMuX1EoKX0ke3RoaXMuX25Db2RlKCdvcmRlcicsIHVuZGVmaW5lZCl9JHt0aGlzLl9RKCl9ICR7dGhpcy5fX2ZpZWxkR3JvdXBzLm9yZGVyfWA7CgoJCQlpZiAodGhpcy5fX2ZpZWxkR3JvdXBzLmRhdGUpIHNxbCArPSBgJHt0aGlzLl9RKCl9JHt0aGlzLl9uQ29kZSgnZGF0ZScsIHVuZGVmaW5lZCl9JHt0aGlzLl9RKCl9ICR7dGhpcy5fX2ZpZWxkR3JvdXBzLmRhdGV9YDsKCgkJCWlmICh0aGlzLl9fZmllbGRHcm91cHMubmFtZSkgc3FsICs9IGAke3RoaXMuX1EoKX0ke3RoaXMuX25Db2RlKCduYW1lJywgdW5kZWZpbmVkKX0ke3RoaXMuX1EoKX0gJHt0aGlzLl9fZmllbGRHcm91cHMubmFtZX1gOwoKCQl9CgoJCWlmIChzcWwuZW5kc1dpdGgoIndoZXJlIDE9MSIpKSB7CgkJCS8vIHNxbCA9IHNxbC5yZXBsYWNlKCJ3aGVyZSAxPTEiLCAid2hlcmUgMT0wIik7CgkJfSBlbHNlIHsKCQkJc3FsID0gc3FsLnJlcGxhY2UoIndoZXJlIDE9MSBhbmQgIiwgIndoZXJlICIpOwoJCX0KCgkJc3FsID0gdHlwZW9mKHNxbEZvcm1hdHRlcikgIT09ICd1bmRlZmluZWQnID8gc3FsRm9ybWF0dGVyLmZvcm1hdChzcWwpIDogc3FsOwoJCXRoaXMubG9nKHVuZGVmaW5lZCwgJ190b1NlbGVjdFNRTCcsICdFbnRpdHlPYmplY3QnLCAwLCBzcWwpOwoKCQlyZXR1cm4gc3FsOwoJfQoKCV90b1BhdGhzKCkgewoJCWxldCByZXQgPSB0aGlzLl9fZXhwb3J0KHt9LCB7CgkJCV9USElTOiBvYmogPT4ge30sCgoJCX0sICJfdG9QYXRocyIpOwoJCS8vIHJldHVybiByZXQ7CgkJcmV0dXJuIE9iamVjdC5rZXlzKHJldCkubWFwKGsgPT4gKHsKCQkJW2tdOiByZXRba10KCQl9KSk7Cgl9CgoJX3RvVXBkYXRlU1FMKGZpZWxkcykgewoJCWxldCByZXRGaWVsZHMgPSB0aGlzLl90b0ZpZWxkc1NRTChmaWVsZHMpLm1hcChmID0+IHRoaXMuX1EoKSArIGYucmVwbGFjZSgvXC4vZywgJycpICsgdGhpcy5fUSgpKS5qb2luKCcsICcpOwoJCWxldCBzcWwgPSBgdXBkYXRlICR7dGhpcy5fUSgpfSR7dGhpcy5fbkNvZGUoKX0ke3RoaXMuX1EoKX0gc2V0IGAgKyBPYmplY3QuZW50cmllcyh0aGlzLl90b0RCT2JqZWN0KGZpZWxkcykpLm1hcCh2ID0+IHRoaXMuX1EoKSArIHZbMF0gKyB0aGlzLl9RKCkgKyAiPSIgKyB2WzFdKSArIGAgd2hlcmUgJHt0aGlzLl9RKCl9JHt0aGlzLl9fY29uZmlnKCdpZEZpZWxkJywgJ19faWQnKX0ke3RoaXMuX1EoKX09JyR7dGhpcy5JZH0nYDsgLy9gIHJldHVybmluZyAke3JldEZpZWxkc31gOwoJCXRoaXMubG9nKHVuZGVmaW5lZCwgJ190b1VwZGF0ZVNRTCcsICdFbnRpdHlPYmplY3QnLCAwLCBzcWwpOwoJCXJldHVybiBzcWw7Cgl9CgoJX3RvSW5zZXJ0U1FMKGZpZWxkcykgewoJCWxldCBvYmogPSB0aGlzLl90b0RCT2JqZWN0KGZpZWxkcyk7CgkJbGV0IHNxbCA9IGBpbnNlcnQgaW50byAke3RoaXMuX1EoKX0ke3RoaXMuX25Db2RlKCl9JHt0aGlzLl9RKCl9IChgICsgT2JqZWN0LmtleXMob2JqKS5tYXAoayA9PiB0aGlzLl9RKCkgKyBrICsgdGhpcy5fUSgpKSArICIpIHZhbHVlcyAoIiArIE9iamVjdC52YWx1ZXMob2JqKSArIGApYDsKCQl0aGlzLmxvZyh1bmRlZmluZWQsICdfdG9JbnNlcnRTUUwnLCAnRW50aXR5T2JqZWN0JywgMCwgc3FsKTsKCQlyZXR1cm4gc3FsOwoJfQoKCV9jb3B5RnJvbShvYmopIHsKCQlpZiAoIW9iaikgcmV0dXJuIG51bGw7CgkJcmV0dXJuIHRoaXMuX3JldmVydChvYmopOwoJfQoKCWFzeW5jIF9zdG9yZUVudGl0eUNsYXNzKGRlcHRoKSB7CgkJdHJ5IHsKCQkJaWYgKHR5cGVvZihkZXB0aCkgPT09ICJ1bmRlZmluZWQiKSBkZXB0aCA9IHRoaXMuX19jb25maWcoImNyZWF0ZSIpOwoJCQlpZiAoIWRlcHRoKSByZXR1cm47CgoJCQlsb3R0by5fc3RvcmVFbnRpdHlDbGFzcyA9IGxvdHRvLl9zdG9yZUVudGl0eUNsYXNzIHx8IHt9OwoJCQlpZiAobG90dG8uX3N0b3JlRW50aXR5Q2xhc3MuQ29udGVudCkgcmV0dXJuOwoJCQlsb3R0by5fc3RvcmVFbnRpdHlDbGFzcy5Db250ZW50ID0gdHJ1ZTsKCgkJCXRoaXMubG9nKHVuZGVmaW5lZCwgJ19zdG9yZUVudGl0eUNsYXNzJywgJ0VudGl0eU9iamVjdCcsIDAsIGBzdG9yaW5nICcke3RoaXMuVG9vbC50eXBlLm5hbWV9JyBtb2RlbCB3aXRoIGRlcHRoICR7ZGVwdGh9YCk7CgoJCQlpZiAodGhpcy5Ub29sLnR5cGUubmFtZSA9PSAiRmlsZVN5c3RlbSIpIHsKCgkJCX0KCgkJCWlmICh0aGlzLlRvb2wudHlwZS5uYW1lID09ICJHaXRIdWIiKSB7CgoJCQl9CgoJCX0gY2F0Y2ggKGV4KSB7CgkJCXRoaXMubG9nKHVuZGVmaW5lZCwgJ19zdG9yZUVudGl0eUNsYXNzJywgJ0VudGl0eU9iamVjdCcsIDIsIGV4KTsKCQl9CgkJcmV0dXJuIHRoaXM7Cgl9CgoJYXN5bmMgRFNDb25uZWN0KHRvb2wgPSB0aGlzLlRvb2wpIHsKCgkJdHJ5IHsKCQkJaWYgKCF0b29sKSB7CgkJCQl0aGlzLmxvZyh1bmRlZmluZWQsICdEU0Nvbm5lY3QnLCAnRW50aXR5T2JqZWN0JywgMiwgIlRvb2wgaXMgbnVsbCIsIHRoaXMuVG9vbHMubGVuZ3RoLCBsb3R0by5Ub29scy5sZW5ndGgpOwoJCQkJcmV0dXJuOwoJCQl9IGVsc2UgaWYgKCF0b29sLnR5cGUpIHsKCQkJCXRoaXMubG9nKHVuZGVmaW5lZCwgJ0RTQ29ubmVjdCcsICdFbnRpdHlPYmplY3QnLCAyLCAiVG9vbC50eXBlIGlzIG51bGwiLCB0b29sLCB0aGlzLlRvb2xzLmxlbmd0aCwgbG90dG8uVG9vbHMubGVuZ3RoKTsKCQkJCXJldHVybjsKCQkJfSBlbHNlIGlmICh0eXBlb2YodG9vbC5kYikgIT09ICJ1bmRlZmluZWQiKSB7CgkJCQl0aGlzLmxvZyh1bmRlZmluZWQsICdEU0Nvbm5lY3QnLCAnRW50aXR5T2JqZWN0JywgMCwgIlRvb2wgYWxyZWFkeSBjb25uZWN0ZWQhIik7CgkJCQlyZXR1cm47CgkJCX0gZWxzZSBpZiAobG90dG8uX25vZGUgJiYgLypsb3R0by5fbm9kZS5fcGFyZW50X3NldCAmJiAqLyBsb3R0by5fbm9kZS5wYXJlbnQoKS5fc2FtZU5vZGUobG90dG8uX25vZGUucGFyZW50KCkpKSB7CgkJCQl0aGlzLmxvZyh1bmRlZmluZWQsICdEU0Nvbm5lY3QnLCAnRW50aXR5T2JqZWN0JywgMCwgIk5vZGUgaGFzIGEgdmFsaWQgcGFyZW50LCBubyBsb2NhbCBTUUwgcG9zc2libGUiKTsKCQkJCXJldHVybjsKCQkJfQoKCQkJdG9vbC5fX2RtbFN0YXRlbWVudHMgPSB0b29sLl9fZG1sU3RhdGVtZW50cyB8fCBbXTsKCgkJCWlmICh0b29sLnR5cGUubmFtZSA9PSAiRmlsZVN5c3RlbSIpIHsKCgkJCQlhd2FpdCB0aGlzLl9zdG9yZUVudGl0eUNsYXNzKCk7CgkJCX0KCgkJCWlmICh0b29sLnR5cGUubmFtZSA9PSAiR2l0SHViIikgewoKCQkJCWF3YWl0IHRoaXMuX3N0b3JlRW50aXR5Q2xhc3MoKTsKCQkJfQoKCQl9IGNhdGNoIChleCkgewoJCQl0aGlzLmxvZyh1bmRlZmluZWQsICdEU0Nvbm5lY3QnLCAnRW50aXR5T2JqZWN0JywgMiwgZXgpOwoJCX0KCQlyZXR1cm4gdGhpczsKCgl9CgkvKiBFbmQ6IFV0aWwgZnVuY3Rpb25zICovCgoJX21hdGNoZXMocXVlcnkpIHsKCQl0cnkgewoJCQlpZiAoIXF1ZXJ5IHx8ICFxdWVyeS5FbnRpdHlDbGFzcyB8fCBxdWVyeS5FbnRpdHlDbGFzcy5OYW1lICE9ICJDb250ZW50IikgcmV0dXJuIGZhbHNlOwoKCQkJbGV0IG9NYXRjaCA9IHRoaXMuX19leHBvcnQoe30sIHsKCQkJCUZ1bGw6IHRydWUsCgkJCQlOdWxsOiB0cnVlLAoJCQkJSWQ6IChvYmosIHYpID0+IG9iai5faWQgPSB0aGlzLklkID09IHF1ZXJ5LklkLAoKCQkJCWFjdGl2ZTogKG9iaiwgdikgPT4gewoKCQkJCQlvYmouYWN0aXZlID0gdiA9PSBxdWVyeS5hY3RpdmUoKTsKCgkJCQkJaWYgKAoJCQkJCQkodGhpcy5fYWN0aXZlX3NldCAmJiAhcXVlcnkuX2FjdGl2ZV9zZXQpIHx8CgkJCQkJCWZhbHNlCgkJCQkJKSBvYmouYWN0aXZlID0gdHJ1ZTsKCgkJCQkJaWYgKAoJCQkJCQkoIXRoaXMuX2FjdGl2ZV9zZXQgJiYgcXVlcnkuX2FjdGl2ZV9zZXQpIHx8CgoJCQkJCQlmYWxzZQoJCQkJCSkgb2JqLmFjdGl2ZSA9IGZhbHNlOwoJCQkJfSwKCgkJCQllbmFibGVkOiAob2JqLCB2KSA9PiB7CgoJCQkJCW9iai5lbmFibGVkID0gdiA9PSBxdWVyeS5lbmFibGVkKCk7CgoJCQkJCWlmICgKCQkJCQkJKHRoaXMuX2VuYWJsZWRfc2V0ICYmICFxdWVyeS5fZW5hYmxlZF9zZXQpIHx8CgkJCQkJCWZhbHNlCgkJCQkJKSBvYmouZW5hYmxlZCA9IHRydWU7CgoJCQkJCWlmICgKCQkJCQkJKCF0aGlzLl9lbmFibGVkX3NldCAmJiBxdWVyeS5fZW5hYmxlZF9zZXQpIHx8CgoJCQkJCQlmYWxzZQoJCQkJCSkgb2JqLmVuYWJsZWQgPSBmYWxzZTsKCQkJCX0sCgoJCQkJY29kZTogKG9iaiwgdikgPT4gewoKCQkJCQlvYmouY29kZSA9IHYgPT0gcXVlcnkuY29kZSgpOwoKCQkJCQlpZiAoCgkJCQkJCSh0aGlzLl9jb2RlX3NldCAmJiAhcXVlcnkuX2NvZGVfc2V0KSB8fAoJCQkJCQlmYWxzZQoJCQkJCSkgb2JqLmNvZGUgPSB0cnVlOwoKCQkJCQlpZiAoCgkJCQkJCSghdGhpcy5fY29kZV9zZXQgJiYgcXVlcnkuX2NvZGVfc2V0KSB8fAoKCQkJCQkJZmFsc2UKCQkJCQkpIG9iai5jb2RlID0gZmFsc2U7CgkJCQl9LAoKCQkJCW9yZGVyOiAob2JqLCB2KSA9PiB7CgoJCQkJCW9iai5vcmRlciA9IHYgPT0gcXVlcnkub3JkZXIoKTsKCgkJCQkJaWYgKAoJCQkJCQkodGhpcy5fb3JkZXJfc2V0ICYmICFxdWVyeS5fb3JkZXJfc2V0KSB8fAoJCQkJCQlmYWxzZQoJCQkJCSkgb2JqLm9yZGVyID0gdHJ1ZTsKCgkJCQkJaWYgKAoJCQkJCQkoIXRoaXMuX29yZGVyX3NldCAmJiBxdWVyeS5fb3JkZXJfc2V0KSB8fAoKCQkJCQkJZmFsc2UKCQkJCQkpIG9iai5vcmRlciA9IGZhbHNlOwoJCQkJfSwKCgkJCQlkYXRlOiAob2JqLCB2KSA9PiB7CgoJCQkJCW9iai5kYXRlID0gdiA9PSBxdWVyeS5kYXRlKCk7CgoJCQkJCWlmICgKCQkJCQkJKHRoaXMuX2RhdGVfc2V0ICYmICFxdWVyeS5fZGF0ZV9zZXQpIHx8CgkJCQkJCWZhbHNlCgkJCQkJKSBvYmouZGF0ZSA9IHRydWU7CgoJCQkJCWlmICgKCQkJCQkJKCF0aGlzLl9kYXRlX3NldCAmJiBxdWVyeS5fZGF0ZV9zZXQpIHx8CgoJCQkJCQlmYWxzZQoJCQkJCSkgb2JqLmRhdGUgPSBmYWxzZTsKCQkJCX0sCgoJCQkJbmFtZTogKG9iaiwgdikgPT4gewoKCQkJCQlvYmoubmFtZSA9IHYgPT0gcXVlcnkubmFtZSgpOwoKCQkJCQlpZiAoCgkJCQkJCSh0aGlzLl9uYW1lX3NldCAmJiAhcXVlcnkuX25hbWVfc2V0KSB8fAoJCQkJCQlmYWxzZQoJCQkJCSkgb2JqLm5hbWUgPSB0cnVlOwoKCQkJCQlpZiAoCgkJCQkJCSghdGhpcy5fbmFtZV9zZXQgJiYgcXVlcnkuX25hbWVfc2V0KSB8fAoKCQkJCQkJZmFsc2UKCQkJCQkpIG9iai5uYW1lID0gZmFsc2U7CgkJCQl9LAoKCQkJCXJlbWFyazogKG9iaiwgdikgPT4gewoKCQkJCQlvYmoucmVtYXJrID0gdiA9PSBxdWVyeS5yZW1hcmsoKTsKCgkJCQkJaWYgKAoJCQkJCQkodGhpcy5fcmVtYXJrX3NldCAmJiAhcXVlcnkuX3JlbWFya19zZXQpIHx8CgkJCQkJCWZhbHNlCgkJCQkJKSBvYmoucmVtYXJrID0gdHJ1ZTsKCgkJCQkJaWYgKAoJCQkJCQkoIXRoaXMuX3JlbWFya19zZXQgJiYgcXVlcnkuX3JlbWFya19zZXQpIHx8CgoJCQkJCQlmYWxzZQoJCQkJCSkgb2JqLnJlbWFyayA9IGZhbHNlOwoJCQkJfSwKCgkJCQljb250ZW50OiAob2JqLCB2KSA9PiB7CgoJCQkJCW9iai5jb250ZW50ID0gdiA9PSBxdWVyeS5jb250ZW50KCk7CgoJCQkJCWlmICgKCQkJCQkJKHRoaXMuX2NvbnRlbnRfc2V0ICYmICFxdWVyeS5fY29udGVudF9zZXQpIHx8CgkJCQkJCWZhbHNlCgkJCQkJKSBvYmouY29udGVudCA9IHRydWU7CgoJCQkJCWlmICgKCQkJCQkJKCF0aGlzLl9jb250ZW50X3NldCAmJiBxdWVyeS5fY29udGVudF9zZXQpIHx8CgoJCQkJCQlmYWxzZQoJCQkJCSkgb2JqLmNvbnRlbnQgPSBmYWxzZTsKCQkJCX0sCgoJCQl9LCAiX21hdGNoZXMiKTsKCgkJCXRoaXMubG9nKHVuZGVmaW5lZCwgJ19tYXRjaGVzJywgJ0VudGl0eU9iamVjdCcsIDAsIG9NYXRjaCk7CgoJCQlyZXR1cm4gT2JqZWN0LmtleXMob01hdGNoKS5ldmVyeShrID0+IG9NYXRjaFtrXSk7CgkJfSBjYXRjaCAoZXgpIHsKCQkJdGhpcy5sb2codW5kZWZpbmVkLCAnX21hdGNoZXMnLCAnRW50aXR5T2JqZWN0JywgMiwgZXgpOwoJCX0KCX0KCglfbWF0Y2hpbmcocXVlcnkpIHsKCQl0cnkgewoJCQlsZXQgcmV0ID0gW107CgoJCQlsZXQgbWF0Y2hlcyA9IHRoaXMuX19leHBvcnQoe30sIHsKCgkJCX0sICJfbWF0Y2hpbmciKTsKCgkJCXRoaXMubG9nKHVuZGVmaW5lZCwgJ19tYXRjaGluZycsICdFbnRpdHlPYmplY3QnLCAwLCAibWF0Y2hlcyIsIG1hdGNoZXMpOwoKCQkJcmV0ID0gWy4uLm5ldyBTZXQoT2JqZWN0LmtleXMobWF0Y2hlcykubWFwKGsgPT4gbWF0Y2hlc1trXSkuZmxhdCgpKV0uZmlsdGVyKG0gPT4gbSAhPSBxdWVyeSk7CgoJCQl0aGlzLmxvZyh1bmRlZmluZWQsICdfbWF0Y2hpbmcnLCAnRW50aXR5T2JqZWN0JywgMCwgInJldCIsIHJldCk7CgkJCXJldHVybiByZXQ7CgkJfSBjYXRjaCAoZXgpIHsKCQkJdGhpcy5sb2codW5kZWZpbmVkLCAnX21hdGNoaW5nJywgJ0VudGl0eU9iamVjdCcsIDIsIGV4KTsKCQl9Cgl9CgoJX2RlUmVmZXJlbmNlKHJvb3QpIHsKCQl0cnkgewoJCQlpZiAoIXJvb3QpIHJvb3QgPSB0aGlzOwoKCQkJbGV0IGlzUXVlcnkgPSB0cnVlCgoJCQkJJiYKCQkJCSh0aGlzLl9hY3RpdmVfc2V0ID8gZmFsc2UgOiB0cnVlKQoKCQkJCSYmCgkJCQkodGhpcy5fZW5hYmxlZF9zZXQgPyBmYWxzZSA6IHRydWUpCgoJCQkJJiYKCQkJCSh0aGlzLl9jb2RlX3NldCA/IGZhbHNlIDogdHJ1ZSkKCgkJCQkmJgoJCQkJKHRoaXMuX29yZGVyX3NldCA/IGZhbHNlIDogdHJ1ZSkKCgkJCQkmJgoJCQkJKHRoaXMuX2RhdGVfc2V0ID8gZmFsc2UgOiB0cnVlKQoKCQkJCSYmCgkJCQkodGhpcy5fbmFtZV9zZXQgPyBmYWxzZSA6IHRydWUpCgoJCQkJJiYKCQkJCSh0aGlzLl9yZW1hcmtfc2V0ID8gZmFsc2UgOiB0cnVlKQoKCQkJCSYmCgkJCQkodGhpcy5fY29udGVudF9zZXQgPyBmYWxzZSA6IHRydWUpOwoKCQkJaWYgKHJvb3QgIT0gdGhpcyAmJiBpc1F1ZXJ5KSB7CgkJCQlsZXQgbXlNYXRjaGVzID0gcm9vdC5fbWF0Y2hpbmcodGhpcyk7CgkJCQlpZiAoIW15TWF0Y2hlcy5sZW5ndGgpIHJldHVybiB0aGlzOwoJCQkJdGhpcy5sb2codW5kZWZpbmVkLCAnX2RlUmVmZXJlbmNlJywgJ0VudGl0eU9iamVjdCcsIDAsICJRdWVyeSIsIG15TWF0Y2hlcy5sZWd0aCk7CgkJCQlyZXR1cm4gbXlNYXRjaGVzWzBdOwoJCQl9CgoJCQl0aGlzLl9fZXhwb3J0KHt9LCB7CgoJCQl9LCAiX2RlUmVmZXJlbmNlIik7CgoJCQlyZXR1cm4gdGhpczsKCQl9IGNhdGNoIChleCkgewoJCQl0aGlzLmxvZyh1bmRlZmluZWQsICdfZGVSZWZlcmVuY2UnLCAnRW50aXR5T2JqZWN0JywgMiwgZXgpOwoJCX0KCX0KCglfZnJvbURvY3VtZW50KG9iaiwgYlRvb2wsIGJOb051bGwpIHsKCQlpZiAoIW9iaikgcmV0dXJuIHRoaXM7CgkJaWYgKG9iai5fZnJvbURvY3VtZW50KSByZXR1cm4gb2JqOwoKCQlpZiAodHlwZW9mKG9iaikgPT09ICdzdHJpbmcnKSB7CgkJCXRyeSB7CgkJCQlvYmogPSBKU09OLnBhcnNlKG9iaik7CgkJCX0gY2F0Y2ggKGV4KSB7CgkJCQl0aGlzLmxvZyh1bmRlZmluZWQsICdfZnJvbURvY3VtZW50JywgJ0VudGl0eU9iamVjdCcsIDEsICJJbnZhbGlkIEpTT04iLCBvYmopOwoJCQl9CgkJfQoKCQl0aGlzLl9faW1wb3J0KG9iaiwgewoJCQlfbWFwOiBiVG9vbCwKCQkJX1RISVM6IG9iaiA9PiB0aGlzLlRISVMob2JqLlRISVMsIG9iai5PUEVSQVRPUlMgPyBvYmouT1BFUkFUT1JTLlRISVMgOiB1bmRlZmluZWQpLAoJCQlJZDogb2JqID0+IHsKCQkJCXRoaXMuSWQgPSBvYmpbdGhpcy5fX2NvbmZpZygnaWRGaWVsZCcsICdfX2lkJywgewoJCQkJCXRvb2w6IG9iai5fX3Rvb2wKCQkJCX0pXTsKCQkJCWlmIChvYmouX190b29sKSB7CgkJCQkJdHJ5IHsKCQkJCQkJdGhpcy5Ub29sID0gb2JqLl9fdG9vbDsKCQkJCQl9IGNhdGNoIChleCkgewoJCQkJCQl0aGlzLmxvZyh1bmRlZmluZWQsICdfZnJvbURvY3VtZW50JywgJ0VudGl0eU9iamVjdCcsIDIsIGV4KTsKCQkJCQl9CgkJCQl9CgkJCX0sCgoJCQlhY3RpdmU6IChvYmosIHYsIGVhQ29kZSA9IChiVG9vbCA/IHRoaXMuX25Db2RlKCdhY3RpdmUnLCB1bmRlZmluZWQpIDogImFjdGl2ZSIpKSA9PiB7CgkJCQlpZiAob2JqLk9QRVJBVE9SUyAmJiBvYmouT1BFUkFUT1JTW2VhQ29kZV0pIHsKCQkJCQl0aGlzLl9hY3RpdmVfY29vcCA9IG9iai5PUEVSQVRPUlNbZWFDb2RlXTsKCQkJCX0KCgkJCQlsZXQgcmVmID0gb2JqW2VhQ29kZV07CgkJCQlpZiAodHlwZW9mKHJlZikgPT09ICd1bmRlZmluZWQnKSByZXR1cm47CgkJCQlpZiAoYk5vTnVsbCAmJiByZWYgPT09IG51bGwpIHJldHVybjsKCgkJCQl0aGlzLmFjdGl2ZShyZWYpOwoKCQkJfSwKCgkJCWVuYWJsZWQ6IChvYmosIHYsIGVhQ29kZSA9IChiVG9vbCA/IHRoaXMuX25Db2RlKCdlbmFibGVkJywgdW5kZWZpbmVkKSA6ICJlbmFibGVkIikpID0+IHsKCQkJCWlmIChvYmouT1BFUkFUT1JTICYmIG9iai5PUEVSQVRPUlNbZWFDb2RlXSkgewoJCQkJCXRoaXMuX2VuYWJsZWRfY29vcCA9IG9iai5PUEVSQVRPUlNbZWFDb2RlXTsKCQkJCX0KCgkJCQlsZXQgcmVmID0gb2JqW2VhQ29kZV07CgkJCQlpZiAodHlwZW9mKHJlZikgPT09ICd1bmRlZmluZWQnKSByZXR1cm47CgkJCQlpZiAoYk5vTnVsbCAmJiByZWYgPT09IG51bGwpIHJldHVybjsKCgkJCQl0aGlzLmVuYWJsZWQocmVmKTsKCgkJCX0sCgoJCQljb2RlOiAob2JqLCB2LCBlYUNvZGUgPSAoYlRvb2wgPyB0aGlzLl9uQ29kZSgnY29kZScsIHVuZGVmaW5lZCkgOiAiY29kZSIpKSA9PiB7CgkJCQlpZiAob2JqLk9QRVJBVE9SUyAmJiBvYmouT1BFUkFUT1JTW2VhQ29kZV0pIHsKCQkJCQl0aGlzLl9jb2RlX2Nvb3AgPSBvYmouT1BFUkFUT1JTW2VhQ29kZV07CgkJCQl9CgoJCQkJbGV0IHJlZiA9IG9ialtlYUNvZGVdOwoJCQkJaWYgKHR5cGVvZihyZWYpID09PSAndW5kZWZpbmVkJykgcmV0dXJuOwoJCQkJaWYgKGJOb051bGwgJiYgcmVmID09PSBudWxsKSByZXR1cm47CgoJCQkJdGhpcy5jb2RlKHJlZik7CgoJCQl9LAoKCQkJb3JkZXI6IChvYmosIHYsIGVhQ29kZSA9IChiVG9vbCA/IHRoaXMuX25Db2RlKCdvcmRlcicsIHVuZGVmaW5lZCkgOiAib3JkZXIiKSkgPT4gewoJCQkJaWYgKG9iai5PUEVSQVRPUlMgJiYgb2JqLk9QRVJBVE9SU1tlYUNvZGVdKSB7CgkJCQkJdGhpcy5fb3JkZXJfY29vcCA9IG9iai5PUEVSQVRPUlNbZWFDb2RlXTsKCQkJCX0KCgkJCQlsZXQgcmVmID0gb2JqW2VhQ29kZV07CgkJCQlpZiAodHlwZW9mKHJlZikgPT09ICd1bmRlZmluZWQnKSByZXR1cm47CgkJCQlpZiAoYk5vTnVsbCAmJiByZWYgPT09IG51bGwpIHJldHVybjsKCgkJCQl0aGlzLm9yZGVyKHJlZik7CgoJCQl9LAoKCQkJZGF0ZTogKG9iaiwgdiwgZWFDb2RlID0gKGJUb29sID8gdGhpcy5fbkNvZGUoJ2RhdGUnLCB1bmRlZmluZWQpIDogImRhdGUiKSkgPT4gewoJCQkJaWYgKG9iai5PUEVSQVRPUlMgJiYgb2JqLk9QRVJBVE9SU1tlYUNvZGVdKSB7CgkJCQkJdGhpcy5fZGF0ZV9jb29wID0gb2JqLk9QRVJBVE9SU1tlYUNvZGVdOwoJCQkJfQoKCQkJCWxldCByZWYgPSBvYmpbZWFDb2RlXTsKCQkJCWlmICh0eXBlb2YocmVmKSA9PT0gJ3VuZGVmaW5lZCcpIHJldHVybjsKCQkJCWlmIChiTm9OdWxsICYmIHJlZiA9PT0gbnVsbCkgcmV0dXJuOwoKCQkJCWlmICh0aGlzLlRvb2wudHlwZS5uYW1lID09ICJTcWxEQiIpIHsKCQkJCQlpZiAodHlwZW9mKG1vbWVudCkgIT09ICJ1bmRlZmluZWQiICYmIHR5cGVvZih0aGlzLlRvb2wuc3lzX3Byb3BlcnRpZXMpICE9PSAidW5kZWZpbmVkIikgewoJCQkJCQlyZWYgPSBtb21lbnQucGFyc2Vab25lKHJlZiwgdGhpcy5Ub29sLnN5c19wcm9wZXJ0aWVzWyJnbGlkZS5zeXMuZGF0ZV9mb3JtYXQiXSArICIgIiArIHRoaXMuVG9vbC5zeXNfcHJvcGVydGllc1siZ2xpZGUuc3lzLnRpbWVfZm9ybWF0Il0sIHRoaXMuVG9vbC5zeXNfcHJvcGVydGllc1siZ2xpZGUuc3lzLmRlZmF1bHQudHoiXSkudG9EYXRlKCk7CgkJCQkJfSBlbHNlIHsKCQkJCQkJcmVmID0gbmV3IERhdGUocmVmKTsKCQkJCQl9CgkJCQl9IGVsc2UgewoJCQkJCWlmICh0eXBlb2YocmVmKSA9PT0gJ3N0cmluZycpIHsKCQkJCQkJaWYgKHJlZi5pbmRleE9mKCdUJykgPiAwKSB7CgkJCQkJCQlyZWYgPSBEYXRlLnBhcnNlKHJlZik7CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQlyZWYgPSBEYXRlLnBhcnNlKHJlZiArICIgR01UIik7CgkJCQkJCX0KCQkJCQl9CgkJCQkJcmVmID0gbmV3IERhdGUocmVmKTsKCQkJCX0KCQkJCXRoaXMuZGF0ZShyZWYpOwoKCQkJfSwKCgkJCW5hbWU6IChvYmosIHYsIGVhQ29kZSA9IChiVG9vbCA/IHRoaXMuX25Db2RlKCduYW1lJywgdW5kZWZpbmVkKSA6ICJuYW1lIikpID0+IHsKCQkJCWlmIChvYmouT1BFUkFUT1JTICYmIG9iai5PUEVSQVRPUlNbZWFDb2RlXSkgewoJCQkJCXRoaXMuX25hbWVfY29vcCA9IG9iai5PUEVSQVRPUlNbZWFDb2RlXTsKCQkJCX0KCgkJCQlsZXQgcmVmID0gb2JqW2VhQ29kZV07CgkJCQlpZiAodHlwZW9mKHJlZikgPT09ICd1bmRlZmluZWQnKSByZXR1cm47CgkJCQlpZiAoYk5vTnVsbCAmJiByZWYgPT09IG51bGwpIHJldHVybjsKCgkJCQl0aGlzLm5hbWUocmVmKTsKCgkJCX0sCgoJCQlyZW1hcms6IChvYmosIHYsIGVhQ29kZSA9IChiVG9vbCA/IHRoaXMuX25Db2RlKCdyZW1hcmsnLCB1bmRlZmluZWQpIDogInJlbWFyayIpKSA9PiB7CgkJCQlpZiAob2JqLk9QRVJBVE9SUyAmJiBvYmouT1BFUkFUT1JTW2VhQ29kZV0pIHsKCQkJCQl0aGlzLl9yZW1hcmtfY29vcCA9IG9iai5PUEVSQVRPUlNbZWFDb2RlXTsKCQkJCX0KCgkJCQlsZXQgcmVmID0gb2JqW2VhQ29kZV07CgkJCQlpZiAodHlwZW9mKHJlZikgPT09ICd1bmRlZmluZWQnKSByZXR1cm47CgkJCQlpZiAoYk5vTnVsbCAmJiByZWYgPT09IG51bGwpIHJldHVybjsKCgkJCQl0aGlzLnJlbWFyayhyZWYpOwoKCQkJfSwKCgkJCWNvbnRlbnQ6IChvYmosIHYsIGVhQ29kZSA9IChiVG9vbCA/IHRoaXMuX25Db2RlKCdjb250ZW50JywgdW5kZWZpbmVkKSA6ICJjb250ZW50IikpID0+IHsKCQkJCWlmIChvYmouT1BFUkFUT1JTICYmIG9iai5PUEVSQVRPUlNbZWFDb2RlXSkgewoJCQkJCXRoaXMuX2NvbnRlbnRfY29vcCA9IG9iai5PUEVSQVRPUlNbZWFDb2RlXTsKCQkJCX0KCgkJCQlsZXQgcmVmID0gb2JqW2VhQ29kZV07CgkJCQlpZiAodHlwZW9mKHJlZikgPT09ICd1bmRlZmluZWQnKSByZXR1cm47CgkJCQlpZiAoYk5vTnVsbCAmJiByZWYgPT09IG51bGwpIHJldHVybjsKCgkJCQl0aGlzLmNvbnRlbnQocmVmKTsKCgkJCX0sCgoJCX0sICJfZnJvbURvY3VtZW50Iik7CgoJCXJldHVybiB0aGlzOwoJfQoKCV90b0RvY3VtZW50KGJUb29sLCBiRnVsbCwgYk51bGwpIHsKCQlsZXQgcmV0ID0ge307CgoJCWlmICghYlRvb2wpIHsKCQkJcmV0Ll9fZ2VuZXJhdGVkID0gbmV3IERhdGUoKTsKCQkJaWYgKHRoaXMuVG9vbC5uYW1lKSB7CgkJCQlyZXQuX190b29sID0gewoJCQkJCW5hbWU6IHRoaXMuVG9vbC5uYW1lLAoJCQkJCXR5cGU6IHsKCQkJCQkJbmFtZTogdGhpcy5Ub29sLnR5cGUubmFtZSwKCQkJCQl9CgkJCQl9OwoJCQl9CgkJCWlmIChsb3R0by5fbm9kZSkgewoJCQkJcmV0Ll9fbm9kZSA9IHsKCQkJCQljb2RlOiBsb3R0by5fbm9kZS5jb2RlKCkKCQkJCX07CgkJCX0KCQl9CgoJCXJldHVybiB0aGlzLl9fZXhwb3J0KHJldCwgewoJCQlGdWxsOiBiRnVsbCwKCQkJTnVsbDogYk51bGwsCgkJCV9tYXA6IGJUb29sLAoJCQlfVEhJUzogKG9iaiwgdikgPT4gewoJCQkJaWYgKGJUb29sKSByZXR1cm47CgkJCQlvYmouVEhJUyA9IHRoaXMuX1RISVMubWFwKHQgPT4gdC5fdG9Eb2N1bWVudChiVG9vbCwgYkZ1bGwsIGJOdWxsKSk7CgkJCQlvYmouT1BFUkFUT1JTID0gb2JqLk9QRVJBVE9SUyB8fCB7fTsKCQkJCW9iai5PUEVSQVRPUlMuVEhJUyA9IHRoaXMuX1RISVNfY29vcDsKCQkJfSwKCQkJSWQ6IChvYmosIHYpID0+IG9ialt0aGlzLl9fY29uZmlnKCdpZEZpZWxkJywgJ19faWQnKV0gPSB2LAoKCQkJImFjdGl2ZSI6IChvYmosIHYsIGVhQ29kZSA9IChiVG9vbCA/IHRoaXMuX25Db2RlKCdhY3RpdmUnLCB1bmRlZmluZWQpIDogImFjdGl2ZSIpKSA9PiB7CgoJCQkJb2JqW2VhQ29kZV0gPSB2OwoKCQkJCWlmICh0aGlzLl9hY3RpdmVfY29vcCkgewoJCQkJCW9iai5PUEVSQVRPUlMgPSBvYmouT1BFUkFUT1JTIHx8IHt9OwoJCQkJCW9iai5PUEVSQVRPUlNbZWFDb2RlXSA9IHRoaXMuX2FjdGl2ZV9jb29wOwoJCQkJfQoJCQl9LAoKCQkJImVuYWJsZWQiOiAob2JqLCB2LCBlYUNvZGUgPSAoYlRvb2wgPyB0aGlzLl9uQ29kZSgnZW5hYmxlZCcsIHVuZGVmaW5lZCkgOiAiZW5hYmxlZCIpKSA9PiB7CgoJCQkJb2JqW2VhQ29kZV0gPSB2OwoKCQkJCWlmICh0aGlzLl9lbmFibGVkX2Nvb3ApIHsKCQkJCQlvYmouT1BFUkFUT1JTID0gb2JqLk9QRVJBVE9SUyB8fCB7fTsKCQkJCQlvYmouT1BFUkFUT1JTW2VhQ29kZV0gPSB0aGlzLl9lbmFibGVkX2Nvb3A7CgkJCQl9CgkJCX0sCgoJCQkiY29kZSI6IChvYmosIHYsIGVhQ29kZSA9IChiVG9vbCA/IHRoaXMuX25Db2RlKCdjb2RlJywgdW5kZWZpbmVkKSA6ICJjb2RlIikpID0+IHsKCgkJCQlvYmpbZWFDb2RlXSA9IHY7CgoJCQkJaWYgKHRoaXMuX2NvZGVfY29vcCkgewoJCQkJCW9iai5PUEVSQVRPUlMgPSBvYmouT1BFUkFUT1JTIHx8IHt9OwoJCQkJCW9iai5PUEVSQVRPUlNbZWFDb2RlXSA9IHRoaXMuX2NvZGVfY29vcDsKCQkJCX0KCQkJfSwKCgkJCSJvcmRlciI6IChvYmosIHYsIGVhQ29kZSA9IChiVG9vbCA/IHRoaXMuX25Db2RlKCdvcmRlcicsIHVuZGVmaW5lZCkgOiAib3JkZXIiKSkgPT4gewoKCQkJCW9ialtlYUNvZGVdID0gdjsKCgkJCQlpZiAodGhpcy5fb3JkZXJfY29vcCkgewoJCQkJCW9iai5PUEVSQVRPUlMgPSBvYmouT1BFUkFUT1JTIHx8IHt9OwoJCQkJCW9iai5PUEVSQVRPUlNbZWFDb2RlXSA9IHRoaXMuX29yZGVyX2Nvb3A7CgkJCQl9CgkJCX0sCgoJCQkiZGF0ZSI6IChvYmosIHYsIGVhQ29kZSA9IChiVG9vbCA/IHRoaXMuX25Db2RlKCdkYXRlJywgdW5kZWZpbmVkKSA6ICJkYXRlIikpID0+IHsKCgkJCQlvYmpbZWFDb2RlXSA9IHYgPyB2LnRvSVNPU3RyaW5nKCkgOiBudWxsOwoJCQkJaWYgKHRoaXMuVG9vbC50eXBlLm5hbWUgPT0gIlNlcnZpY2VOb3ciKSBvYmpbZWFDb2RlXSA9IG9ialtlYUNvZGVdLnJlcGxhY2UoL1wuWzAtOV0qWi9nLCAnJyk7CgoJCQkJaWYgKHRoaXMuX2RhdGVfY29vcCkgewoJCQkJCW9iai5PUEVSQVRPUlMgPSBvYmouT1BFUkFUT1JTIHx8IHt9OwoJCQkJCW9iai5PUEVSQVRPUlNbZWFDb2RlXSA9IHRoaXMuX2RhdGVfY29vcDsKCQkJCX0KCQkJfSwKCgkJCSJuYW1lIjogKG9iaiwgdiwgZWFDb2RlID0gKGJUb29sID8gdGhpcy5fbkNvZGUoJ25hbWUnLCB1bmRlZmluZWQpIDogIm5hbWUiKSkgPT4gewoKCQkJCW9ialtlYUNvZGVdID0gdjsKCgkJCQlpZiAodGhpcy5fbmFtZV9jb29wKSB7CgkJCQkJb2JqLk9QRVJBVE9SUyA9IG9iai5PUEVSQVRPUlMgfHwge307CgkJCQkJb2JqLk9QRVJBVE9SU1tlYUNvZGVdID0gdGhpcy5fbmFtZV9jb29wOwoJCQkJfQoJCQl9LAoKCQkJInJlbWFyayI6IChvYmosIHYsIGVhQ29kZSA9IChiVG9vbCA/IHRoaXMuX25Db2RlKCdyZW1hcmsnLCB1bmRlZmluZWQpIDogInJlbWFyayIpKSA9PiB7CgoJCQkJb2JqW2VhQ29kZV0gPSB2OwoKCQkJCWlmICh0aGlzLl9yZW1hcmtfY29vcCkgewoJCQkJCW9iai5PUEVSQVRPUlMgPSBvYmouT1BFUkFUT1JTIHx8IHt9OwoJCQkJCW9iai5PUEVSQVRPUlNbZWFDb2RlXSA9IHRoaXMuX3JlbWFya19jb29wOwoJCQkJfQoJCQl9LAoKCQkJImNvbnRlbnQiOiAob2JqLCB2LCBlYUNvZGUgPSAoYlRvb2wgPyB0aGlzLl9uQ29kZSgnY29udGVudCcsIHVuZGVmaW5lZCkgOiAiY29udGVudCIpKSA9PiB7CgoJCQkJb2JqW2VhQ29kZV0gPSB2OwoKCQkJCWlmICh0aGlzLl9jb250ZW50X2Nvb3ApIHsKCQkJCQlvYmouT1BFUkFUT1JTID0gb2JqLk9QRVJBVE9SUyB8fCB7fTsKCQkJCQlvYmouT1BFUkFUT1JTW2VhQ29kZV0gPSB0aGlzLl9jb250ZW50X2Nvb3A7CgkJCQl9CgkJCX0sCgoJCX0sICJfdG9Eb2N1bWVudCIsIGJUb29sLCBiRnVsbCwgYk51bGwpOwoJfQoKCWFzeW5jIGdldChuYW1lKSB7CgkJaWYgKCF0aGlzLklkKSByZXR1cm4gbnVsbDsKCQl2YXIgdCA9IG51bGw7CgkJJC5lYWNoKG5hbWUuc3BsaXQoJy4nKSwgKF8sIGYpID0+IHsKCQkJdCA9IHsKCQkJCUVudGl0eU9iamVjdDogdCA/IHsKCQkJCQlBY3RpdmU6IHRydWUsCgkJCQkJVmFsdWVFbnRpdGllczogW3RdCgkJCQl9IDogewoJCQkJCUFjdGl2ZTogdHJ1ZSwKCQkJCQlJZDogdGhpcy5JZAoJCQkJfSwKCQkJCUVudGl0eUF0dHJpYnV0ZTogewoJCQkJCU5hbWU6IGYsCgkJCQkJT1BFUkFUT1JTOiB7CgkJCQkJCU5hbWU6ICI9IgoJCQkJCX0KCQkJCX0KCQkJfTsKCQl9KTsKCQlyZXR1cm4gJC53aGVuKHRoaXMuc3IoKS5fKCJFbnRlcnByaXNlTWFuYWdlci5lbXNFbnRpdHlWYWx1ZUZpbmQiLCBudWxsLCB0KSkudGhlbihldiA9PiB7CgkJCXRoaXMubG9nKHVuZGVmaW5lZCwgJ2dldCcsICdFbnRpdHlPYmplY3QnLCAwLCBldik7CgkJCWlmIChldiA9PT0gbnVsbCkgcmV0dXJuIG51bGw7CgkJCWlmIChldi5FbnRpdHlBdHRyaWJ1dGUuSXNTdHJpbmcpIHJldHVybiBldi5TdHJpbmdWYWx1ZTsKCQkJaWYgKGV2LkVudGl0eUF0dHJpYnV0ZS5Jc0Zsb2F0KSByZXR1cm4gZXYuRmxvYXRWYWx1ZTsKCQkJaWYgKGV2LkVudGl0eUF0dHJpYnV0ZS5Jc0ludCkgcmV0dXJuIGV2LkludFZhbHVlOwoJCQlpZiAoZXYuRW50aXR5QXR0cmlidXRlLklzTG9uZykgcmV0dXJuIGV2LkxvbmdWYWx1ZTsKCQkJaWYgKGV2LkVudGl0eUF0dHJpYnV0ZS5Jc1RleHQpIHJldHVybiBldi5UZXh0VmFsdWU7CgkJCWlmIChldi5FbnRpdHlBdHRyaWJ1dGUuSXNCb29sKSByZXR1cm4gZXYuQm9vbFZhbHVlOwoKCQkJaWYgKCFldi5PYmplY3RWYWx1ZSkgcmV0dXJuIG51bGw7CgoJCQlyZXR1cm4gbmV3IGxvdHRvWyQuZ3JlcChsb3R0by5FbnRpdHlDbGFzc2VzLCBjID0+IGMuSWQgPT0gZXYuRW50aXR5QXR0cmlidXRlLkVudGl0eVR5cGVpZClbMF0uTmFtZS5yZXBsYWNlKC8gL2csICdfJyldKGV2Lk9iamVjdFZhbHVlLklkKTsKCQl9KTsKCX0KCgkvKiBTVEFSVDogc3IgZnVuY3Rpb24gY29waWVzICovCgoJLyogQ0xPTkU6OlNUQVJUOiBzci5fKCkgKi8KCV8oLi4ucGFyYW1zKSB7CgkJaWYgKHR5cGVvZih3aW5kb3cpICE9PSAidW5kZWZpbmVkIiAmJiB0eXBlb2Yod2luZG93LnNyKSAhPT0gInVuZGVmaW5lZCIpIHsKCQkJcmV0dXJuIHdpbmRvdy5zci5fKC4uLnBhcmFtcyk7CgkJfSBlbHNlIHsKCQkJcmV0dXJuIG5ldyBsb3R0by5Vc2VyKCkuXyguLi5wYXJhbXMpOwoJCX0KCX0KCS8qIENMT05FOjpFTkQgIDogc3IuXygpICovCgoJLyogQ0xPTkU6OlNUQVJUOiBzci5idWlsZFVSTCgpICovCglidWlsZFVSTCguLi5wYXJhbXMpIHsKCQlpZiAodHlwZW9mKHdpbmRvdykgIT09ICJ1bmRlZmluZWQiICYmIHR5cGVvZih3aW5kb3cuc3IpICE9PSAidW5kZWZpbmVkIikgewoJCQlyZXR1cm4gd2luZG93LnNyLmJ1aWxkVVJMKC4uLnBhcmFtcyk7CgkJfSBlbHNlIHsKCQkJcmV0dXJuIG5ldyBsb3R0by5Vc2VyKCkuYnVpbGRVUkwoLi4ucGFyYW1zKTsKCQl9Cgl9CgkvKiBDTE9ORTo6RU5EICA6IHNyLmJ1aWxkVVJMKCkgKi8KCgkvKiBDTE9ORTo6U1RBUlQ6IHNyLiRfUkVRVUVTVCgpICovCgkkX1JFUVVFU1QoLi4ucGFyYW1zKSB7CgkJaWYgKHR5cGVvZih3aW5kb3cpICE9PSAidW5kZWZpbmVkIiAmJiB0eXBlb2Yod2luZG93LnNyKSAhPT0gInVuZGVmaW5lZCIpIHsKCQkJcmV0dXJuIHdpbmRvdy5zci4kX1JFUVVFU1QoLi4ucGFyYW1zKTsKCQl9IGVsc2UgewoJCQlyZXR1cm4gbmV3IGxvdHRvLlVzZXIoKS4kX1JFUVVFU1QoLi4ucGFyYW1zKTsKCQl9Cgl9CgkvKiBDTE9ORTo6RU5EICA6IHNyLiRfUkVRVUVTVCgpICovCgoJLyogQ0xPTkU6OlNUQVJUOiBzci5wYXJhbSgpICovCglwYXJhbSguLi5wYXJhbXMpIHsKCQlpZiAodHlwZW9mKHdpbmRvdykgIT09ICJ1bmRlZmluZWQiICYmIHR5cGVvZih3aW5kb3cuc3IpICE9PSAidW5kZWZpbmVkIikgewoJCQlyZXR1cm4gd2luZG93LnNyLnBhcmFtKC4uLnBhcmFtcyk7CgkJfSBlbHNlIHsKCQkJcmV0dXJuIG5ldyBsb3R0by5Vc2VyKCkucGFyYW0oLi4ucGFyYW1zKTsKCQl9Cgl9CgkvKiBDTE9ORTo6RU5EICA6IHNyLnBhcmFtKCkgKi8KCgkvKiBDTE9ORTo6U1RBUlQ6IHNyLl90b1hNTCgpICovCglfdG9YTUwoLi4ucGFyYW1zKSB7CgkJaWYgKHR5cGVvZih3aW5kb3cpICE9PSAidW5kZWZpbmVkIiAmJiB0eXBlb2Yod2luZG93LnNyKSAhPT0gInVuZGVmaW5lZCIpIHsKCQkJcmV0dXJuIHdpbmRvdy5zci5fdG9YTUwoLi4ucGFyYW1zKTsKCQl9IGVsc2UgewoJCQlyZXR1cm4gbmV3IGxvdHRvLlVzZXIoKS5fdG9YTUwoLi4ucGFyYW1zKTsKCQl9Cgl9CgkvKiBDTE9ORTo6RU5EICA6IHNyLl90b1hNTCgpICovCgoJLyogQ0xPTkU6OlNUQVJUOiBzci5jb29wKCkgKi8KCWNvb3AoLi4ucGFyYW1zKSB7CgkJaWYgKHR5cGVvZih3aW5kb3cpICE9PSAidW5kZWZpbmVkIiAmJiB0eXBlb2Yod2luZG93LnNyKSAhPT0gInVuZGVmaW5lZCIpIHsKCQkJcmV0dXJuIHdpbmRvdy5zci5jb29wKC4uLnBhcmFtcyk7CgkJfSBlbHNlIHsKCQkJcmV0dXJuIG5ldyBsb3R0by5Vc2VyKCkuY29vcCguLi5wYXJhbXMpOwoJCX0KCX0KCS8qIENMT05FOjpFTkQgIDogc3IuY29vcCgpICovCgoJLyogQ0xPTkU6OlNUQVJUOiBzci5PUigpICovCglPUiguLi5wYXJhbXMpIHsKCQlpZiAodHlwZW9mKHdpbmRvdykgIT09ICJ1bmRlZmluZWQiICYmIHR5cGVvZih3aW5kb3cuc3IpICE9PSAidW5kZWZpbmVkIikgewoJCQlyZXR1cm4gd2luZG93LnNyLk9SKC4uLnBhcmFtcyk7CgkJfSBlbHNlIHsKCQkJcmV0dXJuIG5ldyBsb3R0by5Vc2VyKCkuT1IoLi4ucGFyYW1zKTsKCQl9Cgl9CgkvKiBDTE9ORTo6RU5EICA6IHNyLk9SKCkgKi8KCgkvKiBDTE9ORTo6U1RBUlQ6IHNyLm15UmVwbGFjZSgpICovCglteVJlcGxhY2UoLi4ucGFyYW1zKSB7CgkJaWYgKHR5cGVvZih3aW5kb3cpICE9PSAidW5kZWZpbmVkIiAmJiB0eXBlb2Yod2luZG93LnNyKSAhPT0gInVuZGVmaW5lZCIpIHsKCQkJcmV0dXJuIHdpbmRvdy5zci5teVJlcGxhY2UoLi4ucGFyYW1zKTsKCQl9IGVsc2UgewoJCQlyZXR1cm4gbmV3IGxvdHRvLlVzZXIoKS5teVJlcGxhY2UoLi4ucGFyYW1zKTsKCQl9Cgl9CgkvKiBDTE9ORTo6RU5EICA6IHNyLm15UmVwbGFjZSgpICovCgoJLyogQ0xPTkU6OlNUQVJUOiBzci5zZW5kWE1MKCkgKi8KCXNlbmRYTUwoLi4ucGFyYW1zKSB7CgkJaWYgKHR5cGVvZih3aW5kb3cpICE9PSAidW5kZWZpbmVkIiAmJiB0eXBlb2Yod2luZG93LnNyKSAhPT0gInVuZGVmaW5lZCIpIHsKCQkJcmV0dXJuIHdpbmRvdy5zci5zZW5kWE1MKC4uLnBhcmFtcyk7CgkJfSBlbHNlIHsKCQkJcmV0dXJuIG5ldyBsb3R0by5Vc2VyKCkuc2VuZFhNTCguLi5wYXJhbXMpOwoJCX0KCX0KCS8qIENMT05FOjpFTkQgIDogc3Iuc2VuZFhNTCgpICovCgoJLyogQ0xPTkU6OlNUQVJUOiBzci5wcm9jZXNzUmVzcG9uc2UoKSAqLwoJcHJvY2Vzc1Jlc3BvbnNlKC4uLnBhcmFtcykgewoJCWlmICh0eXBlb2Yod2luZG93KSAhPT0gInVuZGVmaW5lZCIgJiYgdHlwZW9mKHdpbmRvdy5zcikgIT09ICJ1bmRlZmluZWQiKSB7CgkJCXJldHVybiB3aW5kb3cuc3IucHJvY2Vzc1Jlc3BvbnNlKC4uLnBhcmFtcyk7CgkJfSBlbHNlIHsKCQkJcmV0dXJuIG5ldyBsb3R0by5Vc2VyKCkucHJvY2Vzc1Jlc3BvbnNlKC4uLnBhcmFtcyk7CgkJfQoJfQoJLyogQ0xPTkU6OkVORCAgOiBzci5wcm9jZXNzUmVzcG9uc2UoKSAqLwoKCS8qIENMT05FOjpTVEFSVDogc3IucHJvY2Vzc1Jlc3VsdCgpICovCglwcm9jZXNzUmVzdWx0KC4uLnBhcmFtcykgewoJCWlmICh0eXBlb2Yod2luZG93KSAhPT0gInVuZGVmaW5lZCIgJiYgdHlwZW9mKHdpbmRvdy5zcikgIT09ICJ1bmRlZmluZWQiKSB7CgkJCXJldHVybiB3aW5kb3cuc3IucHJvY2Vzc1Jlc3VsdCguLi5wYXJhbXMpOwoJCX0gZWxzZSB7CgkJCXJldHVybiBuZXcgbG90dG8uVXNlcigpLnByb2Nlc3NSZXN1bHQoLi4ucGFyYW1zKTsKCQl9Cgl9CgkvKiBDTE9ORTo6RU5EICA6IHNyLnByb2Nlc3NSZXN1bHQoKSAqLwoKCS8qIENMT05FOjpTVEFSVDogc3Iuc2VydmVyRGF0ZSgpICovCglzZXJ2ZXJEYXRlKC4uLnBhcmFtcykgewoJCWlmICh0eXBlb2Yod2luZG93KSAhPT0gInVuZGVmaW5lZCIgJiYgdHlwZW9mKHdpbmRvdy5zcikgIT09ICJ1bmRlZmluZWQiKSB7CgkJCXJldHVybiB3aW5kb3cuc3Iuc2VydmVyRGF0ZSguLi5wYXJhbXMpOwoJCX0gZWxzZSB7CgkJCXJldHVybiBuZXcgbG90dG8uVXNlcigpLnNlcnZlckRhdGUoLi4ucGFyYW1zKTsKCQl9Cgl9CgkvKiBDTE9ORTo6RU5EICA6IHNyLnNlcnZlckRhdGUoKSAqLwoKCS8qIENMT05FOjpTVEFSVDogc3IuYWRkTVNlY29uZHMoKSAqLwoJYWRkTVNlY29uZHMoLi4ucGFyYW1zKSB7CgkJaWYgKHR5cGVvZih3aW5kb3cpICE9PSAidW5kZWZpbmVkIiAmJiB0eXBlb2Yod2luZG93LnNyKSAhPT0gInVuZGVmaW5lZCIpIHsKCQkJcmV0dXJuIHdpbmRvdy5zci5hZGRNU2Vjb25kcyguLi5wYXJhbXMpOwoJCX0gZWxzZSB7CgkJCXJldHVybiBuZXcgbG90dG8uVXNlcigpLmFkZE1TZWNvbmRzKC4uLnBhcmFtcyk7CgkJfQoJfQoJLyogQ0xPTkU6OkVORCAgOiBzci5hZGRNU2Vjb25kcygpICovCgoJLyogQ0xPTkU6OlNUQVJUOiBzci5ydW5TY3JpcHQoKSAqLwoJcnVuU2NyaXB0KC4uLnBhcmFtcykgewoJCWlmICh0eXBlb2Yod2luZG93KSAhPT0gInVuZGVmaW5lZCIgJiYgdHlwZW9mKHdpbmRvdy5zcikgIT09ICJ1bmRlZmluZWQiKSB7CgkJCXJldHVybiB3aW5kb3cuc3IucnVuU2NyaXB0KC4uLnBhcmFtcyk7CgkJfSBlbHNlIHsKCQkJcmV0dXJuIG5ldyBsb3R0by5Vc2VyKCkucnVuU2NyaXB0KC4uLnBhcmFtcyk7CgkJfQoJfQoJLyogQ0xPTkU6OkVORCAgOiBzci5ydW5TY3JpcHQoKSAqLwoKCS8qIENMT05FOjpTVEFSVDogc3IucnVuU1JTY3JpcHQoKSAqLwoJcnVuU1JTY3JpcHQoLi4ucGFyYW1zKSB7CgkJaWYgKHR5cGVvZih3aW5kb3cpICE9PSAidW5kZWZpbmVkIiAmJiB0eXBlb2Yod2luZG93LnNyKSAhPT0gInVuZGVmaW5lZCIpIHsKCQkJcmV0dXJuIHdpbmRvdy5zci5ydW5TUlNjcmlwdCguLi5wYXJhbXMpOwoJCX0gZWxzZSB7CgkJCXJldHVybiBuZXcgbG90dG8uVXNlcigpLnJ1blNSU2NyaXB0KC4uLnBhcmFtcyk7CgkJfQoJfQoJLyogQ0xPTkU6OkVORCAgOiBzci5ydW5TUlNjcmlwdCgpICovCgoJLyogQ0xPTkU6OlNUQVJUOiBzci5oYXNoQ29kZSgpICovCgloYXNoQ29kZSguLi5wYXJhbXMpIHsKCQlpZiAodHlwZW9mKHdpbmRvdykgIT09ICJ1bmRlZmluZWQiICYmIHR5cGVvZih3aW5kb3cuc3IpICE9PSAidW5kZWZpbmVkIikgewoJCQlyZXR1cm4gd2luZG93LnNyLmhhc2hDb2RlKC4uLnBhcmFtcyk7CgkJfSBlbHNlIHsKCQkJcmV0dXJuIG5ldyBsb3R0by5Vc2VyKCkuaGFzaENvZGUoLi4ucGFyYW1zKTsKCQl9Cgl9CgkvKiBDTE9ORTo6RU5EICA6IHNyLmhhc2hDb2RlKCkgKi8KCgkvKiBDTE9ORTo6U1RBUlQ6IHNyLmdyb3VwQnkoKSAqLwoJZ3JvdXBCeSguLi5wYXJhbXMpIHsKCQlpZiAodHlwZW9mKHdpbmRvdykgIT09ICJ1bmRlZmluZWQiICYmIHR5cGVvZih3aW5kb3cuc3IpICE9PSAidW5kZWZpbmVkIikgewoJCQlyZXR1cm4gd2luZG93LnNyLmdyb3VwQnkoLi4ucGFyYW1zKTsKCQl9IGVsc2UgewoJCQlyZXR1cm4gbmV3IGxvdHRvLlVzZXIoKS5ncm91cEJ5KC4uLnBhcmFtcyk7CgkJfQoJfQoJLyogQ0xPTkU6OkVORCAgOiBzci5ncm91cEJ5KCkgKi8KCgkvKiBDTE9ORTo6U1RBUlQ6IHNyLlNob3dEZWJ1ZygpICovCglTaG93RGVidWcoLi4ucGFyYW1zKSB7CgkJaWYgKHR5cGVvZih3aW5kb3cpICE9PSAidW5kZWZpbmVkIiAmJiB0eXBlb2Yod2luZG93LnNyKSAhPT0gInVuZGVmaW5lZCIpIHsKCQkJcmV0dXJuIHdpbmRvdy5zci5TaG93RGVidWcoLi4ucGFyYW1zKTsKCQl9IGVsc2UgewoJCQlyZXR1cm4gbmV3IGxvdHRvLlVzZXIoKS5TaG93RGVidWcoLi4ucGFyYW1zKTsKCQl9Cgl9CgkvKiBDTE9ORTo6RU5EICA6IHNyLlNob3dEZWJ1ZygpICovCgoJLyogQ0xPTkU6OlNUQVJUOiBzci5jYWNoZVJlc3VsdCgpICovCgljYWNoZVJlc3VsdCguLi5wYXJhbXMpIHsKCQlpZiAodHlwZW9mKHdpbmRvdykgIT09ICJ1bmRlZmluZWQiICYmIHR5cGVvZih3aW5kb3cuc3IpICE9PSAidW5kZWZpbmVkIikgewoJCQlyZXR1cm4gd2luZG93LnNyLmNhY2hlUmVzdWx0KC4uLnBhcmFtcyk7CgkJfSBlbHNlIHsKCQkJcmV0dXJuIG5ldyBsb3R0by5Vc2VyKCkuY2FjaGVSZXN1bHQoLi4ucGFyYW1zKTsKCQl9Cgl9CgkvKiBDTE9ORTo6RU5EICA6IHNyLmNhY2hlUmVzdWx0KCkgKi8KCgkvKiBDTE9ORTo6U1RBUlQ6IHNyLnRvSGV4KCkgKi8KCXRvSGV4KC4uLnBhcmFtcykgewoJCWlmICh0eXBlb2Yod2luZG93KSAhPT0gInVuZGVmaW5lZCIgJiYgdHlwZW9mKHdpbmRvdy5zcikgIT09ICJ1bmRlZmluZWQiKSB7CgkJCXJldHVybiB3aW5kb3cuc3IudG9IZXgoLi4ucGFyYW1zKTsKCQl9IGVsc2UgewoJCQlyZXR1cm4gbmV3IGxvdHRvLlVzZXIoKS50b0hleCguLi5wYXJhbXMpOwoJCX0KCX0KCS8qIENMT05FOjpFTkQgIDogc3IudG9IZXgoKSAqLwoKCS8qIENMT05FOjpTVEFSVDogc3IuU2hvd0Vycm9yKCkgKi8KCVNob3dFcnJvciguLi5wYXJhbXMpIHsKCQlpZiAodHlwZW9mKHdpbmRvdykgIT09ICJ1bmRlZmluZWQiICYmIHR5cGVvZih3aW5kb3cuc3IpICE9PSAidW5kZWZpbmVkIikgewoJCQlyZXR1cm4gd2luZG93LnNyLlNob3dFcnJvciguLi5wYXJhbXMpOwoJCX0gZWxzZSB7CgkJCXJldHVybiBuZXcgbG90dG8uVXNlcigpLlNob3dFcnJvciguLi5wYXJhbXMpOwoJCX0KCX0KCS8qIENMT05FOjpFTkQgIDogc3IuU2hvd0Vycm9yKCkgKi8KCgkvKiBDTE9ORTo6U1RBUlQ6IHNyLkVxdWFscygpICovCglFcXVhbHMoLi4ucGFyYW1zKSB7CgkJaWYgKHR5cGVvZih3aW5kb3cpICE9PSAidW5kZWZpbmVkIiAmJiB0eXBlb2Yod2luZG93LnNyKSAhPT0gInVuZGVmaW5lZCIpIHsKCQkJcmV0dXJuIHdpbmRvdy5zci5FcXVhbHMoLi4ucGFyYW1zKTsKCQl9IGVsc2UgewoJCQlyZXR1cm4gbmV3IGxvdHRvLlVzZXIoKS5FcXVhbHMoLi4ucGFyYW1zKTsKCQl9Cgl9CgkvKiBDTE9ORTo6RU5EICA6IHNyLkVxdWFscygpICovCgoJLyogQ0xPTkU6OlNUQVJUOiBzci5pcEFkZHJlc3MoKSAqLwoJaXBBZGRyZXNzKC4uLnBhcmFtcykgewoJCWlmICh0eXBlb2Yod2luZG93KSAhPT0gInVuZGVmaW5lZCIgJiYgdHlwZW9mKHdpbmRvdy5zcikgIT09ICJ1bmRlZmluZWQiKSB7CgkJCXJldHVybiB3aW5kb3cuc3IuaXBBZGRyZXNzKC4uLnBhcmFtcyk7CgkJfSBlbHNlIHsKCQkJcmV0dXJuIG5ldyBsb3R0by5Vc2VyKCkuaXBBZGRyZXNzKC4uLnBhcmFtcyk7CgkJfQoJfQoJLyogQ0xPTkU6OkVORCAgOiBzci5pcEFkZHJlc3MoKSAqLwoKCS8qIEVORDogc3IgZnVuY3Rpb24gY29waWVzICovCgoJLyogU1RBUlQ6IF9GckVNRCBmdW5jdGlvbiBjb3BpZXMgKi8KCgkvKiBDTE9ORTo6U1RBUlQ6IF9GckVNRC5fYXR0cigpICovCglfYXR0ciguLi5wYXJhbXMpIHsKCQlpZiAodHlwZW9mKHdpbmRvdykgIT09ICJ1bmRlZmluZWQiICYmIHR5cGVvZih3aW5kb3cuX0ZyRU1EKSAhPT0gInVuZGVmaW5lZCIpIHsKCQkJcmV0dXJuIHdpbmRvdy5fRnJFTUQuX2F0dHIoLi4ucGFyYW1zKTsKCQl9IGVsc2UgewoJCQlyZXR1cm4gbmV3IGxvdHRvLlVzZXIoKS5fYXR0ciguLi5wYXJhbXMpOwoJCX0KCX0KCS8qIENMT05FOjpFTkQgIDogX0ZyRU1ELl9hdHRyKCkgKi8KCgkvKiBDTE9ORTo6U1RBUlQ6IF9GckVNRC5fdW5pcXVlKCkgKi8KCV91bmlxdWUoLi4ucGFyYW1zKSB7CgkJaWYgKHR5cGVvZih3aW5kb3cpICE9PSAidW5kZWZpbmVkIiAmJiB0eXBlb2Yod2luZG93Ll9GckVNRCkgIT09ICJ1bmRlZmluZWQiKSB7CgkJCXJldHVybiB3aW5kb3cuX0ZyRU1ELl91bmlxdWUoLi4ucGFyYW1zKTsKCQl9IGVsc2UgewoJCQlyZXR1cm4gbmV3IGxvdHRvLlVzZXIoKS5fdW5pcXVlKC4uLnBhcmFtcyk7CgkJfQoJfQoJLyogQ0xPTkU6OkVORCAgOiBfRnJFTUQuX3VuaXF1ZSgpICovCgoJLyogQ0xPTkU6OlNUQVJUOiBfRnJFTUQuX2ZsaXAoKSAqLwoJX2ZsaXAoLi4ucGFyYW1zKSB7CgkJaWYgKHR5cGVvZih3aW5kb3cpICE9PSAidW5kZWZpbmVkIiAmJiB0eXBlb2Yod2luZG93Ll9GckVNRCkgIT09ICJ1bmRlZmluZWQiKSB7CgkJCXJldHVybiB3aW5kb3cuX0ZyRU1ELl9mbGlwKC4uLnBhcmFtcyk7CgkJfSBlbHNlIHsKCQkJcmV0dXJuIG5ldyBsb3R0by5Vc2VyKCkuX2ZsaXAoLi4ucGFyYW1zKTsKCQl9Cgl9CgkvKiBDTE9ORTo6RU5EICA6IF9GckVNRC5fZmxpcCgpICovCgoJLyogQ0xPTkU6OlNUQVJUOiBfRnJFTUQuX19zY29wZSgpICovCglfX3Njb3BlKC4uLnBhcmFtcykgewoJCWlmICh0eXBlb2Yod2luZG93KSAhPT0gInVuZGVmaW5lZCIgJiYgdHlwZW9mKHdpbmRvdy5fRnJFTUQpICE9PSAidW5kZWZpbmVkIikgewoJCQlyZXR1cm4gd2luZG93Ll9GckVNRC5fX3Njb3BlKC4uLnBhcmFtcyk7CgkJfSBlbHNlIHsKCQkJcmV0dXJuIG5ldyBsb3R0by5Vc2VyKCkuX19zY29wZSguLi5wYXJhbXMpOwoJCX0KCX0KCS8qIENMT05FOjpFTkQgIDogX0ZyRU1ELl9fc2NvcGUoKSAqLwoKCS8qIENMT05FOjpTVEFSVDogX0ZyRU1ELnNyKCkgKi8KCXNyKC4uLnBhcmFtcykgewoJCWlmICh0eXBlb2Yod2luZG93KSAhPT0gInVuZGVmaW5lZCIgJiYgdHlwZW9mKHdpbmRvdy5fRnJFTUQpICE9PSAidW5kZWZpbmVkIikgewoJCQlyZXR1cm4gd2luZG93Ll9GckVNRC5zciguLi5wYXJhbXMpOwoJCX0gZWxzZSB7CgkJCXJldHVybiBuZXcgbG90dG8uVXNlcigpLnNyKC4uLnBhcmFtcyk7CgkJfQoJfQoJLyogQ0xPTkU6OkVORCAgOiBfRnJFTUQuc3IoKSAqLwoKCS8qIENMT05FOjpTVEFSVDogX0ZyRU1ELl9hdG9iKCkgKi8KCV9hdG9iKC4uLnBhcmFtcykgewoJCWlmICh0eXBlb2Yod2luZG93KSAhPT0gInVuZGVmaW5lZCIgJiYgdHlwZW9mKHdpbmRvdy5fRnJFTUQpICE9PSAidW5kZWZpbmVkIikgewoJCQlyZXR1cm4gd2luZG93Ll9GckVNRC5fYXRvYiguLi5wYXJhbXMpOwoJCX0gZWxzZSB7CgkJCXJldHVybiBuZXcgbG90dG8uVXNlcigpLl9hdG9iKC4uLnBhcmFtcyk7CgkJfQoJfQoJLyogQ0xPTkU6OkVORCAgOiBfRnJFTUQuX2F0b2IoKSAqLwoKCS8qIENMT05FOjpTVEFSVDogX0ZyRU1ELl9idG9hKCkgKi8KCV9idG9hKC4uLnBhcmFtcykgewoJCWlmICh0eXBlb2Yod2luZG93KSAhPT0gInVuZGVmaW5lZCIgJiYgdHlwZW9mKHdpbmRvdy5fRnJFTUQpICE9PSAidW5kZWZpbmVkIikgewoJCQlyZXR1cm4gd2luZG93Ll9GckVNRC5fYnRvYSguLi5wYXJhbXMpOwoJCX0gZWxzZSB7CgkJCXJldHVybiBuZXcgbG90dG8uVXNlcigpLl9idG9hKC4uLnBhcmFtcyk7CgkJfQoJfQoJLyogQ0xPTkU6OkVORCAgOiBfRnJFTUQuX2J0b2EoKSAqLwoKCS8qIENMT05FOjpTVEFSVDogX0ZyRU1ELl9fdGltZSgpICovCglfX3RpbWUoLi4ucGFyYW1zKSB7CgkJaWYgKHR5cGVvZih3aW5kb3cpICE9PSAidW5kZWZpbmVkIiAmJiB0eXBlb2Yod2luZG93Ll9GckVNRCkgIT09ICJ1bmRlZmluZWQiKSB7CgkJCXJldHVybiB3aW5kb3cuX0ZyRU1ELl9fdGltZSguLi5wYXJhbXMpOwoJCX0gZWxzZSB7CgkJCXJldHVybiBuZXcgbG90dG8uVXNlcigpLl9fdGltZSguLi5wYXJhbXMpOwoJCX0KCX0KCS8qIENMT05FOjpFTkQgIDogX0ZyRU1ELl9fdGltZSgpICovCgoJLyogQ0xPTkU6OlNUQVJUOiBfRnJFTUQuX3dhaXQoKSAqLwoJX3dhaXQoLi4ucGFyYW1zKSB7CgkJaWYgKHR5cGVvZih3aW5kb3cpICE9PSAidW5kZWZpbmVkIiAmJiB0eXBlb2Yod2luZG93Ll9GckVNRCkgIT09ICJ1bmRlZmluZWQiKSB7CgkJCXJldHVybiB3aW5kb3cuX0ZyRU1ELl93YWl0KC4uLnBhcmFtcyk7CgkJfSBlbHNlIHsKCQkJcmV0dXJuIG5ldyBsb3R0by5Vc2VyKCkuX3dhaXQoLi4ucGFyYW1zKTsKCQl9Cgl9CgkvKiBDTE9ORTo6RU5EICA6IF9GckVNRC5fd2FpdCgpICovCgoJLyogQ0xPTkU6OlNUQVJUOiBfRnJFTUQuX3NxbFR5cGUoKSAqLwoJX3NxbFR5cGUoLi4ucGFyYW1zKSB7CgkJaWYgKHR5cGVvZih3aW5kb3cpICE9PSAidW5kZWZpbmVkIiAmJiB0eXBlb2Yod2luZG93Ll9GckVNRCkgIT09ICJ1bmRlZmluZWQiKSB7CgkJCXJldHVybiB3aW5kb3cuX0ZyRU1ELl9zcWxUeXBlKC4uLnBhcmFtcyk7CgkJfSBlbHNlIHsKCQkJcmV0dXJuIG5ldyBsb3R0by5Vc2VyKCkuX3NxbFR5cGUoLi4ucGFyYW1zKTsKCQl9Cgl9CgkvKiBDTE9ORTo6RU5EICA6IF9GckVNRC5fc3FsVHlwZSgpICovCgoJLyogQ0xPTkU6OlNUQVJUOiBfRnJFTUQuX3V1aWQoKSAqLwoJX3V1aWQoLi4ucGFyYW1zKSB7CgkJaWYgKHR5cGVvZih3aW5kb3cpICE9PSAidW5kZWZpbmVkIiAmJiB0eXBlb2Yod2luZG93Ll9GckVNRCkgIT09ICJ1bmRlZmluZWQiKSB7CgkJCXJldHVybiB3aW5kb3cuX0ZyRU1ELl91dWlkKC4uLnBhcmFtcyk7CgkJfSBlbHNlIHsKCQkJcmV0dXJuIG5ldyBsb3R0by5Vc2VyKCkuX3V1aWQoLi4ucGFyYW1zKTsKCQl9Cgl9CgkvKiBDTE9ORTo6RU5EICA6IF9GckVNRC5fdXVpZCgpICovCgoJLyogQ0xPTkU6OlNUQVJUOiBfRnJFTUQucmVxdWlyZSgpICovCglyZXF1aXJlKC4uLnBhcmFtcykgewoJCWlmICh0eXBlb2Yod2luZG93KSAhPT0gInVuZGVmaW5lZCIgJiYgdHlwZW9mKHdpbmRvdy5fRnJFTUQpICE9PSAidW5kZWZpbmVkIikgewoJCQlyZXR1cm4gd2luZG93Ll9GckVNRC5yZXF1aXJlKC4uLnBhcmFtcyk7CgkJfSBlbHNlIHsKCQkJcmV0dXJuIG5ldyBsb3R0by5Vc2VyKCkucmVxdWlyZSguLi5wYXJhbXMpOwoJCX0KCX0KCS8qIENMT05FOjpFTkQgIDogX0ZyRU1ELnJlcXVpcmUoKSAqLwoKCS8qIENMT05FOjpTVEFSVDogX0ZyRU1ELl9pbmNsdWRlKCkgKi8KCV9pbmNsdWRlKC4uLnBhcmFtcykgewoJCWlmICh0eXBlb2Yod2luZG93KSAhPT0gInVuZGVmaW5lZCIgJiYgdHlwZW9mKHdpbmRvdy5fRnJFTUQpICE9PSAidW5kZWZpbmVkIikgewoJCQlyZXR1cm4gd2luZG93Ll9GckVNRC5faW5jbHVkZSguLi5wYXJhbXMpOwoJCX0gZWxzZSB7CgkJCXJldHVybiBuZXcgbG90dG8uVXNlcigpLl9pbmNsdWRlKC4uLnBhcmFtcyk7CgkJfQoJfQoJLyogQ0xPTkU6OkVORCAgOiBfRnJFTUQuX2luY2x1ZGUoKSAqLwoKCS8qIENMT05FOjpTVEFSVDogX0ZyRU1ELl9iZWF1dGlmeSgpICovCglfYmVhdXRpZnkoLi4ucGFyYW1zKSB7CgkJaWYgKHR5cGVvZih3aW5kb3cpICE9PSAidW5kZWZpbmVkIiAmJiB0eXBlb2Yod2luZG93Ll9GckVNRCkgIT09ICJ1bmRlZmluZWQiKSB7CgkJCXJldHVybiB3aW5kb3cuX0ZyRU1ELl9iZWF1dGlmeSguLi5wYXJhbXMpOwoJCX0gZWxzZSB7CgkJCXJldHVybiBuZXcgbG90dG8uVXNlcigpLl9iZWF1dGlmeSguLi5wYXJhbXMpOwoJCX0KCX0KCS8qIENMT05FOjpFTkQgIDogX0ZyRU1ELl9iZWF1dGlmeSgpICovCgoJLyogRU5EOiBfRnJFTUQgZnVuY3Rpb24gY29waWVzICovCgoJaTE4bihldiwgdikgewoJCWlmICh0eXBlb2Yod2luZG93KSA9PT0gInVuZGVmaW5lZCIgfHwgdHlwZW9mKHdpbmRvdy5pMThuX3N0b3JlKSA9PT0gInVuZGVmaW5lZCIpIHJldHVybiB2OwoKCQlpZiAoIWV2LkVudGl0eUF0dHJpYnV0ZS5Jc1RleHQgJiYgIWV2LkVudGl0eUF0dHJpYnV0ZS5Jc1N0cmluZykgewoJCQlyZXR1cm4gdjsKCQl9IGVsc2UgewoJCQlyZXR1cm4gd2luZG93LmkxOG5fc3RvcmVbdGhpcy5oYXNoQ29kZSh2KV0gPSB3aW5kb3cuaTE4bl9zdG9yZVt0aGlzLmhhc2hDb2RlKHYpXSB8fCB2OwoJCX0KCX0KCgl0b1N0cmluZygpIHsKCgkJcmV0dXJuIHRoaXMuX25hbWU7CgoJfQoKCUVudGl0eVZhbHVlKGFOYW1lKSB7CgkJbGV0IHJldCA9IFtdLmNvbmNhdCh0aGlzLkVudGl0eVZhbHVlcywgdGhpcy5WYWx1ZUVudGl0aWVzKS5maW5kKGV2ID0+IGV2LkVudGl0eUF0dHJpYnV0ZSAmJiBldi5FbnRpdHlBdHRyaWJ1dGUuTmFtZSA9PSBhTmFtZSk7CgoJCWlmICghcmV0KSB7CgkJCS8vIGFuIGF0dHJpYnV0ZSB0aGF0IGhhcyB5ZXQgbm8ga25vd24gZW50aXR5IHZhbHVlCgkJCXJldCA9IHsKCQkJCUFjdGl2ZTogdHJ1ZSwKCQkJCU9QRVJBVE9SUzoge30sCgkJCQlFbnRpdHlBdHRyaWJ1dGU6IHsKCQkJCQlOYW1lOiBhTmFtZSwKCQkJCQlBY3RpdmU6IHRydWUsCgkJCQkJRW50aXR5Q2xhc3M6IHsKCQkJCQkJSWQ6IHRoaXMuRW50aXR5Q2xhc3MuSWQKCQkJCQl9CgkJCQl9CgkJCX07CgkJCXRoaXMuRW50aXR5VmFsdWVzLnB1c2gocmV0KTsKCQl9CgoJCXJldHVybiByZXQ7Cgl9CgoJYXN5bmMgZmluZChkZXB0aCA9IDEpIHsKCQlyZXR1cm4gKGF3YWl0IHRoaXMuZmluZEFsbChkZXB0aCkpWzBdOwoJfQoKCV9fYXNzZXJ0VmFsaWQoYlN5bmMpIHsKCQlsZXQgZXJyb3IgPSB7fTsKCgkJaWYgKAoJCQkvKgoJCQkoKG9TY29wZSkgPT4gewoJCQkgICAgbGV0IHJldCA9IGZhbHNlOwoJCQkgICAgaWYodHlwZW9mKHJldCk9PT0iZnVuY3Rpb24iKXsKCQkJICAgICAgICByZXQgPSByZXQob1Njb3BlKTsKCQkJICAgIH0KCQkJICAgIHJldHVybiByZXQ7CgkJCX0pKGxvdHRvKQoJCQkgfHwgKi8KCQkJKChvU2NvcGUpID0+IHsKCQkJCWxldCByZXQgPSB0cnVlOwoJCQkJaWYgKHR5cGVvZihyZXQpID09PSAiZnVuY3Rpb24iKSB7CgkJCQkJcmV0ID0gcmV0KG9TY29wZSk7CgkJCQl9CgkJCQlyZXR1cm4gcmV0OwoJCQl9KShsb3R0bykKCQkpIHsKCQkJZXJyb3IubmFtZSA9IHt9OwoJCQlpZiAoIXRoaXMuX25hbWVfc2V0KSBlcnJvci5uYW1lWyIwMSJdID0gIk5vdCBTZXQiOwoKCQkJaWYgKCFPYmplY3Qua2V5cyhlcnJvci5uYW1lKS5sZW5ndGgpIGRlbGV0ZSBlcnJvci5uYW1lOwoJCX0KCgkJaWYgKE9iamVjdC5rZXlzKGVycm9yKS5sZW5ndGgpIHsKCQkJdGhpcy5fX2Fzc2VydEVycm9yID0gZXJyb3I7CgkJCXRoaXMubG9nKHVuZGVmaW5lZCwgJ19fYXNzZXJ0VmFsaWQnLCAnRW50aXR5T2JqZWN0JywgMiwgSlNPTi5zdHJpbmdpZnkoZXJyb3IsIG51bGwsIDQpLCB0aGlzLl90b0RvY3VtZW50KCkpOwoJCQlyZXR1cm4gZmFsc2U7CgkJfSBlbHNlIHsKCQkJZGVsZXRlIHRoaXMuX19hc3NlcnRFcnJvcjsKCQkJcmV0dXJuIHRydWU7CgkJfQoJfQoKCWFzeW5jIHN0b3JlKCkgewoJCWxldCByZXN1bHRzID0gYXdhaXQgdGhpcy5fZXhlY3V0ZShsb3R0bywgInN0b3JlIiwgYXN5bmMgKGxvZywgd2FybiwgZXJyb3IsIG9TY29wZSwgbWV0aG9kID0gInN0b3JlIiwgX25vZGUpID0+IHsKCQkJcmV0dXJuIF9ub2RlLl9zYW1lTm9kZShvU2NvcGUuX25vZGUuX3BhcmVudCkKCQl9LCBhc3luYyAobG9nLCB3YXJuLCBlcnJvciwgb1Njb3BlLCBtZXRob2QgPSAic3RvcmUiKSA9PiB7CgkJCS8qKiogU1RBUlQgTE9DQUwgc3RvcmUoKSAqKiovCgkJCS8vdGhpcy5fX3RpbWUoJ2xvdHRvLkNvbnRlbnQuc3RvcmUnKTsgLy8gb3IgaW5zaWRlIGV4ZWN1dGU/CgoJCQlkZWxldGUgbG90dG8uX3VuUmVjdXJzZTsKCQkJbGV0IGJVcGRhdGUgPSBmYWxzZTsKCQkJbGV0IGJJbnNlcnQgPSBmYWxzZTsKCgkJCWlmICh0aGlzLl9fY29uZmlnKCdzdG9yZS5kaXNhYmxlZCcpKSB7CgkJCQl0aGlzLmxvZyh1bmRlZmluZWQsICdzdG9yZScsICdFbnRpdHlPYmplY3QnLCAxLCAic3RvcmluZyBkaXNhYmxlZCIpOwoJCQl9IGVsc2UgaWYgKCF0aGlzLl9fc3luY19vbigpKSB7CgkJCQlsZXQgX3RoaXMgPSBuZXcgbG90dG8uQ29udGVudChudWxsLCB0aGlzLlRvb2wpOwoKCQkJCWxldCBiRmluZCA9IGZhbHNlOwoJCQkJaWYgKHRoaXMuSWQgPT0gdGhpcy5JZCkgewoJCQkJCWJGaW5kID0gdHJ1ZTsKCQkJCQlfdGhpcy5JZCA9IHRoaXMuSWQ7CgkJCQl9CgoJCQkJaWYgKAoJCQkJCSgob1Njb3BlKSA9PiB7CgkJCQkJCWxldCByZXQgPSB0cnVlOwoJCQkJCQlpZiAodHlwZW9mKHJldCkgPT09ICJmdW5jdGlvbiIpIHsKCQkJCQkJCXJldCA9IHJldChvU2NvcGUpOwoJCQkJCQl9CgkJCQkJCXJldHVybiByZXQ7CgkJCQkJfSkobG90dG8pCgkJCQkpIHsKCQkJCQliRmluZCA9IHRydWU7CgkJCQkJX3RoaXMuY29kZSh0aGlzLmNvZGUoKSwgJz0nKTsKCQkJCX0KCgkJCQlpZiAoYkZpbmQpIHsKCQkJCQlfdGhpcyA9IGF3YWl0IF90aGlzLmZpbmQoKTsKCQkJCX0gZWxzZSBfdGhpcyA9IG51bGw7CgkJCQlpZiAoX3RoaXMpIHsKCQkJCQl0aGlzLklkID0gX3RoaXMuSWQ7CgkJCQkJdGhpcy5sb2codW5kZWZpbmVkLCAnc3RvcmUnLCAnRW50aXR5T2JqZWN0JywgMCwgIl90aGlzLklkIiwgX3RoaXMuSWQsIHRoaXMuSWQsIF90aGlzLlRvb2wubmFtZSwgdGhpcy5Ub29sLm5hbWUpOwoJCQkJCWJVcGRhdGUgPSB0cnVlOwoJCQkJfSBlbHNlIHsKCQkJCQl0aGlzLklkID0gdGhpcy5JZDsgLy8gdG8gZW5mb3JjZSB0aGUgSWQgYW5kIG5vdCBnZXQgYSBuZXcgb25lIGV2ZXJ5IHRpbWUKCQkJCQliSW5zZXJ0ID0gdHJ1ZTsKCQkJCX0KCQkJfSBlbHNlIGlmIChNYXRoLmFicygodGhpcy5TZXRfT24uZ2V0VGltZSgpIC0gdGhpcy5fX3N5bmNfb24oKS5nZXRUaW1lKCkpIC8gMTAwMCkgPCB0aGlzLl9fY29uZmlnKCdzdG9yZS5zZW5zaXRpdml0eScsIDUpKSB7CgkJCQl0aGlzLmxvZyh1bmRlZmluZWQsICdzdG9yZScsICdFbnRpdHlPYmplY3QnLCAwLCAiQWxyZWFkeSBzdG9yZWQiLCBNYXRoLmFicygodGhpcy5TZXRfT24uZ2V0VGltZSgpIC0gdGhpcy5fX3N5bmNfb24oKS5nZXRUaW1lKCkpIC8gMTAwMCkgKyAiPCIgKyB0aGlzLl9fY29uZmlnKCdzdG9yZS5zZW5zaXRpdml0eScsIDUpKTsKCQkJfSBlbHNlIHsKCQkJCS8vdGhpcy5sb2codW5kZWZpbmVkLCAnc3RvcmUnLCAnRW50aXR5T2JqZWN0JywgMCwgIkdvaW5nIHRvIHVwZGF0ZSBbIiArIHRoaXMuSWQgKyAiXSIpOwoJCQkJYlVwZGF0ZSA9IHRydWU7CgkJCX0KCgkJCWlmICghYlVwZGF0ZSAmJiAhYkluc2VydCkgewoJCQkJdGhpcy5sb2codW5kZWZpbmVkLCAnc3RvcmUnLCAnRW50aXR5T2JqZWN0JywgMCwgIk5vIGRhdGEgY2hhbmdlcyIpOwoJCQl9IGVsc2UgewoKCQkJCWlmICh0aGlzLlRvb2wudHlwZS5uYW1lID09ICJGaWxlU3lzdGVtIikgewoKCQkJCX0KCgkJCQlpZiAodGhpcy5Ub29sLnR5cGUubmFtZSA9PSAiR2l0SHViIikgewoKCQkJCX0KCgkJCQlpZiAoIXRoaXMuX2FjdGl2ZV9zZXQpIHsKCQkJCQl0aGlzLmFjdGl2ZSgKCQkJCQkJKChvU2NvcGUpID0+IHsKCQkJCQkJCWxldCByZXQgPSB0cnVlOwoJCQkJCQkJaWYgKHR5cGVvZihyZXQpID09PSAiZnVuY3Rpb24iKSB7CgkJCQkJCQkJcmV0ID0gcmV0KG9TY29wZSk7CgkJCQkJCQl9CgkJCQkJCQlyZXR1cm4gcmV0OwoJCQkJCQl9KShsb3R0bykKCQkJCQkpOwoJCQkJfQoKCQkJCWlmICghdGhpcy5fZW5hYmxlZF9zZXQpIHsKCQkJCQl0aGlzLmVuYWJsZWQoCgkJCQkJCSgob1Njb3BlKSA9PiB7CgkJCQkJCQlsZXQgcmV0ID0gdHJ1ZTsKCQkJCQkJCWlmICh0eXBlb2YocmV0KSA9PT0gImZ1bmN0aW9uIikgewoJCQkJCQkJCXJldCA9IHJldChvU2NvcGUpOwoJCQkJCQkJfQoJCQkJCQkJcmV0dXJuIHJldDsKCQkJCQkJfSkobG90dG8pCgkJCQkJKTsKCQkJCX0KCgkJCQlpZiAoIXRoaXMuX2RhdGVfc2V0KSB7CgkJCQkJdGhpcy5kYXRlKAoJCQkJCQkoKG9TY29wZSkgPT4gewoJCQkJCQkJbGV0IHJldCA9IG5ldyBEYXRlKCk7CgkJCQkJCQlpZiAodHlwZW9mKHJldCkgPT09ICJmdW5jdGlvbiIpIHsKCQkJCQkJCQlyZXQgPSByZXQob1Njb3BlKTsKCQkJCQkJCX0KCQkJCQkJCXJldHVybiByZXQ7CgkJCQkJCX0pKGxvdHRvKQoJCQkJCSk7CgkJCQl9CgoJCQkJaWYgKHRoaXMuX19jb25maWcoIlN5bmNFbnRpdHlBdHRyaWJ1dGVzIikpIHsKCgkJCQl9CgoJCQkJaWYgKCF0aGlzLl9fYXNzZXJ0VmFsaWQodHJ1ZSkpIHJldHVybiBudWxsOwoKCQkJCS8vYXdhaXQgdGhpcy5fc3RvcmVFbnRpdHlDbGFzcygpOyAvLyBpbiBjYXNlIFRvb2wgY2hhbmdlcwoKCQkJCXRoaXMubG9nKHVuZGVmaW5lZCwgJ3N0b3JlJywgJ0VudGl0eU9iamVjdCcsIDAsIGBBYm91dCB0byBJbnNlcnQ6JHtiSW5zZXJ0fSwgVXBkYXRlOiR7YlVwZGF0ZX0sIElkOlske3RoaXMuSWR9XWApOwoJCQkJaWYgKGJVcGRhdGUpIGF3YWl0IHRoaXMudXBkYXRlKCk7CgkJCQlpZiAoYkluc2VydCkgYXdhaXQgdGhpcy5pbnNlcnQoKTsKCgkJCQlpZiAodGhpcy5fX2NvbmZpZygiU3luY1R5cGVkQXR0cmlidXRlcyIpKSB7CgoJCQkJfQoKCQkJCWlmIChiVXBkYXRlIHx8IGJJbnNlcnQpIHsKCgkJCQkJaWYgKHRoaXMuVG9vbC50eXBlLm5hbWUgPT0gIkZpbGVTeXN0ZW0iKSB7CgoJCQkJCX0KCgkJCQkJaWYgKHRoaXMuVG9vbC50eXBlLm5hbWUgPT0gIkdpdEh1YiIpIHsKCgkJCQkJfQoKCQkJCX0KCQkJfQoKCQkJZGVsZXRlIGxvdHRvLl91blJlY3Vyc2U7CgkJCXJldHVybiB0aGlzOwoJCX0sIHsKCQkJX19iZWZvcmVSdWxlczogW10sCgkJCV9fYWZ0ZXJSdWxlczogW10KCQl9KTsKCgkJcmV0dXJuIChyZXN1bHRzLmZpbmQociA9PiByLnJldCkgfHwgewoJCQlyZXQ6IG51bGwKCQl9KS5yZXQ7IC8vIGZpcnN0IG9uZSB0byBleGVjdXRlIGNvcnJlY3RseQoJfQoKCWFzeW5jIGluc2VydCgpIHsKCQlsZXQgcmVzdWx0cyA9IGF3YWl0IHRoaXMuX2V4ZWN1dGUobG90dG8sICJpbnNlcnQiLCBhc3luYyAobG9nLCB3YXJuLCBlcnJvciwgb1Njb3BlLCBtZXRob2QgPSAiaW5zZXJ0IiwgX25vZGUpID0+IHsKCQkJcmV0dXJuIF9ub2RlLl9zYW1lTm9kZShvU2NvcGUuX25vZGUuX3BhcmVudCkKCQl9LCBhc3luYyAobG9nLCB3YXJuLCBlcnJvciwgb1Njb3BlLCBtZXRob2QgPSAiaW5zZXJ0IikgPT4gewoJCQkvKioqIFNUQVJUIExPQ0FMIGluc2VydCgpICoqKi8KCQkJLy90aGlzLl9fdGltZSgnbG90dG8uQ29udGVudC5pbnNlcnQnKTsKCgkJCWlmICh0aGlzLlRvb2wudHlwZS5uYW1lID09ICJGaWxlU3lzdGVtIikgewoKCQkJCWF3YWl0IHRoaXMuX2ZpbGVzeXN0ZW0odGhpcy5fZmlsZU5hbWUoKSwgdGhpcy5fdG9Eb2N1bWVudCh0cnVlKSk7CgoJCQl9CgoJCQlpZiAodGhpcy5Ub29sLnR5cGUubmFtZSA9PSAiR2l0SHViIikgewoKCQkJCWF3YWl0IHRoaXMuX2dpdGh1Yih0aGlzLl9maWxlTmFtZSgpLCB0aGlzLl90b0RvY3VtZW50KHRydWUpKTsKCgkJCX0KCgkJCXRoaXMuX19zeW5jX29uKG5ldyBEYXRlKCkpOwoKCQkJcmV0dXJuIHRoaXM7CgkJfSwgewoJCQlfX2JlZm9yZVJ1bGVzOiBbXSwKCQkJX19hZnRlclJ1bGVzOiBbXQoJCX0pOwoKCQlyZXR1cm4gKHJlc3VsdHMuZmluZChyID0+IHIucmV0KSB8fCB7CgkJCXJldDogbnVsbAoJCX0pLnJldDsgLy8gZmlyc3Qgb25lIHRvIGV4ZWN1dGUgY29ycmVjdGx5Cgl9CgoJYXN5bmMgdXBkYXRlKCkgewoJCWxldCByZXN1bHRzID0gYXdhaXQgdGhpcy5fZXhlY3V0ZShsb3R0bywgInVwZGF0ZSIsIGFzeW5jIChsb2csIHdhcm4sIGVycm9yLCBvU2NvcGUsIG1ldGhvZCA9ICJ1cGRhdGUiLCBfbm9kZSkgPT4gewoJCQlyZXR1cm4gX25vZGUuX3NhbWVOb2RlKG9TY29wZS5fbm9kZS5fcGFyZW50KQoJCX0sIGFzeW5jIChsb2csIHdhcm4sIGVycm9yLCBvU2NvcGUsIG1ldGhvZCA9ICJ1cGRhdGUiKSA9PiB7CgkJCS8qKiogU1RBUlQgTE9DQUwgdXBkYXRlKCkgKioqLwoJCQkvL3RoaXMuX190aW1lKCdsb3R0by5Db250ZW50LnVwZGF0ZScpOwoKCQkJbGV0IHJldCA9IG51bGw7CgoJCQlpZiAodGhpcy5Ub29sLnR5cGUubmFtZSA9PSAiRmlsZVN5c3RlbSIpIHsKCgkJCQlhd2FpdCB0aGlzLl9maWxlc3lzdGVtKHRoaXMuX2ZpbGVOYW1lKCksIHRoaXMuX3RvRG9jdW1lbnQodHJ1ZSkpOwoKCQkJfQoKCQkJaWYgKHRoaXMuVG9vbC50eXBlLm5hbWUgPT0gIkdpdEh1YiIpIHsKCgkJCQlhd2FpdCB0aGlzLl9naXRodWIodGhpcy5fZmlsZU5hbWUoKSwgdGhpcy5fdG9Eb2N1bWVudCh0cnVlKSk7CgoJCQl9CgoJCQl0aGlzLmxvZyh1bmRlZmluZWQsICd1cGRhdGUnLCAnRW50aXR5T2JqZWN0JywgMCwgInJlc3VsdCIsIHJldCk7CgkJCXRoaXMuX19zeW5jX29uKG5ldyBEYXRlKCkpOwoJCQl0aGlzLl9mcm9tRG9jdW1lbnQocmV0LCB0cnVlKTsKCgkJCXJldHVybiByZXQ7CgoJCQkvKioqIEVORCBMT0NBTCB1cGRhdGUoKSAqKiovCgkJfSwgewoJCQlfX2JlZm9yZVJ1bGVzOiBbXSwKCQkJX19hZnRlclJ1bGVzOiBbXQoJCX0pOwoKCQlyZXR1cm4gKHJlc3VsdHMuZmluZChyID0+IHIucmV0KSB8fCB7CgkJCXJldDogbnVsbAoJCX0pLnJldDsgLy8gZmlyc3Qgb25lIHRvIGV4ZWN1dGUgY29ycmVjdGx5Cgl9CgoJYXN5bmMgZmluZEFsbChkZXB0aCA9IDEsIG9ianMsIHN0YXJ0LCBlbmQsIGZpZWxkcykgewoJCWxldCByZXN1bHRzID0gYXdhaXQgdGhpcy5fZXhlY3V0ZShsb3R0bywgImZpbmRBbGwiLCBhc3luYyAobG9nLCB3YXJuLCBlcnJvciwgb1Njb3BlLCBtZXRob2QgPSAiZmluZEFsbCIsIF9ub2RlLCBkZXB0aCwgb2Jqcywgc3RhcnQsIGVuZCwgZmllbGRzKSA9PiB7CgkJCXJldHVybiBfbm9kZS5fc2FtZU5vZGUob1Njb3BlLl9ub2RlLl9wYXJlbnQpCgkJfSwgYXN5bmMgKGxvZywgd2FybiwgZXJyb3IsIG9TY29wZSwgbWV0aG9kID0gImZpbmRBbGwiLCBkZXB0aCwgb2Jqcywgc3RhcnQsIGVuZCwgZmllbGRzKSA9PiB7CgkJCS8qKiogU1RBUlQgTE9DQUwgZmluZEFsbCgpICoqKi8KCQkJLy90aGlzLl9fdGltZSgnbG90dG8uQ29udGVudC5maW5kQWxsJyk7CgoJCQkvLyBhdm9pZHMgY3ljbGljIHF1ZXJpZXMKCQkJb2JqcyA9IChvYmpzIHx8IFtdKS5tYXAobyA9PiBvLl9jbG9uZSgpKTsKCgkJCWF3YWl0IHRoaXMuX3N0b3JlRW50aXR5Q2xhc3MoKTsgLy8/PwoKCQkJbGV0IHJldCA9IFtdOyAvLyBhIGpzb24gYXJyYXkKCgkJCWlmICh0aGlzLlRvb2wudHlwZS5uYW1lID09ICJGaWxlU3lzdGVtIikgewoKCQkJCXJldCA9IFthd2FpdCB0aGlzLl9maWxlc3lzdGVtKHRoaXMuX2ZpbGVOYW1lKCkpXTsKCgkJCX0KCgkJCWlmICh0aGlzLlRvb2wudHlwZS5uYW1lID09ICJHaXRIdWIiKSB7CgoJCQkJcmV0ID0gW2F3YWl0IHRoaXMuX2dpdGh1Yih0aGlzLl9maWxlTmFtZSgpKV07CgoJCQl9CgoJCQl0aGlzLmxvZyh1bmRlZmluZWQsICdmaW5kQWxsJywgJ0VudGl0eU9iamVjdCcsIDAsICJCZWZvcmUgX2Zyb21Eb2N1bWVudCgpIiwgcmV0KTsKCgkJCXJldCA9IHJldC5maWx0ZXIociA9PiByKS5tYXAociA9PiBuZXcgbG90dG8uQ29udGVudChudWxsLCB0aGlzLlRvb2wpLl9mcm9tRG9jdW1lbnQociwgdHJ1ZSwgdHJ1ZSkuX19zeW5jX29uKG5ldyBEYXRlKCkpKTsKCgkJCWF3YWl0IHRoaXMuX2ZpbmRSZWZlcmVuY2VzKHJldCwgb2JqcywgZGVwdGgpOwoJCQl0aGlzLmxvZyh1bmRlZmluZWQsICdmaW5kQWxsJywgJ0VudGl0eU9iamVjdCcsIDAsICJPdXRwdXQiLCByZXQpOwoKCQkJZGVsZXRlIGxvdHRvLl91blJlY3Vyc2U7CgoJCQlyZXR1cm4gcmV0OwoJCQkvKioqIEVORCBMT0NBTCBmaW5kQWxsKCkgKioqLwoJCX0sIHsKCQkJZGVwdGgsCgkJCW9ianMsCgkJCXN0YXJ0LAoJCQllbmQsCgkJCWZpZWxkcywKCQkJX19iZWZvcmVSdWxlczogW10sCgkJCV9fYWZ0ZXJSdWxlczogW10KCQl9KTsKCgkJcmV0dXJuIChyZXN1bHRzLmZpbmQociA9PiByLnJldCkgfHwgewoJCQlyZXQ6IFtdCgkJfSkucmV0IHx8IFtdOyAvLyBmaXJzdCBvbmUgdG8gZXhlY3V0ZSBjb3JyZWN0bHkKCX0KCglhc3luYyBfZmluZFJlZmVyZW5jZXMocmV0LCBvYmpzLCBkZXB0aCkgewoKCQl0cnkgewoJCQlpZiAoZGVwdGggPiAxKSB7CgkJCQlmb3IgYXdhaXQgKGNvbnN0IHIgb2YgcmV0KSB7CgoJCQkJfQoJCQl9CgoJCQlsZXQgcmVmcyA9IFtdOwoJCQlpZiAoIUFycmF5LmlzQXJyYXkocmV0KSkgcmV0ID0gW3JldF07CgoJCQlyZWZzLnB1c2goLi4ucmV0LmZpbHRlcihyID0+IHIuRW50aXR5Q2xhc3MpKTsKCQkJZm9yIGF3YWl0IChjb25zdCBvIG9mIChvYmpzIHx8IFtdKSkgewoJCQkJbGV0IG9mYSA9IFtdOwoJCQkJaWYgKG8uX3RvRU1TT2JqZWN0KSB7CgkJCQkJb2ZhID0gYXdhaXQgdGhpcy5fZnJvbUVNU1ZhbHVlcyhhd2FpdCBvLl90b0VNU09iamVjdCh0cnVlLCB0cnVlKS5maW5kQWxsKGRlcHRoKSk7CgkJCQl9IGVsc2UgewoJCQkJCW9mYSA9IGF3YWl0IG8uZmluZEFsbChkZXB0aCk7CgkJCQl9CgkJCQlyZWZzLnB1c2goLi4ub2ZhKTsKCQkJfQoJCQlyZWZzID0gcmVmcy5maWx0ZXIociA9PiByKTsKCQkJcmVmcy5mb3JFYWNoKHIgPT4gewoJCQkJZm9yICh2YXIgcCBpbiByKSB7CgkJCQkJaWYgKHAuc3RhcnRzV2l0aCgnXycpICYmIHJbcF0gJiYgcltwICsgIl9zZXQiXSAmJiByW3BdLklkICYmIHJlZnMuZmluZChvID0+IG8uSWQgPT0gcltwXS5JZCkpIHsKCQkJCQkJcltwLnN1YnN0cmluZygxKV0ocmVmcy5maW5kKG8gPT4gby5JZCA9PSByW3BdLklkKSk7CgkJCQkJfQoJCQkJfQoJCQl9KTsKCgkJCXJldHVybiByZXQ7CgkJfSBjYXRjaCAoZXgpIHsKCQkJdGhpcy5sb2codW5kZWZpbmVkLCAnX2ZpbmRSZWZlcmVuY2VzJywgJ0VudGl0eU9iamVjdCcsIDIsIGV4KTsKCQl9CgoJfQoKfTsKCgppZih0eXBlb2YobW9kdWxlKSE9PSJ1bmRlZmluZWQiKSBtb2R1bGUuZXhwb3J0cy5sb3R0byA9IGxvdHRvOwoKKGFzeW5jICgpID0+IGF3YWl0IG5ldyBsb3R0by5Vc2VyKCkuX3NlcnZlcih0eXBlb2YoX19fb3B0aW9ucykhPT0ndW5kZWZpbmVkJz9fX19vcHRpb25zOntpbml0Tm9kZTogdHJ1ZSwgaW5pdFNlbGY6IHRydWUsIGxvYWRUb29sczogdHJ1ZSwgbG9hZENvbnRlbnQ6IHRydWV9KSkoKTs="
}