{
	"Id": "e7e34f3201eb69aa7a827bfb46186e4dcc09c566",
	"active": "true",
	"enabled": "true",
	"code": "snow",
	"date": "2024-11-02T04:41:35.415Z",
	"name": "SNOW",
	"remark": "dmFyIGVzcHRlc3QgPSBDbGFzcy5jcmVhdGUoKTsNCmVzcHRlc3QucHJvdG90eXBlID0gew0KICAgIGluaXRpYWxpemUgOmZ1bmN0aW9uKCl7fSwNCiAgICB0eXBlOiAnZXNwdGVzdCcsDQp9Ow0KDQoNCg0KICAgIA0KICAgIGVzcHRlc3QuVXNlciA9IGNsYXNzIHsNCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogVXNlci5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBhY3RpdmUodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fYWN0aXZlID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9hY3RpdmU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogVXNlci5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgZW5hYmxlZCh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9lbmFibGVkID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9lbmFibGVkOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIFVzZXIuY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGNvZGUodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fY29kZSA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fY29kZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBVc2VyLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgb3JkZXIodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fb3JkZXIgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX29yZGVyOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIFVzZXIuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGRhdGUodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fZGF0ZSA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZGF0ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBVc2VyLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBuYW1lKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX25hbWUgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX25hbWU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogVXNlci5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICByZW1hcmsodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fcmVtYXJrID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9yZW1hcms7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogVXNlci51c2VybmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHVzZXJuYW1lKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX3VzZXJuYW1lID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl91c2VybmFtZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBVc2VyLnBhc3N3b3JkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgcGFzc3dvcmQodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fcGFzc3dvcmQgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3Bhc3N3b3JkOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgDQogICAgDQogICAgDQogICAgICAgIF9mcm9tRG9jdW1lbnQob2JqKXsNCiAgICAgICAgICAgIGxldCBfX3RvU3RyaW5nID0gJ1VzZXIuX2Zyb21Eb2N1bWVudCgpOiAnOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBpZighb2JqKSByZXR1cm4gdGhpczsNCg0KICAgICAgICAgICAgLy9pZiBpc2luc3RhbmNlKG9iaiwgYnl0ZXMpOiBvYmogPSBzdHIob2JqLCAidXRmLTgiKTsNCg0KICAgICAgICAgICAgaWYodHlwZW9mKG9iaik9PT0nc3RyaW5nJyl7DQogICAgICAgICAgICAgICAgaWYobmV3IFJlZ0V4cCgiKCgoW0EtWmEtel17Myw5fTooPzovLyk/KSg/OlstOzomPSskLHddK0ApP1tBLVphLXowLTkuLV0rfCg/Ond3dy58Wy07OiY9KyQsd10rQClbQS1aYS16MC05Li1dKykoKD86L1srfiUvLnctX10qKT8/Pyg/OlstKz0mOyVALndfXSopIz8oPzpbd10qKSk/KSIpLnRlc3Qob2JqKSl7DQogICAgICAgICAgICAgICAgICAgIGxldCByZXF1ZXN0ID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTsNCiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdC5zZXRIdHRwTWV0aG9kKCdHRVQnKTsNCiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdC5zZXRFbmRwb2ludChvYmopOw0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHJlcXVlc3QuZXhlY3V0ZSgpLmdldEJvZHkoKSk7DQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoSlNPTi5wYXJzZShvYmopKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgaWYoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKXtyZXR1cm4gbmV3IFVzZXIoKS5fZnJvbURvY3VtZW50KG8pfSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZihvYmouSWQpIT09J3VuZGVmaW5lZCcpIHRoaXMuSWQgPSBvYmouSWQ7DQoNCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZihvYmouYWN0aXZlKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2Yob2JqLmVuYWJsZWQpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKG9iai5jb2RlKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLmNvZGUob2JqLmNvZGUpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZihvYmoub3JkZXIpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMub3JkZXIob2JqLm9yZGVyKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2Yob2JqLmRhdGUpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuZGF0ZShvYmouZGF0ZSk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIHRoaXMuZGF0ZShuZXcgR2xpZGVEYXRlVGltZSh0aGlzLmRhdGUoKSkpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZihvYmoubmFtZSkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5uYW1lKG9iai5uYW1lKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2Yob2JqLnJlbWFyaykhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5yZW1hcmsob2JqLnJlbWFyayk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIHRoaXMucmVtYXJrKEdsaWRlU3RyaW5nVXRpbC5iYXNlNjREZWNvZGUodGhpcy5yZW1hcmsoKSkpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZihvYmoudXNlcm5hbWUpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMudXNlcm5hbWUob2JqLnVzZXJuYW1lKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2Yob2JqLnBhc3N3b3JkKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLnBhc3N3b3JkKG9iai5wYXNzd29yZCk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KDQogICAgDQoNCiAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICB9DQoNCiAgICAgICAgX3RvRG9jdW1lbnQoKXsNCiAgICAgICAgICAgIGxldCBfX3RvU3RyaW5nID0gJ1VzZXIuX3RvRG9jdW1lbnQoKTogJzsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgbGV0IHJldCA9IHt9Ow0KICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMuSWQpIT09J3VuZGVmaW5lZCcpIHJldC5JZCA9IHRoaXMuSWQ7DQoNCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZih0aGlzLl9hY3RpdmUpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHJldC5hY3RpdmUgPSB0aGlzLmFjdGl2ZSgpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZih0aGlzLl9lbmFibGVkKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICByZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZih0aGlzLl9jb2RlKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICByZXQuY29kZSA9IHRoaXMuY29kZSgpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZih0aGlzLl9vcmRlcikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgcmV0Lm9yZGVyID0gdGhpcy5vcmRlcigpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZih0aGlzLl9kYXRlKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICByZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBpZihyZXQuZGF0ZSAmJiB0eXBlb2YocmV0LmRhdGUuZ2V0TnVtZXJpY1ZhbHVlKT09PSdmdW5jdGlvbicpIHJldC5kYXRlID0gbmV3IERhdGUocmV0LmRhdGUuZ2V0TnVtZXJpY1ZhbHVlKCkpLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZih0aGlzLl9uYW1lKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICByZXQubmFtZSA9IHRoaXMubmFtZSgpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZih0aGlzLl9yZW1hcmspIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHJldC5yZW1hcmsgPSB0aGlzLnJlbWFyaygpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBpZih0eXBlb2YocmV0LnJlbWFyaygpKT09PSdvYmplY3QnKSByZXQucmVtYXJrID0gR2xpZGVTdHJpbmdVdGlsLmJhc2U2NEVuY29kZShKU09OLnN0cmluZ2lmeShyZXQucmVtYXJrKSk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMuX3VzZXJuYW1lKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICByZXQudXNlcm5hbWUgPSB0aGlzLnVzZXJuYW1lKCk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMuX3Bhc3N3b3JkKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICByZXQucGFzc3dvcmQgPSB0aGlzLnBhc3N3b3JkKCk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICANCiAgICANCiAgICAgICAgICAgIHJldHVybiByZXQ7DQogICAgICAgIH0NCg0KICAgICAgICBfdW5pcXVlKCl7DQogICAgICAgICAgICBsZXQgX190b1N0cmluZyA9ICdVc2VyLl91bmlxdWUoKTogJzsNCiAgICAgICAgDQogICAgICAgICAgICBsZXQgcmV0ID0gbmV3IHVuZGVmaW5lZCgpOw0KICAgICAgICAgICAgaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDsNCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZih0aGlzLmNvZGUoKSkhPT0ndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpOw0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMudXNlcm5hbWUoKSkhPT0ndW5kZWZpbmVkJykgcmV0LnVzZXJuYW1lKHRoaXMudXNlcm5hbWUoKSk7DQogICAgDQogICAgICAgICAgICByZXR1cm4gcmV0Ow0KICAgICAgICB9DQoNCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogVXNlci5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHN0b3JlKF9fZXZlbnQpew0KICAgICAgICAgICAgbGV0IF9fdG9TdHJpbmcgPSAnVXNlci5zdG9yZSgpOiAnOw0KDQogICAgICAgICAgICBsZXQgYW5zd2VyID0gdW5kZWZpbmVkOw0KDQogICAgICAgICAgICB2YXIgbm9kZSA9IG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uTm9kZSgpLmNvZGUoZ3MuZ2V0UHJvcGVydHkoJ2luc3RhbmNlX25hbWUnKSk7DQogICAgICAgICAgICBsZXQgX19yZXNwb25zZSA9IG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrbmV3IERhdGUobmV3IEdsaWRlRGF0ZVRpbWUoKSkudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJykrJ10uVXNlci5zdG9yZSgpJykubWV0aG9kKCdzdG9yZScpLmNsYXNzTmFtZSgnVXNlcicpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpOw0KDQogICAgICAgICAgICBsZXQgZXZKU09OID0gbnVsbDsNCiAgICAgICAgICAgIGlmKF9fZXZlbnQpew0KICAgICAgICAgICAgICAgIGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgICAgIGlmKHR5cGVvZihldkpTT04uX190aGlzKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpOw0KICAgICAgICANCg0KDQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAvL19fcmVzcG9uc2UucmVjaXBpZW50KG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uTm9kZSgpLmNvZGUoJ3BhcmVudCcpKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoX19ldmVudCAmJiAhX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KDQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgaWYoX19ldmVudCAmJiBfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBhbnN3ZXIgPSBVc2VyKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZighX19ldmVudCl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgLy8gc3RvcmUgbG9jYWxseQ0KICAgICAgICAgICAgICAgIGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgnVXNlcicpOw0KDQogICAgICAgICAgICAgICAgbGV0IF90aGlzID0gdGhpcy5fdW5pcXVlKCkuZmluZCgpOw0KICAgICAgICAgICAgICAgIGlmKCFfdGhpcykgZ3Iuc2V0TmV3R3VpZFZhbHVlKHRoaXMuSWQgfHwgKHRoaXMuSWQgPSBnci5zZXROZXdHdWlkKCkpKTsNCiAgICAgICAgICAgICAgICBpZihfdGhpcyAmJiB0eXBlb2YoX3RoaXMuSWQpIT09J3VuZGVmaW5lZCcpIGdyLmdldChfdGhpcy5JZCk7DQoNCiAgICAgICAgICAgICAgICBsZXQgYlNldCA9IGZhbHNlOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBpZihfdGhpcyAmJiB0eXBlb2YoX3RoaXMuZ2V0Y29kZSgpKSE9PSd1bmRlZmluZWQnKSBiU2V0ID0gZ3Iuc2V0VmFsdWUoJ2NvZGUnLCBfdGhpcy5nZXRjb2RlKCkpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBpZihfdGhpcyAmJiB0eXBlb2YoX3RoaXMuZ2V0dXNlcm5hbWUoKSkhPT0ndW5kZWZpbmVkJykgYlNldCA9IGdyLnNldFZhbHVlKCd1c2VybmFtZScsIF90aGlzLmdldHVzZXJuYW1lKCkpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBpZihiU2V0KXsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5JZCA9IGdyLnVwZGF0ZSgpOw0KICAgICAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAidGhpcy5JZCA9ICIgKyB0aGlzLklkKTsNCiAgICAgICAgICAgICAgICAgICAgaWYoIWFuc3dlcikgYW5zd2VyID0gdGhpczsNCiAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImludmFsaWQgb2JqZWN0Iik7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIA0KDQogICAgICAgICAgICB9DQoNCg0KDQoNCiAgICAgICAgICAgIGlmKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgaWYoYW5zd2VyKXsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7X190aGlzOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHJldHVybiBhbnN3ZXI7DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogVXNlci5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgZmluZEFsbChfX2V2ZW50KXsNCiAgICAgICAgICAgIGxldCBfX3RvU3RyaW5nID0gJ1VzZXIuZmluZEFsbCgpOiAnOw0KDQogICAgICAgICAgICBsZXQgYW5zd2VyID0gdW5kZWZpbmVkOw0KDQogICAgICAgICAgICB2YXIgbm9kZSA9IG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uTm9kZSgpLmNvZGUoZ3MuZ2V0UHJvcGVydHkoJ2luc3RhbmNlX25hbWUnKSk7DQogICAgICAgICAgICBsZXQgX19yZXNwb25zZSA9IG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrbmV3IERhdGUobmV3IEdsaWRlRGF0ZVRpbWUoKSkudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJykrJ10uVXNlci5maW5kQWxsKCknKS5tZXRob2QoJ2ZpbmRBbGwnKS5jbGFzc05hbWUoJ1VzZXInKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKTsNCg0KICAgICAgICAgICAgbGV0IGV2SlNPTiA9IG51bGw7DQogICAgICAgICAgICBpZihfX2V2ZW50KXsNCiAgICAgICAgICAgICAgICBldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgICAgICBpZih0eXBlb2YoZXZKU09OLl9fdGhpcykhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTsNCiAgICAgICAgDQoNCg0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgLy9fX3Jlc3BvbnNlLnJlY2lwaWVudChuZXcgZXNwdGVzdC5jb20ubmFtbW91ci5kY29tLk5vZGUoKS5jb2RlKCdwYXJlbnQnKSk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKF9fZXZlbnQgJiYgIV9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCg0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgIGlmKF9fZXZlbnQgJiYgX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgYW5zd2VyID0gVXNlcigpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIA0KDQogICAgICAgICAgICB9DQoNCg0KDQoNCiAgICAgICAgICAgIGlmKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgaWYoYW5zd2VyKXsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7X190aGlzOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHJldHVybiBhbnN3ZXI7DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogVXNlci5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgZmluZChfX2V2ZW50KXsNCiAgICAgICAgICAgIGxldCBfX3RvU3RyaW5nID0gJ1VzZXIuZmluZCgpOiAnOw0KDQogICAgICAgICAgICBsZXQgYW5zd2VyID0gdW5kZWZpbmVkOw0KDQogICAgICAgICAgICB2YXIgbm9kZSA9IG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uTm9kZSgpLmNvZGUoZ3MuZ2V0UHJvcGVydHkoJ2luc3RhbmNlX25hbWUnKSk7DQogICAgICAgICAgICBsZXQgX19yZXNwb25zZSA9IG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrbmV3IERhdGUobmV3IEdsaWRlRGF0ZVRpbWUoKSkudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJykrJ10uVXNlci5maW5kKCknKS5tZXRob2QoJ2ZpbmQnKS5jbGFzc05hbWUoJ1VzZXInKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKTsNCg0KICAgICAgICAgICAgbGV0IGV2SlNPTiA9IG51bGw7DQogICAgICAgICAgICBpZihfX2V2ZW50KXsNCiAgICAgICAgICAgICAgICBldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgICAgICBpZih0eXBlb2YoZXZKU09OLl9fdGhpcykhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTsNCiAgICAgICAgDQoNCg0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgLy9fX3Jlc3BvbnNlLnJlY2lwaWVudChuZXcgZXNwdGVzdC5jb20ubmFtbW91ci5kY29tLk5vZGUoKS5jb2RlKCdwYXJlbnQnKSk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKF9fZXZlbnQgJiYgIV9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCg0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgIGlmKF9fZXZlbnQgJiYgX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgYW5zd2VyID0gVXNlcigpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIA0KDQogICAgICAgICAgICB9DQoNCg0KDQoNCiAgICAgICAgICAgIGlmKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgaWYoYW5zd2VyKXsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7X190aGlzOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHJldHVybiBhbnN3ZXI7DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogVXNlci5pbml0KCkgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgaW5pdChfX2V2ZW50KXsNCiAgICAgICAgICAgIGxldCBfX3RvU3RyaW5nID0gJ1VzZXIuaW5pdCgpOiAnOw0KDQogICAgICAgICAgICBsZXQgYW5zd2VyID0gdW5kZWZpbmVkOw0KDQogICAgICAgICAgICB2YXIgbm9kZSA9IG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uTm9kZSgpLmNvZGUoZ3MuZ2V0UHJvcGVydHkoJ2luc3RhbmNlX25hbWUnKSk7DQogICAgICAgICAgICBsZXQgX19yZXNwb25zZSA9IG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrbmV3IERhdGUobmV3IEdsaWRlRGF0ZVRpbWUoKSkudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJykrJ10uVXNlci5pbml0KCknKS5tZXRob2QoJ2luaXQnKS5jbGFzc05hbWUoJ1VzZXInKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKTsNCg0KICAgICAgICAgICAgbGV0IGV2SlNPTiA9IG51bGw7DQogICAgICAgICAgICBpZihfX2V2ZW50KXsNCiAgICAgICAgICAgICAgICBldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgICAgICBpZih0eXBlb2YoZXZKU09OLl9fdGhpcykhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTsNCiAgICAgICAgDQoNCg0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgLy9fX3Jlc3BvbnNlLnJlY2lwaWVudChuZXcgZXNwdGVzdC5jb20ubmFtbW91ci5kY29tLk5vZGUoKS5jb2RlKCdwYXJlbnQnKSk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKF9fZXZlbnQgJiYgIV9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCg0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgIGlmKF9fZXZlbnQgJiYgX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgYW5zd2VyID0gZXZKU09OOw0KICAgICAgICANCg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZighX19ldmVudCl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KDQoNCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBpZihhbnN3ZXIpew0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChzdHIoYW5zd2VyKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHtfX3RoaXM6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcmV0dXJuIGFuc3dlcjsNCiAgICAgICAgfQ0KICAgIA0KICAgIH07DQoNCiAgICBlc3B0ZXN0LmNvbSA9IGVzcHRlc3QuY29tIHx8IHt9O2VzcHRlc3QuY29tLm5hbW1vdXIgPSBlc3B0ZXN0LmNvbS5uYW1tb3VyIHx8IHt9O2VzcHRlc3QuY29tLm5hbW1vdXIuZGlvdCA9IGVzcHRlc3QuY29tLm5hbW1vdXIuZGlvdCB8fCB7fTsNCiAgICBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRpb3QuTWV0cmljID0gY2xhc3Mgew0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBNZXRyaWMuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgYWN0aXZlKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX2FjdGl2ZSA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fYWN0aXZlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE1ldHJpYy5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgZW5hYmxlZCh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9lbmFibGVkID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9lbmFibGVkOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE1ldHJpYy5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgY29kZSh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9jb2RlID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9jb2RlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE1ldHJpYy5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIG9yZGVyKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX29yZGVyID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9vcmRlcjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBNZXRyaWMuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGRhdGUodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fZGF0ZSA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZGF0ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBNZXRyaWMubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIG5hbWUodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fbmFtZSA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fbmFtZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBNZXRyaWMucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgcmVtYXJrKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX3JlbWFyayA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fcmVtYXJrOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE1ldHJpYy5zY3JpcHQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBzY3JpcHQodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fc2NyaXB0ID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9zY3JpcHQ7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTWV0cmljLnR5cGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICB0eXBlKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX3R5cGUgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3R5cGU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTWV0cmljLmRldmljZVR5cGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBkZXZpY2VUeXBlKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX2RldmljZVR5cGUgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2RldmljZVR5cGU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICANCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTWV0cmljLm1ldHJpY19NZXRyaWNfVmFsdWVzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgbWV0cmljX01ldHJpY19WYWx1ZXModil7DQogICAgICAgIH0NCiAgICANCiAgICANCiAgICAgICAgX2Zyb21Eb2N1bWVudChvYmopew0KICAgICAgICAgICAgbGV0IF9fdG9TdHJpbmcgPSAnTWV0cmljLl9mcm9tRG9jdW1lbnQoKTogJzsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgaWYoIW9iaikgcmV0dXJuIHRoaXM7DQoNCiAgICAgICAgICAgIC8vaWYgaXNpbnN0YW5jZShvYmosIGJ5dGVzKTogb2JqID0gc3RyKG9iaiwgInV0Zi04Iik7DQoNCiAgICAgICAgICAgIGlmKHR5cGVvZihvYmopPT09J3N0cmluZycpew0KICAgICAgICAgICAgICAgIGlmKG5ldyBSZWdFeHAoIigoKFtBLVphLXpdezMsOX06KD86Ly8pPykoPzpbLTs6Jj0rJCx3XStAKT9bQS1aYS16MC05Li1dK3woPzp3d3cufFstOzomPSskLHddK0ApW0EtWmEtejAtOS4tXSspKCg/Oi9bK34lLy53LV9dKik/Pz8oPzpbLSs9JjslQC53X10qKSM/KD86W3ddKikpPykiKS50ZXN0KG9iaikpew0KICAgICAgICAgICAgICAgICAgICBsZXQgcmVxdWVzdCA9IG5ldyBzbl93cy5SRVNUTWVzc2FnZVYyKCk7DQogICAgICAgICAgICAgICAgICAgIHJlcXVlc3Quc2V0SHR0cE1ldGhvZCgnR0VUJyk7DQogICAgICAgICAgICAgICAgICAgIHJlcXVlc3Quc2V0RW5kcG9pbnQob2JqKTsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChyZXF1ZXN0LmV4ZWN1dGUoKS5nZXRCb2R5KCkpOw0KICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KEpTT04ucGFyc2Uob2JqKSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgIGlmKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obyl7cmV0dXJuIG5ldyBNZXRyaWMoKS5fZnJvbURvY3VtZW50KG8pfSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZihvYmouSWQpIT09J3VuZGVmaW5lZCcpIHRoaXMuSWQgPSBvYmouSWQ7DQoNCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZihvYmouYWN0aXZlKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2Yob2JqLmVuYWJsZWQpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKG9iai5jb2RlKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLmNvZGUob2JqLmNvZGUpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZihvYmoub3JkZXIpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMub3JkZXIob2JqLm9yZGVyKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2Yob2JqLmRhdGUpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuZGF0ZShvYmouZGF0ZSk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIHRoaXMuZGF0ZShuZXcgR2xpZGVEYXRlVGltZSh0aGlzLmRhdGUoKSkpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZihvYmoubmFtZSkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5uYW1lKG9iai5uYW1lKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2Yob2JqLnJlbWFyaykhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5yZW1hcmsob2JqLnJlbWFyayk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIHRoaXMucmVtYXJrKEdsaWRlU3RyaW5nVXRpbC5iYXNlNjREZWNvZGUodGhpcy5yZW1hcmsoKSkpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZihvYmouc2NyaXB0KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLnNjcmlwdChvYmouc2NyaXB0KTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgdGhpcy5zY3JpcHQoR2xpZGVTdHJpbmdVdGlsLmJhc2U2NERlY29kZSh0aGlzLnNjcmlwdCgpKSk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKG9iai50eXBlKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLnR5cGUoTWV0cmljX1R5cGUoKS5fZnJvbURvY3VtZW50KG9iai50eXBlKSk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKG9iai5kZXZpY2VUeXBlKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLmRldmljZVR5cGUoRGV2aWNlX1R5cGUoKS5fZnJvbURvY3VtZW50KG9iai5kZXZpY2VUeXBlKSk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KDQogICAgDQogICAgICAgICAgICBpZih0eXBlb2Yob2JqLm1ldHJpY19NZXRyaWNfVmFsdWVzKSE9PSd1bmRlZmluZWQnKSB0aGlzLm1ldHJpY19NZXRyaWNfVmFsdWVzKG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRpb3QuTWV0cmljX1ZhbHVlKCkuX2Zyb21Eb2N1bWVudChvYmoubWV0cmljX21ldHJpY19NZXRyaWNfVmFsdWVzKSk7DQogICAgDQoNCiAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICB9DQoNCiAgICAgICAgX3RvRG9jdW1lbnQoKXsNCiAgICAgICAgICAgIGxldCBfX3RvU3RyaW5nID0gJ01ldHJpYy5fdG9Eb2N1bWVudCgpOiAnOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBsZXQgcmV0ID0ge307DQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5JZCkhPT0ndW5kZWZpbmVkJykgcmV0LklkID0gdGhpcy5JZDsNCg0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMuX2FjdGl2ZSkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgcmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMuX2VuYWJsZWQpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHJldC5lbmFibGVkID0gdGhpcy5lbmFibGVkKCk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMuX2NvZGUpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHJldC5jb2RlID0gdGhpcy5jb2RlKCk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMuX29yZGVyKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICByZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMuX2RhdGUpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHJldC5kYXRlID0gdGhpcy5kYXRlKCk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGlmKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS5nZXROdW1lcmljVmFsdWUpPT09J2Z1bmN0aW9uJykgcmV0LmRhdGUgPSBuZXcgRGF0ZShyZXQuZGF0ZS5nZXROdW1lcmljVmFsdWUoKSkudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMuX25hbWUpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHJldC5uYW1lID0gdGhpcy5uYW1lKCk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMuX3JlbWFyaykhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgcmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGlmKHR5cGVvZihyZXQucmVtYXJrKCkpPT09J29iamVjdCcpIHJldC5yZW1hcmsgPSBHbGlkZVN0cmluZ1V0aWwuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5yZW1hcmspKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5fc2NyaXB0KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICByZXQuc2NyaXB0ID0gdGhpcy5zY3JpcHQoKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgaWYodHlwZW9mKHJldC5zY3JpcHQoKSk9PT0nb2JqZWN0JykgcmV0LnNjcmlwdCA9IEdsaWRlU3RyaW5nVXRpbC5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnNjcmlwdCkpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZih0aGlzLl90eXBlKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICByZXQudHlwZSA9IHRoaXMudHlwZSgpLl90b0RvY3VtZW50KCk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMuX2RldmljZVR5cGUpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHJldC5kZXZpY2VUeXBlID0gdGhpcy5kZXZpY2VUeXBlKCkuX3RvRG9jdW1lbnQoKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgIA0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMubWV0cmljX01ldHJpY19WYWx1ZXMoKSkhPT0ndW5kZWZpbmVkJykgcmV0Lm1ldHJpY19NZXRyaWNfVmFsdWVzID0gc2VsZi5tZXRyaWNfbWV0cmljX01ldHJpY19WYWx1ZXMoKS5tYXAoZnVuY3Rpb24odGEpe3JldHVybiB0YS5fdG9Eb2N1bWVudCgpO30pOw0KICAgIA0KICAgICAgICAgICAgcmV0dXJuIHJldDsNCiAgICAgICAgfQ0KDQogICAgICAgIF91bmlxdWUoKXsNCiAgICAgICAgICAgIGxldCBfX3RvU3RyaW5nID0gJ01ldHJpYy5fdW5pcXVlKCk6ICc7DQogICAgICAgIA0KICAgICAgICAgICAgbGV0IHJldCA9IG5ldyB1bmRlZmluZWQoKTsNCiAgICAgICAgICAgIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5jb2RlKCkpIT09J3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTsNCiAgICANCiAgICAgICAgICAgIHJldHVybiByZXQ7DQogICAgICAgIH0NCg0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBNZXRyaWMuc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBzdG9yZShfX2V2ZW50KXsNCiAgICAgICAgICAgIGxldCBfX3RvU3RyaW5nID0gJ01ldHJpYy5zdG9yZSgpOiAnOw0KDQogICAgICAgICAgICBsZXQgYW5zd2VyID0gdW5kZWZpbmVkOw0KDQogICAgICAgICAgICB2YXIgbm9kZSA9IG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uTm9kZSgpLmNvZGUoZ3MuZ2V0UHJvcGVydHkoJ2luc3RhbmNlX25hbWUnKSk7DQogICAgICAgICAgICBsZXQgX19yZXNwb25zZSA9IG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrbmV3IERhdGUobmV3IEdsaWRlRGF0ZVRpbWUoKSkudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJykrJ10uTWV0cmljLnN0b3JlKCknKS5tZXRob2QoJ3N0b3JlJykuY2xhc3NOYW1lKCdNZXRyaWMnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKTsNCg0KICAgICAgICAgICAgbGV0IGV2SlNPTiA9IG51bGw7DQogICAgICAgICAgICBpZihfX2V2ZW50KXsNCiAgICAgICAgICAgICAgICBldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgICAgICBpZih0eXBlb2YoZXZKU09OLl9fdGhpcykhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTsNCiAgICAgICAgDQoNCg0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgLy9fX3Jlc3BvbnNlLnJlY2lwaWVudChuZXcgZXNwdGVzdC5jb20ubmFtbW91ci5kY29tLk5vZGUoKS5jb2RlKCdwYXJlbnQnKSk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKF9fZXZlbnQgJiYgIV9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCg0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgIGlmKF9fZXZlbnQgJiYgX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgYW5zd2VyID0gTWV0cmljKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZighX19ldmVudCl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgLy8gc3RvcmUgbG9jYWxseQ0KICAgICAgICAgICAgICAgIGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgnTWV0cmljJyk7DQoNCiAgICAgICAgICAgICAgICBsZXQgX3RoaXMgPSB0aGlzLl91bmlxdWUoKS5maW5kKCk7DQogICAgICAgICAgICAgICAgaWYoIV90aGlzKSBnci5zZXROZXdHdWlkVmFsdWUodGhpcy5JZCB8fCAodGhpcy5JZCA9IGdyLnNldE5ld0d1aWQoKSkpOw0KICAgICAgICAgICAgICAgIGlmKF90aGlzICYmIHR5cGVvZihfdGhpcy5JZCkhPT0ndW5kZWZpbmVkJykgZ3IuZ2V0KF90aGlzLklkKTsNCg0KICAgICAgICAgICAgICAgIGxldCBiU2V0ID0gZmFsc2U7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGlmKF90aGlzICYmIHR5cGVvZihfdGhpcy5nZXRjb2RlKCkpIT09J3VuZGVmaW5lZCcpIGJTZXQgPSBnci5zZXRWYWx1ZSgnY29kZScsIF90aGlzLmdldGNvZGUoKSk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGlmKGJTZXQpew0KICAgICAgICAgICAgICAgICAgICB0aGlzLklkID0gZ3IudXBkYXRlKCk7DQogICAgICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJ0aGlzLklkID0gIiArIHRoaXMuSWQpOw0KICAgICAgICAgICAgICAgICAgICBpZighYW5zd2VyKSBhbnN3ZXIgPSB0aGlzOw0KICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiaW52YWxpZCBvYmplY3QiKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KDQoNCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBpZihhbnN3ZXIpew0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHtfX3RoaXM6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcmV0dXJuIGFuc3dlcjsNCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBNZXRyaWMuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGZpbmRBbGwoX19ldmVudCl7DQogICAgICAgICAgICBsZXQgX190b1N0cmluZyA9ICdNZXRyaWMuZmluZEFsbCgpOiAnOw0KDQogICAgICAgICAgICBsZXQgYW5zd2VyID0gdW5kZWZpbmVkOw0KDQogICAgICAgICAgICB2YXIgbm9kZSA9IG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uTm9kZSgpLmNvZGUoZ3MuZ2V0UHJvcGVydHkoJ2luc3RhbmNlX25hbWUnKSk7DQogICAgICAgICAgICBsZXQgX19yZXNwb25zZSA9IG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrbmV3IERhdGUobmV3IEdsaWRlRGF0ZVRpbWUoKSkudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJykrJ10uTWV0cmljLmZpbmRBbGwoKScpLm1ldGhvZCgnZmluZEFsbCcpLmNsYXNzTmFtZSgnTWV0cmljJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSk7DQoNCiAgICAgICAgICAgIGxldCBldkpTT04gPSBudWxsOw0KICAgICAgICAgICAgaWYoX19ldmVudCl7DQogICAgICAgICAgICAgICAgZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICAgICAgaWYodHlwZW9mKGV2SlNPTi5fX3RoaXMpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgICAgICB0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7DQogICAgICAgIA0KDQoNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIC8vX19yZXNwb25zZS5yZWNpcGllbnQobmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5Ob2RlKCkuY29kZSgncGFyZW50JykpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZihfX2V2ZW50ICYmICFfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQoNCiAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICBpZihfX2V2ZW50ICYmIF9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGFuc3dlciA9IE1ldHJpYygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIA0KDQogICAgICAgICAgICB9DQoNCg0KDQoNCiAgICAgICAgICAgIGlmKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgaWYoYW5zd2VyKXsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7X190aGlzOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHJldHVybiBhbnN3ZXI7DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTWV0cmljLmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBmaW5kKF9fZXZlbnQpew0KICAgICAgICAgICAgbGV0IF9fdG9TdHJpbmcgPSAnTWV0cmljLmZpbmQoKTogJzsNCg0KICAgICAgICAgICAgbGV0IGFuc3dlciA9IHVuZGVmaW5lZDsNCg0KICAgICAgICAgICAgdmFyIG5vZGUgPSBuZXcgZXNwdGVzdC5jb20ubmFtbW91ci5kY29tLk5vZGUoKS5jb2RlKGdzLmdldFByb3BlcnR5KCdpbnN0YW5jZV9uYW1lJykpOw0KICAgICAgICAgICAgbGV0IF9fcmVzcG9uc2UgPSBuZXcgZXNwdGVzdC5jb20ubmFtbW91ci5kY29tLkV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK25ldyBEYXRlKG5ldyBHbGlkZURhdGVUaW1lKCkpLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpKyddLk1ldHJpYy5maW5kKCknKS5tZXRob2QoJ2ZpbmQnKS5jbGFzc05hbWUoJ01ldHJpYycpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpOw0KDQogICAgICAgICAgICBsZXQgZXZKU09OID0gbnVsbDsNCiAgICAgICAgICAgIGlmKF9fZXZlbnQpew0KICAgICAgICAgICAgICAgIGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgICAgIGlmKHR5cGVvZihldkpTT04uX190aGlzKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpOw0KICAgICAgICANCg0KDQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAvL19fcmVzcG9uc2UucmVjaXBpZW50KG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uTm9kZSgpLmNvZGUoJ3BhcmVudCcpKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoX19ldmVudCAmJiAhX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KDQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgaWYoX19ldmVudCAmJiBfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBhbnN3ZXIgPSBNZXRyaWMoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKCFfX2V2ZW50KXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICANCg0KICAgICAgICAgICAgfQ0KDQoNCg0KDQogICAgICAgICAgICBpZighX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGlmKGFuc3dlcil7DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoe19fdGhpczogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICByZXR1cm4gYW5zd2VyOw0KICAgICAgICB9DQogICAgDQogICAgfTsNCg0KICAgIGVzcHRlc3QuY29tID0gZXNwdGVzdC5jb20gfHwge307ZXNwdGVzdC5jb20ubmFtbW91ciA9IGVzcHRlc3QuY29tLm5hbW1vdXIgfHwge307ZXNwdGVzdC5jb20ubmFtbW91ci5kaW90ID0gZXNwdGVzdC5jb20ubmFtbW91ci5kaW90IHx8IHt9Ow0KICAgIGVzcHRlc3QuY29tLm5hbW1vdXIuZGlvdC5NZXRyaWNfVmFsdWUgPSBjbGFzcyB7DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE1ldHJpY19WYWx1ZS5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBhY3RpdmUodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fYWN0aXZlID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9hY3RpdmU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTWV0cmljX1ZhbHVlLmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBlbmFibGVkKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX2VuYWJsZWQgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2VuYWJsZWQ7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTWV0cmljX1ZhbHVlLmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBjb2RlKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX2NvZGUgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2NvZGU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTWV0cmljX1ZhbHVlLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgb3JkZXIodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fb3JkZXIgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX29yZGVyOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE1ldHJpY19WYWx1ZS5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgZGF0ZSh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9kYXRlID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9kYXRlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE1ldHJpY19WYWx1ZS5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgbmFtZSh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9uYW1lID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9uYW1lOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE1ldHJpY19WYWx1ZS5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICByZW1hcmsodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fcmVtYXJrID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9yZW1hcms7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTWV0cmljX1ZhbHVlLnZhbHVlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgdmFsdWUodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fdmFsdWUgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3ZhbHVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE1ldHJpY19WYWx1ZS5tZWFzdXJlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIG1lYXN1cmVkKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX21lYXN1cmVkID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9tZWFzdXJlZDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBNZXRyaWNfVmFsdWUubWV0cmljIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgbWV0cmljKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX21ldHJpYyA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fbWV0cmljOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE1ldHJpY19WYWx1ZS5kZXZpY2UgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBkZXZpY2Uodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fZGV2aWNlID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9kZXZpY2U7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICANCiAgICANCiAgICANCiAgICAgICAgX2Zyb21Eb2N1bWVudChvYmopew0KICAgICAgICAgICAgbGV0IF9fdG9TdHJpbmcgPSAnTWV0cmljX1ZhbHVlLl9mcm9tRG9jdW1lbnQoKTogJzsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgaWYoIW9iaikgcmV0dXJuIHRoaXM7DQoNCiAgICAgICAgICAgIC8vaWYgaXNpbnN0YW5jZShvYmosIGJ5dGVzKTogb2JqID0gc3RyKG9iaiwgInV0Zi04Iik7DQoNCiAgICAgICAgICAgIGlmKHR5cGVvZihvYmopPT09J3N0cmluZycpew0KICAgICAgICAgICAgICAgIGlmKG5ldyBSZWdFeHAoIigoKFtBLVphLXpdezMsOX06KD86Ly8pPykoPzpbLTs6Jj0rJCx3XStAKT9bQS1aYS16MC05Li1dK3woPzp3d3cufFstOzomPSskLHddK0ApW0EtWmEtejAtOS4tXSspKCg/Oi9bK34lLy53LV9dKik/Pz8oPzpbLSs9JjslQC53X10qKSM/KD86W3ddKikpPykiKS50ZXN0KG9iaikpew0KICAgICAgICAgICAgICAgICAgICBsZXQgcmVxdWVzdCA9IG5ldyBzbl93cy5SRVNUTWVzc2FnZVYyKCk7DQogICAgICAgICAgICAgICAgICAgIHJlcXVlc3Quc2V0SHR0cE1ldGhvZCgnR0VUJyk7DQogICAgICAgICAgICAgICAgICAgIHJlcXVlc3Quc2V0RW5kcG9pbnQob2JqKTsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChyZXF1ZXN0LmV4ZWN1dGUoKS5nZXRCb2R5KCkpOw0KICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KEpTT04ucGFyc2Uob2JqKSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgIGlmKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obyl7cmV0dXJuIG5ldyBNZXRyaWNfVmFsdWUoKS5fZnJvbURvY3VtZW50KG8pfSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZihvYmouSWQpIT09J3VuZGVmaW5lZCcpIHRoaXMuSWQgPSBvYmouSWQ7DQoNCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZihvYmouYWN0aXZlKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2Yob2JqLmVuYWJsZWQpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKG9iai5jb2RlKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLmNvZGUob2JqLmNvZGUpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZihvYmoub3JkZXIpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMub3JkZXIob2JqLm9yZGVyKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2Yob2JqLmRhdGUpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuZGF0ZShvYmouZGF0ZSk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIHRoaXMuZGF0ZShuZXcgR2xpZGVEYXRlVGltZSh0aGlzLmRhdGUoKSkpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZihvYmoubmFtZSkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5uYW1lKG9iai5uYW1lKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2Yob2JqLnJlbWFyaykhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5yZW1hcmsob2JqLnJlbWFyayk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIHRoaXMucmVtYXJrKEdsaWRlU3RyaW5nVXRpbC5iYXNlNjREZWNvZGUodGhpcy5yZW1hcmsoKSkpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZihvYmoudmFsdWUpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMudmFsdWUob2JqLnZhbHVlKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2Yob2JqLm1lYXN1cmVkKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLm1lYXN1cmVkKG9iai5tZWFzdXJlZCk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIHRoaXMubWVhc3VyZWQobmV3IEdsaWRlRGF0ZVRpbWUodGhpcy5tZWFzdXJlZCgpKSk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKG9iai5tZXRyaWMpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMubWV0cmljKE1ldHJpYygpLl9mcm9tRG9jdW1lbnQob2JqLm1ldHJpYykpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZihvYmouZGV2aWNlKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLmRldmljZShEZXZpY2UoKS5fZnJvbURvY3VtZW50KG9iai5kZXZpY2UpKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQoNCiAgICANCg0KICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgIH0NCg0KICAgICAgICBfdG9Eb2N1bWVudCgpew0KICAgICAgICAgICAgbGV0IF9fdG9TdHJpbmcgPSAnTWV0cmljX1ZhbHVlLl90b0RvY3VtZW50KCk6ICc7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGxldCByZXQgPSB7fTsNCiAgICAgICAgICAgIGlmKHR5cGVvZih0aGlzLklkKSE9PSd1bmRlZmluZWQnKSByZXQuSWQgPSB0aGlzLklkOw0KDQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5fYWN0aXZlKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICByZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5fZW5hYmxlZCkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgcmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5fY29kZSkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgcmV0LmNvZGUgPSB0aGlzLmNvZGUoKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5fb3JkZXIpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5fZGF0ZSkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgcmV0LmRhdGUgPSB0aGlzLmRhdGUoKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgaWYocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLmdldE51bWVyaWNWYWx1ZSk9PT0nZnVuY3Rpb24nKSByZXQuZGF0ZSA9IG5ldyBEYXRlKHJldC5kYXRlLmdldE51bWVyaWNWYWx1ZSgpKS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5fbmFtZSkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgcmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5fcmVtYXJrKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICByZXQucmVtYXJrID0gdGhpcy5yZW1hcmsoKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgaWYodHlwZW9mKHJldC5yZW1hcmsoKSk9PT0nb2JqZWN0JykgcmV0LnJlbWFyayA9IEdsaWRlU3RyaW5nVXRpbC5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZih0aGlzLl92YWx1ZSkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgcmV0LnZhbHVlID0gdGhpcy52YWx1ZSgpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZih0aGlzLl9tZWFzdXJlZCkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgcmV0Lm1lYXN1cmVkID0gdGhpcy5tZWFzdXJlZCgpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBpZihyZXQubWVhc3VyZWQgJiYgdHlwZW9mKHJldC5tZWFzdXJlZC5nZXROdW1lcmljVmFsdWUpPT09J2Z1bmN0aW9uJykgcmV0Lm1lYXN1cmVkID0gbmV3IERhdGUocmV0Lm1lYXN1cmVkLmdldE51bWVyaWNWYWx1ZSgpKS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5fbWV0cmljKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICByZXQubWV0cmljID0gdGhpcy5tZXRyaWMoKS5fdG9Eb2N1bWVudCgpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZih0aGlzLl9kZXZpY2UpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHJldC5kZXZpY2UgPSB0aGlzLmRldmljZSgpLl90b0RvY3VtZW50KCk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICANCiAgICANCiAgICAgICAgICAgIHJldHVybiByZXQ7DQogICAgICAgIH0NCg0KICAgICAgICBfdW5pcXVlKCl7DQogICAgICAgICAgICBsZXQgX190b1N0cmluZyA9ICdNZXRyaWNfVmFsdWUuX3VuaXF1ZSgpOiAnOw0KICAgICAgICANCiAgICAgICAgICAgIGxldCByZXQgPSBuZXcgdW5kZWZpbmVkKCk7DQogICAgICAgICAgICBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkOw0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMubWV0cmljKCkpIT09J3VuZGVmaW5lZCcpIHJldC5tZXRyaWModGhpcy5tZXRyaWMoKS5fdW5pcXVlKCkpOw0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMuZGV2aWNlKCkpIT09J3VuZGVmaW5lZCcpIHJldC5kZXZpY2UodGhpcy5kZXZpY2UoKS5fdW5pcXVlKCkpOw0KICAgIA0KICAgICAgICAgICAgcmV0dXJuIHJldDsNCiAgICAgICAgfQ0KDQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE1ldHJpY19WYWx1ZS5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHN0b3JlKF9fZXZlbnQpew0KICAgICAgICAgICAgbGV0IF9fdG9TdHJpbmcgPSAnTWV0cmljX1ZhbHVlLnN0b3JlKCk6ICc7DQoNCiAgICAgICAgICAgIGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7DQoNCiAgICAgICAgICAgIHZhciBub2RlID0gbmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5Ob2RlKCkuY29kZShncy5nZXRQcm9wZXJ0eSgnaW5zdGFuY2VfbmFtZScpKTsNCiAgICAgICAgICAgIGxldCBfX3Jlc3BvbnNlID0gbmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5FdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytuZXcgRGF0ZShuZXcgR2xpZGVEYXRlVGltZSgpKS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKSsnXS5NZXRyaWNfVmFsdWUuc3RvcmUoKScpLm1ldGhvZCgnc3RvcmUnKS5jbGFzc05hbWUoJ01ldHJpY19WYWx1ZScpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpOw0KDQogICAgICAgICAgICBsZXQgZXZKU09OID0gbnVsbDsNCiAgICAgICAgICAgIGlmKF9fZXZlbnQpew0KICAgICAgICAgICAgICAgIGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgICAgIGlmKHR5cGVvZihldkpTT04uX190aGlzKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpOw0KICAgICAgICANCg0KDQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAvL19fcmVzcG9uc2UucmVjaXBpZW50KG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uTm9kZSgpLmNvZGUoJ3BhcmVudCcpKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoX19ldmVudCAmJiAhX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KDQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgaWYoX19ldmVudCAmJiBfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBhbnN3ZXIgPSBNZXRyaWNfVmFsdWUoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKCFfX2V2ZW50KXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBzdG9yZSBsb2NhbGx5DQogICAgICAgICAgICAgICAgbGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCdNZXRyaWNfVmFsdWUnKTsNCg0KICAgICAgICAgICAgICAgIGxldCBfdGhpcyA9IHRoaXMuX3VuaXF1ZSgpLmZpbmQoKTsNCiAgICAgICAgICAgICAgICBpZighX3RoaXMpIGdyLnNldE5ld0d1aWRWYWx1ZSh0aGlzLklkIHx8ICh0aGlzLklkID0gZ3Iuc2V0TmV3R3VpZCgpKSk7DQogICAgICAgICAgICAgICAgaWYoX3RoaXMgJiYgdHlwZW9mKF90aGlzLklkKSE9PSd1bmRlZmluZWQnKSBnci5nZXQoX3RoaXMuSWQpOw0KDQogICAgICAgICAgICAgICAgbGV0IGJTZXQgPSBmYWxzZTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgaWYoX3RoaXMgJiYgdHlwZW9mKF90aGlzLmdldG1ldHJpYygpKSE9PSd1bmRlZmluZWQnKSBiU2V0ID0gZ3Iuc2V0VmFsdWUoJ21ldHJpYycsIF90aGlzLmdldG1ldHJpYygpKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgaWYoX3RoaXMgJiYgdHlwZW9mKF90aGlzLmdldGRldmljZSgpKSE9PSd1bmRlZmluZWQnKSBiU2V0ID0gZ3Iuc2V0VmFsdWUoJ2RldmljZScsIF90aGlzLmdldGRldmljZSgpKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgaWYoYlNldCl7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuSWQgPSBnci51cGRhdGUoKTsNCiAgICAgICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgInRoaXMuSWQgPSAiICsgdGhpcy5JZCk7DQogICAgICAgICAgICAgICAgICAgIGlmKCFhbnN3ZXIpIGFuc3dlciA9IHRoaXM7DQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJpbnZhbGlkIG9iamVjdCIpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICANCg0KICAgICAgICAgICAgfQ0KDQoNCg0KDQogICAgICAgICAgICBpZighX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGlmKGFuc3dlcil7DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoe19fdGhpczogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICByZXR1cm4gYW5zd2VyOw0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE1ldHJpY19WYWx1ZS5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgZmluZEFsbChfX2V2ZW50KXsNCiAgICAgICAgICAgIGxldCBfX3RvU3RyaW5nID0gJ01ldHJpY19WYWx1ZS5maW5kQWxsKCk6ICc7DQoNCiAgICAgICAgICAgIGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7DQoNCiAgICAgICAgICAgIHZhciBub2RlID0gbmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5Ob2RlKCkuY29kZShncy5nZXRQcm9wZXJ0eSgnaW5zdGFuY2VfbmFtZScpKTsNCiAgICAgICAgICAgIGxldCBfX3Jlc3BvbnNlID0gbmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5FdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytuZXcgRGF0ZShuZXcgR2xpZGVEYXRlVGltZSgpKS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKSsnXS5NZXRyaWNfVmFsdWUuZmluZEFsbCgpJykubWV0aG9kKCdmaW5kQWxsJykuY2xhc3NOYW1lKCdNZXRyaWNfVmFsdWUnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKTsNCg0KICAgICAgICAgICAgbGV0IGV2SlNPTiA9IG51bGw7DQogICAgICAgICAgICBpZihfX2V2ZW50KXsNCiAgICAgICAgICAgICAgICBldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgICAgICBpZih0eXBlb2YoZXZKU09OLl9fdGhpcykhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTsNCiAgICAgICAgDQoNCg0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgLy9fX3Jlc3BvbnNlLnJlY2lwaWVudChuZXcgZXNwdGVzdC5jb20ubmFtbW91ci5kY29tLk5vZGUoKS5jb2RlKCdwYXJlbnQnKSk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKF9fZXZlbnQgJiYgIV9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCg0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgIGlmKF9fZXZlbnQgJiYgX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgYW5zd2VyID0gTWV0cmljX1ZhbHVlKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZighX19ldmVudCl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KDQoNCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBpZihhbnN3ZXIpew0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHtfX3RoaXM6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcmV0dXJuIGFuc3dlcjsNCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBNZXRyaWNfVmFsdWUuZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGZpbmQoX19ldmVudCl7DQogICAgICAgICAgICBsZXQgX190b1N0cmluZyA9ICdNZXRyaWNfVmFsdWUuZmluZCgpOiAnOw0KDQogICAgICAgICAgICBsZXQgYW5zd2VyID0gdW5kZWZpbmVkOw0KDQogICAgICAgICAgICB2YXIgbm9kZSA9IG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uTm9kZSgpLmNvZGUoZ3MuZ2V0UHJvcGVydHkoJ2luc3RhbmNlX25hbWUnKSk7DQogICAgICAgICAgICBsZXQgX19yZXNwb25zZSA9IG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrbmV3IERhdGUobmV3IEdsaWRlRGF0ZVRpbWUoKSkudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJykrJ10uTWV0cmljX1ZhbHVlLmZpbmQoKScpLm1ldGhvZCgnZmluZCcpLmNsYXNzTmFtZSgnTWV0cmljX1ZhbHVlJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSk7DQoNCiAgICAgICAgICAgIGxldCBldkpTT04gPSBudWxsOw0KICAgICAgICAgICAgaWYoX19ldmVudCl7DQogICAgICAgICAgICAgICAgZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICAgICAgaWYodHlwZW9mKGV2SlNPTi5fX3RoaXMpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgICAgICB0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7DQogICAgICAgIA0KDQoNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIC8vX19yZXNwb25zZS5yZWNpcGllbnQobmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5Ob2RlKCkuY29kZSgncGFyZW50JykpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZihfX2V2ZW50ICYmICFfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQoNCiAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICBpZihfX2V2ZW50ICYmIF9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGFuc3dlciA9IE1ldHJpY19WYWx1ZSgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIA0KDQogICAgICAgICAgICB9DQoNCg0KDQoNCiAgICAgICAgICAgIGlmKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgaWYoYW5zd2VyKXsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7X190aGlzOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHJldHVybiBhbnN3ZXI7DQogICAgICAgIH0NCiAgICANCiAgICB9Ow0KDQogICAgZXNwdGVzdC5jb20gPSBlc3B0ZXN0LmNvbSB8fCB7fTtlc3B0ZXN0LmNvbS5uYW1tb3VyID0gZXNwdGVzdC5jb20ubmFtbW91ciB8fCB7fTtlc3B0ZXN0LmNvbS5uYW1tb3VyLmRpb3QgPSBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRpb3QgfHwge307DQogICAgZXNwdGVzdC5jb20ubmFtbW91ci5kaW90LkRldmljZSA9IGNsYXNzIHsNCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogRGV2aWNlLmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGFjdGl2ZSh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9hY3RpdmUgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2FjdGl2ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBEZXZpY2UuZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGVuYWJsZWQodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fZW5hYmxlZCA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZW5hYmxlZDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBEZXZpY2UuY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGNvZGUodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fY29kZSA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fY29kZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBEZXZpY2Uub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBvcmRlcih2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9vcmRlciA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fb3JkZXI7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogRGV2aWNlLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBkYXRlKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX2RhdGUgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2RhdGU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogRGV2aWNlLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBuYW1lKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX25hbWUgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX25hbWU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogRGV2aWNlLnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHJlbWFyayh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9yZW1hcmsgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3JlbWFyazsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBEZXZpY2UudHlwZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHR5cGUodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fdHlwZSA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fdHlwZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBEZXZpY2UuY29udHJvbGxlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGNvbnRyb2xsZXIodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fY29udHJvbGxlciA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fY29udHJvbGxlcjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgIA0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBEZXZpY2UuZGV2aWNlX01ldHJpY19WYWx1ZXMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBkZXZpY2VfTWV0cmljX1ZhbHVlcyh2KXsNCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBEZXZpY2UuZGV2aWNlX0RldmljZV9BdHRyaWJ1dGVzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgZGV2aWNlX0RldmljZV9BdHRyaWJ1dGVzKHYpew0KICAgICAgICB9DQogICAgDQogICAgDQogICAgICAgIF9mcm9tRG9jdW1lbnQob2JqKXsNCiAgICAgICAgICAgIGxldCBfX3RvU3RyaW5nID0gJ0RldmljZS5fZnJvbURvY3VtZW50KCk6ICc7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGlmKCFvYmopIHJldHVybiB0aGlzOw0KDQogICAgICAgICAgICAvL2lmIGlzaW5zdGFuY2Uob2JqLCBieXRlcyk6IG9iaiA9IHN0cihvYmosICJ1dGYtOCIpOw0KDQogICAgICAgICAgICBpZih0eXBlb2Yob2JqKT09PSdzdHJpbmcnKXsNCiAgICAgICAgICAgICAgICBpZihuZXcgUmVnRXhwKCIoKChbQS1aYS16XXszLDl9Oig/Oi8vKT8pKD86Wy07OiY9KyQsd10rQCk/W0EtWmEtejAtOS4tXSt8KD86d3d3LnxbLTs6Jj0rJCx3XStAKVtBLVphLXowLTkuLV0rKSgoPzovWyt+JS8udy1fXSopPz8/KD86Wy0rPSY7JUAud19dKikjPyg/Olt3XSopKT8pIikudGVzdChvYmopKXsNCiAgICAgICAgICAgICAgICAgICAgbGV0IHJlcXVlc3QgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpOw0KICAgICAgICAgICAgICAgICAgICByZXF1ZXN0LnNldEh0dHBNZXRob2QoJ0dFVCcpOw0KICAgICAgICAgICAgICAgICAgICByZXF1ZXN0LnNldEVuZHBvaW50KG9iaik7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQocmVxdWVzdC5leGVjdXRlKCkuZ2V0Qm9keSgpKTsNCiAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChKU09OLnBhcnNlKG9iaikpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICBpZihBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pe3JldHVybiBuZXcgRGV2aWNlKCkuX2Zyb21Eb2N1bWVudChvKX0pOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBpZih0eXBlb2Yob2JqLklkKSE9PSd1bmRlZmluZWQnKSB0aGlzLklkID0gb2JqLklkOw0KDQogICAgDQogICAgICAgICAgICBpZih0eXBlb2Yob2JqLmFjdGl2ZSkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKG9iai5lbmFibGVkKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZihvYmouY29kZSkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5jb2RlKG9iai5jb2RlKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2Yob2JqLm9yZGVyKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLm9yZGVyKG9iai5vcmRlcik7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKG9iai5kYXRlKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLmRhdGUob2JqLmRhdGUpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICB0aGlzLmRhdGUobmV3IEdsaWRlRGF0ZVRpbWUodGhpcy5kYXRlKCkpKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2Yob2JqLm5hbWUpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMubmFtZShvYmoubmFtZSk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKG9iai5yZW1hcmspIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMucmVtYXJrKG9iai5yZW1hcmspOw0KICAgICAgICANCiAgICAgICAgICAgICAgICB0aGlzLnJlbWFyayhHbGlkZVN0cmluZ1V0aWwuYmFzZTY0RGVjb2RlKHRoaXMucmVtYXJrKCkpKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2Yob2JqLnR5cGUpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMudHlwZShEZXZpY2VfVHlwZSgpLl9mcm9tRG9jdW1lbnQob2JqLnR5cGUpKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2Yob2JqLmNvbnRyb2xsZXIpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuY29udHJvbGxlcihOb2RlKCkuX2Zyb21Eb2N1bWVudChvYmouY29udHJvbGxlcikpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCg0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKG9iai5kZXZpY2VfTWV0cmljX1ZhbHVlcykhPT0ndW5kZWZpbmVkJykgdGhpcy5kZXZpY2VfTWV0cmljX1ZhbHVlcyhuZXcgZXNwdGVzdC5jb20ubmFtbW91ci5kaW90Lk1ldHJpY19WYWx1ZSgpLl9mcm9tRG9jdW1lbnQob2JqLmRldmljZV9kZXZpY2VfTWV0cmljX1ZhbHVlcykpOw0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKG9iai5kZXZpY2VfRGV2aWNlX0F0dHJpYnV0ZXMpIT09J3VuZGVmaW5lZCcpIHRoaXMuZGV2aWNlX0RldmljZV9BdHRyaWJ1dGVzKG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRpb3QuRGV2aWNlX0F0dHJpYnV0ZSgpLl9mcm9tRG9jdW1lbnQob2JqLmRldmljZV9kZXZpY2VfRGV2aWNlX0F0dHJpYnV0ZXMpKTsNCiAgICANCg0KICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgIH0NCg0KICAgICAgICBfdG9Eb2N1bWVudCgpew0KICAgICAgICAgICAgbGV0IF9fdG9TdHJpbmcgPSAnRGV2aWNlLl90b0RvY3VtZW50KCk6ICc7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGxldCByZXQgPSB7fTsNCiAgICAgICAgICAgIGlmKHR5cGVvZih0aGlzLklkKSE9PSd1bmRlZmluZWQnKSByZXQuSWQgPSB0aGlzLklkOw0KDQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5fYWN0aXZlKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICByZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5fZW5hYmxlZCkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgcmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5fY29kZSkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgcmV0LmNvZGUgPSB0aGlzLmNvZGUoKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5fb3JkZXIpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5fZGF0ZSkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgcmV0LmRhdGUgPSB0aGlzLmRhdGUoKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgaWYocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLmdldE51bWVyaWNWYWx1ZSk9PT0nZnVuY3Rpb24nKSByZXQuZGF0ZSA9IG5ldyBEYXRlKHJldC5kYXRlLmdldE51bWVyaWNWYWx1ZSgpKS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5fbmFtZSkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgcmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5fcmVtYXJrKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICByZXQucmVtYXJrID0gdGhpcy5yZW1hcmsoKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgaWYodHlwZW9mKHJldC5yZW1hcmsoKSk9PT0nb2JqZWN0JykgcmV0LnJlbWFyayA9IEdsaWRlU3RyaW5nVXRpbC5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZih0aGlzLl90eXBlKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICByZXQudHlwZSA9IHRoaXMudHlwZSgpLl90b0RvY3VtZW50KCk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMuX2NvbnRyb2xsZXIpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHJldC5jb250cm9sbGVyID0gdGhpcy5jb250cm9sbGVyKCkuX3RvRG9jdW1lbnQoKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgIA0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMuZGV2aWNlX01ldHJpY19WYWx1ZXMoKSkhPT0ndW5kZWZpbmVkJykgcmV0LmRldmljZV9NZXRyaWNfVmFsdWVzID0gc2VsZi5kZXZpY2VfZGV2aWNlX01ldHJpY19WYWx1ZXMoKS5tYXAoZnVuY3Rpb24odGEpe3JldHVybiB0YS5fdG9Eb2N1bWVudCgpO30pOw0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMuZGV2aWNlX0RldmljZV9BdHRyaWJ1dGVzKCkpIT09J3VuZGVmaW5lZCcpIHJldC5kZXZpY2VfRGV2aWNlX0F0dHJpYnV0ZXMgPSBzZWxmLmRldmljZV9kZXZpY2VfRGV2aWNlX0F0dHJpYnV0ZXMoKS5tYXAoZnVuY3Rpb24odGEpe3JldHVybiB0YS5fdG9Eb2N1bWVudCgpO30pOw0KICAgIA0KICAgICAgICAgICAgcmV0dXJuIHJldDsNCiAgICAgICAgfQ0KDQogICAgICAgIF91bmlxdWUoKXsNCiAgICAgICAgICAgIGxldCBfX3RvU3RyaW5nID0gJ0RldmljZS5fdW5pcXVlKCk6ICc7DQogICAgICAgIA0KICAgICAgICAgICAgbGV0IHJldCA9IG5ldyB1bmRlZmluZWQoKTsNCiAgICAgICAgICAgIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5jb2RlKCkpIT09J3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTsNCiAgICANCiAgICAgICAgICAgIHJldHVybiByZXQ7DQogICAgICAgIH0NCg0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBEZXZpY2Uuc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBzdG9yZShfX2V2ZW50KXsNCiAgICAgICAgICAgIGxldCBfX3RvU3RyaW5nID0gJ0RldmljZS5zdG9yZSgpOiAnOw0KDQogICAgICAgICAgICBsZXQgYW5zd2VyID0gdW5kZWZpbmVkOw0KDQogICAgICAgICAgICB2YXIgbm9kZSA9IG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uTm9kZSgpLmNvZGUoZ3MuZ2V0UHJvcGVydHkoJ2luc3RhbmNlX25hbWUnKSk7DQogICAgICAgICAgICBsZXQgX19yZXNwb25zZSA9IG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrbmV3IERhdGUobmV3IEdsaWRlRGF0ZVRpbWUoKSkudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJykrJ10uRGV2aWNlLnN0b3JlKCknKS5tZXRob2QoJ3N0b3JlJykuY2xhc3NOYW1lKCdEZXZpY2UnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKTsNCg0KICAgICAgICAgICAgbGV0IGV2SlNPTiA9IG51bGw7DQogICAgICAgICAgICBpZihfX2V2ZW50KXsNCiAgICAgICAgICAgICAgICBldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgICAgICBpZih0eXBlb2YoZXZKU09OLl9fdGhpcykhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTsNCiAgICAgICAgDQoNCg0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgLy9fX3Jlc3BvbnNlLnJlY2lwaWVudChuZXcgZXNwdGVzdC5jb20ubmFtbW91ci5kY29tLk5vZGUoKS5jb2RlKCdwYXJlbnQnKSk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKF9fZXZlbnQgJiYgIV9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCg0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgIGlmKF9fZXZlbnQgJiYgX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgYW5zd2VyID0gRGV2aWNlKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZighX19ldmVudCl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgLy8gc3RvcmUgbG9jYWxseQ0KICAgICAgICAgICAgICAgIGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgnRGV2aWNlJyk7DQoNCiAgICAgICAgICAgICAgICBsZXQgX3RoaXMgPSB0aGlzLl91bmlxdWUoKS5maW5kKCk7DQogICAgICAgICAgICAgICAgaWYoIV90aGlzKSBnci5zZXROZXdHdWlkVmFsdWUodGhpcy5JZCB8fCAodGhpcy5JZCA9IGdyLnNldE5ld0d1aWQoKSkpOw0KICAgICAgICAgICAgICAgIGlmKF90aGlzICYmIHR5cGVvZihfdGhpcy5JZCkhPT0ndW5kZWZpbmVkJykgZ3IuZ2V0KF90aGlzLklkKTsNCg0KICAgICAgICAgICAgICAgIGxldCBiU2V0ID0gZmFsc2U7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGlmKF90aGlzICYmIHR5cGVvZihfdGhpcy5nZXRjb2RlKCkpIT09J3VuZGVmaW5lZCcpIGJTZXQgPSBnci5zZXRWYWx1ZSgnY29kZScsIF90aGlzLmdldGNvZGUoKSk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGlmKGJTZXQpew0KICAgICAgICAgICAgICAgICAgICB0aGlzLklkID0gZ3IudXBkYXRlKCk7DQogICAgICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJ0aGlzLklkID0gIiArIHRoaXMuSWQpOw0KICAgICAgICAgICAgICAgICAgICBpZighYW5zd2VyKSBhbnN3ZXIgPSB0aGlzOw0KICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiaW52YWxpZCBvYmplY3QiKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KDQoNCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBpZihhbnN3ZXIpew0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHtfX3RoaXM6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcmV0dXJuIGFuc3dlcjsNCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBEZXZpY2UuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGZpbmRBbGwoX19ldmVudCl7DQogICAgICAgICAgICBsZXQgX190b1N0cmluZyA9ICdEZXZpY2UuZmluZEFsbCgpOiAnOw0KDQogICAgICAgICAgICBsZXQgYW5zd2VyID0gdW5kZWZpbmVkOw0KDQogICAgICAgICAgICB2YXIgbm9kZSA9IG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uTm9kZSgpLmNvZGUoZ3MuZ2V0UHJvcGVydHkoJ2luc3RhbmNlX25hbWUnKSk7DQogICAgICAgICAgICBsZXQgX19yZXNwb25zZSA9IG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrbmV3IERhdGUobmV3IEdsaWRlRGF0ZVRpbWUoKSkudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJykrJ10uRGV2aWNlLmZpbmRBbGwoKScpLm1ldGhvZCgnZmluZEFsbCcpLmNsYXNzTmFtZSgnRGV2aWNlJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSk7DQoNCiAgICAgICAgICAgIGxldCBldkpTT04gPSBudWxsOw0KICAgICAgICAgICAgaWYoX19ldmVudCl7DQogICAgICAgICAgICAgICAgZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICAgICAgaWYodHlwZW9mKGV2SlNPTi5fX3RoaXMpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgICAgICB0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7DQogICAgICAgIA0KDQoNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIC8vX19yZXNwb25zZS5yZWNpcGllbnQobmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5Ob2RlKCkuY29kZSgncGFyZW50JykpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZihfX2V2ZW50ICYmICFfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQoNCiAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICBpZihfX2V2ZW50ICYmIF9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGFuc3dlciA9IERldmljZSgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIA0KDQogICAgICAgICAgICB9DQoNCg0KDQoNCiAgICAgICAgICAgIGlmKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgaWYoYW5zd2VyKXsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7X190aGlzOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHJldHVybiBhbnN3ZXI7DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogRGV2aWNlLmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBmaW5kKF9fZXZlbnQpew0KICAgICAgICAgICAgbGV0IF9fdG9TdHJpbmcgPSAnRGV2aWNlLmZpbmQoKTogJzsNCg0KICAgICAgICAgICAgbGV0IGFuc3dlciA9IHVuZGVmaW5lZDsNCg0KICAgICAgICAgICAgdmFyIG5vZGUgPSBuZXcgZXNwdGVzdC5jb20ubmFtbW91ci5kY29tLk5vZGUoKS5jb2RlKGdzLmdldFByb3BlcnR5KCdpbnN0YW5jZV9uYW1lJykpOw0KICAgICAgICAgICAgbGV0IF9fcmVzcG9uc2UgPSBuZXcgZXNwdGVzdC5jb20ubmFtbW91ci5kY29tLkV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK25ldyBEYXRlKG5ldyBHbGlkZURhdGVUaW1lKCkpLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpKyddLkRldmljZS5maW5kKCknKS5tZXRob2QoJ2ZpbmQnKS5jbGFzc05hbWUoJ0RldmljZScpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpOw0KDQogICAgICAgICAgICBsZXQgZXZKU09OID0gbnVsbDsNCiAgICAgICAgICAgIGlmKF9fZXZlbnQpew0KICAgICAgICAgICAgICAgIGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgICAgIGlmKHR5cGVvZihldkpTT04uX190aGlzKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpOw0KICAgICAgICANCg0KDQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAvL19fcmVzcG9uc2UucmVjaXBpZW50KG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uTm9kZSgpLmNvZGUoJ3BhcmVudCcpKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoX19ldmVudCAmJiAhX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KDQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgaWYoX19ldmVudCAmJiBfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBhbnN3ZXIgPSBEZXZpY2UoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKCFfX2V2ZW50KXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICANCg0KICAgICAgICAgICAgfQ0KDQoNCg0KDQogICAgICAgICAgICBpZighX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGlmKGFuc3dlcil7DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoe19fdGhpczogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICByZXR1cm4gYW5zd2VyOw0KICAgICAgICB9DQogICAgDQogICAgfTsNCg0KICAgIGVzcHRlc3QuY29tID0gZXNwdGVzdC5jb20gfHwge307ZXNwdGVzdC5jb20ubmFtbW91ciA9IGVzcHRlc3QuY29tLm5hbW1vdXIgfHwge307ZXNwdGVzdC5jb20ubmFtbW91ci5kaW90ID0gZXNwdGVzdC5jb20ubmFtbW91ci5kaW90IHx8IHt9Ow0KICAgIGVzcHRlc3QuY29tLm5hbW1vdXIuZGlvdC5EZXZpY2VfQXR0cmlidXRlID0gY2xhc3Mgew0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBEZXZpY2VfQXR0cmlidXRlLmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGFjdGl2ZSh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9hY3RpdmUgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2FjdGl2ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBEZXZpY2VfQXR0cmlidXRlLmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBlbmFibGVkKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX2VuYWJsZWQgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2VuYWJsZWQ7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogRGV2aWNlX0F0dHJpYnV0ZS5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgY29kZSh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9jb2RlID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9jb2RlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIERldmljZV9BdHRyaWJ1dGUub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBvcmRlcih2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9vcmRlciA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fb3JkZXI7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogRGV2aWNlX0F0dHJpYnV0ZS5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgZGF0ZSh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9kYXRlID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9kYXRlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIERldmljZV9BdHRyaWJ1dGUubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIG5hbWUodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fbmFtZSA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fbmFtZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBEZXZpY2VfQXR0cmlidXRlLnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHJlbWFyayh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9yZW1hcmsgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3JlbWFyazsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBEZXZpY2VfQXR0cmlidXRlLnZhbHVlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgdmFsdWUodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fdmFsdWUgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3ZhbHVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIERldmljZV9BdHRyaWJ1dGUuZGV2aWNlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgZGV2aWNlKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX2RldmljZSA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZGV2aWNlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIERldmljZV9BdHRyaWJ1dGUuYXR0cmlidXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgYXR0cmlidXRlKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX2F0dHJpYnV0ZSA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fYXR0cmlidXRlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgDQogICAgDQogICAgDQogICAgICAgIF9mcm9tRG9jdW1lbnQob2JqKXsNCiAgICAgICAgICAgIGxldCBfX3RvU3RyaW5nID0gJ0RldmljZV9BdHRyaWJ1dGUuX2Zyb21Eb2N1bWVudCgpOiAnOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBpZighb2JqKSByZXR1cm4gdGhpczsNCg0KICAgICAgICAgICAgLy9pZiBpc2luc3RhbmNlKG9iaiwgYnl0ZXMpOiBvYmogPSBzdHIob2JqLCAidXRmLTgiKTsNCg0KICAgICAgICAgICAgaWYodHlwZW9mKG9iaik9PT0nc3RyaW5nJyl7DQogICAgICAgICAgICAgICAgaWYobmV3IFJlZ0V4cCgiKCgoW0EtWmEtel17Myw5fTooPzovLyk/KSg/OlstOzomPSskLHddK0ApP1tBLVphLXowLTkuLV0rfCg/Ond3dy58Wy07OiY9KyQsd10rQClbQS1aYS16MC05Li1dKykoKD86L1srfiUvLnctX10qKT8/Pyg/OlstKz0mOyVALndfXSopIz8oPzpbd10qKSk/KSIpLnRlc3Qob2JqKSl7DQogICAgICAgICAgICAgICAgICAgIGxldCByZXF1ZXN0ID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTsNCiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdC5zZXRIdHRwTWV0aG9kKCdHRVQnKTsNCiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdC5zZXRFbmRwb2ludChvYmopOw0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHJlcXVlc3QuZXhlY3V0ZSgpLmdldEJvZHkoKSk7DQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoSlNPTi5wYXJzZShvYmopKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgaWYoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKXtyZXR1cm4gbmV3IERldmljZV9BdHRyaWJ1dGUoKS5fZnJvbURvY3VtZW50KG8pfSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZihvYmouSWQpIT09J3VuZGVmaW5lZCcpIHRoaXMuSWQgPSBvYmouSWQ7DQoNCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZihvYmouYWN0aXZlKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2Yob2JqLmVuYWJsZWQpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKG9iai5jb2RlKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLmNvZGUob2JqLmNvZGUpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZihvYmoub3JkZXIpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMub3JkZXIob2JqLm9yZGVyKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2Yob2JqLmRhdGUpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuZGF0ZShvYmouZGF0ZSk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIHRoaXMuZGF0ZShuZXcgR2xpZGVEYXRlVGltZSh0aGlzLmRhdGUoKSkpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZihvYmoubmFtZSkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5uYW1lKG9iai5uYW1lKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2Yob2JqLnJlbWFyaykhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5yZW1hcmsob2JqLnJlbWFyayk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIHRoaXMucmVtYXJrKEdsaWRlU3RyaW5nVXRpbC5iYXNlNjREZWNvZGUodGhpcy5yZW1hcmsoKSkpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZihvYmoudmFsdWUpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMudmFsdWUob2JqLnZhbHVlKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2Yob2JqLmRldmljZSkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5kZXZpY2UoRGV2aWNlKCkuX2Zyb21Eb2N1bWVudChvYmouZGV2aWNlKSk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKG9iai5hdHRyaWJ1dGUpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuYXR0cmlidXRlKFR5cGVfQXR0cmlidXRlKCkuX2Zyb21Eb2N1bWVudChvYmouYXR0cmlidXRlKSk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KDQogICAgDQoNCiAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICB9DQoNCiAgICAgICAgX3RvRG9jdW1lbnQoKXsNCiAgICAgICAgICAgIGxldCBfX3RvU3RyaW5nID0gJ0RldmljZV9BdHRyaWJ1dGUuX3RvRG9jdW1lbnQoKTogJzsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgbGV0IHJldCA9IHt9Ow0KICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMuSWQpIT09J3VuZGVmaW5lZCcpIHJldC5JZCA9IHRoaXMuSWQ7DQoNCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZih0aGlzLl9hY3RpdmUpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHJldC5hY3RpdmUgPSB0aGlzLmFjdGl2ZSgpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZih0aGlzLl9lbmFibGVkKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICByZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZih0aGlzLl9jb2RlKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICByZXQuY29kZSA9IHRoaXMuY29kZSgpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZih0aGlzLl9vcmRlcikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgcmV0Lm9yZGVyID0gdGhpcy5vcmRlcigpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZih0aGlzLl9kYXRlKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICByZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBpZihyZXQuZGF0ZSAmJiB0eXBlb2YocmV0LmRhdGUuZ2V0TnVtZXJpY1ZhbHVlKT09PSdmdW5jdGlvbicpIHJldC5kYXRlID0gbmV3IERhdGUocmV0LmRhdGUuZ2V0TnVtZXJpY1ZhbHVlKCkpLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZih0aGlzLl9uYW1lKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICByZXQubmFtZSA9IHRoaXMubmFtZSgpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZih0aGlzLl9yZW1hcmspIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHJldC5yZW1hcmsgPSB0aGlzLnJlbWFyaygpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBpZih0eXBlb2YocmV0LnJlbWFyaygpKT09PSdvYmplY3QnKSByZXQucmVtYXJrID0gR2xpZGVTdHJpbmdVdGlsLmJhc2U2NEVuY29kZShKU09OLnN0cmluZ2lmeShyZXQucmVtYXJrKSk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMuX3ZhbHVlKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICByZXQudmFsdWUgPSB0aGlzLnZhbHVlKCk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMuX2RldmljZSkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgcmV0LmRldmljZSA9IHRoaXMuZGV2aWNlKCkuX3RvRG9jdW1lbnQoKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5fYXR0cmlidXRlKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICByZXQuYXR0cmlidXRlID0gdGhpcy5hdHRyaWJ1dGUoKS5fdG9Eb2N1bWVudCgpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgDQogICAgDQogICAgICAgICAgICByZXR1cm4gcmV0Ow0KICAgICAgICB9DQoNCiAgICAgICAgX3VuaXF1ZSgpew0KICAgICAgICAgICAgbGV0IF9fdG9TdHJpbmcgPSAnRGV2aWNlX0F0dHJpYnV0ZS5fdW5pcXVlKCk6ICc7DQogICAgICAgIA0KICAgICAgICAgICAgbGV0IHJldCA9IG5ldyB1bmRlZmluZWQoKTsNCiAgICAgICAgICAgIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5kZXZpY2UoKSkhPT0ndW5kZWZpbmVkJykgcmV0LmRldmljZSh0aGlzLmRldmljZSgpLl91bmlxdWUoKSk7DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5hdHRyaWJ1dGUoKSkhPT0ndW5kZWZpbmVkJykgcmV0LmF0dHJpYnV0ZSh0aGlzLmF0dHJpYnV0ZSgpLl91bmlxdWUoKSk7DQogICAgDQogICAgICAgICAgICByZXR1cm4gcmV0Ow0KICAgICAgICB9DQoNCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogRGV2aWNlX0F0dHJpYnV0ZS5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHN0b3JlKF9fZXZlbnQpew0KICAgICAgICAgICAgbGV0IF9fdG9TdHJpbmcgPSAnRGV2aWNlX0F0dHJpYnV0ZS5zdG9yZSgpOiAnOw0KDQogICAgICAgICAgICBsZXQgYW5zd2VyID0gdW5kZWZpbmVkOw0KDQogICAgICAgICAgICB2YXIgbm9kZSA9IG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uTm9kZSgpLmNvZGUoZ3MuZ2V0UHJvcGVydHkoJ2luc3RhbmNlX25hbWUnKSk7DQogICAgICAgICAgICBsZXQgX19yZXNwb25zZSA9IG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrbmV3IERhdGUobmV3IEdsaWRlRGF0ZVRpbWUoKSkudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJykrJ10uRGV2aWNlX0F0dHJpYnV0ZS5zdG9yZSgpJykubWV0aG9kKCdzdG9yZScpLmNsYXNzTmFtZSgnRGV2aWNlX0F0dHJpYnV0ZScpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpOw0KDQogICAgICAgICAgICBsZXQgZXZKU09OID0gbnVsbDsNCiAgICAgICAgICAgIGlmKF9fZXZlbnQpew0KICAgICAgICAgICAgICAgIGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgICAgIGlmKHR5cGVvZihldkpTT04uX190aGlzKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpOw0KICAgICAgICANCg0KDQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAvL19fcmVzcG9uc2UucmVjaXBpZW50KG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uTm9kZSgpLmNvZGUoJ3BhcmVudCcpKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoX19ldmVudCAmJiAhX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KDQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgaWYoX19ldmVudCAmJiBfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBhbnN3ZXIgPSBEZXZpY2VfQXR0cmlidXRlKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZighX19ldmVudCl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgLy8gc3RvcmUgbG9jYWxseQ0KICAgICAgICAgICAgICAgIGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgnRGV2aWNlX0F0dHJpYnV0ZScpOw0KDQogICAgICAgICAgICAgICAgbGV0IF90aGlzID0gdGhpcy5fdW5pcXVlKCkuZmluZCgpOw0KICAgICAgICAgICAgICAgIGlmKCFfdGhpcykgZ3Iuc2V0TmV3R3VpZFZhbHVlKHRoaXMuSWQgfHwgKHRoaXMuSWQgPSBnci5zZXROZXdHdWlkKCkpKTsNCiAgICAgICAgICAgICAgICBpZihfdGhpcyAmJiB0eXBlb2YoX3RoaXMuSWQpIT09J3VuZGVmaW5lZCcpIGdyLmdldChfdGhpcy5JZCk7DQoNCiAgICAgICAgICAgICAgICBsZXQgYlNldCA9IGZhbHNlOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBpZihfdGhpcyAmJiB0eXBlb2YoX3RoaXMuZ2V0ZGV2aWNlKCkpIT09J3VuZGVmaW5lZCcpIGJTZXQgPSBnci5zZXRWYWx1ZSgnZGV2aWNlJywgX3RoaXMuZ2V0ZGV2aWNlKCkpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBpZihfdGhpcyAmJiB0eXBlb2YoX3RoaXMuZ2V0YXR0cmlidXRlKCkpIT09J3VuZGVmaW5lZCcpIGJTZXQgPSBnci5zZXRWYWx1ZSgnYXR0cmlidXRlJywgX3RoaXMuZ2V0YXR0cmlidXRlKCkpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBpZihiU2V0KXsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5JZCA9IGdyLnVwZGF0ZSgpOw0KICAgICAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAidGhpcy5JZCA9ICIgKyB0aGlzLklkKTsNCiAgICAgICAgICAgICAgICAgICAgaWYoIWFuc3dlcikgYW5zd2VyID0gdGhpczsNCiAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImludmFsaWQgb2JqZWN0Iik7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIA0KDQogICAgICAgICAgICB9DQoNCg0KDQoNCiAgICAgICAgICAgIGlmKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgaWYoYW5zd2VyKXsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7X190aGlzOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHJldHVybiBhbnN3ZXI7DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogRGV2aWNlX0F0dHJpYnV0ZS5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgZmluZEFsbChfX2V2ZW50KXsNCiAgICAgICAgICAgIGxldCBfX3RvU3RyaW5nID0gJ0RldmljZV9BdHRyaWJ1dGUuZmluZEFsbCgpOiAnOw0KDQogICAgICAgICAgICBsZXQgYW5zd2VyID0gdW5kZWZpbmVkOw0KDQogICAgICAgICAgICB2YXIgbm9kZSA9IG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uTm9kZSgpLmNvZGUoZ3MuZ2V0UHJvcGVydHkoJ2luc3RhbmNlX25hbWUnKSk7DQogICAgICAgICAgICBsZXQgX19yZXNwb25zZSA9IG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrbmV3IERhdGUobmV3IEdsaWRlRGF0ZVRpbWUoKSkudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJykrJ10uRGV2aWNlX0F0dHJpYnV0ZS5maW5kQWxsKCknKS5tZXRob2QoJ2ZpbmRBbGwnKS5jbGFzc05hbWUoJ0RldmljZV9BdHRyaWJ1dGUnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKTsNCg0KICAgICAgICAgICAgbGV0IGV2SlNPTiA9IG51bGw7DQogICAgICAgICAgICBpZihfX2V2ZW50KXsNCiAgICAgICAgICAgICAgICBldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgICAgICBpZih0eXBlb2YoZXZKU09OLl9fdGhpcykhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTsNCiAgICAgICAgDQoNCg0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgLy9fX3Jlc3BvbnNlLnJlY2lwaWVudChuZXcgZXNwdGVzdC5jb20ubmFtbW91ci5kY29tLk5vZGUoKS5jb2RlKCdwYXJlbnQnKSk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKF9fZXZlbnQgJiYgIV9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCg0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgIGlmKF9fZXZlbnQgJiYgX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgYW5zd2VyID0gRGV2aWNlX0F0dHJpYnV0ZSgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIA0KDQogICAgICAgICAgICB9DQoNCg0KDQoNCiAgICAgICAgICAgIGlmKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgaWYoYW5zd2VyKXsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7X190aGlzOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHJldHVybiBhbnN3ZXI7DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogRGV2aWNlX0F0dHJpYnV0ZS5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgZmluZChfX2V2ZW50KXsNCiAgICAgICAgICAgIGxldCBfX3RvU3RyaW5nID0gJ0RldmljZV9BdHRyaWJ1dGUuZmluZCgpOiAnOw0KDQogICAgICAgICAgICBsZXQgYW5zd2VyID0gdW5kZWZpbmVkOw0KDQogICAgICAgICAgICB2YXIgbm9kZSA9IG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uTm9kZSgpLmNvZGUoZ3MuZ2V0UHJvcGVydHkoJ2luc3RhbmNlX25hbWUnKSk7DQogICAgICAgICAgICBsZXQgX19yZXNwb25zZSA9IG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrbmV3IERhdGUobmV3IEdsaWRlRGF0ZVRpbWUoKSkudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJykrJ10uRGV2aWNlX0F0dHJpYnV0ZS5maW5kKCknKS5tZXRob2QoJ2ZpbmQnKS5jbGFzc05hbWUoJ0RldmljZV9BdHRyaWJ1dGUnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKTsNCg0KICAgICAgICAgICAgbGV0IGV2SlNPTiA9IG51bGw7DQogICAgICAgICAgICBpZihfX2V2ZW50KXsNCiAgICAgICAgICAgICAgICBldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgICAgICBpZih0eXBlb2YoZXZKU09OLl9fdGhpcykhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTsNCiAgICAgICAgDQoNCg0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgLy9fX3Jlc3BvbnNlLnJlY2lwaWVudChuZXcgZXNwdGVzdC5jb20ubmFtbW91ci5kY29tLk5vZGUoKS5jb2RlKCdwYXJlbnQnKSk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKF9fZXZlbnQgJiYgIV9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCg0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgIGlmKF9fZXZlbnQgJiYgX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgYW5zd2VyID0gRGV2aWNlX0F0dHJpYnV0ZSgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIA0KDQogICAgICAgICAgICB9DQoNCg0KDQoNCiAgICAgICAgICAgIGlmKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgaWYoYW5zd2VyKXsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7X190aGlzOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHJldHVybiBhbnN3ZXI7DQogICAgICAgIH0NCiAgICANCiAgICB9Ow0KDQogICAgZXNwdGVzdC5jb20gPSBlc3B0ZXN0LmNvbSB8fCB7fTtlc3B0ZXN0LmNvbS5uYW1tb3VyID0gZXNwdGVzdC5jb20ubmFtbW91ciB8fCB7fTtlc3B0ZXN0LmNvbS5uYW1tb3VyLmRpb3QgPSBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRpb3QgfHwge307DQogICAgZXNwdGVzdC5jb20ubmFtbW91ci5kaW90LlR5cGVfQXR0cmlidXRlID0gY2xhc3Mgew0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBUeXBlX0F0dHJpYnV0ZS5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBhY3RpdmUodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fYWN0aXZlID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9hY3RpdmU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogVHlwZV9BdHRyaWJ1dGUuZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGVuYWJsZWQodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fZW5hYmxlZCA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZW5hYmxlZDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBUeXBlX0F0dHJpYnV0ZS5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgY29kZSh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9jb2RlID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9jb2RlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIFR5cGVfQXR0cmlidXRlLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgb3JkZXIodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fb3JkZXIgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX29yZGVyOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIFR5cGVfQXR0cmlidXRlLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBkYXRlKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX2RhdGUgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2RhdGU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogVHlwZV9BdHRyaWJ1dGUubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIG5hbWUodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fbmFtZSA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fbmFtZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBUeXBlX0F0dHJpYnV0ZS5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICByZW1hcmsodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fcmVtYXJrID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9yZW1hcms7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogVHlwZV9BdHRyaWJ1dGUuZGV2aWNlVHlwZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGRldmljZVR5cGUodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fZGV2aWNlVHlwZSA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZGV2aWNlVHlwZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgIA0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBUeXBlX0F0dHJpYnV0ZS5hdHRyaWJ1dGVfRGV2aWNlX0F0dHJpYnV0ZXMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBhdHRyaWJ1dGVfRGV2aWNlX0F0dHJpYnV0ZXModil7DQogICAgICAgIH0NCiAgICANCiAgICANCiAgICAgICAgX2Zyb21Eb2N1bWVudChvYmopew0KICAgICAgICAgICAgbGV0IF9fdG9TdHJpbmcgPSAnVHlwZV9BdHRyaWJ1dGUuX2Zyb21Eb2N1bWVudCgpOiAnOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBpZighb2JqKSByZXR1cm4gdGhpczsNCg0KICAgICAgICAgICAgLy9pZiBpc2luc3RhbmNlKG9iaiwgYnl0ZXMpOiBvYmogPSBzdHIob2JqLCAidXRmLTgiKTsNCg0KICAgICAgICAgICAgaWYodHlwZW9mKG9iaik9PT0nc3RyaW5nJyl7DQogICAgICAgICAgICAgICAgaWYobmV3IFJlZ0V4cCgiKCgoW0EtWmEtel17Myw5fTooPzovLyk/KSg/OlstOzomPSskLHddK0ApP1tBLVphLXowLTkuLV0rfCg/Ond3dy58Wy07OiY9KyQsd10rQClbQS1aYS16MC05Li1dKykoKD86L1srfiUvLnctX10qKT8/Pyg/OlstKz0mOyVALndfXSopIz8oPzpbd10qKSk/KSIpLnRlc3Qob2JqKSl7DQogICAgICAgICAgICAgICAgICAgIGxldCByZXF1ZXN0ID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTsNCiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdC5zZXRIdHRwTWV0aG9kKCdHRVQnKTsNCiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdC5zZXRFbmRwb2ludChvYmopOw0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHJlcXVlc3QuZXhlY3V0ZSgpLmdldEJvZHkoKSk7DQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoSlNPTi5wYXJzZShvYmopKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgaWYoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKXtyZXR1cm4gbmV3IFR5cGVfQXR0cmlidXRlKCkuX2Zyb21Eb2N1bWVudChvKX0pOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBpZih0eXBlb2Yob2JqLklkKSE9PSd1bmRlZmluZWQnKSB0aGlzLklkID0gb2JqLklkOw0KDQogICAgDQogICAgICAgICAgICBpZih0eXBlb2Yob2JqLmFjdGl2ZSkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKG9iai5lbmFibGVkKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZihvYmouY29kZSkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5jb2RlKG9iai5jb2RlKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2Yob2JqLm9yZGVyKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLm9yZGVyKG9iai5vcmRlcik7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKG9iai5kYXRlKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLmRhdGUob2JqLmRhdGUpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICB0aGlzLmRhdGUobmV3IEdsaWRlRGF0ZVRpbWUodGhpcy5kYXRlKCkpKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2Yob2JqLm5hbWUpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMubmFtZShvYmoubmFtZSk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKG9iai5yZW1hcmspIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMucmVtYXJrKG9iai5yZW1hcmspOw0KICAgICAgICANCiAgICAgICAgICAgICAgICB0aGlzLnJlbWFyayhHbGlkZVN0cmluZ1V0aWwuYmFzZTY0RGVjb2RlKHRoaXMucmVtYXJrKCkpKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2Yob2JqLmRldmljZVR5cGUpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuZGV2aWNlVHlwZShEZXZpY2VfVHlwZSgpLl9mcm9tRG9jdW1lbnQob2JqLmRldmljZVR5cGUpKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQoNCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZihvYmouYXR0cmlidXRlX0RldmljZV9BdHRyaWJ1dGVzKSE9PSd1bmRlZmluZWQnKSB0aGlzLmF0dHJpYnV0ZV9EZXZpY2VfQXR0cmlidXRlcyhuZXcgZXNwdGVzdC5jb20ubmFtbW91ci5kaW90LkRldmljZV9BdHRyaWJ1dGUoKS5fZnJvbURvY3VtZW50KG9iai5hdHRyaWJ1dGVfYXR0cmlidXRlX0RldmljZV9BdHRyaWJ1dGVzKSk7DQogICAgDQoNCiAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICB9DQoNCiAgICAgICAgX3RvRG9jdW1lbnQoKXsNCiAgICAgICAgICAgIGxldCBfX3RvU3RyaW5nID0gJ1R5cGVfQXR0cmlidXRlLl90b0RvY3VtZW50KCk6ICc7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGxldCByZXQgPSB7fTsNCiAgICAgICAgICAgIGlmKHR5cGVvZih0aGlzLklkKSE9PSd1bmRlZmluZWQnKSByZXQuSWQgPSB0aGlzLklkOw0KDQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5fYWN0aXZlKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICByZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5fZW5hYmxlZCkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgcmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5fY29kZSkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgcmV0LmNvZGUgPSB0aGlzLmNvZGUoKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5fb3JkZXIpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5fZGF0ZSkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgcmV0LmRhdGUgPSB0aGlzLmRhdGUoKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgaWYocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLmdldE51bWVyaWNWYWx1ZSk9PT0nZnVuY3Rpb24nKSByZXQuZGF0ZSA9IG5ldyBEYXRlKHJldC5kYXRlLmdldE51bWVyaWNWYWx1ZSgpKS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5fbmFtZSkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgcmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5fcmVtYXJrKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICByZXQucmVtYXJrID0gdGhpcy5yZW1hcmsoKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgaWYodHlwZW9mKHJldC5yZW1hcmsoKSk9PT0nb2JqZWN0JykgcmV0LnJlbWFyayA9IEdsaWRlU3RyaW5nVXRpbC5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZih0aGlzLl9kZXZpY2VUeXBlKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICByZXQuZGV2aWNlVHlwZSA9IHRoaXMuZGV2aWNlVHlwZSgpLl90b0RvY3VtZW50KCk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICANCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZih0aGlzLmF0dHJpYnV0ZV9EZXZpY2VfQXR0cmlidXRlcygpKSE9PSd1bmRlZmluZWQnKSByZXQuYXR0cmlidXRlX0RldmljZV9BdHRyaWJ1dGVzID0gc2VsZi5hdHRyaWJ1dGVfYXR0cmlidXRlX0RldmljZV9BdHRyaWJ1dGVzKCkubWFwKGZ1bmN0aW9uKHRhKXtyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTt9KTsNCiAgICANCiAgICAgICAgICAgIHJldHVybiByZXQ7DQogICAgICAgIH0NCg0KICAgICAgICBfdW5pcXVlKCl7DQogICAgICAgICAgICBsZXQgX190b1N0cmluZyA9ICdUeXBlX0F0dHJpYnV0ZS5fdW5pcXVlKCk6ICc7DQogICAgICAgIA0KICAgICAgICAgICAgbGV0IHJldCA9IG5ldyB1bmRlZmluZWQoKTsNCiAgICAgICAgICAgIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5jb2RlKCkpIT09J3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTsNCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZih0aGlzLmRldmljZVR5cGUoKSkhPT0ndW5kZWZpbmVkJykgcmV0LmRldmljZVR5cGUodGhpcy5kZXZpY2VUeXBlKCkuX3VuaXF1ZSgpKTsNCiAgICANCiAgICAgICAgICAgIHJldHVybiByZXQ7DQogICAgICAgIH0NCg0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBUeXBlX0F0dHJpYnV0ZS5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHN0b3JlKF9fZXZlbnQpew0KICAgICAgICAgICAgbGV0IF9fdG9TdHJpbmcgPSAnVHlwZV9BdHRyaWJ1dGUuc3RvcmUoKTogJzsNCg0KICAgICAgICAgICAgbGV0IGFuc3dlciA9IHVuZGVmaW5lZDsNCg0KICAgICAgICAgICAgdmFyIG5vZGUgPSBuZXcgZXNwdGVzdC5jb20ubmFtbW91ci5kY29tLk5vZGUoKS5jb2RlKGdzLmdldFByb3BlcnR5KCdpbnN0YW5jZV9uYW1lJykpOw0KICAgICAgICAgICAgbGV0IF9fcmVzcG9uc2UgPSBuZXcgZXNwdGVzdC5jb20ubmFtbW91ci5kY29tLkV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK25ldyBEYXRlKG5ldyBHbGlkZURhdGVUaW1lKCkpLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpKyddLlR5cGVfQXR0cmlidXRlLnN0b3JlKCknKS5tZXRob2QoJ3N0b3JlJykuY2xhc3NOYW1lKCdUeXBlX0F0dHJpYnV0ZScpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpOw0KDQogICAgICAgICAgICBsZXQgZXZKU09OID0gbnVsbDsNCiAgICAgICAgICAgIGlmKF9fZXZlbnQpew0KICAgICAgICAgICAgICAgIGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgICAgIGlmKHR5cGVvZihldkpTT04uX190aGlzKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpOw0KICAgICAgICANCg0KDQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAvL19fcmVzcG9uc2UucmVjaXBpZW50KG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uTm9kZSgpLmNvZGUoJ3BhcmVudCcpKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoX19ldmVudCAmJiAhX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KDQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgaWYoX19ldmVudCAmJiBfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBhbnN3ZXIgPSBUeXBlX0F0dHJpYnV0ZSgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIHN0b3JlIGxvY2FsbHkNCiAgICAgICAgICAgICAgICBsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ1R5cGVfQXR0cmlidXRlJyk7DQoNCiAgICAgICAgICAgICAgICBsZXQgX3RoaXMgPSB0aGlzLl91bmlxdWUoKS5maW5kKCk7DQogICAgICAgICAgICAgICAgaWYoIV90aGlzKSBnci5zZXROZXdHdWlkVmFsdWUodGhpcy5JZCB8fCAodGhpcy5JZCA9IGdyLnNldE5ld0d1aWQoKSkpOw0KICAgICAgICAgICAgICAgIGlmKF90aGlzICYmIHR5cGVvZihfdGhpcy5JZCkhPT0ndW5kZWZpbmVkJykgZ3IuZ2V0KF90aGlzLklkKTsNCg0KICAgICAgICAgICAgICAgIGxldCBiU2V0ID0gZmFsc2U7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGlmKF90aGlzICYmIHR5cGVvZihfdGhpcy5nZXRjb2RlKCkpIT09J3VuZGVmaW5lZCcpIGJTZXQgPSBnci5zZXRWYWx1ZSgnY29kZScsIF90aGlzLmdldGNvZGUoKSk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGlmKF90aGlzICYmIHR5cGVvZihfdGhpcy5nZXRkZXZpY2VUeXBlKCkpIT09J3VuZGVmaW5lZCcpIGJTZXQgPSBnci5zZXRWYWx1ZSgnZGV2aWNlVHlwZScsIF90aGlzLmdldGRldmljZVR5cGUoKSk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGlmKGJTZXQpew0KICAgICAgICAgICAgICAgICAgICB0aGlzLklkID0gZ3IudXBkYXRlKCk7DQogICAgICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJ0aGlzLklkID0gIiArIHRoaXMuSWQpOw0KICAgICAgICAgICAgICAgICAgICBpZighYW5zd2VyKSBhbnN3ZXIgPSB0aGlzOw0KICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiaW52YWxpZCBvYmplY3QiKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KDQoNCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBpZihhbnN3ZXIpew0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHtfX3RoaXM6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcmV0dXJuIGFuc3dlcjsNCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBUeXBlX0F0dHJpYnV0ZS5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgZmluZEFsbChfX2V2ZW50KXsNCiAgICAgICAgICAgIGxldCBfX3RvU3RyaW5nID0gJ1R5cGVfQXR0cmlidXRlLmZpbmRBbGwoKTogJzsNCg0KICAgICAgICAgICAgbGV0IGFuc3dlciA9IHVuZGVmaW5lZDsNCg0KICAgICAgICAgICAgdmFyIG5vZGUgPSBuZXcgZXNwdGVzdC5jb20ubmFtbW91ci5kY29tLk5vZGUoKS5jb2RlKGdzLmdldFByb3BlcnR5KCdpbnN0YW5jZV9uYW1lJykpOw0KICAgICAgICAgICAgbGV0IF9fcmVzcG9uc2UgPSBuZXcgZXNwdGVzdC5jb20ubmFtbW91ci5kY29tLkV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK25ldyBEYXRlKG5ldyBHbGlkZURhdGVUaW1lKCkpLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpKyddLlR5cGVfQXR0cmlidXRlLmZpbmRBbGwoKScpLm1ldGhvZCgnZmluZEFsbCcpLmNsYXNzTmFtZSgnVHlwZV9BdHRyaWJ1dGUnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKTsNCg0KICAgICAgICAgICAgbGV0IGV2SlNPTiA9IG51bGw7DQogICAgICAgICAgICBpZihfX2V2ZW50KXsNCiAgICAgICAgICAgICAgICBldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgICAgICBpZih0eXBlb2YoZXZKU09OLl9fdGhpcykhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTsNCiAgICAgICAgDQoNCg0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgLy9fX3Jlc3BvbnNlLnJlY2lwaWVudChuZXcgZXNwdGVzdC5jb20ubmFtbW91ci5kY29tLk5vZGUoKS5jb2RlKCdwYXJlbnQnKSk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKF9fZXZlbnQgJiYgIV9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCg0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgIGlmKF9fZXZlbnQgJiYgX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgYW5zd2VyID0gVHlwZV9BdHRyaWJ1dGUoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKCFfX2V2ZW50KXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICANCg0KICAgICAgICAgICAgfQ0KDQoNCg0KDQogICAgICAgICAgICBpZighX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGlmKGFuc3dlcil7DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoe19fdGhpczogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICByZXR1cm4gYW5zd2VyOw0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIFR5cGVfQXR0cmlidXRlLmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBmaW5kKF9fZXZlbnQpew0KICAgICAgICAgICAgbGV0IF9fdG9TdHJpbmcgPSAnVHlwZV9BdHRyaWJ1dGUuZmluZCgpOiAnOw0KDQogICAgICAgICAgICBsZXQgYW5zd2VyID0gdW5kZWZpbmVkOw0KDQogICAgICAgICAgICB2YXIgbm9kZSA9IG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uTm9kZSgpLmNvZGUoZ3MuZ2V0UHJvcGVydHkoJ2luc3RhbmNlX25hbWUnKSk7DQogICAgICAgICAgICBsZXQgX19yZXNwb25zZSA9IG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrbmV3IERhdGUobmV3IEdsaWRlRGF0ZVRpbWUoKSkudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJykrJ10uVHlwZV9BdHRyaWJ1dGUuZmluZCgpJykubWV0aG9kKCdmaW5kJykuY2xhc3NOYW1lKCdUeXBlX0F0dHJpYnV0ZScpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpOw0KDQogICAgICAgICAgICBsZXQgZXZKU09OID0gbnVsbDsNCiAgICAgICAgICAgIGlmKF9fZXZlbnQpew0KICAgICAgICAgICAgICAgIGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgICAgIGlmKHR5cGVvZihldkpTT04uX190aGlzKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpOw0KICAgICAgICANCg0KDQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAvL19fcmVzcG9uc2UucmVjaXBpZW50KG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uTm9kZSgpLmNvZGUoJ3BhcmVudCcpKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoX19ldmVudCAmJiAhX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KDQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgaWYoX19ldmVudCAmJiBfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBhbnN3ZXIgPSBUeXBlX0F0dHJpYnV0ZSgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIA0KDQogICAgICAgICAgICB9DQoNCg0KDQoNCiAgICAgICAgICAgIGlmKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgaWYoYW5zd2VyKXsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7X190aGlzOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHJldHVybiBhbnN3ZXI7DQogICAgICAgIH0NCiAgICANCiAgICB9Ow0KDQogICAgZXNwdGVzdC5jb20gPSBlc3B0ZXN0LmNvbSB8fCB7fTtlc3B0ZXN0LmNvbS5uYW1tb3VyID0gZXNwdGVzdC5jb20ubmFtbW91ciB8fCB7fTtlc3B0ZXN0LmNvbS5uYW1tb3VyLmRpb3QgPSBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRpb3QgfHwge307DQogICAgZXNwdGVzdC5jb20ubmFtbW91ci5kaW90LkRldmljZV9DYXRlZ29yeSA9IGNsYXNzIHsNCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogRGV2aWNlX0NhdGVnb3J5LmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGFjdGl2ZSh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9hY3RpdmUgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2FjdGl2ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBEZXZpY2VfQ2F0ZWdvcnkuZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGVuYWJsZWQodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fZW5hYmxlZCA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZW5hYmxlZDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBEZXZpY2VfQ2F0ZWdvcnkuY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGNvZGUodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fY29kZSA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fY29kZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBEZXZpY2VfQ2F0ZWdvcnkub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBvcmRlcih2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9vcmRlciA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fb3JkZXI7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogRGV2aWNlX0NhdGVnb3J5LmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBkYXRlKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX2RhdGUgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2RhdGU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogRGV2aWNlX0NhdGVnb3J5Lm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBuYW1lKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX25hbWUgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX25hbWU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogRGV2aWNlX0NhdGVnb3J5LnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHJlbWFyayh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9yZW1hcmsgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3JlbWFyazsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBEZXZpY2VfQ2F0ZWdvcnkucGFyZW50IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgcGFyZW50KHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX3BhcmVudCA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fcGFyZW50Ow0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgDQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIERldmljZV9DYXRlZ29yeS5wYXJlbnRfRGV2aWNlX0NhdGVnb3J5cyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHBhcmVudF9EZXZpY2VfQ2F0ZWdvcnlzKHYpew0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIERldmljZV9DYXRlZ29yeS5jYXRlZ29yeV9EZXZpY2VfVHlwZXMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBjYXRlZ29yeV9EZXZpY2VfVHlwZXModil7DQogICAgICAgIH0NCiAgICANCiAgICANCiAgICAgICAgX2Zyb21Eb2N1bWVudChvYmopew0KICAgICAgICAgICAgbGV0IF9fdG9TdHJpbmcgPSAnRGV2aWNlX0NhdGVnb3J5Ll9mcm9tRG9jdW1lbnQoKTogJzsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgaWYoIW9iaikgcmV0dXJuIHRoaXM7DQoNCiAgICAgICAgICAgIC8vaWYgaXNpbnN0YW5jZShvYmosIGJ5dGVzKTogb2JqID0gc3RyKG9iaiwgInV0Zi04Iik7DQoNCiAgICAgICAgICAgIGlmKHR5cGVvZihvYmopPT09J3N0cmluZycpew0KICAgICAgICAgICAgICAgIGlmKG5ldyBSZWdFeHAoIigoKFtBLVphLXpdezMsOX06KD86Ly8pPykoPzpbLTs6Jj0rJCx3XStAKT9bQS1aYS16MC05Li1dK3woPzp3d3cufFstOzomPSskLHddK0ApW0EtWmEtejAtOS4tXSspKCg/Oi9bK34lLy53LV9dKik/Pz8oPzpbLSs9JjslQC53X10qKSM/KD86W3ddKikpPykiKS50ZXN0KG9iaikpew0KICAgICAgICAgICAgICAgICAgICBsZXQgcmVxdWVzdCA9IG5ldyBzbl93cy5SRVNUTWVzc2FnZVYyKCk7DQogICAgICAgICAgICAgICAgICAgIHJlcXVlc3Quc2V0SHR0cE1ldGhvZCgnR0VUJyk7DQogICAgICAgICAgICAgICAgICAgIHJlcXVlc3Quc2V0RW5kcG9pbnQob2JqKTsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChyZXF1ZXN0LmV4ZWN1dGUoKS5nZXRCb2R5KCkpOw0KICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KEpTT04ucGFyc2Uob2JqKSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgIGlmKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obyl7cmV0dXJuIG5ldyBEZXZpY2VfQ2F0ZWdvcnkoKS5fZnJvbURvY3VtZW50KG8pfSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZihvYmouSWQpIT09J3VuZGVmaW5lZCcpIHRoaXMuSWQgPSBvYmouSWQ7DQoNCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZihvYmouYWN0aXZlKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2Yob2JqLmVuYWJsZWQpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKG9iai5jb2RlKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLmNvZGUob2JqLmNvZGUpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZihvYmoub3JkZXIpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMub3JkZXIob2JqLm9yZGVyKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2Yob2JqLmRhdGUpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuZGF0ZShvYmouZGF0ZSk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIHRoaXMuZGF0ZShuZXcgR2xpZGVEYXRlVGltZSh0aGlzLmRhdGUoKSkpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZihvYmoubmFtZSkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5uYW1lKG9iai5uYW1lKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2Yob2JqLnJlbWFyaykhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5yZW1hcmsob2JqLnJlbWFyayk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIHRoaXMucmVtYXJrKEdsaWRlU3RyaW5nVXRpbC5iYXNlNjREZWNvZGUodGhpcy5yZW1hcmsoKSkpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZihvYmoucGFyZW50KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLnBhcmVudChEZXZpY2VfQ2F0ZWdvcnkoKS5fZnJvbURvY3VtZW50KG9iai5wYXJlbnQpKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQoNCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZihvYmoucGFyZW50X0RldmljZV9DYXRlZ29yeXMpIT09J3VuZGVmaW5lZCcpIHRoaXMucGFyZW50X0RldmljZV9DYXRlZ29yeXMobmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGlvdC5EZXZpY2VfQ2F0ZWdvcnkoKS5fZnJvbURvY3VtZW50KG9iai5wYXJlbnRfcGFyZW50X0RldmljZV9DYXRlZ29yeXMpKTsNCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZihvYmouY2F0ZWdvcnlfRGV2aWNlX1R5cGVzKSE9PSd1bmRlZmluZWQnKSB0aGlzLmNhdGVnb3J5X0RldmljZV9UeXBlcyhuZXcgZXNwdGVzdC5jb20ubmFtbW91ci5kaW90LkRldmljZV9UeXBlKCkuX2Zyb21Eb2N1bWVudChvYmouY2F0ZWdvcnlfY2F0ZWdvcnlfRGV2aWNlX1R5cGVzKSk7DQogICAgDQoNCiAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICB9DQoNCiAgICAgICAgX3RvRG9jdW1lbnQoKXsNCiAgICAgICAgICAgIGxldCBfX3RvU3RyaW5nID0gJ0RldmljZV9DYXRlZ29yeS5fdG9Eb2N1bWVudCgpOiAnOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBsZXQgcmV0ID0ge307DQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5JZCkhPT0ndW5kZWZpbmVkJykgcmV0LklkID0gdGhpcy5JZDsNCg0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMuX2FjdGl2ZSkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgcmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMuX2VuYWJsZWQpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHJldC5lbmFibGVkID0gdGhpcy5lbmFibGVkKCk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMuX2NvZGUpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHJldC5jb2RlID0gdGhpcy5jb2RlKCk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMuX29yZGVyKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICByZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMuX2RhdGUpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHJldC5kYXRlID0gdGhpcy5kYXRlKCk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGlmKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS5nZXROdW1lcmljVmFsdWUpPT09J2Z1bmN0aW9uJykgcmV0LmRhdGUgPSBuZXcgRGF0ZShyZXQuZGF0ZS5nZXROdW1lcmljVmFsdWUoKSkudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMuX25hbWUpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHJldC5uYW1lID0gdGhpcy5uYW1lKCk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMuX3JlbWFyaykhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgcmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGlmKHR5cGVvZihyZXQucmVtYXJrKCkpPT09J29iamVjdCcpIHJldC5yZW1hcmsgPSBHbGlkZVN0cmluZ1V0aWwuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5yZW1hcmspKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5fcGFyZW50KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICByZXQucGFyZW50ID0gdGhpcy5wYXJlbnQoKS5fdG9Eb2N1bWVudCgpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgDQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5wYXJlbnRfRGV2aWNlX0NhdGVnb3J5cygpKSE9PSd1bmRlZmluZWQnKSByZXQucGFyZW50X0RldmljZV9DYXRlZ29yeXMgPSBzZWxmLnBhcmVudF9wYXJlbnRfRGV2aWNlX0NhdGVnb3J5cygpLm1hcChmdW5jdGlvbih0YSl7cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7fSk7DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5jYXRlZ29yeV9EZXZpY2VfVHlwZXMoKSkhPT0ndW5kZWZpbmVkJykgcmV0LmNhdGVnb3J5X0RldmljZV9UeXBlcyA9IHNlbGYuY2F0ZWdvcnlfY2F0ZWdvcnlfRGV2aWNlX1R5cGVzKCkubWFwKGZ1bmN0aW9uKHRhKXtyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTt9KTsNCiAgICANCiAgICAgICAgICAgIHJldHVybiByZXQ7DQogICAgICAgIH0NCg0KICAgICAgICBfdW5pcXVlKCl7DQogICAgICAgICAgICBsZXQgX190b1N0cmluZyA9ICdEZXZpY2VfQ2F0ZWdvcnkuX3VuaXF1ZSgpOiAnOw0KICAgICAgICANCiAgICAgICAgICAgIGxldCByZXQgPSBuZXcgdW5kZWZpbmVkKCk7DQogICAgICAgICAgICBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkOw0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMuY29kZSgpKSE9PSd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7DQogICAgDQogICAgICAgICAgICByZXR1cm4gcmV0Ow0KICAgICAgICB9DQoNCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogRGV2aWNlX0NhdGVnb3J5LnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgc3RvcmUoX19ldmVudCl7DQogICAgICAgICAgICBsZXQgX190b1N0cmluZyA9ICdEZXZpY2VfQ2F0ZWdvcnkuc3RvcmUoKTogJzsNCg0KICAgICAgICAgICAgbGV0IGFuc3dlciA9IHVuZGVmaW5lZDsNCg0KICAgICAgICAgICAgdmFyIG5vZGUgPSBuZXcgZXNwdGVzdC5jb20ubmFtbW91ci5kY29tLk5vZGUoKS5jb2RlKGdzLmdldFByb3BlcnR5KCdpbnN0YW5jZV9uYW1lJykpOw0KICAgICAgICAgICAgbGV0IF9fcmVzcG9uc2UgPSBuZXcgZXNwdGVzdC5jb20ubmFtbW91ci5kY29tLkV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK25ldyBEYXRlKG5ldyBHbGlkZURhdGVUaW1lKCkpLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpKyddLkRldmljZV9DYXRlZ29yeS5zdG9yZSgpJykubWV0aG9kKCdzdG9yZScpLmNsYXNzTmFtZSgnRGV2aWNlX0NhdGVnb3J5JykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSk7DQoNCiAgICAgICAgICAgIGxldCBldkpTT04gPSBudWxsOw0KICAgICAgICAgICAgaWYoX19ldmVudCl7DQogICAgICAgICAgICAgICAgZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICAgICAgaWYodHlwZW9mKGV2SlNPTi5fX3RoaXMpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgICAgICB0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7DQogICAgICAgIA0KDQoNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIC8vX19yZXNwb25zZS5yZWNpcGllbnQobmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5Ob2RlKCkuY29kZSgncGFyZW50JykpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZihfX2V2ZW50ICYmICFfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQoNCiAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICBpZihfX2V2ZW50ICYmIF9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGFuc3dlciA9IERldmljZV9DYXRlZ29yeSgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIHN0b3JlIGxvY2FsbHkNCiAgICAgICAgICAgICAgICBsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ0RldmljZV9DYXRlZ29yeScpOw0KDQogICAgICAgICAgICAgICAgbGV0IF90aGlzID0gdGhpcy5fdW5pcXVlKCkuZmluZCgpOw0KICAgICAgICAgICAgICAgIGlmKCFfdGhpcykgZ3Iuc2V0TmV3R3VpZFZhbHVlKHRoaXMuSWQgfHwgKHRoaXMuSWQgPSBnci5zZXROZXdHdWlkKCkpKTsNCiAgICAgICAgICAgICAgICBpZihfdGhpcyAmJiB0eXBlb2YoX3RoaXMuSWQpIT09J3VuZGVmaW5lZCcpIGdyLmdldChfdGhpcy5JZCk7DQoNCiAgICAgICAgICAgICAgICBsZXQgYlNldCA9IGZhbHNlOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBpZihfdGhpcyAmJiB0eXBlb2YoX3RoaXMuZ2V0Y29kZSgpKSE9PSd1bmRlZmluZWQnKSBiU2V0ID0gZ3Iuc2V0VmFsdWUoJ2NvZGUnLCBfdGhpcy5nZXRjb2RlKCkpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBpZihiU2V0KXsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5JZCA9IGdyLnVwZGF0ZSgpOw0KICAgICAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAidGhpcy5JZCA9ICIgKyB0aGlzLklkKTsNCiAgICAgICAgICAgICAgICAgICAgaWYoIWFuc3dlcikgYW5zd2VyID0gdGhpczsNCiAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImludmFsaWQgb2JqZWN0Iik7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIA0KDQogICAgICAgICAgICB9DQoNCg0KDQoNCiAgICAgICAgICAgIGlmKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgaWYoYW5zd2VyKXsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7X190aGlzOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHJldHVybiBhbnN3ZXI7DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogRGV2aWNlX0NhdGVnb3J5LmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBmaW5kQWxsKF9fZXZlbnQpew0KICAgICAgICAgICAgbGV0IF9fdG9TdHJpbmcgPSAnRGV2aWNlX0NhdGVnb3J5LmZpbmRBbGwoKTogJzsNCg0KICAgICAgICAgICAgbGV0IGFuc3dlciA9IHVuZGVmaW5lZDsNCg0KICAgICAgICAgICAgdmFyIG5vZGUgPSBuZXcgZXNwdGVzdC5jb20ubmFtbW91ci5kY29tLk5vZGUoKS5jb2RlKGdzLmdldFByb3BlcnR5KCdpbnN0YW5jZV9uYW1lJykpOw0KICAgICAgICAgICAgbGV0IF9fcmVzcG9uc2UgPSBuZXcgZXNwdGVzdC5jb20ubmFtbW91ci5kY29tLkV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK25ldyBEYXRlKG5ldyBHbGlkZURhdGVUaW1lKCkpLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpKyddLkRldmljZV9DYXRlZ29yeS5maW5kQWxsKCknKS5tZXRob2QoJ2ZpbmRBbGwnKS5jbGFzc05hbWUoJ0RldmljZV9DYXRlZ29yeScpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpOw0KDQogICAgICAgICAgICBsZXQgZXZKU09OID0gbnVsbDsNCiAgICAgICAgICAgIGlmKF9fZXZlbnQpew0KICAgICAgICAgICAgICAgIGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgICAgIGlmKHR5cGVvZihldkpTT04uX190aGlzKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpOw0KICAgICAgICANCg0KDQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAvL19fcmVzcG9uc2UucmVjaXBpZW50KG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uTm9kZSgpLmNvZGUoJ3BhcmVudCcpKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoX19ldmVudCAmJiAhX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KDQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgaWYoX19ldmVudCAmJiBfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBhbnN3ZXIgPSBEZXZpY2VfQ2F0ZWdvcnkoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKCFfX2V2ZW50KXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICANCg0KICAgICAgICAgICAgfQ0KDQoNCg0KDQogICAgICAgICAgICBpZighX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGlmKGFuc3dlcil7DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoe19fdGhpczogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICByZXR1cm4gYW5zd2VyOw0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIERldmljZV9DYXRlZ29yeS5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgZmluZChfX2V2ZW50KXsNCiAgICAgICAgICAgIGxldCBfX3RvU3RyaW5nID0gJ0RldmljZV9DYXRlZ29yeS5maW5kKCk6ICc7DQoNCiAgICAgICAgICAgIGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7DQoNCiAgICAgICAgICAgIHZhciBub2RlID0gbmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5Ob2RlKCkuY29kZShncy5nZXRQcm9wZXJ0eSgnaW5zdGFuY2VfbmFtZScpKTsNCiAgICAgICAgICAgIGxldCBfX3Jlc3BvbnNlID0gbmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5FdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytuZXcgRGF0ZShuZXcgR2xpZGVEYXRlVGltZSgpKS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKSsnXS5EZXZpY2VfQ2F0ZWdvcnkuZmluZCgpJykubWV0aG9kKCdmaW5kJykuY2xhc3NOYW1lKCdEZXZpY2VfQ2F0ZWdvcnknKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKTsNCg0KICAgICAgICAgICAgbGV0IGV2SlNPTiA9IG51bGw7DQogICAgICAgICAgICBpZihfX2V2ZW50KXsNCiAgICAgICAgICAgICAgICBldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgICAgICBpZih0eXBlb2YoZXZKU09OLl9fdGhpcykhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTsNCiAgICAgICAgDQoNCg0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgLy9fX3Jlc3BvbnNlLnJlY2lwaWVudChuZXcgZXNwdGVzdC5jb20ubmFtbW91ci5kY29tLk5vZGUoKS5jb2RlKCdwYXJlbnQnKSk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKF9fZXZlbnQgJiYgIV9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCg0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgIGlmKF9fZXZlbnQgJiYgX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgYW5zd2VyID0gRGV2aWNlX0NhdGVnb3J5KCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZighX19ldmVudCl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KDQoNCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBpZihhbnN3ZXIpew0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHtfX3RoaXM6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcmV0dXJuIGFuc3dlcjsNCiAgICAgICAgfQ0KICAgIA0KICAgIH07DQoNCiAgICBlc3B0ZXN0LmNvbSA9IGVzcHRlc3QuY29tIHx8IHt9O2VzcHRlc3QuY29tLm5hbW1vdXIgPSBlc3B0ZXN0LmNvbS5uYW1tb3VyIHx8IHt9O2VzcHRlc3QuY29tLm5hbW1vdXIuZGlvdCA9IGVzcHRlc3QuY29tLm5hbW1vdXIuZGlvdCB8fCB7fTsNCiAgICBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRpb3QuRGV2aWNlX1R5cGUgPSBjbGFzcyB7DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIERldmljZV9UeXBlLmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGFjdGl2ZSh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9hY3RpdmUgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2FjdGl2ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBEZXZpY2VfVHlwZS5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgZW5hYmxlZCh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9lbmFibGVkID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9lbmFibGVkOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIERldmljZV9UeXBlLmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBjb2RlKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX2NvZGUgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2NvZGU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogRGV2aWNlX1R5cGUub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBvcmRlcih2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9vcmRlciA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fb3JkZXI7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogRGV2aWNlX1R5cGUuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGRhdGUodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fZGF0ZSA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZGF0ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBEZXZpY2VfVHlwZS5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgbmFtZSh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9uYW1lID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9uYW1lOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIERldmljZV9UeXBlLnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHJlbWFyayh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9yZW1hcmsgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3JlbWFyazsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBEZXZpY2VfVHlwZS5jYXRlZ29yeSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGNhdGVnb3J5KHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX2NhdGVnb3J5ID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9jYXRlZ29yeTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgIA0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBEZXZpY2VfVHlwZS5kZXZpY2VUeXBlX01ldHJpY3MgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBkZXZpY2VUeXBlX01ldHJpY3Modil7DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogRGV2aWNlX1R5cGUudHlwZV9EZXZpY2VzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgdHlwZV9EZXZpY2VzKHYpew0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIERldmljZV9UeXBlLmRldmljZVR5cGVfVHlwZV9BdHRyaWJ1dGVzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgZGV2aWNlVHlwZV9UeXBlX0F0dHJpYnV0ZXModil7DQogICAgICAgIH0NCiAgICANCiAgICANCiAgICAgICAgX2Zyb21Eb2N1bWVudChvYmopew0KICAgICAgICAgICAgbGV0IF9fdG9TdHJpbmcgPSAnRGV2aWNlX1R5cGUuX2Zyb21Eb2N1bWVudCgpOiAnOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBpZighb2JqKSByZXR1cm4gdGhpczsNCg0KICAgICAgICAgICAgLy9pZiBpc2luc3RhbmNlKG9iaiwgYnl0ZXMpOiBvYmogPSBzdHIob2JqLCAidXRmLTgiKTsNCg0KICAgICAgICAgICAgaWYodHlwZW9mKG9iaik9PT0nc3RyaW5nJyl7DQogICAgICAgICAgICAgICAgaWYobmV3IFJlZ0V4cCgiKCgoW0EtWmEtel17Myw5fTooPzovLyk/KSg/OlstOzomPSskLHddK0ApP1tBLVphLXowLTkuLV0rfCg/Ond3dy58Wy07OiY9KyQsd10rQClbQS1aYS16MC05Li1dKykoKD86L1srfiUvLnctX10qKT8/Pyg/OlstKz0mOyVALndfXSopIz8oPzpbd10qKSk/KSIpLnRlc3Qob2JqKSl7DQogICAgICAgICAgICAgICAgICAgIGxldCByZXF1ZXN0ID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTsNCiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdC5zZXRIdHRwTWV0aG9kKCdHRVQnKTsNCiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdC5zZXRFbmRwb2ludChvYmopOw0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHJlcXVlc3QuZXhlY3V0ZSgpLmdldEJvZHkoKSk7DQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoSlNPTi5wYXJzZShvYmopKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgaWYoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKXtyZXR1cm4gbmV3IERldmljZV9UeXBlKCkuX2Zyb21Eb2N1bWVudChvKX0pOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBpZih0eXBlb2Yob2JqLklkKSE9PSd1bmRlZmluZWQnKSB0aGlzLklkID0gb2JqLklkOw0KDQogICAgDQogICAgICAgICAgICBpZih0eXBlb2Yob2JqLmFjdGl2ZSkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKG9iai5lbmFibGVkKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZihvYmouY29kZSkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5jb2RlKG9iai5jb2RlKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2Yob2JqLm9yZGVyKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLm9yZGVyKG9iai5vcmRlcik7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKG9iai5kYXRlKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLmRhdGUob2JqLmRhdGUpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICB0aGlzLmRhdGUobmV3IEdsaWRlRGF0ZVRpbWUodGhpcy5kYXRlKCkpKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2Yob2JqLm5hbWUpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMubmFtZShvYmoubmFtZSk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKG9iai5yZW1hcmspIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMucmVtYXJrKG9iai5yZW1hcmspOw0KICAgICAgICANCiAgICAgICAgICAgICAgICB0aGlzLnJlbWFyayhHbGlkZVN0cmluZ1V0aWwuYmFzZTY0RGVjb2RlKHRoaXMucmVtYXJrKCkpKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2Yob2JqLmNhdGVnb3J5KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLmNhdGVnb3J5KERldmljZV9DYXRlZ29yeSgpLl9mcm9tRG9jdW1lbnQob2JqLmNhdGVnb3J5KSk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KDQogICAgDQogICAgICAgICAgICBpZih0eXBlb2Yob2JqLmRldmljZVR5cGVfTWV0cmljcykhPT0ndW5kZWZpbmVkJykgdGhpcy5kZXZpY2VUeXBlX01ldHJpY3MobmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGlvdC5NZXRyaWMoKS5fZnJvbURvY3VtZW50KG9iai5kZXZpY2VUeXBlX2RldmljZVR5cGVfTWV0cmljcykpOw0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKG9iai50eXBlX0RldmljZXMpIT09J3VuZGVmaW5lZCcpIHRoaXMudHlwZV9EZXZpY2VzKG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRpb3QuRGV2aWNlKCkuX2Zyb21Eb2N1bWVudChvYmoudHlwZV90eXBlX0RldmljZXMpKTsNCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZihvYmouZGV2aWNlVHlwZV9UeXBlX0F0dHJpYnV0ZXMpIT09J3VuZGVmaW5lZCcpIHRoaXMuZGV2aWNlVHlwZV9UeXBlX0F0dHJpYnV0ZXMobmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGlvdC5UeXBlX0F0dHJpYnV0ZSgpLl9mcm9tRG9jdW1lbnQob2JqLmRldmljZVR5cGVfZGV2aWNlVHlwZV9UeXBlX0F0dHJpYnV0ZXMpKTsNCiAgICANCg0KICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgIH0NCg0KICAgICAgICBfdG9Eb2N1bWVudCgpew0KICAgICAgICAgICAgbGV0IF9fdG9TdHJpbmcgPSAnRGV2aWNlX1R5cGUuX3RvRG9jdW1lbnQoKTogJzsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgbGV0IHJldCA9IHt9Ow0KICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMuSWQpIT09J3VuZGVmaW5lZCcpIHJldC5JZCA9IHRoaXMuSWQ7DQoNCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZih0aGlzLl9hY3RpdmUpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHJldC5hY3RpdmUgPSB0aGlzLmFjdGl2ZSgpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZih0aGlzLl9lbmFibGVkKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICByZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZih0aGlzLl9jb2RlKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICByZXQuY29kZSA9IHRoaXMuY29kZSgpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZih0aGlzLl9vcmRlcikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgcmV0Lm9yZGVyID0gdGhpcy5vcmRlcigpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZih0aGlzLl9kYXRlKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICByZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBpZihyZXQuZGF0ZSAmJiB0eXBlb2YocmV0LmRhdGUuZ2V0TnVtZXJpY1ZhbHVlKT09PSdmdW5jdGlvbicpIHJldC5kYXRlID0gbmV3IERhdGUocmV0LmRhdGUuZ2V0TnVtZXJpY1ZhbHVlKCkpLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZih0aGlzLl9uYW1lKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICByZXQubmFtZSA9IHRoaXMubmFtZSgpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZih0aGlzLl9yZW1hcmspIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHJldC5yZW1hcmsgPSB0aGlzLnJlbWFyaygpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBpZih0eXBlb2YocmV0LnJlbWFyaygpKT09PSdvYmplY3QnKSByZXQucmVtYXJrID0gR2xpZGVTdHJpbmdVdGlsLmJhc2U2NEVuY29kZShKU09OLnN0cmluZ2lmeShyZXQucmVtYXJrKSk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMuX2NhdGVnb3J5KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICByZXQuY2F0ZWdvcnkgPSB0aGlzLmNhdGVnb3J5KCkuX3RvRG9jdW1lbnQoKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgIA0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMuZGV2aWNlVHlwZV9NZXRyaWNzKCkpIT09J3VuZGVmaW5lZCcpIHJldC5kZXZpY2VUeXBlX01ldHJpY3MgPSBzZWxmLmRldmljZVR5cGVfZGV2aWNlVHlwZV9NZXRyaWNzKCkubWFwKGZ1bmN0aW9uKHRhKXtyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTt9KTsNCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZih0aGlzLnR5cGVfRGV2aWNlcygpKSE9PSd1bmRlZmluZWQnKSByZXQudHlwZV9EZXZpY2VzID0gc2VsZi50eXBlX3R5cGVfRGV2aWNlcygpLm1hcChmdW5jdGlvbih0YSl7cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7fSk7DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5kZXZpY2VUeXBlX1R5cGVfQXR0cmlidXRlcygpKSE9PSd1bmRlZmluZWQnKSByZXQuZGV2aWNlVHlwZV9UeXBlX0F0dHJpYnV0ZXMgPSBzZWxmLmRldmljZVR5cGVfZGV2aWNlVHlwZV9UeXBlX0F0dHJpYnV0ZXMoKS5tYXAoZnVuY3Rpb24odGEpe3JldHVybiB0YS5fdG9Eb2N1bWVudCgpO30pOw0KICAgIA0KICAgICAgICAgICAgcmV0dXJuIHJldDsNCiAgICAgICAgfQ0KDQogICAgICAgIF91bmlxdWUoKXsNCiAgICAgICAgICAgIGxldCBfX3RvU3RyaW5nID0gJ0RldmljZV9UeXBlLl91bmlxdWUoKTogJzsNCiAgICAgICAgDQogICAgICAgICAgICBsZXQgcmV0ID0gbmV3IHVuZGVmaW5lZCgpOw0KICAgICAgICAgICAgaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDsNCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZih0aGlzLmNvZGUoKSkhPT0ndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpOw0KICAgIA0KICAgICAgICAgICAgcmV0dXJuIHJldDsNCiAgICAgICAgfQ0KDQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIERldmljZV9UeXBlLnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgc3RvcmUoX19ldmVudCl7DQogICAgICAgICAgICBsZXQgX190b1N0cmluZyA9ICdEZXZpY2VfVHlwZS5zdG9yZSgpOiAnOw0KDQogICAgICAgICAgICBsZXQgYW5zd2VyID0gdW5kZWZpbmVkOw0KDQogICAgICAgICAgICB2YXIgbm9kZSA9IG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uTm9kZSgpLmNvZGUoZ3MuZ2V0UHJvcGVydHkoJ2luc3RhbmNlX25hbWUnKSk7DQogICAgICAgICAgICBsZXQgX19yZXNwb25zZSA9IG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrbmV3IERhdGUobmV3IEdsaWRlRGF0ZVRpbWUoKSkudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJykrJ10uRGV2aWNlX1R5cGUuc3RvcmUoKScpLm1ldGhvZCgnc3RvcmUnKS5jbGFzc05hbWUoJ0RldmljZV9UeXBlJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSk7DQoNCiAgICAgICAgICAgIGxldCBldkpTT04gPSBudWxsOw0KICAgICAgICAgICAgaWYoX19ldmVudCl7DQogICAgICAgICAgICAgICAgZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICAgICAgaWYodHlwZW9mKGV2SlNPTi5fX3RoaXMpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgICAgICB0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7DQogICAgICAgIA0KDQoNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIC8vX19yZXNwb25zZS5yZWNpcGllbnQobmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5Ob2RlKCkuY29kZSgncGFyZW50JykpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZihfX2V2ZW50ICYmICFfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQoNCiAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICBpZihfX2V2ZW50ICYmIF9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGFuc3dlciA9IERldmljZV9UeXBlKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZighX19ldmVudCl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgLy8gc3RvcmUgbG9jYWxseQ0KICAgICAgICAgICAgICAgIGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgnRGV2aWNlX1R5cGUnKTsNCg0KICAgICAgICAgICAgICAgIGxldCBfdGhpcyA9IHRoaXMuX3VuaXF1ZSgpLmZpbmQoKTsNCiAgICAgICAgICAgICAgICBpZighX3RoaXMpIGdyLnNldE5ld0d1aWRWYWx1ZSh0aGlzLklkIHx8ICh0aGlzLklkID0gZ3Iuc2V0TmV3R3VpZCgpKSk7DQogICAgICAgICAgICAgICAgaWYoX3RoaXMgJiYgdHlwZW9mKF90aGlzLklkKSE9PSd1bmRlZmluZWQnKSBnci5nZXQoX3RoaXMuSWQpOw0KDQogICAgICAgICAgICAgICAgbGV0IGJTZXQgPSBmYWxzZTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgaWYoX3RoaXMgJiYgdHlwZW9mKF90aGlzLmdldGNvZGUoKSkhPT0ndW5kZWZpbmVkJykgYlNldCA9IGdyLnNldFZhbHVlKCdjb2RlJywgX3RoaXMuZ2V0Y29kZSgpKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgaWYoYlNldCl7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuSWQgPSBnci51cGRhdGUoKTsNCiAgICAgICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgInRoaXMuSWQgPSAiICsgdGhpcy5JZCk7DQogICAgICAgICAgICAgICAgICAgIGlmKCFhbnN3ZXIpIGFuc3dlciA9IHRoaXM7DQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJpbnZhbGlkIG9iamVjdCIpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICANCg0KICAgICAgICAgICAgfQ0KDQoNCg0KDQogICAgICAgICAgICBpZighX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGlmKGFuc3dlcil7DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoe19fdGhpczogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICByZXR1cm4gYW5zd2VyOw0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIERldmljZV9UeXBlLmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBmaW5kQWxsKF9fZXZlbnQpew0KICAgICAgICAgICAgbGV0IF9fdG9TdHJpbmcgPSAnRGV2aWNlX1R5cGUuZmluZEFsbCgpOiAnOw0KDQogICAgICAgICAgICBsZXQgYW5zd2VyID0gdW5kZWZpbmVkOw0KDQogICAgICAgICAgICB2YXIgbm9kZSA9IG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uTm9kZSgpLmNvZGUoZ3MuZ2V0UHJvcGVydHkoJ2luc3RhbmNlX25hbWUnKSk7DQogICAgICAgICAgICBsZXQgX19yZXNwb25zZSA9IG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrbmV3IERhdGUobmV3IEdsaWRlRGF0ZVRpbWUoKSkudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJykrJ10uRGV2aWNlX1R5cGUuZmluZEFsbCgpJykubWV0aG9kKCdmaW5kQWxsJykuY2xhc3NOYW1lKCdEZXZpY2VfVHlwZScpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpOw0KDQogICAgICAgICAgICBsZXQgZXZKU09OID0gbnVsbDsNCiAgICAgICAgICAgIGlmKF9fZXZlbnQpew0KICAgICAgICAgICAgICAgIGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgICAgIGlmKHR5cGVvZihldkpTT04uX190aGlzKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpOw0KICAgICAgICANCg0KDQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAvL19fcmVzcG9uc2UucmVjaXBpZW50KG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uTm9kZSgpLmNvZGUoJ3BhcmVudCcpKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoX19ldmVudCAmJiAhX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KDQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgaWYoX19ldmVudCAmJiBfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBhbnN3ZXIgPSBEZXZpY2VfVHlwZSgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIA0KDQogICAgICAgICAgICB9DQoNCg0KDQoNCiAgICAgICAgICAgIGlmKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgaWYoYW5zd2VyKXsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7X190aGlzOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHJldHVybiBhbnN3ZXI7DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogRGV2aWNlX1R5cGUuZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGZpbmQoX19ldmVudCl7DQogICAgICAgICAgICBsZXQgX190b1N0cmluZyA9ICdEZXZpY2VfVHlwZS5maW5kKCk6ICc7DQoNCiAgICAgICAgICAgIGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7DQoNCiAgICAgICAgICAgIHZhciBub2RlID0gbmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5Ob2RlKCkuY29kZShncy5nZXRQcm9wZXJ0eSgnaW5zdGFuY2VfbmFtZScpKTsNCiAgICAgICAgICAgIGxldCBfX3Jlc3BvbnNlID0gbmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5FdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytuZXcgRGF0ZShuZXcgR2xpZGVEYXRlVGltZSgpKS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKSsnXS5EZXZpY2VfVHlwZS5maW5kKCknKS5tZXRob2QoJ2ZpbmQnKS5jbGFzc05hbWUoJ0RldmljZV9UeXBlJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSk7DQoNCiAgICAgICAgICAgIGxldCBldkpTT04gPSBudWxsOw0KICAgICAgICAgICAgaWYoX19ldmVudCl7DQogICAgICAgICAgICAgICAgZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICAgICAgaWYodHlwZW9mKGV2SlNPTi5fX3RoaXMpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgICAgICB0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7DQogICAgICAgIA0KDQoNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIC8vX19yZXNwb25zZS5yZWNpcGllbnQobmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5Ob2RlKCkuY29kZSgncGFyZW50JykpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZihfX2V2ZW50ICYmICFfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQoNCiAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICBpZihfX2V2ZW50ICYmIF9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGFuc3dlciA9IERldmljZV9UeXBlKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZighX19ldmVudCl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KDQoNCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBpZihhbnN3ZXIpew0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHtfX3RoaXM6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcmV0dXJuIGFuc3dlcjsNCiAgICAgICAgfQ0KICAgIA0KICAgIH07DQoNCiAgICBlc3B0ZXN0LmNvbSA9IGVzcHRlc3QuY29tIHx8IHt9O2VzcHRlc3QuY29tLm5hbW1vdXIgPSBlc3B0ZXN0LmNvbS5uYW1tb3VyIHx8IHt9O2VzcHRlc3QuY29tLm5hbW1vdXIuZGlvdCA9IGVzcHRlc3QuY29tLm5hbW1vdXIuZGlvdCB8fCB7fTsNCiAgICBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRpb3QuTWV0cmljX0dyb3VwID0gY2xhc3Mgew0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBNZXRyaWNfR3JvdXAuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgYWN0aXZlKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX2FjdGl2ZSA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fYWN0aXZlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE1ldHJpY19Hcm91cC5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgZW5hYmxlZCh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9lbmFibGVkID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9lbmFibGVkOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE1ldHJpY19Hcm91cC5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgY29kZSh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9jb2RlID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9jb2RlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE1ldHJpY19Hcm91cC5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIG9yZGVyKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX29yZGVyID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9vcmRlcjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBNZXRyaWNfR3JvdXAuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGRhdGUodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fZGF0ZSA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZGF0ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBNZXRyaWNfR3JvdXAubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIG5hbWUodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fbmFtZSA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fbmFtZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBNZXRyaWNfR3JvdXAucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgcmVtYXJrKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX3JlbWFyayA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fcmVtYXJrOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgDQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE1ldHJpY19Hcm91cC5ncm91cF9NZXRyaWNfVHlwZXMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBncm91cF9NZXRyaWNfVHlwZXModil7DQogICAgICAgIH0NCiAgICANCiAgICANCiAgICAgICAgX2Zyb21Eb2N1bWVudChvYmopew0KICAgICAgICAgICAgbGV0IF9fdG9TdHJpbmcgPSAnTWV0cmljX0dyb3VwLl9mcm9tRG9jdW1lbnQoKTogJzsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgaWYoIW9iaikgcmV0dXJuIHRoaXM7DQoNCiAgICAgICAgICAgIC8vaWYgaXNpbnN0YW5jZShvYmosIGJ5dGVzKTogb2JqID0gc3RyKG9iaiwgInV0Zi04Iik7DQoNCiAgICAgICAgICAgIGlmKHR5cGVvZihvYmopPT09J3N0cmluZycpew0KICAgICAgICAgICAgICAgIGlmKG5ldyBSZWdFeHAoIigoKFtBLVphLXpdezMsOX06KD86Ly8pPykoPzpbLTs6Jj0rJCx3XStAKT9bQS1aYS16MC05Li1dK3woPzp3d3cufFstOzomPSskLHddK0ApW0EtWmEtejAtOS4tXSspKCg/Oi9bK34lLy53LV9dKik/Pz8oPzpbLSs9JjslQC53X10qKSM/KD86W3ddKikpPykiKS50ZXN0KG9iaikpew0KICAgICAgICAgICAgICAgICAgICBsZXQgcmVxdWVzdCA9IG5ldyBzbl93cy5SRVNUTWVzc2FnZVYyKCk7DQogICAgICAgICAgICAgICAgICAgIHJlcXVlc3Quc2V0SHR0cE1ldGhvZCgnR0VUJyk7DQogICAgICAgICAgICAgICAgICAgIHJlcXVlc3Quc2V0RW5kcG9pbnQob2JqKTsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChyZXF1ZXN0LmV4ZWN1dGUoKS5nZXRCb2R5KCkpOw0KICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KEpTT04ucGFyc2Uob2JqKSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgIGlmKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obyl7cmV0dXJuIG5ldyBNZXRyaWNfR3JvdXAoKS5fZnJvbURvY3VtZW50KG8pfSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZihvYmouSWQpIT09J3VuZGVmaW5lZCcpIHRoaXMuSWQgPSBvYmouSWQ7DQoNCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZihvYmouYWN0aXZlKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2Yob2JqLmVuYWJsZWQpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKG9iai5jb2RlKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLmNvZGUob2JqLmNvZGUpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZihvYmoub3JkZXIpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMub3JkZXIob2JqLm9yZGVyKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2Yob2JqLmRhdGUpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuZGF0ZShvYmouZGF0ZSk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIHRoaXMuZGF0ZShuZXcgR2xpZGVEYXRlVGltZSh0aGlzLmRhdGUoKSkpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZihvYmoubmFtZSkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5uYW1lKG9iai5uYW1lKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2Yob2JqLnJlbWFyaykhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5yZW1hcmsob2JqLnJlbWFyayk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIHRoaXMucmVtYXJrKEdsaWRlU3RyaW5nVXRpbC5iYXNlNjREZWNvZGUodGhpcy5yZW1hcmsoKSkpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCg0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKG9iai5ncm91cF9NZXRyaWNfVHlwZXMpIT09J3VuZGVmaW5lZCcpIHRoaXMuZ3JvdXBfTWV0cmljX1R5cGVzKG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRpb3QuTWV0cmljX1R5cGUoKS5fZnJvbURvY3VtZW50KG9iai5ncm91cF9ncm91cF9NZXRyaWNfVHlwZXMpKTsNCiAgICANCg0KICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgIH0NCg0KICAgICAgICBfdG9Eb2N1bWVudCgpew0KICAgICAgICAgICAgbGV0IF9fdG9TdHJpbmcgPSAnTWV0cmljX0dyb3VwLl90b0RvY3VtZW50KCk6ICc7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGxldCByZXQgPSB7fTsNCiAgICAgICAgICAgIGlmKHR5cGVvZih0aGlzLklkKSE9PSd1bmRlZmluZWQnKSByZXQuSWQgPSB0aGlzLklkOw0KDQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5fYWN0aXZlKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICByZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5fZW5hYmxlZCkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgcmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5fY29kZSkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgcmV0LmNvZGUgPSB0aGlzLmNvZGUoKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5fb3JkZXIpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5fZGF0ZSkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgcmV0LmRhdGUgPSB0aGlzLmRhdGUoKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgaWYocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLmdldE51bWVyaWNWYWx1ZSk9PT0nZnVuY3Rpb24nKSByZXQuZGF0ZSA9IG5ldyBEYXRlKHJldC5kYXRlLmdldE51bWVyaWNWYWx1ZSgpKS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5fbmFtZSkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgcmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5fcmVtYXJrKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICByZXQucmVtYXJrID0gdGhpcy5yZW1hcmsoKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgaWYodHlwZW9mKHJldC5yZW1hcmsoKSk9PT0nb2JqZWN0JykgcmV0LnJlbWFyayA9IEdsaWRlU3RyaW5nVXRpbC5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgDQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5ncm91cF9NZXRyaWNfVHlwZXMoKSkhPT0ndW5kZWZpbmVkJykgcmV0Lmdyb3VwX01ldHJpY19UeXBlcyA9IHNlbGYuZ3JvdXBfZ3JvdXBfTWV0cmljX1R5cGVzKCkubWFwKGZ1bmN0aW9uKHRhKXtyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTt9KTsNCiAgICANCiAgICAgICAgICAgIHJldHVybiByZXQ7DQogICAgICAgIH0NCg0KICAgICAgICBfdW5pcXVlKCl7DQogICAgICAgICAgICBsZXQgX190b1N0cmluZyA9ICdNZXRyaWNfR3JvdXAuX3VuaXF1ZSgpOiAnOw0KICAgICAgICANCiAgICAgICAgICAgIGxldCByZXQgPSBuZXcgdW5kZWZpbmVkKCk7DQogICAgICAgICAgICBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkOw0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMuY29kZSgpKSE9PSd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7DQogICAgDQogICAgICAgICAgICByZXR1cm4gcmV0Ow0KICAgICAgICB9DQoNCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTWV0cmljX0dyb3VwLnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgc3RvcmUoX19ldmVudCl7DQogICAgICAgICAgICBsZXQgX190b1N0cmluZyA9ICdNZXRyaWNfR3JvdXAuc3RvcmUoKTogJzsNCg0KICAgICAgICAgICAgbGV0IGFuc3dlciA9IHVuZGVmaW5lZDsNCg0KICAgICAgICAgICAgdmFyIG5vZGUgPSBuZXcgZXNwdGVzdC5jb20ubmFtbW91ci5kY29tLk5vZGUoKS5jb2RlKGdzLmdldFByb3BlcnR5KCdpbnN0YW5jZV9uYW1lJykpOw0KICAgICAgICAgICAgbGV0IF9fcmVzcG9uc2UgPSBuZXcgZXNwdGVzdC5jb20ubmFtbW91ci5kY29tLkV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK25ldyBEYXRlKG5ldyBHbGlkZURhdGVUaW1lKCkpLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpKyddLk1ldHJpY19Hcm91cC5zdG9yZSgpJykubWV0aG9kKCdzdG9yZScpLmNsYXNzTmFtZSgnTWV0cmljX0dyb3VwJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSk7DQoNCiAgICAgICAgICAgIGxldCBldkpTT04gPSBudWxsOw0KICAgICAgICAgICAgaWYoX19ldmVudCl7DQogICAgICAgICAgICAgICAgZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICAgICAgaWYodHlwZW9mKGV2SlNPTi5fX3RoaXMpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgICAgICB0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7DQogICAgICAgIA0KDQoNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIC8vX19yZXNwb25zZS5yZWNpcGllbnQobmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5Ob2RlKCkuY29kZSgncGFyZW50JykpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZihfX2V2ZW50ICYmICFfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQoNCiAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICBpZihfX2V2ZW50ICYmIF9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGFuc3dlciA9IE1ldHJpY19Hcm91cCgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIHN0b3JlIGxvY2FsbHkNCiAgICAgICAgICAgICAgICBsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ01ldHJpY19Hcm91cCcpOw0KDQogICAgICAgICAgICAgICAgbGV0IF90aGlzID0gdGhpcy5fdW5pcXVlKCkuZmluZCgpOw0KICAgICAgICAgICAgICAgIGlmKCFfdGhpcykgZ3Iuc2V0TmV3R3VpZFZhbHVlKHRoaXMuSWQgfHwgKHRoaXMuSWQgPSBnci5zZXROZXdHdWlkKCkpKTsNCiAgICAgICAgICAgICAgICBpZihfdGhpcyAmJiB0eXBlb2YoX3RoaXMuSWQpIT09J3VuZGVmaW5lZCcpIGdyLmdldChfdGhpcy5JZCk7DQoNCiAgICAgICAgICAgICAgICBsZXQgYlNldCA9IGZhbHNlOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBpZihfdGhpcyAmJiB0eXBlb2YoX3RoaXMuZ2V0Y29kZSgpKSE9PSd1bmRlZmluZWQnKSBiU2V0ID0gZ3Iuc2V0VmFsdWUoJ2NvZGUnLCBfdGhpcy5nZXRjb2RlKCkpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBpZihiU2V0KXsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5JZCA9IGdyLnVwZGF0ZSgpOw0KICAgICAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAidGhpcy5JZCA9ICIgKyB0aGlzLklkKTsNCiAgICAgICAgICAgICAgICAgICAgaWYoIWFuc3dlcikgYW5zd2VyID0gdGhpczsNCiAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImludmFsaWQgb2JqZWN0Iik7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIA0KDQogICAgICAgICAgICB9DQoNCg0KDQoNCiAgICAgICAgICAgIGlmKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgaWYoYW5zd2VyKXsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7X190aGlzOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHJldHVybiBhbnN3ZXI7DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTWV0cmljX0dyb3VwLmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBmaW5kQWxsKF9fZXZlbnQpew0KICAgICAgICAgICAgbGV0IF9fdG9TdHJpbmcgPSAnTWV0cmljX0dyb3VwLmZpbmRBbGwoKTogJzsNCg0KICAgICAgICAgICAgbGV0IGFuc3dlciA9IHVuZGVmaW5lZDsNCg0KICAgICAgICAgICAgdmFyIG5vZGUgPSBuZXcgZXNwdGVzdC5jb20ubmFtbW91ci5kY29tLk5vZGUoKS5jb2RlKGdzLmdldFByb3BlcnR5KCdpbnN0YW5jZV9uYW1lJykpOw0KICAgICAgICAgICAgbGV0IF9fcmVzcG9uc2UgPSBuZXcgZXNwdGVzdC5jb20ubmFtbW91ci5kY29tLkV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK25ldyBEYXRlKG5ldyBHbGlkZURhdGVUaW1lKCkpLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpKyddLk1ldHJpY19Hcm91cC5maW5kQWxsKCknKS5tZXRob2QoJ2ZpbmRBbGwnKS5jbGFzc05hbWUoJ01ldHJpY19Hcm91cCcpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpOw0KDQogICAgICAgICAgICBsZXQgZXZKU09OID0gbnVsbDsNCiAgICAgICAgICAgIGlmKF9fZXZlbnQpew0KICAgICAgICAgICAgICAgIGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgICAgIGlmKHR5cGVvZihldkpTT04uX190aGlzKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpOw0KICAgICAgICANCg0KDQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAvL19fcmVzcG9uc2UucmVjaXBpZW50KG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uTm9kZSgpLmNvZGUoJ3BhcmVudCcpKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoX19ldmVudCAmJiAhX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KDQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgaWYoX19ldmVudCAmJiBfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBhbnN3ZXIgPSBNZXRyaWNfR3JvdXAoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKCFfX2V2ZW50KXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICANCg0KICAgICAgICAgICAgfQ0KDQoNCg0KDQogICAgICAgICAgICBpZighX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGlmKGFuc3dlcil7DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoe19fdGhpczogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICByZXR1cm4gYW5zd2VyOw0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE1ldHJpY19Hcm91cC5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgZmluZChfX2V2ZW50KXsNCiAgICAgICAgICAgIGxldCBfX3RvU3RyaW5nID0gJ01ldHJpY19Hcm91cC5maW5kKCk6ICc7DQoNCiAgICAgICAgICAgIGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7DQoNCiAgICAgICAgICAgIHZhciBub2RlID0gbmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5Ob2RlKCkuY29kZShncy5nZXRQcm9wZXJ0eSgnaW5zdGFuY2VfbmFtZScpKTsNCiAgICAgICAgICAgIGxldCBfX3Jlc3BvbnNlID0gbmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5FdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytuZXcgRGF0ZShuZXcgR2xpZGVEYXRlVGltZSgpKS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKSsnXS5NZXRyaWNfR3JvdXAuZmluZCgpJykubWV0aG9kKCdmaW5kJykuY2xhc3NOYW1lKCdNZXRyaWNfR3JvdXAnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKTsNCg0KICAgICAgICAgICAgbGV0IGV2SlNPTiA9IG51bGw7DQogICAgICAgICAgICBpZihfX2V2ZW50KXsNCiAgICAgICAgICAgICAgICBldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgICAgICBpZih0eXBlb2YoZXZKU09OLl9fdGhpcykhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTsNCiAgICAgICAgDQoNCg0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgLy9fX3Jlc3BvbnNlLnJlY2lwaWVudChuZXcgZXNwdGVzdC5jb20ubmFtbW91ci5kY29tLk5vZGUoKS5jb2RlKCdwYXJlbnQnKSk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKF9fZXZlbnQgJiYgIV9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCg0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgIGlmKF9fZXZlbnQgJiYgX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgYW5zd2VyID0gTWV0cmljX0dyb3VwKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZighX19ldmVudCl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KDQoNCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBpZihhbnN3ZXIpew0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHtfX3RoaXM6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcmV0dXJuIGFuc3dlcjsNCiAgICAgICAgfQ0KICAgIA0KICAgIH07DQoNCiAgICBlc3B0ZXN0LmNvbSA9IGVzcHRlc3QuY29tIHx8IHt9O2VzcHRlc3QuY29tLm5hbW1vdXIgPSBlc3B0ZXN0LmNvbS5uYW1tb3VyIHx8IHt9O2VzcHRlc3QuY29tLm5hbW1vdXIuZGlvdCA9IGVzcHRlc3QuY29tLm5hbW1vdXIuZGlvdCB8fCB7fTsNCiAgICBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRpb3QuTWV0cmljX1R5cGUgPSBjbGFzcyB7DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE1ldHJpY19UeXBlLmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGFjdGl2ZSh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9hY3RpdmUgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2FjdGl2ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBNZXRyaWNfVHlwZS5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgZW5hYmxlZCh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9lbmFibGVkID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9lbmFibGVkOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE1ldHJpY19UeXBlLmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBjb2RlKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX2NvZGUgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2NvZGU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTWV0cmljX1R5cGUub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBvcmRlcih2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9vcmRlciA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fb3JkZXI7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTWV0cmljX1R5cGUuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGRhdGUodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fZGF0ZSA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZGF0ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBNZXRyaWNfVHlwZS5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgbmFtZSh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9uYW1lID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9uYW1lOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE1ldHJpY19UeXBlLnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHJlbWFyayh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9yZW1hcmsgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3JlbWFyazsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBNZXRyaWNfVHlwZS5ncm91cCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGdyb3VwKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX2dyb3VwID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9ncm91cDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgIA0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBNZXRyaWNfVHlwZS50eXBlX01ldHJpY3MgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICB0eXBlX01ldHJpY3Modil7DQogICAgICAgIH0NCiAgICANCiAgICANCiAgICAgICAgX2Zyb21Eb2N1bWVudChvYmopew0KICAgICAgICAgICAgbGV0IF9fdG9TdHJpbmcgPSAnTWV0cmljX1R5cGUuX2Zyb21Eb2N1bWVudCgpOiAnOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBpZighb2JqKSByZXR1cm4gdGhpczsNCg0KICAgICAgICAgICAgLy9pZiBpc2luc3RhbmNlKG9iaiwgYnl0ZXMpOiBvYmogPSBzdHIob2JqLCAidXRmLTgiKTsNCg0KICAgICAgICAgICAgaWYodHlwZW9mKG9iaik9PT0nc3RyaW5nJyl7DQogICAgICAgICAgICAgICAgaWYobmV3IFJlZ0V4cCgiKCgoW0EtWmEtel17Myw5fTooPzovLyk/KSg/OlstOzomPSskLHddK0ApP1tBLVphLXowLTkuLV0rfCg/Ond3dy58Wy07OiY9KyQsd10rQClbQS1aYS16MC05Li1dKykoKD86L1srfiUvLnctX10qKT8/Pyg/OlstKz0mOyVALndfXSopIz8oPzpbd10qKSk/KSIpLnRlc3Qob2JqKSl7DQogICAgICAgICAgICAgICAgICAgIGxldCByZXF1ZXN0ID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTsNCiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdC5zZXRIdHRwTWV0aG9kKCdHRVQnKTsNCiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdC5zZXRFbmRwb2ludChvYmopOw0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHJlcXVlc3QuZXhlY3V0ZSgpLmdldEJvZHkoKSk7DQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoSlNPTi5wYXJzZShvYmopKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgaWYoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKXtyZXR1cm4gbmV3IE1ldHJpY19UeXBlKCkuX2Zyb21Eb2N1bWVudChvKX0pOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBpZih0eXBlb2Yob2JqLklkKSE9PSd1bmRlZmluZWQnKSB0aGlzLklkID0gb2JqLklkOw0KDQogICAgDQogICAgICAgICAgICBpZih0eXBlb2Yob2JqLmFjdGl2ZSkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKG9iai5lbmFibGVkKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZihvYmouY29kZSkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5jb2RlKG9iai5jb2RlKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2Yob2JqLm9yZGVyKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLm9yZGVyKG9iai5vcmRlcik7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKG9iai5kYXRlKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLmRhdGUob2JqLmRhdGUpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICB0aGlzLmRhdGUobmV3IEdsaWRlRGF0ZVRpbWUodGhpcy5kYXRlKCkpKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2Yob2JqLm5hbWUpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMubmFtZShvYmoubmFtZSk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKG9iai5yZW1hcmspIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMucmVtYXJrKG9iai5yZW1hcmspOw0KICAgICAgICANCiAgICAgICAgICAgICAgICB0aGlzLnJlbWFyayhHbGlkZVN0cmluZ1V0aWwuYmFzZTY0RGVjb2RlKHRoaXMucmVtYXJrKCkpKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2Yob2JqLmdyb3VwKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLmdyb3VwKE1ldHJpY19Hcm91cCgpLl9mcm9tRG9jdW1lbnQob2JqLmdyb3VwKSk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KDQogICAgDQogICAgICAgICAgICBpZih0eXBlb2Yob2JqLnR5cGVfTWV0cmljcykhPT0ndW5kZWZpbmVkJykgdGhpcy50eXBlX01ldHJpY3MobmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGlvdC5NZXRyaWMoKS5fZnJvbURvY3VtZW50KG9iai50eXBlX3R5cGVfTWV0cmljcykpOw0KICAgIA0KDQogICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgfQ0KDQogICAgICAgIF90b0RvY3VtZW50KCl7DQogICAgICAgICAgICBsZXQgX190b1N0cmluZyA9ICdNZXRyaWNfVHlwZS5fdG9Eb2N1bWVudCgpOiAnOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBsZXQgcmV0ID0ge307DQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5JZCkhPT0ndW5kZWZpbmVkJykgcmV0LklkID0gdGhpcy5JZDsNCg0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMuX2FjdGl2ZSkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgcmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMuX2VuYWJsZWQpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHJldC5lbmFibGVkID0gdGhpcy5lbmFibGVkKCk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMuX2NvZGUpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHJldC5jb2RlID0gdGhpcy5jb2RlKCk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMuX29yZGVyKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICByZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMuX2RhdGUpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHJldC5kYXRlID0gdGhpcy5kYXRlKCk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGlmKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS5nZXROdW1lcmljVmFsdWUpPT09J2Z1bmN0aW9uJykgcmV0LmRhdGUgPSBuZXcgRGF0ZShyZXQuZGF0ZS5nZXROdW1lcmljVmFsdWUoKSkudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMuX25hbWUpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHJldC5uYW1lID0gdGhpcy5uYW1lKCk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMuX3JlbWFyaykhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgcmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGlmKHR5cGVvZihyZXQucmVtYXJrKCkpPT09J29iamVjdCcpIHJldC5yZW1hcmsgPSBHbGlkZVN0cmluZ1V0aWwuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5yZW1hcmspKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5fZ3JvdXApIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHJldC5ncm91cCA9IHRoaXMuZ3JvdXAoKS5fdG9Eb2N1bWVudCgpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgDQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy50eXBlX01ldHJpY3MoKSkhPT0ndW5kZWZpbmVkJykgcmV0LnR5cGVfTWV0cmljcyA9IHNlbGYudHlwZV90eXBlX01ldHJpY3MoKS5tYXAoZnVuY3Rpb24odGEpe3JldHVybiB0YS5fdG9Eb2N1bWVudCgpO30pOw0KICAgIA0KICAgICAgICAgICAgcmV0dXJuIHJldDsNCiAgICAgICAgfQ0KDQogICAgICAgIF91bmlxdWUoKXsNCiAgICAgICAgICAgIGxldCBfX3RvU3RyaW5nID0gJ01ldHJpY19UeXBlLl91bmlxdWUoKTogJzsNCiAgICAgICAgDQogICAgICAgICAgICBsZXQgcmV0ID0gbmV3IHVuZGVmaW5lZCgpOw0KICAgICAgICAgICAgaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDsNCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZih0aGlzLmNvZGUoKSkhPT0ndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpOw0KICAgIA0KICAgICAgICAgICAgcmV0dXJuIHJldDsNCiAgICAgICAgfQ0KDQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE1ldHJpY19UeXBlLnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgc3RvcmUoX19ldmVudCl7DQogICAgICAgICAgICBsZXQgX190b1N0cmluZyA9ICdNZXRyaWNfVHlwZS5zdG9yZSgpOiAnOw0KDQogICAgICAgICAgICBsZXQgYW5zd2VyID0gdW5kZWZpbmVkOw0KDQogICAgICAgICAgICB2YXIgbm9kZSA9IG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uTm9kZSgpLmNvZGUoZ3MuZ2V0UHJvcGVydHkoJ2luc3RhbmNlX25hbWUnKSk7DQogICAgICAgICAgICBsZXQgX19yZXNwb25zZSA9IG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrbmV3IERhdGUobmV3IEdsaWRlRGF0ZVRpbWUoKSkudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJykrJ10uTWV0cmljX1R5cGUuc3RvcmUoKScpLm1ldGhvZCgnc3RvcmUnKS5jbGFzc05hbWUoJ01ldHJpY19UeXBlJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSk7DQoNCiAgICAgICAgICAgIGxldCBldkpTT04gPSBudWxsOw0KICAgICAgICAgICAgaWYoX19ldmVudCl7DQogICAgICAgICAgICAgICAgZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICAgICAgaWYodHlwZW9mKGV2SlNPTi5fX3RoaXMpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgICAgICB0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7DQogICAgICAgIA0KDQoNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIC8vX19yZXNwb25zZS5yZWNpcGllbnQobmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5Ob2RlKCkuY29kZSgncGFyZW50JykpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZihfX2V2ZW50ICYmICFfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQoNCiAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICBpZihfX2V2ZW50ICYmIF9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGFuc3dlciA9IE1ldHJpY19UeXBlKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZighX19ldmVudCl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgLy8gc3RvcmUgbG9jYWxseQ0KICAgICAgICAgICAgICAgIGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgnTWV0cmljX1R5cGUnKTsNCg0KICAgICAgICAgICAgICAgIGxldCBfdGhpcyA9IHRoaXMuX3VuaXF1ZSgpLmZpbmQoKTsNCiAgICAgICAgICAgICAgICBpZighX3RoaXMpIGdyLnNldE5ld0d1aWRWYWx1ZSh0aGlzLklkIHx8ICh0aGlzLklkID0gZ3Iuc2V0TmV3R3VpZCgpKSk7DQogICAgICAgICAgICAgICAgaWYoX3RoaXMgJiYgdHlwZW9mKF90aGlzLklkKSE9PSd1bmRlZmluZWQnKSBnci5nZXQoX3RoaXMuSWQpOw0KDQogICAgICAgICAgICAgICAgbGV0IGJTZXQgPSBmYWxzZTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgaWYoX3RoaXMgJiYgdHlwZW9mKF90aGlzLmdldGNvZGUoKSkhPT0ndW5kZWZpbmVkJykgYlNldCA9IGdyLnNldFZhbHVlKCdjb2RlJywgX3RoaXMuZ2V0Y29kZSgpKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgaWYoYlNldCl7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuSWQgPSBnci51cGRhdGUoKTsNCiAgICAgICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgInRoaXMuSWQgPSAiICsgdGhpcy5JZCk7DQogICAgICAgICAgICAgICAgICAgIGlmKCFhbnN3ZXIpIGFuc3dlciA9IHRoaXM7DQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJpbnZhbGlkIG9iamVjdCIpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICANCg0KICAgICAgICAgICAgfQ0KDQoNCg0KDQogICAgICAgICAgICBpZighX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGlmKGFuc3dlcil7DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoe19fdGhpczogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICByZXR1cm4gYW5zd2VyOw0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE1ldHJpY19UeXBlLmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBmaW5kQWxsKF9fZXZlbnQpew0KICAgICAgICAgICAgbGV0IF9fdG9TdHJpbmcgPSAnTWV0cmljX1R5cGUuZmluZEFsbCgpOiAnOw0KDQogICAgICAgICAgICBsZXQgYW5zd2VyID0gdW5kZWZpbmVkOw0KDQogICAgICAgICAgICB2YXIgbm9kZSA9IG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uTm9kZSgpLmNvZGUoZ3MuZ2V0UHJvcGVydHkoJ2luc3RhbmNlX25hbWUnKSk7DQogICAgICAgICAgICBsZXQgX19yZXNwb25zZSA9IG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrbmV3IERhdGUobmV3IEdsaWRlRGF0ZVRpbWUoKSkudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJykrJ10uTWV0cmljX1R5cGUuZmluZEFsbCgpJykubWV0aG9kKCdmaW5kQWxsJykuY2xhc3NOYW1lKCdNZXRyaWNfVHlwZScpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpOw0KDQogICAgICAgICAgICBsZXQgZXZKU09OID0gbnVsbDsNCiAgICAgICAgICAgIGlmKF9fZXZlbnQpew0KICAgICAgICAgICAgICAgIGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgICAgIGlmKHR5cGVvZihldkpTT04uX190aGlzKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpOw0KICAgICAgICANCg0KDQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAvL19fcmVzcG9uc2UucmVjaXBpZW50KG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uTm9kZSgpLmNvZGUoJ3BhcmVudCcpKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoX19ldmVudCAmJiAhX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KDQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgaWYoX19ldmVudCAmJiBfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBhbnN3ZXIgPSBNZXRyaWNfVHlwZSgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIA0KDQogICAgICAgICAgICB9DQoNCg0KDQoNCiAgICAgICAgICAgIGlmKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgaWYoYW5zd2VyKXsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7X190aGlzOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHJldHVybiBhbnN3ZXI7DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTWV0cmljX1R5cGUuZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGZpbmQoX19ldmVudCl7DQogICAgICAgICAgICBsZXQgX190b1N0cmluZyA9ICdNZXRyaWNfVHlwZS5maW5kKCk6ICc7DQoNCiAgICAgICAgICAgIGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7DQoNCiAgICAgICAgICAgIHZhciBub2RlID0gbmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5Ob2RlKCkuY29kZShncy5nZXRQcm9wZXJ0eSgnaW5zdGFuY2VfbmFtZScpKTsNCiAgICAgICAgICAgIGxldCBfX3Jlc3BvbnNlID0gbmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5FdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytuZXcgRGF0ZShuZXcgR2xpZGVEYXRlVGltZSgpKS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKSsnXS5NZXRyaWNfVHlwZS5maW5kKCknKS5tZXRob2QoJ2ZpbmQnKS5jbGFzc05hbWUoJ01ldHJpY19UeXBlJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSk7DQoNCiAgICAgICAgICAgIGxldCBldkpTT04gPSBudWxsOw0KICAgICAgICAgICAgaWYoX19ldmVudCl7DQogICAgICAgICAgICAgICAgZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICAgICAgaWYodHlwZW9mKGV2SlNPTi5fX3RoaXMpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgICAgICB0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7DQogICAgICAgIA0KDQoNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIC8vX19yZXNwb25zZS5yZWNpcGllbnQobmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5Ob2RlKCkuY29kZSgncGFyZW50JykpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZihfX2V2ZW50ICYmICFfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQoNCiAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICBpZihfX2V2ZW50ICYmIF9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGFuc3dlciA9IE1ldHJpY19UeXBlKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZighX19ldmVudCl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KDQoNCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBpZihhbnN3ZXIpew0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHtfX3RoaXM6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcmV0dXJuIGFuc3dlcjsNCiAgICAgICAgfQ0KICAgIA0KICAgIH07DQoNCiAgICBlc3B0ZXN0LmNvbSA9IGVzcHRlc3QuY29tIHx8IHt9O2VzcHRlc3QuY29tLm5hbW1vdXIgPSBlc3B0ZXN0LmNvbS5uYW1tb3VyIHx8IHt9O2VzcHRlc3QuY29tLm5hbW1vdXIuZGNvbSA9IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbSB8fCB7fTsNCiAgICBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uQ29uZmlnID0gY2xhc3Mgew0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBDb25maWcuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgYWN0aXZlKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX2FjdGl2ZSA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fYWN0aXZlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIENvbmZpZy5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgZW5hYmxlZCh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9lbmFibGVkID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9lbmFibGVkOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIENvbmZpZy5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgY29kZSh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9jb2RlID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9jb2RlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIENvbmZpZy5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIG9yZGVyKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX29yZGVyID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9vcmRlcjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBDb25maWcuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGRhdGUodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fZGF0ZSA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZGF0ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBDb25maWcubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIG5hbWUodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fbmFtZSA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fbmFtZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBDb25maWcucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgcmVtYXJrKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX3JlbWFyayA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fcmVtYXJrOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIENvbmZpZy52YWx1ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHZhbHVlKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX3ZhbHVlID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl92YWx1ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBDb25maWcuc2NyaXB0IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgc2NyaXB0KHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX3NjcmlwdCA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fc2NyaXB0Ow0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIENvbmZpZy50b29sIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgdG9vbCh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl90b29sID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl90b29sOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIENvbmZpZy5ncm91cCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGdyb3VwKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX2dyb3VwID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9ncm91cDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBDb25maWcudHlwZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHR5cGUodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fdHlwZSA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fdHlwZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBDb25maWcubm9kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIG5vZGUodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fbm9kZSA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fbm9kZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgIA0KICAgIA0KICAgIA0KICAgICAgICBfZnJvbURvY3VtZW50KG9iail7DQogICAgICAgICAgICBsZXQgX190b1N0cmluZyA9ICdDb25maWcuX2Zyb21Eb2N1bWVudCgpOiAnOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBpZighb2JqKSByZXR1cm4gdGhpczsNCg0KICAgICAgICAgICAgLy9pZiBpc2luc3RhbmNlKG9iaiwgYnl0ZXMpOiBvYmogPSBzdHIob2JqLCAidXRmLTgiKTsNCg0KICAgICAgICAgICAgaWYodHlwZW9mKG9iaik9PT0nc3RyaW5nJyl7DQogICAgICAgICAgICAgICAgaWYobmV3IFJlZ0V4cCgiKCgoW0EtWmEtel17Myw5fTooPzovLyk/KSg/OlstOzomPSskLHddK0ApP1tBLVphLXowLTkuLV0rfCg/Ond3dy58Wy07OiY9KyQsd10rQClbQS1aYS16MC05Li1dKykoKD86L1srfiUvLnctX10qKT8/Pyg/OlstKz0mOyVALndfXSopIz8oPzpbd10qKSk/KSIpLnRlc3Qob2JqKSl7DQogICAgICAgICAgICAgICAgICAgIGxldCByZXF1ZXN0ID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTsNCiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdC5zZXRIdHRwTWV0aG9kKCdHRVQnKTsNCiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdC5zZXRFbmRwb2ludChvYmopOw0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHJlcXVlc3QuZXhlY3V0ZSgpLmdldEJvZHkoKSk7DQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoSlNPTi5wYXJzZShvYmopKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgaWYoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKXtyZXR1cm4gbmV3IENvbmZpZygpLl9mcm9tRG9jdW1lbnQobyl9KTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKG9iai5JZCkhPT0ndW5kZWZpbmVkJykgdGhpcy5JZCA9IG9iai5JZDsNCg0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKG9iai5hY3RpdmUpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZihvYmouZW5hYmxlZCkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2Yob2JqLmNvZGUpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuY29kZShvYmouY29kZSk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKG9iai5vcmRlcikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5vcmRlcihvYmoub3JkZXIpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZihvYmouZGF0ZSkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5kYXRlKG9iai5kYXRlKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgdGhpcy5kYXRlKG5ldyBHbGlkZURhdGVUaW1lKHRoaXMuZGF0ZSgpKSk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKG9iai5uYW1lKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLm5hbWUob2JqLm5hbWUpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZihvYmoucmVtYXJrKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLnJlbWFyayhvYmoucmVtYXJrKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgdGhpcy5yZW1hcmsoR2xpZGVTdHJpbmdVdGlsLmJhc2U2NERlY29kZSh0aGlzLnJlbWFyaygpKSk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKG9iai52YWx1ZSkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy52YWx1ZShvYmoudmFsdWUpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICB0aGlzLnZhbHVlKEdsaWRlU3RyaW5nVXRpbC5iYXNlNjREZWNvZGUodGhpcy52YWx1ZSgpKSk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKG9iai5zY3JpcHQpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuc2NyaXB0KG9iai5zY3JpcHQpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICB0aGlzLnNjcmlwdChHbGlkZVN0cmluZ1V0aWwuYmFzZTY0RGVjb2RlKHRoaXMuc2NyaXB0KCkpKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2Yob2JqLnRvb2wpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMudG9vbChUb29sKCkuX2Zyb21Eb2N1bWVudChvYmoudG9vbCkpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZihvYmouZ3JvdXApIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXAoQ29uZmlnX0dyb3VwKCkuX2Zyb21Eb2N1bWVudChvYmouZ3JvdXApKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2Yob2JqLnR5cGUpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMudHlwZShUb29sX1R5cGUoKS5fZnJvbURvY3VtZW50KG9iai50eXBlKSk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKG9iai5ub2RlKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLm5vZGUoTm9kZSgpLl9mcm9tRG9jdW1lbnQob2JqLm5vZGUpKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQoNCiAgICANCg0KICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgIH0NCg0KICAgICAgICBfdG9Eb2N1bWVudCgpew0KICAgICAgICAgICAgbGV0IF9fdG9TdHJpbmcgPSAnQ29uZmlnLl90b0RvY3VtZW50KCk6ICc7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGxldCByZXQgPSB7fTsNCiAgICAgICAgICAgIGlmKHR5cGVvZih0aGlzLklkKSE9PSd1bmRlZmluZWQnKSByZXQuSWQgPSB0aGlzLklkOw0KDQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5fYWN0aXZlKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICByZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5fZW5hYmxlZCkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgcmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5fY29kZSkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgcmV0LmNvZGUgPSB0aGlzLmNvZGUoKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5fb3JkZXIpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5fZGF0ZSkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgcmV0LmRhdGUgPSB0aGlzLmRhdGUoKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgaWYocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLmdldE51bWVyaWNWYWx1ZSk9PT0nZnVuY3Rpb24nKSByZXQuZGF0ZSA9IG5ldyBEYXRlKHJldC5kYXRlLmdldE51bWVyaWNWYWx1ZSgpKS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5fbmFtZSkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgcmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5fcmVtYXJrKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICByZXQucmVtYXJrID0gdGhpcy5yZW1hcmsoKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgaWYodHlwZW9mKHJldC5yZW1hcmsoKSk9PT0nb2JqZWN0JykgcmV0LnJlbWFyayA9IEdsaWRlU3RyaW5nVXRpbC5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZih0aGlzLl92YWx1ZSkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgcmV0LnZhbHVlID0gdGhpcy52YWx1ZSgpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBpZih0eXBlb2YocmV0LnZhbHVlKCkpPT09J29iamVjdCcpIHJldC52YWx1ZSA9IEdsaWRlU3RyaW5nVXRpbC5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnZhbHVlKSk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMuX3NjcmlwdCkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgcmV0LnNjcmlwdCA9IHRoaXMuc2NyaXB0KCk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGlmKHR5cGVvZihyZXQuc2NyaXB0KCkpPT09J29iamVjdCcpIHJldC5zY3JpcHQgPSBHbGlkZVN0cmluZ1V0aWwuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5zY3JpcHQpKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5fdG9vbCkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgcmV0LnRvb2wgPSB0aGlzLnRvb2woKS5fdG9Eb2N1bWVudCgpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZih0aGlzLl9ncm91cCkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgcmV0Lmdyb3VwID0gdGhpcy5ncm91cCgpLl90b0RvY3VtZW50KCk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMuX3R5cGUpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHJldC50eXBlID0gdGhpcy50eXBlKCkuX3RvRG9jdW1lbnQoKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5fbm9kZSkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgcmV0Lm5vZGUgPSB0aGlzLm5vZGUoKS5fdG9Eb2N1bWVudCgpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgDQogICAgDQogICAgICAgICAgICByZXR1cm4gcmV0Ow0KICAgICAgICB9DQoNCiAgICAgICAgX3VuaXF1ZSgpew0KICAgICAgICAgICAgbGV0IF9fdG9TdHJpbmcgPSAnQ29uZmlnLl91bmlxdWUoKTogJzsNCiAgICAgICAgDQogICAgICAgICAgICBsZXQgcmV0ID0gbmV3IHVuZGVmaW5lZCgpOw0KICAgICAgICAgICAgaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDsNCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZih0aGlzLm5hbWUoKSkhPT0ndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpOw0KICAgIA0KICAgICAgICAgICAgcmV0dXJuIHJldDsNCiAgICAgICAgfQ0KDQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIENvbmZpZy5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHN0b3JlKF9fZXZlbnQpew0KICAgICAgICAgICAgbGV0IF9fdG9TdHJpbmcgPSAnQ29uZmlnLnN0b3JlKCk6ICc7DQoNCiAgICAgICAgICAgIGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7DQoNCiAgICAgICAgICAgIHZhciBub2RlID0gbmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5Ob2RlKCkuY29kZShncy5nZXRQcm9wZXJ0eSgnaW5zdGFuY2VfbmFtZScpKTsNCiAgICAgICAgICAgIGxldCBfX3Jlc3BvbnNlID0gbmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5FdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytuZXcgRGF0ZShuZXcgR2xpZGVEYXRlVGltZSgpKS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKSsnXS5Db25maWcuc3RvcmUoKScpLm1ldGhvZCgnc3RvcmUnKS5jbGFzc05hbWUoJ0NvbmZpZycpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpOw0KDQogICAgICAgICAgICBsZXQgZXZKU09OID0gbnVsbDsNCiAgICAgICAgICAgIGlmKF9fZXZlbnQpew0KICAgICAgICAgICAgICAgIGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgICAgIGlmKHR5cGVvZihldkpTT04uX190aGlzKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpOw0KICAgICAgICANCg0KDQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAvL19fcmVzcG9uc2UucmVjaXBpZW50KG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uTm9kZSgpLmNvZGUoJ3BhcmVudCcpKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoX19ldmVudCAmJiAhX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KDQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgaWYoX19ldmVudCAmJiBfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBhbnN3ZXIgPSBDb25maWcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKCFfX2V2ZW50KXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBzdG9yZSBsb2NhbGx5DQogICAgICAgICAgICAgICAgbGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCdDb25maWcnKTsNCg0KICAgICAgICAgICAgICAgIGxldCBfdGhpcyA9IHRoaXMuX3VuaXF1ZSgpLmZpbmQoKTsNCiAgICAgICAgICAgICAgICBpZighX3RoaXMpIGdyLnNldE5ld0d1aWRWYWx1ZSh0aGlzLklkIHx8ICh0aGlzLklkID0gZ3Iuc2V0TmV3R3VpZCgpKSk7DQogICAgICAgICAgICAgICAgaWYoX3RoaXMgJiYgdHlwZW9mKF90aGlzLklkKSE9PSd1bmRlZmluZWQnKSBnci5nZXQoX3RoaXMuSWQpOw0KDQogICAgICAgICAgICAgICAgbGV0IGJTZXQgPSBmYWxzZTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgaWYoX3RoaXMgJiYgdHlwZW9mKF90aGlzLmdldG5hbWUoKSkhPT0ndW5kZWZpbmVkJykgYlNldCA9IGdyLnNldFZhbHVlKCduYW1lJywgX3RoaXMuZ2V0bmFtZSgpKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgaWYoYlNldCl7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuSWQgPSBnci51cGRhdGUoKTsNCiAgICAgICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgInRoaXMuSWQgPSAiICsgdGhpcy5JZCk7DQogICAgICAgICAgICAgICAgICAgIGlmKCFhbnN3ZXIpIGFuc3dlciA9IHRoaXM7DQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJpbnZhbGlkIG9iamVjdCIpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICANCg0KICAgICAgICAgICAgfQ0KDQoNCg0KDQogICAgICAgICAgICBpZighX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGlmKGFuc3dlcil7DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoe19fdGhpczogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICByZXR1cm4gYW5zd2VyOw0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIENvbmZpZy5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgZmluZEFsbChfX2V2ZW50KXsNCiAgICAgICAgICAgIGxldCBfX3RvU3RyaW5nID0gJ0NvbmZpZy5maW5kQWxsKCk6ICc7DQoNCiAgICAgICAgICAgIGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7DQoNCiAgICAgICAgICAgIHZhciBub2RlID0gbmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5Ob2RlKCkuY29kZShncy5nZXRQcm9wZXJ0eSgnaW5zdGFuY2VfbmFtZScpKTsNCiAgICAgICAgICAgIGxldCBfX3Jlc3BvbnNlID0gbmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5FdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytuZXcgRGF0ZShuZXcgR2xpZGVEYXRlVGltZSgpKS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKSsnXS5Db25maWcuZmluZEFsbCgpJykubWV0aG9kKCdmaW5kQWxsJykuY2xhc3NOYW1lKCdDb25maWcnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKTsNCg0KICAgICAgICAgICAgbGV0IGV2SlNPTiA9IG51bGw7DQogICAgICAgICAgICBpZihfX2V2ZW50KXsNCiAgICAgICAgICAgICAgICBldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgICAgICBpZih0eXBlb2YoZXZKU09OLl9fdGhpcykhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTsNCiAgICAgICAgDQoNCg0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgLy9fX3Jlc3BvbnNlLnJlY2lwaWVudChuZXcgZXNwdGVzdC5jb20ubmFtbW91ci5kY29tLk5vZGUoKS5jb2RlKCdwYXJlbnQnKSk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKF9fZXZlbnQgJiYgIV9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCg0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgIGlmKF9fZXZlbnQgJiYgX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgYW5zd2VyID0gQ29uZmlnKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZighX19ldmVudCl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KDQoNCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBpZihhbnN3ZXIpew0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHtfX3RoaXM6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcmV0dXJuIGFuc3dlcjsNCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBDb25maWcuZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGZpbmQoX19ldmVudCl7DQogICAgICAgICAgICBsZXQgX190b1N0cmluZyA9ICdDb25maWcuZmluZCgpOiAnOw0KDQogICAgICAgICAgICBsZXQgYW5zd2VyID0gdW5kZWZpbmVkOw0KDQogICAgICAgICAgICB2YXIgbm9kZSA9IG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uTm9kZSgpLmNvZGUoZ3MuZ2V0UHJvcGVydHkoJ2luc3RhbmNlX25hbWUnKSk7DQogICAgICAgICAgICBsZXQgX19yZXNwb25zZSA9IG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrbmV3IERhdGUobmV3IEdsaWRlRGF0ZVRpbWUoKSkudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJykrJ10uQ29uZmlnLmZpbmQoKScpLm1ldGhvZCgnZmluZCcpLmNsYXNzTmFtZSgnQ29uZmlnJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSk7DQoNCiAgICAgICAgICAgIGxldCBldkpTT04gPSBudWxsOw0KICAgICAgICAgICAgaWYoX19ldmVudCl7DQogICAgICAgICAgICAgICAgZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICAgICAgaWYodHlwZW9mKGV2SlNPTi5fX3RoaXMpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgICAgICB0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7DQogICAgICAgIA0KDQoNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIC8vX19yZXNwb25zZS5yZWNpcGllbnQobmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5Ob2RlKCkuY29kZSgncGFyZW50JykpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZihfX2V2ZW50ICYmICFfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQoNCiAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICBpZihfX2V2ZW50ICYmIF9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGFuc3dlciA9IENvbmZpZygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIA0KDQogICAgICAgICAgICB9DQoNCg0KDQoNCiAgICAgICAgICAgIGlmKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgaWYoYW5zd2VyKXsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7X190aGlzOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHJldHVybiBhbnN3ZXI7DQogICAgICAgIH0NCiAgICANCiAgICB9Ow0KDQogICAgZXNwdGVzdC5jb20gPSBlc3B0ZXN0LmNvbSB8fCB7fTtlc3B0ZXN0LmNvbS5uYW1tb3VyID0gZXNwdGVzdC5jb20ubmFtbW91ciB8fCB7fTtlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20gPSBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20gfHwge307DQogICAgZXNwdGVzdC5jb20ubmFtbW91ci5kY29tLlRvb2wgPSBjbGFzcyB7DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIFRvb2wuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgYWN0aXZlKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX2FjdGl2ZSA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fYWN0aXZlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIFRvb2wuZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGVuYWJsZWQodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fZW5hYmxlZCA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZW5hYmxlZDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBUb29sLmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBjb2RlKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX2NvZGUgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2NvZGU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogVG9vbC5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIG9yZGVyKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX29yZGVyID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9vcmRlcjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBUb29sLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBkYXRlKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX2RhdGUgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2RhdGU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogVG9vbC5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgbmFtZSh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9uYW1lID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9uYW1lOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIFRvb2wucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgcmVtYXJrKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX3JlbWFyayA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fcmVtYXJrOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIFRvb2wudHlwZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHR5cGUodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fdHlwZSA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fdHlwZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgIA0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBUb29sLnRvb2xfQ29uZmlncyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHRvb2xfQ29uZmlncyh2KXsNCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBUb29sLnRvb2xfTWFwcGluZ3MgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICB0b29sX01hcHBpbmdzKHYpew0KICAgICAgICB9DQogICAgDQogICAgDQogICAgICAgIF9mcm9tRG9jdW1lbnQob2JqKXsNCiAgICAgICAgICAgIGxldCBfX3RvU3RyaW5nID0gJ1Rvb2wuX2Zyb21Eb2N1bWVudCgpOiAnOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBpZighb2JqKSByZXR1cm4gdGhpczsNCg0KICAgICAgICAgICAgLy9pZiBpc2luc3RhbmNlKG9iaiwgYnl0ZXMpOiBvYmogPSBzdHIob2JqLCAidXRmLTgiKTsNCg0KICAgICAgICAgICAgaWYodHlwZW9mKG9iaik9PT0nc3RyaW5nJyl7DQogICAgICAgICAgICAgICAgaWYobmV3IFJlZ0V4cCgiKCgoW0EtWmEtel17Myw5fTooPzovLyk/KSg/OlstOzomPSskLHddK0ApP1tBLVphLXowLTkuLV0rfCg/Ond3dy58Wy07OiY9KyQsd10rQClbQS1aYS16MC05Li1dKykoKD86L1srfiUvLnctX10qKT8/Pyg/OlstKz0mOyVALndfXSopIz8oPzpbd10qKSk/KSIpLnRlc3Qob2JqKSl7DQogICAgICAgICAgICAgICAgICAgIGxldCByZXF1ZXN0ID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTsNCiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdC5zZXRIdHRwTWV0aG9kKCdHRVQnKTsNCiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdC5zZXRFbmRwb2ludChvYmopOw0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHJlcXVlc3QuZXhlY3V0ZSgpLmdldEJvZHkoKSk7DQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoSlNPTi5wYXJzZShvYmopKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgaWYoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKXtyZXR1cm4gbmV3IFRvb2woKS5fZnJvbURvY3VtZW50KG8pfSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZihvYmouSWQpIT09J3VuZGVmaW5lZCcpIHRoaXMuSWQgPSBvYmouSWQ7DQoNCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZihvYmouYWN0aXZlKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2Yob2JqLmVuYWJsZWQpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKG9iai5jb2RlKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLmNvZGUob2JqLmNvZGUpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZihvYmoub3JkZXIpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMub3JkZXIob2JqLm9yZGVyKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2Yob2JqLmRhdGUpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuZGF0ZShvYmouZGF0ZSk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIHRoaXMuZGF0ZShuZXcgR2xpZGVEYXRlVGltZSh0aGlzLmRhdGUoKSkpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZihvYmoubmFtZSkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5uYW1lKG9iai5uYW1lKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2Yob2JqLnJlbWFyaykhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5yZW1hcmsob2JqLnJlbWFyayk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIHRoaXMucmVtYXJrKEdsaWRlU3RyaW5nVXRpbC5iYXNlNjREZWNvZGUodGhpcy5yZW1hcmsoKSkpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZihvYmoudHlwZSkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy50eXBlKFRvb2xfVHlwZSgpLl9mcm9tRG9jdW1lbnQob2JqLnR5cGUpKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQoNCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZihvYmoudG9vbF9Db25maWdzKSE9PSd1bmRlZmluZWQnKSB0aGlzLnRvb2xfQ29uZmlncyhuZXcgZXNwdGVzdC5jb20ubmFtbW91ci5kY29tLkNvbmZpZygpLl9mcm9tRG9jdW1lbnQob2JqLnRvb2xfdG9vbF9Db25maWdzKSk7DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2Yob2JqLnRvb2xfTWFwcGluZ3MpIT09J3VuZGVmaW5lZCcpIHRoaXMudG9vbF9NYXBwaW5ncyhuZXcgZXNwdGVzdC5jb20ubmFtbW91ci5kY29tLk1hcHBpbmcoKS5fZnJvbURvY3VtZW50KG9iai50b29sX3Rvb2xfTWFwcGluZ3MpKTsNCiAgICANCg0KICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgIH0NCg0KICAgICAgICBfdG9Eb2N1bWVudCgpew0KICAgICAgICAgICAgbGV0IF9fdG9TdHJpbmcgPSAnVG9vbC5fdG9Eb2N1bWVudCgpOiAnOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBsZXQgcmV0ID0ge307DQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5JZCkhPT0ndW5kZWZpbmVkJykgcmV0LklkID0gdGhpcy5JZDsNCg0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMuX2FjdGl2ZSkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgcmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMuX2VuYWJsZWQpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHJldC5lbmFibGVkID0gdGhpcy5lbmFibGVkKCk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMuX2NvZGUpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHJldC5jb2RlID0gdGhpcy5jb2RlKCk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMuX29yZGVyKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICByZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMuX2RhdGUpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHJldC5kYXRlID0gdGhpcy5kYXRlKCk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGlmKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS5nZXROdW1lcmljVmFsdWUpPT09J2Z1bmN0aW9uJykgcmV0LmRhdGUgPSBuZXcgRGF0ZShyZXQuZGF0ZS5nZXROdW1lcmljVmFsdWUoKSkudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMuX25hbWUpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHJldC5uYW1lID0gdGhpcy5uYW1lKCk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMuX3JlbWFyaykhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgcmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGlmKHR5cGVvZihyZXQucmVtYXJrKCkpPT09J29iamVjdCcpIHJldC5yZW1hcmsgPSBHbGlkZVN0cmluZ1V0aWwuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5yZW1hcmspKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5fdHlwZSkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgcmV0LnR5cGUgPSB0aGlzLnR5cGUoKS5fdG9Eb2N1bWVudCgpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgDQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy50b29sX0NvbmZpZ3MoKSkhPT0ndW5kZWZpbmVkJykgcmV0LnRvb2xfQ29uZmlncyA9IHNlbGYudG9vbF90b29sX0NvbmZpZ3MoKS5tYXAoZnVuY3Rpb24odGEpe3JldHVybiB0YS5fdG9Eb2N1bWVudCgpO30pOw0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMudG9vbF9NYXBwaW5ncygpKSE9PSd1bmRlZmluZWQnKSByZXQudG9vbF9NYXBwaW5ncyA9IHNlbGYudG9vbF90b29sX01hcHBpbmdzKCkubWFwKGZ1bmN0aW9uKHRhKXtyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTt9KTsNCiAgICANCiAgICAgICAgICAgIHJldHVybiByZXQ7DQogICAgICAgIH0NCg0KICAgICAgICBfdW5pcXVlKCl7DQogICAgICAgICAgICBsZXQgX190b1N0cmluZyA9ICdUb29sLl91bmlxdWUoKTogJzsNCiAgICAgICAgDQogICAgICAgICAgICBsZXQgcmV0ID0gbmV3IHVuZGVmaW5lZCgpOw0KICAgICAgICAgICAgaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDsNCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZih0aGlzLm5hbWUoKSkhPT0ndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpOw0KICAgIA0KICAgICAgICAgICAgcmV0dXJuIHJldDsNCiAgICAgICAgfQ0KDQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIFRvb2wuc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBzdG9yZShfX2V2ZW50KXsNCiAgICAgICAgICAgIGxldCBfX3RvU3RyaW5nID0gJ1Rvb2wuc3RvcmUoKTogJzsNCg0KICAgICAgICAgICAgbGV0IGFuc3dlciA9IHVuZGVmaW5lZDsNCg0KICAgICAgICAgICAgdmFyIG5vZGUgPSBuZXcgZXNwdGVzdC5jb20ubmFtbW91ci5kY29tLk5vZGUoKS5jb2RlKGdzLmdldFByb3BlcnR5KCdpbnN0YW5jZV9uYW1lJykpOw0KICAgICAgICAgICAgbGV0IF9fcmVzcG9uc2UgPSBuZXcgZXNwdGVzdC5jb20ubmFtbW91ci5kY29tLkV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK25ldyBEYXRlKG5ldyBHbGlkZURhdGVUaW1lKCkpLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpKyddLlRvb2wuc3RvcmUoKScpLm1ldGhvZCgnc3RvcmUnKS5jbGFzc05hbWUoJ1Rvb2wnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKTsNCg0KICAgICAgICAgICAgbGV0IGV2SlNPTiA9IG51bGw7DQogICAgICAgICAgICBpZihfX2V2ZW50KXsNCiAgICAgICAgICAgICAgICBldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgICAgICBpZih0eXBlb2YoZXZKU09OLl9fdGhpcykhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTsNCiAgICAgICAgDQoNCg0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgLy9fX3Jlc3BvbnNlLnJlY2lwaWVudChuZXcgZXNwdGVzdC5jb20ubmFtbW91ci5kY29tLk5vZGUoKS5jb2RlKCdwYXJlbnQnKSk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKF9fZXZlbnQgJiYgIV9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCg0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgIGlmKF9fZXZlbnQgJiYgX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgYW5zd2VyID0gVG9vbCgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIHN0b3JlIGxvY2FsbHkNCiAgICAgICAgICAgICAgICBsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ1Rvb2wnKTsNCg0KICAgICAgICAgICAgICAgIGxldCBfdGhpcyA9IHRoaXMuX3VuaXF1ZSgpLmZpbmQoKTsNCiAgICAgICAgICAgICAgICBpZighX3RoaXMpIGdyLnNldE5ld0d1aWRWYWx1ZSh0aGlzLklkIHx8ICh0aGlzLklkID0gZ3Iuc2V0TmV3R3VpZCgpKSk7DQogICAgICAgICAgICAgICAgaWYoX3RoaXMgJiYgdHlwZW9mKF90aGlzLklkKSE9PSd1bmRlZmluZWQnKSBnci5nZXQoX3RoaXMuSWQpOw0KDQogICAgICAgICAgICAgICAgbGV0IGJTZXQgPSBmYWxzZTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgaWYoX3RoaXMgJiYgdHlwZW9mKF90aGlzLmdldG5hbWUoKSkhPT0ndW5kZWZpbmVkJykgYlNldCA9IGdyLnNldFZhbHVlKCduYW1lJywgX3RoaXMuZ2V0bmFtZSgpKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgaWYoYlNldCl7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuSWQgPSBnci51cGRhdGUoKTsNCiAgICAgICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgInRoaXMuSWQgPSAiICsgdGhpcy5JZCk7DQogICAgICAgICAgICAgICAgICAgIGlmKCFhbnN3ZXIpIGFuc3dlciA9IHRoaXM7DQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJpbnZhbGlkIG9iamVjdCIpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICANCg0KICAgICAgICAgICAgfQ0KDQoNCg0KDQogICAgICAgICAgICBpZighX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGlmKGFuc3dlcil7DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoe19fdGhpczogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICByZXR1cm4gYW5zd2VyOw0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIFRvb2wuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGZpbmRBbGwoX19ldmVudCl7DQogICAgICAgICAgICBsZXQgX190b1N0cmluZyA9ICdUb29sLmZpbmRBbGwoKTogJzsNCg0KICAgICAgICAgICAgbGV0IGFuc3dlciA9IHVuZGVmaW5lZDsNCg0KICAgICAgICAgICAgdmFyIG5vZGUgPSBuZXcgZXNwdGVzdC5jb20ubmFtbW91ci5kY29tLk5vZGUoKS5jb2RlKGdzLmdldFByb3BlcnR5KCdpbnN0YW5jZV9uYW1lJykpOw0KICAgICAgICAgICAgbGV0IF9fcmVzcG9uc2UgPSBuZXcgZXNwdGVzdC5jb20ubmFtbW91ci5kY29tLkV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK25ldyBEYXRlKG5ldyBHbGlkZURhdGVUaW1lKCkpLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpKyddLlRvb2wuZmluZEFsbCgpJykubWV0aG9kKCdmaW5kQWxsJykuY2xhc3NOYW1lKCdUb29sJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSk7DQoNCiAgICAgICAgICAgIGxldCBldkpTT04gPSBudWxsOw0KICAgICAgICAgICAgaWYoX19ldmVudCl7DQogICAgICAgICAgICAgICAgZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICAgICAgaWYodHlwZW9mKGV2SlNPTi5fX3RoaXMpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgICAgICB0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7DQogICAgICAgIA0KDQoNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIC8vX19yZXNwb25zZS5yZWNpcGllbnQobmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5Ob2RlKCkuY29kZSgncGFyZW50JykpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZihfX2V2ZW50ICYmICFfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQoNCiAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICBpZihfX2V2ZW50ICYmIF9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGFuc3dlciA9IFRvb2woKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKCFfX2V2ZW50KXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICANCg0KICAgICAgICAgICAgfQ0KDQoNCg0KDQogICAgICAgICAgICBpZighX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGlmKGFuc3dlcil7DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoe19fdGhpczogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICByZXR1cm4gYW5zd2VyOw0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIFRvb2wuZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGZpbmQoX19ldmVudCl7DQogICAgICAgICAgICBsZXQgX190b1N0cmluZyA9ICdUb29sLmZpbmQoKTogJzsNCg0KICAgICAgICAgICAgbGV0IGFuc3dlciA9IHVuZGVmaW5lZDsNCg0KICAgICAgICAgICAgdmFyIG5vZGUgPSBuZXcgZXNwdGVzdC5jb20ubmFtbW91ci5kY29tLk5vZGUoKS5jb2RlKGdzLmdldFByb3BlcnR5KCdpbnN0YW5jZV9uYW1lJykpOw0KICAgICAgICAgICAgbGV0IF9fcmVzcG9uc2UgPSBuZXcgZXNwdGVzdC5jb20ubmFtbW91ci5kY29tLkV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK25ldyBEYXRlKG5ldyBHbGlkZURhdGVUaW1lKCkpLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpKyddLlRvb2wuZmluZCgpJykubWV0aG9kKCdmaW5kJykuY2xhc3NOYW1lKCdUb29sJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSk7DQoNCiAgICAgICAgICAgIGxldCBldkpTT04gPSBudWxsOw0KICAgICAgICAgICAgaWYoX19ldmVudCl7DQogICAgICAgICAgICAgICAgZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICAgICAgaWYodHlwZW9mKGV2SlNPTi5fX3RoaXMpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgICAgICB0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7DQogICAgICAgIA0KDQoNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIC8vX19yZXNwb25zZS5yZWNpcGllbnQobmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5Ob2RlKCkuY29kZSgncGFyZW50JykpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZihfX2V2ZW50ICYmICFfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQoNCiAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICBpZihfX2V2ZW50ICYmIF9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGFuc3dlciA9IFRvb2woKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKCFfX2V2ZW50KXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICANCg0KICAgICAgICAgICAgfQ0KDQoNCg0KDQogICAgICAgICAgICBpZighX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGlmKGFuc3dlcil7DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoe19fdGhpczogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICByZXR1cm4gYW5zd2VyOw0KICAgICAgICB9DQogICAgDQogICAgfTsNCg0KICAgIGVzcHRlc3QuY29tID0gZXNwdGVzdC5jb20gfHwge307ZXNwdGVzdC5jb20ubmFtbW91ciA9IGVzcHRlc3QuY29tLm5hbW1vdXIgfHwge307ZXNwdGVzdC5jb20ubmFtbW91ci5kY29tID0gZXNwdGVzdC5jb20ubmFtbW91ci5kY29tIHx8IHt9Ow0KICAgIGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5Db25maWdfR3JvdXAgPSBjbGFzcyB7DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIENvbmZpZ19Hcm91cC5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBhY3RpdmUodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fYWN0aXZlID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9hY3RpdmU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogQ29uZmlnX0dyb3VwLmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBlbmFibGVkKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX2VuYWJsZWQgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2VuYWJsZWQ7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogQ29uZmlnX0dyb3VwLmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBjb2RlKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX2NvZGUgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2NvZGU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogQ29uZmlnX0dyb3VwLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgb3JkZXIodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fb3JkZXIgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX29yZGVyOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIENvbmZpZ19Hcm91cC5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgZGF0ZSh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9kYXRlID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9kYXRlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIENvbmZpZ19Hcm91cC5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgbmFtZSh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9uYW1lID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9uYW1lOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIENvbmZpZ19Hcm91cC5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICByZW1hcmsodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fcmVtYXJrID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9yZW1hcms7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICANCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogQ29uZmlnX0dyb3VwLmdyb3VwX0NvbmZpZ3MgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBncm91cF9Db25maWdzKHYpew0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIENvbmZpZ19Hcm91cC5ncm91cF9NYXBwaW5ncyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGdyb3VwX01hcHBpbmdzKHYpew0KICAgICAgICB9DQogICAgDQogICAgDQogICAgICAgIF9mcm9tRG9jdW1lbnQob2JqKXsNCiAgICAgICAgICAgIGxldCBfX3RvU3RyaW5nID0gJ0NvbmZpZ19Hcm91cC5fZnJvbURvY3VtZW50KCk6ICc7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGlmKCFvYmopIHJldHVybiB0aGlzOw0KDQogICAgICAgICAgICAvL2lmIGlzaW5zdGFuY2Uob2JqLCBieXRlcyk6IG9iaiA9IHN0cihvYmosICJ1dGYtOCIpOw0KDQogICAgICAgICAgICBpZih0eXBlb2Yob2JqKT09PSdzdHJpbmcnKXsNCiAgICAgICAgICAgICAgICBpZihuZXcgUmVnRXhwKCIoKChbQS1aYS16XXszLDl9Oig/Oi8vKT8pKD86Wy07OiY9KyQsd10rQCk/W0EtWmEtejAtOS4tXSt8KD86d3d3LnxbLTs6Jj0rJCx3XStAKVtBLVphLXowLTkuLV0rKSgoPzovWyt+JS8udy1fXSopPz8/KD86Wy0rPSY7JUAud19dKikjPyg/Olt3XSopKT8pIikudGVzdChvYmopKXsNCiAgICAgICAgICAgICAgICAgICAgbGV0IHJlcXVlc3QgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpOw0KICAgICAgICAgICAgICAgICAgICByZXF1ZXN0LnNldEh0dHBNZXRob2QoJ0dFVCcpOw0KICAgICAgICAgICAgICAgICAgICByZXF1ZXN0LnNldEVuZHBvaW50KG9iaik7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQocmVxdWVzdC5leGVjdXRlKCkuZ2V0Qm9keSgpKTsNCiAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChKU09OLnBhcnNlKG9iaikpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICBpZihBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pe3JldHVybiBuZXcgQ29uZmlnX0dyb3VwKCkuX2Zyb21Eb2N1bWVudChvKX0pOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBpZih0eXBlb2Yob2JqLklkKSE9PSd1bmRlZmluZWQnKSB0aGlzLklkID0gb2JqLklkOw0KDQogICAgDQogICAgICAgICAgICBpZih0eXBlb2Yob2JqLmFjdGl2ZSkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKG9iai5lbmFibGVkKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZihvYmouY29kZSkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5jb2RlKG9iai5jb2RlKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2Yob2JqLm9yZGVyKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLm9yZGVyKG9iai5vcmRlcik7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKG9iai5kYXRlKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLmRhdGUob2JqLmRhdGUpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICB0aGlzLmRhdGUobmV3IEdsaWRlRGF0ZVRpbWUodGhpcy5kYXRlKCkpKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2Yob2JqLm5hbWUpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMubmFtZShvYmoubmFtZSk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKG9iai5yZW1hcmspIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMucmVtYXJrKG9iai5yZW1hcmspOw0KICAgICAgICANCiAgICAgICAgICAgICAgICB0aGlzLnJlbWFyayhHbGlkZVN0cmluZ1V0aWwuYmFzZTY0RGVjb2RlKHRoaXMucmVtYXJrKCkpKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQoNCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZihvYmouZ3JvdXBfQ29uZmlncykhPT0ndW5kZWZpbmVkJykgdGhpcy5ncm91cF9Db25maWdzKG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uQ29uZmlnKCkuX2Zyb21Eb2N1bWVudChvYmouZ3JvdXBfZ3JvdXBfQ29uZmlncykpOw0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKG9iai5ncm91cF9NYXBwaW5ncykhPT0ndW5kZWZpbmVkJykgdGhpcy5ncm91cF9NYXBwaW5ncyhuZXcgZXNwdGVzdC5jb20ubmFtbW91ci5kY29tLk1hcHBpbmcoKS5fZnJvbURvY3VtZW50KG9iai5ncm91cF9ncm91cF9NYXBwaW5ncykpOw0KICAgIA0KDQogICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgfQ0KDQogICAgICAgIF90b0RvY3VtZW50KCl7DQogICAgICAgICAgICBsZXQgX190b1N0cmluZyA9ICdDb25maWdfR3JvdXAuX3RvRG9jdW1lbnQoKTogJzsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgbGV0IHJldCA9IHt9Ow0KICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMuSWQpIT09J3VuZGVmaW5lZCcpIHJldC5JZCA9IHRoaXMuSWQ7DQoNCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZih0aGlzLl9hY3RpdmUpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHJldC5hY3RpdmUgPSB0aGlzLmFjdGl2ZSgpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZih0aGlzLl9lbmFibGVkKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICByZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZih0aGlzLl9jb2RlKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICByZXQuY29kZSA9IHRoaXMuY29kZSgpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZih0aGlzLl9vcmRlcikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgcmV0Lm9yZGVyID0gdGhpcy5vcmRlcigpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZih0aGlzLl9kYXRlKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICByZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBpZihyZXQuZGF0ZSAmJiB0eXBlb2YocmV0LmRhdGUuZ2V0TnVtZXJpY1ZhbHVlKT09PSdmdW5jdGlvbicpIHJldC5kYXRlID0gbmV3IERhdGUocmV0LmRhdGUuZ2V0TnVtZXJpY1ZhbHVlKCkpLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZih0aGlzLl9uYW1lKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICByZXQubmFtZSA9IHRoaXMubmFtZSgpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZih0aGlzLl9yZW1hcmspIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHJldC5yZW1hcmsgPSB0aGlzLnJlbWFyaygpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBpZih0eXBlb2YocmV0LnJlbWFyaygpKT09PSdvYmplY3QnKSByZXQucmVtYXJrID0gR2xpZGVTdHJpbmdVdGlsLmJhc2U2NEVuY29kZShKU09OLnN0cmluZ2lmeShyZXQucmVtYXJrKSk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICANCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZih0aGlzLmdyb3VwX0NvbmZpZ3MoKSkhPT0ndW5kZWZpbmVkJykgcmV0Lmdyb3VwX0NvbmZpZ3MgPSBzZWxmLmdyb3VwX2dyb3VwX0NvbmZpZ3MoKS5tYXAoZnVuY3Rpb24odGEpe3JldHVybiB0YS5fdG9Eb2N1bWVudCgpO30pOw0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMuZ3JvdXBfTWFwcGluZ3MoKSkhPT0ndW5kZWZpbmVkJykgcmV0Lmdyb3VwX01hcHBpbmdzID0gc2VsZi5ncm91cF9ncm91cF9NYXBwaW5ncygpLm1hcChmdW5jdGlvbih0YSl7cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7fSk7DQogICAgDQogICAgICAgICAgICByZXR1cm4gcmV0Ow0KICAgICAgICB9DQoNCiAgICAgICAgX3VuaXF1ZSgpew0KICAgICAgICAgICAgbGV0IF9fdG9TdHJpbmcgPSAnQ29uZmlnX0dyb3VwLl91bmlxdWUoKTogJzsNCiAgICAgICAgDQogICAgICAgICAgICBsZXQgcmV0ID0gbmV3IHVuZGVmaW5lZCgpOw0KICAgICAgICAgICAgaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDsNCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZih0aGlzLmNvZGUoKSkhPT0ndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpOw0KICAgIA0KICAgICAgICAgICAgcmV0dXJuIHJldDsNCiAgICAgICAgfQ0KDQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIENvbmZpZ19Hcm91cC5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHN0b3JlKF9fZXZlbnQpew0KICAgICAgICAgICAgbGV0IF9fdG9TdHJpbmcgPSAnQ29uZmlnX0dyb3VwLnN0b3JlKCk6ICc7DQoNCiAgICAgICAgICAgIGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7DQoNCiAgICAgICAgICAgIHZhciBub2RlID0gbmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5Ob2RlKCkuY29kZShncy5nZXRQcm9wZXJ0eSgnaW5zdGFuY2VfbmFtZScpKTsNCiAgICAgICAgICAgIGxldCBfX3Jlc3BvbnNlID0gbmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5FdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytuZXcgRGF0ZShuZXcgR2xpZGVEYXRlVGltZSgpKS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKSsnXS5Db25maWdfR3JvdXAuc3RvcmUoKScpLm1ldGhvZCgnc3RvcmUnKS5jbGFzc05hbWUoJ0NvbmZpZ19Hcm91cCcpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpOw0KDQogICAgICAgICAgICBsZXQgZXZKU09OID0gbnVsbDsNCiAgICAgICAgICAgIGlmKF9fZXZlbnQpew0KICAgICAgICAgICAgICAgIGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgICAgIGlmKHR5cGVvZihldkpTT04uX190aGlzKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpOw0KICAgICAgICANCg0KDQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAvL19fcmVzcG9uc2UucmVjaXBpZW50KG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uTm9kZSgpLmNvZGUoJ3BhcmVudCcpKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoX19ldmVudCAmJiAhX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KDQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgaWYoX19ldmVudCAmJiBfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBhbnN3ZXIgPSBDb25maWdfR3JvdXAoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKCFfX2V2ZW50KXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBzdG9yZSBsb2NhbGx5DQogICAgICAgICAgICAgICAgbGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCdDb25maWdfR3JvdXAnKTsNCg0KICAgICAgICAgICAgICAgIGxldCBfdGhpcyA9IHRoaXMuX3VuaXF1ZSgpLmZpbmQoKTsNCiAgICAgICAgICAgICAgICBpZighX3RoaXMpIGdyLnNldE5ld0d1aWRWYWx1ZSh0aGlzLklkIHx8ICh0aGlzLklkID0gZ3Iuc2V0TmV3R3VpZCgpKSk7DQogICAgICAgICAgICAgICAgaWYoX3RoaXMgJiYgdHlwZW9mKF90aGlzLklkKSE9PSd1bmRlZmluZWQnKSBnci5nZXQoX3RoaXMuSWQpOw0KDQogICAgICAgICAgICAgICAgbGV0IGJTZXQgPSBmYWxzZTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgaWYoX3RoaXMgJiYgdHlwZW9mKF90aGlzLmdldGNvZGUoKSkhPT0ndW5kZWZpbmVkJykgYlNldCA9IGdyLnNldFZhbHVlKCdjb2RlJywgX3RoaXMuZ2V0Y29kZSgpKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgaWYoYlNldCl7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuSWQgPSBnci51cGRhdGUoKTsNCiAgICAgICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgInRoaXMuSWQgPSAiICsgdGhpcy5JZCk7DQogICAgICAgICAgICAgICAgICAgIGlmKCFhbnN3ZXIpIGFuc3dlciA9IHRoaXM7DQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJpbnZhbGlkIG9iamVjdCIpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICANCg0KICAgICAgICAgICAgfQ0KDQoNCg0KDQogICAgICAgICAgICBpZighX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGlmKGFuc3dlcil7DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoe19fdGhpczogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICByZXR1cm4gYW5zd2VyOw0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIENvbmZpZ19Hcm91cC5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgZmluZEFsbChfX2V2ZW50KXsNCiAgICAgICAgICAgIGxldCBfX3RvU3RyaW5nID0gJ0NvbmZpZ19Hcm91cC5maW5kQWxsKCk6ICc7DQoNCiAgICAgICAgICAgIGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7DQoNCiAgICAgICAgICAgIHZhciBub2RlID0gbmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5Ob2RlKCkuY29kZShncy5nZXRQcm9wZXJ0eSgnaW5zdGFuY2VfbmFtZScpKTsNCiAgICAgICAgICAgIGxldCBfX3Jlc3BvbnNlID0gbmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5FdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytuZXcgRGF0ZShuZXcgR2xpZGVEYXRlVGltZSgpKS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKSsnXS5Db25maWdfR3JvdXAuZmluZEFsbCgpJykubWV0aG9kKCdmaW5kQWxsJykuY2xhc3NOYW1lKCdDb25maWdfR3JvdXAnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKTsNCg0KICAgICAgICAgICAgbGV0IGV2SlNPTiA9IG51bGw7DQogICAgICAgICAgICBpZihfX2V2ZW50KXsNCiAgICAgICAgICAgICAgICBldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgICAgICBpZih0eXBlb2YoZXZKU09OLl9fdGhpcykhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTsNCiAgICAgICAgDQoNCg0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgLy9fX3Jlc3BvbnNlLnJlY2lwaWVudChuZXcgZXNwdGVzdC5jb20ubmFtbW91ci5kY29tLk5vZGUoKS5jb2RlKCdwYXJlbnQnKSk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKF9fZXZlbnQgJiYgIV9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCg0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgIGlmKF9fZXZlbnQgJiYgX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgYW5zd2VyID0gQ29uZmlnX0dyb3VwKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZighX19ldmVudCl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KDQoNCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBpZihhbnN3ZXIpew0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHtfX3RoaXM6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcmV0dXJuIGFuc3dlcjsNCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBDb25maWdfR3JvdXAuZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGZpbmQoX19ldmVudCl7DQogICAgICAgICAgICBsZXQgX190b1N0cmluZyA9ICdDb25maWdfR3JvdXAuZmluZCgpOiAnOw0KDQogICAgICAgICAgICBsZXQgYW5zd2VyID0gdW5kZWZpbmVkOw0KDQogICAgICAgICAgICB2YXIgbm9kZSA9IG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uTm9kZSgpLmNvZGUoZ3MuZ2V0UHJvcGVydHkoJ2luc3RhbmNlX25hbWUnKSk7DQogICAgICAgICAgICBsZXQgX19yZXNwb25zZSA9IG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrbmV3IERhdGUobmV3IEdsaWRlRGF0ZVRpbWUoKSkudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJykrJ10uQ29uZmlnX0dyb3VwLmZpbmQoKScpLm1ldGhvZCgnZmluZCcpLmNsYXNzTmFtZSgnQ29uZmlnX0dyb3VwJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSk7DQoNCiAgICAgICAgICAgIGxldCBldkpTT04gPSBudWxsOw0KICAgICAgICAgICAgaWYoX19ldmVudCl7DQogICAgICAgICAgICAgICAgZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICAgICAgaWYodHlwZW9mKGV2SlNPTi5fX3RoaXMpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgICAgICB0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7DQogICAgICAgIA0KDQoNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIC8vX19yZXNwb25zZS5yZWNpcGllbnQobmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5Ob2RlKCkuY29kZSgncGFyZW50JykpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZihfX2V2ZW50ICYmICFfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQoNCiAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICBpZihfX2V2ZW50ICYmIF9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGFuc3dlciA9IENvbmZpZ19Hcm91cCgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIA0KDQogICAgICAgICAgICB9DQoNCg0KDQoNCiAgICAgICAgICAgIGlmKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgaWYoYW5zd2VyKXsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7X190aGlzOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHJldHVybiBhbnN3ZXI7DQogICAgICAgIH0NCiAgICANCiAgICB9Ow0KDQogICAgZXNwdGVzdC5jb20gPSBlc3B0ZXN0LmNvbSB8fCB7fTtlc3B0ZXN0LmNvbS5uYW1tb3VyID0gZXNwdGVzdC5jb20ubmFtbW91ciB8fCB7fTtlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20gPSBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20gfHwge307DQogICAgZXNwdGVzdC5jb20ubmFtbW91ci5kY29tLk1hcHBpbmdfR3JvdXAgPSBjbGFzcyB7DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE1hcHBpbmdfR3JvdXAuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgYWN0aXZlKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX2FjdGl2ZSA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fYWN0aXZlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE1hcHBpbmdfR3JvdXAuZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGVuYWJsZWQodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fZW5hYmxlZCA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZW5hYmxlZDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBNYXBwaW5nX0dyb3VwLmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBjb2RlKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX2NvZGUgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2NvZGU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTWFwcGluZ19Hcm91cC5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIG9yZGVyKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX29yZGVyID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9vcmRlcjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBNYXBwaW5nX0dyb3VwLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBkYXRlKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX2RhdGUgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2RhdGU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTWFwcGluZ19Hcm91cC5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgbmFtZSh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9uYW1lID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9uYW1lOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE1hcHBpbmdfR3JvdXAucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgcmVtYXJrKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX3JlbWFyayA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fcmVtYXJrOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgDQogICAgDQogICAgDQogICAgICAgIF9mcm9tRG9jdW1lbnQob2JqKXsNCiAgICAgICAgICAgIGxldCBfX3RvU3RyaW5nID0gJ01hcHBpbmdfR3JvdXAuX2Zyb21Eb2N1bWVudCgpOiAnOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBpZighb2JqKSByZXR1cm4gdGhpczsNCg0KICAgICAgICAgICAgLy9pZiBpc2luc3RhbmNlKG9iaiwgYnl0ZXMpOiBvYmogPSBzdHIob2JqLCAidXRmLTgiKTsNCg0KICAgICAgICAgICAgaWYodHlwZW9mKG9iaik9PT0nc3RyaW5nJyl7DQogICAgICAgICAgICAgICAgaWYobmV3IFJlZ0V4cCgiKCgoW0EtWmEtel17Myw5fTooPzovLyk/KSg/OlstOzomPSskLHddK0ApP1tBLVphLXowLTkuLV0rfCg/Ond3dy58Wy07OiY9KyQsd10rQClbQS1aYS16MC05Li1dKykoKD86L1srfiUvLnctX10qKT8/Pyg/OlstKz0mOyVALndfXSopIz8oPzpbd10qKSk/KSIpLnRlc3Qob2JqKSl7DQogICAgICAgICAgICAgICAgICAgIGxldCByZXF1ZXN0ID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTsNCiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdC5zZXRIdHRwTWV0aG9kKCdHRVQnKTsNCiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdC5zZXRFbmRwb2ludChvYmopOw0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHJlcXVlc3QuZXhlY3V0ZSgpLmdldEJvZHkoKSk7DQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoSlNPTi5wYXJzZShvYmopKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgaWYoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKXtyZXR1cm4gbmV3IE1hcHBpbmdfR3JvdXAoKS5fZnJvbURvY3VtZW50KG8pfSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZihvYmouSWQpIT09J3VuZGVmaW5lZCcpIHRoaXMuSWQgPSBvYmouSWQ7DQoNCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZihvYmouYWN0aXZlKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2Yob2JqLmVuYWJsZWQpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKG9iai5jb2RlKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLmNvZGUob2JqLmNvZGUpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZihvYmoub3JkZXIpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMub3JkZXIob2JqLm9yZGVyKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2Yob2JqLmRhdGUpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuZGF0ZShvYmouZGF0ZSk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIHRoaXMuZGF0ZShuZXcgR2xpZGVEYXRlVGltZSh0aGlzLmRhdGUoKSkpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZihvYmoubmFtZSkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5uYW1lKG9iai5uYW1lKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2Yob2JqLnJlbWFyaykhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5yZW1hcmsob2JqLnJlbWFyayk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIHRoaXMucmVtYXJrKEdsaWRlU3RyaW5nVXRpbC5iYXNlNjREZWNvZGUodGhpcy5yZW1hcmsoKSkpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCg0KICAgIA0KDQogICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgfQ0KDQogICAgICAgIF90b0RvY3VtZW50KCl7DQogICAgICAgICAgICBsZXQgX190b1N0cmluZyA9ICdNYXBwaW5nX0dyb3VwLl90b0RvY3VtZW50KCk6ICc7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGxldCByZXQgPSB7fTsNCiAgICAgICAgICAgIGlmKHR5cGVvZih0aGlzLklkKSE9PSd1bmRlZmluZWQnKSByZXQuSWQgPSB0aGlzLklkOw0KDQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5fYWN0aXZlKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICByZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5fZW5hYmxlZCkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgcmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5fY29kZSkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgcmV0LmNvZGUgPSB0aGlzLmNvZGUoKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5fb3JkZXIpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5fZGF0ZSkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgcmV0LmRhdGUgPSB0aGlzLmRhdGUoKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgaWYocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLmdldE51bWVyaWNWYWx1ZSk9PT0nZnVuY3Rpb24nKSByZXQuZGF0ZSA9IG5ldyBEYXRlKHJldC5kYXRlLmdldE51bWVyaWNWYWx1ZSgpKS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5fbmFtZSkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgcmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5fcmVtYXJrKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICByZXQucmVtYXJrID0gdGhpcy5yZW1hcmsoKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgaWYodHlwZW9mKHJldC5yZW1hcmsoKSk9PT0nb2JqZWN0JykgcmV0LnJlbWFyayA9IEdsaWRlU3RyaW5nVXRpbC5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgDQogICAgDQogICAgICAgICAgICByZXR1cm4gcmV0Ow0KICAgICAgICB9DQoNCiAgICAgICAgX3VuaXF1ZSgpew0KICAgICAgICAgICAgbGV0IF9fdG9TdHJpbmcgPSAnTWFwcGluZ19Hcm91cC5fdW5pcXVlKCk6ICc7DQogICAgICAgIA0KICAgICAgICAgICAgbGV0IHJldCA9IG5ldyB1bmRlZmluZWQoKTsNCiAgICAgICAgICAgIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5jb2RlKCkpIT09J3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTsNCiAgICANCiAgICAgICAgICAgIHJldHVybiByZXQ7DQogICAgICAgIH0NCg0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBNYXBwaW5nX0dyb3VwLnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgc3RvcmUoX19ldmVudCl7DQogICAgICAgICAgICBsZXQgX190b1N0cmluZyA9ICdNYXBwaW5nX0dyb3VwLnN0b3JlKCk6ICc7DQoNCiAgICAgICAgICAgIGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7DQoNCiAgICAgICAgICAgIHZhciBub2RlID0gbmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5Ob2RlKCkuY29kZShncy5nZXRQcm9wZXJ0eSgnaW5zdGFuY2VfbmFtZScpKTsNCiAgICAgICAgICAgIGxldCBfX3Jlc3BvbnNlID0gbmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5FdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytuZXcgRGF0ZShuZXcgR2xpZGVEYXRlVGltZSgpKS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKSsnXS5NYXBwaW5nX0dyb3VwLnN0b3JlKCknKS5tZXRob2QoJ3N0b3JlJykuY2xhc3NOYW1lKCdNYXBwaW5nX0dyb3VwJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSk7DQoNCiAgICAgICAgICAgIGxldCBldkpTT04gPSBudWxsOw0KICAgICAgICAgICAgaWYoX19ldmVudCl7DQogICAgICAgICAgICAgICAgZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICAgICAgaWYodHlwZW9mKGV2SlNPTi5fX3RoaXMpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgICAgICB0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7DQogICAgICAgIA0KDQoNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIC8vX19yZXNwb25zZS5yZWNpcGllbnQobmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5Ob2RlKCkuY29kZSgncGFyZW50JykpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZihfX2V2ZW50ICYmICFfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQoNCiAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICBpZihfX2V2ZW50ICYmIF9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGFuc3dlciA9IE1hcHBpbmdfR3JvdXAoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKCFfX2V2ZW50KXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBzdG9yZSBsb2NhbGx5DQogICAgICAgICAgICAgICAgbGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCdNYXBwaW5nX0dyb3VwJyk7DQoNCiAgICAgICAgICAgICAgICBsZXQgX3RoaXMgPSB0aGlzLl91bmlxdWUoKS5maW5kKCk7DQogICAgICAgICAgICAgICAgaWYoIV90aGlzKSBnci5zZXROZXdHdWlkVmFsdWUodGhpcy5JZCB8fCAodGhpcy5JZCA9IGdyLnNldE5ld0d1aWQoKSkpOw0KICAgICAgICAgICAgICAgIGlmKF90aGlzICYmIHR5cGVvZihfdGhpcy5JZCkhPT0ndW5kZWZpbmVkJykgZ3IuZ2V0KF90aGlzLklkKTsNCg0KICAgICAgICAgICAgICAgIGxldCBiU2V0ID0gZmFsc2U7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGlmKF90aGlzICYmIHR5cGVvZihfdGhpcy5nZXRjb2RlKCkpIT09J3VuZGVmaW5lZCcpIGJTZXQgPSBnci5zZXRWYWx1ZSgnY29kZScsIF90aGlzLmdldGNvZGUoKSk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGlmKGJTZXQpew0KICAgICAgICAgICAgICAgICAgICB0aGlzLklkID0gZ3IudXBkYXRlKCk7DQogICAgICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJ0aGlzLklkID0gIiArIHRoaXMuSWQpOw0KICAgICAgICAgICAgICAgICAgICBpZighYW5zd2VyKSBhbnN3ZXIgPSB0aGlzOw0KICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiaW52YWxpZCBvYmplY3QiKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KDQoNCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBpZihhbnN3ZXIpew0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHtfX3RoaXM6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcmV0dXJuIGFuc3dlcjsNCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBNYXBwaW5nX0dyb3VwLmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBmaW5kQWxsKF9fZXZlbnQpew0KICAgICAgICAgICAgbGV0IF9fdG9TdHJpbmcgPSAnTWFwcGluZ19Hcm91cC5maW5kQWxsKCk6ICc7DQoNCiAgICAgICAgICAgIGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7DQoNCiAgICAgICAgICAgIHZhciBub2RlID0gbmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5Ob2RlKCkuY29kZShncy5nZXRQcm9wZXJ0eSgnaW5zdGFuY2VfbmFtZScpKTsNCiAgICAgICAgICAgIGxldCBfX3Jlc3BvbnNlID0gbmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5FdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytuZXcgRGF0ZShuZXcgR2xpZGVEYXRlVGltZSgpKS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKSsnXS5NYXBwaW5nX0dyb3VwLmZpbmRBbGwoKScpLm1ldGhvZCgnZmluZEFsbCcpLmNsYXNzTmFtZSgnTWFwcGluZ19Hcm91cCcpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpOw0KDQogICAgICAgICAgICBsZXQgZXZKU09OID0gbnVsbDsNCiAgICAgICAgICAgIGlmKF9fZXZlbnQpew0KICAgICAgICAgICAgICAgIGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgICAgIGlmKHR5cGVvZihldkpTT04uX190aGlzKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpOw0KICAgICAgICANCg0KDQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAvL19fcmVzcG9uc2UucmVjaXBpZW50KG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uTm9kZSgpLmNvZGUoJ3BhcmVudCcpKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoX19ldmVudCAmJiAhX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KDQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgaWYoX19ldmVudCAmJiBfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBhbnN3ZXIgPSBNYXBwaW5nX0dyb3VwKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZighX19ldmVudCl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KDQoNCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBpZihhbnN3ZXIpew0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHtfX3RoaXM6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcmV0dXJuIGFuc3dlcjsNCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBNYXBwaW5nX0dyb3VwLmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBmaW5kKF9fZXZlbnQpew0KICAgICAgICAgICAgbGV0IF9fdG9TdHJpbmcgPSAnTWFwcGluZ19Hcm91cC5maW5kKCk6ICc7DQoNCiAgICAgICAgICAgIGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7DQoNCiAgICAgICAgICAgIHZhciBub2RlID0gbmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5Ob2RlKCkuY29kZShncy5nZXRQcm9wZXJ0eSgnaW5zdGFuY2VfbmFtZScpKTsNCiAgICAgICAgICAgIGxldCBfX3Jlc3BvbnNlID0gbmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5FdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytuZXcgRGF0ZShuZXcgR2xpZGVEYXRlVGltZSgpKS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKSsnXS5NYXBwaW5nX0dyb3VwLmZpbmQoKScpLm1ldGhvZCgnZmluZCcpLmNsYXNzTmFtZSgnTWFwcGluZ19Hcm91cCcpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpOw0KDQogICAgICAgICAgICBsZXQgZXZKU09OID0gbnVsbDsNCiAgICAgICAgICAgIGlmKF9fZXZlbnQpew0KICAgICAgICAgICAgICAgIGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgICAgIGlmKHR5cGVvZihldkpTT04uX190aGlzKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpOw0KICAgICAgICANCg0KDQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAvL19fcmVzcG9uc2UucmVjaXBpZW50KG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uTm9kZSgpLmNvZGUoJ3BhcmVudCcpKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoX19ldmVudCAmJiAhX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KDQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgaWYoX19ldmVudCAmJiBfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBhbnN3ZXIgPSBNYXBwaW5nX0dyb3VwKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZighX19ldmVudCl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KDQoNCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBpZihhbnN3ZXIpew0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHtfX3RoaXM6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcmV0dXJuIGFuc3dlcjsNCiAgICAgICAgfQ0KICAgIA0KICAgIH07DQoNCiAgICBlc3B0ZXN0LmNvbSA9IGVzcHRlc3QuY29tIHx8IHt9O2VzcHRlc3QuY29tLm5hbW1vdXIgPSBlc3B0ZXN0LmNvbS5uYW1tb3VyIHx8IHt9O2VzcHRlc3QuY29tLm5hbW1vdXIuZGNvbSA9IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbSB8fCB7fTsNCiAgICBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uVG9vbF9UeXBlID0gY2xhc3Mgew0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBUb29sX1R5cGUuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgYWN0aXZlKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX2FjdGl2ZSA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fYWN0aXZlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIFRvb2xfVHlwZS5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgZW5hYmxlZCh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9lbmFibGVkID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9lbmFibGVkOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIFRvb2xfVHlwZS5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgY29kZSh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9jb2RlID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9jb2RlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIFRvb2xfVHlwZS5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIG9yZGVyKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX29yZGVyID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9vcmRlcjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBUb29sX1R5cGUuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGRhdGUodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fZGF0ZSA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZGF0ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBUb29sX1R5cGUubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIG5hbWUodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fbmFtZSA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fbmFtZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBUb29sX1R5cGUucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgcmVtYXJrKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX3JlbWFyayA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fcmVtYXJrOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgDQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIFRvb2xfVHlwZS50eXBlX0NvbmZpZ3MgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICB0eXBlX0NvbmZpZ3Modil7DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogVG9vbF9UeXBlLnR5cGVfVG9vbHMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICB0eXBlX1Rvb2xzKHYpew0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIFRvb2xfVHlwZS50eXBlX01hcHBpbmdzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgdHlwZV9NYXBwaW5ncyh2KXsNCiAgICAgICAgfQ0KICAgIA0KICAgIA0KICAgICAgICBfZnJvbURvY3VtZW50KG9iail7DQogICAgICAgICAgICBsZXQgX190b1N0cmluZyA9ICdUb29sX1R5cGUuX2Zyb21Eb2N1bWVudCgpOiAnOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBpZighb2JqKSByZXR1cm4gdGhpczsNCg0KICAgICAgICAgICAgLy9pZiBpc2luc3RhbmNlKG9iaiwgYnl0ZXMpOiBvYmogPSBzdHIob2JqLCAidXRmLTgiKTsNCg0KICAgICAgICAgICAgaWYodHlwZW9mKG9iaik9PT0nc3RyaW5nJyl7DQogICAgICAgICAgICAgICAgaWYobmV3IFJlZ0V4cCgiKCgoW0EtWmEtel17Myw5fTooPzovLyk/KSg/OlstOzomPSskLHddK0ApP1tBLVphLXowLTkuLV0rfCg/Ond3dy58Wy07OiY9KyQsd10rQClbQS1aYS16MC05Li1dKykoKD86L1srfiUvLnctX10qKT8/Pyg/OlstKz0mOyVALndfXSopIz8oPzpbd10qKSk/KSIpLnRlc3Qob2JqKSl7DQogICAgICAgICAgICAgICAgICAgIGxldCByZXF1ZXN0ID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTsNCiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdC5zZXRIdHRwTWV0aG9kKCdHRVQnKTsNCiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdC5zZXRFbmRwb2ludChvYmopOw0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHJlcXVlc3QuZXhlY3V0ZSgpLmdldEJvZHkoKSk7DQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoSlNPTi5wYXJzZShvYmopKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgaWYoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKXtyZXR1cm4gbmV3IFRvb2xfVHlwZSgpLl9mcm9tRG9jdW1lbnQobyl9KTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKG9iai5JZCkhPT0ndW5kZWZpbmVkJykgdGhpcy5JZCA9IG9iai5JZDsNCg0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKG9iai5hY3RpdmUpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZihvYmouZW5hYmxlZCkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2Yob2JqLmNvZGUpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuY29kZShvYmouY29kZSk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKG9iai5vcmRlcikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5vcmRlcihvYmoub3JkZXIpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZihvYmouZGF0ZSkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5kYXRlKG9iai5kYXRlKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgdGhpcy5kYXRlKG5ldyBHbGlkZURhdGVUaW1lKHRoaXMuZGF0ZSgpKSk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKG9iai5uYW1lKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLm5hbWUob2JqLm5hbWUpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZihvYmoucmVtYXJrKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLnJlbWFyayhvYmoucmVtYXJrKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgdGhpcy5yZW1hcmsoR2xpZGVTdHJpbmdVdGlsLmJhc2U2NERlY29kZSh0aGlzLnJlbWFyaygpKSk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KDQogICAgDQogICAgICAgICAgICBpZih0eXBlb2Yob2JqLnR5cGVfQ29uZmlncykhPT0ndW5kZWZpbmVkJykgdGhpcy50eXBlX0NvbmZpZ3MobmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5Db25maWcoKS5fZnJvbURvY3VtZW50KG9iai50eXBlX3R5cGVfQ29uZmlncykpOw0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKG9iai50eXBlX1Rvb2xzKSE9PSd1bmRlZmluZWQnKSB0aGlzLnR5cGVfVG9vbHMobmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5Ub29sKCkuX2Zyb21Eb2N1bWVudChvYmoudHlwZV90eXBlX1Rvb2xzKSk7DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2Yob2JqLnR5cGVfTWFwcGluZ3MpIT09J3VuZGVmaW5lZCcpIHRoaXMudHlwZV9NYXBwaW5ncyhuZXcgZXNwdGVzdC5jb20ubmFtbW91ci5kY29tLk1hcHBpbmcoKS5fZnJvbURvY3VtZW50KG9iai50eXBlX3R5cGVfTWFwcGluZ3MpKTsNCiAgICANCg0KICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgIH0NCg0KICAgICAgICBfdG9Eb2N1bWVudCgpew0KICAgICAgICAgICAgbGV0IF9fdG9TdHJpbmcgPSAnVG9vbF9UeXBlLl90b0RvY3VtZW50KCk6ICc7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGxldCByZXQgPSB7fTsNCiAgICAgICAgICAgIGlmKHR5cGVvZih0aGlzLklkKSE9PSd1bmRlZmluZWQnKSByZXQuSWQgPSB0aGlzLklkOw0KDQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5fYWN0aXZlKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICByZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5fZW5hYmxlZCkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgcmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5fY29kZSkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgcmV0LmNvZGUgPSB0aGlzLmNvZGUoKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5fb3JkZXIpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5fZGF0ZSkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgcmV0LmRhdGUgPSB0aGlzLmRhdGUoKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgaWYocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLmdldE51bWVyaWNWYWx1ZSk9PT0nZnVuY3Rpb24nKSByZXQuZGF0ZSA9IG5ldyBEYXRlKHJldC5kYXRlLmdldE51bWVyaWNWYWx1ZSgpKS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5fbmFtZSkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgcmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5fcmVtYXJrKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICByZXQucmVtYXJrID0gdGhpcy5yZW1hcmsoKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgaWYodHlwZW9mKHJldC5yZW1hcmsoKSk9PT0nb2JqZWN0JykgcmV0LnJlbWFyayA9IEdsaWRlU3RyaW5nVXRpbC5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgDQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy50eXBlX0NvbmZpZ3MoKSkhPT0ndW5kZWZpbmVkJykgcmV0LnR5cGVfQ29uZmlncyA9IHNlbGYudHlwZV90eXBlX0NvbmZpZ3MoKS5tYXAoZnVuY3Rpb24odGEpe3JldHVybiB0YS5fdG9Eb2N1bWVudCgpO30pOw0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMudHlwZV9Ub29scygpKSE9PSd1bmRlZmluZWQnKSByZXQudHlwZV9Ub29scyA9IHNlbGYudHlwZV90eXBlX1Rvb2xzKCkubWFwKGZ1bmN0aW9uKHRhKXtyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTt9KTsNCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZih0aGlzLnR5cGVfTWFwcGluZ3MoKSkhPT0ndW5kZWZpbmVkJykgcmV0LnR5cGVfTWFwcGluZ3MgPSBzZWxmLnR5cGVfdHlwZV9NYXBwaW5ncygpLm1hcChmdW5jdGlvbih0YSl7cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7fSk7DQogICAgDQogICAgICAgICAgICByZXR1cm4gcmV0Ow0KICAgICAgICB9DQoNCiAgICAgICAgX3VuaXF1ZSgpew0KICAgICAgICAgICAgbGV0IF9fdG9TdHJpbmcgPSAnVG9vbF9UeXBlLl91bmlxdWUoKTogJzsNCiAgICAgICAgDQogICAgICAgICAgICBsZXQgcmV0ID0gbmV3IHVuZGVmaW5lZCgpOw0KICAgICAgICAgICAgaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDsNCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZih0aGlzLm5hbWUoKSkhPT0ndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpOw0KICAgIA0KICAgICAgICAgICAgcmV0dXJuIHJldDsNCiAgICAgICAgfQ0KDQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIFRvb2xfVHlwZS5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHN0b3JlKF9fZXZlbnQpew0KICAgICAgICAgICAgbGV0IF9fdG9TdHJpbmcgPSAnVG9vbF9UeXBlLnN0b3JlKCk6ICc7DQoNCiAgICAgICAgICAgIGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7DQoNCiAgICAgICAgICAgIHZhciBub2RlID0gbmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5Ob2RlKCkuY29kZShncy5nZXRQcm9wZXJ0eSgnaW5zdGFuY2VfbmFtZScpKTsNCiAgICAgICAgICAgIGxldCBfX3Jlc3BvbnNlID0gbmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5FdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytuZXcgRGF0ZShuZXcgR2xpZGVEYXRlVGltZSgpKS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKSsnXS5Ub29sX1R5cGUuc3RvcmUoKScpLm1ldGhvZCgnc3RvcmUnKS5jbGFzc05hbWUoJ1Rvb2xfVHlwZScpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpOw0KDQogICAgICAgICAgICBsZXQgZXZKU09OID0gbnVsbDsNCiAgICAgICAgICAgIGlmKF9fZXZlbnQpew0KICAgICAgICAgICAgICAgIGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgICAgIGlmKHR5cGVvZihldkpTT04uX190aGlzKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpOw0KICAgICAgICANCg0KDQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAvL19fcmVzcG9uc2UucmVjaXBpZW50KG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uTm9kZSgpLmNvZGUoJ3BhcmVudCcpKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoX19ldmVudCAmJiAhX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KDQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgaWYoX19ldmVudCAmJiBfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBhbnN3ZXIgPSBUb29sX1R5cGUoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKCFfX2V2ZW50KXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBzdG9yZSBsb2NhbGx5DQogICAgICAgICAgICAgICAgbGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCdUb29sX1R5cGUnKTsNCg0KICAgICAgICAgICAgICAgIGxldCBfdGhpcyA9IHRoaXMuX3VuaXF1ZSgpLmZpbmQoKTsNCiAgICAgICAgICAgICAgICBpZighX3RoaXMpIGdyLnNldE5ld0d1aWRWYWx1ZSh0aGlzLklkIHx8ICh0aGlzLklkID0gZ3Iuc2V0TmV3R3VpZCgpKSk7DQogICAgICAgICAgICAgICAgaWYoX3RoaXMgJiYgdHlwZW9mKF90aGlzLklkKSE9PSd1bmRlZmluZWQnKSBnci5nZXQoX3RoaXMuSWQpOw0KDQogICAgICAgICAgICAgICAgbGV0IGJTZXQgPSBmYWxzZTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgaWYoX3RoaXMgJiYgdHlwZW9mKF90aGlzLmdldG5hbWUoKSkhPT0ndW5kZWZpbmVkJykgYlNldCA9IGdyLnNldFZhbHVlKCduYW1lJywgX3RoaXMuZ2V0bmFtZSgpKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgaWYoYlNldCl7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuSWQgPSBnci51cGRhdGUoKTsNCiAgICAgICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgInRoaXMuSWQgPSAiICsgdGhpcy5JZCk7DQogICAgICAgICAgICAgICAgICAgIGlmKCFhbnN3ZXIpIGFuc3dlciA9IHRoaXM7DQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJpbnZhbGlkIG9iamVjdCIpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICANCg0KICAgICAgICAgICAgfQ0KDQoNCg0KDQogICAgICAgICAgICBpZighX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGlmKGFuc3dlcil7DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoe19fdGhpczogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICByZXR1cm4gYW5zd2VyOw0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIFRvb2xfVHlwZS5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgZmluZEFsbChfX2V2ZW50KXsNCiAgICAgICAgICAgIGxldCBfX3RvU3RyaW5nID0gJ1Rvb2xfVHlwZS5maW5kQWxsKCk6ICc7DQoNCiAgICAgICAgICAgIGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7DQoNCiAgICAgICAgICAgIHZhciBub2RlID0gbmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5Ob2RlKCkuY29kZShncy5nZXRQcm9wZXJ0eSgnaW5zdGFuY2VfbmFtZScpKTsNCiAgICAgICAgICAgIGxldCBfX3Jlc3BvbnNlID0gbmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5FdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytuZXcgRGF0ZShuZXcgR2xpZGVEYXRlVGltZSgpKS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKSsnXS5Ub29sX1R5cGUuZmluZEFsbCgpJykubWV0aG9kKCdmaW5kQWxsJykuY2xhc3NOYW1lKCdUb29sX1R5cGUnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKTsNCg0KICAgICAgICAgICAgbGV0IGV2SlNPTiA9IG51bGw7DQogICAgICAgICAgICBpZihfX2V2ZW50KXsNCiAgICAgICAgICAgICAgICBldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgICAgICBpZih0eXBlb2YoZXZKU09OLl9fdGhpcykhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTsNCiAgICAgICAgDQoNCg0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgLy9fX3Jlc3BvbnNlLnJlY2lwaWVudChuZXcgZXNwdGVzdC5jb20ubmFtbW91ci5kY29tLk5vZGUoKS5jb2RlKCdwYXJlbnQnKSk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKF9fZXZlbnQgJiYgIV9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCg0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgIGlmKF9fZXZlbnQgJiYgX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgYW5zd2VyID0gVG9vbF9UeXBlKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZighX19ldmVudCl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KDQoNCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBpZihhbnN3ZXIpew0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHtfX3RoaXM6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcmV0dXJuIGFuc3dlcjsNCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBUb29sX1R5cGUuZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGZpbmQoX19ldmVudCl7DQogICAgICAgICAgICBsZXQgX190b1N0cmluZyA9ICdUb29sX1R5cGUuZmluZCgpOiAnOw0KDQogICAgICAgICAgICBsZXQgYW5zd2VyID0gdW5kZWZpbmVkOw0KDQogICAgICAgICAgICB2YXIgbm9kZSA9IG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uTm9kZSgpLmNvZGUoZ3MuZ2V0UHJvcGVydHkoJ2luc3RhbmNlX25hbWUnKSk7DQogICAgICAgICAgICBsZXQgX19yZXNwb25zZSA9IG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrbmV3IERhdGUobmV3IEdsaWRlRGF0ZVRpbWUoKSkudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJykrJ10uVG9vbF9UeXBlLmZpbmQoKScpLm1ldGhvZCgnZmluZCcpLmNsYXNzTmFtZSgnVG9vbF9UeXBlJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSk7DQoNCiAgICAgICAgICAgIGxldCBldkpTT04gPSBudWxsOw0KICAgICAgICAgICAgaWYoX19ldmVudCl7DQogICAgICAgICAgICAgICAgZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICAgICAgaWYodHlwZW9mKGV2SlNPTi5fX3RoaXMpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgICAgICB0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7DQogICAgICAgIA0KDQoNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIC8vX19yZXNwb25zZS5yZWNpcGllbnQobmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5Ob2RlKCkuY29kZSgncGFyZW50JykpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZihfX2V2ZW50ICYmICFfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQoNCiAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICBpZihfX2V2ZW50ICYmIF9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGFuc3dlciA9IFRvb2xfVHlwZSgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIA0KDQogICAgICAgICAgICB9DQoNCg0KDQoNCiAgICAgICAgICAgIGlmKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgaWYoYW5zd2VyKXsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7X190aGlzOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHJldHVybiBhbnN3ZXI7DQogICAgICAgIH0NCiAgICANCiAgICB9Ow0KDQogICAgZXNwdGVzdC5jb20gPSBlc3B0ZXN0LmNvbSB8fCB7fTtlc3B0ZXN0LmNvbS5uYW1tb3VyID0gZXNwdGVzdC5jb20ubmFtbW91ciB8fCB7fTtlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20gPSBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20gfHwge307DQogICAgZXNwdGVzdC5jb20ubmFtbW91ci5kY29tLkV2ZW50ID0gY2xhc3Mgew0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBFdmVudC5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBhY3RpdmUodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fYWN0aXZlID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9hY3RpdmU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogRXZlbnQuZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGVuYWJsZWQodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fZW5hYmxlZCA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZW5hYmxlZDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBFdmVudC5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgY29kZSh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9jb2RlID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9jb2RlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIEV2ZW50Lm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgb3JkZXIodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fb3JkZXIgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX29yZGVyOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIEV2ZW50LmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBkYXRlKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX2RhdGUgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2RhdGU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogRXZlbnQubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIG5hbWUodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fbmFtZSA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fbmFtZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBFdmVudC5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICByZW1hcmsodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fcmVtYXJrID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9yZW1hcms7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogRXZlbnQuY2xhc3NOYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgY2xhc3NOYW1lKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX2NsYXNzTmFtZSA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fY2xhc3NOYW1lOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIEV2ZW50Lm1ldGhvZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIG1ldGhvZCh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9tZXRob2QgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX21ldGhvZDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBFdmVudC5wYXlsb2FkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgcGF5bG9hZCh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9wYXlsb2FkID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9wYXlsb2FkOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIEV2ZW50LmNhcnJpZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBjYXJyaWVyKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX2NhcnJpZXIgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2NhcnJpZXI7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogRXZlbnQuc2VuZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgc2VuZGVyKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX3NlbmRlciA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fc2VuZGVyOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIEV2ZW50LnJlY2lwaWVudCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHJlY2lwaWVudCh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9yZWNpcGllbnQgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3JlY2lwaWVudDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBFdmVudC5yZXNwb25zZVRvIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgcmVzcG9uc2VUbyh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9yZXNwb25zZVRvID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9yZXNwb25zZVRvOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgDQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIEV2ZW50LnJlc3BvbnNlVG9fRXZlbnRzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgcmVzcG9uc2VUb19FdmVudHModil7DQogICAgICAgIH0NCiAgICANCiAgICANCiAgICAgICAgX2Zyb21Eb2N1bWVudChvYmopew0KICAgICAgICAgICAgbGV0IF9fdG9TdHJpbmcgPSAnRXZlbnQuX2Zyb21Eb2N1bWVudCgpOiAnOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBpZighb2JqKSByZXR1cm4gdGhpczsNCg0KICAgICAgICAgICAgLy9pZiBpc2luc3RhbmNlKG9iaiwgYnl0ZXMpOiBvYmogPSBzdHIob2JqLCAidXRmLTgiKTsNCg0KICAgICAgICAgICAgaWYodHlwZW9mKG9iaik9PT0nc3RyaW5nJyl7DQogICAgICAgICAgICAgICAgaWYobmV3IFJlZ0V4cCgiKCgoW0EtWmEtel17Myw5fTooPzovLyk/KSg/OlstOzomPSskLHddK0ApP1tBLVphLXowLTkuLV0rfCg/Ond3dy58Wy07OiY9KyQsd10rQClbQS1aYS16MC05Li1dKykoKD86L1srfiUvLnctX10qKT8/Pyg/OlstKz0mOyVALndfXSopIz8oPzpbd10qKSk/KSIpLnRlc3Qob2JqKSl7DQogICAgICAgICAgICAgICAgICAgIGxldCByZXF1ZXN0ID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTsNCiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdC5zZXRIdHRwTWV0aG9kKCdHRVQnKTsNCiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdC5zZXRFbmRwb2ludChvYmopOw0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHJlcXVlc3QuZXhlY3V0ZSgpLmdldEJvZHkoKSk7DQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoSlNPTi5wYXJzZShvYmopKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgaWYoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKXtyZXR1cm4gbmV3IEV2ZW50KCkuX2Zyb21Eb2N1bWVudChvKX0pOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBpZih0eXBlb2Yob2JqLklkKSE9PSd1bmRlZmluZWQnKSB0aGlzLklkID0gb2JqLklkOw0KDQogICAgDQogICAgICAgICAgICBpZih0eXBlb2Yob2JqLmFjdGl2ZSkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKG9iai5lbmFibGVkKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZihvYmouY29kZSkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5jb2RlKG9iai5jb2RlKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2Yob2JqLm9yZGVyKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLm9yZGVyKG9iai5vcmRlcik7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKG9iai5kYXRlKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLmRhdGUob2JqLmRhdGUpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICB0aGlzLmRhdGUobmV3IEdsaWRlRGF0ZVRpbWUodGhpcy5kYXRlKCkpKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2Yob2JqLm5hbWUpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMubmFtZShvYmoubmFtZSk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKG9iai5yZW1hcmspIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMucmVtYXJrKG9iai5yZW1hcmspOw0KICAgICAgICANCiAgICAgICAgICAgICAgICB0aGlzLnJlbWFyayhHbGlkZVN0cmluZ1V0aWwuYmFzZTY0RGVjb2RlKHRoaXMucmVtYXJrKCkpKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2Yob2JqLmNsYXNzTmFtZSkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5jbGFzc05hbWUob2JqLmNsYXNzTmFtZSk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKG9iai5tZXRob2QpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMubWV0aG9kKG9iai5tZXRob2QpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZihvYmoucGF5bG9hZCkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5wYXlsb2FkKG9iai5wYXlsb2FkKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgdGhpcy5wYXlsb2FkKEdsaWRlU3RyaW5nVXRpbC5iYXNlNjREZWNvZGUodGhpcy5wYXlsb2FkKCkpKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2Yob2JqLmNhcnJpZXIpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuY2FycmllcihOb2RlKCkuX2Zyb21Eb2N1bWVudChvYmouY2FycmllcikpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZihvYmouc2VuZGVyKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLnNlbmRlcihOb2RlKCkuX2Zyb21Eb2N1bWVudChvYmouc2VuZGVyKSk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKG9iai5yZWNpcGllbnQpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMucmVjaXBpZW50KE5vZGUoKS5fZnJvbURvY3VtZW50KG9iai5yZWNpcGllbnQpKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2Yob2JqLnJlc3BvbnNlVG8pIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMucmVzcG9uc2VUbyhFdmVudCgpLl9mcm9tRG9jdW1lbnQob2JqLnJlc3BvbnNlVG8pKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQoNCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZihvYmoucmVzcG9uc2VUb19FdmVudHMpIT09J3VuZGVmaW5lZCcpIHRoaXMucmVzcG9uc2VUb19FdmVudHMobmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5FdmVudCgpLl9mcm9tRG9jdW1lbnQob2JqLnJlc3BvbnNlVG9fcmVzcG9uc2VUb19FdmVudHMpKTsNCiAgICANCg0KICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgIH0NCg0KICAgICAgICBfdG9Eb2N1bWVudCgpew0KICAgICAgICAgICAgbGV0IF9fdG9TdHJpbmcgPSAnRXZlbnQuX3RvRG9jdW1lbnQoKTogJzsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgbGV0IHJldCA9IHt9Ow0KICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMuSWQpIT09J3VuZGVmaW5lZCcpIHJldC5JZCA9IHRoaXMuSWQ7DQoNCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZih0aGlzLl9hY3RpdmUpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHJldC5hY3RpdmUgPSB0aGlzLmFjdGl2ZSgpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZih0aGlzLl9lbmFibGVkKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICByZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZih0aGlzLl9jb2RlKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICByZXQuY29kZSA9IHRoaXMuY29kZSgpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZih0aGlzLl9vcmRlcikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgcmV0Lm9yZGVyID0gdGhpcy5vcmRlcigpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZih0aGlzLl9kYXRlKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICByZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBpZihyZXQuZGF0ZSAmJiB0eXBlb2YocmV0LmRhdGUuZ2V0TnVtZXJpY1ZhbHVlKT09PSdmdW5jdGlvbicpIHJldC5kYXRlID0gbmV3IERhdGUocmV0LmRhdGUuZ2V0TnVtZXJpY1ZhbHVlKCkpLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZih0aGlzLl9uYW1lKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICByZXQubmFtZSA9IHRoaXMubmFtZSgpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZih0aGlzLl9yZW1hcmspIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHJldC5yZW1hcmsgPSB0aGlzLnJlbWFyaygpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBpZih0eXBlb2YocmV0LnJlbWFyaygpKT09PSdvYmplY3QnKSByZXQucmVtYXJrID0gR2xpZGVTdHJpbmdVdGlsLmJhc2U2NEVuY29kZShKU09OLnN0cmluZ2lmeShyZXQucmVtYXJrKSk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMuX2NsYXNzTmFtZSkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgcmV0LmNsYXNzTmFtZSA9IHRoaXMuY2xhc3NOYW1lKCk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMuX21ldGhvZCkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgcmV0Lm1ldGhvZCA9IHRoaXMubWV0aG9kKCk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMuX3BheWxvYWQpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHJldC5wYXlsb2FkID0gdGhpcy5wYXlsb2FkKCk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGlmKHR5cGVvZihyZXQucGF5bG9hZCgpKT09PSdvYmplY3QnKSByZXQucGF5bG9hZCA9IEdsaWRlU3RyaW5nVXRpbC5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnBheWxvYWQpKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5fY2FycmllcikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgcmV0LmNhcnJpZXIgPSB0aGlzLmNhcnJpZXIoKS5fdG9Eb2N1bWVudCgpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZih0aGlzLl9zZW5kZXIpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHJldC5zZW5kZXIgPSB0aGlzLnNlbmRlcigpLl90b0RvY3VtZW50KCk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMuX3JlY2lwaWVudCkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgcmV0LnJlY2lwaWVudCA9IHRoaXMucmVjaXBpZW50KCkuX3RvRG9jdW1lbnQoKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5fcmVzcG9uc2VUbykhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgcmV0LnJlc3BvbnNlVG8gPSB0aGlzLnJlc3BvbnNlVG8oKS5fdG9Eb2N1bWVudCgpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgDQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5yZXNwb25zZVRvX0V2ZW50cygpKSE9PSd1bmRlZmluZWQnKSByZXQucmVzcG9uc2VUb19FdmVudHMgPSBzZWxmLnJlc3BvbnNlVG9fcmVzcG9uc2VUb19FdmVudHMoKS5tYXAoZnVuY3Rpb24odGEpe3JldHVybiB0YS5fdG9Eb2N1bWVudCgpO30pOw0KICAgIA0KICAgICAgICAgICAgcmV0dXJuIHJldDsNCiAgICAgICAgfQ0KDQogICAgICAgIF91bmlxdWUoKXsNCiAgICAgICAgICAgIGxldCBfX3RvU3RyaW5nID0gJ0V2ZW50Ll91bmlxdWUoKTogJzsNCiAgICAgICAgDQogICAgICAgICAgICBsZXQgcmV0ID0gbmV3IHVuZGVmaW5lZCgpOw0KICAgICAgICAgICAgaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDsNCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZih0aGlzLmNvZGUoKSkhPT0ndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpOw0KICAgIA0KICAgICAgICAgICAgcmV0dXJuIHJldDsNCiAgICAgICAgfQ0KDQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIEV2ZW50LnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgc3RvcmUoX19ldmVudCl7DQogICAgICAgICAgICBsZXQgX190b1N0cmluZyA9ICdFdmVudC5zdG9yZSgpOiAnOw0KDQogICAgICAgICAgICBsZXQgYW5zd2VyID0gdW5kZWZpbmVkOw0KDQogICAgICAgICAgICB2YXIgbm9kZSA9IG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uTm9kZSgpLmNvZGUoZ3MuZ2V0UHJvcGVydHkoJ2luc3RhbmNlX25hbWUnKSk7DQogICAgICAgICAgICBsZXQgX19yZXNwb25zZSA9IG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrbmV3IERhdGUobmV3IEdsaWRlRGF0ZVRpbWUoKSkudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJykrJ10uRXZlbnQuc3RvcmUoKScpLm1ldGhvZCgnc3RvcmUnKS5jbGFzc05hbWUoJ0V2ZW50JykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSk7DQoNCiAgICAgICAgICAgIGxldCBldkpTT04gPSBudWxsOw0KICAgICAgICAgICAgaWYoX19ldmVudCl7DQogICAgICAgICAgICAgICAgZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICAgICAgaWYodHlwZW9mKGV2SlNPTi5fX3RoaXMpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgICAgICB0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7DQogICAgICAgIA0KDQoNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIC8vX19yZXNwb25zZS5yZWNpcGllbnQobmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5Ob2RlKCkuY29kZSgncGFyZW50JykpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZihfX2V2ZW50ICYmICFfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQoNCiAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICBpZihfX2V2ZW50ICYmIF9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGFuc3dlciA9IEV2ZW50KCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZighX19ldmVudCl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgLy8gc3RvcmUgbG9jYWxseQ0KICAgICAgICAgICAgICAgIGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgnRXZlbnQnKTsNCg0KICAgICAgICAgICAgICAgIGxldCBfdGhpcyA9IHRoaXMuX3VuaXF1ZSgpLmZpbmQoKTsNCiAgICAgICAgICAgICAgICBpZighX3RoaXMpIGdyLnNldE5ld0d1aWRWYWx1ZSh0aGlzLklkIHx8ICh0aGlzLklkID0gZ3Iuc2V0TmV3R3VpZCgpKSk7DQogICAgICAgICAgICAgICAgaWYoX3RoaXMgJiYgdHlwZW9mKF90aGlzLklkKSE9PSd1bmRlZmluZWQnKSBnci5nZXQoX3RoaXMuSWQpOw0KDQogICAgICAgICAgICAgICAgbGV0IGJTZXQgPSBmYWxzZTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgaWYoX3RoaXMgJiYgdHlwZW9mKF90aGlzLmdldGNvZGUoKSkhPT0ndW5kZWZpbmVkJykgYlNldCA9IGdyLnNldFZhbHVlKCdjb2RlJywgX3RoaXMuZ2V0Y29kZSgpKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgaWYoYlNldCl7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuSWQgPSBnci51cGRhdGUoKTsNCiAgICAgICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgInRoaXMuSWQgPSAiICsgdGhpcy5JZCk7DQogICAgICAgICAgICAgICAgICAgIGlmKCFhbnN3ZXIpIGFuc3dlciA9IHRoaXM7DQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJpbnZhbGlkIG9iamVjdCIpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICANCg0KICAgICAgICAgICAgfQ0KDQoNCg0KDQogICAgICAgICAgICBpZighX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGlmKGFuc3dlcil7DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoe19fdGhpczogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICByZXR1cm4gYW5zd2VyOw0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIEV2ZW50LmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBmaW5kQWxsKF9fZXZlbnQpew0KICAgICAgICAgICAgbGV0IF9fdG9TdHJpbmcgPSAnRXZlbnQuZmluZEFsbCgpOiAnOw0KDQogICAgICAgICAgICBsZXQgYW5zd2VyID0gdW5kZWZpbmVkOw0KDQogICAgICAgICAgICB2YXIgbm9kZSA9IG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uTm9kZSgpLmNvZGUoZ3MuZ2V0UHJvcGVydHkoJ2luc3RhbmNlX25hbWUnKSk7DQogICAgICAgICAgICBsZXQgX19yZXNwb25zZSA9IG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrbmV3IERhdGUobmV3IEdsaWRlRGF0ZVRpbWUoKSkudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJykrJ10uRXZlbnQuZmluZEFsbCgpJykubWV0aG9kKCdmaW5kQWxsJykuY2xhc3NOYW1lKCdFdmVudCcpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpOw0KDQogICAgICAgICAgICBsZXQgZXZKU09OID0gbnVsbDsNCiAgICAgICAgICAgIGlmKF9fZXZlbnQpew0KICAgICAgICAgICAgICAgIGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgICAgIGlmKHR5cGVvZihldkpTT04uX190aGlzKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpOw0KICAgICAgICANCg0KDQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAvL19fcmVzcG9uc2UucmVjaXBpZW50KG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uTm9kZSgpLmNvZGUoJ3BhcmVudCcpKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoX19ldmVudCAmJiAhX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KDQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgaWYoX19ldmVudCAmJiBfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBhbnN3ZXIgPSBFdmVudCgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIA0KDQogICAgICAgICAgICB9DQoNCg0KDQoNCiAgICAgICAgICAgIGlmKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgaWYoYW5zd2VyKXsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7X190aGlzOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHJldHVybiBhbnN3ZXI7DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogRXZlbnQuZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGZpbmQoX19ldmVudCl7DQogICAgICAgICAgICBsZXQgX190b1N0cmluZyA9ICdFdmVudC5maW5kKCk6ICc7DQoNCiAgICAgICAgICAgIGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7DQoNCiAgICAgICAgICAgIHZhciBub2RlID0gbmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5Ob2RlKCkuY29kZShncy5nZXRQcm9wZXJ0eSgnaW5zdGFuY2VfbmFtZScpKTsNCiAgICAgICAgICAgIGxldCBfX3Jlc3BvbnNlID0gbmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5FdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytuZXcgRGF0ZShuZXcgR2xpZGVEYXRlVGltZSgpKS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKSsnXS5FdmVudC5maW5kKCknKS5tZXRob2QoJ2ZpbmQnKS5jbGFzc05hbWUoJ0V2ZW50JykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSk7DQoNCiAgICAgICAgICAgIGxldCBldkpTT04gPSBudWxsOw0KICAgICAgICAgICAgaWYoX19ldmVudCl7DQogICAgICAgICAgICAgICAgZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICAgICAgaWYodHlwZW9mKGV2SlNPTi5fX3RoaXMpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgICAgICB0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7DQogICAgICAgIA0KDQoNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIC8vX19yZXNwb25zZS5yZWNpcGllbnQobmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5Ob2RlKCkuY29kZSgncGFyZW50JykpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZihfX2V2ZW50ICYmICFfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQoNCiAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICBpZihfX2V2ZW50ICYmIF9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGFuc3dlciA9IEV2ZW50KCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZighX19ldmVudCl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KDQoNCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBpZihhbnN3ZXIpew0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHtfX3RoaXM6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcmV0dXJuIGFuc3dlcjsNCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBFdmVudC5saXN0ZW4oKSAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBsaXN0ZW4oX19ldmVudCwgbm9kZSl7DQogICAgICAgICAgICBsZXQgX190b1N0cmluZyA9ICdFdmVudC5saXN0ZW4oKTogJzsNCg0KICAgICAgICAgICAgbGV0IGFuc3dlciA9IHVuZGVmaW5lZDsNCg0KICAgICAgICAgICAgdmFyIG5vZGUgPSBuZXcgZXNwdGVzdC5jb20ubmFtbW91ci5kY29tLk5vZGUoKS5jb2RlKGdzLmdldFByb3BlcnR5KCdpbnN0YW5jZV9uYW1lJykpOw0KICAgICAgICAgICAgbGV0IF9fcmVzcG9uc2UgPSBuZXcgZXNwdGVzdC5jb20ubmFtbW91ci5kY29tLkV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK25ldyBEYXRlKG5ldyBHbGlkZURhdGVUaW1lKCkpLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpKyddLkV2ZW50Lmxpc3RlbigpJykubWV0aG9kKCdsaXN0ZW4nKS5jbGFzc05hbWUoJ0V2ZW50JykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSk7DQoNCiAgICAgICAgICAgIGxldCBldkpTT04gPSBudWxsOw0KICAgICAgICAgICAgaWYoX19ldmVudCl7DQogICAgICAgICAgICAgICAgZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICAgICAgaWYodHlwZW9mKGV2SlNPTi5fX3RoaXMpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgICAgICB0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICBpZih0eXBlb2YoZXZKU09OLm5vZGUpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgICAgICBub2RlID0gZXZKU09OLm5vZGU7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7DQogICAgICAgIA0KDQoNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIC8vX19yZXNwb25zZS5yZWNpcGllbnQobmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5Ob2RlKCkuY29kZSgncGFyZW50JykpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZihfX2V2ZW50ICYmICFfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQoNCiAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICBpZihfX2V2ZW50ICYmIF9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGFuc3dlciA9IGV2SlNPTjsNCiAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIA0KDQogICAgICAgICAgICB9DQoNCg0KDQoNCiAgICAgICAgICAgIGlmKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgaWYoYW5zd2VyKXsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoc3RyKGFuc3dlcikpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7X190aGlzOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHJldHVybiBhbnN3ZXI7DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogRXZlbnQudHJpZ2dlcigpICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHRyaWdnZXIoX19ldmVudCl7DQogICAgICAgICAgICBsZXQgX190b1N0cmluZyA9ICdFdmVudC50cmlnZ2VyKCk6ICc7DQoNCiAgICAgICAgICAgIGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7DQoNCiAgICAgICAgICAgIHZhciBub2RlID0gbmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5Ob2RlKCkuY29kZShncy5nZXRQcm9wZXJ0eSgnaW5zdGFuY2VfbmFtZScpKTsNCiAgICAgICAgICAgIGxldCBfX3Jlc3BvbnNlID0gbmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5FdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytuZXcgRGF0ZShuZXcgR2xpZGVEYXRlVGltZSgpKS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKSsnXS5FdmVudC50cmlnZ2VyKCknKS5tZXRob2QoJ3RyaWdnZXInKS5jbGFzc05hbWUoJ0V2ZW50JykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSk7DQoNCiAgICAgICAgICAgIGxldCBldkpTT04gPSBudWxsOw0KICAgICAgICAgICAgaWYoX19ldmVudCl7DQogICAgICAgICAgICAgICAgZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICAgICAgaWYodHlwZW9mKGV2SlNPTi5fX3RoaXMpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgICAgICB0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7DQogICAgICAgIA0KDQoNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIC8vX19yZXNwb25zZS5yZWNpcGllbnQobmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5Ob2RlKCkuY29kZSgncGFyZW50JykpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZihfX2V2ZW50ICYmICFfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQoNCiAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICBpZihfX2V2ZW50ICYmIF9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGFuc3dlciA9IGV2SlNPTjsNCiAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIA0KCgkJICAgIHJldHVybiB0aGlzLnN0b3JlKCk7CgkJDQogICAgICAgICAgICB9DQoNCg0KDQoNCiAgICAgICAgICAgIGlmKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgaWYoYW5zd2VyKXsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoc3RyKGFuc3dlcikpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7X190aGlzOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICByZXR1cm4gYW5zd2VyOw0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIEV2ZW50LnByb2Nlc3MoKSAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBwcm9jZXNzKF9fZXZlbnQpew0KICAgICAgICAgICAgbGV0IF9fdG9TdHJpbmcgPSAnRXZlbnQucHJvY2VzcygpOiAnOw0KDQogICAgICAgICAgICBsZXQgYW5zd2VyID0gdW5kZWZpbmVkOw0KDQogICAgICAgICAgICB2YXIgbm9kZSA9IG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uTm9kZSgpLmNvZGUoZ3MuZ2V0UHJvcGVydHkoJ2luc3RhbmNlX25hbWUnKSk7DQogICAgICAgICAgICBsZXQgX19yZXNwb25zZSA9IG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrbmV3IERhdGUobmV3IEdsaWRlRGF0ZVRpbWUoKSkudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJykrJ10uRXZlbnQucHJvY2VzcygpJykubWV0aG9kKCdwcm9jZXNzJykuY2xhc3NOYW1lKCdFdmVudCcpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpOw0KDQogICAgICAgICAgICBsZXQgZXZKU09OID0gbnVsbDsNCiAgICAgICAgICAgIGlmKF9fZXZlbnQpew0KICAgICAgICAgICAgICAgIGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgICAgIGlmKHR5cGVvZihldkpTT04uX190aGlzKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpOw0KICAgICAgICANCg0KDQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAvL19fcmVzcG9uc2UucmVjaXBpZW50KG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uTm9kZSgpLmNvZGUoJ3BhcmVudCcpKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoX19ldmVudCAmJiAhX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KDQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgaWYoX19ldmVudCAmJiBfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBhbnN3ZXIgPSBFdmVudCgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIA0KDQogICAgICAgICAgICB9DQoNCg0KDQoNCiAgICAgICAgICAgIGlmKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgaWYoYW5zd2VyKXsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7X190aGlzOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHJldHVybiBhbnN3ZXI7DQogICAgICAgIH0NCiAgICANCiAgICB9Ow0KDQogICAgZXNwdGVzdC5jb20gPSBlc3B0ZXN0LmNvbSB8fCB7fTtlc3B0ZXN0LmNvbS5uYW1tb3VyID0gZXNwdGVzdC5jb20ubmFtbW91ciB8fCB7fTtlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20gPSBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20gfHwge307DQogICAgZXNwdGVzdC5jb20ubmFtbW91ci5kY29tLk5vZGUgPSBjbGFzcyB7DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE5vZGUuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgYWN0aXZlKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX2FjdGl2ZSA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fYWN0aXZlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE5vZGUuZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGVuYWJsZWQodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fZW5hYmxlZCA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZW5hYmxlZDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBOb2RlLmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBjb2RlKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX2NvZGUgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2NvZGU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTm9kZS5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIG9yZGVyKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX29yZGVyID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9vcmRlcjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBOb2RlLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBkYXRlKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX2RhdGUgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2RhdGU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTm9kZS5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgbmFtZSh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9uYW1lID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9uYW1lOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE5vZGUucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgcmVtYXJrKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX3JlbWFyayA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fcmVtYXJrOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE5vZGUuYWRkcmVzcyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGFkZHJlc3Modil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fYWRkcmVzcyA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fYWRkcmVzczsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBOb2RlLmJhY2t1cCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGJhY2t1cCh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9iYWNrdXAgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2JhY2t1cDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBOb2RlLnBhcmVudCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHBhcmVudCh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9wYXJlbnQgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3BhcmVudDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBOb2RlLmdyb3VwIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgZ3JvdXAodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fZ3JvdXAgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2dyb3VwOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE5vZGUuY29udGV4dCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGNvbnRleHQodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fY29udGV4dCA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fY29udGV4dDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBOb2RlLnBvcnQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBwb3J0KHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX3BvcnQgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3BvcnQ7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTm9kZS5vbmxpbmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBvbmxpbmUodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fb25saW5lID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9vbmxpbmU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTm9kZS5zZWN1cmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBzZWN1cmUodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fc2VjdXJlID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9zZWN1cmU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTm9kZS50eXBlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgdHlwZSh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl90eXBlID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl90eXBlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgDQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE5vZGUuY29udHJvbGxlcl9EZXZpY2VzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgY29udHJvbGxlcl9EZXZpY2VzKHYpew0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE5vZGUubm9kZV9Db25maWdzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgbm9kZV9Db25maWdzKHYpew0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE5vZGUuY2Fycmllcl9FdmVudHMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBjYXJyaWVyX0V2ZW50cyh2KXsNCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBOb2RlLnNlbmRlcl9FdmVudHMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBzZW5kZXJfRXZlbnRzKHYpew0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE5vZGUucmVjaXBpZW50X0V2ZW50cyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHJlY2lwaWVudF9FdmVudHModil7DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTm9kZS5iYWNrdXBfTm9kZXMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBiYWNrdXBfTm9kZXModil7DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTm9kZS5wYXJlbnRfTm9kZXMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBwYXJlbnRfTm9kZXModil7DQogICAgICAgIH0NCiAgICANCiAgICANCiAgICAgICAgX2Zyb21Eb2N1bWVudChvYmopew0KICAgICAgICAgICAgbGV0IF9fdG9TdHJpbmcgPSAnTm9kZS5fZnJvbURvY3VtZW50KCk6ICc7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGlmKCFvYmopIHJldHVybiB0aGlzOw0KDQogICAgICAgICAgICAvL2lmIGlzaW5zdGFuY2Uob2JqLCBieXRlcyk6IG9iaiA9IHN0cihvYmosICJ1dGYtOCIpOw0KDQogICAgICAgICAgICBpZih0eXBlb2Yob2JqKT09PSdzdHJpbmcnKXsNCiAgICAgICAgICAgICAgICBpZihuZXcgUmVnRXhwKCIoKChbQS1aYS16XXszLDl9Oig/Oi8vKT8pKD86Wy07OiY9KyQsd10rQCk/W0EtWmEtejAtOS4tXSt8KD86d3d3LnxbLTs6Jj0rJCx3XStAKVtBLVphLXowLTkuLV0rKSgoPzovWyt+JS8udy1fXSopPz8/KD86Wy0rPSY7JUAud19dKikjPyg/Olt3XSopKT8pIikudGVzdChvYmopKXsNCiAgICAgICAgICAgICAgICAgICAgbGV0IHJlcXVlc3QgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpOw0KICAgICAgICAgICAgICAgICAgICByZXF1ZXN0LnNldEh0dHBNZXRob2QoJ0dFVCcpOw0KICAgICAgICAgICAgICAgICAgICByZXF1ZXN0LnNldEVuZHBvaW50KG9iaik7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQocmVxdWVzdC5leGVjdXRlKCkuZ2V0Qm9keSgpKTsNCiAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChKU09OLnBhcnNlKG9iaikpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICBpZihBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pe3JldHVybiBuZXcgTm9kZSgpLl9mcm9tRG9jdW1lbnQobyl9KTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKG9iai5JZCkhPT0ndW5kZWZpbmVkJykgdGhpcy5JZCA9IG9iai5JZDsNCg0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKG9iai5hY3RpdmUpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZihvYmouZW5hYmxlZCkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2Yob2JqLmNvZGUpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuY29kZShvYmouY29kZSk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKG9iai5vcmRlcikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5vcmRlcihvYmoub3JkZXIpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZihvYmouZGF0ZSkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5kYXRlKG9iai5kYXRlKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgdGhpcy5kYXRlKG5ldyBHbGlkZURhdGVUaW1lKHRoaXMuZGF0ZSgpKSk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKG9iai5uYW1lKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLm5hbWUob2JqLm5hbWUpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZihvYmoucmVtYXJrKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLnJlbWFyayhvYmoucmVtYXJrKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgdGhpcy5yZW1hcmsoR2xpZGVTdHJpbmdVdGlsLmJhc2U2NERlY29kZSh0aGlzLnJlbWFyaygpKSk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKG9iai5hZGRyZXNzKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLmFkZHJlc3Mob2JqLmFkZHJlc3MpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZihvYmouYmFja3VwKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLmJhY2t1cChOb2RlKCkuX2Zyb21Eb2N1bWVudChvYmouYmFja3VwKSk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKG9iai5wYXJlbnQpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMucGFyZW50KE5vZGUoKS5fZnJvbURvY3VtZW50KG9iai5wYXJlbnQpKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2Yob2JqLmdyb3VwKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLmdyb3VwKE5vZGVfR3JvdXAoKS5fZnJvbURvY3VtZW50KG9iai5ncm91cCkpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZihvYmouY29udGV4dCkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5jb250ZXh0KE5vZGVfQ29udGV4dCgpLl9mcm9tRG9jdW1lbnQob2JqLmNvbnRleHQpKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2Yob2JqLnBvcnQpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMucG9ydChvYmoucG9ydCk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKG9iai5vbmxpbmUpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMub25saW5lKG9iai5vbmxpbmUpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICB0aGlzLm9ubGluZShuZXcgR2xpZGVEYXRlVGltZSh0aGlzLm9ubGluZSgpKSk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKG9iai5zZWN1cmUpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuc2VjdXJlKG9iai5zZWN1cmUpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZihvYmoudHlwZSkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy50eXBlKE5vZGVfVHlwZSgpLl9mcm9tRG9jdW1lbnQob2JqLnR5cGUpKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQoNCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZihvYmouY29udHJvbGxlcl9EZXZpY2VzKSE9PSd1bmRlZmluZWQnKSB0aGlzLmNvbnRyb2xsZXJfRGV2aWNlcyhuZXcgZXNwdGVzdC5jb20ubmFtbW91ci5kaW90LkRldmljZSgpLl9mcm9tRG9jdW1lbnQob2JqLmNvbnRyb2xsZXJfY29udHJvbGxlcl9EZXZpY2VzKSk7DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2Yob2JqLm5vZGVfQ29uZmlncykhPT0ndW5kZWZpbmVkJykgdGhpcy5ub2RlX0NvbmZpZ3MobmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5Db25maWcoKS5fZnJvbURvY3VtZW50KG9iai5ub2RlX25vZGVfQ29uZmlncykpOw0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKG9iai5jYXJyaWVyX0V2ZW50cykhPT0ndW5kZWZpbmVkJykgdGhpcy5jYXJyaWVyX0V2ZW50cyhuZXcgZXNwdGVzdC5jb20ubmFtbW91ci5kY29tLkV2ZW50KCkuX2Zyb21Eb2N1bWVudChvYmouY2Fycmllcl9jYXJyaWVyX0V2ZW50cykpOw0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKG9iai5zZW5kZXJfRXZlbnRzKSE9PSd1bmRlZmluZWQnKSB0aGlzLnNlbmRlcl9FdmVudHMobmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5FdmVudCgpLl9mcm9tRG9jdW1lbnQob2JqLnNlbmRlcl9zZW5kZXJfRXZlbnRzKSk7DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2Yob2JqLnJlY2lwaWVudF9FdmVudHMpIT09J3VuZGVmaW5lZCcpIHRoaXMucmVjaXBpZW50X0V2ZW50cyhuZXcgZXNwdGVzdC5jb20ubmFtbW91ci5kY29tLkV2ZW50KCkuX2Zyb21Eb2N1bWVudChvYmoucmVjaXBpZW50X3JlY2lwaWVudF9FdmVudHMpKTsNCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZihvYmouYmFja3VwX05vZGVzKSE9PSd1bmRlZmluZWQnKSB0aGlzLmJhY2t1cF9Ob2RlcyhuZXcgZXNwdGVzdC5jb20ubmFtbW91ci5kY29tLk5vZGUoKS5fZnJvbURvY3VtZW50KG9iai5iYWNrdXBfYmFja3VwX05vZGVzKSk7DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2Yob2JqLnBhcmVudF9Ob2RlcykhPT0ndW5kZWZpbmVkJykgdGhpcy5wYXJlbnRfTm9kZXMobmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5Ob2RlKCkuX2Zyb21Eb2N1bWVudChvYmoucGFyZW50X3BhcmVudF9Ob2RlcykpOw0KICAgIA0KDQogICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgfQ0KDQogICAgICAgIF90b0RvY3VtZW50KCl7DQogICAgICAgICAgICBsZXQgX190b1N0cmluZyA9ICdOb2RlLl90b0RvY3VtZW50KCk6ICc7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGxldCByZXQgPSB7fTsNCiAgICAgICAgICAgIGlmKHR5cGVvZih0aGlzLklkKSE9PSd1bmRlZmluZWQnKSByZXQuSWQgPSB0aGlzLklkOw0KDQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5fYWN0aXZlKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICByZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5fZW5hYmxlZCkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgcmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5fY29kZSkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgcmV0LmNvZGUgPSB0aGlzLmNvZGUoKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5fb3JkZXIpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5fZGF0ZSkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgcmV0LmRhdGUgPSB0aGlzLmRhdGUoKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgaWYocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLmdldE51bWVyaWNWYWx1ZSk9PT0nZnVuY3Rpb24nKSByZXQuZGF0ZSA9IG5ldyBEYXRlKHJldC5kYXRlLmdldE51bWVyaWNWYWx1ZSgpKS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5fbmFtZSkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgcmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5fcmVtYXJrKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICByZXQucmVtYXJrID0gdGhpcy5yZW1hcmsoKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgaWYodHlwZW9mKHJldC5yZW1hcmsoKSk9PT0nb2JqZWN0JykgcmV0LnJlbWFyayA9IEdsaWRlU3RyaW5nVXRpbC5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZih0aGlzLl9hZGRyZXNzKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICByZXQuYWRkcmVzcyA9IHRoaXMuYWRkcmVzcygpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZih0aGlzLl9iYWNrdXApIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHJldC5iYWNrdXAgPSB0aGlzLmJhY2t1cCgpLl90b0RvY3VtZW50KCk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMuX3BhcmVudCkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgcmV0LnBhcmVudCA9IHRoaXMucGFyZW50KCkuX3RvRG9jdW1lbnQoKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5fZ3JvdXApIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHJldC5ncm91cCA9IHRoaXMuZ3JvdXAoKS5fdG9Eb2N1bWVudCgpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZih0aGlzLl9jb250ZXh0KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICByZXQuY29udGV4dCA9IHRoaXMuY29udGV4dCgpLl90b0RvY3VtZW50KCk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMuX3BvcnQpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHJldC5wb3J0ID0gdGhpcy5wb3J0KCk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMuX29ubGluZSkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgcmV0Lm9ubGluZSA9IHRoaXMub25saW5lKCk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGlmKHJldC5vbmxpbmUgJiYgdHlwZW9mKHJldC5vbmxpbmUuZ2V0TnVtZXJpY1ZhbHVlKT09PSdmdW5jdGlvbicpIHJldC5vbmxpbmUgPSBuZXcgRGF0ZShyZXQub25saW5lLmdldE51bWVyaWNWYWx1ZSgpKS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5fc2VjdXJlKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICByZXQuc2VjdXJlID0gdGhpcy5zZWN1cmUoKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5fdHlwZSkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgcmV0LnR5cGUgPSB0aGlzLnR5cGUoKS5fdG9Eb2N1bWVudCgpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgDQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5jb250cm9sbGVyX0RldmljZXMoKSkhPT0ndW5kZWZpbmVkJykgcmV0LmNvbnRyb2xsZXJfRGV2aWNlcyA9IHNlbGYuY29udHJvbGxlcl9jb250cm9sbGVyX0RldmljZXMoKS5tYXAoZnVuY3Rpb24odGEpe3JldHVybiB0YS5fdG9Eb2N1bWVudCgpO30pOw0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMubm9kZV9Db25maWdzKCkpIT09J3VuZGVmaW5lZCcpIHJldC5ub2RlX0NvbmZpZ3MgPSBzZWxmLm5vZGVfbm9kZV9Db25maWdzKCkubWFwKGZ1bmN0aW9uKHRhKXtyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTt9KTsNCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZih0aGlzLmNhcnJpZXJfRXZlbnRzKCkpIT09J3VuZGVmaW5lZCcpIHJldC5jYXJyaWVyX0V2ZW50cyA9IHNlbGYuY2Fycmllcl9jYXJyaWVyX0V2ZW50cygpLm1hcChmdW5jdGlvbih0YSl7cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7fSk7DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5zZW5kZXJfRXZlbnRzKCkpIT09J3VuZGVmaW5lZCcpIHJldC5zZW5kZXJfRXZlbnRzID0gc2VsZi5zZW5kZXJfc2VuZGVyX0V2ZW50cygpLm1hcChmdW5jdGlvbih0YSl7cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7fSk7DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5yZWNpcGllbnRfRXZlbnRzKCkpIT09J3VuZGVmaW5lZCcpIHJldC5yZWNpcGllbnRfRXZlbnRzID0gc2VsZi5yZWNpcGllbnRfcmVjaXBpZW50X0V2ZW50cygpLm1hcChmdW5jdGlvbih0YSl7cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7fSk7DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5iYWNrdXBfTm9kZXMoKSkhPT0ndW5kZWZpbmVkJykgcmV0LmJhY2t1cF9Ob2RlcyA9IHNlbGYuYmFja3VwX2JhY2t1cF9Ob2RlcygpLm1hcChmdW5jdGlvbih0YSl7cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7fSk7DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5wYXJlbnRfTm9kZXMoKSkhPT0ndW5kZWZpbmVkJykgcmV0LnBhcmVudF9Ob2RlcyA9IHNlbGYucGFyZW50X3BhcmVudF9Ob2RlcygpLm1hcChmdW5jdGlvbih0YSl7cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7fSk7DQogICAgDQogICAgICAgICAgICByZXR1cm4gcmV0Ow0KICAgICAgICB9DQoNCiAgICAgICAgX3VuaXF1ZSgpew0KICAgICAgICAgICAgbGV0IF9fdG9TdHJpbmcgPSAnTm9kZS5fdW5pcXVlKCk6ICc7DQogICAgICAgIA0KICAgICAgICAgICAgbGV0IHJldCA9IG5ldyB1bmRlZmluZWQoKTsNCiAgICAgICAgICAgIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5jb2RlKCkpIT09J3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTsNCiAgICANCiAgICAgICAgICAgIHJldHVybiByZXQ7DQogICAgICAgIH0NCg0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBOb2RlLnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgc3RvcmUoX19ldmVudCl7DQogICAgICAgICAgICBsZXQgX190b1N0cmluZyA9ICdOb2RlLnN0b3JlKCk6ICc7DQoNCiAgICAgICAgICAgIGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7DQoNCiAgICAgICAgICAgIHZhciBub2RlID0gbmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5Ob2RlKCkuY29kZShncy5nZXRQcm9wZXJ0eSgnaW5zdGFuY2VfbmFtZScpKTsNCiAgICAgICAgICAgIGxldCBfX3Jlc3BvbnNlID0gbmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5FdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytuZXcgRGF0ZShuZXcgR2xpZGVEYXRlVGltZSgpKS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKSsnXS5Ob2RlLnN0b3JlKCknKS5tZXRob2QoJ3N0b3JlJykuY2xhc3NOYW1lKCdOb2RlJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSk7DQoNCiAgICAgICAgICAgIGxldCBldkpTT04gPSBudWxsOw0KICAgICAgICAgICAgaWYoX19ldmVudCl7DQogICAgICAgICAgICAgICAgZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICAgICAgaWYodHlwZW9mKGV2SlNPTi5fX3RoaXMpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgICAgICB0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7DQogICAgICAgIA0KDQoNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIC8vX19yZXNwb25zZS5yZWNpcGllbnQobmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5Ob2RlKCkuY29kZSgncGFyZW50JykpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZihfX2V2ZW50ICYmICFfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQoNCiAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICBpZihfX2V2ZW50ICYmIF9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGFuc3dlciA9IE5vZGUoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKCFfX2V2ZW50KXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBzdG9yZSBsb2NhbGx5DQogICAgICAgICAgICAgICAgbGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCdOb2RlJyk7DQoNCiAgICAgICAgICAgICAgICBsZXQgX3RoaXMgPSB0aGlzLl91bmlxdWUoKS5maW5kKCk7DQogICAgICAgICAgICAgICAgaWYoIV90aGlzKSBnci5zZXROZXdHdWlkVmFsdWUodGhpcy5JZCB8fCAodGhpcy5JZCA9IGdyLnNldE5ld0d1aWQoKSkpOw0KICAgICAgICAgICAgICAgIGlmKF90aGlzICYmIHR5cGVvZihfdGhpcy5JZCkhPT0ndW5kZWZpbmVkJykgZ3IuZ2V0KF90aGlzLklkKTsNCg0KICAgICAgICAgICAgICAgIGxldCBiU2V0ID0gZmFsc2U7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGlmKF90aGlzICYmIHR5cGVvZihfdGhpcy5nZXRjb2RlKCkpIT09J3VuZGVmaW5lZCcpIGJTZXQgPSBnci5zZXRWYWx1ZSgnY29kZScsIF90aGlzLmdldGNvZGUoKSk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGlmKGJTZXQpew0KICAgICAgICAgICAgICAgICAgICB0aGlzLklkID0gZ3IudXBkYXRlKCk7DQogICAgICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJ0aGlzLklkID0gIiArIHRoaXMuSWQpOw0KICAgICAgICAgICAgICAgICAgICBpZighYW5zd2VyKSBhbnN3ZXIgPSB0aGlzOw0KICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiaW52YWxpZCBvYmplY3QiKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KDQoNCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBpZihhbnN3ZXIpew0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHtfX3RoaXM6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcmV0dXJuIGFuc3dlcjsNCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBOb2RlLmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBmaW5kQWxsKF9fZXZlbnQpew0KICAgICAgICAgICAgbGV0IF9fdG9TdHJpbmcgPSAnTm9kZS5maW5kQWxsKCk6ICc7DQoNCiAgICAgICAgICAgIGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7DQoNCiAgICAgICAgICAgIHZhciBub2RlID0gbmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5Ob2RlKCkuY29kZShncy5nZXRQcm9wZXJ0eSgnaW5zdGFuY2VfbmFtZScpKTsNCiAgICAgICAgICAgIGxldCBfX3Jlc3BvbnNlID0gbmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5FdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytuZXcgRGF0ZShuZXcgR2xpZGVEYXRlVGltZSgpKS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKSsnXS5Ob2RlLmZpbmRBbGwoKScpLm1ldGhvZCgnZmluZEFsbCcpLmNsYXNzTmFtZSgnTm9kZScpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpOw0KDQogICAgICAgICAgICBsZXQgZXZKU09OID0gbnVsbDsNCiAgICAgICAgICAgIGlmKF9fZXZlbnQpew0KICAgICAgICAgICAgICAgIGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgICAgIGlmKHR5cGVvZihldkpTT04uX190aGlzKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpOw0KICAgICAgICANCg0KDQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAvL19fcmVzcG9uc2UucmVjaXBpZW50KG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uTm9kZSgpLmNvZGUoJ3BhcmVudCcpKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoX19ldmVudCAmJiAhX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KDQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgaWYoX19ldmVudCAmJiBfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBhbnN3ZXIgPSBOb2RlKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZighX19ldmVudCl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KDQoNCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBpZihhbnN3ZXIpew0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHtfX3RoaXM6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcmV0dXJuIGFuc3dlcjsNCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBOb2RlLmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBmaW5kKF9fZXZlbnQpew0KICAgICAgICAgICAgbGV0IF9fdG9TdHJpbmcgPSAnTm9kZS5maW5kKCk6ICc7DQoNCiAgICAgICAgICAgIGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7DQoNCiAgICAgICAgICAgIHZhciBub2RlID0gbmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5Ob2RlKCkuY29kZShncy5nZXRQcm9wZXJ0eSgnaW5zdGFuY2VfbmFtZScpKTsNCiAgICAgICAgICAgIGxldCBfX3Jlc3BvbnNlID0gbmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5FdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytuZXcgRGF0ZShuZXcgR2xpZGVEYXRlVGltZSgpKS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKSsnXS5Ob2RlLmZpbmQoKScpLm1ldGhvZCgnZmluZCcpLmNsYXNzTmFtZSgnTm9kZScpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpOw0KDQogICAgICAgICAgICBsZXQgZXZKU09OID0gbnVsbDsNCiAgICAgICAgICAgIGlmKF9fZXZlbnQpew0KICAgICAgICAgICAgICAgIGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgICAgIGlmKHR5cGVvZihldkpTT04uX190aGlzKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpOw0KICAgICAgICANCg0KDQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAvL19fcmVzcG9uc2UucmVjaXBpZW50KG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uTm9kZSgpLmNvZGUoJ3BhcmVudCcpKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoX19ldmVudCAmJiAhX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KDQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgaWYoX19ldmVudCAmJiBfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBhbnN3ZXIgPSBOb2RlKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZighX19ldmVudCl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KDQoNCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBpZihhbnN3ZXIpew0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHtfX3RoaXM6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcmV0dXJuIGFuc3dlcjsNCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBOb2RlLmF1dGhDb2RlKCkgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgYXV0aENvZGUoX19ldmVudCwgY29kZSwgdG9vbCl7DQogICAgICAgICAgICBsZXQgX190b1N0cmluZyA9ICdOb2RlLmF1dGhDb2RlKCk6ICc7DQoNCiAgICAgICAgICAgIGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7DQoNCiAgICAgICAgICAgIHZhciBub2RlID0gbmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5Ob2RlKCkuY29kZShncy5nZXRQcm9wZXJ0eSgnaW5zdGFuY2VfbmFtZScpKTsNCiAgICAgICAgICAgIGxldCBfX3Jlc3BvbnNlID0gbmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5FdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytuZXcgRGF0ZShuZXcgR2xpZGVEYXRlVGltZSgpKS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKSsnXS5Ob2RlLmF1dGhDb2RlKCknKS5tZXRob2QoJ2F1dGhDb2RlJykuY2xhc3NOYW1lKCdOb2RlJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSk7DQoNCiAgICAgICAgICAgIGxldCBldkpTT04gPSBudWxsOw0KICAgICAgICAgICAgaWYoX19ldmVudCl7DQogICAgICAgICAgICAgICAgZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICAgICAgaWYodHlwZW9mKGV2SlNPTi5fX3RoaXMpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgICAgICB0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICBpZih0eXBlb2YoZXZKU09OLmNvZGUpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgICAgICBjb2RlID0gZXZKU09OLmNvZGU7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICBpZih0eXBlb2YoZXZKU09OLnRvb2wpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgICAgICB0b29sID0gZXZKU09OLnRvb2w7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7DQogICAgICAgIA0KDQoNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIC8vX19yZXNwb25zZS5yZWNpcGllbnQobmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5Ob2RlKCkuY29kZSgncGFyZW50JykpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZihfX2V2ZW50ICYmICFfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQoNCiAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICBpZihfX2V2ZW50ICYmIF9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGFuc3dlciA9IGV2SlNPTjsNCiAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIA0KDQogICAgICAgICAgICB9DQoNCg0KDQoNCiAgICAgICAgICAgIGlmKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgaWYoYW5zd2VyKXsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoc3RyKGFuc3dlcikpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7X190aGlzOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHJldHVybiBhbnN3ZXI7DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTm9kZS5pbml0KCkgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgaW5pdChfX2V2ZW50LCBvbmxpbmUsIGNvZGUsIHVpZCl7DQogICAgICAgICAgICBsZXQgX190b1N0cmluZyA9ICdOb2RlLmluaXQoKTogJzsNCg0KICAgICAgICAgICAgbGV0IGFuc3dlciA9IHVuZGVmaW5lZDsNCg0KICAgICAgICAgICAgdmFyIG5vZGUgPSBuZXcgZXNwdGVzdC5jb20ubmFtbW91ci5kY29tLk5vZGUoKS5jb2RlKGdzLmdldFByb3BlcnR5KCdpbnN0YW5jZV9uYW1lJykpOw0KICAgICAgICAgICAgbGV0IF9fcmVzcG9uc2UgPSBuZXcgZXNwdGVzdC5jb20ubmFtbW91ci5kY29tLkV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK25ldyBEYXRlKG5ldyBHbGlkZURhdGVUaW1lKCkpLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpKyddLk5vZGUuaW5pdCgpJykubWV0aG9kKCdpbml0JykuY2xhc3NOYW1lKCdOb2RlJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSk7DQoNCiAgICAgICAgICAgIGxldCBldkpTT04gPSBudWxsOw0KICAgICAgICAgICAgaWYoX19ldmVudCl7DQogICAgICAgICAgICAgICAgZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICAgICAgaWYodHlwZW9mKGV2SlNPTi5fX3RoaXMpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgICAgICB0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICBpZih0eXBlb2YoZXZKU09OLm9ubGluZSkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgICAgIG9ubGluZSA9IGV2SlNPTi5vbmxpbmU7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICBpZih0eXBlb2YoZXZKU09OLmNvZGUpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgICAgICBjb2RlID0gZXZKU09OLmNvZGU7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICBpZih0eXBlb2YoZXZKU09OLnVpZCkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgICAgIHVpZCA9IGV2SlNPTi51aWQ7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7DQogICAgICAgIA0KDQoNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIC8vX19yZXNwb25zZS5yZWNpcGllbnQobmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5Ob2RlKCkuY29kZSgncGFyZW50JykpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZihfX2V2ZW50ICYmICFfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQoNCiAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICBpZihfX2V2ZW50ICYmIF9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGFuc3dlciA9IE5vZGUoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKCFfX2V2ZW50KXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICANCg0KICAgICAgICAgICAgfQ0KDQoNCg0KDQogICAgICAgICAgICBpZighX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGlmKGFuc3dlcil7DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoe19fdGhpczogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICByZXR1cm4gYW5zd2VyOw0KICAgICAgICB9DQogICAgDQogICAgfTsNCg0KICAgIGVzcHRlc3QuY29tID0gZXNwdGVzdC5jb20gfHwge307ZXNwdGVzdC5jb20ubmFtbW91ciA9IGVzcHRlc3QuY29tLm5hbW1vdXIgfHwge307ZXNwdGVzdC5jb20ubmFtbW91ci5kY29tID0gZXNwdGVzdC5jb20ubmFtbW91ci5kY29tIHx8IHt9Ow0KICAgIGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5Ob2RlX0NvbnRleHQgPSBjbGFzcyB7DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE5vZGVfQ29udGV4dC5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBhY3RpdmUodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fYWN0aXZlID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9hY3RpdmU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTm9kZV9Db250ZXh0LmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBlbmFibGVkKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX2VuYWJsZWQgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2VuYWJsZWQ7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTm9kZV9Db250ZXh0LmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBjb2RlKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX2NvZGUgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2NvZGU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTm9kZV9Db250ZXh0Lm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgb3JkZXIodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fb3JkZXIgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX29yZGVyOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE5vZGVfQ29udGV4dC5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgZGF0ZSh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9kYXRlID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9kYXRlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE5vZGVfQ29udGV4dC5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgbmFtZSh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9uYW1lID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9uYW1lOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE5vZGVfQ29udGV4dC5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICByZW1hcmsodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fcmVtYXJrID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9yZW1hcms7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICANCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTm9kZV9Db250ZXh0LmNvbnRleHRfTm9kZXMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBjb250ZXh0X05vZGVzKHYpew0KICAgICAgICB9DQogICAgDQogICAgDQogICAgICAgIF9mcm9tRG9jdW1lbnQob2JqKXsNCiAgICAgICAgICAgIGxldCBfX3RvU3RyaW5nID0gJ05vZGVfQ29udGV4dC5fZnJvbURvY3VtZW50KCk6ICc7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGlmKCFvYmopIHJldHVybiB0aGlzOw0KDQogICAgICAgICAgICAvL2lmIGlzaW5zdGFuY2Uob2JqLCBieXRlcyk6IG9iaiA9IHN0cihvYmosICJ1dGYtOCIpOw0KDQogICAgICAgICAgICBpZih0eXBlb2Yob2JqKT09PSdzdHJpbmcnKXsNCiAgICAgICAgICAgICAgICBpZihuZXcgUmVnRXhwKCIoKChbQS1aYS16XXszLDl9Oig/Oi8vKT8pKD86Wy07OiY9KyQsd10rQCk/W0EtWmEtejAtOS4tXSt8KD86d3d3LnxbLTs6Jj0rJCx3XStAKVtBLVphLXowLTkuLV0rKSgoPzovWyt+JS8udy1fXSopPz8/KD86Wy0rPSY7JUAud19dKikjPyg/Olt3XSopKT8pIikudGVzdChvYmopKXsNCiAgICAgICAgICAgICAgICAgICAgbGV0IHJlcXVlc3QgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpOw0KICAgICAgICAgICAgICAgICAgICByZXF1ZXN0LnNldEh0dHBNZXRob2QoJ0dFVCcpOw0KICAgICAgICAgICAgICAgICAgICByZXF1ZXN0LnNldEVuZHBvaW50KG9iaik7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQocmVxdWVzdC5leGVjdXRlKCkuZ2V0Qm9keSgpKTsNCiAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChKU09OLnBhcnNlKG9iaikpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICBpZihBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pe3JldHVybiBuZXcgTm9kZV9Db250ZXh0KCkuX2Zyb21Eb2N1bWVudChvKX0pOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBpZih0eXBlb2Yob2JqLklkKSE9PSd1bmRlZmluZWQnKSB0aGlzLklkID0gb2JqLklkOw0KDQogICAgDQogICAgICAgICAgICBpZih0eXBlb2Yob2JqLmFjdGl2ZSkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKG9iai5lbmFibGVkKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZihvYmouY29kZSkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5jb2RlKG9iai5jb2RlKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2Yob2JqLm9yZGVyKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLm9yZGVyKG9iai5vcmRlcik7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKG9iai5kYXRlKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLmRhdGUob2JqLmRhdGUpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICB0aGlzLmRhdGUobmV3IEdsaWRlRGF0ZVRpbWUodGhpcy5kYXRlKCkpKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2Yob2JqLm5hbWUpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMubmFtZShvYmoubmFtZSk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKG9iai5yZW1hcmspIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMucmVtYXJrKG9iai5yZW1hcmspOw0KICAgICAgICANCiAgICAgICAgICAgICAgICB0aGlzLnJlbWFyayhHbGlkZVN0cmluZ1V0aWwuYmFzZTY0RGVjb2RlKHRoaXMucmVtYXJrKCkpKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQoNCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZihvYmouY29udGV4dF9Ob2RlcykhPT0ndW5kZWZpbmVkJykgdGhpcy5jb250ZXh0X05vZGVzKG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uTm9kZSgpLl9mcm9tRG9jdW1lbnQob2JqLmNvbnRleHRfY29udGV4dF9Ob2RlcykpOw0KICAgIA0KDQogICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgfQ0KDQogICAgICAgIF90b0RvY3VtZW50KCl7DQogICAgICAgICAgICBsZXQgX190b1N0cmluZyA9ICdOb2RlX0NvbnRleHQuX3RvRG9jdW1lbnQoKTogJzsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgbGV0IHJldCA9IHt9Ow0KICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMuSWQpIT09J3VuZGVmaW5lZCcpIHJldC5JZCA9IHRoaXMuSWQ7DQoNCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZih0aGlzLl9hY3RpdmUpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHJldC5hY3RpdmUgPSB0aGlzLmFjdGl2ZSgpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZih0aGlzLl9lbmFibGVkKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICByZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZih0aGlzLl9jb2RlKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICByZXQuY29kZSA9IHRoaXMuY29kZSgpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZih0aGlzLl9vcmRlcikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgcmV0Lm9yZGVyID0gdGhpcy5vcmRlcigpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZih0aGlzLl9kYXRlKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICByZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBpZihyZXQuZGF0ZSAmJiB0eXBlb2YocmV0LmRhdGUuZ2V0TnVtZXJpY1ZhbHVlKT09PSdmdW5jdGlvbicpIHJldC5kYXRlID0gbmV3IERhdGUocmV0LmRhdGUuZ2V0TnVtZXJpY1ZhbHVlKCkpLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZih0aGlzLl9uYW1lKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICByZXQubmFtZSA9IHRoaXMubmFtZSgpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZih0aGlzLl9yZW1hcmspIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHJldC5yZW1hcmsgPSB0aGlzLnJlbWFyaygpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBpZih0eXBlb2YocmV0LnJlbWFyaygpKT09PSdvYmplY3QnKSByZXQucmVtYXJrID0gR2xpZGVTdHJpbmdVdGlsLmJhc2U2NEVuY29kZShKU09OLnN0cmluZ2lmeShyZXQucmVtYXJrKSk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICANCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZih0aGlzLmNvbnRleHRfTm9kZXMoKSkhPT0ndW5kZWZpbmVkJykgcmV0LmNvbnRleHRfTm9kZXMgPSBzZWxmLmNvbnRleHRfY29udGV4dF9Ob2RlcygpLm1hcChmdW5jdGlvbih0YSl7cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7fSk7DQogICAgDQogICAgICAgICAgICByZXR1cm4gcmV0Ow0KICAgICAgICB9DQoNCiAgICAgICAgX3VuaXF1ZSgpew0KICAgICAgICAgICAgbGV0IF9fdG9TdHJpbmcgPSAnTm9kZV9Db250ZXh0Ll91bmlxdWUoKTogJzsNCiAgICAgICAgDQogICAgICAgICAgICBsZXQgcmV0ID0gbmV3IHVuZGVmaW5lZCgpOw0KICAgICAgICAgICAgaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDsNCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZih0aGlzLmNvZGUoKSkhPT0ndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpOw0KICAgIA0KICAgICAgICAgICAgcmV0dXJuIHJldDsNCiAgICAgICAgfQ0KDQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE5vZGVfQ29udGV4dC5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHN0b3JlKF9fZXZlbnQpew0KICAgICAgICAgICAgbGV0IF9fdG9TdHJpbmcgPSAnTm9kZV9Db250ZXh0LnN0b3JlKCk6ICc7DQoNCiAgICAgICAgICAgIGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7DQoNCiAgICAgICAgICAgIHZhciBub2RlID0gbmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5Ob2RlKCkuY29kZShncy5nZXRQcm9wZXJ0eSgnaW5zdGFuY2VfbmFtZScpKTsNCiAgICAgICAgICAgIGxldCBfX3Jlc3BvbnNlID0gbmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5FdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytuZXcgRGF0ZShuZXcgR2xpZGVEYXRlVGltZSgpKS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKSsnXS5Ob2RlX0NvbnRleHQuc3RvcmUoKScpLm1ldGhvZCgnc3RvcmUnKS5jbGFzc05hbWUoJ05vZGVfQ29udGV4dCcpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpOw0KDQogICAgICAgICAgICBsZXQgZXZKU09OID0gbnVsbDsNCiAgICAgICAgICAgIGlmKF9fZXZlbnQpew0KICAgICAgICAgICAgICAgIGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgICAgIGlmKHR5cGVvZihldkpTT04uX190aGlzKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpOw0KICAgICAgICANCg0KDQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAvL19fcmVzcG9uc2UucmVjaXBpZW50KG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uTm9kZSgpLmNvZGUoJ3BhcmVudCcpKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoX19ldmVudCAmJiAhX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KDQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgaWYoX19ldmVudCAmJiBfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBhbnN3ZXIgPSBOb2RlX0NvbnRleHQoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKCFfX2V2ZW50KXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBzdG9yZSBsb2NhbGx5DQogICAgICAgICAgICAgICAgbGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCdOb2RlX0NvbnRleHQnKTsNCg0KICAgICAgICAgICAgICAgIGxldCBfdGhpcyA9IHRoaXMuX3VuaXF1ZSgpLmZpbmQoKTsNCiAgICAgICAgICAgICAgICBpZighX3RoaXMpIGdyLnNldE5ld0d1aWRWYWx1ZSh0aGlzLklkIHx8ICh0aGlzLklkID0gZ3Iuc2V0TmV3R3VpZCgpKSk7DQogICAgICAgICAgICAgICAgaWYoX3RoaXMgJiYgdHlwZW9mKF90aGlzLklkKSE9PSd1bmRlZmluZWQnKSBnci5nZXQoX3RoaXMuSWQpOw0KDQogICAgICAgICAgICAgICAgbGV0IGJTZXQgPSBmYWxzZTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgaWYoX3RoaXMgJiYgdHlwZW9mKF90aGlzLmdldGNvZGUoKSkhPT0ndW5kZWZpbmVkJykgYlNldCA9IGdyLnNldFZhbHVlKCdjb2RlJywgX3RoaXMuZ2V0Y29kZSgpKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgaWYoYlNldCl7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuSWQgPSBnci51cGRhdGUoKTsNCiAgICAgICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgInRoaXMuSWQgPSAiICsgdGhpcy5JZCk7DQogICAgICAgICAgICAgICAgICAgIGlmKCFhbnN3ZXIpIGFuc3dlciA9IHRoaXM7DQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJpbnZhbGlkIG9iamVjdCIpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICANCg0KICAgICAgICAgICAgfQ0KDQoNCg0KDQogICAgICAgICAgICBpZighX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGlmKGFuc3dlcil7DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoe19fdGhpczogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICByZXR1cm4gYW5zd2VyOw0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE5vZGVfQ29udGV4dC5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgZmluZEFsbChfX2V2ZW50KXsNCiAgICAgICAgICAgIGxldCBfX3RvU3RyaW5nID0gJ05vZGVfQ29udGV4dC5maW5kQWxsKCk6ICc7DQoNCiAgICAgICAgICAgIGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7DQoNCiAgICAgICAgICAgIHZhciBub2RlID0gbmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5Ob2RlKCkuY29kZShncy5nZXRQcm9wZXJ0eSgnaW5zdGFuY2VfbmFtZScpKTsNCiAgICAgICAgICAgIGxldCBfX3Jlc3BvbnNlID0gbmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5FdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytuZXcgRGF0ZShuZXcgR2xpZGVEYXRlVGltZSgpKS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKSsnXS5Ob2RlX0NvbnRleHQuZmluZEFsbCgpJykubWV0aG9kKCdmaW5kQWxsJykuY2xhc3NOYW1lKCdOb2RlX0NvbnRleHQnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKTsNCg0KICAgICAgICAgICAgbGV0IGV2SlNPTiA9IG51bGw7DQogICAgICAgICAgICBpZihfX2V2ZW50KXsNCiAgICAgICAgICAgICAgICBldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgICAgICBpZih0eXBlb2YoZXZKU09OLl9fdGhpcykhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTsNCiAgICAgICAgDQoNCg0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgLy9fX3Jlc3BvbnNlLnJlY2lwaWVudChuZXcgZXNwdGVzdC5jb20ubmFtbW91ci5kY29tLk5vZGUoKS5jb2RlKCdwYXJlbnQnKSk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKF9fZXZlbnQgJiYgIV9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCg0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgIGlmKF9fZXZlbnQgJiYgX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgYW5zd2VyID0gTm9kZV9Db250ZXh0KCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZighX19ldmVudCl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KDQoNCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBpZihhbnN3ZXIpew0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHtfX3RoaXM6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcmV0dXJuIGFuc3dlcjsNCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBOb2RlX0NvbnRleHQuZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGZpbmQoX19ldmVudCl7DQogICAgICAgICAgICBsZXQgX190b1N0cmluZyA9ICdOb2RlX0NvbnRleHQuZmluZCgpOiAnOw0KDQogICAgICAgICAgICBsZXQgYW5zd2VyID0gdW5kZWZpbmVkOw0KDQogICAgICAgICAgICB2YXIgbm9kZSA9IG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uTm9kZSgpLmNvZGUoZ3MuZ2V0UHJvcGVydHkoJ2luc3RhbmNlX25hbWUnKSk7DQogICAgICAgICAgICBsZXQgX19yZXNwb25zZSA9IG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrbmV3IERhdGUobmV3IEdsaWRlRGF0ZVRpbWUoKSkudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJykrJ10uTm9kZV9Db250ZXh0LmZpbmQoKScpLm1ldGhvZCgnZmluZCcpLmNsYXNzTmFtZSgnTm9kZV9Db250ZXh0JykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSk7DQoNCiAgICAgICAgICAgIGxldCBldkpTT04gPSBudWxsOw0KICAgICAgICAgICAgaWYoX19ldmVudCl7DQogICAgICAgICAgICAgICAgZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICAgICAgaWYodHlwZW9mKGV2SlNPTi5fX3RoaXMpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgICAgICB0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7DQogICAgICAgIA0KDQoNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIC8vX19yZXNwb25zZS5yZWNpcGllbnQobmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5Ob2RlKCkuY29kZSgncGFyZW50JykpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZihfX2V2ZW50ICYmICFfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQoNCiAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICBpZihfX2V2ZW50ICYmIF9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGFuc3dlciA9IE5vZGVfQ29udGV4dCgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIA0KDQogICAgICAgICAgICB9DQoNCg0KDQoNCiAgICAgICAgICAgIGlmKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgaWYoYW5zd2VyKXsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7X190aGlzOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHJldHVybiBhbnN3ZXI7DQogICAgICAgIH0NCiAgICANCiAgICB9Ow0KDQogICAgZXNwdGVzdC5jb20gPSBlc3B0ZXN0LmNvbSB8fCB7fTtlc3B0ZXN0LmNvbS5uYW1tb3VyID0gZXNwdGVzdC5jb20ubmFtbW91ciB8fCB7fTtlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20gPSBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20gfHwge307DQogICAgZXNwdGVzdC5jb20ubmFtbW91ci5kY29tLk5vZGVfR3JvdXAgPSBjbGFzcyB7DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE5vZGVfR3JvdXAuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgYWN0aXZlKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX2FjdGl2ZSA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fYWN0aXZlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE5vZGVfR3JvdXAuZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGVuYWJsZWQodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fZW5hYmxlZCA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZW5hYmxlZDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBOb2RlX0dyb3VwLmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBjb2RlKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX2NvZGUgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2NvZGU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTm9kZV9Hcm91cC5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIG9yZGVyKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX29yZGVyID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9vcmRlcjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBOb2RlX0dyb3VwLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBkYXRlKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX2RhdGUgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2RhdGU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTm9kZV9Hcm91cC5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgbmFtZSh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9uYW1lID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9uYW1lOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE5vZGVfR3JvdXAucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgcmVtYXJrKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX3JlbWFyayA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fcmVtYXJrOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgDQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE5vZGVfR3JvdXAuZ3JvdXBfTm9kZXMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBncm91cF9Ob2Rlcyh2KXsNCiAgICAgICAgfQ0KICAgIA0KICAgIA0KICAgICAgICBfZnJvbURvY3VtZW50KG9iail7DQogICAgICAgICAgICBsZXQgX190b1N0cmluZyA9ICdOb2RlX0dyb3VwLl9mcm9tRG9jdW1lbnQoKTogJzsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgaWYoIW9iaikgcmV0dXJuIHRoaXM7DQoNCiAgICAgICAgICAgIC8vaWYgaXNpbnN0YW5jZShvYmosIGJ5dGVzKTogb2JqID0gc3RyKG9iaiwgInV0Zi04Iik7DQoNCiAgICAgICAgICAgIGlmKHR5cGVvZihvYmopPT09J3N0cmluZycpew0KICAgICAgICAgICAgICAgIGlmKG5ldyBSZWdFeHAoIigoKFtBLVphLXpdezMsOX06KD86Ly8pPykoPzpbLTs6Jj0rJCx3XStAKT9bQS1aYS16MC05Li1dK3woPzp3d3cufFstOzomPSskLHddK0ApW0EtWmEtejAtOS4tXSspKCg/Oi9bK34lLy53LV9dKik/Pz8oPzpbLSs9JjslQC53X10qKSM/KD86W3ddKikpPykiKS50ZXN0KG9iaikpew0KICAgICAgICAgICAgICAgICAgICBsZXQgcmVxdWVzdCA9IG5ldyBzbl93cy5SRVNUTWVzc2FnZVYyKCk7DQogICAgICAgICAgICAgICAgICAgIHJlcXVlc3Quc2V0SHR0cE1ldGhvZCgnR0VUJyk7DQogICAgICAgICAgICAgICAgICAgIHJlcXVlc3Quc2V0RW5kcG9pbnQob2JqKTsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChyZXF1ZXN0LmV4ZWN1dGUoKS5nZXRCb2R5KCkpOw0KICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KEpTT04ucGFyc2Uob2JqKSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgIGlmKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obyl7cmV0dXJuIG5ldyBOb2RlX0dyb3VwKCkuX2Zyb21Eb2N1bWVudChvKX0pOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBpZih0eXBlb2Yob2JqLklkKSE9PSd1bmRlZmluZWQnKSB0aGlzLklkID0gb2JqLklkOw0KDQogICAgDQogICAgICAgICAgICBpZih0eXBlb2Yob2JqLmFjdGl2ZSkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKG9iai5lbmFibGVkKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZihvYmouY29kZSkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5jb2RlKG9iai5jb2RlKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2Yob2JqLm9yZGVyKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLm9yZGVyKG9iai5vcmRlcik7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKG9iai5kYXRlKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLmRhdGUob2JqLmRhdGUpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICB0aGlzLmRhdGUobmV3IEdsaWRlRGF0ZVRpbWUodGhpcy5kYXRlKCkpKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2Yob2JqLm5hbWUpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMubmFtZShvYmoubmFtZSk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKG9iai5yZW1hcmspIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMucmVtYXJrKG9iai5yZW1hcmspOw0KICAgICAgICANCiAgICAgICAgICAgICAgICB0aGlzLnJlbWFyayhHbGlkZVN0cmluZ1V0aWwuYmFzZTY0RGVjb2RlKHRoaXMucmVtYXJrKCkpKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQoNCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZihvYmouZ3JvdXBfTm9kZXMpIT09J3VuZGVmaW5lZCcpIHRoaXMuZ3JvdXBfTm9kZXMobmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5Ob2RlKCkuX2Zyb21Eb2N1bWVudChvYmouZ3JvdXBfZ3JvdXBfTm9kZXMpKTsNCiAgICANCg0KICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgIH0NCg0KICAgICAgICBfdG9Eb2N1bWVudCgpew0KICAgICAgICAgICAgbGV0IF9fdG9TdHJpbmcgPSAnTm9kZV9Hcm91cC5fdG9Eb2N1bWVudCgpOiAnOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBsZXQgcmV0ID0ge307DQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5JZCkhPT0ndW5kZWZpbmVkJykgcmV0LklkID0gdGhpcy5JZDsNCg0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMuX2FjdGl2ZSkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgcmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMuX2VuYWJsZWQpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHJldC5lbmFibGVkID0gdGhpcy5lbmFibGVkKCk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMuX2NvZGUpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHJldC5jb2RlID0gdGhpcy5jb2RlKCk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMuX29yZGVyKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICByZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMuX2RhdGUpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHJldC5kYXRlID0gdGhpcy5kYXRlKCk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGlmKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS5nZXROdW1lcmljVmFsdWUpPT09J2Z1bmN0aW9uJykgcmV0LmRhdGUgPSBuZXcgRGF0ZShyZXQuZGF0ZS5nZXROdW1lcmljVmFsdWUoKSkudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMuX25hbWUpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHJldC5uYW1lID0gdGhpcy5uYW1lKCk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMuX3JlbWFyaykhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgcmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGlmKHR5cGVvZihyZXQucmVtYXJrKCkpPT09J29iamVjdCcpIHJldC5yZW1hcmsgPSBHbGlkZVN0cmluZ1V0aWwuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5yZW1hcmspKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgIA0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMuZ3JvdXBfTm9kZXMoKSkhPT0ndW5kZWZpbmVkJykgcmV0Lmdyb3VwX05vZGVzID0gc2VsZi5ncm91cF9ncm91cF9Ob2RlcygpLm1hcChmdW5jdGlvbih0YSl7cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7fSk7DQogICAgDQogICAgICAgICAgICByZXR1cm4gcmV0Ow0KICAgICAgICB9DQoNCiAgICAgICAgX3VuaXF1ZSgpew0KICAgICAgICAgICAgbGV0IF9fdG9TdHJpbmcgPSAnTm9kZV9Hcm91cC5fdW5pcXVlKCk6ICc7DQogICAgICAgIA0KICAgICAgICAgICAgbGV0IHJldCA9IG5ldyB1bmRlZmluZWQoKTsNCiAgICAgICAgICAgIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5uYW1lKCkpIT09J3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTsNCiAgICANCiAgICAgICAgICAgIHJldHVybiByZXQ7DQogICAgICAgIH0NCg0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBOb2RlX0dyb3VwLnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgc3RvcmUoX19ldmVudCl7DQogICAgICAgICAgICBsZXQgX190b1N0cmluZyA9ICdOb2RlX0dyb3VwLnN0b3JlKCk6ICc7DQoNCiAgICAgICAgICAgIGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7DQoNCiAgICAgICAgICAgIHZhciBub2RlID0gbmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5Ob2RlKCkuY29kZShncy5nZXRQcm9wZXJ0eSgnaW5zdGFuY2VfbmFtZScpKTsNCiAgICAgICAgICAgIGxldCBfX3Jlc3BvbnNlID0gbmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5FdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytuZXcgRGF0ZShuZXcgR2xpZGVEYXRlVGltZSgpKS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKSsnXS5Ob2RlX0dyb3VwLnN0b3JlKCknKS5tZXRob2QoJ3N0b3JlJykuY2xhc3NOYW1lKCdOb2RlX0dyb3VwJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSk7DQoNCiAgICAgICAgICAgIGxldCBldkpTT04gPSBudWxsOw0KICAgICAgICAgICAgaWYoX19ldmVudCl7DQogICAgICAgICAgICAgICAgZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICAgICAgaWYodHlwZW9mKGV2SlNPTi5fX3RoaXMpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgICAgICB0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7DQogICAgICAgIA0KDQoNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIC8vX19yZXNwb25zZS5yZWNpcGllbnQobmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5Ob2RlKCkuY29kZSgncGFyZW50JykpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZihfX2V2ZW50ICYmICFfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQoNCiAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICBpZihfX2V2ZW50ICYmIF9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGFuc3dlciA9IE5vZGVfR3JvdXAoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKCFfX2V2ZW50KXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBzdG9yZSBsb2NhbGx5DQogICAgICAgICAgICAgICAgbGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCdOb2RlX0dyb3VwJyk7DQoNCiAgICAgICAgICAgICAgICBsZXQgX3RoaXMgPSB0aGlzLl91bmlxdWUoKS5maW5kKCk7DQogICAgICAgICAgICAgICAgaWYoIV90aGlzKSBnci5zZXROZXdHdWlkVmFsdWUodGhpcy5JZCB8fCAodGhpcy5JZCA9IGdyLnNldE5ld0d1aWQoKSkpOw0KICAgICAgICAgICAgICAgIGlmKF90aGlzICYmIHR5cGVvZihfdGhpcy5JZCkhPT0ndW5kZWZpbmVkJykgZ3IuZ2V0KF90aGlzLklkKTsNCg0KICAgICAgICAgICAgICAgIGxldCBiU2V0ID0gZmFsc2U7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGlmKF90aGlzICYmIHR5cGVvZihfdGhpcy5nZXRuYW1lKCkpIT09J3VuZGVmaW5lZCcpIGJTZXQgPSBnci5zZXRWYWx1ZSgnbmFtZScsIF90aGlzLmdldG5hbWUoKSk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGlmKGJTZXQpew0KICAgICAgICAgICAgICAgICAgICB0aGlzLklkID0gZ3IudXBkYXRlKCk7DQogICAgICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJ0aGlzLklkID0gIiArIHRoaXMuSWQpOw0KICAgICAgICAgICAgICAgICAgICBpZighYW5zd2VyKSBhbnN3ZXIgPSB0aGlzOw0KICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiaW52YWxpZCBvYmplY3QiKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KDQoNCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBpZihhbnN3ZXIpew0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHtfX3RoaXM6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcmV0dXJuIGFuc3dlcjsNCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBOb2RlX0dyb3VwLmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBmaW5kQWxsKF9fZXZlbnQpew0KICAgICAgICAgICAgbGV0IF9fdG9TdHJpbmcgPSAnTm9kZV9Hcm91cC5maW5kQWxsKCk6ICc7DQoNCiAgICAgICAgICAgIGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7DQoNCiAgICAgICAgICAgIHZhciBub2RlID0gbmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5Ob2RlKCkuY29kZShncy5nZXRQcm9wZXJ0eSgnaW5zdGFuY2VfbmFtZScpKTsNCiAgICAgICAgICAgIGxldCBfX3Jlc3BvbnNlID0gbmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5FdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytuZXcgRGF0ZShuZXcgR2xpZGVEYXRlVGltZSgpKS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKSsnXS5Ob2RlX0dyb3VwLmZpbmRBbGwoKScpLm1ldGhvZCgnZmluZEFsbCcpLmNsYXNzTmFtZSgnTm9kZV9Hcm91cCcpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpOw0KDQogICAgICAgICAgICBsZXQgZXZKU09OID0gbnVsbDsNCiAgICAgICAgICAgIGlmKF9fZXZlbnQpew0KICAgICAgICAgICAgICAgIGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgICAgIGlmKHR5cGVvZihldkpTT04uX190aGlzKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpOw0KICAgICAgICANCg0KDQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAvL19fcmVzcG9uc2UucmVjaXBpZW50KG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uTm9kZSgpLmNvZGUoJ3BhcmVudCcpKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoX19ldmVudCAmJiAhX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KDQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgaWYoX19ldmVudCAmJiBfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBhbnN3ZXIgPSBOb2RlX0dyb3VwKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZighX19ldmVudCl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KDQoNCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBpZihhbnN3ZXIpew0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHtfX3RoaXM6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcmV0dXJuIGFuc3dlcjsNCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBOb2RlX0dyb3VwLmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBmaW5kKF9fZXZlbnQpew0KICAgICAgICAgICAgbGV0IF9fdG9TdHJpbmcgPSAnTm9kZV9Hcm91cC5maW5kKCk6ICc7DQoNCiAgICAgICAgICAgIGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7DQoNCiAgICAgICAgICAgIHZhciBub2RlID0gbmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5Ob2RlKCkuY29kZShncy5nZXRQcm9wZXJ0eSgnaW5zdGFuY2VfbmFtZScpKTsNCiAgICAgICAgICAgIGxldCBfX3Jlc3BvbnNlID0gbmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5FdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytuZXcgRGF0ZShuZXcgR2xpZGVEYXRlVGltZSgpKS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKSsnXS5Ob2RlX0dyb3VwLmZpbmQoKScpLm1ldGhvZCgnZmluZCcpLmNsYXNzTmFtZSgnTm9kZV9Hcm91cCcpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpOw0KDQogICAgICAgICAgICBsZXQgZXZKU09OID0gbnVsbDsNCiAgICAgICAgICAgIGlmKF9fZXZlbnQpew0KICAgICAgICAgICAgICAgIGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgICAgIGlmKHR5cGVvZihldkpTT04uX190aGlzKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpOw0KICAgICAgICANCg0KDQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAvL19fcmVzcG9uc2UucmVjaXBpZW50KG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uTm9kZSgpLmNvZGUoJ3BhcmVudCcpKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoX19ldmVudCAmJiAhX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KDQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgaWYoX19ldmVudCAmJiBfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBhbnN3ZXIgPSBOb2RlX0dyb3VwKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZighX19ldmVudCl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KDQoNCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBpZihhbnN3ZXIpew0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHtfX3RoaXM6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcmV0dXJuIGFuc3dlcjsNCiAgICAgICAgfQ0KICAgIA0KICAgIH07DQoNCiAgICBlc3B0ZXN0LmNvbSA9IGVzcHRlc3QuY29tIHx8IHt9O2VzcHRlc3QuY29tLm5hbW1vdXIgPSBlc3B0ZXN0LmNvbS5uYW1tb3VyIHx8IHt9O2VzcHRlc3QuY29tLm5hbW1vdXIuZGNvbSA9IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbSB8fCB7fTsNCiAgICBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uTm9kZV9UeXBlID0gY2xhc3Mgew0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBOb2RlX1R5cGUuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgYWN0aXZlKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX2FjdGl2ZSA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fYWN0aXZlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE5vZGVfVHlwZS5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgZW5hYmxlZCh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9lbmFibGVkID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9lbmFibGVkOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE5vZGVfVHlwZS5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgY29kZSh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9jb2RlID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9jb2RlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE5vZGVfVHlwZS5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIG9yZGVyKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX29yZGVyID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9vcmRlcjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBOb2RlX1R5cGUuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGRhdGUodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fZGF0ZSA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZGF0ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBOb2RlX1R5cGUubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIG5hbWUodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fbmFtZSA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fbmFtZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBOb2RlX1R5cGUucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgcmVtYXJrKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX3JlbWFyayA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fcmVtYXJrOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE5vZGVfVHlwZS5keW5hbWljIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgZHluYW1pYyh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9keW5hbWljID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9keW5hbWljOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgDQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE5vZGVfVHlwZS50eXBlX05vZGVzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgdHlwZV9Ob2Rlcyh2KXsNCiAgICAgICAgfQ0KICAgIA0KICAgIA0KICAgICAgICBfZnJvbURvY3VtZW50KG9iail7DQogICAgICAgICAgICBsZXQgX190b1N0cmluZyA9ICdOb2RlX1R5cGUuX2Zyb21Eb2N1bWVudCgpOiAnOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBpZighb2JqKSByZXR1cm4gdGhpczsNCg0KICAgICAgICAgICAgLy9pZiBpc2luc3RhbmNlKG9iaiwgYnl0ZXMpOiBvYmogPSBzdHIob2JqLCAidXRmLTgiKTsNCg0KICAgICAgICAgICAgaWYodHlwZW9mKG9iaik9PT0nc3RyaW5nJyl7DQogICAgICAgICAgICAgICAgaWYobmV3IFJlZ0V4cCgiKCgoW0EtWmEtel17Myw5fTooPzovLyk/KSg/OlstOzomPSskLHddK0ApP1tBLVphLXowLTkuLV0rfCg/Ond3dy58Wy07OiY9KyQsd10rQClbQS1aYS16MC05Li1dKykoKD86L1srfiUvLnctX10qKT8/Pyg/OlstKz0mOyVALndfXSopIz8oPzpbd10qKSk/KSIpLnRlc3Qob2JqKSl7DQogICAgICAgICAgICAgICAgICAgIGxldCByZXF1ZXN0ID0gbmV3IHNuX3dzLlJFU1RNZXNzYWdlVjIoKTsNCiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdC5zZXRIdHRwTWV0aG9kKCdHRVQnKTsNCiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdC5zZXRFbmRwb2ludChvYmopOw0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHJlcXVlc3QuZXhlY3V0ZSgpLmdldEJvZHkoKSk7DQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoSlNPTi5wYXJzZShvYmopKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgaWYoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKXtyZXR1cm4gbmV3IE5vZGVfVHlwZSgpLl9mcm9tRG9jdW1lbnQobyl9KTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKG9iai5JZCkhPT0ndW5kZWZpbmVkJykgdGhpcy5JZCA9IG9iai5JZDsNCg0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKG9iai5hY3RpdmUpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZihvYmouZW5hYmxlZCkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2Yob2JqLmNvZGUpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuY29kZShvYmouY29kZSk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKG9iai5vcmRlcikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5vcmRlcihvYmoub3JkZXIpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZihvYmouZGF0ZSkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5kYXRlKG9iai5kYXRlKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgdGhpcy5kYXRlKG5ldyBHbGlkZURhdGVUaW1lKHRoaXMuZGF0ZSgpKSk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKG9iai5uYW1lKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLm5hbWUob2JqLm5hbWUpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZihvYmoucmVtYXJrKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLnJlbWFyayhvYmoucmVtYXJrKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgdGhpcy5yZW1hcmsoR2xpZGVTdHJpbmdVdGlsLmJhc2U2NERlY29kZSh0aGlzLnJlbWFyaygpKSk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKG9iai5keW5hbWljKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLmR5bmFtaWMob2JqLmR5bmFtaWMpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCg0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKG9iai50eXBlX05vZGVzKSE9PSd1bmRlZmluZWQnKSB0aGlzLnR5cGVfTm9kZXMobmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5Ob2RlKCkuX2Zyb21Eb2N1bWVudChvYmoudHlwZV90eXBlX05vZGVzKSk7DQogICAgDQoNCiAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICB9DQoNCiAgICAgICAgX3RvRG9jdW1lbnQoKXsNCiAgICAgICAgICAgIGxldCBfX3RvU3RyaW5nID0gJ05vZGVfVHlwZS5fdG9Eb2N1bWVudCgpOiAnOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBsZXQgcmV0ID0ge307DQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5JZCkhPT0ndW5kZWZpbmVkJykgcmV0LklkID0gdGhpcy5JZDsNCg0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMuX2FjdGl2ZSkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgcmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMuX2VuYWJsZWQpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHJldC5lbmFibGVkID0gdGhpcy5lbmFibGVkKCk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMuX2NvZGUpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHJldC5jb2RlID0gdGhpcy5jb2RlKCk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMuX29yZGVyKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICByZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMuX2RhdGUpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHJldC5kYXRlID0gdGhpcy5kYXRlKCk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGlmKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS5nZXROdW1lcmljVmFsdWUpPT09J2Z1bmN0aW9uJykgcmV0LmRhdGUgPSBuZXcgRGF0ZShyZXQuZGF0ZS5nZXROdW1lcmljVmFsdWUoKSkudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMuX25hbWUpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHJldC5uYW1lID0gdGhpcy5uYW1lKCk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMuX3JlbWFyaykhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgcmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGlmKHR5cGVvZihyZXQucmVtYXJrKCkpPT09J29iamVjdCcpIHJldC5yZW1hcmsgPSBHbGlkZVN0cmluZ1V0aWwuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5yZW1hcmspKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5fZHluYW1pYykhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgcmV0LmR5bmFtaWMgPSB0aGlzLmR5bmFtaWMoKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgIA0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMudHlwZV9Ob2RlcygpKSE9PSd1bmRlZmluZWQnKSByZXQudHlwZV9Ob2RlcyA9IHNlbGYudHlwZV90eXBlX05vZGVzKCkubWFwKGZ1bmN0aW9uKHRhKXtyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTt9KTsNCiAgICANCiAgICAgICAgICAgIHJldHVybiByZXQ7DQogICAgICAgIH0NCg0KICAgICAgICBfdW5pcXVlKCl7DQogICAgICAgICAgICBsZXQgX190b1N0cmluZyA9ICdOb2RlX1R5cGUuX3VuaXF1ZSgpOiAnOw0KICAgICAgICANCiAgICAgICAgICAgIGxldCByZXQgPSBuZXcgdW5kZWZpbmVkKCk7DQogICAgICAgICAgICBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkOw0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMubmFtZSgpKSE9PSd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7DQogICAgDQogICAgICAgICAgICByZXR1cm4gcmV0Ow0KICAgICAgICB9DQoNCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTm9kZV9UeXBlLnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgc3RvcmUoX19ldmVudCl7DQogICAgICAgICAgICBsZXQgX190b1N0cmluZyA9ICdOb2RlX1R5cGUuc3RvcmUoKTogJzsNCg0KICAgICAgICAgICAgbGV0IGFuc3dlciA9IHVuZGVmaW5lZDsNCg0KICAgICAgICAgICAgdmFyIG5vZGUgPSBuZXcgZXNwdGVzdC5jb20ubmFtbW91ci5kY29tLk5vZGUoKS5jb2RlKGdzLmdldFByb3BlcnR5KCdpbnN0YW5jZV9uYW1lJykpOw0KICAgICAgICAgICAgbGV0IF9fcmVzcG9uc2UgPSBuZXcgZXNwdGVzdC5jb20ubmFtbW91ci5kY29tLkV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK25ldyBEYXRlKG5ldyBHbGlkZURhdGVUaW1lKCkpLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpKyddLk5vZGVfVHlwZS5zdG9yZSgpJykubWV0aG9kKCdzdG9yZScpLmNsYXNzTmFtZSgnTm9kZV9UeXBlJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSk7DQoNCiAgICAgICAgICAgIGxldCBldkpTT04gPSBudWxsOw0KICAgICAgICAgICAgaWYoX19ldmVudCl7DQogICAgICAgICAgICAgICAgZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICAgICAgaWYodHlwZW9mKGV2SlNPTi5fX3RoaXMpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgICAgICB0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7DQogICAgICAgIA0KDQoNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIC8vX19yZXNwb25zZS5yZWNpcGllbnQobmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5Ob2RlKCkuY29kZSgncGFyZW50JykpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZihfX2V2ZW50ICYmICFfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQoNCiAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICBpZihfX2V2ZW50ICYmIF9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGFuc3dlciA9IE5vZGVfVHlwZSgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIHN0b3JlIGxvY2FsbHkNCiAgICAgICAgICAgICAgICBsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ05vZGVfVHlwZScpOw0KDQogICAgICAgICAgICAgICAgbGV0IF90aGlzID0gdGhpcy5fdW5pcXVlKCkuZmluZCgpOw0KICAgICAgICAgICAgICAgIGlmKCFfdGhpcykgZ3Iuc2V0TmV3R3VpZFZhbHVlKHRoaXMuSWQgfHwgKHRoaXMuSWQgPSBnci5zZXROZXdHdWlkKCkpKTsNCiAgICAgICAgICAgICAgICBpZihfdGhpcyAmJiB0eXBlb2YoX3RoaXMuSWQpIT09J3VuZGVmaW5lZCcpIGdyLmdldChfdGhpcy5JZCk7DQoNCiAgICAgICAgICAgICAgICBsZXQgYlNldCA9IGZhbHNlOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBpZihfdGhpcyAmJiB0eXBlb2YoX3RoaXMuZ2V0bmFtZSgpKSE9PSd1bmRlZmluZWQnKSBiU2V0ID0gZ3Iuc2V0VmFsdWUoJ25hbWUnLCBfdGhpcy5nZXRuYW1lKCkpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBpZihiU2V0KXsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5JZCA9IGdyLnVwZGF0ZSgpOw0KICAgICAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAidGhpcy5JZCA9ICIgKyB0aGlzLklkKTsNCiAgICAgICAgICAgICAgICAgICAgaWYoIWFuc3dlcikgYW5zd2VyID0gdGhpczsNCiAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImludmFsaWQgb2JqZWN0Iik7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIA0KDQogICAgICAgICAgICB9DQoNCg0KDQoNCiAgICAgICAgICAgIGlmKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgaWYoYW5zd2VyKXsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7X190aGlzOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHJldHVybiBhbnN3ZXI7DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTm9kZV9UeXBlLmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBmaW5kQWxsKF9fZXZlbnQpew0KICAgICAgICAgICAgbGV0IF9fdG9TdHJpbmcgPSAnTm9kZV9UeXBlLmZpbmRBbGwoKTogJzsNCg0KICAgICAgICAgICAgbGV0IGFuc3dlciA9IHVuZGVmaW5lZDsNCg0KICAgICAgICAgICAgdmFyIG5vZGUgPSBuZXcgZXNwdGVzdC5jb20ubmFtbW91ci5kY29tLk5vZGUoKS5jb2RlKGdzLmdldFByb3BlcnR5KCdpbnN0YW5jZV9uYW1lJykpOw0KICAgICAgICAgICAgbGV0IF9fcmVzcG9uc2UgPSBuZXcgZXNwdGVzdC5jb20ubmFtbW91ci5kY29tLkV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK25ldyBEYXRlKG5ldyBHbGlkZURhdGVUaW1lKCkpLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpKyddLk5vZGVfVHlwZS5maW5kQWxsKCknKS5tZXRob2QoJ2ZpbmRBbGwnKS5jbGFzc05hbWUoJ05vZGVfVHlwZScpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpOw0KDQogICAgICAgICAgICBsZXQgZXZKU09OID0gbnVsbDsNCiAgICAgICAgICAgIGlmKF9fZXZlbnQpew0KICAgICAgICAgICAgICAgIGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgICAgIGlmKHR5cGVvZihldkpTT04uX190aGlzKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpOw0KICAgICAgICANCg0KDQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAvL19fcmVzcG9uc2UucmVjaXBpZW50KG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uTm9kZSgpLmNvZGUoJ3BhcmVudCcpKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoX19ldmVudCAmJiAhX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KDQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgaWYoX19ldmVudCAmJiBfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBhbnN3ZXIgPSBOb2RlX1R5cGUoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKCFfX2V2ZW50KXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICANCg0KICAgICAgICAgICAgfQ0KDQoNCg0KDQogICAgICAgICAgICBpZighX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGlmKGFuc3dlcil7DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoe19fdGhpczogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICByZXR1cm4gYW5zd2VyOw0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE5vZGVfVHlwZS5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgZmluZChfX2V2ZW50KXsNCiAgICAgICAgICAgIGxldCBfX3RvU3RyaW5nID0gJ05vZGVfVHlwZS5maW5kKCk6ICc7DQoNCiAgICAgICAgICAgIGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7DQoNCiAgICAgICAgICAgIHZhciBub2RlID0gbmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5Ob2RlKCkuY29kZShncy5nZXRQcm9wZXJ0eSgnaW5zdGFuY2VfbmFtZScpKTsNCiAgICAgICAgICAgIGxldCBfX3Jlc3BvbnNlID0gbmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5FdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytuZXcgRGF0ZShuZXcgR2xpZGVEYXRlVGltZSgpKS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKSsnXS5Ob2RlX1R5cGUuZmluZCgpJykubWV0aG9kKCdmaW5kJykuY2xhc3NOYW1lKCdOb2RlX1R5cGUnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKTsNCg0KICAgICAgICAgICAgbGV0IGV2SlNPTiA9IG51bGw7DQogICAgICAgICAgICBpZihfX2V2ZW50KXsNCiAgICAgICAgICAgICAgICBldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgICAgICBpZih0eXBlb2YoZXZKU09OLl9fdGhpcykhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTsNCiAgICAgICAgDQoNCg0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgLy9fX3Jlc3BvbnNlLnJlY2lwaWVudChuZXcgZXNwdGVzdC5jb20ubmFtbW91ci5kY29tLk5vZGUoKS5jb2RlKCdwYXJlbnQnKSk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKF9fZXZlbnQgJiYgIV9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCg0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgIGlmKF9fZXZlbnQgJiYgX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgYW5zd2VyID0gTm9kZV9UeXBlKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZighX19ldmVudCl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KDQoNCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBpZihhbnN3ZXIpew0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHtfX3RoaXM6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcmV0dXJuIGFuc3dlcjsNCiAgICAgICAgfQ0KICAgIA0KICAgIH07DQoNCiAgICBlc3B0ZXN0LmNvbSA9IGVzcHRlc3QuY29tIHx8IHt9O2VzcHRlc3QuY29tLm5hbW1vdXIgPSBlc3B0ZXN0LmNvbS5uYW1tb3VyIHx8IHt9O2VzcHRlc3QuY29tLm5hbW1vdXIuZGNvbSA9IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbSB8fCB7fTsNCiAgICBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uTWFwcGluZyA9IGNsYXNzIHsNCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTWFwcGluZy5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBhY3RpdmUodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fYWN0aXZlID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9hY3RpdmU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTWFwcGluZy5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgZW5hYmxlZCh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9lbmFibGVkID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9lbmFibGVkOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE1hcHBpbmcub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBvcmRlcih2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9vcmRlciA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fb3JkZXI7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTWFwcGluZy5jbGFzc05hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBjbGFzc05hbWUodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fY2xhc3NOYW1lID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9jbGFzc05hbWU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTWFwcGluZy5zY29wZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHNjb3BlKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX3Njb3BlID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9zY29wZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBNYXBwaW5nLmNvbnRleHQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBjb250ZXh0KHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX2NvbnRleHQgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2NvbnRleHQ7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTWFwcGluZy5zb3VyY2UgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBzb3VyY2Uodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fc291cmNlID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9zb3VyY2U7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTWFwcGluZy50YXJnZXQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICB0YXJnZXQodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fdGFyZ2V0ID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl90YXJnZXQ7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTWFwcGluZy5pblNjcmlwdCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGluU2NyaXB0KHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX2luU2NyaXB0ID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9pblNjcmlwdDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBNYXBwaW5nLm91dFNjcmlwdCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIG91dFNjcmlwdCh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9vdXRTY3JpcHQgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX291dFNjcmlwdDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBNYXBwaW5nLnRvb2wgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICB0b29sKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX3Rvb2wgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3Rvb2w7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTWFwcGluZy5ncm91cCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGdyb3VwKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX2dyb3VwID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9ncm91cDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBNYXBwaW5nLnR5cGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICB0eXBlKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX3R5cGUgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3R5cGU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICANCiAgICANCiAgICANCiAgICAgICAgX2Zyb21Eb2N1bWVudChvYmopew0KICAgICAgICAgICAgbGV0IF9fdG9TdHJpbmcgPSAnTWFwcGluZy5fZnJvbURvY3VtZW50KCk6ICc7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGlmKCFvYmopIHJldHVybiB0aGlzOw0KDQogICAgICAgICAgICAvL2lmIGlzaW5zdGFuY2Uob2JqLCBieXRlcyk6IG9iaiA9IHN0cihvYmosICJ1dGYtOCIpOw0KDQogICAgICAgICAgICBpZih0eXBlb2Yob2JqKT09PSdzdHJpbmcnKXsNCiAgICAgICAgICAgICAgICBpZihuZXcgUmVnRXhwKCIoKChbQS1aYS16XXszLDl9Oig/Oi8vKT8pKD86Wy07OiY9KyQsd10rQCk/W0EtWmEtejAtOS4tXSt8KD86d3d3LnxbLTs6Jj0rJCx3XStAKVtBLVphLXowLTkuLV0rKSgoPzovWyt+JS8udy1fXSopPz8/KD86Wy0rPSY7JUAud19dKikjPyg/Olt3XSopKT8pIikudGVzdChvYmopKXsNCiAgICAgICAgICAgICAgICAgICAgbGV0IHJlcXVlc3QgPSBuZXcgc25fd3MuUkVTVE1lc3NhZ2VWMigpOw0KICAgICAgICAgICAgICAgICAgICByZXF1ZXN0LnNldEh0dHBNZXRob2QoJ0dFVCcpOw0KICAgICAgICAgICAgICAgICAgICByZXF1ZXN0LnNldEVuZHBvaW50KG9iaik7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQocmVxdWVzdC5leGVjdXRlKCkuZ2V0Qm9keSgpKTsNCiAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChKU09OLnBhcnNlKG9iaikpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICBpZihBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pe3JldHVybiBuZXcgTWFwcGluZygpLl9mcm9tRG9jdW1lbnQobyl9KTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKG9iai5JZCkhPT0ndW5kZWZpbmVkJykgdGhpcy5JZCA9IG9iai5JZDsNCg0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKG9iai5hY3RpdmUpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZihvYmouZW5hYmxlZCkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2Yob2JqLm9yZGVyKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLm9yZGVyKG9iai5vcmRlcik7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKG9iai5jbGFzc05hbWUpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuY2xhc3NOYW1lKG9iai5jbGFzc05hbWUpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZihvYmouc2NvcGUpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuc2NvcGUob2JqLnNjb3BlKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2Yob2JqLmNvbnRleHQpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuY29udGV4dChvYmouY29udGV4dCk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKG9iai5zb3VyY2UpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuc291cmNlKG9iai5zb3VyY2UpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZihvYmoudGFyZ2V0KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLnRhcmdldChvYmoudGFyZ2V0KTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2Yob2JqLmluU2NyaXB0KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLmluU2NyaXB0KG9iai5pblNjcmlwdCk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIHRoaXMuaW5TY3JpcHQoR2xpZGVTdHJpbmdVdGlsLmJhc2U2NERlY29kZSh0aGlzLmluU2NyaXB0KCkpKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2Yob2JqLm91dFNjcmlwdCkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5vdXRTY3JpcHQob2JqLm91dFNjcmlwdCk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIHRoaXMub3V0U2NyaXB0KEdsaWRlU3RyaW5nVXRpbC5iYXNlNjREZWNvZGUodGhpcy5vdXRTY3JpcHQoKSkpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZihvYmoudG9vbCkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy50b29sKFRvb2woKS5fZnJvbURvY3VtZW50KG9iai50b29sKSk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKG9iai5ncm91cCkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5ncm91cChDb25maWdfR3JvdXAoKS5fZnJvbURvY3VtZW50KG9iai5ncm91cCkpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZihvYmoudHlwZSkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy50eXBlKFRvb2xfVHlwZSgpLl9mcm9tRG9jdW1lbnQob2JqLnR5cGUpKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQoNCiAgICANCg0KICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgIH0NCg0KICAgICAgICBfdG9Eb2N1bWVudCgpew0KICAgICAgICAgICAgbGV0IF9fdG9TdHJpbmcgPSAnTWFwcGluZy5fdG9Eb2N1bWVudCgpOiAnOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBsZXQgcmV0ID0ge307DQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5JZCkhPT0ndW5kZWZpbmVkJykgcmV0LklkID0gdGhpcy5JZDsNCg0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMuX2FjdGl2ZSkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgcmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMuX2VuYWJsZWQpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHJldC5lbmFibGVkID0gdGhpcy5lbmFibGVkKCk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMuX29yZGVyKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICByZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMuX2NsYXNzTmFtZSkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgcmV0LmNsYXNzTmFtZSA9IHRoaXMuY2xhc3NOYW1lKCk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMuX3Njb3BlKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICByZXQuc2NvcGUgPSB0aGlzLnNjb3BlKCk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMuX2NvbnRleHQpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHJldC5jb250ZXh0ID0gdGhpcy5jb250ZXh0KCk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMuX3NvdXJjZSkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgcmV0LnNvdXJjZSA9IHRoaXMuc291cmNlKCk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMuX3RhcmdldCkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgcmV0LnRhcmdldCA9IHRoaXMudGFyZ2V0KCk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMuX2luU2NyaXB0KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICByZXQuaW5TY3JpcHQgPSB0aGlzLmluU2NyaXB0KCk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGlmKHR5cGVvZihyZXQuaW5TY3JpcHQoKSk9PT0nb2JqZWN0JykgcmV0LmluU2NyaXB0ID0gR2xpZGVTdHJpbmdVdGlsLmJhc2U2NEVuY29kZShKU09OLnN0cmluZ2lmeShyZXQuaW5TY3JpcHQpKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5fb3V0U2NyaXB0KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICByZXQub3V0U2NyaXB0ID0gdGhpcy5vdXRTY3JpcHQoKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgaWYodHlwZW9mKHJldC5vdXRTY3JpcHQoKSk9PT0nb2JqZWN0JykgcmV0Lm91dFNjcmlwdCA9IEdsaWRlU3RyaW5nVXRpbC5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0Lm91dFNjcmlwdCkpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZih0aGlzLl90b29sKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICByZXQudG9vbCA9IHRoaXMudG9vbCgpLl90b0RvY3VtZW50KCk7DQogICAgICAgIA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMuX2dyb3VwKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICByZXQuZ3JvdXAgPSB0aGlzLmdyb3VwKCkuX3RvRG9jdW1lbnQoKTsNCiAgICAgICAgDQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5fdHlwZSkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgcmV0LnR5cGUgPSB0aGlzLnR5cGUoKS5fdG9Eb2N1bWVudCgpOw0KICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgDQogICAgDQogICAgICAgICAgICByZXR1cm4gcmV0Ow0KICAgICAgICB9DQoNCiAgICAgICAgX3VuaXF1ZSgpew0KICAgICAgICAgICAgbGV0IF9fdG9TdHJpbmcgPSAnTWFwcGluZy5fdW5pcXVlKCk6ICc7DQogICAgICAgIA0KICAgICAgICAgICAgbGV0IHJldCA9IG5ldyB1bmRlZmluZWQoKTsNCiAgICAgICAgICAgIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7DQogICAgDQogICAgICAgICAgICByZXR1cm4gcmV0Ow0KICAgICAgICB9DQoNCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTWFwcGluZy5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHN0b3JlKF9fZXZlbnQpew0KICAgICAgICAgICAgbGV0IF9fdG9TdHJpbmcgPSAnTWFwcGluZy5zdG9yZSgpOiAnOw0KDQogICAgICAgICAgICBsZXQgYW5zd2VyID0gdW5kZWZpbmVkOw0KDQogICAgICAgICAgICB2YXIgbm9kZSA9IG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uTm9kZSgpLmNvZGUoZ3MuZ2V0UHJvcGVydHkoJ2luc3RhbmNlX25hbWUnKSk7DQogICAgICAgICAgICBsZXQgX19yZXNwb25zZSA9IG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrbmV3IERhdGUobmV3IEdsaWRlRGF0ZVRpbWUoKSkudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJykrJ10uTWFwcGluZy5zdG9yZSgpJykubWV0aG9kKCdzdG9yZScpLmNsYXNzTmFtZSgnTWFwcGluZycpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpOw0KDQogICAgICAgICAgICBsZXQgZXZKU09OID0gbnVsbDsNCiAgICAgICAgICAgIGlmKF9fZXZlbnQpew0KICAgICAgICAgICAgICAgIGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgICAgIGlmKHR5cGVvZihldkpTT04uX190aGlzKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpOw0KICAgICAgICANCg0KDQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAvL19fcmVzcG9uc2UucmVjaXBpZW50KG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uTm9kZSgpLmNvZGUoJ3BhcmVudCcpKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoX19ldmVudCAmJiAhX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KDQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgaWYoX19ldmVudCAmJiBfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBhbnN3ZXIgPSBNYXBwaW5nKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZighX19ldmVudCl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgLy8gc3RvcmUgbG9jYWxseQ0KICAgICAgICAgICAgICAgIGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgnTWFwcGluZycpOw0KDQogICAgICAgICAgICAgICAgbGV0IF90aGlzID0gdGhpcy5fdW5pcXVlKCkuZmluZCgpOw0KICAgICAgICAgICAgICAgIGlmKCFfdGhpcykgZ3Iuc2V0TmV3R3VpZFZhbHVlKHRoaXMuSWQgfHwgKHRoaXMuSWQgPSBnci5zZXROZXdHdWlkKCkpKTsNCiAgICAgICAgICAgICAgICBpZihfdGhpcyAmJiB0eXBlb2YoX3RoaXMuSWQpIT09J3VuZGVmaW5lZCcpIGdyLmdldChfdGhpcy5JZCk7DQoNCiAgICAgICAgICAgICAgICBsZXQgYlNldCA9IGZhbHNlOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBpZihiU2V0KXsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5JZCA9IGdyLnVwZGF0ZSgpOw0KICAgICAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAidGhpcy5JZCA9ICIgKyB0aGlzLklkKTsNCiAgICAgICAgICAgICAgICAgICAgaWYoIWFuc3dlcikgYW5zd2VyID0gdGhpczsNCiAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImludmFsaWQgb2JqZWN0Iik7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIA0KDQogICAgICAgICAgICB9DQoNCg0KDQoNCiAgICAgICAgICAgIGlmKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgaWYoYW5zd2VyKXsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7X190aGlzOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHJldHVybiBhbnN3ZXI7DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTWFwcGluZy5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgZmluZEFsbChfX2V2ZW50KXsNCiAgICAgICAgICAgIGxldCBfX3RvU3RyaW5nID0gJ01hcHBpbmcuZmluZEFsbCgpOiAnOw0KDQogICAgICAgICAgICBsZXQgYW5zd2VyID0gdW5kZWZpbmVkOw0KDQogICAgICAgICAgICB2YXIgbm9kZSA9IG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uTm9kZSgpLmNvZGUoZ3MuZ2V0UHJvcGVydHkoJ2luc3RhbmNlX25hbWUnKSk7DQogICAgICAgICAgICBsZXQgX19yZXNwb25zZSA9IG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrbmV3IERhdGUobmV3IEdsaWRlRGF0ZVRpbWUoKSkudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJykrJ10uTWFwcGluZy5maW5kQWxsKCknKS5tZXRob2QoJ2ZpbmRBbGwnKS5jbGFzc05hbWUoJ01hcHBpbmcnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKTsNCg0KICAgICAgICAgICAgbGV0IGV2SlNPTiA9IG51bGw7DQogICAgICAgICAgICBpZihfX2V2ZW50KXsNCiAgICAgICAgICAgICAgICBldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgICAgICBpZih0eXBlb2YoZXZKU09OLl9fdGhpcykhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTsNCiAgICAgICAgDQoNCg0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgLy9fX3Jlc3BvbnNlLnJlY2lwaWVudChuZXcgZXNwdGVzdC5jb20ubmFtbW91ci5kY29tLk5vZGUoKS5jb2RlKCdwYXJlbnQnKSk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKF9fZXZlbnQgJiYgIV9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCg0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgIGlmKF9fZXZlbnQgJiYgX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgYW5zd2VyID0gTWFwcGluZygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIA0KDQogICAgICAgICAgICB9DQoNCg0KDQoNCiAgICAgICAgICAgIGlmKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgaWYoYW5zd2VyKXsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7X190aGlzOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHJldHVybiBhbnN3ZXI7DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTWFwcGluZy5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgZmluZChfX2V2ZW50KXsNCiAgICAgICAgICAgIGxldCBfX3RvU3RyaW5nID0gJ01hcHBpbmcuZmluZCgpOiAnOw0KDQogICAgICAgICAgICBsZXQgYW5zd2VyID0gdW5kZWZpbmVkOw0KDQogICAgICAgICAgICB2YXIgbm9kZSA9IG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uTm9kZSgpLmNvZGUoZ3MuZ2V0UHJvcGVydHkoJ2luc3RhbmNlX25hbWUnKSk7DQogICAgICAgICAgICBsZXQgX19yZXNwb25zZSA9IG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrbmV3IERhdGUobmV3IEdsaWRlRGF0ZVRpbWUoKSkudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJykrJ10uTWFwcGluZy5maW5kKCknKS5tZXRob2QoJ2ZpbmQnKS5jbGFzc05hbWUoJ01hcHBpbmcnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKTsNCg0KICAgICAgICAgICAgbGV0IGV2SlNPTiA9IG51bGw7DQogICAgICAgICAgICBpZihfX2V2ZW50KXsNCiAgICAgICAgICAgICAgICBldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgICAgICBpZih0eXBlb2YoZXZKU09OLl9fdGhpcykhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTsNCiAgICAgICAgDQoNCg0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgLy9fX3Jlc3BvbnNlLnJlY2lwaWVudChuZXcgZXNwdGVzdC5jb20ubmFtbW91ci5kY29tLk5vZGUoKS5jb2RlKCdwYXJlbnQnKSk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKF9fZXZlbnQgJiYgIV9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCg0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgIGlmKF9fZXZlbnQgJiYgX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgYW5zd2VyID0gTWFwcGluZygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIA0KDQogICAgICAgICAgICB9DQoNCg0KDQoNCiAgICAgICAgICAgIGlmKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgaWYoYW5zd2VyKXsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7X190aGlzOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHJldHVybiBhbnN3ZXI7DQogICAgICAgIH0NCiAgICANCiAgICB9Ow0KDQoNCmlmKHR5cGVvZihtb2R1bGUpIT09InVuZGVmaW5lZCIpIG1vZHVsZS5leHBvcnRzLmVzcHRlc3QgPSBlc3B0ZXN0Ow==",
	"__keys": ["name"],
	"__trMap": []
}