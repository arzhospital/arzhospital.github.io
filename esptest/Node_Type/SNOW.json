{
	"Id": "b2dacee9b6048335eae23741fbf486b62ae35dcb",
	"active": "true",
	"enabled": "true",
	"code": "snow",
	"date": "2024-11-01T06:11:10.357Z",
	"name": "SNOW",
	"remark": "dmFyIGVzcHRlc3QgPSBDbGFzcy5jcmVhdGUoKTsNCmVzcHRlc3QucHJvdG90eXBlID0gew0KICAgIGluaXRpYWxpemUgOmZ1bmN0aW9uKCl7fSwNCiAgICB0eXBlOiAnZXNwdGVzdCcsDQp9Ow0KDQoNCg0KICAgIA0KICAgIGVzcHRlc3QuVXNlciA9IGNsYXNzIHsNCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogVXNlci5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBhY3RpdmUodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fYWN0aXZlID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9hY3RpdmU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogVXNlci5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgZW5hYmxlZCh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9lbmFibGVkID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9lbmFibGVkOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIFVzZXIuY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGNvZGUodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fY29kZSA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fY29kZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBVc2VyLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgb3JkZXIodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fb3JkZXIgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX29yZGVyOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIFVzZXIuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGRhdGUodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fZGF0ZSA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZGF0ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBVc2VyLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBuYW1lKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX25hbWUgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX25hbWU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogVXNlci5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICByZW1hcmsodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fcmVtYXJrID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9yZW1hcms7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogVXNlci51c2VybmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHVzZXJuYW1lKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX3VzZXJuYW1lID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl91c2VybmFtZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBVc2VyLnBhc3N3b3JkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgcGFzc3dvcmQodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fcGFzc3dvcmQgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3Bhc3N3b3JkOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgDQogICAgDQogICAgDQogICAgICAgIF91bmlxdWUoKXsNCiAgICAgICAgICAgIGxldCBfX3RvU3RyaW5nID0gJ1VzZXIuX3VuaXF1ZSgpOiAnOw0KICAgICAgICANCiAgICAgICAgICAgIGxldCByZXQgPSBuZXcgdW5kZWZpbmVkKCk7DQogICAgICAgICAgICBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkOw0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMuY29kZSgpKSE9PSd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy51c2VybmFtZSgpKSE9PSd1bmRlZmluZWQnKSByZXQudXNlcm5hbWUodGhpcy51c2VybmFtZSgpKTsNCiAgICANCiAgICAgICAgICAgIHJldHVybiByZXQ7DQogICAgICAgIH0NCg0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBVc2VyLnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgc3RvcmUoX19ldmVudCl7DQogICAgICAgICAgICBsZXQgX190b1N0cmluZyA9ICdVc2VyLnN0b3JlKCk6ICc7DQoNCiAgICAgICAgICAgIGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7DQoNCiAgICAgICAgICAgIGxldCBfX3Jlc3BvbnNlID0gbmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5FdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJyt0aWNrcysnXS5Vc2VyLnN0b3JlKCknKS5tZXRob2QoJ3N0b3JlJykuY2xhc3NOYW1lKCdVc2VyJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOw0KDQogICAgICAgICAgICBsZXQgZXZKU09OID0gbnVsbDsNCiAgICAgICAgICAgIGlmKF9fZXZlbnQpew0KICAgICAgICAgICAgICAgIGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgICAgIGlmKHR5cGVvZihldkpTT04uX190aGlzKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTsNCiAgICAgICAgDQoNCg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZihfX2V2ZW50ICYmICFfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQoNCiAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICBpZihfX2V2ZW50ICYmIF9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGFuc3dlciA9IFVzZXIoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKCFfX2V2ZW50KXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBzdG9yZSBsb2NhbGx5DQogICAgICAgICAgICAgICAgbGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCdVc2VyJyk7DQoNCiAgICAgICAgICAgICAgICBsZXQgX3RoaXMgPSB0aGlzLl91bmlxdWUoKS5maW5kKCk7DQogICAgICAgICAgICAgICAgaWYoIV90aGlzKSBnci5zZXROZXdHdWlkVmFsdWUodGhpcy5JZCB8fCAodGhpcy5JZCA9IGdyLnNldE5ld0d1aWQoKSkpOw0KICAgICAgICAgICAgICAgIGlmKF90aGlzICYmIHR5cGVvZihfdGhpcy5JZCkhPT0ndW5kZWZpbmVkJykgZ3IuZ2V0KF90aGlzLklkKTsNCg0KICAgICAgICAgICAgICAgIGxldCBiU2V0ID0gZmFsc2U7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGlmKF90aGlzICYmIHR5cGVvZihfdGhpcy5nZXRjb2RlKCkpIT09J3VuZGVmaW5lZCcpIGJTZXQgPSBnci5zZXRWYWx1ZSgnY29kZScsIF90aGlzLmdldGNvZGUoKSk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGlmKF90aGlzICYmIHR5cGVvZihfdGhpcy5nZXR1c2VybmFtZSgpKSE9PSd1bmRlZmluZWQnKSBiU2V0ID0gZ3Iuc2V0VmFsdWUoJ3VzZXJuYW1lJywgX3RoaXMuZ2V0dXNlcm5hbWUoKSk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGlmKGJTZXQpew0KICAgICAgICAgICAgICAgICAgICB0aGlzLklkID0gZ3IudXBkYXRlKCk7DQogICAgICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJ0aGlzLklkID0gIiArIHRoaXMuSWQpOw0KICAgICAgICAgICAgICAgICAgICBpZighYW5zd2VyKSBhbnN3ZXIgPSB0aGlzOw0KICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiaW52YWxpZCBvYmplY3QiKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KDQoNCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBpZihhbnN3ZXIpew0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHtfX3RoaXM6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcmV0dXJuIGFuc3dlcjsNCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBVc2VyLmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBmaW5kQWxsKF9fZXZlbnQpew0KICAgICAgICAgICAgbGV0IF9fdG9TdHJpbmcgPSAnVXNlci5maW5kQWxsKCk6ICc7DQoNCiAgICAgICAgICAgIGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7DQoNCiAgICAgICAgICAgIGxldCBfX3Jlc3BvbnNlID0gbmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5FdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJyt0aWNrcysnXS5Vc2VyLmZpbmRBbGwoKScpLm1ldGhvZCgnZmluZEFsbCcpLmNsYXNzTmFtZSgnVXNlcicpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCg0KICAgICAgICAgICAgbGV0IGV2SlNPTiA9IG51bGw7DQogICAgICAgICAgICBpZihfX2V2ZW50KXsNCiAgICAgICAgICAgICAgICBldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgICAgICBpZih0eXBlb2YoZXZKU09OLl9fdGhpcykhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7DQogICAgICAgIA0KDQoNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoX19ldmVudCAmJiAhX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KDQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgaWYoX19ldmVudCAmJiBfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBhbnN3ZXIgPSBVc2VyKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZighX19ldmVudCl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KDQoNCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBpZihhbnN3ZXIpew0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHtfX3RoaXM6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcmV0dXJuIGFuc3dlcjsNCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBVc2VyLmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBmaW5kKF9fZXZlbnQpew0KICAgICAgICAgICAgbGV0IF9fdG9TdHJpbmcgPSAnVXNlci5maW5kKCk6ICc7DQoNCiAgICAgICAgICAgIGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7DQoNCiAgICAgICAgICAgIGxldCBfX3Jlc3BvbnNlID0gbmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5FdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJyt0aWNrcysnXS5Vc2VyLmZpbmQoKScpLm1ldGhvZCgnZmluZCcpLmNsYXNzTmFtZSgnVXNlcicpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCg0KICAgICAgICAgICAgbGV0IGV2SlNPTiA9IG51bGw7DQogICAgICAgICAgICBpZihfX2V2ZW50KXsNCiAgICAgICAgICAgICAgICBldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgICAgICBpZih0eXBlb2YoZXZKU09OLl9fdGhpcykhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7DQogICAgICAgIA0KDQoNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoX19ldmVudCAmJiAhX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KDQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgaWYoX19ldmVudCAmJiBfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBhbnN3ZXIgPSBVc2VyKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZighX19ldmVudCl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KDQoNCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBpZihhbnN3ZXIpew0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHtfX3RoaXM6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcmV0dXJuIGFuc3dlcjsNCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBVc2VyLmluaXQoKSAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBpbml0KF9fZXZlbnQpew0KICAgICAgICAgICAgbGV0IF9fdG9TdHJpbmcgPSAnVXNlci5pbml0KCk6ICc7DQoNCiAgICAgICAgICAgIGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7DQoNCiAgICAgICAgICAgIGxldCBfX3Jlc3BvbnNlID0gbmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5FdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJyt0aWNrcysnXS5Vc2VyLmluaXQoKScpLm1ldGhvZCgnaW5pdCcpLmNsYXNzTmFtZSgnVXNlcicpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCg0KICAgICAgICAgICAgbGV0IGV2SlNPTiA9IG51bGw7DQogICAgICAgICAgICBpZihfX2V2ZW50KXsNCiAgICAgICAgICAgICAgICBldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgICAgICBpZih0eXBlb2YoZXZKU09OLl9fdGhpcykhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7DQogICAgICAgIA0KDQoNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoX19ldmVudCAmJiAhX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KDQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgaWYoX19ldmVudCAmJiBfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBhbnN3ZXIgPSBldkpTT047DQogICAgICAgIA0KDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKCFfX2V2ZW50KXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICANCg0KICAgICAgICAgICAgfQ0KDQoNCg0KDQogICAgICAgICAgICBpZighX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGlmKGFuc3dlcil7DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHN0cihhbnN3ZXIpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoe19fdGhpczogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICByZXR1cm4gYW5zd2VyOw0KICAgICAgICB9DQogICAgDQogICAgfTsNCg0KICAgIGVzcHRlc3QuY29tID0gZXNwdGVzdC5jb20gfHwge307ZXNwdGVzdC5jb20ubmFtbW91ciA9IGVzcHRlc3QuY29tLm5hbW1vdXIgfHwge307ZXNwdGVzdC5jb20ubmFtbW91ci5kaW90ID0gZXNwdGVzdC5jb20ubmFtbW91ci5kaW90IHx8IHt9Ow0KICAgIGVzcHRlc3QuY29tLm5hbW1vdXIuZGlvdC5NZXRyaWMgPSBjbGFzcyB7DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE1ldHJpYy5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBhY3RpdmUodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fYWN0aXZlID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9hY3RpdmU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTWV0cmljLmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBlbmFibGVkKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX2VuYWJsZWQgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2VuYWJsZWQ7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTWV0cmljLmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBjb2RlKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX2NvZGUgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2NvZGU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTWV0cmljLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgb3JkZXIodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fb3JkZXIgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX29yZGVyOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE1ldHJpYy5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgZGF0ZSh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9kYXRlID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9kYXRlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE1ldHJpYy5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgbmFtZSh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9uYW1lID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9uYW1lOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE1ldHJpYy5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICByZW1hcmsodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fcmVtYXJrID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9yZW1hcms7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTWV0cmljLnNjcmlwdCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHNjcmlwdCh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9zY3JpcHQgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3NjcmlwdDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBNZXRyaWMudHlwZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHR5cGUodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fdHlwZSA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fdHlwZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBNZXRyaWMuZGV2aWNlVHlwZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGRldmljZVR5cGUodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fZGV2aWNlVHlwZSA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZGV2aWNlVHlwZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgIA0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBNZXRyaWMubWV0cmljX01ldHJpY19WYWx1ZXMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBtZXRyaWNfTWV0cmljX1ZhbHVlcyh2KXsNCiAgICAgICAgfQ0KICAgIA0KICAgIA0KICAgICAgICBfdW5pcXVlKCl7DQogICAgICAgICAgICBsZXQgX190b1N0cmluZyA9ICdNZXRyaWMuX3VuaXF1ZSgpOiAnOw0KICAgICAgICANCiAgICAgICAgICAgIGxldCByZXQgPSBuZXcgdW5kZWZpbmVkKCk7DQogICAgICAgICAgICBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkOw0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMuY29kZSgpKSE9PSd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7DQogICAgDQogICAgICAgICAgICByZXR1cm4gcmV0Ow0KICAgICAgICB9DQoNCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTWV0cmljLnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgc3RvcmUoX19ldmVudCl7DQogICAgICAgICAgICBsZXQgX190b1N0cmluZyA9ICdNZXRyaWMuc3RvcmUoKTogJzsNCg0KICAgICAgICAgICAgbGV0IGFuc3dlciA9IHVuZGVmaW5lZDsNCg0KICAgICAgICAgICAgbGV0IF9fcmVzcG9uc2UgPSBuZXcgZXNwdGVzdC5jb20ubmFtbW91ci5kY29tLkV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3RpY2tzKyddLk1ldHJpYy5zdG9yZSgpJykubWV0aG9kKCdzdG9yZScpLmNsYXNzTmFtZSgnTWV0cmljJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOw0KDQogICAgICAgICAgICBsZXQgZXZKU09OID0gbnVsbDsNCiAgICAgICAgICAgIGlmKF9fZXZlbnQpew0KICAgICAgICAgICAgICAgIGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgICAgIGlmKHR5cGVvZihldkpTT04uX190aGlzKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTsNCiAgICAgICAgDQoNCg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZihfX2V2ZW50ICYmICFfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQoNCiAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICBpZihfX2V2ZW50ICYmIF9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGFuc3dlciA9IE1ldHJpYygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIHN0b3JlIGxvY2FsbHkNCiAgICAgICAgICAgICAgICBsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ01ldHJpYycpOw0KDQogICAgICAgICAgICAgICAgbGV0IF90aGlzID0gdGhpcy5fdW5pcXVlKCkuZmluZCgpOw0KICAgICAgICAgICAgICAgIGlmKCFfdGhpcykgZ3Iuc2V0TmV3R3VpZFZhbHVlKHRoaXMuSWQgfHwgKHRoaXMuSWQgPSBnci5zZXROZXdHdWlkKCkpKTsNCiAgICAgICAgICAgICAgICBpZihfdGhpcyAmJiB0eXBlb2YoX3RoaXMuSWQpIT09J3VuZGVmaW5lZCcpIGdyLmdldChfdGhpcy5JZCk7DQoNCiAgICAgICAgICAgICAgICBsZXQgYlNldCA9IGZhbHNlOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBpZihfdGhpcyAmJiB0eXBlb2YoX3RoaXMuZ2V0Y29kZSgpKSE9PSd1bmRlZmluZWQnKSBiU2V0ID0gZ3Iuc2V0VmFsdWUoJ2NvZGUnLCBfdGhpcy5nZXRjb2RlKCkpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBpZihiU2V0KXsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5JZCA9IGdyLnVwZGF0ZSgpOw0KICAgICAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAidGhpcy5JZCA9ICIgKyB0aGlzLklkKTsNCiAgICAgICAgICAgICAgICAgICAgaWYoIWFuc3dlcikgYW5zd2VyID0gdGhpczsNCiAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImludmFsaWQgb2JqZWN0Iik7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIA0KDQogICAgICAgICAgICB9DQoNCg0KDQoNCiAgICAgICAgICAgIGlmKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgaWYoYW5zd2VyKXsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7X190aGlzOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHJldHVybiBhbnN3ZXI7DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTWV0cmljLmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBmaW5kQWxsKF9fZXZlbnQpew0KICAgICAgICAgICAgbGV0IF9fdG9TdHJpbmcgPSAnTWV0cmljLmZpbmRBbGwoKTogJzsNCg0KICAgICAgICAgICAgbGV0IGFuc3dlciA9IHVuZGVmaW5lZDsNCg0KICAgICAgICAgICAgbGV0IF9fcmVzcG9uc2UgPSBuZXcgZXNwdGVzdC5jb20ubmFtbW91ci5kY29tLkV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3RpY2tzKyddLk1ldHJpYy5maW5kQWxsKCknKS5tZXRob2QoJ2ZpbmRBbGwnKS5jbGFzc05hbWUoJ01ldHJpYycpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCg0KICAgICAgICAgICAgbGV0IGV2SlNPTiA9IG51bGw7DQogICAgICAgICAgICBpZihfX2V2ZW50KXsNCiAgICAgICAgICAgICAgICBldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgICAgICBpZih0eXBlb2YoZXZKU09OLl9fdGhpcykhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7DQogICAgICAgIA0KDQoNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoX19ldmVudCAmJiAhX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KDQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgaWYoX19ldmVudCAmJiBfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBhbnN3ZXIgPSBNZXRyaWMoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKCFfX2V2ZW50KXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICANCg0KICAgICAgICAgICAgfQ0KDQoNCg0KDQogICAgICAgICAgICBpZighX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGlmKGFuc3dlcil7DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoe19fdGhpczogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICByZXR1cm4gYW5zd2VyOw0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE1ldHJpYy5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgZmluZChfX2V2ZW50KXsNCiAgICAgICAgICAgIGxldCBfX3RvU3RyaW5nID0gJ01ldHJpYy5maW5kKCk6ICc7DQoNCiAgICAgICAgICAgIGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7DQoNCiAgICAgICAgICAgIGxldCBfX3Jlc3BvbnNlID0gbmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5FdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJyt0aWNrcysnXS5NZXRyaWMuZmluZCgpJykubWV0aG9kKCdmaW5kJykuY2xhc3NOYW1lKCdNZXRyaWMnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQoNCiAgICAgICAgICAgIGxldCBldkpTT04gPSBudWxsOw0KICAgICAgICAgICAgaWYoX19ldmVudCl7DQogICAgICAgICAgICAgICAgZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICAgICAgaWYodHlwZW9mKGV2SlNPTi5fX3RoaXMpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgICAgICB0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpOw0KICAgICAgICANCg0KDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKF9fZXZlbnQgJiYgIV9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCg0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgIGlmKF9fZXZlbnQgJiYgX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgYW5zd2VyID0gTWV0cmljKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZighX19ldmVudCl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KDQoNCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBpZihhbnN3ZXIpew0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHtfX3RoaXM6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcmV0dXJuIGFuc3dlcjsNCiAgICAgICAgfQ0KICAgIA0KICAgIH07DQoNCiAgICBlc3B0ZXN0LmNvbSA9IGVzcHRlc3QuY29tIHx8IHt9O2VzcHRlc3QuY29tLm5hbW1vdXIgPSBlc3B0ZXN0LmNvbS5uYW1tb3VyIHx8IHt9O2VzcHRlc3QuY29tLm5hbW1vdXIuZGlvdCA9IGVzcHRlc3QuY29tLm5hbW1vdXIuZGlvdCB8fCB7fTsNCiAgICBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRpb3QuTWV0cmljX1ZhbHVlID0gY2xhc3Mgew0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBNZXRyaWNfVmFsdWUuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgYWN0aXZlKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX2FjdGl2ZSA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fYWN0aXZlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE1ldHJpY19WYWx1ZS5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgZW5hYmxlZCh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9lbmFibGVkID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9lbmFibGVkOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE1ldHJpY19WYWx1ZS5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgY29kZSh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9jb2RlID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9jb2RlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE1ldHJpY19WYWx1ZS5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIG9yZGVyKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX29yZGVyID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9vcmRlcjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBNZXRyaWNfVmFsdWUuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGRhdGUodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fZGF0ZSA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZGF0ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBNZXRyaWNfVmFsdWUubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIG5hbWUodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fbmFtZSA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fbmFtZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBNZXRyaWNfVmFsdWUucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgcmVtYXJrKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX3JlbWFyayA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fcmVtYXJrOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE1ldHJpY19WYWx1ZS52YWx1ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHZhbHVlKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX3ZhbHVlID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl92YWx1ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBNZXRyaWNfVmFsdWUubWVhc3VyZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBtZWFzdXJlZCh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9tZWFzdXJlZCA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fbWVhc3VyZWQ7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTWV0cmljX1ZhbHVlLm1ldHJpYyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIG1ldHJpYyh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9tZXRyaWMgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX21ldHJpYzsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBNZXRyaWNfVmFsdWUuZGV2aWNlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgZGV2aWNlKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX2RldmljZSA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZGV2aWNlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgDQogICAgDQogICAgDQogICAgICAgIF91bmlxdWUoKXsNCiAgICAgICAgICAgIGxldCBfX3RvU3RyaW5nID0gJ01ldHJpY19WYWx1ZS5fdW5pcXVlKCk6ICc7DQogICAgICAgIA0KICAgICAgICAgICAgbGV0IHJldCA9IG5ldyB1bmRlZmluZWQoKTsNCiAgICAgICAgICAgIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5tZXRyaWMoKSkhPT0ndW5kZWZpbmVkJykgcmV0Lm1ldHJpYyh0aGlzLm1ldHJpYygpLl91bmlxdWUoKSk7DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5kZXZpY2UoKSkhPT0ndW5kZWZpbmVkJykgcmV0LmRldmljZSh0aGlzLmRldmljZSgpLl91bmlxdWUoKSk7DQogICAgDQogICAgICAgICAgICByZXR1cm4gcmV0Ow0KICAgICAgICB9DQoNCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTWV0cmljX1ZhbHVlLnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgc3RvcmUoX19ldmVudCl7DQogICAgICAgICAgICBsZXQgX190b1N0cmluZyA9ICdNZXRyaWNfVmFsdWUuc3RvcmUoKTogJzsNCg0KICAgICAgICAgICAgbGV0IGFuc3dlciA9IHVuZGVmaW5lZDsNCg0KICAgICAgICAgICAgbGV0IF9fcmVzcG9uc2UgPSBuZXcgZXNwdGVzdC5jb20ubmFtbW91ci5kY29tLkV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3RpY2tzKyddLk1ldHJpY19WYWx1ZS5zdG9yZSgpJykubWV0aG9kKCdzdG9yZScpLmNsYXNzTmFtZSgnTWV0cmljX1ZhbHVlJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOw0KDQogICAgICAgICAgICBsZXQgZXZKU09OID0gbnVsbDsNCiAgICAgICAgICAgIGlmKF9fZXZlbnQpew0KICAgICAgICAgICAgICAgIGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgICAgIGlmKHR5cGVvZihldkpTT04uX190aGlzKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTsNCiAgICAgICAgDQoNCg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZihfX2V2ZW50ICYmICFfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQoNCiAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICBpZihfX2V2ZW50ICYmIF9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGFuc3dlciA9IE1ldHJpY19WYWx1ZSgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIHN0b3JlIGxvY2FsbHkNCiAgICAgICAgICAgICAgICBsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ01ldHJpY19WYWx1ZScpOw0KDQogICAgICAgICAgICAgICAgbGV0IF90aGlzID0gdGhpcy5fdW5pcXVlKCkuZmluZCgpOw0KICAgICAgICAgICAgICAgIGlmKCFfdGhpcykgZ3Iuc2V0TmV3R3VpZFZhbHVlKHRoaXMuSWQgfHwgKHRoaXMuSWQgPSBnci5zZXROZXdHdWlkKCkpKTsNCiAgICAgICAgICAgICAgICBpZihfdGhpcyAmJiB0eXBlb2YoX3RoaXMuSWQpIT09J3VuZGVmaW5lZCcpIGdyLmdldChfdGhpcy5JZCk7DQoNCiAgICAgICAgICAgICAgICBsZXQgYlNldCA9IGZhbHNlOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBpZihfdGhpcyAmJiB0eXBlb2YoX3RoaXMuZ2V0bWV0cmljKCkpIT09J3VuZGVmaW5lZCcpIGJTZXQgPSBnci5zZXRWYWx1ZSgnbWV0cmljJywgX3RoaXMuZ2V0bWV0cmljKCkpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBpZihfdGhpcyAmJiB0eXBlb2YoX3RoaXMuZ2V0ZGV2aWNlKCkpIT09J3VuZGVmaW5lZCcpIGJTZXQgPSBnci5zZXRWYWx1ZSgnZGV2aWNlJywgX3RoaXMuZ2V0ZGV2aWNlKCkpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBpZihiU2V0KXsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5JZCA9IGdyLnVwZGF0ZSgpOw0KICAgICAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAidGhpcy5JZCA9ICIgKyB0aGlzLklkKTsNCiAgICAgICAgICAgICAgICAgICAgaWYoIWFuc3dlcikgYW5zd2VyID0gdGhpczsNCiAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImludmFsaWQgb2JqZWN0Iik7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIA0KDQogICAgICAgICAgICB9DQoNCg0KDQoNCiAgICAgICAgICAgIGlmKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgaWYoYW5zd2VyKXsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7X190aGlzOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHJldHVybiBhbnN3ZXI7DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTWV0cmljX1ZhbHVlLmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBmaW5kQWxsKF9fZXZlbnQpew0KICAgICAgICAgICAgbGV0IF9fdG9TdHJpbmcgPSAnTWV0cmljX1ZhbHVlLmZpbmRBbGwoKTogJzsNCg0KICAgICAgICAgICAgbGV0IGFuc3dlciA9IHVuZGVmaW5lZDsNCg0KICAgICAgICAgICAgbGV0IF9fcmVzcG9uc2UgPSBuZXcgZXNwdGVzdC5jb20ubmFtbW91ci5kY29tLkV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3RpY2tzKyddLk1ldHJpY19WYWx1ZS5maW5kQWxsKCknKS5tZXRob2QoJ2ZpbmRBbGwnKS5jbGFzc05hbWUoJ01ldHJpY19WYWx1ZScpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCg0KICAgICAgICAgICAgbGV0IGV2SlNPTiA9IG51bGw7DQogICAgICAgICAgICBpZihfX2V2ZW50KXsNCiAgICAgICAgICAgICAgICBldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgICAgICBpZih0eXBlb2YoZXZKU09OLl9fdGhpcykhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7DQogICAgICAgIA0KDQoNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoX19ldmVudCAmJiAhX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KDQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgaWYoX19ldmVudCAmJiBfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBhbnN3ZXIgPSBNZXRyaWNfVmFsdWUoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKCFfX2V2ZW50KXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICANCg0KICAgICAgICAgICAgfQ0KDQoNCg0KDQogICAgICAgICAgICBpZighX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGlmKGFuc3dlcil7DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoe19fdGhpczogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICByZXR1cm4gYW5zd2VyOw0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE1ldHJpY19WYWx1ZS5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgZmluZChfX2V2ZW50KXsNCiAgICAgICAgICAgIGxldCBfX3RvU3RyaW5nID0gJ01ldHJpY19WYWx1ZS5maW5kKCk6ICc7DQoNCiAgICAgICAgICAgIGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7DQoNCiAgICAgICAgICAgIGxldCBfX3Jlc3BvbnNlID0gbmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5FdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJyt0aWNrcysnXS5NZXRyaWNfVmFsdWUuZmluZCgpJykubWV0aG9kKCdmaW5kJykuY2xhc3NOYW1lKCdNZXRyaWNfVmFsdWUnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQoNCiAgICAgICAgICAgIGxldCBldkpTT04gPSBudWxsOw0KICAgICAgICAgICAgaWYoX19ldmVudCl7DQogICAgICAgICAgICAgICAgZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICAgICAgaWYodHlwZW9mKGV2SlNPTi5fX3RoaXMpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgICAgICB0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpOw0KICAgICAgICANCg0KDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKF9fZXZlbnQgJiYgIV9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCg0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgIGlmKF9fZXZlbnQgJiYgX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgYW5zd2VyID0gTWV0cmljX1ZhbHVlKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZighX19ldmVudCl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KDQoNCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBpZihhbnN3ZXIpew0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHtfX3RoaXM6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcmV0dXJuIGFuc3dlcjsNCiAgICAgICAgfQ0KICAgIA0KICAgIH07DQoNCiAgICBlc3B0ZXN0LmNvbSA9IGVzcHRlc3QuY29tIHx8IHt9O2VzcHRlc3QuY29tLm5hbW1vdXIgPSBlc3B0ZXN0LmNvbS5uYW1tb3VyIHx8IHt9O2VzcHRlc3QuY29tLm5hbW1vdXIuZGlvdCA9IGVzcHRlc3QuY29tLm5hbW1vdXIuZGlvdCB8fCB7fTsNCiAgICBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRpb3QuRGV2aWNlID0gY2xhc3Mgew0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBEZXZpY2UuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgYWN0aXZlKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX2FjdGl2ZSA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fYWN0aXZlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIERldmljZS5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgZW5hYmxlZCh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9lbmFibGVkID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9lbmFibGVkOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIERldmljZS5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgY29kZSh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9jb2RlID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9jb2RlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIERldmljZS5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIG9yZGVyKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX29yZGVyID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9vcmRlcjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBEZXZpY2UuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGRhdGUodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fZGF0ZSA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZGF0ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBEZXZpY2UubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIG5hbWUodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fbmFtZSA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fbmFtZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBEZXZpY2UucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgcmVtYXJrKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX3JlbWFyayA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fcmVtYXJrOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIERldmljZS50eXBlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgdHlwZSh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl90eXBlID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl90eXBlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIERldmljZS5jb250cm9sbGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgY29udHJvbGxlcih2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9jb250cm9sbGVyID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9jb250cm9sbGVyOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgDQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIERldmljZS5kZXZpY2VfTWV0cmljX1ZhbHVlcyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGRldmljZV9NZXRyaWNfVmFsdWVzKHYpew0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIERldmljZS5kZXZpY2VfRGV2aWNlX0F0dHJpYnV0ZXMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBkZXZpY2VfRGV2aWNlX0F0dHJpYnV0ZXModil7DQogICAgICAgIH0NCiAgICANCiAgICANCiAgICAgICAgX3VuaXF1ZSgpew0KICAgICAgICAgICAgbGV0IF9fdG9TdHJpbmcgPSAnRGV2aWNlLl91bmlxdWUoKTogJzsNCiAgICAgICAgDQogICAgICAgICAgICBsZXQgcmV0ID0gbmV3IHVuZGVmaW5lZCgpOw0KICAgICAgICAgICAgaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDsNCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZih0aGlzLmNvZGUoKSkhPT0ndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpOw0KICAgIA0KICAgICAgICAgICAgcmV0dXJuIHJldDsNCiAgICAgICAgfQ0KDQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIERldmljZS5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHN0b3JlKF9fZXZlbnQpew0KICAgICAgICAgICAgbGV0IF9fdG9TdHJpbmcgPSAnRGV2aWNlLnN0b3JlKCk6ICc7DQoNCiAgICAgICAgICAgIGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7DQoNCiAgICAgICAgICAgIGxldCBfX3Jlc3BvbnNlID0gbmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5FdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJyt0aWNrcysnXS5EZXZpY2Uuc3RvcmUoKScpLm1ldGhvZCgnc3RvcmUnKS5jbGFzc05hbWUoJ0RldmljZScpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCg0KICAgICAgICAgICAgbGV0IGV2SlNPTiA9IG51bGw7DQogICAgICAgICAgICBpZihfX2V2ZW50KXsNCiAgICAgICAgICAgICAgICBldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgICAgICBpZih0eXBlb2YoZXZKU09OLl9fdGhpcykhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7DQogICAgICAgIA0KDQoNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoX19ldmVudCAmJiAhX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KDQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgaWYoX19ldmVudCAmJiBfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBhbnN3ZXIgPSBEZXZpY2UoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKCFfX2V2ZW50KXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBzdG9yZSBsb2NhbGx5DQogICAgICAgICAgICAgICAgbGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCdEZXZpY2UnKTsNCg0KICAgICAgICAgICAgICAgIGxldCBfdGhpcyA9IHRoaXMuX3VuaXF1ZSgpLmZpbmQoKTsNCiAgICAgICAgICAgICAgICBpZighX3RoaXMpIGdyLnNldE5ld0d1aWRWYWx1ZSh0aGlzLklkIHx8ICh0aGlzLklkID0gZ3Iuc2V0TmV3R3VpZCgpKSk7DQogICAgICAgICAgICAgICAgaWYoX3RoaXMgJiYgdHlwZW9mKF90aGlzLklkKSE9PSd1bmRlZmluZWQnKSBnci5nZXQoX3RoaXMuSWQpOw0KDQogICAgICAgICAgICAgICAgbGV0IGJTZXQgPSBmYWxzZTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgaWYoX3RoaXMgJiYgdHlwZW9mKF90aGlzLmdldGNvZGUoKSkhPT0ndW5kZWZpbmVkJykgYlNldCA9IGdyLnNldFZhbHVlKCdjb2RlJywgX3RoaXMuZ2V0Y29kZSgpKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgaWYoYlNldCl7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuSWQgPSBnci51cGRhdGUoKTsNCiAgICAgICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgInRoaXMuSWQgPSAiICsgdGhpcy5JZCk7DQogICAgICAgICAgICAgICAgICAgIGlmKCFhbnN3ZXIpIGFuc3dlciA9IHRoaXM7DQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJpbnZhbGlkIG9iamVjdCIpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICANCg0KICAgICAgICAgICAgfQ0KDQoNCg0KDQogICAgICAgICAgICBpZighX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGlmKGFuc3dlcil7DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoe19fdGhpczogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICByZXR1cm4gYW5zd2VyOw0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIERldmljZS5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgZmluZEFsbChfX2V2ZW50KXsNCiAgICAgICAgICAgIGxldCBfX3RvU3RyaW5nID0gJ0RldmljZS5maW5kQWxsKCk6ICc7DQoNCiAgICAgICAgICAgIGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7DQoNCiAgICAgICAgICAgIGxldCBfX3Jlc3BvbnNlID0gbmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5FdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJyt0aWNrcysnXS5EZXZpY2UuZmluZEFsbCgpJykubWV0aG9kKCdmaW5kQWxsJykuY2xhc3NOYW1lKCdEZXZpY2UnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQoNCiAgICAgICAgICAgIGxldCBldkpTT04gPSBudWxsOw0KICAgICAgICAgICAgaWYoX19ldmVudCl7DQogICAgICAgICAgICAgICAgZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICAgICAgaWYodHlwZW9mKGV2SlNPTi5fX3RoaXMpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgICAgICB0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpOw0KICAgICAgICANCg0KDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKF9fZXZlbnQgJiYgIV9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCg0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgIGlmKF9fZXZlbnQgJiYgX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgYW5zd2VyID0gRGV2aWNlKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZighX19ldmVudCl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KDQoNCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBpZihhbnN3ZXIpew0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHtfX3RoaXM6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcmV0dXJuIGFuc3dlcjsNCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBEZXZpY2UuZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGZpbmQoX19ldmVudCl7DQogICAgICAgICAgICBsZXQgX190b1N0cmluZyA9ICdEZXZpY2UuZmluZCgpOiAnOw0KDQogICAgICAgICAgICBsZXQgYW5zd2VyID0gdW5kZWZpbmVkOw0KDQogICAgICAgICAgICBsZXQgX19yZXNwb25zZSA9IG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrdGlja3MrJ10uRGV2aWNlLmZpbmQoKScpLm1ldGhvZCgnZmluZCcpLmNsYXNzTmFtZSgnRGV2aWNlJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOw0KDQogICAgICAgICAgICBsZXQgZXZKU09OID0gbnVsbDsNCiAgICAgICAgICAgIGlmKF9fZXZlbnQpew0KICAgICAgICAgICAgICAgIGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgICAgIGlmKHR5cGVvZihldkpTT04uX190aGlzKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTsNCiAgICAgICAgDQoNCg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZihfX2V2ZW50ICYmICFfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQoNCiAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICBpZihfX2V2ZW50ICYmIF9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGFuc3dlciA9IERldmljZSgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIA0KDQogICAgICAgICAgICB9DQoNCg0KDQoNCiAgICAgICAgICAgIGlmKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgaWYoYW5zd2VyKXsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7X190aGlzOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHJldHVybiBhbnN3ZXI7DQogICAgICAgIH0NCiAgICANCiAgICB9Ow0KDQogICAgZXNwdGVzdC5jb20gPSBlc3B0ZXN0LmNvbSB8fCB7fTtlc3B0ZXN0LmNvbS5uYW1tb3VyID0gZXNwdGVzdC5jb20ubmFtbW91ciB8fCB7fTtlc3B0ZXN0LmNvbS5uYW1tb3VyLmRpb3QgPSBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRpb3QgfHwge307DQogICAgZXNwdGVzdC5jb20ubmFtbW91ci5kaW90LkRldmljZV9BdHRyaWJ1dGUgPSBjbGFzcyB7DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIERldmljZV9BdHRyaWJ1dGUuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgYWN0aXZlKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX2FjdGl2ZSA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fYWN0aXZlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIERldmljZV9BdHRyaWJ1dGUuZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGVuYWJsZWQodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fZW5hYmxlZCA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZW5hYmxlZDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBEZXZpY2VfQXR0cmlidXRlLmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBjb2RlKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX2NvZGUgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2NvZGU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogRGV2aWNlX0F0dHJpYnV0ZS5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIG9yZGVyKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX29yZGVyID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9vcmRlcjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBEZXZpY2VfQXR0cmlidXRlLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBkYXRlKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX2RhdGUgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2RhdGU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogRGV2aWNlX0F0dHJpYnV0ZS5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgbmFtZSh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9uYW1lID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9uYW1lOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIERldmljZV9BdHRyaWJ1dGUucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgcmVtYXJrKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX3JlbWFyayA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fcmVtYXJrOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIERldmljZV9BdHRyaWJ1dGUudmFsdWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICB2YWx1ZSh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl92YWx1ZSA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fdmFsdWU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogRGV2aWNlX0F0dHJpYnV0ZS5kZXZpY2UgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBkZXZpY2Uodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fZGV2aWNlID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9kZXZpY2U7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogRGV2aWNlX0F0dHJpYnV0ZS5hdHRyaWJ1dGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBhdHRyaWJ1dGUodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fYXR0cmlidXRlID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9hdHRyaWJ1dGU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICANCiAgICANCiAgICANCiAgICAgICAgX3VuaXF1ZSgpew0KICAgICAgICAgICAgbGV0IF9fdG9TdHJpbmcgPSAnRGV2aWNlX0F0dHJpYnV0ZS5fdW5pcXVlKCk6ICc7DQogICAgICAgIA0KICAgICAgICAgICAgbGV0IHJldCA9IG5ldyB1bmRlZmluZWQoKTsNCiAgICAgICAgICAgIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5kZXZpY2UoKSkhPT0ndW5kZWZpbmVkJykgcmV0LmRldmljZSh0aGlzLmRldmljZSgpLl91bmlxdWUoKSk7DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5hdHRyaWJ1dGUoKSkhPT0ndW5kZWZpbmVkJykgcmV0LmF0dHJpYnV0ZSh0aGlzLmF0dHJpYnV0ZSgpLl91bmlxdWUoKSk7DQogICAgDQogICAgICAgICAgICByZXR1cm4gcmV0Ow0KICAgICAgICB9DQoNCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogRGV2aWNlX0F0dHJpYnV0ZS5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHN0b3JlKF9fZXZlbnQpew0KICAgICAgICAgICAgbGV0IF9fdG9TdHJpbmcgPSAnRGV2aWNlX0F0dHJpYnV0ZS5zdG9yZSgpOiAnOw0KDQogICAgICAgICAgICBsZXQgYW5zd2VyID0gdW5kZWZpbmVkOw0KDQogICAgICAgICAgICBsZXQgX19yZXNwb25zZSA9IG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrdGlja3MrJ10uRGV2aWNlX0F0dHJpYnV0ZS5zdG9yZSgpJykubWV0aG9kKCdzdG9yZScpLmNsYXNzTmFtZSgnRGV2aWNlX0F0dHJpYnV0ZScpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCg0KICAgICAgICAgICAgbGV0IGV2SlNPTiA9IG51bGw7DQogICAgICAgICAgICBpZihfX2V2ZW50KXsNCiAgICAgICAgICAgICAgICBldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgICAgICBpZih0eXBlb2YoZXZKU09OLl9fdGhpcykhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7DQogICAgICAgIA0KDQoNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoX19ldmVudCAmJiAhX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KDQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgaWYoX19ldmVudCAmJiBfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBhbnN3ZXIgPSBEZXZpY2VfQXR0cmlidXRlKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZighX19ldmVudCl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgLy8gc3RvcmUgbG9jYWxseQ0KICAgICAgICAgICAgICAgIGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgnRGV2aWNlX0F0dHJpYnV0ZScpOw0KDQogICAgICAgICAgICAgICAgbGV0IF90aGlzID0gdGhpcy5fdW5pcXVlKCkuZmluZCgpOw0KICAgICAgICAgICAgICAgIGlmKCFfdGhpcykgZ3Iuc2V0TmV3R3VpZFZhbHVlKHRoaXMuSWQgfHwgKHRoaXMuSWQgPSBnci5zZXROZXdHdWlkKCkpKTsNCiAgICAgICAgICAgICAgICBpZihfdGhpcyAmJiB0eXBlb2YoX3RoaXMuSWQpIT09J3VuZGVmaW5lZCcpIGdyLmdldChfdGhpcy5JZCk7DQoNCiAgICAgICAgICAgICAgICBsZXQgYlNldCA9IGZhbHNlOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBpZihfdGhpcyAmJiB0eXBlb2YoX3RoaXMuZ2V0ZGV2aWNlKCkpIT09J3VuZGVmaW5lZCcpIGJTZXQgPSBnci5zZXRWYWx1ZSgnZGV2aWNlJywgX3RoaXMuZ2V0ZGV2aWNlKCkpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBpZihfdGhpcyAmJiB0eXBlb2YoX3RoaXMuZ2V0YXR0cmlidXRlKCkpIT09J3VuZGVmaW5lZCcpIGJTZXQgPSBnci5zZXRWYWx1ZSgnYXR0cmlidXRlJywgX3RoaXMuZ2V0YXR0cmlidXRlKCkpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBpZihiU2V0KXsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5JZCA9IGdyLnVwZGF0ZSgpOw0KICAgICAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAidGhpcy5JZCA9ICIgKyB0aGlzLklkKTsNCiAgICAgICAgICAgICAgICAgICAgaWYoIWFuc3dlcikgYW5zd2VyID0gdGhpczsNCiAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImludmFsaWQgb2JqZWN0Iik7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIA0KDQogICAgICAgICAgICB9DQoNCg0KDQoNCiAgICAgICAgICAgIGlmKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgaWYoYW5zd2VyKXsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7X190aGlzOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHJldHVybiBhbnN3ZXI7DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogRGV2aWNlX0F0dHJpYnV0ZS5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgZmluZEFsbChfX2V2ZW50KXsNCiAgICAgICAgICAgIGxldCBfX3RvU3RyaW5nID0gJ0RldmljZV9BdHRyaWJ1dGUuZmluZEFsbCgpOiAnOw0KDQogICAgICAgICAgICBsZXQgYW5zd2VyID0gdW5kZWZpbmVkOw0KDQogICAgICAgICAgICBsZXQgX19yZXNwb25zZSA9IG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrdGlja3MrJ10uRGV2aWNlX0F0dHJpYnV0ZS5maW5kQWxsKCknKS5tZXRob2QoJ2ZpbmRBbGwnKS5jbGFzc05hbWUoJ0RldmljZV9BdHRyaWJ1dGUnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQoNCiAgICAgICAgICAgIGxldCBldkpTT04gPSBudWxsOw0KICAgICAgICAgICAgaWYoX19ldmVudCl7DQogICAgICAgICAgICAgICAgZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICAgICAgaWYodHlwZW9mKGV2SlNPTi5fX3RoaXMpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgICAgICB0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpOw0KICAgICAgICANCg0KDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKF9fZXZlbnQgJiYgIV9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCg0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgIGlmKF9fZXZlbnQgJiYgX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgYW5zd2VyID0gRGV2aWNlX0F0dHJpYnV0ZSgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIA0KDQogICAgICAgICAgICB9DQoNCg0KDQoNCiAgICAgICAgICAgIGlmKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgaWYoYW5zd2VyKXsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7X190aGlzOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHJldHVybiBhbnN3ZXI7DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogRGV2aWNlX0F0dHJpYnV0ZS5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgZmluZChfX2V2ZW50KXsNCiAgICAgICAgICAgIGxldCBfX3RvU3RyaW5nID0gJ0RldmljZV9BdHRyaWJ1dGUuZmluZCgpOiAnOw0KDQogICAgICAgICAgICBsZXQgYW5zd2VyID0gdW5kZWZpbmVkOw0KDQogICAgICAgICAgICBsZXQgX19yZXNwb25zZSA9IG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrdGlja3MrJ10uRGV2aWNlX0F0dHJpYnV0ZS5maW5kKCknKS5tZXRob2QoJ2ZpbmQnKS5jbGFzc05hbWUoJ0RldmljZV9BdHRyaWJ1dGUnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQoNCiAgICAgICAgICAgIGxldCBldkpTT04gPSBudWxsOw0KICAgICAgICAgICAgaWYoX19ldmVudCl7DQogICAgICAgICAgICAgICAgZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICAgICAgaWYodHlwZW9mKGV2SlNPTi5fX3RoaXMpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgICAgICB0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpOw0KICAgICAgICANCg0KDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKF9fZXZlbnQgJiYgIV9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCg0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgIGlmKF9fZXZlbnQgJiYgX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgYW5zd2VyID0gRGV2aWNlX0F0dHJpYnV0ZSgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIA0KDQogICAgICAgICAgICB9DQoNCg0KDQoNCiAgICAgICAgICAgIGlmKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgaWYoYW5zd2VyKXsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7X190aGlzOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHJldHVybiBhbnN3ZXI7DQogICAgICAgIH0NCiAgICANCiAgICB9Ow0KDQogICAgZXNwdGVzdC5jb20gPSBlc3B0ZXN0LmNvbSB8fCB7fTtlc3B0ZXN0LmNvbS5uYW1tb3VyID0gZXNwdGVzdC5jb20ubmFtbW91ciB8fCB7fTtlc3B0ZXN0LmNvbS5uYW1tb3VyLmRpb3QgPSBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRpb3QgfHwge307DQogICAgZXNwdGVzdC5jb20ubmFtbW91ci5kaW90LlR5cGVfQXR0cmlidXRlID0gY2xhc3Mgew0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBUeXBlX0F0dHJpYnV0ZS5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBhY3RpdmUodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fYWN0aXZlID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9hY3RpdmU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogVHlwZV9BdHRyaWJ1dGUuZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGVuYWJsZWQodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fZW5hYmxlZCA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZW5hYmxlZDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBUeXBlX0F0dHJpYnV0ZS5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgY29kZSh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9jb2RlID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9jb2RlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIFR5cGVfQXR0cmlidXRlLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgb3JkZXIodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fb3JkZXIgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX29yZGVyOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIFR5cGVfQXR0cmlidXRlLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBkYXRlKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX2RhdGUgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2RhdGU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogVHlwZV9BdHRyaWJ1dGUubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIG5hbWUodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fbmFtZSA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fbmFtZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBUeXBlX0F0dHJpYnV0ZS5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICByZW1hcmsodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fcmVtYXJrID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9yZW1hcms7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogVHlwZV9BdHRyaWJ1dGUuZGV2aWNlVHlwZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGRldmljZVR5cGUodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fZGV2aWNlVHlwZSA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZGV2aWNlVHlwZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgIA0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBUeXBlX0F0dHJpYnV0ZS5hdHRyaWJ1dGVfRGV2aWNlX0F0dHJpYnV0ZXMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBhdHRyaWJ1dGVfRGV2aWNlX0F0dHJpYnV0ZXModil7DQogICAgICAgIH0NCiAgICANCiAgICANCiAgICAgICAgX3VuaXF1ZSgpew0KICAgICAgICAgICAgbGV0IF9fdG9TdHJpbmcgPSAnVHlwZV9BdHRyaWJ1dGUuX3VuaXF1ZSgpOiAnOw0KICAgICAgICANCiAgICAgICAgICAgIGxldCByZXQgPSBuZXcgdW5kZWZpbmVkKCk7DQogICAgICAgICAgICBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkOw0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMuY29kZSgpKSE9PSd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5kZXZpY2VUeXBlKCkpIT09J3VuZGVmaW5lZCcpIHJldC5kZXZpY2VUeXBlKHRoaXMuZGV2aWNlVHlwZSgpLl91bmlxdWUoKSk7DQogICAgDQogICAgICAgICAgICByZXR1cm4gcmV0Ow0KICAgICAgICB9DQoNCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogVHlwZV9BdHRyaWJ1dGUuc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBzdG9yZShfX2V2ZW50KXsNCiAgICAgICAgICAgIGxldCBfX3RvU3RyaW5nID0gJ1R5cGVfQXR0cmlidXRlLnN0b3JlKCk6ICc7DQoNCiAgICAgICAgICAgIGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7DQoNCiAgICAgICAgICAgIGxldCBfX3Jlc3BvbnNlID0gbmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5FdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJyt0aWNrcysnXS5UeXBlX0F0dHJpYnV0ZS5zdG9yZSgpJykubWV0aG9kKCdzdG9yZScpLmNsYXNzTmFtZSgnVHlwZV9BdHRyaWJ1dGUnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQoNCiAgICAgICAgICAgIGxldCBldkpTT04gPSBudWxsOw0KICAgICAgICAgICAgaWYoX19ldmVudCl7DQogICAgICAgICAgICAgICAgZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICAgICAgaWYodHlwZW9mKGV2SlNPTi5fX3RoaXMpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgICAgICB0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpOw0KICAgICAgICANCg0KDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKF9fZXZlbnQgJiYgIV9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCg0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgIGlmKF9fZXZlbnQgJiYgX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgYW5zd2VyID0gVHlwZV9BdHRyaWJ1dGUoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKCFfX2V2ZW50KXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBzdG9yZSBsb2NhbGx5DQogICAgICAgICAgICAgICAgbGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCdUeXBlX0F0dHJpYnV0ZScpOw0KDQogICAgICAgICAgICAgICAgbGV0IF90aGlzID0gdGhpcy5fdW5pcXVlKCkuZmluZCgpOw0KICAgICAgICAgICAgICAgIGlmKCFfdGhpcykgZ3Iuc2V0TmV3R3VpZFZhbHVlKHRoaXMuSWQgfHwgKHRoaXMuSWQgPSBnci5zZXROZXdHdWlkKCkpKTsNCiAgICAgICAgICAgICAgICBpZihfdGhpcyAmJiB0eXBlb2YoX3RoaXMuSWQpIT09J3VuZGVmaW5lZCcpIGdyLmdldChfdGhpcy5JZCk7DQoNCiAgICAgICAgICAgICAgICBsZXQgYlNldCA9IGZhbHNlOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBpZihfdGhpcyAmJiB0eXBlb2YoX3RoaXMuZ2V0Y29kZSgpKSE9PSd1bmRlZmluZWQnKSBiU2V0ID0gZ3Iuc2V0VmFsdWUoJ2NvZGUnLCBfdGhpcy5nZXRjb2RlKCkpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBpZihfdGhpcyAmJiB0eXBlb2YoX3RoaXMuZ2V0ZGV2aWNlVHlwZSgpKSE9PSd1bmRlZmluZWQnKSBiU2V0ID0gZ3Iuc2V0VmFsdWUoJ2RldmljZVR5cGUnLCBfdGhpcy5nZXRkZXZpY2VUeXBlKCkpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBpZihiU2V0KXsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5JZCA9IGdyLnVwZGF0ZSgpOw0KICAgICAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAidGhpcy5JZCA9ICIgKyB0aGlzLklkKTsNCiAgICAgICAgICAgICAgICAgICAgaWYoIWFuc3dlcikgYW5zd2VyID0gdGhpczsNCiAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImludmFsaWQgb2JqZWN0Iik7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIA0KDQogICAgICAgICAgICB9DQoNCg0KDQoNCiAgICAgICAgICAgIGlmKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgaWYoYW5zd2VyKXsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7X190aGlzOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHJldHVybiBhbnN3ZXI7DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogVHlwZV9BdHRyaWJ1dGUuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGZpbmRBbGwoX19ldmVudCl7DQogICAgICAgICAgICBsZXQgX190b1N0cmluZyA9ICdUeXBlX0F0dHJpYnV0ZS5maW5kQWxsKCk6ICc7DQoNCiAgICAgICAgICAgIGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7DQoNCiAgICAgICAgICAgIGxldCBfX3Jlc3BvbnNlID0gbmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5FdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJyt0aWNrcysnXS5UeXBlX0F0dHJpYnV0ZS5maW5kQWxsKCknKS5tZXRob2QoJ2ZpbmRBbGwnKS5jbGFzc05hbWUoJ1R5cGVfQXR0cmlidXRlJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOw0KDQogICAgICAgICAgICBsZXQgZXZKU09OID0gbnVsbDsNCiAgICAgICAgICAgIGlmKF9fZXZlbnQpew0KICAgICAgICAgICAgICAgIGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgICAgIGlmKHR5cGVvZihldkpTT04uX190aGlzKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTsNCiAgICAgICAgDQoNCg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZihfX2V2ZW50ICYmICFfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQoNCiAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICBpZihfX2V2ZW50ICYmIF9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGFuc3dlciA9IFR5cGVfQXR0cmlidXRlKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZighX19ldmVudCl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KDQoNCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBpZihhbnN3ZXIpew0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHtfX3RoaXM6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcmV0dXJuIGFuc3dlcjsNCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBUeXBlX0F0dHJpYnV0ZS5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgZmluZChfX2V2ZW50KXsNCiAgICAgICAgICAgIGxldCBfX3RvU3RyaW5nID0gJ1R5cGVfQXR0cmlidXRlLmZpbmQoKTogJzsNCg0KICAgICAgICAgICAgbGV0IGFuc3dlciA9IHVuZGVmaW5lZDsNCg0KICAgICAgICAgICAgbGV0IF9fcmVzcG9uc2UgPSBuZXcgZXNwdGVzdC5jb20ubmFtbW91ci5kY29tLkV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3RpY2tzKyddLlR5cGVfQXR0cmlidXRlLmZpbmQoKScpLm1ldGhvZCgnZmluZCcpLmNsYXNzTmFtZSgnVHlwZV9BdHRyaWJ1dGUnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQoNCiAgICAgICAgICAgIGxldCBldkpTT04gPSBudWxsOw0KICAgICAgICAgICAgaWYoX19ldmVudCl7DQogICAgICAgICAgICAgICAgZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICAgICAgaWYodHlwZW9mKGV2SlNPTi5fX3RoaXMpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgICAgICB0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpOw0KICAgICAgICANCg0KDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKF9fZXZlbnQgJiYgIV9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCg0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgIGlmKF9fZXZlbnQgJiYgX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgYW5zd2VyID0gVHlwZV9BdHRyaWJ1dGUoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKCFfX2V2ZW50KXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICANCg0KICAgICAgICAgICAgfQ0KDQoNCg0KDQogICAgICAgICAgICBpZighX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGlmKGFuc3dlcil7DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoe19fdGhpczogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICByZXR1cm4gYW5zd2VyOw0KICAgICAgICB9DQogICAgDQogICAgfTsNCg0KICAgIGVzcHRlc3QuY29tID0gZXNwdGVzdC5jb20gfHwge307ZXNwdGVzdC5jb20ubmFtbW91ciA9IGVzcHRlc3QuY29tLm5hbW1vdXIgfHwge307ZXNwdGVzdC5jb20ubmFtbW91ci5kaW90ID0gZXNwdGVzdC5jb20ubmFtbW91ci5kaW90IHx8IHt9Ow0KICAgIGVzcHRlc3QuY29tLm5hbW1vdXIuZGlvdC5EZXZpY2VfQ2F0ZWdvcnkgPSBjbGFzcyB7DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIERldmljZV9DYXRlZ29yeS5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBhY3RpdmUodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fYWN0aXZlID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9hY3RpdmU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogRGV2aWNlX0NhdGVnb3J5LmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBlbmFibGVkKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX2VuYWJsZWQgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2VuYWJsZWQ7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogRGV2aWNlX0NhdGVnb3J5LmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBjb2RlKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX2NvZGUgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2NvZGU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogRGV2aWNlX0NhdGVnb3J5Lm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgb3JkZXIodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fb3JkZXIgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX29yZGVyOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIERldmljZV9DYXRlZ29yeS5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgZGF0ZSh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9kYXRlID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9kYXRlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIERldmljZV9DYXRlZ29yeS5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgbmFtZSh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9uYW1lID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9uYW1lOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIERldmljZV9DYXRlZ29yeS5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICByZW1hcmsodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fcmVtYXJrID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9yZW1hcms7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogRGV2aWNlX0NhdGVnb3J5LnBhcmVudCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHBhcmVudCh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9wYXJlbnQgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3BhcmVudDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgIA0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBEZXZpY2VfQ2F0ZWdvcnkucGFyZW50X0RldmljZV9DYXRlZ29yeXMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBwYXJlbnRfRGV2aWNlX0NhdGVnb3J5cyh2KXsNCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBEZXZpY2VfQ2F0ZWdvcnkuY2F0ZWdvcnlfRGV2aWNlX1R5cGVzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgY2F0ZWdvcnlfRGV2aWNlX1R5cGVzKHYpew0KICAgICAgICB9DQogICAgDQogICAgDQogICAgICAgIF91bmlxdWUoKXsNCiAgICAgICAgICAgIGxldCBfX3RvU3RyaW5nID0gJ0RldmljZV9DYXRlZ29yeS5fdW5pcXVlKCk6ICc7DQogICAgICAgIA0KICAgICAgICAgICAgbGV0IHJldCA9IG5ldyB1bmRlZmluZWQoKTsNCiAgICAgICAgICAgIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5jb2RlKCkpIT09J3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTsNCiAgICANCiAgICAgICAgICAgIHJldHVybiByZXQ7DQogICAgICAgIH0NCg0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBEZXZpY2VfQ2F0ZWdvcnkuc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBzdG9yZShfX2V2ZW50KXsNCiAgICAgICAgICAgIGxldCBfX3RvU3RyaW5nID0gJ0RldmljZV9DYXRlZ29yeS5zdG9yZSgpOiAnOw0KDQogICAgICAgICAgICBsZXQgYW5zd2VyID0gdW5kZWZpbmVkOw0KDQogICAgICAgICAgICBsZXQgX19yZXNwb25zZSA9IG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrdGlja3MrJ10uRGV2aWNlX0NhdGVnb3J5LnN0b3JlKCknKS5tZXRob2QoJ3N0b3JlJykuY2xhc3NOYW1lKCdEZXZpY2VfQ2F0ZWdvcnknKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQoNCiAgICAgICAgICAgIGxldCBldkpTT04gPSBudWxsOw0KICAgICAgICAgICAgaWYoX19ldmVudCl7DQogICAgICAgICAgICAgICAgZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICAgICAgaWYodHlwZW9mKGV2SlNPTi5fX3RoaXMpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgICAgICB0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpOw0KICAgICAgICANCg0KDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKF9fZXZlbnQgJiYgIV9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCg0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgIGlmKF9fZXZlbnQgJiYgX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgYW5zd2VyID0gRGV2aWNlX0NhdGVnb3J5KCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZighX19ldmVudCl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgLy8gc3RvcmUgbG9jYWxseQ0KICAgICAgICAgICAgICAgIGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgnRGV2aWNlX0NhdGVnb3J5Jyk7DQoNCiAgICAgICAgICAgICAgICBsZXQgX3RoaXMgPSB0aGlzLl91bmlxdWUoKS5maW5kKCk7DQogICAgICAgICAgICAgICAgaWYoIV90aGlzKSBnci5zZXROZXdHdWlkVmFsdWUodGhpcy5JZCB8fCAodGhpcy5JZCA9IGdyLnNldE5ld0d1aWQoKSkpOw0KICAgICAgICAgICAgICAgIGlmKF90aGlzICYmIHR5cGVvZihfdGhpcy5JZCkhPT0ndW5kZWZpbmVkJykgZ3IuZ2V0KF90aGlzLklkKTsNCg0KICAgICAgICAgICAgICAgIGxldCBiU2V0ID0gZmFsc2U7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGlmKF90aGlzICYmIHR5cGVvZihfdGhpcy5nZXRjb2RlKCkpIT09J3VuZGVmaW5lZCcpIGJTZXQgPSBnci5zZXRWYWx1ZSgnY29kZScsIF90aGlzLmdldGNvZGUoKSk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGlmKGJTZXQpew0KICAgICAgICAgICAgICAgICAgICB0aGlzLklkID0gZ3IudXBkYXRlKCk7DQogICAgICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJ0aGlzLklkID0gIiArIHRoaXMuSWQpOw0KICAgICAgICAgICAgICAgICAgICBpZighYW5zd2VyKSBhbnN3ZXIgPSB0aGlzOw0KICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiaW52YWxpZCBvYmplY3QiKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KDQoNCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBpZihhbnN3ZXIpew0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHtfX3RoaXM6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcmV0dXJuIGFuc3dlcjsNCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBEZXZpY2VfQ2F0ZWdvcnkuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGZpbmRBbGwoX19ldmVudCl7DQogICAgICAgICAgICBsZXQgX190b1N0cmluZyA9ICdEZXZpY2VfQ2F0ZWdvcnkuZmluZEFsbCgpOiAnOw0KDQogICAgICAgICAgICBsZXQgYW5zd2VyID0gdW5kZWZpbmVkOw0KDQogICAgICAgICAgICBsZXQgX19yZXNwb25zZSA9IG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrdGlja3MrJ10uRGV2aWNlX0NhdGVnb3J5LmZpbmRBbGwoKScpLm1ldGhvZCgnZmluZEFsbCcpLmNsYXNzTmFtZSgnRGV2aWNlX0NhdGVnb3J5JykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOw0KDQogICAgICAgICAgICBsZXQgZXZKU09OID0gbnVsbDsNCiAgICAgICAgICAgIGlmKF9fZXZlbnQpew0KICAgICAgICAgICAgICAgIGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgICAgIGlmKHR5cGVvZihldkpTT04uX190aGlzKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTsNCiAgICAgICAgDQoNCg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZihfX2V2ZW50ICYmICFfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQoNCiAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICBpZihfX2V2ZW50ICYmIF9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGFuc3dlciA9IERldmljZV9DYXRlZ29yeSgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIA0KDQogICAgICAgICAgICB9DQoNCg0KDQoNCiAgICAgICAgICAgIGlmKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgaWYoYW5zd2VyKXsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7X190aGlzOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHJldHVybiBhbnN3ZXI7DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogRGV2aWNlX0NhdGVnb3J5LmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBmaW5kKF9fZXZlbnQpew0KICAgICAgICAgICAgbGV0IF9fdG9TdHJpbmcgPSAnRGV2aWNlX0NhdGVnb3J5LmZpbmQoKTogJzsNCg0KICAgICAgICAgICAgbGV0IGFuc3dlciA9IHVuZGVmaW5lZDsNCg0KICAgICAgICAgICAgbGV0IF9fcmVzcG9uc2UgPSBuZXcgZXNwdGVzdC5jb20ubmFtbW91ci5kY29tLkV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3RpY2tzKyddLkRldmljZV9DYXRlZ29yeS5maW5kKCknKS5tZXRob2QoJ2ZpbmQnKS5jbGFzc05hbWUoJ0RldmljZV9DYXRlZ29yeScpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCg0KICAgICAgICAgICAgbGV0IGV2SlNPTiA9IG51bGw7DQogICAgICAgICAgICBpZihfX2V2ZW50KXsNCiAgICAgICAgICAgICAgICBldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgICAgICBpZih0eXBlb2YoZXZKU09OLl9fdGhpcykhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7DQogICAgICAgIA0KDQoNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoX19ldmVudCAmJiAhX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KDQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgaWYoX19ldmVudCAmJiBfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBhbnN3ZXIgPSBEZXZpY2VfQ2F0ZWdvcnkoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKCFfX2V2ZW50KXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICANCg0KICAgICAgICAgICAgfQ0KDQoNCg0KDQogICAgICAgICAgICBpZighX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGlmKGFuc3dlcil7DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoe19fdGhpczogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICByZXR1cm4gYW5zd2VyOw0KICAgICAgICB9DQogICAgDQogICAgfTsNCg0KICAgIGVzcHRlc3QuY29tID0gZXNwdGVzdC5jb20gfHwge307ZXNwdGVzdC5jb20ubmFtbW91ciA9IGVzcHRlc3QuY29tLm5hbW1vdXIgfHwge307ZXNwdGVzdC5jb20ubmFtbW91ci5kaW90ID0gZXNwdGVzdC5jb20ubmFtbW91ci5kaW90IHx8IHt9Ow0KICAgIGVzcHRlc3QuY29tLm5hbW1vdXIuZGlvdC5EZXZpY2VfVHlwZSA9IGNsYXNzIHsNCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogRGV2aWNlX1R5cGUuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgYWN0aXZlKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX2FjdGl2ZSA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fYWN0aXZlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIERldmljZV9UeXBlLmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBlbmFibGVkKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX2VuYWJsZWQgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2VuYWJsZWQ7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogRGV2aWNlX1R5cGUuY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGNvZGUodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fY29kZSA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fY29kZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBEZXZpY2VfVHlwZS5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIG9yZGVyKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX29yZGVyID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9vcmRlcjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBEZXZpY2VfVHlwZS5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgZGF0ZSh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9kYXRlID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9kYXRlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIERldmljZV9UeXBlLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBuYW1lKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX25hbWUgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX25hbWU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogRGV2aWNlX1R5cGUucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgcmVtYXJrKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX3JlbWFyayA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fcmVtYXJrOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIERldmljZV9UeXBlLmNhdGVnb3J5IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgY2F0ZWdvcnkodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fY2F0ZWdvcnkgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2NhdGVnb3J5Ow0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgDQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIERldmljZV9UeXBlLmRldmljZVR5cGVfTWV0cmljcyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGRldmljZVR5cGVfTWV0cmljcyh2KXsNCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBEZXZpY2VfVHlwZS50eXBlX0RldmljZXMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICB0eXBlX0RldmljZXModil7DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogRGV2aWNlX1R5cGUuZGV2aWNlVHlwZV9UeXBlX0F0dHJpYnV0ZXMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBkZXZpY2VUeXBlX1R5cGVfQXR0cmlidXRlcyh2KXsNCiAgICAgICAgfQ0KICAgIA0KICAgIA0KICAgICAgICBfdW5pcXVlKCl7DQogICAgICAgICAgICBsZXQgX190b1N0cmluZyA9ICdEZXZpY2VfVHlwZS5fdW5pcXVlKCk6ICc7DQogICAgICAgIA0KICAgICAgICAgICAgbGV0IHJldCA9IG5ldyB1bmRlZmluZWQoKTsNCiAgICAgICAgICAgIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5jb2RlKCkpIT09J3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTsNCiAgICANCiAgICAgICAgICAgIHJldHVybiByZXQ7DQogICAgICAgIH0NCg0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBEZXZpY2VfVHlwZS5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHN0b3JlKF9fZXZlbnQpew0KICAgICAgICAgICAgbGV0IF9fdG9TdHJpbmcgPSAnRGV2aWNlX1R5cGUuc3RvcmUoKTogJzsNCg0KICAgICAgICAgICAgbGV0IGFuc3dlciA9IHVuZGVmaW5lZDsNCg0KICAgICAgICAgICAgbGV0IF9fcmVzcG9uc2UgPSBuZXcgZXNwdGVzdC5jb20ubmFtbW91ci5kY29tLkV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3RpY2tzKyddLkRldmljZV9UeXBlLnN0b3JlKCknKS5tZXRob2QoJ3N0b3JlJykuY2xhc3NOYW1lKCdEZXZpY2VfVHlwZScpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCg0KICAgICAgICAgICAgbGV0IGV2SlNPTiA9IG51bGw7DQogICAgICAgICAgICBpZihfX2V2ZW50KXsNCiAgICAgICAgICAgICAgICBldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgICAgICBpZih0eXBlb2YoZXZKU09OLl9fdGhpcykhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7DQogICAgICAgIA0KDQoNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoX19ldmVudCAmJiAhX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KDQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgaWYoX19ldmVudCAmJiBfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBhbnN3ZXIgPSBEZXZpY2VfVHlwZSgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIHN0b3JlIGxvY2FsbHkNCiAgICAgICAgICAgICAgICBsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ0RldmljZV9UeXBlJyk7DQoNCiAgICAgICAgICAgICAgICBsZXQgX3RoaXMgPSB0aGlzLl91bmlxdWUoKS5maW5kKCk7DQogICAgICAgICAgICAgICAgaWYoIV90aGlzKSBnci5zZXROZXdHdWlkVmFsdWUodGhpcy5JZCB8fCAodGhpcy5JZCA9IGdyLnNldE5ld0d1aWQoKSkpOw0KICAgICAgICAgICAgICAgIGlmKF90aGlzICYmIHR5cGVvZihfdGhpcy5JZCkhPT0ndW5kZWZpbmVkJykgZ3IuZ2V0KF90aGlzLklkKTsNCg0KICAgICAgICAgICAgICAgIGxldCBiU2V0ID0gZmFsc2U7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGlmKF90aGlzICYmIHR5cGVvZihfdGhpcy5nZXRjb2RlKCkpIT09J3VuZGVmaW5lZCcpIGJTZXQgPSBnci5zZXRWYWx1ZSgnY29kZScsIF90aGlzLmdldGNvZGUoKSk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGlmKGJTZXQpew0KICAgICAgICAgICAgICAgICAgICB0aGlzLklkID0gZ3IudXBkYXRlKCk7DQogICAgICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJ0aGlzLklkID0gIiArIHRoaXMuSWQpOw0KICAgICAgICAgICAgICAgICAgICBpZighYW5zd2VyKSBhbnN3ZXIgPSB0aGlzOw0KICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiaW52YWxpZCBvYmplY3QiKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KDQoNCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBpZihhbnN3ZXIpew0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHtfX3RoaXM6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcmV0dXJuIGFuc3dlcjsNCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBEZXZpY2VfVHlwZS5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgZmluZEFsbChfX2V2ZW50KXsNCiAgICAgICAgICAgIGxldCBfX3RvU3RyaW5nID0gJ0RldmljZV9UeXBlLmZpbmRBbGwoKTogJzsNCg0KICAgICAgICAgICAgbGV0IGFuc3dlciA9IHVuZGVmaW5lZDsNCg0KICAgICAgICAgICAgbGV0IF9fcmVzcG9uc2UgPSBuZXcgZXNwdGVzdC5jb20ubmFtbW91ci5kY29tLkV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3RpY2tzKyddLkRldmljZV9UeXBlLmZpbmRBbGwoKScpLm1ldGhvZCgnZmluZEFsbCcpLmNsYXNzTmFtZSgnRGV2aWNlX1R5cGUnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQoNCiAgICAgICAgICAgIGxldCBldkpTT04gPSBudWxsOw0KICAgICAgICAgICAgaWYoX19ldmVudCl7DQogICAgICAgICAgICAgICAgZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICAgICAgaWYodHlwZW9mKGV2SlNPTi5fX3RoaXMpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgICAgICB0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpOw0KICAgICAgICANCg0KDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKF9fZXZlbnQgJiYgIV9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCg0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgIGlmKF9fZXZlbnQgJiYgX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgYW5zd2VyID0gRGV2aWNlX1R5cGUoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKCFfX2V2ZW50KXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICANCg0KICAgICAgICAgICAgfQ0KDQoNCg0KDQogICAgICAgICAgICBpZighX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGlmKGFuc3dlcil7DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoe19fdGhpczogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICByZXR1cm4gYW5zd2VyOw0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIERldmljZV9UeXBlLmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBmaW5kKF9fZXZlbnQpew0KICAgICAgICAgICAgbGV0IF9fdG9TdHJpbmcgPSAnRGV2aWNlX1R5cGUuZmluZCgpOiAnOw0KDQogICAgICAgICAgICBsZXQgYW5zd2VyID0gdW5kZWZpbmVkOw0KDQogICAgICAgICAgICBsZXQgX19yZXNwb25zZSA9IG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrdGlja3MrJ10uRGV2aWNlX1R5cGUuZmluZCgpJykubWV0aG9kKCdmaW5kJykuY2xhc3NOYW1lKCdEZXZpY2VfVHlwZScpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCg0KICAgICAgICAgICAgbGV0IGV2SlNPTiA9IG51bGw7DQogICAgICAgICAgICBpZihfX2V2ZW50KXsNCiAgICAgICAgICAgICAgICBldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgICAgICBpZih0eXBlb2YoZXZKU09OLl9fdGhpcykhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7DQogICAgICAgIA0KDQoNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoX19ldmVudCAmJiAhX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KDQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgaWYoX19ldmVudCAmJiBfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBhbnN3ZXIgPSBEZXZpY2VfVHlwZSgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIA0KDQogICAgICAgICAgICB9DQoNCg0KDQoNCiAgICAgICAgICAgIGlmKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgaWYoYW5zd2VyKXsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7X190aGlzOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHJldHVybiBhbnN3ZXI7DQogICAgICAgIH0NCiAgICANCiAgICB9Ow0KDQogICAgZXNwdGVzdC5jb20gPSBlc3B0ZXN0LmNvbSB8fCB7fTtlc3B0ZXN0LmNvbS5uYW1tb3VyID0gZXNwdGVzdC5jb20ubmFtbW91ciB8fCB7fTtlc3B0ZXN0LmNvbS5uYW1tb3VyLmRpb3QgPSBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRpb3QgfHwge307DQogICAgZXNwdGVzdC5jb20ubmFtbW91ci5kaW90Lk1ldHJpY19Hcm91cCA9IGNsYXNzIHsNCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTWV0cmljX0dyb3VwLmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGFjdGl2ZSh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9hY3RpdmUgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2FjdGl2ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBNZXRyaWNfR3JvdXAuZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGVuYWJsZWQodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fZW5hYmxlZCA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZW5hYmxlZDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBNZXRyaWNfR3JvdXAuY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGNvZGUodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fY29kZSA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fY29kZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBNZXRyaWNfR3JvdXAub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBvcmRlcih2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9vcmRlciA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fb3JkZXI7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTWV0cmljX0dyb3VwLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBkYXRlKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX2RhdGUgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2RhdGU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTWV0cmljX0dyb3VwLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBuYW1lKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX25hbWUgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX25hbWU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTWV0cmljX0dyb3VwLnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHJlbWFyayh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9yZW1hcmsgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3JlbWFyazsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgIA0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBNZXRyaWNfR3JvdXAuZ3JvdXBfTWV0cmljX1R5cGVzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgZ3JvdXBfTWV0cmljX1R5cGVzKHYpew0KICAgICAgICB9DQogICAgDQogICAgDQogICAgICAgIF91bmlxdWUoKXsNCiAgICAgICAgICAgIGxldCBfX3RvU3RyaW5nID0gJ01ldHJpY19Hcm91cC5fdW5pcXVlKCk6ICc7DQogICAgICAgIA0KICAgICAgICAgICAgbGV0IHJldCA9IG5ldyB1bmRlZmluZWQoKTsNCiAgICAgICAgICAgIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5jb2RlKCkpIT09J3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTsNCiAgICANCiAgICAgICAgICAgIHJldHVybiByZXQ7DQogICAgICAgIH0NCg0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBNZXRyaWNfR3JvdXAuc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBzdG9yZShfX2V2ZW50KXsNCiAgICAgICAgICAgIGxldCBfX3RvU3RyaW5nID0gJ01ldHJpY19Hcm91cC5zdG9yZSgpOiAnOw0KDQogICAgICAgICAgICBsZXQgYW5zd2VyID0gdW5kZWZpbmVkOw0KDQogICAgICAgICAgICBsZXQgX19yZXNwb25zZSA9IG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrdGlja3MrJ10uTWV0cmljX0dyb3VwLnN0b3JlKCknKS5tZXRob2QoJ3N0b3JlJykuY2xhc3NOYW1lKCdNZXRyaWNfR3JvdXAnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQoNCiAgICAgICAgICAgIGxldCBldkpTT04gPSBudWxsOw0KICAgICAgICAgICAgaWYoX19ldmVudCl7DQogICAgICAgICAgICAgICAgZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICAgICAgaWYodHlwZW9mKGV2SlNPTi5fX3RoaXMpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgICAgICB0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpOw0KICAgICAgICANCg0KDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKF9fZXZlbnQgJiYgIV9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCg0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgIGlmKF9fZXZlbnQgJiYgX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgYW5zd2VyID0gTWV0cmljX0dyb3VwKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZighX19ldmVudCl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgLy8gc3RvcmUgbG9jYWxseQ0KICAgICAgICAgICAgICAgIGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgnTWV0cmljX0dyb3VwJyk7DQoNCiAgICAgICAgICAgICAgICBsZXQgX3RoaXMgPSB0aGlzLl91bmlxdWUoKS5maW5kKCk7DQogICAgICAgICAgICAgICAgaWYoIV90aGlzKSBnci5zZXROZXdHdWlkVmFsdWUodGhpcy5JZCB8fCAodGhpcy5JZCA9IGdyLnNldE5ld0d1aWQoKSkpOw0KICAgICAgICAgICAgICAgIGlmKF90aGlzICYmIHR5cGVvZihfdGhpcy5JZCkhPT0ndW5kZWZpbmVkJykgZ3IuZ2V0KF90aGlzLklkKTsNCg0KICAgICAgICAgICAgICAgIGxldCBiU2V0ID0gZmFsc2U7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGlmKF90aGlzICYmIHR5cGVvZihfdGhpcy5nZXRjb2RlKCkpIT09J3VuZGVmaW5lZCcpIGJTZXQgPSBnci5zZXRWYWx1ZSgnY29kZScsIF90aGlzLmdldGNvZGUoKSk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGlmKGJTZXQpew0KICAgICAgICAgICAgICAgICAgICB0aGlzLklkID0gZ3IudXBkYXRlKCk7DQogICAgICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJ0aGlzLklkID0gIiArIHRoaXMuSWQpOw0KICAgICAgICAgICAgICAgICAgICBpZighYW5zd2VyKSBhbnN3ZXIgPSB0aGlzOw0KICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiaW52YWxpZCBvYmplY3QiKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KDQoNCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBpZihhbnN3ZXIpew0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHtfX3RoaXM6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcmV0dXJuIGFuc3dlcjsNCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBNZXRyaWNfR3JvdXAuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGZpbmRBbGwoX19ldmVudCl7DQogICAgICAgICAgICBsZXQgX190b1N0cmluZyA9ICdNZXRyaWNfR3JvdXAuZmluZEFsbCgpOiAnOw0KDQogICAgICAgICAgICBsZXQgYW5zd2VyID0gdW5kZWZpbmVkOw0KDQogICAgICAgICAgICBsZXQgX19yZXNwb25zZSA9IG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrdGlja3MrJ10uTWV0cmljX0dyb3VwLmZpbmRBbGwoKScpLm1ldGhvZCgnZmluZEFsbCcpLmNsYXNzTmFtZSgnTWV0cmljX0dyb3VwJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOw0KDQogICAgICAgICAgICBsZXQgZXZKU09OID0gbnVsbDsNCiAgICAgICAgICAgIGlmKF9fZXZlbnQpew0KICAgICAgICAgICAgICAgIGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgICAgIGlmKHR5cGVvZihldkpTT04uX190aGlzKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTsNCiAgICAgICAgDQoNCg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZihfX2V2ZW50ICYmICFfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQoNCiAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICBpZihfX2V2ZW50ICYmIF9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGFuc3dlciA9IE1ldHJpY19Hcm91cCgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIA0KDQogICAgICAgICAgICB9DQoNCg0KDQoNCiAgICAgICAgICAgIGlmKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgaWYoYW5zd2VyKXsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7X190aGlzOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHJldHVybiBhbnN3ZXI7DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTWV0cmljX0dyb3VwLmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBmaW5kKF9fZXZlbnQpew0KICAgICAgICAgICAgbGV0IF9fdG9TdHJpbmcgPSAnTWV0cmljX0dyb3VwLmZpbmQoKTogJzsNCg0KICAgICAgICAgICAgbGV0IGFuc3dlciA9IHVuZGVmaW5lZDsNCg0KICAgICAgICAgICAgbGV0IF9fcmVzcG9uc2UgPSBuZXcgZXNwdGVzdC5jb20ubmFtbW91ci5kY29tLkV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3RpY2tzKyddLk1ldHJpY19Hcm91cC5maW5kKCknKS5tZXRob2QoJ2ZpbmQnKS5jbGFzc05hbWUoJ01ldHJpY19Hcm91cCcpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCg0KICAgICAgICAgICAgbGV0IGV2SlNPTiA9IG51bGw7DQogICAgICAgICAgICBpZihfX2V2ZW50KXsNCiAgICAgICAgICAgICAgICBldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgICAgICBpZih0eXBlb2YoZXZKU09OLl9fdGhpcykhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7DQogICAgICAgIA0KDQoNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoX19ldmVudCAmJiAhX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KDQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgaWYoX19ldmVudCAmJiBfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBhbnN3ZXIgPSBNZXRyaWNfR3JvdXAoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKCFfX2V2ZW50KXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICANCg0KICAgICAgICAgICAgfQ0KDQoNCg0KDQogICAgICAgICAgICBpZighX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGlmKGFuc3dlcil7DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoe19fdGhpczogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICByZXR1cm4gYW5zd2VyOw0KICAgICAgICB9DQogICAgDQogICAgfTsNCg0KICAgIGVzcHRlc3QuY29tID0gZXNwdGVzdC5jb20gfHwge307ZXNwdGVzdC5jb20ubmFtbW91ciA9IGVzcHRlc3QuY29tLm5hbW1vdXIgfHwge307ZXNwdGVzdC5jb20ubmFtbW91ci5kaW90ID0gZXNwdGVzdC5jb20ubmFtbW91ci5kaW90IHx8IHt9Ow0KICAgIGVzcHRlc3QuY29tLm5hbW1vdXIuZGlvdC5NZXRyaWNfVHlwZSA9IGNsYXNzIHsNCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTWV0cmljX1R5cGUuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgYWN0aXZlKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX2FjdGl2ZSA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fYWN0aXZlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE1ldHJpY19UeXBlLmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBlbmFibGVkKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX2VuYWJsZWQgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2VuYWJsZWQ7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTWV0cmljX1R5cGUuY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGNvZGUodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fY29kZSA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fY29kZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBNZXRyaWNfVHlwZS5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIG9yZGVyKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX29yZGVyID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9vcmRlcjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBNZXRyaWNfVHlwZS5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgZGF0ZSh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9kYXRlID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9kYXRlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE1ldHJpY19UeXBlLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBuYW1lKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX25hbWUgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX25hbWU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTWV0cmljX1R5cGUucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgcmVtYXJrKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX3JlbWFyayA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fcmVtYXJrOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE1ldHJpY19UeXBlLmdyb3VwIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgZ3JvdXAodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fZ3JvdXAgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2dyb3VwOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgDQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE1ldHJpY19UeXBlLnR5cGVfTWV0cmljcyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHR5cGVfTWV0cmljcyh2KXsNCiAgICAgICAgfQ0KICAgIA0KICAgIA0KICAgICAgICBfdW5pcXVlKCl7DQogICAgICAgICAgICBsZXQgX190b1N0cmluZyA9ICdNZXRyaWNfVHlwZS5fdW5pcXVlKCk6ICc7DQogICAgICAgIA0KICAgICAgICAgICAgbGV0IHJldCA9IG5ldyB1bmRlZmluZWQoKTsNCiAgICAgICAgICAgIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5jb2RlKCkpIT09J3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTsNCiAgICANCiAgICAgICAgICAgIHJldHVybiByZXQ7DQogICAgICAgIH0NCg0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBNZXRyaWNfVHlwZS5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHN0b3JlKF9fZXZlbnQpew0KICAgICAgICAgICAgbGV0IF9fdG9TdHJpbmcgPSAnTWV0cmljX1R5cGUuc3RvcmUoKTogJzsNCg0KICAgICAgICAgICAgbGV0IGFuc3dlciA9IHVuZGVmaW5lZDsNCg0KICAgICAgICAgICAgbGV0IF9fcmVzcG9uc2UgPSBuZXcgZXNwdGVzdC5jb20ubmFtbW91ci5kY29tLkV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3RpY2tzKyddLk1ldHJpY19UeXBlLnN0b3JlKCknKS5tZXRob2QoJ3N0b3JlJykuY2xhc3NOYW1lKCdNZXRyaWNfVHlwZScpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCg0KICAgICAgICAgICAgbGV0IGV2SlNPTiA9IG51bGw7DQogICAgICAgICAgICBpZihfX2V2ZW50KXsNCiAgICAgICAgICAgICAgICBldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgICAgICBpZih0eXBlb2YoZXZKU09OLl9fdGhpcykhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7DQogICAgICAgIA0KDQoNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoX19ldmVudCAmJiAhX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KDQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgaWYoX19ldmVudCAmJiBfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBhbnN3ZXIgPSBNZXRyaWNfVHlwZSgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIHN0b3JlIGxvY2FsbHkNCiAgICAgICAgICAgICAgICBsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ01ldHJpY19UeXBlJyk7DQoNCiAgICAgICAgICAgICAgICBsZXQgX3RoaXMgPSB0aGlzLl91bmlxdWUoKS5maW5kKCk7DQogICAgICAgICAgICAgICAgaWYoIV90aGlzKSBnci5zZXROZXdHdWlkVmFsdWUodGhpcy5JZCB8fCAodGhpcy5JZCA9IGdyLnNldE5ld0d1aWQoKSkpOw0KICAgICAgICAgICAgICAgIGlmKF90aGlzICYmIHR5cGVvZihfdGhpcy5JZCkhPT0ndW5kZWZpbmVkJykgZ3IuZ2V0KF90aGlzLklkKTsNCg0KICAgICAgICAgICAgICAgIGxldCBiU2V0ID0gZmFsc2U7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGlmKF90aGlzICYmIHR5cGVvZihfdGhpcy5nZXRjb2RlKCkpIT09J3VuZGVmaW5lZCcpIGJTZXQgPSBnci5zZXRWYWx1ZSgnY29kZScsIF90aGlzLmdldGNvZGUoKSk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGlmKGJTZXQpew0KICAgICAgICAgICAgICAgICAgICB0aGlzLklkID0gZ3IudXBkYXRlKCk7DQogICAgICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJ0aGlzLklkID0gIiArIHRoaXMuSWQpOw0KICAgICAgICAgICAgICAgICAgICBpZighYW5zd2VyKSBhbnN3ZXIgPSB0aGlzOw0KICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiaW52YWxpZCBvYmplY3QiKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KDQoNCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBpZihhbnN3ZXIpew0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHtfX3RoaXM6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcmV0dXJuIGFuc3dlcjsNCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBNZXRyaWNfVHlwZS5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgZmluZEFsbChfX2V2ZW50KXsNCiAgICAgICAgICAgIGxldCBfX3RvU3RyaW5nID0gJ01ldHJpY19UeXBlLmZpbmRBbGwoKTogJzsNCg0KICAgICAgICAgICAgbGV0IGFuc3dlciA9IHVuZGVmaW5lZDsNCg0KICAgICAgICAgICAgbGV0IF9fcmVzcG9uc2UgPSBuZXcgZXNwdGVzdC5jb20ubmFtbW91ci5kY29tLkV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3RpY2tzKyddLk1ldHJpY19UeXBlLmZpbmRBbGwoKScpLm1ldGhvZCgnZmluZEFsbCcpLmNsYXNzTmFtZSgnTWV0cmljX1R5cGUnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQoNCiAgICAgICAgICAgIGxldCBldkpTT04gPSBudWxsOw0KICAgICAgICAgICAgaWYoX19ldmVudCl7DQogICAgICAgICAgICAgICAgZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICAgICAgaWYodHlwZW9mKGV2SlNPTi5fX3RoaXMpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgICAgICB0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpOw0KICAgICAgICANCg0KDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKF9fZXZlbnQgJiYgIV9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCg0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgIGlmKF9fZXZlbnQgJiYgX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgYW5zd2VyID0gTWV0cmljX1R5cGUoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKCFfX2V2ZW50KXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICANCg0KICAgICAgICAgICAgfQ0KDQoNCg0KDQogICAgICAgICAgICBpZighX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGlmKGFuc3dlcil7DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoe19fdGhpczogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICByZXR1cm4gYW5zd2VyOw0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE1ldHJpY19UeXBlLmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBmaW5kKF9fZXZlbnQpew0KICAgICAgICAgICAgbGV0IF9fdG9TdHJpbmcgPSAnTWV0cmljX1R5cGUuZmluZCgpOiAnOw0KDQogICAgICAgICAgICBsZXQgYW5zd2VyID0gdW5kZWZpbmVkOw0KDQogICAgICAgICAgICBsZXQgX19yZXNwb25zZSA9IG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrdGlja3MrJ10uTWV0cmljX1R5cGUuZmluZCgpJykubWV0aG9kKCdmaW5kJykuY2xhc3NOYW1lKCdNZXRyaWNfVHlwZScpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCg0KICAgICAgICAgICAgbGV0IGV2SlNPTiA9IG51bGw7DQogICAgICAgICAgICBpZihfX2V2ZW50KXsNCiAgICAgICAgICAgICAgICBldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgICAgICBpZih0eXBlb2YoZXZKU09OLl9fdGhpcykhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7DQogICAgICAgIA0KDQoNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoX19ldmVudCAmJiAhX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KDQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgaWYoX19ldmVudCAmJiBfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBhbnN3ZXIgPSBNZXRyaWNfVHlwZSgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIA0KDQogICAgICAgICAgICB9DQoNCg0KDQoNCiAgICAgICAgICAgIGlmKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgaWYoYW5zd2VyKXsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7X190aGlzOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHJldHVybiBhbnN3ZXI7DQogICAgICAgIH0NCiAgICANCiAgICB9Ow0KDQogICAgZXNwdGVzdC5jb20gPSBlc3B0ZXN0LmNvbSB8fCB7fTtlc3B0ZXN0LmNvbS5uYW1tb3VyID0gZXNwdGVzdC5jb20ubmFtbW91ciB8fCB7fTtlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20gPSBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20gfHwge307DQogICAgZXNwdGVzdC5jb20ubmFtbW91ci5kY29tLkNvbmZpZyA9IGNsYXNzIHsNCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogQ29uZmlnLmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGFjdGl2ZSh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9hY3RpdmUgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2FjdGl2ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBDb25maWcuZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGVuYWJsZWQodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fZW5hYmxlZCA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZW5hYmxlZDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBDb25maWcuY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGNvZGUodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fY29kZSA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fY29kZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBDb25maWcub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBvcmRlcih2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9vcmRlciA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fb3JkZXI7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogQ29uZmlnLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBkYXRlKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX2RhdGUgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2RhdGU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogQ29uZmlnLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBuYW1lKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX25hbWUgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX25hbWU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogQ29uZmlnLnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHJlbWFyayh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9yZW1hcmsgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3JlbWFyazsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBDb25maWcudmFsdWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICB2YWx1ZSh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl92YWx1ZSA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fdmFsdWU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogQ29uZmlnLnNjcmlwdCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHNjcmlwdCh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9zY3JpcHQgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3NjcmlwdDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBDb25maWcudG9vbCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHRvb2wodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fdG9vbCA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fdG9vbDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBDb25maWcuZ3JvdXAgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBncm91cCh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9ncm91cCA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZ3JvdXA7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogQ29uZmlnLnR5cGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICB0eXBlKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX3R5cGUgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3R5cGU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogQ29uZmlnLm5vZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBub2RlKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX25vZGUgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX25vZGU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICANCiAgICANCiAgICANCiAgICAgICAgX3VuaXF1ZSgpew0KICAgICAgICAgICAgbGV0IF9fdG9TdHJpbmcgPSAnQ29uZmlnLl91bmlxdWUoKTogJzsNCiAgICAgICAgDQogICAgICAgICAgICBsZXQgcmV0ID0gbmV3IHVuZGVmaW5lZCgpOw0KICAgICAgICAgICAgaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDsNCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZih0aGlzLm5hbWUoKSkhPT0ndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpOw0KICAgIA0KICAgICAgICAgICAgcmV0dXJuIHJldDsNCiAgICAgICAgfQ0KDQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIENvbmZpZy5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHN0b3JlKF9fZXZlbnQpew0KICAgICAgICAgICAgbGV0IF9fdG9TdHJpbmcgPSAnQ29uZmlnLnN0b3JlKCk6ICc7DQoNCiAgICAgICAgICAgIGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7DQoNCiAgICAgICAgICAgIGxldCBfX3Jlc3BvbnNlID0gbmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5FdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJyt0aWNrcysnXS5Db25maWcuc3RvcmUoKScpLm1ldGhvZCgnc3RvcmUnKS5jbGFzc05hbWUoJ0NvbmZpZycpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCg0KICAgICAgICAgICAgbGV0IGV2SlNPTiA9IG51bGw7DQogICAgICAgICAgICBpZihfX2V2ZW50KXsNCiAgICAgICAgICAgICAgICBldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgICAgICBpZih0eXBlb2YoZXZKU09OLl9fdGhpcykhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7DQogICAgICAgIA0KDQoNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoX19ldmVudCAmJiAhX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KDQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgaWYoX19ldmVudCAmJiBfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBhbnN3ZXIgPSBDb25maWcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKCFfX2V2ZW50KXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBzdG9yZSBsb2NhbGx5DQogICAgICAgICAgICAgICAgbGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCdDb25maWcnKTsNCg0KICAgICAgICAgICAgICAgIGxldCBfdGhpcyA9IHRoaXMuX3VuaXF1ZSgpLmZpbmQoKTsNCiAgICAgICAgICAgICAgICBpZighX3RoaXMpIGdyLnNldE5ld0d1aWRWYWx1ZSh0aGlzLklkIHx8ICh0aGlzLklkID0gZ3Iuc2V0TmV3R3VpZCgpKSk7DQogICAgICAgICAgICAgICAgaWYoX3RoaXMgJiYgdHlwZW9mKF90aGlzLklkKSE9PSd1bmRlZmluZWQnKSBnci5nZXQoX3RoaXMuSWQpOw0KDQogICAgICAgICAgICAgICAgbGV0IGJTZXQgPSBmYWxzZTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgaWYoX3RoaXMgJiYgdHlwZW9mKF90aGlzLmdldG5hbWUoKSkhPT0ndW5kZWZpbmVkJykgYlNldCA9IGdyLnNldFZhbHVlKCduYW1lJywgX3RoaXMuZ2V0bmFtZSgpKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgaWYoYlNldCl7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuSWQgPSBnci51cGRhdGUoKTsNCiAgICAgICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgInRoaXMuSWQgPSAiICsgdGhpcy5JZCk7DQogICAgICAgICAgICAgICAgICAgIGlmKCFhbnN3ZXIpIGFuc3dlciA9IHRoaXM7DQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJpbnZhbGlkIG9iamVjdCIpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICANCg0KICAgICAgICAgICAgfQ0KDQoNCg0KDQogICAgICAgICAgICBpZighX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGlmKGFuc3dlcil7DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoe19fdGhpczogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICByZXR1cm4gYW5zd2VyOw0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIENvbmZpZy5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgZmluZEFsbChfX2V2ZW50KXsNCiAgICAgICAgICAgIGxldCBfX3RvU3RyaW5nID0gJ0NvbmZpZy5maW5kQWxsKCk6ICc7DQoNCiAgICAgICAgICAgIGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7DQoNCiAgICAgICAgICAgIGxldCBfX3Jlc3BvbnNlID0gbmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5FdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJyt0aWNrcysnXS5Db25maWcuZmluZEFsbCgpJykubWV0aG9kKCdmaW5kQWxsJykuY2xhc3NOYW1lKCdDb25maWcnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQoNCiAgICAgICAgICAgIGxldCBldkpTT04gPSBudWxsOw0KICAgICAgICAgICAgaWYoX19ldmVudCl7DQogICAgICAgICAgICAgICAgZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICAgICAgaWYodHlwZW9mKGV2SlNPTi5fX3RoaXMpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgICAgICB0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpOw0KICAgICAgICANCg0KDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKF9fZXZlbnQgJiYgIV9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCg0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgIGlmKF9fZXZlbnQgJiYgX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgYW5zd2VyID0gQ29uZmlnKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZighX19ldmVudCl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KDQoNCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBpZihhbnN3ZXIpew0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHtfX3RoaXM6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcmV0dXJuIGFuc3dlcjsNCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBDb25maWcuZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGZpbmQoX19ldmVudCl7DQogICAgICAgICAgICBsZXQgX190b1N0cmluZyA9ICdDb25maWcuZmluZCgpOiAnOw0KDQogICAgICAgICAgICBsZXQgYW5zd2VyID0gdW5kZWZpbmVkOw0KDQogICAgICAgICAgICBsZXQgX19yZXNwb25zZSA9IG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrdGlja3MrJ10uQ29uZmlnLmZpbmQoKScpLm1ldGhvZCgnZmluZCcpLmNsYXNzTmFtZSgnQ29uZmlnJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOw0KDQogICAgICAgICAgICBsZXQgZXZKU09OID0gbnVsbDsNCiAgICAgICAgICAgIGlmKF9fZXZlbnQpew0KICAgICAgICAgICAgICAgIGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgICAgIGlmKHR5cGVvZihldkpTT04uX190aGlzKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTsNCiAgICAgICAgDQoNCg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZihfX2V2ZW50ICYmICFfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQoNCiAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICBpZihfX2V2ZW50ICYmIF9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGFuc3dlciA9IENvbmZpZygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIA0KDQogICAgICAgICAgICB9DQoNCg0KDQoNCiAgICAgICAgICAgIGlmKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgaWYoYW5zd2VyKXsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7X190aGlzOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHJldHVybiBhbnN3ZXI7DQogICAgICAgIH0NCiAgICANCiAgICB9Ow0KDQogICAgZXNwdGVzdC5jb20gPSBlc3B0ZXN0LmNvbSB8fCB7fTtlc3B0ZXN0LmNvbS5uYW1tb3VyID0gZXNwdGVzdC5jb20ubmFtbW91ciB8fCB7fTtlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20gPSBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20gfHwge307DQogICAgZXNwdGVzdC5jb20ubmFtbW91ci5kY29tLlRvb2wgPSBjbGFzcyB7DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIFRvb2wuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgYWN0aXZlKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX2FjdGl2ZSA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fYWN0aXZlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIFRvb2wuZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGVuYWJsZWQodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fZW5hYmxlZCA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZW5hYmxlZDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBUb29sLmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBjb2RlKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX2NvZGUgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2NvZGU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogVG9vbC5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIG9yZGVyKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX29yZGVyID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9vcmRlcjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBUb29sLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBkYXRlKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX2RhdGUgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2RhdGU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogVG9vbC5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgbmFtZSh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9uYW1lID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9uYW1lOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIFRvb2wucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgcmVtYXJrKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX3JlbWFyayA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fcmVtYXJrOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIFRvb2wudHlwZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHR5cGUodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fdHlwZSA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fdHlwZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgIA0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBUb29sLnRvb2xfQ29uZmlncyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHRvb2xfQ29uZmlncyh2KXsNCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBUb29sLnRvb2xfTWFwcGluZ3MgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICB0b29sX01hcHBpbmdzKHYpew0KICAgICAgICB9DQogICAgDQogICAgDQogICAgICAgIF91bmlxdWUoKXsNCiAgICAgICAgICAgIGxldCBfX3RvU3RyaW5nID0gJ1Rvb2wuX3VuaXF1ZSgpOiAnOw0KICAgICAgICANCiAgICAgICAgICAgIGxldCByZXQgPSBuZXcgdW5kZWZpbmVkKCk7DQogICAgICAgICAgICBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkOw0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMubmFtZSgpKSE9PSd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7DQogICAgDQogICAgICAgICAgICByZXR1cm4gcmV0Ow0KICAgICAgICB9DQoNCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogVG9vbC5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHN0b3JlKF9fZXZlbnQpew0KICAgICAgICAgICAgbGV0IF9fdG9TdHJpbmcgPSAnVG9vbC5zdG9yZSgpOiAnOw0KDQogICAgICAgICAgICBsZXQgYW5zd2VyID0gdW5kZWZpbmVkOw0KDQogICAgICAgICAgICBsZXQgX19yZXNwb25zZSA9IG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrdGlja3MrJ10uVG9vbC5zdG9yZSgpJykubWV0aG9kKCdzdG9yZScpLmNsYXNzTmFtZSgnVG9vbCcpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCg0KICAgICAgICAgICAgbGV0IGV2SlNPTiA9IG51bGw7DQogICAgICAgICAgICBpZihfX2V2ZW50KXsNCiAgICAgICAgICAgICAgICBldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgICAgICBpZih0eXBlb2YoZXZKU09OLl9fdGhpcykhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7DQogICAgICAgIA0KDQoNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoX19ldmVudCAmJiAhX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KDQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgaWYoX19ldmVudCAmJiBfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBhbnN3ZXIgPSBUb29sKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZighX19ldmVudCl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgLy8gc3RvcmUgbG9jYWxseQ0KICAgICAgICAgICAgICAgIGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgnVG9vbCcpOw0KDQogICAgICAgICAgICAgICAgbGV0IF90aGlzID0gdGhpcy5fdW5pcXVlKCkuZmluZCgpOw0KICAgICAgICAgICAgICAgIGlmKCFfdGhpcykgZ3Iuc2V0TmV3R3VpZFZhbHVlKHRoaXMuSWQgfHwgKHRoaXMuSWQgPSBnci5zZXROZXdHdWlkKCkpKTsNCiAgICAgICAgICAgICAgICBpZihfdGhpcyAmJiB0eXBlb2YoX3RoaXMuSWQpIT09J3VuZGVmaW5lZCcpIGdyLmdldChfdGhpcy5JZCk7DQoNCiAgICAgICAgICAgICAgICBsZXQgYlNldCA9IGZhbHNlOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBpZihfdGhpcyAmJiB0eXBlb2YoX3RoaXMuZ2V0bmFtZSgpKSE9PSd1bmRlZmluZWQnKSBiU2V0ID0gZ3Iuc2V0VmFsdWUoJ25hbWUnLCBfdGhpcy5nZXRuYW1lKCkpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBpZihiU2V0KXsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5JZCA9IGdyLnVwZGF0ZSgpOw0KICAgICAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAidGhpcy5JZCA9ICIgKyB0aGlzLklkKTsNCiAgICAgICAgICAgICAgICAgICAgaWYoIWFuc3dlcikgYW5zd2VyID0gdGhpczsNCiAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImludmFsaWQgb2JqZWN0Iik7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIA0KDQogICAgICAgICAgICB9DQoNCg0KDQoNCiAgICAgICAgICAgIGlmKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgaWYoYW5zd2VyKXsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7X190aGlzOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHJldHVybiBhbnN3ZXI7DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogVG9vbC5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgZmluZEFsbChfX2V2ZW50KXsNCiAgICAgICAgICAgIGxldCBfX3RvU3RyaW5nID0gJ1Rvb2wuZmluZEFsbCgpOiAnOw0KDQogICAgICAgICAgICBsZXQgYW5zd2VyID0gdW5kZWZpbmVkOw0KDQogICAgICAgICAgICBsZXQgX19yZXNwb25zZSA9IG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrdGlja3MrJ10uVG9vbC5maW5kQWxsKCknKS5tZXRob2QoJ2ZpbmRBbGwnKS5jbGFzc05hbWUoJ1Rvb2wnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQoNCiAgICAgICAgICAgIGxldCBldkpTT04gPSBudWxsOw0KICAgICAgICAgICAgaWYoX19ldmVudCl7DQogICAgICAgICAgICAgICAgZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICAgICAgaWYodHlwZW9mKGV2SlNPTi5fX3RoaXMpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgICAgICB0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpOw0KICAgICAgICANCg0KDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKF9fZXZlbnQgJiYgIV9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCg0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgIGlmKF9fZXZlbnQgJiYgX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgYW5zd2VyID0gVG9vbCgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIA0KDQogICAgICAgICAgICB9DQoNCg0KDQoNCiAgICAgICAgICAgIGlmKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgaWYoYW5zd2VyKXsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7X190aGlzOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHJldHVybiBhbnN3ZXI7DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogVG9vbC5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgZmluZChfX2V2ZW50KXsNCiAgICAgICAgICAgIGxldCBfX3RvU3RyaW5nID0gJ1Rvb2wuZmluZCgpOiAnOw0KDQogICAgICAgICAgICBsZXQgYW5zd2VyID0gdW5kZWZpbmVkOw0KDQogICAgICAgICAgICBsZXQgX19yZXNwb25zZSA9IG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrdGlja3MrJ10uVG9vbC5maW5kKCknKS5tZXRob2QoJ2ZpbmQnKS5jbGFzc05hbWUoJ1Rvb2wnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQoNCiAgICAgICAgICAgIGxldCBldkpTT04gPSBudWxsOw0KICAgICAgICAgICAgaWYoX19ldmVudCl7DQogICAgICAgICAgICAgICAgZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICAgICAgaWYodHlwZW9mKGV2SlNPTi5fX3RoaXMpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgICAgICB0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpOw0KICAgICAgICANCg0KDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKF9fZXZlbnQgJiYgIV9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCg0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgIGlmKF9fZXZlbnQgJiYgX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgYW5zd2VyID0gVG9vbCgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIA0KDQogICAgICAgICAgICB9DQoNCg0KDQoNCiAgICAgICAgICAgIGlmKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgaWYoYW5zd2VyKXsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7X190aGlzOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHJldHVybiBhbnN3ZXI7DQogICAgICAgIH0NCiAgICANCiAgICB9Ow0KDQogICAgZXNwdGVzdC5jb20gPSBlc3B0ZXN0LmNvbSB8fCB7fTtlc3B0ZXN0LmNvbS5uYW1tb3VyID0gZXNwdGVzdC5jb20ubmFtbW91ciB8fCB7fTtlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20gPSBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20gfHwge307DQogICAgZXNwdGVzdC5jb20ubmFtbW91ci5kY29tLkNvbmZpZ19Hcm91cCA9IGNsYXNzIHsNCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogQ29uZmlnX0dyb3VwLmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGFjdGl2ZSh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9hY3RpdmUgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2FjdGl2ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBDb25maWdfR3JvdXAuZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGVuYWJsZWQodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fZW5hYmxlZCA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZW5hYmxlZDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBDb25maWdfR3JvdXAuY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGNvZGUodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fY29kZSA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fY29kZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBDb25maWdfR3JvdXAub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBvcmRlcih2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9vcmRlciA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fb3JkZXI7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogQ29uZmlnX0dyb3VwLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBkYXRlKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX2RhdGUgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2RhdGU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogQ29uZmlnX0dyb3VwLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBuYW1lKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX25hbWUgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX25hbWU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogQ29uZmlnX0dyb3VwLnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHJlbWFyayh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9yZW1hcmsgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3JlbWFyazsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgIA0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBDb25maWdfR3JvdXAuZ3JvdXBfQ29uZmlncyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGdyb3VwX0NvbmZpZ3Modil7DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogQ29uZmlnX0dyb3VwLmdyb3VwX01hcHBpbmdzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgZ3JvdXBfTWFwcGluZ3Modil7DQogICAgICAgIH0NCiAgICANCiAgICANCiAgICAgICAgX3VuaXF1ZSgpew0KICAgICAgICAgICAgbGV0IF9fdG9TdHJpbmcgPSAnQ29uZmlnX0dyb3VwLl91bmlxdWUoKTogJzsNCiAgICAgICAgDQogICAgICAgICAgICBsZXQgcmV0ID0gbmV3IHVuZGVmaW5lZCgpOw0KICAgICAgICAgICAgaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDsNCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZih0aGlzLmNvZGUoKSkhPT0ndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpOw0KICAgIA0KICAgICAgICAgICAgcmV0dXJuIHJldDsNCiAgICAgICAgfQ0KDQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIENvbmZpZ19Hcm91cC5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHN0b3JlKF9fZXZlbnQpew0KICAgICAgICAgICAgbGV0IF9fdG9TdHJpbmcgPSAnQ29uZmlnX0dyb3VwLnN0b3JlKCk6ICc7DQoNCiAgICAgICAgICAgIGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7DQoNCiAgICAgICAgICAgIGxldCBfX3Jlc3BvbnNlID0gbmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5FdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJyt0aWNrcysnXS5Db25maWdfR3JvdXAuc3RvcmUoKScpLm1ldGhvZCgnc3RvcmUnKS5jbGFzc05hbWUoJ0NvbmZpZ19Hcm91cCcpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCg0KICAgICAgICAgICAgbGV0IGV2SlNPTiA9IG51bGw7DQogICAgICAgICAgICBpZihfX2V2ZW50KXsNCiAgICAgICAgICAgICAgICBldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgICAgICBpZih0eXBlb2YoZXZKU09OLl9fdGhpcykhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7DQogICAgICAgIA0KDQoNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoX19ldmVudCAmJiAhX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KDQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgaWYoX19ldmVudCAmJiBfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBhbnN3ZXIgPSBDb25maWdfR3JvdXAoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKCFfX2V2ZW50KXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBzdG9yZSBsb2NhbGx5DQogICAgICAgICAgICAgICAgbGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCdDb25maWdfR3JvdXAnKTsNCg0KICAgICAgICAgICAgICAgIGxldCBfdGhpcyA9IHRoaXMuX3VuaXF1ZSgpLmZpbmQoKTsNCiAgICAgICAgICAgICAgICBpZighX3RoaXMpIGdyLnNldE5ld0d1aWRWYWx1ZSh0aGlzLklkIHx8ICh0aGlzLklkID0gZ3Iuc2V0TmV3R3VpZCgpKSk7DQogICAgICAgICAgICAgICAgaWYoX3RoaXMgJiYgdHlwZW9mKF90aGlzLklkKSE9PSd1bmRlZmluZWQnKSBnci5nZXQoX3RoaXMuSWQpOw0KDQogICAgICAgICAgICAgICAgbGV0IGJTZXQgPSBmYWxzZTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgaWYoX3RoaXMgJiYgdHlwZW9mKF90aGlzLmdldGNvZGUoKSkhPT0ndW5kZWZpbmVkJykgYlNldCA9IGdyLnNldFZhbHVlKCdjb2RlJywgX3RoaXMuZ2V0Y29kZSgpKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgaWYoYlNldCl7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuSWQgPSBnci51cGRhdGUoKTsNCiAgICAgICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgInRoaXMuSWQgPSAiICsgdGhpcy5JZCk7DQogICAgICAgICAgICAgICAgICAgIGlmKCFhbnN3ZXIpIGFuc3dlciA9IHRoaXM7DQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJpbnZhbGlkIG9iamVjdCIpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICANCg0KICAgICAgICAgICAgfQ0KDQoNCg0KDQogICAgICAgICAgICBpZighX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGlmKGFuc3dlcil7DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoe19fdGhpczogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICByZXR1cm4gYW5zd2VyOw0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIENvbmZpZ19Hcm91cC5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgZmluZEFsbChfX2V2ZW50KXsNCiAgICAgICAgICAgIGxldCBfX3RvU3RyaW5nID0gJ0NvbmZpZ19Hcm91cC5maW5kQWxsKCk6ICc7DQoNCiAgICAgICAgICAgIGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7DQoNCiAgICAgICAgICAgIGxldCBfX3Jlc3BvbnNlID0gbmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5FdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJyt0aWNrcysnXS5Db25maWdfR3JvdXAuZmluZEFsbCgpJykubWV0aG9kKCdmaW5kQWxsJykuY2xhc3NOYW1lKCdDb25maWdfR3JvdXAnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQoNCiAgICAgICAgICAgIGxldCBldkpTT04gPSBudWxsOw0KICAgICAgICAgICAgaWYoX19ldmVudCl7DQogICAgICAgICAgICAgICAgZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICAgICAgaWYodHlwZW9mKGV2SlNPTi5fX3RoaXMpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgICAgICB0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpOw0KICAgICAgICANCg0KDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKF9fZXZlbnQgJiYgIV9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCg0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgIGlmKF9fZXZlbnQgJiYgX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgYW5zd2VyID0gQ29uZmlnX0dyb3VwKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZighX19ldmVudCl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KDQoNCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBpZihhbnN3ZXIpew0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHtfX3RoaXM6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcmV0dXJuIGFuc3dlcjsNCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBDb25maWdfR3JvdXAuZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGZpbmQoX19ldmVudCl7DQogICAgICAgICAgICBsZXQgX190b1N0cmluZyA9ICdDb25maWdfR3JvdXAuZmluZCgpOiAnOw0KDQogICAgICAgICAgICBsZXQgYW5zd2VyID0gdW5kZWZpbmVkOw0KDQogICAgICAgICAgICBsZXQgX19yZXNwb25zZSA9IG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrdGlja3MrJ10uQ29uZmlnX0dyb3VwLmZpbmQoKScpLm1ldGhvZCgnZmluZCcpLmNsYXNzTmFtZSgnQ29uZmlnX0dyb3VwJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOw0KDQogICAgICAgICAgICBsZXQgZXZKU09OID0gbnVsbDsNCiAgICAgICAgICAgIGlmKF9fZXZlbnQpew0KICAgICAgICAgICAgICAgIGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgICAgIGlmKHR5cGVvZihldkpTT04uX190aGlzKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTsNCiAgICAgICAgDQoNCg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZihfX2V2ZW50ICYmICFfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQoNCiAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICBpZihfX2V2ZW50ICYmIF9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGFuc3dlciA9IENvbmZpZ19Hcm91cCgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIA0KDQogICAgICAgICAgICB9DQoNCg0KDQoNCiAgICAgICAgICAgIGlmKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgaWYoYW5zd2VyKXsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7X190aGlzOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHJldHVybiBhbnN3ZXI7DQogICAgICAgIH0NCiAgICANCiAgICB9Ow0KDQogICAgZXNwdGVzdC5jb20gPSBlc3B0ZXN0LmNvbSB8fCB7fTtlc3B0ZXN0LmNvbS5uYW1tb3VyID0gZXNwdGVzdC5jb20ubmFtbW91ciB8fCB7fTtlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20gPSBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20gfHwge307DQogICAgZXNwdGVzdC5jb20ubmFtbW91ci5kY29tLk1hcHBpbmdfR3JvdXAgPSBjbGFzcyB7DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE1hcHBpbmdfR3JvdXAuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgYWN0aXZlKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX2FjdGl2ZSA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fYWN0aXZlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE1hcHBpbmdfR3JvdXAuZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGVuYWJsZWQodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fZW5hYmxlZCA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZW5hYmxlZDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBNYXBwaW5nX0dyb3VwLmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBjb2RlKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX2NvZGUgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2NvZGU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTWFwcGluZ19Hcm91cC5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIG9yZGVyKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX29yZGVyID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9vcmRlcjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBNYXBwaW5nX0dyb3VwLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBkYXRlKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX2RhdGUgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2RhdGU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTWFwcGluZ19Hcm91cC5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgbmFtZSh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9uYW1lID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9uYW1lOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE1hcHBpbmdfR3JvdXAucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgcmVtYXJrKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX3JlbWFyayA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fcmVtYXJrOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgDQogICAgDQogICAgDQogICAgICAgIF91bmlxdWUoKXsNCiAgICAgICAgICAgIGxldCBfX3RvU3RyaW5nID0gJ01hcHBpbmdfR3JvdXAuX3VuaXF1ZSgpOiAnOw0KICAgICAgICANCiAgICAgICAgICAgIGxldCByZXQgPSBuZXcgdW5kZWZpbmVkKCk7DQogICAgICAgICAgICBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkOw0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMuY29kZSgpKSE9PSd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7DQogICAgDQogICAgICAgICAgICByZXR1cm4gcmV0Ow0KICAgICAgICB9DQoNCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTWFwcGluZ19Hcm91cC5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHN0b3JlKF9fZXZlbnQpew0KICAgICAgICAgICAgbGV0IF9fdG9TdHJpbmcgPSAnTWFwcGluZ19Hcm91cC5zdG9yZSgpOiAnOw0KDQogICAgICAgICAgICBsZXQgYW5zd2VyID0gdW5kZWZpbmVkOw0KDQogICAgICAgICAgICBsZXQgX19yZXNwb25zZSA9IG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrdGlja3MrJ10uTWFwcGluZ19Hcm91cC5zdG9yZSgpJykubWV0aG9kKCdzdG9yZScpLmNsYXNzTmFtZSgnTWFwcGluZ19Hcm91cCcpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCg0KICAgICAgICAgICAgbGV0IGV2SlNPTiA9IG51bGw7DQogICAgICAgICAgICBpZihfX2V2ZW50KXsNCiAgICAgICAgICAgICAgICBldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgICAgICBpZih0eXBlb2YoZXZKU09OLl9fdGhpcykhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7DQogICAgICAgIA0KDQoNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoX19ldmVudCAmJiAhX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KDQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgaWYoX19ldmVudCAmJiBfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBhbnN3ZXIgPSBNYXBwaW5nX0dyb3VwKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZighX19ldmVudCl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgLy8gc3RvcmUgbG9jYWxseQ0KICAgICAgICAgICAgICAgIGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgnTWFwcGluZ19Hcm91cCcpOw0KDQogICAgICAgICAgICAgICAgbGV0IF90aGlzID0gdGhpcy5fdW5pcXVlKCkuZmluZCgpOw0KICAgICAgICAgICAgICAgIGlmKCFfdGhpcykgZ3Iuc2V0TmV3R3VpZFZhbHVlKHRoaXMuSWQgfHwgKHRoaXMuSWQgPSBnci5zZXROZXdHdWlkKCkpKTsNCiAgICAgICAgICAgICAgICBpZihfdGhpcyAmJiB0eXBlb2YoX3RoaXMuSWQpIT09J3VuZGVmaW5lZCcpIGdyLmdldChfdGhpcy5JZCk7DQoNCiAgICAgICAgICAgICAgICBsZXQgYlNldCA9IGZhbHNlOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBpZihfdGhpcyAmJiB0eXBlb2YoX3RoaXMuZ2V0Y29kZSgpKSE9PSd1bmRlZmluZWQnKSBiU2V0ID0gZ3Iuc2V0VmFsdWUoJ2NvZGUnLCBfdGhpcy5nZXRjb2RlKCkpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBpZihiU2V0KXsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5JZCA9IGdyLnVwZGF0ZSgpOw0KICAgICAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAidGhpcy5JZCA9ICIgKyB0aGlzLklkKTsNCiAgICAgICAgICAgICAgICAgICAgaWYoIWFuc3dlcikgYW5zd2VyID0gdGhpczsNCiAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImludmFsaWQgb2JqZWN0Iik7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIA0KDQogICAgICAgICAgICB9DQoNCg0KDQoNCiAgICAgICAgICAgIGlmKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgaWYoYW5zd2VyKXsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7X190aGlzOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHJldHVybiBhbnN3ZXI7DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTWFwcGluZ19Hcm91cC5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgZmluZEFsbChfX2V2ZW50KXsNCiAgICAgICAgICAgIGxldCBfX3RvU3RyaW5nID0gJ01hcHBpbmdfR3JvdXAuZmluZEFsbCgpOiAnOw0KDQogICAgICAgICAgICBsZXQgYW5zd2VyID0gdW5kZWZpbmVkOw0KDQogICAgICAgICAgICBsZXQgX19yZXNwb25zZSA9IG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrdGlja3MrJ10uTWFwcGluZ19Hcm91cC5maW5kQWxsKCknKS5tZXRob2QoJ2ZpbmRBbGwnKS5jbGFzc05hbWUoJ01hcHBpbmdfR3JvdXAnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQoNCiAgICAgICAgICAgIGxldCBldkpTT04gPSBudWxsOw0KICAgICAgICAgICAgaWYoX19ldmVudCl7DQogICAgICAgICAgICAgICAgZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICAgICAgaWYodHlwZW9mKGV2SlNPTi5fX3RoaXMpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgICAgICB0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpOw0KICAgICAgICANCg0KDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKF9fZXZlbnQgJiYgIV9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCg0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgIGlmKF9fZXZlbnQgJiYgX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgYW5zd2VyID0gTWFwcGluZ19Hcm91cCgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIA0KDQogICAgICAgICAgICB9DQoNCg0KDQoNCiAgICAgICAgICAgIGlmKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgaWYoYW5zd2VyKXsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7X190aGlzOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHJldHVybiBhbnN3ZXI7DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTWFwcGluZ19Hcm91cC5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgZmluZChfX2V2ZW50KXsNCiAgICAgICAgICAgIGxldCBfX3RvU3RyaW5nID0gJ01hcHBpbmdfR3JvdXAuZmluZCgpOiAnOw0KDQogICAgICAgICAgICBsZXQgYW5zd2VyID0gdW5kZWZpbmVkOw0KDQogICAgICAgICAgICBsZXQgX19yZXNwb25zZSA9IG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrdGlja3MrJ10uTWFwcGluZ19Hcm91cC5maW5kKCknKS5tZXRob2QoJ2ZpbmQnKS5jbGFzc05hbWUoJ01hcHBpbmdfR3JvdXAnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQoNCiAgICAgICAgICAgIGxldCBldkpTT04gPSBudWxsOw0KICAgICAgICAgICAgaWYoX19ldmVudCl7DQogICAgICAgICAgICAgICAgZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICAgICAgaWYodHlwZW9mKGV2SlNPTi5fX3RoaXMpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgICAgICB0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpOw0KICAgICAgICANCg0KDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKF9fZXZlbnQgJiYgIV9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCg0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgIGlmKF9fZXZlbnQgJiYgX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgYW5zd2VyID0gTWFwcGluZ19Hcm91cCgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIA0KDQogICAgICAgICAgICB9DQoNCg0KDQoNCiAgICAgICAgICAgIGlmKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgaWYoYW5zd2VyKXsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7X190aGlzOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHJldHVybiBhbnN3ZXI7DQogICAgICAgIH0NCiAgICANCiAgICB9Ow0KDQogICAgZXNwdGVzdC5jb20gPSBlc3B0ZXN0LmNvbSB8fCB7fTtlc3B0ZXN0LmNvbS5uYW1tb3VyID0gZXNwdGVzdC5jb20ubmFtbW91ciB8fCB7fTtlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20gPSBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20gfHwge307DQogICAgZXNwdGVzdC5jb20ubmFtbW91ci5kY29tLlRvb2xfVHlwZSA9IGNsYXNzIHsNCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogVG9vbF9UeXBlLmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGFjdGl2ZSh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9hY3RpdmUgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2FjdGl2ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBUb29sX1R5cGUuZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGVuYWJsZWQodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fZW5hYmxlZCA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZW5hYmxlZDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBUb29sX1R5cGUuY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGNvZGUodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fY29kZSA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fY29kZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBUb29sX1R5cGUub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBvcmRlcih2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9vcmRlciA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fb3JkZXI7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogVG9vbF9UeXBlLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBkYXRlKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX2RhdGUgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2RhdGU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogVG9vbF9UeXBlLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBuYW1lKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX25hbWUgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX25hbWU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogVG9vbF9UeXBlLnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHJlbWFyayh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9yZW1hcmsgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3JlbWFyazsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgIA0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBUb29sX1R5cGUudHlwZV9Db25maWdzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgdHlwZV9Db25maWdzKHYpew0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIFRvb2xfVHlwZS50eXBlX1Rvb2xzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgdHlwZV9Ub29scyh2KXsNCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBUb29sX1R5cGUudHlwZV9NYXBwaW5ncyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHR5cGVfTWFwcGluZ3Modil7DQogICAgICAgIH0NCiAgICANCiAgICANCiAgICAgICAgX3VuaXF1ZSgpew0KICAgICAgICAgICAgbGV0IF9fdG9TdHJpbmcgPSAnVG9vbF9UeXBlLl91bmlxdWUoKTogJzsNCiAgICAgICAgDQogICAgICAgICAgICBsZXQgcmV0ID0gbmV3IHVuZGVmaW5lZCgpOw0KICAgICAgICAgICAgaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDsNCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZih0aGlzLm5hbWUoKSkhPT0ndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpOw0KICAgIA0KICAgICAgICAgICAgcmV0dXJuIHJldDsNCiAgICAgICAgfQ0KDQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIFRvb2xfVHlwZS5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHN0b3JlKF9fZXZlbnQpew0KICAgICAgICAgICAgbGV0IF9fdG9TdHJpbmcgPSAnVG9vbF9UeXBlLnN0b3JlKCk6ICc7DQoNCiAgICAgICAgICAgIGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7DQoNCiAgICAgICAgICAgIGxldCBfX3Jlc3BvbnNlID0gbmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5FdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJyt0aWNrcysnXS5Ub29sX1R5cGUuc3RvcmUoKScpLm1ldGhvZCgnc3RvcmUnKS5jbGFzc05hbWUoJ1Rvb2xfVHlwZScpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCg0KICAgICAgICAgICAgbGV0IGV2SlNPTiA9IG51bGw7DQogICAgICAgICAgICBpZihfX2V2ZW50KXsNCiAgICAgICAgICAgICAgICBldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgICAgICBpZih0eXBlb2YoZXZKU09OLl9fdGhpcykhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7DQogICAgICAgIA0KDQoNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoX19ldmVudCAmJiAhX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KDQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgaWYoX19ldmVudCAmJiBfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBhbnN3ZXIgPSBUb29sX1R5cGUoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKCFfX2V2ZW50KXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBzdG9yZSBsb2NhbGx5DQogICAgICAgICAgICAgICAgbGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCdUb29sX1R5cGUnKTsNCg0KICAgICAgICAgICAgICAgIGxldCBfdGhpcyA9IHRoaXMuX3VuaXF1ZSgpLmZpbmQoKTsNCiAgICAgICAgICAgICAgICBpZighX3RoaXMpIGdyLnNldE5ld0d1aWRWYWx1ZSh0aGlzLklkIHx8ICh0aGlzLklkID0gZ3Iuc2V0TmV3R3VpZCgpKSk7DQogICAgICAgICAgICAgICAgaWYoX3RoaXMgJiYgdHlwZW9mKF90aGlzLklkKSE9PSd1bmRlZmluZWQnKSBnci5nZXQoX3RoaXMuSWQpOw0KDQogICAgICAgICAgICAgICAgbGV0IGJTZXQgPSBmYWxzZTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgaWYoX3RoaXMgJiYgdHlwZW9mKF90aGlzLmdldG5hbWUoKSkhPT0ndW5kZWZpbmVkJykgYlNldCA9IGdyLnNldFZhbHVlKCduYW1lJywgX3RoaXMuZ2V0bmFtZSgpKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgaWYoYlNldCl7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuSWQgPSBnci51cGRhdGUoKTsNCiAgICAgICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgInRoaXMuSWQgPSAiICsgdGhpcy5JZCk7DQogICAgICAgICAgICAgICAgICAgIGlmKCFhbnN3ZXIpIGFuc3dlciA9IHRoaXM7DQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJpbnZhbGlkIG9iamVjdCIpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICANCg0KICAgICAgICAgICAgfQ0KDQoNCg0KDQogICAgICAgICAgICBpZighX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGlmKGFuc3dlcil7DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoe19fdGhpczogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICByZXR1cm4gYW5zd2VyOw0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIFRvb2xfVHlwZS5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgZmluZEFsbChfX2V2ZW50KXsNCiAgICAgICAgICAgIGxldCBfX3RvU3RyaW5nID0gJ1Rvb2xfVHlwZS5maW5kQWxsKCk6ICc7DQoNCiAgICAgICAgICAgIGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7DQoNCiAgICAgICAgICAgIGxldCBfX3Jlc3BvbnNlID0gbmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5FdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJyt0aWNrcysnXS5Ub29sX1R5cGUuZmluZEFsbCgpJykubWV0aG9kKCdmaW5kQWxsJykuY2xhc3NOYW1lKCdUb29sX1R5cGUnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQoNCiAgICAgICAgICAgIGxldCBldkpTT04gPSBudWxsOw0KICAgICAgICAgICAgaWYoX19ldmVudCl7DQogICAgICAgICAgICAgICAgZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICAgICAgaWYodHlwZW9mKGV2SlNPTi5fX3RoaXMpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgICAgICB0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpOw0KICAgICAgICANCg0KDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKF9fZXZlbnQgJiYgIV9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCg0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgIGlmKF9fZXZlbnQgJiYgX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgYW5zd2VyID0gVG9vbF9UeXBlKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZighX19ldmVudCl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KDQoNCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBpZihhbnN3ZXIpew0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHtfX3RoaXM6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcmV0dXJuIGFuc3dlcjsNCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBUb29sX1R5cGUuZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGZpbmQoX19ldmVudCl7DQogICAgICAgICAgICBsZXQgX190b1N0cmluZyA9ICdUb29sX1R5cGUuZmluZCgpOiAnOw0KDQogICAgICAgICAgICBsZXQgYW5zd2VyID0gdW5kZWZpbmVkOw0KDQogICAgICAgICAgICBsZXQgX19yZXNwb25zZSA9IG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrdGlja3MrJ10uVG9vbF9UeXBlLmZpbmQoKScpLm1ldGhvZCgnZmluZCcpLmNsYXNzTmFtZSgnVG9vbF9UeXBlJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOw0KDQogICAgICAgICAgICBsZXQgZXZKU09OID0gbnVsbDsNCiAgICAgICAgICAgIGlmKF9fZXZlbnQpew0KICAgICAgICAgICAgICAgIGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgICAgIGlmKHR5cGVvZihldkpTT04uX190aGlzKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTsNCiAgICAgICAgDQoNCg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZihfX2V2ZW50ICYmICFfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQoNCiAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICBpZihfX2V2ZW50ICYmIF9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGFuc3dlciA9IFRvb2xfVHlwZSgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIA0KDQogICAgICAgICAgICB9DQoNCg0KDQoNCiAgICAgICAgICAgIGlmKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgaWYoYW5zd2VyKXsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7X190aGlzOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHJldHVybiBhbnN3ZXI7DQogICAgICAgIH0NCiAgICANCiAgICB9Ow0KDQogICAgZXNwdGVzdC5jb20gPSBlc3B0ZXN0LmNvbSB8fCB7fTtlc3B0ZXN0LmNvbS5uYW1tb3VyID0gZXNwdGVzdC5jb20ubmFtbW91ciB8fCB7fTtlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20gPSBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20gfHwge307DQogICAgZXNwdGVzdC5jb20ubmFtbW91ci5kY29tLkV2ZW50ID0gY2xhc3Mgew0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBFdmVudC5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBhY3RpdmUodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fYWN0aXZlID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9hY3RpdmU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogRXZlbnQuZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGVuYWJsZWQodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fZW5hYmxlZCA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZW5hYmxlZDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBFdmVudC5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgY29kZSh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9jb2RlID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9jb2RlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIEV2ZW50Lm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgb3JkZXIodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fb3JkZXIgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX29yZGVyOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIEV2ZW50LmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBkYXRlKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX2RhdGUgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2RhdGU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogRXZlbnQubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIG5hbWUodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fbmFtZSA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fbmFtZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBFdmVudC5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICByZW1hcmsodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fcmVtYXJrID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9yZW1hcms7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogRXZlbnQuY2xhc3NOYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgY2xhc3NOYW1lKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX2NsYXNzTmFtZSA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fY2xhc3NOYW1lOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIEV2ZW50Lm1ldGhvZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIG1ldGhvZCh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9tZXRob2QgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX21ldGhvZDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBFdmVudC5wYXlsb2FkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgcGF5bG9hZCh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9wYXlsb2FkID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9wYXlsb2FkOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIEV2ZW50LmNhcnJpZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBjYXJyaWVyKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX2NhcnJpZXIgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2NhcnJpZXI7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogRXZlbnQuc2VuZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgc2VuZGVyKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX3NlbmRlciA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fc2VuZGVyOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIEV2ZW50LnJlY2lwaWVudCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHJlY2lwaWVudCh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9yZWNpcGllbnQgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3JlY2lwaWVudDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBFdmVudC5yZXNwb25zZVRvIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgcmVzcG9uc2VUbyh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9yZXNwb25zZVRvID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9yZXNwb25zZVRvOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgDQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIEV2ZW50LnJlc3BvbnNlVG9fRXZlbnRzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgcmVzcG9uc2VUb19FdmVudHModil7DQogICAgICAgIH0NCiAgICANCiAgICANCiAgICAgICAgX3VuaXF1ZSgpew0KICAgICAgICAgICAgbGV0IF9fdG9TdHJpbmcgPSAnRXZlbnQuX3VuaXF1ZSgpOiAnOw0KICAgICAgICANCiAgICAgICAgICAgIGxldCByZXQgPSBuZXcgdW5kZWZpbmVkKCk7DQogICAgICAgICAgICBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkOw0KICAgIA0KICAgICAgICAgICAgaWYodHlwZW9mKHRoaXMuY29kZSgpKSE9PSd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7DQogICAgDQogICAgICAgICAgICByZXR1cm4gcmV0Ow0KICAgICAgICB9DQoNCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogRXZlbnQuc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBzdG9yZShfX2V2ZW50KXsNCiAgICAgICAgICAgIGxldCBfX3RvU3RyaW5nID0gJ0V2ZW50LnN0b3JlKCk6ICc7DQoNCiAgICAgICAgICAgIGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7DQoNCiAgICAgICAgICAgIGxldCBfX3Jlc3BvbnNlID0gbmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5FdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJyt0aWNrcysnXS5FdmVudC5zdG9yZSgpJykubWV0aG9kKCdzdG9yZScpLmNsYXNzTmFtZSgnRXZlbnQnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQoNCiAgICAgICAgICAgIGxldCBldkpTT04gPSBudWxsOw0KICAgICAgICAgICAgaWYoX19ldmVudCl7DQogICAgICAgICAgICAgICAgZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICAgICAgaWYodHlwZW9mKGV2SlNPTi5fX3RoaXMpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgICAgICB0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpOw0KICAgICAgICANCg0KDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKF9fZXZlbnQgJiYgIV9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCg0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgIGlmKF9fZXZlbnQgJiYgX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgYW5zd2VyID0gRXZlbnQoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKCFfX2V2ZW50KXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBzdG9yZSBsb2NhbGx5DQogICAgICAgICAgICAgICAgbGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCdFdmVudCcpOw0KDQogICAgICAgICAgICAgICAgbGV0IF90aGlzID0gdGhpcy5fdW5pcXVlKCkuZmluZCgpOw0KICAgICAgICAgICAgICAgIGlmKCFfdGhpcykgZ3Iuc2V0TmV3R3VpZFZhbHVlKHRoaXMuSWQgfHwgKHRoaXMuSWQgPSBnci5zZXROZXdHdWlkKCkpKTsNCiAgICAgICAgICAgICAgICBpZihfdGhpcyAmJiB0eXBlb2YoX3RoaXMuSWQpIT09J3VuZGVmaW5lZCcpIGdyLmdldChfdGhpcy5JZCk7DQoNCiAgICAgICAgICAgICAgICBsZXQgYlNldCA9IGZhbHNlOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBpZihfdGhpcyAmJiB0eXBlb2YoX3RoaXMuZ2V0Y29kZSgpKSE9PSd1bmRlZmluZWQnKSBiU2V0ID0gZ3Iuc2V0VmFsdWUoJ2NvZGUnLCBfdGhpcy5nZXRjb2RlKCkpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBpZihiU2V0KXsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5JZCA9IGdyLnVwZGF0ZSgpOw0KICAgICAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAidGhpcy5JZCA9ICIgKyB0aGlzLklkKTsNCiAgICAgICAgICAgICAgICAgICAgaWYoIWFuc3dlcikgYW5zd2VyID0gdGhpczsNCiAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImludmFsaWQgb2JqZWN0Iik7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIA0KDQogICAgICAgICAgICB9DQoNCg0KDQoNCiAgICAgICAgICAgIGlmKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgaWYoYW5zd2VyKXsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7X190aGlzOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHJldHVybiBhbnN3ZXI7DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogRXZlbnQuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGZpbmRBbGwoX19ldmVudCl7DQogICAgICAgICAgICBsZXQgX190b1N0cmluZyA9ICdFdmVudC5maW5kQWxsKCk6ICc7DQoNCiAgICAgICAgICAgIGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7DQoNCiAgICAgICAgICAgIGxldCBfX3Jlc3BvbnNlID0gbmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5FdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJyt0aWNrcysnXS5FdmVudC5maW5kQWxsKCknKS5tZXRob2QoJ2ZpbmRBbGwnKS5jbGFzc05hbWUoJ0V2ZW50JykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOw0KDQogICAgICAgICAgICBsZXQgZXZKU09OID0gbnVsbDsNCiAgICAgICAgICAgIGlmKF9fZXZlbnQpew0KICAgICAgICAgICAgICAgIGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgICAgIGlmKHR5cGVvZihldkpTT04uX190aGlzKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTsNCiAgICAgICAgDQoNCg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZihfX2V2ZW50ICYmICFfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQoNCiAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICBpZihfX2V2ZW50ICYmIF9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGFuc3dlciA9IEV2ZW50KCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZighX19ldmVudCl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KDQoNCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBpZihhbnN3ZXIpew0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHtfX3RoaXM6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcmV0dXJuIGFuc3dlcjsNCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBFdmVudC5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgZmluZChfX2V2ZW50KXsNCiAgICAgICAgICAgIGxldCBfX3RvU3RyaW5nID0gJ0V2ZW50LmZpbmQoKTogJzsNCg0KICAgICAgICAgICAgbGV0IGFuc3dlciA9IHVuZGVmaW5lZDsNCg0KICAgICAgICAgICAgbGV0IF9fcmVzcG9uc2UgPSBuZXcgZXNwdGVzdC5jb20ubmFtbW91ci5kY29tLkV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3RpY2tzKyddLkV2ZW50LmZpbmQoKScpLm1ldGhvZCgnZmluZCcpLmNsYXNzTmFtZSgnRXZlbnQnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQoNCiAgICAgICAgICAgIGxldCBldkpTT04gPSBudWxsOw0KICAgICAgICAgICAgaWYoX19ldmVudCl7DQogICAgICAgICAgICAgICAgZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICAgICAgaWYodHlwZW9mKGV2SlNPTi5fX3RoaXMpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgICAgICB0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpOw0KICAgICAgICANCg0KDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKF9fZXZlbnQgJiYgIV9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCg0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgIGlmKF9fZXZlbnQgJiYgX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgYW5zd2VyID0gRXZlbnQoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKCFfX2V2ZW50KXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICANCg0KICAgICAgICAgICAgfQ0KDQoNCg0KDQogICAgICAgICAgICBpZighX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGlmKGFuc3dlcil7DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoe19fdGhpczogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICByZXR1cm4gYW5zd2VyOw0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIEV2ZW50Lmxpc3RlbigpICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGxpc3RlbihfX2V2ZW50LCBub2RlKXsNCiAgICAgICAgICAgIGxldCBfX3RvU3RyaW5nID0gJ0V2ZW50Lmxpc3RlbigpOiAnOw0KDQogICAgICAgICAgICBsZXQgYW5zd2VyID0gdW5kZWZpbmVkOw0KDQogICAgICAgICAgICBsZXQgX19yZXNwb25zZSA9IG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrdGlja3MrJ10uRXZlbnQubGlzdGVuKCknKS5tZXRob2QoJ2xpc3RlbicpLmNsYXNzTmFtZSgnRXZlbnQnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQoNCiAgICAgICAgICAgIGxldCBldkpTT04gPSBudWxsOw0KICAgICAgICAgICAgaWYoX19ldmVudCl7DQogICAgICAgICAgICAgICAgZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICAgICAgaWYodHlwZW9mKGV2SlNPTi5fX3RoaXMpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgICAgICB0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICBpZih0eXBlb2YoZXZKU09OLm5vZGUpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgICAgICBub2RlID0gZXZKU09OLm5vZGU7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpOw0KICAgICAgICANCg0KDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKF9fZXZlbnQgJiYgIV9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCg0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgIGlmKF9fZXZlbnQgJiYgX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgYW5zd2VyID0gZXZKU09OOw0KICAgICAgICANCg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZighX19ldmVudCl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KDQoNCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBpZihhbnN3ZXIpew0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChzdHIoYW5zd2VyKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHtfX3RoaXM6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcmV0dXJuIGFuc3dlcjsNCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBFdmVudC50cmlnZ2VyKCkgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgdHJpZ2dlcihfX2V2ZW50KXsNCiAgICAgICAgICAgIGxldCBfX3RvU3RyaW5nID0gJ0V2ZW50LnRyaWdnZXIoKTogJzsNCg0KICAgICAgICAgICAgbGV0IGFuc3dlciA9IHVuZGVmaW5lZDsNCg0KICAgICAgICAgICAgbGV0IF9fcmVzcG9uc2UgPSBuZXcgZXNwdGVzdC5jb20ubmFtbW91ci5kY29tLkV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3RpY2tzKyddLkV2ZW50LnRyaWdnZXIoKScpLm1ldGhvZCgndHJpZ2dlcicpLmNsYXNzTmFtZSgnRXZlbnQnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQoNCiAgICAgICAgICAgIGxldCBldkpTT04gPSBudWxsOw0KICAgICAgICAgICAgaWYoX19ldmVudCl7DQogICAgICAgICAgICAgICAgZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICAgICAgaWYodHlwZW9mKGV2SlNPTi5fX3RoaXMpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgICAgICB0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpOw0KICAgICAgICANCg0KDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKF9fZXZlbnQgJiYgIV9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCg0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgIGlmKF9fZXZlbnQgJiYgX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgYW5zd2VyID0gZXZKU09OOw0KICAgICAgICANCg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZighX19ldmVudCl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KDQoNCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBpZihhbnN3ZXIpew0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChzdHIoYW5zd2VyKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHtfX3RoaXM6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHJldHVybiBhbnN3ZXI7DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogRXZlbnQucHJvY2VzcygpICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHByb2Nlc3MoX19ldmVudCl7DQogICAgICAgICAgICBsZXQgX190b1N0cmluZyA9ICdFdmVudC5wcm9jZXNzKCk6ICc7DQoNCiAgICAgICAgICAgIGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7DQoNCiAgICAgICAgICAgIGxldCBfX3Jlc3BvbnNlID0gbmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5FdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJyt0aWNrcysnXS5FdmVudC5wcm9jZXNzKCknKS5tZXRob2QoJ3Byb2Nlc3MnKS5jbGFzc05hbWUoJ0V2ZW50JykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOw0KDQogICAgICAgICAgICBsZXQgZXZKU09OID0gbnVsbDsNCiAgICAgICAgICAgIGlmKF9fZXZlbnQpew0KICAgICAgICAgICAgICAgIGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgICAgIGlmKHR5cGVvZihldkpTT04uX190aGlzKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTsNCiAgICAgICAgDQoNCg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZihfX2V2ZW50ICYmICFfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQoNCiAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICBpZihfX2V2ZW50ICYmIF9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGFuc3dlciA9IEV2ZW50KCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZighX19ldmVudCl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KDQoNCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBpZihhbnN3ZXIpew0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHtfX3RoaXM6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcmV0dXJuIGFuc3dlcjsNCiAgICAgICAgfQ0KICAgIA0KICAgIH07DQoNCiAgICBlc3B0ZXN0LmNvbSA9IGVzcHRlc3QuY29tIHx8IHt9O2VzcHRlc3QuY29tLm5hbW1vdXIgPSBlc3B0ZXN0LmNvbS5uYW1tb3VyIHx8IHt9O2VzcHRlc3QuY29tLm5hbW1vdXIuZGNvbSA9IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbSB8fCB7fTsNCiAgICBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uTm9kZSA9IGNsYXNzIHsNCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTm9kZS5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBhY3RpdmUodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fYWN0aXZlID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9hY3RpdmU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTm9kZS5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgZW5hYmxlZCh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9lbmFibGVkID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9lbmFibGVkOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE5vZGUuY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGNvZGUodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fY29kZSA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fY29kZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBOb2RlLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgb3JkZXIodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fb3JkZXIgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX29yZGVyOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE5vZGUuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGRhdGUodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fZGF0ZSA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZGF0ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBOb2RlLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBuYW1lKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX25hbWUgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX25hbWU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTm9kZS5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICByZW1hcmsodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fcmVtYXJrID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9yZW1hcms7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTm9kZS5hZGRyZXNzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgYWRkcmVzcyh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9hZGRyZXNzID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9hZGRyZXNzOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE5vZGUuYmFja3VwIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgYmFja3VwKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX2JhY2t1cCA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fYmFja3VwOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE5vZGUucGFyZW50IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgcGFyZW50KHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX3BhcmVudCA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fcGFyZW50Ow0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE5vZGUuZ3JvdXAgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBncm91cCh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9ncm91cCA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZ3JvdXA7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTm9kZS5jb250ZXh0IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgY29udGV4dCh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9jb250ZXh0ID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9jb250ZXh0Ow0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE5vZGUucG9ydCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHBvcnQodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fcG9ydCA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fcG9ydDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBOb2RlLm9ubGluZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIG9ubGluZSh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9vbmxpbmUgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX29ubGluZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBOb2RlLnNlY3VyZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHNlY3VyZSh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9zZWN1cmUgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3NlY3VyZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBOb2RlLnR5cGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICB0eXBlKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX3R5cGUgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3R5cGU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICANCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTm9kZS5jb250cm9sbGVyX0RldmljZXMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBjb250cm9sbGVyX0RldmljZXModil7DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTm9kZS5ub2RlX0NvbmZpZ3MgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBub2RlX0NvbmZpZ3Modil7DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTm9kZS5jYXJyaWVyX0V2ZW50cyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGNhcnJpZXJfRXZlbnRzKHYpew0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE5vZGUuc2VuZGVyX0V2ZW50cyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHNlbmRlcl9FdmVudHModil7DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTm9kZS5yZWNpcGllbnRfRXZlbnRzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgcmVjaXBpZW50X0V2ZW50cyh2KXsNCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBOb2RlLmJhY2t1cF9Ob2RlcyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGJhY2t1cF9Ob2Rlcyh2KXsNCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBOb2RlLnBhcmVudF9Ob2RlcyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHBhcmVudF9Ob2Rlcyh2KXsNCiAgICAgICAgfQ0KICAgIA0KICAgIA0KICAgICAgICBfdW5pcXVlKCl7DQogICAgICAgICAgICBsZXQgX190b1N0cmluZyA9ICdOb2RlLl91bmlxdWUoKTogJzsNCiAgICAgICAgDQogICAgICAgICAgICBsZXQgcmV0ID0gbmV3IHVuZGVmaW5lZCgpOw0KICAgICAgICAgICAgaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDsNCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZih0aGlzLmNvZGUoKSkhPT0ndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpOw0KICAgIA0KICAgICAgICAgICAgcmV0dXJuIHJldDsNCiAgICAgICAgfQ0KDQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE5vZGUuc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBzdG9yZShfX2V2ZW50KXsNCiAgICAgICAgICAgIGxldCBfX3RvU3RyaW5nID0gJ05vZGUuc3RvcmUoKTogJzsNCg0KICAgICAgICAgICAgbGV0IGFuc3dlciA9IHVuZGVmaW5lZDsNCg0KICAgICAgICAgICAgbGV0IF9fcmVzcG9uc2UgPSBuZXcgZXNwdGVzdC5jb20ubmFtbW91ci5kY29tLkV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3RpY2tzKyddLk5vZGUuc3RvcmUoKScpLm1ldGhvZCgnc3RvcmUnKS5jbGFzc05hbWUoJ05vZGUnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQoNCiAgICAgICAgICAgIGxldCBldkpTT04gPSBudWxsOw0KICAgICAgICAgICAgaWYoX19ldmVudCl7DQogICAgICAgICAgICAgICAgZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICAgICAgaWYodHlwZW9mKGV2SlNPTi5fX3RoaXMpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgICAgICB0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpOw0KICAgICAgICANCg0KDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKF9fZXZlbnQgJiYgIV9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCg0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgIGlmKF9fZXZlbnQgJiYgX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgYW5zd2VyID0gTm9kZSgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIHN0b3JlIGxvY2FsbHkNCiAgICAgICAgICAgICAgICBsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ05vZGUnKTsNCg0KICAgICAgICAgICAgICAgIGxldCBfdGhpcyA9IHRoaXMuX3VuaXF1ZSgpLmZpbmQoKTsNCiAgICAgICAgICAgICAgICBpZighX3RoaXMpIGdyLnNldE5ld0d1aWRWYWx1ZSh0aGlzLklkIHx8ICh0aGlzLklkID0gZ3Iuc2V0TmV3R3VpZCgpKSk7DQogICAgICAgICAgICAgICAgaWYoX3RoaXMgJiYgdHlwZW9mKF90aGlzLklkKSE9PSd1bmRlZmluZWQnKSBnci5nZXQoX3RoaXMuSWQpOw0KDQogICAgICAgICAgICAgICAgbGV0IGJTZXQgPSBmYWxzZTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgaWYoX3RoaXMgJiYgdHlwZW9mKF90aGlzLmdldGNvZGUoKSkhPT0ndW5kZWZpbmVkJykgYlNldCA9IGdyLnNldFZhbHVlKCdjb2RlJywgX3RoaXMuZ2V0Y29kZSgpKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgaWYoYlNldCl7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuSWQgPSBnci51cGRhdGUoKTsNCiAgICAgICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgInRoaXMuSWQgPSAiICsgdGhpcy5JZCk7DQogICAgICAgICAgICAgICAgICAgIGlmKCFhbnN3ZXIpIGFuc3dlciA9IHRoaXM7DQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJpbnZhbGlkIG9iamVjdCIpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICANCg0KICAgICAgICAgICAgfQ0KDQoNCg0KDQogICAgICAgICAgICBpZighX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGlmKGFuc3dlcil7DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoe19fdGhpczogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICByZXR1cm4gYW5zd2VyOw0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE5vZGUuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGZpbmRBbGwoX19ldmVudCl7DQogICAgICAgICAgICBsZXQgX190b1N0cmluZyA9ICdOb2RlLmZpbmRBbGwoKTogJzsNCg0KICAgICAgICAgICAgbGV0IGFuc3dlciA9IHVuZGVmaW5lZDsNCg0KICAgICAgICAgICAgbGV0IF9fcmVzcG9uc2UgPSBuZXcgZXNwdGVzdC5jb20ubmFtbW91ci5kY29tLkV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3RpY2tzKyddLk5vZGUuZmluZEFsbCgpJykubWV0aG9kKCdmaW5kQWxsJykuY2xhc3NOYW1lKCdOb2RlJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOw0KDQogICAgICAgICAgICBsZXQgZXZKU09OID0gbnVsbDsNCiAgICAgICAgICAgIGlmKF9fZXZlbnQpew0KICAgICAgICAgICAgICAgIGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgICAgIGlmKHR5cGVvZihldkpTT04uX190aGlzKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTsNCiAgICAgICAgDQoNCg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZihfX2V2ZW50ICYmICFfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQoNCiAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICBpZihfX2V2ZW50ICYmIF9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGFuc3dlciA9IE5vZGUoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKCFfX2V2ZW50KXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICANCg0KICAgICAgICAgICAgfQ0KDQoNCg0KDQogICAgICAgICAgICBpZighX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGlmKGFuc3dlcil7DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoe19fdGhpczogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICByZXR1cm4gYW5zd2VyOw0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE5vZGUuZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGZpbmQoX19ldmVudCl7DQogICAgICAgICAgICBsZXQgX190b1N0cmluZyA9ICdOb2RlLmZpbmQoKTogJzsNCg0KICAgICAgICAgICAgbGV0IGFuc3dlciA9IHVuZGVmaW5lZDsNCg0KICAgICAgICAgICAgbGV0IF9fcmVzcG9uc2UgPSBuZXcgZXNwdGVzdC5jb20ubmFtbW91ci5kY29tLkV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3RpY2tzKyddLk5vZGUuZmluZCgpJykubWV0aG9kKCdmaW5kJykuY2xhc3NOYW1lKCdOb2RlJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOw0KDQogICAgICAgICAgICBsZXQgZXZKU09OID0gbnVsbDsNCiAgICAgICAgICAgIGlmKF9fZXZlbnQpew0KICAgICAgICAgICAgICAgIGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgICAgIGlmKHR5cGVvZihldkpTT04uX190aGlzKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTsNCiAgICAgICAgDQoNCg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZihfX2V2ZW50ICYmICFfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQoNCiAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICBpZihfX2V2ZW50ICYmIF9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGFuc3dlciA9IE5vZGUoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKCFfX2V2ZW50KXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICANCg0KICAgICAgICAgICAgfQ0KDQoNCg0KDQogICAgICAgICAgICBpZighX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGlmKGFuc3dlcil7DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoe19fdGhpczogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICByZXR1cm4gYW5zd2VyOw0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE5vZGUuYXV0aENvZGUoKSAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBhdXRoQ29kZShfX2V2ZW50LCBjb2RlLCB0b29sKXsNCiAgICAgICAgICAgIGxldCBfX3RvU3RyaW5nID0gJ05vZGUuYXV0aENvZGUoKTogJzsNCg0KICAgICAgICAgICAgbGV0IGFuc3dlciA9IHVuZGVmaW5lZDsNCg0KICAgICAgICAgICAgbGV0IF9fcmVzcG9uc2UgPSBuZXcgZXNwdGVzdC5jb20ubmFtbW91ci5kY29tLkV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3RpY2tzKyddLk5vZGUuYXV0aENvZGUoKScpLm1ldGhvZCgnYXV0aENvZGUnKS5jbGFzc05hbWUoJ05vZGUnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQoNCiAgICAgICAgICAgIGxldCBldkpTT04gPSBudWxsOw0KICAgICAgICAgICAgaWYoX19ldmVudCl7DQogICAgICAgICAgICAgICAgZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICAgICAgaWYodHlwZW9mKGV2SlNPTi5fX3RoaXMpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgICAgICB0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICBpZih0eXBlb2YoZXZKU09OLmNvZGUpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgICAgICBjb2RlID0gZXZKU09OLmNvZGU7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICBpZih0eXBlb2YoZXZKU09OLnRvb2wpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgICAgICB0b29sID0gZXZKU09OLnRvb2w7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpOw0KICAgICAgICANCg0KDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKF9fZXZlbnQgJiYgIV9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCg0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgIGlmKF9fZXZlbnQgJiYgX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgYW5zd2VyID0gZXZKU09OOw0KICAgICAgICANCg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZighX19ldmVudCl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KDQoNCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBpZihhbnN3ZXIpew0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChzdHIoYW5zd2VyKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHtfX3RoaXM6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcmV0dXJuIGFuc3dlcjsNCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBOb2RlLmluaXQoKSAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBpbml0KF9fZXZlbnQsIG9ubGluZSwgY29kZSwgdWlkKXsNCiAgICAgICAgICAgIGxldCBfX3RvU3RyaW5nID0gJ05vZGUuaW5pdCgpOiAnOw0KDQogICAgICAgICAgICBsZXQgYW5zd2VyID0gdW5kZWZpbmVkOw0KDQogICAgICAgICAgICBsZXQgX19yZXNwb25zZSA9IG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrdGlja3MrJ10uTm9kZS5pbml0KCknKS5tZXRob2QoJ2luaXQnKS5jbGFzc05hbWUoJ05vZGUnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQoNCiAgICAgICAgICAgIGxldCBldkpTT04gPSBudWxsOw0KICAgICAgICAgICAgaWYoX19ldmVudCl7DQogICAgICAgICAgICAgICAgZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICAgICAgaWYodHlwZW9mKGV2SlNPTi5fX3RoaXMpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgICAgICB0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICBpZih0eXBlb2YoZXZKU09OLm9ubGluZSkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgICAgIG9ubGluZSA9IGV2SlNPTi5vbmxpbmU7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICBpZih0eXBlb2YoZXZKU09OLmNvZGUpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgICAgICBjb2RlID0gZXZKU09OLmNvZGU7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICBpZih0eXBlb2YoZXZKU09OLnVpZCkhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgICAgIHVpZCA9IGV2SlNPTi51aWQ7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpOw0KICAgICAgICANCg0KDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKF9fZXZlbnQgJiYgIV9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCg0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgIGlmKF9fZXZlbnQgJiYgX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgYW5zd2VyID0gTm9kZSgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIA0KDQogICAgICAgICAgICB9DQoNCg0KDQoNCiAgICAgICAgICAgIGlmKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgaWYoYW5zd2VyKXsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7X190aGlzOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHJldHVybiBhbnN3ZXI7DQogICAgICAgIH0NCiAgICANCiAgICB9Ow0KDQogICAgZXNwdGVzdC5jb20gPSBlc3B0ZXN0LmNvbSB8fCB7fTtlc3B0ZXN0LmNvbS5uYW1tb3VyID0gZXNwdGVzdC5jb20ubmFtbW91ciB8fCB7fTtlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20gPSBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20gfHwge307DQogICAgZXNwdGVzdC5jb20ubmFtbW91ci5kY29tLk5vZGVfQ29udGV4dCA9IGNsYXNzIHsNCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTm9kZV9Db250ZXh0LmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGFjdGl2ZSh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9hY3RpdmUgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2FjdGl2ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBOb2RlX0NvbnRleHQuZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGVuYWJsZWQodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fZW5hYmxlZCA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZW5hYmxlZDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBOb2RlX0NvbnRleHQuY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGNvZGUodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fY29kZSA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fY29kZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBOb2RlX0NvbnRleHQub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBvcmRlcih2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9vcmRlciA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fb3JkZXI7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTm9kZV9Db250ZXh0LmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBkYXRlKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX2RhdGUgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2RhdGU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTm9kZV9Db250ZXh0Lm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBuYW1lKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX25hbWUgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX25hbWU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTm9kZV9Db250ZXh0LnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHJlbWFyayh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9yZW1hcmsgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3JlbWFyazsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgIA0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBOb2RlX0NvbnRleHQuY29udGV4dF9Ob2RlcyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGNvbnRleHRfTm9kZXModil7DQogICAgICAgIH0NCiAgICANCiAgICANCiAgICAgICAgX3VuaXF1ZSgpew0KICAgICAgICAgICAgbGV0IF9fdG9TdHJpbmcgPSAnTm9kZV9Db250ZXh0Ll91bmlxdWUoKTogJzsNCiAgICAgICAgDQogICAgICAgICAgICBsZXQgcmV0ID0gbmV3IHVuZGVmaW5lZCgpOw0KICAgICAgICAgICAgaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDsNCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZih0aGlzLmNvZGUoKSkhPT0ndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpOw0KICAgIA0KICAgICAgICAgICAgcmV0dXJuIHJldDsNCiAgICAgICAgfQ0KDQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE5vZGVfQ29udGV4dC5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHN0b3JlKF9fZXZlbnQpew0KICAgICAgICAgICAgbGV0IF9fdG9TdHJpbmcgPSAnTm9kZV9Db250ZXh0LnN0b3JlKCk6ICc7DQoNCiAgICAgICAgICAgIGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7DQoNCiAgICAgICAgICAgIGxldCBfX3Jlc3BvbnNlID0gbmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5FdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJyt0aWNrcysnXS5Ob2RlX0NvbnRleHQuc3RvcmUoKScpLm1ldGhvZCgnc3RvcmUnKS5jbGFzc05hbWUoJ05vZGVfQ29udGV4dCcpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCg0KICAgICAgICAgICAgbGV0IGV2SlNPTiA9IG51bGw7DQogICAgICAgICAgICBpZihfX2V2ZW50KXsNCiAgICAgICAgICAgICAgICBldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgICAgICBpZih0eXBlb2YoZXZKU09OLl9fdGhpcykhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7DQogICAgICAgIA0KDQoNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoX19ldmVudCAmJiAhX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KDQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgaWYoX19ldmVudCAmJiBfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBhbnN3ZXIgPSBOb2RlX0NvbnRleHQoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKCFfX2V2ZW50KXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBzdG9yZSBsb2NhbGx5DQogICAgICAgICAgICAgICAgbGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCdOb2RlX0NvbnRleHQnKTsNCg0KICAgICAgICAgICAgICAgIGxldCBfdGhpcyA9IHRoaXMuX3VuaXF1ZSgpLmZpbmQoKTsNCiAgICAgICAgICAgICAgICBpZighX3RoaXMpIGdyLnNldE5ld0d1aWRWYWx1ZSh0aGlzLklkIHx8ICh0aGlzLklkID0gZ3Iuc2V0TmV3R3VpZCgpKSk7DQogICAgICAgICAgICAgICAgaWYoX3RoaXMgJiYgdHlwZW9mKF90aGlzLklkKSE9PSd1bmRlZmluZWQnKSBnci5nZXQoX3RoaXMuSWQpOw0KDQogICAgICAgICAgICAgICAgbGV0IGJTZXQgPSBmYWxzZTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgaWYoX3RoaXMgJiYgdHlwZW9mKF90aGlzLmdldGNvZGUoKSkhPT0ndW5kZWZpbmVkJykgYlNldCA9IGdyLnNldFZhbHVlKCdjb2RlJywgX3RoaXMuZ2V0Y29kZSgpKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgaWYoYlNldCl7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuSWQgPSBnci51cGRhdGUoKTsNCiAgICAgICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgInRoaXMuSWQgPSAiICsgdGhpcy5JZCk7DQogICAgICAgICAgICAgICAgICAgIGlmKCFhbnN3ZXIpIGFuc3dlciA9IHRoaXM7DQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJpbnZhbGlkIG9iamVjdCIpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICANCg0KICAgICAgICAgICAgfQ0KDQoNCg0KDQogICAgICAgICAgICBpZighX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGlmKGFuc3dlcil7DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoe19fdGhpczogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICByZXR1cm4gYW5zd2VyOw0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE5vZGVfQ29udGV4dC5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgZmluZEFsbChfX2V2ZW50KXsNCiAgICAgICAgICAgIGxldCBfX3RvU3RyaW5nID0gJ05vZGVfQ29udGV4dC5maW5kQWxsKCk6ICc7DQoNCiAgICAgICAgICAgIGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7DQoNCiAgICAgICAgICAgIGxldCBfX3Jlc3BvbnNlID0gbmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5FdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJyt0aWNrcysnXS5Ob2RlX0NvbnRleHQuZmluZEFsbCgpJykubWV0aG9kKCdmaW5kQWxsJykuY2xhc3NOYW1lKCdOb2RlX0NvbnRleHQnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQoNCiAgICAgICAgICAgIGxldCBldkpTT04gPSBudWxsOw0KICAgICAgICAgICAgaWYoX19ldmVudCl7DQogICAgICAgICAgICAgICAgZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICAgICAgaWYodHlwZW9mKGV2SlNPTi5fX3RoaXMpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgICAgICB0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpOw0KICAgICAgICANCg0KDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKF9fZXZlbnQgJiYgIV9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCg0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgIGlmKF9fZXZlbnQgJiYgX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgYW5zd2VyID0gTm9kZV9Db250ZXh0KCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZighX19ldmVudCl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KDQoNCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBpZihhbnN3ZXIpew0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHtfX3RoaXM6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcmV0dXJuIGFuc3dlcjsNCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBOb2RlX0NvbnRleHQuZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGZpbmQoX19ldmVudCl7DQogICAgICAgICAgICBsZXQgX190b1N0cmluZyA9ICdOb2RlX0NvbnRleHQuZmluZCgpOiAnOw0KDQogICAgICAgICAgICBsZXQgYW5zd2VyID0gdW5kZWZpbmVkOw0KDQogICAgICAgICAgICBsZXQgX19yZXNwb25zZSA9IG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrdGlja3MrJ10uTm9kZV9Db250ZXh0LmZpbmQoKScpLm1ldGhvZCgnZmluZCcpLmNsYXNzTmFtZSgnTm9kZV9Db250ZXh0JykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOw0KDQogICAgICAgICAgICBsZXQgZXZKU09OID0gbnVsbDsNCiAgICAgICAgICAgIGlmKF9fZXZlbnQpew0KICAgICAgICAgICAgICAgIGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgICAgIGlmKHR5cGVvZihldkpTT04uX190aGlzKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTsNCiAgICAgICAgDQoNCg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZihfX2V2ZW50ICYmICFfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQoNCiAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICBpZihfX2V2ZW50ICYmIF9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGFuc3dlciA9IE5vZGVfQ29udGV4dCgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIA0KDQogICAgICAgICAgICB9DQoNCg0KDQoNCiAgICAgICAgICAgIGlmKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgaWYoYW5zd2VyKXsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7X190aGlzOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHJldHVybiBhbnN3ZXI7DQogICAgICAgIH0NCiAgICANCiAgICB9Ow0KDQogICAgZXNwdGVzdC5jb20gPSBlc3B0ZXN0LmNvbSB8fCB7fTtlc3B0ZXN0LmNvbS5uYW1tb3VyID0gZXNwdGVzdC5jb20ubmFtbW91ciB8fCB7fTtlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20gPSBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20gfHwge307DQogICAgZXNwdGVzdC5jb20ubmFtbW91ci5kY29tLk5vZGVfR3JvdXAgPSBjbGFzcyB7DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE5vZGVfR3JvdXAuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgYWN0aXZlKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX2FjdGl2ZSA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fYWN0aXZlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE5vZGVfR3JvdXAuZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGVuYWJsZWQodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fZW5hYmxlZCA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZW5hYmxlZDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBOb2RlX0dyb3VwLmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBjb2RlKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX2NvZGUgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2NvZGU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTm9kZV9Hcm91cC5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIG9yZGVyKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX29yZGVyID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9vcmRlcjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBOb2RlX0dyb3VwLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBkYXRlKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX2RhdGUgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2RhdGU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTm9kZV9Hcm91cC5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgbmFtZSh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9uYW1lID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9uYW1lOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE5vZGVfR3JvdXAucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgcmVtYXJrKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX3JlbWFyayA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fcmVtYXJrOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgDQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE5vZGVfR3JvdXAuZ3JvdXBfTm9kZXMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBncm91cF9Ob2Rlcyh2KXsNCiAgICAgICAgfQ0KICAgIA0KICAgIA0KICAgICAgICBfdW5pcXVlKCl7DQogICAgICAgICAgICBsZXQgX190b1N0cmluZyA9ICdOb2RlX0dyb3VwLl91bmlxdWUoKTogJzsNCiAgICAgICAgDQogICAgICAgICAgICBsZXQgcmV0ID0gbmV3IHVuZGVmaW5lZCgpOw0KICAgICAgICAgICAgaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDsNCiAgICANCiAgICAgICAgICAgIGlmKHR5cGVvZih0aGlzLm5hbWUoKSkhPT0ndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpOw0KICAgIA0KICAgICAgICAgICAgcmV0dXJuIHJldDsNCiAgICAgICAgfQ0KDQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE5vZGVfR3JvdXAuc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBzdG9yZShfX2V2ZW50KXsNCiAgICAgICAgICAgIGxldCBfX3RvU3RyaW5nID0gJ05vZGVfR3JvdXAuc3RvcmUoKTogJzsNCg0KICAgICAgICAgICAgbGV0IGFuc3dlciA9IHVuZGVmaW5lZDsNCg0KICAgICAgICAgICAgbGV0IF9fcmVzcG9uc2UgPSBuZXcgZXNwdGVzdC5jb20ubmFtbW91ci5kY29tLkV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3RpY2tzKyddLk5vZGVfR3JvdXAuc3RvcmUoKScpLm1ldGhvZCgnc3RvcmUnKS5jbGFzc05hbWUoJ05vZGVfR3JvdXAnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQoNCiAgICAgICAgICAgIGxldCBldkpTT04gPSBudWxsOw0KICAgICAgICAgICAgaWYoX19ldmVudCl7DQogICAgICAgICAgICAgICAgZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICAgICAgaWYodHlwZW9mKGV2SlNPTi5fX3RoaXMpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgICAgICB0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpOw0KICAgICAgICANCg0KDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKF9fZXZlbnQgJiYgIV9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCg0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgIGlmKF9fZXZlbnQgJiYgX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgYW5zd2VyID0gTm9kZV9Hcm91cCgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIHN0b3JlIGxvY2FsbHkNCiAgICAgICAgICAgICAgICBsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoJ05vZGVfR3JvdXAnKTsNCg0KICAgICAgICAgICAgICAgIGxldCBfdGhpcyA9IHRoaXMuX3VuaXF1ZSgpLmZpbmQoKTsNCiAgICAgICAgICAgICAgICBpZighX3RoaXMpIGdyLnNldE5ld0d1aWRWYWx1ZSh0aGlzLklkIHx8ICh0aGlzLklkID0gZ3Iuc2V0TmV3R3VpZCgpKSk7DQogICAgICAgICAgICAgICAgaWYoX3RoaXMgJiYgdHlwZW9mKF90aGlzLklkKSE9PSd1bmRlZmluZWQnKSBnci5nZXQoX3RoaXMuSWQpOw0KDQogICAgICAgICAgICAgICAgbGV0IGJTZXQgPSBmYWxzZTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgaWYoX3RoaXMgJiYgdHlwZW9mKF90aGlzLmdldG5hbWUoKSkhPT0ndW5kZWZpbmVkJykgYlNldCA9IGdyLnNldFZhbHVlKCduYW1lJywgX3RoaXMuZ2V0bmFtZSgpKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgaWYoYlNldCl7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuSWQgPSBnci51cGRhdGUoKTsNCiAgICAgICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgInRoaXMuSWQgPSAiICsgdGhpcy5JZCk7DQogICAgICAgICAgICAgICAgICAgIGlmKCFhbnN3ZXIpIGFuc3dlciA9IHRoaXM7DQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJpbnZhbGlkIG9iamVjdCIpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICANCg0KICAgICAgICAgICAgfQ0KDQoNCg0KDQogICAgICAgICAgICBpZighX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGlmKGFuc3dlcil7DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoe19fdGhpczogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICByZXR1cm4gYW5zd2VyOw0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE5vZGVfR3JvdXAuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGZpbmRBbGwoX19ldmVudCl7DQogICAgICAgICAgICBsZXQgX190b1N0cmluZyA9ICdOb2RlX0dyb3VwLmZpbmRBbGwoKTogJzsNCg0KICAgICAgICAgICAgbGV0IGFuc3dlciA9IHVuZGVmaW5lZDsNCg0KICAgICAgICAgICAgbGV0IF9fcmVzcG9uc2UgPSBuZXcgZXNwdGVzdC5jb20ubmFtbW91ci5kY29tLkV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3RpY2tzKyddLk5vZGVfR3JvdXAuZmluZEFsbCgpJykubWV0aG9kKCdmaW5kQWxsJykuY2xhc3NOYW1lKCdOb2RlX0dyb3VwJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOw0KDQogICAgICAgICAgICBsZXQgZXZKU09OID0gbnVsbDsNCiAgICAgICAgICAgIGlmKF9fZXZlbnQpew0KICAgICAgICAgICAgICAgIGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgICAgIGlmKHR5cGVvZihldkpTT04uX190aGlzKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTsNCiAgICAgICAgDQoNCg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZihfX2V2ZW50ICYmICFfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQoNCiAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICBpZihfX2V2ZW50ICYmIF9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGFuc3dlciA9IE5vZGVfR3JvdXAoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKCFfX2V2ZW50KXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICANCg0KICAgICAgICAgICAgfQ0KDQoNCg0KDQogICAgICAgICAgICBpZighX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGlmKGFuc3dlcil7DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoe19fdGhpczogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICByZXR1cm4gYW5zd2VyOw0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE5vZGVfR3JvdXAuZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGZpbmQoX19ldmVudCl7DQogICAgICAgICAgICBsZXQgX190b1N0cmluZyA9ICdOb2RlX0dyb3VwLmZpbmQoKTogJzsNCg0KICAgICAgICAgICAgbGV0IGFuc3dlciA9IHVuZGVmaW5lZDsNCg0KICAgICAgICAgICAgbGV0IF9fcmVzcG9uc2UgPSBuZXcgZXNwdGVzdC5jb20ubmFtbW91ci5kY29tLkV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3RpY2tzKyddLk5vZGVfR3JvdXAuZmluZCgpJykubWV0aG9kKCdmaW5kJykuY2xhc3NOYW1lKCdOb2RlX0dyb3VwJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOw0KDQogICAgICAgICAgICBsZXQgZXZKU09OID0gbnVsbDsNCiAgICAgICAgICAgIGlmKF9fZXZlbnQpew0KICAgICAgICAgICAgICAgIGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgICAgIGlmKHR5cGVvZihldkpTT04uX190aGlzKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTsNCiAgICAgICAgDQoNCg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZihfX2V2ZW50ICYmICFfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQoNCiAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICBpZihfX2V2ZW50ICYmIF9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGFuc3dlciA9IE5vZGVfR3JvdXAoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKCFfX2V2ZW50KXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICANCg0KICAgICAgICAgICAgfQ0KDQoNCg0KDQogICAgICAgICAgICBpZighX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGlmKGFuc3dlcil7DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoe19fdGhpczogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICByZXR1cm4gYW5zd2VyOw0KICAgICAgICB9DQogICAgDQogICAgfTsNCg0KICAgIGVzcHRlc3QuY29tID0gZXNwdGVzdC5jb20gfHwge307ZXNwdGVzdC5jb20ubmFtbW91ciA9IGVzcHRlc3QuY29tLm5hbW1vdXIgfHwge307ZXNwdGVzdC5jb20ubmFtbW91ci5kY29tID0gZXNwdGVzdC5jb20ubmFtbW91ci5kY29tIHx8IHt9Ow0KICAgIGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5Ob2RlX1R5cGUgPSBjbGFzcyB7DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE5vZGVfVHlwZS5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBhY3RpdmUodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fYWN0aXZlID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9hY3RpdmU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTm9kZV9UeXBlLmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBlbmFibGVkKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX2VuYWJsZWQgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2VuYWJsZWQ7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTm9kZV9UeXBlLmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBjb2RlKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX2NvZGUgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2NvZGU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTm9kZV9UeXBlLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgb3JkZXIodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fb3JkZXIgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX29yZGVyOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE5vZGVfVHlwZS5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgZGF0ZSh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9kYXRlID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9kYXRlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE5vZGVfVHlwZS5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgbmFtZSh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9uYW1lID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9uYW1lOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE5vZGVfVHlwZS5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICByZW1hcmsodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fcmVtYXJrID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9yZW1hcms7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTm9kZV9UeXBlLmR5bmFtaWMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBkeW5hbWljKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX2R5bmFtaWMgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2R5bmFtaWM7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICANCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTm9kZV9UeXBlLnR5cGVfTm9kZXMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICB0eXBlX05vZGVzKHYpew0KICAgICAgICB9DQogICAgDQogICAgDQogICAgICAgIF91bmlxdWUoKXsNCiAgICAgICAgICAgIGxldCBfX3RvU3RyaW5nID0gJ05vZGVfVHlwZS5fdW5pcXVlKCk6ICc7DQogICAgICAgIA0KICAgICAgICAgICAgbGV0IHJldCA9IG5ldyB1bmRlZmluZWQoKTsNCiAgICAgICAgICAgIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7DQogICAgDQogICAgICAgICAgICBpZih0eXBlb2YodGhpcy5uYW1lKCkpIT09J3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTsNCiAgICANCiAgICAgICAgICAgIHJldHVybiByZXQ7DQogICAgICAgIH0NCg0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBOb2RlX1R5cGUuc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBzdG9yZShfX2V2ZW50KXsNCiAgICAgICAgICAgIGxldCBfX3RvU3RyaW5nID0gJ05vZGVfVHlwZS5zdG9yZSgpOiAnOw0KDQogICAgICAgICAgICBsZXQgYW5zd2VyID0gdW5kZWZpbmVkOw0KDQogICAgICAgICAgICBsZXQgX19yZXNwb25zZSA9IG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrdGlja3MrJ10uTm9kZV9UeXBlLnN0b3JlKCknKS5tZXRob2QoJ3N0b3JlJykuY2xhc3NOYW1lKCdOb2RlX1R5cGUnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQoNCiAgICAgICAgICAgIGxldCBldkpTT04gPSBudWxsOw0KICAgICAgICAgICAgaWYoX19ldmVudCl7DQogICAgICAgICAgICAgICAgZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICAgICAgaWYodHlwZW9mKGV2SlNPTi5fX3RoaXMpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgICAgICB0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpOw0KICAgICAgICANCg0KDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKF9fZXZlbnQgJiYgIV9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCg0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgIGlmKF9fZXZlbnQgJiYgX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgYW5zd2VyID0gTm9kZV9UeXBlKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZighX19ldmVudCl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgLy8gc3RvcmUgbG9jYWxseQ0KICAgICAgICAgICAgICAgIGxldCBnciA9IG5ldyBHbGlkZVJlY29yZCgnTm9kZV9UeXBlJyk7DQoNCiAgICAgICAgICAgICAgICBsZXQgX3RoaXMgPSB0aGlzLl91bmlxdWUoKS5maW5kKCk7DQogICAgICAgICAgICAgICAgaWYoIV90aGlzKSBnci5zZXROZXdHdWlkVmFsdWUodGhpcy5JZCB8fCAodGhpcy5JZCA9IGdyLnNldE5ld0d1aWQoKSkpOw0KICAgICAgICAgICAgICAgIGlmKF90aGlzICYmIHR5cGVvZihfdGhpcy5JZCkhPT0ndW5kZWZpbmVkJykgZ3IuZ2V0KF90aGlzLklkKTsNCg0KICAgICAgICAgICAgICAgIGxldCBiU2V0ID0gZmFsc2U7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGlmKF90aGlzICYmIHR5cGVvZihfdGhpcy5nZXRuYW1lKCkpIT09J3VuZGVmaW5lZCcpIGJTZXQgPSBnci5zZXRWYWx1ZSgnbmFtZScsIF90aGlzLmdldG5hbWUoKSk7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGlmKGJTZXQpew0KICAgICAgICAgICAgICAgICAgICB0aGlzLklkID0gZ3IudXBkYXRlKCk7DQogICAgICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJ0aGlzLklkID0gIiArIHRoaXMuSWQpOw0KICAgICAgICAgICAgICAgICAgICBpZighYW5zd2VyKSBhbnN3ZXIgPSB0aGlzOw0KICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiaW52YWxpZCBvYmplY3QiKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KDQoNCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBpZihhbnN3ZXIpew0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHtfX3RoaXM6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcmV0dXJuIGFuc3dlcjsNCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBOb2RlX1R5cGUuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGZpbmRBbGwoX19ldmVudCl7DQogICAgICAgICAgICBsZXQgX190b1N0cmluZyA9ICdOb2RlX1R5cGUuZmluZEFsbCgpOiAnOw0KDQogICAgICAgICAgICBsZXQgYW5zd2VyID0gdW5kZWZpbmVkOw0KDQogICAgICAgICAgICBsZXQgX19yZXNwb25zZSA9IG5ldyBlc3B0ZXN0LmNvbS5uYW1tb3VyLmRjb20uRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrdGlja3MrJ10uTm9kZV9UeXBlLmZpbmRBbGwoKScpLm1ldGhvZCgnZmluZEFsbCcpLmNsYXNzTmFtZSgnTm9kZV9UeXBlJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOw0KDQogICAgICAgICAgICBsZXQgZXZKU09OID0gbnVsbDsNCiAgICAgICAgICAgIGlmKF9fZXZlbnQpew0KICAgICAgICAgICAgICAgIGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgICAgIGlmKHR5cGVvZihldkpTT04uX190aGlzKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTsNCiAgICAgICAgDQoNCg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZihfX2V2ZW50ICYmICFfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQoNCiAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICBpZihfX2V2ZW50ICYmIF9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGFuc3dlciA9IE5vZGVfVHlwZSgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIA0KDQogICAgICAgICAgICB9DQoNCg0KDQoNCiAgICAgICAgICAgIGlmKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgaWYoYW5zd2VyKXsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7X190aGlzOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHJldHVybiBhbnN3ZXI7DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTm9kZV9UeXBlLmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBmaW5kKF9fZXZlbnQpew0KICAgICAgICAgICAgbGV0IF9fdG9TdHJpbmcgPSAnTm9kZV9UeXBlLmZpbmQoKTogJzsNCg0KICAgICAgICAgICAgbGV0IGFuc3dlciA9IHVuZGVmaW5lZDsNCg0KICAgICAgICAgICAgbGV0IF9fcmVzcG9uc2UgPSBuZXcgZXNwdGVzdC5jb20ubmFtbW91ci5kY29tLkV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3RpY2tzKyddLk5vZGVfVHlwZS5maW5kKCknKS5tZXRob2QoJ2ZpbmQnKS5jbGFzc05hbWUoJ05vZGVfVHlwZScpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCg0KICAgICAgICAgICAgbGV0IGV2SlNPTiA9IG51bGw7DQogICAgICAgICAgICBpZihfX2V2ZW50KXsNCiAgICAgICAgICAgICAgICBldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgICAgICBpZih0eXBlb2YoZXZKU09OLl9fdGhpcykhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7DQogICAgICAgIA0KDQoNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoX19ldmVudCAmJiAhX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KDQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgaWYoX19ldmVudCAmJiBfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBhbnN3ZXIgPSBOb2RlX1R5cGUoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKCFfX2V2ZW50KXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICANCg0KICAgICAgICAgICAgfQ0KDQoNCg0KDQogICAgICAgICAgICBpZighX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGlmKGFuc3dlcil7DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoe19fdGhpczogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICByZXR1cm4gYW5zd2VyOw0KICAgICAgICB9DQogICAgDQogICAgfTsNCg0KICAgIGVzcHRlc3QuY29tID0gZXNwdGVzdC5jb20gfHwge307ZXNwdGVzdC5jb20ubmFtbW91ciA9IGVzcHRlc3QuY29tLm5hbW1vdXIgfHwge307ZXNwdGVzdC5jb20ubmFtbW91ci5kY29tID0gZXNwdGVzdC5jb20ubmFtbW91ci5kY29tIHx8IHt9Ow0KICAgIGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5NYXBwaW5nID0gY2xhc3Mgew0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBNYXBwaW5nLmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGFjdGl2ZSh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9hY3RpdmUgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2FjdGl2ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBNYXBwaW5nLmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBlbmFibGVkKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX2VuYWJsZWQgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2VuYWJsZWQ7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTWFwcGluZy5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIG9yZGVyKHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX29yZGVyID0gdjsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9vcmRlcjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBNYXBwaW5nLmNsYXNzTmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGNsYXNzTmFtZSh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9jbGFzc05hbWUgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2NsYXNzTmFtZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBNYXBwaW5nLnNjb3BlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgc2NvcGUodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fc2NvcGUgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3Njb3BlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE1hcHBpbmcuY29udGV4dCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIGNvbnRleHQodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fY29udGV4dCA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fY29udGV4dDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBNYXBwaW5nLnNvdXJjZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHNvdXJjZSh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl9zb3VyY2UgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3NvdXJjZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBNYXBwaW5nLnRhcmdldCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHRhcmdldCh2KXsNCiAgICAgICAgICAgIGlmKHR5cGVvZih2KSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICB0aGlzLl90YXJnZXQgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3RhcmdldDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBNYXBwaW5nLmluU2NyaXB0IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgaW5TY3JpcHQodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5faW5TY3JpcHQgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2luU2NyaXB0Ow0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE1hcHBpbmcub3V0U2NyaXB0IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgb3V0U2NyaXB0KHYpew0KICAgICAgICAgICAgaWYodHlwZW9mKHYpIT09J3VuZGVmaW5lZCcpew0KICAgICAgICAgICAgICAgIHRoaXMuX291dFNjcmlwdCA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fb3V0U2NyaXB0Ow0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE1hcHBpbmcudG9vbCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHRvb2wodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fdG9vbCA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fdG9vbDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBNYXBwaW5nLmdyb3VwIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgZ3JvdXAodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fZ3JvdXAgPSB2Ow0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2dyb3VwOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE1hcHBpbmcudHlwZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHR5cGUodil7DQogICAgICAgICAgICBpZih0eXBlb2YodikhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgdGhpcy5fdHlwZSA9IHY7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fdHlwZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgIA0KICAgIA0KICAgIA0KICAgICAgICBfdW5pcXVlKCl7DQogICAgICAgICAgICBsZXQgX190b1N0cmluZyA9ICdNYXBwaW5nLl91bmlxdWUoKTogJzsNCiAgICAgICAgDQogICAgICAgICAgICBsZXQgcmV0ID0gbmV3IHVuZGVmaW5lZCgpOw0KICAgICAgICAgICAgaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDsNCiAgICANCiAgICAgICAgICAgIHJldHVybiByZXQ7DQogICAgICAgIH0NCg0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBNYXBwaW5nLnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgc3RvcmUoX19ldmVudCl7DQogICAgICAgICAgICBsZXQgX190b1N0cmluZyA9ICdNYXBwaW5nLnN0b3JlKCk6ICc7DQoNCiAgICAgICAgICAgIGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7DQoNCiAgICAgICAgICAgIGxldCBfX3Jlc3BvbnNlID0gbmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5FdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJyt0aWNrcysnXS5NYXBwaW5nLnN0b3JlKCknKS5tZXRob2QoJ3N0b3JlJykuY2xhc3NOYW1lKCdNYXBwaW5nJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOw0KDQogICAgICAgICAgICBsZXQgZXZKU09OID0gbnVsbDsNCiAgICAgICAgICAgIGlmKF9fZXZlbnQpew0KICAgICAgICAgICAgICAgIGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgICAgIGlmKHR5cGVvZihldkpTT04uX190aGlzKSE9PSd1bmRlZmluZWQnKXsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTsNCiAgICAgICAgDQoNCg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZihfX2V2ZW50ICYmICFfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQoNCiAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICBpZihfX2V2ZW50ICYmIF9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGFuc3dlciA9IE1hcHBpbmcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKCFfX2V2ZW50KXsNCiAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBzdG9yZSBsb2NhbGx5DQogICAgICAgICAgICAgICAgbGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKCdNYXBwaW5nJyk7DQoNCiAgICAgICAgICAgICAgICBsZXQgX3RoaXMgPSB0aGlzLl91bmlxdWUoKS5maW5kKCk7DQogICAgICAgICAgICAgICAgaWYoIV90aGlzKSBnci5zZXROZXdHdWlkVmFsdWUodGhpcy5JZCB8fCAodGhpcy5JZCA9IGdyLnNldE5ld0d1aWQoKSkpOw0KICAgICAgICAgICAgICAgIGlmKF90aGlzICYmIHR5cGVvZihfdGhpcy5JZCkhPT0ndW5kZWZpbmVkJykgZ3IuZ2V0KF90aGlzLklkKTsNCg0KICAgICAgICAgICAgICAgIGxldCBiU2V0ID0gZmFsc2U7DQogICAgICAgIA0KICAgICAgICAgICAgICAgIGlmKGJTZXQpew0KICAgICAgICAgICAgICAgICAgICB0aGlzLklkID0gZ3IudXBkYXRlKCk7DQogICAgICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICJ0aGlzLklkID0gIiArIHRoaXMuSWQpOw0KICAgICAgICAgICAgICAgICAgICBpZighYW5zd2VyKSBhbnN3ZXIgPSB0aGlzOw0KICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICBncy5pbmZvKF9fdG9TdHJpbmcgKyAiaW52YWxpZCBvYmplY3QiKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KDQoNCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBpZihhbnN3ZXIpew0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHtfX3RoaXM6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcmV0dXJuIGFuc3dlcjsNCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBNYXBwaW5nLmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBmaW5kQWxsKF9fZXZlbnQpew0KICAgICAgICAgICAgbGV0IF9fdG9TdHJpbmcgPSAnTWFwcGluZy5maW5kQWxsKCk6ICc7DQoNCiAgICAgICAgICAgIGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7DQoNCiAgICAgICAgICAgIGxldCBfX3Jlc3BvbnNlID0gbmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5FdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJyt0aWNrcysnXS5NYXBwaW5nLmZpbmRBbGwoKScpLm1ldGhvZCgnZmluZEFsbCcpLmNsYXNzTmFtZSgnTWFwcGluZycpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCg0KICAgICAgICAgICAgbGV0IGV2SlNPTiA9IG51bGw7DQogICAgICAgICAgICBpZihfX2V2ZW50KXsNCiAgICAgICAgICAgICAgICBldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgICAgICBpZih0eXBlb2YoZXZKU09OLl9fdGhpcykhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7DQogICAgICAgIA0KDQoNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoX19ldmVudCAmJiAhX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KDQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgaWYoX19ldmVudCAmJiBfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBhbnN3ZXIgPSBNYXBwaW5nKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZighX19ldmVudCl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KDQoNCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBpZihhbnN3ZXIpew0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHtfX3RoaXM6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcmV0dXJuIGFuc3dlcjsNCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBNYXBwaW5nLmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBmaW5kKF9fZXZlbnQpew0KICAgICAgICAgICAgbGV0IF9fdG9TdHJpbmcgPSAnTWFwcGluZy5maW5kKCk6ICc7DQoNCiAgICAgICAgICAgIGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7DQoNCiAgICAgICAgICAgIGxldCBfX3Jlc3BvbnNlID0gbmV3IGVzcHRlc3QuY29tLm5hbW1vdXIuZGNvbS5FdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJyt0aWNrcysnXS5NYXBwaW5nLmZpbmQoKScpLm1ldGhvZCgnZmluZCcpLmNsYXNzTmFtZSgnTWFwcGluZycpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCg0KICAgICAgICAgICAgbGV0IGV2SlNPTiA9IG51bGw7DQogICAgICAgICAgICBpZihfX2V2ZW50KXsNCiAgICAgICAgICAgICAgICBldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgICAgICBpZih0eXBlb2YoZXZKU09OLl9fdGhpcykhPT0ndW5kZWZpbmVkJyl7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7DQogICAgICAgIA0KDQoNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYoX19ldmVudCAmJiAhX19ldmVudC5yZXNwb25zZVRvKCkpew0KICAgICAgICAgICAgICAgIGdzLmluZm8oX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KDQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgaWYoX19ldmVudCAmJiBfX2V2ZW50LnJlc3BvbnNlVG8oKSl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgICAgICBhbnN3ZXIgPSBNYXBwaW5nKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZighX19ldmVudCl7DQogICAgICAgICAgICAgICAgZ3MuaW5mbyhfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgDQoNCiAgICAgICAgICAgIH0NCg0KDQoNCg0KICAgICAgICAgICAgaWYoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKXsNCiAgICAgICAgICAgICAgICBpZihhbnN3ZXIpew0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHtfX3RoaXM6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcmV0dXJuIGFuc3dlcjsNCiAgICAgICAgfQ0KICAgIA0KICAgIH07DQoNCg0KaWYodHlwZW9mKG1vZHVsZSkhPT0idW5kZWZpbmVkIikgbW9kdWxlLmV4cG9ydHMuZXNwdGVzdCA9IGVzcHRlc3Q7",
	"__keys": ["name"],
	"__trMap": []
}