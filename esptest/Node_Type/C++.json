{
	"Id": "e821661e54613bce83b3071de5ef2b6abbd0b57a",
	"active": "true",
	"enabled": "true",
	"code": "c++",
	"date": "2024-10-21T14:39:23.908Z",
	"name": "C++",
	"remark": "LyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqDQoqKioqKioqKioqKioqKioqKioqKiAgICAgICAgQVBJIFNlcnZlciBTdHViIGZvciBDKysgICAgICAgKioqKioqKioqKioqKioqKioqKioqKioNCioqKioqKioqKioqKioqKioqKioqIFZFUlNJT046IDIwMjQtMTAtMjFUMTQ6Mzk6MjEuNjM5WiAgKioqKioqKioqKioqKioqKioqKioNCioqKioqKioqKioqKioqKioqKioqICBTWVNURU06IGFwaXNlcnZlci9lc3B0ZXN0ICAgICAqKioqKioqKioqKioqKioqKioqKg0KKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovDQoNCg0KDQovKiBMaW51eCBydW5uZXI6DQp3Z2V0IC1xTy0gImh0dHBzOi8vYXJ6aG9zcGl0YWwuZ2l0aHViLmlvL2VzcHRlc3QvTm9kZV9UeXBlL0MrKy5qc29uIiB8IGpxIC1yICcucmVtYXJrIHwgQGJhc2U2NGQnIHwgZysrIC14IGMrKyAtDQoNCg0KKi8NCg0KDQojaW5jbHVkZSA8Y3RpbWU+DQojaW5jbHVkZSA8c3RyaW5nPg0KI2luY2x1ZGUgImJpdHMvc3RkYysrLmgiDQojaW5jbHVkZSA8Y2hyb25vPg0KI2luY2x1ZGUgImluY2x1ZGUvanNvbi5ocHAiDQojaW5jbHVkZSAibXF0dC9hc3luY19jbGllbnQuaCINCiNpbmNsdWRlICJtcXR0L3RvcGljLmgiDQojaW5jbHVkZSA8cmVnZXg+DQojaW5jbHVkZSAiY3VybC9jdXJsLmgiDQoNCnVzaW5nIGpzb24gPSBubG9obWFubjo6anNvbjsNCg0KDQpuYW1lc3BhY2UgZXNwdGVzdHsKCQpuYW1lc3BhY2UgY29tewoJCm5hbWVzcGFjZSBuYW1tb3VyewoJCm5hbWVzcGFjZSBkY29tewoJDQogICAgDQogICAgY2xhc3MgQ29uZmlnX0dyb3Vwew0KICAgICAgICBwdWJsaWM6DQogICAgICAgICAgICBDb25maWdfR3JvdXAoKXsNCiAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICB+Q29uZmlnX0dyb3VwKCl7DQogICAgICAgICAgICAgICAgLy8gZm9yIGV2ZXJ5ICJuZXciIHRoZXJlIG11c3QgYmUgYSAiZGVsZXRlIg0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgcHJpdmF0ZToNCiAgICAgICAgICAgIHVuc2lnbmVkIGxvbmcgSWQ7DQoNCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogQ29uZmlnX0dyb3VwLmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHByaXZhdGU6DQogICAgICAgICAgICBib29sIF9hY3RpdmU7DQogICAgICAgICAgICANCiAgICAgICAgcHVibGljOg0KICAgICAgICAgICAgYm9vbCBhY3RpdmUoKTsNCiAgICAgICAgICAgIENvbmZpZ19Hcm91cCYgYWN0aXZlKGJvb2wgdik7DQogICAgICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBDb25maWdfR3JvdXAuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogQ29uZmlnX0dyb3VwLmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBwcml2YXRlOg0KICAgICAgICAgICAgYm9vbCBfZW5hYmxlZDsNCiAgICAgICAgICAgIA0KICAgICAgICBwdWJsaWM6DQogICAgICAgICAgICBib29sIGVuYWJsZWQoKTsNCiAgICAgICAgICAgIENvbmZpZ19Hcm91cCYgZW5hYmxlZChib29sIHYpOw0KICAgICAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogQ29uZmlnX0dyb3VwLmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBDb25maWdfR3JvdXAuY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHByaXZhdGU6DQogICAgICAgICAgICBzdGQ6OnN0cmluZyBfY29kZTsNCiAgICAgICAgICAgIA0KICAgICAgICBwdWJsaWM6DQogICAgICAgICAgICBzdGQ6OnN0cmluZyBjb2RlKCk7DQogICAgICAgICAgICBDb25maWdfR3JvdXAmIGNvZGUoc3RkOjpzdHJpbmcgdik7DQogICAgICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBDb25maWdfR3JvdXAuY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIENvbmZpZ19Hcm91cC5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHByaXZhdGU6DQogICAgICAgICAgICBpbnQgX29yZGVyOw0KICAgICAgICAgICAgDQogICAgICAgIHB1YmxpYzoNCiAgICAgICAgICAgIGludCBvcmRlcigpOw0KICAgICAgICAgICAgQ29uZmlnX0dyb3VwJiBvcmRlcihpbnQgdik7DQogICAgICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBDb25maWdfR3JvdXAub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBDb25maWdfR3JvdXAuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHByaXZhdGU6DQogICAgICAgICAgICB0aW1lX3QgX2RhdGU7DQogICAgICAgICAgICANCiAgICAgICAgcHVibGljOg0KICAgICAgICAgICAgdGltZV90IGRhdGUoKTsNCiAgICAgICAgICAgIENvbmZpZ19Hcm91cCYgZGF0ZSh0aW1lX3Qgdik7DQogICAgICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBDb25maWdfR3JvdXAuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIENvbmZpZ19Hcm91cC5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgcHJpdmF0ZToNCiAgICAgICAgICAgIHN0ZDo6c3RyaW5nIF9uYW1lOw0KICAgICAgICAgICAgDQogICAgICAgIHB1YmxpYzoNCiAgICAgICAgICAgIHN0ZDo6c3RyaW5nIG5hbWUoKTsNCiAgICAgICAgICAgIENvbmZpZ19Hcm91cCYgbmFtZShzdGQ6OnN0cmluZyB2KTsNCiAgICAgICAgDQogICAgICAgIC8qKioqKioqKioqKioqIENvbmZpZ19Hcm91cC5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogQ29uZmlnX0dyb3VwLnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHByaXZhdGU6DQogICAgICAgICAgICBzdGQ6OnN0cmluZyBfcmVtYXJrOw0KICAgICAgICAgICAgDQogICAgICAgIHB1YmxpYzoNCiAgICAgICAgICAgIHN0ZDo6c3RyaW5nIHJlbWFyaygpOw0KICAgICAgICAgICAgQ29uZmlnX0dyb3VwJiByZW1hcmsoc3RkOjpzdHJpbmcgdik7DQogICAgICAgIA0KICAgICAgICAgICAgQ29uZmlnX0dyb3VwJiByZW1hcmsoanNvbiB2KTsNCiAgICAgICAgDQogICAgICAgIC8qKioqKioqKioqKioqIENvbmZpZ19Hcm91cC5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgIA0KDQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIENvbmZpZ19Hcm91cC5ncm91cF9Db25maWdzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCg0KICAgICAgICBwcml2YXRlOg0KICAgICAgICAgICAgc3RkOjp2ZWN0b3I8c3RkOjphbnk+KiBfZ3JvdXBfQ29uZmlnczsNCiAgICAgICAgDQogICAgICAgIHB1YmxpYzoNCiAgICAgICAgICAgIHN0ZDo6dmVjdG9yPHN0ZDo6YW55PiYmIGdyb3VwX0NvbmZpZ3MoKTsNCiAgICAgICAgICAgIENvbmZpZ19Hcm91cCYgZ3JvdXBfQ29uZmlncyhzdGQ6OnZlY3RvcjxzdGQ6OmFueT4mJiB2KTsNCiAgICAgICAgLyoqKioqKioqKioqKiogQ29uZmlnX0dyb3VwLmdyb3VwX0NvbmZpZ3MgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBDb25maWdfR3JvdXAuZ3JvdXBfTWFwcGluZ3MgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KDQogICAgICAgIHByaXZhdGU6DQogICAgICAgICAgICBzdGQ6OnZlY3RvcjxzdGQ6OmFueT4qIF9ncm91cF9NYXBwaW5nczsNCiAgICAgICAgDQogICAgICAgIHB1YmxpYzoNCiAgICAgICAgICAgIHN0ZDo6dmVjdG9yPHN0ZDo6YW55PiYmIGdyb3VwX01hcHBpbmdzKCk7DQogICAgICAgICAgICBDb25maWdfR3JvdXAmIGdyb3VwX01hcHBpbmdzKHN0ZDo6dmVjdG9yPHN0ZDo6YW55PiYmIHYpOw0KICAgICAgICAvKioqKioqKioqKioqKiBDb25maWdfR3JvdXAuZ3JvdXBfTWFwcGluZ3MgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgIA0KDQogICAgICAgIHB1YmxpYzoNCiAgICAgICAgICAgIENvbmZpZ19Hcm91cCYgX3VuaXF1ZSgpOw0KICAgICAgICAgICAgc3RkOjpzdHJpbmcgX3RvRG9jdW1lbnQoKTsNCiAgICAgICAgICAgIENvbmZpZ19Hcm91cCYgX2Zyb21Eb2N1bWVudCh1bnNpZ25lZCBjaGFyKiBvYmopOw0KICAgICAgICAgICAgQ29uZmlnX0dyb3VwJiBfZnJvbURvY3VtZW50KHN0ZDo6c3RyaW5nIG9iaik7DQogICAgICAgICAgICBDb25maWdfR3JvdXAmIF9mcm9tRG9jdW1lbnQoanNvbiBvYmopOw0KICAgICAgICAgICAgc3RkOjp2ZWN0b3I8Q29uZmlnX0dyb3VwPiYmIF9mcm9tRG9jdW1lbnQoc3RkOjp2ZWN0b3I8anNvbj4mJiBvYmopOw0KICAgIA0KICAgICAgICBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkNvbmZpZ19Hcm91cCYgc3RvcmUoKTsNCiAgICANCiAgICAgICAgc3RkOjp2ZWN0b3I8ZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpDb25maWdfR3JvdXA+JiBmaW5kQWxsKCk7DQogICAgDQogICAgICAgIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Q29uZmlnX0dyb3VwJiBmaW5kKCk7DQogICAgDQogICAgfTsNCiAgICANCiAgICBjbGFzcyBNYXBwaW5nX0dyb3Vwew0KICAgICAgICBwdWJsaWM6DQogICAgICAgICAgICBNYXBwaW5nX0dyb3VwKCl7DQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgfk1hcHBpbmdfR3JvdXAoKXsNCiAgICAgICAgICAgICAgICAvLyBmb3IgZXZlcnkgIm5ldyIgdGhlcmUgbXVzdCBiZSBhICJkZWxldGUiDQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICBwcml2YXRlOg0KICAgICAgICAgICAgdW5zaWduZWQgbG9uZyBJZDsNCg0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBNYXBwaW5nX0dyb3VwLmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHByaXZhdGU6DQogICAgICAgICAgICBib29sIF9hY3RpdmU7DQogICAgICAgICAgICANCiAgICAgICAgcHVibGljOg0KICAgICAgICAgICAgYm9vbCBhY3RpdmUoKTsNCiAgICAgICAgICAgIE1hcHBpbmdfR3JvdXAmIGFjdGl2ZShib29sIHYpOw0KICAgICAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTWFwcGluZ19Hcm91cC5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBNYXBwaW5nX0dyb3VwLmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBwcml2YXRlOg0KICAgICAgICAgICAgYm9vbCBfZW5hYmxlZDsNCiAgICAgICAgICAgIA0KICAgICAgICBwdWJsaWM6DQogICAgICAgICAgICBib29sIGVuYWJsZWQoKTsNCiAgICAgICAgICAgIE1hcHBpbmdfR3JvdXAmIGVuYWJsZWQoYm9vbCB2KTsNCiAgICAgICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE1hcHBpbmdfR3JvdXAuZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE1hcHBpbmdfR3JvdXAuY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHByaXZhdGU6DQogICAgICAgICAgICBzdGQ6OnN0cmluZyBfY29kZTsNCiAgICAgICAgICAgIA0KICAgICAgICBwdWJsaWM6DQogICAgICAgICAgICBzdGQ6OnN0cmluZyBjb2RlKCk7DQogICAgICAgICAgICBNYXBwaW5nX0dyb3VwJiBjb2RlKHN0ZDo6c3RyaW5nIHYpOw0KICAgICAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTWFwcGluZ19Hcm91cC5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTWFwcGluZ19Hcm91cC5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHByaXZhdGU6DQogICAgICAgICAgICBpbnQgX29yZGVyOw0KICAgICAgICAgICAgDQogICAgICAgIHB1YmxpYzoNCiAgICAgICAgICAgIGludCBvcmRlcigpOw0KICAgICAgICAgICAgTWFwcGluZ19Hcm91cCYgb3JkZXIoaW50IHYpOw0KICAgICAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTWFwcGluZ19Hcm91cC5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE1hcHBpbmdfR3JvdXAuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHByaXZhdGU6DQogICAgICAgICAgICB0aW1lX3QgX2RhdGU7DQogICAgICAgICAgICANCiAgICAgICAgcHVibGljOg0KICAgICAgICAgICAgdGltZV90IGRhdGUoKTsNCiAgICAgICAgICAgIE1hcHBpbmdfR3JvdXAmIGRhdGUodGltZV90IHYpOw0KICAgICAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTWFwcGluZ19Hcm91cC5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTWFwcGluZ19Hcm91cC5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgcHJpdmF0ZToNCiAgICAgICAgICAgIHN0ZDo6c3RyaW5nIF9uYW1lOw0KICAgICAgICAgICAgDQogICAgICAgIHB1YmxpYzoNCiAgICAgICAgICAgIHN0ZDo6c3RyaW5nIG5hbWUoKTsNCiAgICAgICAgICAgIE1hcHBpbmdfR3JvdXAmIG5hbWUoc3RkOjpzdHJpbmcgdik7DQogICAgICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBNYXBwaW5nX0dyb3VwLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBNYXBwaW5nX0dyb3VwLnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHByaXZhdGU6DQogICAgICAgICAgICBzdGQ6OnN0cmluZyBfcmVtYXJrOw0KICAgICAgICAgICAgDQogICAgICAgIHB1YmxpYzoNCiAgICAgICAgICAgIHN0ZDo6c3RyaW5nIHJlbWFyaygpOw0KICAgICAgICAgICAgTWFwcGluZ19Hcm91cCYgcmVtYXJrKHN0ZDo6c3RyaW5nIHYpOw0KICAgICAgICANCiAgICAgICAgICAgIE1hcHBpbmdfR3JvdXAmIHJlbWFyayhqc29uIHYpOw0KICAgICAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTWFwcGluZ19Hcm91cC5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgIA0KDQogICAgDQoNCiAgICAgICAgcHVibGljOg0KICAgICAgICAgICAgTWFwcGluZ19Hcm91cCYgX3VuaXF1ZSgpOw0KICAgICAgICAgICAgc3RkOjpzdHJpbmcgX3RvRG9jdW1lbnQoKTsNCiAgICAgICAgICAgIE1hcHBpbmdfR3JvdXAmIF9mcm9tRG9jdW1lbnQodW5zaWduZWQgY2hhciogb2JqKTsNCiAgICAgICAgICAgIE1hcHBpbmdfR3JvdXAmIF9mcm9tRG9jdW1lbnQoc3RkOjpzdHJpbmcgb2JqKTsNCiAgICAgICAgICAgIE1hcHBpbmdfR3JvdXAmIF9mcm9tRG9jdW1lbnQoanNvbiBvYmopOw0KICAgICAgICAgICAgc3RkOjp2ZWN0b3I8TWFwcGluZ19Hcm91cD4mJiBfZnJvbURvY3VtZW50KHN0ZDo6dmVjdG9yPGpzb24+JiYgb2JqKTsNCiAgICANCiAgICAgICAgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpNYXBwaW5nX0dyb3VwJiBzdG9yZSgpOw0KICAgIA0KICAgICAgICBzdGQ6OnZlY3Rvcjxlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok1hcHBpbmdfR3JvdXA+JiBmaW5kQWxsKCk7DQogICAgDQogICAgICAgIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6TWFwcGluZ19Hcm91cCYgZmluZCgpOw0KICAgIA0KICAgIH07DQogICAgDQogICAgY2xhc3MgVG9vbF9UeXBlew0KICAgICAgICBwdWJsaWM6DQogICAgICAgICAgICBUb29sX1R5cGUoKXsNCiAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICB+VG9vbF9UeXBlKCl7DQogICAgICAgICAgICAgICAgLy8gZm9yIGV2ZXJ5ICJuZXciIHRoZXJlIG11c3QgYmUgYSAiZGVsZXRlIg0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgcHJpdmF0ZToNCiAgICAgICAgICAgIHVuc2lnbmVkIGxvbmcgSWQ7DQoNCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogVG9vbF9UeXBlLmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHByaXZhdGU6DQogICAgICAgICAgICBib29sIF9hY3RpdmU7DQogICAgICAgICAgICANCiAgICAgICAgcHVibGljOg0KICAgICAgICAgICAgYm9vbCBhY3RpdmUoKTsNCiAgICAgICAgICAgIFRvb2xfVHlwZSYgYWN0aXZlKGJvb2wgdik7DQogICAgICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBUb29sX1R5cGUuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogVG9vbF9UeXBlLmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBwcml2YXRlOg0KICAgICAgICAgICAgYm9vbCBfZW5hYmxlZDsNCiAgICAgICAgICAgIA0KICAgICAgICBwdWJsaWM6DQogICAgICAgICAgICBib29sIGVuYWJsZWQoKTsNCiAgICAgICAgICAgIFRvb2xfVHlwZSYgZW5hYmxlZChib29sIHYpOw0KICAgICAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogVG9vbF9UeXBlLmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBUb29sX1R5cGUuY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHByaXZhdGU6DQogICAgICAgICAgICBzdGQ6OnN0cmluZyBfY29kZTsNCiAgICAgICAgICAgIA0KICAgICAgICBwdWJsaWM6DQogICAgICAgICAgICBzdGQ6OnN0cmluZyBjb2RlKCk7DQogICAgICAgICAgICBUb29sX1R5cGUmIGNvZGUoc3RkOjpzdHJpbmcgdik7DQogICAgICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBUb29sX1R5cGUuY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIFRvb2xfVHlwZS5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHByaXZhdGU6DQogICAgICAgICAgICBpbnQgX29yZGVyOw0KICAgICAgICAgICAgDQogICAgICAgIHB1YmxpYzoNCiAgICAgICAgICAgIGludCBvcmRlcigpOw0KICAgICAgICAgICAgVG9vbF9UeXBlJiBvcmRlcihpbnQgdik7DQogICAgICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBUb29sX1R5cGUub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBUb29sX1R5cGUuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHByaXZhdGU6DQogICAgICAgICAgICB0aW1lX3QgX2RhdGU7DQogICAgICAgICAgICANCiAgICAgICAgcHVibGljOg0KICAgICAgICAgICAgdGltZV90IGRhdGUoKTsNCiAgICAgICAgICAgIFRvb2xfVHlwZSYgZGF0ZSh0aW1lX3Qgdik7DQogICAgICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBUb29sX1R5cGUuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIFRvb2xfVHlwZS5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgcHJpdmF0ZToNCiAgICAgICAgICAgIHN0ZDo6c3RyaW5nIF9uYW1lOw0KICAgICAgICAgICAgDQogICAgICAgIHB1YmxpYzoNCiAgICAgICAgICAgIHN0ZDo6c3RyaW5nIG5hbWUoKTsNCiAgICAgICAgICAgIFRvb2xfVHlwZSYgbmFtZShzdGQ6OnN0cmluZyB2KTsNCiAgICAgICAgDQogICAgICAgIC8qKioqKioqKioqKioqIFRvb2xfVHlwZS5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogVG9vbF9UeXBlLnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHByaXZhdGU6DQogICAgICAgICAgICBzdGQ6OnN0cmluZyBfcmVtYXJrOw0KICAgICAgICAgICAgDQogICAgICAgIHB1YmxpYzoNCiAgICAgICAgICAgIHN0ZDo6c3RyaW5nIHJlbWFyaygpOw0KICAgICAgICAgICAgVG9vbF9UeXBlJiByZW1hcmsoc3RkOjpzdHJpbmcgdik7DQogICAgICAgIA0KICAgICAgICAgICAgVG9vbF9UeXBlJiByZW1hcmsoanNvbiB2KTsNCiAgICAgICAgDQogICAgICAgIC8qKioqKioqKioqKioqIFRvb2xfVHlwZS5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgIA0KDQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIFRvb2xfVHlwZS50eXBlX0NvbmZpZ3MgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KDQogICAgICAgIHByaXZhdGU6DQogICAgICAgICAgICBzdGQ6OnZlY3RvcjxzdGQ6OmFueT4qIF90eXBlX0NvbmZpZ3M7DQogICAgICAgIA0KICAgICAgICBwdWJsaWM6DQogICAgICAgICAgICBzdGQ6OnZlY3RvcjxzdGQ6OmFueT4mJiB0eXBlX0NvbmZpZ3MoKTsNCiAgICAgICAgICAgIFRvb2xfVHlwZSYgdHlwZV9Db25maWdzKHN0ZDo6dmVjdG9yPHN0ZDo6YW55PiYmIHYpOw0KICAgICAgICAvKioqKioqKioqKioqKiBUb29sX1R5cGUudHlwZV9Db25maWdzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogVG9vbF9UeXBlLnR5cGVfVG9vbHMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KDQogICAgICAgIHByaXZhdGU6DQogICAgICAgICAgICBzdGQ6OnZlY3RvcjxzdGQ6OmFueT4qIF90eXBlX1Rvb2xzOw0KICAgICAgICANCiAgICAgICAgcHVibGljOg0KICAgICAgICAgICAgc3RkOjp2ZWN0b3I8c3RkOjphbnk+JiYgdHlwZV9Ub29scygpOw0KICAgICAgICAgICAgVG9vbF9UeXBlJiB0eXBlX1Rvb2xzKHN0ZDo6dmVjdG9yPHN0ZDo6YW55PiYmIHYpOw0KICAgICAgICAvKioqKioqKioqKioqKiBUb29sX1R5cGUudHlwZV9Ub29scyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIFRvb2xfVHlwZS50eXBlX01hcHBpbmdzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCg0KICAgICAgICBwcml2YXRlOg0KICAgICAgICAgICAgc3RkOjp2ZWN0b3I8c3RkOjphbnk+KiBfdHlwZV9NYXBwaW5nczsNCiAgICAgICAgDQogICAgICAgIHB1YmxpYzoNCiAgICAgICAgICAgIHN0ZDo6dmVjdG9yPHN0ZDo6YW55PiYmIHR5cGVfTWFwcGluZ3MoKTsNCiAgICAgICAgICAgIFRvb2xfVHlwZSYgdHlwZV9NYXBwaW5ncyhzdGQ6OnZlY3RvcjxzdGQ6OmFueT4mJiB2KTsNCiAgICAgICAgLyoqKioqKioqKioqKiogVG9vbF9UeXBlLnR5cGVfTWFwcGluZ3MgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgIA0KDQogICAgICAgIHB1YmxpYzoNCiAgICAgICAgICAgIFRvb2xfVHlwZSYgX3VuaXF1ZSgpOw0KICAgICAgICAgICAgc3RkOjpzdHJpbmcgX3RvRG9jdW1lbnQoKTsNCiAgICAgICAgICAgIFRvb2xfVHlwZSYgX2Zyb21Eb2N1bWVudCh1bnNpZ25lZCBjaGFyKiBvYmopOw0KICAgICAgICAgICAgVG9vbF9UeXBlJiBfZnJvbURvY3VtZW50KHN0ZDo6c3RyaW5nIG9iaik7DQogICAgICAgICAgICBUb29sX1R5cGUmIF9mcm9tRG9jdW1lbnQoanNvbiBvYmopOw0KICAgICAgICAgICAgc3RkOjp2ZWN0b3I8VG9vbF9UeXBlPiYmIF9mcm9tRG9jdW1lbnQoc3RkOjp2ZWN0b3I8anNvbj4mJiBvYmopOw0KICAgIA0KICAgICAgICBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OlRvb2xfVHlwZSYgc3RvcmUoKTsNCiAgICANCiAgICAgICAgc3RkOjp2ZWN0b3I8ZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpUb29sX1R5cGU+JiBmaW5kQWxsKCk7DQogICAgDQogICAgICAgIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6VG9vbF9UeXBlJiBmaW5kKCk7DQogICAgDQogICAgfTsNCiAgICANCiAgICBjbGFzcyBOb2RlX0NvbnRleHR7DQogICAgICAgIHB1YmxpYzoNCiAgICAgICAgICAgIE5vZGVfQ29udGV4dCgpew0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgIH5Ob2RlX0NvbnRleHQoKXsNCiAgICAgICAgICAgICAgICAvLyBmb3IgZXZlcnkgIm5ldyIgdGhlcmUgbXVzdCBiZSBhICJkZWxldGUiDQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICBwcml2YXRlOg0KICAgICAgICAgICAgdW5zaWduZWQgbG9uZyBJZDsNCg0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBOb2RlX0NvbnRleHQuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgcHJpdmF0ZToNCiAgICAgICAgICAgIGJvb2wgX2FjdGl2ZTsNCiAgICAgICAgICAgIA0KICAgICAgICBwdWJsaWM6DQogICAgICAgICAgICBib29sIGFjdGl2ZSgpOw0KICAgICAgICAgICAgTm9kZV9Db250ZXh0JiBhY3RpdmUoYm9vbCB2KTsNCiAgICAgICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE5vZGVfQ29udGV4dC5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBOb2RlX0NvbnRleHQuZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHByaXZhdGU6DQogICAgICAgICAgICBib29sIF9lbmFibGVkOw0KICAgICAgICAgICAgDQogICAgICAgIHB1YmxpYzoNCiAgICAgICAgICAgIGJvb2wgZW5hYmxlZCgpOw0KICAgICAgICAgICAgTm9kZV9Db250ZXh0JiBlbmFibGVkKGJvb2wgdik7DQogICAgICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBOb2RlX0NvbnRleHQuZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE5vZGVfQ29udGV4dC5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgcHJpdmF0ZToNCiAgICAgICAgICAgIHN0ZDo6c3RyaW5nIF9jb2RlOw0KICAgICAgICAgICAgDQogICAgICAgIHB1YmxpYzoNCiAgICAgICAgICAgIHN0ZDo6c3RyaW5nIGNvZGUoKTsNCiAgICAgICAgICAgIE5vZGVfQ29udGV4dCYgY29kZShzdGQ6OnN0cmluZyB2KTsNCiAgICAgICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE5vZGVfQ29udGV4dC5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTm9kZV9Db250ZXh0Lm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgcHJpdmF0ZToNCiAgICAgICAgICAgIGludCBfb3JkZXI7DQogICAgICAgICAgICANCiAgICAgICAgcHVibGljOg0KICAgICAgICAgICAgaW50IG9yZGVyKCk7DQogICAgICAgICAgICBOb2RlX0NvbnRleHQmIG9yZGVyKGludCB2KTsNCiAgICAgICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE5vZGVfQ29udGV4dC5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE5vZGVfQ29udGV4dC5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgcHJpdmF0ZToNCiAgICAgICAgICAgIHRpbWVfdCBfZGF0ZTsNCiAgICAgICAgICAgIA0KICAgICAgICBwdWJsaWM6DQogICAgICAgICAgICB0aW1lX3QgZGF0ZSgpOw0KICAgICAgICAgICAgTm9kZV9Db250ZXh0JiBkYXRlKHRpbWVfdCB2KTsNCiAgICAgICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE5vZGVfQ29udGV4dC5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTm9kZV9Db250ZXh0Lm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBwcml2YXRlOg0KICAgICAgICAgICAgc3RkOjpzdHJpbmcgX25hbWU7DQogICAgICAgICAgICANCiAgICAgICAgcHVibGljOg0KICAgICAgICAgICAgc3RkOjpzdHJpbmcgbmFtZSgpOw0KICAgICAgICAgICAgTm9kZV9Db250ZXh0JiBuYW1lKHN0ZDo6c3RyaW5nIHYpOw0KICAgICAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTm9kZV9Db250ZXh0Lm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBOb2RlX0NvbnRleHQucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgcHJpdmF0ZToNCiAgICAgICAgICAgIHN0ZDo6c3RyaW5nIF9yZW1hcms7DQogICAgICAgICAgICANCiAgICAgICAgcHVibGljOg0KICAgICAgICAgICAgc3RkOjpzdHJpbmcgcmVtYXJrKCk7DQogICAgICAgICAgICBOb2RlX0NvbnRleHQmIHJlbWFyayhzdGQ6OnN0cmluZyB2KTsNCiAgICAgICAgDQogICAgICAgICAgICBOb2RlX0NvbnRleHQmIHJlbWFyayhqc29uIHYpOw0KICAgICAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTm9kZV9Db250ZXh0LnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgDQoNCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTm9kZV9Db250ZXh0LmNvbnRleHRfTm9kZXMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KDQogICAgICAgIHByaXZhdGU6DQogICAgICAgICAgICBzdGQ6OnZlY3RvcjxzdGQ6OmFueT4qIF9jb250ZXh0X05vZGVzOw0KICAgICAgICANCiAgICAgICAgcHVibGljOg0KICAgICAgICAgICAgc3RkOjp2ZWN0b3I8c3RkOjphbnk+JiYgY29udGV4dF9Ob2RlcygpOw0KICAgICAgICAgICAgTm9kZV9Db250ZXh0JiBjb250ZXh0X05vZGVzKHN0ZDo6dmVjdG9yPHN0ZDo6YW55PiYmIHYpOw0KICAgICAgICAvKioqKioqKioqKioqKiBOb2RlX0NvbnRleHQuY29udGV4dF9Ob2RlcyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgDQoNCiAgICAgICAgcHVibGljOg0KICAgICAgICAgICAgTm9kZV9Db250ZXh0JiBfdW5pcXVlKCk7DQogICAgICAgICAgICBzdGQ6OnN0cmluZyBfdG9Eb2N1bWVudCgpOw0KICAgICAgICAgICAgTm9kZV9Db250ZXh0JiBfZnJvbURvY3VtZW50KHVuc2lnbmVkIGNoYXIqIG9iaik7DQogICAgICAgICAgICBOb2RlX0NvbnRleHQmIF9mcm9tRG9jdW1lbnQoc3RkOjpzdHJpbmcgb2JqKTsNCiAgICAgICAgICAgIE5vZGVfQ29udGV4dCYgX2Zyb21Eb2N1bWVudChqc29uIG9iaik7DQogICAgICAgICAgICBzdGQ6OnZlY3RvcjxOb2RlX0NvbnRleHQ+JiYgX2Zyb21Eb2N1bWVudChzdGQ6OnZlY3Rvcjxqc29uPiYmIG9iaik7DQogICAgDQogICAgICAgIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZV9Db250ZXh0JiBzdG9yZSgpOw0KICAgIA0KICAgICAgICBzdGQ6OnZlY3Rvcjxlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGVfQ29udGV4dD4mIGZpbmRBbGwoKTsNCiAgICANCiAgICAgICAgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlX0NvbnRleHQmIGZpbmQoKTsNCiAgICANCiAgICB9Ow0KICAgIA0KICAgIGNsYXNzIE5vZGVfR3JvdXB7DQogICAgICAgIHB1YmxpYzoNCiAgICAgICAgICAgIE5vZGVfR3JvdXAoKXsNCiAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICB+Tm9kZV9Hcm91cCgpew0KICAgICAgICAgICAgICAgIC8vIGZvciBldmVyeSAibmV3IiB0aGVyZSBtdXN0IGJlIGEgImRlbGV0ZSINCiAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIHByaXZhdGU6DQogICAgICAgICAgICB1bnNpZ25lZCBsb25nIElkOw0KDQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE5vZGVfR3JvdXAuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgcHJpdmF0ZToNCiAgICAgICAgICAgIGJvb2wgX2FjdGl2ZTsNCiAgICAgICAgICAgIA0KICAgICAgICBwdWJsaWM6DQogICAgICAgICAgICBib29sIGFjdGl2ZSgpOw0KICAgICAgICAgICAgTm9kZV9Hcm91cCYgYWN0aXZlKGJvb2wgdik7DQogICAgICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBOb2RlX0dyb3VwLmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE5vZGVfR3JvdXAuZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHByaXZhdGU6DQogICAgICAgICAgICBib29sIF9lbmFibGVkOw0KICAgICAgICAgICAgDQogICAgICAgIHB1YmxpYzoNCiAgICAgICAgICAgIGJvb2wgZW5hYmxlZCgpOw0KICAgICAgICAgICAgTm9kZV9Hcm91cCYgZW5hYmxlZChib29sIHYpOw0KICAgICAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTm9kZV9Hcm91cC5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTm9kZV9Hcm91cC5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgcHJpdmF0ZToNCiAgICAgICAgICAgIHN0ZDo6c3RyaW5nIF9jb2RlOw0KICAgICAgICAgICAgDQogICAgICAgIHB1YmxpYzoNCiAgICAgICAgICAgIHN0ZDo6c3RyaW5nIGNvZGUoKTsNCiAgICAgICAgICAgIE5vZGVfR3JvdXAmIGNvZGUoc3RkOjpzdHJpbmcgdik7DQogICAgICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBOb2RlX0dyb3VwLmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBOb2RlX0dyb3VwLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgcHJpdmF0ZToNCiAgICAgICAgICAgIGludCBfb3JkZXI7DQogICAgICAgICAgICANCiAgICAgICAgcHVibGljOg0KICAgICAgICAgICAgaW50IG9yZGVyKCk7DQogICAgICAgICAgICBOb2RlX0dyb3VwJiBvcmRlcihpbnQgdik7DQogICAgICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBOb2RlX0dyb3VwLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTm9kZV9Hcm91cC5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgcHJpdmF0ZToNCiAgICAgICAgICAgIHRpbWVfdCBfZGF0ZTsNCiAgICAgICAgICAgIA0KICAgICAgICBwdWJsaWM6DQogICAgICAgICAgICB0aW1lX3QgZGF0ZSgpOw0KICAgICAgICAgICAgTm9kZV9Hcm91cCYgZGF0ZSh0aW1lX3Qgdik7DQogICAgICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBOb2RlX0dyb3VwLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBOb2RlX0dyb3VwLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBwcml2YXRlOg0KICAgICAgICAgICAgc3RkOjpzdHJpbmcgX25hbWU7DQogICAgICAgICAgICANCiAgICAgICAgcHVibGljOg0KICAgICAgICAgICAgc3RkOjpzdHJpbmcgbmFtZSgpOw0KICAgICAgICAgICAgTm9kZV9Hcm91cCYgbmFtZShzdGQ6OnN0cmluZyB2KTsNCiAgICAgICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE5vZGVfR3JvdXAubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE5vZGVfR3JvdXAucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgcHJpdmF0ZToNCiAgICAgICAgICAgIHN0ZDo6c3RyaW5nIF9yZW1hcms7DQogICAgICAgICAgICANCiAgICAgICAgcHVibGljOg0KICAgICAgICAgICAgc3RkOjpzdHJpbmcgcmVtYXJrKCk7DQogICAgICAgICAgICBOb2RlX0dyb3VwJiByZW1hcmsoc3RkOjpzdHJpbmcgdik7DQogICAgICAgIA0KICAgICAgICAgICAgTm9kZV9Hcm91cCYgcmVtYXJrKGpzb24gdik7DQogICAgICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBOb2RlX0dyb3VwLnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgDQoNCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTm9kZV9Hcm91cC5ncm91cF9Ob2RlcyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQoNCiAgICAgICAgcHJpdmF0ZToNCiAgICAgICAgICAgIHN0ZDo6dmVjdG9yPHN0ZDo6YW55PiogX2dyb3VwX05vZGVzOw0KICAgICAgICANCiAgICAgICAgcHVibGljOg0KICAgICAgICAgICAgc3RkOjp2ZWN0b3I8c3RkOjphbnk+JiYgZ3JvdXBfTm9kZXMoKTsNCiAgICAgICAgICAgIE5vZGVfR3JvdXAmIGdyb3VwX05vZGVzKHN0ZDo6dmVjdG9yPHN0ZDo6YW55PiYmIHYpOw0KICAgICAgICAvKioqKioqKioqKioqKiBOb2RlX0dyb3VwLmdyb3VwX05vZGVzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICANCg0KICAgICAgICBwdWJsaWM6DQogICAgICAgICAgICBOb2RlX0dyb3VwJiBfdW5pcXVlKCk7DQogICAgICAgICAgICBzdGQ6OnN0cmluZyBfdG9Eb2N1bWVudCgpOw0KICAgICAgICAgICAgTm9kZV9Hcm91cCYgX2Zyb21Eb2N1bWVudCh1bnNpZ25lZCBjaGFyKiBvYmopOw0KICAgICAgICAgICAgTm9kZV9Hcm91cCYgX2Zyb21Eb2N1bWVudChzdGQ6OnN0cmluZyBvYmopOw0KICAgICAgICAgICAgTm9kZV9Hcm91cCYgX2Zyb21Eb2N1bWVudChqc29uIG9iaik7DQogICAgICAgICAgICBzdGQ6OnZlY3RvcjxOb2RlX0dyb3VwPiYmIF9mcm9tRG9jdW1lbnQoc3RkOjp2ZWN0b3I8anNvbj4mJiBvYmopOw0KICAgIA0KICAgICAgICBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGVfR3JvdXAmIHN0b3JlKCk7DQogICAgDQogICAgICAgIHN0ZDo6dmVjdG9yPGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZV9Hcm91cD4mIGZpbmRBbGwoKTsNCiAgICANCiAgICAgICAgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlX0dyb3VwJiBmaW5kKCk7DQogICAgDQogICAgfTsNCiAgICANCiAgICBjbGFzcyBOb2RlX1R5cGV7DQogICAgICAgIHB1YmxpYzoNCiAgICAgICAgICAgIE5vZGVfVHlwZSgpew0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgIH5Ob2RlX1R5cGUoKXsNCiAgICAgICAgICAgICAgICAvLyBmb3IgZXZlcnkgIm5ldyIgdGhlcmUgbXVzdCBiZSBhICJkZWxldGUiDQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICBwcml2YXRlOg0KICAgICAgICAgICAgdW5zaWduZWQgbG9uZyBJZDsNCg0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBOb2RlX1R5cGUuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgcHJpdmF0ZToNCiAgICAgICAgICAgIGJvb2wgX2FjdGl2ZTsNCiAgICAgICAgICAgIA0KICAgICAgICBwdWJsaWM6DQogICAgICAgICAgICBib29sIGFjdGl2ZSgpOw0KICAgICAgICAgICAgTm9kZV9UeXBlJiBhY3RpdmUoYm9vbCB2KTsNCiAgICAgICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE5vZGVfVHlwZS5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBOb2RlX1R5cGUuZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHByaXZhdGU6DQogICAgICAgICAgICBib29sIF9lbmFibGVkOw0KICAgICAgICAgICAgDQogICAgICAgIHB1YmxpYzoNCiAgICAgICAgICAgIGJvb2wgZW5hYmxlZCgpOw0KICAgICAgICAgICAgTm9kZV9UeXBlJiBlbmFibGVkKGJvb2wgdik7DQogICAgICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBOb2RlX1R5cGUuZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE5vZGVfVHlwZS5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgcHJpdmF0ZToNCiAgICAgICAgICAgIHN0ZDo6c3RyaW5nIF9jb2RlOw0KICAgICAgICAgICAgDQogICAgICAgIHB1YmxpYzoNCiAgICAgICAgICAgIHN0ZDo6c3RyaW5nIGNvZGUoKTsNCiAgICAgICAgICAgIE5vZGVfVHlwZSYgY29kZShzdGQ6OnN0cmluZyB2KTsNCiAgICAgICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE5vZGVfVHlwZS5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTm9kZV9UeXBlLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgcHJpdmF0ZToNCiAgICAgICAgICAgIGludCBfb3JkZXI7DQogICAgICAgICAgICANCiAgICAgICAgcHVibGljOg0KICAgICAgICAgICAgaW50IG9yZGVyKCk7DQogICAgICAgICAgICBOb2RlX1R5cGUmIG9yZGVyKGludCB2KTsNCiAgICAgICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE5vZGVfVHlwZS5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE5vZGVfVHlwZS5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgcHJpdmF0ZToNCiAgICAgICAgICAgIHRpbWVfdCBfZGF0ZTsNCiAgICAgICAgICAgIA0KICAgICAgICBwdWJsaWM6DQogICAgICAgICAgICB0aW1lX3QgZGF0ZSgpOw0KICAgICAgICAgICAgTm9kZV9UeXBlJiBkYXRlKHRpbWVfdCB2KTsNCiAgICAgICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE5vZGVfVHlwZS5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTm9kZV9UeXBlLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBwcml2YXRlOg0KICAgICAgICAgICAgc3RkOjpzdHJpbmcgX25hbWU7DQogICAgICAgICAgICANCiAgICAgICAgcHVibGljOg0KICAgICAgICAgICAgc3RkOjpzdHJpbmcgbmFtZSgpOw0KICAgICAgICAgICAgTm9kZV9UeXBlJiBuYW1lKHN0ZDo6c3RyaW5nIHYpOw0KICAgICAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTm9kZV9UeXBlLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBOb2RlX1R5cGUucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgcHJpdmF0ZToNCiAgICAgICAgICAgIHN0ZDo6c3RyaW5nIF9yZW1hcms7DQogICAgICAgICAgICANCiAgICAgICAgcHVibGljOg0KICAgICAgICAgICAgc3RkOjpzdHJpbmcgcmVtYXJrKCk7DQogICAgICAgICAgICBOb2RlX1R5cGUmIHJlbWFyayhzdGQ6OnN0cmluZyB2KTsNCiAgICAgICAgDQogICAgICAgICAgICBOb2RlX1R5cGUmIHJlbWFyayhqc29uIHYpOw0KICAgICAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTm9kZV9UeXBlLnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE5vZGVfVHlwZS5keW5hbWljIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgcHJpdmF0ZToNCiAgICAgICAgICAgIGJvb2wgX2R5bmFtaWM7DQogICAgICAgICAgICANCiAgICAgICAgcHVibGljOg0KICAgICAgICAgICAgYm9vbCBkeW5hbWljKCk7DQogICAgICAgICAgICBOb2RlX1R5cGUmIGR5bmFtaWMoYm9vbCB2KTsNCiAgICAgICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE5vZGVfVHlwZS5keW5hbWljIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICANCg0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBOb2RlX1R5cGUudHlwZV9Ob2RlcyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQoNCiAgICAgICAgcHJpdmF0ZToNCiAgICAgICAgICAgIHN0ZDo6dmVjdG9yPHN0ZDo6YW55PiogX3R5cGVfTm9kZXM7DQogICAgICAgIA0KICAgICAgICBwdWJsaWM6DQogICAgICAgICAgICBzdGQ6OnZlY3RvcjxzdGQ6OmFueT4mJiB0eXBlX05vZGVzKCk7DQogICAgICAgICAgICBOb2RlX1R5cGUmIHR5cGVfTm9kZXMoc3RkOjp2ZWN0b3I8c3RkOjphbnk+JiYgdik7DQogICAgICAgIC8qKioqKioqKioqKioqIE5vZGVfVHlwZS50eXBlX05vZGVzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICANCg0KICAgICAgICBwdWJsaWM6DQogICAgICAgICAgICBOb2RlX1R5cGUmIF91bmlxdWUoKTsNCiAgICAgICAgICAgIHN0ZDo6c3RyaW5nIF90b0RvY3VtZW50KCk7DQogICAgICAgICAgICBOb2RlX1R5cGUmIF9mcm9tRG9jdW1lbnQodW5zaWduZWQgY2hhciogb2JqKTsNCiAgICAgICAgICAgIE5vZGVfVHlwZSYgX2Zyb21Eb2N1bWVudChzdGQ6OnN0cmluZyBvYmopOw0KICAgICAgICAgICAgTm9kZV9UeXBlJiBfZnJvbURvY3VtZW50KGpzb24gb2JqKTsNCiAgICAgICAgICAgIHN0ZDo6dmVjdG9yPE5vZGVfVHlwZT4mJiBfZnJvbURvY3VtZW50KHN0ZDo6dmVjdG9yPGpzb24+JiYgb2JqKTsNCiAgICANCiAgICAgICAgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlX1R5cGUmIHN0b3JlKCk7DQogICAgDQogICAgICAgIHN0ZDo6dmVjdG9yPGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZV9UeXBlPiYgZmluZEFsbCgpOw0KICAgIA0KICAgICAgICBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGVfVHlwZSYgZmluZCgpOw0KICAgIA0KICAgIH07DQogICAgDQogICAgY2xhc3MgVG9vbHsNCiAgICAgICAgcHVibGljOg0KICAgICAgICAgICAgVG9vbCgpew0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgIH5Ub29sKCl7DQogICAgICAgICAgICAgICAgLy8gZm9yIGV2ZXJ5ICJuZXciIHRoZXJlIG11c3QgYmUgYSAiZGVsZXRlIg0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgcHJpdmF0ZToNCiAgICAgICAgICAgIHVuc2lnbmVkIGxvbmcgSWQ7DQoNCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogVG9vbC5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBwcml2YXRlOg0KICAgICAgICAgICAgYm9vbCBfYWN0aXZlOw0KICAgICAgICAgICAgDQogICAgICAgIHB1YmxpYzoNCiAgICAgICAgICAgIGJvb2wgYWN0aXZlKCk7DQogICAgICAgICAgICBUb29sJiBhY3RpdmUoYm9vbCB2KTsNCiAgICAgICAgDQogICAgICAgIC8qKioqKioqKioqKioqIFRvb2wuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogVG9vbC5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgcHJpdmF0ZToNCiAgICAgICAgICAgIGJvb2wgX2VuYWJsZWQ7DQogICAgICAgICAgICANCiAgICAgICAgcHVibGljOg0KICAgICAgICAgICAgYm9vbCBlbmFibGVkKCk7DQogICAgICAgICAgICBUb29sJiBlbmFibGVkKGJvb2wgdik7DQogICAgICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBUb29sLmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBUb29sLmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBwcml2YXRlOg0KICAgICAgICAgICAgc3RkOjpzdHJpbmcgX2NvZGU7DQogICAgICAgICAgICANCiAgICAgICAgcHVibGljOg0KICAgICAgICAgICAgc3RkOjpzdHJpbmcgY29kZSgpOw0KICAgICAgICAgICAgVG9vbCYgY29kZShzdGQ6OnN0cmluZyB2KTsNCiAgICAgICAgDQogICAgICAgIC8qKioqKioqKioqKioqIFRvb2wuY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIFRvb2wub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBwcml2YXRlOg0KICAgICAgICAgICAgaW50IF9vcmRlcjsNCiAgICAgICAgICAgIA0KICAgICAgICBwdWJsaWM6DQogICAgICAgICAgICBpbnQgb3JkZXIoKTsNCiAgICAgICAgICAgIFRvb2wmIG9yZGVyKGludCB2KTsNCiAgICAgICAgDQogICAgICAgIC8qKioqKioqKioqKioqIFRvb2wub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBUb29sLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBwcml2YXRlOg0KICAgICAgICAgICAgdGltZV90IF9kYXRlOw0KICAgICAgICAgICAgDQogICAgICAgIHB1YmxpYzoNCiAgICAgICAgICAgIHRpbWVfdCBkYXRlKCk7DQogICAgICAgICAgICBUb29sJiBkYXRlKHRpbWVfdCB2KTsNCiAgICAgICAgDQogICAgICAgIC8qKioqKioqKioqKioqIFRvb2wuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIFRvb2wubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHByaXZhdGU6DQogICAgICAgICAgICBzdGQ6OnN0cmluZyBfbmFtZTsNCiAgICAgICAgICAgIA0KICAgICAgICBwdWJsaWM6DQogICAgICAgICAgICBzdGQ6OnN0cmluZyBuYW1lKCk7DQogICAgICAgICAgICBUb29sJiBuYW1lKHN0ZDo6c3RyaW5nIHYpOw0KICAgICAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogVG9vbC5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogVG9vbC5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBwcml2YXRlOg0KICAgICAgICAgICAgc3RkOjpzdHJpbmcgX3JlbWFyazsNCiAgICAgICAgICAgIA0KICAgICAgICBwdWJsaWM6DQogICAgICAgICAgICBzdGQ6OnN0cmluZyByZW1hcmsoKTsNCiAgICAgICAgICAgIFRvb2wmIHJlbWFyayhzdGQ6OnN0cmluZyB2KTsNCiAgICAgICAgDQogICAgICAgICAgICBUb29sJiByZW1hcmsoanNvbiB2KTsNCiAgICAgICAgDQogICAgICAgIC8qKioqKioqKioqKioqIFRvb2wucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogVG9vbC50eXBlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgcHJpdmF0ZToNCiAgICAgICAgICAgIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6VG9vbF9UeXBlKiBfdHlwZTsNCiAgICAgICAgICAgIA0KICAgICAgICBwdWJsaWM6DQogICAgICAgICAgICBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OlRvb2xfVHlwZSogdHlwZSgpOw0KICAgICAgICAgICAgVG9vbCYgdHlwZShlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OlRvb2xfVHlwZSYgdik7DQogICAgICAgIA0KICAgICAgICAgICAgVG9vbCYgdHlwZShlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OlRvb2xfVHlwZSogdik7DQogICAgICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBUb29sLnR5cGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgIA0KDQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIFRvb2wudG9vbF9Db25maWdzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCg0KICAgICAgICBwcml2YXRlOg0KICAgICAgICAgICAgc3RkOjp2ZWN0b3I8c3RkOjphbnk+KiBfdG9vbF9Db25maWdzOw0KICAgICAgICANCiAgICAgICAgcHVibGljOg0KICAgICAgICAgICAgc3RkOjp2ZWN0b3I8c3RkOjphbnk+JiYgdG9vbF9Db25maWdzKCk7DQogICAgICAgICAgICBUb29sJiB0b29sX0NvbmZpZ3Moc3RkOjp2ZWN0b3I8c3RkOjphbnk+JiYgdik7DQogICAgICAgIC8qKioqKioqKioqKioqIFRvb2wudG9vbF9Db25maWdzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogVG9vbC50b29sX01hcHBpbmdzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCg0KICAgICAgICBwcml2YXRlOg0KICAgICAgICAgICAgc3RkOjp2ZWN0b3I8c3RkOjphbnk+KiBfdG9vbF9NYXBwaW5nczsNCiAgICAgICAgDQogICAgICAgIHB1YmxpYzoNCiAgICAgICAgICAgIHN0ZDo6dmVjdG9yPHN0ZDo6YW55PiYmIHRvb2xfTWFwcGluZ3MoKTsNCiAgICAgICAgICAgIFRvb2wmIHRvb2xfTWFwcGluZ3Moc3RkOjp2ZWN0b3I8c3RkOjphbnk+JiYgdik7DQogICAgICAgIC8qKioqKioqKioqKioqIFRvb2wudG9vbF9NYXBwaW5ncyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgDQoNCiAgICAgICAgcHVibGljOg0KICAgICAgICAgICAgVG9vbCYgX3VuaXF1ZSgpOw0KICAgICAgICAgICAgc3RkOjpzdHJpbmcgX3RvRG9jdW1lbnQoKTsNCiAgICAgICAgICAgIFRvb2wmIF9mcm9tRG9jdW1lbnQodW5zaWduZWQgY2hhciogb2JqKTsNCiAgICAgICAgICAgIFRvb2wmIF9mcm9tRG9jdW1lbnQoc3RkOjpzdHJpbmcgb2JqKTsNCiAgICAgICAgICAgIFRvb2wmIF9mcm9tRG9jdW1lbnQoanNvbiBvYmopOw0KICAgICAgICAgICAgc3RkOjp2ZWN0b3I8VG9vbD4mJiBfZnJvbURvY3VtZW50KHN0ZDo6dmVjdG9yPGpzb24+JiYgb2JqKTsNCiAgICANCiAgICAgICAgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpUb29sJiBzdG9yZSgpOw0KICAgIA0KICAgICAgICBzdGQ6OnZlY3Rvcjxlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OlRvb2w+JiBmaW5kQWxsKCk7DQogICAgDQogICAgICAgIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6VG9vbCYgZmluZCgpOw0KICAgIA0KICAgIH07DQogICAgDQogICAgY2xhc3MgTWFwcGluZ3sNCiAgICAgICAgcHVibGljOg0KICAgICAgICAgICAgTWFwcGluZygpew0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgIH5NYXBwaW5nKCl7DQogICAgICAgICAgICAgICAgLy8gZm9yIGV2ZXJ5ICJuZXciIHRoZXJlIG11c3QgYmUgYSAiZGVsZXRlIg0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgcHJpdmF0ZToNCiAgICAgICAgICAgIHVuc2lnbmVkIGxvbmcgSWQ7DQoNCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTWFwcGluZy5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBwcml2YXRlOg0KICAgICAgICAgICAgYm9vbCBfYWN0aXZlOw0KICAgICAgICAgICAgDQogICAgICAgIHB1YmxpYzoNCiAgICAgICAgICAgIGJvb2wgYWN0aXZlKCk7DQogICAgICAgICAgICBNYXBwaW5nJiBhY3RpdmUoYm9vbCB2KTsNCiAgICAgICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE1hcHBpbmcuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTWFwcGluZy5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgcHJpdmF0ZToNCiAgICAgICAgICAgIGJvb2wgX2VuYWJsZWQ7DQogICAgICAgICAgICANCiAgICAgICAgcHVibGljOg0KICAgICAgICAgICAgYm9vbCBlbmFibGVkKCk7DQogICAgICAgICAgICBNYXBwaW5nJiBlbmFibGVkKGJvb2wgdik7DQogICAgICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBNYXBwaW5nLmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBNYXBwaW5nLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgcHJpdmF0ZToNCiAgICAgICAgICAgIGludCBfb3JkZXI7DQogICAgICAgICAgICANCiAgICAgICAgcHVibGljOg0KICAgICAgICAgICAgaW50IG9yZGVyKCk7DQogICAgICAgICAgICBNYXBwaW5nJiBvcmRlcihpbnQgdik7DQogICAgICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBNYXBwaW5nLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTWFwcGluZy5jbGFzc05hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBwcml2YXRlOg0KICAgICAgICAgICAgc3RkOjpzdHJpbmcgX2NsYXNzTmFtZTsNCiAgICAgICAgICAgIA0KICAgICAgICBwdWJsaWM6DQogICAgICAgICAgICBzdGQ6OnN0cmluZyBjbGFzc05hbWUoKTsNCiAgICAgICAgICAgIE1hcHBpbmcmIGNsYXNzTmFtZShzdGQ6OnN0cmluZyB2KTsNCiAgICAgICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE1hcHBpbmcuY2xhc3NOYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTWFwcGluZy5zY29wZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHByaXZhdGU6DQogICAgICAgICAgICBzdGQ6OnN0cmluZyBfc2NvcGU7DQogICAgICAgICAgICANCiAgICAgICAgcHVibGljOg0KICAgICAgICAgICAgc3RkOjpzdHJpbmcgc2NvcGUoKTsNCiAgICAgICAgICAgIE1hcHBpbmcmIHNjb3BlKHN0ZDo6c3RyaW5nIHYpOw0KICAgICAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTWFwcGluZy5zY29wZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE1hcHBpbmcuY29udGV4dCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHByaXZhdGU6DQogICAgICAgICAgICBzdGQ6OnN0cmluZyBfY29udGV4dDsNCiAgICAgICAgICAgIA0KICAgICAgICBwdWJsaWM6DQogICAgICAgICAgICBzdGQ6OnN0cmluZyBjb250ZXh0KCk7DQogICAgICAgICAgICBNYXBwaW5nJiBjb250ZXh0KHN0ZDo6c3RyaW5nIHYpOw0KICAgICAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTWFwcGluZy5jb250ZXh0IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTWFwcGluZy5zb3VyY2UgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBwcml2YXRlOg0KICAgICAgICAgICAgc3RkOjpzdHJpbmcgX3NvdXJjZTsNCiAgICAgICAgICAgIA0KICAgICAgICBwdWJsaWM6DQogICAgICAgICAgICBzdGQ6OnN0cmluZyBzb3VyY2UoKTsNCiAgICAgICAgICAgIE1hcHBpbmcmIHNvdXJjZShzdGQ6OnN0cmluZyB2KTsNCiAgICAgICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE1hcHBpbmcuc291cmNlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTWFwcGluZy50YXJnZXQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBwcml2YXRlOg0KICAgICAgICAgICAgc3RkOjpzdHJpbmcgX3RhcmdldDsNCiAgICAgICAgICAgIA0KICAgICAgICBwdWJsaWM6DQogICAgICAgICAgICBzdGQ6OnN0cmluZyB0YXJnZXQoKTsNCiAgICAgICAgICAgIE1hcHBpbmcmIHRhcmdldChzdGQ6OnN0cmluZyB2KTsNCiAgICAgICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE1hcHBpbmcudGFyZ2V0IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTWFwcGluZy5pblNjcmlwdCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHByaXZhdGU6DQogICAgICAgICAgICBzdGQ6OnN0cmluZyBfaW5TY3JpcHQ7DQogICAgICAgICAgICANCiAgICAgICAgcHVibGljOg0KICAgICAgICAgICAgc3RkOjpzdHJpbmcgaW5TY3JpcHQoKTsNCiAgICAgICAgICAgIE1hcHBpbmcmIGluU2NyaXB0KHN0ZDo6c3RyaW5nIHYpOw0KICAgICAgICANCiAgICAgICAgICAgIE1hcHBpbmcmIGluU2NyaXB0KGpzb24gdik7DQogICAgICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBNYXBwaW5nLmluU2NyaXB0IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTWFwcGluZy5vdXRTY3JpcHQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBwcml2YXRlOg0KICAgICAgICAgICAgc3RkOjpzdHJpbmcgX291dFNjcmlwdDsNCiAgICAgICAgICAgIA0KICAgICAgICBwdWJsaWM6DQogICAgICAgICAgICBzdGQ6OnN0cmluZyBvdXRTY3JpcHQoKTsNCiAgICAgICAgICAgIE1hcHBpbmcmIG91dFNjcmlwdChzdGQ6OnN0cmluZyB2KTsNCiAgICAgICAgDQogICAgICAgICAgICBNYXBwaW5nJiBvdXRTY3JpcHQoanNvbiB2KTsNCiAgICAgICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE1hcHBpbmcub3V0U2NyaXB0IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTWFwcGluZy50b29sIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgcHJpdmF0ZToNCiAgICAgICAgICAgIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6VG9vbCogX3Rvb2w7DQogICAgICAgICAgICANCiAgICAgICAgcHVibGljOg0KICAgICAgICAgICAgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpUb29sKiB0b29sKCk7DQogICAgICAgICAgICBNYXBwaW5nJiB0b29sKGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6VG9vbCYgdik7DQogICAgICAgIA0KICAgICAgICAgICAgTWFwcGluZyYgdG9vbChlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OlRvb2wqIHYpOw0KICAgICAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTWFwcGluZy50b29sIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTWFwcGluZy5ncm91cCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHByaXZhdGU6DQogICAgICAgICAgICBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkNvbmZpZ19Hcm91cCogX2dyb3VwOw0KICAgICAgICAgICAgDQogICAgICAgIHB1YmxpYzoNCiAgICAgICAgICAgIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Q29uZmlnX0dyb3VwKiBncm91cCgpOw0KICAgICAgICAgICAgTWFwcGluZyYgZ3JvdXAoZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpDb25maWdfR3JvdXAmIHYpOw0KICAgICAgICANCiAgICAgICAgICAgIE1hcHBpbmcmIGdyb3VwKGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Q29uZmlnX0dyb3VwKiB2KTsNCiAgICAgICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE1hcHBpbmcuZ3JvdXAgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBNYXBwaW5nLnR5cGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBwcml2YXRlOg0KICAgICAgICAgICAgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpUb29sX1R5cGUqIF90eXBlOw0KICAgICAgICAgICAgDQogICAgICAgIHB1YmxpYzoNCiAgICAgICAgICAgIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6VG9vbF9UeXBlKiB0eXBlKCk7DQogICAgICAgICAgICBNYXBwaW5nJiB0eXBlKGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6VG9vbF9UeXBlJiB2KTsNCiAgICAgICAgDQogICAgICAgICAgICBNYXBwaW5nJiB0eXBlKGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6VG9vbF9UeXBlKiB2KTsNCiAgICAgICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE1hcHBpbmcudHlwZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgDQoNCiAgICANCg0KICAgICAgICBwdWJsaWM6DQogICAgICAgICAgICBNYXBwaW5nJiBfdW5pcXVlKCk7DQogICAgICAgICAgICBzdGQ6OnN0cmluZyBfdG9Eb2N1bWVudCgpOw0KICAgICAgICAgICAgTWFwcGluZyYgX2Zyb21Eb2N1bWVudCh1bnNpZ25lZCBjaGFyKiBvYmopOw0KICAgICAgICAgICAgTWFwcGluZyYgX2Zyb21Eb2N1bWVudChzdGQ6OnN0cmluZyBvYmopOw0KICAgICAgICAgICAgTWFwcGluZyYgX2Zyb21Eb2N1bWVudChqc29uIG9iaik7DQogICAgICAgICAgICBzdGQ6OnZlY3RvcjxNYXBwaW5nPiYmIF9mcm9tRG9jdW1lbnQoc3RkOjp2ZWN0b3I8anNvbj4mJiBvYmopOw0KICAgIA0KICAgICAgICBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok1hcHBpbmcmIHN0b3JlKCk7DQogICAgDQogICAgICAgIHN0ZDo6dmVjdG9yPGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6TWFwcGluZz4mIGZpbmRBbGwoKTsNCiAgICANCiAgICAgICAgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpNYXBwaW5nJiBmaW5kKCk7DQogICAgDQogICAgfTsNCiAgICANCiAgICBjbGFzcyBOb2Rlew0KICAgICAgICBwdWJsaWM6DQogICAgICAgICAgICBOb2RlKCl7DQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgfk5vZGUoKXsNCiAgICAgICAgICAgICAgICAvLyBmb3IgZXZlcnkgIm5ldyIgdGhlcmUgbXVzdCBiZSBhICJkZWxldGUiDQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICBwcml2YXRlOg0KICAgICAgICAgICAgdW5zaWduZWQgbG9uZyBJZDsNCg0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBOb2RlLmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHByaXZhdGU6DQogICAgICAgICAgICBib29sIF9hY3RpdmU7DQogICAgICAgICAgICANCiAgICAgICAgcHVibGljOg0KICAgICAgICAgICAgYm9vbCBhY3RpdmUoKTsNCiAgICAgICAgICAgIE5vZGUmIGFjdGl2ZShib29sIHYpOw0KICAgICAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTm9kZS5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBOb2RlLmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBwcml2YXRlOg0KICAgICAgICAgICAgYm9vbCBfZW5hYmxlZDsNCiAgICAgICAgICAgIA0KICAgICAgICBwdWJsaWM6DQogICAgICAgICAgICBib29sIGVuYWJsZWQoKTsNCiAgICAgICAgICAgIE5vZGUmIGVuYWJsZWQoYm9vbCB2KTsNCiAgICAgICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE5vZGUuZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE5vZGUuY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHByaXZhdGU6DQogICAgICAgICAgICBzdGQ6OnN0cmluZyBfY29kZTsNCiAgICAgICAgICAgIA0KICAgICAgICBwdWJsaWM6DQogICAgICAgICAgICBzdGQ6OnN0cmluZyBjb2RlKCk7DQogICAgICAgICAgICBOb2RlJiBjb2RlKHN0ZDo6c3RyaW5nIHYpOw0KICAgICAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTm9kZS5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTm9kZS5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHByaXZhdGU6DQogICAgICAgICAgICBpbnQgX29yZGVyOw0KICAgICAgICAgICAgDQogICAgICAgIHB1YmxpYzoNCiAgICAgICAgICAgIGludCBvcmRlcigpOw0KICAgICAgICAgICAgTm9kZSYgb3JkZXIoaW50IHYpOw0KICAgICAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTm9kZS5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE5vZGUuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHByaXZhdGU6DQogICAgICAgICAgICB0aW1lX3QgX2RhdGU7DQogICAgICAgICAgICANCiAgICAgICAgcHVibGljOg0KICAgICAgICAgICAgdGltZV90IGRhdGUoKTsNCiAgICAgICAgICAgIE5vZGUmIGRhdGUodGltZV90IHYpOw0KICAgICAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTm9kZS5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTm9kZS5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgcHJpdmF0ZToNCiAgICAgICAgICAgIHN0ZDo6c3RyaW5nIF9uYW1lOw0KICAgICAgICAgICAgDQogICAgICAgIHB1YmxpYzoNCiAgICAgICAgICAgIHN0ZDo6c3RyaW5nIG5hbWUoKTsNCiAgICAgICAgICAgIE5vZGUmIG5hbWUoc3RkOjpzdHJpbmcgdik7DQogICAgICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBOb2RlLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBOb2RlLnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHByaXZhdGU6DQogICAgICAgICAgICBzdGQ6OnN0cmluZyBfcmVtYXJrOw0KICAgICAgICAgICAgDQogICAgICAgIHB1YmxpYzoNCiAgICAgICAgICAgIHN0ZDo6c3RyaW5nIHJlbWFyaygpOw0KICAgICAgICAgICAgTm9kZSYgcmVtYXJrKHN0ZDo6c3RyaW5nIHYpOw0KICAgICAgICANCiAgICAgICAgICAgIE5vZGUmIHJlbWFyayhqc29uIHYpOw0KICAgICAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTm9kZS5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBOb2RlLmFkZHJlc3MgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBwcml2YXRlOg0KICAgICAgICAgICAgc3RkOjpzdHJpbmcgX2FkZHJlc3M7DQogICAgICAgICAgICANCiAgICAgICAgcHVibGljOg0KICAgICAgICAgICAgc3RkOjpzdHJpbmcgYWRkcmVzcygpOw0KICAgICAgICAgICAgTm9kZSYgYWRkcmVzcyhzdGQ6OnN0cmluZyB2KTsNCiAgICAgICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE5vZGUuYWRkcmVzcyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE5vZGUuYmFja3VwIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgcHJpdmF0ZToNCiAgICAgICAgICAgIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZSogX2JhY2t1cDsNCiAgICAgICAgICAgIA0KICAgICAgICBwdWJsaWM6DQogICAgICAgICAgICBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGUqIGJhY2t1cCgpOw0KICAgICAgICAgICAgTm9kZSYgYmFja3VwKGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZSYgdik7DQogICAgICAgIA0KICAgICAgICAgICAgTm9kZSYgYmFja3VwKGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZSogdik7DQogICAgICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBOb2RlLmJhY2t1cCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE5vZGUucGFyZW50IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgcHJpdmF0ZToNCiAgICAgICAgICAgIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZSogX3BhcmVudDsNCiAgICAgICAgICAgIA0KICAgICAgICBwdWJsaWM6DQogICAgICAgICAgICBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGUqIHBhcmVudCgpOw0KICAgICAgICAgICAgTm9kZSYgcGFyZW50KGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZSYgdik7DQogICAgICAgIA0KICAgICAgICAgICAgTm9kZSYgcGFyZW50KGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZSogdik7DQogICAgICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBOb2RlLnBhcmVudCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE5vZGUuZ3JvdXAgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBwcml2YXRlOg0KICAgICAgICAgICAgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlX0dyb3VwKiBfZ3JvdXA7DQogICAgICAgICAgICANCiAgICAgICAgcHVibGljOg0KICAgICAgICAgICAgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlX0dyb3VwKiBncm91cCgpOw0KICAgICAgICAgICAgTm9kZSYgZ3JvdXAoZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlX0dyb3VwJiB2KTsNCiAgICAgICAgDQogICAgICAgICAgICBOb2RlJiBncm91cChlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGVfR3JvdXAqIHYpOw0KICAgICAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTm9kZS5ncm91cCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE5vZGUuY29udGV4dCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHByaXZhdGU6DQogICAgICAgICAgICBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGVfQ29udGV4dCogX2NvbnRleHQ7DQogICAgICAgICAgICANCiAgICAgICAgcHVibGljOg0KICAgICAgICAgICAgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlX0NvbnRleHQqIGNvbnRleHQoKTsNCiAgICAgICAgICAgIE5vZGUmIGNvbnRleHQoZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlX0NvbnRleHQmIHYpOw0KICAgICAgICANCiAgICAgICAgICAgIE5vZGUmIGNvbnRleHQoZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlX0NvbnRleHQqIHYpOw0KICAgICAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTm9kZS5jb250ZXh0IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTm9kZS5wb3J0IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgcHJpdmF0ZToNCiAgICAgICAgICAgIGludCBfcG9ydDsNCiAgICAgICAgICAgIA0KICAgICAgICBwdWJsaWM6DQogICAgICAgICAgICBpbnQgcG9ydCgpOw0KICAgICAgICAgICAgTm9kZSYgcG9ydChpbnQgdik7DQogICAgICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBOb2RlLnBvcnQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBOb2RlLm9ubGluZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHByaXZhdGU6DQogICAgICAgICAgICB0aW1lX3QgX29ubGluZTsNCiAgICAgICAgICAgIA0KICAgICAgICBwdWJsaWM6DQogICAgICAgICAgICB0aW1lX3Qgb25saW5lKCk7DQogICAgICAgICAgICBOb2RlJiBvbmxpbmUodGltZV90IHYpOw0KICAgICAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTm9kZS5vbmxpbmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBOb2RlLnNlY3VyZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHByaXZhdGU6DQogICAgICAgICAgICBib29sIF9zZWN1cmU7DQogICAgICAgICAgICANCiAgICAgICAgcHVibGljOg0KICAgICAgICAgICAgYm9vbCBzZWN1cmUoKTsNCiAgICAgICAgICAgIE5vZGUmIHNlY3VyZShib29sIHYpOw0KICAgICAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTm9kZS5zZWN1cmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBOb2RlLnR5cGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBwcml2YXRlOg0KICAgICAgICAgICAgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlX1R5cGUqIF90eXBlOw0KICAgICAgICAgICAgDQogICAgICAgIHB1YmxpYzoNCiAgICAgICAgICAgIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZV9UeXBlKiB0eXBlKCk7DQogICAgICAgICAgICBOb2RlJiB0eXBlKGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZV9UeXBlJiB2KTsNCiAgICAgICAgDQogICAgICAgICAgICBOb2RlJiB0eXBlKGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZV9UeXBlKiB2KTsNCiAgICAgICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE5vZGUudHlwZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgDQoNCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTm9kZS5jb250cm9sbGVyX0RldmljZXMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KDQogICAgICAgIHByaXZhdGU6DQogICAgICAgICAgICBzdGQ6OnZlY3RvcjxzdGQ6OmFueT4qIF9jb250cm9sbGVyX0RldmljZXM7DQogICAgICAgIA0KICAgICAgICBwdWJsaWM6DQogICAgICAgICAgICBzdGQ6OnZlY3RvcjxzdGQ6OmFueT4mJiBjb250cm9sbGVyX0RldmljZXMoKTsNCiAgICAgICAgICAgIE5vZGUmIGNvbnRyb2xsZXJfRGV2aWNlcyhzdGQ6OnZlY3RvcjxzdGQ6OmFueT4mJiB2KTsNCiAgICAgICAgLyoqKioqKioqKioqKiogTm9kZS5jb250cm9sbGVyX0RldmljZXMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBOb2RlLm5vZGVfQ29uZmlncyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQoNCiAgICAgICAgcHJpdmF0ZToNCiAgICAgICAgICAgIHN0ZDo6dmVjdG9yPHN0ZDo6YW55PiogX25vZGVfQ29uZmlnczsNCiAgICAgICAgDQogICAgICAgIHB1YmxpYzoNCiAgICAgICAgICAgIHN0ZDo6dmVjdG9yPHN0ZDo6YW55PiYmIG5vZGVfQ29uZmlncygpOw0KICAgICAgICAgICAgTm9kZSYgbm9kZV9Db25maWdzKHN0ZDo6dmVjdG9yPHN0ZDo6YW55PiYmIHYpOw0KICAgICAgICAvKioqKioqKioqKioqKiBOb2RlLm5vZGVfQ29uZmlncyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE5vZGUuY2Fycmllcl9FdmVudHMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KDQogICAgICAgIHByaXZhdGU6DQogICAgICAgICAgICBzdGQ6OnZlY3RvcjxzdGQ6OmFueT4qIF9jYXJyaWVyX0V2ZW50czsNCiAgICAgICAgDQogICAgICAgIHB1YmxpYzoNCiAgICAgICAgICAgIHN0ZDo6dmVjdG9yPHN0ZDo6YW55PiYmIGNhcnJpZXJfRXZlbnRzKCk7DQogICAgICAgICAgICBOb2RlJiBjYXJyaWVyX0V2ZW50cyhzdGQ6OnZlY3RvcjxzdGQ6OmFueT4mJiB2KTsNCiAgICAgICAgLyoqKioqKioqKioqKiogTm9kZS5jYXJyaWVyX0V2ZW50cyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE5vZGUuc2VuZGVyX0V2ZW50cyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQoNCiAgICAgICAgcHJpdmF0ZToNCiAgICAgICAgICAgIHN0ZDo6dmVjdG9yPHN0ZDo6YW55PiogX3NlbmRlcl9FdmVudHM7DQogICAgICAgIA0KICAgICAgICBwdWJsaWM6DQogICAgICAgICAgICBzdGQ6OnZlY3RvcjxzdGQ6OmFueT4mJiBzZW5kZXJfRXZlbnRzKCk7DQogICAgICAgICAgICBOb2RlJiBzZW5kZXJfRXZlbnRzKHN0ZDo6dmVjdG9yPHN0ZDo6YW55PiYmIHYpOw0KICAgICAgICAvKioqKioqKioqKioqKiBOb2RlLnNlbmRlcl9FdmVudHMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBOb2RlLnJlY2lwaWVudF9FdmVudHMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KDQogICAgICAgIHByaXZhdGU6DQogICAgICAgICAgICBzdGQ6OnZlY3RvcjxzdGQ6OmFueT4qIF9yZWNpcGllbnRfRXZlbnRzOw0KICAgICAgICANCiAgICAgICAgcHVibGljOg0KICAgICAgICAgICAgc3RkOjp2ZWN0b3I8c3RkOjphbnk+JiYgcmVjaXBpZW50X0V2ZW50cygpOw0KICAgICAgICAgICAgTm9kZSYgcmVjaXBpZW50X0V2ZW50cyhzdGQ6OnZlY3RvcjxzdGQ6OmFueT4mJiB2KTsNCiAgICAgICAgLyoqKioqKioqKioqKiogTm9kZS5yZWNpcGllbnRfRXZlbnRzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTm9kZS5iYWNrdXBfTm9kZXMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KDQogICAgICAgIHByaXZhdGU6DQogICAgICAgICAgICBzdGQ6OnZlY3RvcjxzdGQ6OmFueT4qIF9iYWNrdXBfTm9kZXM7DQogICAgICAgIA0KICAgICAgICBwdWJsaWM6DQogICAgICAgICAgICBzdGQ6OnZlY3RvcjxzdGQ6OmFueT4mJiBiYWNrdXBfTm9kZXMoKTsNCiAgICAgICAgICAgIE5vZGUmIGJhY2t1cF9Ob2RlcyhzdGQ6OnZlY3RvcjxzdGQ6OmFueT4mJiB2KTsNCiAgICAgICAgLyoqKioqKioqKioqKiogTm9kZS5iYWNrdXBfTm9kZXMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBOb2RlLnBhcmVudF9Ob2RlcyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQoNCiAgICAgICAgcHJpdmF0ZToNCiAgICAgICAgICAgIHN0ZDo6dmVjdG9yPHN0ZDo6YW55PiogX3BhcmVudF9Ob2RlczsNCiAgICAgICAgDQogICAgICAgIHB1YmxpYzoNCiAgICAgICAgICAgIHN0ZDo6dmVjdG9yPHN0ZDo6YW55PiYmIHBhcmVudF9Ob2RlcygpOw0KICAgICAgICAgICAgTm9kZSYgcGFyZW50X05vZGVzKHN0ZDo6dmVjdG9yPHN0ZDo6YW55PiYmIHYpOw0KICAgICAgICAvKioqKioqKioqKioqKiBOb2RlLnBhcmVudF9Ob2RlcyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgDQoNCiAgICAgICAgcHVibGljOg0KICAgICAgICAgICAgTm9kZSYgX3VuaXF1ZSgpOw0KICAgICAgICAgICAgc3RkOjpzdHJpbmcgX3RvRG9jdW1lbnQoKTsNCiAgICAgICAgICAgIE5vZGUmIF9mcm9tRG9jdW1lbnQodW5zaWduZWQgY2hhciogb2JqKTsNCiAgICAgICAgICAgIE5vZGUmIF9mcm9tRG9jdW1lbnQoc3RkOjpzdHJpbmcgb2JqKTsNCiAgICAgICAgICAgIE5vZGUmIF9mcm9tRG9jdW1lbnQoanNvbiBvYmopOw0KICAgICAgICAgICAgc3RkOjp2ZWN0b3I8Tm9kZT4mJiBfZnJvbURvY3VtZW50KHN0ZDo6dmVjdG9yPGpzb24+JiYgb2JqKTsNCiAgICANCiAgICAgICAgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlJiBzdG9yZSgpOw0KICAgIA0KICAgICAgICBzdGQ6OnZlY3Rvcjxlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGU+JiBmaW5kQWxsKCk7DQogICAgDQogICAgICAgIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZSYgZmluZCgpOw0KICAgIA0KICAgICAgICBqc29uIGF1dGhDb2RlKHN0ZDo6c3RyaW5nIGNvZGUsIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6VG9vbCYgdG9vbCk7DQogICAgDQogICAgICAgIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZSYgaW5pdChpbnQgb25saW5lLCBzdGQ6OnN0cmluZyBjb2RlLCBzdGQ6OnN0cmluZyB1aWQpOw0KICAgIA0KICAgIH07DQogICAgDQogICAgY2xhc3MgQ29uZmlnew0KICAgICAgICBwdWJsaWM6DQogICAgICAgICAgICBDb25maWcoKXsNCiAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICB+Q29uZmlnKCl7DQogICAgICAgICAgICAgICAgLy8gZm9yIGV2ZXJ5ICJuZXciIHRoZXJlIG11c3QgYmUgYSAiZGVsZXRlIg0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgcHJpdmF0ZToNCiAgICAgICAgICAgIHVuc2lnbmVkIGxvbmcgSWQ7DQoNCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogQ29uZmlnLmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHByaXZhdGU6DQogICAgICAgICAgICBib29sIF9hY3RpdmU7DQogICAgICAgICAgICANCiAgICAgICAgcHVibGljOg0KICAgICAgICAgICAgYm9vbCBhY3RpdmUoKTsNCiAgICAgICAgICAgIENvbmZpZyYgYWN0aXZlKGJvb2wgdik7DQogICAgICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBDb25maWcuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogQ29uZmlnLmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBwcml2YXRlOg0KICAgICAgICAgICAgYm9vbCBfZW5hYmxlZDsNCiAgICAgICAgICAgIA0KICAgICAgICBwdWJsaWM6DQogICAgICAgICAgICBib29sIGVuYWJsZWQoKTsNCiAgICAgICAgICAgIENvbmZpZyYgZW5hYmxlZChib29sIHYpOw0KICAgICAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogQ29uZmlnLmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBDb25maWcuY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHByaXZhdGU6DQogICAgICAgICAgICBzdGQ6OnN0cmluZyBfY29kZTsNCiAgICAgICAgICAgIA0KICAgICAgICBwdWJsaWM6DQogICAgICAgICAgICBzdGQ6OnN0cmluZyBjb2RlKCk7DQogICAgICAgICAgICBDb25maWcmIGNvZGUoc3RkOjpzdHJpbmcgdik7DQogICAgICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBDb25maWcuY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIENvbmZpZy5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHByaXZhdGU6DQogICAgICAgICAgICBpbnQgX29yZGVyOw0KICAgICAgICAgICAgDQogICAgICAgIHB1YmxpYzoNCiAgICAgICAgICAgIGludCBvcmRlcigpOw0KICAgICAgICAgICAgQ29uZmlnJiBvcmRlcihpbnQgdik7DQogICAgICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBDb25maWcub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBDb25maWcuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHByaXZhdGU6DQogICAgICAgICAgICB0aW1lX3QgX2RhdGU7DQogICAgICAgICAgICANCiAgICAgICAgcHVibGljOg0KICAgICAgICAgICAgdGltZV90IGRhdGUoKTsNCiAgICAgICAgICAgIENvbmZpZyYgZGF0ZSh0aW1lX3Qgdik7DQogICAgICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBDb25maWcuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIENvbmZpZy5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgcHJpdmF0ZToNCiAgICAgICAgICAgIHN0ZDo6c3RyaW5nIF9uYW1lOw0KICAgICAgICAgICAgDQogICAgICAgIHB1YmxpYzoNCiAgICAgICAgICAgIHN0ZDo6c3RyaW5nIG5hbWUoKTsNCiAgICAgICAgICAgIENvbmZpZyYgbmFtZShzdGQ6OnN0cmluZyB2KTsNCiAgICAgICAgDQogICAgICAgIC8qKioqKioqKioqKioqIENvbmZpZy5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogQ29uZmlnLnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHByaXZhdGU6DQogICAgICAgICAgICBzdGQ6OnN0cmluZyBfcmVtYXJrOw0KICAgICAgICAgICAgDQogICAgICAgIHB1YmxpYzoNCiAgICAgICAgICAgIHN0ZDo6c3RyaW5nIHJlbWFyaygpOw0KICAgICAgICAgICAgQ29uZmlnJiByZW1hcmsoc3RkOjpzdHJpbmcgdik7DQogICAgICAgIA0KICAgICAgICAgICAgQ29uZmlnJiByZW1hcmsoanNvbiB2KTsNCiAgICAgICAgDQogICAgICAgIC8qKioqKioqKioqKioqIENvbmZpZy5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBDb25maWcudmFsdWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBwcml2YXRlOg0KICAgICAgICAgICAgc3RkOjpzdHJpbmcgX3ZhbHVlOw0KICAgICAgICAgICAgDQogICAgICAgIHB1YmxpYzoNCiAgICAgICAgICAgIHN0ZDo6c3RyaW5nIHZhbHVlKCk7DQogICAgICAgICAgICBDb25maWcmIHZhbHVlKHN0ZDo6c3RyaW5nIHYpOw0KICAgICAgICANCiAgICAgICAgICAgIENvbmZpZyYgdmFsdWUoanNvbiB2KTsNCiAgICAgICAgDQogICAgICAgIC8qKioqKioqKioqKioqIENvbmZpZy52YWx1ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIENvbmZpZy5zY3JpcHQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBwcml2YXRlOg0KICAgICAgICAgICAgc3RkOjpzdHJpbmcgX3NjcmlwdDsNCiAgICAgICAgICAgIA0KICAgICAgICBwdWJsaWM6DQogICAgICAgICAgICBzdGQ6OnN0cmluZyBzY3JpcHQoKTsNCiAgICAgICAgICAgIENvbmZpZyYgc2NyaXB0KHN0ZDo6c3RyaW5nIHYpOw0KICAgICAgICANCiAgICAgICAgICAgIENvbmZpZyYgc2NyaXB0KGpzb24gdik7DQogICAgICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBDb25maWcuc2NyaXB0IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogQ29uZmlnLnRvb2wgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBwcml2YXRlOg0KICAgICAgICAgICAgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpUb29sKiBfdG9vbDsNCiAgICAgICAgICAgIA0KICAgICAgICBwdWJsaWM6DQogICAgICAgICAgICBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OlRvb2wqIHRvb2woKTsNCiAgICAgICAgICAgIENvbmZpZyYgdG9vbChlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OlRvb2wmIHYpOw0KICAgICAgICANCiAgICAgICAgICAgIENvbmZpZyYgdG9vbChlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OlRvb2wqIHYpOw0KICAgICAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogQ29uZmlnLnRvb2wgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBDb25maWcuZ3JvdXAgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBwcml2YXRlOg0KICAgICAgICAgICAgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpDb25maWdfR3JvdXAqIF9ncm91cDsNCiAgICAgICAgICAgIA0KICAgICAgICBwdWJsaWM6DQogICAgICAgICAgICBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkNvbmZpZ19Hcm91cCogZ3JvdXAoKTsNCiAgICAgICAgICAgIENvbmZpZyYgZ3JvdXAoZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpDb25maWdfR3JvdXAmIHYpOw0KICAgICAgICANCiAgICAgICAgICAgIENvbmZpZyYgZ3JvdXAoZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpDb25maWdfR3JvdXAqIHYpOw0KICAgICAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogQ29uZmlnLmdyb3VwIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogQ29uZmlnLnR5cGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBwcml2YXRlOg0KICAgICAgICAgICAgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpUb29sX1R5cGUqIF90eXBlOw0KICAgICAgICAgICAgDQogICAgICAgIHB1YmxpYzoNCiAgICAgICAgICAgIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6VG9vbF9UeXBlKiB0eXBlKCk7DQogICAgICAgICAgICBDb25maWcmIHR5cGUoZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpUb29sX1R5cGUmIHYpOw0KICAgICAgICANCiAgICAgICAgICAgIENvbmZpZyYgdHlwZShlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OlRvb2xfVHlwZSogdik7DQogICAgICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBDb25maWcudHlwZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIENvbmZpZy5ub2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgcHJpdmF0ZToNCiAgICAgICAgICAgIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZSogX25vZGU7DQogICAgICAgICAgICANCiAgICAgICAgcHVibGljOg0KICAgICAgICAgICAgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlKiBub2RlKCk7DQogICAgICAgICAgICBDb25maWcmIG5vZGUoZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlJiB2KTsNCiAgICAgICAgDQogICAgICAgICAgICBDb25maWcmIG5vZGUoZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlKiB2KTsNCiAgICAgICAgDQogICAgICAgIC8qKioqKioqKioqKioqIENvbmZpZy5ub2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICANCg0KICAgIA0KDQogICAgICAgIHB1YmxpYzoNCiAgICAgICAgICAgIENvbmZpZyYgX3VuaXF1ZSgpOw0KICAgICAgICAgICAgc3RkOjpzdHJpbmcgX3RvRG9jdW1lbnQoKTsNCiAgICAgICAgICAgIENvbmZpZyYgX2Zyb21Eb2N1bWVudCh1bnNpZ25lZCBjaGFyKiBvYmopOw0KICAgICAgICAgICAgQ29uZmlnJiBfZnJvbURvY3VtZW50KHN0ZDo6c3RyaW5nIG9iaik7DQogICAgICAgICAgICBDb25maWcmIF9mcm9tRG9jdW1lbnQoanNvbiBvYmopOw0KICAgICAgICAgICAgc3RkOjp2ZWN0b3I8Q29uZmlnPiYmIF9mcm9tRG9jdW1lbnQoc3RkOjp2ZWN0b3I8anNvbj4mJiBvYmopOw0KICAgIA0KICAgICAgICBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkNvbmZpZyYgc3RvcmUoKTsNCiAgICANCiAgICAgICAgc3RkOjp2ZWN0b3I8ZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpDb25maWc+JiBmaW5kQWxsKCk7DQogICAgDQogICAgICAgIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Q29uZmlnJiBmaW5kKCk7DQogICAgDQogICAgfTsNCiAgICANCiAgICBjbGFzcyBFdmVudHsNCiAgICAgICAgcHVibGljOg0KICAgICAgICAgICAgRXZlbnQoKXsNCiAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICB+RXZlbnQoKXsNCiAgICAgICAgICAgICAgICAvLyBmb3IgZXZlcnkgIm5ldyIgdGhlcmUgbXVzdCBiZSBhICJkZWxldGUiDQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICBwcml2YXRlOg0KICAgICAgICAgICAgdW5zaWduZWQgbG9uZyBJZDsNCg0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBFdmVudC5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBwcml2YXRlOg0KICAgICAgICAgICAgYm9vbCBfYWN0aXZlOw0KICAgICAgICAgICAgDQogICAgICAgIHB1YmxpYzoNCiAgICAgICAgICAgIGJvb2wgYWN0aXZlKCk7DQogICAgICAgICAgICBFdmVudCYgYWN0aXZlKGJvb2wgdik7DQogICAgICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBFdmVudC5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBFdmVudC5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgcHJpdmF0ZToNCiAgICAgICAgICAgIGJvb2wgX2VuYWJsZWQ7DQogICAgICAgICAgICANCiAgICAgICAgcHVibGljOg0KICAgICAgICAgICAgYm9vbCBlbmFibGVkKCk7DQogICAgICAgICAgICBFdmVudCYgZW5hYmxlZChib29sIHYpOw0KICAgICAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogRXZlbnQuZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIEV2ZW50LmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBwcml2YXRlOg0KICAgICAgICAgICAgc3RkOjpzdHJpbmcgX2NvZGU7DQogICAgICAgICAgICANCiAgICAgICAgcHVibGljOg0KICAgICAgICAgICAgc3RkOjpzdHJpbmcgY29kZSgpOw0KICAgICAgICAgICAgRXZlbnQmIGNvZGUoc3RkOjpzdHJpbmcgdik7DQogICAgICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBFdmVudC5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogRXZlbnQub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBwcml2YXRlOg0KICAgICAgICAgICAgaW50IF9vcmRlcjsNCiAgICAgICAgICAgIA0KICAgICAgICBwdWJsaWM6DQogICAgICAgICAgICBpbnQgb3JkZXIoKTsNCiAgICAgICAgICAgIEV2ZW50JiBvcmRlcihpbnQgdik7DQogICAgICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBFdmVudC5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIEV2ZW50LmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBwcml2YXRlOg0KICAgICAgICAgICAgdGltZV90IF9kYXRlOw0KICAgICAgICAgICAgDQogICAgICAgIHB1YmxpYzoNCiAgICAgICAgICAgIHRpbWVfdCBkYXRlKCk7DQogICAgICAgICAgICBFdmVudCYgZGF0ZSh0aW1lX3Qgdik7DQogICAgICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBFdmVudC5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogRXZlbnQubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHByaXZhdGU6DQogICAgICAgICAgICBzdGQ6OnN0cmluZyBfbmFtZTsNCiAgICAgICAgICAgIA0KICAgICAgICBwdWJsaWM6DQogICAgICAgICAgICBzdGQ6OnN0cmluZyBuYW1lKCk7DQogICAgICAgICAgICBFdmVudCYgbmFtZShzdGQ6OnN0cmluZyB2KTsNCiAgICAgICAgDQogICAgICAgIC8qKioqKioqKioqKioqIEV2ZW50Lm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBFdmVudC5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBwcml2YXRlOg0KICAgICAgICAgICAgc3RkOjpzdHJpbmcgX3JlbWFyazsNCiAgICAgICAgICAgIA0KICAgICAgICBwdWJsaWM6DQogICAgICAgICAgICBzdGQ6OnN0cmluZyByZW1hcmsoKTsNCiAgICAgICAgICAgIEV2ZW50JiByZW1hcmsoc3RkOjpzdHJpbmcgdik7DQogICAgICAgIA0KICAgICAgICAgICAgRXZlbnQmIHJlbWFyayhqc29uIHYpOw0KICAgICAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogRXZlbnQucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogRXZlbnQuY2xhc3NOYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgcHJpdmF0ZToNCiAgICAgICAgICAgIHN0ZDo6c3RyaW5nIF9jbGFzc05hbWU7DQogICAgICAgICAgICANCiAgICAgICAgcHVibGljOg0KICAgICAgICAgICAgc3RkOjpzdHJpbmcgY2xhc3NOYW1lKCk7DQogICAgICAgICAgICBFdmVudCYgY2xhc3NOYW1lKHN0ZDo6c3RyaW5nIHYpOw0KICAgICAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogRXZlbnQuY2xhc3NOYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogRXZlbnQubWV0aG9kIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgcHJpdmF0ZToNCiAgICAgICAgICAgIHN0ZDo6c3RyaW5nIF9tZXRob2Q7DQogICAgICAgICAgICANCiAgICAgICAgcHVibGljOg0KICAgICAgICAgICAgc3RkOjpzdHJpbmcgbWV0aG9kKCk7DQogICAgICAgICAgICBFdmVudCYgbWV0aG9kKHN0ZDo6c3RyaW5nIHYpOw0KICAgICAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogRXZlbnQubWV0aG9kIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogRXZlbnQucGF5bG9hZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHByaXZhdGU6DQogICAgICAgICAgICBzdGQ6OnN0cmluZyBfcGF5bG9hZDsNCiAgICAgICAgICAgIA0KICAgICAgICBwdWJsaWM6DQogICAgICAgICAgICBzdGQ6OnN0cmluZyBwYXlsb2FkKCk7DQogICAgICAgICAgICBFdmVudCYgcGF5bG9hZChzdGQ6OnN0cmluZyB2KTsNCiAgICAgICAgDQogICAgICAgICAgICBFdmVudCYgcGF5bG9hZChqc29uIHYpOw0KICAgICAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogRXZlbnQucGF5bG9hZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIEV2ZW50LmNhcnJpZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBwcml2YXRlOg0KICAgICAgICAgICAgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlKiBfY2FycmllcjsNCiAgICAgICAgICAgIA0KICAgICAgICBwdWJsaWM6DQogICAgICAgICAgICBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGUqIGNhcnJpZXIoKTsNCiAgICAgICAgICAgIEV2ZW50JiBjYXJyaWVyKGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZSYgdik7DQogICAgICAgIA0KICAgICAgICAgICAgRXZlbnQmIGNhcnJpZXIoZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlKiB2KTsNCiAgICAgICAgDQogICAgICAgIC8qKioqKioqKioqKioqIEV2ZW50LmNhcnJpZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBFdmVudC5zZW5kZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBwcml2YXRlOg0KICAgICAgICAgICAgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlKiBfc2VuZGVyOw0KICAgICAgICAgICAgDQogICAgICAgIHB1YmxpYzoNCiAgICAgICAgICAgIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZSogc2VuZGVyKCk7DQogICAgICAgICAgICBFdmVudCYgc2VuZGVyKGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZSYgdik7DQogICAgICAgIA0KICAgICAgICAgICAgRXZlbnQmIHNlbmRlcihlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGUqIHYpOw0KICAgICAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogRXZlbnQuc2VuZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogRXZlbnQucmVjaXBpZW50IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgcHJpdmF0ZToNCiAgICAgICAgICAgIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZSogX3JlY2lwaWVudDsNCiAgICAgICAgICAgIA0KICAgICAgICBwdWJsaWM6DQogICAgICAgICAgICBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGUqIHJlY2lwaWVudCgpOw0KICAgICAgICAgICAgRXZlbnQmIHJlY2lwaWVudChlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGUmIHYpOw0KICAgICAgICANCiAgICAgICAgICAgIEV2ZW50JiByZWNpcGllbnQoZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlKiB2KTsNCiAgICAgICAgDQogICAgICAgIC8qKioqKioqKioqKioqIEV2ZW50LnJlY2lwaWVudCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIEV2ZW50LnJlc3BvbnNlVG8gR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBwcml2YXRlOg0KICAgICAgICAgICAgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpFdmVudCogX3Jlc3BvbnNlVG87DQogICAgICAgICAgICANCiAgICAgICAgcHVibGljOg0KICAgICAgICAgICAgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpFdmVudCogcmVzcG9uc2VUbygpOw0KICAgICAgICAgICAgRXZlbnQmIHJlc3BvbnNlVG8oZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpFdmVudCYgdik7DQogICAgICAgIA0KICAgICAgICAgICAgRXZlbnQmIHJlc3BvbnNlVG8oZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpFdmVudCogdik7DQogICAgICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBFdmVudC5yZXNwb25zZVRvIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICANCg0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBFdmVudC5yZXNwb25zZVRvX0V2ZW50cyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQoNCiAgICAgICAgcHJpdmF0ZToNCiAgICAgICAgICAgIHN0ZDo6dmVjdG9yPHN0ZDo6YW55PiogX3Jlc3BvbnNlVG9fRXZlbnRzOw0KICAgICAgICANCiAgICAgICAgcHVibGljOg0KICAgICAgICAgICAgc3RkOjp2ZWN0b3I8c3RkOjphbnk+JiYgcmVzcG9uc2VUb19FdmVudHMoKTsNCiAgICAgICAgICAgIEV2ZW50JiByZXNwb25zZVRvX0V2ZW50cyhzdGQ6OnZlY3RvcjxzdGQ6OmFueT4mJiB2KTsNCiAgICAgICAgLyoqKioqKioqKioqKiogRXZlbnQucmVzcG9uc2VUb19FdmVudHMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgIA0KDQogICAgICAgIHB1YmxpYzoNCiAgICAgICAgICAgIEV2ZW50JiBfdW5pcXVlKCk7DQogICAgICAgICAgICBzdGQ6OnN0cmluZyBfdG9Eb2N1bWVudCgpOw0KICAgICAgICAgICAgRXZlbnQmIF9mcm9tRG9jdW1lbnQodW5zaWduZWQgY2hhciogb2JqKTsNCiAgICAgICAgICAgIEV2ZW50JiBfZnJvbURvY3VtZW50KHN0ZDo6c3RyaW5nIG9iaik7DQogICAgICAgICAgICBFdmVudCYgX2Zyb21Eb2N1bWVudChqc29uIG9iaik7DQogICAgICAgICAgICBzdGQ6OnZlY3RvcjxFdmVudD4mJiBfZnJvbURvY3VtZW50KHN0ZDo6dmVjdG9yPGpzb24+JiYgb2JqKTsNCiAgICANCiAgICAgICAgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpFdmVudCYgc3RvcmUoKTsNCiAgICANCiAgICAgICAgc3RkOjp2ZWN0b3I8ZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpFdmVudD4mIGZpbmRBbGwoKTsNCiAgICANCiAgICAgICAgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpFdmVudCYgZmluZCgpOw0KICAgIA0KICAgICAgICBqc29uIGxpc3Rlbihlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGUmIG5vZGUpOw0KICAgIA0KICAgICAgICBqc29uIHRyaWdnZXIoKTsNCiAgICANCiAgICAgICAgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpFdmVudCYgcHJvY2VzcygpOw0KICAgIA0KICAgIH07DQogICAgDQp9CgkKfQoJCn0KCQp9CgkNCg0KbmFtZXNwYWNlIGVzcHRlc3R7CgkKbmFtZXNwYWNlIGNvbXsKCQpuYW1lc3BhY2UgbmFtbW91cnsKCQpuYW1lc3BhY2UgZGlvdHsKCQ0KICAgIA0KICAgIGNsYXNzIERldmljZV9DYXRlZ29yeXsNCiAgICAgICAgcHVibGljOg0KICAgICAgICAgICAgRGV2aWNlX0NhdGVnb3J5KCl7DQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgfkRldmljZV9DYXRlZ29yeSgpew0KICAgICAgICAgICAgICAgIC8vIGZvciBldmVyeSAibmV3IiB0aGVyZSBtdXN0IGJlIGEgImRlbGV0ZSINCiAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIHByaXZhdGU6DQogICAgICAgICAgICB1bnNpZ25lZCBsb25nIElkOw0KDQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIERldmljZV9DYXRlZ29yeS5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBwcml2YXRlOg0KICAgICAgICAgICAgYm9vbCBfYWN0aXZlOw0KICAgICAgICAgICAgDQogICAgICAgIHB1YmxpYzoNCiAgICAgICAgICAgIGJvb2wgYWN0aXZlKCk7DQogICAgICAgICAgICBEZXZpY2VfQ2F0ZWdvcnkmIGFjdGl2ZShib29sIHYpOw0KICAgICAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogRGV2aWNlX0NhdGVnb3J5LmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIERldmljZV9DYXRlZ29yeS5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgcHJpdmF0ZToNCiAgICAgICAgICAgIGJvb2wgX2VuYWJsZWQ7DQogICAgICAgICAgICANCiAgICAgICAgcHVibGljOg0KICAgICAgICAgICAgYm9vbCBlbmFibGVkKCk7DQogICAgICAgICAgICBEZXZpY2VfQ2F0ZWdvcnkmIGVuYWJsZWQoYm9vbCB2KTsNCiAgICAgICAgDQogICAgICAgIC8qKioqKioqKioqKioqIERldmljZV9DYXRlZ29yeS5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogRGV2aWNlX0NhdGVnb3J5LmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBwcml2YXRlOg0KICAgICAgICAgICAgc3RkOjpzdHJpbmcgX2NvZGU7DQogICAgICAgICAgICANCiAgICAgICAgcHVibGljOg0KICAgICAgICAgICAgc3RkOjpzdHJpbmcgY29kZSgpOw0KICAgICAgICAgICAgRGV2aWNlX0NhdGVnb3J5JiBjb2RlKHN0ZDo6c3RyaW5nIHYpOw0KICAgICAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogRGV2aWNlX0NhdGVnb3J5LmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBEZXZpY2VfQ2F0ZWdvcnkub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBwcml2YXRlOg0KICAgICAgICAgICAgaW50IF9vcmRlcjsNCiAgICAgICAgICAgIA0KICAgICAgICBwdWJsaWM6DQogICAgICAgICAgICBpbnQgb3JkZXIoKTsNCiAgICAgICAgICAgIERldmljZV9DYXRlZ29yeSYgb3JkZXIoaW50IHYpOw0KICAgICAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogRGV2aWNlX0NhdGVnb3J5Lm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogRGV2aWNlX0NhdGVnb3J5LmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBwcml2YXRlOg0KICAgICAgICAgICAgdGltZV90IF9kYXRlOw0KICAgICAgICAgICAgDQogICAgICAgIHB1YmxpYzoNCiAgICAgICAgICAgIHRpbWVfdCBkYXRlKCk7DQogICAgICAgICAgICBEZXZpY2VfQ2F0ZWdvcnkmIGRhdGUodGltZV90IHYpOw0KICAgICAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogRGV2aWNlX0NhdGVnb3J5LmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBEZXZpY2VfQ2F0ZWdvcnkubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHByaXZhdGU6DQogICAgICAgICAgICBzdGQ6OnN0cmluZyBfbmFtZTsNCiAgICAgICAgICAgIA0KICAgICAgICBwdWJsaWM6DQogICAgICAgICAgICBzdGQ6OnN0cmluZyBuYW1lKCk7DQogICAgICAgICAgICBEZXZpY2VfQ2F0ZWdvcnkmIG5hbWUoc3RkOjpzdHJpbmcgdik7DQogICAgICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBEZXZpY2VfQ2F0ZWdvcnkubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIERldmljZV9DYXRlZ29yeS5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBwcml2YXRlOg0KICAgICAgICAgICAgc3RkOjpzdHJpbmcgX3JlbWFyazsNCiAgICAgICAgICAgIA0KICAgICAgICBwdWJsaWM6DQogICAgICAgICAgICBzdGQ6OnN0cmluZyByZW1hcmsoKTsNCiAgICAgICAgICAgIERldmljZV9DYXRlZ29yeSYgcmVtYXJrKHN0ZDo6c3RyaW5nIHYpOw0KICAgICAgICANCiAgICAgICAgICAgIERldmljZV9DYXRlZ29yeSYgcmVtYXJrKGpzb24gdik7DQogICAgICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBEZXZpY2VfQ2F0ZWdvcnkucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogRGV2aWNlX0NhdGVnb3J5LnBhcmVudCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHByaXZhdGU6DQogICAgICAgICAgICBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZV9DYXRlZ29yeSogX3BhcmVudDsNCiAgICAgICAgICAgIA0KICAgICAgICBwdWJsaWM6DQogICAgICAgICAgICBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZV9DYXRlZ29yeSogcGFyZW50KCk7DQogICAgICAgICAgICBEZXZpY2VfQ2F0ZWdvcnkmIHBhcmVudChlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZV9DYXRlZ29yeSYgdik7DQogICAgICAgIA0KICAgICAgICAgICAgRGV2aWNlX0NhdGVnb3J5JiBwYXJlbnQoZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpEZXZpY2VfQ2F0ZWdvcnkqIHYpOw0KICAgICAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogRGV2aWNlX0NhdGVnb3J5LnBhcmVudCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgDQoNCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogRGV2aWNlX0NhdGVnb3J5LnBhcmVudF9EZXZpY2VfQ2F0ZWdvcnlzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCg0KICAgICAgICBwcml2YXRlOg0KICAgICAgICAgICAgc3RkOjp2ZWN0b3I8c3RkOjphbnk+KiBfcGFyZW50X0RldmljZV9DYXRlZ29yeXM7DQogICAgICAgIA0KICAgICAgICBwdWJsaWM6DQogICAgICAgICAgICBzdGQ6OnZlY3RvcjxzdGQ6OmFueT4mJiBwYXJlbnRfRGV2aWNlX0NhdGVnb3J5cygpOw0KICAgICAgICAgICAgRGV2aWNlX0NhdGVnb3J5JiBwYXJlbnRfRGV2aWNlX0NhdGVnb3J5cyhzdGQ6OnZlY3RvcjxzdGQ6OmFueT4mJiB2KTsNCiAgICAgICAgLyoqKioqKioqKioqKiogRGV2aWNlX0NhdGVnb3J5LnBhcmVudF9EZXZpY2VfQ2F0ZWdvcnlzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogRGV2aWNlX0NhdGVnb3J5LmNhdGVnb3J5X0RldmljZV9UeXBlcyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQoNCiAgICAgICAgcHJpdmF0ZToNCiAgICAgICAgICAgIHN0ZDo6dmVjdG9yPHN0ZDo6YW55PiogX2NhdGVnb3J5X0RldmljZV9UeXBlczsNCiAgICAgICAgDQogICAgICAgIHB1YmxpYzoNCiAgICAgICAgICAgIHN0ZDo6dmVjdG9yPHN0ZDo6YW55PiYmIGNhdGVnb3J5X0RldmljZV9UeXBlcygpOw0KICAgICAgICAgICAgRGV2aWNlX0NhdGVnb3J5JiBjYXRlZ29yeV9EZXZpY2VfVHlwZXMoc3RkOjp2ZWN0b3I8c3RkOjphbnk+JiYgdik7DQogICAgICAgIC8qKioqKioqKioqKioqIERldmljZV9DYXRlZ29yeS5jYXRlZ29yeV9EZXZpY2VfVHlwZXMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgIA0KDQogICAgICAgIHB1YmxpYzoNCiAgICAgICAgICAgIERldmljZV9DYXRlZ29yeSYgX3VuaXF1ZSgpOw0KICAgICAgICAgICAgc3RkOjpzdHJpbmcgX3RvRG9jdW1lbnQoKTsNCiAgICAgICAgICAgIERldmljZV9DYXRlZ29yeSYgX2Zyb21Eb2N1bWVudCh1bnNpZ25lZCBjaGFyKiBvYmopOw0KICAgICAgICAgICAgRGV2aWNlX0NhdGVnb3J5JiBfZnJvbURvY3VtZW50KHN0ZDo6c3RyaW5nIG9iaik7DQogICAgICAgICAgICBEZXZpY2VfQ2F0ZWdvcnkmIF9mcm9tRG9jdW1lbnQoanNvbiBvYmopOw0KICAgICAgICAgICAgc3RkOjp2ZWN0b3I8RGV2aWNlX0NhdGVnb3J5PiYmIF9mcm9tRG9jdW1lbnQoc3RkOjp2ZWN0b3I8anNvbj4mJiBvYmopOw0KICAgIA0KICAgICAgICBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZV9DYXRlZ29yeSYgc3RvcmUoKTsNCiAgICANCiAgICAgICAgc3RkOjp2ZWN0b3I8ZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpEZXZpY2VfQ2F0ZWdvcnk+JiBmaW5kQWxsKCk7DQogICAgDQogICAgICAgIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6RGV2aWNlX0NhdGVnb3J5JiBmaW5kKCk7DQogICAgDQogICAgfTsNCiAgICANCiAgICBjbGFzcyBNZXRyaWNfR3JvdXB7DQogICAgICAgIHB1YmxpYzoNCiAgICAgICAgICAgIE1ldHJpY19Hcm91cCgpew0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgIH5NZXRyaWNfR3JvdXAoKXsNCiAgICAgICAgICAgICAgICAvLyBmb3IgZXZlcnkgIm5ldyIgdGhlcmUgbXVzdCBiZSBhICJkZWxldGUiDQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICBwcml2YXRlOg0KICAgICAgICAgICAgdW5zaWduZWQgbG9uZyBJZDsNCg0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBNZXRyaWNfR3JvdXAuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgcHJpdmF0ZToNCiAgICAgICAgICAgIGJvb2wgX2FjdGl2ZTsNCiAgICAgICAgICAgIA0KICAgICAgICBwdWJsaWM6DQogICAgICAgICAgICBib29sIGFjdGl2ZSgpOw0KICAgICAgICAgICAgTWV0cmljX0dyb3VwJiBhY3RpdmUoYm9vbCB2KTsNCiAgICAgICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE1ldHJpY19Hcm91cC5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBNZXRyaWNfR3JvdXAuZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHByaXZhdGU6DQogICAgICAgICAgICBib29sIF9lbmFibGVkOw0KICAgICAgICAgICAgDQogICAgICAgIHB1YmxpYzoNCiAgICAgICAgICAgIGJvb2wgZW5hYmxlZCgpOw0KICAgICAgICAgICAgTWV0cmljX0dyb3VwJiBlbmFibGVkKGJvb2wgdik7DQogICAgICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBNZXRyaWNfR3JvdXAuZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE1ldHJpY19Hcm91cC5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgcHJpdmF0ZToNCiAgICAgICAgICAgIHN0ZDo6c3RyaW5nIF9jb2RlOw0KICAgICAgICAgICAgDQogICAgICAgIHB1YmxpYzoNCiAgICAgICAgICAgIHN0ZDo6c3RyaW5nIGNvZGUoKTsNCiAgICAgICAgICAgIE1ldHJpY19Hcm91cCYgY29kZShzdGQ6OnN0cmluZyB2KTsNCiAgICAgICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE1ldHJpY19Hcm91cC5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTWV0cmljX0dyb3VwLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgcHJpdmF0ZToNCiAgICAgICAgICAgIGludCBfb3JkZXI7DQogICAgICAgICAgICANCiAgICAgICAgcHVibGljOg0KICAgICAgICAgICAgaW50IG9yZGVyKCk7DQogICAgICAgICAgICBNZXRyaWNfR3JvdXAmIG9yZGVyKGludCB2KTsNCiAgICAgICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE1ldHJpY19Hcm91cC5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE1ldHJpY19Hcm91cC5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgcHJpdmF0ZToNCiAgICAgICAgICAgIHRpbWVfdCBfZGF0ZTsNCiAgICAgICAgICAgIA0KICAgICAgICBwdWJsaWM6DQogICAgICAgICAgICB0aW1lX3QgZGF0ZSgpOw0KICAgICAgICAgICAgTWV0cmljX0dyb3VwJiBkYXRlKHRpbWVfdCB2KTsNCiAgICAgICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE1ldHJpY19Hcm91cC5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTWV0cmljX0dyb3VwLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBwcml2YXRlOg0KICAgICAgICAgICAgc3RkOjpzdHJpbmcgX25hbWU7DQogICAgICAgICAgICANCiAgICAgICAgcHVibGljOg0KICAgICAgICAgICAgc3RkOjpzdHJpbmcgbmFtZSgpOw0KICAgICAgICAgICAgTWV0cmljX0dyb3VwJiBuYW1lKHN0ZDo6c3RyaW5nIHYpOw0KICAgICAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTWV0cmljX0dyb3VwLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBNZXRyaWNfR3JvdXAucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgcHJpdmF0ZToNCiAgICAgICAgICAgIHN0ZDo6c3RyaW5nIF9yZW1hcms7DQogICAgICAgICAgICANCiAgICAgICAgcHVibGljOg0KICAgICAgICAgICAgc3RkOjpzdHJpbmcgcmVtYXJrKCk7DQogICAgICAgICAgICBNZXRyaWNfR3JvdXAmIHJlbWFyayhzdGQ6OnN0cmluZyB2KTsNCiAgICAgICAgDQogICAgICAgICAgICBNZXRyaWNfR3JvdXAmIHJlbWFyayhqc29uIHYpOw0KICAgICAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTWV0cmljX0dyb3VwLnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgDQoNCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTWV0cmljX0dyb3VwLmdyb3VwX01ldHJpY19UeXBlcyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQoNCiAgICAgICAgcHJpdmF0ZToNCiAgICAgICAgICAgIHN0ZDo6dmVjdG9yPHN0ZDo6YW55PiogX2dyb3VwX01ldHJpY19UeXBlczsNCiAgICAgICAgDQogICAgICAgIHB1YmxpYzoNCiAgICAgICAgICAgIHN0ZDo6dmVjdG9yPHN0ZDo6YW55PiYmIGdyb3VwX01ldHJpY19UeXBlcygpOw0KICAgICAgICAgICAgTWV0cmljX0dyb3VwJiBncm91cF9NZXRyaWNfVHlwZXMoc3RkOjp2ZWN0b3I8c3RkOjphbnk+JiYgdik7DQogICAgICAgIC8qKioqKioqKioqKioqIE1ldHJpY19Hcm91cC5ncm91cF9NZXRyaWNfVHlwZXMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgIA0KDQogICAgICAgIHB1YmxpYzoNCiAgICAgICAgICAgIE1ldHJpY19Hcm91cCYgX3VuaXF1ZSgpOw0KICAgICAgICAgICAgc3RkOjpzdHJpbmcgX3RvRG9jdW1lbnQoKTsNCiAgICAgICAgICAgIE1ldHJpY19Hcm91cCYgX2Zyb21Eb2N1bWVudCh1bnNpZ25lZCBjaGFyKiBvYmopOw0KICAgICAgICAgICAgTWV0cmljX0dyb3VwJiBfZnJvbURvY3VtZW50KHN0ZDo6c3RyaW5nIG9iaik7DQogICAgICAgICAgICBNZXRyaWNfR3JvdXAmIF9mcm9tRG9jdW1lbnQoanNvbiBvYmopOw0KICAgICAgICAgICAgc3RkOjp2ZWN0b3I8TWV0cmljX0dyb3VwPiYmIF9mcm9tRG9jdW1lbnQoc3RkOjp2ZWN0b3I8anNvbj4mJiBvYmopOw0KICAgIA0KICAgICAgICBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6Ok1ldHJpY19Hcm91cCYgc3RvcmUoKTsNCiAgICANCiAgICAgICAgc3RkOjp2ZWN0b3I8ZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpNZXRyaWNfR3JvdXA+JiBmaW5kQWxsKCk7DQogICAgDQogICAgICAgIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6TWV0cmljX0dyb3VwJiBmaW5kKCk7DQogICAgDQogICAgfTsNCiAgICANCiAgICBjbGFzcyBEZXZpY2VfVHlwZXsNCiAgICAgICAgcHVibGljOg0KICAgICAgICAgICAgRGV2aWNlX1R5cGUoKXsNCiAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICB+RGV2aWNlX1R5cGUoKXsNCiAgICAgICAgICAgICAgICAvLyBmb3IgZXZlcnkgIm5ldyIgdGhlcmUgbXVzdCBiZSBhICJkZWxldGUiDQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICBwcml2YXRlOg0KICAgICAgICAgICAgdW5zaWduZWQgbG9uZyBJZDsNCg0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBEZXZpY2VfVHlwZS5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBwcml2YXRlOg0KICAgICAgICAgICAgYm9vbCBfYWN0aXZlOw0KICAgICAgICAgICAgDQogICAgICAgIHB1YmxpYzoNCiAgICAgICAgICAgIGJvb2wgYWN0aXZlKCk7DQogICAgICAgICAgICBEZXZpY2VfVHlwZSYgYWN0aXZlKGJvb2wgdik7DQogICAgICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBEZXZpY2VfVHlwZS5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBEZXZpY2VfVHlwZS5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgcHJpdmF0ZToNCiAgICAgICAgICAgIGJvb2wgX2VuYWJsZWQ7DQogICAgICAgICAgICANCiAgICAgICAgcHVibGljOg0KICAgICAgICAgICAgYm9vbCBlbmFibGVkKCk7DQogICAgICAgICAgICBEZXZpY2VfVHlwZSYgZW5hYmxlZChib29sIHYpOw0KICAgICAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogRGV2aWNlX1R5cGUuZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIERldmljZV9UeXBlLmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBwcml2YXRlOg0KICAgICAgICAgICAgc3RkOjpzdHJpbmcgX2NvZGU7DQogICAgICAgICAgICANCiAgICAgICAgcHVibGljOg0KICAgICAgICAgICAgc3RkOjpzdHJpbmcgY29kZSgpOw0KICAgICAgICAgICAgRGV2aWNlX1R5cGUmIGNvZGUoc3RkOjpzdHJpbmcgdik7DQogICAgICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBEZXZpY2VfVHlwZS5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogRGV2aWNlX1R5cGUub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBwcml2YXRlOg0KICAgICAgICAgICAgaW50IF9vcmRlcjsNCiAgICAgICAgICAgIA0KICAgICAgICBwdWJsaWM6DQogICAgICAgICAgICBpbnQgb3JkZXIoKTsNCiAgICAgICAgICAgIERldmljZV9UeXBlJiBvcmRlcihpbnQgdik7DQogICAgICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBEZXZpY2VfVHlwZS5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIERldmljZV9UeXBlLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBwcml2YXRlOg0KICAgICAgICAgICAgdGltZV90IF9kYXRlOw0KICAgICAgICAgICAgDQogICAgICAgIHB1YmxpYzoNCiAgICAgICAgICAgIHRpbWVfdCBkYXRlKCk7DQogICAgICAgICAgICBEZXZpY2VfVHlwZSYgZGF0ZSh0aW1lX3Qgdik7DQogICAgICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBEZXZpY2VfVHlwZS5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogRGV2aWNlX1R5cGUubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHByaXZhdGU6DQogICAgICAgICAgICBzdGQ6OnN0cmluZyBfbmFtZTsNCiAgICAgICAgICAgIA0KICAgICAgICBwdWJsaWM6DQogICAgICAgICAgICBzdGQ6OnN0cmluZyBuYW1lKCk7DQogICAgICAgICAgICBEZXZpY2VfVHlwZSYgbmFtZShzdGQ6OnN0cmluZyB2KTsNCiAgICAgICAgDQogICAgICAgIC8qKioqKioqKioqKioqIERldmljZV9UeXBlLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBEZXZpY2VfVHlwZS5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBwcml2YXRlOg0KICAgICAgICAgICAgc3RkOjpzdHJpbmcgX3JlbWFyazsNCiAgICAgICAgICAgIA0KICAgICAgICBwdWJsaWM6DQogICAgICAgICAgICBzdGQ6OnN0cmluZyByZW1hcmsoKTsNCiAgICAgICAgICAgIERldmljZV9UeXBlJiByZW1hcmsoc3RkOjpzdHJpbmcgdik7DQogICAgICAgIA0KICAgICAgICAgICAgRGV2aWNlX1R5cGUmIHJlbWFyayhqc29uIHYpOw0KICAgICAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogRGV2aWNlX1R5cGUucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogRGV2aWNlX1R5cGUuY2F0ZWdvcnkgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBwcml2YXRlOg0KICAgICAgICAgICAgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpEZXZpY2VfQ2F0ZWdvcnkqIF9jYXRlZ29yeTsNCiAgICAgICAgICAgIA0KICAgICAgICBwdWJsaWM6DQogICAgICAgICAgICBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZV9DYXRlZ29yeSogY2F0ZWdvcnkoKTsNCiAgICAgICAgICAgIERldmljZV9UeXBlJiBjYXRlZ29yeShlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZV9DYXRlZ29yeSYgdik7DQogICAgICAgIA0KICAgICAgICAgICAgRGV2aWNlX1R5cGUmIGNhdGVnb3J5KGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6RGV2aWNlX0NhdGVnb3J5KiB2KTsNCiAgICAgICAgDQogICAgICAgIC8qKioqKioqKioqKioqIERldmljZV9UeXBlLmNhdGVnb3J5IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICANCg0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBEZXZpY2VfVHlwZS5kZXZpY2VUeXBlX01ldHJpY3MgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KDQogICAgICAgIHByaXZhdGU6DQogICAgICAgICAgICBzdGQ6OnZlY3RvcjxzdGQ6OmFueT4qIF9kZXZpY2VUeXBlX01ldHJpY3M7DQogICAgICAgIA0KICAgICAgICBwdWJsaWM6DQogICAgICAgICAgICBzdGQ6OnZlY3RvcjxzdGQ6OmFueT4mJiBkZXZpY2VUeXBlX01ldHJpY3MoKTsNCiAgICAgICAgICAgIERldmljZV9UeXBlJiBkZXZpY2VUeXBlX01ldHJpY3Moc3RkOjp2ZWN0b3I8c3RkOjphbnk+JiYgdik7DQogICAgICAgIC8qKioqKioqKioqKioqIERldmljZV9UeXBlLmRldmljZVR5cGVfTWV0cmljcyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIERldmljZV9UeXBlLnR5cGVfRGV2aWNlcyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQoNCiAgICAgICAgcHJpdmF0ZToNCiAgICAgICAgICAgIHN0ZDo6dmVjdG9yPHN0ZDo6YW55PiogX3R5cGVfRGV2aWNlczsNCiAgICAgICAgDQogICAgICAgIHB1YmxpYzoNCiAgICAgICAgICAgIHN0ZDo6dmVjdG9yPHN0ZDo6YW55PiYmIHR5cGVfRGV2aWNlcygpOw0KICAgICAgICAgICAgRGV2aWNlX1R5cGUmIHR5cGVfRGV2aWNlcyhzdGQ6OnZlY3RvcjxzdGQ6OmFueT4mJiB2KTsNCiAgICAgICAgLyoqKioqKioqKioqKiogRGV2aWNlX1R5cGUudHlwZV9EZXZpY2VzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogRGV2aWNlX1R5cGUuZGV2aWNlVHlwZV9UeXBlX0F0dHJpYnV0ZXMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KDQogICAgICAgIHByaXZhdGU6DQogICAgICAgICAgICBzdGQ6OnZlY3RvcjxzdGQ6OmFueT4qIF9kZXZpY2VUeXBlX1R5cGVfQXR0cmlidXRlczsNCiAgICAgICAgDQogICAgICAgIHB1YmxpYzoNCiAgICAgICAgICAgIHN0ZDo6dmVjdG9yPHN0ZDo6YW55PiYmIGRldmljZVR5cGVfVHlwZV9BdHRyaWJ1dGVzKCk7DQogICAgICAgICAgICBEZXZpY2VfVHlwZSYgZGV2aWNlVHlwZV9UeXBlX0F0dHJpYnV0ZXMoc3RkOjp2ZWN0b3I8c3RkOjphbnk+JiYgdik7DQogICAgICAgIC8qKioqKioqKioqKioqIERldmljZV9UeXBlLmRldmljZVR5cGVfVHlwZV9BdHRyaWJ1dGVzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICANCg0KICAgICAgICBwdWJsaWM6DQogICAgICAgICAgICBEZXZpY2VfVHlwZSYgX3VuaXF1ZSgpOw0KICAgICAgICAgICAgc3RkOjpzdHJpbmcgX3RvRG9jdW1lbnQoKTsNCiAgICAgICAgICAgIERldmljZV9UeXBlJiBfZnJvbURvY3VtZW50KHVuc2lnbmVkIGNoYXIqIG9iaik7DQogICAgICAgICAgICBEZXZpY2VfVHlwZSYgX2Zyb21Eb2N1bWVudChzdGQ6OnN0cmluZyBvYmopOw0KICAgICAgICAgICAgRGV2aWNlX1R5cGUmIF9mcm9tRG9jdW1lbnQoanNvbiBvYmopOw0KICAgICAgICAgICAgc3RkOjp2ZWN0b3I8RGV2aWNlX1R5cGU+JiYgX2Zyb21Eb2N1bWVudChzdGQ6OnZlY3Rvcjxqc29uPiYmIG9iaik7DQogICAgDQogICAgICAgIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6RGV2aWNlX1R5cGUmIHN0b3JlKCk7DQogICAgDQogICAgICAgIHN0ZDo6dmVjdG9yPGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6RGV2aWNlX1R5cGU+JiBmaW5kQWxsKCk7DQogICAgDQogICAgICAgIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6RGV2aWNlX1R5cGUmIGZpbmQoKTsNCiAgICANCiAgICB9Ow0KICAgIA0KICAgIGNsYXNzIE1ldHJpY19UeXBlew0KICAgICAgICBwdWJsaWM6DQogICAgICAgICAgICBNZXRyaWNfVHlwZSgpew0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgIH5NZXRyaWNfVHlwZSgpew0KICAgICAgICAgICAgICAgIC8vIGZvciBldmVyeSAibmV3IiB0aGVyZSBtdXN0IGJlIGEgImRlbGV0ZSINCiAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIHByaXZhdGU6DQogICAgICAgICAgICB1bnNpZ25lZCBsb25nIElkOw0KDQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE1ldHJpY19UeXBlLmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHByaXZhdGU6DQogICAgICAgICAgICBib29sIF9hY3RpdmU7DQogICAgICAgICAgICANCiAgICAgICAgcHVibGljOg0KICAgICAgICAgICAgYm9vbCBhY3RpdmUoKTsNCiAgICAgICAgICAgIE1ldHJpY19UeXBlJiBhY3RpdmUoYm9vbCB2KTsNCiAgICAgICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE1ldHJpY19UeXBlLmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE1ldHJpY19UeXBlLmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBwcml2YXRlOg0KICAgICAgICAgICAgYm9vbCBfZW5hYmxlZDsNCiAgICAgICAgICAgIA0KICAgICAgICBwdWJsaWM6DQogICAgICAgICAgICBib29sIGVuYWJsZWQoKTsNCiAgICAgICAgICAgIE1ldHJpY19UeXBlJiBlbmFibGVkKGJvb2wgdik7DQogICAgICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBNZXRyaWNfVHlwZS5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTWV0cmljX1R5cGUuY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHByaXZhdGU6DQogICAgICAgICAgICBzdGQ6OnN0cmluZyBfY29kZTsNCiAgICAgICAgICAgIA0KICAgICAgICBwdWJsaWM6DQogICAgICAgICAgICBzdGQ6OnN0cmluZyBjb2RlKCk7DQogICAgICAgICAgICBNZXRyaWNfVHlwZSYgY29kZShzdGQ6OnN0cmluZyB2KTsNCiAgICAgICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE1ldHJpY19UeXBlLmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBNZXRyaWNfVHlwZS5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHByaXZhdGU6DQogICAgICAgICAgICBpbnQgX29yZGVyOw0KICAgICAgICAgICAgDQogICAgICAgIHB1YmxpYzoNCiAgICAgICAgICAgIGludCBvcmRlcigpOw0KICAgICAgICAgICAgTWV0cmljX1R5cGUmIG9yZGVyKGludCB2KTsNCiAgICAgICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE1ldHJpY19UeXBlLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTWV0cmljX1R5cGUuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHByaXZhdGU6DQogICAgICAgICAgICB0aW1lX3QgX2RhdGU7DQogICAgICAgICAgICANCiAgICAgICAgcHVibGljOg0KICAgICAgICAgICAgdGltZV90IGRhdGUoKTsNCiAgICAgICAgICAgIE1ldHJpY19UeXBlJiBkYXRlKHRpbWVfdCB2KTsNCiAgICAgICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE1ldHJpY19UeXBlLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBNZXRyaWNfVHlwZS5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgcHJpdmF0ZToNCiAgICAgICAgICAgIHN0ZDo6c3RyaW5nIF9uYW1lOw0KICAgICAgICAgICAgDQogICAgICAgIHB1YmxpYzoNCiAgICAgICAgICAgIHN0ZDo6c3RyaW5nIG5hbWUoKTsNCiAgICAgICAgICAgIE1ldHJpY19UeXBlJiBuYW1lKHN0ZDo6c3RyaW5nIHYpOw0KICAgICAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTWV0cmljX1R5cGUubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE1ldHJpY19UeXBlLnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHByaXZhdGU6DQogICAgICAgICAgICBzdGQ6OnN0cmluZyBfcmVtYXJrOw0KICAgICAgICAgICAgDQogICAgICAgIHB1YmxpYzoNCiAgICAgICAgICAgIHN0ZDo6c3RyaW5nIHJlbWFyaygpOw0KICAgICAgICAgICAgTWV0cmljX1R5cGUmIHJlbWFyayhzdGQ6OnN0cmluZyB2KTsNCiAgICAgICAgDQogICAgICAgICAgICBNZXRyaWNfVHlwZSYgcmVtYXJrKGpzb24gdik7DQogICAgICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBNZXRyaWNfVHlwZS5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBNZXRyaWNfVHlwZS5ncm91cCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHByaXZhdGU6DQogICAgICAgICAgICBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6Ok1ldHJpY19Hcm91cCogX2dyb3VwOw0KICAgICAgICAgICAgDQogICAgICAgIHB1YmxpYzoNCiAgICAgICAgICAgIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6TWV0cmljX0dyb3VwKiBncm91cCgpOw0KICAgICAgICAgICAgTWV0cmljX1R5cGUmIGdyb3VwKGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6TWV0cmljX0dyb3VwJiB2KTsNCiAgICAgICAgDQogICAgICAgICAgICBNZXRyaWNfVHlwZSYgZ3JvdXAoZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpNZXRyaWNfR3JvdXAqIHYpOw0KICAgICAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTWV0cmljX1R5cGUuZ3JvdXAgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgIA0KDQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE1ldHJpY19UeXBlLnR5cGVfTWV0cmljcyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQoNCiAgICAgICAgcHJpdmF0ZToNCiAgICAgICAgICAgIHN0ZDo6dmVjdG9yPHN0ZDo6YW55PiogX3R5cGVfTWV0cmljczsNCiAgICAgICAgDQogICAgICAgIHB1YmxpYzoNCiAgICAgICAgICAgIHN0ZDo6dmVjdG9yPHN0ZDo6YW55PiYmIHR5cGVfTWV0cmljcygpOw0KICAgICAgICAgICAgTWV0cmljX1R5cGUmIHR5cGVfTWV0cmljcyhzdGQ6OnZlY3RvcjxzdGQ6OmFueT4mJiB2KTsNCiAgICAgICAgLyoqKioqKioqKioqKiogTWV0cmljX1R5cGUudHlwZV9NZXRyaWNzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICANCg0KICAgICAgICBwdWJsaWM6DQogICAgICAgICAgICBNZXRyaWNfVHlwZSYgX3VuaXF1ZSgpOw0KICAgICAgICAgICAgc3RkOjpzdHJpbmcgX3RvRG9jdW1lbnQoKTsNCiAgICAgICAgICAgIE1ldHJpY19UeXBlJiBfZnJvbURvY3VtZW50KHVuc2lnbmVkIGNoYXIqIG9iaik7DQogICAgICAgICAgICBNZXRyaWNfVHlwZSYgX2Zyb21Eb2N1bWVudChzdGQ6OnN0cmluZyBvYmopOw0KICAgICAgICAgICAgTWV0cmljX1R5cGUmIF9mcm9tRG9jdW1lbnQoanNvbiBvYmopOw0KICAgICAgICAgICAgc3RkOjp2ZWN0b3I8TWV0cmljX1R5cGU+JiYgX2Zyb21Eb2N1bWVudChzdGQ6OnZlY3Rvcjxqc29uPiYmIG9iaik7DQogICAgDQogICAgICAgIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6TWV0cmljX1R5cGUmIHN0b3JlKCk7DQogICAgDQogICAgICAgIHN0ZDo6dmVjdG9yPGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6TWV0cmljX1R5cGU+JiBmaW5kQWxsKCk7DQogICAgDQogICAgICAgIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6TWV0cmljX1R5cGUmIGZpbmQoKTsNCiAgICANCiAgICB9Ow0KICAgIA0KICAgIGNsYXNzIFR5cGVfQXR0cmlidXRlew0KICAgICAgICBwdWJsaWM6DQogICAgICAgICAgICBUeXBlX0F0dHJpYnV0ZSgpew0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICAgIH5UeXBlX0F0dHJpYnV0ZSgpew0KICAgICAgICAgICAgICAgIC8vIGZvciBldmVyeSAibmV3IiB0aGVyZSBtdXN0IGJlIGEgImRlbGV0ZSINCiAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIHByaXZhdGU6DQogICAgICAgICAgICB1bnNpZ25lZCBsb25nIElkOw0KDQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIFR5cGVfQXR0cmlidXRlLmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHByaXZhdGU6DQogICAgICAgICAgICBib29sIF9hY3RpdmU7DQogICAgICAgICAgICANCiAgICAgICAgcHVibGljOg0KICAgICAgICAgICAgYm9vbCBhY3RpdmUoKTsNCiAgICAgICAgICAgIFR5cGVfQXR0cmlidXRlJiBhY3RpdmUoYm9vbCB2KTsNCiAgICAgICAgDQogICAgICAgIC8qKioqKioqKioqKioqIFR5cGVfQXR0cmlidXRlLmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIFR5cGVfQXR0cmlidXRlLmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBwcml2YXRlOg0KICAgICAgICAgICAgYm9vbCBfZW5hYmxlZDsNCiAgICAgICAgICAgIA0KICAgICAgICBwdWJsaWM6DQogICAgICAgICAgICBib29sIGVuYWJsZWQoKTsNCiAgICAgICAgICAgIFR5cGVfQXR0cmlidXRlJiBlbmFibGVkKGJvb2wgdik7DQogICAgICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBUeXBlX0F0dHJpYnV0ZS5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogVHlwZV9BdHRyaWJ1dGUuY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHByaXZhdGU6DQogICAgICAgICAgICBzdGQ6OnN0cmluZyBfY29kZTsNCiAgICAgICAgICAgIA0KICAgICAgICBwdWJsaWM6DQogICAgICAgICAgICBzdGQ6OnN0cmluZyBjb2RlKCk7DQogICAgICAgICAgICBUeXBlX0F0dHJpYnV0ZSYgY29kZShzdGQ6OnN0cmluZyB2KTsNCiAgICAgICAgDQogICAgICAgIC8qKioqKioqKioqKioqIFR5cGVfQXR0cmlidXRlLmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBUeXBlX0F0dHJpYnV0ZS5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHByaXZhdGU6DQogICAgICAgICAgICBpbnQgX29yZGVyOw0KICAgICAgICAgICAgDQogICAgICAgIHB1YmxpYzoNCiAgICAgICAgICAgIGludCBvcmRlcigpOw0KICAgICAgICAgICAgVHlwZV9BdHRyaWJ1dGUmIG9yZGVyKGludCB2KTsNCiAgICAgICAgDQogICAgICAgIC8qKioqKioqKioqKioqIFR5cGVfQXR0cmlidXRlLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogVHlwZV9BdHRyaWJ1dGUuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHByaXZhdGU6DQogICAgICAgICAgICB0aW1lX3QgX2RhdGU7DQogICAgICAgICAgICANCiAgICAgICAgcHVibGljOg0KICAgICAgICAgICAgdGltZV90IGRhdGUoKTsNCiAgICAgICAgICAgIFR5cGVfQXR0cmlidXRlJiBkYXRlKHRpbWVfdCB2KTsNCiAgICAgICAgDQogICAgICAgIC8qKioqKioqKioqKioqIFR5cGVfQXR0cmlidXRlLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBUeXBlX0F0dHJpYnV0ZS5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgcHJpdmF0ZToNCiAgICAgICAgICAgIHN0ZDo6c3RyaW5nIF9uYW1lOw0KICAgICAgICAgICAgDQogICAgICAgIHB1YmxpYzoNCiAgICAgICAgICAgIHN0ZDo6c3RyaW5nIG5hbWUoKTsNCiAgICAgICAgICAgIFR5cGVfQXR0cmlidXRlJiBuYW1lKHN0ZDo6c3RyaW5nIHYpOw0KICAgICAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogVHlwZV9BdHRyaWJ1dGUubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIFR5cGVfQXR0cmlidXRlLnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHByaXZhdGU6DQogICAgICAgICAgICBzdGQ6OnN0cmluZyBfcmVtYXJrOw0KICAgICAgICAgICAgDQogICAgICAgIHB1YmxpYzoNCiAgICAgICAgICAgIHN0ZDo6c3RyaW5nIHJlbWFyaygpOw0KICAgICAgICAgICAgVHlwZV9BdHRyaWJ1dGUmIHJlbWFyayhzdGQ6OnN0cmluZyB2KTsNCiAgICAgICAgDQogICAgICAgICAgICBUeXBlX0F0dHJpYnV0ZSYgcmVtYXJrKGpzb24gdik7DQogICAgICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBUeXBlX0F0dHJpYnV0ZS5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBUeXBlX0F0dHJpYnV0ZS5kZXZpY2VUeXBlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgcHJpdmF0ZToNCiAgICAgICAgICAgIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6RGV2aWNlX1R5cGUqIF9kZXZpY2VUeXBlOw0KICAgICAgICAgICAgDQogICAgICAgIHB1YmxpYzoNCiAgICAgICAgICAgIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6RGV2aWNlX1R5cGUqIGRldmljZVR5cGUoKTsNCiAgICAgICAgICAgIFR5cGVfQXR0cmlidXRlJiBkZXZpY2VUeXBlKGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6RGV2aWNlX1R5cGUmIHYpOw0KICAgICAgICANCiAgICAgICAgICAgIFR5cGVfQXR0cmlidXRlJiBkZXZpY2VUeXBlKGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6RGV2aWNlX1R5cGUqIHYpOw0KICAgICAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogVHlwZV9BdHRyaWJ1dGUuZGV2aWNlVHlwZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgDQoNCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogVHlwZV9BdHRyaWJ1dGUuYXR0cmlidXRlX0RldmljZV9BdHRyaWJ1dGVzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCg0KICAgICAgICBwcml2YXRlOg0KICAgICAgICAgICAgc3RkOjp2ZWN0b3I8c3RkOjphbnk+KiBfYXR0cmlidXRlX0RldmljZV9BdHRyaWJ1dGVzOw0KICAgICAgICANCiAgICAgICAgcHVibGljOg0KICAgICAgICAgICAgc3RkOjp2ZWN0b3I8c3RkOjphbnk+JiYgYXR0cmlidXRlX0RldmljZV9BdHRyaWJ1dGVzKCk7DQogICAgICAgICAgICBUeXBlX0F0dHJpYnV0ZSYgYXR0cmlidXRlX0RldmljZV9BdHRyaWJ1dGVzKHN0ZDo6dmVjdG9yPHN0ZDo6YW55PiYmIHYpOw0KICAgICAgICAvKioqKioqKioqKioqKiBUeXBlX0F0dHJpYnV0ZS5hdHRyaWJ1dGVfRGV2aWNlX0F0dHJpYnV0ZXMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgIA0KDQogICAgICAgIHB1YmxpYzoNCiAgICAgICAgICAgIFR5cGVfQXR0cmlidXRlJiBfdW5pcXVlKCk7DQogICAgICAgICAgICBzdGQ6OnN0cmluZyBfdG9Eb2N1bWVudCgpOw0KICAgICAgICAgICAgVHlwZV9BdHRyaWJ1dGUmIF9mcm9tRG9jdW1lbnQodW5zaWduZWQgY2hhciogb2JqKTsNCiAgICAgICAgICAgIFR5cGVfQXR0cmlidXRlJiBfZnJvbURvY3VtZW50KHN0ZDo6c3RyaW5nIG9iaik7DQogICAgICAgICAgICBUeXBlX0F0dHJpYnV0ZSYgX2Zyb21Eb2N1bWVudChqc29uIG9iaik7DQogICAgICAgICAgICBzdGQ6OnZlY3RvcjxUeXBlX0F0dHJpYnV0ZT4mJiBfZnJvbURvY3VtZW50KHN0ZDo6dmVjdG9yPGpzb24+JiYgb2JqKTsNCiAgICANCiAgICAgICAgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpUeXBlX0F0dHJpYnV0ZSYgc3RvcmUoKTsNCiAgICANCiAgICAgICAgc3RkOjp2ZWN0b3I8ZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpUeXBlX0F0dHJpYnV0ZT4mIGZpbmRBbGwoKTsNCiAgICANCiAgICAgICAgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpUeXBlX0F0dHJpYnV0ZSYgZmluZCgpOw0KICAgIA0KICAgIH07DQogICAgDQogICAgY2xhc3MgTWV0cmljew0KICAgICAgICBwdWJsaWM6DQogICAgICAgICAgICBNZXRyaWMoKXsNCiAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICB+TWV0cmljKCl7DQogICAgICAgICAgICAgICAgLy8gZm9yIGV2ZXJ5ICJuZXciIHRoZXJlIG11c3QgYmUgYSAiZGVsZXRlIg0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgcHJpdmF0ZToNCiAgICAgICAgICAgIHVuc2lnbmVkIGxvbmcgSWQ7DQoNCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTWV0cmljLmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHByaXZhdGU6DQogICAgICAgICAgICBib29sIF9hY3RpdmU7DQogICAgICAgICAgICANCiAgICAgICAgcHVibGljOg0KICAgICAgICAgICAgYm9vbCBhY3RpdmUoKTsNCiAgICAgICAgICAgIE1ldHJpYyYgYWN0aXZlKGJvb2wgdik7DQogICAgICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBNZXRyaWMuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTWV0cmljLmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBwcml2YXRlOg0KICAgICAgICAgICAgYm9vbCBfZW5hYmxlZDsNCiAgICAgICAgICAgIA0KICAgICAgICBwdWJsaWM6DQogICAgICAgICAgICBib29sIGVuYWJsZWQoKTsNCiAgICAgICAgICAgIE1ldHJpYyYgZW5hYmxlZChib29sIHYpOw0KICAgICAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTWV0cmljLmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBNZXRyaWMuY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHByaXZhdGU6DQogICAgICAgICAgICBzdGQ6OnN0cmluZyBfY29kZTsNCiAgICAgICAgICAgIA0KICAgICAgICBwdWJsaWM6DQogICAgICAgICAgICBzdGQ6OnN0cmluZyBjb2RlKCk7DQogICAgICAgICAgICBNZXRyaWMmIGNvZGUoc3RkOjpzdHJpbmcgdik7DQogICAgICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBNZXRyaWMuY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE1ldHJpYy5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHByaXZhdGU6DQogICAgICAgICAgICBpbnQgX29yZGVyOw0KICAgICAgICAgICAgDQogICAgICAgIHB1YmxpYzoNCiAgICAgICAgICAgIGludCBvcmRlcigpOw0KICAgICAgICAgICAgTWV0cmljJiBvcmRlcihpbnQgdik7DQogICAgICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBNZXRyaWMub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBNZXRyaWMuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHByaXZhdGU6DQogICAgICAgICAgICB0aW1lX3QgX2RhdGU7DQogICAgICAgICAgICANCiAgICAgICAgcHVibGljOg0KICAgICAgICAgICAgdGltZV90IGRhdGUoKTsNCiAgICAgICAgICAgIE1ldHJpYyYgZGF0ZSh0aW1lX3Qgdik7DQogICAgICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBNZXRyaWMuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE1ldHJpYy5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgcHJpdmF0ZToNCiAgICAgICAgICAgIHN0ZDo6c3RyaW5nIF9uYW1lOw0KICAgICAgICAgICAgDQogICAgICAgIHB1YmxpYzoNCiAgICAgICAgICAgIHN0ZDo6c3RyaW5nIG5hbWUoKTsNCiAgICAgICAgICAgIE1ldHJpYyYgbmFtZShzdGQ6OnN0cmluZyB2KTsNCiAgICAgICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE1ldHJpYy5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTWV0cmljLnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHByaXZhdGU6DQogICAgICAgICAgICBzdGQ6OnN0cmluZyBfcmVtYXJrOw0KICAgICAgICAgICAgDQogICAgICAgIHB1YmxpYzoNCiAgICAgICAgICAgIHN0ZDo6c3RyaW5nIHJlbWFyaygpOw0KICAgICAgICAgICAgTWV0cmljJiByZW1hcmsoc3RkOjpzdHJpbmcgdik7DQogICAgICAgIA0KICAgICAgICAgICAgTWV0cmljJiByZW1hcmsoanNvbiB2KTsNCiAgICAgICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE1ldHJpYy5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBNZXRyaWMuc2NyaXB0IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgcHJpdmF0ZToNCiAgICAgICAgICAgIHN0ZDo6c3RyaW5nIF9zY3JpcHQ7DQogICAgICAgICAgICANCiAgICAgICAgcHVibGljOg0KICAgICAgICAgICAgc3RkOjpzdHJpbmcgc2NyaXB0KCk7DQogICAgICAgICAgICBNZXRyaWMmIHNjcmlwdChzdGQ6OnN0cmluZyB2KTsNCiAgICAgICAgDQogICAgICAgICAgICBNZXRyaWMmIHNjcmlwdChqc29uIHYpOw0KICAgICAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTWV0cmljLnNjcmlwdCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE1ldHJpYy50eXBlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgcHJpdmF0ZToNCiAgICAgICAgICAgIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6TWV0cmljX1R5cGUqIF90eXBlOw0KICAgICAgICAgICAgDQogICAgICAgIHB1YmxpYzoNCiAgICAgICAgICAgIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6TWV0cmljX1R5cGUqIHR5cGUoKTsNCiAgICAgICAgICAgIE1ldHJpYyYgdHlwZShlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6Ok1ldHJpY19UeXBlJiB2KTsNCiAgICAgICAgDQogICAgICAgICAgICBNZXRyaWMmIHR5cGUoZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpNZXRyaWNfVHlwZSogdik7DQogICAgICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBNZXRyaWMudHlwZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE1ldHJpYy5kZXZpY2VUeXBlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgcHJpdmF0ZToNCiAgICAgICAgICAgIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6RGV2aWNlX1R5cGUqIF9kZXZpY2VUeXBlOw0KICAgICAgICAgICAgDQogICAgICAgIHB1YmxpYzoNCiAgICAgICAgICAgIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6RGV2aWNlX1R5cGUqIGRldmljZVR5cGUoKTsNCiAgICAgICAgICAgIE1ldHJpYyYgZGV2aWNlVHlwZShlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZV9UeXBlJiB2KTsNCiAgICAgICAgDQogICAgICAgICAgICBNZXRyaWMmIGRldmljZVR5cGUoZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpEZXZpY2VfVHlwZSogdik7DQogICAgICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBNZXRyaWMuZGV2aWNlVHlwZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgDQoNCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTWV0cmljLm1ldHJpY19NZXRyaWNfVmFsdWVzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCg0KICAgICAgICBwcml2YXRlOg0KICAgICAgICAgICAgc3RkOjp2ZWN0b3I8c3RkOjphbnk+KiBfbWV0cmljX01ldHJpY19WYWx1ZXM7DQogICAgICAgIA0KICAgICAgICBwdWJsaWM6DQogICAgICAgICAgICBzdGQ6OnZlY3RvcjxzdGQ6OmFueT4mJiBtZXRyaWNfTWV0cmljX1ZhbHVlcygpOw0KICAgICAgICAgICAgTWV0cmljJiBtZXRyaWNfTWV0cmljX1ZhbHVlcyhzdGQ6OnZlY3RvcjxzdGQ6OmFueT4mJiB2KTsNCiAgICAgICAgLyoqKioqKioqKioqKiogTWV0cmljLm1ldHJpY19NZXRyaWNfVmFsdWVzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICANCg0KICAgICAgICBwdWJsaWM6DQogICAgICAgICAgICBNZXRyaWMmIF91bmlxdWUoKTsNCiAgICAgICAgICAgIHN0ZDo6c3RyaW5nIF90b0RvY3VtZW50KCk7DQogICAgICAgICAgICBNZXRyaWMmIF9mcm9tRG9jdW1lbnQodW5zaWduZWQgY2hhciogb2JqKTsNCiAgICAgICAgICAgIE1ldHJpYyYgX2Zyb21Eb2N1bWVudChzdGQ6OnN0cmluZyBvYmopOw0KICAgICAgICAgICAgTWV0cmljJiBfZnJvbURvY3VtZW50KGpzb24gb2JqKTsNCiAgICAgICAgICAgIHN0ZDo6dmVjdG9yPE1ldHJpYz4mJiBfZnJvbURvY3VtZW50KHN0ZDo6dmVjdG9yPGpzb24+JiYgb2JqKTsNCiAgICANCiAgICAgICAgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpNZXRyaWMmIHN0b3JlKCk7DQogICAgDQogICAgICAgIHN0ZDo6dmVjdG9yPGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6TWV0cmljPiYgZmluZEFsbCgpOw0KICAgIA0KICAgICAgICBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6Ok1ldHJpYyYgZmluZCgpOw0KICAgIA0KICAgIH07DQogICAgDQogICAgY2xhc3MgRGV2aWNlew0KICAgICAgICBwdWJsaWM6DQogICAgICAgICAgICBEZXZpY2UoKXsNCiAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICB+RGV2aWNlKCl7DQogICAgICAgICAgICAgICAgLy8gZm9yIGV2ZXJ5ICJuZXciIHRoZXJlIG11c3QgYmUgYSAiZGVsZXRlIg0KICAgICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgcHJpdmF0ZToNCiAgICAgICAgICAgIHVuc2lnbmVkIGxvbmcgSWQ7DQoNCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogRGV2aWNlLmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHByaXZhdGU6DQogICAgICAgICAgICBib29sIF9hY3RpdmU7DQogICAgICAgICAgICANCiAgICAgICAgcHVibGljOg0KICAgICAgICAgICAgYm9vbCBhY3RpdmUoKTsNCiAgICAgICAgICAgIERldmljZSYgYWN0aXZlKGJvb2wgdik7DQogICAgICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBEZXZpY2UuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogRGV2aWNlLmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBwcml2YXRlOg0KICAgICAgICAgICAgYm9vbCBfZW5hYmxlZDsNCiAgICAgICAgICAgIA0KICAgICAgICBwdWJsaWM6DQogICAgICAgICAgICBib29sIGVuYWJsZWQoKTsNCiAgICAgICAgICAgIERldmljZSYgZW5hYmxlZChib29sIHYpOw0KICAgICAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogRGV2aWNlLmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBEZXZpY2UuY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHByaXZhdGU6DQogICAgICAgICAgICBzdGQ6OnN0cmluZyBfY29kZTsNCiAgICAgICAgICAgIA0KICAgICAgICBwdWJsaWM6DQogICAgICAgICAgICBzdGQ6OnN0cmluZyBjb2RlKCk7DQogICAgICAgICAgICBEZXZpY2UmIGNvZGUoc3RkOjpzdHJpbmcgdik7DQogICAgICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBEZXZpY2UuY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIERldmljZS5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHByaXZhdGU6DQogICAgICAgICAgICBpbnQgX29yZGVyOw0KICAgICAgICAgICAgDQogICAgICAgIHB1YmxpYzoNCiAgICAgICAgICAgIGludCBvcmRlcigpOw0KICAgICAgICAgICAgRGV2aWNlJiBvcmRlcihpbnQgdik7DQogICAgICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBEZXZpY2Uub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBEZXZpY2UuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHByaXZhdGU6DQogICAgICAgICAgICB0aW1lX3QgX2RhdGU7DQogICAgICAgICAgICANCiAgICAgICAgcHVibGljOg0KICAgICAgICAgICAgdGltZV90IGRhdGUoKTsNCiAgICAgICAgICAgIERldmljZSYgZGF0ZSh0aW1lX3Qgdik7DQogICAgICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBEZXZpY2UuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIERldmljZS5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgcHJpdmF0ZToNCiAgICAgICAgICAgIHN0ZDo6c3RyaW5nIF9uYW1lOw0KICAgICAgICAgICAgDQogICAgICAgIHB1YmxpYzoNCiAgICAgICAgICAgIHN0ZDo6c3RyaW5nIG5hbWUoKTsNCiAgICAgICAgICAgIERldmljZSYgbmFtZShzdGQ6OnN0cmluZyB2KTsNCiAgICAgICAgDQogICAgICAgIC8qKioqKioqKioqKioqIERldmljZS5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogRGV2aWNlLnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHByaXZhdGU6DQogICAgICAgICAgICBzdGQ6OnN0cmluZyBfcmVtYXJrOw0KICAgICAgICAgICAgDQogICAgICAgIHB1YmxpYzoNCiAgICAgICAgICAgIHN0ZDo6c3RyaW5nIHJlbWFyaygpOw0KICAgICAgICAgICAgRGV2aWNlJiByZW1hcmsoc3RkOjpzdHJpbmcgdik7DQogICAgICAgIA0KICAgICAgICAgICAgRGV2aWNlJiByZW1hcmsoanNvbiB2KTsNCiAgICAgICAgDQogICAgICAgIC8qKioqKioqKioqKioqIERldmljZS5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBEZXZpY2UudHlwZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHByaXZhdGU6DQogICAgICAgICAgICBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZV9UeXBlKiBfdHlwZTsNCiAgICAgICAgICAgIA0KICAgICAgICBwdWJsaWM6DQogICAgICAgICAgICBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZV9UeXBlKiB0eXBlKCk7DQogICAgICAgICAgICBEZXZpY2UmIHR5cGUoZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpEZXZpY2VfVHlwZSYgdik7DQogICAgICAgIA0KICAgICAgICAgICAgRGV2aWNlJiB0eXBlKGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6RGV2aWNlX1R5cGUqIHYpOw0KICAgICAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogRGV2aWNlLnR5cGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBEZXZpY2UuY29udHJvbGxlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHByaXZhdGU6DQogICAgICAgICAgICBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGUqIF9jb250cm9sbGVyOw0KICAgICAgICAgICAgDQogICAgICAgIHB1YmxpYzoNCiAgICAgICAgICAgIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZSogY29udHJvbGxlcigpOw0KICAgICAgICAgICAgRGV2aWNlJiBjb250cm9sbGVyKGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZSYgdik7DQogICAgICAgIA0KICAgICAgICAgICAgRGV2aWNlJiBjb250cm9sbGVyKGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZSogdik7DQogICAgICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBEZXZpY2UuY29udHJvbGxlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgDQoNCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogRGV2aWNlLmRldmljZV9NZXRyaWNfVmFsdWVzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCg0KICAgICAgICBwcml2YXRlOg0KICAgICAgICAgICAgc3RkOjp2ZWN0b3I8c3RkOjphbnk+KiBfZGV2aWNlX01ldHJpY19WYWx1ZXM7DQogICAgICAgIA0KICAgICAgICBwdWJsaWM6DQogICAgICAgICAgICBzdGQ6OnZlY3RvcjxzdGQ6OmFueT4mJiBkZXZpY2VfTWV0cmljX1ZhbHVlcygpOw0KICAgICAgICAgICAgRGV2aWNlJiBkZXZpY2VfTWV0cmljX1ZhbHVlcyhzdGQ6OnZlY3RvcjxzdGQ6OmFueT4mJiB2KTsNCiAgICAgICAgLyoqKioqKioqKioqKiogRGV2aWNlLmRldmljZV9NZXRyaWNfVmFsdWVzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogRGV2aWNlLmRldmljZV9EZXZpY2VfQXR0cmlidXRlcyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQoNCiAgICAgICAgcHJpdmF0ZToNCiAgICAgICAgICAgIHN0ZDo6dmVjdG9yPHN0ZDo6YW55PiogX2RldmljZV9EZXZpY2VfQXR0cmlidXRlczsNCiAgICAgICAgDQogICAgICAgIHB1YmxpYzoNCiAgICAgICAgICAgIHN0ZDo6dmVjdG9yPHN0ZDo6YW55PiYmIGRldmljZV9EZXZpY2VfQXR0cmlidXRlcygpOw0KICAgICAgICAgICAgRGV2aWNlJiBkZXZpY2VfRGV2aWNlX0F0dHJpYnV0ZXMoc3RkOjp2ZWN0b3I8c3RkOjphbnk+JiYgdik7DQogICAgICAgIC8qKioqKioqKioqKioqIERldmljZS5kZXZpY2VfRGV2aWNlX0F0dHJpYnV0ZXMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgIA0KDQogICAgICAgIHB1YmxpYzoNCiAgICAgICAgICAgIERldmljZSYgX3VuaXF1ZSgpOw0KICAgICAgICAgICAgc3RkOjpzdHJpbmcgX3RvRG9jdW1lbnQoKTsNCiAgICAgICAgICAgIERldmljZSYgX2Zyb21Eb2N1bWVudCh1bnNpZ25lZCBjaGFyKiBvYmopOw0KICAgICAgICAgICAgRGV2aWNlJiBfZnJvbURvY3VtZW50KHN0ZDo6c3RyaW5nIG9iaik7DQogICAgICAgICAgICBEZXZpY2UmIF9mcm9tRG9jdW1lbnQoanNvbiBvYmopOw0KICAgICAgICAgICAgc3RkOjp2ZWN0b3I8RGV2aWNlPiYmIF9mcm9tRG9jdW1lbnQoc3RkOjp2ZWN0b3I8anNvbj4mJiBvYmopOw0KICAgIA0KICAgICAgICBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZSYgc3RvcmUoKTsNCiAgICANCiAgICAgICAgc3RkOjp2ZWN0b3I8ZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpEZXZpY2U+JiBmaW5kQWxsKCk7DQogICAgDQogICAgICAgIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6RGV2aWNlJiBmaW5kKCk7DQogICAgDQogICAgfTsNCiAgICANCiAgICBjbGFzcyBEZXZpY2VfQXR0cmlidXRlew0KICAgICAgICBwdWJsaWM6DQogICAgICAgICAgICBEZXZpY2VfQXR0cmlidXRlKCl7DQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgfkRldmljZV9BdHRyaWJ1dGUoKXsNCiAgICAgICAgICAgICAgICAvLyBmb3IgZXZlcnkgIm5ldyIgdGhlcmUgbXVzdCBiZSBhICJkZWxldGUiDQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICBwcml2YXRlOg0KICAgICAgICAgICAgdW5zaWduZWQgbG9uZyBJZDsNCg0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBEZXZpY2VfQXR0cmlidXRlLmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHByaXZhdGU6DQogICAgICAgICAgICBib29sIF9hY3RpdmU7DQogICAgICAgICAgICANCiAgICAgICAgcHVibGljOg0KICAgICAgICAgICAgYm9vbCBhY3RpdmUoKTsNCiAgICAgICAgICAgIERldmljZV9BdHRyaWJ1dGUmIGFjdGl2ZShib29sIHYpOw0KICAgICAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogRGV2aWNlX0F0dHJpYnV0ZS5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBEZXZpY2VfQXR0cmlidXRlLmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBwcml2YXRlOg0KICAgICAgICAgICAgYm9vbCBfZW5hYmxlZDsNCiAgICAgICAgICAgIA0KICAgICAgICBwdWJsaWM6DQogICAgICAgICAgICBib29sIGVuYWJsZWQoKTsNCiAgICAgICAgICAgIERldmljZV9BdHRyaWJ1dGUmIGVuYWJsZWQoYm9vbCB2KTsNCiAgICAgICAgDQogICAgICAgIC8qKioqKioqKioqKioqIERldmljZV9BdHRyaWJ1dGUuZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIERldmljZV9BdHRyaWJ1dGUuY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHByaXZhdGU6DQogICAgICAgICAgICBzdGQ6OnN0cmluZyBfY29kZTsNCiAgICAgICAgICAgIA0KICAgICAgICBwdWJsaWM6DQogICAgICAgICAgICBzdGQ6OnN0cmluZyBjb2RlKCk7DQogICAgICAgICAgICBEZXZpY2VfQXR0cmlidXRlJiBjb2RlKHN0ZDo6c3RyaW5nIHYpOw0KICAgICAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogRGV2aWNlX0F0dHJpYnV0ZS5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogRGV2aWNlX0F0dHJpYnV0ZS5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHByaXZhdGU6DQogICAgICAgICAgICBpbnQgX29yZGVyOw0KICAgICAgICAgICAgDQogICAgICAgIHB1YmxpYzoNCiAgICAgICAgICAgIGludCBvcmRlcigpOw0KICAgICAgICAgICAgRGV2aWNlX0F0dHJpYnV0ZSYgb3JkZXIoaW50IHYpOw0KICAgICAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogRGV2aWNlX0F0dHJpYnV0ZS5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIERldmljZV9BdHRyaWJ1dGUuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHByaXZhdGU6DQogICAgICAgICAgICB0aW1lX3QgX2RhdGU7DQogICAgICAgICAgICANCiAgICAgICAgcHVibGljOg0KICAgICAgICAgICAgdGltZV90IGRhdGUoKTsNCiAgICAgICAgICAgIERldmljZV9BdHRyaWJ1dGUmIGRhdGUodGltZV90IHYpOw0KICAgICAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogRGV2aWNlX0F0dHJpYnV0ZS5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogRGV2aWNlX0F0dHJpYnV0ZS5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgcHJpdmF0ZToNCiAgICAgICAgICAgIHN0ZDo6c3RyaW5nIF9uYW1lOw0KICAgICAgICAgICAgDQogICAgICAgIHB1YmxpYzoNCiAgICAgICAgICAgIHN0ZDo6c3RyaW5nIG5hbWUoKTsNCiAgICAgICAgICAgIERldmljZV9BdHRyaWJ1dGUmIG5hbWUoc3RkOjpzdHJpbmcgdik7DQogICAgICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBEZXZpY2VfQXR0cmlidXRlLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBEZXZpY2VfQXR0cmlidXRlLnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHByaXZhdGU6DQogICAgICAgICAgICBzdGQ6OnN0cmluZyBfcmVtYXJrOw0KICAgICAgICAgICAgDQogICAgICAgIHB1YmxpYzoNCiAgICAgICAgICAgIHN0ZDo6c3RyaW5nIHJlbWFyaygpOw0KICAgICAgICAgICAgRGV2aWNlX0F0dHJpYnV0ZSYgcmVtYXJrKHN0ZDo6c3RyaW5nIHYpOw0KICAgICAgICANCiAgICAgICAgICAgIERldmljZV9BdHRyaWJ1dGUmIHJlbWFyayhqc29uIHYpOw0KICAgICAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogRGV2aWNlX0F0dHJpYnV0ZS5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBEZXZpY2VfQXR0cmlidXRlLnZhbHVlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgcHJpdmF0ZToNCiAgICAgICAgICAgIHN0ZDo6c3RyaW5nIF92YWx1ZTsNCiAgICAgICAgICAgIA0KICAgICAgICBwdWJsaWM6DQogICAgICAgICAgICBzdGQ6OnN0cmluZyB2YWx1ZSgpOw0KICAgICAgICAgICAgRGV2aWNlX0F0dHJpYnV0ZSYgdmFsdWUoc3RkOjpzdHJpbmcgdik7DQogICAgICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBEZXZpY2VfQXR0cmlidXRlLnZhbHVlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogRGV2aWNlX0F0dHJpYnV0ZS5kZXZpY2UgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBwcml2YXRlOg0KICAgICAgICAgICAgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpEZXZpY2UqIF9kZXZpY2U7DQogICAgICAgICAgICANCiAgICAgICAgcHVibGljOg0KICAgICAgICAgICAgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpEZXZpY2UqIGRldmljZSgpOw0KICAgICAgICAgICAgRGV2aWNlX0F0dHJpYnV0ZSYgZGV2aWNlKGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6RGV2aWNlJiB2KTsNCiAgICAgICAgDQogICAgICAgICAgICBEZXZpY2VfQXR0cmlidXRlJiBkZXZpY2UoZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpEZXZpY2UqIHYpOw0KICAgICAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogRGV2aWNlX0F0dHJpYnV0ZS5kZXZpY2UgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBEZXZpY2VfQXR0cmlidXRlLmF0dHJpYnV0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHByaXZhdGU6DQogICAgICAgICAgICBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OlR5cGVfQXR0cmlidXRlKiBfYXR0cmlidXRlOw0KICAgICAgICAgICAgDQogICAgICAgIHB1YmxpYzoNCiAgICAgICAgICAgIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6VHlwZV9BdHRyaWJ1dGUqIGF0dHJpYnV0ZSgpOw0KICAgICAgICAgICAgRGV2aWNlX0F0dHJpYnV0ZSYgYXR0cmlidXRlKGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6VHlwZV9BdHRyaWJ1dGUmIHYpOw0KICAgICAgICANCiAgICAgICAgICAgIERldmljZV9BdHRyaWJ1dGUmIGF0dHJpYnV0ZShlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OlR5cGVfQXR0cmlidXRlKiB2KTsNCiAgICAgICAgDQogICAgICAgIC8qKioqKioqKioqKioqIERldmljZV9BdHRyaWJ1dGUuYXR0cmlidXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICANCg0KICAgIA0KDQogICAgICAgIHB1YmxpYzoNCiAgICAgICAgICAgIERldmljZV9BdHRyaWJ1dGUmIF91bmlxdWUoKTsNCiAgICAgICAgICAgIHN0ZDo6c3RyaW5nIF90b0RvY3VtZW50KCk7DQogICAgICAgICAgICBEZXZpY2VfQXR0cmlidXRlJiBfZnJvbURvY3VtZW50KHVuc2lnbmVkIGNoYXIqIG9iaik7DQogICAgICAgICAgICBEZXZpY2VfQXR0cmlidXRlJiBfZnJvbURvY3VtZW50KHN0ZDo6c3RyaW5nIG9iaik7DQogICAgICAgICAgICBEZXZpY2VfQXR0cmlidXRlJiBfZnJvbURvY3VtZW50KGpzb24gb2JqKTsNCiAgICAgICAgICAgIHN0ZDo6dmVjdG9yPERldmljZV9BdHRyaWJ1dGU+JiYgX2Zyb21Eb2N1bWVudChzdGQ6OnZlY3Rvcjxqc29uPiYmIG9iaik7DQogICAgDQogICAgICAgIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6RGV2aWNlX0F0dHJpYnV0ZSYgc3RvcmUoKTsNCiAgICANCiAgICAgICAgc3RkOjp2ZWN0b3I8ZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpEZXZpY2VfQXR0cmlidXRlPiYgZmluZEFsbCgpOw0KICAgIA0KICAgICAgICBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZV9BdHRyaWJ1dGUmIGZpbmQoKTsNCiAgICANCiAgICB9Ow0KICAgIA0KICAgIGNsYXNzIE1ldHJpY19WYWx1ZXsNCiAgICAgICAgcHVibGljOg0KICAgICAgICAgICAgTWV0cmljX1ZhbHVlKCl7DQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgfk1ldHJpY19WYWx1ZSgpew0KICAgICAgICAgICAgICAgIC8vIGZvciBldmVyeSAibmV3IiB0aGVyZSBtdXN0IGJlIGEgImRlbGV0ZSINCiAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIHByaXZhdGU6DQogICAgICAgICAgICB1bnNpZ25lZCBsb25nIElkOw0KDQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE1ldHJpY19WYWx1ZS5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBwcml2YXRlOg0KICAgICAgICAgICAgYm9vbCBfYWN0aXZlOw0KICAgICAgICAgICAgDQogICAgICAgIHB1YmxpYzoNCiAgICAgICAgICAgIGJvb2wgYWN0aXZlKCk7DQogICAgICAgICAgICBNZXRyaWNfVmFsdWUmIGFjdGl2ZShib29sIHYpOw0KICAgICAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTWV0cmljX1ZhbHVlLmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE1ldHJpY19WYWx1ZS5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgcHJpdmF0ZToNCiAgICAgICAgICAgIGJvb2wgX2VuYWJsZWQ7DQogICAgICAgICAgICANCiAgICAgICAgcHVibGljOg0KICAgICAgICAgICAgYm9vbCBlbmFibGVkKCk7DQogICAgICAgICAgICBNZXRyaWNfVmFsdWUmIGVuYWJsZWQoYm9vbCB2KTsNCiAgICAgICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE1ldHJpY19WYWx1ZS5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTWV0cmljX1ZhbHVlLmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBwcml2YXRlOg0KICAgICAgICAgICAgc3RkOjpzdHJpbmcgX2NvZGU7DQogICAgICAgICAgICANCiAgICAgICAgcHVibGljOg0KICAgICAgICAgICAgc3RkOjpzdHJpbmcgY29kZSgpOw0KICAgICAgICAgICAgTWV0cmljX1ZhbHVlJiBjb2RlKHN0ZDo6c3RyaW5nIHYpOw0KICAgICAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTWV0cmljX1ZhbHVlLmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBNZXRyaWNfVmFsdWUub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBwcml2YXRlOg0KICAgICAgICAgICAgaW50IF9vcmRlcjsNCiAgICAgICAgICAgIA0KICAgICAgICBwdWJsaWM6DQogICAgICAgICAgICBpbnQgb3JkZXIoKTsNCiAgICAgICAgICAgIE1ldHJpY19WYWx1ZSYgb3JkZXIoaW50IHYpOw0KICAgICAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTWV0cmljX1ZhbHVlLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTWV0cmljX1ZhbHVlLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBwcml2YXRlOg0KICAgICAgICAgICAgdGltZV90IF9kYXRlOw0KICAgICAgICAgICAgDQogICAgICAgIHB1YmxpYzoNCiAgICAgICAgICAgIHRpbWVfdCBkYXRlKCk7DQogICAgICAgICAgICBNZXRyaWNfVmFsdWUmIGRhdGUodGltZV90IHYpOw0KICAgICAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTWV0cmljX1ZhbHVlLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBNZXRyaWNfVmFsdWUubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHByaXZhdGU6DQogICAgICAgICAgICBzdGQ6OnN0cmluZyBfbmFtZTsNCiAgICAgICAgICAgIA0KICAgICAgICBwdWJsaWM6DQogICAgICAgICAgICBzdGQ6OnN0cmluZyBuYW1lKCk7DQogICAgICAgICAgICBNZXRyaWNfVmFsdWUmIG5hbWUoc3RkOjpzdHJpbmcgdik7DQogICAgICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBNZXRyaWNfVmFsdWUubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE1ldHJpY19WYWx1ZS5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBwcml2YXRlOg0KICAgICAgICAgICAgc3RkOjpzdHJpbmcgX3JlbWFyazsNCiAgICAgICAgICAgIA0KICAgICAgICBwdWJsaWM6DQogICAgICAgICAgICBzdGQ6OnN0cmluZyByZW1hcmsoKTsNCiAgICAgICAgICAgIE1ldHJpY19WYWx1ZSYgcmVtYXJrKHN0ZDo6c3RyaW5nIHYpOw0KICAgICAgICANCiAgICAgICAgICAgIE1ldHJpY19WYWx1ZSYgcmVtYXJrKGpzb24gdik7DQogICAgICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBNZXRyaWNfVmFsdWUucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTWV0cmljX1ZhbHVlLnZhbHVlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgcHJpdmF0ZToNCiAgICAgICAgICAgIHN0ZDo6c3RyaW5nIF92YWx1ZTsNCiAgICAgICAgICAgIA0KICAgICAgICBwdWJsaWM6DQogICAgICAgICAgICBzdGQ6OnN0cmluZyB2YWx1ZSgpOw0KICAgICAgICAgICAgTWV0cmljX1ZhbHVlJiB2YWx1ZShzdGQ6OnN0cmluZyB2KTsNCiAgICAgICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE1ldHJpY19WYWx1ZS52YWx1ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIE1ldHJpY19WYWx1ZS5tZWFzdXJlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHByaXZhdGU6DQogICAgICAgICAgICB0aW1lX3QgX21lYXN1cmVkOw0KICAgICAgICAgICAgDQogICAgICAgIHB1YmxpYzoNCiAgICAgICAgICAgIHRpbWVfdCBtZWFzdXJlZCgpOw0KICAgICAgICAgICAgTWV0cmljX1ZhbHVlJiBtZWFzdXJlZCh0aW1lX3Qgdik7DQogICAgICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBNZXRyaWNfVmFsdWUubWVhc3VyZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBNZXRyaWNfVmFsdWUubWV0cmljIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgcHJpdmF0ZToNCiAgICAgICAgICAgIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6TWV0cmljKiBfbWV0cmljOw0KICAgICAgICAgICAgDQogICAgICAgIHB1YmxpYzoNCiAgICAgICAgICAgIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6TWV0cmljKiBtZXRyaWMoKTsNCiAgICAgICAgICAgIE1ldHJpY19WYWx1ZSYgbWV0cmljKGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6TWV0cmljJiB2KTsNCiAgICAgICAgDQogICAgICAgICAgICBNZXRyaWNfVmFsdWUmIG1ldHJpYyhlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6Ok1ldHJpYyogdik7DQogICAgICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBNZXRyaWNfVmFsdWUubWV0cmljIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTWV0cmljX1ZhbHVlLmRldmljZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHByaXZhdGU6DQogICAgICAgICAgICBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZSogX2RldmljZTsNCiAgICAgICAgICAgIA0KICAgICAgICBwdWJsaWM6DQogICAgICAgICAgICBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZSogZGV2aWNlKCk7DQogICAgICAgICAgICBNZXRyaWNfVmFsdWUmIGRldmljZShlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZSYgdik7DQogICAgICAgIA0KICAgICAgICAgICAgTWV0cmljX1ZhbHVlJiBkZXZpY2UoZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpEZXZpY2UqIHYpOw0KICAgICAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogTWV0cmljX1ZhbHVlLmRldmljZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgDQoNCiAgICANCg0KICAgICAgICBwdWJsaWM6DQogICAgICAgICAgICBNZXRyaWNfVmFsdWUmIF91bmlxdWUoKTsNCiAgICAgICAgICAgIHN0ZDo6c3RyaW5nIF90b0RvY3VtZW50KCk7DQogICAgICAgICAgICBNZXRyaWNfVmFsdWUmIF9mcm9tRG9jdW1lbnQodW5zaWduZWQgY2hhciogb2JqKTsNCiAgICAgICAgICAgIE1ldHJpY19WYWx1ZSYgX2Zyb21Eb2N1bWVudChzdGQ6OnN0cmluZyBvYmopOw0KICAgICAgICAgICAgTWV0cmljX1ZhbHVlJiBfZnJvbURvY3VtZW50KGpzb24gb2JqKTsNCiAgICAgICAgICAgIHN0ZDo6dmVjdG9yPE1ldHJpY19WYWx1ZT4mJiBfZnJvbURvY3VtZW50KHN0ZDo6dmVjdG9yPGpzb24+JiYgb2JqKTsNCiAgICANCiAgICAgICAgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpNZXRyaWNfVmFsdWUmIHN0b3JlKCk7DQogICAgDQogICAgICAgIHN0ZDo6dmVjdG9yPGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6TWV0cmljX1ZhbHVlPiYgZmluZEFsbCgpOw0KICAgIA0KICAgICAgICBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6Ok1ldHJpY19WYWx1ZSYgZmluZCgpOw0KICAgIA0KICAgIH07DQogICAgDQp9CgkKfQoJCn0KCQp9CgkNCg0KbmFtZXNwYWNlIGVzcHRlc3R7CgkNCiAgICANCiAgICBjbGFzcyBVc2Vyew0KICAgICAgICBwdWJsaWM6DQogICAgICAgICAgICBVc2VyKCl7DQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgflVzZXIoKXsNCiAgICAgICAgICAgICAgICAvLyBmb3IgZXZlcnkgIm5ldyIgdGhlcmUgbXVzdCBiZSBhICJkZWxldGUiDQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICBwcml2YXRlOg0KICAgICAgICAgICAgdW5zaWduZWQgbG9uZyBJZDsNCg0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBVc2VyLmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHByaXZhdGU6DQogICAgICAgICAgICBib29sIF9hY3RpdmU7DQogICAgICAgICAgICANCiAgICAgICAgcHVibGljOg0KICAgICAgICAgICAgYm9vbCBhY3RpdmUoKTsNCiAgICAgICAgICAgIFVzZXImIGFjdGl2ZShib29sIHYpOw0KICAgICAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogVXNlci5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBVc2VyLmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgICAgICBwcml2YXRlOg0KICAgICAgICAgICAgYm9vbCBfZW5hYmxlZDsNCiAgICAgICAgICAgIA0KICAgICAgICBwdWJsaWM6DQogICAgICAgICAgICBib29sIGVuYWJsZWQoKTsNCiAgICAgICAgICAgIFVzZXImIGVuYWJsZWQoYm9vbCB2KTsNCiAgICAgICAgDQogICAgICAgIC8qKioqKioqKioqKioqIFVzZXIuZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIFVzZXIuY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHByaXZhdGU6DQogICAgICAgICAgICBzdGQ6OnN0cmluZyBfY29kZTsNCiAgICAgICAgICAgIA0KICAgICAgICBwdWJsaWM6DQogICAgICAgICAgICBzdGQ6OnN0cmluZyBjb2RlKCk7DQogICAgICAgICAgICBVc2VyJiBjb2RlKHN0ZDo6c3RyaW5nIHYpOw0KICAgICAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogVXNlci5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogVXNlci5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHByaXZhdGU6DQogICAgICAgICAgICBpbnQgX29yZGVyOw0KICAgICAgICAgICAgDQogICAgICAgIHB1YmxpYzoNCiAgICAgICAgICAgIGludCBvcmRlcigpOw0KICAgICAgICAgICAgVXNlciYgb3JkZXIoaW50IHYpOw0KICAgICAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogVXNlci5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgDQogICAgICAgIC8qKioqKioqKioqKioqIFVzZXIuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHByaXZhdGU6DQogICAgICAgICAgICB0aW1lX3QgX2RhdGU7DQogICAgICAgICAgICANCiAgICAgICAgcHVibGljOg0KICAgICAgICAgICAgdGltZV90IGRhdGUoKTsNCiAgICAgICAgICAgIFVzZXImIGRhdGUodGltZV90IHYpOw0KICAgICAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogVXNlci5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogVXNlci5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgcHJpdmF0ZToNCiAgICAgICAgICAgIHN0ZDo6c3RyaW5nIF9uYW1lOw0KICAgICAgICAgICAgDQogICAgICAgIHB1YmxpYzoNCiAgICAgICAgICAgIHN0ZDo6c3RyaW5nIG5hbWUoKTsNCiAgICAgICAgICAgIFVzZXImIG5hbWUoc3RkOjpzdHJpbmcgdik7DQogICAgICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBVc2VyLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBVc2VyLnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHByaXZhdGU6DQogICAgICAgICAgICBzdGQ6OnN0cmluZyBfcmVtYXJrOw0KICAgICAgICAgICAgDQogICAgICAgIHB1YmxpYzoNCiAgICAgICAgICAgIHN0ZDo6c3RyaW5nIHJlbWFyaygpOw0KICAgICAgICAgICAgVXNlciYgcmVtYXJrKHN0ZDo6c3RyaW5nIHYpOw0KICAgICAgICANCiAgICAgICAgICAgIFVzZXImIHJlbWFyayhqc29uIHYpOw0KICAgICAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogVXNlci5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqLw0KICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBVc2VyLnVzZXJuYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICAgICAgcHJpdmF0ZToNCiAgICAgICAgICAgIHN0ZDo6c3RyaW5nIF91c2VybmFtZTsNCiAgICAgICAgICAgIA0KICAgICAgICBwdWJsaWM6DQogICAgICAgICAgICBzdGQ6OnN0cmluZyB1c2VybmFtZSgpOw0KICAgICAgICAgICAgVXNlciYgdXNlcm5hbWUoc3RkOjpzdHJpbmcgdik7DQogICAgICAgIA0KICAgICAgICAvKioqKioqKioqKioqKiBVc2VyLnVzZXJuYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi8NCiAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogVXNlci5wYXNzd29yZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgICAgIHByaXZhdGU6DQogICAgICAgICAgICBzdGQ6OnN0cmluZyBfcGFzc3dvcmQ7DQogICAgICAgICAgICANCiAgICAgICAgcHVibGljOg0KICAgICAgICAgICAgc3RkOjpzdHJpbmcgcGFzc3dvcmQoKTsNCiAgICAgICAgICAgIFVzZXImIHBhc3N3b3JkKHN0ZDo6c3RyaW5nIHYpOw0KICAgICAgICANCiAgICAgICAgLyoqKioqKioqKioqKiogVXNlci5wYXNzd29yZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovDQogICAgDQoNCiAgICANCg0KICAgICAgICBwdWJsaWM6DQogICAgICAgICAgICBVc2VyJiBfdW5pcXVlKCk7DQogICAgICAgICAgICBzdGQ6OnN0cmluZyBfdG9Eb2N1bWVudCgpOw0KICAgICAgICAgICAgVXNlciYgX2Zyb21Eb2N1bWVudCh1bnNpZ25lZCBjaGFyKiBvYmopOw0KICAgICAgICAgICAgVXNlciYgX2Zyb21Eb2N1bWVudChzdGQ6OnN0cmluZyBvYmopOw0KICAgICAgICAgICAgVXNlciYgX2Zyb21Eb2N1bWVudChqc29uIG9iaik7DQogICAgICAgICAgICBzdGQ6OnZlY3RvcjxVc2VyPiYmIF9mcm9tRG9jdW1lbnQoc3RkOjp2ZWN0b3I8anNvbj4mJiBvYmopOw0KICAgIA0KICAgICAgICBlc3B0ZXN0OjpVc2VyJiBzdG9yZSgpOw0KICAgIA0KICAgICAgICBzdGQ6OnZlY3Rvcjxlc3B0ZXN0OjpVc2VyPiYgZmluZEFsbCgpOw0KICAgIA0KICAgICAgICBlc3B0ZXN0OjpVc2VyJiBmaW5kKCk7DQogICAgDQogICAgICAgIGpzb24gaW5pdCgpOw0KICAgIA0KICAgIH07DQogICAgDQp9CgkNCg0KLyoqKioqKioqKioqKiogSGVhZGVyIEZpbGUgRU5EICoqKioqKioqKioqKioqKioqKioqKiovDQoNCg0Kc3RhdGljIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZSYgdGhpc05vZGUgPSAobmV3IGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZSgpKS0+Y29kZSgiYWJjIikuYWN0aXZlKHRydWUpLmVuYWJsZWQodHJ1ZSk7DQoNCg0KICAgIA0KDQplc3B0ZXN0OjpVc2VyJiBlc3B0ZXN0OjpVc2VyOjphY3RpdmUoYm9vbCB2KXsNCiAgICB0aGlzLT5fYWN0aXZlID0gdjsNCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQoNCmJvb2wgZXNwdGVzdDo6VXNlcjo6YWN0aXZlKCl7DQogICAgcmV0dXJuIHRoaXMtPl9hY3RpdmU7DQp9DQogICAgDQoNCmVzcHRlc3Q6OlVzZXImIGVzcHRlc3Q6OlVzZXI6OmVuYWJsZWQoYm9vbCB2KXsNCiAgICB0aGlzLT5fZW5hYmxlZCA9IHY7DQogICAgcmV0dXJuICp0aGlzOw0KfQ0KICAgIA0KDQpib29sIGVzcHRlc3Q6OlVzZXI6OmVuYWJsZWQoKXsNCiAgICByZXR1cm4gdGhpcy0+X2VuYWJsZWQ7DQp9DQogICAgDQoNCmVzcHRlc3Q6OlVzZXImIGVzcHRlc3Q6OlVzZXI6OmNvZGUoc3RkOjpzdHJpbmcgdil7DQogICAgdGhpcy0+X2NvZGUgPSB2Ow0KICAgIHJldHVybiAqdGhpczsNCn0NCiAgICANCg0Kc3RkOjpzdHJpbmcgZXNwdGVzdDo6VXNlcjo6Y29kZSgpew0KICAgIHJldHVybiB0aGlzLT5fY29kZTsNCn0NCiAgICANCg0KZXNwdGVzdDo6VXNlciYgZXNwdGVzdDo6VXNlcjo6b3JkZXIoaW50IHYpew0KICAgIHRoaXMtPl9vcmRlciA9IHY7DQogICAgcmV0dXJuICp0aGlzOw0KfQ0KICAgIA0KDQppbnQgZXNwdGVzdDo6VXNlcjo6b3JkZXIoKXsNCiAgICByZXR1cm4gdGhpcy0+X29yZGVyOw0KfQ0KICAgIA0KDQplc3B0ZXN0OjpVc2VyJiBlc3B0ZXN0OjpVc2VyOjpkYXRlKHRpbWVfdCB2KXsNCiAgICB0aGlzLT5fZGF0ZSA9IHY7DQogICAgcmV0dXJuICp0aGlzOw0KfQ0KICAgIA0KDQp0aW1lX3QgZXNwdGVzdDo6VXNlcjo6ZGF0ZSgpew0KICAgIHJldHVybiB0aGlzLT5fZGF0ZTsNCn0NCiAgICANCg0KZXNwdGVzdDo6VXNlciYgZXNwdGVzdDo6VXNlcjo6bmFtZShzdGQ6OnN0cmluZyB2KXsNCiAgICB0aGlzLT5fbmFtZSA9IHY7DQogICAgcmV0dXJuICp0aGlzOw0KfQ0KICAgIA0KDQpzdGQ6OnN0cmluZyBlc3B0ZXN0OjpVc2VyOjpuYW1lKCl7DQogICAgcmV0dXJuIHRoaXMtPl9uYW1lOw0KfQ0KICAgIA0KDQplc3B0ZXN0OjpVc2VyJiBlc3B0ZXN0OjpVc2VyOjpyZW1hcmsoc3RkOjpzdHJpbmcgdil7DQogICAgdGhpcy0+X3JlbWFyayA9IHY7DQogICAgcmV0dXJuICp0aGlzOw0KfQ0KICAgIA0KZXNwdGVzdDo6VXNlciYgZXNwdGVzdDo6VXNlcjo6cmVtYXJrKGpzb24gdil7DQogICAgLy90aGlzLT5fcmVtYXJrDQogICAgcmV0dXJuICp0aGlzOw0KfQ0KICAgIA0KDQpzdGQ6OnN0cmluZyBlc3B0ZXN0OjpVc2VyOjpyZW1hcmsoKXsNCiAgICByZXR1cm4gdGhpcy0+X3JlbWFyazsNCn0NCiAgICANCg0KZXNwdGVzdDo6VXNlciYgZXNwdGVzdDo6VXNlcjo6dXNlcm5hbWUoc3RkOjpzdHJpbmcgdil7DQogICAgdGhpcy0+X3VzZXJuYW1lID0gdjsNCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQoNCnN0ZDo6c3RyaW5nIGVzcHRlc3Q6OlVzZXI6OnVzZXJuYW1lKCl7DQogICAgcmV0dXJuIHRoaXMtPl91c2VybmFtZTsNCn0NCiAgICANCg0KZXNwdGVzdDo6VXNlciYgZXNwdGVzdDo6VXNlcjo6cGFzc3dvcmQoc3RkOjpzdHJpbmcgdil7DQogICAgdGhpcy0+X3Bhc3N3b3JkID0gdjsNCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQoNCnN0ZDo6c3RyaW5nIGVzcHRlc3Q6OlVzZXI6OnBhc3N3b3JkKCl7DQogICAgcmV0dXJuIHRoaXMtPl9wYXNzd29yZDsNCn0NCiAgICANCg0KICAgIA0KDQoNCmVzcHRlc3Q6OlVzZXImIGVzcHRlc3Q6OlVzZXI6Ol91bmlxdWUoKXsNCiAgICBzdGQ6OnN0cmluZyBfX3RvU3RyaW5nID0gIlVzZXI6Ol91bmlxdWUoKTogIjsNCg0KICAgIFVzZXIqIHJldCA9IG5ldyBVc2VyKCk7DQogICAgaWYodGhpcy0+SWQhPTApIHJldC0+SWQgPSB0aGlzLT5JZDsNCiAgICANCiAgICAgICAgDQogICAgaWYodGhpcy0+Y29kZSgpLmVtcHR5KCkpDQogICAgICAgIA0KICAgICAgICByZXQtPmNvZGUodGhpcy0+Y29kZSgpKTsNCiAgICANCiAgICAgICAgDQogICAgaWYodGhpcy0+dXNlcm5hbWUoKS5lbXB0eSgpKQ0KICAgICAgICANCiAgICAgICAgcmV0LT51c2VybmFtZSh0aGlzLT51c2VybmFtZSgpKTsNCiAgICANCg0KICAgIHJldHVybiAqdGhpczsNCn0NCg0KZXNwdGVzdDo6VXNlciYgZXNwdGVzdDo6VXNlcjo6X2Zyb21Eb2N1bWVudCh1bnNpZ25lZCBjaGFyKiBvYmopew0KICAgIHJldHVybiB0aGlzLT5fZnJvbURvY3VtZW50KHN0ZDo6c3RyaW5nKCBvYmosIG9iaiArIHNpemVvZiBvYmogLyBzaXplb2Ygb2JqWzBdICkpOw0KfQ0KDQplc3B0ZXN0OjpVc2VyJiBlc3B0ZXN0OjpVc2VyOjpfZnJvbURvY3VtZW50KHN0ZDo6c3RyaW5nIG9iail7DQogICAgaWYob2JqLmVtcHR5KCkpIHJldHVybiAqdGhpczsNCg0KICAgIGlmIChzdGQ6OnJlZ2V4X21hdGNoKG9iaiwgc3RkOjpyZWdleChSIiIoKChbQS1aYS16XXszLDl9Oig/Oi8vKT8pKD86Wy07OiY9KyQsd10rQCk/W0EtWmEtejAtOS4tXSt8KD86d3d3LnxbLTs6Jj0rJCx3XStAKVtBLVphLXowLTkuLV0rKSgoPzovWyt+JS8udy1fXSopPz8/KD86Wy0rPSY7JUAud19dKikjPyg/Olt3XSopKT8pIiIpKSl7DQogICAgICAgIHN0ZDo6c3RyaW5nIHJlYWRCdWZmZXI7DQogICAgICAgIENVUkwgKmN1cmwgPSBjdXJsX2Vhc3lfaW5pdCgpOw0KICAgICAgICBjdXJsX2Vhc3lfc2V0b3B0KGN1cmwsIENVUkxPUFRfVVJMLCBvYmopOw0KICAgICAgICBjdXJsX2Vhc3lfc2V0b3B0KGN1cmwsIENVUkxPUFRfRk9MTE9XTE9DQVRJT04sIDFMKTsNCiAgICAgICAgLy9jdXJsX2Vhc3lfc2V0b3B0KGN1cmwsIENVUkxPUFRfV1JJVEVGVU5DVElPTiwgK1tdKHZvaWQgKnB0ciwgc2l6ZV90IHNpemUsIHNpemVfdCBubWVtYiwgdm9pZCAqc3RyZWFtKSAtPiBzaXplX3QgeyByZWFkQnVmZmVyLmFwcGVuZCgqcHRyLCBzaXplICogbm1lbWIpOyB9KTsNCiAgICAgICAgY3VybF9lYXN5X3NldG9wdChjdXJsLCBDVVJMT1BUX1dSSVRFREFUQSwgJnJlYWRCdWZmZXIpOw0KICAgICAgICBjdXJsX2Vhc3lfcGVyZm9ybShjdXJsKTsNCiAgICAgICAgY3VybF9lYXN5X2NsZWFudXAoY3VybCk7DQogICAgICAgIHJldHVybiB0aGlzLT5fZnJvbURvY3VtZW50KHJlYWRCdWZmZXIpOw0KICAgIH0NCg0KICAgIHJldHVybiB0aGlzLT5fZnJvbURvY3VtZW50KGpzb246OnBhcnNlKG9iaikpOw0KfQ0KDQpzdGQ6OnZlY3Rvcjxlc3B0ZXN0OjpVc2VyPiYmIGVzcHRlc3Q6OlVzZXI6Ol9mcm9tRG9jdW1lbnQoc3RkOjp2ZWN0b3I8anNvbj4mJiBvYmopew0KICAgIHN0ZDo6dmVjdG9yPFVzZXI+KiByZXQgPSBuZXcgc3RkOjp2ZWN0b3I8VXNlcj4ob2JqLnNpemUoKSk7DQogICAgDQogICAgZm9yIChjb25zdCBqc29uJiBqIDogb2JqKXsNCiAgICAgICAgcmV0LT5wdXNoX2JhY2soKG5ldyBVc2VyKCkpLT5fZnJvbURvY3VtZW50KGopKTsNCiAgICB9DQogICAgDQogICAgcmV0dXJuIG1vdmUoKnJldCk7DQp9DQoNCmVzcHRlc3Q6OlVzZXImIGVzcHRlc3Q6OlVzZXI6Ol9mcm9tRG9jdW1lbnQoanNvbiBvYmopew0KICAgIA0KICAgIGlmKG9iai5jb250YWlucygiYWN0aXZlIikpIHRoaXMtPmFjdGl2ZSgNCiAgICAgICAgDQogICAgICAgIG9ialsiYWN0aXZlIl0udGVtcGxhdGUgZ2V0PGJvb2w+KCkNCiAgICAgICAgDQogICAgICAgICk7DQogICAgDQogICAgaWYob2JqLmNvbnRhaW5zKCJlbmFibGVkIikpIHRoaXMtPmVuYWJsZWQoDQogICAgICAgIA0KICAgICAgICBvYmpbImVuYWJsZWQiXS50ZW1wbGF0ZSBnZXQ8Ym9vbD4oKQ0KICAgICAgICANCiAgICAgICAgKTsNCiAgICANCiAgICBpZihvYmouY29udGFpbnMoImNvZGUiKSkgdGhpcy0+Y29kZSgNCiAgICAgICAgDQogICAgICAgIG9ialsiY29kZSJdLnRlbXBsYXRlIGdldDxzdGQ6OnN0cmluZz4oKQ0KICAgICAgICANCiAgICAgICAgKTsNCiAgICANCiAgICBpZihvYmouY29udGFpbnMoIm9yZGVyIikpIHRoaXMtPm9yZGVyKA0KICAgICAgICANCiAgICAgICAgb2JqWyJvcmRlciJdLnRlbXBsYXRlIGdldDxpbnQ+KCkNCiAgICAgICAgDQogICAgICAgICk7DQogICAgDQogICAgaWYob2JqLmNvbnRhaW5zKCJkYXRlIikpIHRoaXMtPmRhdGUoDQogICAgICAgIA0KICAgICAgICBvYmpbImRhdGUiXS50ZW1wbGF0ZSBnZXQ8dGltZV90PigpDQogICAgICAgIA0KICAgICAgICApOw0KICAgIA0KICAgIGlmKG9iai5jb250YWlucygibmFtZSIpKSB0aGlzLT5uYW1lKA0KICAgICAgICANCiAgICAgICAgb2JqWyJuYW1lIl0udGVtcGxhdGUgZ2V0PHN0ZDo6c3RyaW5nPigpDQogICAgICAgIA0KICAgICAgICApOw0KICAgIA0KICAgIGlmKG9iai5jb250YWlucygicmVtYXJrIikpIHRoaXMtPnJlbWFyaygNCiAgICAgICAgDQogICAgICAgIG9ialsicmVtYXJrIl0udGVtcGxhdGUgZ2V0PHN0ZDo6c3RyaW5nPigpDQogICAgICAgIA0KICAgICAgICApOw0KICAgIA0KICAgIGlmKG9iai5jb250YWlucygidXNlcm5hbWUiKSkgdGhpcy0+dXNlcm5hbWUoDQogICAgICAgIA0KICAgICAgICBvYmpbInVzZXJuYW1lIl0udGVtcGxhdGUgZ2V0PHN0ZDo6c3RyaW5nPigpDQogICAgICAgIA0KICAgICAgICApOw0KICAgIA0KICAgIGlmKG9iai5jb250YWlucygicGFzc3dvcmQiKSkgdGhpcy0+cGFzc3dvcmQoDQogICAgICAgIA0KICAgICAgICBvYmpbInBhc3N3b3JkIl0udGVtcGxhdGUgZ2V0PHN0ZDo6c3RyaW5nPigpDQogICAgICAgIA0KICAgICAgICApOw0KICAgIA0KICAgIA0KICAgIA0KICAgIHJldHVybiAqdGhpczsNCn0NCg0Kc3RkOjpzdHJpbmcgZXNwdGVzdDo6VXNlcjo6X3RvRG9jdW1lbnQoKXsNCiAgICByZXR1cm4gIiI7DQp9DQoNCiAgICANCmVzcHRlc3Q6OlVzZXImIGVzcHRlc3Q6OlVzZXI6OnN0b3JlKCl7DQogICAgc3RkOjpzdHJpbmcgX190b1N0cmluZyA9ICJVc2VyOjpzdG9yZSgpOiAiOw0KICAgIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6RXZlbnQgX19yZXNwb25zZSA9IChuZXcgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpFdmVudCgpKS0+Y29kZSgiWyIrdGhpc05vZGUuY29kZSgpKyJAdGltZSIrIl0uVXNlci5zdG9yZSgpIikubWV0aG9kKCJzdG9yZSIpLmNsYXNzTmFtZSgiVXNlciIpLmNhcnJpZXIodGhpc05vZGUpLnNlbmRlcih0aGlzTm9kZSkucmVjaXBpZW50KHRoaXNOb2RlLnBhcmVudCgpKTsNCg0KICAgIGVzcHRlc3Q6OlVzZXIqIGFuc3dlcjsNCg0KICAgIA0KDQogICAgDQogICAgaWYoYW5zd2VyIT1udWxscHRyKXsNCiAgICANCg0KICAgIA0KICAgICAgICANCiAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci0+X3RvRG9jdW1lbnQoKSk7DQogICAgICAgIA0KICAgIA0KICAgIH1lbHNlew0KICAgICAgICBqc29uIF9qUmV0Ow0KICAgICAgICBfalJldFsiX190aGlzIl0gPSB0aGlzLT5fdG9Eb2N1bWVudCgpOw0KICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoX2pSZXQpOw0KICAgICAgICAvL19fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHRoaXMtPl90b0RvY3VtZW50KCl9KTsNCiAgICB9DQoNCiAgICAvL19fcmVzcG9uc2UudHJpZ2dlcigpOw0KDQogICAgcmV0dXJuICphbnN3ZXI7DQp9DQogICAgDQpzdGQ6OnZlY3Rvcjxlc3B0ZXN0OjpVc2VyPiYgZXNwdGVzdDo6VXNlcjo6ZmluZEFsbCgpew0KICAgIHN0ZDo6c3RyaW5nIF9fdG9TdHJpbmcgPSAiVXNlcjo6ZmluZEFsbCgpOiAiOw0KICAgIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6RXZlbnQgX19yZXNwb25zZSA9IChuZXcgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpFdmVudCgpKS0+Y29kZSgiWyIrdGhpc05vZGUuY29kZSgpKyJAdGltZSIrIl0uVXNlci5maW5kQWxsKCkiKS5tZXRob2QoImZpbmRBbGwiKS5jbGFzc05hbWUoIlVzZXIiKS5jYXJyaWVyKHRoaXNOb2RlKS5zZW5kZXIodGhpc05vZGUpLnJlY2lwaWVudCh0aGlzTm9kZS5wYXJlbnQoKSk7DQoNCiAgICBzdGQ6OnZlY3Rvcjxlc3B0ZXN0OjpVc2VyPiogYW5zd2VyOw0KDQogICAgDQoNCiAgICANCiAgICBpZihhbnN3ZXItPmVtcHR5KCkpew0KICAgIA0KDQogICAgDQogICAgICAgIA0KICAgICAgICAvL19fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXItPl90b0RvY3VtZW50KCkpOw0KICAgICAgICANCiAgICANCiAgICB9ZWxzZXsNCiAgICAgICAganNvbiBfalJldDsNCiAgICAgICAgX2pSZXRbIl9fdGhpcyJdID0gdGhpcy0+X3RvRG9jdW1lbnQoKTsNCiAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKF9qUmV0KTsNCiAgICAgICAgLy9fX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiB0aGlzLT5fdG9Eb2N1bWVudCgpfSk7DQogICAgfQ0KDQogICAgLy9fX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCg0KICAgIHJldHVybiAqYW5zd2VyOw0KfQ0KICAgIA0KZXNwdGVzdDo6VXNlciYgZXNwdGVzdDo6VXNlcjo6ZmluZCgpew0KICAgIHN0ZDo6c3RyaW5nIF9fdG9TdHJpbmcgPSAiVXNlcjo6ZmluZCgpOiAiOw0KICAgIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6RXZlbnQgX19yZXNwb25zZSA9IChuZXcgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpFdmVudCgpKS0+Y29kZSgiWyIrdGhpc05vZGUuY29kZSgpKyJAdGltZSIrIl0uVXNlci5maW5kKCkiKS5tZXRob2QoImZpbmQiKS5jbGFzc05hbWUoIlVzZXIiKS5jYXJyaWVyKHRoaXNOb2RlKS5zZW5kZXIodGhpc05vZGUpLnJlY2lwaWVudCh0aGlzTm9kZS5wYXJlbnQoKSk7DQoNCiAgICBlc3B0ZXN0OjpVc2VyKiBhbnN3ZXI7DQoNCiAgICANCg0KICAgIA0KICAgIGlmKGFuc3dlciE9bnVsbHB0cil7DQogICAgDQoNCiAgICANCiAgICAgICAgDQogICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXItPl90b0RvY3VtZW50KCkpOw0KICAgICAgICANCiAgICANCiAgICB9ZWxzZXsNCiAgICAgICAganNvbiBfalJldDsNCiAgICAgICAgX2pSZXRbIl9fdGhpcyJdID0gdGhpcy0+X3RvRG9jdW1lbnQoKTsNCiAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKF9qUmV0KTsNCiAgICAgICAgLy9fX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiB0aGlzLT5fdG9Eb2N1bWVudCgpfSk7DQogICAgfQ0KDQogICAgLy9fX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCg0KICAgIHJldHVybiAqYW5zd2VyOw0KfQ0KICAgIA0KanNvbiBlc3B0ZXN0OjpVc2VyOjppbml0KCl7DQogICAgc3RkOjpzdHJpbmcgX190b1N0cmluZyA9ICJVc2VyOjppbml0KCk6ICI7DQogICAgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpFdmVudCBfX3Jlc3BvbnNlID0gKG5ldyBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkV2ZW50KCkpLT5jb2RlKCJbIit0aGlzTm9kZS5jb2RlKCkrIkB0aW1lIisiXS5Vc2VyLmluaXQoKSIpLm1ldGhvZCgiaW5pdCIpLmNsYXNzTmFtZSgiVXNlciIpLmNhcnJpZXIodGhpc05vZGUpLnNlbmRlcih0aGlzTm9kZSkucmVjaXBpZW50KHRoaXNOb2RlLnBhcmVudCgpKTsNCg0KICAgIGpzb24gYW5zd2VyOw0KDQogICAgDQoNCiAgICANCiAgICBpZihhbnN3ZXIhPW51bGxwdHIpew0KICAgIA0KDQogICAgDQogICAgICAgIC8vX19yZXNwb25zZS5wYXlsb2FkKChzdGQ6OnN0cmluZylhbnN3ZXIpOw0KICAgIA0KICAgIH1lbHNlew0KICAgICAgICBqc29uIF9qUmV0Ow0KICAgICAgICBfalJldFsiX190aGlzIl0gPSB0aGlzLT5fdG9Eb2N1bWVudCgpOw0KICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoX2pSZXQpOw0KICAgICAgICAvL19fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHRoaXMtPl90b0RvY3VtZW50KCl9KTsNCiAgICB9DQoNCiAgICAvL19fcmVzcG9uc2UudHJpZ2dlcigpOw0KDQogICAgcmV0dXJuIGFuc3dlcjsNCn0NCiAgICANCg0KICAgIA0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6Ok1ldHJpYyYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpNZXRyaWM6OmFjdGl2ZShib29sIHYpew0KICAgIHRoaXMtPl9hY3RpdmUgPSB2Ow0KICAgIHJldHVybiAqdGhpczsNCn0NCiAgICANCg0KYm9vbCBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6Ok1ldHJpYzo6YWN0aXZlKCl7DQogICAgcmV0dXJuIHRoaXMtPl9hY3RpdmU7DQp9DQogICAgDQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6TWV0cmljJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6Ok1ldHJpYzo6ZW5hYmxlZChib29sIHYpew0KICAgIHRoaXMtPl9lbmFibGVkID0gdjsNCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQoNCmJvb2wgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpNZXRyaWM6OmVuYWJsZWQoKXsNCiAgICByZXR1cm4gdGhpcy0+X2VuYWJsZWQ7DQp9DQogICAgDQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6TWV0cmljJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6Ok1ldHJpYzo6Y29kZShzdGQ6OnN0cmluZyB2KXsNCiAgICB0aGlzLT5fY29kZSA9IHY7DQogICAgcmV0dXJuICp0aGlzOw0KfQ0KICAgIA0KDQpzdGQ6OnN0cmluZyBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6Ok1ldHJpYzo6Y29kZSgpew0KICAgIHJldHVybiB0aGlzLT5fY29kZTsNCn0NCiAgICANCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpNZXRyaWMmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6TWV0cmljOjpvcmRlcihpbnQgdil7DQogICAgdGhpcy0+X29yZGVyID0gdjsNCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQoNCmludCBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6Ok1ldHJpYzo6b3JkZXIoKXsNCiAgICByZXR1cm4gdGhpcy0+X29yZGVyOw0KfQ0KICAgIA0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6Ok1ldHJpYyYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpNZXRyaWM6OmRhdGUodGltZV90IHYpew0KICAgIHRoaXMtPl9kYXRlID0gdjsNCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQoNCnRpbWVfdCBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6Ok1ldHJpYzo6ZGF0ZSgpew0KICAgIHJldHVybiB0aGlzLT5fZGF0ZTsNCn0NCiAgICANCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpNZXRyaWMmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6TWV0cmljOjpuYW1lKHN0ZDo6c3RyaW5nIHYpew0KICAgIHRoaXMtPl9uYW1lID0gdjsNCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQoNCnN0ZDo6c3RyaW5nIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6TWV0cmljOjpuYW1lKCl7DQogICAgcmV0dXJuIHRoaXMtPl9uYW1lOw0KfQ0KICAgIA0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6Ok1ldHJpYyYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpNZXRyaWM6OnJlbWFyayhzdGQ6OnN0cmluZyB2KXsNCiAgICB0aGlzLT5fcmVtYXJrID0gdjsNCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6Ok1ldHJpYyYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpNZXRyaWM6OnJlbWFyayhqc29uIHYpew0KICAgIC8vdGhpcy0+X3JlbWFyaw0KICAgIHJldHVybiAqdGhpczsNCn0NCiAgICANCg0Kc3RkOjpzdHJpbmcgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpNZXRyaWM6OnJlbWFyaygpew0KICAgIHJldHVybiB0aGlzLT5fcmVtYXJrOw0KfQ0KICAgIA0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6Ok1ldHJpYyYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpNZXRyaWM6OnNjcmlwdChzdGQ6OnN0cmluZyB2KXsNCiAgICB0aGlzLT5fc2NyaXB0ID0gdjsNCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6Ok1ldHJpYyYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpNZXRyaWM6OnNjcmlwdChqc29uIHYpew0KICAgIC8vdGhpcy0+X3NjcmlwdA0KICAgIHJldHVybiAqdGhpczsNCn0NCiAgICANCg0Kc3RkOjpzdHJpbmcgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpNZXRyaWM6OnNjcmlwdCgpew0KICAgIHJldHVybiB0aGlzLT5fc2NyaXB0Ow0KfQ0KICAgIA0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6Ok1ldHJpYyYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpNZXRyaWM6OnR5cGUoZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpNZXRyaWNfVHlwZSYgdil7DQogICAgdGhpcy0+X3R5cGUgPSAmdjsNCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6Ok1ldHJpYyYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpNZXRyaWM6OnR5cGUoZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpNZXRyaWNfVHlwZSogdil7DQogICAgaWYodiE9bnVsbHB0cil7DQogICAgICAgIHRoaXMtPl90eXBlID0gdjsNCiAgICB9DQogICAgcmV0dXJuICp0aGlzOw0KfQ0KICAgIA0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6Ok1ldHJpY19UeXBlKiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6Ok1ldHJpYzo6dHlwZSgpew0KICAgIHJldHVybiB0aGlzLT5fdHlwZTsNCn0NCiAgICANCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpNZXRyaWMmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6TWV0cmljOjpkZXZpY2VUeXBlKGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6RGV2aWNlX1R5cGUmIHYpew0KICAgIHRoaXMtPl9kZXZpY2VUeXBlID0gJnY7DQogICAgcmV0dXJuICp0aGlzOw0KfQ0KICAgIA0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpNZXRyaWMmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6TWV0cmljOjpkZXZpY2VUeXBlKGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6RGV2aWNlX1R5cGUqIHYpew0KICAgIGlmKHYhPW51bGxwdHIpew0KICAgICAgICB0aGlzLT5fZGV2aWNlVHlwZSA9IHY7DQogICAgfQ0KICAgIHJldHVybiAqdGhpczsNCn0NCiAgICANCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpEZXZpY2VfVHlwZSogZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpNZXRyaWM6OmRldmljZVR5cGUoKXsNCiAgICByZXR1cm4gdGhpcy0+X2RldmljZVR5cGU7DQp9DQogICAgDQoNCiAgICANCnN0ZDo6dmVjdG9yPHN0ZDo6YW55PiYmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6TWV0cmljOjptZXRyaWNfTWV0cmljX1ZhbHVlcygpew0KICAgIHJldHVybiBtb3ZlKCoodGhpcy0+X21ldHJpY19NZXRyaWNfVmFsdWVzKSk7DQp9DQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6TWV0cmljJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6Ok1ldHJpYzo6bWV0cmljX01ldHJpY19WYWx1ZXMoc3RkOjp2ZWN0b3I8c3RkOjphbnk+JiYgdil7DQogICAgcmV0dXJuICp0aGlzOw0KfQ0KICAgIA0KDQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6TWV0cmljJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6Ok1ldHJpYzo6X3VuaXF1ZSgpew0KICAgIHN0ZDo6c3RyaW5nIF9fdG9TdHJpbmcgPSAiTWV0cmljOjpfdW5pcXVlKCk6ICI7DQoNCiAgICBNZXRyaWMqIHJldCA9IG5ldyBNZXRyaWMoKTsNCiAgICBpZih0aGlzLT5JZCE9MCkgcmV0LT5JZCA9IHRoaXMtPklkOw0KICAgIA0KICAgICAgICANCiAgICBpZih0aGlzLT5jb2RlKCkuZW1wdHkoKSkNCiAgICAgICAgDQogICAgICAgIHJldC0+Y29kZSh0aGlzLT5jb2RlKCkpOw0KICAgIA0KDQogICAgcmV0dXJuICp0aGlzOw0KfQ0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6Ok1ldHJpYyYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpNZXRyaWM6Ol9mcm9tRG9jdW1lbnQodW5zaWduZWQgY2hhciogb2JqKXsNCiAgICByZXR1cm4gdGhpcy0+X2Zyb21Eb2N1bWVudChzdGQ6OnN0cmluZyggb2JqLCBvYmogKyBzaXplb2Ygb2JqIC8gc2l6ZW9mIG9ialswXSApKTsNCn0NCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpNZXRyaWMmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6TWV0cmljOjpfZnJvbURvY3VtZW50KHN0ZDo6c3RyaW5nIG9iail7DQogICAgaWYob2JqLmVtcHR5KCkpIHJldHVybiAqdGhpczsNCg0KICAgIGlmIChzdGQ6OnJlZ2V4X21hdGNoKG9iaiwgc3RkOjpyZWdleChSIiIoKChbQS1aYS16XXszLDl9Oig/Oi8vKT8pKD86Wy07OiY9KyQsd10rQCk/W0EtWmEtejAtOS4tXSt8KD86d3d3LnxbLTs6Jj0rJCx3XStAKVtBLVphLXowLTkuLV0rKSgoPzovWyt+JS8udy1fXSopPz8/KD86Wy0rPSY7JUAud19dKikjPyg/Olt3XSopKT8pIiIpKSl7DQogICAgICAgIHN0ZDo6c3RyaW5nIHJlYWRCdWZmZXI7DQogICAgICAgIENVUkwgKmN1cmwgPSBjdXJsX2Vhc3lfaW5pdCgpOw0KICAgICAgICBjdXJsX2Vhc3lfc2V0b3B0KGN1cmwsIENVUkxPUFRfVVJMLCBvYmopOw0KICAgICAgICBjdXJsX2Vhc3lfc2V0b3B0KGN1cmwsIENVUkxPUFRfRk9MTE9XTE9DQVRJT04sIDFMKTsNCiAgICAgICAgLy9jdXJsX2Vhc3lfc2V0b3B0KGN1cmwsIENVUkxPUFRfV1JJVEVGVU5DVElPTiwgK1tdKHZvaWQgKnB0ciwgc2l6ZV90IHNpemUsIHNpemVfdCBubWVtYiwgdm9pZCAqc3RyZWFtKSAtPiBzaXplX3QgeyByZWFkQnVmZmVyLmFwcGVuZCgqcHRyLCBzaXplICogbm1lbWIpOyB9KTsNCiAgICAgICAgY3VybF9lYXN5X3NldG9wdChjdXJsLCBDVVJMT1BUX1dSSVRFREFUQSwgJnJlYWRCdWZmZXIpOw0KICAgICAgICBjdXJsX2Vhc3lfcGVyZm9ybShjdXJsKTsNCiAgICAgICAgY3VybF9lYXN5X2NsZWFudXAoY3VybCk7DQogICAgICAgIHJldHVybiB0aGlzLT5fZnJvbURvY3VtZW50KHJlYWRCdWZmZXIpOw0KICAgIH0NCg0KICAgIHJldHVybiB0aGlzLT5fZnJvbURvY3VtZW50KGpzb246OnBhcnNlKG9iaikpOw0KfQ0KDQpzdGQ6OnZlY3Rvcjxlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6Ok1ldHJpYz4mJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6Ok1ldHJpYzo6X2Zyb21Eb2N1bWVudChzdGQ6OnZlY3Rvcjxqc29uPiYmIG9iail7DQogICAgc3RkOjp2ZWN0b3I8TWV0cmljPiogcmV0ID0gbmV3IHN0ZDo6dmVjdG9yPE1ldHJpYz4ob2JqLnNpemUoKSk7DQogICAgDQogICAgZm9yIChjb25zdCBqc29uJiBqIDogb2JqKXsNCiAgICAgICAgcmV0LT5wdXNoX2JhY2soKG5ldyBNZXRyaWMoKSktPl9mcm9tRG9jdW1lbnQoaikpOw0KICAgIH0NCiAgICANCiAgICByZXR1cm4gbW92ZSgqcmV0KTsNCn0NCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpNZXRyaWMmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6TWV0cmljOjpfZnJvbURvY3VtZW50KGpzb24gb2JqKXsNCiAgICANCiAgICBpZihvYmouY29udGFpbnMoImFjdGl2ZSIpKSB0aGlzLT5hY3RpdmUoDQogICAgICAgIA0KICAgICAgICBvYmpbImFjdGl2ZSJdLnRlbXBsYXRlIGdldDxib29sPigpDQogICAgICAgIA0KICAgICAgICApOw0KICAgIA0KICAgIGlmKG9iai5jb250YWlucygiZW5hYmxlZCIpKSB0aGlzLT5lbmFibGVkKA0KICAgICAgICANCiAgICAgICAgb2JqWyJlbmFibGVkIl0udGVtcGxhdGUgZ2V0PGJvb2w+KCkNCiAgICAgICAgDQogICAgICAgICk7DQogICAgDQogICAgaWYob2JqLmNvbnRhaW5zKCJjb2RlIikpIHRoaXMtPmNvZGUoDQogICAgICAgIA0KICAgICAgICBvYmpbImNvZGUiXS50ZW1wbGF0ZSBnZXQ8c3RkOjpzdHJpbmc+KCkNCiAgICAgICAgDQogICAgICAgICk7DQogICAgDQogICAgaWYob2JqLmNvbnRhaW5zKCJvcmRlciIpKSB0aGlzLT5vcmRlcigNCiAgICAgICAgDQogICAgICAgIG9ialsib3JkZXIiXS50ZW1wbGF0ZSBnZXQ8aW50PigpDQogICAgICAgIA0KICAgICAgICApOw0KICAgIA0KICAgIGlmKG9iai5jb250YWlucygiZGF0ZSIpKSB0aGlzLT5kYXRlKA0KICAgICAgICANCiAgICAgICAgb2JqWyJkYXRlIl0udGVtcGxhdGUgZ2V0PHRpbWVfdD4oKQ0KICAgICAgICANCiAgICAgICAgKTsNCiAgICANCiAgICBpZihvYmouY29udGFpbnMoIm5hbWUiKSkgdGhpcy0+bmFtZSgNCiAgICAgICAgDQogICAgICAgIG9ialsibmFtZSJdLnRlbXBsYXRlIGdldDxzdGQ6OnN0cmluZz4oKQ0KICAgICAgICANCiAgICAgICAgKTsNCiAgICANCiAgICBpZihvYmouY29udGFpbnMoInJlbWFyayIpKSB0aGlzLT5yZW1hcmsoDQogICAgICAgIA0KICAgICAgICBvYmpbInJlbWFyayJdLnRlbXBsYXRlIGdldDxzdGQ6OnN0cmluZz4oKQ0KICAgICAgICANCiAgICAgICAgKTsNCiAgICANCiAgICBpZihvYmouY29udGFpbnMoInNjcmlwdCIpKSB0aGlzLT5zY3JpcHQoDQogICAgICAgIA0KICAgICAgICBvYmpbInNjcmlwdCJdLnRlbXBsYXRlIGdldDxzdGQ6OnN0cmluZz4oKQ0KICAgICAgICANCiAgICAgICAgKTsNCiAgICANCiAgICBpZihvYmouY29udGFpbnMoInR5cGUiKSkgdGhpcy0+dHlwZSgNCiAgICAgICAgDQogICAgICAgIChuZXcgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpNZXRyaWNfVHlwZSgpKS0+X2Zyb21Eb2N1bWVudChvYmpbInR5cGUiXSkNCiAgICAgICAgDQogICAgICAgICk7DQogICAgDQogICAgaWYob2JqLmNvbnRhaW5zKCJkZXZpY2VUeXBlIikpIHRoaXMtPmRldmljZVR5cGUoDQogICAgICAgIA0KICAgICAgICAobmV3IGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6RGV2aWNlX1R5cGUoKSktPl9mcm9tRG9jdW1lbnQob2JqWyJkZXZpY2VUeXBlIl0pDQogICAgICAgIA0KICAgICAgICApOw0KICAgIA0KICAgIA0KICAgIA0KICAgIGlmKG9iai5jb250YWlucygibWV0cmljX01ldHJpY19WYWx1ZXMiKSkgdGhpcy0+bWV0cmljX01ldHJpY19WYWx1ZXMoKG5ldyBNZXRyaWNfVmFsdWUoKSktPl9mcm9tRG9jdW1lbnQoKHN0ZDo6dmVjdG9yPGpzb24+KW9ialsibWV0cmljX01ldHJpY19WYWx1ZXMiXSkpOw0KICAgIA0KICAgIHJldHVybiAqdGhpczsNCn0NCg0Kc3RkOjpzdHJpbmcgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpNZXRyaWM6Ol90b0RvY3VtZW50KCl7DQogICAgcmV0dXJuICIiOw0KfQ0KDQogICAgDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6Ok1ldHJpYyYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpNZXRyaWM6OnN0b3JlKCl7DQogICAgc3RkOjpzdHJpbmcgX190b1N0cmluZyA9ICJNZXRyaWM6OnN0b3JlKCk6ICI7DQogICAgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpFdmVudCBfX3Jlc3BvbnNlID0gKG5ldyBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkV2ZW50KCkpLT5jb2RlKCJbIit0aGlzTm9kZS5jb2RlKCkrIkB0aW1lIisiXS5NZXRyaWMuc3RvcmUoKSIpLm1ldGhvZCgic3RvcmUiKS5jbGFzc05hbWUoIk1ldHJpYyIpLmNhcnJpZXIodGhpc05vZGUpLnNlbmRlcih0aGlzTm9kZSkucmVjaXBpZW50KHRoaXNOb2RlLnBhcmVudCgpKTsNCg0KICAgIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6TWV0cmljKiBhbnN3ZXI7DQoNCiAgICANCg0KICAgIA0KICAgIGlmKGFuc3dlciE9bnVsbHB0cil7DQogICAgDQoNCiAgICANCiAgICAgICAgDQogICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXItPl90b0RvY3VtZW50KCkpOw0KICAgICAgICANCiAgICANCiAgICB9ZWxzZXsNCiAgICAgICAganNvbiBfalJldDsNCiAgICAgICAgX2pSZXRbIl9fdGhpcyJdID0gdGhpcy0+X3RvRG9jdW1lbnQoKTsNCiAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKF9qUmV0KTsNCiAgICAgICAgLy9fX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiB0aGlzLT5fdG9Eb2N1bWVudCgpfSk7DQogICAgfQ0KDQogICAgLy9fX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCg0KICAgIHJldHVybiAqYW5zd2VyOw0KfQ0KICAgIA0Kc3RkOjp2ZWN0b3I8ZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpNZXRyaWM+JiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6Ok1ldHJpYzo6ZmluZEFsbCgpew0KICAgIHN0ZDo6c3RyaW5nIF9fdG9TdHJpbmcgPSAiTWV0cmljOjpmaW5kQWxsKCk6ICI7DQogICAgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpFdmVudCBfX3Jlc3BvbnNlID0gKG5ldyBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkV2ZW50KCkpLT5jb2RlKCJbIit0aGlzTm9kZS5jb2RlKCkrIkB0aW1lIisiXS5NZXRyaWMuZmluZEFsbCgpIikubWV0aG9kKCJmaW5kQWxsIikuY2xhc3NOYW1lKCJNZXRyaWMiKS5jYXJyaWVyKHRoaXNOb2RlKS5zZW5kZXIodGhpc05vZGUpLnJlY2lwaWVudCh0aGlzTm9kZS5wYXJlbnQoKSk7DQoNCiAgICBzdGQ6OnZlY3Rvcjxlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6Ok1ldHJpYz4qIGFuc3dlcjsNCg0KICAgIA0KDQogICAgDQogICAgaWYoYW5zd2VyLT5lbXB0eSgpKXsNCiAgICANCg0KICAgIA0KICAgICAgICANCiAgICAgICAgLy9fX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLT5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgDQogICAgDQogICAgfWVsc2V7DQogICAgICAgIGpzb24gX2pSZXQ7DQogICAgICAgIF9qUmV0WyJfX3RoaXMiXSA9IHRoaXMtPl90b0RvY3VtZW50KCk7DQogICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChfalJldCk7DQogICAgICAgIC8vX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogdGhpcy0+X3RvRG9jdW1lbnQoKX0pOw0KICAgIH0NCg0KICAgIC8vX19yZXNwb25zZS50cmlnZ2VyKCk7DQoNCiAgICByZXR1cm4gKmFuc3dlcjsNCn0NCiAgICANCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6TWV0cmljJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6Ok1ldHJpYzo6ZmluZCgpew0KICAgIHN0ZDo6c3RyaW5nIF9fdG9TdHJpbmcgPSAiTWV0cmljOjpmaW5kKCk6ICI7DQogICAgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpFdmVudCBfX3Jlc3BvbnNlID0gKG5ldyBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkV2ZW50KCkpLT5jb2RlKCJbIit0aGlzTm9kZS5jb2RlKCkrIkB0aW1lIisiXS5NZXRyaWMuZmluZCgpIikubWV0aG9kKCJmaW5kIikuY2xhc3NOYW1lKCJNZXRyaWMiKS5jYXJyaWVyKHRoaXNOb2RlKS5zZW5kZXIodGhpc05vZGUpLnJlY2lwaWVudCh0aGlzTm9kZS5wYXJlbnQoKSk7DQoNCiAgICBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6Ok1ldHJpYyogYW5zd2VyOw0KDQogICAgDQoNCiAgICANCiAgICBpZihhbnN3ZXIhPW51bGxwdHIpew0KICAgIA0KDQogICAgDQogICAgICAgIA0KICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLT5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgDQogICAgDQogICAgfWVsc2V7DQogICAgICAgIGpzb24gX2pSZXQ7DQogICAgICAgIF9qUmV0WyJfX3RoaXMiXSA9IHRoaXMtPl90b0RvY3VtZW50KCk7DQogICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChfalJldCk7DQogICAgICAgIC8vX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogdGhpcy0+X3RvRG9jdW1lbnQoKX0pOw0KICAgIH0NCg0KICAgIC8vX19yZXNwb25zZS50cmlnZ2VyKCk7DQoNCiAgICByZXR1cm4gKmFuc3dlcjsNCn0NCiAgICANCg0KICAgIA0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6Ok1ldHJpY19WYWx1ZSYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpNZXRyaWNfVmFsdWU6OmFjdGl2ZShib29sIHYpew0KICAgIHRoaXMtPl9hY3RpdmUgPSB2Ow0KICAgIHJldHVybiAqdGhpczsNCn0NCiAgICANCg0KYm9vbCBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6Ok1ldHJpY19WYWx1ZTo6YWN0aXZlKCl7DQogICAgcmV0dXJuIHRoaXMtPl9hY3RpdmU7DQp9DQogICAgDQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6TWV0cmljX1ZhbHVlJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6Ok1ldHJpY19WYWx1ZTo6ZW5hYmxlZChib29sIHYpew0KICAgIHRoaXMtPl9lbmFibGVkID0gdjsNCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQoNCmJvb2wgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpNZXRyaWNfVmFsdWU6OmVuYWJsZWQoKXsNCiAgICByZXR1cm4gdGhpcy0+X2VuYWJsZWQ7DQp9DQogICAgDQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6TWV0cmljX1ZhbHVlJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6Ok1ldHJpY19WYWx1ZTo6Y29kZShzdGQ6OnN0cmluZyB2KXsNCiAgICB0aGlzLT5fY29kZSA9IHY7DQogICAgcmV0dXJuICp0aGlzOw0KfQ0KICAgIA0KDQpzdGQ6OnN0cmluZyBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6Ok1ldHJpY19WYWx1ZTo6Y29kZSgpew0KICAgIHJldHVybiB0aGlzLT5fY29kZTsNCn0NCiAgICANCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpNZXRyaWNfVmFsdWUmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6TWV0cmljX1ZhbHVlOjpvcmRlcihpbnQgdil7DQogICAgdGhpcy0+X29yZGVyID0gdjsNCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQoNCmludCBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6Ok1ldHJpY19WYWx1ZTo6b3JkZXIoKXsNCiAgICByZXR1cm4gdGhpcy0+X29yZGVyOw0KfQ0KICAgIA0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6Ok1ldHJpY19WYWx1ZSYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpNZXRyaWNfVmFsdWU6OmRhdGUodGltZV90IHYpew0KICAgIHRoaXMtPl9kYXRlID0gdjsNCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQoNCnRpbWVfdCBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6Ok1ldHJpY19WYWx1ZTo6ZGF0ZSgpew0KICAgIHJldHVybiB0aGlzLT5fZGF0ZTsNCn0NCiAgICANCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpNZXRyaWNfVmFsdWUmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6TWV0cmljX1ZhbHVlOjpuYW1lKHN0ZDo6c3RyaW5nIHYpew0KICAgIHRoaXMtPl9uYW1lID0gdjsNCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQoNCnN0ZDo6c3RyaW5nIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6TWV0cmljX1ZhbHVlOjpuYW1lKCl7DQogICAgcmV0dXJuIHRoaXMtPl9uYW1lOw0KfQ0KICAgIA0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6Ok1ldHJpY19WYWx1ZSYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpNZXRyaWNfVmFsdWU6OnJlbWFyayhzdGQ6OnN0cmluZyB2KXsNCiAgICB0aGlzLT5fcmVtYXJrID0gdjsNCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6Ok1ldHJpY19WYWx1ZSYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpNZXRyaWNfVmFsdWU6OnJlbWFyayhqc29uIHYpew0KICAgIC8vdGhpcy0+X3JlbWFyaw0KICAgIHJldHVybiAqdGhpczsNCn0NCiAgICANCg0Kc3RkOjpzdHJpbmcgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpNZXRyaWNfVmFsdWU6OnJlbWFyaygpew0KICAgIHJldHVybiB0aGlzLT5fcmVtYXJrOw0KfQ0KICAgIA0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6Ok1ldHJpY19WYWx1ZSYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpNZXRyaWNfVmFsdWU6OnZhbHVlKHN0ZDo6c3RyaW5nIHYpew0KICAgIHRoaXMtPl92YWx1ZSA9IHY7DQogICAgcmV0dXJuICp0aGlzOw0KfQ0KICAgIA0KDQpzdGQ6OnN0cmluZyBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6Ok1ldHJpY19WYWx1ZTo6dmFsdWUoKXsNCiAgICByZXR1cm4gdGhpcy0+X3ZhbHVlOw0KfQ0KICAgIA0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6Ok1ldHJpY19WYWx1ZSYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpNZXRyaWNfVmFsdWU6Om1lYXN1cmVkKHRpbWVfdCB2KXsNCiAgICB0aGlzLT5fbWVhc3VyZWQgPSB2Ow0KICAgIHJldHVybiAqdGhpczsNCn0NCiAgICANCg0KdGltZV90IGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6TWV0cmljX1ZhbHVlOjptZWFzdXJlZCgpew0KICAgIHJldHVybiB0aGlzLT5fbWVhc3VyZWQ7DQp9DQogICAgDQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6TWV0cmljX1ZhbHVlJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6Ok1ldHJpY19WYWx1ZTo6bWV0cmljKGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6TWV0cmljJiB2KXsNCiAgICB0aGlzLT5fbWV0cmljID0gJnY7DQogICAgcmV0dXJuICp0aGlzOw0KfQ0KICAgIA0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpNZXRyaWNfVmFsdWUmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6TWV0cmljX1ZhbHVlOjptZXRyaWMoZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpNZXRyaWMqIHYpew0KICAgIGlmKHYhPW51bGxwdHIpew0KICAgICAgICB0aGlzLT5fbWV0cmljID0gdjsNCiAgICB9DQogICAgcmV0dXJuICp0aGlzOw0KfQ0KICAgIA0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6Ok1ldHJpYyogZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpNZXRyaWNfVmFsdWU6Om1ldHJpYygpew0KICAgIHJldHVybiB0aGlzLT5fbWV0cmljOw0KfQ0KICAgIA0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6Ok1ldHJpY19WYWx1ZSYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpNZXRyaWNfVmFsdWU6OmRldmljZShlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZSYgdil7DQogICAgdGhpcy0+X2RldmljZSA9ICZ2Ow0KICAgIHJldHVybiAqdGhpczsNCn0NCiAgICANCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6TWV0cmljX1ZhbHVlJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6Ok1ldHJpY19WYWx1ZTo6ZGV2aWNlKGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6RGV2aWNlKiB2KXsNCiAgICBpZih2IT1udWxscHRyKXsNCiAgICAgICAgdGhpcy0+X2RldmljZSA9IHY7DQogICAgfQ0KICAgIHJldHVybiAqdGhpczsNCn0NCiAgICANCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpEZXZpY2UqIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6TWV0cmljX1ZhbHVlOjpkZXZpY2UoKXsNCiAgICByZXR1cm4gdGhpcy0+X2RldmljZTsNCn0NCiAgICANCg0KICAgIA0KDQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6TWV0cmljX1ZhbHVlJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6Ok1ldHJpY19WYWx1ZTo6X3VuaXF1ZSgpew0KICAgIHN0ZDo6c3RyaW5nIF9fdG9TdHJpbmcgPSAiTWV0cmljX1ZhbHVlOjpfdW5pcXVlKCk6ICI7DQoNCiAgICBNZXRyaWNfVmFsdWUqIHJldCA9IG5ldyBNZXRyaWNfVmFsdWUoKTsNCiAgICBpZih0aGlzLT5JZCE9MCkgcmV0LT5JZCA9IHRoaXMtPklkOw0KICAgIA0KICAgICAgICANCiAgICBpZih0aGlzLT5tZXRyaWMoKSE9bnVsbHB0cikNCiAgICAgICAgDQogICAgICAgIHJldC0+bWV0cmljKHRoaXMtPm1ldHJpYygpLT5fdW5pcXVlKCkpOw0KICAgIA0KICAgICAgICANCiAgICBpZih0aGlzLT5kZXZpY2UoKSE9bnVsbHB0cikNCiAgICAgICAgDQogICAgICAgIHJldC0+ZGV2aWNlKHRoaXMtPmRldmljZSgpLT5fdW5pcXVlKCkpOw0KICAgIA0KDQogICAgcmV0dXJuICp0aGlzOw0KfQ0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6Ok1ldHJpY19WYWx1ZSYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpNZXRyaWNfVmFsdWU6Ol9mcm9tRG9jdW1lbnQodW5zaWduZWQgY2hhciogb2JqKXsNCiAgICByZXR1cm4gdGhpcy0+X2Zyb21Eb2N1bWVudChzdGQ6OnN0cmluZyggb2JqLCBvYmogKyBzaXplb2Ygb2JqIC8gc2l6ZW9mIG9ialswXSApKTsNCn0NCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpNZXRyaWNfVmFsdWUmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6TWV0cmljX1ZhbHVlOjpfZnJvbURvY3VtZW50KHN0ZDo6c3RyaW5nIG9iail7DQogICAgaWYob2JqLmVtcHR5KCkpIHJldHVybiAqdGhpczsNCg0KICAgIGlmIChzdGQ6OnJlZ2V4X21hdGNoKG9iaiwgc3RkOjpyZWdleChSIiIoKChbQS1aYS16XXszLDl9Oig/Oi8vKT8pKD86Wy07OiY9KyQsd10rQCk/W0EtWmEtejAtOS4tXSt8KD86d3d3LnxbLTs6Jj0rJCx3XStAKVtBLVphLXowLTkuLV0rKSgoPzovWyt+JS8udy1fXSopPz8/KD86Wy0rPSY7JUAud19dKikjPyg/Olt3XSopKT8pIiIpKSl7DQogICAgICAgIHN0ZDo6c3RyaW5nIHJlYWRCdWZmZXI7DQogICAgICAgIENVUkwgKmN1cmwgPSBjdXJsX2Vhc3lfaW5pdCgpOw0KICAgICAgICBjdXJsX2Vhc3lfc2V0b3B0KGN1cmwsIENVUkxPUFRfVVJMLCBvYmopOw0KICAgICAgICBjdXJsX2Vhc3lfc2V0b3B0KGN1cmwsIENVUkxPUFRfRk9MTE9XTE9DQVRJT04sIDFMKTsNCiAgICAgICAgLy9jdXJsX2Vhc3lfc2V0b3B0KGN1cmwsIENVUkxPUFRfV1JJVEVGVU5DVElPTiwgK1tdKHZvaWQgKnB0ciwgc2l6ZV90IHNpemUsIHNpemVfdCBubWVtYiwgdm9pZCAqc3RyZWFtKSAtPiBzaXplX3QgeyByZWFkQnVmZmVyLmFwcGVuZCgqcHRyLCBzaXplICogbm1lbWIpOyB9KTsNCiAgICAgICAgY3VybF9lYXN5X3NldG9wdChjdXJsLCBDVVJMT1BUX1dSSVRFREFUQSwgJnJlYWRCdWZmZXIpOw0KICAgICAgICBjdXJsX2Vhc3lfcGVyZm9ybShjdXJsKTsNCiAgICAgICAgY3VybF9lYXN5X2NsZWFudXAoY3VybCk7DQogICAgICAgIHJldHVybiB0aGlzLT5fZnJvbURvY3VtZW50KHJlYWRCdWZmZXIpOw0KICAgIH0NCg0KICAgIHJldHVybiB0aGlzLT5fZnJvbURvY3VtZW50KGpzb246OnBhcnNlKG9iaikpOw0KfQ0KDQpzdGQ6OnZlY3Rvcjxlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6Ok1ldHJpY19WYWx1ZT4mJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6Ok1ldHJpY19WYWx1ZTo6X2Zyb21Eb2N1bWVudChzdGQ6OnZlY3Rvcjxqc29uPiYmIG9iail7DQogICAgc3RkOjp2ZWN0b3I8TWV0cmljX1ZhbHVlPiogcmV0ID0gbmV3IHN0ZDo6dmVjdG9yPE1ldHJpY19WYWx1ZT4ob2JqLnNpemUoKSk7DQogICAgDQogICAgZm9yIChjb25zdCBqc29uJiBqIDogb2JqKXsNCiAgICAgICAgcmV0LT5wdXNoX2JhY2soKG5ldyBNZXRyaWNfVmFsdWUoKSktPl9mcm9tRG9jdW1lbnQoaikpOw0KICAgIH0NCiAgICANCiAgICByZXR1cm4gbW92ZSgqcmV0KTsNCn0NCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpNZXRyaWNfVmFsdWUmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6TWV0cmljX1ZhbHVlOjpfZnJvbURvY3VtZW50KGpzb24gb2JqKXsNCiAgICANCiAgICBpZihvYmouY29udGFpbnMoImFjdGl2ZSIpKSB0aGlzLT5hY3RpdmUoDQogICAgICAgIA0KICAgICAgICBvYmpbImFjdGl2ZSJdLnRlbXBsYXRlIGdldDxib29sPigpDQogICAgICAgIA0KICAgICAgICApOw0KICAgIA0KICAgIGlmKG9iai5jb250YWlucygiZW5hYmxlZCIpKSB0aGlzLT5lbmFibGVkKA0KICAgICAgICANCiAgICAgICAgb2JqWyJlbmFibGVkIl0udGVtcGxhdGUgZ2V0PGJvb2w+KCkNCiAgICAgICAgDQogICAgICAgICk7DQogICAgDQogICAgaWYob2JqLmNvbnRhaW5zKCJjb2RlIikpIHRoaXMtPmNvZGUoDQogICAgICAgIA0KICAgICAgICBvYmpbImNvZGUiXS50ZW1wbGF0ZSBnZXQ8c3RkOjpzdHJpbmc+KCkNCiAgICAgICAgDQogICAgICAgICk7DQogICAgDQogICAgaWYob2JqLmNvbnRhaW5zKCJvcmRlciIpKSB0aGlzLT5vcmRlcigNCiAgICAgICAgDQogICAgICAgIG9ialsib3JkZXIiXS50ZW1wbGF0ZSBnZXQ8aW50PigpDQogICAgICAgIA0KICAgICAgICApOw0KICAgIA0KICAgIGlmKG9iai5jb250YWlucygiZGF0ZSIpKSB0aGlzLT5kYXRlKA0KICAgICAgICANCiAgICAgICAgb2JqWyJkYXRlIl0udGVtcGxhdGUgZ2V0PHRpbWVfdD4oKQ0KICAgICAgICANCiAgICAgICAgKTsNCiAgICANCiAgICBpZihvYmouY29udGFpbnMoIm5hbWUiKSkgdGhpcy0+bmFtZSgNCiAgICAgICAgDQogICAgICAgIG9ialsibmFtZSJdLnRlbXBsYXRlIGdldDxzdGQ6OnN0cmluZz4oKQ0KICAgICAgICANCiAgICAgICAgKTsNCiAgICANCiAgICBpZihvYmouY29udGFpbnMoInJlbWFyayIpKSB0aGlzLT5yZW1hcmsoDQogICAgICAgIA0KICAgICAgICBvYmpbInJlbWFyayJdLnRlbXBsYXRlIGdldDxzdGQ6OnN0cmluZz4oKQ0KICAgICAgICANCiAgICAgICAgKTsNCiAgICANCiAgICBpZihvYmouY29udGFpbnMoInZhbHVlIikpIHRoaXMtPnZhbHVlKA0KICAgICAgICANCiAgICAgICAgb2JqWyJ2YWx1ZSJdLnRlbXBsYXRlIGdldDxzdGQ6OnN0cmluZz4oKQ0KICAgICAgICANCiAgICAgICAgKTsNCiAgICANCiAgICBpZihvYmouY29udGFpbnMoIm1lYXN1cmVkIikpIHRoaXMtPm1lYXN1cmVkKA0KICAgICAgICANCiAgICAgICAgb2JqWyJtZWFzdXJlZCJdLnRlbXBsYXRlIGdldDx0aW1lX3Q+KCkNCiAgICAgICAgDQogICAgICAgICk7DQogICAgDQogICAgaWYob2JqLmNvbnRhaW5zKCJtZXRyaWMiKSkgdGhpcy0+bWV0cmljKA0KICAgICAgICANCiAgICAgICAgKG5ldyBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6Ok1ldHJpYygpKS0+X2Zyb21Eb2N1bWVudChvYmpbIm1ldHJpYyJdKQ0KICAgICAgICANCiAgICAgICAgKTsNCiAgICANCiAgICBpZihvYmouY29udGFpbnMoImRldmljZSIpKSB0aGlzLT5kZXZpY2UoDQogICAgICAgIA0KICAgICAgICAobmV3IGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6RGV2aWNlKCkpLT5fZnJvbURvY3VtZW50KG9ialsiZGV2aWNlIl0pDQogICAgICAgIA0KICAgICAgICApOw0KICAgIA0KICAgIA0KICAgIA0KICAgIHJldHVybiAqdGhpczsNCn0NCg0Kc3RkOjpzdHJpbmcgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpNZXRyaWNfVmFsdWU6Ol90b0RvY3VtZW50KCl7DQogICAgcmV0dXJuICIiOw0KfQ0KDQogICAgDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6Ok1ldHJpY19WYWx1ZSYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpNZXRyaWNfVmFsdWU6OnN0b3JlKCl7DQogICAgc3RkOjpzdHJpbmcgX190b1N0cmluZyA9ICJNZXRyaWNfVmFsdWU6OnN0b3JlKCk6ICI7DQogICAgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpFdmVudCBfX3Jlc3BvbnNlID0gKG5ldyBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkV2ZW50KCkpLT5jb2RlKCJbIit0aGlzTm9kZS5jb2RlKCkrIkB0aW1lIisiXS5NZXRyaWNfVmFsdWUuc3RvcmUoKSIpLm1ldGhvZCgic3RvcmUiKS5jbGFzc05hbWUoIk1ldHJpY19WYWx1ZSIpLmNhcnJpZXIodGhpc05vZGUpLnNlbmRlcih0aGlzTm9kZSkucmVjaXBpZW50KHRoaXNOb2RlLnBhcmVudCgpKTsNCg0KICAgIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6TWV0cmljX1ZhbHVlKiBhbnN3ZXI7DQoNCiAgICANCg0KICAgIA0KICAgIGlmKGFuc3dlciE9bnVsbHB0cil7DQogICAgDQoNCiAgICANCiAgICAgICAgDQogICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXItPl90b0RvY3VtZW50KCkpOw0KICAgICAgICANCiAgICANCiAgICB9ZWxzZXsNCiAgICAgICAganNvbiBfalJldDsNCiAgICAgICAgX2pSZXRbIl9fdGhpcyJdID0gdGhpcy0+X3RvRG9jdW1lbnQoKTsNCiAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKF9qUmV0KTsNCiAgICAgICAgLy9fX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiB0aGlzLT5fdG9Eb2N1bWVudCgpfSk7DQogICAgfQ0KDQogICAgLy9fX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCg0KICAgIHJldHVybiAqYW5zd2VyOw0KfQ0KICAgIA0Kc3RkOjp2ZWN0b3I8ZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpNZXRyaWNfVmFsdWU+JiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6Ok1ldHJpY19WYWx1ZTo6ZmluZEFsbCgpew0KICAgIHN0ZDo6c3RyaW5nIF9fdG9TdHJpbmcgPSAiTWV0cmljX1ZhbHVlOjpmaW5kQWxsKCk6ICI7DQogICAgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpFdmVudCBfX3Jlc3BvbnNlID0gKG5ldyBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkV2ZW50KCkpLT5jb2RlKCJbIit0aGlzTm9kZS5jb2RlKCkrIkB0aW1lIisiXS5NZXRyaWNfVmFsdWUuZmluZEFsbCgpIikubWV0aG9kKCJmaW5kQWxsIikuY2xhc3NOYW1lKCJNZXRyaWNfVmFsdWUiKS5jYXJyaWVyKHRoaXNOb2RlKS5zZW5kZXIodGhpc05vZGUpLnJlY2lwaWVudCh0aGlzTm9kZS5wYXJlbnQoKSk7DQoNCiAgICBzdGQ6OnZlY3Rvcjxlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6Ok1ldHJpY19WYWx1ZT4qIGFuc3dlcjsNCg0KICAgIA0KDQogICAgDQogICAgaWYoYW5zd2VyLT5lbXB0eSgpKXsNCiAgICANCg0KICAgIA0KICAgICAgICANCiAgICAgICAgLy9fX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLT5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgDQogICAgDQogICAgfWVsc2V7DQogICAgICAgIGpzb24gX2pSZXQ7DQogICAgICAgIF9qUmV0WyJfX3RoaXMiXSA9IHRoaXMtPl90b0RvY3VtZW50KCk7DQogICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChfalJldCk7DQogICAgICAgIC8vX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogdGhpcy0+X3RvRG9jdW1lbnQoKX0pOw0KICAgIH0NCg0KICAgIC8vX19yZXNwb25zZS50cmlnZ2VyKCk7DQoNCiAgICByZXR1cm4gKmFuc3dlcjsNCn0NCiAgICANCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6TWV0cmljX1ZhbHVlJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6Ok1ldHJpY19WYWx1ZTo6ZmluZCgpew0KICAgIHN0ZDo6c3RyaW5nIF9fdG9TdHJpbmcgPSAiTWV0cmljX1ZhbHVlOjpmaW5kKCk6ICI7DQogICAgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpFdmVudCBfX3Jlc3BvbnNlID0gKG5ldyBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkV2ZW50KCkpLT5jb2RlKCJbIit0aGlzTm9kZS5jb2RlKCkrIkB0aW1lIisiXS5NZXRyaWNfVmFsdWUuZmluZCgpIikubWV0aG9kKCJmaW5kIikuY2xhc3NOYW1lKCJNZXRyaWNfVmFsdWUiKS5jYXJyaWVyKHRoaXNOb2RlKS5zZW5kZXIodGhpc05vZGUpLnJlY2lwaWVudCh0aGlzTm9kZS5wYXJlbnQoKSk7DQoNCiAgICBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6Ok1ldHJpY19WYWx1ZSogYW5zd2VyOw0KDQogICAgDQoNCiAgICANCiAgICBpZihhbnN3ZXIhPW51bGxwdHIpew0KICAgIA0KDQogICAgDQogICAgICAgIA0KICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLT5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgDQogICAgDQogICAgfWVsc2V7DQogICAgICAgIGpzb24gX2pSZXQ7DQogICAgICAgIF9qUmV0WyJfX3RoaXMiXSA9IHRoaXMtPl90b0RvY3VtZW50KCk7DQogICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChfalJldCk7DQogICAgICAgIC8vX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogdGhpcy0+X3RvRG9jdW1lbnQoKX0pOw0KICAgIH0NCg0KICAgIC8vX19yZXNwb25zZS50cmlnZ2VyKCk7DQoNCiAgICByZXR1cm4gKmFuc3dlcjsNCn0NCiAgICANCg0KICAgIA0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZSYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpEZXZpY2U6OmFjdGl2ZShib29sIHYpew0KICAgIHRoaXMtPl9hY3RpdmUgPSB2Ow0KICAgIHJldHVybiAqdGhpczsNCn0NCiAgICANCg0KYm9vbCBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZTo6YWN0aXZlKCl7DQogICAgcmV0dXJuIHRoaXMtPl9hY3RpdmU7DQp9DQogICAgDQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6RGV2aWNlJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZTo6ZW5hYmxlZChib29sIHYpew0KICAgIHRoaXMtPl9lbmFibGVkID0gdjsNCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQoNCmJvb2wgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpEZXZpY2U6OmVuYWJsZWQoKXsNCiAgICByZXR1cm4gdGhpcy0+X2VuYWJsZWQ7DQp9DQogICAgDQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6RGV2aWNlJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZTo6Y29kZShzdGQ6OnN0cmluZyB2KXsNCiAgICB0aGlzLT5fY29kZSA9IHY7DQogICAgcmV0dXJuICp0aGlzOw0KfQ0KICAgIA0KDQpzdGQ6OnN0cmluZyBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZTo6Y29kZSgpew0KICAgIHJldHVybiB0aGlzLT5fY29kZTsNCn0NCiAgICANCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpEZXZpY2UmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6RGV2aWNlOjpvcmRlcihpbnQgdil7DQogICAgdGhpcy0+X29yZGVyID0gdjsNCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQoNCmludCBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZTo6b3JkZXIoKXsNCiAgICByZXR1cm4gdGhpcy0+X29yZGVyOw0KfQ0KICAgIA0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZSYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpEZXZpY2U6OmRhdGUodGltZV90IHYpew0KICAgIHRoaXMtPl9kYXRlID0gdjsNCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQoNCnRpbWVfdCBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZTo6ZGF0ZSgpew0KICAgIHJldHVybiB0aGlzLT5fZGF0ZTsNCn0NCiAgICANCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpEZXZpY2UmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6RGV2aWNlOjpuYW1lKHN0ZDo6c3RyaW5nIHYpew0KICAgIHRoaXMtPl9uYW1lID0gdjsNCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQoNCnN0ZDo6c3RyaW5nIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6RGV2aWNlOjpuYW1lKCl7DQogICAgcmV0dXJuIHRoaXMtPl9uYW1lOw0KfQ0KICAgIA0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZSYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpEZXZpY2U6OnJlbWFyayhzdGQ6OnN0cmluZyB2KXsNCiAgICB0aGlzLT5fcmVtYXJrID0gdjsNCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZSYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpEZXZpY2U6OnJlbWFyayhqc29uIHYpew0KICAgIC8vdGhpcy0+X3JlbWFyaw0KICAgIHJldHVybiAqdGhpczsNCn0NCiAgICANCg0Kc3RkOjpzdHJpbmcgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpEZXZpY2U6OnJlbWFyaygpew0KICAgIHJldHVybiB0aGlzLT5fcmVtYXJrOw0KfQ0KICAgIA0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZSYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpEZXZpY2U6OnR5cGUoZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpEZXZpY2VfVHlwZSYgdil7DQogICAgdGhpcy0+X3R5cGUgPSAmdjsNCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZSYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpEZXZpY2U6OnR5cGUoZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpEZXZpY2VfVHlwZSogdil7DQogICAgaWYodiE9bnVsbHB0cil7DQogICAgICAgIHRoaXMtPl90eXBlID0gdjsNCiAgICB9DQogICAgcmV0dXJuICp0aGlzOw0KfQ0KICAgIA0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZV9UeXBlKiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZTo6dHlwZSgpew0KICAgIHJldHVybiB0aGlzLT5fdHlwZTsNCn0NCiAgICANCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpEZXZpY2UmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6RGV2aWNlOjpjb250cm9sbGVyKGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZSYgdil7DQogICAgdGhpcy0+X2NvbnRyb2xsZXIgPSAmdjsNCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZSYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpEZXZpY2U6OmNvbnRyb2xsZXIoZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlKiB2KXsNCiAgICBpZih2IT1udWxscHRyKXsNCiAgICAgICAgdGhpcy0+X2NvbnRyb2xsZXIgPSB2Ow0KICAgIH0NCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZSogZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpEZXZpY2U6OmNvbnRyb2xsZXIoKXsNCiAgICByZXR1cm4gdGhpcy0+X2NvbnRyb2xsZXI7DQp9DQogICAgDQoNCiAgICANCnN0ZDo6dmVjdG9yPHN0ZDo6YW55PiYmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6RGV2aWNlOjpkZXZpY2VfTWV0cmljX1ZhbHVlcygpew0KICAgIHJldHVybiBtb3ZlKCoodGhpcy0+X2RldmljZV9NZXRyaWNfVmFsdWVzKSk7DQp9DQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6RGV2aWNlJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZTo6ZGV2aWNlX01ldHJpY19WYWx1ZXMoc3RkOjp2ZWN0b3I8c3RkOjphbnk+JiYgdil7DQogICAgcmV0dXJuICp0aGlzOw0KfQ0KICAgIA0Kc3RkOjp2ZWN0b3I8c3RkOjphbnk+JiYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpEZXZpY2U6OmRldmljZV9EZXZpY2VfQXR0cmlidXRlcygpew0KICAgIHJldHVybiBtb3ZlKCoodGhpcy0+X2RldmljZV9EZXZpY2VfQXR0cmlidXRlcykpOw0KfQ0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZSYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpEZXZpY2U6OmRldmljZV9EZXZpY2VfQXR0cmlidXRlcyhzdGQ6OnZlY3RvcjxzdGQ6OmFueT4mJiB2KXsNCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQoNCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpEZXZpY2UmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6RGV2aWNlOjpfdW5pcXVlKCl7DQogICAgc3RkOjpzdHJpbmcgX190b1N0cmluZyA9ICJEZXZpY2U6Ol91bmlxdWUoKTogIjsNCg0KICAgIERldmljZSogcmV0ID0gbmV3IERldmljZSgpOw0KICAgIGlmKHRoaXMtPklkIT0wKSByZXQtPklkID0gdGhpcy0+SWQ7DQogICAgDQogICAgICAgIA0KICAgIGlmKHRoaXMtPmNvZGUoKS5lbXB0eSgpKQ0KICAgICAgICANCiAgICAgICAgcmV0LT5jb2RlKHRoaXMtPmNvZGUoKSk7DQogICAgDQoNCiAgICByZXR1cm4gKnRoaXM7DQp9DQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6RGV2aWNlJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZTo6X2Zyb21Eb2N1bWVudCh1bnNpZ25lZCBjaGFyKiBvYmopew0KICAgIHJldHVybiB0aGlzLT5fZnJvbURvY3VtZW50KHN0ZDo6c3RyaW5nKCBvYmosIG9iaiArIHNpemVvZiBvYmogLyBzaXplb2Ygb2JqWzBdICkpOw0KfQ0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZSYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpEZXZpY2U6Ol9mcm9tRG9jdW1lbnQoc3RkOjpzdHJpbmcgb2JqKXsNCiAgICBpZihvYmouZW1wdHkoKSkgcmV0dXJuICp0aGlzOw0KDQogICAgaWYgKHN0ZDo6cmVnZXhfbWF0Y2gob2JqLCBzdGQ6OnJlZ2V4KFIiIigoKFtBLVphLXpdezMsOX06KD86Ly8pPykoPzpbLTs6Jj0rJCx3XStAKT9bQS1aYS16MC05Li1dK3woPzp3d3cufFstOzomPSskLHddK0ApW0EtWmEtejAtOS4tXSspKCg/Oi9bK34lLy53LV9dKik/Pz8oPzpbLSs9JjslQC53X10qKSM/KD86W3ddKikpPykiIikpKXsNCiAgICAgICAgc3RkOjpzdHJpbmcgcmVhZEJ1ZmZlcjsNCiAgICAgICAgQ1VSTCAqY3VybCA9IGN1cmxfZWFzeV9pbml0KCk7DQogICAgICAgIGN1cmxfZWFzeV9zZXRvcHQoY3VybCwgQ1VSTE9QVF9VUkwsIG9iaik7DQogICAgICAgIGN1cmxfZWFzeV9zZXRvcHQoY3VybCwgQ1VSTE9QVF9GT0xMT1dMT0NBVElPTiwgMUwpOw0KICAgICAgICAvL2N1cmxfZWFzeV9zZXRvcHQoY3VybCwgQ1VSTE9QVF9XUklURUZVTkNUSU9OLCArW10odm9pZCAqcHRyLCBzaXplX3Qgc2l6ZSwgc2l6ZV90IG5tZW1iLCB2b2lkICpzdHJlYW0pIC0+IHNpemVfdCB7IHJlYWRCdWZmZXIuYXBwZW5kKCpwdHIsIHNpemUgKiBubWVtYik7IH0pOw0KICAgICAgICBjdXJsX2Vhc3lfc2V0b3B0KGN1cmwsIENVUkxPUFRfV1JJVEVEQVRBLCAmcmVhZEJ1ZmZlcik7DQogICAgICAgIGN1cmxfZWFzeV9wZXJmb3JtKGN1cmwpOw0KICAgICAgICBjdXJsX2Vhc3lfY2xlYW51cChjdXJsKTsNCiAgICAgICAgcmV0dXJuIHRoaXMtPl9mcm9tRG9jdW1lbnQocmVhZEJ1ZmZlcik7DQogICAgfQ0KDQogICAgcmV0dXJuIHRoaXMtPl9mcm9tRG9jdW1lbnQoanNvbjo6cGFyc2Uob2JqKSk7DQp9DQoNCnN0ZDo6dmVjdG9yPGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6RGV2aWNlPiYmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6RGV2aWNlOjpfZnJvbURvY3VtZW50KHN0ZDo6dmVjdG9yPGpzb24+JiYgb2JqKXsNCiAgICBzdGQ6OnZlY3RvcjxEZXZpY2U+KiByZXQgPSBuZXcgc3RkOjp2ZWN0b3I8RGV2aWNlPihvYmouc2l6ZSgpKTsNCiAgICANCiAgICBmb3IgKGNvbnN0IGpzb24mIGogOiBvYmopew0KICAgICAgICByZXQtPnB1c2hfYmFjaygobmV3IERldmljZSgpKS0+X2Zyb21Eb2N1bWVudChqKSk7DQogICAgfQ0KICAgIA0KICAgIHJldHVybiBtb3ZlKCpyZXQpOw0KfQ0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZSYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpEZXZpY2U6Ol9mcm9tRG9jdW1lbnQoanNvbiBvYmopew0KICAgIA0KICAgIGlmKG9iai5jb250YWlucygiYWN0aXZlIikpIHRoaXMtPmFjdGl2ZSgNCiAgICAgICAgDQogICAgICAgIG9ialsiYWN0aXZlIl0udGVtcGxhdGUgZ2V0PGJvb2w+KCkNCiAgICAgICAgDQogICAgICAgICk7DQogICAgDQogICAgaWYob2JqLmNvbnRhaW5zKCJlbmFibGVkIikpIHRoaXMtPmVuYWJsZWQoDQogICAgICAgIA0KICAgICAgICBvYmpbImVuYWJsZWQiXS50ZW1wbGF0ZSBnZXQ8Ym9vbD4oKQ0KICAgICAgICANCiAgICAgICAgKTsNCiAgICANCiAgICBpZihvYmouY29udGFpbnMoImNvZGUiKSkgdGhpcy0+Y29kZSgNCiAgICAgICAgDQogICAgICAgIG9ialsiY29kZSJdLnRlbXBsYXRlIGdldDxzdGQ6OnN0cmluZz4oKQ0KICAgICAgICANCiAgICAgICAgKTsNCiAgICANCiAgICBpZihvYmouY29udGFpbnMoIm9yZGVyIikpIHRoaXMtPm9yZGVyKA0KICAgICAgICANCiAgICAgICAgb2JqWyJvcmRlciJdLnRlbXBsYXRlIGdldDxpbnQ+KCkNCiAgICAgICAgDQogICAgICAgICk7DQogICAgDQogICAgaWYob2JqLmNvbnRhaW5zKCJkYXRlIikpIHRoaXMtPmRhdGUoDQogICAgICAgIA0KICAgICAgICBvYmpbImRhdGUiXS50ZW1wbGF0ZSBnZXQ8dGltZV90PigpDQogICAgICAgIA0KICAgICAgICApOw0KICAgIA0KICAgIGlmKG9iai5jb250YWlucygibmFtZSIpKSB0aGlzLT5uYW1lKA0KICAgICAgICANCiAgICAgICAgb2JqWyJuYW1lIl0udGVtcGxhdGUgZ2V0PHN0ZDo6c3RyaW5nPigpDQogICAgICAgIA0KICAgICAgICApOw0KICAgIA0KICAgIGlmKG9iai5jb250YWlucygicmVtYXJrIikpIHRoaXMtPnJlbWFyaygNCiAgICAgICAgDQogICAgICAgIG9ialsicmVtYXJrIl0udGVtcGxhdGUgZ2V0PHN0ZDo6c3RyaW5nPigpDQogICAgICAgIA0KICAgICAgICApOw0KICAgIA0KICAgIGlmKG9iai5jb250YWlucygidHlwZSIpKSB0aGlzLT50eXBlKA0KICAgICAgICANCiAgICAgICAgKG5ldyBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZV9UeXBlKCkpLT5fZnJvbURvY3VtZW50KG9ialsidHlwZSJdKQ0KICAgICAgICANCiAgICAgICAgKTsNCiAgICANCiAgICBpZihvYmouY29udGFpbnMoImNvbnRyb2xsZXIiKSkgdGhpcy0+Y29udHJvbGxlcigNCiAgICAgICAgDQogICAgICAgIChuZXcgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlKCkpLT5fZnJvbURvY3VtZW50KG9ialsiY29udHJvbGxlciJdKQ0KICAgICAgICANCiAgICAgICAgKTsNCiAgICANCiAgICANCiAgICANCiAgICBpZihvYmouY29udGFpbnMoImRldmljZV9NZXRyaWNfVmFsdWVzIikpIHRoaXMtPmRldmljZV9NZXRyaWNfVmFsdWVzKChuZXcgTWV0cmljX1ZhbHVlKCkpLT5fZnJvbURvY3VtZW50KChzdGQ6OnZlY3Rvcjxqc29uPilvYmpbImRldmljZV9NZXRyaWNfVmFsdWVzIl0pKTsNCiAgICANCiAgICBpZihvYmouY29udGFpbnMoImRldmljZV9EZXZpY2VfQXR0cmlidXRlcyIpKSB0aGlzLT5kZXZpY2VfRGV2aWNlX0F0dHJpYnV0ZXMoKG5ldyBEZXZpY2VfQXR0cmlidXRlKCkpLT5fZnJvbURvY3VtZW50KChzdGQ6OnZlY3Rvcjxqc29uPilvYmpbImRldmljZV9EZXZpY2VfQXR0cmlidXRlcyJdKSk7DQogICAgDQogICAgcmV0dXJuICp0aGlzOw0KfQ0KDQpzdGQ6OnN0cmluZyBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZTo6X3RvRG9jdW1lbnQoKXsNCiAgICByZXR1cm4gIiI7DQp9DQoNCiAgICANCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6RGV2aWNlJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZTo6c3RvcmUoKXsNCiAgICBzdGQ6OnN0cmluZyBfX3RvU3RyaW5nID0gIkRldmljZTo6c3RvcmUoKTogIjsNCiAgICBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkV2ZW50IF9fcmVzcG9uc2UgPSAobmV3IGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6RXZlbnQoKSktPmNvZGUoIlsiK3RoaXNOb2RlLmNvZGUoKSsiQHRpbWUiKyJdLkRldmljZS5zdG9yZSgpIikubWV0aG9kKCJzdG9yZSIpLmNsYXNzTmFtZSgiRGV2aWNlIikuY2Fycmllcih0aGlzTm9kZSkuc2VuZGVyKHRoaXNOb2RlKS5yZWNpcGllbnQodGhpc05vZGUucGFyZW50KCkpOw0KDQogICAgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpEZXZpY2UqIGFuc3dlcjsNCg0KICAgIA0KDQogICAgDQogICAgaWYoYW5zd2VyIT1udWxscHRyKXsNCiAgICANCg0KICAgIA0KICAgICAgICANCiAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci0+X3RvRG9jdW1lbnQoKSk7DQogICAgICAgIA0KICAgIA0KICAgIH1lbHNlew0KICAgICAgICBqc29uIF9qUmV0Ow0KICAgICAgICBfalJldFsiX190aGlzIl0gPSB0aGlzLT5fdG9Eb2N1bWVudCgpOw0KICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoX2pSZXQpOw0KICAgICAgICAvL19fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHRoaXMtPl90b0RvY3VtZW50KCl9KTsNCiAgICB9DQoNCiAgICAvL19fcmVzcG9uc2UudHJpZ2dlcigpOw0KDQogICAgcmV0dXJuICphbnN3ZXI7DQp9DQogICAgDQpzdGQ6OnZlY3Rvcjxlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZT4mIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6RGV2aWNlOjpmaW5kQWxsKCl7DQogICAgc3RkOjpzdHJpbmcgX190b1N0cmluZyA9ICJEZXZpY2U6OmZpbmRBbGwoKTogIjsNCiAgICBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkV2ZW50IF9fcmVzcG9uc2UgPSAobmV3IGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6RXZlbnQoKSktPmNvZGUoIlsiK3RoaXNOb2RlLmNvZGUoKSsiQHRpbWUiKyJdLkRldmljZS5maW5kQWxsKCkiKS5tZXRob2QoImZpbmRBbGwiKS5jbGFzc05hbWUoIkRldmljZSIpLmNhcnJpZXIodGhpc05vZGUpLnNlbmRlcih0aGlzTm9kZSkucmVjaXBpZW50KHRoaXNOb2RlLnBhcmVudCgpKTsNCg0KICAgIHN0ZDo6dmVjdG9yPGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6RGV2aWNlPiogYW5zd2VyOw0KDQogICAgDQoNCiAgICANCiAgICBpZihhbnN3ZXItPmVtcHR5KCkpew0KICAgIA0KDQogICAgDQogICAgICAgIA0KICAgICAgICAvL19fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXItPl90b0RvY3VtZW50KCkpOw0KICAgICAgICANCiAgICANCiAgICB9ZWxzZXsNCiAgICAgICAganNvbiBfalJldDsNCiAgICAgICAgX2pSZXRbIl9fdGhpcyJdID0gdGhpcy0+X3RvRG9jdW1lbnQoKTsNCiAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKF9qUmV0KTsNCiAgICAgICAgLy9fX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiB0aGlzLT5fdG9Eb2N1bWVudCgpfSk7DQogICAgfQ0KDQogICAgLy9fX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCg0KICAgIHJldHVybiAqYW5zd2VyOw0KfQ0KICAgIA0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpEZXZpY2UmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6RGV2aWNlOjpmaW5kKCl7DQogICAgc3RkOjpzdHJpbmcgX190b1N0cmluZyA9ICJEZXZpY2U6OmZpbmQoKTogIjsNCiAgICBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkV2ZW50IF9fcmVzcG9uc2UgPSAobmV3IGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6RXZlbnQoKSktPmNvZGUoIlsiK3RoaXNOb2RlLmNvZGUoKSsiQHRpbWUiKyJdLkRldmljZS5maW5kKCkiKS5tZXRob2QoImZpbmQiKS5jbGFzc05hbWUoIkRldmljZSIpLmNhcnJpZXIodGhpc05vZGUpLnNlbmRlcih0aGlzTm9kZSkucmVjaXBpZW50KHRoaXNOb2RlLnBhcmVudCgpKTsNCg0KICAgIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6RGV2aWNlKiBhbnN3ZXI7DQoNCiAgICANCg0KICAgIA0KICAgIGlmKGFuc3dlciE9bnVsbHB0cil7DQogICAgDQoNCiAgICANCiAgICAgICAgDQogICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXItPl90b0RvY3VtZW50KCkpOw0KICAgICAgICANCiAgICANCiAgICB9ZWxzZXsNCiAgICAgICAganNvbiBfalJldDsNCiAgICAgICAgX2pSZXRbIl9fdGhpcyJdID0gdGhpcy0+X3RvRG9jdW1lbnQoKTsNCiAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKF9qUmV0KTsNCiAgICAgICAgLy9fX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiB0aGlzLT5fdG9Eb2N1bWVudCgpfSk7DQogICAgfQ0KDQogICAgLy9fX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCg0KICAgIHJldHVybiAqYW5zd2VyOw0KfQ0KICAgIA0KDQogICAgDQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6RGV2aWNlX0F0dHJpYnV0ZSYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpEZXZpY2VfQXR0cmlidXRlOjphY3RpdmUoYm9vbCB2KXsNCiAgICB0aGlzLT5fYWN0aXZlID0gdjsNCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQoNCmJvb2wgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpEZXZpY2VfQXR0cmlidXRlOjphY3RpdmUoKXsNCiAgICByZXR1cm4gdGhpcy0+X2FjdGl2ZTsNCn0NCiAgICANCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpEZXZpY2VfQXR0cmlidXRlJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZV9BdHRyaWJ1dGU6OmVuYWJsZWQoYm9vbCB2KXsNCiAgICB0aGlzLT5fZW5hYmxlZCA9IHY7DQogICAgcmV0dXJuICp0aGlzOw0KfQ0KICAgIA0KDQpib29sIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6RGV2aWNlX0F0dHJpYnV0ZTo6ZW5hYmxlZCgpew0KICAgIHJldHVybiB0aGlzLT5fZW5hYmxlZDsNCn0NCiAgICANCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpEZXZpY2VfQXR0cmlidXRlJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZV9BdHRyaWJ1dGU6OmNvZGUoc3RkOjpzdHJpbmcgdil7DQogICAgdGhpcy0+X2NvZGUgPSB2Ow0KICAgIHJldHVybiAqdGhpczsNCn0NCiAgICANCg0Kc3RkOjpzdHJpbmcgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpEZXZpY2VfQXR0cmlidXRlOjpjb2RlKCl7DQogICAgcmV0dXJuIHRoaXMtPl9jb2RlOw0KfQ0KICAgIA0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZV9BdHRyaWJ1dGUmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6RGV2aWNlX0F0dHJpYnV0ZTo6b3JkZXIoaW50IHYpew0KICAgIHRoaXMtPl9vcmRlciA9IHY7DQogICAgcmV0dXJuICp0aGlzOw0KfQ0KICAgIA0KDQppbnQgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpEZXZpY2VfQXR0cmlidXRlOjpvcmRlcigpew0KICAgIHJldHVybiB0aGlzLT5fb3JkZXI7DQp9DQogICAgDQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6RGV2aWNlX0F0dHJpYnV0ZSYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpEZXZpY2VfQXR0cmlidXRlOjpkYXRlKHRpbWVfdCB2KXsNCiAgICB0aGlzLT5fZGF0ZSA9IHY7DQogICAgcmV0dXJuICp0aGlzOw0KfQ0KICAgIA0KDQp0aW1lX3QgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpEZXZpY2VfQXR0cmlidXRlOjpkYXRlKCl7DQogICAgcmV0dXJuIHRoaXMtPl9kYXRlOw0KfQ0KICAgIA0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZV9BdHRyaWJ1dGUmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6RGV2aWNlX0F0dHJpYnV0ZTo6bmFtZShzdGQ6OnN0cmluZyB2KXsNCiAgICB0aGlzLT5fbmFtZSA9IHY7DQogICAgcmV0dXJuICp0aGlzOw0KfQ0KICAgIA0KDQpzdGQ6OnN0cmluZyBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZV9BdHRyaWJ1dGU6Om5hbWUoKXsNCiAgICByZXR1cm4gdGhpcy0+X25hbWU7DQp9DQogICAgDQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6RGV2aWNlX0F0dHJpYnV0ZSYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpEZXZpY2VfQXR0cmlidXRlOjpyZW1hcmsoc3RkOjpzdHJpbmcgdil7DQogICAgdGhpcy0+X3JlbWFyayA9IHY7DQogICAgcmV0dXJuICp0aGlzOw0KfQ0KICAgIA0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpEZXZpY2VfQXR0cmlidXRlJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZV9BdHRyaWJ1dGU6OnJlbWFyayhqc29uIHYpew0KICAgIC8vdGhpcy0+X3JlbWFyaw0KICAgIHJldHVybiAqdGhpczsNCn0NCiAgICANCg0Kc3RkOjpzdHJpbmcgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpEZXZpY2VfQXR0cmlidXRlOjpyZW1hcmsoKXsNCiAgICByZXR1cm4gdGhpcy0+X3JlbWFyazsNCn0NCiAgICANCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpEZXZpY2VfQXR0cmlidXRlJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZV9BdHRyaWJ1dGU6OnZhbHVlKHN0ZDo6c3RyaW5nIHYpew0KICAgIHRoaXMtPl92YWx1ZSA9IHY7DQogICAgcmV0dXJuICp0aGlzOw0KfQ0KICAgIA0KDQpzdGQ6OnN0cmluZyBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZV9BdHRyaWJ1dGU6OnZhbHVlKCl7DQogICAgcmV0dXJuIHRoaXMtPl92YWx1ZTsNCn0NCiAgICANCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpEZXZpY2VfQXR0cmlidXRlJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZV9BdHRyaWJ1dGU6OmRldmljZShlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZSYgdil7DQogICAgdGhpcy0+X2RldmljZSA9ICZ2Ow0KICAgIHJldHVybiAqdGhpczsNCn0NCiAgICANCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6RGV2aWNlX0F0dHJpYnV0ZSYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpEZXZpY2VfQXR0cmlidXRlOjpkZXZpY2UoZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpEZXZpY2UqIHYpew0KICAgIGlmKHYhPW51bGxwdHIpew0KICAgICAgICB0aGlzLT5fZGV2aWNlID0gdjsNCiAgICB9DQogICAgcmV0dXJuICp0aGlzOw0KfQ0KICAgIA0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZSogZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpEZXZpY2VfQXR0cmlidXRlOjpkZXZpY2UoKXsNCiAgICByZXR1cm4gdGhpcy0+X2RldmljZTsNCn0NCiAgICANCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpEZXZpY2VfQXR0cmlidXRlJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZV9BdHRyaWJ1dGU6OmF0dHJpYnV0ZShlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OlR5cGVfQXR0cmlidXRlJiB2KXsNCiAgICB0aGlzLT5fYXR0cmlidXRlID0gJnY7DQogICAgcmV0dXJuICp0aGlzOw0KfQ0KICAgIA0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpEZXZpY2VfQXR0cmlidXRlJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZV9BdHRyaWJ1dGU6OmF0dHJpYnV0ZShlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OlR5cGVfQXR0cmlidXRlKiB2KXsNCiAgICBpZih2IT1udWxscHRyKXsNCiAgICAgICAgdGhpcy0+X2F0dHJpYnV0ZSA9IHY7DQogICAgfQ0KICAgIHJldHVybiAqdGhpczsNCn0NCiAgICANCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpUeXBlX0F0dHJpYnV0ZSogZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpEZXZpY2VfQXR0cmlidXRlOjphdHRyaWJ1dGUoKXsNCiAgICByZXR1cm4gdGhpcy0+X2F0dHJpYnV0ZTsNCn0NCiAgICANCg0KICAgIA0KDQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6RGV2aWNlX0F0dHJpYnV0ZSYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpEZXZpY2VfQXR0cmlidXRlOjpfdW5pcXVlKCl7DQogICAgc3RkOjpzdHJpbmcgX190b1N0cmluZyA9ICJEZXZpY2VfQXR0cmlidXRlOjpfdW5pcXVlKCk6ICI7DQoNCiAgICBEZXZpY2VfQXR0cmlidXRlKiByZXQgPSBuZXcgRGV2aWNlX0F0dHJpYnV0ZSgpOw0KICAgIGlmKHRoaXMtPklkIT0wKSByZXQtPklkID0gdGhpcy0+SWQ7DQogICAgDQogICAgICAgIA0KICAgIGlmKHRoaXMtPmRldmljZSgpIT1udWxscHRyKQ0KICAgICAgICANCiAgICAgICAgcmV0LT5kZXZpY2UodGhpcy0+ZGV2aWNlKCktPl91bmlxdWUoKSk7DQogICAgDQogICAgICAgIA0KICAgIGlmKHRoaXMtPmF0dHJpYnV0ZSgpIT1udWxscHRyKQ0KICAgICAgICANCiAgICAgICAgcmV0LT5hdHRyaWJ1dGUodGhpcy0+YXR0cmlidXRlKCktPl91bmlxdWUoKSk7DQogICAgDQoNCiAgICByZXR1cm4gKnRoaXM7DQp9DQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6RGV2aWNlX0F0dHJpYnV0ZSYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpEZXZpY2VfQXR0cmlidXRlOjpfZnJvbURvY3VtZW50KHVuc2lnbmVkIGNoYXIqIG9iail7DQogICAgcmV0dXJuIHRoaXMtPl9mcm9tRG9jdW1lbnQoc3RkOjpzdHJpbmcoIG9iaiwgb2JqICsgc2l6ZW9mIG9iaiAvIHNpemVvZiBvYmpbMF0gKSk7DQp9DQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6RGV2aWNlX0F0dHJpYnV0ZSYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpEZXZpY2VfQXR0cmlidXRlOjpfZnJvbURvY3VtZW50KHN0ZDo6c3RyaW5nIG9iail7DQogICAgaWYob2JqLmVtcHR5KCkpIHJldHVybiAqdGhpczsNCg0KICAgIGlmIChzdGQ6OnJlZ2V4X21hdGNoKG9iaiwgc3RkOjpyZWdleChSIiIoKChbQS1aYS16XXszLDl9Oig/Oi8vKT8pKD86Wy07OiY9KyQsd10rQCk/W0EtWmEtejAtOS4tXSt8KD86d3d3LnxbLTs6Jj0rJCx3XStAKVtBLVphLXowLTkuLV0rKSgoPzovWyt+JS8udy1fXSopPz8/KD86Wy0rPSY7JUAud19dKikjPyg/Olt3XSopKT8pIiIpKSl7DQogICAgICAgIHN0ZDo6c3RyaW5nIHJlYWRCdWZmZXI7DQogICAgICAgIENVUkwgKmN1cmwgPSBjdXJsX2Vhc3lfaW5pdCgpOw0KICAgICAgICBjdXJsX2Vhc3lfc2V0b3B0KGN1cmwsIENVUkxPUFRfVVJMLCBvYmopOw0KICAgICAgICBjdXJsX2Vhc3lfc2V0b3B0KGN1cmwsIENVUkxPUFRfRk9MTE9XTE9DQVRJT04sIDFMKTsNCiAgICAgICAgLy9jdXJsX2Vhc3lfc2V0b3B0KGN1cmwsIENVUkxPUFRfV1JJVEVGVU5DVElPTiwgK1tdKHZvaWQgKnB0ciwgc2l6ZV90IHNpemUsIHNpemVfdCBubWVtYiwgdm9pZCAqc3RyZWFtKSAtPiBzaXplX3QgeyByZWFkQnVmZmVyLmFwcGVuZCgqcHRyLCBzaXplICogbm1lbWIpOyB9KTsNCiAgICAgICAgY3VybF9lYXN5X3NldG9wdChjdXJsLCBDVVJMT1BUX1dSSVRFREFUQSwgJnJlYWRCdWZmZXIpOw0KICAgICAgICBjdXJsX2Vhc3lfcGVyZm9ybShjdXJsKTsNCiAgICAgICAgY3VybF9lYXN5X2NsZWFudXAoY3VybCk7DQogICAgICAgIHJldHVybiB0aGlzLT5fZnJvbURvY3VtZW50KHJlYWRCdWZmZXIpOw0KICAgIH0NCg0KICAgIHJldHVybiB0aGlzLT5fZnJvbURvY3VtZW50KGpzb246OnBhcnNlKG9iaikpOw0KfQ0KDQpzdGQ6OnZlY3Rvcjxlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZV9BdHRyaWJ1dGU+JiYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpEZXZpY2VfQXR0cmlidXRlOjpfZnJvbURvY3VtZW50KHN0ZDo6dmVjdG9yPGpzb24+JiYgb2JqKXsNCiAgICBzdGQ6OnZlY3RvcjxEZXZpY2VfQXR0cmlidXRlPiogcmV0ID0gbmV3IHN0ZDo6dmVjdG9yPERldmljZV9BdHRyaWJ1dGU+KG9iai5zaXplKCkpOw0KICAgIA0KICAgIGZvciAoY29uc3QganNvbiYgaiA6IG9iail7DQogICAgICAgIHJldC0+cHVzaF9iYWNrKChuZXcgRGV2aWNlX0F0dHJpYnV0ZSgpKS0+X2Zyb21Eb2N1bWVudChqKSk7DQogICAgfQ0KICAgIA0KICAgIHJldHVybiBtb3ZlKCpyZXQpOw0KfQ0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZV9BdHRyaWJ1dGUmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6RGV2aWNlX0F0dHJpYnV0ZTo6X2Zyb21Eb2N1bWVudChqc29uIG9iail7DQogICAgDQogICAgaWYob2JqLmNvbnRhaW5zKCJhY3RpdmUiKSkgdGhpcy0+YWN0aXZlKA0KICAgICAgICANCiAgICAgICAgb2JqWyJhY3RpdmUiXS50ZW1wbGF0ZSBnZXQ8Ym9vbD4oKQ0KICAgICAgICANCiAgICAgICAgKTsNCiAgICANCiAgICBpZihvYmouY29udGFpbnMoImVuYWJsZWQiKSkgdGhpcy0+ZW5hYmxlZCgNCiAgICAgICAgDQogICAgICAgIG9ialsiZW5hYmxlZCJdLnRlbXBsYXRlIGdldDxib29sPigpDQogICAgICAgIA0KICAgICAgICApOw0KICAgIA0KICAgIGlmKG9iai5jb250YWlucygiY29kZSIpKSB0aGlzLT5jb2RlKA0KICAgICAgICANCiAgICAgICAgb2JqWyJjb2RlIl0udGVtcGxhdGUgZ2V0PHN0ZDo6c3RyaW5nPigpDQogICAgICAgIA0KICAgICAgICApOw0KICAgIA0KICAgIGlmKG9iai5jb250YWlucygib3JkZXIiKSkgdGhpcy0+b3JkZXIoDQogICAgICAgIA0KICAgICAgICBvYmpbIm9yZGVyIl0udGVtcGxhdGUgZ2V0PGludD4oKQ0KICAgICAgICANCiAgICAgICAgKTsNCiAgICANCiAgICBpZihvYmouY29udGFpbnMoImRhdGUiKSkgdGhpcy0+ZGF0ZSgNCiAgICAgICAgDQogICAgICAgIG9ialsiZGF0ZSJdLnRlbXBsYXRlIGdldDx0aW1lX3Q+KCkNCiAgICAgICAgDQogICAgICAgICk7DQogICAgDQogICAgaWYob2JqLmNvbnRhaW5zKCJuYW1lIikpIHRoaXMtPm5hbWUoDQogICAgICAgIA0KICAgICAgICBvYmpbIm5hbWUiXS50ZW1wbGF0ZSBnZXQ8c3RkOjpzdHJpbmc+KCkNCiAgICAgICAgDQogICAgICAgICk7DQogICAgDQogICAgaWYob2JqLmNvbnRhaW5zKCJyZW1hcmsiKSkgdGhpcy0+cmVtYXJrKA0KICAgICAgICANCiAgICAgICAgb2JqWyJyZW1hcmsiXS50ZW1wbGF0ZSBnZXQ8c3RkOjpzdHJpbmc+KCkNCiAgICAgICAgDQogICAgICAgICk7DQogICAgDQogICAgaWYob2JqLmNvbnRhaW5zKCJ2YWx1ZSIpKSB0aGlzLT52YWx1ZSgNCiAgICAgICAgDQogICAgICAgIG9ialsidmFsdWUiXS50ZW1wbGF0ZSBnZXQ8c3RkOjpzdHJpbmc+KCkNCiAgICAgICAgDQogICAgICAgICk7DQogICAgDQogICAgaWYob2JqLmNvbnRhaW5zKCJkZXZpY2UiKSkgdGhpcy0+ZGV2aWNlKA0KICAgICAgICANCiAgICAgICAgKG5ldyBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZSgpKS0+X2Zyb21Eb2N1bWVudChvYmpbImRldmljZSJdKQ0KICAgICAgICANCiAgICAgICAgKTsNCiAgICANCiAgICBpZihvYmouY29udGFpbnMoImF0dHJpYnV0ZSIpKSB0aGlzLT5hdHRyaWJ1dGUoDQogICAgICAgIA0KICAgICAgICAobmV3IGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6VHlwZV9BdHRyaWJ1dGUoKSktPl9mcm9tRG9jdW1lbnQob2JqWyJhdHRyaWJ1dGUiXSkNCiAgICAgICAgDQogICAgICAgICk7DQogICAgDQogICAgDQogICAgDQogICAgcmV0dXJuICp0aGlzOw0KfQ0KDQpzdGQ6OnN0cmluZyBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZV9BdHRyaWJ1dGU6Ol90b0RvY3VtZW50KCl7DQogICAgcmV0dXJuICIiOw0KfQ0KDQogICAgDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZV9BdHRyaWJ1dGUmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6RGV2aWNlX0F0dHJpYnV0ZTo6c3RvcmUoKXsNCiAgICBzdGQ6OnN0cmluZyBfX3RvU3RyaW5nID0gIkRldmljZV9BdHRyaWJ1dGU6OnN0b3JlKCk6ICI7DQogICAgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpFdmVudCBfX3Jlc3BvbnNlID0gKG5ldyBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkV2ZW50KCkpLT5jb2RlKCJbIit0aGlzTm9kZS5jb2RlKCkrIkB0aW1lIisiXS5EZXZpY2VfQXR0cmlidXRlLnN0b3JlKCkiKS5tZXRob2QoInN0b3JlIikuY2xhc3NOYW1lKCJEZXZpY2VfQXR0cmlidXRlIikuY2Fycmllcih0aGlzTm9kZSkuc2VuZGVyKHRoaXNOb2RlKS5yZWNpcGllbnQodGhpc05vZGUucGFyZW50KCkpOw0KDQogICAgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpEZXZpY2VfQXR0cmlidXRlKiBhbnN3ZXI7DQoNCiAgICANCg0KICAgIA0KICAgIGlmKGFuc3dlciE9bnVsbHB0cil7DQogICAgDQoNCiAgICANCiAgICAgICAgDQogICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXItPl90b0RvY3VtZW50KCkpOw0KICAgICAgICANCiAgICANCiAgICB9ZWxzZXsNCiAgICAgICAganNvbiBfalJldDsNCiAgICAgICAgX2pSZXRbIl9fdGhpcyJdID0gdGhpcy0+X3RvRG9jdW1lbnQoKTsNCiAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKF9qUmV0KTsNCiAgICAgICAgLy9fX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiB0aGlzLT5fdG9Eb2N1bWVudCgpfSk7DQogICAgfQ0KDQogICAgLy9fX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCg0KICAgIHJldHVybiAqYW5zd2VyOw0KfQ0KICAgIA0Kc3RkOjp2ZWN0b3I8ZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpEZXZpY2VfQXR0cmlidXRlPiYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpEZXZpY2VfQXR0cmlidXRlOjpmaW5kQWxsKCl7DQogICAgc3RkOjpzdHJpbmcgX190b1N0cmluZyA9ICJEZXZpY2VfQXR0cmlidXRlOjpmaW5kQWxsKCk6ICI7DQogICAgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpFdmVudCBfX3Jlc3BvbnNlID0gKG5ldyBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkV2ZW50KCkpLT5jb2RlKCJbIit0aGlzTm9kZS5jb2RlKCkrIkB0aW1lIisiXS5EZXZpY2VfQXR0cmlidXRlLmZpbmRBbGwoKSIpLm1ldGhvZCgiZmluZEFsbCIpLmNsYXNzTmFtZSgiRGV2aWNlX0F0dHJpYnV0ZSIpLmNhcnJpZXIodGhpc05vZGUpLnNlbmRlcih0aGlzTm9kZSkucmVjaXBpZW50KHRoaXNOb2RlLnBhcmVudCgpKTsNCg0KICAgIHN0ZDo6dmVjdG9yPGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6RGV2aWNlX0F0dHJpYnV0ZT4qIGFuc3dlcjsNCg0KICAgIA0KDQogICAgDQogICAgaWYoYW5zd2VyLT5lbXB0eSgpKXsNCiAgICANCg0KICAgIA0KICAgICAgICANCiAgICAgICAgLy9fX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLT5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgDQogICAgDQogICAgfWVsc2V7DQogICAgICAgIGpzb24gX2pSZXQ7DQogICAgICAgIF9qUmV0WyJfX3RoaXMiXSA9IHRoaXMtPl90b0RvY3VtZW50KCk7DQogICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChfalJldCk7DQogICAgICAgIC8vX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogdGhpcy0+X3RvRG9jdW1lbnQoKX0pOw0KICAgIH0NCg0KICAgIC8vX19yZXNwb25zZS50cmlnZ2VyKCk7DQoNCiAgICByZXR1cm4gKmFuc3dlcjsNCn0NCiAgICANCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6RGV2aWNlX0F0dHJpYnV0ZSYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpEZXZpY2VfQXR0cmlidXRlOjpmaW5kKCl7DQogICAgc3RkOjpzdHJpbmcgX190b1N0cmluZyA9ICJEZXZpY2VfQXR0cmlidXRlOjpmaW5kKCk6ICI7DQogICAgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpFdmVudCBfX3Jlc3BvbnNlID0gKG5ldyBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkV2ZW50KCkpLT5jb2RlKCJbIit0aGlzTm9kZS5jb2RlKCkrIkB0aW1lIisiXS5EZXZpY2VfQXR0cmlidXRlLmZpbmQoKSIpLm1ldGhvZCgiZmluZCIpLmNsYXNzTmFtZSgiRGV2aWNlX0F0dHJpYnV0ZSIpLmNhcnJpZXIodGhpc05vZGUpLnNlbmRlcih0aGlzTm9kZSkucmVjaXBpZW50KHRoaXNOb2RlLnBhcmVudCgpKTsNCg0KICAgIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6RGV2aWNlX0F0dHJpYnV0ZSogYW5zd2VyOw0KDQogICAgDQoNCiAgICANCiAgICBpZihhbnN3ZXIhPW51bGxwdHIpew0KICAgIA0KDQogICAgDQogICAgICAgIA0KICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLT5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgDQogICAgDQogICAgfWVsc2V7DQogICAgICAgIGpzb24gX2pSZXQ7DQogICAgICAgIF9qUmV0WyJfX3RoaXMiXSA9IHRoaXMtPl90b0RvY3VtZW50KCk7DQogICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChfalJldCk7DQogICAgICAgIC8vX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogdGhpcy0+X3RvRG9jdW1lbnQoKX0pOw0KICAgIH0NCg0KICAgIC8vX19yZXNwb25zZS50cmlnZ2VyKCk7DQoNCiAgICByZXR1cm4gKmFuc3dlcjsNCn0NCiAgICANCg0KICAgIA0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OlR5cGVfQXR0cmlidXRlJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OlR5cGVfQXR0cmlidXRlOjphY3RpdmUoYm9vbCB2KXsNCiAgICB0aGlzLT5fYWN0aXZlID0gdjsNCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQoNCmJvb2wgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpUeXBlX0F0dHJpYnV0ZTo6YWN0aXZlKCl7DQogICAgcmV0dXJuIHRoaXMtPl9hY3RpdmU7DQp9DQogICAgDQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6VHlwZV9BdHRyaWJ1dGUmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6VHlwZV9BdHRyaWJ1dGU6OmVuYWJsZWQoYm9vbCB2KXsNCiAgICB0aGlzLT5fZW5hYmxlZCA9IHY7DQogICAgcmV0dXJuICp0aGlzOw0KfQ0KICAgIA0KDQpib29sIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6VHlwZV9BdHRyaWJ1dGU6OmVuYWJsZWQoKXsNCiAgICByZXR1cm4gdGhpcy0+X2VuYWJsZWQ7DQp9DQogICAgDQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6VHlwZV9BdHRyaWJ1dGUmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6VHlwZV9BdHRyaWJ1dGU6OmNvZGUoc3RkOjpzdHJpbmcgdil7DQogICAgdGhpcy0+X2NvZGUgPSB2Ow0KICAgIHJldHVybiAqdGhpczsNCn0NCiAgICANCg0Kc3RkOjpzdHJpbmcgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpUeXBlX0F0dHJpYnV0ZTo6Y29kZSgpew0KICAgIHJldHVybiB0aGlzLT5fY29kZTsNCn0NCiAgICANCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpUeXBlX0F0dHJpYnV0ZSYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpUeXBlX0F0dHJpYnV0ZTo6b3JkZXIoaW50IHYpew0KICAgIHRoaXMtPl9vcmRlciA9IHY7DQogICAgcmV0dXJuICp0aGlzOw0KfQ0KICAgIA0KDQppbnQgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpUeXBlX0F0dHJpYnV0ZTo6b3JkZXIoKXsNCiAgICByZXR1cm4gdGhpcy0+X29yZGVyOw0KfQ0KICAgIA0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OlR5cGVfQXR0cmlidXRlJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OlR5cGVfQXR0cmlidXRlOjpkYXRlKHRpbWVfdCB2KXsNCiAgICB0aGlzLT5fZGF0ZSA9IHY7DQogICAgcmV0dXJuICp0aGlzOw0KfQ0KICAgIA0KDQp0aW1lX3QgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpUeXBlX0F0dHJpYnV0ZTo6ZGF0ZSgpew0KICAgIHJldHVybiB0aGlzLT5fZGF0ZTsNCn0NCiAgICANCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpUeXBlX0F0dHJpYnV0ZSYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpUeXBlX0F0dHJpYnV0ZTo6bmFtZShzdGQ6OnN0cmluZyB2KXsNCiAgICB0aGlzLT5fbmFtZSA9IHY7DQogICAgcmV0dXJuICp0aGlzOw0KfQ0KICAgIA0KDQpzdGQ6OnN0cmluZyBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OlR5cGVfQXR0cmlidXRlOjpuYW1lKCl7DQogICAgcmV0dXJuIHRoaXMtPl9uYW1lOw0KfQ0KICAgIA0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OlR5cGVfQXR0cmlidXRlJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OlR5cGVfQXR0cmlidXRlOjpyZW1hcmsoc3RkOjpzdHJpbmcgdil7DQogICAgdGhpcy0+X3JlbWFyayA9IHY7DQogICAgcmV0dXJuICp0aGlzOw0KfQ0KICAgIA0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpUeXBlX0F0dHJpYnV0ZSYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpUeXBlX0F0dHJpYnV0ZTo6cmVtYXJrKGpzb24gdil7DQogICAgLy90aGlzLT5fcmVtYXJrDQogICAgcmV0dXJuICp0aGlzOw0KfQ0KICAgIA0KDQpzdGQ6OnN0cmluZyBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OlR5cGVfQXR0cmlidXRlOjpyZW1hcmsoKXsNCiAgICByZXR1cm4gdGhpcy0+X3JlbWFyazsNCn0NCiAgICANCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpUeXBlX0F0dHJpYnV0ZSYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpUeXBlX0F0dHJpYnV0ZTo6ZGV2aWNlVHlwZShlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZV9UeXBlJiB2KXsNCiAgICB0aGlzLT5fZGV2aWNlVHlwZSA9ICZ2Ow0KICAgIHJldHVybiAqdGhpczsNCn0NCiAgICANCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6VHlwZV9BdHRyaWJ1dGUmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6VHlwZV9BdHRyaWJ1dGU6OmRldmljZVR5cGUoZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpEZXZpY2VfVHlwZSogdil7DQogICAgaWYodiE9bnVsbHB0cil7DQogICAgICAgIHRoaXMtPl9kZXZpY2VUeXBlID0gdjsNCiAgICB9DQogICAgcmV0dXJuICp0aGlzOw0KfQ0KICAgIA0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZV9UeXBlKiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OlR5cGVfQXR0cmlidXRlOjpkZXZpY2VUeXBlKCl7DQogICAgcmV0dXJuIHRoaXMtPl9kZXZpY2VUeXBlOw0KfQ0KICAgIA0KDQogICAgDQpzdGQ6OnZlY3RvcjxzdGQ6OmFueT4mJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OlR5cGVfQXR0cmlidXRlOjphdHRyaWJ1dGVfRGV2aWNlX0F0dHJpYnV0ZXMoKXsNCiAgICByZXR1cm4gbW92ZSgqKHRoaXMtPl9hdHRyaWJ1dGVfRGV2aWNlX0F0dHJpYnV0ZXMpKTsNCn0NCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpUeXBlX0F0dHJpYnV0ZSYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpUeXBlX0F0dHJpYnV0ZTo6YXR0cmlidXRlX0RldmljZV9BdHRyaWJ1dGVzKHN0ZDo6dmVjdG9yPHN0ZDo6YW55PiYmIHYpew0KICAgIHJldHVybiAqdGhpczsNCn0NCiAgICANCg0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OlR5cGVfQXR0cmlidXRlJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OlR5cGVfQXR0cmlidXRlOjpfdW5pcXVlKCl7DQogICAgc3RkOjpzdHJpbmcgX190b1N0cmluZyA9ICJUeXBlX0F0dHJpYnV0ZTo6X3VuaXF1ZSgpOiAiOw0KDQogICAgVHlwZV9BdHRyaWJ1dGUqIHJldCA9IG5ldyBUeXBlX0F0dHJpYnV0ZSgpOw0KICAgIGlmKHRoaXMtPklkIT0wKSByZXQtPklkID0gdGhpcy0+SWQ7DQogICAgDQogICAgICAgIA0KICAgIGlmKHRoaXMtPmNvZGUoKS5lbXB0eSgpKQ0KICAgICAgICANCiAgICAgICAgcmV0LT5jb2RlKHRoaXMtPmNvZGUoKSk7DQogICAgDQogICAgICAgIA0KICAgIGlmKHRoaXMtPmRldmljZVR5cGUoKSE9bnVsbHB0cikNCiAgICAgICAgDQogICAgICAgIHJldC0+ZGV2aWNlVHlwZSh0aGlzLT5kZXZpY2VUeXBlKCktPl91bmlxdWUoKSk7DQogICAgDQoNCiAgICByZXR1cm4gKnRoaXM7DQp9DQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6VHlwZV9BdHRyaWJ1dGUmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6VHlwZV9BdHRyaWJ1dGU6Ol9mcm9tRG9jdW1lbnQodW5zaWduZWQgY2hhciogb2JqKXsNCiAgICByZXR1cm4gdGhpcy0+X2Zyb21Eb2N1bWVudChzdGQ6OnN0cmluZyggb2JqLCBvYmogKyBzaXplb2Ygb2JqIC8gc2l6ZW9mIG9ialswXSApKTsNCn0NCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpUeXBlX0F0dHJpYnV0ZSYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpUeXBlX0F0dHJpYnV0ZTo6X2Zyb21Eb2N1bWVudChzdGQ6OnN0cmluZyBvYmopew0KICAgIGlmKG9iai5lbXB0eSgpKSByZXR1cm4gKnRoaXM7DQoNCiAgICBpZiAoc3RkOjpyZWdleF9tYXRjaChvYmosIHN0ZDo6cmVnZXgoUiIiKCgoW0EtWmEtel17Myw5fTooPzovLyk/KSg/OlstOzomPSskLHddK0ApP1tBLVphLXowLTkuLV0rfCg/Ond3dy58Wy07OiY9KyQsd10rQClbQS1aYS16MC05Li1dKykoKD86L1srfiUvLnctX10qKT8/Pyg/OlstKz0mOyVALndfXSopIz8oPzpbd10qKSk/KSIiKSkpew0KICAgICAgICBzdGQ6OnN0cmluZyByZWFkQnVmZmVyOw0KICAgICAgICBDVVJMICpjdXJsID0gY3VybF9lYXN5X2luaXQoKTsNCiAgICAgICAgY3VybF9lYXN5X3NldG9wdChjdXJsLCBDVVJMT1BUX1VSTCwgb2JqKTsNCiAgICAgICAgY3VybF9lYXN5X3NldG9wdChjdXJsLCBDVVJMT1BUX0ZPTExPV0xPQ0FUSU9OLCAxTCk7DQogICAgICAgIC8vY3VybF9lYXN5X3NldG9wdChjdXJsLCBDVVJMT1BUX1dSSVRFRlVOQ1RJT04sICtbXSh2b2lkICpwdHIsIHNpemVfdCBzaXplLCBzaXplX3Qgbm1lbWIsIHZvaWQgKnN0cmVhbSkgLT4gc2l6ZV90IHsgcmVhZEJ1ZmZlci5hcHBlbmQoKnB0ciwgc2l6ZSAqIG5tZW1iKTsgfSk7DQogICAgICAgIGN1cmxfZWFzeV9zZXRvcHQoY3VybCwgQ1VSTE9QVF9XUklURURBVEEsICZyZWFkQnVmZmVyKTsNCiAgICAgICAgY3VybF9lYXN5X3BlcmZvcm0oY3VybCk7DQogICAgICAgIGN1cmxfZWFzeV9jbGVhbnVwKGN1cmwpOw0KICAgICAgICByZXR1cm4gdGhpcy0+X2Zyb21Eb2N1bWVudChyZWFkQnVmZmVyKTsNCiAgICB9DQoNCiAgICByZXR1cm4gdGhpcy0+X2Zyb21Eb2N1bWVudChqc29uOjpwYXJzZShvYmopKTsNCn0NCg0Kc3RkOjp2ZWN0b3I8ZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpUeXBlX0F0dHJpYnV0ZT4mJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OlR5cGVfQXR0cmlidXRlOjpfZnJvbURvY3VtZW50KHN0ZDo6dmVjdG9yPGpzb24+JiYgb2JqKXsNCiAgICBzdGQ6OnZlY3RvcjxUeXBlX0F0dHJpYnV0ZT4qIHJldCA9IG5ldyBzdGQ6OnZlY3RvcjxUeXBlX0F0dHJpYnV0ZT4ob2JqLnNpemUoKSk7DQogICAgDQogICAgZm9yIChjb25zdCBqc29uJiBqIDogb2JqKXsNCiAgICAgICAgcmV0LT5wdXNoX2JhY2soKG5ldyBUeXBlX0F0dHJpYnV0ZSgpKS0+X2Zyb21Eb2N1bWVudChqKSk7DQogICAgfQ0KICAgIA0KICAgIHJldHVybiBtb3ZlKCpyZXQpOw0KfQ0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OlR5cGVfQXR0cmlidXRlJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OlR5cGVfQXR0cmlidXRlOjpfZnJvbURvY3VtZW50KGpzb24gb2JqKXsNCiAgICANCiAgICBpZihvYmouY29udGFpbnMoImFjdGl2ZSIpKSB0aGlzLT5hY3RpdmUoDQogICAgICAgIA0KICAgICAgICBvYmpbImFjdGl2ZSJdLnRlbXBsYXRlIGdldDxib29sPigpDQogICAgICAgIA0KICAgICAgICApOw0KICAgIA0KICAgIGlmKG9iai5jb250YWlucygiZW5hYmxlZCIpKSB0aGlzLT5lbmFibGVkKA0KICAgICAgICANCiAgICAgICAgb2JqWyJlbmFibGVkIl0udGVtcGxhdGUgZ2V0PGJvb2w+KCkNCiAgICAgICAgDQogICAgICAgICk7DQogICAgDQogICAgaWYob2JqLmNvbnRhaW5zKCJjb2RlIikpIHRoaXMtPmNvZGUoDQogICAgICAgIA0KICAgICAgICBvYmpbImNvZGUiXS50ZW1wbGF0ZSBnZXQ8c3RkOjpzdHJpbmc+KCkNCiAgICAgICAgDQogICAgICAgICk7DQogICAgDQogICAgaWYob2JqLmNvbnRhaW5zKCJvcmRlciIpKSB0aGlzLT5vcmRlcigNCiAgICAgICAgDQogICAgICAgIG9ialsib3JkZXIiXS50ZW1wbGF0ZSBnZXQ8aW50PigpDQogICAgICAgIA0KICAgICAgICApOw0KICAgIA0KICAgIGlmKG9iai5jb250YWlucygiZGF0ZSIpKSB0aGlzLT5kYXRlKA0KICAgICAgICANCiAgICAgICAgb2JqWyJkYXRlIl0udGVtcGxhdGUgZ2V0PHRpbWVfdD4oKQ0KICAgICAgICANCiAgICAgICAgKTsNCiAgICANCiAgICBpZihvYmouY29udGFpbnMoIm5hbWUiKSkgdGhpcy0+bmFtZSgNCiAgICAgICAgDQogICAgICAgIG9ialsibmFtZSJdLnRlbXBsYXRlIGdldDxzdGQ6OnN0cmluZz4oKQ0KICAgICAgICANCiAgICAgICAgKTsNCiAgICANCiAgICBpZihvYmouY29udGFpbnMoInJlbWFyayIpKSB0aGlzLT5yZW1hcmsoDQogICAgICAgIA0KICAgICAgICBvYmpbInJlbWFyayJdLnRlbXBsYXRlIGdldDxzdGQ6OnN0cmluZz4oKQ0KICAgICAgICANCiAgICAgICAgKTsNCiAgICANCiAgICBpZihvYmouY29udGFpbnMoImRldmljZVR5cGUiKSkgdGhpcy0+ZGV2aWNlVHlwZSgNCiAgICAgICAgDQogICAgICAgIChuZXcgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpEZXZpY2VfVHlwZSgpKS0+X2Zyb21Eb2N1bWVudChvYmpbImRldmljZVR5cGUiXSkNCiAgICAgICAgDQogICAgICAgICk7DQogICAgDQogICAgDQogICAgDQogICAgaWYob2JqLmNvbnRhaW5zKCJhdHRyaWJ1dGVfRGV2aWNlX0F0dHJpYnV0ZXMiKSkgdGhpcy0+YXR0cmlidXRlX0RldmljZV9BdHRyaWJ1dGVzKChuZXcgRGV2aWNlX0F0dHJpYnV0ZSgpKS0+X2Zyb21Eb2N1bWVudCgoc3RkOjp2ZWN0b3I8anNvbj4pb2JqWyJhdHRyaWJ1dGVfRGV2aWNlX0F0dHJpYnV0ZXMiXSkpOw0KICAgIA0KICAgIHJldHVybiAqdGhpczsNCn0NCg0Kc3RkOjpzdHJpbmcgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpUeXBlX0F0dHJpYnV0ZTo6X3RvRG9jdW1lbnQoKXsNCiAgICByZXR1cm4gIiI7DQp9DQoNCiAgICANCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6VHlwZV9BdHRyaWJ1dGUmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6VHlwZV9BdHRyaWJ1dGU6OnN0b3JlKCl7DQogICAgc3RkOjpzdHJpbmcgX190b1N0cmluZyA9ICJUeXBlX0F0dHJpYnV0ZTo6c3RvcmUoKTogIjsNCiAgICBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkV2ZW50IF9fcmVzcG9uc2UgPSAobmV3IGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6RXZlbnQoKSktPmNvZGUoIlsiK3RoaXNOb2RlLmNvZGUoKSsiQHRpbWUiKyJdLlR5cGVfQXR0cmlidXRlLnN0b3JlKCkiKS5tZXRob2QoInN0b3JlIikuY2xhc3NOYW1lKCJUeXBlX0F0dHJpYnV0ZSIpLmNhcnJpZXIodGhpc05vZGUpLnNlbmRlcih0aGlzTm9kZSkucmVjaXBpZW50KHRoaXNOb2RlLnBhcmVudCgpKTsNCg0KICAgIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6VHlwZV9BdHRyaWJ1dGUqIGFuc3dlcjsNCg0KICAgIA0KDQogICAgDQogICAgaWYoYW5zd2VyIT1udWxscHRyKXsNCiAgICANCg0KICAgIA0KICAgICAgICANCiAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci0+X3RvRG9jdW1lbnQoKSk7DQogICAgICAgIA0KICAgIA0KICAgIH1lbHNlew0KICAgICAgICBqc29uIF9qUmV0Ow0KICAgICAgICBfalJldFsiX190aGlzIl0gPSB0aGlzLT5fdG9Eb2N1bWVudCgpOw0KICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoX2pSZXQpOw0KICAgICAgICAvL19fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHRoaXMtPl90b0RvY3VtZW50KCl9KTsNCiAgICB9DQoNCiAgICAvL19fcmVzcG9uc2UudHJpZ2dlcigpOw0KDQogICAgcmV0dXJuICphbnN3ZXI7DQp9DQogICAgDQpzdGQ6OnZlY3Rvcjxlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OlR5cGVfQXR0cmlidXRlPiYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpUeXBlX0F0dHJpYnV0ZTo6ZmluZEFsbCgpew0KICAgIHN0ZDo6c3RyaW5nIF9fdG9TdHJpbmcgPSAiVHlwZV9BdHRyaWJ1dGU6OmZpbmRBbGwoKTogIjsNCiAgICBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkV2ZW50IF9fcmVzcG9uc2UgPSAobmV3IGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6RXZlbnQoKSktPmNvZGUoIlsiK3RoaXNOb2RlLmNvZGUoKSsiQHRpbWUiKyJdLlR5cGVfQXR0cmlidXRlLmZpbmRBbGwoKSIpLm1ldGhvZCgiZmluZEFsbCIpLmNsYXNzTmFtZSgiVHlwZV9BdHRyaWJ1dGUiKS5jYXJyaWVyKHRoaXNOb2RlKS5zZW5kZXIodGhpc05vZGUpLnJlY2lwaWVudCh0aGlzTm9kZS5wYXJlbnQoKSk7DQoNCiAgICBzdGQ6OnZlY3Rvcjxlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OlR5cGVfQXR0cmlidXRlPiogYW5zd2VyOw0KDQogICAgDQoNCiAgICANCiAgICBpZihhbnN3ZXItPmVtcHR5KCkpew0KICAgIA0KDQogICAgDQogICAgICAgIA0KICAgICAgICAvL19fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXItPl90b0RvY3VtZW50KCkpOw0KICAgICAgICANCiAgICANCiAgICB9ZWxzZXsNCiAgICAgICAganNvbiBfalJldDsNCiAgICAgICAgX2pSZXRbIl9fdGhpcyJdID0gdGhpcy0+X3RvRG9jdW1lbnQoKTsNCiAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKF9qUmV0KTsNCiAgICAgICAgLy9fX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiB0aGlzLT5fdG9Eb2N1bWVudCgpfSk7DQogICAgfQ0KDQogICAgLy9fX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCg0KICAgIHJldHVybiAqYW5zd2VyOw0KfQ0KICAgIA0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpUeXBlX0F0dHJpYnV0ZSYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpUeXBlX0F0dHJpYnV0ZTo6ZmluZCgpew0KICAgIHN0ZDo6c3RyaW5nIF9fdG9TdHJpbmcgPSAiVHlwZV9BdHRyaWJ1dGU6OmZpbmQoKTogIjsNCiAgICBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkV2ZW50IF9fcmVzcG9uc2UgPSAobmV3IGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6RXZlbnQoKSktPmNvZGUoIlsiK3RoaXNOb2RlLmNvZGUoKSsiQHRpbWUiKyJdLlR5cGVfQXR0cmlidXRlLmZpbmQoKSIpLm1ldGhvZCgiZmluZCIpLmNsYXNzTmFtZSgiVHlwZV9BdHRyaWJ1dGUiKS5jYXJyaWVyKHRoaXNOb2RlKS5zZW5kZXIodGhpc05vZGUpLnJlY2lwaWVudCh0aGlzTm9kZS5wYXJlbnQoKSk7DQoNCiAgICBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OlR5cGVfQXR0cmlidXRlKiBhbnN3ZXI7DQoNCiAgICANCg0KICAgIA0KICAgIGlmKGFuc3dlciE9bnVsbHB0cil7DQogICAgDQoNCiAgICANCiAgICAgICAgDQogICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXItPl90b0RvY3VtZW50KCkpOw0KICAgICAgICANCiAgICANCiAgICB9ZWxzZXsNCiAgICAgICAganNvbiBfalJldDsNCiAgICAgICAgX2pSZXRbIl9fdGhpcyJdID0gdGhpcy0+X3RvRG9jdW1lbnQoKTsNCiAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKF9qUmV0KTsNCiAgICAgICAgLy9fX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiB0aGlzLT5fdG9Eb2N1bWVudCgpfSk7DQogICAgfQ0KDQogICAgLy9fX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCg0KICAgIHJldHVybiAqYW5zd2VyOw0KfQ0KICAgIA0KDQogICAgDQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6RGV2aWNlX0NhdGVnb3J5JiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZV9DYXRlZ29yeTo6YWN0aXZlKGJvb2wgdil7DQogICAgdGhpcy0+X2FjdGl2ZSA9IHY7DQogICAgcmV0dXJuICp0aGlzOw0KfQ0KICAgIA0KDQpib29sIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6RGV2aWNlX0NhdGVnb3J5OjphY3RpdmUoKXsNCiAgICByZXR1cm4gdGhpcy0+X2FjdGl2ZTsNCn0NCiAgICANCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpEZXZpY2VfQ2F0ZWdvcnkmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6RGV2aWNlX0NhdGVnb3J5OjplbmFibGVkKGJvb2wgdil7DQogICAgdGhpcy0+X2VuYWJsZWQgPSB2Ow0KICAgIHJldHVybiAqdGhpczsNCn0NCiAgICANCg0KYm9vbCBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZV9DYXRlZ29yeTo6ZW5hYmxlZCgpew0KICAgIHJldHVybiB0aGlzLT5fZW5hYmxlZDsNCn0NCiAgICANCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpEZXZpY2VfQ2F0ZWdvcnkmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6RGV2aWNlX0NhdGVnb3J5Ojpjb2RlKHN0ZDo6c3RyaW5nIHYpew0KICAgIHRoaXMtPl9jb2RlID0gdjsNCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQoNCnN0ZDo6c3RyaW5nIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6RGV2aWNlX0NhdGVnb3J5Ojpjb2RlKCl7DQogICAgcmV0dXJuIHRoaXMtPl9jb2RlOw0KfQ0KICAgIA0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZV9DYXRlZ29yeSYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpEZXZpY2VfQ2F0ZWdvcnk6Om9yZGVyKGludCB2KXsNCiAgICB0aGlzLT5fb3JkZXIgPSB2Ow0KICAgIHJldHVybiAqdGhpczsNCn0NCiAgICANCg0KaW50IGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6RGV2aWNlX0NhdGVnb3J5OjpvcmRlcigpew0KICAgIHJldHVybiB0aGlzLT5fb3JkZXI7DQp9DQogICAgDQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6RGV2aWNlX0NhdGVnb3J5JiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZV9DYXRlZ29yeTo6ZGF0ZSh0aW1lX3Qgdil7DQogICAgdGhpcy0+X2RhdGUgPSB2Ow0KICAgIHJldHVybiAqdGhpczsNCn0NCiAgICANCg0KdGltZV90IGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6RGV2aWNlX0NhdGVnb3J5OjpkYXRlKCl7DQogICAgcmV0dXJuIHRoaXMtPl9kYXRlOw0KfQ0KICAgIA0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZV9DYXRlZ29yeSYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpEZXZpY2VfQ2F0ZWdvcnk6Om5hbWUoc3RkOjpzdHJpbmcgdil7DQogICAgdGhpcy0+X25hbWUgPSB2Ow0KICAgIHJldHVybiAqdGhpczsNCn0NCiAgICANCg0Kc3RkOjpzdHJpbmcgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpEZXZpY2VfQ2F0ZWdvcnk6Om5hbWUoKXsNCiAgICByZXR1cm4gdGhpcy0+X25hbWU7DQp9DQogICAgDQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6RGV2aWNlX0NhdGVnb3J5JiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZV9DYXRlZ29yeTo6cmVtYXJrKHN0ZDo6c3RyaW5nIHYpew0KICAgIHRoaXMtPl9yZW1hcmsgPSB2Ow0KICAgIHJldHVybiAqdGhpczsNCn0NCiAgICANCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6RGV2aWNlX0NhdGVnb3J5JiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZV9DYXRlZ29yeTo6cmVtYXJrKGpzb24gdil7DQogICAgLy90aGlzLT5fcmVtYXJrDQogICAgcmV0dXJuICp0aGlzOw0KfQ0KICAgIA0KDQpzdGQ6OnN0cmluZyBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZV9DYXRlZ29yeTo6cmVtYXJrKCl7DQogICAgcmV0dXJuIHRoaXMtPl9yZW1hcms7DQp9DQogICAgDQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6RGV2aWNlX0NhdGVnb3J5JiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZV9DYXRlZ29yeTo6cGFyZW50KGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6RGV2aWNlX0NhdGVnb3J5JiB2KXsNCiAgICB0aGlzLT5fcGFyZW50ID0gJnY7DQogICAgcmV0dXJuICp0aGlzOw0KfQ0KICAgIA0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpEZXZpY2VfQ2F0ZWdvcnkmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6RGV2aWNlX0NhdGVnb3J5OjpwYXJlbnQoZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpEZXZpY2VfQ2F0ZWdvcnkqIHYpew0KICAgIGlmKHYhPW51bGxwdHIpew0KICAgICAgICB0aGlzLT5fcGFyZW50ID0gdjsNCiAgICB9DQogICAgcmV0dXJuICp0aGlzOw0KfQ0KICAgIA0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZV9DYXRlZ29yeSogZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpEZXZpY2VfQ2F0ZWdvcnk6OnBhcmVudCgpew0KICAgIHJldHVybiB0aGlzLT5fcGFyZW50Ow0KfQ0KICAgIA0KDQogICAgDQpzdGQ6OnZlY3RvcjxzdGQ6OmFueT4mJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZV9DYXRlZ29yeTo6cGFyZW50X0RldmljZV9DYXRlZ29yeXMoKXsNCiAgICByZXR1cm4gbW92ZSgqKHRoaXMtPl9wYXJlbnRfRGV2aWNlX0NhdGVnb3J5cykpOw0KfQ0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZV9DYXRlZ29yeSYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpEZXZpY2VfQ2F0ZWdvcnk6OnBhcmVudF9EZXZpY2VfQ2F0ZWdvcnlzKHN0ZDo6dmVjdG9yPHN0ZDo6YW55PiYmIHYpew0KICAgIHJldHVybiAqdGhpczsNCn0NCiAgICANCnN0ZDo6dmVjdG9yPHN0ZDo6YW55PiYmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6RGV2aWNlX0NhdGVnb3J5OjpjYXRlZ29yeV9EZXZpY2VfVHlwZXMoKXsNCiAgICByZXR1cm4gbW92ZSgqKHRoaXMtPl9jYXRlZ29yeV9EZXZpY2VfVHlwZXMpKTsNCn0NCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpEZXZpY2VfQ2F0ZWdvcnkmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6RGV2aWNlX0NhdGVnb3J5OjpjYXRlZ29yeV9EZXZpY2VfVHlwZXMoc3RkOjp2ZWN0b3I8c3RkOjphbnk+JiYgdil7DQogICAgcmV0dXJuICp0aGlzOw0KfQ0KICAgIA0KDQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6RGV2aWNlX0NhdGVnb3J5JiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZV9DYXRlZ29yeTo6X3VuaXF1ZSgpew0KICAgIHN0ZDo6c3RyaW5nIF9fdG9TdHJpbmcgPSAiRGV2aWNlX0NhdGVnb3J5OjpfdW5pcXVlKCk6ICI7DQoNCiAgICBEZXZpY2VfQ2F0ZWdvcnkqIHJldCA9IG5ldyBEZXZpY2VfQ2F0ZWdvcnkoKTsNCiAgICBpZih0aGlzLT5JZCE9MCkgcmV0LT5JZCA9IHRoaXMtPklkOw0KICAgIA0KICAgICAgICANCiAgICBpZih0aGlzLT5jb2RlKCkuZW1wdHkoKSkNCiAgICAgICAgDQogICAgICAgIHJldC0+Y29kZSh0aGlzLT5jb2RlKCkpOw0KICAgIA0KDQogICAgcmV0dXJuICp0aGlzOw0KfQ0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZV9DYXRlZ29yeSYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpEZXZpY2VfQ2F0ZWdvcnk6Ol9mcm9tRG9jdW1lbnQodW5zaWduZWQgY2hhciogb2JqKXsNCiAgICByZXR1cm4gdGhpcy0+X2Zyb21Eb2N1bWVudChzdGQ6OnN0cmluZyggb2JqLCBvYmogKyBzaXplb2Ygb2JqIC8gc2l6ZW9mIG9ialswXSApKTsNCn0NCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpEZXZpY2VfQ2F0ZWdvcnkmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6RGV2aWNlX0NhdGVnb3J5OjpfZnJvbURvY3VtZW50KHN0ZDo6c3RyaW5nIG9iail7DQogICAgaWYob2JqLmVtcHR5KCkpIHJldHVybiAqdGhpczsNCg0KICAgIGlmIChzdGQ6OnJlZ2V4X21hdGNoKG9iaiwgc3RkOjpyZWdleChSIiIoKChbQS1aYS16XXszLDl9Oig/Oi8vKT8pKD86Wy07OiY9KyQsd10rQCk/W0EtWmEtejAtOS4tXSt8KD86d3d3LnxbLTs6Jj0rJCx3XStAKVtBLVphLXowLTkuLV0rKSgoPzovWyt+JS8udy1fXSopPz8/KD86Wy0rPSY7JUAud19dKikjPyg/Olt3XSopKT8pIiIpKSl7DQogICAgICAgIHN0ZDo6c3RyaW5nIHJlYWRCdWZmZXI7DQogICAgICAgIENVUkwgKmN1cmwgPSBjdXJsX2Vhc3lfaW5pdCgpOw0KICAgICAgICBjdXJsX2Vhc3lfc2V0b3B0KGN1cmwsIENVUkxPUFRfVVJMLCBvYmopOw0KICAgICAgICBjdXJsX2Vhc3lfc2V0b3B0KGN1cmwsIENVUkxPUFRfRk9MTE9XTE9DQVRJT04sIDFMKTsNCiAgICAgICAgLy9jdXJsX2Vhc3lfc2V0b3B0KGN1cmwsIENVUkxPUFRfV1JJVEVGVU5DVElPTiwgK1tdKHZvaWQgKnB0ciwgc2l6ZV90IHNpemUsIHNpemVfdCBubWVtYiwgdm9pZCAqc3RyZWFtKSAtPiBzaXplX3QgeyByZWFkQnVmZmVyLmFwcGVuZCgqcHRyLCBzaXplICogbm1lbWIpOyB9KTsNCiAgICAgICAgY3VybF9lYXN5X3NldG9wdChjdXJsLCBDVVJMT1BUX1dSSVRFREFUQSwgJnJlYWRCdWZmZXIpOw0KICAgICAgICBjdXJsX2Vhc3lfcGVyZm9ybShjdXJsKTsNCiAgICAgICAgY3VybF9lYXN5X2NsZWFudXAoY3VybCk7DQogICAgICAgIHJldHVybiB0aGlzLT5fZnJvbURvY3VtZW50KHJlYWRCdWZmZXIpOw0KICAgIH0NCg0KICAgIHJldHVybiB0aGlzLT5fZnJvbURvY3VtZW50KGpzb246OnBhcnNlKG9iaikpOw0KfQ0KDQpzdGQ6OnZlY3Rvcjxlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZV9DYXRlZ29yeT4mJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZV9DYXRlZ29yeTo6X2Zyb21Eb2N1bWVudChzdGQ6OnZlY3Rvcjxqc29uPiYmIG9iail7DQogICAgc3RkOjp2ZWN0b3I8RGV2aWNlX0NhdGVnb3J5PiogcmV0ID0gbmV3IHN0ZDo6dmVjdG9yPERldmljZV9DYXRlZ29yeT4ob2JqLnNpemUoKSk7DQogICAgDQogICAgZm9yIChjb25zdCBqc29uJiBqIDogb2JqKXsNCiAgICAgICAgcmV0LT5wdXNoX2JhY2soKG5ldyBEZXZpY2VfQ2F0ZWdvcnkoKSktPl9mcm9tRG9jdW1lbnQoaikpOw0KICAgIH0NCiAgICANCiAgICByZXR1cm4gbW92ZSgqcmV0KTsNCn0NCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpEZXZpY2VfQ2F0ZWdvcnkmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6RGV2aWNlX0NhdGVnb3J5OjpfZnJvbURvY3VtZW50KGpzb24gb2JqKXsNCiAgICANCiAgICBpZihvYmouY29udGFpbnMoImFjdGl2ZSIpKSB0aGlzLT5hY3RpdmUoDQogICAgICAgIA0KICAgICAgICBvYmpbImFjdGl2ZSJdLnRlbXBsYXRlIGdldDxib29sPigpDQogICAgICAgIA0KICAgICAgICApOw0KICAgIA0KICAgIGlmKG9iai5jb250YWlucygiZW5hYmxlZCIpKSB0aGlzLT5lbmFibGVkKA0KICAgICAgICANCiAgICAgICAgb2JqWyJlbmFibGVkIl0udGVtcGxhdGUgZ2V0PGJvb2w+KCkNCiAgICAgICAgDQogICAgICAgICk7DQogICAgDQogICAgaWYob2JqLmNvbnRhaW5zKCJjb2RlIikpIHRoaXMtPmNvZGUoDQogICAgICAgIA0KICAgICAgICBvYmpbImNvZGUiXS50ZW1wbGF0ZSBnZXQ8c3RkOjpzdHJpbmc+KCkNCiAgICAgICAgDQogICAgICAgICk7DQogICAgDQogICAgaWYob2JqLmNvbnRhaW5zKCJvcmRlciIpKSB0aGlzLT5vcmRlcigNCiAgICAgICAgDQogICAgICAgIG9ialsib3JkZXIiXS50ZW1wbGF0ZSBnZXQ8aW50PigpDQogICAgICAgIA0KICAgICAgICApOw0KICAgIA0KICAgIGlmKG9iai5jb250YWlucygiZGF0ZSIpKSB0aGlzLT5kYXRlKA0KICAgICAgICANCiAgICAgICAgb2JqWyJkYXRlIl0udGVtcGxhdGUgZ2V0PHRpbWVfdD4oKQ0KICAgICAgICANCiAgICAgICAgKTsNCiAgICANCiAgICBpZihvYmouY29udGFpbnMoIm5hbWUiKSkgdGhpcy0+bmFtZSgNCiAgICAgICAgDQogICAgICAgIG9ialsibmFtZSJdLnRlbXBsYXRlIGdldDxzdGQ6OnN0cmluZz4oKQ0KICAgICAgICANCiAgICAgICAgKTsNCiAgICANCiAgICBpZihvYmouY29udGFpbnMoInJlbWFyayIpKSB0aGlzLT5yZW1hcmsoDQogICAgICAgIA0KICAgICAgICBvYmpbInJlbWFyayJdLnRlbXBsYXRlIGdldDxzdGQ6OnN0cmluZz4oKQ0KICAgICAgICANCiAgICAgICAgKTsNCiAgICANCiAgICBpZihvYmouY29udGFpbnMoInBhcmVudCIpKSB0aGlzLT5wYXJlbnQoDQogICAgICAgIA0KICAgICAgICAobmV3IGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6RGV2aWNlX0NhdGVnb3J5KCkpLT5fZnJvbURvY3VtZW50KG9ialsicGFyZW50Il0pDQogICAgICAgIA0KICAgICAgICApOw0KICAgIA0KICAgIA0KICAgIA0KICAgIGlmKG9iai5jb250YWlucygicGFyZW50X0RldmljZV9DYXRlZ29yeXMiKSkgdGhpcy0+cGFyZW50X0RldmljZV9DYXRlZ29yeXMoKG5ldyBEZXZpY2VfQ2F0ZWdvcnkoKSktPl9mcm9tRG9jdW1lbnQoKHN0ZDo6dmVjdG9yPGpzb24+KW9ialsicGFyZW50X0RldmljZV9DYXRlZ29yeXMiXSkpOw0KICAgIA0KICAgIGlmKG9iai5jb250YWlucygiY2F0ZWdvcnlfRGV2aWNlX1R5cGVzIikpIHRoaXMtPmNhdGVnb3J5X0RldmljZV9UeXBlcygobmV3IERldmljZV9UeXBlKCkpLT5fZnJvbURvY3VtZW50KChzdGQ6OnZlY3Rvcjxqc29uPilvYmpbImNhdGVnb3J5X0RldmljZV9UeXBlcyJdKSk7DQogICAgDQogICAgcmV0dXJuICp0aGlzOw0KfQ0KDQpzdGQ6OnN0cmluZyBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZV9DYXRlZ29yeTo6X3RvRG9jdW1lbnQoKXsNCiAgICByZXR1cm4gIiI7DQp9DQoNCiAgICANCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6RGV2aWNlX0NhdGVnb3J5JiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZV9DYXRlZ29yeTo6c3RvcmUoKXsNCiAgICBzdGQ6OnN0cmluZyBfX3RvU3RyaW5nID0gIkRldmljZV9DYXRlZ29yeTo6c3RvcmUoKTogIjsNCiAgICBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkV2ZW50IF9fcmVzcG9uc2UgPSAobmV3IGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6RXZlbnQoKSktPmNvZGUoIlsiK3RoaXNOb2RlLmNvZGUoKSsiQHRpbWUiKyJdLkRldmljZV9DYXRlZ29yeS5zdG9yZSgpIikubWV0aG9kKCJzdG9yZSIpLmNsYXNzTmFtZSgiRGV2aWNlX0NhdGVnb3J5IikuY2Fycmllcih0aGlzTm9kZSkuc2VuZGVyKHRoaXNOb2RlKS5yZWNpcGllbnQodGhpc05vZGUucGFyZW50KCkpOw0KDQogICAgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpEZXZpY2VfQ2F0ZWdvcnkqIGFuc3dlcjsNCg0KICAgIA0KDQogICAgDQogICAgaWYoYW5zd2VyIT1udWxscHRyKXsNCiAgICANCg0KICAgIA0KICAgICAgICANCiAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci0+X3RvRG9jdW1lbnQoKSk7DQogICAgICAgIA0KICAgIA0KICAgIH1lbHNlew0KICAgICAgICBqc29uIF9qUmV0Ow0KICAgICAgICBfalJldFsiX190aGlzIl0gPSB0aGlzLT5fdG9Eb2N1bWVudCgpOw0KICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoX2pSZXQpOw0KICAgICAgICAvL19fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHRoaXMtPl90b0RvY3VtZW50KCl9KTsNCiAgICB9DQoNCiAgICAvL19fcmVzcG9uc2UudHJpZ2dlcigpOw0KDQogICAgcmV0dXJuICphbnN3ZXI7DQp9DQogICAgDQpzdGQ6OnZlY3Rvcjxlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZV9DYXRlZ29yeT4mIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6RGV2aWNlX0NhdGVnb3J5OjpmaW5kQWxsKCl7DQogICAgc3RkOjpzdHJpbmcgX190b1N0cmluZyA9ICJEZXZpY2VfQ2F0ZWdvcnk6OmZpbmRBbGwoKTogIjsNCiAgICBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkV2ZW50IF9fcmVzcG9uc2UgPSAobmV3IGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6RXZlbnQoKSktPmNvZGUoIlsiK3RoaXNOb2RlLmNvZGUoKSsiQHRpbWUiKyJdLkRldmljZV9DYXRlZ29yeS5maW5kQWxsKCkiKS5tZXRob2QoImZpbmRBbGwiKS5jbGFzc05hbWUoIkRldmljZV9DYXRlZ29yeSIpLmNhcnJpZXIodGhpc05vZGUpLnNlbmRlcih0aGlzTm9kZSkucmVjaXBpZW50KHRoaXNOb2RlLnBhcmVudCgpKTsNCg0KICAgIHN0ZDo6dmVjdG9yPGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6RGV2aWNlX0NhdGVnb3J5PiogYW5zd2VyOw0KDQogICAgDQoNCiAgICANCiAgICBpZihhbnN3ZXItPmVtcHR5KCkpew0KICAgIA0KDQogICAgDQogICAgICAgIA0KICAgICAgICAvL19fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXItPl90b0RvY3VtZW50KCkpOw0KICAgICAgICANCiAgICANCiAgICB9ZWxzZXsNCiAgICAgICAganNvbiBfalJldDsNCiAgICAgICAgX2pSZXRbIl9fdGhpcyJdID0gdGhpcy0+X3RvRG9jdW1lbnQoKTsNCiAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKF9qUmV0KTsNCiAgICAgICAgLy9fX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiB0aGlzLT5fdG9Eb2N1bWVudCgpfSk7DQogICAgfQ0KDQogICAgLy9fX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCg0KICAgIHJldHVybiAqYW5zd2VyOw0KfQ0KICAgIA0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpEZXZpY2VfQ2F0ZWdvcnkmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6RGV2aWNlX0NhdGVnb3J5OjpmaW5kKCl7DQogICAgc3RkOjpzdHJpbmcgX190b1N0cmluZyA9ICJEZXZpY2VfQ2F0ZWdvcnk6OmZpbmQoKTogIjsNCiAgICBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkV2ZW50IF9fcmVzcG9uc2UgPSAobmV3IGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6RXZlbnQoKSktPmNvZGUoIlsiK3RoaXNOb2RlLmNvZGUoKSsiQHRpbWUiKyJdLkRldmljZV9DYXRlZ29yeS5maW5kKCkiKS5tZXRob2QoImZpbmQiKS5jbGFzc05hbWUoIkRldmljZV9DYXRlZ29yeSIpLmNhcnJpZXIodGhpc05vZGUpLnNlbmRlcih0aGlzTm9kZSkucmVjaXBpZW50KHRoaXNOb2RlLnBhcmVudCgpKTsNCg0KICAgIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6RGV2aWNlX0NhdGVnb3J5KiBhbnN3ZXI7DQoNCiAgICANCg0KICAgIA0KICAgIGlmKGFuc3dlciE9bnVsbHB0cil7DQogICAgDQoNCiAgICANCiAgICAgICAgDQogICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXItPl90b0RvY3VtZW50KCkpOw0KICAgICAgICANCiAgICANCiAgICB9ZWxzZXsNCiAgICAgICAganNvbiBfalJldDsNCiAgICAgICAgX2pSZXRbIl9fdGhpcyJdID0gdGhpcy0+X3RvRG9jdW1lbnQoKTsNCiAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKF9qUmV0KTsNCiAgICAgICAgLy9fX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiB0aGlzLT5fdG9Eb2N1bWVudCgpfSk7DQogICAgfQ0KDQogICAgLy9fX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCg0KICAgIHJldHVybiAqYW5zd2VyOw0KfQ0KICAgIA0KDQogICAgDQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6RGV2aWNlX1R5cGUmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6RGV2aWNlX1R5cGU6OmFjdGl2ZShib29sIHYpew0KICAgIHRoaXMtPl9hY3RpdmUgPSB2Ow0KICAgIHJldHVybiAqdGhpczsNCn0NCiAgICANCg0KYm9vbCBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZV9UeXBlOjphY3RpdmUoKXsNCiAgICByZXR1cm4gdGhpcy0+X2FjdGl2ZTsNCn0NCiAgICANCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpEZXZpY2VfVHlwZSYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpEZXZpY2VfVHlwZTo6ZW5hYmxlZChib29sIHYpew0KICAgIHRoaXMtPl9lbmFibGVkID0gdjsNCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQoNCmJvb2wgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpEZXZpY2VfVHlwZTo6ZW5hYmxlZCgpew0KICAgIHJldHVybiB0aGlzLT5fZW5hYmxlZDsNCn0NCiAgICANCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpEZXZpY2VfVHlwZSYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpEZXZpY2VfVHlwZTo6Y29kZShzdGQ6OnN0cmluZyB2KXsNCiAgICB0aGlzLT5fY29kZSA9IHY7DQogICAgcmV0dXJuICp0aGlzOw0KfQ0KICAgIA0KDQpzdGQ6OnN0cmluZyBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZV9UeXBlOjpjb2RlKCl7DQogICAgcmV0dXJuIHRoaXMtPl9jb2RlOw0KfQ0KICAgIA0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZV9UeXBlJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZV9UeXBlOjpvcmRlcihpbnQgdil7DQogICAgdGhpcy0+X29yZGVyID0gdjsNCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQoNCmludCBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZV9UeXBlOjpvcmRlcigpew0KICAgIHJldHVybiB0aGlzLT5fb3JkZXI7DQp9DQogICAgDQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6RGV2aWNlX1R5cGUmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6RGV2aWNlX1R5cGU6OmRhdGUodGltZV90IHYpew0KICAgIHRoaXMtPl9kYXRlID0gdjsNCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQoNCnRpbWVfdCBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZV9UeXBlOjpkYXRlKCl7DQogICAgcmV0dXJuIHRoaXMtPl9kYXRlOw0KfQ0KICAgIA0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZV9UeXBlJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZV9UeXBlOjpuYW1lKHN0ZDo6c3RyaW5nIHYpew0KICAgIHRoaXMtPl9uYW1lID0gdjsNCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQoNCnN0ZDo6c3RyaW5nIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6RGV2aWNlX1R5cGU6Om5hbWUoKXsNCiAgICByZXR1cm4gdGhpcy0+X25hbWU7DQp9DQogICAgDQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6RGV2aWNlX1R5cGUmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6RGV2aWNlX1R5cGU6OnJlbWFyayhzdGQ6OnN0cmluZyB2KXsNCiAgICB0aGlzLT5fcmVtYXJrID0gdjsNCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZV9UeXBlJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZV9UeXBlOjpyZW1hcmsoanNvbiB2KXsNCiAgICAvL3RoaXMtPl9yZW1hcmsNCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQoNCnN0ZDo6c3RyaW5nIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6RGV2aWNlX1R5cGU6OnJlbWFyaygpew0KICAgIHJldHVybiB0aGlzLT5fcmVtYXJrOw0KfQ0KICAgIA0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZV9UeXBlJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZV9UeXBlOjpjYXRlZ29yeShlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZV9DYXRlZ29yeSYgdil7DQogICAgdGhpcy0+X2NhdGVnb3J5ID0gJnY7DQogICAgcmV0dXJuICp0aGlzOw0KfQ0KICAgIA0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpEZXZpY2VfVHlwZSYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpEZXZpY2VfVHlwZTo6Y2F0ZWdvcnkoZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpEZXZpY2VfQ2F0ZWdvcnkqIHYpew0KICAgIGlmKHYhPW51bGxwdHIpew0KICAgICAgICB0aGlzLT5fY2F0ZWdvcnkgPSB2Ow0KICAgIH0NCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6RGV2aWNlX0NhdGVnb3J5KiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZV9UeXBlOjpjYXRlZ29yeSgpew0KICAgIHJldHVybiB0aGlzLT5fY2F0ZWdvcnk7DQp9DQogICAgDQoNCiAgICANCnN0ZDo6dmVjdG9yPHN0ZDo6YW55PiYmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6RGV2aWNlX1R5cGU6OmRldmljZVR5cGVfTWV0cmljcygpew0KICAgIHJldHVybiBtb3ZlKCoodGhpcy0+X2RldmljZVR5cGVfTWV0cmljcykpOw0KfQ0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZV9UeXBlJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZV9UeXBlOjpkZXZpY2VUeXBlX01ldHJpY3Moc3RkOjp2ZWN0b3I8c3RkOjphbnk+JiYgdil7DQogICAgcmV0dXJuICp0aGlzOw0KfQ0KICAgIA0Kc3RkOjp2ZWN0b3I8c3RkOjphbnk+JiYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpEZXZpY2VfVHlwZTo6dHlwZV9EZXZpY2VzKCl7DQogICAgcmV0dXJuIG1vdmUoKih0aGlzLT5fdHlwZV9EZXZpY2VzKSk7DQp9DQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6RGV2aWNlX1R5cGUmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6RGV2aWNlX1R5cGU6OnR5cGVfRGV2aWNlcyhzdGQ6OnZlY3RvcjxzdGQ6OmFueT4mJiB2KXsNCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQpzdGQ6OnZlY3RvcjxzdGQ6OmFueT4mJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZV9UeXBlOjpkZXZpY2VUeXBlX1R5cGVfQXR0cmlidXRlcygpew0KICAgIHJldHVybiBtb3ZlKCoodGhpcy0+X2RldmljZVR5cGVfVHlwZV9BdHRyaWJ1dGVzKSk7DQp9DQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6RGV2aWNlX1R5cGUmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6RGV2aWNlX1R5cGU6OmRldmljZVR5cGVfVHlwZV9BdHRyaWJ1dGVzKHN0ZDo6dmVjdG9yPHN0ZDo6YW55PiYmIHYpew0KICAgIHJldHVybiAqdGhpczsNCn0NCiAgICANCg0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZV9UeXBlJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZV9UeXBlOjpfdW5pcXVlKCl7DQogICAgc3RkOjpzdHJpbmcgX190b1N0cmluZyA9ICJEZXZpY2VfVHlwZTo6X3VuaXF1ZSgpOiAiOw0KDQogICAgRGV2aWNlX1R5cGUqIHJldCA9IG5ldyBEZXZpY2VfVHlwZSgpOw0KICAgIGlmKHRoaXMtPklkIT0wKSByZXQtPklkID0gdGhpcy0+SWQ7DQogICAgDQogICAgICAgIA0KICAgIGlmKHRoaXMtPmNvZGUoKS5lbXB0eSgpKQ0KICAgICAgICANCiAgICAgICAgcmV0LT5jb2RlKHRoaXMtPmNvZGUoKSk7DQogICAgDQoNCiAgICByZXR1cm4gKnRoaXM7DQp9DQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6RGV2aWNlX1R5cGUmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6RGV2aWNlX1R5cGU6Ol9mcm9tRG9jdW1lbnQodW5zaWduZWQgY2hhciogb2JqKXsNCiAgICByZXR1cm4gdGhpcy0+X2Zyb21Eb2N1bWVudChzdGQ6OnN0cmluZyggb2JqLCBvYmogKyBzaXplb2Ygb2JqIC8gc2l6ZW9mIG9ialswXSApKTsNCn0NCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpEZXZpY2VfVHlwZSYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpEZXZpY2VfVHlwZTo6X2Zyb21Eb2N1bWVudChzdGQ6OnN0cmluZyBvYmopew0KICAgIGlmKG9iai5lbXB0eSgpKSByZXR1cm4gKnRoaXM7DQoNCiAgICBpZiAoc3RkOjpyZWdleF9tYXRjaChvYmosIHN0ZDo6cmVnZXgoUiIiKCgoW0EtWmEtel17Myw5fTooPzovLyk/KSg/OlstOzomPSskLHddK0ApP1tBLVphLXowLTkuLV0rfCg/Ond3dy58Wy07OiY9KyQsd10rQClbQS1aYS16MC05Li1dKykoKD86L1srfiUvLnctX10qKT8/Pyg/OlstKz0mOyVALndfXSopIz8oPzpbd10qKSk/KSIiKSkpew0KICAgICAgICBzdGQ6OnN0cmluZyByZWFkQnVmZmVyOw0KICAgICAgICBDVVJMICpjdXJsID0gY3VybF9lYXN5X2luaXQoKTsNCiAgICAgICAgY3VybF9lYXN5X3NldG9wdChjdXJsLCBDVVJMT1BUX1VSTCwgb2JqKTsNCiAgICAgICAgY3VybF9lYXN5X3NldG9wdChjdXJsLCBDVVJMT1BUX0ZPTExPV0xPQ0FUSU9OLCAxTCk7DQogICAgICAgIC8vY3VybF9lYXN5X3NldG9wdChjdXJsLCBDVVJMT1BUX1dSSVRFRlVOQ1RJT04sICtbXSh2b2lkICpwdHIsIHNpemVfdCBzaXplLCBzaXplX3Qgbm1lbWIsIHZvaWQgKnN0cmVhbSkgLT4gc2l6ZV90IHsgcmVhZEJ1ZmZlci5hcHBlbmQoKnB0ciwgc2l6ZSAqIG5tZW1iKTsgfSk7DQogICAgICAgIGN1cmxfZWFzeV9zZXRvcHQoY3VybCwgQ1VSTE9QVF9XUklURURBVEEsICZyZWFkQnVmZmVyKTsNCiAgICAgICAgY3VybF9lYXN5X3BlcmZvcm0oY3VybCk7DQogICAgICAgIGN1cmxfZWFzeV9jbGVhbnVwKGN1cmwpOw0KICAgICAgICByZXR1cm4gdGhpcy0+X2Zyb21Eb2N1bWVudChyZWFkQnVmZmVyKTsNCiAgICB9DQoNCiAgICByZXR1cm4gdGhpcy0+X2Zyb21Eb2N1bWVudChqc29uOjpwYXJzZShvYmopKTsNCn0NCg0Kc3RkOjp2ZWN0b3I8ZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpEZXZpY2VfVHlwZT4mJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZV9UeXBlOjpfZnJvbURvY3VtZW50KHN0ZDo6dmVjdG9yPGpzb24+JiYgb2JqKXsNCiAgICBzdGQ6OnZlY3RvcjxEZXZpY2VfVHlwZT4qIHJldCA9IG5ldyBzdGQ6OnZlY3RvcjxEZXZpY2VfVHlwZT4ob2JqLnNpemUoKSk7DQogICAgDQogICAgZm9yIChjb25zdCBqc29uJiBqIDogb2JqKXsNCiAgICAgICAgcmV0LT5wdXNoX2JhY2soKG5ldyBEZXZpY2VfVHlwZSgpKS0+X2Zyb21Eb2N1bWVudChqKSk7DQogICAgfQ0KICAgIA0KICAgIHJldHVybiBtb3ZlKCpyZXQpOw0KfQ0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZV9UeXBlJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZV9UeXBlOjpfZnJvbURvY3VtZW50KGpzb24gb2JqKXsNCiAgICANCiAgICBpZihvYmouY29udGFpbnMoImFjdGl2ZSIpKSB0aGlzLT5hY3RpdmUoDQogICAgICAgIA0KICAgICAgICBvYmpbImFjdGl2ZSJdLnRlbXBsYXRlIGdldDxib29sPigpDQogICAgICAgIA0KICAgICAgICApOw0KICAgIA0KICAgIGlmKG9iai5jb250YWlucygiZW5hYmxlZCIpKSB0aGlzLT5lbmFibGVkKA0KICAgICAgICANCiAgICAgICAgb2JqWyJlbmFibGVkIl0udGVtcGxhdGUgZ2V0PGJvb2w+KCkNCiAgICAgICAgDQogICAgICAgICk7DQogICAgDQogICAgaWYob2JqLmNvbnRhaW5zKCJjb2RlIikpIHRoaXMtPmNvZGUoDQogICAgICAgIA0KICAgICAgICBvYmpbImNvZGUiXS50ZW1wbGF0ZSBnZXQ8c3RkOjpzdHJpbmc+KCkNCiAgICAgICAgDQogICAgICAgICk7DQogICAgDQogICAgaWYob2JqLmNvbnRhaW5zKCJvcmRlciIpKSB0aGlzLT5vcmRlcigNCiAgICAgICAgDQogICAgICAgIG9ialsib3JkZXIiXS50ZW1wbGF0ZSBnZXQ8aW50PigpDQogICAgICAgIA0KICAgICAgICApOw0KICAgIA0KICAgIGlmKG9iai5jb250YWlucygiZGF0ZSIpKSB0aGlzLT5kYXRlKA0KICAgICAgICANCiAgICAgICAgb2JqWyJkYXRlIl0udGVtcGxhdGUgZ2V0PHRpbWVfdD4oKQ0KICAgICAgICANCiAgICAgICAgKTsNCiAgICANCiAgICBpZihvYmouY29udGFpbnMoIm5hbWUiKSkgdGhpcy0+bmFtZSgNCiAgICAgICAgDQogICAgICAgIG9ialsibmFtZSJdLnRlbXBsYXRlIGdldDxzdGQ6OnN0cmluZz4oKQ0KICAgICAgICANCiAgICAgICAgKTsNCiAgICANCiAgICBpZihvYmouY29udGFpbnMoInJlbWFyayIpKSB0aGlzLT5yZW1hcmsoDQogICAgICAgIA0KICAgICAgICBvYmpbInJlbWFyayJdLnRlbXBsYXRlIGdldDxzdGQ6OnN0cmluZz4oKQ0KICAgICAgICANCiAgICAgICAgKTsNCiAgICANCiAgICBpZihvYmouY29udGFpbnMoImNhdGVnb3J5IikpIHRoaXMtPmNhdGVnb3J5KA0KICAgICAgICANCiAgICAgICAgKG5ldyBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZV9DYXRlZ29yeSgpKS0+X2Zyb21Eb2N1bWVudChvYmpbImNhdGVnb3J5Il0pDQogICAgICAgIA0KICAgICAgICApOw0KICAgIA0KICAgIA0KICAgIA0KICAgIGlmKG9iai5jb250YWlucygiZGV2aWNlVHlwZV9NZXRyaWNzIikpIHRoaXMtPmRldmljZVR5cGVfTWV0cmljcygobmV3IE1ldHJpYygpKS0+X2Zyb21Eb2N1bWVudCgoc3RkOjp2ZWN0b3I8anNvbj4pb2JqWyJkZXZpY2VUeXBlX01ldHJpY3MiXSkpOw0KICAgIA0KICAgIGlmKG9iai5jb250YWlucygidHlwZV9EZXZpY2VzIikpIHRoaXMtPnR5cGVfRGV2aWNlcygobmV3IERldmljZSgpKS0+X2Zyb21Eb2N1bWVudCgoc3RkOjp2ZWN0b3I8anNvbj4pb2JqWyJ0eXBlX0RldmljZXMiXSkpOw0KICAgIA0KICAgIGlmKG9iai5jb250YWlucygiZGV2aWNlVHlwZV9UeXBlX0F0dHJpYnV0ZXMiKSkgdGhpcy0+ZGV2aWNlVHlwZV9UeXBlX0F0dHJpYnV0ZXMoKG5ldyBUeXBlX0F0dHJpYnV0ZSgpKS0+X2Zyb21Eb2N1bWVudCgoc3RkOjp2ZWN0b3I8anNvbj4pb2JqWyJkZXZpY2VUeXBlX1R5cGVfQXR0cmlidXRlcyJdKSk7DQogICAgDQogICAgcmV0dXJuICp0aGlzOw0KfQ0KDQpzdGQ6OnN0cmluZyBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZV9UeXBlOjpfdG9Eb2N1bWVudCgpew0KICAgIHJldHVybiAiIjsNCn0NCg0KICAgIA0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpEZXZpY2VfVHlwZSYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpEZXZpY2VfVHlwZTo6c3RvcmUoKXsNCiAgICBzdGQ6OnN0cmluZyBfX3RvU3RyaW5nID0gIkRldmljZV9UeXBlOjpzdG9yZSgpOiAiOw0KICAgIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6RXZlbnQgX19yZXNwb25zZSA9IChuZXcgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpFdmVudCgpKS0+Y29kZSgiWyIrdGhpc05vZGUuY29kZSgpKyJAdGltZSIrIl0uRGV2aWNlX1R5cGUuc3RvcmUoKSIpLm1ldGhvZCgic3RvcmUiKS5jbGFzc05hbWUoIkRldmljZV9UeXBlIikuY2Fycmllcih0aGlzTm9kZSkuc2VuZGVyKHRoaXNOb2RlKS5yZWNpcGllbnQodGhpc05vZGUucGFyZW50KCkpOw0KDQogICAgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpEZXZpY2VfVHlwZSogYW5zd2VyOw0KDQogICAgDQoNCiAgICANCiAgICBpZihhbnN3ZXIhPW51bGxwdHIpew0KICAgIA0KDQogICAgDQogICAgICAgIA0KICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLT5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgDQogICAgDQogICAgfWVsc2V7DQogICAgICAgIGpzb24gX2pSZXQ7DQogICAgICAgIF9qUmV0WyJfX3RoaXMiXSA9IHRoaXMtPl90b0RvY3VtZW50KCk7DQogICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChfalJldCk7DQogICAgICAgIC8vX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogdGhpcy0+X3RvRG9jdW1lbnQoKX0pOw0KICAgIH0NCg0KICAgIC8vX19yZXNwb25zZS50cmlnZ2VyKCk7DQoNCiAgICByZXR1cm4gKmFuc3dlcjsNCn0NCiAgICANCnN0ZDo6dmVjdG9yPGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6RGV2aWNlX1R5cGU+JiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZV9UeXBlOjpmaW5kQWxsKCl7DQogICAgc3RkOjpzdHJpbmcgX190b1N0cmluZyA9ICJEZXZpY2VfVHlwZTo6ZmluZEFsbCgpOiAiOw0KICAgIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6RXZlbnQgX19yZXNwb25zZSA9IChuZXcgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpFdmVudCgpKS0+Y29kZSgiWyIrdGhpc05vZGUuY29kZSgpKyJAdGltZSIrIl0uRGV2aWNlX1R5cGUuZmluZEFsbCgpIikubWV0aG9kKCJmaW5kQWxsIikuY2xhc3NOYW1lKCJEZXZpY2VfVHlwZSIpLmNhcnJpZXIodGhpc05vZGUpLnNlbmRlcih0aGlzTm9kZSkucmVjaXBpZW50KHRoaXNOb2RlLnBhcmVudCgpKTsNCg0KICAgIHN0ZDo6dmVjdG9yPGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6RGV2aWNlX1R5cGU+KiBhbnN3ZXI7DQoNCiAgICANCg0KICAgIA0KICAgIGlmKGFuc3dlci0+ZW1wdHkoKSl7DQogICAgDQoNCiAgICANCiAgICAgICAgDQogICAgICAgIC8vX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci0+X3RvRG9jdW1lbnQoKSk7DQogICAgICAgIA0KICAgIA0KICAgIH1lbHNlew0KICAgICAgICBqc29uIF9qUmV0Ow0KICAgICAgICBfalJldFsiX190aGlzIl0gPSB0aGlzLT5fdG9Eb2N1bWVudCgpOw0KICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoX2pSZXQpOw0KICAgICAgICAvL19fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHRoaXMtPl90b0RvY3VtZW50KCl9KTsNCiAgICB9DQoNCiAgICAvL19fcmVzcG9uc2UudHJpZ2dlcigpOw0KDQogICAgcmV0dXJuICphbnN3ZXI7DQp9DQogICAgDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZV9UeXBlJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6OkRldmljZV9UeXBlOjpmaW5kKCl7DQogICAgc3RkOjpzdHJpbmcgX190b1N0cmluZyA9ICJEZXZpY2VfVHlwZTo6ZmluZCgpOiAiOw0KICAgIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6RXZlbnQgX19yZXNwb25zZSA9IChuZXcgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpFdmVudCgpKS0+Y29kZSgiWyIrdGhpc05vZGUuY29kZSgpKyJAdGltZSIrIl0uRGV2aWNlX1R5cGUuZmluZCgpIikubWV0aG9kKCJmaW5kIikuY2xhc3NOYW1lKCJEZXZpY2VfVHlwZSIpLmNhcnJpZXIodGhpc05vZGUpLnNlbmRlcih0aGlzTm9kZSkucmVjaXBpZW50KHRoaXNOb2RlLnBhcmVudCgpKTsNCg0KICAgIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6RGV2aWNlX1R5cGUqIGFuc3dlcjsNCg0KICAgIA0KDQogICAgDQogICAgaWYoYW5zd2VyIT1udWxscHRyKXsNCiAgICANCg0KICAgIA0KICAgICAgICANCiAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci0+X3RvRG9jdW1lbnQoKSk7DQogICAgICAgIA0KICAgIA0KICAgIH1lbHNlew0KICAgICAgICBqc29uIF9qUmV0Ow0KICAgICAgICBfalJldFsiX190aGlzIl0gPSB0aGlzLT5fdG9Eb2N1bWVudCgpOw0KICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoX2pSZXQpOw0KICAgICAgICAvL19fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHRoaXMtPl90b0RvY3VtZW50KCl9KTsNCiAgICB9DQoNCiAgICAvL19fcmVzcG9uc2UudHJpZ2dlcigpOw0KDQogICAgcmV0dXJuICphbnN3ZXI7DQp9DQogICAgDQoNCiAgICANCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpNZXRyaWNfR3JvdXAmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6TWV0cmljX0dyb3VwOjphY3RpdmUoYm9vbCB2KXsNCiAgICB0aGlzLT5fYWN0aXZlID0gdjsNCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQoNCmJvb2wgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpNZXRyaWNfR3JvdXA6OmFjdGl2ZSgpew0KICAgIHJldHVybiB0aGlzLT5fYWN0aXZlOw0KfQ0KICAgIA0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6Ok1ldHJpY19Hcm91cCYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpNZXRyaWNfR3JvdXA6OmVuYWJsZWQoYm9vbCB2KXsNCiAgICB0aGlzLT5fZW5hYmxlZCA9IHY7DQogICAgcmV0dXJuICp0aGlzOw0KfQ0KICAgIA0KDQpib29sIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6TWV0cmljX0dyb3VwOjplbmFibGVkKCl7DQogICAgcmV0dXJuIHRoaXMtPl9lbmFibGVkOw0KfQ0KICAgIA0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6Ok1ldHJpY19Hcm91cCYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpNZXRyaWNfR3JvdXA6OmNvZGUoc3RkOjpzdHJpbmcgdil7DQogICAgdGhpcy0+X2NvZGUgPSB2Ow0KICAgIHJldHVybiAqdGhpczsNCn0NCiAgICANCg0Kc3RkOjpzdHJpbmcgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpNZXRyaWNfR3JvdXA6OmNvZGUoKXsNCiAgICByZXR1cm4gdGhpcy0+X2NvZGU7DQp9DQogICAgDQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6TWV0cmljX0dyb3VwJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6Ok1ldHJpY19Hcm91cDo6b3JkZXIoaW50IHYpew0KICAgIHRoaXMtPl9vcmRlciA9IHY7DQogICAgcmV0dXJuICp0aGlzOw0KfQ0KICAgIA0KDQppbnQgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpNZXRyaWNfR3JvdXA6Om9yZGVyKCl7DQogICAgcmV0dXJuIHRoaXMtPl9vcmRlcjsNCn0NCiAgICANCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpNZXRyaWNfR3JvdXAmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6TWV0cmljX0dyb3VwOjpkYXRlKHRpbWVfdCB2KXsNCiAgICB0aGlzLT5fZGF0ZSA9IHY7DQogICAgcmV0dXJuICp0aGlzOw0KfQ0KICAgIA0KDQp0aW1lX3QgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpNZXRyaWNfR3JvdXA6OmRhdGUoKXsNCiAgICByZXR1cm4gdGhpcy0+X2RhdGU7DQp9DQogICAgDQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6TWV0cmljX0dyb3VwJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6Ok1ldHJpY19Hcm91cDo6bmFtZShzdGQ6OnN0cmluZyB2KXsNCiAgICB0aGlzLT5fbmFtZSA9IHY7DQogICAgcmV0dXJuICp0aGlzOw0KfQ0KICAgIA0KDQpzdGQ6OnN0cmluZyBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6Ok1ldHJpY19Hcm91cDo6bmFtZSgpew0KICAgIHJldHVybiB0aGlzLT5fbmFtZTsNCn0NCiAgICANCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpNZXRyaWNfR3JvdXAmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6TWV0cmljX0dyb3VwOjpyZW1hcmsoc3RkOjpzdHJpbmcgdil7DQogICAgdGhpcy0+X3JlbWFyayA9IHY7DQogICAgcmV0dXJuICp0aGlzOw0KfQ0KICAgIA0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpNZXRyaWNfR3JvdXAmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6TWV0cmljX0dyb3VwOjpyZW1hcmsoanNvbiB2KXsNCiAgICAvL3RoaXMtPl9yZW1hcmsNCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQoNCnN0ZDo6c3RyaW5nIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6TWV0cmljX0dyb3VwOjpyZW1hcmsoKXsNCiAgICByZXR1cm4gdGhpcy0+X3JlbWFyazsNCn0NCiAgICANCg0KICAgIA0Kc3RkOjp2ZWN0b3I8c3RkOjphbnk+JiYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpNZXRyaWNfR3JvdXA6Omdyb3VwX01ldHJpY19UeXBlcygpew0KICAgIHJldHVybiBtb3ZlKCoodGhpcy0+X2dyb3VwX01ldHJpY19UeXBlcykpOw0KfQ0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6Ok1ldHJpY19Hcm91cCYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpNZXRyaWNfR3JvdXA6Omdyb3VwX01ldHJpY19UeXBlcyhzdGQ6OnZlY3RvcjxzdGQ6OmFueT4mJiB2KXsNCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQoNCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpNZXRyaWNfR3JvdXAmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6TWV0cmljX0dyb3VwOjpfdW5pcXVlKCl7DQogICAgc3RkOjpzdHJpbmcgX190b1N0cmluZyA9ICJNZXRyaWNfR3JvdXA6Ol91bmlxdWUoKTogIjsNCg0KICAgIE1ldHJpY19Hcm91cCogcmV0ID0gbmV3IE1ldHJpY19Hcm91cCgpOw0KICAgIGlmKHRoaXMtPklkIT0wKSByZXQtPklkID0gdGhpcy0+SWQ7DQogICAgDQogICAgICAgIA0KICAgIGlmKHRoaXMtPmNvZGUoKS5lbXB0eSgpKQ0KICAgICAgICANCiAgICAgICAgcmV0LT5jb2RlKHRoaXMtPmNvZGUoKSk7DQogICAgDQoNCiAgICByZXR1cm4gKnRoaXM7DQp9DQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6TWV0cmljX0dyb3VwJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6Ok1ldHJpY19Hcm91cDo6X2Zyb21Eb2N1bWVudCh1bnNpZ25lZCBjaGFyKiBvYmopew0KICAgIHJldHVybiB0aGlzLT5fZnJvbURvY3VtZW50KHN0ZDo6c3RyaW5nKCBvYmosIG9iaiArIHNpemVvZiBvYmogLyBzaXplb2Ygb2JqWzBdICkpOw0KfQ0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6Ok1ldHJpY19Hcm91cCYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpNZXRyaWNfR3JvdXA6Ol9mcm9tRG9jdW1lbnQoc3RkOjpzdHJpbmcgb2JqKXsNCiAgICBpZihvYmouZW1wdHkoKSkgcmV0dXJuICp0aGlzOw0KDQogICAgaWYgKHN0ZDo6cmVnZXhfbWF0Y2gob2JqLCBzdGQ6OnJlZ2V4KFIiIigoKFtBLVphLXpdezMsOX06KD86Ly8pPykoPzpbLTs6Jj0rJCx3XStAKT9bQS1aYS16MC05Li1dK3woPzp3d3cufFstOzomPSskLHddK0ApW0EtWmEtejAtOS4tXSspKCg/Oi9bK34lLy53LV9dKik/Pz8oPzpbLSs9JjslQC53X10qKSM/KD86W3ddKikpPykiIikpKXsNCiAgICAgICAgc3RkOjpzdHJpbmcgcmVhZEJ1ZmZlcjsNCiAgICAgICAgQ1VSTCAqY3VybCA9IGN1cmxfZWFzeV9pbml0KCk7DQogICAgICAgIGN1cmxfZWFzeV9zZXRvcHQoY3VybCwgQ1VSTE9QVF9VUkwsIG9iaik7DQogICAgICAgIGN1cmxfZWFzeV9zZXRvcHQoY3VybCwgQ1VSTE9QVF9GT0xMT1dMT0NBVElPTiwgMUwpOw0KICAgICAgICAvL2N1cmxfZWFzeV9zZXRvcHQoY3VybCwgQ1VSTE9QVF9XUklURUZVTkNUSU9OLCArW10odm9pZCAqcHRyLCBzaXplX3Qgc2l6ZSwgc2l6ZV90IG5tZW1iLCB2b2lkICpzdHJlYW0pIC0+IHNpemVfdCB7IHJlYWRCdWZmZXIuYXBwZW5kKCpwdHIsIHNpemUgKiBubWVtYik7IH0pOw0KICAgICAgICBjdXJsX2Vhc3lfc2V0b3B0KGN1cmwsIENVUkxPUFRfV1JJVEVEQVRBLCAmcmVhZEJ1ZmZlcik7DQogICAgICAgIGN1cmxfZWFzeV9wZXJmb3JtKGN1cmwpOw0KICAgICAgICBjdXJsX2Vhc3lfY2xlYW51cChjdXJsKTsNCiAgICAgICAgcmV0dXJuIHRoaXMtPl9mcm9tRG9jdW1lbnQocmVhZEJ1ZmZlcik7DQogICAgfQ0KDQogICAgcmV0dXJuIHRoaXMtPl9mcm9tRG9jdW1lbnQoanNvbjo6cGFyc2Uob2JqKSk7DQp9DQoNCnN0ZDo6dmVjdG9yPGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6TWV0cmljX0dyb3VwPiYmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6TWV0cmljX0dyb3VwOjpfZnJvbURvY3VtZW50KHN0ZDo6dmVjdG9yPGpzb24+JiYgb2JqKXsNCiAgICBzdGQ6OnZlY3RvcjxNZXRyaWNfR3JvdXA+KiByZXQgPSBuZXcgc3RkOjp2ZWN0b3I8TWV0cmljX0dyb3VwPihvYmouc2l6ZSgpKTsNCiAgICANCiAgICBmb3IgKGNvbnN0IGpzb24mIGogOiBvYmopew0KICAgICAgICByZXQtPnB1c2hfYmFjaygobmV3IE1ldHJpY19Hcm91cCgpKS0+X2Zyb21Eb2N1bWVudChqKSk7DQogICAgfQ0KICAgIA0KICAgIHJldHVybiBtb3ZlKCpyZXQpOw0KfQ0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6Ok1ldHJpY19Hcm91cCYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpNZXRyaWNfR3JvdXA6Ol9mcm9tRG9jdW1lbnQoanNvbiBvYmopew0KICAgIA0KICAgIGlmKG9iai5jb250YWlucygiYWN0aXZlIikpIHRoaXMtPmFjdGl2ZSgNCiAgICAgICAgDQogICAgICAgIG9ialsiYWN0aXZlIl0udGVtcGxhdGUgZ2V0PGJvb2w+KCkNCiAgICAgICAgDQogICAgICAgICk7DQogICAgDQogICAgaWYob2JqLmNvbnRhaW5zKCJlbmFibGVkIikpIHRoaXMtPmVuYWJsZWQoDQogICAgICAgIA0KICAgICAgICBvYmpbImVuYWJsZWQiXS50ZW1wbGF0ZSBnZXQ8Ym9vbD4oKQ0KICAgICAgICANCiAgICAgICAgKTsNCiAgICANCiAgICBpZihvYmouY29udGFpbnMoImNvZGUiKSkgdGhpcy0+Y29kZSgNCiAgICAgICAgDQogICAgICAgIG9ialsiY29kZSJdLnRlbXBsYXRlIGdldDxzdGQ6OnN0cmluZz4oKQ0KICAgICAgICANCiAgICAgICAgKTsNCiAgICANCiAgICBpZihvYmouY29udGFpbnMoIm9yZGVyIikpIHRoaXMtPm9yZGVyKA0KICAgICAgICANCiAgICAgICAgb2JqWyJvcmRlciJdLnRlbXBsYXRlIGdldDxpbnQ+KCkNCiAgICAgICAgDQogICAgICAgICk7DQogICAgDQogICAgaWYob2JqLmNvbnRhaW5zKCJkYXRlIikpIHRoaXMtPmRhdGUoDQogICAgICAgIA0KICAgICAgICBvYmpbImRhdGUiXS50ZW1wbGF0ZSBnZXQ8dGltZV90PigpDQogICAgICAgIA0KICAgICAgICApOw0KICAgIA0KICAgIGlmKG9iai5jb250YWlucygibmFtZSIpKSB0aGlzLT5uYW1lKA0KICAgICAgICANCiAgICAgICAgb2JqWyJuYW1lIl0udGVtcGxhdGUgZ2V0PHN0ZDo6c3RyaW5nPigpDQogICAgICAgIA0KICAgICAgICApOw0KICAgIA0KICAgIGlmKG9iai5jb250YWlucygicmVtYXJrIikpIHRoaXMtPnJlbWFyaygNCiAgICAgICAgDQogICAgICAgIG9ialsicmVtYXJrIl0udGVtcGxhdGUgZ2V0PHN0ZDo6c3RyaW5nPigpDQogICAgICAgIA0KICAgICAgICApOw0KICAgIA0KICAgIA0KICAgIA0KICAgIGlmKG9iai5jb250YWlucygiZ3JvdXBfTWV0cmljX1R5cGVzIikpIHRoaXMtPmdyb3VwX01ldHJpY19UeXBlcygobmV3IE1ldHJpY19UeXBlKCkpLT5fZnJvbURvY3VtZW50KChzdGQ6OnZlY3Rvcjxqc29uPilvYmpbImdyb3VwX01ldHJpY19UeXBlcyJdKSk7DQogICAgDQogICAgcmV0dXJuICp0aGlzOw0KfQ0KDQpzdGQ6OnN0cmluZyBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6Ok1ldHJpY19Hcm91cDo6X3RvRG9jdW1lbnQoKXsNCiAgICByZXR1cm4gIiI7DQp9DQoNCiAgICANCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6TWV0cmljX0dyb3VwJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6Ok1ldHJpY19Hcm91cDo6c3RvcmUoKXsNCiAgICBzdGQ6OnN0cmluZyBfX3RvU3RyaW5nID0gIk1ldHJpY19Hcm91cDo6c3RvcmUoKTogIjsNCiAgICBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkV2ZW50IF9fcmVzcG9uc2UgPSAobmV3IGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6RXZlbnQoKSktPmNvZGUoIlsiK3RoaXNOb2RlLmNvZGUoKSsiQHRpbWUiKyJdLk1ldHJpY19Hcm91cC5zdG9yZSgpIikubWV0aG9kKCJzdG9yZSIpLmNsYXNzTmFtZSgiTWV0cmljX0dyb3VwIikuY2Fycmllcih0aGlzTm9kZSkuc2VuZGVyKHRoaXNOb2RlKS5yZWNpcGllbnQodGhpc05vZGUucGFyZW50KCkpOw0KDQogICAgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpNZXRyaWNfR3JvdXAqIGFuc3dlcjsNCg0KICAgIA0KDQogICAgDQogICAgaWYoYW5zd2VyIT1udWxscHRyKXsNCiAgICANCg0KICAgIA0KICAgICAgICANCiAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci0+X3RvRG9jdW1lbnQoKSk7DQogICAgICAgIA0KICAgIA0KICAgIH1lbHNlew0KICAgICAgICBqc29uIF9qUmV0Ow0KICAgICAgICBfalJldFsiX190aGlzIl0gPSB0aGlzLT5fdG9Eb2N1bWVudCgpOw0KICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoX2pSZXQpOw0KICAgICAgICAvL19fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHRoaXMtPl90b0RvY3VtZW50KCl9KTsNCiAgICB9DQoNCiAgICAvL19fcmVzcG9uc2UudHJpZ2dlcigpOw0KDQogICAgcmV0dXJuICphbnN3ZXI7DQp9DQogICAgDQpzdGQ6OnZlY3Rvcjxlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6Ok1ldHJpY19Hcm91cD4mIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6TWV0cmljX0dyb3VwOjpmaW5kQWxsKCl7DQogICAgc3RkOjpzdHJpbmcgX190b1N0cmluZyA9ICJNZXRyaWNfR3JvdXA6OmZpbmRBbGwoKTogIjsNCiAgICBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkV2ZW50IF9fcmVzcG9uc2UgPSAobmV3IGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6RXZlbnQoKSktPmNvZGUoIlsiK3RoaXNOb2RlLmNvZGUoKSsiQHRpbWUiKyJdLk1ldHJpY19Hcm91cC5maW5kQWxsKCkiKS5tZXRob2QoImZpbmRBbGwiKS5jbGFzc05hbWUoIk1ldHJpY19Hcm91cCIpLmNhcnJpZXIodGhpc05vZGUpLnNlbmRlcih0aGlzTm9kZSkucmVjaXBpZW50KHRoaXNOb2RlLnBhcmVudCgpKTsNCg0KICAgIHN0ZDo6dmVjdG9yPGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6TWV0cmljX0dyb3VwPiogYW5zd2VyOw0KDQogICAgDQoNCiAgICANCiAgICBpZihhbnN3ZXItPmVtcHR5KCkpew0KICAgIA0KDQogICAgDQogICAgICAgIA0KICAgICAgICAvL19fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXItPl90b0RvY3VtZW50KCkpOw0KICAgICAgICANCiAgICANCiAgICB9ZWxzZXsNCiAgICAgICAganNvbiBfalJldDsNCiAgICAgICAgX2pSZXRbIl9fdGhpcyJdID0gdGhpcy0+X3RvRG9jdW1lbnQoKTsNCiAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKF9qUmV0KTsNCiAgICAgICAgLy9fX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiB0aGlzLT5fdG9Eb2N1bWVudCgpfSk7DQogICAgfQ0KDQogICAgLy9fX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCg0KICAgIHJldHVybiAqYW5zd2VyOw0KfQ0KICAgIA0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpNZXRyaWNfR3JvdXAmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6TWV0cmljX0dyb3VwOjpmaW5kKCl7DQogICAgc3RkOjpzdHJpbmcgX190b1N0cmluZyA9ICJNZXRyaWNfR3JvdXA6OmZpbmQoKTogIjsNCiAgICBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkV2ZW50IF9fcmVzcG9uc2UgPSAobmV3IGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6RXZlbnQoKSktPmNvZGUoIlsiK3RoaXNOb2RlLmNvZGUoKSsiQHRpbWUiKyJdLk1ldHJpY19Hcm91cC5maW5kKCkiKS5tZXRob2QoImZpbmQiKS5jbGFzc05hbWUoIk1ldHJpY19Hcm91cCIpLmNhcnJpZXIodGhpc05vZGUpLnNlbmRlcih0aGlzTm9kZSkucmVjaXBpZW50KHRoaXNOb2RlLnBhcmVudCgpKTsNCg0KICAgIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6TWV0cmljX0dyb3VwKiBhbnN3ZXI7DQoNCiAgICANCg0KICAgIA0KICAgIGlmKGFuc3dlciE9bnVsbHB0cil7DQogICAgDQoNCiAgICANCiAgICAgICAgDQogICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXItPl90b0RvY3VtZW50KCkpOw0KICAgICAgICANCiAgICANCiAgICB9ZWxzZXsNCiAgICAgICAganNvbiBfalJldDsNCiAgICAgICAgX2pSZXRbIl9fdGhpcyJdID0gdGhpcy0+X3RvRG9jdW1lbnQoKTsNCiAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKF9qUmV0KTsNCiAgICAgICAgLy9fX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiB0aGlzLT5fdG9Eb2N1bWVudCgpfSk7DQogICAgfQ0KDQogICAgLy9fX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCg0KICAgIHJldHVybiAqYW5zd2VyOw0KfQ0KICAgIA0KDQogICAgDQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6TWV0cmljX1R5cGUmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6TWV0cmljX1R5cGU6OmFjdGl2ZShib29sIHYpew0KICAgIHRoaXMtPl9hY3RpdmUgPSB2Ow0KICAgIHJldHVybiAqdGhpczsNCn0NCiAgICANCg0KYm9vbCBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6Ok1ldHJpY19UeXBlOjphY3RpdmUoKXsNCiAgICByZXR1cm4gdGhpcy0+X2FjdGl2ZTsNCn0NCiAgICANCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpNZXRyaWNfVHlwZSYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpNZXRyaWNfVHlwZTo6ZW5hYmxlZChib29sIHYpew0KICAgIHRoaXMtPl9lbmFibGVkID0gdjsNCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQoNCmJvb2wgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpNZXRyaWNfVHlwZTo6ZW5hYmxlZCgpew0KICAgIHJldHVybiB0aGlzLT5fZW5hYmxlZDsNCn0NCiAgICANCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpNZXRyaWNfVHlwZSYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpNZXRyaWNfVHlwZTo6Y29kZShzdGQ6OnN0cmluZyB2KXsNCiAgICB0aGlzLT5fY29kZSA9IHY7DQogICAgcmV0dXJuICp0aGlzOw0KfQ0KICAgIA0KDQpzdGQ6OnN0cmluZyBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6Ok1ldHJpY19UeXBlOjpjb2RlKCl7DQogICAgcmV0dXJuIHRoaXMtPl9jb2RlOw0KfQ0KICAgIA0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6Ok1ldHJpY19UeXBlJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6Ok1ldHJpY19UeXBlOjpvcmRlcihpbnQgdil7DQogICAgdGhpcy0+X29yZGVyID0gdjsNCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQoNCmludCBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6Ok1ldHJpY19UeXBlOjpvcmRlcigpew0KICAgIHJldHVybiB0aGlzLT5fb3JkZXI7DQp9DQogICAgDQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6TWV0cmljX1R5cGUmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6TWV0cmljX1R5cGU6OmRhdGUodGltZV90IHYpew0KICAgIHRoaXMtPl9kYXRlID0gdjsNCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQoNCnRpbWVfdCBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6Ok1ldHJpY19UeXBlOjpkYXRlKCl7DQogICAgcmV0dXJuIHRoaXMtPl9kYXRlOw0KfQ0KICAgIA0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6Ok1ldHJpY19UeXBlJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6Ok1ldHJpY19UeXBlOjpuYW1lKHN0ZDo6c3RyaW5nIHYpew0KICAgIHRoaXMtPl9uYW1lID0gdjsNCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQoNCnN0ZDo6c3RyaW5nIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6TWV0cmljX1R5cGU6Om5hbWUoKXsNCiAgICByZXR1cm4gdGhpcy0+X25hbWU7DQp9DQogICAgDQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6TWV0cmljX1R5cGUmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6TWV0cmljX1R5cGU6OnJlbWFyayhzdGQ6OnN0cmluZyB2KXsNCiAgICB0aGlzLT5fcmVtYXJrID0gdjsNCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6Ok1ldHJpY19UeXBlJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6Ok1ldHJpY19UeXBlOjpyZW1hcmsoanNvbiB2KXsNCiAgICAvL3RoaXMtPl9yZW1hcmsNCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQoNCnN0ZDo6c3RyaW5nIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6TWV0cmljX1R5cGU6OnJlbWFyaygpew0KICAgIHJldHVybiB0aGlzLT5fcmVtYXJrOw0KfQ0KICAgIA0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6Ok1ldHJpY19UeXBlJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6Ok1ldHJpY19UeXBlOjpncm91cChlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6Ok1ldHJpY19Hcm91cCYgdil7DQogICAgdGhpcy0+X2dyb3VwID0gJnY7DQogICAgcmV0dXJuICp0aGlzOw0KfQ0KICAgIA0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpNZXRyaWNfVHlwZSYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpNZXRyaWNfVHlwZTo6Z3JvdXAoZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpNZXRyaWNfR3JvdXAqIHYpew0KICAgIGlmKHYhPW51bGxwdHIpew0KICAgICAgICB0aGlzLT5fZ3JvdXAgPSB2Ow0KICAgIH0NCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6TWV0cmljX0dyb3VwKiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6Ok1ldHJpY19UeXBlOjpncm91cCgpew0KICAgIHJldHVybiB0aGlzLT5fZ3JvdXA7DQp9DQogICAgDQoNCiAgICANCnN0ZDo6dmVjdG9yPHN0ZDo6YW55PiYmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6TWV0cmljX1R5cGU6OnR5cGVfTWV0cmljcygpew0KICAgIHJldHVybiBtb3ZlKCoodGhpcy0+X3R5cGVfTWV0cmljcykpOw0KfQ0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6Ok1ldHJpY19UeXBlJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6Ok1ldHJpY19UeXBlOjp0eXBlX01ldHJpY3Moc3RkOjp2ZWN0b3I8c3RkOjphbnk+JiYgdil7DQogICAgcmV0dXJuICp0aGlzOw0KfQ0KICAgIA0KDQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6TWV0cmljX1R5cGUmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6TWV0cmljX1R5cGU6Ol91bmlxdWUoKXsNCiAgICBzdGQ6OnN0cmluZyBfX3RvU3RyaW5nID0gIk1ldHJpY19UeXBlOjpfdW5pcXVlKCk6ICI7DQoNCiAgICBNZXRyaWNfVHlwZSogcmV0ID0gbmV3IE1ldHJpY19UeXBlKCk7DQogICAgaWYodGhpcy0+SWQhPTApIHJldC0+SWQgPSB0aGlzLT5JZDsNCiAgICANCiAgICAgICAgDQogICAgaWYodGhpcy0+Y29kZSgpLmVtcHR5KCkpDQogICAgICAgIA0KICAgICAgICByZXQtPmNvZGUodGhpcy0+Y29kZSgpKTsNCiAgICANCg0KICAgIHJldHVybiAqdGhpczsNCn0NCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpNZXRyaWNfVHlwZSYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpNZXRyaWNfVHlwZTo6X2Zyb21Eb2N1bWVudCh1bnNpZ25lZCBjaGFyKiBvYmopew0KICAgIHJldHVybiB0aGlzLT5fZnJvbURvY3VtZW50KHN0ZDo6c3RyaW5nKCBvYmosIG9iaiArIHNpemVvZiBvYmogLyBzaXplb2Ygb2JqWzBdICkpOw0KfQ0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6Ok1ldHJpY19UeXBlJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6Ok1ldHJpY19UeXBlOjpfZnJvbURvY3VtZW50KHN0ZDo6c3RyaW5nIG9iail7DQogICAgaWYob2JqLmVtcHR5KCkpIHJldHVybiAqdGhpczsNCg0KICAgIGlmIChzdGQ6OnJlZ2V4X21hdGNoKG9iaiwgc3RkOjpyZWdleChSIiIoKChbQS1aYS16XXszLDl9Oig/Oi8vKT8pKD86Wy07OiY9KyQsd10rQCk/W0EtWmEtejAtOS4tXSt8KD86d3d3LnxbLTs6Jj0rJCx3XStAKVtBLVphLXowLTkuLV0rKSgoPzovWyt+JS8udy1fXSopPz8/KD86Wy0rPSY7JUAud19dKikjPyg/Olt3XSopKT8pIiIpKSl7DQogICAgICAgIHN0ZDo6c3RyaW5nIHJlYWRCdWZmZXI7DQogICAgICAgIENVUkwgKmN1cmwgPSBjdXJsX2Vhc3lfaW5pdCgpOw0KICAgICAgICBjdXJsX2Vhc3lfc2V0b3B0KGN1cmwsIENVUkxPUFRfVVJMLCBvYmopOw0KICAgICAgICBjdXJsX2Vhc3lfc2V0b3B0KGN1cmwsIENVUkxPUFRfRk9MTE9XTE9DQVRJT04sIDFMKTsNCiAgICAgICAgLy9jdXJsX2Vhc3lfc2V0b3B0KGN1cmwsIENVUkxPUFRfV1JJVEVGVU5DVElPTiwgK1tdKHZvaWQgKnB0ciwgc2l6ZV90IHNpemUsIHNpemVfdCBubWVtYiwgdm9pZCAqc3RyZWFtKSAtPiBzaXplX3QgeyByZWFkQnVmZmVyLmFwcGVuZCgqcHRyLCBzaXplICogbm1lbWIpOyB9KTsNCiAgICAgICAgY3VybF9lYXN5X3NldG9wdChjdXJsLCBDVVJMT1BUX1dSSVRFREFUQSwgJnJlYWRCdWZmZXIpOw0KICAgICAgICBjdXJsX2Vhc3lfcGVyZm9ybShjdXJsKTsNCiAgICAgICAgY3VybF9lYXN5X2NsZWFudXAoY3VybCk7DQogICAgICAgIHJldHVybiB0aGlzLT5fZnJvbURvY3VtZW50KHJlYWRCdWZmZXIpOw0KICAgIH0NCg0KICAgIHJldHVybiB0aGlzLT5fZnJvbURvY3VtZW50KGpzb246OnBhcnNlKG9iaikpOw0KfQ0KDQpzdGQ6OnZlY3Rvcjxlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6Ok1ldHJpY19UeXBlPiYmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6TWV0cmljX1R5cGU6Ol9mcm9tRG9jdW1lbnQoc3RkOjp2ZWN0b3I8anNvbj4mJiBvYmopew0KICAgIHN0ZDo6dmVjdG9yPE1ldHJpY19UeXBlPiogcmV0ID0gbmV3IHN0ZDo6dmVjdG9yPE1ldHJpY19UeXBlPihvYmouc2l6ZSgpKTsNCiAgICANCiAgICBmb3IgKGNvbnN0IGpzb24mIGogOiBvYmopew0KICAgICAgICByZXQtPnB1c2hfYmFjaygobmV3IE1ldHJpY19UeXBlKCkpLT5fZnJvbURvY3VtZW50KGopKTsNCiAgICB9DQogICAgDQogICAgcmV0dXJuIG1vdmUoKnJldCk7DQp9DQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6TWV0cmljX1R5cGUmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6TWV0cmljX1R5cGU6Ol9mcm9tRG9jdW1lbnQoanNvbiBvYmopew0KICAgIA0KICAgIGlmKG9iai5jb250YWlucygiYWN0aXZlIikpIHRoaXMtPmFjdGl2ZSgNCiAgICAgICAgDQogICAgICAgIG9ialsiYWN0aXZlIl0udGVtcGxhdGUgZ2V0PGJvb2w+KCkNCiAgICAgICAgDQogICAgICAgICk7DQogICAgDQogICAgaWYob2JqLmNvbnRhaW5zKCJlbmFibGVkIikpIHRoaXMtPmVuYWJsZWQoDQogICAgICAgIA0KICAgICAgICBvYmpbImVuYWJsZWQiXS50ZW1wbGF0ZSBnZXQ8Ym9vbD4oKQ0KICAgICAgICANCiAgICAgICAgKTsNCiAgICANCiAgICBpZihvYmouY29udGFpbnMoImNvZGUiKSkgdGhpcy0+Y29kZSgNCiAgICAgICAgDQogICAgICAgIG9ialsiY29kZSJdLnRlbXBsYXRlIGdldDxzdGQ6OnN0cmluZz4oKQ0KICAgICAgICANCiAgICAgICAgKTsNCiAgICANCiAgICBpZihvYmouY29udGFpbnMoIm9yZGVyIikpIHRoaXMtPm9yZGVyKA0KICAgICAgICANCiAgICAgICAgb2JqWyJvcmRlciJdLnRlbXBsYXRlIGdldDxpbnQ+KCkNCiAgICAgICAgDQogICAgICAgICk7DQogICAgDQogICAgaWYob2JqLmNvbnRhaW5zKCJkYXRlIikpIHRoaXMtPmRhdGUoDQogICAgICAgIA0KICAgICAgICBvYmpbImRhdGUiXS50ZW1wbGF0ZSBnZXQ8dGltZV90PigpDQogICAgICAgIA0KICAgICAgICApOw0KICAgIA0KICAgIGlmKG9iai5jb250YWlucygibmFtZSIpKSB0aGlzLT5uYW1lKA0KICAgICAgICANCiAgICAgICAgb2JqWyJuYW1lIl0udGVtcGxhdGUgZ2V0PHN0ZDo6c3RyaW5nPigpDQogICAgICAgIA0KICAgICAgICApOw0KICAgIA0KICAgIGlmKG9iai5jb250YWlucygicmVtYXJrIikpIHRoaXMtPnJlbWFyaygNCiAgICAgICAgDQogICAgICAgIG9ialsicmVtYXJrIl0udGVtcGxhdGUgZ2V0PHN0ZDo6c3RyaW5nPigpDQogICAgICAgIA0KICAgICAgICApOw0KICAgIA0KICAgIGlmKG9iai5jb250YWlucygiZ3JvdXAiKSkgdGhpcy0+Z3JvdXAoDQogICAgICAgIA0KICAgICAgICAobmV3IGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6TWV0cmljX0dyb3VwKCkpLT5fZnJvbURvY3VtZW50KG9ialsiZ3JvdXAiXSkNCiAgICAgICAgDQogICAgICAgICk7DQogICAgDQogICAgDQogICAgDQogICAgaWYob2JqLmNvbnRhaW5zKCJ0eXBlX01ldHJpY3MiKSkgdGhpcy0+dHlwZV9NZXRyaWNzKChuZXcgTWV0cmljKCkpLT5fZnJvbURvY3VtZW50KChzdGQ6OnZlY3Rvcjxqc29uPilvYmpbInR5cGVfTWV0cmljcyJdKSk7DQogICAgDQogICAgcmV0dXJuICp0aGlzOw0KfQ0KDQpzdGQ6OnN0cmluZyBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6Ok1ldHJpY19UeXBlOjpfdG9Eb2N1bWVudCgpew0KICAgIHJldHVybiAiIjsNCn0NCg0KICAgIA0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpNZXRyaWNfVHlwZSYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpNZXRyaWNfVHlwZTo6c3RvcmUoKXsNCiAgICBzdGQ6OnN0cmluZyBfX3RvU3RyaW5nID0gIk1ldHJpY19UeXBlOjpzdG9yZSgpOiAiOw0KICAgIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6RXZlbnQgX19yZXNwb25zZSA9IChuZXcgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpFdmVudCgpKS0+Y29kZSgiWyIrdGhpc05vZGUuY29kZSgpKyJAdGltZSIrIl0uTWV0cmljX1R5cGUuc3RvcmUoKSIpLm1ldGhvZCgic3RvcmUiKS5jbGFzc05hbWUoIk1ldHJpY19UeXBlIikuY2Fycmllcih0aGlzTm9kZSkuc2VuZGVyKHRoaXNOb2RlKS5yZWNpcGllbnQodGhpc05vZGUucGFyZW50KCkpOw0KDQogICAgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkaW90OjpNZXRyaWNfVHlwZSogYW5zd2VyOw0KDQogICAgDQoNCiAgICANCiAgICBpZihhbnN3ZXIhPW51bGxwdHIpew0KICAgIA0KDQogICAgDQogICAgICAgIA0KICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLT5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgDQogICAgDQogICAgfWVsc2V7DQogICAgICAgIGpzb24gX2pSZXQ7DQogICAgICAgIF9qUmV0WyJfX3RoaXMiXSA9IHRoaXMtPl90b0RvY3VtZW50KCk7DQogICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChfalJldCk7DQogICAgICAgIC8vX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogdGhpcy0+X3RvRG9jdW1lbnQoKX0pOw0KICAgIH0NCg0KICAgIC8vX19yZXNwb25zZS50cmlnZ2VyKCk7DQoNCiAgICByZXR1cm4gKmFuc3dlcjsNCn0NCiAgICANCnN0ZDo6dmVjdG9yPGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6TWV0cmljX1R5cGU+JiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6Ok1ldHJpY19UeXBlOjpmaW5kQWxsKCl7DQogICAgc3RkOjpzdHJpbmcgX190b1N0cmluZyA9ICJNZXRyaWNfVHlwZTo6ZmluZEFsbCgpOiAiOw0KICAgIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6RXZlbnQgX19yZXNwb25zZSA9IChuZXcgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpFdmVudCgpKS0+Y29kZSgiWyIrdGhpc05vZGUuY29kZSgpKyJAdGltZSIrIl0uTWV0cmljX1R5cGUuZmluZEFsbCgpIikubWV0aG9kKCJmaW5kQWxsIikuY2xhc3NOYW1lKCJNZXRyaWNfVHlwZSIpLmNhcnJpZXIodGhpc05vZGUpLnNlbmRlcih0aGlzTm9kZSkucmVjaXBpZW50KHRoaXNOb2RlLnBhcmVudCgpKTsNCg0KICAgIHN0ZDo6dmVjdG9yPGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6TWV0cmljX1R5cGU+KiBhbnN3ZXI7DQoNCiAgICANCg0KICAgIA0KICAgIGlmKGFuc3dlci0+ZW1wdHkoKSl7DQogICAgDQoNCiAgICANCiAgICAgICAgDQogICAgICAgIC8vX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci0+X3RvRG9jdW1lbnQoKSk7DQogICAgICAgIA0KICAgIA0KICAgIH1lbHNlew0KICAgICAgICBqc29uIF9qUmV0Ow0KICAgICAgICBfalJldFsiX190aGlzIl0gPSB0aGlzLT5fdG9Eb2N1bWVudCgpOw0KICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoX2pSZXQpOw0KICAgICAgICAvL19fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHRoaXMtPl90b0RvY3VtZW50KCl9KTsNCiAgICB9DQoNCiAgICAvL19fcmVzcG9uc2UudHJpZ2dlcigpOw0KDQogICAgcmV0dXJuICphbnN3ZXI7DQp9DQogICAgDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6Ok1ldHJpY19UeXBlJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRpb3Q6Ok1ldHJpY19UeXBlOjpmaW5kKCl7DQogICAgc3RkOjpzdHJpbmcgX190b1N0cmluZyA9ICJNZXRyaWNfVHlwZTo6ZmluZCgpOiAiOw0KICAgIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6RXZlbnQgX19yZXNwb25zZSA9IChuZXcgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpFdmVudCgpKS0+Y29kZSgiWyIrdGhpc05vZGUuY29kZSgpKyJAdGltZSIrIl0uTWV0cmljX1R5cGUuZmluZCgpIikubWV0aG9kKCJmaW5kIikuY2xhc3NOYW1lKCJNZXRyaWNfVHlwZSIpLmNhcnJpZXIodGhpc05vZGUpLnNlbmRlcih0aGlzTm9kZSkucmVjaXBpZW50KHRoaXNOb2RlLnBhcmVudCgpKTsNCg0KICAgIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGlvdDo6TWV0cmljX1R5cGUqIGFuc3dlcjsNCg0KICAgIA0KDQogICAgDQogICAgaWYoYW5zd2VyIT1udWxscHRyKXsNCiAgICANCg0KICAgIA0KICAgICAgICANCiAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci0+X3RvRG9jdW1lbnQoKSk7DQogICAgICAgIA0KICAgIA0KICAgIH1lbHNlew0KICAgICAgICBqc29uIF9qUmV0Ow0KICAgICAgICBfalJldFsiX190aGlzIl0gPSB0aGlzLT5fdG9Eb2N1bWVudCgpOw0KICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoX2pSZXQpOw0KICAgICAgICAvL19fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHRoaXMtPl90b0RvY3VtZW50KCl9KTsNCiAgICB9DQoNCiAgICAvL19fcmVzcG9uc2UudHJpZ2dlcigpOw0KDQogICAgcmV0dXJuICphbnN3ZXI7DQp9DQogICAgDQoNCiAgICANCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpDb25maWcmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Q29uZmlnOjphY3RpdmUoYm9vbCB2KXsNCiAgICB0aGlzLT5fYWN0aXZlID0gdjsNCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQoNCmJvb2wgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpDb25maWc6OmFjdGl2ZSgpew0KICAgIHJldHVybiB0aGlzLT5fYWN0aXZlOw0KfQ0KICAgIA0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkNvbmZpZyYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpDb25maWc6OmVuYWJsZWQoYm9vbCB2KXsNCiAgICB0aGlzLT5fZW5hYmxlZCA9IHY7DQogICAgcmV0dXJuICp0aGlzOw0KfQ0KICAgIA0KDQpib29sIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Q29uZmlnOjplbmFibGVkKCl7DQogICAgcmV0dXJuIHRoaXMtPl9lbmFibGVkOw0KfQ0KICAgIA0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkNvbmZpZyYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpDb25maWc6OmNvZGUoc3RkOjpzdHJpbmcgdil7DQogICAgdGhpcy0+X2NvZGUgPSB2Ow0KICAgIHJldHVybiAqdGhpczsNCn0NCiAgICANCg0Kc3RkOjpzdHJpbmcgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpDb25maWc6OmNvZGUoKXsNCiAgICByZXR1cm4gdGhpcy0+X2NvZGU7DQp9DQogICAgDQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Q29uZmlnJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkNvbmZpZzo6b3JkZXIoaW50IHYpew0KICAgIHRoaXMtPl9vcmRlciA9IHY7DQogICAgcmV0dXJuICp0aGlzOw0KfQ0KICAgIA0KDQppbnQgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpDb25maWc6Om9yZGVyKCl7DQogICAgcmV0dXJuIHRoaXMtPl9vcmRlcjsNCn0NCiAgICANCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpDb25maWcmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Q29uZmlnOjpkYXRlKHRpbWVfdCB2KXsNCiAgICB0aGlzLT5fZGF0ZSA9IHY7DQogICAgcmV0dXJuICp0aGlzOw0KfQ0KICAgIA0KDQp0aW1lX3QgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpDb25maWc6OmRhdGUoKXsNCiAgICByZXR1cm4gdGhpcy0+X2RhdGU7DQp9DQogICAgDQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Q29uZmlnJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkNvbmZpZzo6bmFtZShzdGQ6OnN0cmluZyB2KXsNCiAgICB0aGlzLT5fbmFtZSA9IHY7DQogICAgcmV0dXJuICp0aGlzOw0KfQ0KICAgIA0KDQpzdGQ6OnN0cmluZyBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkNvbmZpZzo6bmFtZSgpew0KICAgIHJldHVybiB0aGlzLT5fbmFtZTsNCn0NCiAgICANCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpDb25maWcmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Q29uZmlnOjpyZW1hcmsoc3RkOjpzdHJpbmcgdil7DQogICAgdGhpcy0+X3JlbWFyayA9IHY7DQogICAgcmV0dXJuICp0aGlzOw0KfQ0KICAgIA0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpDb25maWcmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Q29uZmlnOjpyZW1hcmsoanNvbiB2KXsNCiAgICAvL3RoaXMtPl9yZW1hcmsNCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQoNCnN0ZDo6c3RyaW5nIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Q29uZmlnOjpyZW1hcmsoKXsNCiAgICByZXR1cm4gdGhpcy0+X3JlbWFyazsNCn0NCiAgICANCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpDb25maWcmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Q29uZmlnOjp2YWx1ZShzdGQ6OnN0cmluZyB2KXsNCiAgICB0aGlzLT5fdmFsdWUgPSB2Ow0KICAgIHJldHVybiAqdGhpczsNCn0NCiAgICANCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Q29uZmlnJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkNvbmZpZzo6dmFsdWUoanNvbiB2KXsNCiAgICAvL3RoaXMtPl92YWx1ZQ0KICAgIHJldHVybiAqdGhpczsNCn0NCiAgICANCg0Kc3RkOjpzdHJpbmcgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpDb25maWc6OnZhbHVlKCl7DQogICAgcmV0dXJuIHRoaXMtPl92YWx1ZTsNCn0NCiAgICANCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpDb25maWcmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Q29uZmlnOjpzY3JpcHQoc3RkOjpzdHJpbmcgdil7DQogICAgdGhpcy0+X3NjcmlwdCA9IHY7DQogICAgcmV0dXJuICp0aGlzOw0KfQ0KICAgIA0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpDb25maWcmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Q29uZmlnOjpzY3JpcHQoanNvbiB2KXsNCiAgICAvL3RoaXMtPl9zY3JpcHQNCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQoNCnN0ZDo6c3RyaW5nIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Q29uZmlnOjpzY3JpcHQoKXsNCiAgICByZXR1cm4gdGhpcy0+X3NjcmlwdDsNCn0NCiAgICANCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpDb25maWcmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Q29uZmlnOjp0b29sKGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6VG9vbCYgdil7DQogICAgdGhpcy0+X3Rvb2wgPSAmdjsNCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkNvbmZpZyYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpDb25maWc6OnRvb2woZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpUb29sKiB2KXsNCiAgICBpZih2IT1udWxscHRyKXsNCiAgICAgICAgdGhpcy0+X3Rvb2wgPSB2Ow0KICAgIH0NCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6VG9vbCogZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpDb25maWc6OnRvb2woKXsNCiAgICByZXR1cm4gdGhpcy0+X3Rvb2w7DQp9DQogICAgDQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Q29uZmlnJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkNvbmZpZzo6Z3JvdXAoZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpDb25maWdfR3JvdXAmIHYpew0KICAgIHRoaXMtPl9ncm91cCA9ICZ2Ow0KICAgIHJldHVybiAqdGhpczsNCn0NCiAgICANCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Q29uZmlnJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkNvbmZpZzo6Z3JvdXAoZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpDb25maWdfR3JvdXAqIHYpew0KICAgIGlmKHYhPW51bGxwdHIpew0KICAgICAgICB0aGlzLT5fZ3JvdXAgPSB2Ow0KICAgIH0NCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Q29uZmlnX0dyb3VwKiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkNvbmZpZzo6Z3JvdXAoKXsNCiAgICByZXR1cm4gdGhpcy0+X2dyb3VwOw0KfQ0KICAgIA0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkNvbmZpZyYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpDb25maWc6OnR5cGUoZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpUb29sX1R5cGUmIHYpew0KICAgIHRoaXMtPl90eXBlID0gJnY7DQogICAgcmV0dXJuICp0aGlzOw0KfQ0KICAgIA0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpDb25maWcmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Q29uZmlnOjp0eXBlKGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6VG9vbF9UeXBlKiB2KXsNCiAgICBpZih2IT1udWxscHRyKXsNCiAgICAgICAgdGhpcy0+X3R5cGUgPSB2Ow0KICAgIH0NCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6VG9vbF9UeXBlKiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkNvbmZpZzo6dHlwZSgpew0KICAgIHJldHVybiB0aGlzLT5fdHlwZTsNCn0NCiAgICANCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpDb25maWcmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Q29uZmlnOjpub2RlKGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZSYgdil7DQogICAgdGhpcy0+X25vZGUgPSAmdjsNCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkNvbmZpZyYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpDb25maWc6Om5vZGUoZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlKiB2KXsNCiAgICBpZih2IT1udWxscHRyKXsNCiAgICAgICAgdGhpcy0+X25vZGUgPSB2Ow0KICAgIH0NCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZSogZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpDb25maWc6Om5vZGUoKXsNCiAgICByZXR1cm4gdGhpcy0+X25vZGU7DQp9DQogICAgDQoNCiAgICANCg0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkNvbmZpZyYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpDb25maWc6Ol91bmlxdWUoKXsNCiAgICBzdGQ6OnN0cmluZyBfX3RvU3RyaW5nID0gIkNvbmZpZzo6X3VuaXF1ZSgpOiAiOw0KDQogICAgQ29uZmlnKiByZXQgPSBuZXcgQ29uZmlnKCk7DQogICAgaWYodGhpcy0+SWQhPTApIHJldC0+SWQgPSB0aGlzLT5JZDsNCiAgICANCiAgICAgICAgDQogICAgaWYodGhpcy0+bmFtZSgpLmVtcHR5KCkpDQogICAgICAgIA0KICAgICAgICByZXQtPm5hbWUodGhpcy0+bmFtZSgpKTsNCiAgICANCg0KICAgIHJldHVybiAqdGhpczsNCn0NCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpDb25maWcmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Q29uZmlnOjpfZnJvbURvY3VtZW50KHVuc2lnbmVkIGNoYXIqIG9iail7DQogICAgcmV0dXJuIHRoaXMtPl9mcm9tRG9jdW1lbnQoc3RkOjpzdHJpbmcoIG9iaiwgb2JqICsgc2l6ZW9mIG9iaiAvIHNpemVvZiBvYmpbMF0gKSk7DQp9DQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Q29uZmlnJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkNvbmZpZzo6X2Zyb21Eb2N1bWVudChzdGQ6OnN0cmluZyBvYmopew0KICAgIGlmKG9iai5lbXB0eSgpKSByZXR1cm4gKnRoaXM7DQoNCiAgICBpZiAoc3RkOjpyZWdleF9tYXRjaChvYmosIHN0ZDo6cmVnZXgoUiIiKCgoW0EtWmEtel17Myw5fTooPzovLyk/KSg/OlstOzomPSskLHddK0ApP1tBLVphLXowLTkuLV0rfCg/Ond3dy58Wy07OiY9KyQsd10rQClbQS1aYS16MC05Li1dKykoKD86L1srfiUvLnctX10qKT8/Pyg/OlstKz0mOyVALndfXSopIz8oPzpbd10qKSk/KSIiKSkpew0KICAgICAgICBzdGQ6OnN0cmluZyByZWFkQnVmZmVyOw0KICAgICAgICBDVVJMICpjdXJsID0gY3VybF9lYXN5X2luaXQoKTsNCiAgICAgICAgY3VybF9lYXN5X3NldG9wdChjdXJsLCBDVVJMT1BUX1VSTCwgb2JqKTsNCiAgICAgICAgY3VybF9lYXN5X3NldG9wdChjdXJsLCBDVVJMT1BUX0ZPTExPV0xPQ0FUSU9OLCAxTCk7DQogICAgICAgIC8vY3VybF9lYXN5X3NldG9wdChjdXJsLCBDVVJMT1BUX1dSSVRFRlVOQ1RJT04sICtbXSh2b2lkICpwdHIsIHNpemVfdCBzaXplLCBzaXplX3Qgbm1lbWIsIHZvaWQgKnN0cmVhbSkgLT4gc2l6ZV90IHsgcmVhZEJ1ZmZlci5hcHBlbmQoKnB0ciwgc2l6ZSAqIG5tZW1iKTsgfSk7DQogICAgICAgIGN1cmxfZWFzeV9zZXRvcHQoY3VybCwgQ1VSTE9QVF9XUklURURBVEEsICZyZWFkQnVmZmVyKTsNCiAgICAgICAgY3VybF9lYXN5X3BlcmZvcm0oY3VybCk7DQogICAgICAgIGN1cmxfZWFzeV9jbGVhbnVwKGN1cmwpOw0KICAgICAgICByZXR1cm4gdGhpcy0+X2Zyb21Eb2N1bWVudChyZWFkQnVmZmVyKTsNCiAgICB9DQoNCiAgICByZXR1cm4gdGhpcy0+X2Zyb21Eb2N1bWVudChqc29uOjpwYXJzZShvYmopKTsNCn0NCg0Kc3RkOjp2ZWN0b3I8ZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpDb25maWc+JiYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpDb25maWc6Ol9mcm9tRG9jdW1lbnQoc3RkOjp2ZWN0b3I8anNvbj4mJiBvYmopew0KICAgIHN0ZDo6dmVjdG9yPENvbmZpZz4qIHJldCA9IG5ldyBzdGQ6OnZlY3RvcjxDb25maWc+KG9iai5zaXplKCkpOw0KICAgIA0KICAgIGZvciAoY29uc3QganNvbiYgaiA6IG9iail7DQogICAgICAgIHJldC0+cHVzaF9iYWNrKChuZXcgQ29uZmlnKCkpLT5fZnJvbURvY3VtZW50KGopKTsNCiAgICB9DQogICAgDQogICAgcmV0dXJuIG1vdmUoKnJldCk7DQp9DQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Q29uZmlnJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkNvbmZpZzo6X2Zyb21Eb2N1bWVudChqc29uIG9iail7DQogICAgDQogICAgaWYob2JqLmNvbnRhaW5zKCJhY3RpdmUiKSkgdGhpcy0+YWN0aXZlKA0KICAgICAgICANCiAgICAgICAgb2JqWyJhY3RpdmUiXS50ZW1wbGF0ZSBnZXQ8Ym9vbD4oKQ0KICAgICAgICANCiAgICAgICAgKTsNCiAgICANCiAgICBpZihvYmouY29udGFpbnMoImVuYWJsZWQiKSkgdGhpcy0+ZW5hYmxlZCgNCiAgICAgICAgDQogICAgICAgIG9ialsiZW5hYmxlZCJdLnRlbXBsYXRlIGdldDxib29sPigpDQogICAgICAgIA0KICAgICAgICApOw0KICAgIA0KICAgIGlmKG9iai5jb250YWlucygiY29kZSIpKSB0aGlzLT5jb2RlKA0KICAgICAgICANCiAgICAgICAgb2JqWyJjb2RlIl0udGVtcGxhdGUgZ2V0PHN0ZDo6c3RyaW5nPigpDQogICAgICAgIA0KICAgICAgICApOw0KICAgIA0KICAgIGlmKG9iai5jb250YWlucygib3JkZXIiKSkgdGhpcy0+b3JkZXIoDQogICAgICAgIA0KICAgICAgICBvYmpbIm9yZGVyIl0udGVtcGxhdGUgZ2V0PGludD4oKQ0KICAgICAgICANCiAgICAgICAgKTsNCiAgICANCiAgICBpZihvYmouY29udGFpbnMoImRhdGUiKSkgdGhpcy0+ZGF0ZSgNCiAgICAgICAgDQogICAgICAgIG9ialsiZGF0ZSJdLnRlbXBsYXRlIGdldDx0aW1lX3Q+KCkNCiAgICAgICAgDQogICAgICAgICk7DQogICAgDQogICAgaWYob2JqLmNvbnRhaW5zKCJuYW1lIikpIHRoaXMtPm5hbWUoDQogICAgICAgIA0KICAgICAgICBvYmpbIm5hbWUiXS50ZW1wbGF0ZSBnZXQ8c3RkOjpzdHJpbmc+KCkNCiAgICAgICAgDQogICAgICAgICk7DQogICAgDQogICAgaWYob2JqLmNvbnRhaW5zKCJyZW1hcmsiKSkgdGhpcy0+cmVtYXJrKA0KICAgICAgICANCiAgICAgICAgb2JqWyJyZW1hcmsiXS50ZW1wbGF0ZSBnZXQ8c3RkOjpzdHJpbmc+KCkNCiAgICAgICAgDQogICAgICAgICk7DQogICAgDQogICAgaWYob2JqLmNvbnRhaW5zKCJ2YWx1ZSIpKSB0aGlzLT52YWx1ZSgNCiAgICAgICAgDQogICAgICAgIG9ialsidmFsdWUiXS50ZW1wbGF0ZSBnZXQ8c3RkOjpzdHJpbmc+KCkNCiAgICAgICAgDQogICAgICAgICk7DQogICAgDQogICAgaWYob2JqLmNvbnRhaW5zKCJzY3JpcHQiKSkgdGhpcy0+c2NyaXB0KA0KICAgICAgICANCiAgICAgICAgb2JqWyJzY3JpcHQiXS50ZW1wbGF0ZSBnZXQ8c3RkOjpzdHJpbmc+KCkNCiAgICAgICAgDQogICAgICAgICk7DQogICAgDQogICAgaWYob2JqLmNvbnRhaW5zKCJ0b29sIikpIHRoaXMtPnRvb2woDQogICAgICAgIA0KICAgICAgICAobmV3IGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6VG9vbCgpKS0+X2Zyb21Eb2N1bWVudChvYmpbInRvb2wiXSkNCiAgICAgICAgDQogICAgICAgICk7DQogICAgDQogICAgaWYob2JqLmNvbnRhaW5zKCJncm91cCIpKSB0aGlzLT5ncm91cCgNCiAgICAgICAgDQogICAgICAgIChuZXcgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpDb25maWdfR3JvdXAoKSktPl9mcm9tRG9jdW1lbnQob2JqWyJncm91cCJdKQ0KICAgICAgICANCiAgICAgICAgKTsNCiAgICANCiAgICBpZihvYmouY29udGFpbnMoInR5cGUiKSkgdGhpcy0+dHlwZSgNCiAgICAgICAgDQogICAgICAgIChuZXcgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpUb29sX1R5cGUoKSktPl9mcm9tRG9jdW1lbnQob2JqWyJ0eXBlIl0pDQogICAgICAgIA0KICAgICAgICApOw0KICAgIA0KICAgIGlmKG9iai5jb250YWlucygibm9kZSIpKSB0aGlzLT5ub2RlKA0KICAgICAgICANCiAgICAgICAgKG5ldyBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGUoKSktPl9mcm9tRG9jdW1lbnQob2JqWyJub2RlIl0pDQogICAgICAgIA0KICAgICAgICApOw0KICAgIA0KICAgIA0KICAgIA0KICAgIHJldHVybiAqdGhpczsNCn0NCg0Kc3RkOjpzdHJpbmcgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpDb25maWc6Ol90b0RvY3VtZW50KCl7DQogICAgcmV0dXJuICIiOw0KfQ0KDQogICAgDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkNvbmZpZyYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpDb25maWc6OnN0b3JlKCl7DQogICAgc3RkOjpzdHJpbmcgX190b1N0cmluZyA9ICJDb25maWc6OnN0b3JlKCk6ICI7DQogICAgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpFdmVudCBfX3Jlc3BvbnNlID0gKG5ldyBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkV2ZW50KCkpLT5jb2RlKCJbIit0aGlzTm9kZS5jb2RlKCkrIkB0aW1lIisiXS5Db25maWcuc3RvcmUoKSIpLm1ldGhvZCgic3RvcmUiKS5jbGFzc05hbWUoIkNvbmZpZyIpLmNhcnJpZXIodGhpc05vZGUpLnNlbmRlcih0aGlzTm9kZSkucmVjaXBpZW50KHRoaXNOb2RlLnBhcmVudCgpKTsNCg0KICAgIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Q29uZmlnKiBhbnN3ZXI7DQoNCiAgICANCg0KICAgIA0KICAgIGlmKGFuc3dlciE9bnVsbHB0cil7DQogICAgDQoNCiAgICANCiAgICAgICAgDQogICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXItPl90b0RvY3VtZW50KCkpOw0KICAgICAgICANCiAgICANCiAgICB9ZWxzZXsNCiAgICAgICAganNvbiBfalJldDsNCiAgICAgICAgX2pSZXRbIl9fdGhpcyJdID0gdGhpcy0+X3RvRG9jdW1lbnQoKTsNCiAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKF9qUmV0KTsNCiAgICAgICAgLy9fX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiB0aGlzLT5fdG9Eb2N1bWVudCgpfSk7DQogICAgfQ0KDQogICAgLy9fX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCg0KICAgIHJldHVybiAqYW5zd2VyOw0KfQ0KICAgIA0Kc3RkOjp2ZWN0b3I8ZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpDb25maWc+JiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkNvbmZpZzo6ZmluZEFsbCgpew0KICAgIHN0ZDo6c3RyaW5nIF9fdG9TdHJpbmcgPSAiQ29uZmlnOjpmaW5kQWxsKCk6ICI7DQogICAgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpFdmVudCBfX3Jlc3BvbnNlID0gKG5ldyBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkV2ZW50KCkpLT5jb2RlKCJbIit0aGlzTm9kZS5jb2RlKCkrIkB0aW1lIisiXS5Db25maWcuZmluZEFsbCgpIikubWV0aG9kKCJmaW5kQWxsIikuY2xhc3NOYW1lKCJDb25maWciKS5jYXJyaWVyKHRoaXNOb2RlKS5zZW5kZXIodGhpc05vZGUpLnJlY2lwaWVudCh0aGlzTm9kZS5wYXJlbnQoKSk7DQoNCiAgICBzdGQ6OnZlY3Rvcjxlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkNvbmZpZz4qIGFuc3dlcjsNCg0KICAgIA0KDQogICAgDQogICAgaWYoYW5zd2VyLT5lbXB0eSgpKXsNCiAgICANCg0KICAgIA0KICAgICAgICANCiAgICAgICAgLy9fX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLT5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgDQogICAgDQogICAgfWVsc2V7DQogICAgICAgIGpzb24gX2pSZXQ7DQogICAgICAgIF9qUmV0WyJfX3RoaXMiXSA9IHRoaXMtPl90b0RvY3VtZW50KCk7DQogICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChfalJldCk7DQogICAgICAgIC8vX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogdGhpcy0+X3RvRG9jdW1lbnQoKX0pOw0KICAgIH0NCg0KICAgIC8vX19yZXNwb25zZS50cmlnZ2VyKCk7DQoNCiAgICByZXR1cm4gKmFuc3dlcjsNCn0NCiAgICANCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Q29uZmlnJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkNvbmZpZzo6ZmluZCgpew0KICAgIHN0ZDo6c3RyaW5nIF9fdG9TdHJpbmcgPSAiQ29uZmlnOjpmaW5kKCk6ICI7DQogICAgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpFdmVudCBfX3Jlc3BvbnNlID0gKG5ldyBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkV2ZW50KCkpLT5jb2RlKCJbIit0aGlzTm9kZS5jb2RlKCkrIkB0aW1lIisiXS5Db25maWcuZmluZCgpIikubWV0aG9kKCJmaW5kIikuY2xhc3NOYW1lKCJDb25maWciKS5jYXJyaWVyKHRoaXNOb2RlKS5zZW5kZXIodGhpc05vZGUpLnJlY2lwaWVudCh0aGlzTm9kZS5wYXJlbnQoKSk7DQoNCiAgICBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkNvbmZpZyogYW5zd2VyOw0KDQogICAgDQoNCiAgICANCiAgICBpZihhbnN3ZXIhPW51bGxwdHIpew0KICAgIA0KDQogICAgDQogICAgICAgIA0KICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLT5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgDQogICAgDQogICAgfWVsc2V7DQogICAgICAgIGpzb24gX2pSZXQ7DQogICAgICAgIF9qUmV0WyJfX3RoaXMiXSA9IHRoaXMtPl90b0RvY3VtZW50KCk7DQogICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChfalJldCk7DQogICAgICAgIC8vX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogdGhpcy0+X3RvRG9jdW1lbnQoKX0pOw0KICAgIH0NCg0KICAgIC8vX19yZXNwb25zZS50cmlnZ2VyKCk7DQoNCiAgICByZXR1cm4gKmFuc3dlcjsNCn0NCiAgICANCg0KICAgIA0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OlRvb2wmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6VG9vbDo6YWN0aXZlKGJvb2wgdil7DQogICAgdGhpcy0+X2FjdGl2ZSA9IHY7DQogICAgcmV0dXJuICp0aGlzOw0KfQ0KICAgIA0KDQpib29sIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6VG9vbDo6YWN0aXZlKCl7DQogICAgcmV0dXJuIHRoaXMtPl9hY3RpdmU7DQp9DQogICAgDQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6VG9vbCYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpUb29sOjplbmFibGVkKGJvb2wgdil7DQogICAgdGhpcy0+X2VuYWJsZWQgPSB2Ow0KICAgIHJldHVybiAqdGhpczsNCn0NCiAgICANCg0KYm9vbCBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OlRvb2w6OmVuYWJsZWQoKXsNCiAgICByZXR1cm4gdGhpcy0+X2VuYWJsZWQ7DQp9DQogICAgDQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6VG9vbCYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpUb29sOjpjb2RlKHN0ZDo6c3RyaW5nIHYpew0KICAgIHRoaXMtPl9jb2RlID0gdjsNCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQoNCnN0ZDo6c3RyaW5nIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6VG9vbDo6Y29kZSgpew0KICAgIHJldHVybiB0aGlzLT5fY29kZTsNCn0NCiAgICANCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpUb29sJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OlRvb2w6Om9yZGVyKGludCB2KXsNCiAgICB0aGlzLT5fb3JkZXIgPSB2Ow0KICAgIHJldHVybiAqdGhpczsNCn0NCiAgICANCg0KaW50IGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6VG9vbDo6b3JkZXIoKXsNCiAgICByZXR1cm4gdGhpcy0+X29yZGVyOw0KfQ0KICAgIA0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OlRvb2wmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6VG9vbDo6ZGF0ZSh0aW1lX3Qgdil7DQogICAgdGhpcy0+X2RhdGUgPSB2Ow0KICAgIHJldHVybiAqdGhpczsNCn0NCiAgICANCg0KdGltZV90IGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6VG9vbDo6ZGF0ZSgpew0KICAgIHJldHVybiB0aGlzLT5fZGF0ZTsNCn0NCiAgICANCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpUb29sJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OlRvb2w6Om5hbWUoc3RkOjpzdHJpbmcgdil7DQogICAgdGhpcy0+X25hbWUgPSB2Ow0KICAgIHJldHVybiAqdGhpczsNCn0NCiAgICANCg0Kc3RkOjpzdHJpbmcgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpUb29sOjpuYW1lKCl7DQogICAgcmV0dXJuIHRoaXMtPl9uYW1lOw0KfQ0KICAgIA0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OlRvb2wmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6VG9vbDo6cmVtYXJrKHN0ZDo6c3RyaW5nIHYpew0KICAgIHRoaXMtPl9yZW1hcmsgPSB2Ow0KICAgIHJldHVybiAqdGhpczsNCn0NCiAgICANCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6VG9vbCYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpUb29sOjpyZW1hcmsoanNvbiB2KXsNCiAgICAvL3RoaXMtPl9yZW1hcmsNCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQoNCnN0ZDo6c3RyaW5nIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6VG9vbDo6cmVtYXJrKCl7DQogICAgcmV0dXJuIHRoaXMtPl9yZW1hcms7DQp9DQogICAgDQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6VG9vbCYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpUb29sOjp0eXBlKGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6VG9vbF9UeXBlJiB2KXsNCiAgICB0aGlzLT5fdHlwZSA9ICZ2Ow0KICAgIHJldHVybiAqdGhpczsNCn0NCiAgICANCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6VG9vbCYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpUb29sOjp0eXBlKGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6VG9vbF9UeXBlKiB2KXsNCiAgICBpZih2IT1udWxscHRyKXsNCiAgICAgICAgdGhpcy0+X3R5cGUgPSB2Ow0KICAgIH0NCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6VG9vbF9UeXBlKiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OlRvb2w6OnR5cGUoKXsNCiAgICByZXR1cm4gdGhpcy0+X3R5cGU7DQp9DQogICAgDQoNCiAgICANCnN0ZDo6dmVjdG9yPHN0ZDo6YW55PiYmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6VG9vbDo6dG9vbF9Db25maWdzKCl7DQogICAgcmV0dXJuIG1vdmUoKih0aGlzLT5fdG9vbF9Db25maWdzKSk7DQp9DQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6VG9vbCYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpUb29sOjp0b29sX0NvbmZpZ3Moc3RkOjp2ZWN0b3I8c3RkOjphbnk+JiYgdil7DQogICAgcmV0dXJuICp0aGlzOw0KfQ0KICAgIA0Kc3RkOjp2ZWN0b3I8c3RkOjphbnk+JiYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpUb29sOjp0b29sX01hcHBpbmdzKCl7DQogICAgcmV0dXJuIG1vdmUoKih0aGlzLT5fdG9vbF9NYXBwaW5ncykpOw0KfQ0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OlRvb2wmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6VG9vbDo6dG9vbF9NYXBwaW5ncyhzdGQ6OnZlY3RvcjxzdGQ6OmFueT4mJiB2KXsNCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQoNCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpUb29sJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OlRvb2w6Ol91bmlxdWUoKXsNCiAgICBzdGQ6OnN0cmluZyBfX3RvU3RyaW5nID0gIlRvb2w6Ol91bmlxdWUoKTogIjsNCg0KICAgIFRvb2wqIHJldCA9IG5ldyBUb29sKCk7DQogICAgaWYodGhpcy0+SWQhPTApIHJldC0+SWQgPSB0aGlzLT5JZDsNCiAgICANCiAgICAgICAgDQogICAgaWYodGhpcy0+bmFtZSgpLmVtcHR5KCkpDQogICAgICAgIA0KICAgICAgICByZXQtPm5hbWUodGhpcy0+bmFtZSgpKTsNCiAgICANCg0KICAgIHJldHVybiAqdGhpczsNCn0NCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpUb29sJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OlRvb2w6Ol9mcm9tRG9jdW1lbnQodW5zaWduZWQgY2hhciogb2JqKXsNCiAgICByZXR1cm4gdGhpcy0+X2Zyb21Eb2N1bWVudChzdGQ6OnN0cmluZyggb2JqLCBvYmogKyBzaXplb2Ygb2JqIC8gc2l6ZW9mIG9ialswXSApKTsNCn0NCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpUb29sJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OlRvb2w6Ol9mcm9tRG9jdW1lbnQoc3RkOjpzdHJpbmcgb2JqKXsNCiAgICBpZihvYmouZW1wdHkoKSkgcmV0dXJuICp0aGlzOw0KDQogICAgaWYgKHN0ZDo6cmVnZXhfbWF0Y2gob2JqLCBzdGQ6OnJlZ2V4KFIiIigoKFtBLVphLXpdezMsOX06KD86Ly8pPykoPzpbLTs6Jj0rJCx3XStAKT9bQS1aYS16MC05Li1dK3woPzp3d3cufFstOzomPSskLHddK0ApW0EtWmEtejAtOS4tXSspKCg/Oi9bK34lLy53LV9dKik/Pz8oPzpbLSs9JjslQC53X10qKSM/KD86W3ddKikpPykiIikpKXsNCiAgICAgICAgc3RkOjpzdHJpbmcgcmVhZEJ1ZmZlcjsNCiAgICAgICAgQ1VSTCAqY3VybCA9IGN1cmxfZWFzeV9pbml0KCk7DQogICAgICAgIGN1cmxfZWFzeV9zZXRvcHQoY3VybCwgQ1VSTE9QVF9VUkwsIG9iaik7DQogICAgICAgIGN1cmxfZWFzeV9zZXRvcHQoY3VybCwgQ1VSTE9QVF9GT0xMT1dMT0NBVElPTiwgMUwpOw0KICAgICAgICAvL2N1cmxfZWFzeV9zZXRvcHQoY3VybCwgQ1VSTE9QVF9XUklURUZVTkNUSU9OLCArW10odm9pZCAqcHRyLCBzaXplX3Qgc2l6ZSwgc2l6ZV90IG5tZW1iLCB2b2lkICpzdHJlYW0pIC0+IHNpemVfdCB7IHJlYWRCdWZmZXIuYXBwZW5kKCpwdHIsIHNpemUgKiBubWVtYik7IH0pOw0KICAgICAgICBjdXJsX2Vhc3lfc2V0b3B0KGN1cmwsIENVUkxPUFRfV1JJVEVEQVRBLCAmcmVhZEJ1ZmZlcik7DQogICAgICAgIGN1cmxfZWFzeV9wZXJmb3JtKGN1cmwpOw0KICAgICAgICBjdXJsX2Vhc3lfY2xlYW51cChjdXJsKTsNCiAgICAgICAgcmV0dXJuIHRoaXMtPl9mcm9tRG9jdW1lbnQocmVhZEJ1ZmZlcik7DQogICAgfQ0KDQogICAgcmV0dXJuIHRoaXMtPl9mcm9tRG9jdW1lbnQoanNvbjo6cGFyc2Uob2JqKSk7DQp9DQoNCnN0ZDo6dmVjdG9yPGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6VG9vbD4mJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OlRvb2w6Ol9mcm9tRG9jdW1lbnQoc3RkOjp2ZWN0b3I8anNvbj4mJiBvYmopew0KICAgIHN0ZDo6dmVjdG9yPFRvb2w+KiByZXQgPSBuZXcgc3RkOjp2ZWN0b3I8VG9vbD4ob2JqLnNpemUoKSk7DQogICAgDQogICAgZm9yIChjb25zdCBqc29uJiBqIDogb2JqKXsNCiAgICAgICAgcmV0LT5wdXNoX2JhY2soKG5ldyBUb29sKCkpLT5fZnJvbURvY3VtZW50KGopKTsNCiAgICB9DQogICAgDQogICAgcmV0dXJuIG1vdmUoKnJldCk7DQp9DQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6VG9vbCYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpUb29sOjpfZnJvbURvY3VtZW50KGpzb24gb2JqKXsNCiAgICANCiAgICBpZihvYmouY29udGFpbnMoImFjdGl2ZSIpKSB0aGlzLT5hY3RpdmUoDQogICAgICAgIA0KICAgICAgICBvYmpbImFjdGl2ZSJdLnRlbXBsYXRlIGdldDxib29sPigpDQogICAgICAgIA0KICAgICAgICApOw0KICAgIA0KICAgIGlmKG9iai5jb250YWlucygiZW5hYmxlZCIpKSB0aGlzLT5lbmFibGVkKA0KICAgICAgICANCiAgICAgICAgb2JqWyJlbmFibGVkIl0udGVtcGxhdGUgZ2V0PGJvb2w+KCkNCiAgICAgICAgDQogICAgICAgICk7DQogICAgDQogICAgaWYob2JqLmNvbnRhaW5zKCJjb2RlIikpIHRoaXMtPmNvZGUoDQogICAgICAgIA0KICAgICAgICBvYmpbImNvZGUiXS50ZW1wbGF0ZSBnZXQ8c3RkOjpzdHJpbmc+KCkNCiAgICAgICAgDQogICAgICAgICk7DQogICAgDQogICAgaWYob2JqLmNvbnRhaW5zKCJvcmRlciIpKSB0aGlzLT5vcmRlcigNCiAgICAgICAgDQogICAgICAgIG9ialsib3JkZXIiXS50ZW1wbGF0ZSBnZXQ8aW50PigpDQogICAgICAgIA0KICAgICAgICApOw0KICAgIA0KICAgIGlmKG9iai5jb250YWlucygiZGF0ZSIpKSB0aGlzLT5kYXRlKA0KICAgICAgICANCiAgICAgICAgb2JqWyJkYXRlIl0udGVtcGxhdGUgZ2V0PHRpbWVfdD4oKQ0KICAgICAgICANCiAgICAgICAgKTsNCiAgICANCiAgICBpZihvYmouY29udGFpbnMoIm5hbWUiKSkgdGhpcy0+bmFtZSgNCiAgICAgICAgDQogICAgICAgIG9ialsibmFtZSJdLnRlbXBsYXRlIGdldDxzdGQ6OnN0cmluZz4oKQ0KICAgICAgICANCiAgICAgICAgKTsNCiAgICANCiAgICBpZihvYmouY29udGFpbnMoInJlbWFyayIpKSB0aGlzLT5yZW1hcmsoDQogICAgICAgIA0KICAgICAgICBvYmpbInJlbWFyayJdLnRlbXBsYXRlIGdldDxzdGQ6OnN0cmluZz4oKQ0KICAgICAgICANCiAgICAgICAgKTsNCiAgICANCiAgICBpZihvYmouY29udGFpbnMoInR5cGUiKSkgdGhpcy0+dHlwZSgNCiAgICAgICAgDQogICAgICAgIChuZXcgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpUb29sX1R5cGUoKSktPl9mcm9tRG9jdW1lbnQob2JqWyJ0eXBlIl0pDQogICAgICAgIA0KICAgICAgICApOw0KICAgIA0KICAgIA0KICAgIA0KICAgIGlmKG9iai5jb250YWlucygidG9vbF9Db25maWdzIikpIHRoaXMtPnRvb2xfQ29uZmlncygobmV3IENvbmZpZygpKS0+X2Zyb21Eb2N1bWVudCgoc3RkOjp2ZWN0b3I8anNvbj4pb2JqWyJ0b29sX0NvbmZpZ3MiXSkpOw0KICAgIA0KICAgIGlmKG9iai5jb250YWlucygidG9vbF9NYXBwaW5ncyIpKSB0aGlzLT50b29sX01hcHBpbmdzKChuZXcgTWFwcGluZygpKS0+X2Zyb21Eb2N1bWVudCgoc3RkOjp2ZWN0b3I8anNvbj4pb2JqWyJ0b29sX01hcHBpbmdzIl0pKTsNCiAgICANCiAgICByZXR1cm4gKnRoaXM7DQp9DQoNCnN0ZDo6c3RyaW5nIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6VG9vbDo6X3RvRG9jdW1lbnQoKXsNCiAgICByZXR1cm4gIiI7DQp9DQoNCiAgICANCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6VG9vbCYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpUb29sOjpzdG9yZSgpew0KICAgIHN0ZDo6c3RyaW5nIF9fdG9TdHJpbmcgPSAiVG9vbDo6c3RvcmUoKTogIjsNCiAgICBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkV2ZW50IF9fcmVzcG9uc2UgPSAobmV3IGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6RXZlbnQoKSktPmNvZGUoIlsiK3RoaXNOb2RlLmNvZGUoKSsiQHRpbWUiKyJdLlRvb2wuc3RvcmUoKSIpLm1ldGhvZCgic3RvcmUiKS5jbGFzc05hbWUoIlRvb2wiKS5jYXJyaWVyKHRoaXNOb2RlKS5zZW5kZXIodGhpc05vZGUpLnJlY2lwaWVudCh0aGlzTm9kZS5wYXJlbnQoKSk7DQoNCiAgICBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OlRvb2wqIGFuc3dlcjsNCg0KICAgIA0KDQogICAgDQogICAgaWYoYW5zd2VyIT1udWxscHRyKXsNCiAgICANCg0KICAgIA0KICAgICAgICANCiAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci0+X3RvRG9jdW1lbnQoKSk7DQogICAgICAgIA0KICAgIA0KICAgIH1lbHNlew0KICAgICAgICBqc29uIF9qUmV0Ow0KICAgICAgICBfalJldFsiX190aGlzIl0gPSB0aGlzLT5fdG9Eb2N1bWVudCgpOw0KICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoX2pSZXQpOw0KICAgICAgICAvL19fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHRoaXMtPl90b0RvY3VtZW50KCl9KTsNCiAgICB9DQoNCiAgICAvL19fcmVzcG9uc2UudHJpZ2dlcigpOw0KDQogICAgcmV0dXJuICphbnN3ZXI7DQp9DQogICAgDQpzdGQ6OnZlY3Rvcjxlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OlRvb2w+JiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OlRvb2w6OmZpbmRBbGwoKXsNCiAgICBzdGQ6OnN0cmluZyBfX3RvU3RyaW5nID0gIlRvb2w6OmZpbmRBbGwoKTogIjsNCiAgICBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkV2ZW50IF9fcmVzcG9uc2UgPSAobmV3IGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6RXZlbnQoKSktPmNvZGUoIlsiK3RoaXNOb2RlLmNvZGUoKSsiQHRpbWUiKyJdLlRvb2wuZmluZEFsbCgpIikubWV0aG9kKCJmaW5kQWxsIikuY2xhc3NOYW1lKCJUb29sIikuY2Fycmllcih0aGlzTm9kZSkuc2VuZGVyKHRoaXNOb2RlKS5yZWNpcGllbnQodGhpc05vZGUucGFyZW50KCkpOw0KDQogICAgc3RkOjp2ZWN0b3I8ZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpUb29sPiogYW5zd2VyOw0KDQogICAgDQoNCiAgICANCiAgICBpZihhbnN3ZXItPmVtcHR5KCkpew0KICAgIA0KDQogICAgDQogICAgICAgIA0KICAgICAgICAvL19fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXItPl90b0RvY3VtZW50KCkpOw0KICAgICAgICANCiAgICANCiAgICB9ZWxzZXsNCiAgICAgICAganNvbiBfalJldDsNCiAgICAgICAgX2pSZXRbIl9fdGhpcyJdID0gdGhpcy0+X3RvRG9jdW1lbnQoKTsNCiAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKF9qUmV0KTsNCiAgICAgICAgLy9fX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiB0aGlzLT5fdG9Eb2N1bWVudCgpfSk7DQogICAgfQ0KDQogICAgLy9fX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCg0KICAgIHJldHVybiAqYW5zd2VyOw0KfQ0KICAgIA0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpUb29sJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OlRvb2w6OmZpbmQoKXsNCiAgICBzdGQ6OnN0cmluZyBfX3RvU3RyaW5nID0gIlRvb2w6OmZpbmQoKTogIjsNCiAgICBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkV2ZW50IF9fcmVzcG9uc2UgPSAobmV3IGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6RXZlbnQoKSktPmNvZGUoIlsiK3RoaXNOb2RlLmNvZGUoKSsiQHRpbWUiKyJdLlRvb2wuZmluZCgpIikubWV0aG9kKCJmaW5kIikuY2xhc3NOYW1lKCJUb29sIikuY2Fycmllcih0aGlzTm9kZSkuc2VuZGVyKHRoaXNOb2RlKS5yZWNpcGllbnQodGhpc05vZGUucGFyZW50KCkpOw0KDQogICAgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpUb29sKiBhbnN3ZXI7DQoNCiAgICANCg0KICAgIA0KICAgIGlmKGFuc3dlciE9bnVsbHB0cil7DQogICAgDQoNCiAgICANCiAgICAgICAgDQogICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXItPl90b0RvY3VtZW50KCkpOw0KICAgICAgICANCiAgICANCiAgICB9ZWxzZXsNCiAgICAgICAganNvbiBfalJldDsNCiAgICAgICAgX2pSZXRbIl9fdGhpcyJdID0gdGhpcy0+X3RvRG9jdW1lbnQoKTsNCiAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKF9qUmV0KTsNCiAgICAgICAgLy9fX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiB0aGlzLT5fdG9Eb2N1bWVudCgpfSk7DQogICAgfQ0KDQogICAgLy9fX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCg0KICAgIHJldHVybiAqYW5zd2VyOw0KfQ0KICAgIA0KDQogICAgDQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Q29uZmlnX0dyb3VwJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkNvbmZpZ19Hcm91cDo6YWN0aXZlKGJvb2wgdil7DQogICAgdGhpcy0+X2FjdGl2ZSA9IHY7DQogICAgcmV0dXJuICp0aGlzOw0KfQ0KICAgIA0KDQpib29sIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Q29uZmlnX0dyb3VwOjphY3RpdmUoKXsNCiAgICByZXR1cm4gdGhpcy0+X2FjdGl2ZTsNCn0NCiAgICANCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpDb25maWdfR3JvdXAmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Q29uZmlnX0dyb3VwOjplbmFibGVkKGJvb2wgdil7DQogICAgdGhpcy0+X2VuYWJsZWQgPSB2Ow0KICAgIHJldHVybiAqdGhpczsNCn0NCiAgICANCg0KYm9vbCBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkNvbmZpZ19Hcm91cDo6ZW5hYmxlZCgpew0KICAgIHJldHVybiB0aGlzLT5fZW5hYmxlZDsNCn0NCiAgICANCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpDb25maWdfR3JvdXAmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Q29uZmlnX0dyb3VwOjpjb2RlKHN0ZDo6c3RyaW5nIHYpew0KICAgIHRoaXMtPl9jb2RlID0gdjsNCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQoNCnN0ZDo6c3RyaW5nIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Q29uZmlnX0dyb3VwOjpjb2RlKCl7DQogICAgcmV0dXJuIHRoaXMtPl9jb2RlOw0KfQ0KICAgIA0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkNvbmZpZ19Hcm91cCYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpDb25maWdfR3JvdXA6Om9yZGVyKGludCB2KXsNCiAgICB0aGlzLT5fb3JkZXIgPSB2Ow0KICAgIHJldHVybiAqdGhpczsNCn0NCiAgICANCg0KaW50IGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Q29uZmlnX0dyb3VwOjpvcmRlcigpew0KICAgIHJldHVybiB0aGlzLT5fb3JkZXI7DQp9DQogICAgDQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Q29uZmlnX0dyb3VwJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkNvbmZpZ19Hcm91cDo6ZGF0ZSh0aW1lX3Qgdil7DQogICAgdGhpcy0+X2RhdGUgPSB2Ow0KICAgIHJldHVybiAqdGhpczsNCn0NCiAgICANCg0KdGltZV90IGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Q29uZmlnX0dyb3VwOjpkYXRlKCl7DQogICAgcmV0dXJuIHRoaXMtPl9kYXRlOw0KfQ0KICAgIA0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkNvbmZpZ19Hcm91cCYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpDb25maWdfR3JvdXA6Om5hbWUoc3RkOjpzdHJpbmcgdil7DQogICAgdGhpcy0+X25hbWUgPSB2Ow0KICAgIHJldHVybiAqdGhpczsNCn0NCiAgICANCg0Kc3RkOjpzdHJpbmcgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpDb25maWdfR3JvdXA6Om5hbWUoKXsNCiAgICByZXR1cm4gdGhpcy0+X25hbWU7DQp9DQogICAgDQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Q29uZmlnX0dyb3VwJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkNvbmZpZ19Hcm91cDo6cmVtYXJrKHN0ZDo6c3RyaW5nIHYpew0KICAgIHRoaXMtPl9yZW1hcmsgPSB2Ow0KICAgIHJldHVybiAqdGhpczsNCn0NCiAgICANCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Q29uZmlnX0dyb3VwJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkNvbmZpZ19Hcm91cDo6cmVtYXJrKGpzb24gdil7DQogICAgLy90aGlzLT5fcmVtYXJrDQogICAgcmV0dXJuICp0aGlzOw0KfQ0KICAgIA0KDQpzdGQ6OnN0cmluZyBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkNvbmZpZ19Hcm91cDo6cmVtYXJrKCl7DQogICAgcmV0dXJuIHRoaXMtPl9yZW1hcms7DQp9DQogICAgDQoNCiAgICANCnN0ZDo6dmVjdG9yPHN0ZDo6YW55PiYmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Q29uZmlnX0dyb3VwOjpncm91cF9Db25maWdzKCl7DQogICAgcmV0dXJuIG1vdmUoKih0aGlzLT5fZ3JvdXBfQ29uZmlncykpOw0KfQ0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkNvbmZpZ19Hcm91cCYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpDb25maWdfR3JvdXA6Omdyb3VwX0NvbmZpZ3Moc3RkOjp2ZWN0b3I8c3RkOjphbnk+JiYgdil7DQogICAgcmV0dXJuICp0aGlzOw0KfQ0KICAgIA0Kc3RkOjp2ZWN0b3I8c3RkOjphbnk+JiYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpDb25maWdfR3JvdXA6Omdyb3VwX01hcHBpbmdzKCl7DQogICAgcmV0dXJuIG1vdmUoKih0aGlzLT5fZ3JvdXBfTWFwcGluZ3MpKTsNCn0NCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpDb25maWdfR3JvdXAmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Q29uZmlnX0dyb3VwOjpncm91cF9NYXBwaW5ncyhzdGQ6OnZlY3RvcjxzdGQ6OmFueT4mJiB2KXsNCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQoNCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpDb25maWdfR3JvdXAmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Q29uZmlnX0dyb3VwOjpfdW5pcXVlKCl7DQogICAgc3RkOjpzdHJpbmcgX190b1N0cmluZyA9ICJDb25maWdfR3JvdXA6Ol91bmlxdWUoKTogIjsNCg0KICAgIENvbmZpZ19Hcm91cCogcmV0ID0gbmV3IENvbmZpZ19Hcm91cCgpOw0KICAgIGlmKHRoaXMtPklkIT0wKSByZXQtPklkID0gdGhpcy0+SWQ7DQogICAgDQogICAgICAgIA0KICAgIGlmKHRoaXMtPmNvZGUoKS5lbXB0eSgpKQ0KICAgICAgICANCiAgICAgICAgcmV0LT5jb2RlKHRoaXMtPmNvZGUoKSk7DQogICAgDQoNCiAgICByZXR1cm4gKnRoaXM7DQp9DQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Q29uZmlnX0dyb3VwJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkNvbmZpZ19Hcm91cDo6X2Zyb21Eb2N1bWVudCh1bnNpZ25lZCBjaGFyKiBvYmopew0KICAgIHJldHVybiB0aGlzLT5fZnJvbURvY3VtZW50KHN0ZDo6c3RyaW5nKCBvYmosIG9iaiArIHNpemVvZiBvYmogLyBzaXplb2Ygb2JqWzBdICkpOw0KfQ0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkNvbmZpZ19Hcm91cCYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpDb25maWdfR3JvdXA6Ol9mcm9tRG9jdW1lbnQoc3RkOjpzdHJpbmcgb2JqKXsNCiAgICBpZihvYmouZW1wdHkoKSkgcmV0dXJuICp0aGlzOw0KDQogICAgaWYgKHN0ZDo6cmVnZXhfbWF0Y2gob2JqLCBzdGQ6OnJlZ2V4KFIiIigoKFtBLVphLXpdezMsOX06KD86Ly8pPykoPzpbLTs6Jj0rJCx3XStAKT9bQS1aYS16MC05Li1dK3woPzp3d3cufFstOzomPSskLHddK0ApW0EtWmEtejAtOS4tXSspKCg/Oi9bK34lLy53LV9dKik/Pz8oPzpbLSs9JjslQC53X10qKSM/KD86W3ddKikpPykiIikpKXsNCiAgICAgICAgc3RkOjpzdHJpbmcgcmVhZEJ1ZmZlcjsNCiAgICAgICAgQ1VSTCAqY3VybCA9IGN1cmxfZWFzeV9pbml0KCk7DQogICAgICAgIGN1cmxfZWFzeV9zZXRvcHQoY3VybCwgQ1VSTE9QVF9VUkwsIG9iaik7DQogICAgICAgIGN1cmxfZWFzeV9zZXRvcHQoY3VybCwgQ1VSTE9QVF9GT0xMT1dMT0NBVElPTiwgMUwpOw0KICAgICAgICAvL2N1cmxfZWFzeV9zZXRvcHQoY3VybCwgQ1VSTE9QVF9XUklURUZVTkNUSU9OLCArW10odm9pZCAqcHRyLCBzaXplX3Qgc2l6ZSwgc2l6ZV90IG5tZW1iLCB2b2lkICpzdHJlYW0pIC0+IHNpemVfdCB7IHJlYWRCdWZmZXIuYXBwZW5kKCpwdHIsIHNpemUgKiBubWVtYik7IH0pOw0KICAgICAgICBjdXJsX2Vhc3lfc2V0b3B0KGN1cmwsIENVUkxPUFRfV1JJVEVEQVRBLCAmcmVhZEJ1ZmZlcik7DQogICAgICAgIGN1cmxfZWFzeV9wZXJmb3JtKGN1cmwpOw0KICAgICAgICBjdXJsX2Vhc3lfY2xlYW51cChjdXJsKTsNCiAgICAgICAgcmV0dXJuIHRoaXMtPl9mcm9tRG9jdW1lbnQocmVhZEJ1ZmZlcik7DQogICAgfQ0KDQogICAgcmV0dXJuIHRoaXMtPl9mcm9tRG9jdW1lbnQoanNvbjo6cGFyc2Uob2JqKSk7DQp9DQoNCnN0ZDo6dmVjdG9yPGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Q29uZmlnX0dyb3VwPiYmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Q29uZmlnX0dyb3VwOjpfZnJvbURvY3VtZW50KHN0ZDo6dmVjdG9yPGpzb24+JiYgb2JqKXsNCiAgICBzdGQ6OnZlY3RvcjxDb25maWdfR3JvdXA+KiByZXQgPSBuZXcgc3RkOjp2ZWN0b3I8Q29uZmlnX0dyb3VwPihvYmouc2l6ZSgpKTsNCiAgICANCiAgICBmb3IgKGNvbnN0IGpzb24mIGogOiBvYmopew0KICAgICAgICByZXQtPnB1c2hfYmFjaygobmV3IENvbmZpZ19Hcm91cCgpKS0+X2Zyb21Eb2N1bWVudChqKSk7DQogICAgfQ0KICAgIA0KICAgIHJldHVybiBtb3ZlKCpyZXQpOw0KfQ0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkNvbmZpZ19Hcm91cCYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpDb25maWdfR3JvdXA6Ol9mcm9tRG9jdW1lbnQoanNvbiBvYmopew0KICAgIA0KICAgIGlmKG9iai5jb250YWlucygiYWN0aXZlIikpIHRoaXMtPmFjdGl2ZSgNCiAgICAgICAgDQogICAgICAgIG9ialsiYWN0aXZlIl0udGVtcGxhdGUgZ2V0PGJvb2w+KCkNCiAgICAgICAgDQogICAgICAgICk7DQogICAgDQogICAgaWYob2JqLmNvbnRhaW5zKCJlbmFibGVkIikpIHRoaXMtPmVuYWJsZWQoDQogICAgICAgIA0KICAgICAgICBvYmpbImVuYWJsZWQiXS50ZW1wbGF0ZSBnZXQ8Ym9vbD4oKQ0KICAgICAgICANCiAgICAgICAgKTsNCiAgICANCiAgICBpZihvYmouY29udGFpbnMoImNvZGUiKSkgdGhpcy0+Y29kZSgNCiAgICAgICAgDQogICAgICAgIG9ialsiY29kZSJdLnRlbXBsYXRlIGdldDxzdGQ6OnN0cmluZz4oKQ0KICAgICAgICANCiAgICAgICAgKTsNCiAgICANCiAgICBpZihvYmouY29udGFpbnMoIm9yZGVyIikpIHRoaXMtPm9yZGVyKA0KICAgICAgICANCiAgICAgICAgb2JqWyJvcmRlciJdLnRlbXBsYXRlIGdldDxpbnQ+KCkNCiAgICAgICAgDQogICAgICAgICk7DQogICAgDQogICAgaWYob2JqLmNvbnRhaW5zKCJkYXRlIikpIHRoaXMtPmRhdGUoDQogICAgICAgIA0KICAgICAgICBvYmpbImRhdGUiXS50ZW1wbGF0ZSBnZXQ8dGltZV90PigpDQogICAgICAgIA0KICAgICAgICApOw0KICAgIA0KICAgIGlmKG9iai5jb250YWlucygibmFtZSIpKSB0aGlzLT5uYW1lKA0KICAgICAgICANCiAgICAgICAgb2JqWyJuYW1lIl0udGVtcGxhdGUgZ2V0PHN0ZDo6c3RyaW5nPigpDQogICAgICAgIA0KICAgICAgICApOw0KICAgIA0KICAgIGlmKG9iai5jb250YWlucygicmVtYXJrIikpIHRoaXMtPnJlbWFyaygNCiAgICAgICAgDQogICAgICAgIG9ialsicmVtYXJrIl0udGVtcGxhdGUgZ2V0PHN0ZDo6c3RyaW5nPigpDQogICAgICAgIA0KICAgICAgICApOw0KICAgIA0KICAgIA0KICAgIA0KICAgIGlmKG9iai5jb250YWlucygiZ3JvdXBfQ29uZmlncyIpKSB0aGlzLT5ncm91cF9Db25maWdzKChuZXcgQ29uZmlnKCkpLT5fZnJvbURvY3VtZW50KChzdGQ6OnZlY3Rvcjxqc29uPilvYmpbImdyb3VwX0NvbmZpZ3MiXSkpOw0KICAgIA0KICAgIGlmKG9iai5jb250YWlucygiZ3JvdXBfTWFwcGluZ3MiKSkgdGhpcy0+Z3JvdXBfTWFwcGluZ3MoKG5ldyBNYXBwaW5nKCkpLT5fZnJvbURvY3VtZW50KChzdGQ6OnZlY3Rvcjxqc29uPilvYmpbImdyb3VwX01hcHBpbmdzIl0pKTsNCiAgICANCiAgICByZXR1cm4gKnRoaXM7DQp9DQoNCnN0ZDo6c3RyaW5nIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Q29uZmlnX0dyb3VwOjpfdG9Eb2N1bWVudCgpew0KICAgIHJldHVybiAiIjsNCn0NCg0KICAgIA0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpDb25maWdfR3JvdXAmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Q29uZmlnX0dyb3VwOjpzdG9yZSgpew0KICAgIHN0ZDo6c3RyaW5nIF9fdG9TdHJpbmcgPSAiQ29uZmlnX0dyb3VwOjpzdG9yZSgpOiAiOw0KICAgIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6RXZlbnQgX19yZXNwb25zZSA9IChuZXcgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpFdmVudCgpKS0+Y29kZSgiWyIrdGhpc05vZGUuY29kZSgpKyJAdGltZSIrIl0uQ29uZmlnX0dyb3VwLnN0b3JlKCkiKS5tZXRob2QoInN0b3JlIikuY2xhc3NOYW1lKCJDb25maWdfR3JvdXAiKS5jYXJyaWVyKHRoaXNOb2RlKS5zZW5kZXIodGhpc05vZGUpLnJlY2lwaWVudCh0aGlzTm9kZS5wYXJlbnQoKSk7DQoNCiAgICBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkNvbmZpZ19Hcm91cCogYW5zd2VyOw0KDQogICAgDQoNCiAgICANCiAgICBpZihhbnN3ZXIhPW51bGxwdHIpew0KICAgIA0KDQogICAgDQogICAgICAgIA0KICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLT5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgDQogICAgDQogICAgfWVsc2V7DQogICAgICAgIGpzb24gX2pSZXQ7DQogICAgICAgIF9qUmV0WyJfX3RoaXMiXSA9IHRoaXMtPl90b0RvY3VtZW50KCk7DQogICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChfalJldCk7DQogICAgICAgIC8vX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogdGhpcy0+X3RvRG9jdW1lbnQoKX0pOw0KICAgIH0NCg0KICAgIC8vX19yZXNwb25zZS50cmlnZ2VyKCk7DQoNCiAgICByZXR1cm4gKmFuc3dlcjsNCn0NCiAgICANCnN0ZDo6dmVjdG9yPGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Q29uZmlnX0dyb3VwPiYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpDb25maWdfR3JvdXA6OmZpbmRBbGwoKXsNCiAgICBzdGQ6OnN0cmluZyBfX3RvU3RyaW5nID0gIkNvbmZpZ19Hcm91cDo6ZmluZEFsbCgpOiAiOw0KICAgIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6RXZlbnQgX19yZXNwb25zZSA9IChuZXcgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpFdmVudCgpKS0+Y29kZSgiWyIrdGhpc05vZGUuY29kZSgpKyJAdGltZSIrIl0uQ29uZmlnX0dyb3VwLmZpbmRBbGwoKSIpLm1ldGhvZCgiZmluZEFsbCIpLmNsYXNzTmFtZSgiQ29uZmlnX0dyb3VwIikuY2Fycmllcih0aGlzTm9kZSkuc2VuZGVyKHRoaXNOb2RlKS5yZWNpcGllbnQodGhpc05vZGUucGFyZW50KCkpOw0KDQogICAgc3RkOjp2ZWN0b3I8ZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpDb25maWdfR3JvdXA+KiBhbnN3ZXI7DQoNCiAgICANCg0KICAgIA0KICAgIGlmKGFuc3dlci0+ZW1wdHkoKSl7DQogICAgDQoNCiAgICANCiAgICAgICAgDQogICAgICAgIC8vX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci0+X3RvRG9jdW1lbnQoKSk7DQogICAgICAgIA0KICAgIA0KICAgIH1lbHNlew0KICAgICAgICBqc29uIF9qUmV0Ow0KICAgICAgICBfalJldFsiX190aGlzIl0gPSB0aGlzLT5fdG9Eb2N1bWVudCgpOw0KICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoX2pSZXQpOw0KICAgICAgICAvL19fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHRoaXMtPl90b0RvY3VtZW50KCl9KTsNCiAgICB9DQoNCiAgICAvL19fcmVzcG9uc2UudHJpZ2dlcigpOw0KDQogICAgcmV0dXJuICphbnN3ZXI7DQp9DQogICAgDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkNvbmZpZ19Hcm91cCYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpDb25maWdfR3JvdXA6OmZpbmQoKXsNCiAgICBzdGQ6OnN0cmluZyBfX3RvU3RyaW5nID0gIkNvbmZpZ19Hcm91cDo6ZmluZCgpOiAiOw0KICAgIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6RXZlbnQgX19yZXNwb25zZSA9IChuZXcgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpFdmVudCgpKS0+Y29kZSgiWyIrdGhpc05vZGUuY29kZSgpKyJAdGltZSIrIl0uQ29uZmlnX0dyb3VwLmZpbmQoKSIpLm1ldGhvZCgiZmluZCIpLmNsYXNzTmFtZSgiQ29uZmlnX0dyb3VwIikuY2Fycmllcih0aGlzTm9kZSkuc2VuZGVyKHRoaXNOb2RlKS5yZWNpcGllbnQodGhpc05vZGUucGFyZW50KCkpOw0KDQogICAgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpDb25maWdfR3JvdXAqIGFuc3dlcjsNCg0KICAgIA0KDQogICAgDQogICAgaWYoYW5zd2VyIT1udWxscHRyKXsNCiAgICANCg0KICAgIA0KICAgICAgICANCiAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci0+X3RvRG9jdW1lbnQoKSk7DQogICAgICAgIA0KICAgIA0KICAgIH1lbHNlew0KICAgICAgICBqc29uIF9qUmV0Ow0KICAgICAgICBfalJldFsiX190aGlzIl0gPSB0aGlzLT5fdG9Eb2N1bWVudCgpOw0KICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoX2pSZXQpOw0KICAgICAgICAvL19fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHRoaXMtPl90b0RvY3VtZW50KCl9KTsNCiAgICB9DQoNCiAgICAvL19fcmVzcG9uc2UudHJpZ2dlcigpOw0KDQogICAgcmV0dXJuICphbnN3ZXI7DQp9DQogICAgDQoNCiAgICANCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpNYXBwaW5nX0dyb3VwJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok1hcHBpbmdfR3JvdXA6OmFjdGl2ZShib29sIHYpew0KICAgIHRoaXMtPl9hY3RpdmUgPSB2Ow0KICAgIHJldHVybiAqdGhpczsNCn0NCiAgICANCg0KYm9vbCBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok1hcHBpbmdfR3JvdXA6OmFjdGl2ZSgpew0KICAgIHJldHVybiB0aGlzLT5fYWN0aXZlOw0KfQ0KICAgIA0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok1hcHBpbmdfR3JvdXAmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6TWFwcGluZ19Hcm91cDo6ZW5hYmxlZChib29sIHYpew0KICAgIHRoaXMtPl9lbmFibGVkID0gdjsNCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQoNCmJvb2wgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpNYXBwaW5nX0dyb3VwOjplbmFibGVkKCl7DQogICAgcmV0dXJuIHRoaXMtPl9lbmFibGVkOw0KfQ0KICAgIA0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok1hcHBpbmdfR3JvdXAmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6TWFwcGluZ19Hcm91cDo6Y29kZShzdGQ6OnN0cmluZyB2KXsNCiAgICB0aGlzLT5fY29kZSA9IHY7DQogICAgcmV0dXJuICp0aGlzOw0KfQ0KICAgIA0KDQpzdGQ6OnN0cmluZyBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok1hcHBpbmdfR3JvdXA6OmNvZGUoKXsNCiAgICByZXR1cm4gdGhpcy0+X2NvZGU7DQp9DQogICAgDQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6TWFwcGluZ19Hcm91cCYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpNYXBwaW5nX0dyb3VwOjpvcmRlcihpbnQgdil7DQogICAgdGhpcy0+X29yZGVyID0gdjsNCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQoNCmludCBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok1hcHBpbmdfR3JvdXA6Om9yZGVyKCl7DQogICAgcmV0dXJuIHRoaXMtPl9vcmRlcjsNCn0NCiAgICANCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpNYXBwaW5nX0dyb3VwJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok1hcHBpbmdfR3JvdXA6OmRhdGUodGltZV90IHYpew0KICAgIHRoaXMtPl9kYXRlID0gdjsNCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQoNCnRpbWVfdCBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok1hcHBpbmdfR3JvdXA6OmRhdGUoKXsNCiAgICByZXR1cm4gdGhpcy0+X2RhdGU7DQp9DQogICAgDQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6TWFwcGluZ19Hcm91cCYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpNYXBwaW5nX0dyb3VwOjpuYW1lKHN0ZDo6c3RyaW5nIHYpew0KICAgIHRoaXMtPl9uYW1lID0gdjsNCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQoNCnN0ZDo6c3RyaW5nIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6TWFwcGluZ19Hcm91cDo6bmFtZSgpew0KICAgIHJldHVybiB0aGlzLT5fbmFtZTsNCn0NCiAgICANCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpNYXBwaW5nX0dyb3VwJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok1hcHBpbmdfR3JvdXA6OnJlbWFyayhzdGQ6OnN0cmluZyB2KXsNCiAgICB0aGlzLT5fcmVtYXJrID0gdjsNCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok1hcHBpbmdfR3JvdXAmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6TWFwcGluZ19Hcm91cDo6cmVtYXJrKGpzb24gdil7DQogICAgLy90aGlzLT5fcmVtYXJrDQogICAgcmV0dXJuICp0aGlzOw0KfQ0KICAgIA0KDQpzdGQ6OnN0cmluZyBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok1hcHBpbmdfR3JvdXA6OnJlbWFyaygpew0KICAgIHJldHVybiB0aGlzLT5fcmVtYXJrOw0KfQ0KICAgIA0KDQogICAgDQoNCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpNYXBwaW5nX0dyb3VwJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok1hcHBpbmdfR3JvdXA6Ol91bmlxdWUoKXsNCiAgICBzdGQ6OnN0cmluZyBfX3RvU3RyaW5nID0gIk1hcHBpbmdfR3JvdXA6Ol91bmlxdWUoKTogIjsNCg0KICAgIE1hcHBpbmdfR3JvdXAqIHJldCA9IG5ldyBNYXBwaW5nX0dyb3VwKCk7DQogICAgaWYodGhpcy0+SWQhPTApIHJldC0+SWQgPSB0aGlzLT5JZDsNCiAgICANCiAgICAgICAgDQogICAgaWYodGhpcy0+Y29kZSgpLmVtcHR5KCkpDQogICAgICAgIA0KICAgICAgICByZXQtPmNvZGUodGhpcy0+Y29kZSgpKTsNCiAgICANCg0KICAgIHJldHVybiAqdGhpczsNCn0NCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpNYXBwaW5nX0dyb3VwJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok1hcHBpbmdfR3JvdXA6Ol9mcm9tRG9jdW1lbnQodW5zaWduZWQgY2hhciogb2JqKXsNCiAgICByZXR1cm4gdGhpcy0+X2Zyb21Eb2N1bWVudChzdGQ6OnN0cmluZyggb2JqLCBvYmogKyBzaXplb2Ygb2JqIC8gc2l6ZW9mIG9ialswXSApKTsNCn0NCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpNYXBwaW5nX0dyb3VwJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok1hcHBpbmdfR3JvdXA6Ol9mcm9tRG9jdW1lbnQoc3RkOjpzdHJpbmcgb2JqKXsNCiAgICBpZihvYmouZW1wdHkoKSkgcmV0dXJuICp0aGlzOw0KDQogICAgaWYgKHN0ZDo6cmVnZXhfbWF0Y2gob2JqLCBzdGQ6OnJlZ2V4KFIiIigoKFtBLVphLXpdezMsOX06KD86Ly8pPykoPzpbLTs6Jj0rJCx3XStAKT9bQS1aYS16MC05Li1dK3woPzp3d3cufFstOzomPSskLHddK0ApW0EtWmEtejAtOS4tXSspKCg/Oi9bK34lLy53LV9dKik/Pz8oPzpbLSs9JjslQC53X10qKSM/KD86W3ddKikpPykiIikpKXsNCiAgICAgICAgc3RkOjpzdHJpbmcgcmVhZEJ1ZmZlcjsNCiAgICAgICAgQ1VSTCAqY3VybCA9IGN1cmxfZWFzeV9pbml0KCk7DQogICAgICAgIGN1cmxfZWFzeV9zZXRvcHQoY3VybCwgQ1VSTE9QVF9VUkwsIG9iaik7DQogICAgICAgIGN1cmxfZWFzeV9zZXRvcHQoY3VybCwgQ1VSTE9QVF9GT0xMT1dMT0NBVElPTiwgMUwpOw0KICAgICAgICAvL2N1cmxfZWFzeV9zZXRvcHQoY3VybCwgQ1VSTE9QVF9XUklURUZVTkNUSU9OLCArW10odm9pZCAqcHRyLCBzaXplX3Qgc2l6ZSwgc2l6ZV90IG5tZW1iLCB2b2lkICpzdHJlYW0pIC0+IHNpemVfdCB7IHJlYWRCdWZmZXIuYXBwZW5kKCpwdHIsIHNpemUgKiBubWVtYik7IH0pOw0KICAgICAgICBjdXJsX2Vhc3lfc2V0b3B0KGN1cmwsIENVUkxPUFRfV1JJVEVEQVRBLCAmcmVhZEJ1ZmZlcik7DQogICAgICAgIGN1cmxfZWFzeV9wZXJmb3JtKGN1cmwpOw0KICAgICAgICBjdXJsX2Vhc3lfY2xlYW51cChjdXJsKTsNCiAgICAgICAgcmV0dXJuIHRoaXMtPl9mcm9tRG9jdW1lbnQocmVhZEJ1ZmZlcik7DQogICAgfQ0KDQogICAgcmV0dXJuIHRoaXMtPl9mcm9tRG9jdW1lbnQoanNvbjo6cGFyc2Uob2JqKSk7DQp9DQoNCnN0ZDo6dmVjdG9yPGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6TWFwcGluZ19Hcm91cD4mJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok1hcHBpbmdfR3JvdXA6Ol9mcm9tRG9jdW1lbnQoc3RkOjp2ZWN0b3I8anNvbj4mJiBvYmopew0KICAgIHN0ZDo6dmVjdG9yPE1hcHBpbmdfR3JvdXA+KiByZXQgPSBuZXcgc3RkOjp2ZWN0b3I8TWFwcGluZ19Hcm91cD4ob2JqLnNpemUoKSk7DQogICAgDQogICAgZm9yIChjb25zdCBqc29uJiBqIDogb2JqKXsNCiAgICAgICAgcmV0LT5wdXNoX2JhY2soKG5ldyBNYXBwaW5nX0dyb3VwKCkpLT5fZnJvbURvY3VtZW50KGopKTsNCiAgICB9DQogICAgDQogICAgcmV0dXJuIG1vdmUoKnJldCk7DQp9DQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6TWFwcGluZ19Hcm91cCYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpNYXBwaW5nX0dyb3VwOjpfZnJvbURvY3VtZW50KGpzb24gb2JqKXsNCiAgICANCiAgICBpZihvYmouY29udGFpbnMoImFjdGl2ZSIpKSB0aGlzLT5hY3RpdmUoDQogICAgICAgIA0KICAgICAgICBvYmpbImFjdGl2ZSJdLnRlbXBsYXRlIGdldDxib29sPigpDQogICAgICAgIA0KICAgICAgICApOw0KICAgIA0KICAgIGlmKG9iai5jb250YWlucygiZW5hYmxlZCIpKSB0aGlzLT5lbmFibGVkKA0KICAgICAgICANCiAgICAgICAgb2JqWyJlbmFibGVkIl0udGVtcGxhdGUgZ2V0PGJvb2w+KCkNCiAgICAgICAgDQogICAgICAgICk7DQogICAgDQogICAgaWYob2JqLmNvbnRhaW5zKCJjb2RlIikpIHRoaXMtPmNvZGUoDQogICAgICAgIA0KICAgICAgICBvYmpbImNvZGUiXS50ZW1wbGF0ZSBnZXQ8c3RkOjpzdHJpbmc+KCkNCiAgICAgICAgDQogICAgICAgICk7DQogICAgDQogICAgaWYob2JqLmNvbnRhaW5zKCJvcmRlciIpKSB0aGlzLT5vcmRlcigNCiAgICAgICAgDQogICAgICAgIG9ialsib3JkZXIiXS50ZW1wbGF0ZSBnZXQ8aW50PigpDQogICAgICAgIA0KICAgICAgICApOw0KICAgIA0KICAgIGlmKG9iai5jb250YWlucygiZGF0ZSIpKSB0aGlzLT5kYXRlKA0KICAgICAgICANCiAgICAgICAgb2JqWyJkYXRlIl0udGVtcGxhdGUgZ2V0PHRpbWVfdD4oKQ0KICAgICAgICANCiAgICAgICAgKTsNCiAgICANCiAgICBpZihvYmouY29udGFpbnMoIm5hbWUiKSkgdGhpcy0+bmFtZSgNCiAgICAgICAgDQogICAgICAgIG9ialsibmFtZSJdLnRlbXBsYXRlIGdldDxzdGQ6OnN0cmluZz4oKQ0KICAgICAgICANCiAgICAgICAgKTsNCiAgICANCiAgICBpZihvYmouY29udGFpbnMoInJlbWFyayIpKSB0aGlzLT5yZW1hcmsoDQogICAgICAgIA0KICAgICAgICBvYmpbInJlbWFyayJdLnRlbXBsYXRlIGdldDxzdGQ6OnN0cmluZz4oKQ0KICAgICAgICANCiAgICAgICAgKTsNCiAgICANCiAgICANCiAgICANCiAgICByZXR1cm4gKnRoaXM7DQp9DQoNCnN0ZDo6c3RyaW5nIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6TWFwcGluZ19Hcm91cDo6X3RvRG9jdW1lbnQoKXsNCiAgICByZXR1cm4gIiI7DQp9DQoNCiAgICANCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6TWFwcGluZ19Hcm91cCYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpNYXBwaW5nX0dyb3VwOjpzdG9yZSgpew0KICAgIHN0ZDo6c3RyaW5nIF9fdG9TdHJpbmcgPSAiTWFwcGluZ19Hcm91cDo6c3RvcmUoKTogIjsNCiAgICBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkV2ZW50IF9fcmVzcG9uc2UgPSAobmV3IGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6RXZlbnQoKSktPmNvZGUoIlsiK3RoaXNOb2RlLmNvZGUoKSsiQHRpbWUiKyJdLk1hcHBpbmdfR3JvdXAuc3RvcmUoKSIpLm1ldGhvZCgic3RvcmUiKS5jbGFzc05hbWUoIk1hcHBpbmdfR3JvdXAiKS5jYXJyaWVyKHRoaXNOb2RlKS5zZW5kZXIodGhpc05vZGUpLnJlY2lwaWVudCh0aGlzTm9kZS5wYXJlbnQoKSk7DQoNCiAgICBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok1hcHBpbmdfR3JvdXAqIGFuc3dlcjsNCg0KICAgIA0KDQogICAgDQogICAgaWYoYW5zd2VyIT1udWxscHRyKXsNCiAgICANCg0KICAgIA0KICAgICAgICANCiAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci0+X3RvRG9jdW1lbnQoKSk7DQogICAgICAgIA0KICAgIA0KICAgIH1lbHNlew0KICAgICAgICBqc29uIF9qUmV0Ow0KICAgICAgICBfalJldFsiX190aGlzIl0gPSB0aGlzLT5fdG9Eb2N1bWVudCgpOw0KICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoX2pSZXQpOw0KICAgICAgICAvL19fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHRoaXMtPl90b0RvY3VtZW50KCl9KTsNCiAgICB9DQoNCiAgICAvL19fcmVzcG9uc2UudHJpZ2dlcigpOw0KDQogICAgcmV0dXJuICphbnN3ZXI7DQp9DQogICAgDQpzdGQ6OnZlY3Rvcjxlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok1hcHBpbmdfR3JvdXA+JiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok1hcHBpbmdfR3JvdXA6OmZpbmRBbGwoKXsNCiAgICBzdGQ6OnN0cmluZyBfX3RvU3RyaW5nID0gIk1hcHBpbmdfR3JvdXA6OmZpbmRBbGwoKTogIjsNCiAgICBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkV2ZW50IF9fcmVzcG9uc2UgPSAobmV3IGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6RXZlbnQoKSktPmNvZGUoIlsiK3RoaXNOb2RlLmNvZGUoKSsiQHRpbWUiKyJdLk1hcHBpbmdfR3JvdXAuZmluZEFsbCgpIikubWV0aG9kKCJmaW5kQWxsIikuY2xhc3NOYW1lKCJNYXBwaW5nX0dyb3VwIikuY2Fycmllcih0aGlzTm9kZSkuc2VuZGVyKHRoaXNOb2RlKS5yZWNpcGllbnQodGhpc05vZGUucGFyZW50KCkpOw0KDQogICAgc3RkOjp2ZWN0b3I8ZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpNYXBwaW5nX0dyb3VwPiogYW5zd2VyOw0KDQogICAgDQoNCiAgICANCiAgICBpZihhbnN3ZXItPmVtcHR5KCkpew0KICAgIA0KDQogICAgDQogICAgICAgIA0KICAgICAgICAvL19fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXItPl90b0RvY3VtZW50KCkpOw0KICAgICAgICANCiAgICANCiAgICB9ZWxzZXsNCiAgICAgICAganNvbiBfalJldDsNCiAgICAgICAgX2pSZXRbIl9fdGhpcyJdID0gdGhpcy0+X3RvRG9jdW1lbnQoKTsNCiAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKF9qUmV0KTsNCiAgICAgICAgLy9fX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiB0aGlzLT5fdG9Eb2N1bWVudCgpfSk7DQogICAgfQ0KDQogICAgLy9fX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCg0KICAgIHJldHVybiAqYW5zd2VyOw0KfQ0KICAgIA0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpNYXBwaW5nX0dyb3VwJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok1hcHBpbmdfR3JvdXA6OmZpbmQoKXsNCiAgICBzdGQ6OnN0cmluZyBfX3RvU3RyaW5nID0gIk1hcHBpbmdfR3JvdXA6OmZpbmQoKTogIjsNCiAgICBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkV2ZW50IF9fcmVzcG9uc2UgPSAobmV3IGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6RXZlbnQoKSktPmNvZGUoIlsiK3RoaXNOb2RlLmNvZGUoKSsiQHRpbWUiKyJdLk1hcHBpbmdfR3JvdXAuZmluZCgpIikubWV0aG9kKCJmaW5kIikuY2xhc3NOYW1lKCJNYXBwaW5nX0dyb3VwIikuY2Fycmllcih0aGlzTm9kZSkuc2VuZGVyKHRoaXNOb2RlKS5yZWNpcGllbnQodGhpc05vZGUucGFyZW50KCkpOw0KDQogICAgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpNYXBwaW5nX0dyb3VwKiBhbnN3ZXI7DQoNCiAgICANCg0KICAgIA0KICAgIGlmKGFuc3dlciE9bnVsbHB0cil7DQogICAgDQoNCiAgICANCiAgICAgICAgDQogICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXItPl90b0RvY3VtZW50KCkpOw0KICAgICAgICANCiAgICANCiAgICB9ZWxzZXsNCiAgICAgICAganNvbiBfalJldDsNCiAgICAgICAgX2pSZXRbIl9fdGhpcyJdID0gdGhpcy0+X3RvRG9jdW1lbnQoKTsNCiAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKF9qUmV0KTsNCiAgICAgICAgLy9fX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiB0aGlzLT5fdG9Eb2N1bWVudCgpfSk7DQogICAgfQ0KDQogICAgLy9fX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCg0KICAgIHJldHVybiAqYW5zd2VyOw0KfQ0KICAgIA0KDQogICAgDQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6VG9vbF9UeXBlJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OlRvb2xfVHlwZTo6YWN0aXZlKGJvb2wgdil7DQogICAgdGhpcy0+X2FjdGl2ZSA9IHY7DQogICAgcmV0dXJuICp0aGlzOw0KfQ0KICAgIA0KDQpib29sIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6VG9vbF9UeXBlOjphY3RpdmUoKXsNCiAgICByZXR1cm4gdGhpcy0+X2FjdGl2ZTsNCn0NCiAgICANCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpUb29sX1R5cGUmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6VG9vbF9UeXBlOjplbmFibGVkKGJvb2wgdil7DQogICAgdGhpcy0+X2VuYWJsZWQgPSB2Ow0KICAgIHJldHVybiAqdGhpczsNCn0NCiAgICANCg0KYm9vbCBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OlRvb2xfVHlwZTo6ZW5hYmxlZCgpew0KICAgIHJldHVybiB0aGlzLT5fZW5hYmxlZDsNCn0NCiAgICANCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpUb29sX1R5cGUmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6VG9vbF9UeXBlOjpjb2RlKHN0ZDo6c3RyaW5nIHYpew0KICAgIHRoaXMtPl9jb2RlID0gdjsNCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQoNCnN0ZDo6c3RyaW5nIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6VG9vbF9UeXBlOjpjb2RlKCl7DQogICAgcmV0dXJuIHRoaXMtPl9jb2RlOw0KfQ0KICAgIA0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OlRvb2xfVHlwZSYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpUb29sX1R5cGU6Om9yZGVyKGludCB2KXsNCiAgICB0aGlzLT5fb3JkZXIgPSB2Ow0KICAgIHJldHVybiAqdGhpczsNCn0NCiAgICANCg0KaW50IGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6VG9vbF9UeXBlOjpvcmRlcigpew0KICAgIHJldHVybiB0aGlzLT5fb3JkZXI7DQp9DQogICAgDQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6VG9vbF9UeXBlJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OlRvb2xfVHlwZTo6ZGF0ZSh0aW1lX3Qgdil7DQogICAgdGhpcy0+X2RhdGUgPSB2Ow0KICAgIHJldHVybiAqdGhpczsNCn0NCiAgICANCg0KdGltZV90IGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6VG9vbF9UeXBlOjpkYXRlKCl7DQogICAgcmV0dXJuIHRoaXMtPl9kYXRlOw0KfQ0KICAgIA0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OlRvb2xfVHlwZSYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpUb29sX1R5cGU6Om5hbWUoc3RkOjpzdHJpbmcgdil7DQogICAgdGhpcy0+X25hbWUgPSB2Ow0KICAgIHJldHVybiAqdGhpczsNCn0NCiAgICANCg0Kc3RkOjpzdHJpbmcgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpUb29sX1R5cGU6Om5hbWUoKXsNCiAgICByZXR1cm4gdGhpcy0+X25hbWU7DQp9DQogICAgDQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6VG9vbF9UeXBlJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OlRvb2xfVHlwZTo6cmVtYXJrKHN0ZDo6c3RyaW5nIHYpew0KICAgIHRoaXMtPl9yZW1hcmsgPSB2Ow0KICAgIHJldHVybiAqdGhpczsNCn0NCiAgICANCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6VG9vbF9UeXBlJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OlRvb2xfVHlwZTo6cmVtYXJrKGpzb24gdil7DQogICAgLy90aGlzLT5fcmVtYXJrDQogICAgcmV0dXJuICp0aGlzOw0KfQ0KICAgIA0KDQpzdGQ6OnN0cmluZyBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OlRvb2xfVHlwZTo6cmVtYXJrKCl7DQogICAgcmV0dXJuIHRoaXMtPl9yZW1hcms7DQp9DQogICAgDQoNCiAgICANCnN0ZDo6dmVjdG9yPHN0ZDo6YW55PiYmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6VG9vbF9UeXBlOjp0eXBlX0NvbmZpZ3MoKXsNCiAgICByZXR1cm4gbW92ZSgqKHRoaXMtPl90eXBlX0NvbmZpZ3MpKTsNCn0NCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpUb29sX1R5cGUmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6VG9vbF9UeXBlOjp0eXBlX0NvbmZpZ3Moc3RkOjp2ZWN0b3I8c3RkOjphbnk+JiYgdil7DQogICAgcmV0dXJuICp0aGlzOw0KfQ0KICAgIA0Kc3RkOjp2ZWN0b3I8c3RkOjphbnk+JiYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpUb29sX1R5cGU6OnR5cGVfVG9vbHMoKXsNCiAgICByZXR1cm4gbW92ZSgqKHRoaXMtPl90eXBlX1Rvb2xzKSk7DQp9DQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6VG9vbF9UeXBlJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OlRvb2xfVHlwZTo6dHlwZV9Ub29scyhzdGQ6OnZlY3RvcjxzdGQ6OmFueT4mJiB2KXsNCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQpzdGQ6OnZlY3RvcjxzdGQ6OmFueT4mJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OlRvb2xfVHlwZTo6dHlwZV9NYXBwaW5ncygpew0KICAgIHJldHVybiBtb3ZlKCoodGhpcy0+X3R5cGVfTWFwcGluZ3MpKTsNCn0NCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpUb29sX1R5cGUmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6VG9vbF9UeXBlOjp0eXBlX01hcHBpbmdzKHN0ZDo6dmVjdG9yPHN0ZDo6YW55PiYmIHYpew0KICAgIHJldHVybiAqdGhpczsNCn0NCiAgICANCg0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OlRvb2xfVHlwZSYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpUb29sX1R5cGU6Ol91bmlxdWUoKXsNCiAgICBzdGQ6OnN0cmluZyBfX3RvU3RyaW5nID0gIlRvb2xfVHlwZTo6X3VuaXF1ZSgpOiAiOw0KDQogICAgVG9vbF9UeXBlKiByZXQgPSBuZXcgVG9vbF9UeXBlKCk7DQogICAgaWYodGhpcy0+SWQhPTApIHJldC0+SWQgPSB0aGlzLT5JZDsNCiAgICANCiAgICAgICAgDQogICAgaWYodGhpcy0+bmFtZSgpLmVtcHR5KCkpDQogICAgICAgIA0KICAgICAgICByZXQtPm5hbWUodGhpcy0+bmFtZSgpKTsNCiAgICANCg0KICAgIHJldHVybiAqdGhpczsNCn0NCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpUb29sX1R5cGUmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6VG9vbF9UeXBlOjpfZnJvbURvY3VtZW50KHVuc2lnbmVkIGNoYXIqIG9iail7DQogICAgcmV0dXJuIHRoaXMtPl9mcm9tRG9jdW1lbnQoc3RkOjpzdHJpbmcoIG9iaiwgb2JqICsgc2l6ZW9mIG9iaiAvIHNpemVvZiBvYmpbMF0gKSk7DQp9DQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6VG9vbF9UeXBlJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OlRvb2xfVHlwZTo6X2Zyb21Eb2N1bWVudChzdGQ6OnN0cmluZyBvYmopew0KICAgIGlmKG9iai5lbXB0eSgpKSByZXR1cm4gKnRoaXM7DQoNCiAgICBpZiAoc3RkOjpyZWdleF9tYXRjaChvYmosIHN0ZDo6cmVnZXgoUiIiKCgoW0EtWmEtel17Myw5fTooPzovLyk/KSg/OlstOzomPSskLHddK0ApP1tBLVphLXowLTkuLV0rfCg/Ond3dy58Wy07OiY9KyQsd10rQClbQS1aYS16MC05Li1dKykoKD86L1srfiUvLnctX10qKT8/Pyg/OlstKz0mOyVALndfXSopIz8oPzpbd10qKSk/KSIiKSkpew0KICAgICAgICBzdGQ6OnN0cmluZyByZWFkQnVmZmVyOw0KICAgICAgICBDVVJMICpjdXJsID0gY3VybF9lYXN5X2luaXQoKTsNCiAgICAgICAgY3VybF9lYXN5X3NldG9wdChjdXJsLCBDVVJMT1BUX1VSTCwgb2JqKTsNCiAgICAgICAgY3VybF9lYXN5X3NldG9wdChjdXJsLCBDVVJMT1BUX0ZPTExPV0xPQ0FUSU9OLCAxTCk7DQogICAgICAgIC8vY3VybF9lYXN5X3NldG9wdChjdXJsLCBDVVJMT1BUX1dSSVRFRlVOQ1RJT04sICtbXSh2b2lkICpwdHIsIHNpemVfdCBzaXplLCBzaXplX3Qgbm1lbWIsIHZvaWQgKnN0cmVhbSkgLT4gc2l6ZV90IHsgcmVhZEJ1ZmZlci5hcHBlbmQoKnB0ciwgc2l6ZSAqIG5tZW1iKTsgfSk7DQogICAgICAgIGN1cmxfZWFzeV9zZXRvcHQoY3VybCwgQ1VSTE9QVF9XUklURURBVEEsICZyZWFkQnVmZmVyKTsNCiAgICAgICAgY3VybF9lYXN5X3BlcmZvcm0oY3VybCk7DQogICAgICAgIGN1cmxfZWFzeV9jbGVhbnVwKGN1cmwpOw0KICAgICAgICByZXR1cm4gdGhpcy0+X2Zyb21Eb2N1bWVudChyZWFkQnVmZmVyKTsNCiAgICB9DQoNCiAgICByZXR1cm4gdGhpcy0+X2Zyb21Eb2N1bWVudChqc29uOjpwYXJzZShvYmopKTsNCn0NCg0Kc3RkOjp2ZWN0b3I8ZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpUb29sX1R5cGU+JiYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpUb29sX1R5cGU6Ol9mcm9tRG9jdW1lbnQoc3RkOjp2ZWN0b3I8anNvbj4mJiBvYmopew0KICAgIHN0ZDo6dmVjdG9yPFRvb2xfVHlwZT4qIHJldCA9IG5ldyBzdGQ6OnZlY3RvcjxUb29sX1R5cGU+KG9iai5zaXplKCkpOw0KICAgIA0KICAgIGZvciAoY29uc3QganNvbiYgaiA6IG9iail7DQogICAgICAgIHJldC0+cHVzaF9iYWNrKChuZXcgVG9vbF9UeXBlKCkpLT5fZnJvbURvY3VtZW50KGopKTsNCiAgICB9DQogICAgDQogICAgcmV0dXJuIG1vdmUoKnJldCk7DQp9DQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6VG9vbF9UeXBlJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OlRvb2xfVHlwZTo6X2Zyb21Eb2N1bWVudChqc29uIG9iail7DQogICAgDQogICAgaWYob2JqLmNvbnRhaW5zKCJhY3RpdmUiKSkgdGhpcy0+YWN0aXZlKA0KICAgICAgICANCiAgICAgICAgb2JqWyJhY3RpdmUiXS50ZW1wbGF0ZSBnZXQ8Ym9vbD4oKQ0KICAgICAgICANCiAgICAgICAgKTsNCiAgICANCiAgICBpZihvYmouY29udGFpbnMoImVuYWJsZWQiKSkgdGhpcy0+ZW5hYmxlZCgNCiAgICAgICAgDQogICAgICAgIG9ialsiZW5hYmxlZCJdLnRlbXBsYXRlIGdldDxib29sPigpDQogICAgICAgIA0KICAgICAgICApOw0KICAgIA0KICAgIGlmKG9iai5jb250YWlucygiY29kZSIpKSB0aGlzLT5jb2RlKA0KICAgICAgICANCiAgICAgICAgb2JqWyJjb2RlIl0udGVtcGxhdGUgZ2V0PHN0ZDo6c3RyaW5nPigpDQogICAgICAgIA0KICAgICAgICApOw0KICAgIA0KICAgIGlmKG9iai5jb250YWlucygib3JkZXIiKSkgdGhpcy0+b3JkZXIoDQogICAgICAgIA0KICAgICAgICBvYmpbIm9yZGVyIl0udGVtcGxhdGUgZ2V0PGludD4oKQ0KICAgICAgICANCiAgICAgICAgKTsNCiAgICANCiAgICBpZihvYmouY29udGFpbnMoImRhdGUiKSkgdGhpcy0+ZGF0ZSgNCiAgICAgICAgDQogICAgICAgIG9ialsiZGF0ZSJdLnRlbXBsYXRlIGdldDx0aW1lX3Q+KCkNCiAgICAgICAgDQogICAgICAgICk7DQogICAgDQogICAgaWYob2JqLmNvbnRhaW5zKCJuYW1lIikpIHRoaXMtPm5hbWUoDQogICAgICAgIA0KICAgICAgICBvYmpbIm5hbWUiXS50ZW1wbGF0ZSBnZXQ8c3RkOjpzdHJpbmc+KCkNCiAgICAgICAgDQogICAgICAgICk7DQogICAgDQogICAgaWYob2JqLmNvbnRhaW5zKCJyZW1hcmsiKSkgdGhpcy0+cmVtYXJrKA0KICAgICAgICANCiAgICAgICAgb2JqWyJyZW1hcmsiXS50ZW1wbGF0ZSBnZXQ8c3RkOjpzdHJpbmc+KCkNCiAgICAgICAgDQogICAgICAgICk7DQogICAgDQogICAgDQogICAgDQogICAgaWYob2JqLmNvbnRhaW5zKCJ0eXBlX0NvbmZpZ3MiKSkgdGhpcy0+dHlwZV9Db25maWdzKChuZXcgQ29uZmlnKCkpLT5fZnJvbURvY3VtZW50KChzdGQ6OnZlY3Rvcjxqc29uPilvYmpbInR5cGVfQ29uZmlncyJdKSk7DQogICAgDQogICAgaWYob2JqLmNvbnRhaW5zKCJ0eXBlX1Rvb2xzIikpIHRoaXMtPnR5cGVfVG9vbHMoKG5ldyBUb29sKCkpLT5fZnJvbURvY3VtZW50KChzdGQ6OnZlY3Rvcjxqc29uPilvYmpbInR5cGVfVG9vbHMiXSkpOw0KICAgIA0KICAgIGlmKG9iai5jb250YWlucygidHlwZV9NYXBwaW5ncyIpKSB0aGlzLT50eXBlX01hcHBpbmdzKChuZXcgTWFwcGluZygpKS0+X2Zyb21Eb2N1bWVudCgoc3RkOjp2ZWN0b3I8anNvbj4pb2JqWyJ0eXBlX01hcHBpbmdzIl0pKTsNCiAgICANCiAgICByZXR1cm4gKnRoaXM7DQp9DQoNCnN0ZDo6c3RyaW5nIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6VG9vbF9UeXBlOjpfdG9Eb2N1bWVudCgpew0KICAgIHJldHVybiAiIjsNCn0NCg0KICAgIA0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpUb29sX1R5cGUmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6VG9vbF9UeXBlOjpzdG9yZSgpew0KICAgIHN0ZDo6c3RyaW5nIF9fdG9TdHJpbmcgPSAiVG9vbF9UeXBlOjpzdG9yZSgpOiAiOw0KICAgIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6RXZlbnQgX19yZXNwb25zZSA9IChuZXcgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpFdmVudCgpKS0+Y29kZSgiWyIrdGhpc05vZGUuY29kZSgpKyJAdGltZSIrIl0uVG9vbF9UeXBlLnN0b3JlKCkiKS5tZXRob2QoInN0b3JlIikuY2xhc3NOYW1lKCJUb29sX1R5cGUiKS5jYXJyaWVyKHRoaXNOb2RlKS5zZW5kZXIodGhpc05vZGUpLnJlY2lwaWVudCh0aGlzTm9kZS5wYXJlbnQoKSk7DQoNCiAgICBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OlRvb2xfVHlwZSogYW5zd2VyOw0KDQogICAgDQoNCiAgICANCiAgICBpZihhbnN3ZXIhPW51bGxwdHIpew0KICAgIA0KDQogICAgDQogICAgICAgIA0KICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLT5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgDQogICAgDQogICAgfWVsc2V7DQogICAgICAgIGpzb24gX2pSZXQ7DQogICAgICAgIF9qUmV0WyJfX3RoaXMiXSA9IHRoaXMtPl90b0RvY3VtZW50KCk7DQogICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChfalJldCk7DQogICAgICAgIC8vX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogdGhpcy0+X3RvRG9jdW1lbnQoKX0pOw0KICAgIH0NCg0KICAgIC8vX19yZXNwb25zZS50cmlnZ2VyKCk7DQoNCiAgICByZXR1cm4gKmFuc3dlcjsNCn0NCiAgICANCnN0ZDo6dmVjdG9yPGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6VG9vbF9UeXBlPiYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpUb29sX1R5cGU6OmZpbmRBbGwoKXsNCiAgICBzdGQ6OnN0cmluZyBfX3RvU3RyaW5nID0gIlRvb2xfVHlwZTo6ZmluZEFsbCgpOiAiOw0KICAgIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6RXZlbnQgX19yZXNwb25zZSA9IChuZXcgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpFdmVudCgpKS0+Y29kZSgiWyIrdGhpc05vZGUuY29kZSgpKyJAdGltZSIrIl0uVG9vbF9UeXBlLmZpbmRBbGwoKSIpLm1ldGhvZCgiZmluZEFsbCIpLmNsYXNzTmFtZSgiVG9vbF9UeXBlIikuY2Fycmllcih0aGlzTm9kZSkuc2VuZGVyKHRoaXNOb2RlKS5yZWNpcGllbnQodGhpc05vZGUucGFyZW50KCkpOw0KDQogICAgc3RkOjp2ZWN0b3I8ZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpUb29sX1R5cGU+KiBhbnN3ZXI7DQoNCiAgICANCg0KICAgIA0KICAgIGlmKGFuc3dlci0+ZW1wdHkoKSl7DQogICAgDQoNCiAgICANCiAgICAgICAgDQogICAgICAgIC8vX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci0+X3RvRG9jdW1lbnQoKSk7DQogICAgICAgIA0KICAgIA0KICAgIH1lbHNlew0KICAgICAgICBqc29uIF9qUmV0Ow0KICAgICAgICBfalJldFsiX190aGlzIl0gPSB0aGlzLT5fdG9Eb2N1bWVudCgpOw0KICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoX2pSZXQpOw0KICAgICAgICAvL19fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHRoaXMtPl90b0RvY3VtZW50KCl9KTsNCiAgICB9DQoNCiAgICAvL19fcmVzcG9uc2UudHJpZ2dlcigpOw0KDQogICAgcmV0dXJuICphbnN3ZXI7DQp9DQogICAgDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OlRvb2xfVHlwZSYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpUb29sX1R5cGU6OmZpbmQoKXsNCiAgICBzdGQ6OnN0cmluZyBfX3RvU3RyaW5nID0gIlRvb2xfVHlwZTo6ZmluZCgpOiAiOw0KICAgIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6RXZlbnQgX19yZXNwb25zZSA9IChuZXcgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpFdmVudCgpKS0+Y29kZSgiWyIrdGhpc05vZGUuY29kZSgpKyJAdGltZSIrIl0uVG9vbF9UeXBlLmZpbmQoKSIpLm1ldGhvZCgiZmluZCIpLmNsYXNzTmFtZSgiVG9vbF9UeXBlIikuY2Fycmllcih0aGlzTm9kZSkuc2VuZGVyKHRoaXNOb2RlKS5yZWNpcGllbnQodGhpc05vZGUucGFyZW50KCkpOw0KDQogICAgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpUb29sX1R5cGUqIGFuc3dlcjsNCg0KICAgIA0KDQogICAgDQogICAgaWYoYW5zd2VyIT1udWxscHRyKXsNCiAgICANCg0KICAgIA0KICAgICAgICANCiAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci0+X3RvRG9jdW1lbnQoKSk7DQogICAgICAgIA0KICAgIA0KICAgIH1lbHNlew0KICAgICAgICBqc29uIF9qUmV0Ow0KICAgICAgICBfalJldFsiX190aGlzIl0gPSB0aGlzLT5fdG9Eb2N1bWVudCgpOw0KICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoX2pSZXQpOw0KICAgICAgICAvL19fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHRoaXMtPl90b0RvY3VtZW50KCl9KTsNCiAgICB9DQoNCiAgICAvL19fcmVzcG9uc2UudHJpZ2dlcigpOw0KDQogICAgcmV0dXJuICphbnN3ZXI7DQp9DQogICAgDQoNCiAgICANCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpFdmVudCYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpFdmVudDo6YWN0aXZlKGJvb2wgdil7DQogICAgdGhpcy0+X2FjdGl2ZSA9IHY7DQogICAgcmV0dXJuICp0aGlzOw0KfQ0KICAgIA0KDQpib29sIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6RXZlbnQ6OmFjdGl2ZSgpew0KICAgIHJldHVybiB0aGlzLT5fYWN0aXZlOw0KfQ0KICAgIA0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkV2ZW50JiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkV2ZW50OjplbmFibGVkKGJvb2wgdil7DQogICAgdGhpcy0+X2VuYWJsZWQgPSB2Ow0KICAgIHJldHVybiAqdGhpczsNCn0NCiAgICANCg0KYm9vbCBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkV2ZW50OjplbmFibGVkKCl7DQogICAgcmV0dXJuIHRoaXMtPl9lbmFibGVkOw0KfQ0KICAgIA0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkV2ZW50JiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkV2ZW50Ojpjb2RlKHN0ZDo6c3RyaW5nIHYpew0KICAgIHRoaXMtPl9jb2RlID0gdjsNCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQoNCnN0ZDo6c3RyaW5nIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6RXZlbnQ6OmNvZGUoKXsNCiAgICByZXR1cm4gdGhpcy0+X2NvZGU7DQp9DQogICAgDQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6RXZlbnQmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6RXZlbnQ6Om9yZGVyKGludCB2KXsNCiAgICB0aGlzLT5fb3JkZXIgPSB2Ow0KICAgIHJldHVybiAqdGhpczsNCn0NCiAgICANCg0KaW50IGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6RXZlbnQ6Om9yZGVyKCl7DQogICAgcmV0dXJuIHRoaXMtPl9vcmRlcjsNCn0NCiAgICANCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpFdmVudCYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpFdmVudDo6ZGF0ZSh0aW1lX3Qgdil7DQogICAgdGhpcy0+X2RhdGUgPSB2Ow0KICAgIHJldHVybiAqdGhpczsNCn0NCiAgICANCg0KdGltZV90IGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6RXZlbnQ6OmRhdGUoKXsNCiAgICByZXR1cm4gdGhpcy0+X2RhdGU7DQp9DQogICAgDQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6RXZlbnQmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6RXZlbnQ6Om5hbWUoc3RkOjpzdHJpbmcgdil7DQogICAgdGhpcy0+X25hbWUgPSB2Ow0KICAgIHJldHVybiAqdGhpczsNCn0NCiAgICANCg0Kc3RkOjpzdHJpbmcgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpFdmVudDo6bmFtZSgpew0KICAgIHJldHVybiB0aGlzLT5fbmFtZTsNCn0NCiAgICANCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpFdmVudCYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpFdmVudDo6cmVtYXJrKHN0ZDo6c3RyaW5nIHYpew0KICAgIHRoaXMtPl9yZW1hcmsgPSB2Ow0KICAgIHJldHVybiAqdGhpczsNCn0NCiAgICANCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6RXZlbnQmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6RXZlbnQ6OnJlbWFyayhqc29uIHYpew0KICAgIC8vdGhpcy0+X3JlbWFyaw0KICAgIHJldHVybiAqdGhpczsNCn0NCiAgICANCg0Kc3RkOjpzdHJpbmcgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpFdmVudDo6cmVtYXJrKCl7DQogICAgcmV0dXJuIHRoaXMtPl9yZW1hcms7DQp9DQogICAgDQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6RXZlbnQmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6RXZlbnQ6OmNsYXNzTmFtZShzdGQ6OnN0cmluZyB2KXsNCiAgICB0aGlzLT5fY2xhc3NOYW1lID0gdjsNCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQoNCnN0ZDo6c3RyaW5nIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6RXZlbnQ6OmNsYXNzTmFtZSgpew0KICAgIHJldHVybiB0aGlzLT5fY2xhc3NOYW1lOw0KfQ0KICAgIA0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkV2ZW50JiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkV2ZW50OjptZXRob2Qoc3RkOjpzdHJpbmcgdil7DQogICAgdGhpcy0+X21ldGhvZCA9IHY7DQogICAgcmV0dXJuICp0aGlzOw0KfQ0KICAgIA0KDQpzdGQ6OnN0cmluZyBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkV2ZW50OjptZXRob2QoKXsNCiAgICByZXR1cm4gdGhpcy0+X21ldGhvZDsNCn0NCiAgICANCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpFdmVudCYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpFdmVudDo6cGF5bG9hZChzdGQ6OnN0cmluZyB2KXsNCiAgICB0aGlzLT5fcGF5bG9hZCA9IHY7DQogICAgcmV0dXJuICp0aGlzOw0KfQ0KICAgIA0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpFdmVudCYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpFdmVudDo6cGF5bG9hZChqc29uIHYpew0KICAgIC8vdGhpcy0+X3BheWxvYWQNCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQoNCnN0ZDo6c3RyaW5nIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6RXZlbnQ6OnBheWxvYWQoKXsNCiAgICByZXR1cm4gdGhpcy0+X3BheWxvYWQ7DQp9DQogICAgDQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6RXZlbnQmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6RXZlbnQ6OmNhcnJpZXIoZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlJiB2KXsNCiAgICB0aGlzLT5fY2FycmllciA9ICZ2Ow0KICAgIHJldHVybiAqdGhpczsNCn0NCiAgICANCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6RXZlbnQmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6RXZlbnQ6OmNhcnJpZXIoZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlKiB2KXsNCiAgICBpZih2IT1udWxscHRyKXsNCiAgICAgICAgdGhpcy0+X2NhcnJpZXIgPSB2Ow0KICAgIH0NCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZSogZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpFdmVudDo6Y2Fycmllcigpew0KICAgIHJldHVybiB0aGlzLT5fY2FycmllcjsNCn0NCiAgICANCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpFdmVudCYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpFdmVudDo6c2VuZGVyKGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZSYgdil7DQogICAgdGhpcy0+X3NlbmRlciA9ICZ2Ow0KICAgIHJldHVybiAqdGhpczsNCn0NCiAgICANCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6RXZlbnQmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6RXZlbnQ6OnNlbmRlcihlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGUqIHYpew0KICAgIGlmKHYhPW51bGxwdHIpew0KICAgICAgICB0aGlzLT5fc2VuZGVyID0gdjsNCiAgICB9DQogICAgcmV0dXJuICp0aGlzOw0KfQ0KICAgIA0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGUqIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6RXZlbnQ6OnNlbmRlcigpew0KICAgIHJldHVybiB0aGlzLT5fc2VuZGVyOw0KfQ0KICAgIA0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkV2ZW50JiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkV2ZW50OjpyZWNpcGllbnQoZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlJiB2KXsNCiAgICB0aGlzLT5fcmVjaXBpZW50ID0gJnY7DQogICAgcmV0dXJuICp0aGlzOw0KfQ0KICAgIA0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpFdmVudCYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpFdmVudDo6cmVjaXBpZW50KGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZSogdil7DQogICAgaWYodiE9bnVsbHB0cil7DQogICAgICAgIHRoaXMtPl9yZWNpcGllbnQgPSB2Ow0KICAgIH0NCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZSogZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpFdmVudDo6cmVjaXBpZW50KCl7DQogICAgcmV0dXJuIHRoaXMtPl9yZWNpcGllbnQ7DQp9DQogICAgDQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6RXZlbnQmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6RXZlbnQ6OnJlc3BvbnNlVG8oZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpFdmVudCYgdil7DQogICAgdGhpcy0+X3Jlc3BvbnNlVG8gPSAmdjsNCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkV2ZW50JiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkV2ZW50OjpyZXNwb25zZVRvKGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6RXZlbnQqIHYpew0KICAgIGlmKHYhPW51bGxwdHIpew0KICAgICAgICB0aGlzLT5fcmVzcG9uc2VUbyA9IHY7DQogICAgfQ0KICAgIHJldHVybiAqdGhpczsNCn0NCiAgICANCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpFdmVudCogZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpFdmVudDo6cmVzcG9uc2VUbygpew0KICAgIHJldHVybiB0aGlzLT5fcmVzcG9uc2VUbzsNCn0NCiAgICANCg0KICAgIA0Kc3RkOjp2ZWN0b3I8c3RkOjphbnk+JiYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpFdmVudDo6cmVzcG9uc2VUb19FdmVudHMoKXsNCiAgICByZXR1cm4gbW92ZSgqKHRoaXMtPl9yZXNwb25zZVRvX0V2ZW50cykpOw0KfQ0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkV2ZW50JiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkV2ZW50OjpyZXNwb25zZVRvX0V2ZW50cyhzdGQ6OnZlY3RvcjxzdGQ6OmFueT4mJiB2KXsNCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQoNCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpFdmVudCYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpFdmVudDo6X3VuaXF1ZSgpew0KICAgIHN0ZDo6c3RyaW5nIF9fdG9TdHJpbmcgPSAiRXZlbnQ6Ol91bmlxdWUoKTogIjsNCg0KICAgIEV2ZW50KiByZXQgPSBuZXcgRXZlbnQoKTsNCiAgICBpZih0aGlzLT5JZCE9MCkgcmV0LT5JZCA9IHRoaXMtPklkOw0KICAgIA0KICAgICAgICANCiAgICBpZih0aGlzLT5jb2RlKCkuZW1wdHkoKSkNCiAgICAgICAgDQogICAgICAgIHJldC0+Y29kZSh0aGlzLT5jb2RlKCkpOw0KICAgIA0KDQogICAgcmV0dXJuICp0aGlzOw0KfQ0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkV2ZW50JiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkV2ZW50OjpfZnJvbURvY3VtZW50KHVuc2lnbmVkIGNoYXIqIG9iail7DQogICAgcmV0dXJuIHRoaXMtPl9mcm9tRG9jdW1lbnQoc3RkOjpzdHJpbmcoIG9iaiwgb2JqICsgc2l6ZW9mIG9iaiAvIHNpemVvZiBvYmpbMF0gKSk7DQp9DQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6RXZlbnQmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6RXZlbnQ6Ol9mcm9tRG9jdW1lbnQoc3RkOjpzdHJpbmcgb2JqKXsNCiAgICBpZihvYmouZW1wdHkoKSkgcmV0dXJuICp0aGlzOw0KDQogICAgaWYgKHN0ZDo6cmVnZXhfbWF0Y2gob2JqLCBzdGQ6OnJlZ2V4KFIiIigoKFtBLVphLXpdezMsOX06KD86Ly8pPykoPzpbLTs6Jj0rJCx3XStAKT9bQS1aYS16MC05Li1dK3woPzp3d3cufFstOzomPSskLHddK0ApW0EtWmEtejAtOS4tXSspKCg/Oi9bK34lLy53LV9dKik/Pz8oPzpbLSs9JjslQC53X10qKSM/KD86W3ddKikpPykiIikpKXsNCiAgICAgICAgc3RkOjpzdHJpbmcgcmVhZEJ1ZmZlcjsNCiAgICAgICAgQ1VSTCAqY3VybCA9IGN1cmxfZWFzeV9pbml0KCk7DQogICAgICAgIGN1cmxfZWFzeV9zZXRvcHQoY3VybCwgQ1VSTE9QVF9VUkwsIG9iaik7DQogICAgICAgIGN1cmxfZWFzeV9zZXRvcHQoY3VybCwgQ1VSTE9QVF9GT0xMT1dMT0NBVElPTiwgMUwpOw0KICAgICAgICAvL2N1cmxfZWFzeV9zZXRvcHQoY3VybCwgQ1VSTE9QVF9XUklURUZVTkNUSU9OLCArW10odm9pZCAqcHRyLCBzaXplX3Qgc2l6ZSwgc2l6ZV90IG5tZW1iLCB2b2lkICpzdHJlYW0pIC0+IHNpemVfdCB7IHJlYWRCdWZmZXIuYXBwZW5kKCpwdHIsIHNpemUgKiBubWVtYik7IH0pOw0KICAgICAgICBjdXJsX2Vhc3lfc2V0b3B0KGN1cmwsIENVUkxPUFRfV1JJVEVEQVRBLCAmcmVhZEJ1ZmZlcik7DQogICAgICAgIGN1cmxfZWFzeV9wZXJmb3JtKGN1cmwpOw0KICAgICAgICBjdXJsX2Vhc3lfY2xlYW51cChjdXJsKTsNCiAgICAgICAgcmV0dXJuIHRoaXMtPl9mcm9tRG9jdW1lbnQocmVhZEJ1ZmZlcik7DQogICAgfQ0KDQogICAgcmV0dXJuIHRoaXMtPl9mcm9tRG9jdW1lbnQoanNvbjo6cGFyc2Uob2JqKSk7DQp9DQoNCnN0ZDo6dmVjdG9yPGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6RXZlbnQ+JiYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpFdmVudDo6X2Zyb21Eb2N1bWVudChzdGQ6OnZlY3Rvcjxqc29uPiYmIG9iail7DQogICAgc3RkOjp2ZWN0b3I8RXZlbnQ+KiByZXQgPSBuZXcgc3RkOjp2ZWN0b3I8RXZlbnQ+KG9iai5zaXplKCkpOw0KICAgIA0KICAgIGZvciAoY29uc3QganNvbiYgaiA6IG9iail7DQogICAgICAgIHJldC0+cHVzaF9iYWNrKChuZXcgRXZlbnQoKSktPl9mcm9tRG9jdW1lbnQoaikpOw0KICAgIH0NCiAgICANCiAgICByZXR1cm4gbW92ZSgqcmV0KTsNCn0NCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpFdmVudCYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpFdmVudDo6X2Zyb21Eb2N1bWVudChqc29uIG9iail7DQogICAgDQogICAgaWYob2JqLmNvbnRhaW5zKCJhY3RpdmUiKSkgdGhpcy0+YWN0aXZlKA0KICAgICAgICANCiAgICAgICAgb2JqWyJhY3RpdmUiXS50ZW1wbGF0ZSBnZXQ8Ym9vbD4oKQ0KICAgICAgICANCiAgICAgICAgKTsNCiAgICANCiAgICBpZihvYmouY29udGFpbnMoImVuYWJsZWQiKSkgdGhpcy0+ZW5hYmxlZCgNCiAgICAgICAgDQogICAgICAgIG9ialsiZW5hYmxlZCJdLnRlbXBsYXRlIGdldDxib29sPigpDQogICAgICAgIA0KICAgICAgICApOw0KICAgIA0KICAgIGlmKG9iai5jb250YWlucygiY29kZSIpKSB0aGlzLT5jb2RlKA0KICAgICAgICANCiAgICAgICAgb2JqWyJjb2RlIl0udGVtcGxhdGUgZ2V0PHN0ZDo6c3RyaW5nPigpDQogICAgICAgIA0KICAgICAgICApOw0KICAgIA0KICAgIGlmKG9iai5jb250YWlucygib3JkZXIiKSkgdGhpcy0+b3JkZXIoDQogICAgICAgIA0KICAgICAgICBvYmpbIm9yZGVyIl0udGVtcGxhdGUgZ2V0PGludD4oKQ0KICAgICAgICANCiAgICAgICAgKTsNCiAgICANCiAgICBpZihvYmouY29udGFpbnMoImRhdGUiKSkgdGhpcy0+ZGF0ZSgNCiAgICAgICAgDQogICAgICAgIG9ialsiZGF0ZSJdLnRlbXBsYXRlIGdldDx0aW1lX3Q+KCkNCiAgICAgICAgDQogICAgICAgICk7DQogICAgDQogICAgaWYob2JqLmNvbnRhaW5zKCJuYW1lIikpIHRoaXMtPm5hbWUoDQogICAgICAgIA0KICAgICAgICBvYmpbIm5hbWUiXS50ZW1wbGF0ZSBnZXQ8c3RkOjpzdHJpbmc+KCkNCiAgICAgICAgDQogICAgICAgICk7DQogICAgDQogICAgaWYob2JqLmNvbnRhaW5zKCJyZW1hcmsiKSkgdGhpcy0+cmVtYXJrKA0KICAgICAgICANCiAgICAgICAgb2JqWyJyZW1hcmsiXS50ZW1wbGF0ZSBnZXQ8c3RkOjpzdHJpbmc+KCkNCiAgICAgICAgDQogICAgICAgICk7DQogICAgDQogICAgaWYob2JqLmNvbnRhaW5zKCJjbGFzc05hbWUiKSkgdGhpcy0+Y2xhc3NOYW1lKA0KICAgICAgICANCiAgICAgICAgb2JqWyJjbGFzc05hbWUiXS50ZW1wbGF0ZSBnZXQ8c3RkOjpzdHJpbmc+KCkNCiAgICAgICAgDQogICAgICAgICk7DQogICAgDQogICAgaWYob2JqLmNvbnRhaW5zKCJtZXRob2QiKSkgdGhpcy0+bWV0aG9kKA0KICAgICAgICANCiAgICAgICAgb2JqWyJtZXRob2QiXS50ZW1wbGF0ZSBnZXQ8c3RkOjpzdHJpbmc+KCkNCiAgICAgICAgDQogICAgICAgICk7DQogICAgDQogICAgaWYob2JqLmNvbnRhaW5zKCJwYXlsb2FkIikpIHRoaXMtPnBheWxvYWQoDQogICAgICAgIA0KICAgICAgICBvYmpbInBheWxvYWQiXS50ZW1wbGF0ZSBnZXQ8c3RkOjpzdHJpbmc+KCkNCiAgICAgICAgDQogICAgICAgICk7DQogICAgDQogICAgaWYob2JqLmNvbnRhaW5zKCJjYXJyaWVyIikpIHRoaXMtPmNhcnJpZXIoDQogICAgICAgIA0KICAgICAgICAobmV3IGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZSgpKS0+X2Zyb21Eb2N1bWVudChvYmpbImNhcnJpZXIiXSkNCiAgICAgICAgDQogICAgICAgICk7DQogICAgDQogICAgaWYob2JqLmNvbnRhaW5zKCJzZW5kZXIiKSkgdGhpcy0+c2VuZGVyKA0KICAgICAgICANCiAgICAgICAgKG5ldyBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGUoKSktPl9mcm9tRG9jdW1lbnQob2JqWyJzZW5kZXIiXSkNCiAgICAgICAgDQogICAgICAgICk7DQogICAgDQogICAgaWYob2JqLmNvbnRhaW5zKCJyZWNpcGllbnQiKSkgdGhpcy0+cmVjaXBpZW50KA0KICAgICAgICANCiAgICAgICAgKG5ldyBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGUoKSktPl9mcm9tRG9jdW1lbnQob2JqWyJyZWNpcGllbnQiXSkNCiAgICAgICAgDQogICAgICAgICk7DQogICAgDQogICAgaWYob2JqLmNvbnRhaW5zKCJyZXNwb25zZVRvIikpIHRoaXMtPnJlc3BvbnNlVG8oDQogICAgICAgIA0KICAgICAgICAobmV3IGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6RXZlbnQoKSktPl9mcm9tRG9jdW1lbnQob2JqWyJyZXNwb25zZVRvIl0pDQogICAgICAgIA0KICAgICAgICApOw0KICAgIA0KICAgIA0KICAgIA0KICAgIGlmKG9iai5jb250YWlucygicmVzcG9uc2VUb19FdmVudHMiKSkgdGhpcy0+cmVzcG9uc2VUb19FdmVudHMoKG5ldyBFdmVudCgpKS0+X2Zyb21Eb2N1bWVudCgoc3RkOjp2ZWN0b3I8anNvbj4pb2JqWyJyZXNwb25zZVRvX0V2ZW50cyJdKSk7DQogICAgDQogICAgcmV0dXJuICp0aGlzOw0KfQ0KDQpzdGQ6OnN0cmluZyBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkV2ZW50OjpfdG9Eb2N1bWVudCgpew0KICAgIHJldHVybiAiIjsNCn0NCg0KICAgIA0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpFdmVudCYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpFdmVudDo6c3RvcmUoKXsNCiAgICBzdGQ6OnN0cmluZyBfX3RvU3RyaW5nID0gIkV2ZW50OjpzdG9yZSgpOiAiOw0KICAgIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6RXZlbnQgX19yZXNwb25zZSA9IChuZXcgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpFdmVudCgpKS0+Y29kZSgiWyIrdGhpc05vZGUuY29kZSgpKyJAdGltZSIrIl0uRXZlbnQuc3RvcmUoKSIpLm1ldGhvZCgic3RvcmUiKS5jbGFzc05hbWUoIkV2ZW50IikuY2Fycmllcih0aGlzTm9kZSkuc2VuZGVyKHRoaXNOb2RlKS5yZWNpcGllbnQodGhpc05vZGUucGFyZW50KCkpOw0KDQogICAgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpFdmVudCogYW5zd2VyOw0KDQogICAgDQoNCiAgICANCiAgICBpZihhbnN3ZXIhPW51bGxwdHIpew0KICAgIA0KDQogICAgDQogICAgICAgIA0KICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLT5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgDQogICAgDQogICAgfWVsc2V7DQogICAgICAgIGpzb24gX2pSZXQ7DQogICAgICAgIF9qUmV0WyJfX3RoaXMiXSA9IHRoaXMtPl90b0RvY3VtZW50KCk7DQogICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChfalJldCk7DQogICAgICAgIC8vX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogdGhpcy0+X3RvRG9jdW1lbnQoKX0pOw0KICAgIH0NCg0KICAgIC8vX19yZXNwb25zZS50cmlnZ2VyKCk7DQoNCiAgICByZXR1cm4gKmFuc3dlcjsNCn0NCiAgICANCnN0ZDo6dmVjdG9yPGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6RXZlbnQ+JiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkV2ZW50OjpmaW5kQWxsKCl7DQogICAgc3RkOjpzdHJpbmcgX190b1N0cmluZyA9ICJFdmVudDo6ZmluZEFsbCgpOiAiOw0KICAgIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6RXZlbnQgX19yZXNwb25zZSA9IChuZXcgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpFdmVudCgpKS0+Y29kZSgiWyIrdGhpc05vZGUuY29kZSgpKyJAdGltZSIrIl0uRXZlbnQuZmluZEFsbCgpIikubWV0aG9kKCJmaW5kQWxsIikuY2xhc3NOYW1lKCJFdmVudCIpLmNhcnJpZXIodGhpc05vZGUpLnNlbmRlcih0aGlzTm9kZSkucmVjaXBpZW50KHRoaXNOb2RlLnBhcmVudCgpKTsNCg0KICAgIHN0ZDo6dmVjdG9yPGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6RXZlbnQ+KiBhbnN3ZXI7DQoNCiAgICANCg0KICAgIA0KICAgIGlmKGFuc3dlci0+ZW1wdHkoKSl7DQogICAgDQoNCiAgICANCiAgICAgICAgDQogICAgICAgIC8vX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci0+X3RvRG9jdW1lbnQoKSk7DQogICAgICAgIA0KICAgIA0KICAgIH1lbHNlew0KICAgICAgICBqc29uIF9qUmV0Ow0KICAgICAgICBfalJldFsiX190aGlzIl0gPSB0aGlzLT5fdG9Eb2N1bWVudCgpOw0KICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoX2pSZXQpOw0KICAgICAgICAvL19fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHRoaXMtPl90b0RvY3VtZW50KCl9KTsNCiAgICB9DQoNCiAgICAvL19fcmVzcG9uc2UudHJpZ2dlcigpOw0KDQogICAgcmV0dXJuICphbnN3ZXI7DQp9DQogICAgDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkV2ZW50JiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkV2ZW50OjpmaW5kKCl7DQogICAgc3RkOjpzdHJpbmcgX190b1N0cmluZyA9ICJFdmVudDo6ZmluZCgpOiAiOw0KICAgIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6RXZlbnQgX19yZXNwb25zZSA9IChuZXcgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpFdmVudCgpKS0+Y29kZSgiWyIrdGhpc05vZGUuY29kZSgpKyJAdGltZSIrIl0uRXZlbnQuZmluZCgpIikubWV0aG9kKCJmaW5kIikuY2xhc3NOYW1lKCJFdmVudCIpLmNhcnJpZXIodGhpc05vZGUpLnNlbmRlcih0aGlzTm9kZSkucmVjaXBpZW50KHRoaXNOb2RlLnBhcmVudCgpKTsNCg0KICAgIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6RXZlbnQqIGFuc3dlcjsNCg0KICAgIA0KDQogICAgDQogICAgaWYoYW5zd2VyIT1udWxscHRyKXsNCiAgICANCg0KICAgIA0KICAgICAgICANCiAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci0+X3RvRG9jdW1lbnQoKSk7DQogICAgICAgIA0KICAgIA0KICAgIH1lbHNlew0KICAgICAgICBqc29uIF9qUmV0Ow0KICAgICAgICBfalJldFsiX190aGlzIl0gPSB0aGlzLT5fdG9Eb2N1bWVudCgpOw0KICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoX2pSZXQpOw0KICAgICAgICAvL19fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHRoaXMtPl90b0RvY3VtZW50KCl9KTsNCiAgICB9DQoNCiAgICAvL19fcmVzcG9uc2UudHJpZ2dlcigpOw0KDQogICAgcmV0dXJuICphbnN3ZXI7DQp9DQogICAgDQpqc29uIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6RXZlbnQ6Omxpc3Rlbihlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGUmIG5vZGUpew0KICAgIHN0ZDo6c3RyaW5nIF9fdG9TdHJpbmcgPSAiRXZlbnQ6Omxpc3RlbigpOiAiOw0KICAgIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6RXZlbnQgX19yZXNwb25zZSA9IChuZXcgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpFdmVudCgpKS0+Y29kZSgiWyIrdGhpc05vZGUuY29kZSgpKyJAdGltZSIrIl0uRXZlbnQubGlzdGVuKCkiKS5tZXRob2QoImxpc3RlbiIpLmNsYXNzTmFtZSgiRXZlbnQiKS5jYXJyaWVyKHRoaXNOb2RlKS5zZW5kZXIodGhpc05vZGUpLnJlY2lwaWVudCh0aGlzTm9kZS5wYXJlbnQoKSk7DQoNCiAgICBqc29uIGFuc3dlcjsNCg0KICAgIA0KDQogICAgDQogICAgaWYoYW5zd2VyIT1udWxscHRyKXsNCiAgICANCg0KICAgIA0KICAgICAgICAvL19fcmVzcG9uc2UucGF5bG9hZCgoc3RkOjpzdHJpbmcpYW5zd2VyKTsNCiAgICANCiAgICB9ZWxzZXsNCiAgICAgICAganNvbiBfalJldDsNCiAgICAgICAgX2pSZXRbIl9fdGhpcyJdID0gdGhpcy0+X3RvRG9jdW1lbnQoKTsNCiAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKF9qUmV0KTsNCiAgICAgICAgLy9fX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiB0aGlzLT5fdG9Eb2N1bWVudCgpfSk7DQogICAgfQ0KDQogICAgLy9fX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCg0KICAgIHJldHVybiBhbnN3ZXI7DQp9DQogICAgDQpqc29uIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6RXZlbnQ6OnRyaWdnZXIoKXsNCiAgICBzdGQ6OnN0cmluZyBfX3RvU3RyaW5nID0gIkV2ZW50Ojp0cmlnZ2VyKCk6ICI7DQogICAgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpFdmVudCBfX3Jlc3BvbnNlID0gKG5ldyBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkV2ZW50KCkpLT5jb2RlKCJbIit0aGlzTm9kZS5jb2RlKCkrIkB0aW1lIisiXS5FdmVudC50cmlnZ2VyKCkiKS5tZXRob2QoInRyaWdnZXIiKS5jbGFzc05hbWUoIkV2ZW50IikuY2Fycmllcih0aGlzTm9kZSkuc2VuZGVyKHRoaXNOb2RlKS5yZWNpcGllbnQodGhpc05vZGUucGFyZW50KCkpOw0KDQogICAganNvbiBhbnN3ZXI7DQoNCiAgICANCg0KICAgIA0KICAgIGlmKGFuc3dlciE9bnVsbHB0cil7DQogICAgDQoNCiAgICANCiAgICAgICAgLy9fX3Jlc3BvbnNlLnBheWxvYWQoKHN0ZDo6c3RyaW5nKWFuc3dlcik7DQogICAgDQogICAgfWVsc2V7DQogICAgICAgIGpzb24gX2pSZXQ7DQogICAgICAgIF9qUmV0WyJfX3RoaXMiXSA9IHRoaXMtPl90b0RvY3VtZW50KCk7DQogICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChfalJldCk7DQogICAgICAgIC8vX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogdGhpcy0+X3RvRG9jdW1lbnQoKX0pOw0KICAgIH0NCg0KICAgIC8vX19yZXNwb25zZS50cmlnZ2VyKCk7DQoNCiAgICByZXR1cm4gYW5zd2VyOw0KfQ0KICAgIA0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpFdmVudCYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpFdmVudDo6cHJvY2Vzcygpew0KICAgIHN0ZDo6c3RyaW5nIF9fdG9TdHJpbmcgPSAiRXZlbnQ6OnByb2Nlc3MoKTogIjsNCiAgICBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkV2ZW50IF9fcmVzcG9uc2UgPSAobmV3IGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6RXZlbnQoKSktPmNvZGUoIlsiK3RoaXNOb2RlLmNvZGUoKSsiQHRpbWUiKyJdLkV2ZW50LnByb2Nlc3MoKSIpLm1ldGhvZCgicHJvY2VzcyIpLmNsYXNzTmFtZSgiRXZlbnQiKS5jYXJyaWVyKHRoaXNOb2RlKS5zZW5kZXIodGhpc05vZGUpLnJlY2lwaWVudCh0aGlzTm9kZS5wYXJlbnQoKSk7DQoNCiAgICBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkV2ZW50KiBhbnN3ZXI7DQoNCiAgICANCg0KICAgIA0KICAgIGlmKGFuc3dlciE9bnVsbHB0cil7DQogICAgDQoNCiAgICANCiAgICAgICAgDQogICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXItPl90b0RvY3VtZW50KCkpOw0KICAgICAgICANCiAgICANCiAgICB9ZWxzZXsNCiAgICAgICAganNvbiBfalJldDsNCiAgICAgICAgX2pSZXRbIl9fdGhpcyJdID0gdGhpcy0+X3RvRG9jdW1lbnQoKTsNCiAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKF9qUmV0KTsNCiAgICAgICAgLy9fX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiB0aGlzLT5fdG9Eb2N1bWVudCgpfSk7DQogICAgfQ0KDQogICAgLy9fX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCg0KICAgIHJldHVybiAqYW5zd2VyOw0KfQ0KICAgIA0KDQogICAgDQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZSYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlOjphY3RpdmUoYm9vbCB2KXsNCiAgICB0aGlzLT5fYWN0aXZlID0gdjsNCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQoNCmJvb2wgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlOjphY3RpdmUoKXsNCiAgICByZXR1cm4gdGhpcy0+X2FjdGl2ZTsNCn0NCiAgICANCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGU6OmVuYWJsZWQoYm9vbCB2KXsNCiAgICB0aGlzLT5fZW5hYmxlZCA9IHY7DQogICAgcmV0dXJuICp0aGlzOw0KfQ0KICAgIA0KDQpib29sIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZTo6ZW5hYmxlZCgpew0KICAgIHJldHVybiB0aGlzLT5fZW5hYmxlZDsNCn0NCiAgICANCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGU6OmNvZGUoc3RkOjpzdHJpbmcgdil7DQogICAgdGhpcy0+X2NvZGUgPSB2Ow0KICAgIHJldHVybiAqdGhpczsNCn0NCiAgICANCg0Kc3RkOjpzdHJpbmcgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlOjpjb2RlKCl7DQogICAgcmV0dXJuIHRoaXMtPl9jb2RlOw0KfQ0KICAgIA0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGUmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZTo6b3JkZXIoaW50IHYpew0KICAgIHRoaXMtPl9vcmRlciA9IHY7DQogICAgcmV0dXJuICp0aGlzOw0KfQ0KICAgIA0KDQppbnQgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlOjpvcmRlcigpew0KICAgIHJldHVybiB0aGlzLT5fb3JkZXI7DQp9DQogICAgDQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZSYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlOjpkYXRlKHRpbWVfdCB2KXsNCiAgICB0aGlzLT5fZGF0ZSA9IHY7DQogICAgcmV0dXJuICp0aGlzOw0KfQ0KICAgIA0KDQp0aW1lX3QgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlOjpkYXRlKCl7DQogICAgcmV0dXJuIHRoaXMtPl9kYXRlOw0KfQ0KICAgIA0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGUmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZTo6bmFtZShzdGQ6OnN0cmluZyB2KXsNCiAgICB0aGlzLT5fbmFtZSA9IHY7DQogICAgcmV0dXJuICp0aGlzOw0KfQ0KICAgIA0KDQpzdGQ6OnN0cmluZyBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGU6Om5hbWUoKXsNCiAgICByZXR1cm4gdGhpcy0+X25hbWU7DQp9DQogICAgDQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZSYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlOjpyZW1hcmsoc3RkOjpzdHJpbmcgdil7DQogICAgdGhpcy0+X3JlbWFyayA9IHY7DQogICAgcmV0dXJuICp0aGlzOw0KfQ0KICAgIA0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGU6OnJlbWFyayhqc29uIHYpew0KICAgIC8vdGhpcy0+X3JlbWFyaw0KICAgIHJldHVybiAqdGhpczsNCn0NCiAgICANCg0Kc3RkOjpzdHJpbmcgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlOjpyZW1hcmsoKXsNCiAgICByZXR1cm4gdGhpcy0+X3JlbWFyazsNCn0NCiAgICANCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGU6OmFkZHJlc3Moc3RkOjpzdHJpbmcgdil7DQogICAgdGhpcy0+X2FkZHJlc3MgPSB2Ow0KICAgIHJldHVybiAqdGhpczsNCn0NCiAgICANCg0Kc3RkOjpzdHJpbmcgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlOjphZGRyZXNzKCl7DQogICAgcmV0dXJuIHRoaXMtPl9hZGRyZXNzOw0KfQ0KICAgIA0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGUmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZTo6YmFja3VwKGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZSYgdil7DQogICAgdGhpcy0+X2JhY2t1cCA9ICZ2Ow0KICAgIHJldHVybiAqdGhpczsNCn0NCiAgICANCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZSYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlOjpiYWNrdXAoZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlKiB2KXsNCiAgICBpZih2IT1udWxscHRyKXsNCiAgICAgICAgdGhpcy0+X2JhY2t1cCA9IHY7DQogICAgfQ0KICAgIHJldHVybiAqdGhpczsNCn0NCiAgICANCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlKiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGU6OmJhY2t1cCgpew0KICAgIHJldHVybiB0aGlzLT5fYmFja3VwOw0KfQ0KICAgIA0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGUmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZTo6cGFyZW50KGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZSYgdil7DQogICAgdGhpcy0+X3BhcmVudCA9ICZ2Ow0KICAgIHJldHVybiAqdGhpczsNCn0NCiAgICANCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZSYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlOjpwYXJlbnQoZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlKiB2KXsNCiAgICBpZih2IT1udWxscHRyKXsNCiAgICAgICAgdGhpcy0+X3BhcmVudCA9IHY7DQogICAgfQ0KICAgIHJldHVybiAqdGhpczsNCn0NCiAgICANCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlKiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGU6OnBhcmVudCgpew0KICAgIHJldHVybiB0aGlzLT5fcGFyZW50Ow0KfQ0KICAgIA0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGUmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZTo6Z3JvdXAoZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlX0dyb3VwJiB2KXsNCiAgICB0aGlzLT5fZ3JvdXAgPSAmdjsNCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGUmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZTo6Z3JvdXAoZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlX0dyb3VwKiB2KXsNCiAgICBpZih2IT1udWxscHRyKXsNCiAgICAgICAgdGhpcy0+X2dyb3VwID0gdjsNCiAgICB9DQogICAgcmV0dXJuICp0aGlzOw0KfQ0KICAgIA0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGVfR3JvdXAqIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZTo6Z3JvdXAoKXsNCiAgICByZXR1cm4gdGhpcy0+X2dyb3VwOw0KfQ0KICAgIA0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGUmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZTo6Y29udGV4dChlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGVfQ29udGV4dCYgdil7DQogICAgdGhpcy0+X2NvbnRleHQgPSAmdjsNCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGUmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZTo6Y29udGV4dChlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGVfQ29udGV4dCogdil7DQogICAgaWYodiE9bnVsbHB0cil7DQogICAgICAgIHRoaXMtPl9jb250ZXh0ID0gdjsNCiAgICB9DQogICAgcmV0dXJuICp0aGlzOw0KfQ0KICAgIA0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGVfQ29udGV4dCogZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlOjpjb250ZXh0KCl7DQogICAgcmV0dXJuIHRoaXMtPl9jb250ZXh0Ow0KfQ0KICAgIA0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGUmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZTo6cG9ydChpbnQgdil7DQogICAgdGhpcy0+X3BvcnQgPSB2Ow0KICAgIHJldHVybiAqdGhpczsNCn0NCiAgICANCg0KaW50IGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZTo6cG9ydCgpew0KICAgIHJldHVybiB0aGlzLT5fcG9ydDsNCn0NCiAgICANCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGU6Om9ubGluZSh0aW1lX3Qgdil7DQogICAgdGhpcy0+X29ubGluZSA9IHY7DQogICAgcmV0dXJuICp0aGlzOw0KfQ0KICAgIA0KDQp0aW1lX3QgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlOjpvbmxpbmUoKXsNCiAgICByZXR1cm4gdGhpcy0+X29ubGluZTsNCn0NCiAgICANCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGU6OnNlY3VyZShib29sIHYpew0KICAgIHRoaXMtPl9zZWN1cmUgPSB2Ow0KICAgIHJldHVybiAqdGhpczsNCn0NCiAgICANCg0KYm9vbCBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGU6OnNlY3VyZSgpew0KICAgIHJldHVybiB0aGlzLT5fc2VjdXJlOw0KfQ0KICAgIA0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGUmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZTo6dHlwZShlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGVfVHlwZSYgdil7DQogICAgdGhpcy0+X3R5cGUgPSAmdjsNCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGUmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZTo6dHlwZShlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGVfVHlwZSogdil7DQogICAgaWYodiE9bnVsbHB0cil7DQogICAgICAgIHRoaXMtPl90eXBlID0gdjsNCiAgICB9DQogICAgcmV0dXJuICp0aGlzOw0KfQ0KICAgIA0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGVfVHlwZSogZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlOjp0eXBlKCl7DQogICAgcmV0dXJuIHRoaXMtPl90eXBlOw0KfQ0KICAgIA0KDQogICAgDQpzdGQ6OnZlY3RvcjxzdGQ6OmFueT4mJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGU6OmNvbnRyb2xsZXJfRGV2aWNlcygpew0KICAgIHJldHVybiBtb3ZlKCoodGhpcy0+X2NvbnRyb2xsZXJfRGV2aWNlcykpOw0KfQ0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGUmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZTo6Y29udHJvbGxlcl9EZXZpY2VzKHN0ZDo6dmVjdG9yPHN0ZDo6YW55PiYmIHYpew0KICAgIHJldHVybiAqdGhpczsNCn0NCiAgICANCnN0ZDo6dmVjdG9yPHN0ZDo6YW55PiYmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZTo6bm9kZV9Db25maWdzKCl7DQogICAgcmV0dXJuIG1vdmUoKih0aGlzLT5fbm9kZV9Db25maWdzKSk7DQp9DQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZSYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlOjpub2RlX0NvbmZpZ3Moc3RkOjp2ZWN0b3I8c3RkOjphbnk+JiYgdil7DQogICAgcmV0dXJuICp0aGlzOw0KfQ0KICAgIA0Kc3RkOjp2ZWN0b3I8c3RkOjphbnk+JiYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlOjpjYXJyaWVyX0V2ZW50cygpew0KICAgIHJldHVybiBtb3ZlKCoodGhpcy0+X2NhcnJpZXJfRXZlbnRzKSk7DQp9DQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZSYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlOjpjYXJyaWVyX0V2ZW50cyhzdGQ6OnZlY3RvcjxzdGQ6OmFueT4mJiB2KXsNCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQpzdGQ6OnZlY3RvcjxzdGQ6OmFueT4mJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGU6OnNlbmRlcl9FdmVudHMoKXsNCiAgICByZXR1cm4gbW92ZSgqKHRoaXMtPl9zZW5kZXJfRXZlbnRzKSk7DQp9DQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZSYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlOjpzZW5kZXJfRXZlbnRzKHN0ZDo6dmVjdG9yPHN0ZDo6YW55PiYmIHYpew0KICAgIHJldHVybiAqdGhpczsNCn0NCiAgICANCnN0ZDo6dmVjdG9yPHN0ZDo6YW55PiYmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZTo6cmVjaXBpZW50X0V2ZW50cygpew0KICAgIHJldHVybiBtb3ZlKCoodGhpcy0+X3JlY2lwaWVudF9FdmVudHMpKTsNCn0NCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGU6OnJlY2lwaWVudF9FdmVudHMoc3RkOjp2ZWN0b3I8c3RkOjphbnk+JiYgdil7DQogICAgcmV0dXJuICp0aGlzOw0KfQ0KICAgIA0Kc3RkOjp2ZWN0b3I8c3RkOjphbnk+JiYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlOjpiYWNrdXBfTm9kZXMoKXsNCiAgICByZXR1cm4gbW92ZSgqKHRoaXMtPl9iYWNrdXBfTm9kZXMpKTsNCn0NCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGU6OmJhY2t1cF9Ob2RlcyhzdGQ6OnZlY3RvcjxzdGQ6OmFueT4mJiB2KXsNCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQpzdGQ6OnZlY3RvcjxzdGQ6OmFueT4mJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGU6OnBhcmVudF9Ob2Rlcygpew0KICAgIHJldHVybiBtb3ZlKCoodGhpcy0+X3BhcmVudF9Ob2RlcykpOw0KfQ0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGUmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZTo6cGFyZW50X05vZGVzKHN0ZDo6dmVjdG9yPHN0ZDo6YW55PiYmIHYpew0KICAgIHJldHVybiAqdGhpczsNCn0NCiAgICANCg0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGUmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZTo6X3VuaXF1ZSgpew0KICAgIHN0ZDo6c3RyaW5nIF9fdG9TdHJpbmcgPSAiTm9kZTo6X3VuaXF1ZSgpOiAiOw0KDQogICAgTm9kZSogcmV0ID0gbmV3IE5vZGUoKTsNCiAgICBpZih0aGlzLT5JZCE9MCkgcmV0LT5JZCA9IHRoaXMtPklkOw0KICAgIA0KICAgICAgICANCiAgICBpZih0aGlzLT5jb2RlKCkuZW1wdHkoKSkNCiAgICAgICAgDQogICAgICAgIHJldC0+Y29kZSh0aGlzLT5jb2RlKCkpOw0KICAgIA0KDQogICAgcmV0dXJuICp0aGlzOw0KfQ0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGUmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZTo6X2Zyb21Eb2N1bWVudCh1bnNpZ25lZCBjaGFyKiBvYmopew0KICAgIHJldHVybiB0aGlzLT5fZnJvbURvY3VtZW50KHN0ZDo6c3RyaW5nKCBvYmosIG9iaiArIHNpemVvZiBvYmogLyBzaXplb2Ygb2JqWzBdICkpOw0KfQ0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGUmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZTo6X2Zyb21Eb2N1bWVudChzdGQ6OnN0cmluZyBvYmopew0KICAgIGlmKG9iai5lbXB0eSgpKSByZXR1cm4gKnRoaXM7DQoNCiAgICBpZiAoc3RkOjpyZWdleF9tYXRjaChvYmosIHN0ZDo6cmVnZXgoUiIiKCgoW0EtWmEtel17Myw5fTooPzovLyk/KSg/OlstOzomPSskLHddK0ApP1tBLVphLXowLTkuLV0rfCg/Ond3dy58Wy07OiY9KyQsd10rQClbQS1aYS16MC05Li1dKykoKD86L1srfiUvLnctX10qKT8/Pyg/OlstKz0mOyVALndfXSopIz8oPzpbd10qKSk/KSIiKSkpew0KICAgICAgICBzdGQ6OnN0cmluZyByZWFkQnVmZmVyOw0KICAgICAgICBDVVJMICpjdXJsID0gY3VybF9lYXN5X2luaXQoKTsNCiAgICAgICAgY3VybF9lYXN5X3NldG9wdChjdXJsLCBDVVJMT1BUX1VSTCwgb2JqKTsNCiAgICAgICAgY3VybF9lYXN5X3NldG9wdChjdXJsLCBDVVJMT1BUX0ZPTExPV0xPQ0FUSU9OLCAxTCk7DQogICAgICAgIC8vY3VybF9lYXN5X3NldG9wdChjdXJsLCBDVVJMT1BUX1dSSVRFRlVOQ1RJT04sICtbXSh2b2lkICpwdHIsIHNpemVfdCBzaXplLCBzaXplX3Qgbm1lbWIsIHZvaWQgKnN0cmVhbSkgLT4gc2l6ZV90IHsgcmVhZEJ1ZmZlci5hcHBlbmQoKnB0ciwgc2l6ZSAqIG5tZW1iKTsgfSk7DQogICAgICAgIGN1cmxfZWFzeV9zZXRvcHQoY3VybCwgQ1VSTE9QVF9XUklURURBVEEsICZyZWFkQnVmZmVyKTsNCiAgICAgICAgY3VybF9lYXN5X3BlcmZvcm0oY3VybCk7DQogICAgICAgIGN1cmxfZWFzeV9jbGVhbnVwKGN1cmwpOw0KICAgICAgICByZXR1cm4gdGhpcy0+X2Zyb21Eb2N1bWVudChyZWFkQnVmZmVyKTsNCiAgICB9DQoNCiAgICByZXR1cm4gdGhpcy0+X2Zyb21Eb2N1bWVudChqc29uOjpwYXJzZShvYmopKTsNCn0NCg0Kc3RkOjp2ZWN0b3I8ZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlPiYmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZTo6X2Zyb21Eb2N1bWVudChzdGQ6OnZlY3Rvcjxqc29uPiYmIG9iail7DQogICAgc3RkOjp2ZWN0b3I8Tm9kZT4qIHJldCA9IG5ldyBzdGQ6OnZlY3RvcjxOb2RlPihvYmouc2l6ZSgpKTsNCiAgICANCiAgICBmb3IgKGNvbnN0IGpzb24mIGogOiBvYmopew0KICAgICAgICByZXQtPnB1c2hfYmFjaygobmV3IE5vZGUoKSktPl9mcm9tRG9jdW1lbnQoaikpOw0KICAgIH0NCiAgICANCiAgICByZXR1cm4gbW92ZSgqcmV0KTsNCn0NCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGU6Ol9mcm9tRG9jdW1lbnQoanNvbiBvYmopew0KICAgIA0KICAgIGlmKG9iai5jb250YWlucygiYWN0aXZlIikpIHRoaXMtPmFjdGl2ZSgNCiAgICAgICAgDQogICAgICAgIG9ialsiYWN0aXZlIl0udGVtcGxhdGUgZ2V0PGJvb2w+KCkNCiAgICAgICAgDQogICAgICAgICk7DQogICAgDQogICAgaWYob2JqLmNvbnRhaW5zKCJlbmFibGVkIikpIHRoaXMtPmVuYWJsZWQoDQogICAgICAgIA0KICAgICAgICBvYmpbImVuYWJsZWQiXS50ZW1wbGF0ZSBnZXQ8Ym9vbD4oKQ0KICAgICAgICANCiAgICAgICAgKTsNCiAgICANCiAgICBpZihvYmouY29udGFpbnMoImNvZGUiKSkgdGhpcy0+Y29kZSgNCiAgICAgICAgDQogICAgICAgIG9ialsiY29kZSJdLnRlbXBsYXRlIGdldDxzdGQ6OnN0cmluZz4oKQ0KICAgICAgICANCiAgICAgICAgKTsNCiAgICANCiAgICBpZihvYmouY29udGFpbnMoIm9yZGVyIikpIHRoaXMtPm9yZGVyKA0KICAgICAgICANCiAgICAgICAgb2JqWyJvcmRlciJdLnRlbXBsYXRlIGdldDxpbnQ+KCkNCiAgICAgICAgDQogICAgICAgICk7DQogICAgDQogICAgaWYob2JqLmNvbnRhaW5zKCJkYXRlIikpIHRoaXMtPmRhdGUoDQogICAgICAgIA0KICAgICAgICBvYmpbImRhdGUiXS50ZW1wbGF0ZSBnZXQ8dGltZV90PigpDQogICAgICAgIA0KICAgICAgICApOw0KICAgIA0KICAgIGlmKG9iai5jb250YWlucygibmFtZSIpKSB0aGlzLT5uYW1lKA0KICAgICAgICANCiAgICAgICAgb2JqWyJuYW1lIl0udGVtcGxhdGUgZ2V0PHN0ZDo6c3RyaW5nPigpDQogICAgICAgIA0KICAgICAgICApOw0KICAgIA0KICAgIGlmKG9iai5jb250YWlucygicmVtYXJrIikpIHRoaXMtPnJlbWFyaygNCiAgICAgICAgDQogICAgICAgIG9ialsicmVtYXJrIl0udGVtcGxhdGUgZ2V0PHN0ZDo6c3RyaW5nPigpDQogICAgICAgIA0KICAgICAgICApOw0KICAgIA0KICAgIGlmKG9iai5jb250YWlucygiYWRkcmVzcyIpKSB0aGlzLT5hZGRyZXNzKA0KICAgICAgICANCiAgICAgICAgb2JqWyJhZGRyZXNzIl0udGVtcGxhdGUgZ2V0PHN0ZDo6c3RyaW5nPigpDQogICAgICAgIA0KICAgICAgICApOw0KICAgIA0KICAgIGlmKG9iai5jb250YWlucygiYmFja3VwIikpIHRoaXMtPmJhY2t1cCgNCiAgICAgICAgDQogICAgICAgIChuZXcgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlKCkpLT5fZnJvbURvY3VtZW50KG9ialsiYmFja3VwIl0pDQogICAgICAgIA0KICAgICAgICApOw0KICAgIA0KICAgIGlmKG9iai5jb250YWlucygicGFyZW50IikpIHRoaXMtPnBhcmVudCgNCiAgICAgICAgDQogICAgICAgIChuZXcgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlKCkpLT5fZnJvbURvY3VtZW50KG9ialsicGFyZW50Il0pDQogICAgICAgIA0KICAgICAgICApOw0KICAgIA0KICAgIGlmKG9iai5jb250YWlucygiZ3JvdXAiKSkgdGhpcy0+Z3JvdXAoDQogICAgICAgIA0KICAgICAgICAobmV3IGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZV9Hcm91cCgpKS0+X2Zyb21Eb2N1bWVudChvYmpbImdyb3VwIl0pDQogICAgICAgIA0KICAgICAgICApOw0KICAgIA0KICAgIGlmKG9iai5jb250YWlucygiY29udGV4dCIpKSB0aGlzLT5jb250ZXh0KA0KICAgICAgICANCiAgICAgICAgKG5ldyBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGVfQ29udGV4dCgpKS0+X2Zyb21Eb2N1bWVudChvYmpbImNvbnRleHQiXSkNCiAgICAgICAgDQogICAgICAgICk7DQogICAgDQogICAgaWYob2JqLmNvbnRhaW5zKCJwb3J0IikpIHRoaXMtPnBvcnQoDQogICAgICAgIA0KICAgICAgICBvYmpbInBvcnQiXS50ZW1wbGF0ZSBnZXQ8aW50PigpDQogICAgICAgIA0KICAgICAgICApOw0KICAgIA0KICAgIGlmKG9iai5jb250YWlucygib25saW5lIikpIHRoaXMtPm9ubGluZSgNCiAgICAgICAgDQogICAgICAgIG9ialsib25saW5lIl0udGVtcGxhdGUgZ2V0PHRpbWVfdD4oKQ0KICAgICAgICANCiAgICAgICAgKTsNCiAgICANCiAgICBpZihvYmouY29udGFpbnMoInNlY3VyZSIpKSB0aGlzLT5zZWN1cmUoDQogICAgICAgIA0KICAgICAgICBvYmpbInNlY3VyZSJdLnRlbXBsYXRlIGdldDxib29sPigpDQogICAgICAgIA0KICAgICAgICApOw0KICAgIA0KICAgIGlmKG9iai5jb250YWlucygidHlwZSIpKSB0aGlzLT50eXBlKA0KICAgICAgICANCiAgICAgICAgKG5ldyBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGVfVHlwZSgpKS0+X2Zyb21Eb2N1bWVudChvYmpbInR5cGUiXSkNCiAgICAgICAgDQogICAgICAgICk7DQogICAgDQogICAgDQogICAgDQogICAgaWYob2JqLmNvbnRhaW5zKCJjb250cm9sbGVyX0RldmljZXMiKSkgdGhpcy0+Y29udHJvbGxlcl9EZXZpY2VzKChuZXcgRGV2aWNlKCkpLT5fZnJvbURvY3VtZW50KChzdGQ6OnZlY3Rvcjxqc29uPilvYmpbImNvbnRyb2xsZXJfRGV2aWNlcyJdKSk7DQogICAgDQogICAgaWYob2JqLmNvbnRhaW5zKCJub2RlX0NvbmZpZ3MiKSkgdGhpcy0+bm9kZV9Db25maWdzKChuZXcgQ29uZmlnKCkpLT5fZnJvbURvY3VtZW50KChzdGQ6OnZlY3Rvcjxqc29uPilvYmpbIm5vZGVfQ29uZmlncyJdKSk7DQogICAgDQogICAgaWYob2JqLmNvbnRhaW5zKCJjYXJyaWVyX0V2ZW50cyIpKSB0aGlzLT5jYXJyaWVyX0V2ZW50cygobmV3IEV2ZW50KCkpLT5fZnJvbURvY3VtZW50KChzdGQ6OnZlY3Rvcjxqc29uPilvYmpbImNhcnJpZXJfRXZlbnRzIl0pKTsNCiAgICANCiAgICBpZihvYmouY29udGFpbnMoInNlbmRlcl9FdmVudHMiKSkgdGhpcy0+c2VuZGVyX0V2ZW50cygobmV3IEV2ZW50KCkpLT5fZnJvbURvY3VtZW50KChzdGQ6OnZlY3Rvcjxqc29uPilvYmpbInNlbmRlcl9FdmVudHMiXSkpOw0KICAgIA0KICAgIGlmKG9iai5jb250YWlucygicmVjaXBpZW50X0V2ZW50cyIpKSB0aGlzLT5yZWNpcGllbnRfRXZlbnRzKChuZXcgRXZlbnQoKSktPl9mcm9tRG9jdW1lbnQoKHN0ZDo6dmVjdG9yPGpzb24+KW9ialsicmVjaXBpZW50X0V2ZW50cyJdKSk7DQogICAgDQogICAgaWYob2JqLmNvbnRhaW5zKCJiYWNrdXBfTm9kZXMiKSkgdGhpcy0+YmFja3VwX05vZGVzKChuZXcgTm9kZSgpKS0+X2Zyb21Eb2N1bWVudCgoc3RkOjp2ZWN0b3I8anNvbj4pb2JqWyJiYWNrdXBfTm9kZXMiXSkpOw0KICAgIA0KICAgIGlmKG9iai5jb250YWlucygicGFyZW50X05vZGVzIikpIHRoaXMtPnBhcmVudF9Ob2RlcygobmV3IE5vZGUoKSktPl9mcm9tRG9jdW1lbnQoKHN0ZDo6dmVjdG9yPGpzb24+KW9ialsicGFyZW50X05vZGVzIl0pKTsNCiAgICANCiAgICByZXR1cm4gKnRoaXM7DQp9DQoNCnN0ZDo6c3RyaW5nIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZTo6X3RvRG9jdW1lbnQoKXsNCiAgICByZXR1cm4gIiI7DQp9DQoNCiAgICANCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZSYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlOjpzdG9yZSgpew0KICAgIHN0ZDo6c3RyaW5nIF9fdG9TdHJpbmcgPSAiTm9kZTo6c3RvcmUoKTogIjsNCiAgICBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkV2ZW50IF9fcmVzcG9uc2UgPSAobmV3IGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6RXZlbnQoKSktPmNvZGUoIlsiK3RoaXNOb2RlLmNvZGUoKSsiQHRpbWUiKyJdLk5vZGUuc3RvcmUoKSIpLm1ldGhvZCgic3RvcmUiKS5jbGFzc05hbWUoIk5vZGUiKS5jYXJyaWVyKHRoaXNOb2RlKS5zZW5kZXIodGhpc05vZGUpLnJlY2lwaWVudCh0aGlzTm9kZS5wYXJlbnQoKSk7DQoNCiAgICBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGUqIGFuc3dlcjsNCg0KICAgIA0KDQogICAgDQogICAgaWYoYW5zd2VyIT1udWxscHRyKXsNCiAgICANCg0KICAgIA0KICAgICAgICANCiAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci0+X3RvRG9jdW1lbnQoKSk7DQogICAgICAgIA0KICAgIA0KICAgIH1lbHNlew0KICAgICAgICBqc29uIF9qUmV0Ow0KICAgICAgICBfalJldFsiX190aGlzIl0gPSB0aGlzLT5fdG9Eb2N1bWVudCgpOw0KICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoX2pSZXQpOw0KICAgICAgICAvL19fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHRoaXMtPl90b0RvY3VtZW50KCl9KTsNCiAgICB9DQoNCiAgICAvL19fcmVzcG9uc2UudHJpZ2dlcigpOw0KDQogICAgcmV0dXJuICphbnN3ZXI7DQp9DQogICAgDQpzdGQ6OnZlY3Rvcjxlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGU+JiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGU6OmZpbmRBbGwoKXsNCiAgICBzdGQ6OnN0cmluZyBfX3RvU3RyaW5nID0gIk5vZGU6OmZpbmRBbGwoKTogIjsNCiAgICBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkV2ZW50IF9fcmVzcG9uc2UgPSAobmV3IGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6RXZlbnQoKSktPmNvZGUoIlsiK3RoaXNOb2RlLmNvZGUoKSsiQHRpbWUiKyJdLk5vZGUuZmluZEFsbCgpIikubWV0aG9kKCJmaW5kQWxsIikuY2xhc3NOYW1lKCJOb2RlIikuY2Fycmllcih0aGlzTm9kZSkuc2VuZGVyKHRoaXNOb2RlKS5yZWNpcGllbnQodGhpc05vZGUucGFyZW50KCkpOw0KDQogICAgc3RkOjp2ZWN0b3I8ZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlPiogYW5zd2VyOw0KDQogICAgDQoNCiAgICANCiAgICBpZihhbnN3ZXItPmVtcHR5KCkpew0KICAgIA0KDQogICAgDQogICAgICAgIA0KICAgICAgICAvL19fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXItPl90b0RvY3VtZW50KCkpOw0KICAgICAgICANCiAgICANCiAgICB9ZWxzZXsNCiAgICAgICAganNvbiBfalJldDsNCiAgICAgICAgX2pSZXRbIl9fdGhpcyJdID0gdGhpcy0+X3RvRG9jdW1lbnQoKTsNCiAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKF9qUmV0KTsNCiAgICAgICAgLy9fX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiB0aGlzLT5fdG9Eb2N1bWVudCgpfSk7DQogICAgfQ0KDQogICAgLy9fX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCg0KICAgIHJldHVybiAqYW5zd2VyOw0KfQ0KICAgIA0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGU6OmZpbmQoKXsNCiAgICBzdGQ6OnN0cmluZyBfX3RvU3RyaW5nID0gIk5vZGU6OmZpbmQoKTogIjsNCiAgICBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkV2ZW50IF9fcmVzcG9uc2UgPSAobmV3IGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6RXZlbnQoKSktPmNvZGUoIlsiK3RoaXNOb2RlLmNvZGUoKSsiQHRpbWUiKyJdLk5vZGUuZmluZCgpIikubWV0aG9kKCJmaW5kIikuY2xhc3NOYW1lKCJOb2RlIikuY2Fycmllcih0aGlzTm9kZSkuc2VuZGVyKHRoaXNOb2RlKS5yZWNpcGllbnQodGhpc05vZGUucGFyZW50KCkpOw0KDQogICAgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlKiBhbnN3ZXI7DQoNCiAgICANCg0KICAgIA0KICAgIGlmKGFuc3dlciE9bnVsbHB0cil7DQogICAgDQoNCiAgICANCiAgICAgICAgDQogICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXItPl90b0RvY3VtZW50KCkpOw0KICAgICAgICANCiAgICANCiAgICB9ZWxzZXsNCiAgICAgICAganNvbiBfalJldDsNCiAgICAgICAgX2pSZXRbIl9fdGhpcyJdID0gdGhpcy0+X3RvRG9jdW1lbnQoKTsNCiAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKF9qUmV0KTsNCiAgICAgICAgLy9fX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiB0aGlzLT5fdG9Eb2N1bWVudCgpfSk7DQogICAgfQ0KDQogICAgLy9fX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCg0KICAgIHJldHVybiAqYW5zd2VyOw0KfQ0KICAgIA0KanNvbiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGU6OmF1dGhDb2RlKHN0ZDo6c3RyaW5nIGNvZGUsIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6VG9vbCYgdG9vbCl7DQogICAgc3RkOjpzdHJpbmcgX190b1N0cmluZyA9ICJOb2RlOjphdXRoQ29kZSgpOiAiOw0KICAgIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6RXZlbnQgX19yZXNwb25zZSA9IChuZXcgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpFdmVudCgpKS0+Y29kZSgiWyIrdGhpc05vZGUuY29kZSgpKyJAdGltZSIrIl0uTm9kZS5hdXRoQ29kZSgpIikubWV0aG9kKCJhdXRoQ29kZSIpLmNsYXNzTmFtZSgiTm9kZSIpLmNhcnJpZXIodGhpc05vZGUpLnNlbmRlcih0aGlzTm9kZSkucmVjaXBpZW50KHRoaXNOb2RlLnBhcmVudCgpKTsNCg0KICAgIGpzb24gYW5zd2VyOw0KDQogICAgDQoNCiAgICANCiAgICBpZihhbnN3ZXIhPW51bGxwdHIpew0KICAgIA0KDQogICAgDQogICAgICAgIC8vX19yZXNwb25zZS5wYXlsb2FkKChzdGQ6OnN0cmluZylhbnN3ZXIpOw0KICAgIA0KICAgIH1lbHNlew0KICAgICAgICBqc29uIF9qUmV0Ow0KICAgICAgICBfalJldFsiX190aGlzIl0gPSB0aGlzLT5fdG9Eb2N1bWVudCgpOw0KICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoX2pSZXQpOw0KICAgICAgICAvL19fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHRoaXMtPl90b0RvY3VtZW50KCl9KTsNCiAgICB9DQoNCiAgICAvL19fcmVzcG9uc2UudHJpZ2dlcigpOw0KDQogICAgcmV0dXJuIGFuc3dlcjsNCn0NCiAgICANCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZSYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlOjppbml0KGludCBvbmxpbmUsIHN0ZDo6c3RyaW5nIGNvZGUsIHN0ZDo6c3RyaW5nIHVpZCl7DQogICAgc3RkOjpzdHJpbmcgX190b1N0cmluZyA9ICJOb2RlOjppbml0KCk6ICI7DQogICAgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpFdmVudCBfX3Jlc3BvbnNlID0gKG5ldyBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkV2ZW50KCkpLT5jb2RlKCJbIit0aGlzTm9kZS5jb2RlKCkrIkB0aW1lIisiXS5Ob2RlLmluaXQoKSIpLm1ldGhvZCgiaW5pdCIpLmNsYXNzTmFtZSgiTm9kZSIpLmNhcnJpZXIodGhpc05vZGUpLnNlbmRlcih0aGlzTm9kZSkucmVjaXBpZW50KHRoaXNOb2RlLnBhcmVudCgpKTsNCg0KICAgIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZSogYW5zd2VyOw0KDQogICAgDQoNCiAgICANCiAgICBpZihhbnN3ZXIhPW51bGxwdHIpew0KICAgIA0KDQogICAgDQogICAgICAgIA0KICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLT5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgDQogICAgDQogICAgfWVsc2V7DQogICAgICAgIGpzb24gX2pSZXQ7DQogICAgICAgIF9qUmV0WyJfX3RoaXMiXSA9IHRoaXMtPl90b0RvY3VtZW50KCk7DQogICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChfalJldCk7DQogICAgICAgIC8vX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogdGhpcy0+X3RvRG9jdW1lbnQoKX0pOw0KICAgIH0NCg0KICAgIC8vX19yZXNwb25zZS50cmlnZ2VyKCk7DQoNCiAgICByZXR1cm4gKmFuc3dlcjsNCn0NCiAgICANCg0KICAgIA0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGVfQ29udGV4dCYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlX0NvbnRleHQ6OmFjdGl2ZShib29sIHYpew0KICAgIHRoaXMtPl9hY3RpdmUgPSB2Ow0KICAgIHJldHVybiAqdGhpczsNCn0NCiAgICANCg0KYm9vbCBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGVfQ29udGV4dDo6YWN0aXZlKCl7DQogICAgcmV0dXJuIHRoaXMtPl9hY3RpdmU7DQp9DQogICAgDQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZV9Db250ZXh0JiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGVfQ29udGV4dDo6ZW5hYmxlZChib29sIHYpew0KICAgIHRoaXMtPl9lbmFibGVkID0gdjsNCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQoNCmJvb2wgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlX0NvbnRleHQ6OmVuYWJsZWQoKXsNCiAgICByZXR1cm4gdGhpcy0+X2VuYWJsZWQ7DQp9DQogICAgDQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZV9Db250ZXh0JiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGVfQ29udGV4dDo6Y29kZShzdGQ6OnN0cmluZyB2KXsNCiAgICB0aGlzLT5fY29kZSA9IHY7DQogICAgcmV0dXJuICp0aGlzOw0KfQ0KICAgIA0KDQpzdGQ6OnN0cmluZyBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGVfQ29udGV4dDo6Y29kZSgpew0KICAgIHJldHVybiB0aGlzLT5fY29kZTsNCn0NCiAgICANCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlX0NvbnRleHQmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZV9Db250ZXh0OjpvcmRlcihpbnQgdil7DQogICAgdGhpcy0+X29yZGVyID0gdjsNCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQoNCmludCBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGVfQ29udGV4dDo6b3JkZXIoKXsNCiAgICByZXR1cm4gdGhpcy0+X29yZGVyOw0KfQ0KICAgIA0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGVfQ29udGV4dCYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlX0NvbnRleHQ6OmRhdGUodGltZV90IHYpew0KICAgIHRoaXMtPl9kYXRlID0gdjsNCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQoNCnRpbWVfdCBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGVfQ29udGV4dDo6ZGF0ZSgpew0KICAgIHJldHVybiB0aGlzLT5fZGF0ZTsNCn0NCiAgICANCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlX0NvbnRleHQmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZV9Db250ZXh0OjpuYW1lKHN0ZDo6c3RyaW5nIHYpew0KICAgIHRoaXMtPl9uYW1lID0gdjsNCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQoNCnN0ZDo6c3RyaW5nIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZV9Db250ZXh0OjpuYW1lKCl7DQogICAgcmV0dXJuIHRoaXMtPl9uYW1lOw0KfQ0KICAgIA0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGVfQ29udGV4dCYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlX0NvbnRleHQ6OnJlbWFyayhzdGQ6OnN0cmluZyB2KXsNCiAgICB0aGlzLT5fcmVtYXJrID0gdjsNCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGVfQ29udGV4dCYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlX0NvbnRleHQ6OnJlbWFyayhqc29uIHYpew0KICAgIC8vdGhpcy0+X3JlbWFyaw0KICAgIHJldHVybiAqdGhpczsNCn0NCiAgICANCg0Kc3RkOjpzdHJpbmcgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlX0NvbnRleHQ6OnJlbWFyaygpew0KICAgIHJldHVybiB0aGlzLT5fcmVtYXJrOw0KfQ0KICAgIA0KDQogICAgDQpzdGQ6OnZlY3RvcjxzdGQ6OmFueT4mJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGVfQ29udGV4dDo6Y29udGV4dF9Ob2Rlcygpew0KICAgIHJldHVybiBtb3ZlKCoodGhpcy0+X2NvbnRleHRfTm9kZXMpKTsNCn0NCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlX0NvbnRleHQmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZV9Db250ZXh0Ojpjb250ZXh0X05vZGVzKHN0ZDo6dmVjdG9yPHN0ZDo6YW55PiYmIHYpew0KICAgIHJldHVybiAqdGhpczsNCn0NCiAgICANCg0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGVfQ29udGV4dCYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlX0NvbnRleHQ6Ol91bmlxdWUoKXsNCiAgICBzdGQ6OnN0cmluZyBfX3RvU3RyaW5nID0gIk5vZGVfQ29udGV4dDo6X3VuaXF1ZSgpOiAiOw0KDQogICAgTm9kZV9Db250ZXh0KiByZXQgPSBuZXcgTm9kZV9Db250ZXh0KCk7DQogICAgaWYodGhpcy0+SWQhPTApIHJldC0+SWQgPSB0aGlzLT5JZDsNCiAgICANCiAgICAgICAgDQogICAgaWYodGhpcy0+Y29kZSgpLmVtcHR5KCkpDQogICAgICAgIA0KICAgICAgICByZXQtPmNvZGUodGhpcy0+Y29kZSgpKTsNCiAgICANCg0KICAgIHJldHVybiAqdGhpczsNCn0NCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlX0NvbnRleHQmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZV9Db250ZXh0OjpfZnJvbURvY3VtZW50KHVuc2lnbmVkIGNoYXIqIG9iail7DQogICAgcmV0dXJuIHRoaXMtPl9mcm9tRG9jdW1lbnQoc3RkOjpzdHJpbmcoIG9iaiwgb2JqICsgc2l6ZW9mIG9iaiAvIHNpemVvZiBvYmpbMF0gKSk7DQp9DQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZV9Db250ZXh0JiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGVfQ29udGV4dDo6X2Zyb21Eb2N1bWVudChzdGQ6OnN0cmluZyBvYmopew0KICAgIGlmKG9iai5lbXB0eSgpKSByZXR1cm4gKnRoaXM7DQoNCiAgICBpZiAoc3RkOjpyZWdleF9tYXRjaChvYmosIHN0ZDo6cmVnZXgoUiIiKCgoW0EtWmEtel17Myw5fTooPzovLyk/KSg/OlstOzomPSskLHddK0ApP1tBLVphLXowLTkuLV0rfCg/Ond3dy58Wy07OiY9KyQsd10rQClbQS1aYS16MC05Li1dKykoKD86L1srfiUvLnctX10qKT8/Pyg/OlstKz0mOyVALndfXSopIz8oPzpbd10qKSk/KSIiKSkpew0KICAgICAgICBzdGQ6OnN0cmluZyByZWFkQnVmZmVyOw0KICAgICAgICBDVVJMICpjdXJsID0gY3VybF9lYXN5X2luaXQoKTsNCiAgICAgICAgY3VybF9lYXN5X3NldG9wdChjdXJsLCBDVVJMT1BUX1VSTCwgb2JqKTsNCiAgICAgICAgY3VybF9lYXN5X3NldG9wdChjdXJsLCBDVVJMT1BUX0ZPTExPV0xPQ0FUSU9OLCAxTCk7DQogICAgICAgIC8vY3VybF9lYXN5X3NldG9wdChjdXJsLCBDVVJMT1BUX1dSSVRFRlVOQ1RJT04sICtbXSh2b2lkICpwdHIsIHNpemVfdCBzaXplLCBzaXplX3Qgbm1lbWIsIHZvaWQgKnN0cmVhbSkgLT4gc2l6ZV90IHsgcmVhZEJ1ZmZlci5hcHBlbmQoKnB0ciwgc2l6ZSAqIG5tZW1iKTsgfSk7DQogICAgICAgIGN1cmxfZWFzeV9zZXRvcHQoY3VybCwgQ1VSTE9QVF9XUklURURBVEEsICZyZWFkQnVmZmVyKTsNCiAgICAgICAgY3VybF9lYXN5X3BlcmZvcm0oY3VybCk7DQogICAgICAgIGN1cmxfZWFzeV9jbGVhbnVwKGN1cmwpOw0KICAgICAgICByZXR1cm4gdGhpcy0+X2Zyb21Eb2N1bWVudChyZWFkQnVmZmVyKTsNCiAgICB9DQoNCiAgICByZXR1cm4gdGhpcy0+X2Zyb21Eb2N1bWVudChqc29uOjpwYXJzZShvYmopKTsNCn0NCg0Kc3RkOjp2ZWN0b3I8ZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlX0NvbnRleHQ+JiYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlX0NvbnRleHQ6Ol9mcm9tRG9jdW1lbnQoc3RkOjp2ZWN0b3I8anNvbj4mJiBvYmopew0KICAgIHN0ZDo6dmVjdG9yPE5vZGVfQ29udGV4dD4qIHJldCA9IG5ldyBzdGQ6OnZlY3RvcjxOb2RlX0NvbnRleHQ+KG9iai5zaXplKCkpOw0KICAgIA0KICAgIGZvciAoY29uc3QganNvbiYgaiA6IG9iail7DQogICAgICAgIHJldC0+cHVzaF9iYWNrKChuZXcgTm9kZV9Db250ZXh0KCkpLT5fZnJvbURvY3VtZW50KGopKTsNCiAgICB9DQogICAgDQogICAgcmV0dXJuIG1vdmUoKnJldCk7DQp9DQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZV9Db250ZXh0JiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGVfQ29udGV4dDo6X2Zyb21Eb2N1bWVudChqc29uIG9iail7DQogICAgDQogICAgaWYob2JqLmNvbnRhaW5zKCJhY3RpdmUiKSkgdGhpcy0+YWN0aXZlKA0KICAgICAgICANCiAgICAgICAgb2JqWyJhY3RpdmUiXS50ZW1wbGF0ZSBnZXQ8Ym9vbD4oKQ0KICAgICAgICANCiAgICAgICAgKTsNCiAgICANCiAgICBpZihvYmouY29udGFpbnMoImVuYWJsZWQiKSkgdGhpcy0+ZW5hYmxlZCgNCiAgICAgICAgDQogICAgICAgIG9ialsiZW5hYmxlZCJdLnRlbXBsYXRlIGdldDxib29sPigpDQogICAgICAgIA0KICAgICAgICApOw0KICAgIA0KICAgIGlmKG9iai5jb250YWlucygiY29kZSIpKSB0aGlzLT5jb2RlKA0KICAgICAgICANCiAgICAgICAgb2JqWyJjb2RlIl0udGVtcGxhdGUgZ2V0PHN0ZDo6c3RyaW5nPigpDQogICAgICAgIA0KICAgICAgICApOw0KICAgIA0KICAgIGlmKG9iai5jb250YWlucygib3JkZXIiKSkgdGhpcy0+b3JkZXIoDQogICAgICAgIA0KICAgICAgICBvYmpbIm9yZGVyIl0udGVtcGxhdGUgZ2V0PGludD4oKQ0KICAgICAgICANCiAgICAgICAgKTsNCiAgICANCiAgICBpZihvYmouY29udGFpbnMoImRhdGUiKSkgdGhpcy0+ZGF0ZSgNCiAgICAgICAgDQogICAgICAgIG9ialsiZGF0ZSJdLnRlbXBsYXRlIGdldDx0aW1lX3Q+KCkNCiAgICAgICAgDQogICAgICAgICk7DQogICAgDQogICAgaWYob2JqLmNvbnRhaW5zKCJuYW1lIikpIHRoaXMtPm5hbWUoDQogICAgICAgIA0KICAgICAgICBvYmpbIm5hbWUiXS50ZW1wbGF0ZSBnZXQ8c3RkOjpzdHJpbmc+KCkNCiAgICAgICAgDQogICAgICAgICk7DQogICAgDQogICAgaWYob2JqLmNvbnRhaW5zKCJyZW1hcmsiKSkgdGhpcy0+cmVtYXJrKA0KICAgICAgICANCiAgICAgICAgb2JqWyJyZW1hcmsiXS50ZW1wbGF0ZSBnZXQ8c3RkOjpzdHJpbmc+KCkNCiAgICAgICAgDQogICAgICAgICk7DQogICAgDQogICAgDQogICAgDQogICAgaWYob2JqLmNvbnRhaW5zKCJjb250ZXh0X05vZGVzIikpIHRoaXMtPmNvbnRleHRfTm9kZXMoKG5ldyBOb2RlKCkpLT5fZnJvbURvY3VtZW50KChzdGQ6OnZlY3Rvcjxqc29uPilvYmpbImNvbnRleHRfTm9kZXMiXSkpOw0KICAgIA0KICAgIHJldHVybiAqdGhpczsNCn0NCg0Kc3RkOjpzdHJpbmcgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlX0NvbnRleHQ6Ol90b0RvY3VtZW50KCl7DQogICAgcmV0dXJuICIiOw0KfQ0KDQogICAgDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGVfQ29udGV4dCYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlX0NvbnRleHQ6OnN0b3JlKCl7DQogICAgc3RkOjpzdHJpbmcgX190b1N0cmluZyA9ICJOb2RlX0NvbnRleHQ6OnN0b3JlKCk6ICI7DQogICAgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpFdmVudCBfX3Jlc3BvbnNlID0gKG5ldyBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkV2ZW50KCkpLT5jb2RlKCJbIit0aGlzTm9kZS5jb2RlKCkrIkB0aW1lIisiXS5Ob2RlX0NvbnRleHQuc3RvcmUoKSIpLm1ldGhvZCgic3RvcmUiKS5jbGFzc05hbWUoIk5vZGVfQ29udGV4dCIpLmNhcnJpZXIodGhpc05vZGUpLnNlbmRlcih0aGlzTm9kZSkucmVjaXBpZW50KHRoaXNOb2RlLnBhcmVudCgpKTsNCg0KICAgIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZV9Db250ZXh0KiBhbnN3ZXI7DQoNCiAgICANCg0KICAgIA0KICAgIGlmKGFuc3dlciE9bnVsbHB0cil7DQogICAgDQoNCiAgICANCiAgICAgICAgDQogICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXItPl90b0RvY3VtZW50KCkpOw0KICAgICAgICANCiAgICANCiAgICB9ZWxzZXsNCiAgICAgICAganNvbiBfalJldDsNCiAgICAgICAgX2pSZXRbIl9fdGhpcyJdID0gdGhpcy0+X3RvRG9jdW1lbnQoKTsNCiAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKF9qUmV0KTsNCiAgICAgICAgLy9fX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiB0aGlzLT5fdG9Eb2N1bWVudCgpfSk7DQogICAgfQ0KDQogICAgLy9fX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCg0KICAgIHJldHVybiAqYW5zd2VyOw0KfQ0KICAgIA0Kc3RkOjp2ZWN0b3I8ZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlX0NvbnRleHQ+JiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGVfQ29udGV4dDo6ZmluZEFsbCgpew0KICAgIHN0ZDo6c3RyaW5nIF9fdG9TdHJpbmcgPSAiTm9kZV9Db250ZXh0OjpmaW5kQWxsKCk6ICI7DQogICAgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpFdmVudCBfX3Jlc3BvbnNlID0gKG5ldyBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkV2ZW50KCkpLT5jb2RlKCJbIit0aGlzTm9kZS5jb2RlKCkrIkB0aW1lIisiXS5Ob2RlX0NvbnRleHQuZmluZEFsbCgpIikubWV0aG9kKCJmaW5kQWxsIikuY2xhc3NOYW1lKCJOb2RlX0NvbnRleHQiKS5jYXJyaWVyKHRoaXNOb2RlKS5zZW5kZXIodGhpc05vZGUpLnJlY2lwaWVudCh0aGlzTm9kZS5wYXJlbnQoKSk7DQoNCiAgICBzdGQ6OnZlY3Rvcjxlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGVfQ29udGV4dD4qIGFuc3dlcjsNCg0KICAgIA0KDQogICAgDQogICAgaWYoYW5zd2VyLT5lbXB0eSgpKXsNCiAgICANCg0KICAgIA0KICAgICAgICANCiAgICAgICAgLy9fX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLT5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgDQogICAgDQogICAgfWVsc2V7DQogICAgICAgIGpzb24gX2pSZXQ7DQogICAgICAgIF9qUmV0WyJfX3RoaXMiXSA9IHRoaXMtPl90b0RvY3VtZW50KCk7DQogICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChfalJldCk7DQogICAgICAgIC8vX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogdGhpcy0+X3RvRG9jdW1lbnQoKX0pOw0KICAgIH0NCg0KICAgIC8vX19yZXNwb25zZS50cmlnZ2VyKCk7DQoNCiAgICByZXR1cm4gKmFuc3dlcjsNCn0NCiAgICANCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZV9Db250ZXh0JiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGVfQ29udGV4dDo6ZmluZCgpew0KICAgIHN0ZDo6c3RyaW5nIF9fdG9TdHJpbmcgPSAiTm9kZV9Db250ZXh0OjpmaW5kKCk6ICI7DQogICAgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpFdmVudCBfX3Jlc3BvbnNlID0gKG5ldyBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkV2ZW50KCkpLT5jb2RlKCJbIit0aGlzTm9kZS5jb2RlKCkrIkB0aW1lIisiXS5Ob2RlX0NvbnRleHQuZmluZCgpIikubWV0aG9kKCJmaW5kIikuY2xhc3NOYW1lKCJOb2RlX0NvbnRleHQiKS5jYXJyaWVyKHRoaXNOb2RlKS5zZW5kZXIodGhpc05vZGUpLnJlY2lwaWVudCh0aGlzTm9kZS5wYXJlbnQoKSk7DQoNCiAgICBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGVfQ29udGV4dCogYW5zd2VyOw0KDQogICAgDQoNCiAgICANCiAgICBpZihhbnN3ZXIhPW51bGxwdHIpew0KICAgIA0KDQogICAgDQogICAgICAgIA0KICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLT5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgDQogICAgDQogICAgfWVsc2V7DQogICAgICAgIGpzb24gX2pSZXQ7DQogICAgICAgIF9qUmV0WyJfX3RoaXMiXSA9IHRoaXMtPl90b0RvY3VtZW50KCk7DQogICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChfalJldCk7DQogICAgICAgIC8vX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogdGhpcy0+X3RvRG9jdW1lbnQoKX0pOw0KICAgIH0NCg0KICAgIC8vX19yZXNwb25zZS50cmlnZ2VyKCk7DQoNCiAgICByZXR1cm4gKmFuc3dlcjsNCn0NCiAgICANCg0KICAgIA0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGVfR3JvdXAmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZV9Hcm91cDo6YWN0aXZlKGJvb2wgdil7DQogICAgdGhpcy0+X2FjdGl2ZSA9IHY7DQogICAgcmV0dXJuICp0aGlzOw0KfQ0KICAgIA0KDQpib29sIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZV9Hcm91cDo6YWN0aXZlKCl7DQogICAgcmV0dXJuIHRoaXMtPl9hY3RpdmU7DQp9DQogICAgDQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZV9Hcm91cCYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlX0dyb3VwOjplbmFibGVkKGJvb2wgdil7DQogICAgdGhpcy0+X2VuYWJsZWQgPSB2Ow0KICAgIHJldHVybiAqdGhpczsNCn0NCiAgICANCg0KYm9vbCBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGVfR3JvdXA6OmVuYWJsZWQoKXsNCiAgICByZXR1cm4gdGhpcy0+X2VuYWJsZWQ7DQp9DQogICAgDQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZV9Hcm91cCYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlX0dyb3VwOjpjb2RlKHN0ZDo6c3RyaW5nIHYpew0KICAgIHRoaXMtPl9jb2RlID0gdjsNCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQoNCnN0ZDo6c3RyaW5nIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZV9Hcm91cDo6Y29kZSgpew0KICAgIHJldHVybiB0aGlzLT5fY29kZTsNCn0NCiAgICANCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlX0dyb3VwJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGVfR3JvdXA6Om9yZGVyKGludCB2KXsNCiAgICB0aGlzLT5fb3JkZXIgPSB2Ow0KICAgIHJldHVybiAqdGhpczsNCn0NCiAgICANCg0KaW50IGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZV9Hcm91cDo6b3JkZXIoKXsNCiAgICByZXR1cm4gdGhpcy0+X29yZGVyOw0KfQ0KICAgIA0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGVfR3JvdXAmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZV9Hcm91cDo6ZGF0ZSh0aW1lX3Qgdil7DQogICAgdGhpcy0+X2RhdGUgPSB2Ow0KICAgIHJldHVybiAqdGhpczsNCn0NCiAgICANCg0KdGltZV90IGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZV9Hcm91cDo6ZGF0ZSgpew0KICAgIHJldHVybiB0aGlzLT5fZGF0ZTsNCn0NCiAgICANCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlX0dyb3VwJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGVfR3JvdXA6Om5hbWUoc3RkOjpzdHJpbmcgdil7DQogICAgdGhpcy0+X25hbWUgPSB2Ow0KICAgIHJldHVybiAqdGhpczsNCn0NCiAgICANCg0Kc3RkOjpzdHJpbmcgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlX0dyb3VwOjpuYW1lKCl7DQogICAgcmV0dXJuIHRoaXMtPl9uYW1lOw0KfQ0KICAgIA0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGVfR3JvdXAmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZV9Hcm91cDo6cmVtYXJrKHN0ZDo6c3RyaW5nIHYpew0KICAgIHRoaXMtPl9yZW1hcmsgPSB2Ow0KICAgIHJldHVybiAqdGhpczsNCn0NCiAgICANCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZV9Hcm91cCYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlX0dyb3VwOjpyZW1hcmsoanNvbiB2KXsNCiAgICAvL3RoaXMtPl9yZW1hcmsNCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQoNCnN0ZDo6c3RyaW5nIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZV9Hcm91cDo6cmVtYXJrKCl7DQogICAgcmV0dXJuIHRoaXMtPl9yZW1hcms7DQp9DQogICAgDQoNCiAgICANCnN0ZDo6dmVjdG9yPHN0ZDo6YW55PiYmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZV9Hcm91cDo6Z3JvdXBfTm9kZXMoKXsNCiAgICByZXR1cm4gbW92ZSgqKHRoaXMtPl9ncm91cF9Ob2RlcykpOw0KfQ0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGVfR3JvdXAmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZV9Hcm91cDo6Z3JvdXBfTm9kZXMoc3RkOjp2ZWN0b3I8c3RkOjphbnk+JiYgdil7DQogICAgcmV0dXJuICp0aGlzOw0KfQ0KICAgIA0KDQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZV9Hcm91cCYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlX0dyb3VwOjpfdW5pcXVlKCl7DQogICAgc3RkOjpzdHJpbmcgX190b1N0cmluZyA9ICJOb2RlX0dyb3VwOjpfdW5pcXVlKCk6ICI7DQoNCiAgICBOb2RlX0dyb3VwKiByZXQgPSBuZXcgTm9kZV9Hcm91cCgpOw0KICAgIGlmKHRoaXMtPklkIT0wKSByZXQtPklkID0gdGhpcy0+SWQ7DQogICAgDQogICAgICAgIA0KICAgIGlmKHRoaXMtPm5hbWUoKS5lbXB0eSgpKQ0KICAgICAgICANCiAgICAgICAgcmV0LT5uYW1lKHRoaXMtPm5hbWUoKSk7DQogICAgDQoNCiAgICByZXR1cm4gKnRoaXM7DQp9DQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZV9Hcm91cCYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlX0dyb3VwOjpfZnJvbURvY3VtZW50KHVuc2lnbmVkIGNoYXIqIG9iail7DQogICAgcmV0dXJuIHRoaXMtPl9mcm9tRG9jdW1lbnQoc3RkOjpzdHJpbmcoIG9iaiwgb2JqICsgc2l6ZW9mIG9iaiAvIHNpemVvZiBvYmpbMF0gKSk7DQp9DQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZV9Hcm91cCYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlX0dyb3VwOjpfZnJvbURvY3VtZW50KHN0ZDo6c3RyaW5nIG9iail7DQogICAgaWYob2JqLmVtcHR5KCkpIHJldHVybiAqdGhpczsNCg0KICAgIGlmIChzdGQ6OnJlZ2V4X21hdGNoKG9iaiwgc3RkOjpyZWdleChSIiIoKChbQS1aYS16XXszLDl9Oig/Oi8vKT8pKD86Wy07OiY9KyQsd10rQCk/W0EtWmEtejAtOS4tXSt8KD86d3d3LnxbLTs6Jj0rJCx3XStAKVtBLVphLXowLTkuLV0rKSgoPzovWyt+JS8udy1fXSopPz8/KD86Wy0rPSY7JUAud19dKikjPyg/Olt3XSopKT8pIiIpKSl7DQogICAgICAgIHN0ZDo6c3RyaW5nIHJlYWRCdWZmZXI7DQogICAgICAgIENVUkwgKmN1cmwgPSBjdXJsX2Vhc3lfaW5pdCgpOw0KICAgICAgICBjdXJsX2Vhc3lfc2V0b3B0KGN1cmwsIENVUkxPUFRfVVJMLCBvYmopOw0KICAgICAgICBjdXJsX2Vhc3lfc2V0b3B0KGN1cmwsIENVUkxPUFRfRk9MTE9XTE9DQVRJT04sIDFMKTsNCiAgICAgICAgLy9jdXJsX2Vhc3lfc2V0b3B0KGN1cmwsIENVUkxPUFRfV1JJVEVGVU5DVElPTiwgK1tdKHZvaWQgKnB0ciwgc2l6ZV90IHNpemUsIHNpemVfdCBubWVtYiwgdm9pZCAqc3RyZWFtKSAtPiBzaXplX3QgeyByZWFkQnVmZmVyLmFwcGVuZCgqcHRyLCBzaXplICogbm1lbWIpOyB9KTsNCiAgICAgICAgY3VybF9lYXN5X3NldG9wdChjdXJsLCBDVVJMT1BUX1dSSVRFREFUQSwgJnJlYWRCdWZmZXIpOw0KICAgICAgICBjdXJsX2Vhc3lfcGVyZm9ybShjdXJsKTsNCiAgICAgICAgY3VybF9lYXN5X2NsZWFudXAoY3VybCk7DQogICAgICAgIHJldHVybiB0aGlzLT5fZnJvbURvY3VtZW50KHJlYWRCdWZmZXIpOw0KICAgIH0NCg0KICAgIHJldHVybiB0aGlzLT5fZnJvbURvY3VtZW50KGpzb246OnBhcnNlKG9iaikpOw0KfQ0KDQpzdGQ6OnZlY3Rvcjxlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGVfR3JvdXA+JiYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlX0dyb3VwOjpfZnJvbURvY3VtZW50KHN0ZDo6dmVjdG9yPGpzb24+JiYgb2JqKXsNCiAgICBzdGQ6OnZlY3RvcjxOb2RlX0dyb3VwPiogcmV0ID0gbmV3IHN0ZDo6dmVjdG9yPE5vZGVfR3JvdXA+KG9iai5zaXplKCkpOw0KICAgIA0KICAgIGZvciAoY29uc3QganNvbiYgaiA6IG9iail7DQogICAgICAgIHJldC0+cHVzaF9iYWNrKChuZXcgTm9kZV9Hcm91cCgpKS0+X2Zyb21Eb2N1bWVudChqKSk7DQogICAgfQ0KICAgIA0KICAgIHJldHVybiBtb3ZlKCpyZXQpOw0KfQ0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGVfR3JvdXAmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZV9Hcm91cDo6X2Zyb21Eb2N1bWVudChqc29uIG9iail7DQogICAgDQogICAgaWYob2JqLmNvbnRhaW5zKCJhY3RpdmUiKSkgdGhpcy0+YWN0aXZlKA0KICAgICAgICANCiAgICAgICAgb2JqWyJhY3RpdmUiXS50ZW1wbGF0ZSBnZXQ8Ym9vbD4oKQ0KICAgICAgICANCiAgICAgICAgKTsNCiAgICANCiAgICBpZihvYmouY29udGFpbnMoImVuYWJsZWQiKSkgdGhpcy0+ZW5hYmxlZCgNCiAgICAgICAgDQogICAgICAgIG9ialsiZW5hYmxlZCJdLnRlbXBsYXRlIGdldDxib29sPigpDQogICAgICAgIA0KICAgICAgICApOw0KICAgIA0KICAgIGlmKG9iai5jb250YWlucygiY29kZSIpKSB0aGlzLT5jb2RlKA0KICAgICAgICANCiAgICAgICAgb2JqWyJjb2RlIl0udGVtcGxhdGUgZ2V0PHN0ZDo6c3RyaW5nPigpDQogICAgICAgIA0KICAgICAgICApOw0KICAgIA0KICAgIGlmKG9iai5jb250YWlucygib3JkZXIiKSkgdGhpcy0+b3JkZXIoDQogICAgICAgIA0KICAgICAgICBvYmpbIm9yZGVyIl0udGVtcGxhdGUgZ2V0PGludD4oKQ0KICAgICAgICANCiAgICAgICAgKTsNCiAgICANCiAgICBpZihvYmouY29udGFpbnMoImRhdGUiKSkgdGhpcy0+ZGF0ZSgNCiAgICAgICAgDQogICAgICAgIG9ialsiZGF0ZSJdLnRlbXBsYXRlIGdldDx0aW1lX3Q+KCkNCiAgICAgICAgDQogICAgICAgICk7DQogICAgDQogICAgaWYob2JqLmNvbnRhaW5zKCJuYW1lIikpIHRoaXMtPm5hbWUoDQogICAgICAgIA0KICAgICAgICBvYmpbIm5hbWUiXS50ZW1wbGF0ZSBnZXQ8c3RkOjpzdHJpbmc+KCkNCiAgICAgICAgDQogICAgICAgICk7DQogICAgDQogICAgaWYob2JqLmNvbnRhaW5zKCJyZW1hcmsiKSkgdGhpcy0+cmVtYXJrKA0KICAgICAgICANCiAgICAgICAgb2JqWyJyZW1hcmsiXS50ZW1wbGF0ZSBnZXQ8c3RkOjpzdHJpbmc+KCkNCiAgICAgICAgDQogICAgICAgICk7DQogICAgDQogICAgDQogICAgDQogICAgaWYob2JqLmNvbnRhaW5zKCJncm91cF9Ob2RlcyIpKSB0aGlzLT5ncm91cF9Ob2RlcygobmV3IE5vZGUoKSktPl9mcm9tRG9jdW1lbnQoKHN0ZDo6dmVjdG9yPGpzb24+KW9ialsiZ3JvdXBfTm9kZXMiXSkpOw0KICAgIA0KICAgIHJldHVybiAqdGhpczsNCn0NCg0Kc3RkOjpzdHJpbmcgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlX0dyb3VwOjpfdG9Eb2N1bWVudCgpew0KICAgIHJldHVybiAiIjsNCn0NCg0KICAgIA0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlX0dyb3VwJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGVfR3JvdXA6OnN0b3JlKCl7DQogICAgc3RkOjpzdHJpbmcgX190b1N0cmluZyA9ICJOb2RlX0dyb3VwOjpzdG9yZSgpOiAiOw0KICAgIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6RXZlbnQgX19yZXNwb25zZSA9IChuZXcgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpFdmVudCgpKS0+Y29kZSgiWyIrdGhpc05vZGUuY29kZSgpKyJAdGltZSIrIl0uTm9kZV9Hcm91cC5zdG9yZSgpIikubWV0aG9kKCJzdG9yZSIpLmNsYXNzTmFtZSgiTm9kZV9Hcm91cCIpLmNhcnJpZXIodGhpc05vZGUpLnNlbmRlcih0aGlzTm9kZSkucmVjaXBpZW50KHRoaXNOb2RlLnBhcmVudCgpKTsNCg0KICAgIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZV9Hcm91cCogYW5zd2VyOw0KDQogICAgDQoNCiAgICANCiAgICBpZihhbnN3ZXIhPW51bGxwdHIpew0KICAgIA0KDQogICAgDQogICAgICAgIA0KICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLT5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgDQogICAgDQogICAgfWVsc2V7DQogICAgICAgIGpzb24gX2pSZXQ7DQogICAgICAgIF9qUmV0WyJfX3RoaXMiXSA9IHRoaXMtPl90b0RvY3VtZW50KCk7DQogICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChfalJldCk7DQogICAgICAgIC8vX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogdGhpcy0+X3RvRG9jdW1lbnQoKX0pOw0KICAgIH0NCg0KICAgIC8vX19yZXNwb25zZS50cmlnZ2VyKCk7DQoNCiAgICByZXR1cm4gKmFuc3dlcjsNCn0NCiAgICANCnN0ZDo6dmVjdG9yPGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZV9Hcm91cD4mIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZV9Hcm91cDo6ZmluZEFsbCgpew0KICAgIHN0ZDo6c3RyaW5nIF9fdG9TdHJpbmcgPSAiTm9kZV9Hcm91cDo6ZmluZEFsbCgpOiAiOw0KICAgIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6RXZlbnQgX19yZXNwb25zZSA9IChuZXcgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpFdmVudCgpKS0+Y29kZSgiWyIrdGhpc05vZGUuY29kZSgpKyJAdGltZSIrIl0uTm9kZV9Hcm91cC5maW5kQWxsKCkiKS5tZXRob2QoImZpbmRBbGwiKS5jbGFzc05hbWUoIk5vZGVfR3JvdXAiKS5jYXJyaWVyKHRoaXNOb2RlKS5zZW5kZXIodGhpc05vZGUpLnJlY2lwaWVudCh0aGlzTm9kZS5wYXJlbnQoKSk7DQoNCiAgICBzdGQ6OnZlY3Rvcjxlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGVfR3JvdXA+KiBhbnN3ZXI7DQoNCiAgICANCg0KICAgIA0KICAgIGlmKGFuc3dlci0+ZW1wdHkoKSl7DQogICAgDQoNCiAgICANCiAgICAgICAgDQogICAgICAgIC8vX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci0+X3RvRG9jdW1lbnQoKSk7DQogICAgICAgIA0KICAgIA0KICAgIH1lbHNlew0KICAgICAgICBqc29uIF9qUmV0Ow0KICAgICAgICBfalJldFsiX190aGlzIl0gPSB0aGlzLT5fdG9Eb2N1bWVudCgpOw0KICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoX2pSZXQpOw0KICAgICAgICAvL19fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHRoaXMtPl90b0RvY3VtZW50KCl9KTsNCiAgICB9DQoNCiAgICAvL19fcmVzcG9uc2UudHJpZ2dlcigpOw0KDQogICAgcmV0dXJuICphbnN3ZXI7DQp9DQogICAgDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGVfR3JvdXAmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZV9Hcm91cDo6ZmluZCgpew0KICAgIHN0ZDo6c3RyaW5nIF9fdG9TdHJpbmcgPSAiTm9kZV9Hcm91cDo6ZmluZCgpOiAiOw0KICAgIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6RXZlbnQgX19yZXNwb25zZSA9IChuZXcgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpFdmVudCgpKS0+Y29kZSgiWyIrdGhpc05vZGUuY29kZSgpKyJAdGltZSIrIl0uTm9kZV9Hcm91cC5maW5kKCkiKS5tZXRob2QoImZpbmQiKS5jbGFzc05hbWUoIk5vZGVfR3JvdXAiKS5jYXJyaWVyKHRoaXNOb2RlKS5zZW5kZXIodGhpc05vZGUpLnJlY2lwaWVudCh0aGlzTm9kZS5wYXJlbnQoKSk7DQoNCiAgICBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGVfR3JvdXAqIGFuc3dlcjsNCg0KICAgIA0KDQogICAgDQogICAgaWYoYW5zd2VyIT1udWxscHRyKXsNCiAgICANCg0KICAgIA0KICAgICAgICANCiAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci0+X3RvRG9jdW1lbnQoKSk7DQogICAgICAgIA0KICAgIA0KICAgIH1lbHNlew0KICAgICAgICBqc29uIF9qUmV0Ow0KICAgICAgICBfalJldFsiX190aGlzIl0gPSB0aGlzLT5fdG9Eb2N1bWVudCgpOw0KICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoX2pSZXQpOw0KICAgICAgICAvL19fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHRoaXMtPl90b0RvY3VtZW50KCl9KTsNCiAgICB9DQoNCiAgICAvL19fcmVzcG9uc2UudHJpZ2dlcigpOw0KDQogICAgcmV0dXJuICphbnN3ZXI7DQp9DQogICAgDQoNCiAgICANCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlX1R5cGUmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZV9UeXBlOjphY3RpdmUoYm9vbCB2KXsNCiAgICB0aGlzLT5fYWN0aXZlID0gdjsNCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQoNCmJvb2wgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlX1R5cGU6OmFjdGl2ZSgpew0KICAgIHJldHVybiB0aGlzLT5fYWN0aXZlOw0KfQ0KICAgIA0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGVfVHlwZSYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlX1R5cGU6OmVuYWJsZWQoYm9vbCB2KXsNCiAgICB0aGlzLT5fZW5hYmxlZCA9IHY7DQogICAgcmV0dXJuICp0aGlzOw0KfQ0KICAgIA0KDQpib29sIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZV9UeXBlOjplbmFibGVkKCl7DQogICAgcmV0dXJuIHRoaXMtPl9lbmFibGVkOw0KfQ0KICAgIA0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGVfVHlwZSYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlX1R5cGU6OmNvZGUoc3RkOjpzdHJpbmcgdil7DQogICAgdGhpcy0+X2NvZGUgPSB2Ow0KICAgIHJldHVybiAqdGhpczsNCn0NCiAgICANCg0Kc3RkOjpzdHJpbmcgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlX1R5cGU6OmNvZGUoKXsNCiAgICByZXR1cm4gdGhpcy0+X2NvZGU7DQp9DQogICAgDQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZV9UeXBlJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGVfVHlwZTo6b3JkZXIoaW50IHYpew0KICAgIHRoaXMtPl9vcmRlciA9IHY7DQogICAgcmV0dXJuICp0aGlzOw0KfQ0KICAgIA0KDQppbnQgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlX1R5cGU6Om9yZGVyKCl7DQogICAgcmV0dXJuIHRoaXMtPl9vcmRlcjsNCn0NCiAgICANCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlX1R5cGUmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZV9UeXBlOjpkYXRlKHRpbWVfdCB2KXsNCiAgICB0aGlzLT5fZGF0ZSA9IHY7DQogICAgcmV0dXJuICp0aGlzOw0KfQ0KICAgIA0KDQp0aW1lX3QgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlX1R5cGU6OmRhdGUoKXsNCiAgICByZXR1cm4gdGhpcy0+X2RhdGU7DQp9DQogICAgDQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZV9UeXBlJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGVfVHlwZTo6bmFtZShzdGQ6OnN0cmluZyB2KXsNCiAgICB0aGlzLT5fbmFtZSA9IHY7DQogICAgcmV0dXJuICp0aGlzOw0KfQ0KICAgIA0KDQpzdGQ6OnN0cmluZyBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGVfVHlwZTo6bmFtZSgpew0KICAgIHJldHVybiB0aGlzLT5fbmFtZTsNCn0NCiAgICANCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlX1R5cGUmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZV9UeXBlOjpyZW1hcmsoc3RkOjpzdHJpbmcgdil7DQogICAgdGhpcy0+X3JlbWFyayA9IHY7DQogICAgcmV0dXJuICp0aGlzOw0KfQ0KICAgIA0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlX1R5cGUmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZV9UeXBlOjpyZW1hcmsoanNvbiB2KXsNCiAgICAvL3RoaXMtPl9yZW1hcmsNCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQoNCnN0ZDo6c3RyaW5nIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZV9UeXBlOjpyZW1hcmsoKXsNCiAgICByZXR1cm4gdGhpcy0+X3JlbWFyazsNCn0NCiAgICANCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlX1R5cGUmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZV9UeXBlOjpkeW5hbWljKGJvb2wgdil7DQogICAgdGhpcy0+X2R5bmFtaWMgPSB2Ow0KICAgIHJldHVybiAqdGhpczsNCn0NCiAgICANCg0KYm9vbCBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGVfVHlwZTo6ZHluYW1pYygpew0KICAgIHJldHVybiB0aGlzLT5fZHluYW1pYzsNCn0NCiAgICANCg0KICAgIA0Kc3RkOjp2ZWN0b3I8c3RkOjphbnk+JiYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlX1R5cGU6OnR5cGVfTm9kZXMoKXsNCiAgICByZXR1cm4gbW92ZSgqKHRoaXMtPl90eXBlX05vZGVzKSk7DQp9DQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZV9UeXBlJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGVfVHlwZTo6dHlwZV9Ob2RlcyhzdGQ6OnZlY3RvcjxzdGQ6OmFueT4mJiB2KXsNCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQoNCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlX1R5cGUmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZV9UeXBlOjpfdW5pcXVlKCl7DQogICAgc3RkOjpzdHJpbmcgX190b1N0cmluZyA9ICJOb2RlX1R5cGU6Ol91bmlxdWUoKTogIjsNCg0KICAgIE5vZGVfVHlwZSogcmV0ID0gbmV3IE5vZGVfVHlwZSgpOw0KICAgIGlmKHRoaXMtPklkIT0wKSByZXQtPklkID0gdGhpcy0+SWQ7DQogICAgDQogICAgICAgIA0KICAgIGlmKHRoaXMtPm5hbWUoKS5lbXB0eSgpKQ0KICAgICAgICANCiAgICAgICAgcmV0LT5uYW1lKHRoaXMtPm5hbWUoKSk7DQogICAgDQoNCiAgICByZXR1cm4gKnRoaXM7DQp9DQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZV9UeXBlJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGVfVHlwZTo6X2Zyb21Eb2N1bWVudCh1bnNpZ25lZCBjaGFyKiBvYmopew0KICAgIHJldHVybiB0aGlzLT5fZnJvbURvY3VtZW50KHN0ZDo6c3RyaW5nKCBvYmosIG9iaiArIHNpemVvZiBvYmogLyBzaXplb2Ygb2JqWzBdICkpOw0KfQ0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGVfVHlwZSYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlX1R5cGU6Ol9mcm9tRG9jdW1lbnQoc3RkOjpzdHJpbmcgb2JqKXsNCiAgICBpZihvYmouZW1wdHkoKSkgcmV0dXJuICp0aGlzOw0KDQogICAgaWYgKHN0ZDo6cmVnZXhfbWF0Y2gob2JqLCBzdGQ6OnJlZ2V4KFIiIigoKFtBLVphLXpdezMsOX06KD86Ly8pPykoPzpbLTs6Jj0rJCx3XStAKT9bQS1aYS16MC05Li1dK3woPzp3d3cufFstOzomPSskLHddK0ApW0EtWmEtejAtOS4tXSspKCg/Oi9bK34lLy53LV9dKik/Pz8oPzpbLSs9JjslQC53X10qKSM/KD86W3ddKikpPykiIikpKXsNCiAgICAgICAgc3RkOjpzdHJpbmcgcmVhZEJ1ZmZlcjsNCiAgICAgICAgQ1VSTCAqY3VybCA9IGN1cmxfZWFzeV9pbml0KCk7DQogICAgICAgIGN1cmxfZWFzeV9zZXRvcHQoY3VybCwgQ1VSTE9QVF9VUkwsIG9iaik7DQogICAgICAgIGN1cmxfZWFzeV9zZXRvcHQoY3VybCwgQ1VSTE9QVF9GT0xMT1dMT0NBVElPTiwgMUwpOw0KICAgICAgICAvL2N1cmxfZWFzeV9zZXRvcHQoY3VybCwgQ1VSTE9QVF9XUklURUZVTkNUSU9OLCArW10odm9pZCAqcHRyLCBzaXplX3Qgc2l6ZSwgc2l6ZV90IG5tZW1iLCB2b2lkICpzdHJlYW0pIC0+IHNpemVfdCB7IHJlYWRCdWZmZXIuYXBwZW5kKCpwdHIsIHNpemUgKiBubWVtYik7IH0pOw0KICAgICAgICBjdXJsX2Vhc3lfc2V0b3B0KGN1cmwsIENVUkxPUFRfV1JJVEVEQVRBLCAmcmVhZEJ1ZmZlcik7DQogICAgICAgIGN1cmxfZWFzeV9wZXJmb3JtKGN1cmwpOw0KICAgICAgICBjdXJsX2Vhc3lfY2xlYW51cChjdXJsKTsNCiAgICAgICAgcmV0dXJuIHRoaXMtPl9mcm9tRG9jdW1lbnQocmVhZEJ1ZmZlcik7DQogICAgfQ0KDQogICAgcmV0dXJuIHRoaXMtPl9mcm9tRG9jdW1lbnQoanNvbjo6cGFyc2Uob2JqKSk7DQp9DQoNCnN0ZDo6dmVjdG9yPGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZV9UeXBlPiYmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZV9UeXBlOjpfZnJvbURvY3VtZW50KHN0ZDo6dmVjdG9yPGpzb24+JiYgb2JqKXsNCiAgICBzdGQ6OnZlY3RvcjxOb2RlX1R5cGU+KiByZXQgPSBuZXcgc3RkOjp2ZWN0b3I8Tm9kZV9UeXBlPihvYmouc2l6ZSgpKTsNCiAgICANCiAgICBmb3IgKGNvbnN0IGpzb24mIGogOiBvYmopew0KICAgICAgICByZXQtPnB1c2hfYmFjaygobmV3IE5vZGVfVHlwZSgpKS0+X2Zyb21Eb2N1bWVudChqKSk7DQogICAgfQ0KICAgIA0KICAgIHJldHVybiBtb3ZlKCpyZXQpOw0KfQ0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGVfVHlwZSYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlX1R5cGU6Ol9mcm9tRG9jdW1lbnQoanNvbiBvYmopew0KICAgIA0KICAgIGlmKG9iai5jb250YWlucygiYWN0aXZlIikpIHRoaXMtPmFjdGl2ZSgNCiAgICAgICAgDQogICAgICAgIG9ialsiYWN0aXZlIl0udGVtcGxhdGUgZ2V0PGJvb2w+KCkNCiAgICAgICAgDQogICAgICAgICk7DQogICAgDQogICAgaWYob2JqLmNvbnRhaW5zKCJlbmFibGVkIikpIHRoaXMtPmVuYWJsZWQoDQogICAgICAgIA0KICAgICAgICBvYmpbImVuYWJsZWQiXS50ZW1wbGF0ZSBnZXQ8Ym9vbD4oKQ0KICAgICAgICANCiAgICAgICAgKTsNCiAgICANCiAgICBpZihvYmouY29udGFpbnMoImNvZGUiKSkgdGhpcy0+Y29kZSgNCiAgICAgICAgDQogICAgICAgIG9ialsiY29kZSJdLnRlbXBsYXRlIGdldDxzdGQ6OnN0cmluZz4oKQ0KICAgICAgICANCiAgICAgICAgKTsNCiAgICANCiAgICBpZihvYmouY29udGFpbnMoIm9yZGVyIikpIHRoaXMtPm9yZGVyKA0KICAgICAgICANCiAgICAgICAgb2JqWyJvcmRlciJdLnRlbXBsYXRlIGdldDxpbnQ+KCkNCiAgICAgICAgDQogICAgICAgICk7DQogICAgDQogICAgaWYob2JqLmNvbnRhaW5zKCJkYXRlIikpIHRoaXMtPmRhdGUoDQogICAgICAgIA0KICAgICAgICBvYmpbImRhdGUiXS50ZW1wbGF0ZSBnZXQ8dGltZV90PigpDQogICAgICAgIA0KICAgICAgICApOw0KICAgIA0KICAgIGlmKG9iai5jb250YWlucygibmFtZSIpKSB0aGlzLT5uYW1lKA0KICAgICAgICANCiAgICAgICAgb2JqWyJuYW1lIl0udGVtcGxhdGUgZ2V0PHN0ZDo6c3RyaW5nPigpDQogICAgICAgIA0KICAgICAgICApOw0KICAgIA0KICAgIGlmKG9iai5jb250YWlucygicmVtYXJrIikpIHRoaXMtPnJlbWFyaygNCiAgICAgICAgDQogICAgICAgIG9ialsicmVtYXJrIl0udGVtcGxhdGUgZ2V0PHN0ZDo6c3RyaW5nPigpDQogICAgICAgIA0KICAgICAgICApOw0KICAgIA0KICAgIGlmKG9iai5jb250YWlucygiZHluYW1pYyIpKSB0aGlzLT5keW5hbWljKA0KICAgICAgICANCiAgICAgICAgb2JqWyJkeW5hbWljIl0udGVtcGxhdGUgZ2V0PGJvb2w+KCkNCiAgICAgICAgDQogICAgICAgICk7DQogICAgDQogICAgDQogICAgDQogICAgaWYob2JqLmNvbnRhaW5zKCJ0eXBlX05vZGVzIikpIHRoaXMtPnR5cGVfTm9kZXMoKG5ldyBOb2RlKCkpLT5fZnJvbURvY3VtZW50KChzdGQ6OnZlY3Rvcjxqc29uPilvYmpbInR5cGVfTm9kZXMiXSkpOw0KICAgIA0KICAgIHJldHVybiAqdGhpczsNCn0NCg0Kc3RkOjpzdHJpbmcgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlX1R5cGU6Ol90b0RvY3VtZW50KCl7DQogICAgcmV0dXJuICIiOw0KfQ0KDQogICAgDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGVfVHlwZSYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlX1R5cGU6OnN0b3JlKCl7DQogICAgc3RkOjpzdHJpbmcgX190b1N0cmluZyA9ICJOb2RlX1R5cGU6OnN0b3JlKCk6ICI7DQogICAgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpFdmVudCBfX3Jlc3BvbnNlID0gKG5ldyBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkV2ZW50KCkpLT5jb2RlKCJbIit0aGlzTm9kZS5jb2RlKCkrIkB0aW1lIisiXS5Ob2RlX1R5cGUuc3RvcmUoKSIpLm1ldGhvZCgic3RvcmUiKS5jbGFzc05hbWUoIk5vZGVfVHlwZSIpLmNhcnJpZXIodGhpc05vZGUpLnNlbmRlcih0aGlzTm9kZSkucmVjaXBpZW50KHRoaXNOb2RlLnBhcmVudCgpKTsNCg0KICAgIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZV9UeXBlKiBhbnN3ZXI7DQoNCiAgICANCg0KICAgIA0KICAgIGlmKGFuc3dlciE9bnVsbHB0cil7DQogICAgDQoNCiAgICANCiAgICAgICAgDQogICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXItPl90b0RvY3VtZW50KCkpOw0KICAgICAgICANCiAgICANCiAgICB9ZWxzZXsNCiAgICAgICAganNvbiBfalJldDsNCiAgICAgICAgX2pSZXRbIl9fdGhpcyJdID0gdGhpcy0+X3RvRG9jdW1lbnQoKTsNCiAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKF9qUmV0KTsNCiAgICAgICAgLy9fX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiB0aGlzLT5fdG9Eb2N1bWVudCgpfSk7DQogICAgfQ0KDQogICAgLy9fX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCg0KICAgIHJldHVybiAqYW5zd2VyOw0KfQ0KICAgIA0Kc3RkOjp2ZWN0b3I8ZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpOb2RlX1R5cGU+JiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGVfVHlwZTo6ZmluZEFsbCgpew0KICAgIHN0ZDo6c3RyaW5nIF9fdG9TdHJpbmcgPSAiTm9kZV9UeXBlOjpmaW5kQWxsKCk6ICI7DQogICAgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpFdmVudCBfX3Jlc3BvbnNlID0gKG5ldyBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkV2ZW50KCkpLT5jb2RlKCJbIit0aGlzTm9kZS5jb2RlKCkrIkB0aW1lIisiXS5Ob2RlX1R5cGUuZmluZEFsbCgpIikubWV0aG9kKCJmaW5kQWxsIikuY2xhc3NOYW1lKCJOb2RlX1R5cGUiKS5jYXJyaWVyKHRoaXNOb2RlKS5zZW5kZXIodGhpc05vZGUpLnJlY2lwaWVudCh0aGlzTm9kZS5wYXJlbnQoKSk7DQoNCiAgICBzdGQ6OnZlY3Rvcjxlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGVfVHlwZT4qIGFuc3dlcjsNCg0KICAgIA0KDQogICAgDQogICAgaWYoYW5zd2VyLT5lbXB0eSgpKXsNCiAgICANCg0KICAgIA0KICAgICAgICANCiAgICAgICAgLy9fX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLT5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgDQogICAgDQogICAgfWVsc2V7DQogICAgICAgIGpzb24gX2pSZXQ7DQogICAgICAgIF9qUmV0WyJfX3RoaXMiXSA9IHRoaXMtPl90b0RvY3VtZW50KCk7DQogICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChfalJldCk7DQogICAgICAgIC8vX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogdGhpcy0+X3RvRG9jdW1lbnQoKX0pOw0KICAgIH0NCg0KICAgIC8vX19yZXNwb25zZS50cmlnZ2VyKCk7DQoNCiAgICByZXR1cm4gKmFuc3dlcjsNCn0NCiAgICANCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Tm9kZV9UeXBlJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGVfVHlwZTo6ZmluZCgpew0KICAgIHN0ZDo6c3RyaW5nIF9fdG9TdHJpbmcgPSAiTm9kZV9UeXBlOjpmaW5kKCk6ICI7DQogICAgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpFdmVudCBfX3Jlc3BvbnNlID0gKG5ldyBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkV2ZW50KCkpLT5jb2RlKCJbIit0aGlzTm9kZS5jb2RlKCkrIkB0aW1lIisiXS5Ob2RlX1R5cGUuZmluZCgpIikubWV0aG9kKCJmaW5kIikuY2xhc3NOYW1lKCJOb2RlX1R5cGUiKS5jYXJyaWVyKHRoaXNOb2RlKS5zZW5kZXIodGhpc05vZGUpLnJlY2lwaWVudCh0aGlzTm9kZS5wYXJlbnQoKSk7DQoNCiAgICBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok5vZGVfVHlwZSogYW5zd2VyOw0KDQogICAgDQoNCiAgICANCiAgICBpZihhbnN3ZXIhPW51bGxwdHIpew0KICAgIA0KDQogICAgDQogICAgICAgIA0KICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLT5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgDQogICAgDQogICAgfWVsc2V7DQogICAgICAgIGpzb24gX2pSZXQ7DQogICAgICAgIF9qUmV0WyJfX3RoaXMiXSA9IHRoaXMtPl90b0RvY3VtZW50KCk7DQogICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChfalJldCk7DQogICAgICAgIC8vX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogdGhpcy0+X3RvRG9jdW1lbnQoKX0pOw0KICAgIH0NCg0KICAgIC8vX19yZXNwb25zZS50cmlnZ2VyKCk7DQoNCiAgICByZXR1cm4gKmFuc3dlcjsNCn0NCiAgICANCg0KICAgIA0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok1hcHBpbmcmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6TWFwcGluZzo6YWN0aXZlKGJvb2wgdil7DQogICAgdGhpcy0+X2FjdGl2ZSA9IHY7DQogICAgcmV0dXJuICp0aGlzOw0KfQ0KICAgIA0KDQpib29sIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6TWFwcGluZzo6YWN0aXZlKCl7DQogICAgcmV0dXJuIHRoaXMtPl9hY3RpdmU7DQp9DQogICAgDQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6TWFwcGluZyYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpNYXBwaW5nOjplbmFibGVkKGJvb2wgdil7DQogICAgdGhpcy0+X2VuYWJsZWQgPSB2Ow0KICAgIHJldHVybiAqdGhpczsNCn0NCiAgICANCg0KYm9vbCBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok1hcHBpbmc6OmVuYWJsZWQoKXsNCiAgICByZXR1cm4gdGhpcy0+X2VuYWJsZWQ7DQp9DQogICAgDQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6TWFwcGluZyYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpNYXBwaW5nOjpvcmRlcihpbnQgdil7DQogICAgdGhpcy0+X29yZGVyID0gdjsNCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQoNCmludCBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok1hcHBpbmc6Om9yZGVyKCl7DQogICAgcmV0dXJuIHRoaXMtPl9vcmRlcjsNCn0NCiAgICANCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpNYXBwaW5nJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok1hcHBpbmc6OmNsYXNzTmFtZShzdGQ6OnN0cmluZyB2KXsNCiAgICB0aGlzLT5fY2xhc3NOYW1lID0gdjsNCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQoNCnN0ZDo6c3RyaW5nIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6TWFwcGluZzo6Y2xhc3NOYW1lKCl7DQogICAgcmV0dXJuIHRoaXMtPl9jbGFzc05hbWU7DQp9DQogICAgDQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6TWFwcGluZyYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpNYXBwaW5nOjpzY29wZShzdGQ6OnN0cmluZyB2KXsNCiAgICB0aGlzLT5fc2NvcGUgPSB2Ow0KICAgIHJldHVybiAqdGhpczsNCn0NCiAgICANCg0Kc3RkOjpzdHJpbmcgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpNYXBwaW5nOjpzY29wZSgpew0KICAgIHJldHVybiB0aGlzLT5fc2NvcGU7DQp9DQogICAgDQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6TWFwcGluZyYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpNYXBwaW5nOjpjb250ZXh0KHN0ZDo6c3RyaW5nIHYpew0KICAgIHRoaXMtPl9jb250ZXh0ID0gdjsNCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQoNCnN0ZDo6c3RyaW5nIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6TWFwcGluZzo6Y29udGV4dCgpew0KICAgIHJldHVybiB0aGlzLT5fY29udGV4dDsNCn0NCiAgICANCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpNYXBwaW5nJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok1hcHBpbmc6OnNvdXJjZShzdGQ6OnN0cmluZyB2KXsNCiAgICB0aGlzLT5fc291cmNlID0gdjsNCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQoNCnN0ZDo6c3RyaW5nIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6TWFwcGluZzo6c291cmNlKCl7DQogICAgcmV0dXJuIHRoaXMtPl9zb3VyY2U7DQp9DQogICAgDQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6TWFwcGluZyYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpNYXBwaW5nOjp0YXJnZXQoc3RkOjpzdHJpbmcgdil7DQogICAgdGhpcy0+X3RhcmdldCA9IHY7DQogICAgcmV0dXJuICp0aGlzOw0KfQ0KICAgIA0KDQpzdGQ6OnN0cmluZyBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok1hcHBpbmc6OnRhcmdldCgpew0KICAgIHJldHVybiB0aGlzLT5fdGFyZ2V0Ow0KfQ0KICAgIA0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok1hcHBpbmcmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6TWFwcGluZzo6aW5TY3JpcHQoc3RkOjpzdHJpbmcgdil7DQogICAgdGhpcy0+X2luU2NyaXB0ID0gdjsNCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok1hcHBpbmcmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6TWFwcGluZzo6aW5TY3JpcHQoanNvbiB2KXsNCiAgICAvL3RoaXMtPl9pblNjcmlwdA0KICAgIHJldHVybiAqdGhpczsNCn0NCiAgICANCg0Kc3RkOjpzdHJpbmcgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpNYXBwaW5nOjppblNjcmlwdCgpew0KICAgIHJldHVybiB0aGlzLT5faW5TY3JpcHQ7DQp9DQogICAgDQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6TWFwcGluZyYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpNYXBwaW5nOjpvdXRTY3JpcHQoc3RkOjpzdHJpbmcgdil7DQogICAgdGhpcy0+X291dFNjcmlwdCA9IHY7DQogICAgcmV0dXJuICp0aGlzOw0KfQ0KICAgIA0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpNYXBwaW5nJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok1hcHBpbmc6Om91dFNjcmlwdChqc29uIHYpew0KICAgIC8vdGhpcy0+X291dFNjcmlwdA0KICAgIHJldHVybiAqdGhpczsNCn0NCiAgICANCg0Kc3RkOjpzdHJpbmcgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpNYXBwaW5nOjpvdXRTY3JpcHQoKXsNCiAgICByZXR1cm4gdGhpcy0+X291dFNjcmlwdDsNCn0NCiAgICANCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpNYXBwaW5nJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok1hcHBpbmc6OnRvb2woZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpUb29sJiB2KXsNCiAgICB0aGlzLT5fdG9vbCA9ICZ2Ow0KICAgIHJldHVybiAqdGhpczsNCn0NCiAgICANCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6TWFwcGluZyYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpNYXBwaW5nOjp0b29sKGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6VG9vbCogdil7DQogICAgaWYodiE9bnVsbHB0cil7DQogICAgICAgIHRoaXMtPl90b29sID0gdjsNCiAgICB9DQogICAgcmV0dXJuICp0aGlzOw0KfQ0KICAgIA0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OlRvb2wqIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6TWFwcGluZzo6dG9vbCgpew0KICAgIHJldHVybiB0aGlzLT5fdG9vbDsNCn0NCiAgICANCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpNYXBwaW5nJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok1hcHBpbmc6Omdyb3VwKGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Q29uZmlnX0dyb3VwJiB2KXsNCiAgICB0aGlzLT5fZ3JvdXAgPSAmdjsNCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok1hcHBpbmcmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6TWFwcGluZzo6Z3JvdXAoZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpDb25maWdfR3JvdXAqIHYpew0KICAgIGlmKHYhPW51bGxwdHIpew0KICAgICAgICB0aGlzLT5fZ3JvdXAgPSB2Ow0KICAgIH0NCiAgICByZXR1cm4gKnRoaXM7DQp9DQogICAgDQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6Q29uZmlnX0dyb3VwKiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok1hcHBpbmc6Omdyb3VwKCl7DQogICAgcmV0dXJuIHRoaXMtPl9ncm91cDsNCn0NCiAgICANCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpNYXBwaW5nJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok1hcHBpbmc6OnR5cGUoZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpUb29sX1R5cGUmIHYpew0KICAgIHRoaXMtPl90eXBlID0gJnY7DQogICAgcmV0dXJuICp0aGlzOw0KfQ0KICAgIA0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpNYXBwaW5nJiBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok1hcHBpbmc6OnR5cGUoZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpUb29sX1R5cGUqIHYpew0KICAgIGlmKHYhPW51bGxwdHIpew0KICAgICAgICB0aGlzLT5fdHlwZSA9IHY7DQogICAgfQ0KICAgIHJldHVybiAqdGhpczsNCn0NCiAgICANCg0KZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpUb29sX1R5cGUqIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6TWFwcGluZzo6dHlwZSgpew0KICAgIHJldHVybiB0aGlzLT5fdHlwZTsNCn0NCiAgICANCg0KICAgIA0KDQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6TWFwcGluZyYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpNYXBwaW5nOjpfdW5pcXVlKCl7DQogICAgc3RkOjpzdHJpbmcgX190b1N0cmluZyA9ICJNYXBwaW5nOjpfdW5pcXVlKCk6ICI7DQoNCiAgICBNYXBwaW5nKiByZXQgPSBuZXcgTWFwcGluZygpOw0KICAgIGlmKHRoaXMtPklkIT0wKSByZXQtPklkID0gdGhpcy0+SWQ7DQogICAgDQoNCiAgICByZXR1cm4gKnRoaXM7DQp9DQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6TWFwcGluZyYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpNYXBwaW5nOjpfZnJvbURvY3VtZW50KHVuc2lnbmVkIGNoYXIqIG9iail7DQogICAgcmV0dXJuIHRoaXMtPl9mcm9tRG9jdW1lbnQoc3RkOjpzdHJpbmcoIG9iaiwgb2JqICsgc2l6ZW9mIG9iaiAvIHNpemVvZiBvYmpbMF0gKSk7DQp9DQoNCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6TWFwcGluZyYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpNYXBwaW5nOjpfZnJvbURvY3VtZW50KHN0ZDo6c3RyaW5nIG9iail7DQogICAgaWYob2JqLmVtcHR5KCkpIHJldHVybiAqdGhpczsNCg0KICAgIGlmIChzdGQ6OnJlZ2V4X21hdGNoKG9iaiwgc3RkOjpyZWdleChSIiIoKChbQS1aYS16XXszLDl9Oig/Oi8vKT8pKD86Wy07OiY9KyQsd10rQCk/W0EtWmEtejAtOS4tXSt8KD86d3d3LnxbLTs6Jj0rJCx3XStAKVtBLVphLXowLTkuLV0rKSgoPzovWyt+JS8udy1fXSopPz8/KD86Wy0rPSY7JUAud19dKikjPyg/Olt3XSopKT8pIiIpKSl7DQogICAgICAgIHN0ZDo6c3RyaW5nIHJlYWRCdWZmZXI7DQogICAgICAgIENVUkwgKmN1cmwgPSBjdXJsX2Vhc3lfaW5pdCgpOw0KICAgICAgICBjdXJsX2Vhc3lfc2V0b3B0KGN1cmwsIENVUkxPUFRfVVJMLCBvYmopOw0KICAgICAgICBjdXJsX2Vhc3lfc2V0b3B0KGN1cmwsIENVUkxPUFRfRk9MTE9XTE9DQVRJT04sIDFMKTsNCiAgICAgICAgLy9jdXJsX2Vhc3lfc2V0b3B0KGN1cmwsIENVUkxPUFRfV1JJVEVGVU5DVElPTiwgK1tdKHZvaWQgKnB0ciwgc2l6ZV90IHNpemUsIHNpemVfdCBubWVtYiwgdm9pZCAqc3RyZWFtKSAtPiBzaXplX3QgeyByZWFkQnVmZmVyLmFwcGVuZCgqcHRyLCBzaXplICogbm1lbWIpOyB9KTsNCiAgICAgICAgY3VybF9lYXN5X3NldG9wdChjdXJsLCBDVVJMT1BUX1dSSVRFREFUQSwgJnJlYWRCdWZmZXIpOw0KICAgICAgICBjdXJsX2Vhc3lfcGVyZm9ybShjdXJsKTsNCiAgICAgICAgY3VybF9lYXN5X2NsZWFudXAoY3VybCk7DQogICAgICAgIHJldHVybiB0aGlzLT5fZnJvbURvY3VtZW50KHJlYWRCdWZmZXIpOw0KICAgIH0NCg0KICAgIHJldHVybiB0aGlzLT5fZnJvbURvY3VtZW50KGpzb246OnBhcnNlKG9iaikpOw0KfQ0KDQpzdGQ6OnZlY3Rvcjxlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok1hcHBpbmc+JiYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpNYXBwaW5nOjpfZnJvbURvY3VtZW50KHN0ZDo6dmVjdG9yPGpzb24+JiYgb2JqKXsNCiAgICBzdGQ6OnZlY3RvcjxNYXBwaW5nPiogcmV0ID0gbmV3IHN0ZDo6dmVjdG9yPE1hcHBpbmc+KG9iai5zaXplKCkpOw0KICAgIA0KICAgIGZvciAoY29uc3QganNvbiYgaiA6IG9iail7DQogICAgICAgIHJldC0+cHVzaF9iYWNrKChuZXcgTWFwcGluZygpKS0+X2Zyb21Eb2N1bWVudChqKSk7DQogICAgfQ0KICAgIA0KICAgIHJldHVybiBtb3ZlKCpyZXQpOw0KfQ0KDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok1hcHBpbmcmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6TWFwcGluZzo6X2Zyb21Eb2N1bWVudChqc29uIG9iail7DQogICAgDQogICAgaWYob2JqLmNvbnRhaW5zKCJhY3RpdmUiKSkgdGhpcy0+YWN0aXZlKA0KICAgICAgICANCiAgICAgICAgb2JqWyJhY3RpdmUiXS50ZW1wbGF0ZSBnZXQ8Ym9vbD4oKQ0KICAgICAgICANCiAgICAgICAgKTsNCiAgICANCiAgICBpZihvYmouY29udGFpbnMoImVuYWJsZWQiKSkgdGhpcy0+ZW5hYmxlZCgNCiAgICAgICAgDQogICAgICAgIG9ialsiZW5hYmxlZCJdLnRlbXBsYXRlIGdldDxib29sPigpDQogICAgICAgIA0KICAgICAgICApOw0KICAgIA0KICAgIGlmKG9iai5jb250YWlucygib3JkZXIiKSkgdGhpcy0+b3JkZXIoDQogICAgICAgIA0KICAgICAgICBvYmpbIm9yZGVyIl0udGVtcGxhdGUgZ2V0PGludD4oKQ0KICAgICAgICANCiAgICAgICAgKTsNCiAgICANCiAgICBpZihvYmouY29udGFpbnMoImNsYXNzTmFtZSIpKSB0aGlzLT5jbGFzc05hbWUoDQogICAgICAgIA0KICAgICAgICBvYmpbImNsYXNzTmFtZSJdLnRlbXBsYXRlIGdldDxzdGQ6OnN0cmluZz4oKQ0KICAgICAgICANCiAgICAgICAgKTsNCiAgICANCiAgICBpZihvYmouY29udGFpbnMoInNjb3BlIikpIHRoaXMtPnNjb3BlKA0KICAgICAgICANCiAgICAgICAgb2JqWyJzY29wZSJdLnRlbXBsYXRlIGdldDxzdGQ6OnN0cmluZz4oKQ0KICAgICAgICANCiAgICAgICAgKTsNCiAgICANCiAgICBpZihvYmouY29udGFpbnMoImNvbnRleHQiKSkgdGhpcy0+Y29udGV4dCgNCiAgICAgICAgDQogICAgICAgIG9ialsiY29udGV4dCJdLnRlbXBsYXRlIGdldDxzdGQ6OnN0cmluZz4oKQ0KICAgICAgICANCiAgICAgICAgKTsNCiAgICANCiAgICBpZihvYmouY29udGFpbnMoInNvdXJjZSIpKSB0aGlzLT5zb3VyY2UoDQogICAgICAgIA0KICAgICAgICBvYmpbInNvdXJjZSJdLnRlbXBsYXRlIGdldDxzdGQ6OnN0cmluZz4oKQ0KICAgICAgICANCiAgICAgICAgKTsNCiAgICANCiAgICBpZihvYmouY29udGFpbnMoInRhcmdldCIpKSB0aGlzLT50YXJnZXQoDQogICAgICAgIA0KICAgICAgICBvYmpbInRhcmdldCJdLnRlbXBsYXRlIGdldDxzdGQ6OnN0cmluZz4oKQ0KICAgICAgICANCiAgICAgICAgKTsNCiAgICANCiAgICBpZihvYmouY29udGFpbnMoImluU2NyaXB0IikpIHRoaXMtPmluU2NyaXB0KA0KICAgICAgICANCiAgICAgICAgb2JqWyJpblNjcmlwdCJdLnRlbXBsYXRlIGdldDxzdGQ6OnN0cmluZz4oKQ0KICAgICAgICANCiAgICAgICAgKTsNCiAgICANCiAgICBpZihvYmouY29udGFpbnMoIm91dFNjcmlwdCIpKSB0aGlzLT5vdXRTY3JpcHQoDQogICAgICAgIA0KICAgICAgICBvYmpbIm91dFNjcmlwdCJdLnRlbXBsYXRlIGdldDxzdGQ6OnN0cmluZz4oKQ0KICAgICAgICANCiAgICAgICAgKTsNCiAgICANCiAgICBpZihvYmouY29udGFpbnMoInRvb2wiKSkgdGhpcy0+dG9vbCgNCiAgICAgICAgDQogICAgICAgIChuZXcgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpUb29sKCkpLT5fZnJvbURvY3VtZW50KG9ialsidG9vbCJdKQ0KICAgICAgICANCiAgICAgICAgKTsNCiAgICANCiAgICBpZihvYmouY29udGFpbnMoImdyb3VwIikpIHRoaXMtPmdyb3VwKA0KICAgICAgICANCiAgICAgICAgKG5ldyBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkNvbmZpZ19Hcm91cCgpKS0+X2Zyb21Eb2N1bWVudChvYmpbImdyb3VwIl0pDQogICAgICAgIA0KICAgICAgICApOw0KICAgIA0KICAgIGlmKG9iai5jb250YWlucygidHlwZSIpKSB0aGlzLT50eXBlKA0KICAgICAgICANCiAgICAgICAgKG5ldyBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OlRvb2xfVHlwZSgpKS0+X2Zyb21Eb2N1bWVudChvYmpbInR5cGUiXSkNCiAgICAgICAgDQogICAgICAgICk7DQogICAgDQogICAgDQogICAgDQogICAgcmV0dXJuICp0aGlzOw0KfQ0KDQpzdGQ6OnN0cmluZyBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok1hcHBpbmc6Ol90b0RvY3VtZW50KCl7DQogICAgcmV0dXJuICIiOw0KfQ0KDQogICAgDQplc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206Ok1hcHBpbmcmIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6TWFwcGluZzo6c3RvcmUoKXsNCiAgICBzdGQ6OnN0cmluZyBfX3RvU3RyaW5nID0gIk1hcHBpbmc6OnN0b3JlKCk6ICI7DQogICAgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpFdmVudCBfX3Jlc3BvbnNlID0gKG5ldyBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkV2ZW50KCkpLT5jb2RlKCJbIit0aGlzTm9kZS5jb2RlKCkrIkB0aW1lIisiXS5NYXBwaW5nLnN0b3JlKCkiKS5tZXRob2QoInN0b3JlIikuY2xhc3NOYW1lKCJNYXBwaW5nIikuY2Fycmllcih0aGlzTm9kZSkuc2VuZGVyKHRoaXNOb2RlKS5yZWNpcGllbnQodGhpc05vZGUucGFyZW50KCkpOw0KDQogICAgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpNYXBwaW5nKiBhbnN3ZXI7DQoNCiAgICANCg0KICAgIA0KICAgIGlmKGFuc3dlciE9bnVsbHB0cil7DQogICAgDQoNCiAgICANCiAgICAgICAgDQogICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXItPl90b0RvY3VtZW50KCkpOw0KICAgICAgICANCiAgICANCiAgICB9ZWxzZXsNCiAgICAgICAganNvbiBfalJldDsNCiAgICAgICAgX2pSZXRbIl9fdGhpcyJdID0gdGhpcy0+X3RvRG9jdW1lbnQoKTsNCiAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKF9qUmV0KTsNCiAgICAgICAgLy9fX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiB0aGlzLT5fdG9Eb2N1bWVudCgpfSk7DQogICAgfQ0KDQogICAgLy9fX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCg0KICAgIHJldHVybiAqYW5zd2VyOw0KfQ0KICAgIA0Kc3RkOjp2ZWN0b3I8ZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpNYXBwaW5nPiYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpNYXBwaW5nOjpmaW5kQWxsKCl7DQogICAgc3RkOjpzdHJpbmcgX190b1N0cmluZyA9ICJNYXBwaW5nOjpmaW5kQWxsKCk6ICI7DQogICAgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpFdmVudCBfX3Jlc3BvbnNlID0gKG5ldyBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkV2ZW50KCkpLT5jb2RlKCJbIit0aGlzTm9kZS5jb2RlKCkrIkB0aW1lIisiXS5NYXBwaW5nLmZpbmRBbGwoKSIpLm1ldGhvZCgiZmluZEFsbCIpLmNsYXNzTmFtZSgiTWFwcGluZyIpLmNhcnJpZXIodGhpc05vZGUpLnNlbmRlcih0aGlzTm9kZSkucmVjaXBpZW50KHRoaXNOb2RlLnBhcmVudCgpKTsNCg0KICAgIHN0ZDo6dmVjdG9yPGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6TWFwcGluZz4qIGFuc3dlcjsNCg0KICAgIA0KDQogICAgDQogICAgaWYoYW5zd2VyLT5lbXB0eSgpKXsNCiAgICANCg0KICAgIA0KICAgICAgICANCiAgICAgICAgLy9fX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLT5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgDQogICAgDQogICAgfWVsc2V7DQogICAgICAgIGpzb24gX2pSZXQ7DQogICAgICAgIF9qUmV0WyJfX3RoaXMiXSA9IHRoaXMtPl90b0RvY3VtZW50KCk7DQogICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChfalJldCk7DQogICAgICAgIC8vX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogdGhpcy0+X3RvRG9jdW1lbnQoKX0pOw0KICAgIH0NCg0KICAgIC8vX19yZXNwb25zZS50cmlnZ2VyKCk7DQoNCiAgICByZXR1cm4gKmFuc3dlcjsNCn0NCiAgICANCmVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6TWFwcGluZyYgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpNYXBwaW5nOjpmaW5kKCl7DQogICAgc3RkOjpzdHJpbmcgX190b1N0cmluZyA9ICJNYXBwaW5nOjpmaW5kKCk6ICI7DQogICAgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpFdmVudCBfX3Jlc3BvbnNlID0gKG5ldyBlc3B0ZXN0Ojpjb206Om5hbW1vdXI6OmRjb206OkV2ZW50KCkpLT5jb2RlKCJbIit0aGlzTm9kZS5jb2RlKCkrIkB0aW1lIisiXS5NYXBwaW5nLmZpbmQoKSIpLm1ldGhvZCgiZmluZCIpLmNsYXNzTmFtZSgiTWFwcGluZyIpLmNhcnJpZXIodGhpc05vZGUpLnNlbmRlcih0aGlzTm9kZSkucmVjaXBpZW50KHRoaXNOb2RlLnBhcmVudCgpKTsNCg0KICAgIGVzcHRlc3Q6OmNvbTo6bmFtbW91cjo6ZGNvbTo6TWFwcGluZyogYW5zd2VyOw0KDQogICAgDQoNCiAgICANCiAgICBpZihhbnN3ZXIhPW51bGxwdHIpew0KICAgIA0KDQogICAgDQogICAgICAgIA0KICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLT5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgDQogICAgDQogICAgfWVsc2V7DQogICAgICAgIGpzb24gX2pSZXQ7DQogICAgICAgIF9qUmV0WyJfX3RoaXMiXSA9IHRoaXMtPl90b0RvY3VtZW50KCk7DQogICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChfalJldCk7DQogICAgICAgIC8vX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogdGhpcy0+X3RvRG9jdW1lbnQoKX0pOw0KICAgIH0NCg0KICAgIC8vX19yZXNwb25zZS50cmlnZ2VyKCk7DQoNCiAgICByZXR1cm4gKmFuc3dlcjsNCn0NCiAgICANCg0KDQppbnQgbWFpbihpbnQgYXJnYywgY2hhciogYXJndltdKSB7DQoNCiAgICBjb25zdCBzdGQ6OnN0cmluZyBTRVJWRVJfQUREUkVTUygibXF0dDovL3Rlc3QubW9zcXVpdHRvLm9yZzoxODgzIik7DQogICAgbXF0dDo6YXN5bmNfY2xpZW50IGNsaShTRVJWRVJfQUREUkVTUywgIiIsIG1xdHQ6OmNyZWF0ZV9vcHRpb25zKE1RVFRWRVJTSU9OXzUpKTsNCiAgICBjbGkuc2V0X21lc3NhZ2VfY2FsbGJhY2soW10obXF0dDo6Y29uc3RfbWVzc2FnZV9wdHIgbXNnKSB7IChuZXcgZXNwdGVzdDo6Y29tOjpuYW1tb3VyOjpkY29tOjpFdmVudCgpKS0+X2Zyb21Eb2N1bWVudChtc2cuZ2V0X3BheWxvYWRfc3RyKCkpLnByb2Nlc3MoKTsgfSk7DQogICAgYXV0byB0b2sgPSBjbGkuY29ubmVjdChtcXR0Ojpjb25uZWN0X29wdGlvbnNfYnVpbGRlcigpDQoJCS5wcm9wZXJ0aWVzKHsNCgkJCXttcXR0Ojpwcm9wZXJ0eTo6U0VTU0lPTl9FWFBJUllfSU5URVJWQUwsIDYwNDgwMH0NCgkJfSkNCgkJLmNsZWFuX3N0YXJ0KGZhbHNlKQ0KCQkvLy53aWxsKHN0ZDo6bW92ZShsd3QpKQ0KCQkua2VlcF9hbGl2ZV9pbnRlcnZhbChzdGQ6OmNocm9ubzo6c2Vjb25kcygyMCkpDQoJCS5maW5hbGl6ZSgpKTsNCiAgICB0b2sud2FpdCgpOw0KDQogICAgcmV0dXJuIDA7DQp9",
	"__keys": ["name"],
	"__trMap": []
}