{
	"Id": "7a49ea1b4b568f15bd4de7778615ef7630ab81e8",
	"active": "true",
	"enabled": "true",
	"code": "apiserver",
	"date": "Mon Sep 30 2024 12:36:10 GMT+0300 (Eastern European Summer Time)",
	"name": "API Server",
	"remark": "aW1wb3J0IHVtcXR0LnNpbXBsZSxuZXR3b3JrLHViaW5hc2NpaSx1anNvbixtYWNoaW5lLGRlZmxhdGUsdGltZSxnYyxpbzsNCg0KDQpjbGFzcyBVc2VyKCk6DQogICAgZGVmIF9faW5pdF9fKHNlbGYsIElkPU5vbmUsIGFjdGl2ZT1Ob25lLCBlbmFibGVkPU5vbmUsIGNvZGU9Tm9uZSwgb3JkZXI9Tm9uZSwgZGF0ZT1Ob25lLCBuYW1lPU5vbmUsIHJlbWFyaz1Ob25lLCB1c2VybmFtZT1Ob25lLCBwYXNzd29yZD1Ob25lKToNCiAgICAgICAgc3VwZXIoKS5fX2luaXRfXygpOw0KDQogICAgICAgICNwcmludCgnVXNlcjo6X19pbml0X18oKScpOw0KICAgICAgICBpZiBJZCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHNlbGYuSWQgPSBJZDsNCg0KICAgICAgICANCiAgICAgICAgc2VsZi5hY3RpdmUoYWN0aXZlKTsNCiAgICAgICAgc2VsZi5lbmFibGVkKGVuYWJsZWQpOw0KICAgICAgICBzZWxmLmNvZGUoY29kZSk7DQogICAgICAgIHNlbGYub3JkZXIob3JkZXIpOw0KICAgICAgICBzZWxmLmRhdGUoZGF0ZSk7DQogICAgICAgIHNlbGYubmFtZShuYW1lKTsNCiAgICAgICAgc2VsZi5yZW1hcmsocmVtYXJrKTsNCiAgICAgICAgc2VsZi51c2VybmFtZSh1c2VybmFtZSk7DQogICAgICAgIHNlbGYucGFzc3dvcmQocGFzc3dvcmQpOw0KICAgICAgICANCiAgICBJZCA9IE5vbmU7DQogICAgDQogICAgDQogICAgIyBhY3RpdmU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfYWN0aXZlID0gTm9uZTsNCiAgICBkZWYgYWN0aXZlKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2FjdGl2ZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9hY3RpdmU7DQoNCg0KICAgIA0KICAgICMgZW5hYmxlZDogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9lbmFibGVkID0gTm9uZTsNCiAgICBkZWYgZW5hYmxlZChzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9lbmFibGVkID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2VuYWJsZWQ7DQoNCg0KICAgIA0KICAgICMgY29kZTogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9jb2RlID0gTm9uZTsNCiAgICBkZWYgY29kZShzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9jb2RlID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2NvZGU7DQoNCg0KICAgIA0KICAgICMgb3JkZXI6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfb3JkZXIgPSBOb25lOw0KICAgIGRlZiBvcmRlcihzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9vcmRlciA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9vcmRlcjsNCg0KDQogICAgDQogICAgIyBkYXRlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2RhdGUgPSBOb25lOw0KICAgIGRlZiBkYXRlKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2RhdGUgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fZGF0ZTsNCg0KDQogICAgDQogICAgIyBuYW1lOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX25hbWUgPSBOb25lOw0KICAgIGRlZiBuYW1lKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX25hbWUgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fbmFtZTsNCg0KDQogICAgDQogICAgIyByZW1hcms6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfcmVtYXJrID0gTm9uZTsNCiAgICBkZWYgcmVtYXJrKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX3JlbWFyayA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9yZW1hcms7DQoNCg0KICAgIA0KICAgICMgdXNlcm5hbWU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfdXNlcm5hbWUgPSBOb25lOw0KICAgIGRlZiB1c2VybmFtZShzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl91c2VybmFtZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl91c2VybmFtZTsNCg0KDQogICAgDQogICAgIyBwYXNzd29yZDogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9wYXNzd29yZCA9IE5vbmU7DQogICAgZGVmIHBhc3N3b3JkKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX3Bhc3N3b3JkID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3Bhc3N3b3JkOw0KDQoNCiAgICANCiAgICANCiAgICBkZWYgX2Zyb21Eb2N1bWVudChzZWxmLCBvYmopOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ1VzZXI6Ol9mcm9tRG9jdW1lbnQoKTogJzsNCg0KICAgICAgICBpZiBvYmogaXMgTm9uZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICANCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIGJ5dGVzKToNCiAgICAgICAgICAgIG9iaiA9IHN0cihvYmosICJ1dGYtOCIpOw0KDQogICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLCBzdHIpIG9yIHR5cGUob2JqKSBpcyBzdHI6DQogICAgICAgICAgICBvYmogPSB1anNvbi5sb2FkcyhvYmopOw0KICAgICAgICANCiAgICAgICAgaWYgbm90IGlzaW5zdGFuY2Uob2JqLCAoc3RyLCBieXRlcywgZGljdCkpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICdHT1QgSEVSRTogJyArIHN0cih0eXBlKG9iaikpKTsNCiAgICAgICAgICAgIHJldHVybiBvYmo7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGZvciBpIGluIG9iajoNCiAgICAgICAgICAgICAgICBvYmpbaV0gPSBVc2VyKCkuX2Zyb21Eb2N1bWVudChvYmpbaV0pOw0KICAgICAgICAgICAgcmV0dXJuIG9iajsNCg0KDQogICAgICAgIGlmICdJZCcgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5JZCA9IG9ialsnSWQnXTsNCg0KICAgIA0KICAgICAgICBpZiAnYWN0aXZlJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmFjdGl2ZShvYmpbJ2FjdGl2ZSddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdlbmFibGVkJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmVuYWJsZWQob2JqWydlbmFibGVkJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ2NvZGUnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuY29kZShvYmpbJ2NvZGUnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnb3JkZXInIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYub3JkZXIob2JqWydvcmRlciddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdkYXRlJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmRhdGUob2JqWydkYXRlJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ25hbWUnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYubmFtZShvYmpbJ25hbWUnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAncmVtYXJrJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLnJlbWFyayhvYmpbJ3JlbWFyayddKTsNCiAgICAgICAgDQogICAgICAgICAgICBzZWxmLnJlbWFyayggdWJpbmFzY2lpLmEyYl9iYXNlNjQoc2VsZi5yZW1hcmsoKSkgKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICd1c2VybmFtZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi51c2VybmFtZShvYmpbJ3VzZXJuYW1lJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ3Bhc3N3b3JkJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLnBhc3N3b3JkKG9ialsncGFzc3dvcmQnXSk7DQogICAgICAgIA0KICAgIA0KDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgDQogICAgZGVmIF90b0RvY3VtZW50KHNlbGYpOg0KICAgICAgICByZXQgPSB7fTsNCiAgICAgICAgaWYgc2VsZi5JZCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiSWQiXSA9IHNlbGYuSWQ7DQoNCiAgICANCiAgICAgICAgaWYgc2VsZi5hY3RpdmUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiYWN0aXZlIl0gPSBzZWxmLmFjdGl2ZSgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5lbmFibGVkKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbImVuYWJsZWQiXSA9IHNlbGYuZW5hYmxlZCgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5jb2RlKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbImNvZGUiXSA9IHNlbGYuY29kZSgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5vcmRlcigpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJvcmRlciJdID0gc2VsZi5vcmRlcigpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5kYXRlKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbImRhdGUiXSA9IHNlbGYuZGF0ZSgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5uYW1lKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbIm5hbWUiXSA9IHNlbGYubmFtZSgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5yZW1hcmsoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSBzZWxmLnJlbWFyaygpOw0KICAgICAgICANCiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UocmV0WyJyZW1hcmsiXSwgZGljdCk6DQogICAgICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IHVqc29uLmR1bXBzKHJldFsicmVtYXJrIl0pOw0KICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IHViaW5hc2NpaS5iMmFfYmFzZTY0KHJldFsicmVtYXJrIl0pLnN0cmlwKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLnVzZXJuYW1lKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbInVzZXJuYW1lIl0gPSBzZWxmLnVzZXJuYW1lKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLnBhc3N3b3JkKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbInBhc3N3b3JkIl0gPSBzZWxmLnBhc3N3b3JkKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICANCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICByZXR1cm4gcmV0Ow0KDQogICAgDQogICAgZGVmIHN0b3JlKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6DQogICAgICAgIF9fdG9TdHJpbmcgPSAnVXNlcjo6c3RvcmUoKTogJzsNCiAgICAgICAgDQogICAgICAgIGV2SlNPTiA9IE5vbmU7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIGV2SlNPTiA9IHVqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoNCiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7DQogICAgICAgIA0KDQogICAgICAgIGFuc3dlciA9IE5vbmU7DQoNCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpY2tzX21zKCkpKyddLlVzZXIuc3RvcmUoKScpLm1ldGhvZCgnc3RvcmUnKS5jbGFzc05hbWUoJ1VzZXInKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOw0KICAgICAgICANCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCiAgICAgICAgDQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgYW5zd2VyID0gVXNlcigpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQogICAgICAgIA0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCg0KDQoNCiAgICAgICAgaWYgJ1VzZXJfc3RvcmUnIGluIGRpcigpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICc9PT4gVXNlcl9zdG9yZSgpJyk7DQogICAgICAgICAgICBhbnN3ZXIgPSBVc2VyX3N0b3JlKHNlbGYsIF9fZXZlbnQsIGFuc3dlciwgX190b1N0cmluZyk7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KDQogICAgICAgICAgICANCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQoNCiAgICAgICAgcmV0dXJuIGFuc3dlcjsNCg0KICAgIA0KICAgIGRlZiBmaW5kQWxsKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6DQogICAgICAgIF9fdG9TdHJpbmcgPSAnVXNlcjo6ZmluZEFsbCgpOiAnOw0KICAgICAgICANCiAgICAgICAgZXZKU09OID0gTm9uZTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgZXZKU09OID0gdWpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOg0KICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsNCiAgICAgICAgDQoNCiAgICAgICAgYW5zd2VyID0gTm9uZTsNCg0KICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGlja3NfbXMoKSkrJ10uVXNlci5maW5kQWxsKCknKS5tZXRob2QoJ2ZpbmRBbGwnKS5jbGFzc05hbWUoJ1VzZXInKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOw0KICAgICAgICANCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCiAgICAgICAgDQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgYW5zd2VyID0gVXNlcigpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQogICAgICAgIA0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCg0KDQoNCiAgICAgICAgaWYgJ1VzZXJfZmluZEFsbCcgaW4gZGlyKCk6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJz09PiBVc2VyX2ZpbmRBbGwoKScpOw0KICAgICAgICAgICAgYW5zd2VyID0gVXNlcl9maW5kQWxsKHNlbGYsIF9fZXZlbnQsIGFuc3dlciwgX190b1N0cmluZyk7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KDQogICAgICAgICAgICANCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQoNCiAgICAgICAgcmV0dXJuIGFuc3dlcjsNCg0KICAgIA0KICAgIGRlZiBmaW5kKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6DQogICAgICAgIF9fdG9TdHJpbmcgPSAnVXNlcjo6ZmluZCgpOiAnOw0KICAgICAgICANCiAgICAgICAgZXZKU09OID0gTm9uZTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgZXZKU09OID0gdWpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOg0KICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsNCiAgICAgICAgDQoNCiAgICAgICAgYW5zd2VyID0gTm9uZTsNCg0KICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGlja3NfbXMoKSkrJ10uVXNlci5maW5kKCknKS5tZXRob2QoJ2ZpbmQnKS5jbGFzc05hbWUoJ1VzZXInKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOw0KICAgICAgICANCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCiAgICAgICAgDQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgYW5zd2VyID0gVXNlcigpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQogICAgICAgIA0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCg0KDQoNCiAgICAgICAgaWYgJ1VzZXJfZmluZCcgaW4gZGlyKCk6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJz09PiBVc2VyX2ZpbmQoKScpOw0KICAgICAgICAgICAgYW5zd2VyID0gVXNlcl9maW5kKHNlbGYsIF9fZXZlbnQsIGFuc3dlciwgX190b1N0cmluZyk7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KDQogICAgICAgICAgICANCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQoNCiAgICAgICAgcmV0dXJuIGFuc3dlcjsNCg0KICAgIA0KICAgIGRlZiBpbml0KHNlbGYsIF9fZXZlbnQ9Tm9uZSk6DQogICAgICAgIF9fdG9TdHJpbmcgPSAnVXNlcjo6aW5pdCgpOiAnOw0KICAgICAgICANCiAgICAgICAgZXZKU09OID0gTm9uZTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgZXZKU09OID0gdWpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOg0KICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsNCiAgICAgICAgDQoNCiAgICAgICAgYW5zd2VyID0gTm9uZTsNCg0KICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGlja3NfbXMoKSkrJ10uVXNlci5pbml0KCknKS5tZXRob2QoJ2luaXQnKS5jbGFzc05hbWUoJ1VzZXInKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOw0KICAgICAgICANCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCiAgICAgICAgDQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgYW5zd2VyID0gZXZKU09OOw0KICAgICAgICANCiAgICAgICAgDQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KDQoNCg0KICAgICAgICBpZiAnVXNlcl9pbml0JyBpbiBkaXIoKToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnPT0+IFVzZXJfaW5pdCgpJyk7DQogICAgICAgICAgICBhbnN3ZXIgPSBVc2VyX2luaXQoc2VsZiwgX19ldmVudCwgYW5zd2VyLCBfX3RvU3RyaW5nKTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChzdHIoYW5zd2VyKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCg0KICAgICAgICByZXR1cm4gYW5zd2VyOw0KDQogICAgDQoNCg0KY2xhc3MgQWN0aW9uX0V4ZWN1dGlvbigpOg0KICAgIGRlZiBfX2luaXRfXyhzZWxmLCBJZD1Ob25lLCBhY3RpdmU9Tm9uZSwgZW5hYmxlZD1Ob25lLCBjb2RlPU5vbmUsIG9yZGVyPU5vbmUsIGRhdGU9Tm9uZSwgbmFtZT1Ob25lLCByZW1hcms9Tm9uZSwgZGV2aWNlPU5vbmUsIGFjdGlvbj1Ob25lLCByZXN1bHQ9Tm9uZSwgY29tcGxldGVkPU5vbmUpOg0KICAgICAgICBzdXBlcigpLl9faW5pdF9fKCk7DQoNCiAgICAgICAgI3ByaW50KCdBY3Rpb25fRXhlY3V0aW9uOjpfX2luaXRfXygpJyk7DQogICAgICAgIGlmIElkIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgc2VsZi5JZCA9IElkOw0KDQogICAgICAgIA0KICAgICAgICBzZWxmLmFjdGl2ZShhY3RpdmUpOw0KICAgICAgICBzZWxmLmVuYWJsZWQoZW5hYmxlZCk7DQogICAgICAgIHNlbGYuY29kZShjb2RlKTsNCiAgICAgICAgc2VsZi5vcmRlcihvcmRlcik7DQogICAgICAgIHNlbGYuZGF0ZShkYXRlKTsNCiAgICAgICAgc2VsZi5uYW1lKG5hbWUpOw0KICAgICAgICBzZWxmLnJlbWFyayhyZW1hcmspOw0KICAgICAgICBzZWxmLmRldmljZShkZXZpY2UpOw0KICAgICAgICBzZWxmLmFjdGlvbihhY3Rpb24pOw0KICAgICAgICBzZWxmLnJlc3VsdChyZXN1bHQpOw0KICAgICAgICBzZWxmLmNvbXBsZXRlZChjb21wbGV0ZWQpOw0KICAgICAgICANCiAgICBJZCA9IE5vbmU7DQogICAgDQogICAgDQogICAgIyBhY3RpdmU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfYWN0aXZlID0gTm9uZTsNCiAgICBkZWYgYWN0aXZlKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2FjdGl2ZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9hY3RpdmU7DQoNCg0KICAgIA0KICAgICMgZW5hYmxlZDogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9lbmFibGVkID0gTm9uZTsNCiAgICBkZWYgZW5hYmxlZChzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9lbmFibGVkID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2VuYWJsZWQ7DQoNCg0KICAgIA0KICAgICMgY29kZTogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9jb2RlID0gTm9uZTsNCiAgICBkZWYgY29kZShzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9jb2RlID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2NvZGU7DQoNCg0KICAgIA0KICAgICMgb3JkZXI6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfb3JkZXIgPSBOb25lOw0KICAgIGRlZiBvcmRlcihzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9vcmRlciA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9vcmRlcjsNCg0KDQogICAgDQogICAgIyBkYXRlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2RhdGUgPSBOb25lOw0KICAgIGRlZiBkYXRlKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2RhdGUgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fZGF0ZTsNCg0KDQogICAgDQogICAgIyBuYW1lOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX25hbWUgPSBOb25lOw0KICAgIGRlZiBuYW1lKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX25hbWUgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fbmFtZTsNCg0KDQogICAgDQogICAgIyByZW1hcms6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfcmVtYXJrID0gTm9uZTsNCiAgICBkZWYgcmVtYXJrKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX3JlbWFyayA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9yZW1hcms7DQoNCg0KICAgIA0KICAgICMgZGV2aWNlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2RldmljZSA9IE5vbmU7DQogICAgZGVmIGRldmljZShzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9kZXZpY2UgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fZGV2aWNlOw0KDQoNCiAgICANCiAgICAjIGFjdGlvbjogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9hY3Rpb24gPSBOb25lOw0KICAgIGRlZiBhY3Rpb24oc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fYWN0aW9uID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2FjdGlvbjsNCg0KDQogICAgDQogICAgIyByZXN1bHQ6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfcmVzdWx0ID0gTm9uZTsNCiAgICBkZWYgcmVzdWx0KHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX3Jlc3VsdCA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9yZXN1bHQ7DQoNCg0KICAgIA0KICAgICMgY29tcGxldGVkOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2NvbXBsZXRlZCA9IE5vbmU7DQogICAgZGVmIGNvbXBsZXRlZChzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9jb21wbGV0ZWQgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fY29tcGxldGVkOw0KDQoNCiAgICANCiAgICANCiAgICBkZWYgX2Zyb21Eb2N1bWVudChzZWxmLCBvYmopOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ0FjdGlvbl9FeGVjdXRpb246Ol9mcm9tRG9jdW1lbnQoKTogJzsNCg0KICAgICAgICBpZiBvYmogaXMgTm9uZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICANCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIGJ5dGVzKToNCiAgICAgICAgICAgIG9iaiA9IHN0cihvYmosICJ1dGYtOCIpOw0KDQogICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLCBzdHIpIG9yIHR5cGUob2JqKSBpcyBzdHI6DQogICAgICAgICAgICBvYmogPSB1anNvbi5sb2FkcyhvYmopOw0KICAgICAgICANCiAgICAgICAgaWYgbm90IGlzaW5zdGFuY2Uob2JqLCAoc3RyLCBieXRlcywgZGljdCkpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICdHT1QgSEVSRTogJyArIHN0cih0eXBlKG9iaikpKTsNCiAgICAgICAgICAgIHJldHVybiBvYmo7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGZvciBpIGluIG9iajoNCiAgICAgICAgICAgICAgICBvYmpbaV0gPSBBY3Rpb25fRXhlY3V0aW9uKCkuX2Zyb21Eb2N1bWVudChvYmpbaV0pOw0KICAgICAgICAgICAgcmV0dXJuIG9iajsNCg0KDQogICAgICAgIGlmICdJZCcgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5JZCA9IG9ialsnSWQnXTsNCg0KICAgIA0KICAgICAgICBpZiAnYWN0aXZlJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmFjdGl2ZShvYmpbJ2FjdGl2ZSddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdlbmFibGVkJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmVuYWJsZWQob2JqWydlbmFibGVkJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ2NvZGUnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuY29kZShvYmpbJ2NvZGUnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnb3JkZXInIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYub3JkZXIob2JqWydvcmRlciddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdkYXRlJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmRhdGUob2JqWydkYXRlJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ25hbWUnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYubmFtZShvYmpbJ25hbWUnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAncmVtYXJrJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLnJlbWFyayhvYmpbJ3JlbWFyayddKTsNCiAgICAgICAgDQogICAgICAgICAgICBzZWxmLnJlbWFyayggdWJpbmFzY2lpLmEyYl9iYXNlNjQoc2VsZi5yZW1hcmsoKSkgKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdkZXZpY2UnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuZGV2aWNlKERldmljZSgpLl9mcm9tRG9jdW1lbnQob2JqWydkZXZpY2UnXSkpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ2FjdGlvbicgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5hY3Rpb24oRGV2aWNlX0FjdGlvbigpLl9mcm9tRG9jdW1lbnQob2JqWydhY3Rpb24nXSkpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ3Jlc3VsdCcgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5yZXN1bHQob2JqWydyZXN1bHQnXSk7DQogICAgICAgIA0KICAgICAgICAgICAgc2VsZi5yZXN1bHQoIHViaW5hc2NpaS5hMmJfYmFzZTY0KHNlbGYucmVzdWx0KCkpICk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnY29tcGxldGVkJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmNvbXBsZXRlZChvYmpbJ2NvbXBsZXRlZCddKTsNCiAgICAgICAgDQogICAgDQoNCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICByZXR1cm4gc2VsZjsNCiAgICANCiAgICBkZWYgX3RvRG9jdW1lbnQoc2VsZik6DQogICAgICAgIHJldCA9IHt9Ow0KICAgICAgICBpZiBzZWxmLklkIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJJZCJdID0gc2VsZi5JZDsNCg0KICAgIA0KICAgICAgICBpZiBzZWxmLmFjdGl2ZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJhY3RpdmUiXSA9IHNlbGYuYWN0aXZlKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmVuYWJsZWQoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiZW5hYmxlZCJdID0gc2VsZi5lbmFibGVkKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmNvZGUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiY29kZSJdID0gc2VsZi5jb2RlKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLm9yZGVyKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbIm9yZGVyIl0gPSBzZWxmLm9yZGVyKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmRhdGUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiZGF0ZSJdID0gc2VsZi5kYXRlKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLm5hbWUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsibmFtZSJdID0gc2VsZi5uYW1lKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLnJlbWFyaygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IHNlbGYucmVtYXJrKCk7DQogICAgICAgIA0KICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShyZXRbInJlbWFyayJdLCBkaWN0KToNCiAgICAgICAgICAgICAgICByZXRbInJlbWFyayJdID0gdWpzb24uZHVtcHMocmV0WyJyZW1hcmsiXSk7DQogICAgICAgICAgICByZXRbInJlbWFyayJdID0gdWJpbmFzY2lpLmIyYV9iYXNlNjQocmV0WyJyZW1hcmsiXSkuc3RyaXAoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYuZGV2aWNlKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbImRldmljZSJdID0gc2VsZi5kZXZpY2UoKS5fdG9Eb2N1bWVudCgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5hY3Rpb24oKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiYWN0aW9uIl0gPSBzZWxmLmFjdGlvbigpLl90b0RvY3VtZW50KCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLnJlc3VsdCgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJyZXN1bHQiXSA9IHNlbGYucmVzdWx0KCk7DQogICAgICAgIA0KICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShyZXRbInJlc3VsdCJdLCBkaWN0KToNCiAgICAgICAgICAgICAgICByZXRbInJlc3VsdCJdID0gdWpzb24uZHVtcHMocmV0WyJyZXN1bHQiXSk7DQogICAgICAgICAgICByZXRbInJlc3VsdCJdID0gdWJpbmFzY2lpLmIyYV9iYXNlNjQocmV0WyJyZXN1bHQiXSkuc3RyaXAoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYuY29tcGxldGVkKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbImNvbXBsZXRlZCJdID0gc2VsZi5jb21wbGV0ZWQoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIHJldHVybiByZXQ7DQoNCiAgICANCiAgICBkZWYgc3RvcmUoc2VsZiwgX19ldmVudD1Ob25lKToNCiAgICAgICAgX190b1N0cmluZyA9ICdBY3Rpb25fRXhlY3V0aW9uOjpzdG9yZSgpOiAnOw0KICAgICAgICANCiAgICAgICAgZXZKU09OID0gTm9uZTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgZXZKU09OID0gdWpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOg0KICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsNCiAgICAgICAgDQoNCiAgICAgICAgYW5zd2VyID0gTm9uZTsNCg0KICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGlja3NfbXMoKSkrJ10uQWN0aW9uX0V4ZWN1dGlvbi5zdG9yZSgpJykubWV0aG9kKCdzdG9yZScpLmNsYXNzTmFtZSgnQWN0aW9uX0V4ZWN1dGlvbicpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7DQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KICAgICAgICANCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICBhbnN3ZXIgPSBBY3Rpb25fRXhlY3V0aW9uKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCiAgICAgICAgDQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KDQoNCg0KICAgICAgICBpZiAnQWN0aW9uX0V4ZWN1dGlvbl9zdG9yZScgaW4gZGlyKCk6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJz09PiBBY3Rpb25fRXhlY3V0aW9uX3N0b3JlKCknKTsNCiAgICAgICAgICAgIGFuc3dlciA9IEFjdGlvbl9FeGVjdXRpb25fc3RvcmUoc2VsZiwgX19ldmVudCwgYW5zd2VyLCBfX3RvU3RyaW5nKTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCg0KICAgICAgICByZXR1cm4gYW5zd2VyOw0KDQogICAgDQogICAgZGVmIGZpbmRBbGwoc2VsZiwgX19ldmVudD1Ob25lKToNCiAgICAgICAgX190b1N0cmluZyA9ICdBY3Rpb25fRXhlY3V0aW9uOjpmaW5kQWxsKCk6ICc7DQogICAgICAgIA0KICAgICAgICBldkpTT04gPSBOb25lOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBldkpTT04gPSB1anNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046DQogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOw0KICAgICAgICANCg0KICAgICAgICBhbnN3ZXIgPSBOb25lOw0KDQogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aWNrc19tcygpKSsnXS5BY3Rpb25fRXhlY3V0aW9uLmZpbmRBbGwoKScpLm1ldGhvZCgnZmluZEFsbCcpLmNsYXNzTmFtZSgnQWN0aW9uX0V4ZWN1dGlvbicpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7DQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KICAgICAgICANCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICBhbnN3ZXIgPSBBY3Rpb25fRXhlY3V0aW9uKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCiAgICAgICAgDQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KDQoNCg0KICAgICAgICBpZiAnQWN0aW9uX0V4ZWN1dGlvbl9maW5kQWxsJyBpbiBkaXIoKToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnPT0+IEFjdGlvbl9FeGVjdXRpb25fZmluZEFsbCgpJyk7DQogICAgICAgICAgICBhbnN3ZXIgPSBBY3Rpb25fRXhlY3V0aW9uX2ZpbmRBbGwoc2VsZiwgX19ldmVudCwgYW5zd2VyLCBfX3RvU3RyaW5nKTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCg0KICAgICAgICByZXR1cm4gYW5zd2VyOw0KDQogICAgDQogICAgZGVmIGZpbmQoc2VsZiwgX19ldmVudD1Ob25lKToNCiAgICAgICAgX190b1N0cmluZyA9ICdBY3Rpb25fRXhlY3V0aW9uOjpmaW5kKCk6ICc7DQogICAgICAgIA0KICAgICAgICBldkpTT04gPSBOb25lOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBldkpTT04gPSB1anNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046DQogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOw0KICAgICAgICANCg0KICAgICAgICBhbnN3ZXIgPSBOb25lOw0KDQogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aWNrc19tcygpKSsnXS5BY3Rpb25fRXhlY3V0aW9uLmZpbmQoKScpLm1ldGhvZCgnZmluZCcpLmNsYXNzTmFtZSgnQWN0aW9uX0V4ZWN1dGlvbicpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7DQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KICAgICAgICANCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICBhbnN3ZXIgPSBBY3Rpb25fRXhlY3V0aW9uKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCiAgICAgICAgDQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiY29tcGxldGVkPSIrYW5zd2VyLmNvbXBsZXRlZCgpKTsKICAgICAgICAgICAgIyBpZiBhbmQgYW5zd2VyLnJlc3VsdCgpIGlzIE5vbmUgYW5kIGFuc3dlci5jb21wbGV0ZWQoKSBpcyBOb25lIGFuZCBhbnN3ZXIuYWN0aW9uKCkuc2NyaXB0KCkgaXMgbm90IE5vbmUKICAgICAgICAgICAgI3ByaW50KF9fdG9TdHJpbmcgKyBhbnN3ZXIuYWN0aW9uKCkuY29kZSgpICsgJyBpcyBleGVjdXRpbmcnKTsKCSAgICANCg0KDQogICAgICAgIGlmICdBY3Rpb25fRXhlY3V0aW9uX2ZpbmQnIGluIGRpcigpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICc9PT4gQWN0aW9uX0V4ZWN1dGlvbl9maW5kKCknKTsNCiAgICAgICAgICAgIGFuc3dlciA9IEFjdGlvbl9FeGVjdXRpb25fZmluZChzZWxmLCBfX2V2ZW50LCBhbnN3ZXIsIF9fdG9TdHJpbmcpOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCg0KICAgICAgICAgICAgDQogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KDQogICAgICAgIHJldHVybiBhbnN3ZXI7DQoNCiAgICANCg0KDQpjbGFzcyBEZXZpY2VfQWN0aW9uKCk6DQogICAgZGVmIF9faW5pdF9fKHNlbGYsIElkPU5vbmUsIGFjdGl2ZT1Ob25lLCBlbmFibGVkPU5vbmUsIGNvZGU9Tm9uZSwgb3JkZXI9Tm9uZSwgZGF0ZT1Ob25lLCBuYW1lPU5vbmUsIHJlbWFyaz1Ob25lLCBzY3JpcHQ9Tm9uZSwgdHlwZT1Ob25lKToNCiAgICAgICAgc3VwZXIoKS5fX2luaXRfXygpOw0KDQogICAgICAgICNwcmludCgnRGV2aWNlX0FjdGlvbjo6X19pbml0X18oKScpOw0KICAgICAgICBpZiBJZCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHNlbGYuSWQgPSBJZDsNCg0KICAgICAgICANCiAgICAgICAgc2VsZi5hY3RpdmUoYWN0aXZlKTsNCiAgICAgICAgc2VsZi5lbmFibGVkKGVuYWJsZWQpOw0KICAgICAgICBzZWxmLmNvZGUoY29kZSk7DQogICAgICAgIHNlbGYub3JkZXIob3JkZXIpOw0KICAgICAgICBzZWxmLmRhdGUoZGF0ZSk7DQogICAgICAgIHNlbGYubmFtZShuYW1lKTsNCiAgICAgICAgc2VsZi5yZW1hcmsocmVtYXJrKTsNCiAgICAgICAgc2VsZi5zY3JpcHQoc2NyaXB0KTsNCiAgICAgICAgc2VsZi50eXBlKHR5cGUpOw0KICAgICAgICANCiAgICBJZCA9IE5vbmU7DQogICAgDQogICAgDQogICAgIyBhY3RpdmU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfYWN0aXZlID0gTm9uZTsNCiAgICBkZWYgYWN0aXZlKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2FjdGl2ZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9hY3RpdmU7DQoNCg0KICAgIA0KICAgICMgZW5hYmxlZDogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9lbmFibGVkID0gTm9uZTsNCiAgICBkZWYgZW5hYmxlZChzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9lbmFibGVkID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2VuYWJsZWQ7DQoNCg0KICAgIA0KICAgICMgY29kZTogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9jb2RlID0gTm9uZTsNCiAgICBkZWYgY29kZShzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9jb2RlID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2NvZGU7DQoNCg0KICAgIA0KICAgICMgb3JkZXI6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfb3JkZXIgPSBOb25lOw0KICAgIGRlZiBvcmRlcihzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9vcmRlciA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9vcmRlcjsNCg0KDQogICAgDQogICAgIyBkYXRlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2RhdGUgPSBOb25lOw0KICAgIGRlZiBkYXRlKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2RhdGUgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fZGF0ZTsNCg0KDQogICAgDQogICAgIyBuYW1lOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX25hbWUgPSBOb25lOw0KICAgIGRlZiBuYW1lKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX25hbWUgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fbmFtZTsNCg0KDQogICAgDQogICAgIyByZW1hcms6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfcmVtYXJrID0gTm9uZTsNCiAgICBkZWYgcmVtYXJrKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX3JlbWFyayA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9yZW1hcms7DQoNCg0KICAgIA0KICAgICMgc2NyaXB0OiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX3NjcmlwdCA9IE5vbmU7DQogICAgZGVmIHNjcmlwdChzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9zY3JpcHQgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fc2NyaXB0Ow0KDQoNCiAgICANCiAgICAjIHR5cGU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfdHlwZSA9IE5vbmU7DQogICAgZGVmIHR5cGUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fdHlwZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl90eXBlOw0KDQoNCiAgICANCiAgICANCiAgICBkZWYgX2Zyb21Eb2N1bWVudChzZWxmLCBvYmopOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ0RldmljZV9BY3Rpb246Ol9mcm9tRG9jdW1lbnQoKTogJzsNCg0KICAgICAgICBpZiBvYmogaXMgTm9uZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICANCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIGJ5dGVzKToNCiAgICAgICAgICAgIG9iaiA9IHN0cihvYmosICJ1dGYtOCIpOw0KDQogICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLCBzdHIpIG9yIHR5cGUob2JqKSBpcyBzdHI6DQogICAgICAgICAgICBvYmogPSB1anNvbi5sb2FkcyhvYmopOw0KICAgICAgICANCiAgICAgICAgaWYgbm90IGlzaW5zdGFuY2Uob2JqLCAoc3RyLCBieXRlcywgZGljdCkpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICdHT1QgSEVSRTogJyArIHN0cih0eXBlKG9iaikpKTsNCiAgICAgICAgICAgIHJldHVybiBvYmo7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGZvciBpIGluIG9iajoNCiAgICAgICAgICAgICAgICBvYmpbaV0gPSBEZXZpY2VfQWN0aW9uKCkuX2Zyb21Eb2N1bWVudChvYmpbaV0pOw0KICAgICAgICAgICAgcmV0dXJuIG9iajsNCg0KDQogICAgICAgIGlmICdJZCcgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5JZCA9IG9ialsnSWQnXTsNCg0KICAgIA0KICAgICAgICBpZiAnYWN0aXZlJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmFjdGl2ZShvYmpbJ2FjdGl2ZSddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdlbmFibGVkJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmVuYWJsZWQob2JqWydlbmFibGVkJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ2NvZGUnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuY29kZShvYmpbJ2NvZGUnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnb3JkZXInIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYub3JkZXIob2JqWydvcmRlciddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdkYXRlJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmRhdGUob2JqWydkYXRlJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ25hbWUnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYubmFtZShvYmpbJ25hbWUnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAncmVtYXJrJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLnJlbWFyayhvYmpbJ3JlbWFyayddKTsNCiAgICAgICAgDQogICAgICAgICAgICBzZWxmLnJlbWFyayggdWJpbmFzY2lpLmEyYl9iYXNlNjQoc2VsZi5yZW1hcmsoKSkgKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdzY3JpcHQnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuc2NyaXB0KG9ialsnc2NyaXB0J10pOw0KICAgICAgICANCiAgICAgICAgICAgIHNlbGYuc2NyaXB0KCB1YmluYXNjaWkuYTJiX2Jhc2U2NChzZWxmLnNjcmlwdCgpKSApOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ3R5cGUnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYudHlwZShEZXZpY2VfVHlwZSgpLl9mcm9tRG9jdW1lbnQob2JqWyd0eXBlJ10pKTsNCiAgICAgICAgDQogICAgDQoNCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICByZXR1cm4gc2VsZjsNCiAgICANCiAgICBkZWYgX3RvRG9jdW1lbnQoc2VsZik6DQogICAgICAgIHJldCA9IHt9Ow0KICAgICAgICBpZiBzZWxmLklkIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJJZCJdID0gc2VsZi5JZDsNCg0KICAgIA0KICAgICAgICBpZiBzZWxmLmFjdGl2ZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJhY3RpdmUiXSA9IHNlbGYuYWN0aXZlKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmVuYWJsZWQoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiZW5hYmxlZCJdID0gc2VsZi5lbmFibGVkKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmNvZGUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiY29kZSJdID0gc2VsZi5jb2RlKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLm9yZGVyKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbIm9yZGVyIl0gPSBzZWxmLm9yZGVyKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmRhdGUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiZGF0ZSJdID0gc2VsZi5kYXRlKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLm5hbWUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsibmFtZSJdID0gc2VsZi5uYW1lKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLnJlbWFyaygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IHNlbGYucmVtYXJrKCk7DQogICAgICAgIA0KICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShyZXRbInJlbWFyayJdLCBkaWN0KToNCiAgICAgICAgICAgICAgICByZXRbInJlbWFyayJdID0gdWpzb24uZHVtcHMocmV0WyJyZW1hcmsiXSk7DQogICAgICAgICAgICByZXRbInJlbWFyayJdID0gdWJpbmFzY2lpLmIyYV9iYXNlNjQocmV0WyJyZW1hcmsiXSkuc3RyaXAoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYuc2NyaXB0KCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbInNjcmlwdCJdID0gc2VsZi5zY3JpcHQoKTsNCiAgICAgICAgDQogICAgICAgICAgICBpZiBpc2luc3RhbmNlKHJldFsic2NyaXB0Il0sIGRpY3QpOg0KICAgICAgICAgICAgICAgIHJldFsic2NyaXB0Il0gPSB1anNvbi5kdW1wcyhyZXRbInNjcmlwdCJdKTsNCiAgICAgICAgICAgIHJldFsic2NyaXB0Il0gPSB1YmluYXNjaWkuYjJhX2Jhc2U2NChyZXRbInNjcmlwdCJdKS5zdHJpcCgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi50eXBlKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbInR5cGUiXSA9IHNlbGYudHlwZSgpLl90b0RvY3VtZW50KCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICANCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICByZXR1cm4gcmV0Ow0KDQogICAgDQogICAgZGVmIHN0b3JlKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6DQogICAgICAgIF9fdG9TdHJpbmcgPSAnRGV2aWNlX0FjdGlvbjo6c3RvcmUoKTogJzsNCiAgICAgICAgDQogICAgICAgIGV2SlNPTiA9IE5vbmU7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIGV2SlNPTiA9IHVqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoNCiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7DQogICAgICAgIA0KDQogICAgICAgIGFuc3dlciA9IE5vbmU7DQoNCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpY2tzX21zKCkpKyddLkRldmljZV9BY3Rpb24uc3RvcmUoKScpLm1ldGhvZCgnc3RvcmUnKS5jbGFzc05hbWUoJ0RldmljZV9BY3Rpb24nKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOw0KICAgICAgICANCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCiAgICAgICAgDQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgYW5zd2VyID0gRGV2aWNlX0FjdGlvbigpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQogICAgICAgIA0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCg0KDQoNCiAgICAgICAgaWYgJ0RldmljZV9BY3Rpb25fc3RvcmUnIGluIGRpcigpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICc9PT4gRGV2aWNlX0FjdGlvbl9zdG9yZSgpJyk7DQogICAgICAgICAgICBhbnN3ZXIgPSBEZXZpY2VfQWN0aW9uX3N0b3JlKHNlbGYsIF9fZXZlbnQsIGFuc3dlciwgX190b1N0cmluZyk7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KDQogICAgICAgICAgICANCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQoNCiAgICAgICAgcmV0dXJuIGFuc3dlcjsNCg0KICAgIA0KICAgIGRlZiBmaW5kQWxsKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6DQogICAgICAgIF9fdG9TdHJpbmcgPSAnRGV2aWNlX0FjdGlvbjo6ZmluZEFsbCgpOiAnOw0KICAgICAgICANCiAgICAgICAgZXZKU09OID0gTm9uZTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgZXZKU09OID0gdWpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOg0KICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsNCiAgICAgICAgDQoNCiAgICAgICAgYW5zd2VyID0gTm9uZTsNCg0KICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGlja3NfbXMoKSkrJ10uRGV2aWNlX0FjdGlvbi5maW5kQWxsKCknKS5tZXRob2QoJ2ZpbmRBbGwnKS5jbGFzc05hbWUoJ0RldmljZV9BY3Rpb24nKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOw0KICAgICAgICANCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCiAgICAgICAgDQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgYW5zd2VyID0gRGV2aWNlX0FjdGlvbigpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQogICAgICAgIA0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCg0KDQoNCiAgICAgICAgaWYgJ0RldmljZV9BY3Rpb25fZmluZEFsbCcgaW4gZGlyKCk6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJz09PiBEZXZpY2VfQWN0aW9uX2ZpbmRBbGwoKScpOw0KICAgICAgICAgICAgYW5zd2VyID0gRGV2aWNlX0FjdGlvbl9maW5kQWxsKHNlbGYsIF9fZXZlbnQsIGFuc3dlciwgX190b1N0cmluZyk7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KDQogICAgICAgICAgICANCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQoNCiAgICAgICAgcmV0dXJuIGFuc3dlcjsNCg0KICAgIA0KICAgIGRlZiBmaW5kKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6DQogICAgICAgIF9fdG9TdHJpbmcgPSAnRGV2aWNlX0FjdGlvbjo6ZmluZCgpOiAnOw0KICAgICAgICANCiAgICAgICAgZXZKU09OID0gTm9uZTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgZXZKU09OID0gdWpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOg0KICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsNCiAgICAgICAgDQoNCiAgICAgICAgYW5zd2VyID0gTm9uZTsNCg0KICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGlja3NfbXMoKSkrJ10uRGV2aWNlX0FjdGlvbi5maW5kKCknKS5tZXRob2QoJ2ZpbmQnKS5jbGFzc05hbWUoJ0RldmljZV9BY3Rpb24nKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOw0KICAgICAgICANCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCiAgICAgICAgDQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgYW5zd2VyID0gRGV2aWNlX0FjdGlvbigpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQogICAgICAgIA0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCg0KDQoNCiAgICAgICAgaWYgJ0RldmljZV9BY3Rpb25fZmluZCcgaW4gZGlyKCk6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJz09PiBEZXZpY2VfQWN0aW9uX2ZpbmQoKScpOw0KICAgICAgICAgICAgYW5zd2VyID0gRGV2aWNlX0FjdGlvbl9maW5kKHNlbGYsIF9fZXZlbnQsIGFuc3dlciwgX190b1N0cmluZyk7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KDQogICAgICAgICAgICANCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQoNCiAgICAgICAgcmV0dXJuIGFuc3dlcjsNCg0KICAgIA0KDQoNCmNsYXNzIERldmljZSgpOg0KICAgIGRlZiBfX2luaXRfXyhzZWxmLCBJZD1Ob25lLCBhY3RpdmU9Tm9uZSwgZW5hYmxlZD1Ob25lLCBjb2RlPU5vbmUsIG9yZGVyPU5vbmUsIGRhdGU9Tm9uZSwgbmFtZT1Ob25lLCByZW1hcms9Tm9uZSwgdHlwZT1Ob25lLCBjb250cm9sbGVyPU5vbmUpOg0KICAgICAgICBzdXBlcigpLl9faW5pdF9fKCk7DQoNCiAgICAgICAgI3ByaW50KCdEZXZpY2U6Ol9faW5pdF9fKCknKTsNCiAgICAgICAgaWYgSWQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBzZWxmLklkID0gSWQ7DQoNCiAgICAgICAgDQogICAgICAgIHNlbGYuYWN0aXZlKGFjdGl2ZSk7DQogICAgICAgIHNlbGYuZW5hYmxlZChlbmFibGVkKTsNCiAgICAgICAgc2VsZi5jb2RlKGNvZGUpOw0KICAgICAgICBzZWxmLm9yZGVyKG9yZGVyKTsNCiAgICAgICAgc2VsZi5kYXRlKGRhdGUpOw0KICAgICAgICBzZWxmLm5hbWUobmFtZSk7DQogICAgICAgIHNlbGYucmVtYXJrKHJlbWFyayk7DQogICAgICAgIHNlbGYudHlwZSh0eXBlKTsNCiAgICAgICAgc2VsZi5jb250cm9sbGVyKGNvbnRyb2xsZXIpOw0KICAgICAgICANCiAgICBJZCA9IE5vbmU7DQogICAgDQogICAgDQogICAgIyBhY3RpdmU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfYWN0aXZlID0gTm9uZTsNCiAgICBkZWYgYWN0aXZlKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2FjdGl2ZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9hY3RpdmU7DQoNCg0KICAgIA0KICAgICMgZW5hYmxlZDogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9lbmFibGVkID0gTm9uZTsNCiAgICBkZWYgZW5hYmxlZChzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9lbmFibGVkID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2VuYWJsZWQ7DQoNCg0KICAgIA0KICAgICMgY29kZTogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9jb2RlID0gTm9uZTsNCiAgICBkZWYgY29kZShzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9jb2RlID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2NvZGU7DQoNCg0KICAgIA0KICAgICMgb3JkZXI6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfb3JkZXIgPSBOb25lOw0KICAgIGRlZiBvcmRlcihzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9vcmRlciA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9vcmRlcjsNCg0KDQogICAgDQogICAgIyBkYXRlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2RhdGUgPSBOb25lOw0KICAgIGRlZiBkYXRlKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2RhdGUgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fZGF0ZTsNCg0KDQogICAgDQogICAgIyBuYW1lOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX25hbWUgPSBOb25lOw0KICAgIGRlZiBuYW1lKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX25hbWUgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fbmFtZTsNCg0KDQogICAgDQogICAgIyByZW1hcms6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfcmVtYXJrID0gTm9uZTsNCiAgICBkZWYgcmVtYXJrKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX3JlbWFyayA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9yZW1hcms7DQoNCg0KICAgIA0KICAgICMgdHlwZTogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF90eXBlID0gTm9uZTsNCiAgICBkZWYgdHlwZShzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl90eXBlID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3R5cGU7DQoNCg0KICAgIA0KICAgICMgY29udHJvbGxlcjogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9jb250cm9sbGVyID0gTm9uZTsNCiAgICBkZWYgY29udHJvbGxlcihzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9jb250cm9sbGVyID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2NvbnRyb2xsZXI7DQoNCg0KICAgIA0KICAgIA0KICAgIGRlZiBfZnJvbURvY3VtZW50KHNlbGYsIG9iaik6DQogICAgICAgIF9fdG9TdHJpbmcgPSAnRGV2aWNlOjpfZnJvbURvY3VtZW50KCk6ICc7DQoNCiAgICAgICAgaWYgb2JqIGlzIE5vbmU6DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgDQogICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLCBieXRlcyk6DQogICAgICAgICAgICBvYmogPSBzdHIob2JqLCAidXRmLTgiKTsNCg0KICAgICAgICBpZiBpc2luc3RhbmNlKG9iaiwgc3RyKSBvciB0eXBlKG9iaikgaXMgc3RyOg0KICAgICAgICAgICAgb2JqID0gdWpzb24ubG9hZHMob2JqKTsNCiAgICAgICAgDQogICAgICAgIGlmIG5vdCBpc2luc3RhbmNlKG9iaiwgKHN0ciwgYnl0ZXMsIGRpY3QpKToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnR09UIEhFUkU6ICcgKyBzdHIodHlwZShvYmopKSk7DQogICAgICAgICAgICByZXR1cm4gb2JqOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBmb3IgaSBpbiBvYmo6DQogICAgICAgICAgICAgICAgb2JqW2ldID0gRGV2aWNlKCkuX2Zyb21Eb2N1bWVudChvYmpbaV0pOw0KICAgICAgICAgICAgcmV0dXJuIG9iajsNCg0KDQogICAgICAgIGlmICdJZCcgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5JZCA9IG9ialsnSWQnXTsNCg0KICAgIA0KICAgICAgICBpZiAnYWN0aXZlJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmFjdGl2ZShvYmpbJ2FjdGl2ZSddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdlbmFibGVkJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmVuYWJsZWQob2JqWydlbmFibGVkJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ2NvZGUnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuY29kZShvYmpbJ2NvZGUnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnb3JkZXInIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYub3JkZXIob2JqWydvcmRlciddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdkYXRlJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmRhdGUob2JqWydkYXRlJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ25hbWUnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYubmFtZShvYmpbJ25hbWUnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAncmVtYXJrJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLnJlbWFyayhvYmpbJ3JlbWFyayddKTsNCiAgICAgICAgDQogICAgICAgICAgICBzZWxmLnJlbWFyayggdWJpbmFzY2lpLmEyYl9iYXNlNjQoc2VsZi5yZW1hcmsoKSkgKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICd0eXBlJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLnR5cGUoRGV2aWNlX1R5cGUoKS5fZnJvbURvY3VtZW50KG9ialsndHlwZSddKSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnY29udHJvbGxlcicgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5jb250cm9sbGVyKE5vZGUoKS5fZnJvbURvY3VtZW50KG9ialsnY29udHJvbGxlciddKSk7DQogICAgICAgIA0KICAgIA0KDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgDQogICAgZGVmIF90b0RvY3VtZW50KHNlbGYpOg0KICAgICAgICByZXQgPSB7fTsNCiAgICAgICAgaWYgc2VsZi5JZCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiSWQiXSA9IHNlbGYuSWQ7DQoNCiAgICANCiAgICAgICAgaWYgc2VsZi5hY3RpdmUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiYWN0aXZlIl0gPSBzZWxmLmFjdGl2ZSgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5lbmFibGVkKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbImVuYWJsZWQiXSA9IHNlbGYuZW5hYmxlZCgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5jb2RlKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbImNvZGUiXSA9IHNlbGYuY29kZSgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5vcmRlcigpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJvcmRlciJdID0gc2VsZi5vcmRlcigpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5kYXRlKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbImRhdGUiXSA9IHNlbGYuZGF0ZSgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5uYW1lKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbIm5hbWUiXSA9IHNlbGYubmFtZSgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5yZW1hcmsoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSBzZWxmLnJlbWFyaygpOw0KICAgICAgICANCiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UocmV0WyJyZW1hcmsiXSwgZGljdCk6DQogICAgICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IHVqc29uLmR1bXBzKHJldFsicmVtYXJrIl0pOw0KICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IHViaW5hc2NpaS5iMmFfYmFzZTY0KHJldFsicmVtYXJrIl0pLnN0cmlwKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLnR5cGUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsidHlwZSJdID0gc2VsZi50eXBlKCkuX3RvRG9jdW1lbnQoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYuY29udHJvbGxlcigpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJjb250cm9sbGVyIl0gPSBzZWxmLmNvbnRyb2xsZXIoKS5fdG9Eb2N1bWVudCgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgcmV0dXJuIHJldDsNCg0KICAgIA0KICAgIGRlZiBzdG9yZShzZWxmLCBfX2V2ZW50PU5vbmUpOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ0RldmljZTo6c3RvcmUoKTogJzsNCiAgICAgICAgDQogICAgICAgIGV2SlNPTiA9IE5vbmU7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIGV2SlNPTiA9IHVqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoNCiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7DQogICAgICAgIA0KDQogICAgICAgIGFuc3dlciA9IE5vbmU7DQoNCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpY2tzX21zKCkpKyddLkRldmljZS5zdG9yZSgpJykubWV0aG9kKCdzdG9yZScpLmNsYXNzTmFtZSgnRGV2aWNlJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOw0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsNCiAgICAgICAgDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQogICAgICAgIA0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgIGFuc3dlciA9IERldmljZSgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQogICAgICAgIA0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCg0KDQoNCiAgICAgICAgaWYgJ0RldmljZV9zdG9yZScgaW4gZGlyKCk6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJz09PiBEZXZpY2Vfc3RvcmUoKScpOw0KICAgICAgICAgICAgYW5zd2VyID0gRGV2aWNlX3N0b3JlKHNlbGYsIF9fZXZlbnQsIGFuc3dlciwgX190b1N0cmluZyk7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KDQogICAgICAgICAgICANCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQoNCiAgICAgICAgcmV0dXJuIGFuc3dlcjsNCg0KICAgIA0KICAgIGRlZiBmaW5kQWxsKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6DQogICAgICAgIF9fdG9TdHJpbmcgPSAnRGV2aWNlOjpmaW5kQWxsKCk6ICc7DQogICAgICAgIA0KICAgICAgICBldkpTT04gPSBOb25lOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBldkpTT04gPSB1anNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046DQogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOw0KICAgICAgICANCg0KICAgICAgICBhbnN3ZXIgPSBOb25lOw0KDQogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aWNrc19tcygpKSsnXS5EZXZpY2UuZmluZEFsbCgpJykubWV0aG9kKCdmaW5kQWxsJykuY2xhc3NOYW1lKCdEZXZpY2UnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOw0KICAgICAgICANCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCiAgICAgICAgDQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgYW5zd2VyID0gRGV2aWNlKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCiAgICAgICAgDQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KDQoNCg0KICAgICAgICBpZiAnRGV2aWNlX2ZpbmRBbGwnIGluIGRpcigpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICc9PT4gRGV2aWNlX2ZpbmRBbGwoKScpOw0KICAgICAgICAgICAgYW5zd2VyID0gRGV2aWNlX2ZpbmRBbGwoc2VsZiwgX19ldmVudCwgYW5zd2VyLCBfX3RvU3RyaW5nKTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCg0KICAgICAgICByZXR1cm4gYW5zd2VyOw0KDQogICAgDQogICAgZGVmIGZpbmQoc2VsZiwgX19ldmVudD1Ob25lKToNCiAgICAgICAgX190b1N0cmluZyA9ICdEZXZpY2U6OmZpbmQoKTogJzsNCiAgICAgICAgDQogICAgICAgIGV2SlNPTiA9IE5vbmU7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIGV2SlNPTiA9IHVqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoNCiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7DQogICAgICAgIA0KDQogICAgICAgIGFuc3dlciA9IE5vbmU7DQoNCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpY2tzX21zKCkpKyddLkRldmljZS5maW5kKCknKS5tZXRob2QoJ2ZpbmQnKS5jbGFzc05hbWUoJ0RldmljZScpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7DQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KICAgICAgICANCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICBhbnN3ZXIgPSBEZXZpY2UoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KICAgICAgICANCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQoNCg0KDQogICAgICAgIGlmICdEZXZpY2VfZmluZCcgaW4gZGlyKCk6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJz09PiBEZXZpY2VfZmluZCgpJyk7DQogICAgICAgICAgICBhbnN3ZXIgPSBEZXZpY2VfZmluZChzZWxmLCBfX2V2ZW50LCBhbnN3ZXIsIF9fdG9TdHJpbmcpOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCg0KICAgICAgICAgICAgDQogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KDQogICAgICAgIHJldHVybiBhbnN3ZXI7DQoNCiAgICANCg0KDQpjbGFzcyBEZXZpY2VfQ2F0ZWdvcnkoKToNCiAgICBkZWYgX19pbml0X18oc2VsZiwgSWQ9Tm9uZSwgYWN0aXZlPU5vbmUsIGVuYWJsZWQ9Tm9uZSwgY29kZT1Ob25lLCBvcmRlcj1Ob25lLCBkYXRlPU5vbmUsIG5hbWU9Tm9uZSwgcmVtYXJrPU5vbmUsIHBhcmVudD1Ob25lKToNCiAgICAgICAgc3VwZXIoKS5fX2luaXRfXygpOw0KDQogICAgICAgICNwcmludCgnRGV2aWNlX0NhdGVnb3J5OjpfX2luaXRfXygpJyk7DQogICAgICAgIGlmIElkIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgc2VsZi5JZCA9IElkOw0KDQogICAgICAgIA0KICAgICAgICBzZWxmLmFjdGl2ZShhY3RpdmUpOw0KICAgICAgICBzZWxmLmVuYWJsZWQoZW5hYmxlZCk7DQogICAgICAgIHNlbGYuY29kZShjb2RlKTsNCiAgICAgICAgc2VsZi5vcmRlcihvcmRlcik7DQogICAgICAgIHNlbGYuZGF0ZShkYXRlKTsNCiAgICAgICAgc2VsZi5uYW1lKG5hbWUpOw0KICAgICAgICBzZWxmLnJlbWFyayhyZW1hcmspOw0KICAgICAgICBzZWxmLnBhcmVudChwYXJlbnQpOw0KICAgICAgICANCiAgICBJZCA9IE5vbmU7DQogICAgDQogICAgDQogICAgIyBhY3RpdmU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfYWN0aXZlID0gTm9uZTsNCiAgICBkZWYgYWN0aXZlKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2FjdGl2ZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9hY3RpdmU7DQoNCg0KICAgIA0KICAgICMgZW5hYmxlZDogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9lbmFibGVkID0gTm9uZTsNCiAgICBkZWYgZW5hYmxlZChzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9lbmFibGVkID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2VuYWJsZWQ7DQoNCg0KICAgIA0KICAgICMgY29kZTogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9jb2RlID0gTm9uZTsNCiAgICBkZWYgY29kZShzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9jb2RlID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2NvZGU7DQoNCg0KICAgIA0KICAgICMgb3JkZXI6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfb3JkZXIgPSBOb25lOw0KICAgIGRlZiBvcmRlcihzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9vcmRlciA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9vcmRlcjsNCg0KDQogICAgDQogICAgIyBkYXRlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2RhdGUgPSBOb25lOw0KICAgIGRlZiBkYXRlKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2RhdGUgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fZGF0ZTsNCg0KDQogICAgDQogICAgIyBuYW1lOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX25hbWUgPSBOb25lOw0KICAgIGRlZiBuYW1lKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX25hbWUgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fbmFtZTsNCg0KDQogICAgDQogICAgIyByZW1hcms6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfcmVtYXJrID0gTm9uZTsNCiAgICBkZWYgcmVtYXJrKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX3JlbWFyayA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9yZW1hcms7DQoNCg0KICAgIA0KICAgICMgcGFyZW50OiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX3BhcmVudCA9IE5vbmU7DQogICAgZGVmIHBhcmVudChzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9wYXJlbnQgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fcGFyZW50Ow0KDQoNCiAgICANCiAgICANCiAgICBkZWYgX2Zyb21Eb2N1bWVudChzZWxmLCBvYmopOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ0RldmljZV9DYXRlZ29yeTo6X2Zyb21Eb2N1bWVudCgpOiAnOw0KDQogICAgICAgIGlmIG9iaiBpcyBOb25lOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIA0KICAgICAgICBpZiBpc2luc3RhbmNlKG9iaiwgYnl0ZXMpOg0KICAgICAgICAgICAgb2JqID0gc3RyKG9iaiwgInV0Zi04Iik7DQoNCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIHN0cikgb3IgdHlwZShvYmopIGlzIHN0cjoNCiAgICAgICAgICAgIG9iaiA9IHVqc29uLmxvYWRzKG9iaik7DQogICAgICAgIA0KICAgICAgICBpZiBub3QgaXNpbnN0YW5jZShvYmosIChzdHIsIGJ5dGVzLCBkaWN0KSk6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJ0dPVCBIRVJFOiAnICsgc3RyKHR5cGUob2JqKSkpOw0KICAgICAgICAgICAgcmV0dXJuIG9iajsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZm9yIGkgaW4gb2JqOg0KICAgICAgICAgICAgICAgIG9ialtpXSA9IERldmljZV9DYXRlZ29yeSgpLl9mcm9tRG9jdW1lbnQob2JqW2ldKTsNCiAgICAgICAgICAgIHJldHVybiBvYmo7DQoNCg0KICAgICAgICBpZiAnSWQnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuSWQgPSBvYmpbJ0lkJ107DQoNCiAgICANCiAgICAgICAgaWYgJ2FjdGl2ZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5hY3RpdmUob2JqWydhY3RpdmUnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnZW5hYmxlZCcgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5lbmFibGVkKG9ialsnZW5hYmxlZCddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdjb2RlJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmNvZGUob2JqWydjb2RlJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ29yZGVyJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLm9yZGVyKG9ialsnb3JkZXInXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnZGF0ZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5kYXRlKG9ialsnZGF0ZSddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICduYW1lJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLm5hbWUob2JqWyduYW1lJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ3JlbWFyaycgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5yZW1hcmsob2JqWydyZW1hcmsnXSk7DQogICAgICAgIA0KICAgICAgICAgICAgc2VsZi5yZW1hcmsoIHViaW5hc2NpaS5hMmJfYmFzZTY0KHNlbGYucmVtYXJrKCkpICk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAncGFyZW50JyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLnBhcmVudChvYmpbJ3BhcmVudCddKTsNCiAgICAgICAgDQogICAgDQoNCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICByZXR1cm4gc2VsZjsNCiAgICANCiAgICBkZWYgX3RvRG9jdW1lbnQoc2VsZik6DQogICAgICAgIHJldCA9IHt9Ow0KICAgICAgICBpZiBzZWxmLklkIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJJZCJdID0gc2VsZi5JZDsNCg0KICAgIA0KICAgICAgICBpZiBzZWxmLmFjdGl2ZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJhY3RpdmUiXSA9IHNlbGYuYWN0aXZlKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmVuYWJsZWQoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiZW5hYmxlZCJdID0gc2VsZi5lbmFibGVkKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmNvZGUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiY29kZSJdID0gc2VsZi5jb2RlKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLm9yZGVyKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbIm9yZGVyIl0gPSBzZWxmLm9yZGVyKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmRhdGUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiZGF0ZSJdID0gc2VsZi5kYXRlKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLm5hbWUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsibmFtZSJdID0gc2VsZi5uYW1lKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLnJlbWFyaygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IHNlbGYucmVtYXJrKCk7DQogICAgICAgIA0KICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShyZXRbInJlbWFyayJdLCBkaWN0KToNCiAgICAgICAgICAgICAgICByZXRbInJlbWFyayJdID0gdWpzb24uZHVtcHMocmV0WyJyZW1hcmsiXSk7DQogICAgICAgICAgICByZXRbInJlbWFyayJdID0gdWJpbmFzY2lpLmIyYV9iYXNlNjQocmV0WyJyZW1hcmsiXSkuc3RyaXAoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYucGFyZW50KCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbInBhcmVudCJdID0gc2VsZi5wYXJlbnQoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIHJldHVybiByZXQ7DQoNCiAgICANCiAgICBkZWYgc3RvcmUoc2VsZiwgX19ldmVudD1Ob25lKToNCiAgICAgICAgX190b1N0cmluZyA9ICdEZXZpY2VfQ2F0ZWdvcnk6OnN0b3JlKCk6ICc7DQogICAgICAgIA0KICAgICAgICBldkpTT04gPSBOb25lOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBldkpTT04gPSB1anNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046DQogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOw0KICAgICAgICANCg0KICAgICAgICBhbnN3ZXIgPSBOb25lOw0KDQogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aWNrc19tcygpKSsnXS5EZXZpY2VfQ2F0ZWdvcnkuc3RvcmUoKScpLm1ldGhvZCgnc3RvcmUnKS5jbGFzc05hbWUoJ0RldmljZV9DYXRlZ29yeScpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7DQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KICAgICAgICANCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICBhbnN3ZXIgPSBEZXZpY2VfQ2F0ZWdvcnkoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KICAgICAgICANCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQoNCg0KDQogICAgICAgIGlmICdEZXZpY2VfQ2F0ZWdvcnlfc3RvcmUnIGluIGRpcigpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICc9PT4gRGV2aWNlX0NhdGVnb3J5X3N0b3JlKCknKTsNCiAgICAgICAgICAgIGFuc3dlciA9IERldmljZV9DYXRlZ29yeV9zdG9yZShzZWxmLCBfX2V2ZW50LCBhbnN3ZXIsIF9fdG9TdHJpbmcpOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCg0KICAgICAgICAgICAgDQogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KDQogICAgICAgIHJldHVybiBhbnN3ZXI7DQoNCiAgICANCiAgICBkZWYgZmluZEFsbChzZWxmLCBfX2V2ZW50PU5vbmUpOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ0RldmljZV9DYXRlZ29yeTo6ZmluZEFsbCgpOiAnOw0KICAgICAgICANCiAgICAgICAgZXZKU09OID0gTm9uZTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgZXZKU09OID0gdWpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOg0KICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsNCiAgICAgICAgDQoNCiAgICAgICAgYW5zd2VyID0gTm9uZTsNCg0KICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGlja3NfbXMoKSkrJ10uRGV2aWNlX0NhdGVnb3J5LmZpbmRBbGwoKScpLm1ldGhvZCgnZmluZEFsbCcpLmNsYXNzTmFtZSgnRGV2aWNlX0NhdGVnb3J5JykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOw0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsNCiAgICAgICAgDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQogICAgICAgIA0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgIGFuc3dlciA9IERldmljZV9DYXRlZ29yeSgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQogICAgICAgIA0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCg0KDQoNCiAgICAgICAgaWYgJ0RldmljZV9DYXRlZ29yeV9maW5kQWxsJyBpbiBkaXIoKToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnPT0+IERldmljZV9DYXRlZ29yeV9maW5kQWxsKCknKTsNCiAgICAgICAgICAgIGFuc3dlciA9IERldmljZV9DYXRlZ29yeV9maW5kQWxsKHNlbGYsIF9fZXZlbnQsIGFuc3dlciwgX190b1N0cmluZyk7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KDQogICAgICAgICAgICANCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQoNCiAgICAgICAgcmV0dXJuIGFuc3dlcjsNCg0KICAgIA0KICAgIGRlZiBmaW5kKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6DQogICAgICAgIF9fdG9TdHJpbmcgPSAnRGV2aWNlX0NhdGVnb3J5OjpmaW5kKCk6ICc7DQogICAgICAgIA0KICAgICAgICBldkpTT04gPSBOb25lOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBldkpTT04gPSB1anNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046DQogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOw0KICAgICAgICANCg0KICAgICAgICBhbnN3ZXIgPSBOb25lOw0KDQogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aWNrc19tcygpKSsnXS5EZXZpY2VfQ2F0ZWdvcnkuZmluZCgpJykubWV0aG9kKCdmaW5kJykuY2xhc3NOYW1lKCdEZXZpY2VfQ2F0ZWdvcnknKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOw0KICAgICAgICANCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCiAgICAgICAgDQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgYW5zd2VyID0gRGV2aWNlX0NhdGVnb3J5KCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCiAgICAgICAgDQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KDQoNCg0KICAgICAgICBpZiAnRGV2aWNlX0NhdGVnb3J5X2ZpbmQnIGluIGRpcigpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICc9PT4gRGV2aWNlX0NhdGVnb3J5X2ZpbmQoKScpOw0KICAgICAgICAgICAgYW5zd2VyID0gRGV2aWNlX0NhdGVnb3J5X2ZpbmQoc2VsZiwgX19ldmVudCwgYW5zd2VyLCBfX3RvU3RyaW5nKTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCg0KICAgICAgICByZXR1cm4gYW5zd2VyOw0KDQogICAgDQoNCg0KY2xhc3MgRGV2aWNlX1R5cGUoKToNCiAgICBkZWYgX19pbml0X18oc2VsZiwgSWQ9Tm9uZSwgYWN0aXZlPU5vbmUsIGVuYWJsZWQ9Tm9uZSwgY29kZT1Ob25lLCBvcmRlcj1Ob25lLCBkYXRlPU5vbmUsIG5hbWU9Tm9uZSwgcmVtYXJrPU5vbmUsIGNhdGVnb3J5PU5vbmUpOg0KICAgICAgICBzdXBlcigpLl9faW5pdF9fKCk7DQoNCiAgICAgICAgI3ByaW50KCdEZXZpY2VfVHlwZTo6X19pbml0X18oKScpOw0KICAgICAgICBpZiBJZCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHNlbGYuSWQgPSBJZDsNCg0KICAgICAgICANCiAgICAgICAgc2VsZi5hY3RpdmUoYWN0aXZlKTsNCiAgICAgICAgc2VsZi5lbmFibGVkKGVuYWJsZWQpOw0KICAgICAgICBzZWxmLmNvZGUoY29kZSk7DQogICAgICAgIHNlbGYub3JkZXIob3JkZXIpOw0KICAgICAgICBzZWxmLmRhdGUoZGF0ZSk7DQogICAgICAgIHNlbGYubmFtZShuYW1lKTsNCiAgICAgICAgc2VsZi5yZW1hcmsocmVtYXJrKTsNCiAgICAgICAgc2VsZi5jYXRlZ29yeShjYXRlZ29yeSk7DQogICAgICAgIA0KICAgIElkID0gTm9uZTsNCiAgICANCiAgICANCiAgICAjIGFjdGl2ZTogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9hY3RpdmUgPSBOb25lOw0KICAgIGRlZiBhY3RpdmUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fYWN0aXZlID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2FjdGl2ZTsNCg0KDQogICAgDQogICAgIyBlbmFibGVkOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2VuYWJsZWQgPSBOb25lOw0KICAgIGRlZiBlbmFibGVkKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2VuYWJsZWQgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fZW5hYmxlZDsNCg0KDQogICAgDQogICAgIyBjb2RlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2NvZGUgPSBOb25lOw0KICAgIGRlZiBjb2RlKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2NvZGUgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fY29kZTsNCg0KDQogICAgDQogICAgIyBvcmRlcjogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9vcmRlciA9IE5vbmU7DQogICAgZGVmIG9yZGVyKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX29yZGVyID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX29yZGVyOw0KDQoNCiAgICANCiAgICAjIGRhdGU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfZGF0ZSA9IE5vbmU7DQogICAgZGVmIGRhdGUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fZGF0ZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9kYXRlOw0KDQoNCiAgICANCiAgICAjIG5hbWU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfbmFtZSA9IE5vbmU7DQogICAgZGVmIG5hbWUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fbmFtZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9uYW1lOw0KDQoNCiAgICANCiAgICAjIHJlbWFyazogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9yZW1hcmsgPSBOb25lOw0KICAgIGRlZiByZW1hcmsoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fcmVtYXJrID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3JlbWFyazsNCg0KDQogICAgDQogICAgIyBjYXRlZ29yeTogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9jYXRlZ29yeSA9IE5vbmU7DQogICAgZGVmIGNhdGVnb3J5KHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2NhdGVnb3J5ID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2NhdGVnb3J5Ow0KDQoNCiAgICANCiAgICANCiAgICBkZWYgX2Zyb21Eb2N1bWVudChzZWxmLCBvYmopOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ0RldmljZV9UeXBlOjpfZnJvbURvY3VtZW50KCk6ICc7DQoNCiAgICAgICAgaWYgb2JqIGlzIE5vbmU6DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgDQogICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLCBieXRlcyk6DQogICAgICAgICAgICBvYmogPSBzdHIob2JqLCAidXRmLTgiKTsNCg0KICAgICAgICBpZiBpc2luc3RhbmNlKG9iaiwgc3RyKSBvciB0eXBlKG9iaikgaXMgc3RyOg0KICAgICAgICAgICAgb2JqID0gdWpzb24ubG9hZHMob2JqKTsNCiAgICAgICAgDQogICAgICAgIGlmIG5vdCBpc2luc3RhbmNlKG9iaiwgKHN0ciwgYnl0ZXMsIGRpY3QpKToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnR09UIEhFUkU6ICcgKyBzdHIodHlwZShvYmopKSk7DQogICAgICAgICAgICByZXR1cm4gb2JqOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBmb3IgaSBpbiBvYmo6DQogICAgICAgICAgICAgICAgb2JqW2ldID0gRGV2aWNlX1R5cGUoKS5fZnJvbURvY3VtZW50KG9ialtpXSk7DQogICAgICAgICAgICByZXR1cm4gb2JqOw0KDQoNCiAgICAgICAgaWYgJ0lkJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLklkID0gb2JqWydJZCddOw0KDQogICAgDQogICAgICAgIGlmICdhY3RpdmUnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuYWN0aXZlKG9ialsnYWN0aXZlJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ2VuYWJsZWQnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuZW5hYmxlZChvYmpbJ2VuYWJsZWQnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnY29kZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5jb2RlKG9ialsnY29kZSddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdvcmRlcicgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5vcmRlcihvYmpbJ29yZGVyJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ2RhdGUnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuZGF0ZShvYmpbJ2RhdGUnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnbmFtZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5uYW1lKG9ialsnbmFtZSddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdyZW1hcmsnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYucmVtYXJrKG9ialsncmVtYXJrJ10pOw0KICAgICAgICANCiAgICAgICAgICAgIHNlbGYucmVtYXJrKCB1YmluYXNjaWkuYTJiX2Jhc2U2NChzZWxmLnJlbWFyaygpKSApOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ2NhdGVnb3J5JyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmNhdGVnb3J5KERldmljZV9DYXRlZ29yeSgpLl9mcm9tRG9jdW1lbnQob2JqWydjYXRlZ29yeSddKSk7DQogICAgICAgIA0KICAgIA0KDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgDQogICAgZGVmIF90b0RvY3VtZW50KHNlbGYpOg0KICAgICAgICByZXQgPSB7fTsNCiAgICAgICAgaWYgc2VsZi5JZCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiSWQiXSA9IHNlbGYuSWQ7DQoNCiAgICANCiAgICAgICAgaWYgc2VsZi5hY3RpdmUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiYWN0aXZlIl0gPSBzZWxmLmFjdGl2ZSgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5lbmFibGVkKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbImVuYWJsZWQiXSA9IHNlbGYuZW5hYmxlZCgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5jb2RlKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbImNvZGUiXSA9IHNlbGYuY29kZSgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5vcmRlcigpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJvcmRlciJdID0gc2VsZi5vcmRlcigpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5kYXRlKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbImRhdGUiXSA9IHNlbGYuZGF0ZSgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5uYW1lKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbIm5hbWUiXSA9IHNlbGYubmFtZSgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5yZW1hcmsoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSBzZWxmLnJlbWFyaygpOw0KICAgICAgICANCiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UocmV0WyJyZW1hcmsiXSwgZGljdCk6DQogICAgICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IHVqc29uLmR1bXBzKHJldFsicmVtYXJrIl0pOw0KICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IHViaW5hc2NpaS5iMmFfYmFzZTY0KHJldFsicmVtYXJrIl0pLnN0cmlwKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmNhdGVnb3J5KCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbImNhdGVnb3J5Il0gPSBzZWxmLmNhdGVnb3J5KCkuX3RvRG9jdW1lbnQoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIHJldHVybiByZXQ7DQoNCiAgICANCiAgICBkZWYgc3RvcmUoc2VsZiwgX19ldmVudD1Ob25lKToNCiAgICAgICAgX190b1N0cmluZyA9ICdEZXZpY2VfVHlwZTo6c3RvcmUoKTogJzsNCiAgICAgICAgDQogICAgICAgIGV2SlNPTiA9IE5vbmU7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIGV2SlNPTiA9IHVqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoNCiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7DQogICAgICAgIA0KDQogICAgICAgIGFuc3dlciA9IE5vbmU7DQoNCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpY2tzX21zKCkpKyddLkRldmljZV9UeXBlLnN0b3JlKCknKS5tZXRob2QoJ3N0b3JlJykuY2xhc3NOYW1lKCdEZXZpY2VfVHlwZScpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7DQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KICAgICAgICANCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICBhbnN3ZXIgPSBEZXZpY2VfVHlwZSgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQogICAgICAgIA0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCg0KDQoNCiAgICAgICAgaWYgJ0RldmljZV9UeXBlX3N0b3JlJyBpbiBkaXIoKToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnPT0+IERldmljZV9UeXBlX3N0b3JlKCknKTsNCiAgICAgICAgICAgIGFuc3dlciA9IERldmljZV9UeXBlX3N0b3JlKHNlbGYsIF9fZXZlbnQsIGFuc3dlciwgX190b1N0cmluZyk7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KDQogICAgICAgICAgICANCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQoNCiAgICAgICAgcmV0dXJuIGFuc3dlcjsNCg0KICAgIA0KICAgIGRlZiBmaW5kQWxsKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6DQogICAgICAgIF9fdG9TdHJpbmcgPSAnRGV2aWNlX1R5cGU6OmZpbmRBbGwoKTogJzsNCiAgICAgICAgDQogICAgICAgIGV2SlNPTiA9IE5vbmU7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIGV2SlNPTiA9IHVqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoNCiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7DQogICAgICAgIA0KDQogICAgICAgIGFuc3dlciA9IE5vbmU7DQoNCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpY2tzX21zKCkpKyddLkRldmljZV9UeXBlLmZpbmRBbGwoKScpLm1ldGhvZCgnZmluZEFsbCcpLmNsYXNzTmFtZSgnRGV2aWNlX1R5cGUnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOw0KICAgICAgICANCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCiAgICAgICAgDQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgYW5zd2VyID0gRGV2aWNlX1R5cGUoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KICAgICAgICANCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQoNCg0KDQogICAgICAgIGlmICdEZXZpY2VfVHlwZV9maW5kQWxsJyBpbiBkaXIoKToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnPT0+IERldmljZV9UeXBlX2ZpbmRBbGwoKScpOw0KICAgICAgICAgICAgYW5zd2VyID0gRGV2aWNlX1R5cGVfZmluZEFsbChzZWxmLCBfX2V2ZW50LCBhbnN3ZXIsIF9fdG9TdHJpbmcpOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCg0KICAgICAgICAgICAgDQogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KDQogICAgICAgIHJldHVybiBhbnN3ZXI7DQoNCiAgICANCiAgICBkZWYgZmluZChzZWxmLCBfX2V2ZW50PU5vbmUpOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ0RldmljZV9UeXBlOjpmaW5kKCk6ICc7DQogICAgICAgIA0KICAgICAgICBldkpTT04gPSBOb25lOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBldkpTT04gPSB1anNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046DQogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOw0KICAgICAgICANCg0KICAgICAgICBhbnN3ZXIgPSBOb25lOw0KDQogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aWNrc19tcygpKSsnXS5EZXZpY2VfVHlwZS5maW5kKCknKS5tZXRob2QoJ2ZpbmQnKS5jbGFzc05hbWUoJ0RldmljZV9UeXBlJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOw0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsNCiAgICAgICAgDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQogICAgICAgIA0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgIGFuc3dlciA9IERldmljZV9UeXBlKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCiAgICAgICAgDQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KDQoNCg0KICAgICAgICBpZiAnRGV2aWNlX1R5cGVfZmluZCcgaW4gZGlyKCk6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJz09PiBEZXZpY2VfVHlwZV9maW5kKCknKTsNCiAgICAgICAgICAgIGFuc3dlciA9IERldmljZV9UeXBlX2ZpbmQoc2VsZiwgX19ldmVudCwgYW5zd2VyLCBfX3RvU3RyaW5nKTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCg0KICAgICAgICByZXR1cm4gYW5zd2VyOw0KDQogICAgDQoNCg0KY2xhc3MgTWV0cmljX0dyb3VwKCk6DQogICAgZGVmIF9faW5pdF9fKHNlbGYsIElkPU5vbmUsIGFjdGl2ZT1Ob25lLCBlbmFibGVkPU5vbmUsIGNvZGU9Tm9uZSwgb3JkZXI9Tm9uZSwgZGF0ZT1Ob25lLCBuYW1lPU5vbmUsIHJlbWFyaz1Ob25lKToNCiAgICAgICAgc3VwZXIoKS5fX2luaXRfXygpOw0KDQogICAgICAgICNwcmludCgnTWV0cmljX0dyb3VwOjpfX2luaXRfXygpJyk7DQogICAgICAgIGlmIElkIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgc2VsZi5JZCA9IElkOw0KDQogICAgICAgIA0KICAgICAgICBzZWxmLmFjdGl2ZShhY3RpdmUpOw0KICAgICAgICBzZWxmLmVuYWJsZWQoZW5hYmxlZCk7DQogICAgICAgIHNlbGYuY29kZShjb2RlKTsNCiAgICAgICAgc2VsZi5vcmRlcihvcmRlcik7DQogICAgICAgIHNlbGYuZGF0ZShkYXRlKTsNCiAgICAgICAgc2VsZi5uYW1lKG5hbWUpOw0KICAgICAgICBzZWxmLnJlbWFyayhyZW1hcmspOw0KICAgICAgICANCiAgICBJZCA9IE5vbmU7DQogICAgDQogICAgDQogICAgIyBhY3RpdmU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfYWN0aXZlID0gTm9uZTsNCiAgICBkZWYgYWN0aXZlKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2FjdGl2ZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9hY3RpdmU7DQoNCg0KICAgIA0KICAgICMgZW5hYmxlZDogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9lbmFibGVkID0gTm9uZTsNCiAgICBkZWYgZW5hYmxlZChzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9lbmFibGVkID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2VuYWJsZWQ7DQoNCg0KICAgIA0KICAgICMgY29kZTogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9jb2RlID0gTm9uZTsNCiAgICBkZWYgY29kZShzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9jb2RlID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2NvZGU7DQoNCg0KICAgIA0KICAgICMgb3JkZXI6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfb3JkZXIgPSBOb25lOw0KICAgIGRlZiBvcmRlcihzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9vcmRlciA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9vcmRlcjsNCg0KDQogICAgDQogICAgIyBkYXRlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2RhdGUgPSBOb25lOw0KICAgIGRlZiBkYXRlKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2RhdGUgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fZGF0ZTsNCg0KDQogICAgDQogICAgIyBuYW1lOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX25hbWUgPSBOb25lOw0KICAgIGRlZiBuYW1lKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX25hbWUgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fbmFtZTsNCg0KDQogICAgDQogICAgIyByZW1hcms6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfcmVtYXJrID0gTm9uZTsNCiAgICBkZWYgcmVtYXJrKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX3JlbWFyayA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9yZW1hcms7DQoNCg0KICAgIA0KICAgIA0KICAgIGRlZiBfZnJvbURvY3VtZW50KHNlbGYsIG9iaik6DQogICAgICAgIF9fdG9TdHJpbmcgPSAnTWV0cmljX0dyb3VwOjpfZnJvbURvY3VtZW50KCk6ICc7DQoNCiAgICAgICAgaWYgb2JqIGlzIE5vbmU6DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgDQogICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLCBieXRlcyk6DQogICAgICAgICAgICBvYmogPSBzdHIob2JqLCAidXRmLTgiKTsNCg0KICAgICAgICBpZiBpc2luc3RhbmNlKG9iaiwgc3RyKSBvciB0eXBlKG9iaikgaXMgc3RyOg0KICAgICAgICAgICAgb2JqID0gdWpzb24ubG9hZHMob2JqKTsNCiAgICAgICAgDQogICAgICAgIGlmIG5vdCBpc2luc3RhbmNlKG9iaiwgKHN0ciwgYnl0ZXMsIGRpY3QpKToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnR09UIEhFUkU6ICcgKyBzdHIodHlwZShvYmopKSk7DQogICAgICAgICAgICByZXR1cm4gb2JqOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBmb3IgaSBpbiBvYmo6DQogICAgICAgICAgICAgICAgb2JqW2ldID0gTWV0cmljX0dyb3VwKCkuX2Zyb21Eb2N1bWVudChvYmpbaV0pOw0KICAgICAgICAgICAgcmV0dXJuIG9iajsNCg0KDQogICAgICAgIGlmICdJZCcgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5JZCA9IG9ialsnSWQnXTsNCg0KICAgIA0KICAgICAgICBpZiAnYWN0aXZlJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmFjdGl2ZShvYmpbJ2FjdGl2ZSddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdlbmFibGVkJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmVuYWJsZWQob2JqWydlbmFibGVkJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ2NvZGUnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuY29kZShvYmpbJ2NvZGUnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnb3JkZXInIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYub3JkZXIob2JqWydvcmRlciddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdkYXRlJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmRhdGUob2JqWydkYXRlJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ25hbWUnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYubmFtZShvYmpbJ25hbWUnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAncmVtYXJrJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLnJlbWFyayhvYmpbJ3JlbWFyayddKTsNCiAgICAgICAgDQogICAgICAgICAgICBzZWxmLnJlbWFyayggdWJpbmFzY2lpLmEyYl9iYXNlNjQoc2VsZi5yZW1hcmsoKSkgKTsNCiAgICAgICAgDQogICAgDQoNCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICByZXR1cm4gc2VsZjsNCiAgICANCiAgICBkZWYgX3RvRG9jdW1lbnQoc2VsZik6DQogICAgICAgIHJldCA9IHt9Ow0KICAgICAgICBpZiBzZWxmLklkIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJJZCJdID0gc2VsZi5JZDsNCg0KICAgIA0KICAgICAgICBpZiBzZWxmLmFjdGl2ZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJhY3RpdmUiXSA9IHNlbGYuYWN0aXZlKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmVuYWJsZWQoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiZW5hYmxlZCJdID0gc2VsZi5lbmFibGVkKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmNvZGUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiY29kZSJdID0gc2VsZi5jb2RlKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLm9yZGVyKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbIm9yZGVyIl0gPSBzZWxmLm9yZGVyKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmRhdGUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiZGF0ZSJdID0gc2VsZi5kYXRlKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLm5hbWUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsibmFtZSJdID0gc2VsZi5uYW1lKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLnJlbWFyaygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IHNlbGYucmVtYXJrKCk7DQogICAgICAgIA0KICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShyZXRbInJlbWFyayJdLCBkaWN0KToNCiAgICAgICAgICAgICAgICByZXRbInJlbWFyayJdID0gdWpzb24uZHVtcHMocmV0WyJyZW1hcmsiXSk7DQogICAgICAgICAgICByZXRbInJlbWFyayJdID0gdWJpbmFzY2lpLmIyYV9iYXNlNjQocmV0WyJyZW1hcmsiXSkuc3RyaXAoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIHJldHVybiByZXQ7DQoNCiAgICANCiAgICBkZWYgc3RvcmUoc2VsZiwgX19ldmVudD1Ob25lKToNCiAgICAgICAgX190b1N0cmluZyA9ICdNZXRyaWNfR3JvdXA6OnN0b3JlKCk6ICc7DQogICAgICAgIA0KICAgICAgICBldkpTT04gPSBOb25lOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBldkpTT04gPSB1anNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046DQogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOw0KICAgICAgICANCg0KICAgICAgICBhbnN3ZXIgPSBOb25lOw0KDQogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aWNrc19tcygpKSsnXS5NZXRyaWNfR3JvdXAuc3RvcmUoKScpLm1ldGhvZCgnc3RvcmUnKS5jbGFzc05hbWUoJ01ldHJpY19Hcm91cCcpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7DQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KICAgICAgICANCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICBhbnN3ZXIgPSBNZXRyaWNfR3JvdXAoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KICAgICAgICANCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQoNCg0KDQogICAgICAgIGlmICdNZXRyaWNfR3JvdXBfc3RvcmUnIGluIGRpcigpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICc9PT4gTWV0cmljX0dyb3VwX3N0b3JlKCknKTsNCiAgICAgICAgICAgIGFuc3dlciA9IE1ldHJpY19Hcm91cF9zdG9yZShzZWxmLCBfX2V2ZW50LCBhbnN3ZXIsIF9fdG9TdHJpbmcpOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCg0KICAgICAgICAgICAgDQogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KDQogICAgICAgIHJldHVybiBhbnN3ZXI7DQoNCiAgICANCiAgICBkZWYgZmluZEFsbChzZWxmLCBfX2V2ZW50PU5vbmUpOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ01ldHJpY19Hcm91cDo6ZmluZEFsbCgpOiAnOw0KICAgICAgICANCiAgICAgICAgZXZKU09OID0gTm9uZTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgZXZKU09OID0gdWpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOg0KICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsNCiAgICAgICAgDQoNCiAgICAgICAgYW5zd2VyID0gTm9uZTsNCg0KICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGlja3NfbXMoKSkrJ10uTWV0cmljX0dyb3VwLmZpbmRBbGwoKScpLm1ldGhvZCgnZmluZEFsbCcpLmNsYXNzTmFtZSgnTWV0cmljX0dyb3VwJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOw0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsNCiAgICAgICAgDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQogICAgICAgIA0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgIGFuc3dlciA9IE1ldHJpY19Hcm91cCgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQogICAgICAgIA0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCg0KDQoNCiAgICAgICAgaWYgJ01ldHJpY19Hcm91cF9maW5kQWxsJyBpbiBkaXIoKToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnPT0+IE1ldHJpY19Hcm91cF9maW5kQWxsKCknKTsNCiAgICAgICAgICAgIGFuc3dlciA9IE1ldHJpY19Hcm91cF9maW5kQWxsKHNlbGYsIF9fZXZlbnQsIGFuc3dlciwgX190b1N0cmluZyk7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KDQogICAgICAgICAgICANCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQoNCiAgICAgICAgcmV0dXJuIGFuc3dlcjsNCg0KICAgIA0KICAgIGRlZiBmaW5kKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6DQogICAgICAgIF9fdG9TdHJpbmcgPSAnTWV0cmljX0dyb3VwOjpmaW5kKCk6ICc7DQogICAgICAgIA0KICAgICAgICBldkpTT04gPSBOb25lOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBldkpTT04gPSB1anNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046DQogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOw0KICAgICAgICANCg0KICAgICAgICBhbnN3ZXIgPSBOb25lOw0KDQogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aWNrc19tcygpKSsnXS5NZXRyaWNfR3JvdXAuZmluZCgpJykubWV0aG9kKCdmaW5kJykuY2xhc3NOYW1lKCdNZXRyaWNfR3JvdXAnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOw0KICAgICAgICANCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCiAgICAgICAgDQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgYW5zd2VyID0gTWV0cmljX0dyb3VwKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCiAgICAgICAgDQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KDQoNCg0KICAgICAgICBpZiAnTWV0cmljX0dyb3VwX2ZpbmQnIGluIGRpcigpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICc9PT4gTWV0cmljX0dyb3VwX2ZpbmQoKScpOw0KICAgICAgICAgICAgYW5zd2VyID0gTWV0cmljX0dyb3VwX2ZpbmQoc2VsZiwgX19ldmVudCwgYW5zd2VyLCBfX3RvU3RyaW5nKTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCg0KICAgICAgICByZXR1cm4gYW5zd2VyOw0KDQogICAgDQoNCg0KY2xhc3MgTWV0cmljX1R5cGUoKToNCiAgICBkZWYgX19pbml0X18oc2VsZiwgSWQ9Tm9uZSwgYWN0aXZlPU5vbmUsIGVuYWJsZWQ9Tm9uZSwgY29kZT1Ob25lLCBvcmRlcj1Ob25lLCBkYXRlPU5vbmUsIG5hbWU9Tm9uZSwgcmVtYXJrPU5vbmUsIGdyb3VwPU5vbmUpOg0KICAgICAgICBzdXBlcigpLl9faW5pdF9fKCk7DQoNCiAgICAgICAgI3ByaW50KCdNZXRyaWNfVHlwZTo6X19pbml0X18oKScpOw0KICAgICAgICBpZiBJZCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHNlbGYuSWQgPSBJZDsNCg0KICAgICAgICANCiAgICAgICAgc2VsZi5hY3RpdmUoYWN0aXZlKTsNCiAgICAgICAgc2VsZi5lbmFibGVkKGVuYWJsZWQpOw0KICAgICAgICBzZWxmLmNvZGUoY29kZSk7DQogICAgICAgIHNlbGYub3JkZXIob3JkZXIpOw0KICAgICAgICBzZWxmLmRhdGUoZGF0ZSk7DQogICAgICAgIHNlbGYubmFtZShuYW1lKTsNCiAgICAgICAgc2VsZi5yZW1hcmsocmVtYXJrKTsNCiAgICAgICAgc2VsZi5ncm91cChncm91cCk7DQogICAgICAgIA0KICAgIElkID0gTm9uZTsNCiAgICANCiAgICANCiAgICAjIGFjdGl2ZTogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9hY3RpdmUgPSBOb25lOw0KICAgIGRlZiBhY3RpdmUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fYWN0aXZlID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2FjdGl2ZTsNCg0KDQogICAgDQogICAgIyBlbmFibGVkOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2VuYWJsZWQgPSBOb25lOw0KICAgIGRlZiBlbmFibGVkKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2VuYWJsZWQgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fZW5hYmxlZDsNCg0KDQogICAgDQogICAgIyBjb2RlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2NvZGUgPSBOb25lOw0KICAgIGRlZiBjb2RlKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2NvZGUgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fY29kZTsNCg0KDQogICAgDQogICAgIyBvcmRlcjogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9vcmRlciA9IE5vbmU7DQogICAgZGVmIG9yZGVyKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX29yZGVyID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX29yZGVyOw0KDQoNCiAgICANCiAgICAjIGRhdGU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfZGF0ZSA9IE5vbmU7DQogICAgZGVmIGRhdGUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fZGF0ZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9kYXRlOw0KDQoNCiAgICANCiAgICAjIG5hbWU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfbmFtZSA9IE5vbmU7DQogICAgZGVmIG5hbWUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fbmFtZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9uYW1lOw0KDQoNCiAgICANCiAgICAjIHJlbWFyazogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9yZW1hcmsgPSBOb25lOw0KICAgIGRlZiByZW1hcmsoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fcmVtYXJrID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3JlbWFyazsNCg0KDQogICAgDQogICAgIyBncm91cDogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9ncm91cCA9IE5vbmU7DQogICAgZGVmIGdyb3VwKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2dyb3VwID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2dyb3VwOw0KDQoNCiAgICANCiAgICANCiAgICBkZWYgX2Zyb21Eb2N1bWVudChzZWxmLCBvYmopOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ01ldHJpY19UeXBlOjpfZnJvbURvY3VtZW50KCk6ICc7DQoNCiAgICAgICAgaWYgb2JqIGlzIE5vbmU6DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgDQogICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLCBieXRlcyk6DQogICAgICAgICAgICBvYmogPSBzdHIob2JqLCAidXRmLTgiKTsNCg0KICAgICAgICBpZiBpc2luc3RhbmNlKG9iaiwgc3RyKSBvciB0eXBlKG9iaikgaXMgc3RyOg0KICAgICAgICAgICAgb2JqID0gdWpzb24ubG9hZHMob2JqKTsNCiAgICAgICAgDQogICAgICAgIGlmIG5vdCBpc2luc3RhbmNlKG9iaiwgKHN0ciwgYnl0ZXMsIGRpY3QpKToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnR09UIEhFUkU6ICcgKyBzdHIodHlwZShvYmopKSk7DQogICAgICAgICAgICByZXR1cm4gb2JqOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBmb3IgaSBpbiBvYmo6DQogICAgICAgICAgICAgICAgb2JqW2ldID0gTWV0cmljX1R5cGUoKS5fZnJvbURvY3VtZW50KG9ialtpXSk7DQogICAgICAgICAgICByZXR1cm4gb2JqOw0KDQoNCiAgICAgICAgaWYgJ0lkJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLklkID0gb2JqWydJZCddOw0KDQogICAgDQogICAgICAgIGlmICdhY3RpdmUnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuYWN0aXZlKG9ialsnYWN0aXZlJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ2VuYWJsZWQnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuZW5hYmxlZChvYmpbJ2VuYWJsZWQnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnY29kZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5jb2RlKG9ialsnY29kZSddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdvcmRlcicgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5vcmRlcihvYmpbJ29yZGVyJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ2RhdGUnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuZGF0ZShvYmpbJ2RhdGUnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnbmFtZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5uYW1lKG9ialsnbmFtZSddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdyZW1hcmsnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYucmVtYXJrKG9ialsncmVtYXJrJ10pOw0KICAgICAgICANCiAgICAgICAgICAgIHNlbGYucmVtYXJrKCB1YmluYXNjaWkuYTJiX2Jhc2U2NChzZWxmLnJlbWFyaygpKSApOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ2dyb3VwJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmdyb3VwKE1ldHJpY19Hcm91cCgpLl9mcm9tRG9jdW1lbnQob2JqWydncm91cCddKSk7DQogICAgICAgIA0KICAgIA0KDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgDQogICAgZGVmIF90b0RvY3VtZW50KHNlbGYpOg0KICAgICAgICByZXQgPSB7fTsNCiAgICAgICAgaWYgc2VsZi5JZCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiSWQiXSA9IHNlbGYuSWQ7DQoNCiAgICANCiAgICAgICAgaWYgc2VsZi5hY3RpdmUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiYWN0aXZlIl0gPSBzZWxmLmFjdGl2ZSgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5lbmFibGVkKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbImVuYWJsZWQiXSA9IHNlbGYuZW5hYmxlZCgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5jb2RlKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbImNvZGUiXSA9IHNlbGYuY29kZSgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5vcmRlcigpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJvcmRlciJdID0gc2VsZi5vcmRlcigpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5kYXRlKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbImRhdGUiXSA9IHNlbGYuZGF0ZSgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5uYW1lKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbIm5hbWUiXSA9IHNlbGYubmFtZSgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5yZW1hcmsoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSBzZWxmLnJlbWFyaygpOw0KICAgICAgICANCiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UocmV0WyJyZW1hcmsiXSwgZGljdCk6DQogICAgICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IHVqc29uLmR1bXBzKHJldFsicmVtYXJrIl0pOw0KICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IHViaW5hc2NpaS5iMmFfYmFzZTY0KHJldFsicmVtYXJrIl0pLnN0cmlwKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmdyb3VwKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbImdyb3VwIl0gPSBzZWxmLmdyb3VwKCkuX3RvRG9jdW1lbnQoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIHJldHVybiByZXQ7DQoNCiAgICANCiAgICBkZWYgc3RvcmUoc2VsZiwgX19ldmVudD1Ob25lKToNCiAgICAgICAgX190b1N0cmluZyA9ICdNZXRyaWNfVHlwZTo6c3RvcmUoKTogJzsNCiAgICAgICAgDQogICAgICAgIGV2SlNPTiA9IE5vbmU7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIGV2SlNPTiA9IHVqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoNCiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7DQogICAgICAgIA0KDQogICAgICAgIGFuc3dlciA9IE5vbmU7DQoNCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpY2tzX21zKCkpKyddLk1ldHJpY19UeXBlLnN0b3JlKCknKS5tZXRob2QoJ3N0b3JlJykuY2xhc3NOYW1lKCdNZXRyaWNfVHlwZScpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7DQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KICAgICAgICANCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICBhbnN3ZXIgPSBNZXRyaWNfVHlwZSgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQogICAgICAgIA0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCg0KDQoNCiAgICAgICAgaWYgJ01ldHJpY19UeXBlX3N0b3JlJyBpbiBkaXIoKToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnPT0+IE1ldHJpY19UeXBlX3N0b3JlKCknKTsNCiAgICAgICAgICAgIGFuc3dlciA9IE1ldHJpY19UeXBlX3N0b3JlKHNlbGYsIF9fZXZlbnQsIGFuc3dlciwgX190b1N0cmluZyk7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KDQogICAgICAgICAgICANCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQoNCiAgICAgICAgcmV0dXJuIGFuc3dlcjsNCg0KICAgIA0KICAgIGRlZiBmaW5kQWxsKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6DQogICAgICAgIF9fdG9TdHJpbmcgPSAnTWV0cmljX1R5cGU6OmZpbmRBbGwoKTogJzsNCiAgICAgICAgDQogICAgICAgIGV2SlNPTiA9IE5vbmU7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIGV2SlNPTiA9IHVqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoNCiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7DQogICAgICAgIA0KDQogICAgICAgIGFuc3dlciA9IE5vbmU7DQoNCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpY2tzX21zKCkpKyddLk1ldHJpY19UeXBlLmZpbmRBbGwoKScpLm1ldGhvZCgnZmluZEFsbCcpLmNsYXNzTmFtZSgnTWV0cmljX1R5cGUnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOw0KICAgICAgICANCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCiAgICAgICAgDQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgYW5zd2VyID0gTWV0cmljX1R5cGUoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KICAgICAgICANCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQoNCg0KDQogICAgICAgIGlmICdNZXRyaWNfVHlwZV9maW5kQWxsJyBpbiBkaXIoKToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnPT0+IE1ldHJpY19UeXBlX2ZpbmRBbGwoKScpOw0KICAgICAgICAgICAgYW5zd2VyID0gTWV0cmljX1R5cGVfZmluZEFsbChzZWxmLCBfX2V2ZW50LCBhbnN3ZXIsIF9fdG9TdHJpbmcpOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCg0KICAgICAgICAgICAgDQogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KDQogICAgICAgIHJldHVybiBhbnN3ZXI7DQoNCiAgICANCiAgICBkZWYgZmluZChzZWxmLCBfX2V2ZW50PU5vbmUpOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ01ldHJpY19UeXBlOjpmaW5kKCk6ICc7DQogICAgICAgIA0KICAgICAgICBldkpTT04gPSBOb25lOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBldkpTT04gPSB1anNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046DQogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOw0KICAgICAgICANCg0KICAgICAgICBhbnN3ZXIgPSBOb25lOw0KDQogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aWNrc19tcygpKSsnXS5NZXRyaWNfVHlwZS5maW5kKCknKS5tZXRob2QoJ2ZpbmQnKS5jbGFzc05hbWUoJ01ldHJpY19UeXBlJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOw0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsNCiAgICAgICAgDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQogICAgICAgIA0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgIGFuc3dlciA9IE1ldHJpY19UeXBlKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCiAgICAgICAgDQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KDQoNCg0KICAgICAgICBpZiAnTWV0cmljX1R5cGVfZmluZCcgaW4gZGlyKCk6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJz09PiBNZXRyaWNfVHlwZV9maW5kKCknKTsNCiAgICAgICAgICAgIGFuc3dlciA9IE1ldHJpY19UeXBlX2ZpbmQoc2VsZiwgX19ldmVudCwgYW5zd2VyLCBfX3RvU3RyaW5nKTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCg0KICAgICAgICByZXR1cm4gYW5zd2VyOw0KDQogICAgDQoNCg0KY2xhc3MgTWV0cmljX1ZhbHVlKCk6DQogICAgZGVmIF9faW5pdF9fKHNlbGYsIElkPU5vbmUsIGFjdGl2ZT1Ob25lLCBlbmFibGVkPU5vbmUsIGNvZGU9Tm9uZSwgb3JkZXI9Tm9uZSwgZGF0ZT1Ob25lLCBuYW1lPU5vbmUsIHJlbWFyaz1Ob25lLCB2YWx1ZT1Ob25lLCBtZXRyaWM9Tm9uZSwgZGV2aWNlPU5vbmUsIGNvbnRyb2xsZXI9Tm9uZSwgZXhlY3V0aW9uPU5vbmUpOg0KICAgICAgICBzdXBlcigpLl9faW5pdF9fKCk7DQoNCiAgICAgICAgI3ByaW50KCdNZXRyaWNfVmFsdWU6Ol9faW5pdF9fKCknKTsNCiAgICAgICAgaWYgSWQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBzZWxmLklkID0gSWQ7DQoNCiAgICAgICAgDQogICAgICAgIHNlbGYuYWN0aXZlKGFjdGl2ZSk7DQogICAgICAgIHNlbGYuZW5hYmxlZChlbmFibGVkKTsNCiAgICAgICAgc2VsZi5jb2RlKGNvZGUpOw0KICAgICAgICBzZWxmLm9yZGVyKG9yZGVyKTsNCiAgICAgICAgc2VsZi5kYXRlKGRhdGUpOw0KICAgICAgICBzZWxmLm5hbWUobmFtZSk7DQogICAgICAgIHNlbGYucmVtYXJrKHJlbWFyayk7DQogICAgICAgIHNlbGYudmFsdWUodmFsdWUpOw0KICAgICAgICBzZWxmLm1ldHJpYyhtZXRyaWMpOw0KICAgICAgICBzZWxmLmRldmljZShkZXZpY2UpOw0KICAgICAgICBzZWxmLmNvbnRyb2xsZXIoY29udHJvbGxlcik7DQogICAgICAgIHNlbGYuZXhlY3V0aW9uKGV4ZWN1dGlvbik7DQogICAgICAgIA0KICAgIElkID0gTm9uZTsNCiAgICANCiAgICANCiAgICAjIGFjdGl2ZTogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9hY3RpdmUgPSBOb25lOw0KICAgIGRlZiBhY3RpdmUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fYWN0aXZlID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2FjdGl2ZTsNCg0KDQogICAgDQogICAgIyBlbmFibGVkOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2VuYWJsZWQgPSBOb25lOw0KICAgIGRlZiBlbmFibGVkKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2VuYWJsZWQgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fZW5hYmxlZDsNCg0KDQogICAgDQogICAgIyBjb2RlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2NvZGUgPSBOb25lOw0KICAgIGRlZiBjb2RlKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2NvZGUgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fY29kZTsNCg0KDQogICAgDQogICAgIyBvcmRlcjogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9vcmRlciA9IE5vbmU7DQogICAgZGVmIG9yZGVyKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX29yZGVyID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX29yZGVyOw0KDQoNCiAgICANCiAgICAjIGRhdGU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfZGF0ZSA9IE5vbmU7DQogICAgZGVmIGRhdGUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fZGF0ZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9kYXRlOw0KDQoNCiAgICANCiAgICAjIG5hbWU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfbmFtZSA9IE5vbmU7DQogICAgZGVmIG5hbWUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fbmFtZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9uYW1lOw0KDQoNCiAgICANCiAgICAjIHJlbWFyazogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9yZW1hcmsgPSBOb25lOw0KICAgIGRlZiByZW1hcmsoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fcmVtYXJrID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3JlbWFyazsNCg0KDQogICAgDQogICAgIyB2YWx1ZTogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF92YWx1ZSA9IE5vbmU7DQogICAgZGVmIHZhbHVlKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX3ZhbHVlID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3ZhbHVlOw0KDQoNCiAgICANCiAgICAjIG1ldHJpYzogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9tZXRyaWMgPSBOb25lOw0KICAgIGRlZiBtZXRyaWMoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fbWV0cmljID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX21ldHJpYzsNCg0KDQogICAgDQogICAgIyBkZXZpY2U6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfZGV2aWNlID0gTm9uZTsNCiAgICBkZWYgZGV2aWNlKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2RldmljZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9kZXZpY2U7DQoNCg0KICAgIA0KICAgICMgY29udHJvbGxlcjogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9jb250cm9sbGVyID0gTm9uZTsNCiAgICBkZWYgY29udHJvbGxlcihzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9jb250cm9sbGVyID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2NvbnRyb2xsZXI7DQoNCg0KICAgIA0KICAgICMgZXhlY3V0aW9uOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2V4ZWN1dGlvbiA9IE5vbmU7DQogICAgZGVmIGV4ZWN1dGlvbihzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9leGVjdXRpb24gPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fZXhlY3V0aW9uOw0KDQoNCiAgICANCiAgICANCiAgICBkZWYgX2Zyb21Eb2N1bWVudChzZWxmLCBvYmopOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ01ldHJpY19WYWx1ZTo6X2Zyb21Eb2N1bWVudCgpOiAnOw0KDQogICAgICAgIGlmIG9iaiBpcyBOb25lOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIA0KICAgICAgICBpZiBpc2luc3RhbmNlKG9iaiwgYnl0ZXMpOg0KICAgICAgICAgICAgb2JqID0gc3RyKG9iaiwgInV0Zi04Iik7DQoNCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIHN0cikgb3IgdHlwZShvYmopIGlzIHN0cjoNCiAgICAgICAgICAgIG9iaiA9IHVqc29uLmxvYWRzKG9iaik7DQogICAgICAgIA0KICAgICAgICBpZiBub3QgaXNpbnN0YW5jZShvYmosIChzdHIsIGJ5dGVzLCBkaWN0KSk6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJ0dPVCBIRVJFOiAnICsgc3RyKHR5cGUob2JqKSkpOw0KICAgICAgICAgICAgcmV0dXJuIG9iajsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZm9yIGkgaW4gb2JqOg0KICAgICAgICAgICAgICAgIG9ialtpXSA9IE1ldHJpY19WYWx1ZSgpLl9mcm9tRG9jdW1lbnQob2JqW2ldKTsNCiAgICAgICAgICAgIHJldHVybiBvYmo7DQoNCg0KICAgICAgICBpZiAnSWQnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuSWQgPSBvYmpbJ0lkJ107DQoNCiAgICANCiAgICAgICAgaWYgJ2FjdGl2ZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5hY3RpdmUob2JqWydhY3RpdmUnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnZW5hYmxlZCcgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5lbmFibGVkKG9ialsnZW5hYmxlZCddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdjb2RlJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmNvZGUob2JqWydjb2RlJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ29yZGVyJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLm9yZGVyKG9ialsnb3JkZXInXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnZGF0ZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5kYXRlKG9ialsnZGF0ZSddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICduYW1lJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLm5hbWUob2JqWyduYW1lJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ3JlbWFyaycgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5yZW1hcmsob2JqWydyZW1hcmsnXSk7DQogICAgICAgIA0KICAgICAgICAgICAgc2VsZi5yZW1hcmsoIHViaW5hc2NpaS5hMmJfYmFzZTY0KHNlbGYucmVtYXJrKCkpICk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAndmFsdWUnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYudmFsdWUob2JqWyd2YWx1ZSddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdtZXRyaWMnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYubWV0cmljKE1ldHJpYygpLl9mcm9tRG9jdW1lbnQob2JqWydtZXRyaWMnXSkpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ2RldmljZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5kZXZpY2UoRGV2aWNlKCkuX2Zyb21Eb2N1bWVudChvYmpbJ2RldmljZSddKSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnY29udHJvbGxlcicgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5jb250cm9sbGVyKE5vZGUoKS5fZnJvbURvY3VtZW50KG9ialsnY29udHJvbGxlciddKSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnZXhlY3V0aW9uJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmV4ZWN1dGlvbihvYmpbJ2V4ZWN1dGlvbiddKTsNCiAgICAgICAgDQogICAgDQoNCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICByZXR1cm4gc2VsZjsNCiAgICANCiAgICBkZWYgX3RvRG9jdW1lbnQoc2VsZik6DQogICAgICAgIHJldCA9IHt9Ow0KICAgICAgICBpZiBzZWxmLklkIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJJZCJdID0gc2VsZi5JZDsNCg0KICAgIA0KICAgICAgICBpZiBzZWxmLmFjdGl2ZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJhY3RpdmUiXSA9IHNlbGYuYWN0aXZlKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmVuYWJsZWQoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiZW5hYmxlZCJdID0gc2VsZi5lbmFibGVkKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmNvZGUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiY29kZSJdID0gc2VsZi5jb2RlKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLm9yZGVyKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbIm9yZGVyIl0gPSBzZWxmLm9yZGVyKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmRhdGUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiZGF0ZSJdID0gc2VsZi5kYXRlKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLm5hbWUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsibmFtZSJdID0gc2VsZi5uYW1lKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLnJlbWFyaygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IHNlbGYucmVtYXJrKCk7DQogICAgICAgIA0KICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShyZXRbInJlbWFyayJdLCBkaWN0KToNCiAgICAgICAgICAgICAgICByZXRbInJlbWFyayJdID0gdWpzb24uZHVtcHMocmV0WyJyZW1hcmsiXSk7DQogICAgICAgICAgICByZXRbInJlbWFyayJdID0gdWJpbmFzY2lpLmIyYV9iYXNlNjQocmV0WyJyZW1hcmsiXSkuc3RyaXAoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYudmFsdWUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsidmFsdWUiXSA9IHNlbGYudmFsdWUoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYubWV0cmljKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbIm1ldHJpYyJdID0gc2VsZi5tZXRyaWMoKS5fdG9Eb2N1bWVudCgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5kZXZpY2UoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiZGV2aWNlIl0gPSBzZWxmLmRldmljZSgpLl90b0RvY3VtZW50KCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmNvbnRyb2xsZXIoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiY29udHJvbGxlciJdID0gc2VsZi5jb250cm9sbGVyKCkuX3RvRG9jdW1lbnQoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYuZXhlY3V0aW9uKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbImV4ZWN1dGlvbiJdID0gc2VsZi5leGVjdXRpb24oKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIHJldHVybiByZXQ7DQoNCiAgICANCiAgICBkZWYgc3RvcmUoc2VsZiwgX19ldmVudD1Ob25lKToNCiAgICAgICAgX190b1N0cmluZyA9ICdNZXRyaWNfVmFsdWU6OnN0b3JlKCk6ICc7DQogICAgICAgIA0KICAgICAgICBldkpTT04gPSBOb25lOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBldkpTT04gPSB1anNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046DQogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOw0KICAgICAgICANCg0KICAgICAgICBhbnN3ZXIgPSBOb25lOw0KDQogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aWNrc19tcygpKSsnXS5NZXRyaWNfVmFsdWUuc3RvcmUoKScpLm1ldGhvZCgnc3RvcmUnKS5jbGFzc05hbWUoJ01ldHJpY19WYWx1ZScpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7DQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KICAgICAgICANCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICBhbnN3ZXIgPSBNZXRyaWNfVmFsdWUoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KICAgICAgICANCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQoNCg0KDQogICAgICAgIGlmICdNZXRyaWNfVmFsdWVfc3RvcmUnIGluIGRpcigpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICc9PT4gTWV0cmljX1ZhbHVlX3N0b3JlKCknKTsNCiAgICAgICAgICAgIGFuc3dlciA9IE1ldHJpY19WYWx1ZV9zdG9yZShzZWxmLCBfX2V2ZW50LCBhbnN3ZXIsIF9fdG9TdHJpbmcpOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCg0KICAgICAgICAgICAgDQogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KDQogICAgICAgIHJldHVybiBhbnN3ZXI7DQoNCiAgICANCiAgICBkZWYgZmluZEFsbChzZWxmLCBfX2V2ZW50PU5vbmUpOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ01ldHJpY19WYWx1ZTo6ZmluZEFsbCgpOiAnOw0KICAgICAgICANCiAgICAgICAgZXZKU09OID0gTm9uZTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgZXZKU09OID0gdWpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOg0KICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsNCiAgICAgICAgDQoNCiAgICAgICAgYW5zd2VyID0gTm9uZTsNCg0KICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGlja3NfbXMoKSkrJ10uTWV0cmljX1ZhbHVlLmZpbmRBbGwoKScpLm1ldGhvZCgnZmluZEFsbCcpLmNsYXNzTmFtZSgnTWV0cmljX1ZhbHVlJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOw0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsNCiAgICAgICAgDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQogICAgICAgIA0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgIGFuc3dlciA9IE1ldHJpY19WYWx1ZSgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQogICAgICAgIA0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCg0KDQoNCiAgICAgICAgaWYgJ01ldHJpY19WYWx1ZV9maW5kQWxsJyBpbiBkaXIoKToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnPT0+IE1ldHJpY19WYWx1ZV9maW5kQWxsKCknKTsNCiAgICAgICAgICAgIGFuc3dlciA9IE1ldHJpY19WYWx1ZV9maW5kQWxsKHNlbGYsIF9fZXZlbnQsIGFuc3dlciwgX190b1N0cmluZyk7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KDQogICAgICAgICAgICANCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQoNCiAgICAgICAgcmV0dXJuIGFuc3dlcjsNCg0KICAgIA0KICAgIGRlZiBmaW5kKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6DQogICAgICAgIF9fdG9TdHJpbmcgPSAnTWV0cmljX1ZhbHVlOjpmaW5kKCk6ICc7DQogICAgICAgIA0KICAgICAgICBldkpTT04gPSBOb25lOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBldkpTT04gPSB1anNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046DQogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOw0KICAgICAgICANCg0KICAgICAgICBhbnN3ZXIgPSBOb25lOw0KDQogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aWNrc19tcygpKSsnXS5NZXRyaWNfVmFsdWUuZmluZCgpJykubWV0aG9kKCdmaW5kJykuY2xhc3NOYW1lKCdNZXRyaWNfVmFsdWUnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOw0KICAgICAgICANCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCiAgICAgICAgDQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgYW5zd2VyID0gTWV0cmljX1ZhbHVlKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCiAgICAgICAgDQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KDQoNCg0KICAgICAgICBpZiAnTWV0cmljX1ZhbHVlX2ZpbmQnIGluIGRpcigpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICc9PT4gTWV0cmljX1ZhbHVlX2ZpbmQoKScpOw0KICAgICAgICAgICAgYW5zd2VyID0gTWV0cmljX1ZhbHVlX2ZpbmQoc2VsZiwgX19ldmVudCwgYW5zd2VyLCBfX3RvU3RyaW5nKTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCg0KICAgICAgICByZXR1cm4gYW5zd2VyOw0KDQogICAgDQoNCg0KY2xhc3MgTWV0cmljKCk6DQogICAgZGVmIF9faW5pdF9fKHNlbGYsIElkPU5vbmUsIGFjdGl2ZT1Ob25lLCBlbmFibGVkPU5vbmUsIGNvZGU9Tm9uZSwgb3JkZXI9Tm9uZSwgZGF0ZT1Ob25lLCBuYW1lPU5vbmUsIHJlbWFyaz1Ob25lLCB0eXBlPU5vbmUsIGRldmljZVR5cGU9Tm9uZSk6DQogICAgICAgIHN1cGVyKCkuX19pbml0X18oKTsNCg0KICAgICAgICAjcHJpbnQoJ01ldHJpYzo6X19pbml0X18oKScpOw0KICAgICAgICBpZiBJZCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHNlbGYuSWQgPSBJZDsNCg0KICAgICAgICANCiAgICAgICAgc2VsZi5hY3RpdmUoYWN0aXZlKTsNCiAgICAgICAgc2VsZi5lbmFibGVkKGVuYWJsZWQpOw0KICAgICAgICBzZWxmLmNvZGUoY29kZSk7DQogICAgICAgIHNlbGYub3JkZXIob3JkZXIpOw0KICAgICAgICBzZWxmLmRhdGUoZGF0ZSk7DQogICAgICAgIHNlbGYubmFtZShuYW1lKTsNCiAgICAgICAgc2VsZi5yZW1hcmsocmVtYXJrKTsNCiAgICAgICAgc2VsZi50eXBlKHR5cGUpOw0KICAgICAgICBzZWxmLmRldmljZVR5cGUoZGV2aWNlVHlwZSk7DQogICAgICAgIA0KICAgIElkID0gTm9uZTsNCiAgICANCiAgICANCiAgICAjIGFjdGl2ZTogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9hY3RpdmUgPSBOb25lOw0KICAgIGRlZiBhY3RpdmUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fYWN0aXZlID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2FjdGl2ZTsNCg0KDQogICAgDQogICAgIyBlbmFibGVkOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2VuYWJsZWQgPSBOb25lOw0KICAgIGRlZiBlbmFibGVkKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2VuYWJsZWQgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fZW5hYmxlZDsNCg0KDQogICAgDQogICAgIyBjb2RlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2NvZGUgPSBOb25lOw0KICAgIGRlZiBjb2RlKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2NvZGUgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fY29kZTsNCg0KDQogICAgDQogICAgIyBvcmRlcjogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9vcmRlciA9IE5vbmU7DQogICAgZGVmIG9yZGVyKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX29yZGVyID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX29yZGVyOw0KDQoNCiAgICANCiAgICAjIGRhdGU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfZGF0ZSA9IE5vbmU7DQogICAgZGVmIGRhdGUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fZGF0ZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9kYXRlOw0KDQoNCiAgICANCiAgICAjIG5hbWU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfbmFtZSA9IE5vbmU7DQogICAgZGVmIG5hbWUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fbmFtZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9uYW1lOw0KDQoNCiAgICANCiAgICAjIHJlbWFyazogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9yZW1hcmsgPSBOb25lOw0KICAgIGRlZiByZW1hcmsoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fcmVtYXJrID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3JlbWFyazsNCg0KDQogICAgDQogICAgIyB0eXBlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX3R5cGUgPSBOb25lOw0KICAgIGRlZiB0eXBlKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX3R5cGUgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fdHlwZTsNCg0KDQogICAgDQogICAgIyBkZXZpY2VUeXBlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2RldmljZVR5cGUgPSBOb25lOw0KICAgIGRlZiBkZXZpY2VUeXBlKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2RldmljZVR5cGUgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fZGV2aWNlVHlwZTsNCg0KDQogICAgDQogICAgDQogICAgZGVmIF9mcm9tRG9jdW1lbnQoc2VsZiwgb2JqKToNCiAgICAgICAgX190b1N0cmluZyA9ICdNZXRyaWM6Ol9mcm9tRG9jdW1lbnQoKTogJzsNCg0KICAgICAgICBpZiBvYmogaXMgTm9uZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICANCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIGJ5dGVzKToNCiAgICAgICAgICAgIG9iaiA9IHN0cihvYmosICJ1dGYtOCIpOw0KDQogICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLCBzdHIpIG9yIHR5cGUob2JqKSBpcyBzdHI6DQogICAgICAgICAgICBvYmogPSB1anNvbi5sb2FkcyhvYmopOw0KICAgICAgICANCiAgICAgICAgaWYgbm90IGlzaW5zdGFuY2Uob2JqLCAoc3RyLCBieXRlcywgZGljdCkpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICdHT1QgSEVSRTogJyArIHN0cih0eXBlKG9iaikpKTsNCiAgICAgICAgICAgIHJldHVybiBvYmo7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGZvciBpIGluIG9iajoNCiAgICAgICAgICAgICAgICBvYmpbaV0gPSBNZXRyaWMoKS5fZnJvbURvY3VtZW50KG9ialtpXSk7DQogICAgICAgICAgICByZXR1cm4gb2JqOw0KDQoNCiAgICAgICAgaWYgJ0lkJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLklkID0gb2JqWydJZCddOw0KDQogICAgDQogICAgICAgIGlmICdhY3RpdmUnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuYWN0aXZlKG9ialsnYWN0aXZlJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ2VuYWJsZWQnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuZW5hYmxlZChvYmpbJ2VuYWJsZWQnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnY29kZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5jb2RlKG9ialsnY29kZSddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdvcmRlcicgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5vcmRlcihvYmpbJ29yZGVyJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ2RhdGUnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuZGF0ZShvYmpbJ2RhdGUnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnbmFtZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5uYW1lKG9ialsnbmFtZSddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdyZW1hcmsnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYucmVtYXJrKG9ialsncmVtYXJrJ10pOw0KICAgICAgICANCiAgICAgICAgICAgIHNlbGYucmVtYXJrKCB1YmluYXNjaWkuYTJiX2Jhc2U2NChzZWxmLnJlbWFyaygpKSApOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ3R5cGUnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYudHlwZShNZXRyaWNfVHlwZSgpLl9mcm9tRG9jdW1lbnQob2JqWyd0eXBlJ10pKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdkZXZpY2VUeXBlJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmRldmljZVR5cGUoRGV2aWNlX1R5cGUoKS5fZnJvbURvY3VtZW50KG9ialsnZGV2aWNlVHlwZSddKSk7DQogICAgICAgIA0KICAgIA0KDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgDQogICAgZGVmIF90b0RvY3VtZW50KHNlbGYpOg0KICAgICAgICByZXQgPSB7fTsNCiAgICAgICAgaWYgc2VsZi5JZCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiSWQiXSA9IHNlbGYuSWQ7DQoNCiAgICANCiAgICAgICAgaWYgc2VsZi5hY3RpdmUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiYWN0aXZlIl0gPSBzZWxmLmFjdGl2ZSgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5lbmFibGVkKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbImVuYWJsZWQiXSA9IHNlbGYuZW5hYmxlZCgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5jb2RlKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbImNvZGUiXSA9IHNlbGYuY29kZSgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5vcmRlcigpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJvcmRlciJdID0gc2VsZi5vcmRlcigpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5kYXRlKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbImRhdGUiXSA9IHNlbGYuZGF0ZSgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5uYW1lKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbIm5hbWUiXSA9IHNlbGYubmFtZSgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5yZW1hcmsoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSBzZWxmLnJlbWFyaygpOw0KICAgICAgICANCiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UocmV0WyJyZW1hcmsiXSwgZGljdCk6DQogICAgICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IHVqc29uLmR1bXBzKHJldFsicmVtYXJrIl0pOw0KICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IHViaW5hc2NpaS5iMmFfYmFzZTY0KHJldFsicmVtYXJrIl0pLnN0cmlwKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLnR5cGUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsidHlwZSJdID0gc2VsZi50eXBlKCkuX3RvRG9jdW1lbnQoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYuZGV2aWNlVHlwZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJkZXZpY2VUeXBlIl0gPSBzZWxmLmRldmljZVR5cGUoKS5fdG9Eb2N1bWVudCgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgcmV0dXJuIHJldDsNCg0KICAgIA0KICAgIGRlZiBzdG9yZShzZWxmLCBfX2V2ZW50PU5vbmUpOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ01ldHJpYzo6c3RvcmUoKTogJzsNCiAgICAgICAgDQogICAgICAgIGV2SlNPTiA9IE5vbmU7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIGV2SlNPTiA9IHVqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoNCiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7DQogICAgICAgIA0KDQogICAgICAgIGFuc3dlciA9IE5vbmU7DQoNCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpY2tzX21zKCkpKyddLk1ldHJpYy5zdG9yZSgpJykubWV0aG9kKCdzdG9yZScpLmNsYXNzTmFtZSgnTWV0cmljJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOw0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsNCiAgICAgICAgDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQogICAgICAgIA0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgIGFuc3dlciA9IE1ldHJpYygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQogICAgICAgIA0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCg0KDQoNCiAgICAgICAgaWYgJ01ldHJpY19zdG9yZScgaW4gZGlyKCk6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJz09PiBNZXRyaWNfc3RvcmUoKScpOw0KICAgICAgICAgICAgYW5zd2VyID0gTWV0cmljX3N0b3JlKHNlbGYsIF9fZXZlbnQsIGFuc3dlciwgX190b1N0cmluZyk7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KDQogICAgICAgICAgICANCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQoNCiAgICAgICAgcmV0dXJuIGFuc3dlcjsNCg0KICAgIA0KICAgIGRlZiBmaW5kQWxsKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6DQogICAgICAgIF9fdG9TdHJpbmcgPSAnTWV0cmljOjpmaW5kQWxsKCk6ICc7DQogICAgICAgIA0KICAgICAgICBldkpTT04gPSBOb25lOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBldkpTT04gPSB1anNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046DQogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOw0KICAgICAgICANCg0KICAgICAgICBhbnN3ZXIgPSBOb25lOw0KDQogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aWNrc19tcygpKSsnXS5NZXRyaWMuZmluZEFsbCgpJykubWV0aG9kKCdmaW5kQWxsJykuY2xhc3NOYW1lKCdNZXRyaWMnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOw0KICAgICAgICANCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCiAgICAgICAgDQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgYW5zd2VyID0gTWV0cmljKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCiAgICAgICAgDQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KDQoNCg0KICAgICAgICBpZiAnTWV0cmljX2ZpbmRBbGwnIGluIGRpcigpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICc9PT4gTWV0cmljX2ZpbmRBbGwoKScpOw0KICAgICAgICAgICAgYW5zd2VyID0gTWV0cmljX2ZpbmRBbGwoc2VsZiwgX19ldmVudCwgYW5zd2VyLCBfX3RvU3RyaW5nKTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCg0KICAgICAgICByZXR1cm4gYW5zd2VyOw0KDQogICAgDQogICAgZGVmIGZpbmQoc2VsZiwgX19ldmVudD1Ob25lKToNCiAgICAgICAgX190b1N0cmluZyA9ICdNZXRyaWM6OmZpbmQoKTogJzsNCiAgICAgICAgDQogICAgICAgIGV2SlNPTiA9IE5vbmU7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIGV2SlNPTiA9IHVqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoNCiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7DQogICAgICAgIA0KDQogICAgICAgIGFuc3dlciA9IE5vbmU7DQoNCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpY2tzX21zKCkpKyddLk1ldHJpYy5maW5kKCknKS5tZXRob2QoJ2ZpbmQnKS5jbGFzc05hbWUoJ01ldHJpYycpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7DQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KICAgICAgICANCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICBhbnN3ZXIgPSBNZXRyaWMoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KICAgICAgICANCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQoNCg0KDQogICAgICAgIGlmICdNZXRyaWNfZmluZCcgaW4gZGlyKCk6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJz09PiBNZXRyaWNfZmluZCgpJyk7DQogICAgICAgICAgICBhbnN3ZXIgPSBNZXRyaWNfZmluZChzZWxmLCBfX2V2ZW50LCBhbnN3ZXIsIF9fdG9TdHJpbmcpOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCg0KICAgICAgICAgICAgDQogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KDQogICAgICAgIHJldHVybiBhbnN3ZXI7DQoNCiAgICANCg0KDQpjbGFzcyBDb25maWcoKToNCiAgICBkZWYgX19pbml0X18oc2VsZiwgSWQ9Tm9uZSwgYWN0aXZlPU5vbmUsIGVuYWJsZWQ9Tm9uZSwgY29kZT1Ob25lLCBvcmRlcj1Ob25lLCBkYXRlPU5vbmUsIG5hbWU9Tm9uZSwgcmVtYXJrPU5vbmUsIHZhbHVlPU5vbmUsIHNjcmlwdD1Ob25lLCB0b29sPU5vbmUsIGdyb3VwPU5vbmUsIHR5cGU9Tm9uZSwgbm9kZT1Ob25lKToNCiAgICAgICAgc3VwZXIoKS5fX2luaXRfXygpOw0KDQogICAgICAgICNwcmludCgnQ29uZmlnOjpfX2luaXRfXygpJyk7DQogICAgICAgIGlmIElkIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgc2VsZi5JZCA9IElkOw0KDQogICAgICAgIA0KICAgICAgICBzZWxmLmFjdGl2ZShhY3RpdmUpOw0KICAgICAgICBzZWxmLmVuYWJsZWQoZW5hYmxlZCk7DQogICAgICAgIHNlbGYuY29kZShjb2RlKTsNCiAgICAgICAgc2VsZi5vcmRlcihvcmRlcik7DQogICAgICAgIHNlbGYuZGF0ZShkYXRlKTsNCiAgICAgICAgc2VsZi5uYW1lKG5hbWUpOw0KICAgICAgICBzZWxmLnJlbWFyayhyZW1hcmspOw0KICAgICAgICBzZWxmLnZhbHVlKHZhbHVlKTsNCiAgICAgICAgc2VsZi5zY3JpcHQoc2NyaXB0KTsNCiAgICAgICAgc2VsZi50b29sKHRvb2wpOw0KICAgICAgICBzZWxmLmdyb3VwKGdyb3VwKTsNCiAgICAgICAgc2VsZi50eXBlKHR5cGUpOw0KICAgICAgICBzZWxmLm5vZGUobm9kZSk7DQogICAgICAgIA0KICAgIElkID0gTm9uZTsNCiAgICANCiAgICANCiAgICAjIGFjdGl2ZTogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9hY3RpdmUgPSBOb25lOw0KICAgIGRlZiBhY3RpdmUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fYWN0aXZlID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2FjdGl2ZTsNCg0KDQogICAgDQogICAgIyBlbmFibGVkOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2VuYWJsZWQgPSBOb25lOw0KICAgIGRlZiBlbmFibGVkKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2VuYWJsZWQgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fZW5hYmxlZDsNCg0KDQogICAgDQogICAgIyBjb2RlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2NvZGUgPSBOb25lOw0KICAgIGRlZiBjb2RlKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2NvZGUgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fY29kZTsNCg0KDQogICAgDQogICAgIyBvcmRlcjogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9vcmRlciA9IE5vbmU7DQogICAgZGVmIG9yZGVyKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX29yZGVyID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX29yZGVyOw0KDQoNCiAgICANCiAgICAjIGRhdGU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfZGF0ZSA9IE5vbmU7DQogICAgZGVmIGRhdGUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fZGF0ZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9kYXRlOw0KDQoNCiAgICANCiAgICAjIG5hbWU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfbmFtZSA9IE5vbmU7DQogICAgZGVmIG5hbWUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fbmFtZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9uYW1lOw0KDQoNCiAgICANCiAgICAjIHJlbWFyazogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9yZW1hcmsgPSBOb25lOw0KICAgIGRlZiByZW1hcmsoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fcmVtYXJrID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3JlbWFyazsNCg0KDQogICAgDQogICAgIyB2YWx1ZTogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF92YWx1ZSA9IE5vbmU7DQogICAgZGVmIHZhbHVlKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX3ZhbHVlID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3ZhbHVlOw0KDQoNCiAgICANCiAgICAjIHNjcmlwdDogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9zY3JpcHQgPSBOb25lOw0KICAgIGRlZiBzY3JpcHQoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fc2NyaXB0ID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3NjcmlwdDsNCg0KDQogICAgDQogICAgIyB0b29sOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX3Rvb2wgPSBOb25lOw0KICAgIGRlZiB0b29sKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX3Rvb2wgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fdG9vbDsNCg0KDQogICAgDQogICAgIyBncm91cDogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9ncm91cCA9IE5vbmU7DQogICAgZGVmIGdyb3VwKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2dyb3VwID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2dyb3VwOw0KDQoNCiAgICANCiAgICAjIHR5cGU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfdHlwZSA9IE5vbmU7DQogICAgZGVmIHR5cGUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fdHlwZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl90eXBlOw0KDQoNCiAgICANCiAgICAjIG5vZGU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfbm9kZSA9IE5vbmU7DQogICAgZGVmIG5vZGUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fbm9kZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9ub2RlOw0KDQoNCiAgICANCiAgICANCiAgICBkZWYgX2Zyb21Eb2N1bWVudChzZWxmLCBvYmopOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ0NvbmZpZzo6X2Zyb21Eb2N1bWVudCgpOiAnOw0KDQogICAgICAgIGlmIG9iaiBpcyBOb25lOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIA0KICAgICAgICBpZiBpc2luc3RhbmNlKG9iaiwgYnl0ZXMpOg0KICAgICAgICAgICAgb2JqID0gc3RyKG9iaiwgInV0Zi04Iik7DQoNCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIHN0cikgb3IgdHlwZShvYmopIGlzIHN0cjoNCiAgICAgICAgICAgIG9iaiA9IHVqc29uLmxvYWRzKG9iaik7DQogICAgICAgIA0KICAgICAgICBpZiBub3QgaXNpbnN0YW5jZShvYmosIChzdHIsIGJ5dGVzLCBkaWN0KSk6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJ0dPVCBIRVJFOiAnICsgc3RyKHR5cGUob2JqKSkpOw0KICAgICAgICAgICAgcmV0dXJuIG9iajsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZm9yIGkgaW4gb2JqOg0KICAgICAgICAgICAgICAgIG9ialtpXSA9IENvbmZpZygpLl9mcm9tRG9jdW1lbnQob2JqW2ldKTsNCiAgICAgICAgICAgIHJldHVybiBvYmo7DQoNCg0KICAgICAgICBpZiAnSWQnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuSWQgPSBvYmpbJ0lkJ107DQoNCiAgICANCiAgICAgICAgaWYgJ2FjdGl2ZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5hY3RpdmUob2JqWydhY3RpdmUnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnZW5hYmxlZCcgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5lbmFibGVkKG9ialsnZW5hYmxlZCddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdjb2RlJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmNvZGUob2JqWydjb2RlJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ29yZGVyJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLm9yZGVyKG9ialsnb3JkZXInXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnZGF0ZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5kYXRlKG9ialsnZGF0ZSddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICduYW1lJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLm5hbWUob2JqWyduYW1lJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ3JlbWFyaycgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5yZW1hcmsob2JqWydyZW1hcmsnXSk7DQogICAgICAgIA0KICAgICAgICAgICAgc2VsZi5yZW1hcmsoIHViaW5hc2NpaS5hMmJfYmFzZTY0KHNlbGYucmVtYXJrKCkpICk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAndmFsdWUnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYudmFsdWUob2JqWyd2YWx1ZSddKTsNCiAgICAgICAgDQogICAgICAgICAgICBzZWxmLnZhbHVlKCB1YmluYXNjaWkuYTJiX2Jhc2U2NChzZWxmLnZhbHVlKCkpICk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnc2NyaXB0JyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLnNjcmlwdChvYmpbJ3NjcmlwdCddKTsNCiAgICAgICAgDQogICAgICAgICAgICBzZWxmLnNjcmlwdCggdWJpbmFzY2lpLmEyYl9iYXNlNjQoc2VsZi5zY3JpcHQoKSkgKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICd0b29sJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLnRvb2woVG9vbCgpLl9mcm9tRG9jdW1lbnQob2JqWyd0b29sJ10pKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdncm91cCcgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5ncm91cChDb25maWdfR3JvdXAoKS5fZnJvbURvY3VtZW50KG9ialsnZ3JvdXAnXSkpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ3R5cGUnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYudHlwZShUb29sX1R5cGUoKS5fZnJvbURvY3VtZW50KG9ialsndHlwZSddKSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnbm9kZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5ub2RlKE5vZGUoKS5fZnJvbURvY3VtZW50KG9ialsnbm9kZSddKSk7DQogICAgICAgIA0KICAgIA0KDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgDQogICAgZGVmIF90b0RvY3VtZW50KHNlbGYpOg0KICAgICAgICByZXQgPSB7fTsNCiAgICAgICAgaWYgc2VsZi5JZCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiSWQiXSA9IHNlbGYuSWQ7DQoNCiAgICANCiAgICAgICAgaWYgc2VsZi5hY3RpdmUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiYWN0aXZlIl0gPSBzZWxmLmFjdGl2ZSgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5lbmFibGVkKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbImVuYWJsZWQiXSA9IHNlbGYuZW5hYmxlZCgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5jb2RlKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbImNvZGUiXSA9IHNlbGYuY29kZSgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5vcmRlcigpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJvcmRlciJdID0gc2VsZi5vcmRlcigpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5kYXRlKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbImRhdGUiXSA9IHNlbGYuZGF0ZSgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5uYW1lKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbIm5hbWUiXSA9IHNlbGYubmFtZSgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5yZW1hcmsoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSBzZWxmLnJlbWFyaygpOw0KICAgICAgICANCiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UocmV0WyJyZW1hcmsiXSwgZGljdCk6DQogICAgICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IHVqc29uLmR1bXBzKHJldFsicmVtYXJrIl0pOw0KICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IHViaW5hc2NpaS5iMmFfYmFzZTY0KHJldFsicmVtYXJrIl0pLnN0cmlwKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLnZhbHVlKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbInZhbHVlIl0gPSBzZWxmLnZhbHVlKCk7DQogICAgICAgIA0KICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShyZXRbInZhbHVlIl0sIGRpY3QpOg0KICAgICAgICAgICAgICAgIHJldFsidmFsdWUiXSA9IHVqc29uLmR1bXBzKHJldFsidmFsdWUiXSk7DQogICAgICAgICAgICByZXRbInZhbHVlIl0gPSB1YmluYXNjaWkuYjJhX2Jhc2U2NChyZXRbInZhbHVlIl0pLnN0cmlwKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLnNjcmlwdCgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJzY3JpcHQiXSA9IHNlbGYuc2NyaXB0KCk7DQogICAgICAgIA0KICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShyZXRbInNjcmlwdCJdLCBkaWN0KToNCiAgICAgICAgICAgICAgICByZXRbInNjcmlwdCJdID0gdWpzb24uZHVtcHMocmV0WyJzY3JpcHQiXSk7DQogICAgICAgICAgICByZXRbInNjcmlwdCJdID0gdWJpbmFzY2lpLmIyYV9iYXNlNjQocmV0WyJzY3JpcHQiXSkuc3RyaXAoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYudG9vbCgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJ0b29sIl0gPSBzZWxmLnRvb2woKS5fdG9Eb2N1bWVudCgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5ncm91cCgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJncm91cCJdID0gc2VsZi5ncm91cCgpLl90b0RvY3VtZW50KCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLnR5cGUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsidHlwZSJdID0gc2VsZi50eXBlKCkuX3RvRG9jdW1lbnQoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYubm9kZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJub2RlIl0gPSBzZWxmLm5vZGUoKS5fdG9Eb2N1bWVudCgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgcmV0dXJuIHJldDsNCg0KICAgIA0KICAgIGRlZiBzdG9yZShzZWxmLCBfX2V2ZW50PU5vbmUpOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ0NvbmZpZzo6c3RvcmUoKTogJzsNCiAgICAgICAgDQogICAgICAgIGV2SlNPTiA9IE5vbmU7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIGV2SlNPTiA9IHVqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoNCiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7DQogICAgICAgIA0KDQogICAgICAgIGFuc3dlciA9IE5vbmU7DQoNCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpY2tzX21zKCkpKyddLkNvbmZpZy5zdG9yZSgpJykubWV0aG9kKCdzdG9yZScpLmNsYXNzTmFtZSgnQ29uZmlnJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOw0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsNCiAgICAgICAgDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQogICAgICAgIA0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgIGFuc3dlciA9IENvbmZpZygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQogICAgICAgIA0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCg0KDQoNCiAgICAgICAgaWYgJ0NvbmZpZ19zdG9yZScgaW4gZGlyKCk6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJz09PiBDb25maWdfc3RvcmUoKScpOw0KICAgICAgICAgICAgYW5zd2VyID0gQ29uZmlnX3N0b3JlKHNlbGYsIF9fZXZlbnQsIGFuc3dlciwgX190b1N0cmluZyk7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KDQogICAgICAgICAgICANCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQoNCiAgICAgICAgcmV0dXJuIGFuc3dlcjsNCg0KICAgIA0KICAgIGRlZiBmaW5kQWxsKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6DQogICAgICAgIF9fdG9TdHJpbmcgPSAnQ29uZmlnOjpmaW5kQWxsKCk6ICc7DQogICAgICAgIA0KICAgICAgICBldkpTT04gPSBOb25lOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBldkpTT04gPSB1anNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046DQogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOw0KICAgICAgICANCg0KICAgICAgICBhbnN3ZXIgPSBOb25lOw0KDQogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aWNrc19tcygpKSsnXS5Db25maWcuZmluZEFsbCgpJykubWV0aG9kKCdmaW5kQWxsJykuY2xhc3NOYW1lKCdDb25maWcnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOw0KICAgICAgICANCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCiAgICAgICAgDQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgYW5zd2VyID0gQ29uZmlnKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCiAgICAgICAgDQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KDQoNCg0KICAgICAgICBpZiAnQ29uZmlnX2ZpbmRBbGwnIGluIGRpcigpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICc9PT4gQ29uZmlnX2ZpbmRBbGwoKScpOw0KICAgICAgICAgICAgYW5zd2VyID0gQ29uZmlnX2ZpbmRBbGwoc2VsZiwgX19ldmVudCwgYW5zd2VyLCBfX3RvU3RyaW5nKTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCg0KICAgICAgICByZXR1cm4gYW5zd2VyOw0KDQogICAgDQogICAgZGVmIGZpbmQoc2VsZiwgX19ldmVudD1Ob25lKToNCiAgICAgICAgX190b1N0cmluZyA9ICdDb25maWc6OmZpbmQoKTogJzsNCiAgICAgICAgDQogICAgICAgIGV2SlNPTiA9IE5vbmU7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIGV2SlNPTiA9IHVqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoNCiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7DQogICAgICAgIA0KDQogICAgICAgIGFuc3dlciA9IE5vbmU7DQoNCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpY2tzX21zKCkpKyddLkNvbmZpZy5maW5kKCknKS5tZXRob2QoJ2ZpbmQnKS5jbGFzc05hbWUoJ0NvbmZpZycpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7DQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KICAgICAgICANCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICBhbnN3ZXIgPSBDb25maWcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KICAgICAgICANCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQoNCg0KDQogICAgICAgIGlmICdDb25maWdfZmluZCcgaW4gZGlyKCk6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJz09PiBDb25maWdfZmluZCgpJyk7DQogICAgICAgICAgICBhbnN3ZXIgPSBDb25maWdfZmluZChzZWxmLCBfX2V2ZW50LCBhbnN3ZXIsIF9fdG9TdHJpbmcpOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCg0KICAgICAgICAgICAgDQogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KDQogICAgICAgIHJldHVybiBhbnN3ZXI7DQoNCiAgICANCg0KDQpjbGFzcyBUb29sKCk6DQogICAgZGVmIF9faW5pdF9fKHNlbGYsIElkPU5vbmUsIGFjdGl2ZT1Ob25lLCBlbmFibGVkPU5vbmUsIGNvZGU9Tm9uZSwgb3JkZXI9Tm9uZSwgZGF0ZT1Ob25lLCBuYW1lPU5vbmUsIHJlbWFyaz1Ob25lLCB0eXBlPU5vbmUpOg0KICAgICAgICBzdXBlcigpLl9faW5pdF9fKCk7DQoNCiAgICAgICAgI3ByaW50KCdUb29sOjpfX2luaXRfXygpJyk7DQogICAgICAgIGlmIElkIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgc2VsZi5JZCA9IElkOw0KDQogICAgICAgIA0KICAgICAgICBzZWxmLmFjdGl2ZShhY3RpdmUpOw0KICAgICAgICBzZWxmLmVuYWJsZWQoZW5hYmxlZCk7DQogICAgICAgIHNlbGYuY29kZShjb2RlKTsNCiAgICAgICAgc2VsZi5vcmRlcihvcmRlcik7DQogICAgICAgIHNlbGYuZGF0ZShkYXRlKTsNCiAgICAgICAgc2VsZi5uYW1lKG5hbWUpOw0KICAgICAgICBzZWxmLnJlbWFyayhyZW1hcmspOw0KICAgICAgICBzZWxmLnR5cGUodHlwZSk7DQogICAgICAgIA0KICAgIElkID0gTm9uZTsNCiAgICANCiAgICANCiAgICAjIGFjdGl2ZTogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9hY3RpdmUgPSBOb25lOw0KICAgIGRlZiBhY3RpdmUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fYWN0aXZlID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2FjdGl2ZTsNCg0KDQogICAgDQogICAgIyBlbmFibGVkOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2VuYWJsZWQgPSBOb25lOw0KICAgIGRlZiBlbmFibGVkKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2VuYWJsZWQgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fZW5hYmxlZDsNCg0KDQogICAgDQogICAgIyBjb2RlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2NvZGUgPSBOb25lOw0KICAgIGRlZiBjb2RlKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2NvZGUgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fY29kZTsNCg0KDQogICAgDQogICAgIyBvcmRlcjogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9vcmRlciA9IE5vbmU7DQogICAgZGVmIG9yZGVyKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX29yZGVyID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX29yZGVyOw0KDQoNCiAgICANCiAgICAjIGRhdGU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfZGF0ZSA9IE5vbmU7DQogICAgZGVmIGRhdGUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fZGF0ZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9kYXRlOw0KDQoNCiAgICANCiAgICAjIG5hbWU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfbmFtZSA9IE5vbmU7DQogICAgZGVmIG5hbWUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fbmFtZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9uYW1lOw0KDQoNCiAgICANCiAgICAjIHJlbWFyazogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9yZW1hcmsgPSBOb25lOw0KICAgIGRlZiByZW1hcmsoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fcmVtYXJrID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3JlbWFyazsNCg0KDQogICAgDQogICAgIyB0eXBlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX3R5cGUgPSBOb25lOw0KICAgIGRlZiB0eXBlKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX3R5cGUgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fdHlwZTsNCg0KDQogICAgDQogICAgDQogICAgZGVmIF9mcm9tRG9jdW1lbnQoc2VsZiwgb2JqKToNCiAgICAgICAgX190b1N0cmluZyA9ICdUb29sOjpfZnJvbURvY3VtZW50KCk6ICc7DQoNCiAgICAgICAgaWYgb2JqIGlzIE5vbmU6DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgDQogICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLCBieXRlcyk6DQogICAgICAgICAgICBvYmogPSBzdHIob2JqLCAidXRmLTgiKTsNCg0KICAgICAgICBpZiBpc2luc3RhbmNlKG9iaiwgc3RyKSBvciB0eXBlKG9iaikgaXMgc3RyOg0KICAgICAgICAgICAgb2JqID0gdWpzb24ubG9hZHMob2JqKTsNCiAgICAgICAgDQogICAgICAgIGlmIG5vdCBpc2luc3RhbmNlKG9iaiwgKHN0ciwgYnl0ZXMsIGRpY3QpKToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnR09UIEhFUkU6ICcgKyBzdHIodHlwZShvYmopKSk7DQogICAgICAgICAgICByZXR1cm4gb2JqOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBmb3IgaSBpbiBvYmo6DQogICAgICAgICAgICAgICAgb2JqW2ldID0gVG9vbCgpLl9mcm9tRG9jdW1lbnQob2JqW2ldKTsNCiAgICAgICAgICAgIHJldHVybiBvYmo7DQoNCg0KICAgICAgICBpZiAnSWQnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuSWQgPSBvYmpbJ0lkJ107DQoNCiAgICANCiAgICAgICAgaWYgJ2FjdGl2ZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5hY3RpdmUob2JqWydhY3RpdmUnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnZW5hYmxlZCcgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5lbmFibGVkKG9ialsnZW5hYmxlZCddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdjb2RlJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmNvZGUob2JqWydjb2RlJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ29yZGVyJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLm9yZGVyKG9ialsnb3JkZXInXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnZGF0ZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5kYXRlKG9ialsnZGF0ZSddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICduYW1lJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLm5hbWUob2JqWyduYW1lJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ3JlbWFyaycgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5yZW1hcmsob2JqWydyZW1hcmsnXSk7DQogICAgICAgIA0KICAgICAgICAgICAgc2VsZi5yZW1hcmsoIHViaW5hc2NpaS5hMmJfYmFzZTY0KHNlbGYucmVtYXJrKCkpICk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAndHlwZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi50eXBlKFRvb2xfVHlwZSgpLl9mcm9tRG9jdW1lbnQob2JqWyd0eXBlJ10pKTsNCiAgICAgICAgDQogICAgDQoNCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICByZXR1cm4gc2VsZjsNCiAgICANCiAgICBkZWYgX3RvRG9jdW1lbnQoc2VsZik6DQogICAgICAgIHJldCA9IHt9Ow0KICAgICAgICBpZiBzZWxmLklkIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJJZCJdID0gc2VsZi5JZDsNCg0KICAgIA0KICAgICAgICBpZiBzZWxmLmFjdGl2ZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJhY3RpdmUiXSA9IHNlbGYuYWN0aXZlKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmVuYWJsZWQoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiZW5hYmxlZCJdID0gc2VsZi5lbmFibGVkKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmNvZGUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiY29kZSJdID0gc2VsZi5jb2RlKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLm9yZGVyKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbIm9yZGVyIl0gPSBzZWxmLm9yZGVyKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmRhdGUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiZGF0ZSJdID0gc2VsZi5kYXRlKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLm5hbWUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsibmFtZSJdID0gc2VsZi5uYW1lKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLnJlbWFyaygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IHNlbGYucmVtYXJrKCk7DQogICAgICAgIA0KICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShyZXRbInJlbWFyayJdLCBkaWN0KToNCiAgICAgICAgICAgICAgICByZXRbInJlbWFyayJdID0gdWpzb24uZHVtcHMocmV0WyJyZW1hcmsiXSk7DQogICAgICAgICAgICByZXRbInJlbWFyayJdID0gdWJpbmFzY2lpLmIyYV9iYXNlNjQocmV0WyJyZW1hcmsiXSkuc3RyaXAoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYudHlwZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJ0eXBlIl0gPSBzZWxmLnR5cGUoKS5fdG9Eb2N1bWVudCgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgcmV0dXJuIHJldDsNCg0KICAgIA0KICAgIGRlZiBzdG9yZShzZWxmLCBfX2V2ZW50PU5vbmUpOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ1Rvb2w6OnN0b3JlKCk6ICc7DQogICAgICAgIA0KICAgICAgICBldkpTT04gPSBOb25lOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBldkpTT04gPSB1anNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046DQogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOw0KICAgICAgICANCg0KICAgICAgICBhbnN3ZXIgPSBOb25lOw0KDQogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aWNrc19tcygpKSsnXS5Ub29sLnN0b3JlKCknKS5tZXRob2QoJ3N0b3JlJykuY2xhc3NOYW1lKCdUb29sJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOw0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsNCiAgICAgICAgDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQogICAgICAgIA0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgIGFuc3dlciA9IFRvb2woKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KICAgICAgICANCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQoNCg0KDQogICAgICAgIGlmICdUb29sX3N0b3JlJyBpbiBkaXIoKToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnPT0+IFRvb2xfc3RvcmUoKScpOw0KICAgICAgICAgICAgYW5zd2VyID0gVG9vbF9zdG9yZShzZWxmLCBfX2V2ZW50LCBhbnN3ZXIsIF9fdG9TdHJpbmcpOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCg0KICAgICAgICAgICAgDQogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KDQogICAgICAgIHJldHVybiBhbnN3ZXI7DQoNCiAgICANCiAgICBkZWYgZmluZEFsbChzZWxmLCBfX2V2ZW50PU5vbmUpOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ1Rvb2w6OmZpbmRBbGwoKTogJzsNCiAgICAgICAgDQogICAgICAgIGV2SlNPTiA9IE5vbmU7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIGV2SlNPTiA9IHVqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoNCiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7DQogICAgICAgIA0KDQogICAgICAgIGFuc3dlciA9IE5vbmU7DQoNCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpY2tzX21zKCkpKyddLlRvb2wuZmluZEFsbCgpJykubWV0aG9kKCdmaW5kQWxsJykuY2xhc3NOYW1lKCdUb29sJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOw0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsNCiAgICAgICAgDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQogICAgICAgIA0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgIGFuc3dlciA9IFRvb2woKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KICAgICAgICANCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQoNCg0KDQogICAgICAgIGlmICdUb29sX2ZpbmRBbGwnIGluIGRpcigpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICc9PT4gVG9vbF9maW5kQWxsKCknKTsNCiAgICAgICAgICAgIGFuc3dlciA9IFRvb2xfZmluZEFsbChzZWxmLCBfX2V2ZW50LCBhbnN3ZXIsIF9fdG9TdHJpbmcpOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCg0KICAgICAgICAgICAgDQogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KDQogICAgICAgIHJldHVybiBhbnN3ZXI7DQoNCiAgICANCiAgICBkZWYgZmluZChzZWxmLCBfX2V2ZW50PU5vbmUpOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ1Rvb2w6OmZpbmQoKTogJzsNCiAgICAgICAgDQogICAgICAgIGV2SlNPTiA9IE5vbmU7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIGV2SlNPTiA9IHVqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoNCiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7DQogICAgICAgIA0KDQogICAgICAgIGFuc3dlciA9IE5vbmU7DQoNCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpY2tzX21zKCkpKyddLlRvb2wuZmluZCgpJykubWV0aG9kKCdmaW5kJykuY2xhc3NOYW1lKCdUb29sJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOw0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsNCiAgICAgICAgDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQogICAgICAgIA0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgIGFuc3dlciA9IFRvb2woKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KICAgICAgICANCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQoNCg0KDQogICAgICAgIGlmICdUb29sX2ZpbmQnIGluIGRpcigpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICc9PT4gVG9vbF9maW5kKCknKTsNCiAgICAgICAgICAgIGFuc3dlciA9IFRvb2xfZmluZChzZWxmLCBfX2V2ZW50LCBhbnN3ZXIsIF9fdG9TdHJpbmcpOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCg0KICAgICAgICAgICAgDQogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KDQogICAgICAgIHJldHVybiBhbnN3ZXI7DQoNCiAgICANCg0KDQpjbGFzcyBDb25maWdfR3JvdXAoKToNCiAgICBkZWYgX19pbml0X18oc2VsZiwgSWQ9Tm9uZSwgYWN0aXZlPU5vbmUsIGVuYWJsZWQ9Tm9uZSwgY29kZT1Ob25lLCBvcmRlcj1Ob25lLCBkYXRlPU5vbmUsIG5hbWU9Tm9uZSwgcmVtYXJrPU5vbmUpOg0KICAgICAgICBzdXBlcigpLl9faW5pdF9fKCk7DQoNCiAgICAgICAgI3ByaW50KCdDb25maWdfR3JvdXA6Ol9faW5pdF9fKCknKTsNCiAgICAgICAgaWYgSWQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBzZWxmLklkID0gSWQ7DQoNCiAgICAgICAgDQogICAgICAgIHNlbGYuYWN0aXZlKGFjdGl2ZSk7DQogICAgICAgIHNlbGYuZW5hYmxlZChlbmFibGVkKTsNCiAgICAgICAgc2VsZi5jb2RlKGNvZGUpOw0KICAgICAgICBzZWxmLm9yZGVyKG9yZGVyKTsNCiAgICAgICAgc2VsZi5kYXRlKGRhdGUpOw0KICAgICAgICBzZWxmLm5hbWUobmFtZSk7DQogICAgICAgIHNlbGYucmVtYXJrKHJlbWFyayk7DQogICAgICAgIA0KICAgIElkID0gTm9uZTsNCiAgICANCiAgICANCiAgICAjIGFjdGl2ZTogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9hY3RpdmUgPSBOb25lOw0KICAgIGRlZiBhY3RpdmUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fYWN0aXZlID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2FjdGl2ZTsNCg0KDQogICAgDQogICAgIyBlbmFibGVkOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2VuYWJsZWQgPSBOb25lOw0KICAgIGRlZiBlbmFibGVkKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2VuYWJsZWQgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fZW5hYmxlZDsNCg0KDQogICAgDQogICAgIyBjb2RlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2NvZGUgPSBOb25lOw0KICAgIGRlZiBjb2RlKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2NvZGUgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fY29kZTsNCg0KDQogICAgDQogICAgIyBvcmRlcjogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9vcmRlciA9IE5vbmU7DQogICAgZGVmIG9yZGVyKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX29yZGVyID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX29yZGVyOw0KDQoNCiAgICANCiAgICAjIGRhdGU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfZGF0ZSA9IE5vbmU7DQogICAgZGVmIGRhdGUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fZGF0ZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9kYXRlOw0KDQoNCiAgICANCiAgICAjIG5hbWU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfbmFtZSA9IE5vbmU7DQogICAgZGVmIG5hbWUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fbmFtZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9uYW1lOw0KDQoNCiAgICANCiAgICAjIHJlbWFyazogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9yZW1hcmsgPSBOb25lOw0KICAgIGRlZiByZW1hcmsoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fcmVtYXJrID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3JlbWFyazsNCg0KDQogICAgDQogICAgDQogICAgZGVmIF9mcm9tRG9jdW1lbnQoc2VsZiwgb2JqKToNCiAgICAgICAgX190b1N0cmluZyA9ICdDb25maWdfR3JvdXA6Ol9mcm9tRG9jdW1lbnQoKTogJzsNCg0KICAgICAgICBpZiBvYmogaXMgTm9uZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICANCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIGJ5dGVzKToNCiAgICAgICAgICAgIG9iaiA9IHN0cihvYmosICJ1dGYtOCIpOw0KDQogICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLCBzdHIpIG9yIHR5cGUob2JqKSBpcyBzdHI6DQogICAgICAgICAgICBvYmogPSB1anNvbi5sb2FkcyhvYmopOw0KICAgICAgICANCiAgICAgICAgaWYgbm90IGlzaW5zdGFuY2Uob2JqLCAoc3RyLCBieXRlcywgZGljdCkpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICdHT1QgSEVSRTogJyArIHN0cih0eXBlKG9iaikpKTsNCiAgICAgICAgICAgIHJldHVybiBvYmo7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGZvciBpIGluIG9iajoNCiAgICAgICAgICAgICAgICBvYmpbaV0gPSBDb25maWdfR3JvdXAoKS5fZnJvbURvY3VtZW50KG9ialtpXSk7DQogICAgICAgICAgICByZXR1cm4gb2JqOw0KDQoNCiAgICAgICAgaWYgJ0lkJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLklkID0gb2JqWydJZCddOw0KDQogICAgDQogICAgICAgIGlmICdhY3RpdmUnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuYWN0aXZlKG9ialsnYWN0aXZlJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ2VuYWJsZWQnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuZW5hYmxlZChvYmpbJ2VuYWJsZWQnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnY29kZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5jb2RlKG9ialsnY29kZSddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdvcmRlcicgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5vcmRlcihvYmpbJ29yZGVyJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ2RhdGUnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuZGF0ZShvYmpbJ2RhdGUnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnbmFtZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5uYW1lKG9ialsnbmFtZSddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdyZW1hcmsnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYucmVtYXJrKG9ialsncmVtYXJrJ10pOw0KICAgICAgICANCiAgICAgICAgICAgIHNlbGYucmVtYXJrKCB1YmluYXNjaWkuYTJiX2Jhc2U2NChzZWxmLnJlbWFyaygpKSApOw0KICAgICAgICANCiAgICANCg0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIHJldHVybiBzZWxmOw0KICAgIA0KICAgIGRlZiBfdG9Eb2N1bWVudChzZWxmKToNCiAgICAgICAgcmV0ID0ge307DQogICAgICAgIGlmIHNlbGYuSWQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbIklkIl0gPSBzZWxmLklkOw0KDQogICAgDQogICAgICAgIGlmIHNlbGYuYWN0aXZlKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbImFjdGl2ZSJdID0gc2VsZi5hY3RpdmUoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYuZW5hYmxlZCgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJlbmFibGVkIl0gPSBzZWxmLmVuYWJsZWQoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYuY29kZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJjb2RlIl0gPSBzZWxmLmNvZGUoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYub3JkZXIoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsib3JkZXIiXSA9IHNlbGYub3JkZXIoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYuZGF0ZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJkYXRlIl0gPSBzZWxmLmRhdGUoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYubmFtZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJuYW1lIl0gPSBzZWxmLm5hbWUoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYucmVtYXJrKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbInJlbWFyayJdID0gc2VsZi5yZW1hcmsoKTsNCiAgICAgICAgDQogICAgICAgICAgICBpZiBpc2luc3RhbmNlKHJldFsicmVtYXJrIl0sIGRpY3QpOg0KICAgICAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSB1anNvbi5kdW1wcyhyZXRbInJlbWFyayJdKTsNCiAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSB1YmluYXNjaWkuYjJhX2Jhc2U2NChyZXRbInJlbWFyayJdKS5zdHJpcCgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgcmV0dXJuIHJldDsNCg0KICAgIA0KICAgIGRlZiBzdG9yZShzZWxmLCBfX2V2ZW50PU5vbmUpOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ0NvbmZpZ19Hcm91cDo6c3RvcmUoKTogJzsNCiAgICAgICAgDQogICAgICAgIGV2SlNPTiA9IE5vbmU7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIGV2SlNPTiA9IHVqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoNCiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7DQogICAgICAgIA0KDQogICAgICAgIGFuc3dlciA9IE5vbmU7DQoNCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpY2tzX21zKCkpKyddLkNvbmZpZ19Hcm91cC5zdG9yZSgpJykubWV0aG9kKCdzdG9yZScpLmNsYXNzTmFtZSgnQ29uZmlnX0dyb3VwJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOw0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsNCiAgICAgICAgDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQogICAgICAgIA0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgIGFuc3dlciA9IENvbmZpZ19Hcm91cCgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQogICAgICAgIA0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCg0KDQoNCiAgICAgICAgaWYgJ0NvbmZpZ19Hcm91cF9zdG9yZScgaW4gZGlyKCk6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJz09PiBDb25maWdfR3JvdXBfc3RvcmUoKScpOw0KICAgICAgICAgICAgYW5zd2VyID0gQ29uZmlnX0dyb3VwX3N0b3JlKHNlbGYsIF9fZXZlbnQsIGFuc3dlciwgX190b1N0cmluZyk7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KDQogICAgICAgICAgICANCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQoNCiAgICAgICAgcmV0dXJuIGFuc3dlcjsNCg0KICAgIA0KICAgIGRlZiBmaW5kQWxsKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6DQogICAgICAgIF9fdG9TdHJpbmcgPSAnQ29uZmlnX0dyb3VwOjpmaW5kQWxsKCk6ICc7DQogICAgICAgIA0KICAgICAgICBldkpTT04gPSBOb25lOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBldkpTT04gPSB1anNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046DQogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOw0KICAgICAgICANCg0KICAgICAgICBhbnN3ZXIgPSBOb25lOw0KDQogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aWNrc19tcygpKSsnXS5Db25maWdfR3JvdXAuZmluZEFsbCgpJykubWV0aG9kKCdmaW5kQWxsJykuY2xhc3NOYW1lKCdDb25maWdfR3JvdXAnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOw0KICAgICAgICANCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCiAgICAgICAgDQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgYW5zd2VyID0gQ29uZmlnX0dyb3VwKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCiAgICAgICAgDQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KDQoNCg0KICAgICAgICBpZiAnQ29uZmlnX0dyb3VwX2ZpbmRBbGwnIGluIGRpcigpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICc9PT4gQ29uZmlnX0dyb3VwX2ZpbmRBbGwoKScpOw0KICAgICAgICAgICAgYW5zd2VyID0gQ29uZmlnX0dyb3VwX2ZpbmRBbGwoc2VsZiwgX19ldmVudCwgYW5zd2VyLCBfX3RvU3RyaW5nKTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCg0KICAgICAgICByZXR1cm4gYW5zd2VyOw0KDQogICAgDQogICAgZGVmIGZpbmQoc2VsZiwgX19ldmVudD1Ob25lKToNCiAgICAgICAgX190b1N0cmluZyA9ICdDb25maWdfR3JvdXA6OmZpbmQoKTogJzsNCiAgICAgICAgDQogICAgICAgIGV2SlNPTiA9IE5vbmU7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIGV2SlNPTiA9IHVqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoNCiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7DQogICAgICAgIA0KDQogICAgICAgIGFuc3dlciA9IE5vbmU7DQoNCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpY2tzX21zKCkpKyddLkNvbmZpZ19Hcm91cC5maW5kKCknKS5tZXRob2QoJ2ZpbmQnKS5jbGFzc05hbWUoJ0NvbmZpZ19Hcm91cCcpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7DQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KICAgICAgICANCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICBhbnN3ZXIgPSBDb25maWdfR3JvdXAoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KICAgICAgICANCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQoNCg0KDQogICAgICAgIGlmICdDb25maWdfR3JvdXBfZmluZCcgaW4gZGlyKCk6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJz09PiBDb25maWdfR3JvdXBfZmluZCgpJyk7DQogICAgICAgICAgICBhbnN3ZXIgPSBDb25maWdfR3JvdXBfZmluZChzZWxmLCBfX2V2ZW50LCBhbnN3ZXIsIF9fdG9TdHJpbmcpOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCg0KICAgICAgICAgICAgDQogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KDQogICAgICAgIHJldHVybiBhbnN3ZXI7DQoNCiAgICANCg0KDQpjbGFzcyBNYXBwaW5nX0dyb3VwKCk6DQogICAgZGVmIF9faW5pdF9fKHNlbGYsIElkPU5vbmUsIGFjdGl2ZT1Ob25lLCBlbmFibGVkPU5vbmUsIGNvZGU9Tm9uZSwgb3JkZXI9Tm9uZSwgZGF0ZT1Ob25lLCBuYW1lPU5vbmUsIHJlbWFyaz1Ob25lKToNCiAgICAgICAgc3VwZXIoKS5fX2luaXRfXygpOw0KDQogICAgICAgICNwcmludCgnTWFwcGluZ19Hcm91cDo6X19pbml0X18oKScpOw0KICAgICAgICBpZiBJZCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHNlbGYuSWQgPSBJZDsNCg0KICAgICAgICANCiAgICAgICAgc2VsZi5hY3RpdmUoYWN0aXZlKTsNCiAgICAgICAgc2VsZi5lbmFibGVkKGVuYWJsZWQpOw0KICAgICAgICBzZWxmLmNvZGUoY29kZSk7DQogICAgICAgIHNlbGYub3JkZXIob3JkZXIpOw0KICAgICAgICBzZWxmLmRhdGUoZGF0ZSk7DQogICAgICAgIHNlbGYubmFtZShuYW1lKTsNCiAgICAgICAgc2VsZi5yZW1hcmsocmVtYXJrKTsNCiAgICAgICAgDQogICAgSWQgPSBOb25lOw0KICAgIA0KICAgIA0KICAgICMgYWN0aXZlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2FjdGl2ZSA9IE5vbmU7DQogICAgZGVmIGFjdGl2ZShzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9hY3RpdmUgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fYWN0aXZlOw0KDQoNCiAgICANCiAgICAjIGVuYWJsZWQ6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfZW5hYmxlZCA9IE5vbmU7DQogICAgZGVmIGVuYWJsZWQoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fZW5hYmxlZCA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9lbmFibGVkOw0KDQoNCiAgICANCiAgICAjIGNvZGU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfY29kZSA9IE5vbmU7DQogICAgZGVmIGNvZGUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fY29kZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9jb2RlOw0KDQoNCiAgICANCiAgICAjIG9yZGVyOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX29yZGVyID0gTm9uZTsNCiAgICBkZWYgb3JkZXIoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fb3JkZXIgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fb3JkZXI7DQoNCg0KICAgIA0KICAgICMgZGF0ZTogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9kYXRlID0gTm9uZTsNCiAgICBkZWYgZGF0ZShzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9kYXRlID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2RhdGU7DQoNCg0KICAgIA0KICAgICMgbmFtZTogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9uYW1lID0gTm9uZTsNCiAgICBkZWYgbmFtZShzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9uYW1lID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX25hbWU7DQoNCg0KICAgIA0KICAgICMgcmVtYXJrOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX3JlbWFyayA9IE5vbmU7DQogICAgZGVmIHJlbWFyayhzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9yZW1hcmsgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fcmVtYXJrOw0KDQoNCiAgICANCiAgICANCiAgICBkZWYgX2Zyb21Eb2N1bWVudChzZWxmLCBvYmopOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ01hcHBpbmdfR3JvdXA6Ol9mcm9tRG9jdW1lbnQoKTogJzsNCg0KICAgICAgICBpZiBvYmogaXMgTm9uZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICANCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIGJ5dGVzKToNCiAgICAgICAgICAgIG9iaiA9IHN0cihvYmosICJ1dGYtOCIpOw0KDQogICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLCBzdHIpIG9yIHR5cGUob2JqKSBpcyBzdHI6DQogICAgICAgICAgICBvYmogPSB1anNvbi5sb2FkcyhvYmopOw0KICAgICAgICANCiAgICAgICAgaWYgbm90IGlzaW5zdGFuY2Uob2JqLCAoc3RyLCBieXRlcywgZGljdCkpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICdHT1QgSEVSRTogJyArIHN0cih0eXBlKG9iaikpKTsNCiAgICAgICAgICAgIHJldHVybiBvYmo7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGZvciBpIGluIG9iajoNCiAgICAgICAgICAgICAgICBvYmpbaV0gPSBNYXBwaW5nX0dyb3VwKCkuX2Zyb21Eb2N1bWVudChvYmpbaV0pOw0KICAgICAgICAgICAgcmV0dXJuIG9iajsNCg0KDQogICAgICAgIGlmICdJZCcgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5JZCA9IG9ialsnSWQnXTsNCg0KICAgIA0KICAgICAgICBpZiAnYWN0aXZlJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmFjdGl2ZShvYmpbJ2FjdGl2ZSddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdlbmFibGVkJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmVuYWJsZWQob2JqWydlbmFibGVkJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ2NvZGUnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuY29kZShvYmpbJ2NvZGUnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnb3JkZXInIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYub3JkZXIob2JqWydvcmRlciddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdkYXRlJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmRhdGUob2JqWydkYXRlJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ25hbWUnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYubmFtZShvYmpbJ25hbWUnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAncmVtYXJrJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLnJlbWFyayhvYmpbJ3JlbWFyayddKTsNCiAgICAgICAgDQogICAgICAgICAgICBzZWxmLnJlbWFyayggdWJpbmFzY2lpLmEyYl9iYXNlNjQoc2VsZi5yZW1hcmsoKSkgKTsNCiAgICAgICAgDQogICAgDQoNCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICByZXR1cm4gc2VsZjsNCiAgICANCiAgICBkZWYgX3RvRG9jdW1lbnQoc2VsZik6DQogICAgICAgIHJldCA9IHt9Ow0KICAgICAgICBpZiBzZWxmLklkIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJJZCJdID0gc2VsZi5JZDsNCg0KICAgIA0KICAgICAgICBpZiBzZWxmLmFjdGl2ZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJhY3RpdmUiXSA9IHNlbGYuYWN0aXZlKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmVuYWJsZWQoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiZW5hYmxlZCJdID0gc2VsZi5lbmFibGVkKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmNvZGUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiY29kZSJdID0gc2VsZi5jb2RlKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLm9yZGVyKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbIm9yZGVyIl0gPSBzZWxmLm9yZGVyKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmRhdGUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiZGF0ZSJdID0gc2VsZi5kYXRlKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLm5hbWUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsibmFtZSJdID0gc2VsZi5uYW1lKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLnJlbWFyaygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IHNlbGYucmVtYXJrKCk7DQogICAgICAgIA0KICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShyZXRbInJlbWFyayJdLCBkaWN0KToNCiAgICAgICAgICAgICAgICByZXRbInJlbWFyayJdID0gdWpzb24uZHVtcHMocmV0WyJyZW1hcmsiXSk7DQogICAgICAgICAgICByZXRbInJlbWFyayJdID0gdWJpbmFzY2lpLmIyYV9iYXNlNjQocmV0WyJyZW1hcmsiXSkuc3RyaXAoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIHJldHVybiByZXQ7DQoNCiAgICANCiAgICBkZWYgc3RvcmUoc2VsZiwgX19ldmVudD1Ob25lKToNCiAgICAgICAgX190b1N0cmluZyA9ICdNYXBwaW5nX0dyb3VwOjpzdG9yZSgpOiAnOw0KICAgICAgICANCiAgICAgICAgZXZKU09OID0gTm9uZTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgZXZKU09OID0gdWpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOg0KICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsNCiAgICAgICAgDQoNCiAgICAgICAgYW5zd2VyID0gTm9uZTsNCg0KICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGlja3NfbXMoKSkrJ10uTWFwcGluZ19Hcm91cC5zdG9yZSgpJykubWV0aG9kKCdzdG9yZScpLmNsYXNzTmFtZSgnTWFwcGluZ19Hcm91cCcpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7DQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KICAgICAgICANCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICBhbnN3ZXIgPSBNYXBwaW5nX0dyb3VwKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCiAgICAgICAgDQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KDQoNCg0KICAgICAgICBpZiAnTWFwcGluZ19Hcm91cF9zdG9yZScgaW4gZGlyKCk6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJz09PiBNYXBwaW5nX0dyb3VwX3N0b3JlKCknKTsNCiAgICAgICAgICAgIGFuc3dlciA9IE1hcHBpbmdfR3JvdXBfc3RvcmUoc2VsZiwgX19ldmVudCwgYW5zd2VyLCBfX3RvU3RyaW5nKTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCg0KICAgICAgICByZXR1cm4gYW5zd2VyOw0KDQogICAgDQogICAgZGVmIGZpbmRBbGwoc2VsZiwgX19ldmVudD1Ob25lKToNCiAgICAgICAgX190b1N0cmluZyA9ICdNYXBwaW5nX0dyb3VwOjpmaW5kQWxsKCk6ICc7DQogICAgICAgIA0KICAgICAgICBldkpTT04gPSBOb25lOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBldkpTT04gPSB1anNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046DQogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOw0KICAgICAgICANCg0KICAgICAgICBhbnN3ZXIgPSBOb25lOw0KDQogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aWNrc19tcygpKSsnXS5NYXBwaW5nX0dyb3VwLmZpbmRBbGwoKScpLm1ldGhvZCgnZmluZEFsbCcpLmNsYXNzTmFtZSgnTWFwcGluZ19Hcm91cCcpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7DQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KICAgICAgICANCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICBhbnN3ZXIgPSBNYXBwaW5nX0dyb3VwKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCiAgICAgICAgDQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KDQoNCg0KICAgICAgICBpZiAnTWFwcGluZ19Hcm91cF9maW5kQWxsJyBpbiBkaXIoKToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnPT0+IE1hcHBpbmdfR3JvdXBfZmluZEFsbCgpJyk7DQogICAgICAgICAgICBhbnN3ZXIgPSBNYXBwaW5nX0dyb3VwX2ZpbmRBbGwoc2VsZiwgX19ldmVudCwgYW5zd2VyLCBfX3RvU3RyaW5nKTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCg0KICAgICAgICByZXR1cm4gYW5zd2VyOw0KDQogICAgDQogICAgZGVmIGZpbmQoc2VsZiwgX19ldmVudD1Ob25lKToNCiAgICAgICAgX190b1N0cmluZyA9ICdNYXBwaW5nX0dyb3VwOjpmaW5kKCk6ICc7DQogICAgICAgIA0KICAgICAgICBldkpTT04gPSBOb25lOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBldkpTT04gPSB1anNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046DQogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOw0KICAgICAgICANCg0KICAgICAgICBhbnN3ZXIgPSBOb25lOw0KDQogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aWNrc19tcygpKSsnXS5NYXBwaW5nX0dyb3VwLmZpbmQoKScpLm1ldGhvZCgnZmluZCcpLmNsYXNzTmFtZSgnTWFwcGluZ19Hcm91cCcpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7DQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KICAgICAgICANCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICBhbnN3ZXIgPSBNYXBwaW5nX0dyb3VwKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCiAgICAgICAgDQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KDQoNCg0KICAgICAgICBpZiAnTWFwcGluZ19Hcm91cF9maW5kJyBpbiBkaXIoKToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnPT0+IE1hcHBpbmdfR3JvdXBfZmluZCgpJyk7DQogICAgICAgICAgICBhbnN3ZXIgPSBNYXBwaW5nX0dyb3VwX2ZpbmQoc2VsZiwgX19ldmVudCwgYW5zd2VyLCBfX3RvU3RyaW5nKTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCg0KICAgICAgICByZXR1cm4gYW5zd2VyOw0KDQogICAgDQoNCg0KY2xhc3MgVG9vbF9UeXBlKCk6DQogICAgZGVmIF9faW5pdF9fKHNlbGYsIElkPU5vbmUsIGFjdGl2ZT1Ob25lLCBlbmFibGVkPU5vbmUsIGNvZGU9Tm9uZSwgb3JkZXI9Tm9uZSwgZGF0ZT1Ob25lLCBuYW1lPU5vbmUsIHJlbWFyaz1Ob25lKToNCiAgICAgICAgc3VwZXIoKS5fX2luaXRfXygpOw0KDQogICAgICAgICNwcmludCgnVG9vbF9UeXBlOjpfX2luaXRfXygpJyk7DQogICAgICAgIGlmIElkIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgc2VsZi5JZCA9IElkOw0KDQogICAgICAgIA0KICAgICAgICBzZWxmLmFjdGl2ZShhY3RpdmUpOw0KICAgICAgICBzZWxmLmVuYWJsZWQoZW5hYmxlZCk7DQogICAgICAgIHNlbGYuY29kZShjb2RlKTsNCiAgICAgICAgc2VsZi5vcmRlcihvcmRlcik7DQogICAgICAgIHNlbGYuZGF0ZShkYXRlKTsNCiAgICAgICAgc2VsZi5uYW1lKG5hbWUpOw0KICAgICAgICBzZWxmLnJlbWFyayhyZW1hcmspOw0KICAgICAgICANCiAgICBJZCA9IE5vbmU7DQogICAgDQogICAgDQogICAgIyBhY3RpdmU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfYWN0aXZlID0gTm9uZTsNCiAgICBkZWYgYWN0aXZlKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2FjdGl2ZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9hY3RpdmU7DQoNCg0KICAgIA0KICAgICMgZW5hYmxlZDogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9lbmFibGVkID0gTm9uZTsNCiAgICBkZWYgZW5hYmxlZChzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9lbmFibGVkID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2VuYWJsZWQ7DQoNCg0KICAgIA0KICAgICMgY29kZTogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9jb2RlID0gTm9uZTsNCiAgICBkZWYgY29kZShzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9jb2RlID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2NvZGU7DQoNCg0KICAgIA0KICAgICMgb3JkZXI6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfb3JkZXIgPSBOb25lOw0KICAgIGRlZiBvcmRlcihzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9vcmRlciA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9vcmRlcjsNCg0KDQogICAgDQogICAgIyBkYXRlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2RhdGUgPSBOb25lOw0KICAgIGRlZiBkYXRlKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2RhdGUgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fZGF0ZTsNCg0KDQogICAgDQogICAgIyBuYW1lOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX25hbWUgPSBOb25lOw0KICAgIGRlZiBuYW1lKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX25hbWUgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fbmFtZTsNCg0KDQogICAgDQogICAgIyByZW1hcms6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfcmVtYXJrID0gTm9uZTsNCiAgICBkZWYgcmVtYXJrKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX3JlbWFyayA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9yZW1hcms7DQoNCg0KICAgIA0KICAgIA0KICAgIGRlZiBfZnJvbURvY3VtZW50KHNlbGYsIG9iaik6DQogICAgICAgIF9fdG9TdHJpbmcgPSAnVG9vbF9UeXBlOjpfZnJvbURvY3VtZW50KCk6ICc7DQoNCiAgICAgICAgaWYgb2JqIGlzIE5vbmU6DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgDQogICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLCBieXRlcyk6DQogICAgICAgICAgICBvYmogPSBzdHIob2JqLCAidXRmLTgiKTsNCg0KICAgICAgICBpZiBpc2luc3RhbmNlKG9iaiwgc3RyKSBvciB0eXBlKG9iaikgaXMgc3RyOg0KICAgICAgICAgICAgb2JqID0gdWpzb24ubG9hZHMob2JqKTsNCiAgICAgICAgDQogICAgICAgIGlmIG5vdCBpc2luc3RhbmNlKG9iaiwgKHN0ciwgYnl0ZXMsIGRpY3QpKToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnR09UIEhFUkU6ICcgKyBzdHIodHlwZShvYmopKSk7DQogICAgICAgICAgICByZXR1cm4gb2JqOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBmb3IgaSBpbiBvYmo6DQogICAgICAgICAgICAgICAgb2JqW2ldID0gVG9vbF9UeXBlKCkuX2Zyb21Eb2N1bWVudChvYmpbaV0pOw0KICAgICAgICAgICAgcmV0dXJuIG9iajsNCg0KDQogICAgICAgIGlmICdJZCcgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5JZCA9IG9ialsnSWQnXTsNCg0KICAgIA0KICAgICAgICBpZiAnYWN0aXZlJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmFjdGl2ZShvYmpbJ2FjdGl2ZSddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdlbmFibGVkJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmVuYWJsZWQob2JqWydlbmFibGVkJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ2NvZGUnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuY29kZShvYmpbJ2NvZGUnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnb3JkZXInIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYub3JkZXIob2JqWydvcmRlciddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdkYXRlJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmRhdGUob2JqWydkYXRlJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ25hbWUnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYubmFtZShvYmpbJ25hbWUnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAncmVtYXJrJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLnJlbWFyayhvYmpbJ3JlbWFyayddKTsNCiAgICAgICAgDQogICAgICAgICAgICBzZWxmLnJlbWFyayggdWJpbmFzY2lpLmEyYl9iYXNlNjQoc2VsZi5yZW1hcmsoKSkgKTsNCiAgICAgICAgDQogICAgDQoNCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICByZXR1cm4gc2VsZjsNCiAgICANCiAgICBkZWYgX3RvRG9jdW1lbnQoc2VsZik6DQogICAgICAgIHJldCA9IHt9Ow0KICAgICAgICBpZiBzZWxmLklkIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJJZCJdID0gc2VsZi5JZDsNCg0KICAgIA0KICAgICAgICBpZiBzZWxmLmFjdGl2ZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJhY3RpdmUiXSA9IHNlbGYuYWN0aXZlKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmVuYWJsZWQoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiZW5hYmxlZCJdID0gc2VsZi5lbmFibGVkKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmNvZGUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiY29kZSJdID0gc2VsZi5jb2RlKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLm9yZGVyKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbIm9yZGVyIl0gPSBzZWxmLm9yZGVyKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmRhdGUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiZGF0ZSJdID0gc2VsZi5kYXRlKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLm5hbWUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsibmFtZSJdID0gc2VsZi5uYW1lKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLnJlbWFyaygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IHNlbGYucmVtYXJrKCk7DQogICAgICAgIA0KICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShyZXRbInJlbWFyayJdLCBkaWN0KToNCiAgICAgICAgICAgICAgICByZXRbInJlbWFyayJdID0gdWpzb24uZHVtcHMocmV0WyJyZW1hcmsiXSk7DQogICAgICAgICAgICByZXRbInJlbWFyayJdID0gdWJpbmFzY2lpLmIyYV9iYXNlNjQocmV0WyJyZW1hcmsiXSkuc3RyaXAoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIHJldHVybiByZXQ7DQoNCiAgICANCiAgICBkZWYgc3RvcmUoc2VsZiwgX19ldmVudD1Ob25lKToNCiAgICAgICAgX190b1N0cmluZyA9ICdUb29sX1R5cGU6OnN0b3JlKCk6ICc7DQogICAgICAgIA0KICAgICAgICBldkpTT04gPSBOb25lOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBldkpTT04gPSB1anNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046DQogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOw0KICAgICAgICANCg0KICAgICAgICBhbnN3ZXIgPSBOb25lOw0KDQogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aWNrc19tcygpKSsnXS5Ub29sX1R5cGUuc3RvcmUoKScpLm1ldGhvZCgnc3RvcmUnKS5jbGFzc05hbWUoJ1Rvb2xfVHlwZScpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7DQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KICAgICAgICANCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICBhbnN3ZXIgPSBUb29sX1R5cGUoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KICAgICAgICANCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQoNCg0KDQogICAgICAgIGlmICdUb29sX1R5cGVfc3RvcmUnIGluIGRpcigpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICc9PT4gVG9vbF9UeXBlX3N0b3JlKCknKTsNCiAgICAgICAgICAgIGFuc3dlciA9IFRvb2xfVHlwZV9zdG9yZShzZWxmLCBfX2V2ZW50LCBhbnN3ZXIsIF9fdG9TdHJpbmcpOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCg0KICAgICAgICAgICAgDQogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KDQogICAgICAgIHJldHVybiBhbnN3ZXI7DQoNCiAgICANCiAgICBkZWYgZmluZEFsbChzZWxmLCBfX2V2ZW50PU5vbmUpOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ1Rvb2xfVHlwZTo6ZmluZEFsbCgpOiAnOw0KICAgICAgICANCiAgICAgICAgZXZKU09OID0gTm9uZTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgZXZKU09OID0gdWpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOg0KICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsNCiAgICAgICAgDQoNCiAgICAgICAgYW5zd2VyID0gTm9uZTsNCg0KICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGlja3NfbXMoKSkrJ10uVG9vbF9UeXBlLmZpbmRBbGwoKScpLm1ldGhvZCgnZmluZEFsbCcpLmNsYXNzTmFtZSgnVG9vbF9UeXBlJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOw0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsNCiAgICAgICAgDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQogICAgICAgIA0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgIGFuc3dlciA9IFRvb2xfVHlwZSgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQogICAgICAgIA0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCg0KDQoNCiAgICAgICAgaWYgJ1Rvb2xfVHlwZV9maW5kQWxsJyBpbiBkaXIoKToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnPT0+IFRvb2xfVHlwZV9maW5kQWxsKCknKTsNCiAgICAgICAgICAgIGFuc3dlciA9IFRvb2xfVHlwZV9maW5kQWxsKHNlbGYsIF9fZXZlbnQsIGFuc3dlciwgX190b1N0cmluZyk7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KDQogICAgICAgICAgICANCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQoNCiAgICAgICAgcmV0dXJuIGFuc3dlcjsNCg0KICAgIA0KICAgIGRlZiBmaW5kKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6DQogICAgICAgIF9fdG9TdHJpbmcgPSAnVG9vbF9UeXBlOjpmaW5kKCk6ICc7DQogICAgICAgIA0KICAgICAgICBldkpTT04gPSBOb25lOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBldkpTT04gPSB1anNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046DQogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOw0KICAgICAgICANCg0KICAgICAgICBhbnN3ZXIgPSBOb25lOw0KDQogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aWNrc19tcygpKSsnXS5Ub29sX1R5cGUuZmluZCgpJykubWV0aG9kKCdmaW5kJykuY2xhc3NOYW1lKCdUb29sX1R5cGUnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOw0KICAgICAgICANCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCiAgICAgICAgDQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgYW5zd2VyID0gVG9vbF9UeXBlKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCiAgICAgICAgDQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KDQoNCg0KICAgICAgICBpZiAnVG9vbF9UeXBlX2ZpbmQnIGluIGRpcigpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICc9PT4gVG9vbF9UeXBlX2ZpbmQoKScpOw0KICAgICAgICAgICAgYW5zd2VyID0gVG9vbF9UeXBlX2ZpbmQoc2VsZiwgX19ldmVudCwgYW5zd2VyLCBfX3RvU3RyaW5nKTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCg0KICAgICAgICByZXR1cm4gYW5zd2VyOw0KDQogICAgDQoNCg0KY2xhc3MgRXZlbnQoKToNCiAgICBkZWYgX19pbml0X18oc2VsZiwgSWQ9Tm9uZSwgYWN0aXZlPU5vbmUsIGVuYWJsZWQ9Tm9uZSwgY29kZT1Ob25lLCBvcmRlcj1Ob25lLCBkYXRlPU5vbmUsIG5hbWU9Tm9uZSwgcmVtYXJrPU5vbmUsIGNsYXNzTmFtZT1Ob25lLCBtZXRob2Q9Tm9uZSwgcGF5bG9hZD1Ob25lLCBjYXJyaWVyPU5vbmUsIHNlbmRlcj1Ob25lLCByZWNpcGllbnQ9Tm9uZSwgcmVzcG9uc2VUbz1Ob25lKToNCiAgICAgICAgc3VwZXIoKS5fX2luaXRfXygpOw0KDQogICAgICAgICNwcmludCgnRXZlbnQ6Ol9faW5pdF9fKCknKTsNCiAgICAgICAgaWYgSWQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBzZWxmLklkID0gSWQ7DQoNCiAgICAgICAgDQogICAgICAgIHNlbGYuYWN0aXZlKGFjdGl2ZSk7DQogICAgICAgIHNlbGYuZW5hYmxlZChlbmFibGVkKTsNCiAgICAgICAgc2VsZi5jb2RlKGNvZGUpOw0KICAgICAgICBzZWxmLm9yZGVyKG9yZGVyKTsNCiAgICAgICAgc2VsZi5kYXRlKGRhdGUpOw0KICAgICAgICBzZWxmLm5hbWUobmFtZSk7DQogICAgICAgIHNlbGYucmVtYXJrKHJlbWFyayk7DQogICAgICAgIHNlbGYuY2xhc3NOYW1lKGNsYXNzTmFtZSk7DQogICAgICAgIHNlbGYubWV0aG9kKG1ldGhvZCk7DQogICAgICAgIHNlbGYucGF5bG9hZChwYXlsb2FkKTsNCiAgICAgICAgc2VsZi5jYXJyaWVyKGNhcnJpZXIpOw0KICAgICAgICBzZWxmLnNlbmRlcihzZW5kZXIpOw0KICAgICAgICBzZWxmLnJlY2lwaWVudChyZWNpcGllbnQpOw0KICAgICAgICBzZWxmLnJlc3BvbnNlVG8ocmVzcG9uc2VUbyk7DQogICAgICAgIA0KICAgIElkID0gTm9uZTsNCiAgICANCiAgICANCiAgICAjIGFjdGl2ZTogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9hY3RpdmUgPSBOb25lOw0KICAgIGRlZiBhY3RpdmUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fYWN0aXZlID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2FjdGl2ZTsNCg0KDQogICAgDQogICAgIyBlbmFibGVkOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2VuYWJsZWQgPSBOb25lOw0KICAgIGRlZiBlbmFibGVkKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2VuYWJsZWQgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fZW5hYmxlZDsNCg0KDQogICAgDQogICAgIyBjb2RlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2NvZGUgPSBOb25lOw0KICAgIGRlZiBjb2RlKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2NvZGUgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fY29kZTsNCg0KDQogICAgDQogICAgIyBvcmRlcjogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9vcmRlciA9IE5vbmU7DQogICAgZGVmIG9yZGVyKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX29yZGVyID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX29yZGVyOw0KDQoNCiAgICANCiAgICAjIGRhdGU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfZGF0ZSA9IE5vbmU7DQogICAgZGVmIGRhdGUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fZGF0ZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9kYXRlOw0KDQoNCiAgICANCiAgICAjIG5hbWU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfbmFtZSA9IE5vbmU7DQogICAgZGVmIG5hbWUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fbmFtZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9uYW1lOw0KDQoNCiAgICANCiAgICAjIHJlbWFyazogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9yZW1hcmsgPSBOb25lOw0KICAgIGRlZiByZW1hcmsoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fcmVtYXJrID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3JlbWFyazsNCg0KDQogICAgDQogICAgIyBjbGFzc05hbWU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfY2xhc3NOYW1lID0gTm9uZTsNCiAgICBkZWYgY2xhc3NOYW1lKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2NsYXNzTmFtZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9jbGFzc05hbWU7DQoNCg0KICAgIA0KICAgICMgbWV0aG9kOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX21ldGhvZCA9IE5vbmU7DQogICAgZGVmIG1ldGhvZChzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9tZXRob2QgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fbWV0aG9kOw0KDQoNCiAgICANCiAgICAjIHBheWxvYWQ6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfcGF5bG9hZCA9IE5vbmU7DQogICAgZGVmIHBheWxvYWQoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fcGF5bG9hZCA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9wYXlsb2FkOw0KDQoNCiAgICANCiAgICAjIGNhcnJpZXI6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfY2FycmllciA9IE5vbmU7DQogICAgZGVmIGNhcnJpZXIoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fY2FycmllciA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9jYXJyaWVyOw0KDQoNCiAgICANCiAgICAjIHNlbmRlcjogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9zZW5kZXIgPSBOb25lOw0KICAgIGRlZiBzZW5kZXIoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fc2VuZGVyID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3NlbmRlcjsNCg0KDQogICAgDQogICAgIyByZWNpcGllbnQ6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfcmVjaXBpZW50ID0gTm9uZTsNCiAgICBkZWYgcmVjaXBpZW50KHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX3JlY2lwaWVudCA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9yZWNpcGllbnQ7DQoNCg0KICAgIA0KICAgICMgcmVzcG9uc2VUbzogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9yZXNwb25zZVRvID0gTm9uZTsNCiAgICBkZWYgcmVzcG9uc2VUbyhzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9yZXNwb25zZVRvID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3Jlc3BvbnNlVG87DQoNCg0KICAgIA0KICAgIA0KICAgIGRlZiBfZnJvbURvY3VtZW50KHNlbGYsIG9iaik6DQogICAgICAgIF9fdG9TdHJpbmcgPSAnRXZlbnQ6Ol9mcm9tRG9jdW1lbnQoKTogJzsNCg0KICAgICAgICBpZiBvYmogaXMgTm9uZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICANCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIGJ5dGVzKToNCiAgICAgICAgICAgIG9iaiA9IHN0cihvYmosICJ1dGYtOCIpOw0KDQogICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLCBzdHIpIG9yIHR5cGUob2JqKSBpcyBzdHI6DQogICAgICAgICAgICBvYmogPSB1anNvbi5sb2FkcyhvYmopOw0KICAgICAgICANCiAgICAgICAgaWYgbm90IGlzaW5zdGFuY2Uob2JqLCAoc3RyLCBieXRlcywgZGljdCkpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICdHT1QgSEVSRTogJyArIHN0cih0eXBlKG9iaikpKTsNCiAgICAgICAgICAgIHJldHVybiBvYmo7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGZvciBpIGluIG9iajoNCiAgICAgICAgICAgICAgICBvYmpbaV0gPSBFdmVudCgpLl9mcm9tRG9jdW1lbnQob2JqW2ldKTsNCiAgICAgICAgICAgIHJldHVybiBvYmo7DQoNCg0KICAgICAgICBpZiAnSWQnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuSWQgPSBvYmpbJ0lkJ107DQoNCiAgICANCiAgICAgICAgaWYgJ2FjdGl2ZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5hY3RpdmUob2JqWydhY3RpdmUnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnZW5hYmxlZCcgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5lbmFibGVkKG9ialsnZW5hYmxlZCddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdjb2RlJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmNvZGUob2JqWydjb2RlJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ29yZGVyJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLm9yZGVyKG9ialsnb3JkZXInXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnZGF0ZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5kYXRlKG9ialsnZGF0ZSddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICduYW1lJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLm5hbWUob2JqWyduYW1lJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ3JlbWFyaycgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5yZW1hcmsob2JqWydyZW1hcmsnXSk7DQogICAgICAgIA0KICAgICAgICAgICAgc2VsZi5yZW1hcmsoIHViaW5hc2NpaS5hMmJfYmFzZTY0KHNlbGYucmVtYXJrKCkpICk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnY2xhc3NOYW1lJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmNsYXNzTmFtZShvYmpbJ2NsYXNzTmFtZSddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdtZXRob2QnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYubWV0aG9kKG9ialsnbWV0aG9kJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ3BheWxvYWQnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYucGF5bG9hZChvYmpbJ3BheWxvYWQnXSk7DQogICAgICAgIA0KICAgICAgICAgICAgc2VsZi5wYXlsb2FkKCB1YmluYXNjaWkuYTJiX2Jhc2U2NChzZWxmLnBheWxvYWQoKSkgKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdjYXJyaWVyJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmNhcnJpZXIoTm9kZSgpLl9mcm9tRG9jdW1lbnQob2JqWydjYXJyaWVyJ10pKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdzZW5kZXInIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuc2VuZGVyKE5vZGUoKS5fZnJvbURvY3VtZW50KG9ialsnc2VuZGVyJ10pKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdyZWNpcGllbnQnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYucmVjaXBpZW50KE5vZGUoKS5fZnJvbURvY3VtZW50KG9ialsncmVjaXBpZW50J10pKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdyZXNwb25zZVRvJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLnJlc3BvbnNlVG8oRXZlbnQoKS5fZnJvbURvY3VtZW50KG9ialsncmVzcG9uc2VUbyddKSk7DQogICAgICAgIA0KICAgIA0KDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgDQogICAgZGVmIF90b0RvY3VtZW50KHNlbGYpOg0KICAgICAgICByZXQgPSB7fTsNCiAgICAgICAgaWYgc2VsZi5JZCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiSWQiXSA9IHNlbGYuSWQ7DQoNCiAgICANCiAgICAgICAgaWYgc2VsZi5hY3RpdmUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiYWN0aXZlIl0gPSBzZWxmLmFjdGl2ZSgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5lbmFibGVkKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbImVuYWJsZWQiXSA9IHNlbGYuZW5hYmxlZCgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5jb2RlKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbImNvZGUiXSA9IHNlbGYuY29kZSgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5vcmRlcigpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJvcmRlciJdID0gc2VsZi5vcmRlcigpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5kYXRlKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbImRhdGUiXSA9IHNlbGYuZGF0ZSgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5uYW1lKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbIm5hbWUiXSA9IHNlbGYubmFtZSgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5yZW1hcmsoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSBzZWxmLnJlbWFyaygpOw0KICAgICAgICANCiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UocmV0WyJyZW1hcmsiXSwgZGljdCk6DQogICAgICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IHVqc29uLmR1bXBzKHJldFsicmVtYXJrIl0pOw0KICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IHViaW5hc2NpaS5iMmFfYmFzZTY0KHJldFsicmVtYXJrIl0pLnN0cmlwKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmNsYXNzTmFtZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJjbGFzc05hbWUiXSA9IHNlbGYuY2xhc3NOYW1lKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLm1ldGhvZCgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJtZXRob2QiXSA9IHNlbGYubWV0aG9kKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLnBheWxvYWQoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsicGF5bG9hZCJdID0gc2VsZi5wYXlsb2FkKCk7DQogICAgICAgIA0KICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShyZXRbInBheWxvYWQiXSwgZGljdCk6DQogICAgICAgICAgICAgICAgcmV0WyJwYXlsb2FkIl0gPSB1anNvbi5kdW1wcyhyZXRbInBheWxvYWQiXSk7DQogICAgICAgICAgICByZXRbInBheWxvYWQiXSA9IHViaW5hc2NpaS5iMmFfYmFzZTY0KHJldFsicGF5bG9hZCJdKS5zdHJpcCgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5jYXJyaWVyKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbImNhcnJpZXIiXSA9IHNlbGYuY2FycmllcigpLl90b0RvY3VtZW50KCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLnNlbmRlcigpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJzZW5kZXIiXSA9IHNlbGYuc2VuZGVyKCkuX3RvRG9jdW1lbnQoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYucmVjaXBpZW50KCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbInJlY2lwaWVudCJdID0gc2VsZi5yZWNpcGllbnQoKS5fdG9Eb2N1bWVudCgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbInJlc3BvbnNlVG8iXSA9IHNlbGYucmVzcG9uc2VUbygpLl90b0RvY3VtZW50KCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICANCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICByZXR1cm4gcmV0Ow0KDQogICAgDQogICAgZGVmIHN0b3JlKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6DQogICAgICAgIF9fdG9TdHJpbmcgPSAnRXZlbnQ6OnN0b3JlKCk6ICc7DQogICAgICAgIA0KICAgICAgICBldkpTT04gPSBOb25lOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBldkpTT04gPSB1anNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046DQogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOw0KICAgICAgICANCg0KICAgICAgICBhbnN3ZXIgPSBOb25lOw0KDQogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aWNrc19tcygpKSsnXS5FdmVudC5zdG9yZSgpJykubWV0aG9kKCdzdG9yZScpLmNsYXNzTmFtZSgnRXZlbnQnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOw0KICAgICAgICANCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCiAgICAgICAgDQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgYW5zd2VyID0gRXZlbnQoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KICAgICAgICANCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQoNCg0KDQogICAgICAgIGlmICdFdmVudF9zdG9yZScgaW4gZGlyKCk6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJz09PiBFdmVudF9zdG9yZSgpJyk7DQogICAgICAgICAgICBhbnN3ZXIgPSBFdmVudF9zdG9yZShzZWxmLCBfX2V2ZW50LCBhbnN3ZXIsIF9fdG9TdHJpbmcpOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCg0KICAgICAgICAgICAgDQogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KDQogICAgICAgIHJldHVybiBhbnN3ZXI7DQoNCiAgICANCiAgICBkZWYgZmluZEFsbChzZWxmLCBfX2V2ZW50PU5vbmUpOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ0V2ZW50OjpmaW5kQWxsKCk6ICc7DQogICAgICAgIA0KICAgICAgICBldkpTT04gPSBOb25lOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBldkpTT04gPSB1anNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046DQogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOw0KICAgICAgICANCg0KICAgICAgICBhbnN3ZXIgPSBOb25lOw0KDQogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aWNrc19tcygpKSsnXS5FdmVudC5maW5kQWxsKCknKS5tZXRob2QoJ2ZpbmRBbGwnKS5jbGFzc05hbWUoJ0V2ZW50JykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOw0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsNCiAgICAgICAgDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQogICAgICAgIA0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgIGFuc3dlciA9IEV2ZW50KCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCiAgICAgICAgDQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KDQoNCg0KICAgICAgICBpZiAnRXZlbnRfZmluZEFsbCcgaW4gZGlyKCk6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJz09PiBFdmVudF9maW5kQWxsKCknKTsNCiAgICAgICAgICAgIGFuc3dlciA9IEV2ZW50X2ZpbmRBbGwoc2VsZiwgX19ldmVudCwgYW5zd2VyLCBfX3RvU3RyaW5nKTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCg0KICAgICAgICByZXR1cm4gYW5zd2VyOw0KDQogICAgDQogICAgZGVmIGZpbmQoc2VsZiwgX19ldmVudD1Ob25lKToNCiAgICAgICAgX190b1N0cmluZyA9ICdFdmVudDo6ZmluZCgpOiAnOw0KICAgICAgICANCiAgICAgICAgZXZKU09OID0gTm9uZTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgZXZKU09OID0gdWpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOg0KICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsNCiAgICAgICAgDQoNCiAgICAgICAgYW5zd2VyID0gTm9uZTsNCg0KICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGlja3NfbXMoKSkrJ10uRXZlbnQuZmluZCgpJykubWV0aG9kKCdmaW5kJykuY2xhc3NOYW1lKCdFdmVudCcpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7DQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KICAgICAgICANCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICBhbnN3ZXIgPSBFdmVudCgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQogICAgICAgIA0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCg0KDQoNCiAgICAgICAgaWYgJ0V2ZW50X2ZpbmQnIGluIGRpcigpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICc9PT4gRXZlbnRfZmluZCgpJyk7DQogICAgICAgICAgICBhbnN3ZXIgPSBFdmVudF9maW5kKHNlbGYsIF9fZXZlbnQsIGFuc3dlciwgX190b1N0cmluZyk7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KDQogICAgICAgICAgICANCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQoNCiAgICAgICAgcmV0dXJuIGFuc3dlcjsNCg0KICAgIA0KICAgIGRlZiBsaXN0ZW4oc2VsZiwgX19ldmVudD1Ob25lLCBub2RlPU5vbmUpOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ0V2ZW50OjpsaXN0ZW4oKTogJzsNCiAgICAgICAgDQogICAgICAgIGV2SlNPTiA9IE5vbmU7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIGV2SlNPTiA9IHVqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoNCiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7DQogICAgICAgIA0KICAgICAgICAgICAgaWYgJ25vZGUnIGluIGV2SlNPTjoNCiAgICAgICAgICAgICAgICBub2RlID0gZXZKU09OWydub2RlJ107DQogICAgICAgIA0KDQogICAgICAgIGFuc3dlciA9IE5vbmU7DQoNCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpY2tzX21zKCkpKyddLkV2ZW50Lmxpc3RlbigpJykubWV0aG9kKCdsaXN0ZW4nKS5jbGFzc05hbWUoJ0V2ZW50JykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOw0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsNCiAgICAgICAgDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQogICAgICAgIA0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgIGFuc3dlciA9IGV2SlNPTjsNCiAgICAgICAgDQogICAgICAgIA0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCg0KDQoNCiAgICAgICAgaWYgJ0V2ZW50X2xpc3RlbicgaW4gZGlyKCk6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJz09PiBFdmVudF9saXN0ZW4oKScpOw0KICAgICAgICAgICAgYW5zd2VyID0gRXZlbnRfbGlzdGVuKHNlbGYsIF9fZXZlbnQsIGFuc3dlciwgX190b1N0cmluZyk7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoc3RyKGFuc3dlcikpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KDQogICAgICAgICAgICANCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQoNCiAgICAgICAgcmV0dXJuIGFuc3dlcjsNCg0KICAgIA0KICAgIGRlZiB0cmlnZ2VyKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6DQogICAgICAgIF9fdG9TdHJpbmcgPSAnRXZlbnQ6OnRyaWdnZXIoKTogJzsNCiAgICAgICAgDQogICAgICAgIGV2SlNPTiA9IE5vbmU7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIGV2SlNPTiA9IHVqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoNCiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7DQogICAgICAgIA0KDQogICAgICAgIGFuc3dlciA9IE5vbmU7DQoNCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpY2tzX21zKCkpKyddLkV2ZW50LnRyaWdnZXIoKScpLm1ldGhvZCgndHJpZ2dlcicpLmNsYXNzTmFtZSgnRXZlbnQnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOw0KICAgICAgICANCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCiAgICAgICAgDQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgYW5zd2VyID0gZXZKU09OOw0KICAgICAgICANCiAgICAgICAgDQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KCiAgICAgICAgICAgIHJldHVybiBtcXR0X2NsaWVudC5wdWJsaXNoKG1xdHRfdG9waWMsIHVqc29uLmR1bXBzKHNlbGYuX3RvRG9jdW1lbnQoKSkpOwoJCQ0KDQoNCiAgICAgICAgaWYgJ0V2ZW50X3RyaWdnZXInIGluIGRpcigpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICc9PT4gRXZlbnRfdHJpZ2dlcigpJyk7DQogICAgICAgICAgICBhbnN3ZXIgPSBFdmVudF90cmlnZ2VyKHNlbGYsIF9fZXZlbnQsIGFuc3dlciwgX190b1N0cmluZyk7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoc3RyKGFuc3dlcikpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KDQogICAgICAgICAgICANCg0KICAgICAgICByZXR1cm4gYW5zd2VyOw0KDQogICAgDQogICAgZGVmIHByb2Nlc3Moc2VsZiwgX19ldmVudD1Ob25lKToNCiAgICAgICAgX190b1N0cmluZyA9ICdFdmVudDo6cHJvY2VzcygpOiAnOw0KICAgICAgICANCiAgICAgICAgZXZKU09OID0gTm9uZTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgZXZKU09OID0gdWpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOg0KICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsNCiAgICAgICAgDQoNCiAgICAgICAgYW5zd2VyID0gTm9uZTsNCg0KICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGlja3NfbXMoKSkrJ10uRXZlbnQucHJvY2VzcygpJykubWV0aG9kKCdwcm9jZXNzJykuY2xhc3NOYW1lKCdFdmVudCcpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7DQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KICAgICAgICANCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICBhbnN3ZXIgPSBFdmVudCgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQogICAgICAgIA0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCgogICAgICAgICAgICBpZiBzZWxmLnNlbmRlcigpLmNvZGUoKT09bm9kZS5jb2RlKCk6CiAgICAgICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImlnbm9yaW5nIG15IGV2ZW50cyIpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICBlbGlmIHNlbGYucmVjaXBpZW50KCkuY29kZSgpIT1ub2RlLmNvZGUoKToKICAgICAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAibm90IHNlbnQgdG8gbWUiKTsKICAgICAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgICAgIHJldHVybiBnZXRhdHRyKGdsb2JhbHMoKVtzZWxmLmNsYXNzTmFtZSgpXSgpLCBzZWxmLm1ldGhvZCgpKSgpOwoJCQ0KDQoNCiAgICAgICAgaWYgJ0V2ZW50X3Byb2Nlc3MnIGluIGRpcigpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICc9PT4gRXZlbnRfcHJvY2VzcygpJyk7DQogICAgICAgICAgICBhbnN3ZXIgPSBFdmVudF9wcm9jZXNzKHNlbGYsIF9fZXZlbnQsIGFuc3dlciwgX190b1N0cmluZyk7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KDQogICAgICAgICAgICANCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQoNCiAgICAgICAgcmV0dXJuIGFuc3dlcjsNCg0KICAgIA0KDQoNCmNsYXNzIE5vZGUoKToNCiAgICBkZWYgX19pbml0X18oc2VsZiwgSWQ9Tm9uZSwgYWN0aXZlPU5vbmUsIGVuYWJsZWQ9Tm9uZSwgY29kZT1Ob25lLCBvcmRlcj1Ob25lLCBkYXRlPU5vbmUsIG5hbWU9Tm9uZSwgcmVtYXJrPU5vbmUsIGFkZHJlc3M9Tm9uZSwgYmFja3VwPU5vbmUsIHBhcmVudD1Ob25lLCBncm91cD1Ob25lLCBjb250ZXh0PU5vbmUsIHBvcnQ9Tm9uZSwgb25saW5lPU5vbmUsIHNlY3VyZT1Ob25lLCB0eXBlPU5vbmUpOg0KICAgICAgICBzdXBlcigpLl9faW5pdF9fKCk7DQoNCiAgICAgICAgI3ByaW50KCdOb2RlOjpfX2luaXRfXygpJyk7DQogICAgICAgIGlmIElkIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgc2VsZi5JZCA9IElkOw0KDQogICAgICAgIA0KICAgICAgICBzZWxmLmFjdGl2ZShhY3RpdmUpOw0KICAgICAgICBzZWxmLmVuYWJsZWQoZW5hYmxlZCk7DQogICAgICAgIHNlbGYuY29kZShjb2RlKTsNCiAgICAgICAgc2VsZi5vcmRlcihvcmRlcik7DQogICAgICAgIHNlbGYuZGF0ZShkYXRlKTsNCiAgICAgICAgc2VsZi5uYW1lKG5hbWUpOw0KICAgICAgICBzZWxmLnJlbWFyayhyZW1hcmspOw0KICAgICAgICBzZWxmLmFkZHJlc3MoYWRkcmVzcyk7DQogICAgICAgIHNlbGYuYmFja3VwKGJhY2t1cCk7DQogICAgICAgIHNlbGYucGFyZW50KHBhcmVudCk7DQogICAgICAgIHNlbGYuZ3JvdXAoZ3JvdXApOw0KICAgICAgICBzZWxmLmNvbnRleHQoY29udGV4dCk7DQogICAgICAgIHNlbGYucG9ydChwb3J0KTsNCiAgICAgICAgc2VsZi5vbmxpbmUob25saW5lKTsNCiAgICAgICAgc2VsZi5zZWN1cmUoc2VjdXJlKTsNCiAgICAgICAgc2VsZi50eXBlKHR5cGUpOw0KICAgICAgICANCiAgICBJZCA9IE5vbmU7DQogICAgDQogICAgDQogICAgIyBhY3RpdmU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfYWN0aXZlID0gTm9uZTsNCiAgICBkZWYgYWN0aXZlKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2FjdGl2ZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9hY3RpdmU7DQoNCg0KICAgIA0KICAgICMgZW5hYmxlZDogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9lbmFibGVkID0gTm9uZTsNCiAgICBkZWYgZW5hYmxlZChzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9lbmFibGVkID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2VuYWJsZWQ7DQoNCg0KICAgIA0KICAgICMgY29kZTogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9jb2RlID0gTm9uZTsNCiAgICBkZWYgY29kZShzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9jb2RlID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2NvZGU7DQoNCg0KICAgIA0KICAgICMgb3JkZXI6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfb3JkZXIgPSBOb25lOw0KICAgIGRlZiBvcmRlcihzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9vcmRlciA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9vcmRlcjsNCg0KDQogICAgDQogICAgIyBkYXRlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2RhdGUgPSBOb25lOw0KICAgIGRlZiBkYXRlKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2RhdGUgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fZGF0ZTsNCg0KDQogICAgDQogICAgIyBuYW1lOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX25hbWUgPSBOb25lOw0KICAgIGRlZiBuYW1lKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX25hbWUgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fbmFtZTsNCg0KDQogICAgDQogICAgIyByZW1hcms6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfcmVtYXJrID0gTm9uZTsNCiAgICBkZWYgcmVtYXJrKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX3JlbWFyayA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9yZW1hcms7DQoNCg0KICAgIA0KICAgICMgYWRkcmVzczogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9hZGRyZXNzID0gTm9uZTsNCiAgICBkZWYgYWRkcmVzcyhzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9hZGRyZXNzID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2FkZHJlc3M7DQoNCg0KICAgIA0KICAgICMgYmFja3VwOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2JhY2t1cCA9IE5vbmU7DQogICAgZGVmIGJhY2t1cChzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9iYWNrdXAgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fYmFja3VwOw0KDQoNCiAgICANCiAgICAjIHBhcmVudDogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9wYXJlbnQgPSBOb25lOw0KICAgIGRlZiBwYXJlbnQoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fcGFyZW50ID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3BhcmVudDsNCg0KDQogICAgDQogICAgIyBncm91cDogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9ncm91cCA9IE5vbmU7DQogICAgZGVmIGdyb3VwKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2dyb3VwID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2dyb3VwOw0KDQoNCiAgICANCiAgICAjIGNvbnRleHQ6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfY29udGV4dCA9IE5vbmU7DQogICAgZGVmIGNvbnRleHQoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fY29udGV4dCA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9jb250ZXh0Ow0KDQoNCiAgICANCiAgICAjIHBvcnQ6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfcG9ydCA9IE5vbmU7DQogICAgZGVmIHBvcnQoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fcG9ydCA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9wb3J0Ow0KDQoNCiAgICANCiAgICAjIG9ubGluZTogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9vbmxpbmUgPSBOb25lOw0KICAgIGRlZiBvbmxpbmUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fb25saW5lID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX29ubGluZTsNCg0KDQogICAgDQogICAgIyBzZWN1cmU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfc2VjdXJlID0gTm9uZTsNCiAgICBkZWYgc2VjdXJlKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX3NlY3VyZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9zZWN1cmU7DQoNCg0KICAgIA0KICAgICMgdHlwZTogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF90eXBlID0gTm9uZTsNCiAgICBkZWYgdHlwZShzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl90eXBlID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3R5cGU7DQoNCg0KICAgIA0KICAgIA0KICAgIGRlZiBfZnJvbURvY3VtZW50KHNlbGYsIG9iaik6DQogICAgICAgIF9fdG9TdHJpbmcgPSAnTm9kZTo6X2Zyb21Eb2N1bWVudCgpOiAnOw0KDQogICAgICAgIGlmIG9iaiBpcyBOb25lOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIA0KICAgICAgICBpZiBpc2luc3RhbmNlKG9iaiwgYnl0ZXMpOg0KICAgICAgICAgICAgb2JqID0gc3RyKG9iaiwgInV0Zi04Iik7DQoNCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIHN0cikgb3IgdHlwZShvYmopIGlzIHN0cjoNCiAgICAgICAgICAgIG9iaiA9IHVqc29uLmxvYWRzKG9iaik7DQogICAgICAgIA0KICAgICAgICBpZiBub3QgaXNpbnN0YW5jZShvYmosIChzdHIsIGJ5dGVzLCBkaWN0KSk6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJ0dPVCBIRVJFOiAnICsgc3RyKHR5cGUob2JqKSkpOw0KICAgICAgICAgICAgcmV0dXJuIG9iajsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZm9yIGkgaW4gb2JqOg0KICAgICAgICAgICAgICAgIG9ialtpXSA9IE5vZGUoKS5fZnJvbURvY3VtZW50KG9ialtpXSk7DQogICAgICAgICAgICByZXR1cm4gb2JqOw0KDQoNCiAgICAgICAgaWYgJ0lkJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLklkID0gb2JqWydJZCddOw0KDQogICAgDQogICAgICAgIGlmICdhY3RpdmUnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuYWN0aXZlKG9ialsnYWN0aXZlJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ2VuYWJsZWQnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuZW5hYmxlZChvYmpbJ2VuYWJsZWQnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnY29kZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5jb2RlKG9ialsnY29kZSddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdvcmRlcicgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5vcmRlcihvYmpbJ29yZGVyJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ2RhdGUnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuZGF0ZShvYmpbJ2RhdGUnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnbmFtZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5uYW1lKG9ialsnbmFtZSddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdyZW1hcmsnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYucmVtYXJrKG9ialsncmVtYXJrJ10pOw0KICAgICAgICANCiAgICAgICAgICAgIHNlbGYucmVtYXJrKCB1YmluYXNjaWkuYTJiX2Jhc2U2NChzZWxmLnJlbWFyaygpKSApOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ2FkZHJlc3MnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuYWRkcmVzcyhvYmpbJ2FkZHJlc3MnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnYmFja3VwJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmJhY2t1cChOb2RlKCkuX2Zyb21Eb2N1bWVudChvYmpbJ2JhY2t1cCddKSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAncGFyZW50JyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLnBhcmVudChOb2RlKCkuX2Zyb21Eb2N1bWVudChvYmpbJ3BhcmVudCddKSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnZ3JvdXAnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuZ3JvdXAoTm9kZV9Hcm91cCgpLl9mcm9tRG9jdW1lbnQob2JqWydncm91cCddKSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnY29udGV4dCcgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5jb250ZXh0KE5vZGVfQ29udGV4dCgpLl9mcm9tRG9jdW1lbnQob2JqWydjb250ZXh0J10pKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdwb3J0JyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLnBvcnQob2JqWydwb3J0J10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ29ubGluZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5vbmxpbmUob2JqWydvbmxpbmUnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnc2VjdXJlJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLnNlY3VyZShvYmpbJ3NlY3VyZSddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICd0eXBlJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLnR5cGUoTm9kZV9UeXBlKCkuX2Zyb21Eb2N1bWVudChvYmpbJ3R5cGUnXSkpOw0KICAgICAgICANCiAgICANCg0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIHJldHVybiBzZWxmOw0KICAgIA0KICAgIGRlZiBfdG9Eb2N1bWVudChzZWxmKToNCiAgICAgICAgcmV0ID0ge307DQogICAgICAgIGlmIHNlbGYuSWQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbIklkIl0gPSBzZWxmLklkOw0KDQogICAgDQogICAgICAgIGlmIHNlbGYuYWN0aXZlKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbImFjdGl2ZSJdID0gc2VsZi5hY3RpdmUoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYuZW5hYmxlZCgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJlbmFibGVkIl0gPSBzZWxmLmVuYWJsZWQoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYuY29kZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJjb2RlIl0gPSBzZWxmLmNvZGUoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYub3JkZXIoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsib3JkZXIiXSA9IHNlbGYub3JkZXIoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYuZGF0ZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJkYXRlIl0gPSBzZWxmLmRhdGUoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYubmFtZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJuYW1lIl0gPSBzZWxmLm5hbWUoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYucmVtYXJrKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbInJlbWFyayJdID0gc2VsZi5yZW1hcmsoKTsNCiAgICAgICAgDQogICAgICAgICAgICBpZiBpc2luc3RhbmNlKHJldFsicmVtYXJrIl0sIGRpY3QpOg0KICAgICAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSB1anNvbi5kdW1wcyhyZXRbInJlbWFyayJdKTsNCiAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSB1YmluYXNjaWkuYjJhX2Jhc2U2NChyZXRbInJlbWFyayJdKS5zdHJpcCgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5hZGRyZXNzKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbImFkZHJlc3MiXSA9IHNlbGYuYWRkcmVzcygpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5iYWNrdXAoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiYmFja3VwIl0gPSBzZWxmLmJhY2t1cCgpLl90b0RvY3VtZW50KCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLnBhcmVudCgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJwYXJlbnQiXSA9IHNlbGYucGFyZW50KCkuX3RvRG9jdW1lbnQoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYuZ3JvdXAoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiZ3JvdXAiXSA9IHNlbGYuZ3JvdXAoKS5fdG9Eb2N1bWVudCgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5jb250ZXh0KCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbImNvbnRleHQiXSA9IHNlbGYuY29udGV4dCgpLl90b0RvY3VtZW50KCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLnBvcnQoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsicG9ydCJdID0gc2VsZi5wb3J0KCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLm9ubGluZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJvbmxpbmUiXSA9IHNlbGYub25saW5lKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLnNlY3VyZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJzZWN1cmUiXSA9IHNlbGYuc2VjdXJlKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLnR5cGUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsidHlwZSJdID0gc2VsZi50eXBlKCkuX3RvRG9jdW1lbnQoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIHJldHVybiByZXQ7DQoNCiAgICANCiAgICBkZWYgc3RvcmUoc2VsZiwgX19ldmVudD1Ob25lKToNCiAgICAgICAgX190b1N0cmluZyA9ICdOb2RlOjpzdG9yZSgpOiAnOw0KICAgICAgICANCiAgICAgICAgZXZKU09OID0gTm9uZTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgZXZKU09OID0gdWpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOg0KICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsNCiAgICAgICAgDQoNCiAgICAgICAgYW5zd2VyID0gTm9uZTsNCg0KICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGlja3NfbXMoKSkrJ10uTm9kZS5zdG9yZSgpJykubWV0aG9kKCdzdG9yZScpLmNsYXNzTmFtZSgnTm9kZScpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7DQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KICAgICAgICANCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICBhbnN3ZXIgPSBOb2RlKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCiAgICAgICAgCiAgICAgICAgDQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KDQoNCg0KICAgICAgICBpZiAnTm9kZV9zdG9yZScgaW4gZGlyKCk6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJz09PiBOb2RlX3N0b3JlKCknKTsNCiAgICAgICAgICAgIGFuc3dlciA9IE5vZGVfc3RvcmUoc2VsZiwgX19ldmVudCwgYW5zd2VyLCBfX3RvU3RyaW5nKTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCg0KICAgICAgICByZXR1cm4gYW5zd2VyOw0KDQogICAgDQogICAgZGVmIGZpbmRBbGwoc2VsZiwgX19ldmVudD1Ob25lKToNCiAgICAgICAgX190b1N0cmluZyA9ICdOb2RlOjpmaW5kQWxsKCk6ICc7DQogICAgICAgIA0KICAgICAgICBldkpTT04gPSBOb25lOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBldkpTT04gPSB1anNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046DQogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOw0KICAgICAgICANCg0KICAgICAgICBhbnN3ZXIgPSBOb25lOw0KDQogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aWNrc19tcygpKSsnXS5Ob2RlLmZpbmRBbGwoKScpLm1ldGhvZCgnZmluZEFsbCcpLmNsYXNzTmFtZSgnTm9kZScpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7DQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KICAgICAgICANCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICBhbnN3ZXIgPSBOb2RlKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCiAgICAgICAgDQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KDQoNCg0KICAgICAgICBpZiAnTm9kZV9maW5kQWxsJyBpbiBkaXIoKToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnPT0+IE5vZGVfZmluZEFsbCgpJyk7DQogICAgICAgICAgICBhbnN3ZXIgPSBOb2RlX2ZpbmRBbGwoc2VsZiwgX19ldmVudCwgYW5zd2VyLCBfX3RvU3RyaW5nKTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCg0KICAgICAgICByZXR1cm4gYW5zd2VyOw0KDQogICAgDQogICAgZGVmIGZpbmQoc2VsZiwgX19ldmVudD1Ob25lKToNCiAgICAgICAgX190b1N0cmluZyA9ICdOb2RlOjpmaW5kKCk6ICc7DQogICAgICAgIA0KICAgICAgICBldkpTT04gPSBOb25lOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBldkpTT04gPSB1anNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046DQogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOw0KICAgICAgICANCg0KICAgICAgICBhbnN3ZXIgPSBOb25lOw0KDQogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aWNrc19tcygpKSsnXS5Ob2RlLmZpbmQoKScpLm1ldGhvZCgnZmluZCcpLmNsYXNzTmFtZSgnTm9kZScpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7DQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KICAgICAgICANCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICBhbnN3ZXIgPSBOb2RlKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCiAgICAgICAgDQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KDQoNCg0KICAgICAgICBpZiAnTm9kZV9maW5kJyBpbiBkaXIoKToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnPT0+IE5vZGVfZmluZCgpJyk7DQogICAgICAgICAgICBhbnN3ZXIgPSBOb2RlX2ZpbmQoc2VsZiwgX19ldmVudCwgYW5zd2VyLCBfX3RvU3RyaW5nKTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCg0KICAgICAgICByZXR1cm4gYW5zd2VyOw0KDQogICAgDQogICAgZGVmIGF1dGhDb2RlKHNlbGYsIF9fZXZlbnQ9Tm9uZSwgY29kZT1Ob25lLCB0b29sPU5vbmUpOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ05vZGU6OmF1dGhDb2RlKCk6ICc7DQogICAgICAgIA0KICAgICAgICBldkpTT04gPSBOb25lOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBldkpTT04gPSB1anNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046DQogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOw0KICAgICAgICANCiAgICAgICAgICAgIGlmICdjb2RlJyBpbiBldkpTT046DQogICAgICAgICAgICAgICAgY29kZSA9IGV2SlNPTlsnY29kZSddOw0KICAgICAgICANCiAgICAgICAgICAgIGlmICd0b29sJyBpbiBldkpTT046DQogICAgICAgICAgICAgICAgdG9vbCA9IGV2SlNPTlsndG9vbCddOw0KICAgICAgICANCg0KICAgICAgICBhbnN3ZXIgPSBOb25lOw0KDQogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aWNrc19tcygpKSsnXS5Ob2RlLmF1dGhDb2RlKCknKS5tZXRob2QoJ2F1dGhDb2RlJykuY2xhc3NOYW1lKCdOb2RlJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOw0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsNCiAgICAgICAgDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQogICAgICAgIA0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgIGFuc3dlciA9IGV2SlNPTjsNCiAgICAgICAgDQogICAgICAgIA0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCg0KDQoNCiAgICAgICAgaWYgJ05vZGVfYXV0aENvZGUnIGluIGRpcigpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICc9PT4gTm9kZV9hdXRoQ29kZSgpJyk7DQogICAgICAgICAgICBhbnN3ZXIgPSBOb2RlX2F1dGhDb2RlKHNlbGYsIF9fZXZlbnQsIGFuc3dlciwgX190b1N0cmluZyk7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoc3RyKGFuc3dlcikpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KDQogICAgICAgICAgICANCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQoNCiAgICAgICAgcmV0dXJuIGFuc3dlcjsNCg0KICAgIA0KICAgIGRlZiBpbml0KHNlbGYsIF9fZXZlbnQ9Tm9uZSwgb25saW5lPU5vbmUsIGNvZGU9Tm9uZSwgdWlkPU5vbmUpOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ05vZGU6OmluaXQoKTogJzsNCiAgICAgICAgDQogICAgICAgIGV2SlNPTiA9IE5vbmU7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIGV2SlNPTiA9IHVqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoNCiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7DQogICAgICAgIA0KICAgICAgICAgICAgaWYgJ29ubGluZScgaW4gZXZKU09OOg0KICAgICAgICAgICAgICAgIG9ubGluZSA9IGV2SlNPTlsnb25saW5lJ107DQogICAgICAgIA0KICAgICAgICAgICAgaWYgJ2NvZGUnIGluIGV2SlNPTjoNCiAgICAgICAgICAgICAgICBjb2RlID0gZXZKU09OWydjb2RlJ107DQogICAgICAgIA0KICAgICAgICAgICAgaWYgJ3VpZCcgaW4gZXZKU09OOg0KICAgICAgICAgICAgICAgIHVpZCA9IGV2SlNPTlsndWlkJ107DQogICAgICAgIA0KDQogICAgICAgIGFuc3dlciA9IE5vbmU7DQoNCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpY2tzX21zKCkpKyddLk5vZGUuaW5pdCgpJykubWV0aG9kKCdpbml0JykuY2xhc3NOYW1lKCdOb2RlJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOw0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsNCiAgICAgICAgDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQogICAgICAgIA0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgIGFuc3dlciA9IE5vZGUoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KICAgICAgICANCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQoNCg0KDQogICAgICAgIGlmICdOb2RlX2luaXQnIGluIGRpcigpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICc9PT4gTm9kZV9pbml0KCknKTsNCiAgICAgICAgICAgIGFuc3dlciA9IE5vZGVfaW5pdChzZWxmLCBfX2V2ZW50LCBhbnN3ZXIsIF9fdG9TdHJpbmcpOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCg0KICAgICAgICAgICAgDQogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KDQogICAgICAgIHJldHVybiBhbnN3ZXI7DQoNCiAgICANCiAgICBkZWYgcmVzdGFydChzZWxmLCBfX2V2ZW50PU5vbmUpOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ05vZGU6OnJlc3RhcnQoKTogJzsNCiAgICAgICAgDQogICAgICAgIGV2SlNPTiA9IE5vbmU7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIGV2SlNPTiA9IHVqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoNCiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7DQogICAgICAgIA0KDQogICAgICAgIGFuc3dlciA9IE5vbmU7DQoNCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpY2tzX21zKCkpKyddLk5vZGUucmVzdGFydCgpJykubWV0aG9kKCdyZXN0YXJ0JykuY2xhc3NOYW1lKCdOb2RlJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOw0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsNCiAgICAgICAgDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQogICAgICAgIA0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgIGFuc3dlciA9IGV2SlNPTjsNCiAgICAgICAgDQogICAgICAgIA0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCg0KDQoNCiAgICAgICAgaWYgJ05vZGVfcmVzdGFydCcgaW4gZGlyKCk6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJz09PiBOb2RlX3Jlc3RhcnQoKScpOw0KICAgICAgICAgICAgYW5zd2VyID0gTm9kZV9yZXN0YXJ0KHNlbGYsIF9fZXZlbnQsIGFuc3dlciwgX190b1N0cmluZyk7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoc3RyKGFuc3dlcikpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KDQogICAgICAgICAgICANCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQoNCiAgICAgICAgcmV0dXJuIGFuc3dlcjsNCg0KICAgIA0KICAgIGRlZiBzdGF0dXMoc2VsZiwgX19ldmVudD1Ob25lKToNCiAgICAgICAgX190b1N0cmluZyA9ICdOb2RlOjpzdGF0dXMoKTogJzsNCiAgICAgICAgDQogICAgICAgIGV2SlNPTiA9IE5vbmU7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIGV2SlNPTiA9IHVqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoNCiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7DQogICAgICAgIA0KDQogICAgICAgIGFuc3dlciA9IE5vbmU7DQoNCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpY2tzX21zKCkpKyddLk5vZGUuc3RhdHVzKCknKS5tZXRob2QoJ3N0YXR1cycpLmNsYXNzTmFtZSgnTm9kZScpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7DQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KICAgICAgICANCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICBhbnN3ZXIgPSBldkpTT047DQogICAgICAgIA0KICAgICAgICANCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQoNCg0KDQogICAgICAgIGlmICdOb2RlX3N0YXR1cycgaW4gZGlyKCk6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJz09PiBOb2RlX3N0YXR1cygpJyk7DQogICAgICAgICAgICBhbnN3ZXIgPSBOb2RlX3N0YXR1cyhzZWxmLCBfX2V2ZW50LCBhbnN3ZXIsIF9fdG9TdHJpbmcpOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHN0cihhbnN3ZXIpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCg0KICAgICAgICAgICAgDQogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KDQogICAgICAgIHJldHVybiBhbnN3ZXI7DQoNCiAgICANCg0KDQpjbGFzcyBOb2RlX0NvbnRleHQoKToNCiAgICBkZWYgX19pbml0X18oc2VsZiwgSWQ9Tm9uZSwgYWN0aXZlPU5vbmUsIGVuYWJsZWQ9Tm9uZSwgY29kZT1Ob25lLCBvcmRlcj1Ob25lLCBkYXRlPU5vbmUsIG5hbWU9Tm9uZSwgcmVtYXJrPU5vbmUpOg0KICAgICAgICBzdXBlcigpLl9faW5pdF9fKCk7DQoNCiAgICAgICAgI3ByaW50KCdOb2RlX0NvbnRleHQ6Ol9faW5pdF9fKCknKTsNCiAgICAgICAgaWYgSWQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBzZWxmLklkID0gSWQ7DQoNCiAgICAgICAgDQogICAgICAgIHNlbGYuYWN0aXZlKGFjdGl2ZSk7DQogICAgICAgIHNlbGYuZW5hYmxlZChlbmFibGVkKTsNCiAgICAgICAgc2VsZi5jb2RlKGNvZGUpOw0KICAgICAgICBzZWxmLm9yZGVyKG9yZGVyKTsNCiAgICAgICAgc2VsZi5kYXRlKGRhdGUpOw0KICAgICAgICBzZWxmLm5hbWUobmFtZSk7DQogICAgICAgIHNlbGYucmVtYXJrKHJlbWFyayk7DQogICAgICAgIA0KICAgIElkID0gTm9uZTsNCiAgICANCiAgICANCiAgICAjIGFjdGl2ZTogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9hY3RpdmUgPSBOb25lOw0KICAgIGRlZiBhY3RpdmUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fYWN0aXZlID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2FjdGl2ZTsNCg0KDQogICAgDQogICAgIyBlbmFibGVkOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2VuYWJsZWQgPSBOb25lOw0KICAgIGRlZiBlbmFibGVkKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2VuYWJsZWQgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fZW5hYmxlZDsNCg0KDQogICAgDQogICAgIyBjb2RlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2NvZGUgPSBOb25lOw0KICAgIGRlZiBjb2RlKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2NvZGUgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fY29kZTsNCg0KDQogICAgDQogICAgIyBvcmRlcjogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9vcmRlciA9IE5vbmU7DQogICAgZGVmIG9yZGVyKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX29yZGVyID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX29yZGVyOw0KDQoNCiAgICANCiAgICAjIGRhdGU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfZGF0ZSA9IE5vbmU7DQogICAgZGVmIGRhdGUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fZGF0ZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9kYXRlOw0KDQoNCiAgICANCiAgICAjIG5hbWU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfbmFtZSA9IE5vbmU7DQogICAgZGVmIG5hbWUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fbmFtZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9uYW1lOw0KDQoNCiAgICANCiAgICAjIHJlbWFyazogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9yZW1hcmsgPSBOb25lOw0KICAgIGRlZiByZW1hcmsoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fcmVtYXJrID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3JlbWFyazsNCg0KDQogICAgDQogICAgDQogICAgZGVmIF9mcm9tRG9jdW1lbnQoc2VsZiwgb2JqKToNCiAgICAgICAgX190b1N0cmluZyA9ICdOb2RlX0NvbnRleHQ6Ol9mcm9tRG9jdW1lbnQoKTogJzsNCg0KICAgICAgICBpZiBvYmogaXMgTm9uZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICANCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIGJ5dGVzKToNCiAgICAgICAgICAgIG9iaiA9IHN0cihvYmosICJ1dGYtOCIpOw0KDQogICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLCBzdHIpIG9yIHR5cGUob2JqKSBpcyBzdHI6DQogICAgICAgICAgICBvYmogPSB1anNvbi5sb2FkcyhvYmopOw0KICAgICAgICANCiAgICAgICAgaWYgbm90IGlzaW5zdGFuY2Uob2JqLCAoc3RyLCBieXRlcywgZGljdCkpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICdHT1QgSEVSRTogJyArIHN0cih0eXBlKG9iaikpKTsNCiAgICAgICAgICAgIHJldHVybiBvYmo7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGZvciBpIGluIG9iajoNCiAgICAgICAgICAgICAgICBvYmpbaV0gPSBOb2RlX0NvbnRleHQoKS5fZnJvbURvY3VtZW50KG9ialtpXSk7DQogICAgICAgICAgICByZXR1cm4gb2JqOw0KDQoNCiAgICAgICAgaWYgJ0lkJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLklkID0gb2JqWydJZCddOw0KDQogICAgDQogICAgICAgIGlmICdhY3RpdmUnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuYWN0aXZlKG9ialsnYWN0aXZlJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ2VuYWJsZWQnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuZW5hYmxlZChvYmpbJ2VuYWJsZWQnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnY29kZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5jb2RlKG9ialsnY29kZSddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdvcmRlcicgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5vcmRlcihvYmpbJ29yZGVyJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ2RhdGUnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuZGF0ZShvYmpbJ2RhdGUnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnbmFtZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5uYW1lKG9ialsnbmFtZSddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdyZW1hcmsnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYucmVtYXJrKG9ialsncmVtYXJrJ10pOw0KICAgICAgICANCiAgICAgICAgICAgIHNlbGYucmVtYXJrKCB1YmluYXNjaWkuYTJiX2Jhc2U2NChzZWxmLnJlbWFyaygpKSApOw0KICAgICAgICANCiAgICANCg0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIHJldHVybiBzZWxmOw0KICAgIA0KICAgIGRlZiBfdG9Eb2N1bWVudChzZWxmKToNCiAgICAgICAgcmV0ID0ge307DQogICAgICAgIGlmIHNlbGYuSWQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbIklkIl0gPSBzZWxmLklkOw0KDQogICAgDQogICAgICAgIGlmIHNlbGYuYWN0aXZlKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbImFjdGl2ZSJdID0gc2VsZi5hY3RpdmUoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYuZW5hYmxlZCgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJlbmFibGVkIl0gPSBzZWxmLmVuYWJsZWQoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYuY29kZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJjb2RlIl0gPSBzZWxmLmNvZGUoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYub3JkZXIoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsib3JkZXIiXSA9IHNlbGYub3JkZXIoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYuZGF0ZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJkYXRlIl0gPSBzZWxmLmRhdGUoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYubmFtZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJuYW1lIl0gPSBzZWxmLm5hbWUoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYucmVtYXJrKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbInJlbWFyayJdID0gc2VsZi5yZW1hcmsoKTsNCiAgICAgICAgDQogICAgICAgICAgICBpZiBpc2luc3RhbmNlKHJldFsicmVtYXJrIl0sIGRpY3QpOg0KICAgICAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSB1anNvbi5kdW1wcyhyZXRbInJlbWFyayJdKTsNCiAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSB1YmluYXNjaWkuYjJhX2Jhc2U2NChyZXRbInJlbWFyayJdKS5zdHJpcCgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgcmV0dXJuIHJldDsNCg0KICAgIA0KICAgIGRlZiBzdG9yZShzZWxmLCBfX2V2ZW50PU5vbmUpOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ05vZGVfQ29udGV4dDo6c3RvcmUoKTogJzsNCiAgICAgICAgDQogICAgICAgIGV2SlNPTiA9IE5vbmU7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIGV2SlNPTiA9IHVqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoNCiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7DQogICAgICAgIA0KDQogICAgICAgIGFuc3dlciA9IE5vbmU7DQoNCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpY2tzX21zKCkpKyddLk5vZGVfQ29udGV4dC5zdG9yZSgpJykubWV0aG9kKCdzdG9yZScpLmNsYXNzTmFtZSgnTm9kZV9Db250ZXh0JykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOw0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsNCiAgICAgICAgDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQogICAgICAgIA0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgIGFuc3dlciA9IE5vZGVfQ29udGV4dCgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQogICAgICAgIA0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCg0KDQoNCiAgICAgICAgaWYgJ05vZGVfQ29udGV4dF9zdG9yZScgaW4gZGlyKCk6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJz09PiBOb2RlX0NvbnRleHRfc3RvcmUoKScpOw0KICAgICAgICAgICAgYW5zd2VyID0gTm9kZV9Db250ZXh0X3N0b3JlKHNlbGYsIF9fZXZlbnQsIGFuc3dlciwgX190b1N0cmluZyk7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KDQogICAgICAgICAgICANCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQoNCiAgICAgICAgcmV0dXJuIGFuc3dlcjsNCg0KICAgIA0KICAgIGRlZiBmaW5kQWxsKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6DQogICAgICAgIF9fdG9TdHJpbmcgPSAnTm9kZV9Db250ZXh0OjpmaW5kQWxsKCk6ICc7DQogICAgICAgIA0KICAgICAgICBldkpTT04gPSBOb25lOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBldkpTT04gPSB1anNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046DQogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOw0KICAgICAgICANCg0KICAgICAgICBhbnN3ZXIgPSBOb25lOw0KDQogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aWNrc19tcygpKSsnXS5Ob2RlX0NvbnRleHQuZmluZEFsbCgpJykubWV0aG9kKCdmaW5kQWxsJykuY2xhc3NOYW1lKCdOb2RlX0NvbnRleHQnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOw0KICAgICAgICANCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCiAgICAgICAgDQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgYW5zd2VyID0gTm9kZV9Db250ZXh0KCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCiAgICAgICAgDQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KDQoNCg0KICAgICAgICBpZiAnTm9kZV9Db250ZXh0X2ZpbmRBbGwnIGluIGRpcigpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICc9PT4gTm9kZV9Db250ZXh0X2ZpbmRBbGwoKScpOw0KICAgICAgICAgICAgYW5zd2VyID0gTm9kZV9Db250ZXh0X2ZpbmRBbGwoc2VsZiwgX19ldmVudCwgYW5zd2VyLCBfX3RvU3RyaW5nKTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCg0KICAgICAgICByZXR1cm4gYW5zd2VyOw0KDQogICAgDQogICAgZGVmIGZpbmQoc2VsZiwgX19ldmVudD1Ob25lKToNCiAgICAgICAgX190b1N0cmluZyA9ICdOb2RlX0NvbnRleHQ6OmZpbmQoKTogJzsNCiAgICAgICAgDQogICAgICAgIGV2SlNPTiA9IE5vbmU7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIGV2SlNPTiA9IHVqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoNCiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7DQogICAgICAgIA0KDQogICAgICAgIGFuc3dlciA9IE5vbmU7DQoNCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpY2tzX21zKCkpKyddLk5vZGVfQ29udGV4dC5maW5kKCknKS5tZXRob2QoJ2ZpbmQnKS5jbGFzc05hbWUoJ05vZGVfQ29udGV4dCcpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7DQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KICAgICAgICANCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICBhbnN3ZXIgPSBOb2RlX0NvbnRleHQoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KICAgICAgICANCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQoNCg0KDQogICAgICAgIGlmICdOb2RlX0NvbnRleHRfZmluZCcgaW4gZGlyKCk6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJz09PiBOb2RlX0NvbnRleHRfZmluZCgpJyk7DQogICAgICAgICAgICBhbnN3ZXIgPSBOb2RlX0NvbnRleHRfZmluZChzZWxmLCBfX2V2ZW50LCBhbnN3ZXIsIF9fdG9TdHJpbmcpOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCg0KICAgICAgICAgICAgDQogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KDQogICAgICAgIHJldHVybiBhbnN3ZXI7DQoNCiAgICANCg0KDQpjbGFzcyBOb2RlX0dyb3VwKCk6DQogICAgZGVmIF9faW5pdF9fKHNlbGYsIElkPU5vbmUsIGFjdGl2ZT1Ob25lLCBlbmFibGVkPU5vbmUsIGNvZGU9Tm9uZSwgb3JkZXI9Tm9uZSwgZGF0ZT1Ob25lLCBuYW1lPU5vbmUsIHJlbWFyaz1Ob25lKToNCiAgICAgICAgc3VwZXIoKS5fX2luaXRfXygpOw0KDQogICAgICAgICNwcmludCgnTm9kZV9Hcm91cDo6X19pbml0X18oKScpOw0KICAgICAgICBpZiBJZCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHNlbGYuSWQgPSBJZDsNCg0KICAgICAgICANCiAgICAgICAgc2VsZi5hY3RpdmUoYWN0aXZlKTsNCiAgICAgICAgc2VsZi5lbmFibGVkKGVuYWJsZWQpOw0KICAgICAgICBzZWxmLmNvZGUoY29kZSk7DQogICAgICAgIHNlbGYub3JkZXIob3JkZXIpOw0KICAgICAgICBzZWxmLmRhdGUoZGF0ZSk7DQogICAgICAgIHNlbGYubmFtZShuYW1lKTsNCiAgICAgICAgc2VsZi5yZW1hcmsocmVtYXJrKTsNCiAgICAgICAgDQogICAgSWQgPSBOb25lOw0KICAgIA0KICAgIA0KICAgICMgYWN0aXZlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2FjdGl2ZSA9IE5vbmU7DQogICAgZGVmIGFjdGl2ZShzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9hY3RpdmUgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fYWN0aXZlOw0KDQoNCiAgICANCiAgICAjIGVuYWJsZWQ6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfZW5hYmxlZCA9IE5vbmU7DQogICAgZGVmIGVuYWJsZWQoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fZW5hYmxlZCA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9lbmFibGVkOw0KDQoNCiAgICANCiAgICAjIGNvZGU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfY29kZSA9IE5vbmU7DQogICAgZGVmIGNvZGUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fY29kZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9jb2RlOw0KDQoNCiAgICANCiAgICAjIG9yZGVyOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX29yZGVyID0gTm9uZTsNCiAgICBkZWYgb3JkZXIoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fb3JkZXIgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fb3JkZXI7DQoNCg0KICAgIA0KICAgICMgZGF0ZTogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9kYXRlID0gTm9uZTsNCiAgICBkZWYgZGF0ZShzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9kYXRlID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2RhdGU7DQoNCg0KICAgIA0KICAgICMgbmFtZTogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9uYW1lID0gTm9uZTsNCiAgICBkZWYgbmFtZShzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9uYW1lID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX25hbWU7DQoNCg0KICAgIA0KICAgICMgcmVtYXJrOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX3JlbWFyayA9IE5vbmU7DQogICAgZGVmIHJlbWFyayhzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9yZW1hcmsgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fcmVtYXJrOw0KDQoNCiAgICANCiAgICANCiAgICBkZWYgX2Zyb21Eb2N1bWVudChzZWxmLCBvYmopOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ05vZGVfR3JvdXA6Ol9mcm9tRG9jdW1lbnQoKTogJzsNCg0KICAgICAgICBpZiBvYmogaXMgTm9uZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICANCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIGJ5dGVzKToNCiAgICAgICAgICAgIG9iaiA9IHN0cihvYmosICJ1dGYtOCIpOw0KDQogICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLCBzdHIpIG9yIHR5cGUob2JqKSBpcyBzdHI6DQogICAgICAgICAgICBvYmogPSB1anNvbi5sb2FkcyhvYmopOw0KICAgICAgICANCiAgICAgICAgaWYgbm90IGlzaW5zdGFuY2Uob2JqLCAoc3RyLCBieXRlcywgZGljdCkpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICdHT1QgSEVSRTogJyArIHN0cih0eXBlKG9iaikpKTsNCiAgICAgICAgICAgIHJldHVybiBvYmo7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGZvciBpIGluIG9iajoNCiAgICAgICAgICAgICAgICBvYmpbaV0gPSBOb2RlX0dyb3VwKCkuX2Zyb21Eb2N1bWVudChvYmpbaV0pOw0KICAgICAgICAgICAgcmV0dXJuIG9iajsNCg0KDQogICAgICAgIGlmICdJZCcgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5JZCA9IG9ialsnSWQnXTsNCg0KICAgIA0KICAgICAgICBpZiAnYWN0aXZlJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmFjdGl2ZShvYmpbJ2FjdGl2ZSddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdlbmFibGVkJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmVuYWJsZWQob2JqWydlbmFibGVkJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ2NvZGUnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuY29kZShvYmpbJ2NvZGUnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnb3JkZXInIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYub3JkZXIob2JqWydvcmRlciddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdkYXRlJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmRhdGUob2JqWydkYXRlJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ25hbWUnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYubmFtZShvYmpbJ25hbWUnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAncmVtYXJrJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLnJlbWFyayhvYmpbJ3JlbWFyayddKTsNCiAgICAgICAgDQogICAgICAgICAgICBzZWxmLnJlbWFyayggdWJpbmFzY2lpLmEyYl9iYXNlNjQoc2VsZi5yZW1hcmsoKSkgKTsNCiAgICAgICAgDQogICAgDQoNCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICByZXR1cm4gc2VsZjsNCiAgICANCiAgICBkZWYgX3RvRG9jdW1lbnQoc2VsZik6DQogICAgICAgIHJldCA9IHt9Ow0KICAgICAgICBpZiBzZWxmLklkIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJJZCJdID0gc2VsZi5JZDsNCg0KICAgIA0KICAgICAgICBpZiBzZWxmLmFjdGl2ZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJhY3RpdmUiXSA9IHNlbGYuYWN0aXZlKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmVuYWJsZWQoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiZW5hYmxlZCJdID0gc2VsZi5lbmFibGVkKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmNvZGUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiY29kZSJdID0gc2VsZi5jb2RlKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLm9yZGVyKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbIm9yZGVyIl0gPSBzZWxmLm9yZGVyKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmRhdGUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiZGF0ZSJdID0gc2VsZi5kYXRlKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLm5hbWUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsibmFtZSJdID0gc2VsZi5uYW1lKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLnJlbWFyaygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IHNlbGYucmVtYXJrKCk7DQogICAgICAgIA0KICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShyZXRbInJlbWFyayJdLCBkaWN0KToNCiAgICAgICAgICAgICAgICByZXRbInJlbWFyayJdID0gdWpzb24uZHVtcHMocmV0WyJyZW1hcmsiXSk7DQogICAgICAgICAgICByZXRbInJlbWFyayJdID0gdWJpbmFzY2lpLmIyYV9iYXNlNjQocmV0WyJyZW1hcmsiXSkuc3RyaXAoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIHJldHVybiByZXQ7DQoNCiAgICANCiAgICBkZWYgc3RvcmUoc2VsZiwgX19ldmVudD1Ob25lKToNCiAgICAgICAgX190b1N0cmluZyA9ICdOb2RlX0dyb3VwOjpzdG9yZSgpOiAnOw0KICAgICAgICANCiAgICAgICAgZXZKU09OID0gTm9uZTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgZXZKU09OID0gdWpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOg0KICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsNCiAgICAgICAgDQoNCiAgICAgICAgYW5zd2VyID0gTm9uZTsNCg0KICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGlja3NfbXMoKSkrJ10uTm9kZV9Hcm91cC5zdG9yZSgpJykubWV0aG9kKCdzdG9yZScpLmNsYXNzTmFtZSgnTm9kZV9Hcm91cCcpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7DQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KICAgICAgICANCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICBhbnN3ZXIgPSBOb2RlX0dyb3VwKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCiAgICAgICAgDQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KDQoNCg0KICAgICAgICBpZiAnTm9kZV9Hcm91cF9zdG9yZScgaW4gZGlyKCk6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJz09PiBOb2RlX0dyb3VwX3N0b3JlKCknKTsNCiAgICAgICAgICAgIGFuc3dlciA9IE5vZGVfR3JvdXBfc3RvcmUoc2VsZiwgX19ldmVudCwgYW5zd2VyLCBfX3RvU3RyaW5nKTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCg0KICAgICAgICByZXR1cm4gYW5zd2VyOw0KDQogICAgDQogICAgZGVmIGZpbmRBbGwoc2VsZiwgX19ldmVudD1Ob25lKToNCiAgICAgICAgX190b1N0cmluZyA9ICdOb2RlX0dyb3VwOjpmaW5kQWxsKCk6ICc7DQogICAgICAgIA0KICAgICAgICBldkpTT04gPSBOb25lOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBldkpTT04gPSB1anNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046DQogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOw0KICAgICAgICANCg0KICAgICAgICBhbnN3ZXIgPSBOb25lOw0KDQogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aWNrc19tcygpKSsnXS5Ob2RlX0dyb3VwLmZpbmRBbGwoKScpLm1ldGhvZCgnZmluZEFsbCcpLmNsYXNzTmFtZSgnTm9kZV9Hcm91cCcpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7DQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KICAgICAgICANCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICBhbnN3ZXIgPSBOb2RlX0dyb3VwKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCiAgICAgICAgDQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KDQoNCg0KICAgICAgICBpZiAnTm9kZV9Hcm91cF9maW5kQWxsJyBpbiBkaXIoKToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnPT0+IE5vZGVfR3JvdXBfZmluZEFsbCgpJyk7DQogICAgICAgICAgICBhbnN3ZXIgPSBOb2RlX0dyb3VwX2ZpbmRBbGwoc2VsZiwgX19ldmVudCwgYW5zd2VyLCBfX3RvU3RyaW5nKTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCg0KICAgICAgICByZXR1cm4gYW5zd2VyOw0KDQogICAgDQogICAgZGVmIGZpbmQoc2VsZiwgX19ldmVudD1Ob25lKToNCiAgICAgICAgX190b1N0cmluZyA9ICdOb2RlX0dyb3VwOjpmaW5kKCk6ICc7DQogICAgICAgIA0KICAgICAgICBldkpTT04gPSBOb25lOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBldkpTT04gPSB1anNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046DQogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOw0KICAgICAgICANCg0KICAgICAgICBhbnN3ZXIgPSBOb25lOw0KDQogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aWNrc19tcygpKSsnXS5Ob2RlX0dyb3VwLmZpbmQoKScpLm1ldGhvZCgnZmluZCcpLmNsYXNzTmFtZSgnTm9kZV9Hcm91cCcpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7DQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KICAgICAgICANCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICBhbnN3ZXIgPSBOb2RlX0dyb3VwKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCiAgICAgICAgDQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KDQoNCg0KICAgICAgICBpZiAnTm9kZV9Hcm91cF9maW5kJyBpbiBkaXIoKToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnPT0+IE5vZGVfR3JvdXBfZmluZCgpJyk7DQogICAgICAgICAgICBhbnN3ZXIgPSBOb2RlX0dyb3VwX2ZpbmQoc2VsZiwgX19ldmVudCwgYW5zd2VyLCBfX3RvU3RyaW5nKTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCg0KICAgICAgICByZXR1cm4gYW5zd2VyOw0KDQogICAgDQoNCg0KY2xhc3MgTm9kZV9UeXBlKCk6DQogICAgZGVmIF9faW5pdF9fKHNlbGYsIElkPU5vbmUsIGFjdGl2ZT1Ob25lLCBlbmFibGVkPU5vbmUsIGNvZGU9Tm9uZSwgb3JkZXI9Tm9uZSwgZGF0ZT1Ob25lLCBuYW1lPU5vbmUsIHJlbWFyaz1Ob25lLCBkeW5hbWljPU5vbmUpOg0KICAgICAgICBzdXBlcigpLl9faW5pdF9fKCk7DQoNCiAgICAgICAgI3ByaW50KCdOb2RlX1R5cGU6Ol9faW5pdF9fKCknKTsNCiAgICAgICAgaWYgSWQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBzZWxmLklkID0gSWQ7DQoNCiAgICAgICAgDQogICAgICAgIHNlbGYuYWN0aXZlKGFjdGl2ZSk7DQogICAgICAgIHNlbGYuZW5hYmxlZChlbmFibGVkKTsNCiAgICAgICAgc2VsZi5jb2RlKGNvZGUpOw0KICAgICAgICBzZWxmLm9yZGVyKG9yZGVyKTsNCiAgICAgICAgc2VsZi5kYXRlKGRhdGUpOw0KICAgICAgICBzZWxmLm5hbWUobmFtZSk7DQogICAgICAgIHNlbGYucmVtYXJrKHJlbWFyayk7DQogICAgICAgIHNlbGYuZHluYW1pYyhkeW5hbWljKTsNCiAgICAgICAgDQogICAgSWQgPSBOb25lOw0KICAgIA0KICAgIA0KICAgICMgYWN0aXZlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2FjdGl2ZSA9IE5vbmU7DQogICAgZGVmIGFjdGl2ZShzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9hY3RpdmUgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fYWN0aXZlOw0KDQoNCiAgICANCiAgICAjIGVuYWJsZWQ6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfZW5hYmxlZCA9IE5vbmU7DQogICAgZGVmIGVuYWJsZWQoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fZW5hYmxlZCA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9lbmFibGVkOw0KDQoNCiAgICANCiAgICAjIGNvZGU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfY29kZSA9IE5vbmU7DQogICAgZGVmIGNvZGUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fY29kZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9jb2RlOw0KDQoNCiAgICANCiAgICAjIG9yZGVyOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX29yZGVyID0gTm9uZTsNCiAgICBkZWYgb3JkZXIoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fb3JkZXIgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fb3JkZXI7DQoNCg0KICAgIA0KICAgICMgZGF0ZTogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9kYXRlID0gTm9uZTsNCiAgICBkZWYgZGF0ZShzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9kYXRlID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2RhdGU7DQoNCg0KICAgIA0KICAgICMgbmFtZTogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9uYW1lID0gTm9uZTsNCiAgICBkZWYgbmFtZShzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9uYW1lID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX25hbWU7DQoNCg0KICAgIA0KICAgICMgcmVtYXJrOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX3JlbWFyayA9IE5vbmU7DQogICAgZGVmIHJlbWFyayhzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9yZW1hcmsgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fcmVtYXJrOw0KDQoNCiAgICANCiAgICAjIGR5bmFtaWM6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfZHluYW1pYyA9IE5vbmU7DQogICAgZGVmIGR5bmFtaWMoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fZHluYW1pYyA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9keW5hbWljOw0KDQoNCiAgICANCiAgICANCiAgICBkZWYgX2Zyb21Eb2N1bWVudChzZWxmLCBvYmopOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ05vZGVfVHlwZTo6X2Zyb21Eb2N1bWVudCgpOiAnOw0KDQogICAgICAgIGlmIG9iaiBpcyBOb25lOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIA0KICAgICAgICBpZiBpc2luc3RhbmNlKG9iaiwgYnl0ZXMpOg0KICAgICAgICAgICAgb2JqID0gc3RyKG9iaiwgInV0Zi04Iik7DQoNCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIHN0cikgb3IgdHlwZShvYmopIGlzIHN0cjoNCiAgICAgICAgICAgIG9iaiA9IHVqc29uLmxvYWRzKG9iaik7DQogICAgICAgIA0KICAgICAgICBpZiBub3QgaXNpbnN0YW5jZShvYmosIChzdHIsIGJ5dGVzLCBkaWN0KSk6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJ0dPVCBIRVJFOiAnICsgc3RyKHR5cGUob2JqKSkpOw0KICAgICAgICAgICAgcmV0dXJuIG9iajsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZm9yIGkgaW4gb2JqOg0KICAgICAgICAgICAgICAgIG9ialtpXSA9IE5vZGVfVHlwZSgpLl9mcm9tRG9jdW1lbnQob2JqW2ldKTsNCiAgICAgICAgICAgIHJldHVybiBvYmo7DQoNCg0KICAgICAgICBpZiAnSWQnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuSWQgPSBvYmpbJ0lkJ107DQoNCiAgICANCiAgICAgICAgaWYgJ2FjdGl2ZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5hY3RpdmUob2JqWydhY3RpdmUnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnZW5hYmxlZCcgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5lbmFibGVkKG9ialsnZW5hYmxlZCddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdjb2RlJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmNvZGUob2JqWydjb2RlJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ29yZGVyJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLm9yZGVyKG9ialsnb3JkZXInXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnZGF0ZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5kYXRlKG9ialsnZGF0ZSddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICduYW1lJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLm5hbWUob2JqWyduYW1lJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ3JlbWFyaycgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5yZW1hcmsob2JqWydyZW1hcmsnXSk7DQogICAgICAgIA0KICAgICAgICAgICAgc2VsZi5yZW1hcmsoIHViaW5hc2NpaS5hMmJfYmFzZTY0KHNlbGYucmVtYXJrKCkpICk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnZHluYW1pYycgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5keW5hbWljKG9ialsnZHluYW1pYyddKTsNCiAgICAgICAgDQogICAgDQoNCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICByZXR1cm4gc2VsZjsNCiAgICANCiAgICBkZWYgX3RvRG9jdW1lbnQoc2VsZik6DQogICAgICAgIHJldCA9IHt9Ow0KICAgICAgICBpZiBzZWxmLklkIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJJZCJdID0gc2VsZi5JZDsNCg0KICAgIA0KICAgICAgICBpZiBzZWxmLmFjdGl2ZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJhY3RpdmUiXSA9IHNlbGYuYWN0aXZlKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmVuYWJsZWQoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiZW5hYmxlZCJdID0gc2VsZi5lbmFibGVkKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmNvZGUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiY29kZSJdID0gc2VsZi5jb2RlKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLm9yZGVyKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbIm9yZGVyIl0gPSBzZWxmLm9yZGVyKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmRhdGUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiZGF0ZSJdID0gc2VsZi5kYXRlKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLm5hbWUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsibmFtZSJdID0gc2VsZi5uYW1lKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLnJlbWFyaygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IHNlbGYucmVtYXJrKCk7DQogICAgICAgIA0KICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShyZXRbInJlbWFyayJdLCBkaWN0KToNCiAgICAgICAgICAgICAgICByZXRbInJlbWFyayJdID0gdWpzb24uZHVtcHMocmV0WyJyZW1hcmsiXSk7DQogICAgICAgICAgICByZXRbInJlbWFyayJdID0gdWJpbmFzY2lpLmIyYV9iYXNlNjQocmV0WyJyZW1hcmsiXSkuc3RyaXAoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYuZHluYW1pYygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJkeW5hbWljIl0gPSBzZWxmLmR5bmFtaWMoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIHJldHVybiByZXQ7DQoNCiAgICANCiAgICBkZWYgc3RvcmUoc2VsZiwgX19ldmVudD1Ob25lKToNCiAgICAgICAgX190b1N0cmluZyA9ICdOb2RlX1R5cGU6OnN0b3JlKCk6ICc7DQogICAgICAgIA0KICAgICAgICBldkpTT04gPSBOb25lOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBldkpTT04gPSB1anNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046DQogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOw0KICAgICAgICANCg0KICAgICAgICBhbnN3ZXIgPSBOb25lOw0KDQogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aWNrc19tcygpKSsnXS5Ob2RlX1R5cGUuc3RvcmUoKScpLm1ldGhvZCgnc3RvcmUnKS5jbGFzc05hbWUoJ05vZGVfVHlwZScpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7DQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KICAgICAgICANCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICBhbnN3ZXIgPSBOb2RlX1R5cGUoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KICAgICAgICANCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQoNCg0KDQogICAgICAgIGlmICdOb2RlX1R5cGVfc3RvcmUnIGluIGRpcigpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICc9PT4gTm9kZV9UeXBlX3N0b3JlKCknKTsNCiAgICAgICAgICAgIGFuc3dlciA9IE5vZGVfVHlwZV9zdG9yZShzZWxmLCBfX2V2ZW50LCBhbnN3ZXIsIF9fdG9TdHJpbmcpOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCg0KICAgICAgICAgICAgDQogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KDQogICAgICAgIHJldHVybiBhbnN3ZXI7DQoNCiAgICANCiAgICBkZWYgZmluZEFsbChzZWxmLCBfX2V2ZW50PU5vbmUpOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ05vZGVfVHlwZTo6ZmluZEFsbCgpOiAnOw0KICAgICAgICANCiAgICAgICAgZXZKU09OID0gTm9uZTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgZXZKU09OID0gdWpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOg0KICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsNCiAgICAgICAgDQoNCiAgICAgICAgYW5zd2VyID0gTm9uZTsNCg0KICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGlja3NfbXMoKSkrJ10uTm9kZV9UeXBlLmZpbmRBbGwoKScpLm1ldGhvZCgnZmluZEFsbCcpLmNsYXNzTmFtZSgnTm9kZV9UeXBlJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOw0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsNCiAgICAgICAgDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQogICAgICAgIA0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgIGFuc3dlciA9IE5vZGVfVHlwZSgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQogICAgICAgIA0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCg0KDQoNCiAgICAgICAgaWYgJ05vZGVfVHlwZV9maW5kQWxsJyBpbiBkaXIoKToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnPT0+IE5vZGVfVHlwZV9maW5kQWxsKCknKTsNCiAgICAgICAgICAgIGFuc3dlciA9IE5vZGVfVHlwZV9maW5kQWxsKHNlbGYsIF9fZXZlbnQsIGFuc3dlciwgX190b1N0cmluZyk7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KDQogICAgICAgICAgICANCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQoNCiAgICAgICAgcmV0dXJuIGFuc3dlcjsNCg0KICAgIA0KICAgIGRlZiBmaW5kKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6DQogICAgICAgIF9fdG9TdHJpbmcgPSAnTm9kZV9UeXBlOjpmaW5kKCk6ICc7DQogICAgICAgIA0KICAgICAgICBldkpTT04gPSBOb25lOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBldkpTT04gPSB1anNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046DQogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOw0KICAgICAgICANCg0KICAgICAgICBhbnN3ZXIgPSBOb25lOw0KDQogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aWNrc19tcygpKSsnXS5Ob2RlX1R5cGUuZmluZCgpJykubWV0aG9kKCdmaW5kJykuY2xhc3NOYW1lKCdOb2RlX1R5cGUnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOw0KICAgICAgICANCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCiAgICAgICAgDQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgYW5zd2VyID0gTm9kZV9UeXBlKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCiAgICAgICAgDQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KDQoNCg0KICAgICAgICBpZiAnTm9kZV9UeXBlX2ZpbmQnIGluIGRpcigpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICc9PT4gTm9kZV9UeXBlX2ZpbmQoKScpOw0KICAgICAgICAgICAgYW5zd2VyID0gTm9kZV9UeXBlX2ZpbmQoc2VsZiwgX19ldmVudCwgYW5zd2VyLCBfX3RvU3RyaW5nKTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCg0KICAgICAgICByZXR1cm4gYW5zd2VyOw0KDQogICAgDQogICAgZGVmIGRlcGxveShzZWxmLCBfX2V2ZW50PU5vbmUpOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ05vZGVfVHlwZTo6ZGVwbG95KCk6ICc7DQogICAgICAgIA0KICAgICAgICBldkpTT04gPSBOb25lOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBldkpTT04gPSB1anNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046DQogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOw0KICAgICAgICANCg0KICAgICAgICBhbnN3ZXIgPSBOb25lOw0KDQogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aWNrc19tcygpKSsnXS5Ob2RlX1R5cGUuZGVwbG95KCknKS5tZXRob2QoJ2RlcGxveScpLmNsYXNzTmFtZSgnTm9kZV9UeXBlJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOw0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsNCiAgICAgICAgDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQogICAgICAgIA0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgIGFuc3dlciA9IGV2SlNPTjsNCiAgICAgICAgDQogICAgICAgIAoJCQkKICAgICAgICAgICAgDQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KDQoNCg0KICAgICAgICBpZiAnTm9kZV9UeXBlX2RlcGxveScgaW4gZGlyKCk6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJz09PiBOb2RlX1R5cGVfZGVwbG95KCknKTsNCiAgICAgICAgICAgIGFuc3dlciA9IE5vZGVfVHlwZV9kZXBsb3koc2VsZiwgX19ldmVudCwgYW5zd2VyLCBfX3RvU3RyaW5nKTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChzdHIoYW5zd2VyKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCg0KICAgICAgICByZXR1cm4gYW5zd2VyOw0KDQogICAgDQoNCg0KY2xhc3MgTWFwcGluZygpOg0KICAgIGRlZiBfX2luaXRfXyhzZWxmLCBJZD1Ob25lLCBhY3RpdmU9Tm9uZSwgZW5hYmxlZD1Ob25lLCBvcmRlcj1Ob25lLCBjbGFzc05hbWU9Tm9uZSwgc2NvcGU9Tm9uZSwgY29udGV4dD1Ob25lLCBzb3VyY2U9Tm9uZSwgdGFyZ2V0PU5vbmUsIG9wZXJhdG9yPU5vbmUsIGluU2NyaXB0PU5vbmUsIG91dFNjcmlwdD1Ob25lLCB0b29sPU5vbmUsIGdyb3VwPU5vbmUsIHR5cGU9Tm9uZSk6DQogICAgICAgIHN1cGVyKCkuX19pbml0X18oKTsNCg0KICAgICAgICAjcHJpbnQoJ01hcHBpbmc6Ol9faW5pdF9fKCknKTsNCiAgICAgICAgaWYgSWQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBzZWxmLklkID0gSWQ7DQoNCiAgICAgICAgDQogICAgICAgIHNlbGYuYWN0aXZlKGFjdGl2ZSk7DQogICAgICAgIHNlbGYuZW5hYmxlZChlbmFibGVkKTsNCiAgICAgICAgc2VsZi5vcmRlcihvcmRlcik7DQogICAgICAgIHNlbGYuY2xhc3NOYW1lKGNsYXNzTmFtZSk7DQogICAgICAgIHNlbGYuc2NvcGUoc2NvcGUpOw0KICAgICAgICBzZWxmLmNvbnRleHQoY29udGV4dCk7DQogICAgICAgIHNlbGYuc291cmNlKHNvdXJjZSk7DQogICAgICAgIHNlbGYudGFyZ2V0KHRhcmdldCk7DQogICAgICAgIHNlbGYub3BlcmF0b3Iob3BlcmF0b3IpOw0KICAgICAgICBzZWxmLmluU2NyaXB0KGluU2NyaXB0KTsNCiAgICAgICAgc2VsZi5vdXRTY3JpcHQob3V0U2NyaXB0KTsNCiAgICAgICAgc2VsZi50b29sKHRvb2wpOw0KICAgICAgICBzZWxmLmdyb3VwKGdyb3VwKTsNCiAgICAgICAgc2VsZi50eXBlKHR5cGUpOw0KICAgICAgICANCiAgICBJZCA9IE5vbmU7DQogICAgDQogICAgDQogICAgIyBhY3RpdmU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfYWN0aXZlID0gTm9uZTsNCiAgICBkZWYgYWN0aXZlKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2FjdGl2ZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9hY3RpdmU7DQoNCg0KICAgIA0KICAgICMgZW5hYmxlZDogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9lbmFibGVkID0gTm9uZTsNCiAgICBkZWYgZW5hYmxlZChzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9lbmFibGVkID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2VuYWJsZWQ7DQoNCg0KICAgIA0KICAgICMgb3JkZXI6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfb3JkZXIgPSBOb25lOw0KICAgIGRlZiBvcmRlcihzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9vcmRlciA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9vcmRlcjsNCg0KDQogICAgDQogICAgIyBjbGFzc05hbWU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfY2xhc3NOYW1lID0gTm9uZTsNCiAgICBkZWYgY2xhc3NOYW1lKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2NsYXNzTmFtZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9jbGFzc05hbWU7DQoNCg0KICAgIA0KICAgICMgc2NvcGU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfc2NvcGUgPSBOb25lOw0KICAgIGRlZiBzY29wZShzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9zY29wZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9zY29wZTsNCg0KDQogICAgDQogICAgIyBjb250ZXh0OiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2NvbnRleHQgPSBOb25lOw0KICAgIGRlZiBjb250ZXh0KHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2NvbnRleHQgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fY29udGV4dDsNCg0KDQogICAgDQogICAgIyBzb3VyY2U6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfc291cmNlID0gTm9uZTsNCiAgICBkZWYgc291cmNlKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX3NvdXJjZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9zb3VyY2U7DQoNCg0KICAgIA0KICAgICMgdGFyZ2V0OiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX3RhcmdldCA9IE5vbmU7DQogICAgZGVmIHRhcmdldChzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl90YXJnZXQgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fdGFyZ2V0Ow0KDQoNCiAgICANCiAgICAjIG9wZXJhdG9yOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX29wZXJhdG9yID0gTm9uZTsNCiAgICBkZWYgb3BlcmF0b3Ioc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fb3BlcmF0b3IgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fb3BlcmF0b3I7DQoNCg0KICAgIA0KICAgICMgaW5TY3JpcHQ6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfaW5TY3JpcHQgPSBOb25lOw0KICAgIGRlZiBpblNjcmlwdChzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9pblNjcmlwdCA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9pblNjcmlwdDsNCg0KDQogICAgDQogICAgIyBvdXRTY3JpcHQ6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfb3V0U2NyaXB0ID0gTm9uZTsNCiAgICBkZWYgb3V0U2NyaXB0KHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX291dFNjcmlwdCA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9vdXRTY3JpcHQ7DQoNCg0KICAgIA0KICAgICMgdG9vbDogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF90b29sID0gTm9uZTsNCiAgICBkZWYgdG9vbChzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl90b29sID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3Rvb2w7DQoNCg0KICAgIA0KICAgICMgZ3JvdXA6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfZ3JvdXAgPSBOb25lOw0KICAgIGRlZiBncm91cChzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9ncm91cCA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9ncm91cDsNCg0KDQogICAgDQogICAgIyB0eXBlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX3R5cGUgPSBOb25lOw0KICAgIGRlZiB0eXBlKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX3R5cGUgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fdHlwZTsNCg0KDQogICAgDQogICAgDQogICAgZGVmIF9mcm9tRG9jdW1lbnQoc2VsZiwgb2JqKToNCiAgICAgICAgX190b1N0cmluZyA9ICdNYXBwaW5nOjpfZnJvbURvY3VtZW50KCk6ICc7DQoNCiAgICAgICAgaWYgb2JqIGlzIE5vbmU6DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgDQogICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLCBieXRlcyk6DQogICAgICAgICAgICBvYmogPSBzdHIob2JqLCAidXRmLTgiKTsNCg0KICAgICAgICBpZiBpc2luc3RhbmNlKG9iaiwgc3RyKSBvciB0eXBlKG9iaikgaXMgc3RyOg0KICAgICAgICAgICAgb2JqID0gdWpzb24ubG9hZHMob2JqKTsNCiAgICAgICAgDQogICAgICAgIGlmIG5vdCBpc2luc3RhbmNlKG9iaiwgKHN0ciwgYnl0ZXMsIGRpY3QpKToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnR09UIEhFUkU6ICcgKyBzdHIodHlwZShvYmopKSk7DQogICAgICAgICAgICByZXR1cm4gb2JqOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBmb3IgaSBpbiBvYmo6DQogICAgICAgICAgICAgICAgb2JqW2ldID0gTWFwcGluZygpLl9mcm9tRG9jdW1lbnQob2JqW2ldKTsNCiAgICAgICAgICAgIHJldHVybiBvYmo7DQoNCg0KICAgICAgICBpZiAnSWQnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuSWQgPSBvYmpbJ0lkJ107DQoNCiAgICANCiAgICAgICAgaWYgJ2FjdGl2ZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5hY3RpdmUob2JqWydhY3RpdmUnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnZW5hYmxlZCcgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5lbmFibGVkKG9ialsnZW5hYmxlZCddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdvcmRlcicgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5vcmRlcihvYmpbJ29yZGVyJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ2NsYXNzTmFtZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5jbGFzc05hbWUob2JqWydjbGFzc05hbWUnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnc2NvcGUnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuc2NvcGUob2JqWydzY29wZSddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdjb250ZXh0JyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmNvbnRleHQob2JqWydjb250ZXh0J10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ3NvdXJjZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5zb3VyY2Uob2JqWydzb3VyY2UnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAndGFyZ2V0JyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLnRhcmdldChvYmpbJ3RhcmdldCddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdvcGVyYXRvcicgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5vcGVyYXRvcihvYmpbJ29wZXJhdG9yJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ2luU2NyaXB0JyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmluU2NyaXB0KG9ialsnaW5TY3JpcHQnXSk7DQogICAgICAgIA0KICAgICAgICAgICAgc2VsZi5pblNjcmlwdCggdWJpbmFzY2lpLmEyYl9iYXNlNjQoc2VsZi5pblNjcmlwdCgpKSApOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ291dFNjcmlwdCcgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5vdXRTY3JpcHQob2JqWydvdXRTY3JpcHQnXSk7DQogICAgICAgIA0KICAgICAgICAgICAgc2VsZi5vdXRTY3JpcHQoIHViaW5hc2NpaS5hMmJfYmFzZTY0KHNlbGYub3V0U2NyaXB0KCkpICk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAndG9vbCcgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi50b29sKFRvb2woKS5fZnJvbURvY3VtZW50KG9ialsndG9vbCddKSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnZ3JvdXAnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuZ3JvdXAoQ29uZmlnX0dyb3VwKCkuX2Zyb21Eb2N1bWVudChvYmpbJ2dyb3VwJ10pKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICd0eXBlJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLnR5cGUoVG9vbF9UeXBlKCkuX2Zyb21Eb2N1bWVudChvYmpbJ3R5cGUnXSkpOw0KICAgICAgICANCiAgICANCg0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIHJldHVybiBzZWxmOw0KICAgIA0KICAgIGRlZiBfdG9Eb2N1bWVudChzZWxmKToNCiAgICAgICAgcmV0ID0ge307DQogICAgICAgIGlmIHNlbGYuSWQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbIklkIl0gPSBzZWxmLklkOw0KDQogICAgDQogICAgICAgIGlmIHNlbGYuYWN0aXZlKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbImFjdGl2ZSJdID0gc2VsZi5hY3RpdmUoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYuZW5hYmxlZCgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJlbmFibGVkIl0gPSBzZWxmLmVuYWJsZWQoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYub3JkZXIoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsib3JkZXIiXSA9IHNlbGYub3JkZXIoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYuY2xhc3NOYW1lKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbImNsYXNzTmFtZSJdID0gc2VsZi5jbGFzc05hbWUoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYuc2NvcGUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsic2NvcGUiXSA9IHNlbGYuc2NvcGUoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYuY29udGV4dCgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJjb250ZXh0Il0gPSBzZWxmLmNvbnRleHQoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYuc291cmNlKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbInNvdXJjZSJdID0gc2VsZi5zb3VyY2UoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYudGFyZ2V0KCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbInRhcmdldCJdID0gc2VsZi50YXJnZXQoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYub3BlcmF0b3IoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsib3BlcmF0b3IiXSA9IHNlbGYub3BlcmF0b3IoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYuaW5TY3JpcHQoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiaW5TY3JpcHQiXSA9IHNlbGYuaW5TY3JpcHQoKTsNCiAgICAgICAgDQogICAgICAgICAgICBpZiBpc2luc3RhbmNlKHJldFsiaW5TY3JpcHQiXSwgZGljdCk6DQogICAgICAgICAgICAgICAgcmV0WyJpblNjcmlwdCJdID0gdWpzb24uZHVtcHMocmV0WyJpblNjcmlwdCJdKTsNCiAgICAgICAgICAgIHJldFsiaW5TY3JpcHQiXSA9IHViaW5hc2NpaS5iMmFfYmFzZTY0KHJldFsiaW5TY3JpcHQiXSkuc3RyaXAoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYub3V0U2NyaXB0KCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbIm91dFNjcmlwdCJdID0gc2VsZi5vdXRTY3JpcHQoKTsNCiAgICAgICAgDQogICAgICAgICAgICBpZiBpc2luc3RhbmNlKHJldFsib3V0U2NyaXB0Il0sIGRpY3QpOg0KICAgICAgICAgICAgICAgIHJldFsib3V0U2NyaXB0Il0gPSB1anNvbi5kdW1wcyhyZXRbIm91dFNjcmlwdCJdKTsNCiAgICAgICAgICAgIHJldFsib3V0U2NyaXB0Il0gPSB1YmluYXNjaWkuYjJhX2Jhc2U2NChyZXRbIm91dFNjcmlwdCJdKS5zdHJpcCgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi50b29sKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbInRvb2wiXSA9IHNlbGYudG9vbCgpLl90b0RvY3VtZW50KCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmdyb3VwKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbImdyb3VwIl0gPSBzZWxmLmdyb3VwKCkuX3RvRG9jdW1lbnQoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYudHlwZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJ0eXBlIl0gPSBzZWxmLnR5cGUoKS5fdG9Eb2N1bWVudCgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgcmV0dXJuIHJldDsNCg0KICAgIA0KICAgIGRlZiBzdG9yZShzZWxmLCBfX2V2ZW50PU5vbmUpOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ01hcHBpbmc6OnN0b3JlKCk6ICc7DQogICAgICAgIA0KICAgICAgICBldkpTT04gPSBOb25lOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBldkpTT04gPSB1anNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046DQogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOw0KICAgICAgICANCg0KICAgICAgICBhbnN3ZXIgPSBOb25lOw0KDQogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aWNrc19tcygpKSsnXS5NYXBwaW5nLnN0b3JlKCknKS5tZXRob2QoJ3N0b3JlJykuY2xhc3NOYW1lKCdNYXBwaW5nJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOw0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsNCiAgICAgICAgDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQogICAgICAgIA0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgIGFuc3dlciA9IE1hcHBpbmcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KICAgICAgICANCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQoNCg0KDQogICAgICAgIGlmICdNYXBwaW5nX3N0b3JlJyBpbiBkaXIoKToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnPT0+IE1hcHBpbmdfc3RvcmUoKScpOw0KICAgICAgICAgICAgYW5zd2VyID0gTWFwcGluZ19zdG9yZShzZWxmLCBfX2V2ZW50LCBhbnN3ZXIsIF9fdG9TdHJpbmcpOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCg0KICAgICAgICAgICAgDQogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KDQogICAgICAgIHJldHVybiBhbnN3ZXI7DQoNCiAgICANCiAgICBkZWYgZmluZEFsbChzZWxmLCBfX2V2ZW50PU5vbmUpOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ01hcHBpbmc6OmZpbmRBbGwoKTogJzsNCiAgICAgICAgDQogICAgICAgIGV2SlNPTiA9IE5vbmU7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIGV2SlNPTiA9IHVqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoNCiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7DQogICAgICAgIA0KDQogICAgICAgIGFuc3dlciA9IE5vbmU7DQoNCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpY2tzX21zKCkpKyddLk1hcHBpbmcuZmluZEFsbCgpJykubWV0aG9kKCdmaW5kQWxsJykuY2xhc3NOYW1lKCdNYXBwaW5nJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOw0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsNCiAgICAgICAgDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQogICAgICAgIA0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgIGFuc3dlciA9IE1hcHBpbmcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KICAgICAgICANCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQoNCg0KDQogICAgICAgIGlmICdNYXBwaW5nX2ZpbmRBbGwnIGluIGRpcigpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICc9PT4gTWFwcGluZ19maW5kQWxsKCknKTsNCiAgICAgICAgICAgIGFuc3dlciA9IE1hcHBpbmdfZmluZEFsbChzZWxmLCBfX2V2ZW50LCBhbnN3ZXIsIF9fdG9TdHJpbmcpOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCg0KICAgICAgICAgICAgDQogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KDQogICAgICAgIHJldHVybiBhbnN3ZXI7DQoNCiAgICANCiAgICBkZWYgZmluZChzZWxmLCBfX2V2ZW50PU5vbmUpOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ01hcHBpbmc6OmZpbmQoKTogJzsNCiAgICAgICAgDQogICAgICAgIGV2SlNPTiA9IE5vbmU7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIGV2SlNPTiA9IHVqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoNCiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7DQogICAgICAgIA0KDQogICAgICAgIGFuc3dlciA9IE5vbmU7DQoNCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpY2tzX21zKCkpKyddLk1hcHBpbmcuZmluZCgpJykubWV0aG9kKCdmaW5kJykuY2xhc3NOYW1lKCdNYXBwaW5nJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOw0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsNCiAgICAgICAgDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQogICAgICAgIA0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgIGFuc3dlciA9IE1hcHBpbmcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KICAgICAgICANCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQoNCg0KDQogICAgICAgIGlmICdNYXBwaW5nX2ZpbmQnIGluIGRpcigpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICc9PT4gTWFwcGluZ19maW5kKCknKTsNCiAgICAgICAgICAgIGFuc3dlciA9IE1hcHBpbmdfZmluZChzZWxmLCBfX2V2ZW50LCBhbnN3ZXIsIF9fdG9TdHJpbmcpOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCg0KICAgICAgICAgICAgDQogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KDQogICAgICAgIHJldHVybiBhbnN3ZXI7DQoNCiAgICANCg0KDQoNCg0KDQogICAgDQojIyMjIyMjIyMjIyBXSUZJIENvbm5lY3Rpb24gIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMNCnByaW50KCdtYWluKCknLCAiQ29ubmVjdGluZyB0byBXaUZpLi4uIiwgZW5kPSIiKTsNCm5ldF9pZiA9IG5ldHdvcmsuV0xBTihuZXR3b3JrLlNUQV9JRik7DQpuZXRfaWYuYWN0aXZlKFRydWUpOw0KbmV0X2lmLmNvbm5lY3QoJ1dva3dpLUdVRVNUJywgJycpOw0Kd2hpbGUgbm90IG5ldF9pZi5pc2Nvbm5lY3RlZCgpOg0KICAgIHRpbWUuc2xlZXAoMC4xKTsNCiAgICBwcmludCgiLiIsIGVuZD0iIik7DQoNCm5jb2RlID0gdWJpbmFzY2lpLmhleGxpZnkobmV0X2lmLmNvbmZpZygnbWFjJykpLmRlY29kZSgpOw0KcHJpbnQoIkRvbmUiKTsNCiMjIyMjIyMjIyMjIFdJRkkgQ29ubmVjdGlvbiAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIw0KICAgIA0KDQpub2RlID0gTm9kZShjb2RlPW5jb2RlLCBwYXJlbnQ9Tm9kZShjb2RlPSdhcGlzZXJ2ZXIvZXNwdGVzdC9tYXN0ZXInKSk7DQoNCg0KIyMjIyMjIyMjIyMgTVFUVCBDb25uZWN0aW9uICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjDQpwcmludCgnbWFpbigpJywgIkNvbm5lY3RpbmcgdG8gTVFUVCBzZXJ2ZXIiLCAiLi4uICIsIGVuZD0iIik7DQptcXR0X3RvcGljID0gJ2FwaXNlcnZlci9lc3B0ZXN0JzsNCg0KbXF0dF9jbGllbnQgPSB1bXF0dC5zaW1wbGUuTVFUVENsaWVudChtcXR0X3RvcGljKycvJytub2RlLmNvZGUoKSwgJ3Rlc3QubW9zcXVpdHRvLm9yZycsIHVzZXI9JycsIHBhc3N3b3JkPScnKTsNCm1xdHRfY2xpZW50LnNldF9jYWxsYmFjayhsYW1iZGEgdG9waWMsIG1zZyA6IEV2ZW50KCkuX2Zyb21Eb2N1bWVudChtc2cpLnByb2Nlc3MoKSk7DQptcXR0X2NsaWVudC5jb25uZWN0KCk7DQoNCg0KbXF0dF9jbGllbnQuc3Vic2NyaWJlKG1xdHRfdG9waWMpOw0KcHJpbnQoIkNvbm5lY3RlZCEiKTsNCiMjIyMjIyMjIyMjIE1RVFQgQ29ubmVjdGlvbiAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIw0KDQoNCg0KIyMjIyMjIyMjIyMgTWV0aG9kIFRyaWdnZXJzICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjDQoNCiMjIyMjIyMjIyMjIE1ldGhvZCBUcmlnZ2VycyAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIw0KDQpub2RlLnN0b3JlKCk7DQoNCnByaW50KCdtYWluKCknLCAnbG9vcGluZyBmb3IgbXF0dCBldmVudHMnKTsNCndoaWxlIFRydWU6DQogICAgbXF0dF9jbGllbnQud2FpdF9tc2coKTsNCiAgICB0aW1lLnNsZWVwKDEpOw0KDQo=",
	"__keys": ["name"],
	"__trMap": []
}