{
	"Id": "3702c2a03a8404f959d6c2c4750da6062619b085",
	"active": "true",
	"enabled": "true",
	"code": "apiserver",
	"date": "Mon Sep 30 2024 22:10:05 GMT+0300 (Eastern European Summer Time)",
	"name": "API Server",
	"remark": "IyBpbXBvcnQgdXJsbGliLnJlcXVlc3QsIGpzb24sIGJhc2U2NDsNCiMgZXhlYyhiYXNlNjQuYjY0ZGVjb2RlKGpzb24ubG9hZCh1cmxsaWIucmVxdWVzdC51cmxvcGVuKCJodHRwczovL2Fyemhvc3BpdGFsLmdpdGh1Yi5pby9lc3B0ZXN0L05vZGVfVHlwZS9BUEkrU2VydmVyLmpzb24iKSlbInJlbWFyayJdKSk7DQoNCmltcG9ydCBwYWhvLm1xdHQuY2xpZW50LGpzb24semxpYix0aW1lLGdjLGlvOw0KDQoNCmNsYXNzIFVzZXIoKToNCiAgICBkZWYgX19pbml0X18oc2VsZiwgSWQ9Tm9uZSwgYWN0aXZlPU5vbmUsIGVuYWJsZWQ9Tm9uZSwgY29kZT1Ob25lLCBvcmRlcj1Ob25lLCBkYXRlPU5vbmUsIG5hbWU9Tm9uZSwgcmVtYXJrPU5vbmUsIHVzZXJuYW1lPU5vbmUsIHBhc3N3b3JkPU5vbmUpOg0KICAgICAgICBzdXBlcigpLl9faW5pdF9fKCk7DQoNCiAgICAgICAgI3ByaW50KCdVc2VyOjpfX2luaXRfXygpJyk7DQogICAgICAgIGlmIElkIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgc2VsZi5JZCA9IElkOw0KDQogICAgICAgIA0KICAgICAgICBzZWxmLmFjdGl2ZShhY3RpdmUpOw0KICAgICAgICBzZWxmLmVuYWJsZWQoZW5hYmxlZCk7DQogICAgICAgIHNlbGYuY29kZShjb2RlKTsNCiAgICAgICAgc2VsZi5vcmRlcihvcmRlcik7DQogICAgICAgIHNlbGYuZGF0ZShkYXRlKTsNCiAgICAgICAgc2VsZi5uYW1lKG5hbWUpOw0KICAgICAgICBzZWxmLnJlbWFyayhyZW1hcmspOw0KICAgICAgICBzZWxmLnVzZXJuYW1lKHVzZXJuYW1lKTsNCiAgICAgICAgc2VsZi5wYXNzd29yZChwYXNzd29yZCk7DQogICAgICAgIA0KICAgIElkID0gTm9uZTsNCiAgICANCiAgICANCiAgICAjIGFjdGl2ZTogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9hY3RpdmUgPSBOb25lOw0KICAgIGRlZiBhY3RpdmUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fYWN0aXZlID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2FjdGl2ZTsNCg0KDQogICAgDQogICAgIyBlbmFibGVkOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2VuYWJsZWQgPSBOb25lOw0KICAgIGRlZiBlbmFibGVkKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2VuYWJsZWQgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fZW5hYmxlZDsNCg0KDQogICAgDQogICAgIyBjb2RlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2NvZGUgPSBOb25lOw0KICAgIGRlZiBjb2RlKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2NvZGUgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fY29kZTsNCg0KDQogICAgDQogICAgIyBvcmRlcjogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9vcmRlciA9IE5vbmU7DQogICAgZGVmIG9yZGVyKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX29yZGVyID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX29yZGVyOw0KDQoNCiAgICANCiAgICAjIGRhdGU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfZGF0ZSA9IE5vbmU7DQogICAgZGVmIGRhdGUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fZGF0ZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9kYXRlOw0KDQoNCiAgICANCiAgICAjIG5hbWU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfbmFtZSA9IE5vbmU7DQogICAgZGVmIG5hbWUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fbmFtZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9uYW1lOw0KDQoNCiAgICANCiAgICAjIHJlbWFyazogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9yZW1hcmsgPSBOb25lOw0KICAgIGRlZiByZW1hcmsoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fcmVtYXJrID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3JlbWFyazsNCg0KDQogICAgDQogICAgIyB1c2VybmFtZTogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF91c2VybmFtZSA9IE5vbmU7DQogICAgZGVmIHVzZXJuYW1lKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX3VzZXJuYW1lID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3VzZXJuYW1lOw0KDQoNCiAgICANCiAgICAjIHBhc3N3b3JkOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX3Bhc3N3b3JkID0gTm9uZTsNCiAgICBkZWYgcGFzc3dvcmQoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fcGFzc3dvcmQgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fcGFzc3dvcmQ7DQoNCg0KICAgIA0KICAgIA0KICAgIGRlZiBfZnJvbURvY3VtZW50KHNlbGYsIG9iaik6DQogICAgICAgIF9fdG9TdHJpbmcgPSAnVXNlcjo6X2Zyb21Eb2N1bWVudCgpOiAnOw0KDQogICAgICAgIGlmIG9iaiBpcyBOb25lOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIA0KICAgICAgICBpZiBpc2luc3RhbmNlKG9iaiwgYnl0ZXMpOg0KICAgICAgICAgICAgb2JqID0gc3RyKG9iaiwgInV0Zi04Iik7DQoNCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIHN0cikgb3IgdHlwZShvYmopIGlzIHN0cjoNCiAgICAgICAgICAgIG9iaiA9IGpzb24ubG9hZHMob2JqKTsNCiAgICAgICAgDQogICAgICAgIGlmIG5vdCBpc2luc3RhbmNlKG9iaiwgKHN0ciwgYnl0ZXMsIGRpY3QpKToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnR09UIEhFUkU6ICcgKyBzdHIodHlwZShvYmopKSk7DQogICAgICAgICAgICByZXR1cm4gb2JqOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBmb3IgaSBpbiBvYmo6DQogICAgICAgICAgICAgICAgb2JqW2ldID0gVXNlcigpLl9mcm9tRG9jdW1lbnQob2JqW2ldKTsNCiAgICAgICAgICAgIHJldHVybiBvYmo7DQoNCg0KICAgICAgICBpZiAnSWQnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuSWQgPSBvYmpbJ0lkJ107DQoNCiAgICANCiAgICAgICAgaWYgJ2FjdGl2ZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5hY3RpdmUob2JqWydhY3RpdmUnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnZW5hYmxlZCcgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5lbmFibGVkKG9ialsnZW5hYmxlZCddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdjb2RlJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmNvZGUob2JqWydjb2RlJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ29yZGVyJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLm9yZGVyKG9ialsnb3JkZXInXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnZGF0ZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5kYXRlKG9ialsnZGF0ZSddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICduYW1lJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLm5hbWUob2JqWyduYW1lJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ3JlbWFyaycgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5yZW1hcmsob2JqWydyZW1hcmsnXSk7DQogICAgICAgIA0KICAgICAgICAgICAgc2VsZi5yZW1hcmsoIGJhc2U2NC5iNjRlbmNvZGUoc2VsZi5yZW1hcmsoKS5lbmNvZGUoImFzY2lpIikpLmRlY29kZSgiYXNjaWkiKSApOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ3VzZXJuYW1lJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLnVzZXJuYW1lKG9ialsndXNlcm5hbWUnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAncGFzc3dvcmQnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYucGFzc3dvcmQob2JqWydwYXNzd29yZCddKTsNCiAgICAgICAgDQogICAgDQoNCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICByZXR1cm4gc2VsZjsNCiAgICANCiAgICBkZWYgX3RvRG9jdW1lbnQoc2VsZik6DQogICAgICAgIHJldCA9IHt9Ow0KICAgICAgICBpZiBzZWxmLklkIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJJZCJdID0gc2VsZi5JZDsNCg0KICAgIA0KICAgICAgICBpZiBzZWxmLmFjdGl2ZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJhY3RpdmUiXSA9IHNlbGYuYWN0aXZlKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmVuYWJsZWQoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiZW5hYmxlZCJdID0gc2VsZi5lbmFibGVkKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmNvZGUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiY29kZSJdID0gc2VsZi5jb2RlKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLm9yZGVyKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbIm9yZGVyIl0gPSBzZWxmLm9yZGVyKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmRhdGUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiZGF0ZSJdID0gc2VsZi5kYXRlKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLm5hbWUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsibmFtZSJdID0gc2VsZi5uYW1lKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLnJlbWFyaygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IHNlbGYucmVtYXJrKCk7DQogICAgICAgIA0KICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShyZXRbInJlbWFyayJdLCBkaWN0KToNCiAgICAgICAgICAgICAgICByZXRbInJlbWFyayJdID0ganNvbi5kdW1wcyhyZXRbInJlbWFyayJdKTsNCiAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSB1YmluYXNjaWkuYjJhX2Jhc2U2NChyZXRbInJlbWFyayJdKS5zdHJpcCgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi51c2VybmFtZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJ1c2VybmFtZSJdID0gc2VsZi51c2VybmFtZSgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5wYXNzd29yZCgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJwYXNzd29yZCJdID0gc2VsZi5wYXNzd29yZCgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgcmV0dXJuIHJldDsNCg0KICAgIA0KICAgIGRlZiBzdG9yZShzZWxmLCBfX2V2ZW50PU5vbmUpOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ1VzZXI6OnN0b3JlKCk6ICc7DQogICAgICAgIA0KICAgICAgICBldkpTT04gPSBOb25lOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBldkpTT04gPSBqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoNCiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7DQogICAgICAgIA0KDQogICAgICAgIGFuc3dlciA9IE5vbmU7DQoNCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpY2tzX21zKCkpKyddLlVzZXIuc3RvcmUoKScpLm1ldGhvZCgnc3RvcmUnKS5jbGFzc05hbWUoJ1VzZXInKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOw0KICAgICAgICANCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCiAgICAgICAgDQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgYW5zd2VyID0gVXNlcigpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQogICAgICAgIA0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCg0KDQoNCiAgICAgICAgaWYgJ1VzZXJfc3RvcmUnIGluIGRpcigpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICc9PT4gVXNlcl9zdG9yZSgpJyk7DQogICAgICAgICAgICBhbnN3ZXIgPSBVc2VyX3N0b3JlKHNlbGYsIF9fZXZlbnQsIGFuc3dlciwgX190b1N0cmluZyk7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KDQogICAgICAgICAgICANCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQoNCiAgICAgICAgcmV0dXJuIGFuc3dlcjsNCg0KICAgIA0KICAgIGRlZiBmaW5kQWxsKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6DQogICAgICAgIF9fdG9TdHJpbmcgPSAnVXNlcjo6ZmluZEFsbCgpOiAnOw0KICAgICAgICANCiAgICAgICAgZXZKU09OID0gTm9uZTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgZXZKU09OID0ganNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046DQogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOw0KICAgICAgICANCg0KICAgICAgICBhbnN3ZXIgPSBOb25lOw0KDQogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aWNrc19tcygpKSsnXS5Vc2VyLmZpbmRBbGwoKScpLm1ldGhvZCgnZmluZEFsbCcpLmNsYXNzTmFtZSgnVXNlcicpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7DQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KICAgICAgICANCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICBhbnN3ZXIgPSBVc2VyKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCiAgICAgICAgDQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KDQoNCg0KICAgICAgICBpZiAnVXNlcl9maW5kQWxsJyBpbiBkaXIoKToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnPT0+IFVzZXJfZmluZEFsbCgpJyk7DQogICAgICAgICAgICBhbnN3ZXIgPSBVc2VyX2ZpbmRBbGwoc2VsZiwgX19ldmVudCwgYW5zd2VyLCBfX3RvU3RyaW5nKTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCg0KICAgICAgICByZXR1cm4gYW5zd2VyOw0KDQogICAgDQogICAgZGVmIGZpbmQoc2VsZiwgX19ldmVudD1Ob25lKToNCiAgICAgICAgX190b1N0cmluZyA9ICdVc2VyOjpmaW5kKCk6ICc7DQogICAgICAgIA0KICAgICAgICBldkpTT04gPSBOb25lOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBldkpTT04gPSBqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoNCiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7DQogICAgICAgIA0KDQogICAgICAgIGFuc3dlciA9IE5vbmU7DQoNCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpY2tzX21zKCkpKyddLlVzZXIuZmluZCgpJykubWV0aG9kKCdmaW5kJykuY2xhc3NOYW1lKCdVc2VyJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOw0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsNCiAgICAgICAgDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQogICAgICAgIA0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgIGFuc3dlciA9IFVzZXIoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KICAgICAgICANCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQoNCg0KDQogICAgICAgIGlmICdVc2VyX2ZpbmQnIGluIGRpcigpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICc9PT4gVXNlcl9maW5kKCknKTsNCiAgICAgICAgICAgIGFuc3dlciA9IFVzZXJfZmluZChzZWxmLCBfX2V2ZW50LCBhbnN3ZXIsIF9fdG9TdHJpbmcpOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCg0KICAgICAgICAgICAgDQogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KDQogICAgICAgIHJldHVybiBhbnN3ZXI7DQoNCiAgICANCiAgICBkZWYgaW5pdChzZWxmLCBfX2V2ZW50PU5vbmUpOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ1VzZXI6OmluaXQoKTogJzsNCiAgICAgICAgDQogICAgICAgIGV2SlNPTiA9IE5vbmU7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIGV2SlNPTiA9IGpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOg0KICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsNCiAgICAgICAgDQoNCiAgICAgICAgYW5zd2VyID0gTm9uZTsNCg0KICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGlja3NfbXMoKSkrJ10uVXNlci5pbml0KCknKS5tZXRob2QoJ2luaXQnKS5jbGFzc05hbWUoJ1VzZXInKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOw0KICAgICAgICANCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCiAgICAgICAgDQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgYW5zd2VyID0gZXZKU09OOw0KICAgICAgICANCiAgICAgICAgDQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KDQoNCg0KICAgICAgICBpZiAnVXNlcl9pbml0JyBpbiBkaXIoKToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnPT0+IFVzZXJfaW5pdCgpJyk7DQogICAgICAgICAgICBhbnN3ZXIgPSBVc2VyX2luaXQoc2VsZiwgX19ldmVudCwgYW5zd2VyLCBfX3RvU3RyaW5nKTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChzdHIoYW5zd2VyKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCg0KICAgICAgICByZXR1cm4gYW5zd2VyOw0KDQogICAgDQoNCg0KY2xhc3MgQWN0aW9uX0V4ZWN1dGlvbigpOg0KICAgIGRlZiBfX2luaXRfXyhzZWxmLCBJZD1Ob25lLCBhY3RpdmU9Tm9uZSwgZW5hYmxlZD1Ob25lLCBjb2RlPU5vbmUsIG9yZGVyPU5vbmUsIGRhdGU9Tm9uZSwgbmFtZT1Ob25lLCByZW1hcms9Tm9uZSwgZGV2aWNlPU5vbmUsIGFjdGlvbj1Ob25lLCByZXN1bHQ9Tm9uZSwgY29tcGxldGVkPU5vbmUpOg0KICAgICAgICBzdXBlcigpLl9faW5pdF9fKCk7DQoNCiAgICAgICAgI3ByaW50KCdBY3Rpb25fRXhlY3V0aW9uOjpfX2luaXRfXygpJyk7DQogICAgICAgIGlmIElkIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgc2VsZi5JZCA9IElkOw0KDQogICAgICAgIA0KICAgICAgICBzZWxmLmFjdGl2ZShhY3RpdmUpOw0KICAgICAgICBzZWxmLmVuYWJsZWQoZW5hYmxlZCk7DQogICAgICAgIHNlbGYuY29kZShjb2RlKTsNCiAgICAgICAgc2VsZi5vcmRlcihvcmRlcik7DQogICAgICAgIHNlbGYuZGF0ZShkYXRlKTsNCiAgICAgICAgc2VsZi5uYW1lKG5hbWUpOw0KICAgICAgICBzZWxmLnJlbWFyayhyZW1hcmspOw0KICAgICAgICBzZWxmLmRldmljZShkZXZpY2UpOw0KICAgICAgICBzZWxmLmFjdGlvbihhY3Rpb24pOw0KICAgICAgICBzZWxmLnJlc3VsdChyZXN1bHQpOw0KICAgICAgICBzZWxmLmNvbXBsZXRlZChjb21wbGV0ZWQpOw0KICAgICAgICANCiAgICBJZCA9IE5vbmU7DQogICAgDQogICAgDQogICAgIyBhY3RpdmU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfYWN0aXZlID0gTm9uZTsNCiAgICBkZWYgYWN0aXZlKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2FjdGl2ZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9hY3RpdmU7DQoNCg0KICAgIA0KICAgICMgZW5hYmxlZDogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9lbmFibGVkID0gTm9uZTsNCiAgICBkZWYgZW5hYmxlZChzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9lbmFibGVkID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2VuYWJsZWQ7DQoNCg0KICAgIA0KICAgICMgY29kZTogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9jb2RlID0gTm9uZTsNCiAgICBkZWYgY29kZShzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9jb2RlID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2NvZGU7DQoNCg0KICAgIA0KICAgICMgb3JkZXI6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfb3JkZXIgPSBOb25lOw0KICAgIGRlZiBvcmRlcihzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9vcmRlciA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9vcmRlcjsNCg0KDQogICAgDQogICAgIyBkYXRlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2RhdGUgPSBOb25lOw0KICAgIGRlZiBkYXRlKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2RhdGUgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fZGF0ZTsNCg0KDQogICAgDQogICAgIyBuYW1lOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX25hbWUgPSBOb25lOw0KICAgIGRlZiBuYW1lKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX25hbWUgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fbmFtZTsNCg0KDQogICAgDQogICAgIyByZW1hcms6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfcmVtYXJrID0gTm9uZTsNCiAgICBkZWYgcmVtYXJrKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX3JlbWFyayA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9yZW1hcms7DQoNCg0KICAgIA0KICAgICMgZGV2aWNlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2RldmljZSA9IE5vbmU7DQogICAgZGVmIGRldmljZShzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9kZXZpY2UgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fZGV2aWNlOw0KDQoNCiAgICANCiAgICAjIGFjdGlvbjogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9hY3Rpb24gPSBOb25lOw0KICAgIGRlZiBhY3Rpb24oc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fYWN0aW9uID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2FjdGlvbjsNCg0KDQogICAgDQogICAgIyByZXN1bHQ6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfcmVzdWx0ID0gTm9uZTsNCiAgICBkZWYgcmVzdWx0KHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX3Jlc3VsdCA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9yZXN1bHQ7DQoNCg0KICAgIA0KICAgICMgY29tcGxldGVkOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2NvbXBsZXRlZCA9IE5vbmU7DQogICAgZGVmIGNvbXBsZXRlZChzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9jb21wbGV0ZWQgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fY29tcGxldGVkOw0KDQoNCiAgICANCiAgICANCiAgICBkZWYgX2Zyb21Eb2N1bWVudChzZWxmLCBvYmopOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ0FjdGlvbl9FeGVjdXRpb246Ol9mcm9tRG9jdW1lbnQoKTogJzsNCg0KICAgICAgICBpZiBvYmogaXMgTm9uZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICANCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIGJ5dGVzKToNCiAgICAgICAgICAgIG9iaiA9IHN0cihvYmosICJ1dGYtOCIpOw0KDQogICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLCBzdHIpIG9yIHR5cGUob2JqKSBpcyBzdHI6DQogICAgICAgICAgICBvYmogPSBqc29uLmxvYWRzKG9iaik7DQogICAgICAgIA0KICAgICAgICBpZiBub3QgaXNpbnN0YW5jZShvYmosIChzdHIsIGJ5dGVzLCBkaWN0KSk6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJ0dPVCBIRVJFOiAnICsgc3RyKHR5cGUob2JqKSkpOw0KICAgICAgICAgICAgcmV0dXJuIG9iajsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZm9yIGkgaW4gb2JqOg0KICAgICAgICAgICAgICAgIG9ialtpXSA9IEFjdGlvbl9FeGVjdXRpb24oKS5fZnJvbURvY3VtZW50KG9ialtpXSk7DQogICAgICAgICAgICByZXR1cm4gb2JqOw0KDQoNCiAgICAgICAgaWYgJ0lkJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLklkID0gb2JqWydJZCddOw0KDQogICAgDQogICAgICAgIGlmICdhY3RpdmUnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuYWN0aXZlKG9ialsnYWN0aXZlJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ2VuYWJsZWQnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuZW5hYmxlZChvYmpbJ2VuYWJsZWQnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnY29kZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5jb2RlKG9ialsnY29kZSddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdvcmRlcicgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5vcmRlcihvYmpbJ29yZGVyJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ2RhdGUnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuZGF0ZShvYmpbJ2RhdGUnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnbmFtZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5uYW1lKG9ialsnbmFtZSddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdyZW1hcmsnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYucmVtYXJrKG9ialsncmVtYXJrJ10pOw0KICAgICAgICANCiAgICAgICAgICAgIHNlbGYucmVtYXJrKCBiYXNlNjQuYjY0ZW5jb2RlKHNlbGYucmVtYXJrKCkuZW5jb2RlKCJhc2NpaSIpKS5kZWNvZGUoImFzY2lpIikgKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdkZXZpY2UnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuZGV2aWNlKERldmljZSgpLl9mcm9tRG9jdW1lbnQob2JqWydkZXZpY2UnXSkpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ2FjdGlvbicgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5hY3Rpb24oRGV2aWNlX0FjdGlvbigpLl9mcm9tRG9jdW1lbnQob2JqWydhY3Rpb24nXSkpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ3Jlc3VsdCcgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5yZXN1bHQob2JqWydyZXN1bHQnXSk7DQogICAgICAgIA0KICAgICAgICAgICAgc2VsZi5yZXN1bHQoIGJhc2U2NC5iNjRlbmNvZGUoc2VsZi5yZXN1bHQoKS5lbmNvZGUoImFzY2lpIikpLmRlY29kZSgiYXNjaWkiKSApOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ2NvbXBsZXRlZCcgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5jb21wbGV0ZWQob2JqWydjb21wbGV0ZWQnXSk7DQogICAgICAgIA0KICAgIA0KDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgDQogICAgZGVmIF90b0RvY3VtZW50KHNlbGYpOg0KICAgICAgICByZXQgPSB7fTsNCiAgICAgICAgaWYgc2VsZi5JZCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiSWQiXSA9IHNlbGYuSWQ7DQoNCiAgICANCiAgICAgICAgaWYgc2VsZi5hY3RpdmUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiYWN0aXZlIl0gPSBzZWxmLmFjdGl2ZSgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5lbmFibGVkKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbImVuYWJsZWQiXSA9IHNlbGYuZW5hYmxlZCgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5jb2RlKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbImNvZGUiXSA9IHNlbGYuY29kZSgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5vcmRlcigpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJvcmRlciJdID0gc2VsZi5vcmRlcigpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5kYXRlKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbImRhdGUiXSA9IHNlbGYuZGF0ZSgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5uYW1lKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbIm5hbWUiXSA9IHNlbGYubmFtZSgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5yZW1hcmsoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSBzZWxmLnJlbWFyaygpOw0KICAgICAgICANCiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UocmV0WyJyZW1hcmsiXSwgZGljdCk6DQogICAgICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IGpzb24uZHVtcHMocmV0WyJyZW1hcmsiXSk7DQogICAgICAgICAgICByZXRbInJlbWFyayJdID0gdWJpbmFzY2lpLmIyYV9iYXNlNjQocmV0WyJyZW1hcmsiXSkuc3RyaXAoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYuZGV2aWNlKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbImRldmljZSJdID0gc2VsZi5kZXZpY2UoKS5fdG9Eb2N1bWVudCgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5hY3Rpb24oKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiYWN0aW9uIl0gPSBzZWxmLmFjdGlvbigpLl90b0RvY3VtZW50KCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLnJlc3VsdCgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJyZXN1bHQiXSA9IHNlbGYucmVzdWx0KCk7DQogICAgICAgIA0KICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShyZXRbInJlc3VsdCJdLCBkaWN0KToNCiAgICAgICAgICAgICAgICByZXRbInJlc3VsdCJdID0ganNvbi5kdW1wcyhyZXRbInJlc3VsdCJdKTsNCiAgICAgICAgICAgIHJldFsicmVzdWx0Il0gPSB1YmluYXNjaWkuYjJhX2Jhc2U2NChyZXRbInJlc3VsdCJdKS5zdHJpcCgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5jb21wbGV0ZWQoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiY29tcGxldGVkIl0gPSBzZWxmLmNvbXBsZXRlZCgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgcmV0dXJuIHJldDsNCg0KICAgIA0KICAgIGRlZiBzdG9yZShzZWxmLCBfX2V2ZW50PU5vbmUpOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ0FjdGlvbl9FeGVjdXRpb246OnN0b3JlKCk6ICc7DQogICAgICAgIA0KICAgICAgICBldkpTT04gPSBOb25lOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBldkpTT04gPSBqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoNCiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7DQogICAgICAgIA0KDQogICAgICAgIGFuc3dlciA9IE5vbmU7DQoNCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpY2tzX21zKCkpKyddLkFjdGlvbl9FeGVjdXRpb24uc3RvcmUoKScpLm1ldGhvZCgnc3RvcmUnKS5jbGFzc05hbWUoJ0FjdGlvbl9FeGVjdXRpb24nKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOw0KICAgICAgICANCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCiAgICAgICAgDQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgYW5zd2VyID0gQWN0aW9uX0V4ZWN1dGlvbigpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQogICAgICAgIA0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCg0KDQoNCiAgICAgICAgaWYgJ0FjdGlvbl9FeGVjdXRpb25fc3RvcmUnIGluIGRpcigpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICc9PT4gQWN0aW9uX0V4ZWN1dGlvbl9zdG9yZSgpJyk7DQogICAgICAgICAgICBhbnN3ZXIgPSBBY3Rpb25fRXhlY3V0aW9uX3N0b3JlKHNlbGYsIF9fZXZlbnQsIGFuc3dlciwgX190b1N0cmluZyk7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KDQogICAgICAgICAgICANCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQoNCiAgICAgICAgcmV0dXJuIGFuc3dlcjsNCg0KICAgIA0KICAgIGRlZiBmaW5kQWxsKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6DQogICAgICAgIF9fdG9TdHJpbmcgPSAnQWN0aW9uX0V4ZWN1dGlvbjo6ZmluZEFsbCgpOiAnOw0KICAgICAgICANCiAgICAgICAgZXZKU09OID0gTm9uZTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgZXZKU09OID0ganNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046DQogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOw0KICAgICAgICANCg0KICAgICAgICBhbnN3ZXIgPSBOb25lOw0KDQogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aWNrc19tcygpKSsnXS5BY3Rpb25fRXhlY3V0aW9uLmZpbmRBbGwoKScpLm1ldGhvZCgnZmluZEFsbCcpLmNsYXNzTmFtZSgnQWN0aW9uX0V4ZWN1dGlvbicpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7DQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KICAgICAgICANCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICBhbnN3ZXIgPSBBY3Rpb25fRXhlY3V0aW9uKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCiAgICAgICAgDQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KDQoNCg0KICAgICAgICBpZiAnQWN0aW9uX0V4ZWN1dGlvbl9maW5kQWxsJyBpbiBkaXIoKToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnPT0+IEFjdGlvbl9FeGVjdXRpb25fZmluZEFsbCgpJyk7DQogICAgICAgICAgICBhbnN3ZXIgPSBBY3Rpb25fRXhlY3V0aW9uX2ZpbmRBbGwoc2VsZiwgX19ldmVudCwgYW5zd2VyLCBfX3RvU3RyaW5nKTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCg0KICAgICAgICByZXR1cm4gYW5zd2VyOw0KDQogICAgDQogICAgZGVmIGZpbmQoc2VsZiwgX19ldmVudD1Ob25lKToNCiAgICAgICAgX190b1N0cmluZyA9ICdBY3Rpb25fRXhlY3V0aW9uOjpmaW5kKCk6ICc7DQogICAgICAgIA0KICAgICAgICBldkpTT04gPSBOb25lOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBldkpTT04gPSBqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoNCiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7DQogICAgICAgIA0KDQogICAgICAgIGFuc3dlciA9IE5vbmU7DQoNCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpY2tzX21zKCkpKyddLkFjdGlvbl9FeGVjdXRpb24uZmluZCgpJykubWV0aG9kKCdmaW5kJykuY2xhc3NOYW1lKCdBY3Rpb25fRXhlY3V0aW9uJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOw0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsNCiAgICAgICAgDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQogICAgICAgIA0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgIGFuc3dlciA9IEFjdGlvbl9FeGVjdXRpb24oKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KICAgICAgICANCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJjb21wbGV0ZWQ9IithbnN3ZXIuY29tcGxldGVkKCkpOwogICAgICAgICAgICAjIGlmIGFuZCBhbnN3ZXIucmVzdWx0KCkgaXMgTm9uZSBhbmQgYW5zd2VyLmNvbXBsZXRlZCgpIGlzIE5vbmUgYW5kIGFuc3dlci5hY3Rpb24oKS5zY3JpcHQoKSBpcyBub3QgTm9uZQogICAgICAgICAgICAjcHJpbnQoX190b1N0cmluZyArIGFuc3dlci5hY3Rpb24oKS5jb2RlKCkgKyAnIGlzIGV4ZWN1dGluZycpOwoJICAgIA0KDQoNCiAgICAgICAgaWYgJ0FjdGlvbl9FeGVjdXRpb25fZmluZCcgaW4gZGlyKCk6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJz09PiBBY3Rpb25fRXhlY3V0aW9uX2ZpbmQoKScpOw0KICAgICAgICAgICAgYW5zd2VyID0gQWN0aW9uX0V4ZWN1dGlvbl9maW5kKHNlbGYsIF9fZXZlbnQsIGFuc3dlciwgX190b1N0cmluZyk7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KDQogICAgICAgICAgICANCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQoNCiAgICAgICAgcmV0dXJuIGFuc3dlcjsNCg0KICAgIA0KDQoNCmNsYXNzIERldmljZV9BY3Rpb24oKToNCiAgICBkZWYgX19pbml0X18oc2VsZiwgSWQ9Tm9uZSwgYWN0aXZlPU5vbmUsIGVuYWJsZWQ9Tm9uZSwgY29kZT1Ob25lLCBvcmRlcj1Ob25lLCBkYXRlPU5vbmUsIG5hbWU9Tm9uZSwgcmVtYXJrPU5vbmUsIHNjcmlwdD1Ob25lLCB0eXBlPU5vbmUpOg0KICAgICAgICBzdXBlcigpLl9faW5pdF9fKCk7DQoNCiAgICAgICAgI3ByaW50KCdEZXZpY2VfQWN0aW9uOjpfX2luaXRfXygpJyk7DQogICAgICAgIGlmIElkIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgc2VsZi5JZCA9IElkOw0KDQogICAgICAgIA0KICAgICAgICBzZWxmLmFjdGl2ZShhY3RpdmUpOw0KICAgICAgICBzZWxmLmVuYWJsZWQoZW5hYmxlZCk7DQogICAgICAgIHNlbGYuY29kZShjb2RlKTsNCiAgICAgICAgc2VsZi5vcmRlcihvcmRlcik7DQogICAgICAgIHNlbGYuZGF0ZShkYXRlKTsNCiAgICAgICAgc2VsZi5uYW1lKG5hbWUpOw0KICAgICAgICBzZWxmLnJlbWFyayhyZW1hcmspOw0KICAgICAgICBzZWxmLnNjcmlwdChzY3JpcHQpOw0KICAgICAgICBzZWxmLnR5cGUodHlwZSk7DQogICAgICAgIA0KICAgIElkID0gTm9uZTsNCiAgICANCiAgICANCiAgICAjIGFjdGl2ZTogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9hY3RpdmUgPSBOb25lOw0KICAgIGRlZiBhY3RpdmUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fYWN0aXZlID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2FjdGl2ZTsNCg0KDQogICAgDQogICAgIyBlbmFibGVkOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2VuYWJsZWQgPSBOb25lOw0KICAgIGRlZiBlbmFibGVkKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2VuYWJsZWQgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fZW5hYmxlZDsNCg0KDQogICAgDQogICAgIyBjb2RlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2NvZGUgPSBOb25lOw0KICAgIGRlZiBjb2RlKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2NvZGUgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fY29kZTsNCg0KDQogICAgDQogICAgIyBvcmRlcjogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9vcmRlciA9IE5vbmU7DQogICAgZGVmIG9yZGVyKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX29yZGVyID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX29yZGVyOw0KDQoNCiAgICANCiAgICAjIGRhdGU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfZGF0ZSA9IE5vbmU7DQogICAgZGVmIGRhdGUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fZGF0ZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9kYXRlOw0KDQoNCiAgICANCiAgICAjIG5hbWU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfbmFtZSA9IE5vbmU7DQogICAgZGVmIG5hbWUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fbmFtZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9uYW1lOw0KDQoNCiAgICANCiAgICAjIHJlbWFyazogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9yZW1hcmsgPSBOb25lOw0KICAgIGRlZiByZW1hcmsoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fcmVtYXJrID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3JlbWFyazsNCg0KDQogICAgDQogICAgIyBzY3JpcHQ6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfc2NyaXB0ID0gTm9uZTsNCiAgICBkZWYgc2NyaXB0KHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX3NjcmlwdCA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9zY3JpcHQ7DQoNCg0KICAgIA0KICAgICMgdHlwZTogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF90eXBlID0gTm9uZTsNCiAgICBkZWYgdHlwZShzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl90eXBlID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3R5cGU7DQoNCg0KICAgIA0KICAgIA0KICAgIGRlZiBfZnJvbURvY3VtZW50KHNlbGYsIG9iaik6DQogICAgICAgIF9fdG9TdHJpbmcgPSAnRGV2aWNlX0FjdGlvbjo6X2Zyb21Eb2N1bWVudCgpOiAnOw0KDQogICAgICAgIGlmIG9iaiBpcyBOb25lOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIA0KICAgICAgICBpZiBpc2luc3RhbmNlKG9iaiwgYnl0ZXMpOg0KICAgICAgICAgICAgb2JqID0gc3RyKG9iaiwgInV0Zi04Iik7DQoNCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIHN0cikgb3IgdHlwZShvYmopIGlzIHN0cjoNCiAgICAgICAgICAgIG9iaiA9IGpzb24ubG9hZHMob2JqKTsNCiAgICAgICAgDQogICAgICAgIGlmIG5vdCBpc2luc3RhbmNlKG9iaiwgKHN0ciwgYnl0ZXMsIGRpY3QpKToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnR09UIEhFUkU6ICcgKyBzdHIodHlwZShvYmopKSk7DQogICAgICAgICAgICByZXR1cm4gb2JqOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBmb3IgaSBpbiBvYmo6DQogICAgICAgICAgICAgICAgb2JqW2ldID0gRGV2aWNlX0FjdGlvbigpLl9mcm9tRG9jdW1lbnQob2JqW2ldKTsNCiAgICAgICAgICAgIHJldHVybiBvYmo7DQoNCg0KICAgICAgICBpZiAnSWQnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuSWQgPSBvYmpbJ0lkJ107DQoNCiAgICANCiAgICAgICAgaWYgJ2FjdGl2ZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5hY3RpdmUob2JqWydhY3RpdmUnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnZW5hYmxlZCcgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5lbmFibGVkKG9ialsnZW5hYmxlZCddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdjb2RlJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmNvZGUob2JqWydjb2RlJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ29yZGVyJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLm9yZGVyKG9ialsnb3JkZXInXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnZGF0ZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5kYXRlKG9ialsnZGF0ZSddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICduYW1lJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLm5hbWUob2JqWyduYW1lJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ3JlbWFyaycgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5yZW1hcmsob2JqWydyZW1hcmsnXSk7DQogICAgICAgIA0KICAgICAgICAgICAgc2VsZi5yZW1hcmsoIGJhc2U2NC5iNjRlbmNvZGUoc2VsZi5yZW1hcmsoKS5lbmNvZGUoImFzY2lpIikpLmRlY29kZSgiYXNjaWkiKSApOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ3NjcmlwdCcgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5zY3JpcHQob2JqWydzY3JpcHQnXSk7DQogICAgICAgIA0KICAgICAgICAgICAgc2VsZi5zY3JpcHQoIGJhc2U2NC5iNjRlbmNvZGUoc2VsZi5zY3JpcHQoKS5lbmNvZGUoImFzY2lpIikpLmRlY29kZSgiYXNjaWkiKSApOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ3R5cGUnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYudHlwZShEZXZpY2VfVHlwZSgpLl9mcm9tRG9jdW1lbnQob2JqWyd0eXBlJ10pKTsNCiAgICAgICAgDQogICAgDQoNCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICByZXR1cm4gc2VsZjsNCiAgICANCiAgICBkZWYgX3RvRG9jdW1lbnQoc2VsZik6DQogICAgICAgIHJldCA9IHt9Ow0KICAgICAgICBpZiBzZWxmLklkIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJJZCJdID0gc2VsZi5JZDsNCg0KICAgIA0KICAgICAgICBpZiBzZWxmLmFjdGl2ZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJhY3RpdmUiXSA9IHNlbGYuYWN0aXZlKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmVuYWJsZWQoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiZW5hYmxlZCJdID0gc2VsZi5lbmFibGVkKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmNvZGUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiY29kZSJdID0gc2VsZi5jb2RlKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLm9yZGVyKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbIm9yZGVyIl0gPSBzZWxmLm9yZGVyKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmRhdGUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiZGF0ZSJdID0gc2VsZi5kYXRlKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLm5hbWUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsibmFtZSJdID0gc2VsZi5uYW1lKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLnJlbWFyaygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IHNlbGYucmVtYXJrKCk7DQogICAgICAgIA0KICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShyZXRbInJlbWFyayJdLCBkaWN0KToNCiAgICAgICAgICAgICAgICByZXRbInJlbWFyayJdID0ganNvbi5kdW1wcyhyZXRbInJlbWFyayJdKTsNCiAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSB1YmluYXNjaWkuYjJhX2Jhc2U2NChyZXRbInJlbWFyayJdKS5zdHJpcCgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5zY3JpcHQoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsic2NyaXB0Il0gPSBzZWxmLnNjcmlwdCgpOw0KICAgICAgICANCiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UocmV0WyJzY3JpcHQiXSwgZGljdCk6DQogICAgICAgICAgICAgICAgcmV0WyJzY3JpcHQiXSA9IGpzb24uZHVtcHMocmV0WyJzY3JpcHQiXSk7DQogICAgICAgICAgICByZXRbInNjcmlwdCJdID0gdWJpbmFzY2lpLmIyYV9iYXNlNjQocmV0WyJzY3JpcHQiXSkuc3RyaXAoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYudHlwZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJ0eXBlIl0gPSBzZWxmLnR5cGUoKS5fdG9Eb2N1bWVudCgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgcmV0dXJuIHJldDsNCg0KICAgIA0KICAgIGRlZiBzdG9yZShzZWxmLCBfX2V2ZW50PU5vbmUpOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ0RldmljZV9BY3Rpb246OnN0b3JlKCk6ICc7DQogICAgICAgIA0KICAgICAgICBldkpTT04gPSBOb25lOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBldkpTT04gPSBqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoNCiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7DQogICAgICAgIA0KDQogICAgICAgIGFuc3dlciA9IE5vbmU7DQoNCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpY2tzX21zKCkpKyddLkRldmljZV9BY3Rpb24uc3RvcmUoKScpLm1ldGhvZCgnc3RvcmUnKS5jbGFzc05hbWUoJ0RldmljZV9BY3Rpb24nKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOw0KICAgICAgICANCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCiAgICAgICAgDQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgYW5zd2VyID0gRGV2aWNlX0FjdGlvbigpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQogICAgICAgIA0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCg0KDQoNCiAgICAgICAgaWYgJ0RldmljZV9BY3Rpb25fc3RvcmUnIGluIGRpcigpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICc9PT4gRGV2aWNlX0FjdGlvbl9zdG9yZSgpJyk7DQogICAgICAgICAgICBhbnN3ZXIgPSBEZXZpY2VfQWN0aW9uX3N0b3JlKHNlbGYsIF9fZXZlbnQsIGFuc3dlciwgX190b1N0cmluZyk7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KDQogICAgICAgICAgICANCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQoNCiAgICAgICAgcmV0dXJuIGFuc3dlcjsNCg0KICAgIA0KICAgIGRlZiBmaW5kQWxsKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6DQogICAgICAgIF9fdG9TdHJpbmcgPSAnRGV2aWNlX0FjdGlvbjo6ZmluZEFsbCgpOiAnOw0KICAgICAgICANCiAgICAgICAgZXZKU09OID0gTm9uZTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgZXZKU09OID0ganNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046DQogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOw0KICAgICAgICANCg0KICAgICAgICBhbnN3ZXIgPSBOb25lOw0KDQogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aWNrc19tcygpKSsnXS5EZXZpY2VfQWN0aW9uLmZpbmRBbGwoKScpLm1ldGhvZCgnZmluZEFsbCcpLmNsYXNzTmFtZSgnRGV2aWNlX0FjdGlvbicpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7DQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KICAgICAgICANCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICBhbnN3ZXIgPSBEZXZpY2VfQWN0aW9uKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCiAgICAgICAgDQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KDQoNCg0KICAgICAgICBpZiAnRGV2aWNlX0FjdGlvbl9maW5kQWxsJyBpbiBkaXIoKToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnPT0+IERldmljZV9BY3Rpb25fZmluZEFsbCgpJyk7DQogICAgICAgICAgICBhbnN3ZXIgPSBEZXZpY2VfQWN0aW9uX2ZpbmRBbGwoc2VsZiwgX19ldmVudCwgYW5zd2VyLCBfX3RvU3RyaW5nKTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCg0KICAgICAgICByZXR1cm4gYW5zd2VyOw0KDQogICAgDQogICAgZGVmIGZpbmQoc2VsZiwgX19ldmVudD1Ob25lKToNCiAgICAgICAgX190b1N0cmluZyA9ICdEZXZpY2VfQWN0aW9uOjpmaW5kKCk6ICc7DQogICAgICAgIA0KICAgICAgICBldkpTT04gPSBOb25lOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBldkpTT04gPSBqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoNCiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7DQogICAgICAgIA0KDQogICAgICAgIGFuc3dlciA9IE5vbmU7DQoNCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpY2tzX21zKCkpKyddLkRldmljZV9BY3Rpb24uZmluZCgpJykubWV0aG9kKCdmaW5kJykuY2xhc3NOYW1lKCdEZXZpY2VfQWN0aW9uJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOw0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsNCiAgICAgICAgDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQogICAgICAgIA0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgIGFuc3dlciA9IERldmljZV9BY3Rpb24oKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KICAgICAgICANCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQoNCg0KDQogICAgICAgIGlmICdEZXZpY2VfQWN0aW9uX2ZpbmQnIGluIGRpcigpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICc9PT4gRGV2aWNlX0FjdGlvbl9maW5kKCknKTsNCiAgICAgICAgICAgIGFuc3dlciA9IERldmljZV9BY3Rpb25fZmluZChzZWxmLCBfX2V2ZW50LCBhbnN3ZXIsIF9fdG9TdHJpbmcpOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCg0KICAgICAgICAgICAgDQogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KDQogICAgICAgIHJldHVybiBhbnN3ZXI7DQoNCiAgICANCg0KDQpjbGFzcyBEZXZpY2UoKToNCiAgICBkZWYgX19pbml0X18oc2VsZiwgSWQ9Tm9uZSwgYWN0aXZlPU5vbmUsIGVuYWJsZWQ9Tm9uZSwgY29kZT1Ob25lLCBvcmRlcj1Ob25lLCBkYXRlPU5vbmUsIG5hbWU9Tm9uZSwgcmVtYXJrPU5vbmUsIHR5cGU9Tm9uZSwgY29udHJvbGxlcj1Ob25lKToNCiAgICAgICAgc3VwZXIoKS5fX2luaXRfXygpOw0KDQogICAgICAgICNwcmludCgnRGV2aWNlOjpfX2luaXRfXygpJyk7DQogICAgICAgIGlmIElkIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgc2VsZi5JZCA9IElkOw0KDQogICAgICAgIA0KICAgICAgICBzZWxmLmFjdGl2ZShhY3RpdmUpOw0KICAgICAgICBzZWxmLmVuYWJsZWQoZW5hYmxlZCk7DQogICAgICAgIHNlbGYuY29kZShjb2RlKTsNCiAgICAgICAgc2VsZi5vcmRlcihvcmRlcik7DQogICAgICAgIHNlbGYuZGF0ZShkYXRlKTsNCiAgICAgICAgc2VsZi5uYW1lKG5hbWUpOw0KICAgICAgICBzZWxmLnJlbWFyayhyZW1hcmspOw0KICAgICAgICBzZWxmLnR5cGUodHlwZSk7DQogICAgICAgIHNlbGYuY29udHJvbGxlcihjb250cm9sbGVyKTsNCiAgICAgICAgDQogICAgSWQgPSBOb25lOw0KICAgIA0KICAgIA0KICAgICMgYWN0aXZlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2FjdGl2ZSA9IE5vbmU7DQogICAgZGVmIGFjdGl2ZShzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9hY3RpdmUgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fYWN0aXZlOw0KDQoNCiAgICANCiAgICAjIGVuYWJsZWQ6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfZW5hYmxlZCA9IE5vbmU7DQogICAgZGVmIGVuYWJsZWQoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fZW5hYmxlZCA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9lbmFibGVkOw0KDQoNCiAgICANCiAgICAjIGNvZGU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfY29kZSA9IE5vbmU7DQogICAgZGVmIGNvZGUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fY29kZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9jb2RlOw0KDQoNCiAgICANCiAgICAjIG9yZGVyOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX29yZGVyID0gTm9uZTsNCiAgICBkZWYgb3JkZXIoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fb3JkZXIgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fb3JkZXI7DQoNCg0KICAgIA0KICAgICMgZGF0ZTogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9kYXRlID0gTm9uZTsNCiAgICBkZWYgZGF0ZShzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9kYXRlID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2RhdGU7DQoNCg0KICAgIA0KICAgICMgbmFtZTogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9uYW1lID0gTm9uZTsNCiAgICBkZWYgbmFtZShzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9uYW1lID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX25hbWU7DQoNCg0KICAgIA0KICAgICMgcmVtYXJrOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX3JlbWFyayA9IE5vbmU7DQogICAgZGVmIHJlbWFyayhzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9yZW1hcmsgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fcmVtYXJrOw0KDQoNCiAgICANCiAgICAjIHR5cGU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfdHlwZSA9IE5vbmU7DQogICAgZGVmIHR5cGUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fdHlwZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl90eXBlOw0KDQoNCiAgICANCiAgICAjIGNvbnRyb2xsZXI6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfY29udHJvbGxlciA9IE5vbmU7DQogICAgZGVmIGNvbnRyb2xsZXIoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fY29udHJvbGxlciA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9jb250cm9sbGVyOw0KDQoNCiAgICANCiAgICANCiAgICBkZWYgX2Zyb21Eb2N1bWVudChzZWxmLCBvYmopOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ0RldmljZTo6X2Zyb21Eb2N1bWVudCgpOiAnOw0KDQogICAgICAgIGlmIG9iaiBpcyBOb25lOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIA0KICAgICAgICBpZiBpc2luc3RhbmNlKG9iaiwgYnl0ZXMpOg0KICAgICAgICAgICAgb2JqID0gc3RyKG9iaiwgInV0Zi04Iik7DQoNCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIHN0cikgb3IgdHlwZShvYmopIGlzIHN0cjoNCiAgICAgICAgICAgIG9iaiA9IGpzb24ubG9hZHMob2JqKTsNCiAgICAgICAgDQogICAgICAgIGlmIG5vdCBpc2luc3RhbmNlKG9iaiwgKHN0ciwgYnl0ZXMsIGRpY3QpKToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnR09UIEhFUkU6ICcgKyBzdHIodHlwZShvYmopKSk7DQogICAgICAgICAgICByZXR1cm4gb2JqOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBmb3IgaSBpbiBvYmo6DQogICAgICAgICAgICAgICAgb2JqW2ldID0gRGV2aWNlKCkuX2Zyb21Eb2N1bWVudChvYmpbaV0pOw0KICAgICAgICAgICAgcmV0dXJuIG9iajsNCg0KDQogICAgICAgIGlmICdJZCcgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5JZCA9IG9ialsnSWQnXTsNCg0KICAgIA0KICAgICAgICBpZiAnYWN0aXZlJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmFjdGl2ZShvYmpbJ2FjdGl2ZSddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdlbmFibGVkJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmVuYWJsZWQob2JqWydlbmFibGVkJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ2NvZGUnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuY29kZShvYmpbJ2NvZGUnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnb3JkZXInIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYub3JkZXIob2JqWydvcmRlciddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdkYXRlJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmRhdGUob2JqWydkYXRlJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ25hbWUnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYubmFtZShvYmpbJ25hbWUnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAncmVtYXJrJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLnJlbWFyayhvYmpbJ3JlbWFyayddKTsNCiAgICAgICAgDQogICAgICAgICAgICBzZWxmLnJlbWFyayggYmFzZTY0LmI2NGVuY29kZShzZWxmLnJlbWFyaygpLmVuY29kZSgiYXNjaWkiKSkuZGVjb2RlKCJhc2NpaSIpICk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAndHlwZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi50eXBlKERldmljZV9UeXBlKCkuX2Zyb21Eb2N1bWVudChvYmpbJ3R5cGUnXSkpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ2NvbnRyb2xsZXInIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuY29udHJvbGxlcihOb2RlKCkuX2Zyb21Eb2N1bWVudChvYmpbJ2NvbnRyb2xsZXInXSkpOw0KICAgICAgICANCiAgICANCg0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIHJldHVybiBzZWxmOw0KICAgIA0KICAgIGRlZiBfdG9Eb2N1bWVudChzZWxmKToNCiAgICAgICAgcmV0ID0ge307DQogICAgICAgIGlmIHNlbGYuSWQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbIklkIl0gPSBzZWxmLklkOw0KDQogICAgDQogICAgICAgIGlmIHNlbGYuYWN0aXZlKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbImFjdGl2ZSJdID0gc2VsZi5hY3RpdmUoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYuZW5hYmxlZCgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJlbmFibGVkIl0gPSBzZWxmLmVuYWJsZWQoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYuY29kZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJjb2RlIl0gPSBzZWxmLmNvZGUoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYub3JkZXIoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsib3JkZXIiXSA9IHNlbGYub3JkZXIoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYuZGF0ZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJkYXRlIl0gPSBzZWxmLmRhdGUoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYubmFtZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJuYW1lIl0gPSBzZWxmLm5hbWUoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYucmVtYXJrKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbInJlbWFyayJdID0gc2VsZi5yZW1hcmsoKTsNCiAgICAgICAgDQogICAgICAgICAgICBpZiBpc2luc3RhbmNlKHJldFsicmVtYXJrIl0sIGRpY3QpOg0KICAgICAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSBqc29uLmR1bXBzKHJldFsicmVtYXJrIl0pOw0KICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IHViaW5hc2NpaS5iMmFfYmFzZTY0KHJldFsicmVtYXJrIl0pLnN0cmlwKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLnR5cGUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsidHlwZSJdID0gc2VsZi50eXBlKCkuX3RvRG9jdW1lbnQoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYuY29udHJvbGxlcigpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJjb250cm9sbGVyIl0gPSBzZWxmLmNvbnRyb2xsZXIoKS5fdG9Eb2N1bWVudCgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgcmV0dXJuIHJldDsNCg0KICAgIA0KICAgIGRlZiBzdG9yZShzZWxmLCBfX2V2ZW50PU5vbmUpOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ0RldmljZTo6c3RvcmUoKTogJzsNCiAgICAgICAgDQogICAgICAgIGV2SlNPTiA9IE5vbmU7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIGV2SlNPTiA9IGpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOg0KICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsNCiAgICAgICAgDQoNCiAgICAgICAgYW5zd2VyID0gTm9uZTsNCg0KICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGlja3NfbXMoKSkrJ10uRGV2aWNlLnN0b3JlKCknKS5tZXRob2QoJ3N0b3JlJykuY2xhc3NOYW1lKCdEZXZpY2UnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOw0KICAgICAgICANCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCiAgICAgICAgDQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgYW5zd2VyID0gRGV2aWNlKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCiAgICAgICAgDQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KDQoNCg0KICAgICAgICBpZiAnRGV2aWNlX3N0b3JlJyBpbiBkaXIoKToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnPT0+IERldmljZV9zdG9yZSgpJyk7DQogICAgICAgICAgICBhbnN3ZXIgPSBEZXZpY2Vfc3RvcmUoc2VsZiwgX19ldmVudCwgYW5zd2VyLCBfX3RvU3RyaW5nKTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCg0KICAgICAgICByZXR1cm4gYW5zd2VyOw0KDQogICAgDQogICAgZGVmIGZpbmRBbGwoc2VsZiwgX19ldmVudD1Ob25lKToNCiAgICAgICAgX190b1N0cmluZyA9ICdEZXZpY2U6OmZpbmRBbGwoKTogJzsNCiAgICAgICAgDQogICAgICAgIGV2SlNPTiA9IE5vbmU7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIGV2SlNPTiA9IGpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOg0KICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsNCiAgICAgICAgDQoNCiAgICAgICAgYW5zd2VyID0gTm9uZTsNCg0KICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGlja3NfbXMoKSkrJ10uRGV2aWNlLmZpbmRBbGwoKScpLm1ldGhvZCgnZmluZEFsbCcpLmNsYXNzTmFtZSgnRGV2aWNlJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOw0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsNCiAgICAgICAgDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQogICAgICAgIA0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgIGFuc3dlciA9IERldmljZSgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQogICAgICAgIA0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCg0KDQoNCiAgICAgICAgaWYgJ0RldmljZV9maW5kQWxsJyBpbiBkaXIoKToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnPT0+IERldmljZV9maW5kQWxsKCknKTsNCiAgICAgICAgICAgIGFuc3dlciA9IERldmljZV9maW5kQWxsKHNlbGYsIF9fZXZlbnQsIGFuc3dlciwgX190b1N0cmluZyk7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KDQogICAgICAgICAgICANCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQoNCiAgICAgICAgcmV0dXJuIGFuc3dlcjsNCg0KICAgIA0KICAgIGRlZiBmaW5kKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6DQogICAgICAgIF9fdG9TdHJpbmcgPSAnRGV2aWNlOjpmaW5kKCk6ICc7DQogICAgICAgIA0KICAgICAgICBldkpTT04gPSBOb25lOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBldkpTT04gPSBqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoNCiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7DQogICAgICAgIA0KDQogICAgICAgIGFuc3dlciA9IE5vbmU7DQoNCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpY2tzX21zKCkpKyddLkRldmljZS5maW5kKCknKS5tZXRob2QoJ2ZpbmQnKS5jbGFzc05hbWUoJ0RldmljZScpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7DQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KICAgICAgICANCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICBhbnN3ZXIgPSBEZXZpY2UoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KICAgICAgICANCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQoNCg0KDQogICAgICAgIGlmICdEZXZpY2VfZmluZCcgaW4gZGlyKCk6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJz09PiBEZXZpY2VfZmluZCgpJyk7DQogICAgICAgICAgICBhbnN3ZXIgPSBEZXZpY2VfZmluZChzZWxmLCBfX2V2ZW50LCBhbnN3ZXIsIF9fdG9TdHJpbmcpOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCg0KICAgICAgICAgICAgDQogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KDQogICAgICAgIHJldHVybiBhbnN3ZXI7DQoNCiAgICANCg0KDQpjbGFzcyBEZXZpY2VfQ2F0ZWdvcnkoKToNCiAgICBkZWYgX19pbml0X18oc2VsZiwgSWQ9Tm9uZSwgYWN0aXZlPU5vbmUsIGVuYWJsZWQ9Tm9uZSwgY29kZT1Ob25lLCBvcmRlcj1Ob25lLCBkYXRlPU5vbmUsIG5hbWU9Tm9uZSwgcmVtYXJrPU5vbmUsIHBhcmVudD1Ob25lKToNCiAgICAgICAgc3VwZXIoKS5fX2luaXRfXygpOw0KDQogICAgICAgICNwcmludCgnRGV2aWNlX0NhdGVnb3J5OjpfX2luaXRfXygpJyk7DQogICAgICAgIGlmIElkIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgc2VsZi5JZCA9IElkOw0KDQogICAgICAgIA0KICAgICAgICBzZWxmLmFjdGl2ZShhY3RpdmUpOw0KICAgICAgICBzZWxmLmVuYWJsZWQoZW5hYmxlZCk7DQogICAgICAgIHNlbGYuY29kZShjb2RlKTsNCiAgICAgICAgc2VsZi5vcmRlcihvcmRlcik7DQogICAgICAgIHNlbGYuZGF0ZShkYXRlKTsNCiAgICAgICAgc2VsZi5uYW1lKG5hbWUpOw0KICAgICAgICBzZWxmLnJlbWFyayhyZW1hcmspOw0KICAgICAgICBzZWxmLnBhcmVudChwYXJlbnQpOw0KICAgICAgICANCiAgICBJZCA9IE5vbmU7DQogICAgDQogICAgDQogICAgIyBhY3RpdmU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfYWN0aXZlID0gTm9uZTsNCiAgICBkZWYgYWN0aXZlKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2FjdGl2ZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9hY3RpdmU7DQoNCg0KICAgIA0KICAgICMgZW5hYmxlZDogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9lbmFibGVkID0gTm9uZTsNCiAgICBkZWYgZW5hYmxlZChzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9lbmFibGVkID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2VuYWJsZWQ7DQoNCg0KICAgIA0KICAgICMgY29kZTogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9jb2RlID0gTm9uZTsNCiAgICBkZWYgY29kZShzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9jb2RlID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2NvZGU7DQoNCg0KICAgIA0KICAgICMgb3JkZXI6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfb3JkZXIgPSBOb25lOw0KICAgIGRlZiBvcmRlcihzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9vcmRlciA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9vcmRlcjsNCg0KDQogICAgDQogICAgIyBkYXRlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2RhdGUgPSBOb25lOw0KICAgIGRlZiBkYXRlKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2RhdGUgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fZGF0ZTsNCg0KDQogICAgDQogICAgIyBuYW1lOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX25hbWUgPSBOb25lOw0KICAgIGRlZiBuYW1lKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX25hbWUgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fbmFtZTsNCg0KDQogICAgDQogICAgIyByZW1hcms6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfcmVtYXJrID0gTm9uZTsNCiAgICBkZWYgcmVtYXJrKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX3JlbWFyayA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9yZW1hcms7DQoNCg0KICAgIA0KICAgICMgcGFyZW50OiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX3BhcmVudCA9IE5vbmU7DQogICAgZGVmIHBhcmVudChzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9wYXJlbnQgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fcGFyZW50Ow0KDQoNCiAgICANCiAgICANCiAgICBkZWYgX2Zyb21Eb2N1bWVudChzZWxmLCBvYmopOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ0RldmljZV9DYXRlZ29yeTo6X2Zyb21Eb2N1bWVudCgpOiAnOw0KDQogICAgICAgIGlmIG9iaiBpcyBOb25lOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIA0KICAgICAgICBpZiBpc2luc3RhbmNlKG9iaiwgYnl0ZXMpOg0KICAgICAgICAgICAgb2JqID0gc3RyKG9iaiwgInV0Zi04Iik7DQoNCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIHN0cikgb3IgdHlwZShvYmopIGlzIHN0cjoNCiAgICAgICAgICAgIG9iaiA9IGpzb24ubG9hZHMob2JqKTsNCiAgICAgICAgDQogICAgICAgIGlmIG5vdCBpc2luc3RhbmNlKG9iaiwgKHN0ciwgYnl0ZXMsIGRpY3QpKToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnR09UIEhFUkU6ICcgKyBzdHIodHlwZShvYmopKSk7DQogICAgICAgICAgICByZXR1cm4gb2JqOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBmb3IgaSBpbiBvYmo6DQogICAgICAgICAgICAgICAgb2JqW2ldID0gRGV2aWNlX0NhdGVnb3J5KCkuX2Zyb21Eb2N1bWVudChvYmpbaV0pOw0KICAgICAgICAgICAgcmV0dXJuIG9iajsNCg0KDQogICAgICAgIGlmICdJZCcgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5JZCA9IG9ialsnSWQnXTsNCg0KICAgIA0KICAgICAgICBpZiAnYWN0aXZlJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmFjdGl2ZShvYmpbJ2FjdGl2ZSddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdlbmFibGVkJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmVuYWJsZWQob2JqWydlbmFibGVkJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ2NvZGUnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuY29kZShvYmpbJ2NvZGUnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnb3JkZXInIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYub3JkZXIob2JqWydvcmRlciddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdkYXRlJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmRhdGUob2JqWydkYXRlJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ25hbWUnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYubmFtZShvYmpbJ25hbWUnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAncmVtYXJrJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLnJlbWFyayhvYmpbJ3JlbWFyayddKTsNCiAgICAgICAgDQogICAgICAgICAgICBzZWxmLnJlbWFyayggYmFzZTY0LmI2NGVuY29kZShzZWxmLnJlbWFyaygpLmVuY29kZSgiYXNjaWkiKSkuZGVjb2RlKCJhc2NpaSIpICk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAncGFyZW50JyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLnBhcmVudChvYmpbJ3BhcmVudCddKTsNCiAgICAgICAgDQogICAgDQoNCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICByZXR1cm4gc2VsZjsNCiAgICANCiAgICBkZWYgX3RvRG9jdW1lbnQoc2VsZik6DQogICAgICAgIHJldCA9IHt9Ow0KICAgICAgICBpZiBzZWxmLklkIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJJZCJdID0gc2VsZi5JZDsNCg0KICAgIA0KICAgICAgICBpZiBzZWxmLmFjdGl2ZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJhY3RpdmUiXSA9IHNlbGYuYWN0aXZlKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmVuYWJsZWQoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiZW5hYmxlZCJdID0gc2VsZi5lbmFibGVkKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmNvZGUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiY29kZSJdID0gc2VsZi5jb2RlKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLm9yZGVyKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbIm9yZGVyIl0gPSBzZWxmLm9yZGVyKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmRhdGUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiZGF0ZSJdID0gc2VsZi5kYXRlKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLm5hbWUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsibmFtZSJdID0gc2VsZi5uYW1lKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLnJlbWFyaygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IHNlbGYucmVtYXJrKCk7DQogICAgICAgIA0KICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShyZXRbInJlbWFyayJdLCBkaWN0KToNCiAgICAgICAgICAgICAgICByZXRbInJlbWFyayJdID0ganNvbi5kdW1wcyhyZXRbInJlbWFyayJdKTsNCiAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSB1YmluYXNjaWkuYjJhX2Jhc2U2NChyZXRbInJlbWFyayJdKS5zdHJpcCgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5wYXJlbnQoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsicGFyZW50Il0gPSBzZWxmLnBhcmVudCgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgcmV0dXJuIHJldDsNCg0KICAgIA0KICAgIGRlZiBzdG9yZShzZWxmLCBfX2V2ZW50PU5vbmUpOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ0RldmljZV9DYXRlZ29yeTo6c3RvcmUoKTogJzsNCiAgICAgICAgDQogICAgICAgIGV2SlNPTiA9IE5vbmU7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIGV2SlNPTiA9IGpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOg0KICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsNCiAgICAgICAgDQoNCiAgICAgICAgYW5zd2VyID0gTm9uZTsNCg0KICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGlja3NfbXMoKSkrJ10uRGV2aWNlX0NhdGVnb3J5LnN0b3JlKCknKS5tZXRob2QoJ3N0b3JlJykuY2xhc3NOYW1lKCdEZXZpY2VfQ2F0ZWdvcnknKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOw0KICAgICAgICANCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCiAgICAgICAgDQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgYW5zd2VyID0gRGV2aWNlX0NhdGVnb3J5KCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCiAgICAgICAgDQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KDQoNCg0KICAgICAgICBpZiAnRGV2aWNlX0NhdGVnb3J5X3N0b3JlJyBpbiBkaXIoKToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnPT0+IERldmljZV9DYXRlZ29yeV9zdG9yZSgpJyk7DQogICAgICAgICAgICBhbnN3ZXIgPSBEZXZpY2VfQ2F0ZWdvcnlfc3RvcmUoc2VsZiwgX19ldmVudCwgYW5zd2VyLCBfX3RvU3RyaW5nKTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCg0KICAgICAgICByZXR1cm4gYW5zd2VyOw0KDQogICAgDQogICAgZGVmIGZpbmRBbGwoc2VsZiwgX19ldmVudD1Ob25lKToNCiAgICAgICAgX190b1N0cmluZyA9ICdEZXZpY2VfQ2F0ZWdvcnk6OmZpbmRBbGwoKTogJzsNCiAgICAgICAgDQogICAgICAgIGV2SlNPTiA9IE5vbmU7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIGV2SlNPTiA9IGpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOg0KICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsNCiAgICAgICAgDQoNCiAgICAgICAgYW5zd2VyID0gTm9uZTsNCg0KICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGlja3NfbXMoKSkrJ10uRGV2aWNlX0NhdGVnb3J5LmZpbmRBbGwoKScpLm1ldGhvZCgnZmluZEFsbCcpLmNsYXNzTmFtZSgnRGV2aWNlX0NhdGVnb3J5JykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOw0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsNCiAgICAgICAgDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQogICAgICAgIA0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgIGFuc3dlciA9IERldmljZV9DYXRlZ29yeSgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQogICAgICAgIA0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCg0KDQoNCiAgICAgICAgaWYgJ0RldmljZV9DYXRlZ29yeV9maW5kQWxsJyBpbiBkaXIoKToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnPT0+IERldmljZV9DYXRlZ29yeV9maW5kQWxsKCknKTsNCiAgICAgICAgICAgIGFuc3dlciA9IERldmljZV9DYXRlZ29yeV9maW5kQWxsKHNlbGYsIF9fZXZlbnQsIGFuc3dlciwgX190b1N0cmluZyk7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KDQogICAgICAgICAgICANCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQoNCiAgICAgICAgcmV0dXJuIGFuc3dlcjsNCg0KICAgIA0KICAgIGRlZiBmaW5kKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6DQogICAgICAgIF9fdG9TdHJpbmcgPSAnRGV2aWNlX0NhdGVnb3J5OjpmaW5kKCk6ICc7DQogICAgICAgIA0KICAgICAgICBldkpTT04gPSBOb25lOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBldkpTT04gPSBqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoNCiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7DQogICAgICAgIA0KDQogICAgICAgIGFuc3dlciA9IE5vbmU7DQoNCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpY2tzX21zKCkpKyddLkRldmljZV9DYXRlZ29yeS5maW5kKCknKS5tZXRob2QoJ2ZpbmQnKS5jbGFzc05hbWUoJ0RldmljZV9DYXRlZ29yeScpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7DQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KICAgICAgICANCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICBhbnN3ZXIgPSBEZXZpY2VfQ2F0ZWdvcnkoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KICAgICAgICANCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQoNCg0KDQogICAgICAgIGlmICdEZXZpY2VfQ2F0ZWdvcnlfZmluZCcgaW4gZGlyKCk6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJz09PiBEZXZpY2VfQ2F0ZWdvcnlfZmluZCgpJyk7DQogICAgICAgICAgICBhbnN3ZXIgPSBEZXZpY2VfQ2F0ZWdvcnlfZmluZChzZWxmLCBfX2V2ZW50LCBhbnN3ZXIsIF9fdG9TdHJpbmcpOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCg0KICAgICAgICAgICAgDQogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KDQogICAgICAgIHJldHVybiBhbnN3ZXI7DQoNCiAgICANCg0KDQpjbGFzcyBEZXZpY2VfVHlwZSgpOg0KICAgIGRlZiBfX2luaXRfXyhzZWxmLCBJZD1Ob25lLCBhY3RpdmU9Tm9uZSwgZW5hYmxlZD1Ob25lLCBjb2RlPU5vbmUsIG9yZGVyPU5vbmUsIGRhdGU9Tm9uZSwgbmFtZT1Ob25lLCByZW1hcms9Tm9uZSwgY2F0ZWdvcnk9Tm9uZSk6DQogICAgICAgIHN1cGVyKCkuX19pbml0X18oKTsNCg0KICAgICAgICAjcHJpbnQoJ0RldmljZV9UeXBlOjpfX2luaXRfXygpJyk7DQogICAgICAgIGlmIElkIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgc2VsZi5JZCA9IElkOw0KDQogICAgICAgIA0KICAgICAgICBzZWxmLmFjdGl2ZShhY3RpdmUpOw0KICAgICAgICBzZWxmLmVuYWJsZWQoZW5hYmxlZCk7DQogICAgICAgIHNlbGYuY29kZShjb2RlKTsNCiAgICAgICAgc2VsZi5vcmRlcihvcmRlcik7DQogICAgICAgIHNlbGYuZGF0ZShkYXRlKTsNCiAgICAgICAgc2VsZi5uYW1lKG5hbWUpOw0KICAgICAgICBzZWxmLnJlbWFyayhyZW1hcmspOw0KICAgICAgICBzZWxmLmNhdGVnb3J5KGNhdGVnb3J5KTsNCiAgICAgICAgDQogICAgSWQgPSBOb25lOw0KICAgIA0KICAgIA0KICAgICMgYWN0aXZlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2FjdGl2ZSA9IE5vbmU7DQogICAgZGVmIGFjdGl2ZShzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9hY3RpdmUgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fYWN0aXZlOw0KDQoNCiAgICANCiAgICAjIGVuYWJsZWQ6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfZW5hYmxlZCA9IE5vbmU7DQogICAgZGVmIGVuYWJsZWQoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fZW5hYmxlZCA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9lbmFibGVkOw0KDQoNCiAgICANCiAgICAjIGNvZGU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfY29kZSA9IE5vbmU7DQogICAgZGVmIGNvZGUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fY29kZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9jb2RlOw0KDQoNCiAgICANCiAgICAjIG9yZGVyOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX29yZGVyID0gTm9uZTsNCiAgICBkZWYgb3JkZXIoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fb3JkZXIgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fb3JkZXI7DQoNCg0KICAgIA0KICAgICMgZGF0ZTogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9kYXRlID0gTm9uZTsNCiAgICBkZWYgZGF0ZShzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9kYXRlID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2RhdGU7DQoNCg0KICAgIA0KICAgICMgbmFtZTogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9uYW1lID0gTm9uZTsNCiAgICBkZWYgbmFtZShzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9uYW1lID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX25hbWU7DQoNCg0KICAgIA0KICAgICMgcmVtYXJrOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX3JlbWFyayA9IE5vbmU7DQogICAgZGVmIHJlbWFyayhzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9yZW1hcmsgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fcmVtYXJrOw0KDQoNCiAgICANCiAgICAjIGNhdGVnb3J5OiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2NhdGVnb3J5ID0gTm9uZTsNCiAgICBkZWYgY2F0ZWdvcnkoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fY2F0ZWdvcnkgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fY2F0ZWdvcnk7DQoNCg0KICAgIA0KICAgIA0KICAgIGRlZiBfZnJvbURvY3VtZW50KHNlbGYsIG9iaik6DQogICAgICAgIF9fdG9TdHJpbmcgPSAnRGV2aWNlX1R5cGU6Ol9mcm9tRG9jdW1lbnQoKTogJzsNCg0KICAgICAgICBpZiBvYmogaXMgTm9uZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICANCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIGJ5dGVzKToNCiAgICAgICAgICAgIG9iaiA9IHN0cihvYmosICJ1dGYtOCIpOw0KDQogICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLCBzdHIpIG9yIHR5cGUob2JqKSBpcyBzdHI6DQogICAgICAgICAgICBvYmogPSBqc29uLmxvYWRzKG9iaik7DQogICAgICAgIA0KICAgICAgICBpZiBub3QgaXNpbnN0YW5jZShvYmosIChzdHIsIGJ5dGVzLCBkaWN0KSk6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJ0dPVCBIRVJFOiAnICsgc3RyKHR5cGUob2JqKSkpOw0KICAgICAgICAgICAgcmV0dXJuIG9iajsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZm9yIGkgaW4gb2JqOg0KICAgICAgICAgICAgICAgIG9ialtpXSA9IERldmljZV9UeXBlKCkuX2Zyb21Eb2N1bWVudChvYmpbaV0pOw0KICAgICAgICAgICAgcmV0dXJuIG9iajsNCg0KDQogICAgICAgIGlmICdJZCcgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5JZCA9IG9ialsnSWQnXTsNCg0KICAgIA0KICAgICAgICBpZiAnYWN0aXZlJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmFjdGl2ZShvYmpbJ2FjdGl2ZSddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdlbmFibGVkJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmVuYWJsZWQob2JqWydlbmFibGVkJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ2NvZGUnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuY29kZShvYmpbJ2NvZGUnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnb3JkZXInIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYub3JkZXIob2JqWydvcmRlciddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdkYXRlJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmRhdGUob2JqWydkYXRlJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ25hbWUnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYubmFtZShvYmpbJ25hbWUnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAncmVtYXJrJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLnJlbWFyayhvYmpbJ3JlbWFyayddKTsNCiAgICAgICAgDQogICAgICAgICAgICBzZWxmLnJlbWFyayggYmFzZTY0LmI2NGVuY29kZShzZWxmLnJlbWFyaygpLmVuY29kZSgiYXNjaWkiKSkuZGVjb2RlKCJhc2NpaSIpICk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnY2F0ZWdvcnknIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuY2F0ZWdvcnkoRGV2aWNlX0NhdGVnb3J5KCkuX2Zyb21Eb2N1bWVudChvYmpbJ2NhdGVnb3J5J10pKTsNCiAgICAgICAgDQogICAgDQoNCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICByZXR1cm4gc2VsZjsNCiAgICANCiAgICBkZWYgX3RvRG9jdW1lbnQoc2VsZik6DQogICAgICAgIHJldCA9IHt9Ow0KICAgICAgICBpZiBzZWxmLklkIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJJZCJdID0gc2VsZi5JZDsNCg0KICAgIA0KICAgICAgICBpZiBzZWxmLmFjdGl2ZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJhY3RpdmUiXSA9IHNlbGYuYWN0aXZlKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmVuYWJsZWQoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiZW5hYmxlZCJdID0gc2VsZi5lbmFibGVkKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmNvZGUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiY29kZSJdID0gc2VsZi5jb2RlKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLm9yZGVyKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbIm9yZGVyIl0gPSBzZWxmLm9yZGVyKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmRhdGUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiZGF0ZSJdID0gc2VsZi5kYXRlKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLm5hbWUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsibmFtZSJdID0gc2VsZi5uYW1lKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLnJlbWFyaygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IHNlbGYucmVtYXJrKCk7DQogICAgICAgIA0KICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShyZXRbInJlbWFyayJdLCBkaWN0KToNCiAgICAgICAgICAgICAgICByZXRbInJlbWFyayJdID0ganNvbi5kdW1wcyhyZXRbInJlbWFyayJdKTsNCiAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSB1YmluYXNjaWkuYjJhX2Jhc2U2NChyZXRbInJlbWFyayJdKS5zdHJpcCgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5jYXRlZ29yeSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJjYXRlZ29yeSJdID0gc2VsZi5jYXRlZ29yeSgpLl90b0RvY3VtZW50KCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICANCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICByZXR1cm4gcmV0Ow0KDQogICAgDQogICAgZGVmIHN0b3JlKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6DQogICAgICAgIF9fdG9TdHJpbmcgPSAnRGV2aWNlX1R5cGU6OnN0b3JlKCk6ICc7DQogICAgICAgIA0KICAgICAgICBldkpTT04gPSBOb25lOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBldkpTT04gPSBqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoNCiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7DQogICAgICAgIA0KDQogICAgICAgIGFuc3dlciA9IE5vbmU7DQoNCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpY2tzX21zKCkpKyddLkRldmljZV9UeXBlLnN0b3JlKCknKS5tZXRob2QoJ3N0b3JlJykuY2xhc3NOYW1lKCdEZXZpY2VfVHlwZScpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7DQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KICAgICAgICANCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICBhbnN3ZXIgPSBEZXZpY2VfVHlwZSgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQogICAgICAgIA0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCg0KDQoNCiAgICAgICAgaWYgJ0RldmljZV9UeXBlX3N0b3JlJyBpbiBkaXIoKToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnPT0+IERldmljZV9UeXBlX3N0b3JlKCknKTsNCiAgICAgICAgICAgIGFuc3dlciA9IERldmljZV9UeXBlX3N0b3JlKHNlbGYsIF9fZXZlbnQsIGFuc3dlciwgX190b1N0cmluZyk7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KDQogICAgICAgICAgICANCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQoNCiAgICAgICAgcmV0dXJuIGFuc3dlcjsNCg0KICAgIA0KICAgIGRlZiBmaW5kQWxsKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6DQogICAgICAgIF9fdG9TdHJpbmcgPSAnRGV2aWNlX1R5cGU6OmZpbmRBbGwoKTogJzsNCiAgICAgICAgDQogICAgICAgIGV2SlNPTiA9IE5vbmU7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIGV2SlNPTiA9IGpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOg0KICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsNCiAgICAgICAgDQoNCiAgICAgICAgYW5zd2VyID0gTm9uZTsNCg0KICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGlja3NfbXMoKSkrJ10uRGV2aWNlX1R5cGUuZmluZEFsbCgpJykubWV0aG9kKCdmaW5kQWxsJykuY2xhc3NOYW1lKCdEZXZpY2VfVHlwZScpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7DQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KICAgICAgICANCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICBhbnN3ZXIgPSBEZXZpY2VfVHlwZSgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQogICAgICAgIA0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCg0KDQoNCiAgICAgICAgaWYgJ0RldmljZV9UeXBlX2ZpbmRBbGwnIGluIGRpcigpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICc9PT4gRGV2aWNlX1R5cGVfZmluZEFsbCgpJyk7DQogICAgICAgICAgICBhbnN3ZXIgPSBEZXZpY2VfVHlwZV9maW5kQWxsKHNlbGYsIF9fZXZlbnQsIGFuc3dlciwgX190b1N0cmluZyk7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KDQogICAgICAgICAgICANCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQoNCiAgICAgICAgcmV0dXJuIGFuc3dlcjsNCg0KICAgIA0KICAgIGRlZiBmaW5kKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6DQogICAgICAgIF9fdG9TdHJpbmcgPSAnRGV2aWNlX1R5cGU6OmZpbmQoKTogJzsNCiAgICAgICAgDQogICAgICAgIGV2SlNPTiA9IE5vbmU7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIGV2SlNPTiA9IGpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOg0KICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsNCiAgICAgICAgDQoNCiAgICAgICAgYW5zd2VyID0gTm9uZTsNCg0KICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGlja3NfbXMoKSkrJ10uRGV2aWNlX1R5cGUuZmluZCgpJykubWV0aG9kKCdmaW5kJykuY2xhc3NOYW1lKCdEZXZpY2VfVHlwZScpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7DQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KICAgICAgICANCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICBhbnN3ZXIgPSBEZXZpY2VfVHlwZSgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQogICAgICAgIA0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCg0KDQoNCiAgICAgICAgaWYgJ0RldmljZV9UeXBlX2ZpbmQnIGluIGRpcigpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICc9PT4gRGV2aWNlX1R5cGVfZmluZCgpJyk7DQogICAgICAgICAgICBhbnN3ZXIgPSBEZXZpY2VfVHlwZV9maW5kKHNlbGYsIF9fZXZlbnQsIGFuc3dlciwgX190b1N0cmluZyk7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KDQogICAgICAgICAgICANCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQoNCiAgICAgICAgcmV0dXJuIGFuc3dlcjsNCg0KICAgIA0KDQoNCmNsYXNzIE1ldHJpY19Hcm91cCgpOg0KICAgIGRlZiBfX2luaXRfXyhzZWxmLCBJZD1Ob25lLCBhY3RpdmU9Tm9uZSwgZW5hYmxlZD1Ob25lLCBjb2RlPU5vbmUsIG9yZGVyPU5vbmUsIGRhdGU9Tm9uZSwgbmFtZT1Ob25lLCByZW1hcms9Tm9uZSk6DQogICAgICAgIHN1cGVyKCkuX19pbml0X18oKTsNCg0KICAgICAgICAjcHJpbnQoJ01ldHJpY19Hcm91cDo6X19pbml0X18oKScpOw0KICAgICAgICBpZiBJZCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHNlbGYuSWQgPSBJZDsNCg0KICAgICAgICANCiAgICAgICAgc2VsZi5hY3RpdmUoYWN0aXZlKTsNCiAgICAgICAgc2VsZi5lbmFibGVkKGVuYWJsZWQpOw0KICAgICAgICBzZWxmLmNvZGUoY29kZSk7DQogICAgICAgIHNlbGYub3JkZXIob3JkZXIpOw0KICAgICAgICBzZWxmLmRhdGUoZGF0ZSk7DQogICAgICAgIHNlbGYubmFtZShuYW1lKTsNCiAgICAgICAgc2VsZi5yZW1hcmsocmVtYXJrKTsNCiAgICAgICAgDQogICAgSWQgPSBOb25lOw0KICAgIA0KICAgIA0KICAgICMgYWN0aXZlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2FjdGl2ZSA9IE5vbmU7DQogICAgZGVmIGFjdGl2ZShzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9hY3RpdmUgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fYWN0aXZlOw0KDQoNCiAgICANCiAgICAjIGVuYWJsZWQ6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfZW5hYmxlZCA9IE5vbmU7DQogICAgZGVmIGVuYWJsZWQoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fZW5hYmxlZCA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9lbmFibGVkOw0KDQoNCiAgICANCiAgICAjIGNvZGU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfY29kZSA9IE5vbmU7DQogICAgZGVmIGNvZGUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fY29kZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9jb2RlOw0KDQoNCiAgICANCiAgICAjIG9yZGVyOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX29yZGVyID0gTm9uZTsNCiAgICBkZWYgb3JkZXIoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fb3JkZXIgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fb3JkZXI7DQoNCg0KICAgIA0KICAgICMgZGF0ZTogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9kYXRlID0gTm9uZTsNCiAgICBkZWYgZGF0ZShzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9kYXRlID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2RhdGU7DQoNCg0KICAgIA0KICAgICMgbmFtZTogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9uYW1lID0gTm9uZTsNCiAgICBkZWYgbmFtZShzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9uYW1lID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX25hbWU7DQoNCg0KICAgIA0KICAgICMgcmVtYXJrOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX3JlbWFyayA9IE5vbmU7DQogICAgZGVmIHJlbWFyayhzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9yZW1hcmsgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fcmVtYXJrOw0KDQoNCiAgICANCiAgICANCiAgICBkZWYgX2Zyb21Eb2N1bWVudChzZWxmLCBvYmopOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ01ldHJpY19Hcm91cDo6X2Zyb21Eb2N1bWVudCgpOiAnOw0KDQogICAgICAgIGlmIG9iaiBpcyBOb25lOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIA0KICAgICAgICBpZiBpc2luc3RhbmNlKG9iaiwgYnl0ZXMpOg0KICAgICAgICAgICAgb2JqID0gc3RyKG9iaiwgInV0Zi04Iik7DQoNCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIHN0cikgb3IgdHlwZShvYmopIGlzIHN0cjoNCiAgICAgICAgICAgIG9iaiA9IGpzb24ubG9hZHMob2JqKTsNCiAgICAgICAgDQogICAgICAgIGlmIG5vdCBpc2luc3RhbmNlKG9iaiwgKHN0ciwgYnl0ZXMsIGRpY3QpKToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnR09UIEhFUkU6ICcgKyBzdHIodHlwZShvYmopKSk7DQogICAgICAgICAgICByZXR1cm4gb2JqOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBmb3IgaSBpbiBvYmo6DQogICAgICAgICAgICAgICAgb2JqW2ldID0gTWV0cmljX0dyb3VwKCkuX2Zyb21Eb2N1bWVudChvYmpbaV0pOw0KICAgICAgICAgICAgcmV0dXJuIG9iajsNCg0KDQogICAgICAgIGlmICdJZCcgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5JZCA9IG9ialsnSWQnXTsNCg0KICAgIA0KICAgICAgICBpZiAnYWN0aXZlJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmFjdGl2ZShvYmpbJ2FjdGl2ZSddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdlbmFibGVkJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmVuYWJsZWQob2JqWydlbmFibGVkJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ2NvZGUnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuY29kZShvYmpbJ2NvZGUnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnb3JkZXInIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYub3JkZXIob2JqWydvcmRlciddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdkYXRlJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmRhdGUob2JqWydkYXRlJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ25hbWUnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYubmFtZShvYmpbJ25hbWUnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAncmVtYXJrJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLnJlbWFyayhvYmpbJ3JlbWFyayddKTsNCiAgICAgICAgDQogICAgICAgICAgICBzZWxmLnJlbWFyayggYmFzZTY0LmI2NGVuY29kZShzZWxmLnJlbWFyaygpLmVuY29kZSgiYXNjaWkiKSkuZGVjb2RlKCJhc2NpaSIpICk7DQogICAgICAgIA0KICAgIA0KDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgDQogICAgZGVmIF90b0RvY3VtZW50KHNlbGYpOg0KICAgICAgICByZXQgPSB7fTsNCiAgICAgICAgaWYgc2VsZi5JZCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiSWQiXSA9IHNlbGYuSWQ7DQoNCiAgICANCiAgICAgICAgaWYgc2VsZi5hY3RpdmUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiYWN0aXZlIl0gPSBzZWxmLmFjdGl2ZSgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5lbmFibGVkKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbImVuYWJsZWQiXSA9IHNlbGYuZW5hYmxlZCgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5jb2RlKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbImNvZGUiXSA9IHNlbGYuY29kZSgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5vcmRlcigpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJvcmRlciJdID0gc2VsZi5vcmRlcigpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5kYXRlKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbImRhdGUiXSA9IHNlbGYuZGF0ZSgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5uYW1lKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbIm5hbWUiXSA9IHNlbGYubmFtZSgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5yZW1hcmsoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSBzZWxmLnJlbWFyaygpOw0KICAgICAgICANCiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UocmV0WyJyZW1hcmsiXSwgZGljdCk6DQogICAgICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IGpzb24uZHVtcHMocmV0WyJyZW1hcmsiXSk7DQogICAgICAgICAgICByZXRbInJlbWFyayJdID0gdWJpbmFzY2lpLmIyYV9iYXNlNjQocmV0WyJyZW1hcmsiXSkuc3RyaXAoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIHJldHVybiByZXQ7DQoNCiAgICANCiAgICBkZWYgc3RvcmUoc2VsZiwgX19ldmVudD1Ob25lKToNCiAgICAgICAgX190b1N0cmluZyA9ICdNZXRyaWNfR3JvdXA6OnN0b3JlKCk6ICc7DQogICAgICAgIA0KICAgICAgICBldkpTT04gPSBOb25lOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBldkpTT04gPSBqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoNCiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7DQogICAgICAgIA0KDQogICAgICAgIGFuc3dlciA9IE5vbmU7DQoNCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpY2tzX21zKCkpKyddLk1ldHJpY19Hcm91cC5zdG9yZSgpJykubWV0aG9kKCdzdG9yZScpLmNsYXNzTmFtZSgnTWV0cmljX0dyb3VwJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOw0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsNCiAgICAgICAgDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQogICAgICAgIA0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgIGFuc3dlciA9IE1ldHJpY19Hcm91cCgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQogICAgICAgIA0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCg0KDQoNCiAgICAgICAgaWYgJ01ldHJpY19Hcm91cF9zdG9yZScgaW4gZGlyKCk6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJz09PiBNZXRyaWNfR3JvdXBfc3RvcmUoKScpOw0KICAgICAgICAgICAgYW5zd2VyID0gTWV0cmljX0dyb3VwX3N0b3JlKHNlbGYsIF9fZXZlbnQsIGFuc3dlciwgX190b1N0cmluZyk7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KDQogICAgICAgICAgICANCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQoNCiAgICAgICAgcmV0dXJuIGFuc3dlcjsNCg0KICAgIA0KICAgIGRlZiBmaW5kQWxsKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6DQogICAgICAgIF9fdG9TdHJpbmcgPSAnTWV0cmljX0dyb3VwOjpmaW5kQWxsKCk6ICc7DQogICAgICAgIA0KICAgICAgICBldkpTT04gPSBOb25lOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBldkpTT04gPSBqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoNCiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7DQogICAgICAgIA0KDQogICAgICAgIGFuc3dlciA9IE5vbmU7DQoNCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpY2tzX21zKCkpKyddLk1ldHJpY19Hcm91cC5maW5kQWxsKCknKS5tZXRob2QoJ2ZpbmRBbGwnKS5jbGFzc05hbWUoJ01ldHJpY19Hcm91cCcpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7DQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KICAgICAgICANCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICBhbnN3ZXIgPSBNZXRyaWNfR3JvdXAoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KICAgICAgICANCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQoNCg0KDQogICAgICAgIGlmICdNZXRyaWNfR3JvdXBfZmluZEFsbCcgaW4gZGlyKCk6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJz09PiBNZXRyaWNfR3JvdXBfZmluZEFsbCgpJyk7DQogICAgICAgICAgICBhbnN3ZXIgPSBNZXRyaWNfR3JvdXBfZmluZEFsbChzZWxmLCBfX2V2ZW50LCBhbnN3ZXIsIF9fdG9TdHJpbmcpOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCg0KICAgICAgICAgICAgDQogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KDQogICAgICAgIHJldHVybiBhbnN3ZXI7DQoNCiAgICANCiAgICBkZWYgZmluZChzZWxmLCBfX2V2ZW50PU5vbmUpOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ01ldHJpY19Hcm91cDo6ZmluZCgpOiAnOw0KICAgICAgICANCiAgICAgICAgZXZKU09OID0gTm9uZTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgZXZKU09OID0ganNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046DQogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOw0KICAgICAgICANCg0KICAgICAgICBhbnN3ZXIgPSBOb25lOw0KDQogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aWNrc19tcygpKSsnXS5NZXRyaWNfR3JvdXAuZmluZCgpJykubWV0aG9kKCdmaW5kJykuY2xhc3NOYW1lKCdNZXRyaWNfR3JvdXAnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOw0KICAgICAgICANCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCiAgICAgICAgDQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgYW5zd2VyID0gTWV0cmljX0dyb3VwKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCiAgICAgICAgDQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KDQoNCg0KICAgICAgICBpZiAnTWV0cmljX0dyb3VwX2ZpbmQnIGluIGRpcigpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICc9PT4gTWV0cmljX0dyb3VwX2ZpbmQoKScpOw0KICAgICAgICAgICAgYW5zd2VyID0gTWV0cmljX0dyb3VwX2ZpbmQoc2VsZiwgX19ldmVudCwgYW5zd2VyLCBfX3RvU3RyaW5nKTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCg0KICAgICAgICByZXR1cm4gYW5zd2VyOw0KDQogICAgDQoNCg0KY2xhc3MgTWV0cmljX1R5cGUoKToNCiAgICBkZWYgX19pbml0X18oc2VsZiwgSWQ9Tm9uZSwgYWN0aXZlPU5vbmUsIGVuYWJsZWQ9Tm9uZSwgY29kZT1Ob25lLCBvcmRlcj1Ob25lLCBkYXRlPU5vbmUsIG5hbWU9Tm9uZSwgcmVtYXJrPU5vbmUsIGdyb3VwPU5vbmUpOg0KICAgICAgICBzdXBlcigpLl9faW5pdF9fKCk7DQoNCiAgICAgICAgI3ByaW50KCdNZXRyaWNfVHlwZTo6X19pbml0X18oKScpOw0KICAgICAgICBpZiBJZCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHNlbGYuSWQgPSBJZDsNCg0KICAgICAgICANCiAgICAgICAgc2VsZi5hY3RpdmUoYWN0aXZlKTsNCiAgICAgICAgc2VsZi5lbmFibGVkKGVuYWJsZWQpOw0KICAgICAgICBzZWxmLmNvZGUoY29kZSk7DQogICAgICAgIHNlbGYub3JkZXIob3JkZXIpOw0KICAgICAgICBzZWxmLmRhdGUoZGF0ZSk7DQogICAgICAgIHNlbGYubmFtZShuYW1lKTsNCiAgICAgICAgc2VsZi5yZW1hcmsocmVtYXJrKTsNCiAgICAgICAgc2VsZi5ncm91cChncm91cCk7DQogICAgICAgIA0KICAgIElkID0gTm9uZTsNCiAgICANCiAgICANCiAgICAjIGFjdGl2ZTogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9hY3RpdmUgPSBOb25lOw0KICAgIGRlZiBhY3RpdmUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fYWN0aXZlID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2FjdGl2ZTsNCg0KDQogICAgDQogICAgIyBlbmFibGVkOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2VuYWJsZWQgPSBOb25lOw0KICAgIGRlZiBlbmFibGVkKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2VuYWJsZWQgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fZW5hYmxlZDsNCg0KDQogICAgDQogICAgIyBjb2RlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2NvZGUgPSBOb25lOw0KICAgIGRlZiBjb2RlKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2NvZGUgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fY29kZTsNCg0KDQogICAgDQogICAgIyBvcmRlcjogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9vcmRlciA9IE5vbmU7DQogICAgZGVmIG9yZGVyKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX29yZGVyID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX29yZGVyOw0KDQoNCiAgICANCiAgICAjIGRhdGU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfZGF0ZSA9IE5vbmU7DQogICAgZGVmIGRhdGUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fZGF0ZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9kYXRlOw0KDQoNCiAgICANCiAgICAjIG5hbWU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfbmFtZSA9IE5vbmU7DQogICAgZGVmIG5hbWUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fbmFtZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9uYW1lOw0KDQoNCiAgICANCiAgICAjIHJlbWFyazogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9yZW1hcmsgPSBOb25lOw0KICAgIGRlZiByZW1hcmsoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fcmVtYXJrID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3JlbWFyazsNCg0KDQogICAgDQogICAgIyBncm91cDogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9ncm91cCA9IE5vbmU7DQogICAgZGVmIGdyb3VwKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2dyb3VwID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2dyb3VwOw0KDQoNCiAgICANCiAgICANCiAgICBkZWYgX2Zyb21Eb2N1bWVudChzZWxmLCBvYmopOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ01ldHJpY19UeXBlOjpfZnJvbURvY3VtZW50KCk6ICc7DQoNCiAgICAgICAgaWYgb2JqIGlzIE5vbmU6DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgDQogICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLCBieXRlcyk6DQogICAgICAgICAgICBvYmogPSBzdHIob2JqLCAidXRmLTgiKTsNCg0KICAgICAgICBpZiBpc2luc3RhbmNlKG9iaiwgc3RyKSBvciB0eXBlKG9iaikgaXMgc3RyOg0KICAgICAgICAgICAgb2JqID0ganNvbi5sb2FkcyhvYmopOw0KICAgICAgICANCiAgICAgICAgaWYgbm90IGlzaW5zdGFuY2Uob2JqLCAoc3RyLCBieXRlcywgZGljdCkpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICdHT1QgSEVSRTogJyArIHN0cih0eXBlKG9iaikpKTsNCiAgICAgICAgICAgIHJldHVybiBvYmo7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGZvciBpIGluIG9iajoNCiAgICAgICAgICAgICAgICBvYmpbaV0gPSBNZXRyaWNfVHlwZSgpLl9mcm9tRG9jdW1lbnQob2JqW2ldKTsNCiAgICAgICAgICAgIHJldHVybiBvYmo7DQoNCg0KICAgICAgICBpZiAnSWQnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuSWQgPSBvYmpbJ0lkJ107DQoNCiAgICANCiAgICAgICAgaWYgJ2FjdGl2ZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5hY3RpdmUob2JqWydhY3RpdmUnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnZW5hYmxlZCcgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5lbmFibGVkKG9ialsnZW5hYmxlZCddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdjb2RlJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmNvZGUob2JqWydjb2RlJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ29yZGVyJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLm9yZGVyKG9ialsnb3JkZXInXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnZGF0ZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5kYXRlKG9ialsnZGF0ZSddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICduYW1lJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLm5hbWUob2JqWyduYW1lJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ3JlbWFyaycgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5yZW1hcmsob2JqWydyZW1hcmsnXSk7DQogICAgICAgIA0KICAgICAgICAgICAgc2VsZi5yZW1hcmsoIGJhc2U2NC5iNjRlbmNvZGUoc2VsZi5yZW1hcmsoKS5lbmNvZGUoImFzY2lpIikpLmRlY29kZSgiYXNjaWkiKSApOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ2dyb3VwJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmdyb3VwKE1ldHJpY19Hcm91cCgpLl9mcm9tRG9jdW1lbnQob2JqWydncm91cCddKSk7DQogICAgICAgIA0KICAgIA0KDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgDQogICAgZGVmIF90b0RvY3VtZW50KHNlbGYpOg0KICAgICAgICByZXQgPSB7fTsNCiAgICAgICAgaWYgc2VsZi5JZCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiSWQiXSA9IHNlbGYuSWQ7DQoNCiAgICANCiAgICAgICAgaWYgc2VsZi5hY3RpdmUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiYWN0aXZlIl0gPSBzZWxmLmFjdGl2ZSgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5lbmFibGVkKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbImVuYWJsZWQiXSA9IHNlbGYuZW5hYmxlZCgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5jb2RlKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbImNvZGUiXSA9IHNlbGYuY29kZSgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5vcmRlcigpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJvcmRlciJdID0gc2VsZi5vcmRlcigpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5kYXRlKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbImRhdGUiXSA9IHNlbGYuZGF0ZSgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5uYW1lKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbIm5hbWUiXSA9IHNlbGYubmFtZSgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5yZW1hcmsoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSBzZWxmLnJlbWFyaygpOw0KICAgICAgICANCiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UocmV0WyJyZW1hcmsiXSwgZGljdCk6DQogICAgICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IGpzb24uZHVtcHMocmV0WyJyZW1hcmsiXSk7DQogICAgICAgICAgICByZXRbInJlbWFyayJdID0gdWJpbmFzY2lpLmIyYV9iYXNlNjQocmV0WyJyZW1hcmsiXSkuc3RyaXAoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYuZ3JvdXAoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiZ3JvdXAiXSA9IHNlbGYuZ3JvdXAoKS5fdG9Eb2N1bWVudCgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgcmV0dXJuIHJldDsNCg0KICAgIA0KICAgIGRlZiBzdG9yZShzZWxmLCBfX2V2ZW50PU5vbmUpOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ01ldHJpY19UeXBlOjpzdG9yZSgpOiAnOw0KICAgICAgICANCiAgICAgICAgZXZKU09OID0gTm9uZTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgZXZKU09OID0ganNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046DQogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOw0KICAgICAgICANCg0KICAgICAgICBhbnN3ZXIgPSBOb25lOw0KDQogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aWNrc19tcygpKSsnXS5NZXRyaWNfVHlwZS5zdG9yZSgpJykubWV0aG9kKCdzdG9yZScpLmNsYXNzTmFtZSgnTWV0cmljX1R5cGUnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOw0KICAgICAgICANCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCiAgICAgICAgDQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgYW5zd2VyID0gTWV0cmljX1R5cGUoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KICAgICAgICANCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQoNCg0KDQogICAgICAgIGlmICdNZXRyaWNfVHlwZV9zdG9yZScgaW4gZGlyKCk6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJz09PiBNZXRyaWNfVHlwZV9zdG9yZSgpJyk7DQogICAgICAgICAgICBhbnN3ZXIgPSBNZXRyaWNfVHlwZV9zdG9yZShzZWxmLCBfX2V2ZW50LCBhbnN3ZXIsIF9fdG9TdHJpbmcpOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCg0KICAgICAgICAgICAgDQogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KDQogICAgICAgIHJldHVybiBhbnN3ZXI7DQoNCiAgICANCiAgICBkZWYgZmluZEFsbChzZWxmLCBfX2V2ZW50PU5vbmUpOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ01ldHJpY19UeXBlOjpmaW5kQWxsKCk6ICc7DQogICAgICAgIA0KICAgICAgICBldkpTT04gPSBOb25lOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBldkpTT04gPSBqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoNCiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7DQogICAgICAgIA0KDQogICAgICAgIGFuc3dlciA9IE5vbmU7DQoNCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpY2tzX21zKCkpKyddLk1ldHJpY19UeXBlLmZpbmRBbGwoKScpLm1ldGhvZCgnZmluZEFsbCcpLmNsYXNzTmFtZSgnTWV0cmljX1R5cGUnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOw0KICAgICAgICANCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCiAgICAgICAgDQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgYW5zd2VyID0gTWV0cmljX1R5cGUoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KICAgICAgICANCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQoNCg0KDQogICAgICAgIGlmICdNZXRyaWNfVHlwZV9maW5kQWxsJyBpbiBkaXIoKToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnPT0+IE1ldHJpY19UeXBlX2ZpbmRBbGwoKScpOw0KICAgICAgICAgICAgYW5zd2VyID0gTWV0cmljX1R5cGVfZmluZEFsbChzZWxmLCBfX2V2ZW50LCBhbnN3ZXIsIF9fdG9TdHJpbmcpOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCg0KICAgICAgICAgICAgDQogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KDQogICAgICAgIHJldHVybiBhbnN3ZXI7DQoNCiAgICANCiAgICBkZWYgZmluZChzZWxmLCBfX2V2ZW50PU5vbmUpOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ01ldHJpY19UeXBlOjpmaW5kKCk6ICc7DQogICAgICAgIA0KICAgICAgICBldkpTT04gPSBOb25lOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBldkpTT04gPSBqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoNCiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7DQogICAgICAgIA0KDQogICAgICAgIGFuc3dlciA9IE5vbmU7DQoNCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpY2tzX21zKCkpKyddLk1ldHJpY19UeXBlLmZpbmQoKScpLm1ldGhvZCgnZmluZCcpLmNsYXNzTmFtZSgnTWV0cmljX1R5cGUnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOw0KICAgICAgICANCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCiAgICAgICAgDQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgYW5zd2VyID0gTWV0cmljX1R5cGUoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KICAgICAgICANCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQoNCg0KDQogICAgICAgIGlmICdNZXRyaWNfVHlwZV9maW5kJyBpbiBkaXIoKToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnPT0+IE1ldHJpY19UeXBlX2ZpbmQoKScpOw0KICAgICAgICAgICAgYW5zd2VyID0gTWV0cmljX1R5cGVfZmluZChzZWxmLCBfX2V2ZW50LCBhbnN3ZXIsIF9fdG9TdHJpbmcpOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCg0KICAgICAgICAgICAgDQogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KDQogICAgICAgIHJldHVybiBhbnN3ZXI7DQoNCiAgICANCg0KDQpjbGFzcyBNZXRyaWNfVmFsdWUoKToNCiAgICBkZWYgX19pbml0X18oc2VsZiwgSWQ9Tm9uZSwgYWN0aXZlPU5vbmUsIGVuYWJsZWQ9Tm9uZSwgY29kZT1Ob25lLCBvcmRlcj1Ob25lLCBkYXRlPU5vbmUsIG5hbWU9Tm9uZSwgcmVtYXJrPU5vbmUsIHZhbHVlPU5vbmUsIG1ldHJpYz1Ob25lLCBkZXZpY2U9Tm9uZSwgY29udHJvbGxlcj1Ob25lLCBleGVjdXRpb249Tm9uZSk6DQogICAgICAgIHN1cGVyKCkuX19pbml0X18oKTsNCg0KICAgICAgICAjcHJpbnQoJ01ldHJpY19WYWx1ZTo6X19pbml0X18oKScpOw0KICAgICAgICBpZiBJZCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHNlbGYuSWQgPSBJZDsNCg0KICAgICAgICANCiAgICAgICAgc2VsZi5hY3RpdmUoYWN0aXZlKTsNCiAgICAgICAgc2VsZi5lbmFibGVkKGVuYWJsZWQpOw0KICAgICAgICBzZWxmLmNvZGUoY29kZSk7DQogICAgICAgIHNlbGYub3JkZXIob3JkZXIpOw0KICAgICAgICBzZWxmLmRhdGUoZGF0ZSk7DQogICAgICAgIHNlbGYubmFtZShuYW1lKTsNCiAgICAgICAgc2VsZi5yZW1hcmsocmVtYXJrKTsNCiAgICAgICAgc2VsZi52YWx1ZSh2YWx1ZSk7DQogICAgICAgIHNlbGYubWV0cmljKG1ldHJpYyk7DQogICAgICAgIHNlbGYuZGV2aWNlKGRldmljZSk7DQogICAgICAgIHNlbGYuY29udHJvbGxlcihjb250cm9sbGVyKTsNCiAgICAgICAgc2VsZi5leGVjdXRpb24oZXhlY3V0aW9uKTsNCiAgICAgICAgDQogICAgSWQgPSBOb25lOw0KICAgIA0KICAgIA0KICAgICMgYWN0aXZlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2FjdGl2ZSA9IE5vbmU7DQogICAgZGVmIGFjdGl2ZShzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9hY3RpdmUgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fYWN0aXZlOw0KDQoNCiAgICANCiAgICAjIGVuYWJsZWQ6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfZW5hYmxlZCA9IE5vbmU7DQogICAgZGVmIGVuYWJsZWQoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fZW5hYmxlZCA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9lbmFibGVkOw0KDQoNCiAgICANCiAgICAjIGNvZGU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfY29kZSA9IE5vbmU7DQogICAgZGVmIGNvZGUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fY29kZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9jb2RlOw0KDQoNCiAgICANCiAgICAjIG9yZGVyOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX29yZGVyID0gTm9uZTsNCiAgICBkZWYgb3JkZXIoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fb3JkZXIgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fb3JkZXI7DQoNCg0KICAgIA0KICAgICMgZGF0ZTogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9kYXRlID0gTm9uZTsNCiAgICBkZWYgZGF0ZShzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9kYXRlID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2RhdGU7DQoNCg0KICAgIA0KICAgICMgbmFtZTogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9uYW1lID0gTm9uZTsNCiAgICBkZWYgbmFtZShzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9uYW1lID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX25hbWU7DQoNCg0KICAgIA0KICAgICMgcmVtYXJrOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX3JlbWFyayA9IE5vbmU7DQogICAgZGVmIHJlbWFyayhzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9yZW1hcmsgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fcmVtYXJrOw0KDQoNCiAgICANCiAgICAjIHZhbHVlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX3ZhbHVlID0gTm9uZTsNCiAgICBkZWYgdmFsdWUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fdmFsdWUgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fdmFsdWU7DQoNCg0KICAgIA0KICAgICMgbWV0cmljOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX21ldHJpYyA9IE5vbmU7DQogICAgZGVmIG1ldHJpYyhzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9tZXRyaWMgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fbWV0cmljOw0KDQoNCiAgICANCiAgICAjIGRldmljZTogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9kZXZpY2UgPSBOb25lOw0KICAgIGRlZiBkZXZpY2Uoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fZGV2aWNlID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2RldmljZTsNCg0KDQogICAgDQogICAgIyBjb250cm9sbGVyOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2NvbnRyb2xsZXIgPSBOb25lOw0KICAgIGRlZiBjb250cm9sbGVyKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2NvbnRyb2xsZXIgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fY29udHJvbGxlcjsNCg0KDQogICAgDQogICAgIyBleGVjdXRpb246IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfZXhlY3V0aW9uID0gTm9uZTsNCiAgICBkZWYgZXhlY3V0aW9uKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2V4ZWN1dGlvbiA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9leGVjdXRpb247DQoNCg0KICAgIA0KICAgIA0KICAgIGRlZiBfZnJvbURvY3VtZW50KHNlbGYsIG9iaik6DQogICAgICAgIF9fdG9TdHJpbmcgPSAnTWV0cmljX1ZhbHVlOjpfZnJvbURvY3VtZW50KCk6ICc7DQoNCiAgICAgICAgaWYgb2JqIGlzIE5vbmU6DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgDQogICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLCBieXRlcyk6DQogICAgICAgICAgICBvYmogPSBzdHIob2JqLCAidXRmLTgiKTsNCg0KICAgICAgICBpZiBpc2luc3RhbmNlKG9iaiwgc3RyKSBvciB0eXBlKG9iaikgaXMgc3RyOg0KICAgICAgICAgICAgb2JqID0ganNvbi5sb2FkcyhvYmopOw0KICAgICAgICANCiAgICAgICAgaWYgbm90IGlzaW5zdGFuY2Uob2JqLCAoc3RyLCBieXRlcywgZGljdCkpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICdHT1QgSEVSRTogJyArIHN0cih0eXBlKG9iaikpKTsNCiAgICAgICAgICAgIHJldHVybiBvYmo7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGZvciBpIGluIG9iajoNCiAgICAgICAgICAgICAgICBvYmpbaV0gPSBNZXRyaWNfVmFsdWUoKS5fZnJvbURvY3VtZW50KG9ialtpXSk7DQogICAgICAgICAgICByZXR1cm4gb2JqOw0KDQoNCiAgICAgICAgaWYgJ0lkJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLklkID0gb2JqWydJZCddOw0KDQogICAgDQogICAgICAgIGlmICdhY3RpdmUnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuYWN0aXZlKG9ialsnYWN0aXZlJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ2VuYWJsZWQnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuZW5hYmxlZChvYmpbJ2VuYWJsZWQnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnY29kZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5jb2RlKG9ialsnY29kZSddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdvcmRlcicgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5vcmRlcihvYmpbJ29yZGVyJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ2RhdGUnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuZGF0ZShvYmpbJ2RhdGUnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnbmFtZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5uYW1lKG9ialsnbmFtZSddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdyZW1hcmsnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYucmVtYXJrKG9ialsncmVtYXJrJ10pOw0KICAgICAgICANCiAgICAgICAgICAgIHNlbGYucmVtYXJrKCBiYXNlNjQuYjY0ZW5jb2RlKHNlbGYucmVtYXJrKCkuZW5jb2RlKCJhc2NpaSIpKS5kZWNvZGUoImFzY2lpIikgKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICd2YWx1ZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi52YWx1ZShvYmpbJ3ZhbHVlJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ21ldHJpYycgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5tZXRyaWMoTWV0cmljKCkuX2Zyb21Eb2N1bWVudChvYmpbJ21ldHJpYyddKSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnZGV2aWNlJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmRldmljZShEZXZpY2UoKS5fZnJvbURvY3VtZW50KG9ialsnZGV2aWNlJ10pKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdjb250cm9sbGVyJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmNvbnRyb2xsZXIoTm9kZSgpLl9mcm9tRG9jdW1lbnQob2JqWydjb250cm9sbGVyJ10pKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdleGVjdXRpb24nIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuZXhlY3V0aW9uKG9ialsnZXhlY3V0aW9uJ10pOw0KICAgICAgICANCiAgICANCg0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIHJldHVybiBzZWxmOw0KICAgIA0KICAgIGRlZiBfdG9Eb2N1bWVudChzZWxmKToNCiAgICAgICAgcmV0ID0ge307DQogICAgICAgIGlmIHNlbGYuSWQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbIklkIl0gPSBzZWxmLklkOw0KDQogICAgDQogICAgICAgIGlmIHNlbGYuYWN0aXZlKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbImFjdGl2ZSJdID0gc2VsZi5hY3RpdmUoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYuZW5hYmxlZCgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJlbmFibGVkIl0gPSBzZWxmLmVuYWJsZWQoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYuY29kZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJjb2RlIl0gPSBzZWxmLmNvZGUoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYub3JkZXIoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsib3JkZXIiXSA9IHNlbGYub3JkZXIoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYuZGF0ZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJkYXRlIl0gPSBzZWxmLmRhdGUoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYubmFtZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJuYW1lIl0gPSBzZWxmLm5hbWUoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYucmVtYXJrKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbInJlbWFyayJdID0gc2VsZi5yZW1hcmsoKTsNCiAgICAgICAgDQogICAgICAgICAgICBpZiBpc2luc3RhbmNlKHJldFsicmVtYXJrIl0sIGRpY3QpOg0KICAgICAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSBqc29uLmR1bXBzKHJldFsicmVtYXJrIl0pOw0KICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IHViaW5hc2NpaS5iMmFfYmFzZTY0KHJldFsicmVtYXJrIl0pLnN0cmlwKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLnZhbHVlKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbInZhbHVlIl0gPSBzZWxmLnZhbHVlKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLm1ldHJpYygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJtZXRyaWMiXSA9IHNlbGYubWV0cmljKCkuX3RvRG9jdW1lbnQoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYuZGV2aWNlKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbImRldmljZSJdID0gc2VsZi5kZXZpY2UoKS5fdG9Eb2N1bWVudCgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5jb250cm9sbGVyKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbImNvbnRyb2xsZXIiXSA9IHNlbGYuY29udHJvbGxlcigpLl90b0RvY3VtZW50KCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmV4ZWN1dGlvbigpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJleGVjdXRpb24iXSA9IHNlbGYuZXhlY3V0aW9uKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICANCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICByZXR1cm4gcmV0Ow0KDQogICAgDQogICAgZGVmIHN0b3JlKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6DQogICAgICAgIF9fdG9TdHJpbmcgPSAnTWV0cmljX1ZhbHVlOjpzdG9yZSgpOiAnOw0KICAgICAgICANCiAgICAgICAgZXZKU09OID0gTm9uZTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgZXZKU09OID0ganNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046DQogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOw0KICAgICAgICANCg0KICAgICAgICBhbnN3ZXIgPSBOb25lOw0KDQogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aWNrc19tcygpKSsnXS5NZXRyaWNfVmFsdWUuc3RvcmUoKScpLm1ldGhvZCgnc3RvcmUnKS5jbGFzc05hbWUoJ01ldHJpY19WYWx1ZScpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7DQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KICAgICAgICANCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICBhbnN3ZXIgPSBNZXRyaWNfVmFsdWUoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KICAgICAgICANCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQoNCg0KDQogICAgICAgIGlmICdNZXRyaWNfVmFsdWVfc3RvcmUnIGluIGRpcigpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICc9PT4gTWV0cmljX1ZhbHVlX3N0b3JlKCknKTsNCiAgICAgICAgICAgIGFuc3dlciA9IE1ldHJpY19WYWx1ZV9zdG9yZShzZWxmLCBfX2V2ZW50LCBhbnN3ZXIsIF9fdG9TdHJpbmcpOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCg0KICAgICAgICAgICAgDQogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KDQogICAgICAgIHJldHVybiBhbnN3ZXI7DQoNCiAgICANCiAgICBkZWYgZmluZEFsbChzZWxmLCBfX2V2ZW50PU5vbmUpOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ01ldHJpY19WYWx1ZTo6ZmluZEFsbCgpOiAnOw0KICAgICAgICANCiAgICAgICAgZXZKU09OID0gTm9uZTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgZXZKU09OID0ganNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046DQogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOw0KICAgICAgICANCg0KICAgICAgICBhbnN3ZXIgPSBOb25lOw0KDQogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aWNrc19tcygpKSsnXS5NZXRyaWNfVmFsdWUuZmluZEFsbCgpJykubWV0aG9kKCdmaW5kQWxsJykuY2xhc3NOYW1lKCdNZXRyaWNfVmFsdWUnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOw0KICAgICAgICANCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCiAgICAgICAgDQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgYW5zd2VyID0gTWV0cmljX1ZhbHVlKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCiAgICAgICAgDQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KDQoNCg0KICAgICAgICBpZiAnTWV0cmljX1ZhbHVlX2ZpbmRBbGwnIGluIGRpcigpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICc9PT4gTWV0cmljX1ZhbHVlX2ZpbmRBbGwoKScpOw0KICAgICAgICAgICAgYW5zd2VyID0gTWV0cmljX1ZhbHVlX2ZpbmRBbGwoc2VsZiwgX19ldmVudCwgYW5zd2VyLCBfX3RvU3RyaW5nKTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCg0KICAgICAgICByZXR1cm4gYW5zd2VyOw0KDQogICAgDQogICAgZGVmIGZpbmQoc2VsZiwgX19ldmVudD1Ob25lKToNCiAgICAgICAgX190b1N0cmluZyA9ICdNZXRyaWNfVmFsdWU6OmZpbmQoKTogJzsNCiAgICAgICAgDQogICAgICAgIGV2SlNPTiA9IE5vbmU7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIGV2SlNPTiA9IGpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOg0KICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsNCiAgICAgICAgDQoNCiAgICAgICAgYW5zd2VyID0gTm9uZTsNCg0KICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGlja3NfbXMoKSkrJ10uTWV0cmljX1ZhbHVlLmZpbmQoKScpLm1ldGhvZCgnZmluZCcpLmNsYXNzTmFtZSgnTWV0cmljX1ZhbHVlJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOw0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsNCiAgICAgICAgDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQogICAgICAgIA0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgIGFuc3dlciA9IE1ldHJpY19WYWx1ZSgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQogICAgICAgIA0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCg0KDQoNCiAgICAgICAgaWYgJ01ldHJpY19WYWx1ZV9maW5kJyBpbiBkaXIoKToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnPT0+IE1ldHJpY19WYWx1ZV9maW5kKCknKTsNCiAgICAgICAgICAgIGFuc3dlciA9IE1ldHJpY19WYWx1ZV9maW5kKHNlbGYsIF9fZXZlbnQsIGFuc3dlciwgX190b1N0cmluZyk7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KDQogICAgICAgICAgICANCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQoNCiAgICAgICAgcmV0dXJuIGFuc3dlcjsNCg0KICAgIA0KDQoNCmNsYXNzIE1ldHJpYygpOg0KICAgIGRlZiBfX2luaXRfXyhzZWxmLCBJZD1Ob25lLCBhY3RpdmU9Tm9uZSwgZW5hYmxlZD1Ob25lLCBjb2RlPU5vbmUsIG9yZGVyPU5vbmUsIGRhdGU9Tm9uZSwgbmFtZT1Ob25lLCByZW1hcms9Tm9uZSwgdHlwZT1Ob25lLCBkZXZpY2VUeXBlPU5vbmUpOg0KICAgICAgICBzdXBlcigpLl9faW5pdF9fKCk7DQoNCiAgICAgICAgI3ByaW50KCdNZXRyaWM6Ol9faW5pdF9fKCknKTsNCiAgICAgICAgaWYgSWQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBzZWxmLklkID0gSWQ7DQoNCiAgICAgICAgDQogICAgICAgIHNlbGYuYWN0aXZlKGFjdGl2ZSk7DQogICAgICAgIHNlbGYuZW5hYmxlZChlbmFibGVkKTsNCiAgICAgICAgc2VsZi5jb2RlKGNvZGUpOw0KICAgICAgICBzZWxmLm9yZGVyKG9yZGVyKTsNCiAgICAgICAgc2VsZi5kYXRlKGRhdGUpOw0KICAgICAgICBzZWxmLm5hbWUobmFtZSk7DQogICAgICAgIHNlbGYucmVtYXJrKHJlbWFyayk7DQogICAgICAgIHNlbGYudHlwZSh0eXBlKTsNCiAgICAgICAgc2VsZi5kZXZpY2VUeXBlKGRldmljZVR5cGUpOw0KICAgICAgICANCiAgICBJZCA9IE5vbmU7DQogICAgDQogICAgDQogICAgIyBhY3RpdmU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfYWN0aXZlID0gTm9uZTsNCiAgICBkZWYgYWN0aXZlKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2FjdGl2ZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9hY3RpdmU7DQoNCg0KICAgIA0KICAgICMgZW5hYmxlZDogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9lbmFibGVkID0gTm9uZTsNCiAgICBkZWYgZW5hYmxlZChzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9lbmFibGVkID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2VuYWJsZWQ7DQoNCg0KICAgIA0KICAgICMgY29kZTogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9jb2RlID0gTm9uZTsNCiAgICBkZWYgY29kZShzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9jb2RlID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2NvZGU7DQoNCg0KICAgIA0KICAgICMgb3JkZXI6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfb3JkZXIgPSBOb25lOw0KICAgIGRlZiBvcmRlcihzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9vcmRlciA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9vcmRlcjsNCg0KDQogICAgDQogICAgIyBkYXRlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2RhdGUgPSBOb25lOw0KICAgIGRlZiBkYXRlKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2RhdGUgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fZGF0ZTsNCg0KDQogICAgDQogICAgIyBuYW1lOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX25hbWUgPSBOb25lOw0KICAgIGRlZiBuYW1lKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX25hbWUgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fbmFtZTsNCg0KDQogICAgDQogICAgIyByZW1hcms6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfcmVtYXJrID0gTm9uZTsNCiAgICBkZWYgcmVtYXJrKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX3JlbWFyayA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9yZW1hcms7DQoNCg0KICAgIA0KICAgICMgdHlwZTogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF90eXBlID0gTm9uZTsNCiAgICBkZWYgdHlwZShzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl90eXBlID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3R5cGU7DQoNCg0KICAgIA0KICAgICMgZGV2aWNlVHlwZTogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9kZXZpY2VUeXBlID0gTm9uZTsNCiAgICBkZWYgZGV2aWNlVHlwZShzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9kZXZpY2VUeXBlID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2RldmljZVR5cGU7DQoNCg0KICAgIA0KICAgIA0KICAgIGRlZiBfZnJvbURvY3VtZW50KHNlbGYsIG9iaik6DQogICAgICAgIF9fdG9TdHJpbmcgPSAnTWV0cmljOjpfZnJvbURvY3VtZW50KCk6ICc7DQoNCiAgICAgICAgaWYgb2JqIGlzIE5vbmU6DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgDQogICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLCBieXRlcyk6DQogICAgICAgICAgICBvYmogPSBzdHIob2JqLCAidXRmLTgiKTsNCg0KICAgICAgICBpZiBpc2luc3RhbmNlKG9iaiwgc3RyKSBvciB0eXBlKG9iaikgaXMgc3RyOg0KICAgICAgICAgICAgb2JqID0ganNvbi5sb2FkcyhvYmopOw0KICAgICAgICANCiAgICAgICAgaWYgbm90IGlzaW5zdGFuY2Uob2JqLCAoc3RyLCBieXRlcywgZGljdCkpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICdHT1QgSEVSRTogJyArIHN0cih0eXBlKG9iaikpKTsNCiAgICAgICAgICAgIHJldHVybiBvYmo7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGZvciBpIGluIG9iajoNCiAgICAgICAgICAgICAgICBvYmpbaV0gPSBNZXRyaWMoKS5fZnJvbURvY3VtZW50KG9ialtpXSk7DQogICAgICAgICAgICByZXR1cm4gb2JqOw0KDQoNCiAgICAgICAgaWYgJ0lkJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLklkID0gb2JqWydJZCddOw0KDQogICAgDQogICAgICAgIGlmICdhY3RpdmUnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuYWN0aXZlKG9ialsnYWN0aXZlJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ2VuYWJsZWQnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuZW5hYmxlZChvYmpbJ2VuYWJsZWQnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnY29kZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5jb2RlKG9ialsnY29kZSddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdvcmRlcicgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5vcmRlcihvYmpbJ29yZGVyJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ2RhdGUnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuZGF0ZShvYmpbJ2RhdGUnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnbmFtZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5uYW1lKG9ialsnbmFtZSddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdyZW1hcmsnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYucmVtYXJrKG9ialsncmVtYXJrJ10pOw0KICAgICAgICANCiAgICAgICAgICAgIHNlbGYucmVtYXJrKCBiYXNlNjQuYjY0ZW5jb2RlKHNlbGYucmVtYXJrKCkuZW5jb2RlKCJhc2NpaSIpKS5kZWNvZGUoImFzY2lpIikgKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICd0eXBlJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLnR5cGUoTWV0cmljX1R5cGUoKS5fZnJvbURvY3VtZW50KG9ialsndHlwZSddKSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnZGV2aWNlVHlwZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5kZXZpY2VUeXBlKERldmljZV9UeXBlKCkuX2Zyb21Eb2N1bWVudChvYmpbJ2RldmljZVR5cGUnXSkpOw0KICAgICAgICANCiAgICANCg0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIHJldHVybiBzZWxmOw0KICAgIA0KICAgIGRlZiBfdG9Eb2N1bWVudChzZWxmKToNCiAgICAgICAgcmV0ID0ge307DQogICAgICAgIGlmIHNlbGYuSWQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbIklkIl0gPSBzZWxmLklkOw0KDQogICAgDQogICAgICAgIGlmIHNlbGYuYWN0aXZlKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbImFjdGl2ZSJdID0gc2VsZi5hY3RpdmUoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYuZW5hYmxlZCgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJlbmFibGVkIl0gPSBzZWxmLmVuYWJsZWQoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYuY29kZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJjb2RlIl0gPSBzZWxmLmNvZGUoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYub3JkZXIoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsib3JkZXIiXSA9IHNlbGYub3JkZXIoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYuZGF0ZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJkYXRlIl0gPSBzZWxmLmRhdGUoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYubmFtZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJuYW1lIl0gPSBzZWxmLm5hbWUoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYucmVtYXJrKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbInJlbWFyayJdID0gc2VsZi5yZW1hcmsoKTsNCiAgICAgICAgDQogICAgICAgICAgICBpZiBpc2luc3RhbmNlKHJldFsicmVtYXJrIl0sIGRpY3QpOg0KICAgICAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSBqc29uLmR1bXBzKHJldFsicmVtYXJrIl0pOw0KICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IHViaW5hc2NpaS5iMmFfYmFzZTY0KHJldFsicmVtYXJrIl0pLnN0cmlwKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLnR5cGUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsidHlwZSJdID0gc2VsZi50eXBlKCkuX3RvRG9jdW1lbnQoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYuZGV2aWNlVHlwZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJkZXZpY2VUeXBlIl0gPSBzZWxmLmRldmljZVR5cGUoKS5fdG9Eb2N1bWVudCgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgcmV0dXJuIHJldDsNCg0KICAgIA0KICAgIGRlZiBzdG9yZShzZWxmLCBfX2V2ZW50PU5vbmUpOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ01ldHJpYzo6c3RvcmUoKTogJzsNCiAgICAgICAgDQogICAgICAgIGV2SlNPTiA9IE5vbmU7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIGV2SlNPTiA9IGpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOg0KICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsNCiAgICAgICAgDQoNCiAgICAgICAgYW5zd2VyID0gTm9uZTsNCg0KICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGlja3NfbXMoKSkrJ10uTWV0cmljLnN0b3JlKCknKS5tZXRob2QoJ3N0b3JlJykuY2xhc3NOYW1lKCdNZXRyaWMnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOw0KICAgICAgICANCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCiAgICAgICAgDQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgYW5zd2VyID0gTWV0cmljKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCiAgICAgICAgDQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KDQoNCg0KICAgICAgICBpZiAnTWV0cmljX3N0b3JlJyBpbiBkaXIoKToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnPT0+IE1ldHJpY19zdG9yZSgpJyk7DQogICAgICAgICAgICBhbnN3ZXIgPSBNZXRyaWNfc3RvcmUoc2VsZiwgX19ldmVudCwgYW5zd2VyLCBfX3RvU3RyaW5nKTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCg0KICAgICAgICByZXR1cm4gYW5zd2VyOw0KDQogICAgDQogICAgZGVmIGZpbmRBbGwoc2VsZiwgX19ldmVudD1Ob25lKToNCiAgICAgICAgX190b1N0cmluZyA9ICdNZXRyaWM6OmZpbmRBbGwoKTogJzsNCiAgICAgICAgDQogICAgICAgIGV2SlNPTiA9IE5vbmU7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIGV2SlNPTiA9IGpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOg0KICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsNCiAgICAgICAgDQoNCiAgICAgICAgYW5zd2VyID0gTm9uZTsNCg0KICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGlja3NfbXMoKSkrJ10uTWV0cmljLmZpbmRBbGwoKScpLm1ldGhvZCgnZmluZEFsbCcpLmNsYXNzTmFtZSgnTWV0cmljJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOw0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsNCiAgICAgICAgDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQogICAgICAgIA0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgIGFuc3dlciA9IE1ldHJpYygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQogICAgICAgIA0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCg0KDQoNCiAgICAgICAgaWYgJ01ldHJpY19maW5kQWxsJyBpbiBkaXIoKToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnPT0+IE1ldHJpY19maW5kQWxsKCknKTsNCiAgICAgICAgICAgIGFuc3dlciA9IE1ldHJpY19maW5kQWxsKHNlbGYsIF9fZXZlbnQsIGFuc3dlciwgX190b1N0cmluZyk7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KDQogICAgICAgICAgICANCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQoNCiAgICAgICAgcmV0dXJuIGFuc3dlcjsNCg0KICAgIA0KICAgIGRlZiBmaW5kKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6DQogICAgICAgIF9fdG9TdHJpbmcgPSAnTWV0cmljOjpmaW5kKCk6ICc7DQogICAgICAgIA0KICAgICAgICBldkpTT04gPSBOb25lOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBldkpTT04gPSBqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoNCiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7DQogICAgICAgIA0KDQogICAgICAgIGFuc3dlciA9IE5vbmU7DQoNCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpY2tzX21zKCkpKyddLk1ldHJpYy5maW5kKCknKS5tZXRob2QoJ2ZpbmQnKS5jbGFzc05hbWUoJ01ldHJpYycpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7DQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KICAgICAgICANCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICBhbnN3ZXIgPSBNZXRyaWMoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KICAgICAgICANCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQoNCg0KDQogICAgICAgIGlmICdNZXRyaWNfZmluZCcgaW4gZGlyKCk6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJz09PiBNZXRyaWNfZmluZCgpJyk7DQogICAgICAgICAgICBhbnN3ZXIgPSBNZXRyaWNfZmluZChzZWxmLCBfX2V2ZW50LCBhbnN3ZXIsIF9fdG9TdHJpbmcpOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCg0KICAgICAgICAgICAgDQogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KDQogICAgICAgIHJldHVybiBhbnN3ZXI7DQoNCiAgICANCg0KDQpjbGFzcyBDb25maWcoKToNCiAgICBkZWYgX19pbml0X18oc2VsZiwgSWQ9Tm9uZSwgYWN0aXZlPU5vbmUsIGVuYWJsZWQ9Tm9uZSwgY29kZT1Ob25lLCBvcmRlcj1Ob25lLCBkYXRlPU5vbmUsIG5hbWU9Tm9uZSwgcmVtYXJrPU5vbmUsIHZhbHVlPU5vbmUsIHNjcmlwdD1Ob25lLCB0b29sPU5vbmUsIGdyb3VwPU5vbmUsIHR5cGU9Tm9uZSwgbm9kZT1Ob25lKToNCiAgICAgICAgc3VwZXIoKS5fX2luaXRfXygpOw0KDQogICAgICAgICNwcmludCgnQ29uZmlnOjpfX2luaXRfXygpJyk7DQogICAgICAgIGlmIElkIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgc2VsZi5JZCA9IElkOw0KDQogICAgICAgIA0KICAgICAgICBzZWxmLmFjdGl2ZShhY3RpdmUpOw0KICAgICAgICBzZWxmLmVuYWJsZWQoZW5hYmxlZCk7DQogICAgICAgIHNlbGYuY29kZShjb2RlKTsNCiAgICAgICAgc2VsZi5vcmRlcihvcmRlcik7DQogICAgICAgIHNlbGYuZGF0ZShkYXRlKTsNCiAgICAgICAgc2VsZi5uYW1lKG5hbWUpOw0KICAgICAgICBzZWxmLnJlbWFyayhyZW1hcmspOw0KICAgICAgICBzZWxmLnZhbHVlKHZhbHVlKTsNCiAgICAgICAgc2VsZi5zY3JpcHQoc2NyaXB0KTsNCiAgICAgICAgc2VsZi50b29sKHRvb2wpOw0KICAgICAgICBzZWxmLmdyb3VwKGdyb3VwKTsNCiAgICAgICAgc2VsZi50eXBlKHR5cGUpOw0KICAgICAgICBzZWxmLm5vZGUobm9kZSk7DQogICAgICAgIA0KICAgIElkID0gTm9uZTsNCiAgICANCiAgICANCiAgICAjIGFjdGl2ZTogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9hY3RpdmUgPSBOb25lOw0KICAgIGRlZiBhY3RpdmUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fYWN0aXZlID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2FjdGl2ZTsNCg0KDQogICAgDQogICAgIyBlbmFibGVkOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2VuYWJsZWQgPSBOb25lOw0KICAgIGRlZiBlbmFibGVkKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2VuYWJsZWQgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fZW5hYmxlZDsNCg0KDQogICAgDQogICAgIyBjb2RlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2NvZGUgPSBOb25lOw0KICAgIGRlZiBjb2RlKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2NvZGUgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fY29kZTsNCg0KDQogICAgDQogICAgIyBvcmRlcjogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9vcmRlciA9IE5vbmU7DQogICAgZGVmIG9yZGVyKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX29yZGVyID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX29yZGVyOw0KDQoNCiAgICANCiAgICAjIGRhdGU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfZGF0ZSA9IE5vbmU7DQogICAgZGVmIGRhdGUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fZGF0ZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9kYXRlOw0KDQoNCiAgICANCiAgICAjIG5hbWU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfbmFtZSA9IE5vbmU7DQogICAgZGVmIG5hbWUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fbmFtZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9uYW1lOw0KDQoNCiAgICANCiAgICAjIHJlbWFyazogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9yZW1hcmsgPSBOb25lOw0KICAgIGRlZiByZW1hcmsoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fcmVtYXJrID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3JlbWFyazsNCg0KDQogICAgDQogICAgIyB2YWx1ZTogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF92YWx1ZSA9IE5vbmU7DQogICAgZGVmIHZhbHVlKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX3ZhbHVlID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3ZhbHVlOw0KDQoNCiAgICANCiAgICAjIHNjcmlwdDogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9zY3JpcHQgPSBOb25lOw0KICAgIGRlZiBzY3JpcHQoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fc2NyaXB0ID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3NjcmlwdDsNCg0KDQogICAgDQogICAgIyB0b29sOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX3Rvb2wgPSBOb25lOw0KICAgIGRlZiB0b29sKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX3Rvb2wgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fdG9vbDsNCg0KDQogICAgDQogICAgIyBncm91cDogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9ncm91cCA9IE5vbmU7DQogICAgZGVmIGdyb3VwKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2dyb3VwID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2dyb3VwOw0KDQoNCiAgICANCiAgICAjIHR5cGU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfdHlwZSA9IE5vbmU7DQogICAgZGVmIHR5cGUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fdHlwZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl90eXBlOw0KDQoNCiAgICANCiAgICAjIG5vZGU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfbm9kZSA9IE5vbmU7DQogICAgZGVmIG5vZGUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fbm9kZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9ub2RlOw0KDQoNCiAgICANCiAgICANCiAgICBkZWYgX2Zyb21Eb2N1bWVudChzZWxmLCBvYmopOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ0NvbmZpZzo6X2Zyb21Eb2N1bWVudCgpOiAnOw0KDQogICAgICAgIGlmIG9iaiBpcyBOb25lOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIA0KICAgICAgICBpZiBpc2luc3RhbmNlKG9iaiwgYnl0ZXMpOg0KICAgICAgICAgICAgb2JqID0gc3RyKG9iaiwgInV0Zi04Iik7DQoNCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIHN0cikgb3IgdHlwZShvYmopIGlzIHN0cjoNCiAgICAgICAgICAgIG9iaiA9IGpzb24ubG9hZHMob2JqKTsNCiAgICAgICAgDQogICAgICAgIGlmIG5vdCBpc2luc3RhbmNlKG9iaiwgKHN0ciwgYnl0ZXMsIGRpY3QpKToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnR09UIEhFUkU6ICcgKyBzdHIodHlwZShvYmopKSk7DQogICAgICAgICAgICByZXR1cm4gb2JqOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBmb3IgaSBpbiBvYmo6DQogICAgICAgICAgICAgICAgb2JqW2ldID0gQ29uZmlnKCkuX2Zyb21Eb2N1bWVudChvYmpbaV0pOw0KICAgICAgICAgICAgcmV0dXJuIG9iajsNCg0KDQogICAgICAgIGlmICdJZCcgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5JZCA9IG9ialsnSWQnXTsNCg0KICAgIA0KICAgICAgICBpZiAnYWN0aXZlJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmFjdGl2ZShvYmpbJ2FjdGl2ZSddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdlbmFibGVkJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmVuYWJsZWQob2JqWydlbmFibGVkJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ2NvZGUnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuY29kZShvYmpbJ2NvZGUnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnb3JkZXInIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYub3JkZXIob2JqWydvcmRlciddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdkYXRlJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmRhdGUob2JqWydkYXRlJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ25hbWUnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYubmFtZShvYmpbJ25hbWUnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAncmVtYXJrJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLnJlbWFyayhvYmpbJ3JlbWFyayddKTsNCiAgICAgICAgDQogICAgICAgICAgICBzZWxmLnJlbWFyayggYmFzZTY0LmI2NGVuY29kZShzZWxmLnJlbWFyaygpLmVuY29kZSgiYXNjaWkiKSkuZGVjb2RlKCJhc2NpaSIpICk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAndmFsdWUnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYudmFsdWUob2JqWyd2YWx1ZSddKTsNCiAgICAgICAgDQogICAgICAgICAgICBzZWxmLnZhbHVlKCBiYXNlNjQuYjY0ZW5jb2RlKHNlbGYudmFsdWUoKS5lbmNvZGUoImFzY2lpIikpLmRlY29kZSgiYXNjaWkiKSApOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ3NjcmlwdCcgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5zY3JpcHQob2JqWydzY3JpcHQnXSk7DQogICAgICAgIA0KICAgICAgICAgICAgc2VsZi5zY3JpcHQoIGJhc2U2NC5iNjRlbmNvZGUoc2VsZi5zY3JpcHQoKS5lbmNvZGUoImFzY2lpIikpLmRlY29kZSgiYXNjaWkiKSApOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ3Rvb2wnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYudG9vbChUb29sKCkuX2Zyb21Eb2N1bWVudChvYmpbJ3Rvb2wnXSkpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ2dyb3VwJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmdyb3VwKENvbmZpZ19Hcm91cCgpLl9mcm9tRG9jdW1lbnQob2JqWydncm91cCddKSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAndHlwZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi50eXBlKFRvb2xfVHlwZSgpLl9mcm9tRG9jdW1lbnQob2JqWyd0eXBlJ10pKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdub2RlJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLm5vZGUoTm9kZSgpLl9mcm9tRG9jdW1lbnQob2JqWydub2RlJ10pKTsNCiAgICAgICAgDQogICAgDQoNCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICByZXR1cm4gc2VsZjsNCiAgICANCiAgICBkZWYgX3RvRG9jdW1lbnQoc2VsZik6DQogICAgICAgIHJldCA9IHt9Ow0KICAgICAgICBpZiBzZWxmLklkIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJJZCJdID0gc2VsZi5JZDsNCg0KICAgIA0KICAgICAgICBpZiBzZWxmLmFjdGl2ZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJhY3RpdmUiXSA9IHNlbGYuYWN0aXZlKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmVuYWJsZWQoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiZW5hYmxlZCJdID0gc2VsZi5lbmFibGVkKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmNvZGUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiY29kZSJdID0gc2VsZi5jb2RlKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLm9yZGVyKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbIm9yZGVyIl0gPSBzZWxmLm9yZGVyKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmRhdGUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiZGF0ZSJdID0gc2VsZi5kYXRlKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLm5hbWUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsibmFtZSJdID0gc2VsZi5uYW1lKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLnJlbWFyaygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IHNlbGYucmVtYXJrKCk7DQogICAgICAgIA0KICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShyZXRbInJlbWFyayJdLCBkaWN0KToNCiAgICAgICAgICAgICAgICByZXRbInJlbWFyayJdID0ganNvbi5kdW1wcyhyZXRbInJlbWFyayJdKTsNCiAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSB1YmluYXNjaWkuYjJhX2Jhc2U2NChyZXRbInJlbWFyayJdKS5zdHJpcCgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi52YWx1ZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJ2YWx1ZSJdID0gc2VsZi52YWx1ZSgpOw0KICAgICAgICANCiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UocmV0WyJ2YWx1ZSJdLCBkaWN0KToNCiAgICAgICAgICAgICAgICByZXRbInZhbHVlIl0gPSBqc29uLmR1bXBzKHJldFsidmFsdWUiXSk7DQogICAgICAgICAgICByZXRbInZhbHVlIl0gPSB1YmluYXNjaWkuYjJhX2Jhc2U2NChyZXRbInZhbHVlIl0pLnN0cmlwKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLnNjcmlwdCgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJzY3JpcHQiXSA9IHNlbGYuc2NyaXB0KCk7DQogICAgICAgIA0KICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShyZXRbInNjcmlwdCJdLCBkaWN0KToNCiAgICAgICAgICAgICAgICByZXRbInNjcmlwdCJdID0ganNvbi5kdW1wcyhyZXRbInNjcmlwdCJdKTsNCiAgICAgICAgICAgIHJldFsic2NyaXB0Il0gPSB1YmluYXNjaWkuYjJhX2Jhc2U2NChyZXRbInNjcmlwdCJdKS5zdHJpcCgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi50b29sKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbInRvb2wiXSA9IHNlbGYudG9vbCgpLl90b0RvY3VtZW50KCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmdyb3VwKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbImdyb3VwIl0gPSBzZWxmLmdyb3VwKCkuX3RvRG9jdW1lbnQoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYudHlwZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJ0eXBlIl0gPSBzZWxmLnR5cGUoKS5fdG9Eb2N1bWVudCgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5ub2RlKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbIm5vZGUiXSA9IHNlbGYubm9kZSgpLl90b0RvY3VtZW50KCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICANCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICByZXR1cm4gcmV0Ow0KDQogICAgDQogICAgZGVmIHN0b3JlKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6DQogICAgICAgIF9fdG9TdHJpbmcgPSAnQ29uZmlnOjpzdG9yZSgpOiAnOw0KICAgICAgICANCiAgICAgICAgZXZKU09OID0gTm9uZTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgZXZKU09OID0ganNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046DQogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOw0KICAgICAgICANCg0KICAgICAgICBhbnN3ZXIgPSBOb25lOw0KDQogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aWNrc19tcygpKSsnXS5Db25maWcuc3RvcmUoKScpLm1ldGhvZCgnc3RvcmUnKS5jbGFzc05hbWUoJ0NvbmZpZycpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7DQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KICAgICAgICANCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICBhbnN3ZXIgPSBDb25maWcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KICAgICAgICANCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQoNCg0KDQogICAgICAgIGlmICdDb25maWdfc3RvcmUnIGluIGRpcigpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICc9PT4gQ29uZmlnX3N0b3JlKCknKTsNCiAgICAgICAgICAgIGFuc3dlciA9IENvbmZpZ19zdG9yZShzZWxmLCBfX2V2ZW50LCBhbnN3ZXIsIF9fdG9TdHJpbmcpOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCg0KICAgICAgICAgICAgDQogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KDQogICAgICAgIHJldHVybiBhbnN3ZXI7DQoNCiAgICANCiAgICBkZWYgZmluZEFsbChzZWxmLCBfX2V2ZW50PU5vbmUpOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ0NvbmZpZzo6ZmluZEFsbCgpOiAnOw0KICAgICAgICANCiAgICAgICAgZXZKU09OID0gTm9uZTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgZXZKU09OID0ganNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046DQogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOw0KICAgICAgICANCg0KICAgICAgICBhbnN3ZXIgPSBOb25lOw0KDQogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aWNrc19tcygpKSsnXS5Db25maWcuZmluZEFsbCgpJykubWV0aG9kKCdmaW5kQWxsJykuY2xhc3NOYW1lKCdDb25maWcnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOw0KICAgICAgICANCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCiAgICAgICAgDQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgYW5zd2VyID0gQ29uZmlnKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCiAgICAgICAgDQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KDQoNCg0KICAgICAgICBpZiAnQ29uZmlnX2ZpbmRBbGwnIGluIGRpcigpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICc9PT4gQ29uZmlnX2ZpbmRBbGwoKScpOw0KICAgICAgICAgICAgYW5zd2VyID0gQ29uZmlnX2ZpbmRBbGwoc2VsZiwgX19ldmVudCwgYW5zd2VyLCBfX3RvU3RyaW5nKTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCg0KICAgICAgICByZXR1cm4gYW5zd2VyOw0KDQogICAgDQogICAgZGVmIGZpbmQoc2VsZiwgX19ldmVudD1Ob25lKToNCiAgICAgICAgX190b1N0cmluZyA9ICdDb25maWc6OmZpbmQoKTogJzsNCiAgICAgICAgDQogICAgICAgIGV2SlNPTiA9IE5vbmU7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIGV2SlNPTiA9IGpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOg0KICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsNCiAgICAgICAgDQoNCiAgICAgICAgYW5zd2VyID0gTm9uZTsNCg0KICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGlja3NfbXMoKSkrJ10uQ29uZmlnLmZpbmQoKScpLm1ldGhvZCgnZmluZCcpLmNsYXNzTmFtZSgnQ29uZmlnJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOw0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsNCiAgICAgICAgDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQogICAgICAgIA0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgIGFuc3dlciA9IENvbmZpZygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQogICAgICAgIA0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCg0KDQoNCiAgICAgICAgaWYgJ0NvbmZpZ19maW5kJyBpbiBkaXIoKToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnPT0+IENvbmZpZ19maW5kKCknKTsNCiAgICAgICAgICAgIGFuc3dlciA9IENvbmZpZ19maW5kKHNlbGYsIF9fZXZlbnQsIGFuc3dlciwgX190b1N0cmluZyk7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KDQogICAgICAgICAgICANCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQoNCiAgICAgICAgcmV0dXJuIGFuc3dlcjsNCg0KICAgIA0KDQoNCmNsYXNzIFRvb2woKToNCiAgICBkZWYgX19pbml0X18oc2VsZiwgSWQ9Tm9uZSwgYWN0aXZlPU5vbmUsIGVuYWJsZWQ9Tm9uZSwgY29kZT1Ob25lLCBvcmRlcj1Ob25lLCBkYXRlPU5vbmUsIG5hbWU9Tm9uZSwgcmVtYXJrPU5vbmUsIHR5cGU9Tm9uZSk6DQogICAgICAgIHN1cGVyKCkuX19pbml0X18oKTsNCg0KICAgICAgICAjcHJpbnQoJ1Rvb2w6Ol9faW5pdF9fKCknKTsNCiAgICAgICAgaWYgSWQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBzZWxmLklkID0gSWQ7DQoNCiAgICAgICAgDQogICAgICAgIHNlbGYuYWN0aXZlKGFjdGl2ZSk7DQogICAgICAgIHNlbGYuZW5hYmxlZChlbmFibGVkKTsNCiAgICAgICAgc2VsZi5jb2RlKGNvZGUpOw0KICAgICAgICBzZWxmLm9yZGVyKG9yZGVyKTsNCiAgICAgICAgc2VsZi5kYXRlKGRhdGUpOw0KICAgICAgICBzZWxmLm5hbWUobmFtZSk7DQogICAgICAgIHNlbGYucmVtYXJrKHJlbWFyayk7DQogICAgICAgIHNlbGYudHlwZSh0eXBlKTsNCiAgICAgICAgDQogICAgSWQgPSBOb25lOw0KICAgIA0KICAgIA0KICAgICMgYWN0aXZlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2FjdGl2ZSA9IE5vbmU7DQogICAgZGVmIGFjdGl2ZShzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9hY3RpdmUgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fYWN0aXZlOw0KDQoNCiAgICANCiAgICAjIGVuYWJsZWQ6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfZW5hYmxlZCA9IE5vbmU7DQogICAgZGVmIGVuYWJsZWQoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fZW5hYmxlZCA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9lbmFibGVkOw0KDQoNCiAgICANCiAgICAjIGNvZGU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfY29kZSA9IE5vbmU7DQogICAgZGVmIGNvZGUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fY29kZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9jb2RlOw0KDQoNCiAgICANCiAgICAjIG9yZGVyOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX29yZGVyID0gTm9uZTsNCiAgICBkZWYgb3JkZXIoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fb3JkZXIgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fb3JkZXI7DQoNCg0KICAgIA0KICAgICMgZGF0ZTogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9kYXRlID0gTm9uZTsNCiAgICBkZWYgZGF0ZShzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9kYXRlID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2RhdGU7DQoNCg0KICAgIA0KICAgICMgbmFtZTogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9uYW1lID0gTm9uZTsNCiAgICBkZWYgbmFtZShzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9uYW1lID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX25hbWU7DQoNCg0KICAgIA0KICAgICMgcmVtYXJrOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX3JlbWFyayA9IE5vbmU7DQogICAgZGVmIHJlbWFyayhzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9yZW1hcmsgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fcmVtYXJrOw0KDQoNCiAgICANCiAgICAjIHR5cGU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfdHlwZSA9IE5vbmU7DQogICAgZGVmIHR5cGUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fdHlwZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl90eXBlOw0KDQoNCiAgICANCiAgICANCiAgICBkZWYgX2Zyb21Eb2N1bWVudChzZWxmLCBvYmopOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ1Rvb2w6Ol9mcm9tRG9jdW1lbnQoKTogJzsNCg0KICAgICAgICBpZiBvYmogaXMgTm9uZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICANCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIGJ5dGVzKToNCiAgICAgICAgICAgIG9iaiA9IHN0cihvYmosICJ1dGYtOCIpOw0KDQogICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLCBzdHIpIG9yIHR5cGUob2JqKSBpcyBzdHI6DQogICAgICAgICAgICBvYmogPSBqc29uLmxvYWRzKG9iaik7DQogICAgICAgIA0KICAgICAgICBpZiBub3QgaXNpbnN0YW5jZShvYmosIChzdHIsIGJ5dGVzLCBkaWN0KSk6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJ0dPVCBIRVJFOiAnICsgc3RyKHR5cGUob2JqKSkpOw0KICAgICAgICAgICAgcmV0dXJuIG9iajsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZm9yIGkgaW4gb2JqOg0KICAgICAgICAgICAgICAgIG9ialtpXSA9IFRvb2woKS5fZnJvbURvY3VtZW50KG9ialtpXSk7DQogICAgICAgICAgICByZXR1cm4gb2JqOw0KDQoNCiAgICAgICAgaWYgJ0lkJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLklkID0gb2JqWydJZCddOw0KDQogICAgDQogICAgICAgIGlmICdhY3RpdmUnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuYWN0aXZlKG9ialsnYWN0aXZlJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ2VuYWJsZWQnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuZW5hYmxlZChvYmpbJ2VuYWJsZWQnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnY29kZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5jb2RlKG9ialsnY29kZSddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdvcmRlcicgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5vcmRlcihvYmpbJ29yZGVyJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ2RhdGUnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuZGF0ZShvYmpbJ2RhdGUnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnbmFtZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5uYW1lKG9ialsnbmFtZSddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdyZW1hcmsnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYucmVtYXJrKG9ialsncmVtYXJrJ10pOw0KICAgICAgICANCiAgICAgICAgICAgIHNlbGYucmVtYXJrKCBiYXNlNjQuYjY0ZW5jb2RlKHNlbGYucmVtYXJrKCkuZW5jb2RlKCJhc2NpaSIpKS5kZWNvZGUoImFzY2lpIikgKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICd0eXBlJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLnR5cGUoVG9vbF9UeXBlKCkuX2Zyb21Eb2N1bWVudChvYmpbJ3R5cGUnXSkpOw0KICAgICAgICANCiAgICANCg0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIHJldHVybiBzZWxmOw0KICAgIA0KICAgIGRlZiBfdG9Eb2N1bWVudChzZWxmKToNCiAgICAgICAgcmV0ID0ge307DQogICAgICAgIGlmIHNlbGYuSWQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbIklkIl0gPSBzZWxmLklkOw0KDQogICAgDQogICAgICAgIGlmIHNlbGYuYWN0aXZlKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbImFjdGl2ZSJdID0gc2VsZi5hY3RpdmUoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYuZW5hYmxlZCgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJlbmFibGVkIl0gPSBzZWxmLmVuYWJsZWQoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYuY29kZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJjb2RlIl0gPSBzZWxmLmNvZGUoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYub3JkZXIoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsib3JkZXIiXSA9IHNlbGYub3JkZXIoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYuZGF0ZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJkYXRlIl0gPSBzZWxmLmRhdGUoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYubmFtZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJuYW1lIl0gPSBzZWxmLm5hbWUoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYucmVtYXJrKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbInJlbWFyayJdID0gc2VsZi5yZW1hcmsoKTsNCiAgICAgICAgDQogICAgICAgICAgICBpZiBpc2luc3RhbmNlKHJldFsicmVtYXJrIl0sIGRpY3QpOg0KICAgICAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSBqc29uLmR1bXBzKHJldFsicmVtYXJrIl0pOw0KICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IHViaW5hc2NpaS5iMmFfYmFzZTY0KHJldFsicmVtYXJrIl0pLnN0cmlwKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLnR5cGUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsidHlwZSJdID0gc2VsZi50eXBlKCkuX3RvRG9jdW1lbnQoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIHJldHVybiByZXQ7DQoNCiAgICANCiAgICBkZWYgc3RvcmUoc2VsZiwgX19ldmVudD1Ob25lKToNCiAgICAgICAgX190b1N0cmluZyA9ICdUb29sOjpzdG9yZSgpOiAnOw0KICAgICAgICANCiAgICAgICAgZXZKU09OID0gTm9uZTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgZXZKU09OID0ganNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046DQogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOw0KICAgICAgICANCg0KICAgICAgICBhbnN3ZXIgPSBOb25lOw0KDQogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aWNrc19tcygpKSsnXS5Ub29sLnN0b3JlKCknKS5tZXRob2QoJ3N0b3JlJykuY2xhc3NOYW1lKCdUb29sJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOw0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsNCiAgICAgICAgDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQogICAgICAgIA0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgIGFuc3dlciA9IFRvb2woKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KICAgICAgICANCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQoNCg0KDQogICAgICAgIGlmICdUb29sX3N0b3JlJyBpbiBkaXIoKToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnPT0+IFRvb2xfc3RvcmUoKScpOw0KICAgICAgICAgICAgYW5zd2VyID0gVG9vbF9zdG9yZShzZWxmLCBfX2V2ZW50LCBhbnN3ZXIsIF9fdG9TdHJpbmcpOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCg0KICAgICAgICAgICAgDQogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KDQogICAgICAgIHJldHVybiBhbnN3ZXI7DQoNCiAgICANCiAgICBkZWYgZmluZEFsbChzZWxmLCBfX2V2ZW50PU5vbmUpOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ1Rvb2w6OmZpbmRBbGwoKTogJzsNCiAgICAgICAgDQogICAgICAgIGV2SlNPTiA9IE5vbmU7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIGV2SlNPTiA9IGpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOg0KICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsNCiAgICAgICAgDQoNCiAgICAgICAgYW5zd2VyID0gTm9uZTsNCg0KICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGlja3NfbXMoKSkrJ10uVG9vbC5maW5kQWxsKCknKS5tZXRob2QoJ2ZpbmRBbGwnKS5jbGFzc05hbWUoJ1Rvb2wnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOw0KICAgICAgICANCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCiAgICAgICAgDQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgYW5zd2VyID0gVG9vbCgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQogICAgICAgIA0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCg0KDQoNCiAgICAgICAgaWYgJ1Rvb2xfZmluZEFsbCcgaW4gZGlyKCk6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJz09PiBUb29sX2ZpbmRBbGwoKScpOw0KICAgICAgICAgICAgYW5zd2VyID0gVG9vbF9maW5kQWxsKHNlbGYsIF9fZXZlbnQsIGFuc3dlciwgX190b1N0cmluZyk7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KDQogICAgICAgICAgICANCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQoNCiAgICAgICAgcmV0dXJuIGFuc3dlcjsNCg0KICAgIA0KICAgIGRlZiBmaW5kKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6DQogICAgICAgIF9fdG9TdHJpbmcgPSAnVG9vbDo6ZmluZCgpOiAnOw0KICAgICAgICANCiAgICAgICAgZXZKU09OID0gTm9uZTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgZXZKU09OID0ganNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046DQogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOw0KICAgICAgICANCg0KICAgICAgICBhbnN3ZXIgPSBOb25lOw0KDQogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aWNrc19tcygpKSsnXS5Ub29sLmZpbmQoKScpLm1ldGhvZCgnZmluZCcpLmNsYXNzTmFtZSgnVG9vbCcpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7DQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KICAgICAgICANCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICBhbnN3ZXIgPSBUb29sKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCiAgICAgICAgDQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KDQoNCg0KICAgICAgICBpZiAnVG9vbF9maW5kJyBpbiBkaXIoKToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnPT0+IFRvb2xfZmluZCgpJyk7DQogICAgICAgICAgICBhbnN3ZXIgPSBUb29sX2ZpbmQoc2VsZiwgX19ldmVudCwgYW5zd2VyLCBfX3RvU3RyaW5nKTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCg0KICAgICAgICByZXR1cm4gYW5zd2VyOw0KDQogICAgDQoNCg0KY2xhc3MgQ29uZmlnX0dyb3VwKCk6DQogICAgZGVmIF9faW5pdF9fKHNlbGYsIElkPU5vbmUsIGFjdGl2ZT1Ob25lLCBlbmFibGVkPU5vbmUsIGNvZGU9Tm9uZSwgb3JkZXI9Tm9uZSwgZGF0ZT1Ob25lLCBuYW1lPU5vbmUsIHJlbWFyaz1Ob25lKToNCiAgICAgICAgc3VwZXIoKS5fX2luaXRfXygpOw0KDQogICAgICAgICNwcmludCgnQ29uZmlnX0dyb3VwOjpfX2luaXRfXygpJyk7DQogICAgICAgIGlmIElkIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgc2VsZi5JZCA9IElkOw0KDQogICAgICAgIA0KICAgICAgICBzZWxmLmFjdGl2ZShhY3RpdmUpOw0KICAgICAgICBzZWxmLmVuYWJsZWQoZW5hYmxlZCk7DQogICAgICAgIHNlbGYuY29kZShjb2RlKTsNCiAgICAgICAgc2VsZi5vcmRlcihvcmRlcik7DQogICAgICAgIHNlbGYuZGF0ZShkYXRlKTsNCiAgICAgICAgc2VsZi5uYW1lKG5hbWUpOw0KICAgICAgICBzZWxmLnJlbWFyayhyZW1hcmspOw0KICAgICAgICANCiAgICBJZCA9IE5vbmU7DQogICAgDQogICAgDQogICAgIyBhY3RpdmU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfYWN0aXZlID0gTm9uZTsNCiAgICBkZWYgYWN0aXZlKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2FjdGl2ZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9hY3RpdmU7DQoNCg0KICAgIA0KICAgICMgZW5hYmxlZDogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9lbmFibGVkID0gTm9uZTsNCiAgICBkZWYgZW5hYmxlZChzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9lbmFibGVkID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2VuYWJsZWQ7DQoNCg0KICAgIA0KICAgICMgY29kZTogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9jb2RlID0gTm9uZTsNCiAgICBkZWYgY29kZShzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9jb2RlID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2NvZGU7DQoNCg0KICAgIA0KICAgICMgb3JkZXI6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfb3JkZXIgPSBOb25lOw0KICAgIGRlZiBvcmRlcihzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9vcmRlciA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9vcmRlcjsNCg0KDQogICAgDQogICAgIyBkYXRlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2RhdGUgPSBOb25lOw0KICAgIGRlZiBkYXRlKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2RhdGUgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fZGF0ZTsNCg0KDQogICAgDQogICAgIyBuYW1lOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX25hbWUgPSBOb25lOw0KICAgIGRlZiBuYW1lKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX25hbWUgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fbmFtZTsNCg0KDQogICAgDQogICAgIyByZW1hcms6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfcmVtYXJrID0gTm9uZTsNCiAgICBkZWYgcmVtYXJrKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX3JlbWFyayA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9yZW1hcms7DQoNCg0KICAgIA0KICAgIA0KICAgIGRlZiBfZnJvbURvY3VtZW50KHNlbGYsIG9iaik6DQogICAgICAgIF9fdG9TdHJpbmcgPSAnQ29uZmlnX0dyb3VwOjpfZnJvbURvY3VtZW50KCk6ICc7DQoNCiAgICAgICAgaWYgb2JqIGlzIE5vbmU6DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgDQogICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLCBieXRlcyk6DQogICAgICAgICAgICBvYmogPSBzdHIob2JqLCAidXRmLTgiKTsNCg0KICAgICAgICBpZiBpc2luc3RhbmNlKG9iaiwgc3RyKSBvciB0eXBlKG9iaikgaXMgc3RyOg0KICAgICAgICAgICAgb2JqID0ganNvbi5sb2FkcyhvYmopOw0KICAgICAgICANCiAgICAgICAgaWYgbm90IGlzaW5zdGFuY2Uob2JqLCAoc3RyLCBieXRlcywgZGljdCkpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICdHT1QgSEVSRTogJyArIHN0cih0eXBlKG9iaikpKTsNCiAgICAgICAgICAgIHJldHVybiBvYmo7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGZvciBpIGluIG9iajoNCiAgICAgICAgICAgICAgICBvYmpbaV0gPSBDb25maWdfR3JvdXAoKS5fZnJvbURvY3VtZW50KG9ialtpXSk7DQogICAgICAgICAgICByZXR1cm4gb2JqOw0KDQoNCiAgICAgICAgaWYgJ0lkJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLklkID0gb2JqWydJZCddOw0KDQogICAgDQogICAgICAgIGlmICdhY3RpdmUnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuYWN0aXZlKG9ialsnYWN0aXZlJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ2VuYWJsZWQnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuZW5hYmxlZChvYmpbJ2VuYWJsZWQnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnY29kZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5jb2RlKG9ialsnY29kZSddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdvcmRlcicgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5vcmRlcihvYmpbJ29yZGVyJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ2RhdGUnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuZGF0ZShvYmpbJ2RhdGUnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnbmFtZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5uYW1lKG9ialsnbmFtZSddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdyZW1hcmsnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYucmVtYXJrKG9ialsncmVtYXJrJ10pOw0KICAgICAgICANCiAgICAgICAgICAgIHNlbGYucmVtYXJrKCBiYXNlNjQuYjY0ZW5jb2RlKHNlbGYucmVtYXJrKCkuZW5jb2RlKCJhc2NpaSIpKS5kZWNvZGUoImFzY2lpIikgKTsNCiAgICAgICAgDQogICAgDQoNCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICByZXR1cm4gc2VsZjsNCiAgICANCiAgICBkZWYgX3RvRG9jdW1lbnQoc2VsZik6DQogICAgICAgIHJldCA9IHt9Ow0KICAgICAgICBpZiBzZWxmLklkIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJJZCJdID0gc2VsZi5JZDsNCg0KICAgIA0KICAgICAgICBpZiBzZWxmLmFjdGl2ZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJhY3RpdmUiXSA9IHNlbGYuYWN0aXZlKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmVuYWJsZWQoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiZW5hYmxlZCJdID0gc2VsZi5lbmFibGVkKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmNvZGUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiY29kZSJdID0gc2VsZi5jb2RlKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLm9yZGVyKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbIm9yZGVyIl0gPSBzZWxmLm9yZGVyKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmRhdGUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiZGF0ZSJdID0gc2VsZi5kYXRlKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLm5hbWUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsibmFtZSJdID0gc2VsZi5uYW1lKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLnJlbWFyaygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IHNlbGYucmVtYXJrKCk7DQogICAgICAgIA0KICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShyZXRbInJlbWFyayJdLCBkaWN0KToNCiAgICAgICAgICAgICAgICByZXRbInJlbWFyayJdID0ganNvbi5kdW1wcyhyZXRbInJlbWFyayJdKTsNCiAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSB1YmluYXNjaWkuYjJhX2Jhc2U2NChyZXRbInJlbWFyayJdKS5zdHJpcCgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgcmV0dXJuIHJldDsNCg0KICAgIA0KICAgIGRlZiBzdG9yZShzZWxmLCBfX2V2ZW50PU5vbmUpOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ0NvbmZpZ19Hcm91cDo6c3RvcmUoKTogJzsNCiAgICAgICAgDQogICAgICAgIGV2SlNPTiA9IE5vbmU7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIGV2SlNPTiA9IGpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOg0KICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsNCiAgICAgICAgDQoNCiAgICAgICAgYW5zd2VyID0gTm9uZTsNCg0KICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGlja3NfbXMoKSkrJ10uQ29uZmlnX0dyb3VwLnN0b3JlKCknKS5tZXRob2QoJ3N0b3JlJykuY2xhc3NOYW1lKCdDb25maWdfR3JvdXAnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOw0KICAgICAgICANCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCiAgICAgICAgDQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgYW5zd2VyID0gQ29uZmlnX0dyb3VwKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCiAgICAgICAgDQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KDQoNCg0KICAgICAgICBpZiAnQ29uZmlnX0dyb3VwX3N0b3JlJyBpbiBkaXIoKToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnPT0+IENvbmZpZ19Hcm91cF9zdG9yZSgpJyk7DQogICAgICAgICAgICBhbnN3ZXIgPSBDb25maWdfR3JvdXBfc3RvcmUoc2VsZiwgX19ldmVudCwgYW5zd2VyLCBfX3RvU3RyaW5nKTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCg0KICAgICAgICByZXR1cm4gYW5zd2VyOw0KDQogICAgDQogICAgZGVmIGZpbmRBbGwoc2VsZiwgX19ldmVudD1Ob25lKToNCiAgICAgICAgX190b1N0cmluZyA9ICdDb25maWdfR3JvdXA6OmZpbmRBbGwoKTogJzsNCiAgICAgICAgDQogICAgICAgIGV2SlNPTiA9IE5vbmU7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIGV2SlNPTiA9IGpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOg0KICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsNCiAgICAgICAgDQoNCiAgICAgICAgYW5zd2VyID0gTm9uZTsNCg0KICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGlja3NfbXMoKSkrJ10uQ29uZmlnX0dyb3VwLmZpbmRBbGwoKScpLm1ldGhvZCgnZmluZEFsbCcpLmNsYXNzTmFtZSgnQ29uZmlnX0dyb3VwJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOw0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsNCiAgICAgICAgDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQogICAgICAgIA0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgIGFuc3dlciA9IENvbmZpZ19Hcm91cCgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQogICAgICAgIA0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCg0KDQoNCiAgICAgICAgaWYgJ0NvbmZpZ19Hcm91cF9maW5kQWxsJyBpbiBkaXIoKToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnPT0+IENvbmZpZ19Hcm91cF9maW5kQWxsKCknKTsNCiAgICAgICAgICAgIGFuc3dlciA9IENvbmZpZ19Hcm91cF9maW5kQWxsKHNlbGYsIF9fZXZlbnQsIGFuc3dlciwgX190b1N0cmluZyk7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KDQogICAgICAgICAgICANCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQoNCiAgICAgICAgcmV0dXJuIGFuc3dlcjsNCg0KICAgIA0KICAgIGRlZiBmaW5kKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6DQogICAgICAgIF9fdG9TdHJpbmcgPSAnQ29uZmlnX0dyb3VwOjpmaW5kKCk6ICc7DQogICAgICAgIA0KICAgICAgICBldkpTT04gPSBOb25lOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBldkpTT04gPSBqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoNCiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7DQogICAgICAgIA0KDQogICAgICAgIGFuc3dlciA9IE5vbmU7DQoNCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpY2tzX21zKCkpKyddLkNvbmZpZ19Hcm91cC5maW5kKCknKS5tZXRob2QoJ2ZpbmQnKS5jbGFzc05hbWUoJ0NvbmZpZ19Hcm91cCcpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7DQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KICAgICAgICANCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICBhbnN3ZXIgPSBDb25maWdfR3JvdXAoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KICAgICAgICANCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQoNCg0KDQogICAgICAgIGlmICdDb25maWdfR3JvdXBfZmluZCcgaW4gZGlyKCk6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJz09PiBDb25maWdfR3JvdXBfZmluZCgpJyk7DQogICAgICAgICAgICBhbnN3ZXIgPSBDb25maWdfR3JvdXBfZmluZChzZWxmLCBfX2V2ZW50LCBhbnN3ZXIsIF9fdG9TdHJpbmcpOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCg0KICAgICAgICAgICAgDQogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KDQogICAgICAgIHJldHVybiBhbnN3ZXI7DQoNCiAgICANCg0KDQpjbGFzcyBNYXBwaW5nX0dyb3VwKCk6DQogICAgZGVmIF9faW5pdF9fKHNlbGYsIElkPU5vbmUsIGFjdGl2ZT1Ob25lLCBlbmFibGVkPU5vbmUsIGNvZGU9Tm9uZSwgb3JkZXI9Tm9uZSwgZGF0ZT1Ob25lLCBuYW1lPU5vbmUsIHJlbWFyaz1Ob25lKToNCiAgICAgICAgc3VwZXIoKS5fX2luaXRfXygpOw0KDQogICAgICAgICNwcmludCgnTWFwcGluZ19Hcm91cDo6X19pbml0X18oKScpOw0KICAgICAgICBpZiBJZCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHNlbGYuSWQgPSBJZDsNCg0KICAgICAgICANCiAgICAgICAgc2VsZi5hY3RpdmUoYWN0aXZlKTsNCiAgICAgICAgc2VsZi5lbmFibGVkKGVuYWJsZWQpOw0KICAgICAgICBzZWxmLmNvZGUoY29kZSk7DQogICAgICAgIHNlbGYub3JkZXIob3JkZXIpOw0KICAgICAgICBzZWxmLmRhdGUoZGF0ZSk7DQogICAgICAgIHNlbGYubmFtZShuYW1lKTsNCiAgICAgICAgc2VsZi5yZW1hcmsocmVtYXJrKTsNCiAgICAgICAgDQogICAgSWQgPSBOb25lOw0KICAgIA0KICAgIA0KICAgICMgYWN0aXZlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2FjdGl2ZSA9IE5vbmU7DQogICAgZGVmIGFjdGl2ZShzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9hY3RpdmUgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fYWN0aXZlOw0KDQoNCiAgICANCiAgICAjIGVuYWJsZWQ6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfZW5hYmxlZCA9IE5vbmU7DQogICAgZGVmIGVuYWJsZWQoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fZW5hYmxlZCA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9lbmFibGVkOw0KDQoNCiAgICANCiAgICAjIGNvZGU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfY29kZSA9IE5vbmU7DQogICAgZGVmIGNvZGUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fY29kZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9jb2RlOw0KDQoNCiAgICANCiAgICAjIG9yZGVyOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX29yZGVyID0gTm9uZTsNCiAgICBkZWYgb3JkZXIoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fb3JkZXIgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fb3JkZXI7DQoNCg0KICAgIA0KICAgICMgZGF0ZTogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9kYXRlID0gTm9uZTsNCiAgICBkZWYgZGF0ZShzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9kYXRlID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2RhdGU7DQoNCg0KICAgIA0KICAgICMgbmFtZTogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9uYW1lID0gTm9uZTsNCiAgICBkZWYgbmFtZShzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9uYW1lID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX25hbWU7DQoNCg0KICAgIA0KICAgICMgcmVtYXJrOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX3JlbWFyayA9IE5vbmU7DQogICAgZGVmIHJlbWFyayhzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9yZW1hcmsgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fcmVtYXJrOw0KDQoNCiAgICANCiAgICANCiAgICBkZWYgX2Zyb21Eb2N1bWVudChzZWxmLCBvYmopOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ01hcHBpbmdfR3JvdXA6Ol9mcm9tRG9jdW1lbnQoKTogJzsNCg0KICAgICAgICBpZiBvYmogaXMgTm9uZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICANCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIGJ5dGVzKToNCiAgICAgICAgICAgIG9iaiA9IHN0cihvYmosICJ1dGYtOCIpOw0KDQogICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLCBzdHIpIG9yIHR5cGUob2JqKSBpcyBzdHI6DQogICAgICAgICAgICBvYmogPSBqc29uLmxvYWRzKG9iaik7DQogICAgICAgIA0KICAgICAgICBpZiBub3QgaXNpbnN0YW5jZShvYmosIChzdHIsIGJ5dGVzLCBkaWN0KSk6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJ0dPVCBIRVJFOiAnICsgc3RyKHR5cGUob2JqKSkpOw0KICAgICAgICAgICAgcmV0dXJuIG9iajsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZm9yIGkgaW4gb2JqOg0KICAgICAgICAgICAgICAgIG9ialtpXSA9IE1hcHBpbmdfR3JvdXAoKS5fZnJvbURvY3VtZW50KG9ialtpXSk7DQogICAgICAgICAgICByZXR1cm4gb2JqOw0KDQoNCiAgICAgICAgaWYgJ0lkJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLklkID0gb2JqWydJZCddOw0KDQogICAgDQogICAgICAgIGlmICdhY3RpdmUnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuYWN0aXZlKG9ialsnYWN0aXZlJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ2VuYWJsZWQnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuZW5hYmxlZChvYmpbJ2VuYWJsZWQnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnY29kZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5jb2RlKG9ialsnY29kZSddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdvcmRlcicgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5vcmRlcihvYmpbJ29yZGVyJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ2RhdGUnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuZGF0ZShvYmpbJ2RhdGUnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnbmFtZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5uYW1lKG9ialsnbmFtZSddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdyZW1hcmsnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYucmVtYXJrKG9ialsncmVtYXJrJ10pOw0KICAgICAgICANCiAgICAgICAgICAgIHNlbGYucmVtYXJrKCBiYXNlNjQuYjY0ZW5jb2RlKHNlbGYucmVtYXJrKCkuZW5jb2RlKCJhc2NpaSIpKS5kZWNvZGUoImFzY2lpIikgKTsNCiAgICAgICAgDQogICAgDQoNCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICByZXR1cm4gc2VsZjsNCiAgICANCiAgICBkZWYgX3RvRG9jdW1lbnQoc2VsZik6DQogICAgICAgIHJldCA9IHt9Ow0KICAgICAgICBpZiBzZWxmLklkIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJJZCJdID0gc2VsZi5JZDsNCg0KICAgIA0KICAgICAgICBpZiBzZWxmLmFjdGl2ZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJhY3RpdmUiXSA9IHNlbGYuYWN0aXZlKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmVuYWJsZWQoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiZW5hYmxlZCJdID0gc2VsZi5lbmFibGVkKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmNvZGUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiY29kZSJdID0gc2VsZi5jb2RlKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLm9yZGVyKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbIm9yZGVyIl0gPSBzZWxmLm9yZGVyKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmRhdGUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiZGF0ZSJdID0gc2VsZi5kYXRlKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLm5hbWUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsibmFtZSJdID0gc2VsZi5uYW1lKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLnJlbWFyaygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IHNlbGYucmVtYXJrKCk7DQogICAgICAgIA0KICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShyZXRbInJlbWFyayJdLCBkaWN0KToNCiAgICAgICAgICAgICAgICByZXRbInJlbWFyayJdID0ganNvbi5kdW1wcyhyZXRbInJlbWFyayJdKTsNCiAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSB1YmluYXNjaWkuYjJhX2Jhc2U2NChyZXRbInJlbWFyayJdKS5zdHJpcCgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgcmV0dXJuIHJldDsNCg0KICAgIA0KICAgIGRlZiBzdG9yZShzZWxmLCBfX2V2ZW50PU5vbmUpOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ01hcHBpbmdfR3JvdXA6OnN0b3JlKCk6ICc7DQogICAgICAgIA0KICAgICAgICBldkpTT04gPSBOb25lOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBldkpTT04gPSBqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoNCiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7DQogICAgICAgIA0KDQogICAgICAgIGFuc3dlciA9IE5vbmU7DQoNCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpY2tzX21zKCkpKyddLk1hcHBpbmdfR3JvdXAuc3RvcmUoKScpLm1ldGhvZCgnc3RvcmUnKS5jbGFzc05hbWUoJ01hcHBpbmdfR3JvdXAnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOw0KICAgICAgICANCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCiAgICAgICAgDQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgYW5zd2VyID0gTWFwcGluZ19Hcm91cCgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQogICAgICAgIA0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCg0KDQoNCiAgICAgICAgaWYgJ01hcHBpbmdfR3JvdXBfc3RvcmUnIGluIGRpcigpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICc9PT4gTWFwcGluZ19Hcm91cF9zdG9yZSgpJyk7DQogICAgICAgICAgICBhbnN3ZXIgPSBNYXBwaW5nX0dyb3VwX3N0b3JlKHNlbGYsIF9fZXZlbnQsIGFuc3dlciwgX190b1N0cmluZyk7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KDQogICAgICAgICAgICANCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQoNCiAgICAgICAgcmV0dXJuIGFuc3dlcjsNCg0KICAgIA0KICAgIGRlZiBmaW5kQWxsKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6DQogICAgICAgIF9fdG9TdHJpbmcgPSAnTWFwcGluZ19Hcm91cDo6ZmluZEFsbCgpOiAnOw0KICAgICAgICANCiAgICAgICAgZXZKU09OID0gTm9uZTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgZXZKU09OID0ganNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046DQogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOw0KICAgICAgICANCg0KICAgICAgICBhbnN3ZXIgPSBOb25lOw0KDQogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aWNrc19tcygpKSsnXS5NYXBwaW5nX0dyb3VwLmZpbmRBbGwoKScpLm1ldGhvZCgnZmluZEFsbCcpLmNsYXNzTmFtZSgnTWFwcGluZ19Hcm91cCcpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7DQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KICAgICAgICANCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICBhbnN3ZXIgPSBNYXBwaW5nX0dyb3VwKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCiAgICAgICAgDQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KDQoNCg0KICAgICAgICBpZiAnTWFwcGluZ19Hcm91cF9maW5kQWxsJyBpbiBkaXIoKToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnPT0+IE1hcHBpbmdfR3JvdXBfZmluZEFsbCgpJyk7DQogICAgICAgICAgICBhbnN3ZXIgPSBNYXBwaW5nX0dyb3VwX2ZpbmRBbGwoc2VsZiwgX19ldmVudCwgYW5zd2VyLCBfX3RvU3RyaW5nKTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCg0KICAgICAgICByZXR1cm4gYW5zd2VyOw0KDQogICAgDQogICAgZGVmIGZpbmQoc2VsZiwgX19ldmVudD1Ob25lKToNCiAgICAgICAgX190b1N0cmluZyA9ICdNYXBwaW5nX0dyb3VwOjpmaW5kKCk6ICc7DQogICAgICAgIA0KICAgICAgICBldkpTT04gPSBOb25lOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBldkpTT04gPSBqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoNCiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7DQogICAgICAgIA0KDQogICAgICAgIGFuc3dlciA9IE5vbmU7DQoNCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpY2tzX21zKCkpKyddLk1hcHBpbmdfR3JvdXAuZmluZCgpJykubWV0aG9kKCdmaW5kJykuY2xhc3NOYW1lKCdNYXBwaW5nX0dyb3VwJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOw0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsNCiAgICAgICAgDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQogICAgICAgIA0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgIGFuc3dlciA9IE1hcHBpbmdfR3JvdXAoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KICAgICAgICANCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQoNCg0KDQogICAgICAgIGlmICdNYXBwaW5nX0dyb3VwX2ZpbmQnIGluIGRpcigpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICc9PT4gTWFwcGluZ19Hcm91cF9maW5kKCknKTsNCiAgICAgICAgICAgIGFuc3dlciA9IE1hcHBpbmdfR3JvdXBfZmluZChzZWxmLCBfX2V2ZW50LCBhbnN3ZXIsIF9fdG9TdHJpbmcpOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCg0KICAgICAgICAgICAgDQogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KDQogICAgICAgIHJldHVybiBhbnN3ZXI7DQoNCiAgICANCg0KDQpjbGFzcyBUb29sX1R5cGUoKToNCiAgICBkZWYgX19pbml0X18oc2VsZiwgSWQ9Tm9uZSwgYWN0aXZlPU5vbmUsIGVuYWJsZWQ9Tm9uZSwgY29kZT1Ob25lLCBvcmRlcj1Ob25lLCBkYXRlPU5vbmUsIG5hbWU9Tm9uZSwgcmVtYXJrPU5vbmUpOg0KICAgICAgICBzdXBlcigpLl9faW5pdF9fKCk7DQoNCiAgICAgICAgI3ByaW50KCdUb29sX1R5cGU6Ol9faW5pdF9fKCknKTsNCiAgICAgICAgaWYgSWQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBzZWxmLklkID0gSWQ7DQoNCiAgICAgICAgDQogICAgICAgIHNlbGYuYWN0aXZlKGFjdGl2ZSk7DQogICAgICAgIHNlbGYuZW5hYmxlZChlbmFibGVkKTsNCiAgICAgICAgc2VsZi5jb2RlKGNvZGUpOw0KICAgICAgICBzZWxmLm9yZGVyKG9yZGVyKTsNCiAgICAgICAgc2VsZi5kYXRlKGRhdGUpOw0KICAgICAgICBzZWxmLm5hbWUobmFtZSk7DQogICAgICAgIHNlbGYucmVtYXJrKHJlbWFyayk7DQogICAgICAgIA0KICAgIElkID0gTm9uZTsNCiAgICANCiAgICANCiAgICAjIGFjdGl2ZTogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9hY3RpdmUgPSBOb25lOw0KICAgIGRlZiBhY3RpdmUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fYWN0aXZlID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2FjdGl2ZTsNCg0KDQogICAgDQogICAgIyBlbmFibGVkOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2VuYWJsZWQgPSBOb25lOw0KICAgIGRlZiBlbmFibGVkKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2VuYWJsZWQgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fZW5hYmxlZDsNCg0KDQogICAgDQogICAgIyBjb2RlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2NvZGUgPSBOb25lOw0KICAgIGRlZiBjb2RlKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2NvZGUgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fY29kZTsNCg0KDQogICAgDQogICAgIyBvcmRlcjogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9vcmRlciA9IE5vbmU7DQogICAgZGVmIG9yZGVyKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX29yZGVyID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX29yZGVyOw0KDQoNCiAgICANCiAgICAjIGRhdGU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfZGF0ZSA9IE5vbmU7DQogICAgZGVmIGRhdGUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fZGF0ZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9kYXRlOw0KDQoNCiAgICANCiAgICAjIG5hbWU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfbmFtZSA9IE5vbmU7DQogICAgZGVmIG5hbWUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fbmFtZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9uYW1lOw0KDQoNCiAgICANCiAgICAjIHJlbWFyazogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9yZW1hcmsgPSBOb25lOw0KICAgIGRlZiByZW1hcmsoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fcmVtYXJrID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3JlbWFyazsNCg0KDQogICAgDQogICAgDQogICAgZGVmIF9mcm9tRG9jdW1lbnQoc2VsZiwgb2JqKToNCiAgICAgICAgX190b1N0cmluZyA9ICdUb29sX1R5cGU6Ol9mcm9tRG9jdW1lbnQoKTogJzsNCg0KICAgICAgICBpZiBvYmogaXMgTm9uZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICANCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIGJ5dGVzKToNCiAgICAgICAgICAgIG9iaiA9IHN0cihvYmosICJ1dGYtOCIpOw0KDQogICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLCBzdHIpIG9yIHR5cGUob2JqKSBpcyBzdHI6DQogICAgICAgICAgICBvYmogPSBqc29uLmxvYWRzKG9iaik7DQogICAgICAgIA0KICAgICAgICBpZiBub3QgaXNpbnN0YW5jZShvYmosIChzdHIsIGJ5dGVzLCBkaWN0KSk6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJ0dPVCBIRVJFOiAnICsgc3RyKHR5cGUob2JqKSkpOw0KICAgICAgICAgICAgcmV0dXJuIG9iajsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZm9yIGkgaW4gb2JqOg0KICAgICAgICAgICAgICAgIG9ialtpXSA9IFRvb2xfVHlwZSgpLl9mcm9tRG9jdW1lbnQob2JqW2ldKTsNCiAgICAgICAgICAgIHJldHVybiBvYmo7DQoNCg0KICAgICAgICBpZiAnSWQnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuSWQgPSBvYmpbJ0lkJ107DQoNCiAgICANCiAgICAgICAgaWYgJ2FjdGl2ZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5hY3RpdmUob2JqWydhY3RpdmUnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnZW5hYmxlZCcgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5lbmFibGVkKG9ialsnZW5hYmxlZCddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdjb2RlJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmNvZGUob2JqWydjb2RlJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ29yZGVyJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLm9yZGVyKG9ialsnb3JkZXInXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnZGF0ZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5kYXRlKG9ialsnZGF0ZSddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICduYW1lJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLm5hbWUob2JqWyduYW1lJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ3JlbWFyaycgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5yZW1hcmsob2JqWydyZW1hcmsnXSk7DQogICAgICAgIA0KICAgICAgICAgICAgc2VsZi5yZW1hcmsoIGJhc2U2NC5iNjRlbmNvZGUoc2VsZi5yZW1hcmsoKS5lbmNvZGUoImFzY2lpIikpLmRlY29kZSgiYXNjaWkiKSApOw0KICAgICAgICANCiAgICANCg0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIHJldHVybiBzZWxmOw0KICAgIA0KICAgIGRlZiBfdG9Eb2N1bWVudChzZWxmKToNCiAgICAgICAgcmV0ID0ge307DQogICAgICAgIGlmIHNlbGYuSWQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbIklkIl0gPSBzZWxmLklkOw0KDQogICAgDQogICAgICAgIGlmIHNlbGYuYWN0aXZlKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbImFjdGl2ZSJdID0gc2VsZi5hY3RpdmUoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYuZW5hYmxlZCgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJlbmFibGVkIl0gPSBzZWxmLmVuYWJsZWQoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYuY29kZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJjb2RlIl0gPSBzZWxmLmNvZGUoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYub3JkZXIoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsib3JkZXIiXSA9IHNlbGYub3JkZXIoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYuZGF0ZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJkYXRlIl0gPSBzZWxmLmRhdGUoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYubmFtZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJuYW1lIl0gPSBzZWxmLm5hbWUoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYucmVtYXJrKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbInJlbWFyayJdID0gc2VsZi5yZW1hcmsoKTsNCiAgICAgICAgDQogICAgICAgICAgICBpZiBpc2luc3RhbmNlKHJldFsicmVtYXJrIl0sIGRpY3QpOg0KICAgICAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSBqc29uLmR1bXBzKHJldFsicmVtYXJrIl0pOw0KICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IHViaW5hc2NpaS5iMmFfYmFzZTY0KHJldFsicmVtYXJrIl0pLnN0cmlwKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICANCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICByZXR1cm4gcmV0Ow0KDQogICAgDQogICAgZGVmIHN0b3JlKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6DQogICAgICAgIF9fdG9TdHJpbmcgPSAnVG9vbF9UeXBlOjpzdG9yZSgpOiAnOw0KICAgICAgICANCiAgICAgICAgZXZKU09OID0gTm9uZTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgZXZKU09OID0ganNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046DQogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOw0KICAgICAgICANCg0KICAgICAgICBhbnN3ZXIgPSBOb25lOw0KDQogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aWNrc19tcygpKSsnXS5Ub29sX1R5cGUuc3RvcmUoKScpLm1ldGhvZCgnc3RvcmUnKS5jbGFzc05hbWUoJ1Rvb2xfVHlwZScpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7DQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KICAgICAgICANCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICBhbnN3ZXIgPSBUb29sX1R5cGUoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KICAgICAgICANCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQoNCg0KDQogICAgICAgIGlmICdUb29sX1R5cGVfc3RvcmUnIGluIGRpcigpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICc9PT4gVG9vbF9UeXBlX3N0b3JlKCknKTsNCiAgICAgICAgICAgIGFuc3dlciA9IFRvb2xfVHlwZV9zdG9yZShzZWxmLCBfX2V2ZW50LCBhbnN3ZXIsIF9fdG9TdHJpbmcpOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCg0KICAgICAgICAgICAgDQogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KDQogICAgICAgIHJldHVybiBhbnN3ZXI7DQoNCiAgICANCiAgICBkZWYgZmluZEFsbChzZWxmLCBfX2V2ZW50PU5vbmUpOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ1Rvb2xfVHlwZTo6ZmluZEFsbCgpOiAnOw0KICAgICAgICANCiAgICAgICAgZXZKU09OID0gTm9uZTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgZXZKU09OID0ganNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046DQogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOw0KICAgICAgICANCg0KICAgICAgICBhbnN3ZXIgPSBOb25lOw0KDQogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aWNrc19tcygpKSsnXS5Ub29sX1R5cGUuZmluZEFsbCgpJykubWV0aG9kKCdmaW5kQWxsJykuY2xhc3NOYW1lKCdUb29sX1R5cGUnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOw0KICAgICAgICANCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCiAgICAgICAgDQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgYW5zd2VyID0gVG9vbF9UeXBlKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCiAgICAgICAgDQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KDQoNCg0KICAgICAgICBpZiAnVG9vbF9UeXBlX2ZpbmRBbGwnIGluIGRpcigpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICc9PT4gVG9vbF9UeXBlX2ZpbmRBbGwoKScpOw0KICAgICAgICAgICAgYW5zd2VyID0gVG9vbF9UeXBlX2ZpbmRBbGwoc2VsZiwgX19ldmVudCwgYW5zd2VyLCBfX3RvU3RyaW5nKTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCg0KICAgICAgICByZXR1cm4gYW5zd2VyOw0KDQogICAgDQogICAgZGVmIGZpbmQoc2VsZiwgX19ldmVudD1Ob25lKToNCiAgICAgICAgX190b1N0cmluZyA9ICdUb29sX1R5cGU6OmZpbmQoKTogJzsNCiAgICAgICAgDQogICAgICAgIGV2SlNPTiA9IE5vbmU7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIGV2SlNPTiA9IGpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOg0KICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsNCiAgICAgICAgDQoNCiAgICAgICAgYW5zd2VyID0gTm9uZTsNCg0KICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGlja3NfbXMoKSkrJ10uVG9vbF9UeXBlLmZpbmQoKScpLm1ldGhvZCgnZmluZCcpLmNsYXNzTmFtZSgnVG9vbF9UeXBlJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOw0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsNCiAgICAgICAgDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQogICAgICAgIA0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgIGFuc3dlciA9IFRvb2xfVHlwZSgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQogICAgICAgIA0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCg0KDQoNCiAgICAgICAgaWYgJ1Rvb2xfVHlwZV9maW5kJyBpbiBkaXIoKToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnPT0+IFRvb2xfVHlwZV9maW5kKCknKTsNCiAgICAgICAgICAgIGFuc3dlciA9IFRvb2xfVHlwZV9maW5kKHNlbGYsIF9fZXZlbnQsIGFuc3dlciwgX190b1N0cmluZyk7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KDQogICAgICAgICAgICANCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQoNCiAgICAgICAgcmV0dXJuIGFuc3dlcjsNCg0KICAgIA0KDQoNCmNsYXNzIEV2ZW50KCk6DQogICAgZGVmIF9faW5pdF9fKHNlbGYsIElkPU5vbmUsIGFjdGl2ZT1Ob25lLCBlbmFibGVkPU5vbmUsIGNvZGU9Tm9uZSwgb3JkZXI9Tm9uZSwgZGF0ZT1Ob25lLCBuYW1lPU5vbmUsIHJlbWFyaz1Ob25lLCBjbGFzc05hbWU9Tm9uZSwgbWV0aG9kPU5vbmUsIHBheWxvYWQ9Tm9uZSwgY2Fycmllcj1Ob25lLCBzZW5kZXI9Tm9uZSwgcmVjaXBpZW50PU5vbmUsIHJlc3BvbnNlVG89Tm9uZSk6DQogICAgICAgIHN1cGVyKCkuX19pbml0X18oKTsNCg0KICAgICAgICAjcHJpbnQoJ0V2ZW50OjpfX2luaXRfXygpJyk7DQogICAgICAgIGlmIElkIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgc2VsZi5JZCA9IElkOw0KDQogICAgICAgIA0KICAgICAgICBzZWxmLmFjdGl2ZShhY3RpdmUpOw0KICAgICAgICBzZWxmLmVuYWJsZWQoZW5hYmxlZCk7DQogICAgICAgIHNlbGYuY29kZShjb2RlKTsNCiAgICAgICAgc2VsZi5vcmRlcihvcmRlcik7DQogICAgICAgIHNlbGYuZGF0ZShkYXRlKTsNCiAgICAgICAgc2VsZi5uYW1lKG5hbWUpOw0KICAgICAgICBzZWxmLnJlbWFyayhyZW1hcmspOw0KICAgICAgICBzZWxmLmNsYXNzTmFtZShjbGFzc05hbWUpOw0KICAgICAgICBzZWxmLm1ldGhvZChtZXRob2QpOw0KICAgICAgICBzZWxmLnBheWxvYWQocGF5bG9hZCk7DQogICAgICAgIHNlbGYuY2FycmllcihjYXJyaWVyKTsNCiAgICAgICAgc2VsZi5zZW5kZXIoc2VuZGVyKTsNCiAgICAgICAgc2VsZi5yZWNpcGllbnQocmVjaXBpZW50KTsNCiAgICAgICAgc2VsZi5yZXNwb25zZVRvKHJlc3BvbnNlVG8pOw0KICAgICAgICANCiAgICBJZCA9IE5vbmU7DQogICAgDQogICAgDQogICAgIyBhY3RpdmU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfYWN0aXZlID0gTm9uZTsNCiAgICBkZWYgYWN0aXZlKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2FjdGl2ZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9hY3RpdmU7DQoNCg0KICAgIA0KICAgICMgZW5hYmxlZDogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9lbmFibGVkID0gTm9uZTsNCiAgICBkZWYgZW5hYmxlZChzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9lbmFibGVkID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2VuYWJsZWQ7DQoNCg0KICAgIA0KICAgICMgY29kZTogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9jb2RlID0gTm9uZTsNCiAgICBkZWYgY29kZShzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9jb2RlID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2NvZGU7DQoNCg0KICAgIA0KICAgICMgb3JkZXI6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfb3JkZXIgPSBOb25lOw0KICAgIGRlZiBvcmRlcihzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9vcmRlciA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9vcmRlcjsNCg0KDQogICAgDQogICAgIyBkYXRlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2RhdGUgPSBOb25lOw0KICAgIGRlZiBkYXRlKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2RhdGUgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fZGF0ZTsNCg0KDQogICAgDQogICAgIyBuYW1lOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX25hbWUgPSBOb25lOw0KICAgIGRlZiBuYW1lKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX25hbWUgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fbmFtZTsNCg0KDQogICAgDQogICAgIyByZW1hcms6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfcmVtYXJrID0gTm9uZTsNCiAgICBkZWYgcmVtYXJrKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX3JlbWFyayA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9yZW1hcms7DQoNCg0KICAgIA0KICAgICMgY2xhc3NOYW1lOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2NsYXNzTmFtZSA9IE5vbmU7DQogICAgZGVmIGNsYXNzTmFtZShzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9jbGFzc05hbWUgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fY2xhc3NOYW1lOw0KDQoNCiAgICANCiAgICAjIG1ldGhvZDogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9tZXRob2QgPSBOb25lOw0KICAgIGRlZiBtZXRob2Qoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fbWV0aG9kID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX21ldGhvZDsNCg0KDQogICAgDQogICAgIyBwYXlsb2FkOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX3BheWxvYWQgPSBOb25lOw0KICAgIGRlZiBwYXlsb2FkKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX3BheWxvYWQgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fcGF5bG9hZDsNCg0KDQogICAgDQogICAgIyBjYXJyaWVyOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2NhcnJpZXIgPSBOb25lOw0KICAgIGRlZiBjYXJyaWVyKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2NhcnJpZXIgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fY2FycmllcjsNCg0KDQogICAgDQogICAgIyBzZW5kZXI6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfc2VuZGVyID0gTm9uZTsNCiAgICBkZWYgc2VuZGVyKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX3NlbmRlciA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9zZW5kZXI7DQoNCg0KICAgIA0KICAgICMgcmVjaXBpZW50OiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX3JlY2lwaWVudCA9IE5vbmU7DQogICAgZGVmIHJlY2lwaWVudChzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9yZWNpcGllbnQgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fcmVjaXBpZW50Ow0KDQoNCiAgICANCiAgICAjIHJlc3BvbnNlVG86IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfcmVzcG9uc2VUbyA9IE5vbmU7DQogICAgZGVmIHJlc3BvbnNlVG8oc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fcmVzcG9uc2VUbyA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9yZXNwb25zZVRvOw0KDQoNCiAgICANCiAgICANCiAgICBkZWYgX2Zyb21Eb2N1bWVudChzZWxmLCBvYmopOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ0V2ZW50OjpfZnJvbURvY3VtZW50KCk6ICc7DQoNCiAgICAgICAgaWYgb2JqIGlzIE5vbmU6DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgDQogICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLCBieXRlcyk6DQogICAgICAgICAgICBvYmogPSBzdHIob2JqLCAidXRmLTgiKTsNCg0KICAgICAgICBpZiBpc2luc3RhbmNlKG9iaiwgc3RyKSBvciB0eXBlKG9iaikgaXMgc3RyOg0KICAgICAgICAgICAgb2JqID0ganNvbi5sb2FkcyhvYmopOw0KICAgICAgICANCiAgICAgICAgaWYgbm90IGlzaW5zdGFuY2Uob2JqLCAoc3RyLCBieXRlcywgZGljdCkpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICdHT1QgSEVSRTogJyArIHN0cih0eXBlKG9iaikpKTsNCiAgICAgICAgICAgIHJldHVybiBvYmo7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGZvciBpIGluIG9iajoNCiAgICAgICAgICAgICAgICBvYmpbaV0gPSBFdmVudCgpLl9mcm9tRG9jdW1lbnQob2JqW2ldKTsNCiAgICAgICAgICAgIHJldHVybiBvYmo7DQoNCg0KICAgICAgICBpZiAnSWQnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuSWQgPSBvYmpbJ0lkJ107DQoNCiAgICANCiAgICAgICAgaWYgJ2FjdGl2ZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5hY3RpdmUob2JqWydhY3RpdmUnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnZW5hYmxlZCcgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5lbmFibGVkKG9ialsnZW5hYmxlZCddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdjb2RlJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmNvZGUob2JqWydjb2RlJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ29yZGVyJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLm9yZGVyKG9ialsnb3JkZXInXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnZGF0ZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5kYXRlKG9ialsnZGF0ZSddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICduYW1lJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLm5hbWUob2JqWyduYW1lJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ3JlbWFyaycgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5yZW1hcmsob2JqWydyZW1hcmsnXSk7DQogICAgICAgIA0KICAgICAgICAgICAgc2VsZi5yZW1hcmsoIGJhc2U2NC5iNjRlbmNvZGUoc2VsZi5yZW1hcmsoKS5lbmNvZGUoImFzY2lpIikpLmRlY29kZSgiYXNjaWkiKSApOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ2NsYXNzTmFtZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5jbGFzc05hbWUob2JqWydjbGFzc05hbWUnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnbWV0aG9kJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLm1ldGhvZChvYmpbJ21ldGhvZCddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdwYXlsb2FkJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLnBheWxvYWQob2JqWydwYXlsb2FkJ10pOw0KICAgICAgICANCiAgICAgICAgICAgIHNlbGYucGF5bG9hZCggYmFzZTY0LmI2NGVuY29kZShzZWxmLnBheWxvYWQoKS5lbmNvZGUoImFzY2lpIikpLmRlY29kZSgiYXNjaWkiKSApOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ2NhcnJpZXInIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuY2FycmllcihOb2RlKCkuX2Zyb21Eb2N1bWVudChvYmpbJ2NhcnJpZXInXSkpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ3NlbmRlcicgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5zZW5kZXIoTm9kZSgpLl9mcm9tRG9jdW1lbnQob2JqWydzZW5kZXInXSkpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ3JlY2lwaWVudCcgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5yZWNpcGllbnQoTm9kZSgpLl9mcm9tRG9jdW1lbnQob2JqWydyZWNpcGllbnQnXSkpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ3Jlc3BvbnNlVG8nIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYucmVzcG9uc2VUbyhFdmVudCgpLl9mcm9tRG9jdW1lbnQob2JqWydyZXNwb25zZVRvJ10pKTsNCiAgICAgICAgDQogICAgDQoNCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICByZXR1cm4gc2VsZjsNCiAgICANCiAgICBkZWYgX3RvRG9jdW1lbnQoc2VsZik6DQogICAgICAgIHJldCA9IHt9Ow0KICAgICAgICBpZiBzZWxmLklkIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJJZCJdID0gc2VsZi5JZDsNCg0KICAgIA0KICAgICAgICBpZiBzZWxmLmFjdGl2ZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJhY3RpdmUiXSA9IHNlbGYuYWN0aXZlKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmVuYWJsZWQoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiZW5hYmxlZCJdID0gc2VsZi5lbmFibGVkKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmNvZGUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiY29kZSJdID0gc2VsZi5jb2RlKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLm9yZGVyKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbIm9yZGVyIl0gPSBzZWxmLm9yZGVyKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmRhdGUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiZGF0ZSJdID0gc2VsZi5kYXRlKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLm5hbWUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsibmFtZSJdID0gc2VsZi5uYW1lKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLnJlbWFyaygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IHNlbGYucmVtYXJrKCk7DQogICAgICAgIA0KICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShyZXRbInJlbWFyayJdLCBkaWN0KToNCiAgICAgICAgICAgICAgICByZXRbInJlbWFyayJdID0ganNvbi5kdW1wcyhyZXRbInJlbWFyayJdKTsNCiAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSB1YmluYXNjaWkuYjJhX2Jhc2U2NChyZXRbInJlbWFyayJdKS5zdHJpcCgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5jbGFzc05hbWUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiY2xhc3NOYW1lIl0gPSBzZWxmLmNsYXNzTmFtZSgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5tZXRob2QoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsibWV0aG9kIl0gPSBzZWxmLm1ldGhvZCgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5wYXlsb2FkKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbInBheWxvYWQiXSA9IHNlbGYucGF5bG9hZCgpOw0KICAgICAgICANCiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UocmV0WyJwYXlsb2FkIl0sIGRpY3QpOg0KICAgICAgICAgICAgICAgIHJldFsicGF5bG9hZCJdID0ganNvbi5kdW1wcyhyZXRbInBheWxvYWQiXSk7DQogICAgICAgICAgICByZXRbInBheWxvYWQiXSA9IHViaW5hc2NpaS5iMmFfYmFzZTY0KHJldFsicGF5bG9hZCJdKS5zdHJpcCgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5jYXJyaWVyKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbImNhcnJpZXIiXSA9IHNlbGYuY2FycmllcigpLl90b0RvY3VtZW50KCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLnNlbmRlcigpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJzZW5kZXIiXSA9IHNlbGYuc2VuZGVyKCkuX3RvRG9jdW1lbnQoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYucmVjaXBpZW50KCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbInJlY2lwaWVudCJdID0gc2VsZi5yZWNpcGllbnQoKS5fdG9Eb2N1bWVudCgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbInJlc3BvbnNlVG8iXSA9IHNlbGYucmVzcG9uc2VUbygpLl90b0RvY3VtZW50KCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICANCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICByZXR1cm4gcmV0Ow0KDQogICAgDQogICAgZGVmIHN0b3JlKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6DQogICAgICAgIF9fdG9TdHJpbmcgPSAnRXZlbnQ6OnN0b3JlKCk6ICc7DQogICAgICAgIA0KICAgICAgICBldkpTT04gPSBOb25lOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBldkpTT04gPSBqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoNCiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7DQogICAgICAgIA0KDQogICAgICAgIGFuc3dlciA9IE5vbmU7DQoNCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpY2tzX21zKCkpKyddLkV2ZW50LnN0b3JlKCknKS5tZXRob2QoJ3N0b3JlJykuY2xhc3NOYW1lKCdFdmVudCcpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7DQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KICAgICAgICANCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICBhbnN3ZXIgPSBFdmVudCgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQogICAgICAgIA0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCg0KDQoNCiAgICAgICAgaWYgJ0V2ZW50X3N0b3JlJyBpbiBkaXIoKToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnPT0+IEV2ZW50X3N0b3JlKCknKTsNCiAgICAgICAgICAgIGFuc3dlciA9IEV2ZW50X3N0b3JlKHNlbGYsIF9fZXZlbnQsIGFuc3dlciwgX190b1N0cmluZyk7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KDQogICAgICAgICAgICANCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQoNCiAgICAgICAgcmV0dXJuIGFuc3dlcjsNCg0KICAgIA0KICAgIGRlZiBmaW5kQWxsKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6DQogICAgICAgIF9fdG9TdHJpbmcgPSAnRXZlbnQ6OmZpbmRBbGwoKTogJzsNCiAgICAgICAgDQogICAgICAgIGV2SlNPTiA9IE5vbmU7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIGV2SlNPTiA9IGpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOg0KICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsNCiAgICAgICAgDQoNCiAgICAgICAgYW5zd2VyID0gTm9uZTsNCg0KICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGlja3NfbXMoKSkrJ10uRXZlbnQuZmluZEFsbCgpJykubWV0aG9kKCdmaW5kQWxsJykuY2xhc3NOYW1lKCdFdmVudCcpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7DQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KICAgICAgICANCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICBhbnN3ZXIgPSBFdmVudCgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQogICAgICAgIA0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCg0KDQoNCiAgICAgICAgaWYgJ0V2ZW50X2ZpbmRBbGwnIGluIGRpcigpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICc9PT4gRXZlbnRfZmluZEFsbCgpJyk7DQogICAgICAgICAgICBhbnN3ZXIgPSBFdmVudF9maW5kQWxsKHNlbGYsIF9fZXZlbnQsIGFuc3dlciwgX190b1N0cmluZyk7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KDQogICAgICAgICAgICANCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQoNCiAgICAgICAgcmV0dXJuIGFuc3dlcjsNCg0KICAgIA0KICAgIGRlZiBmaW5kKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6DQogICAgICAgIF9fdG9TdHJpbmcgPSAnRXZlbnQ6OmZpbmQoKTogJzsNCiAgICAgICAgDQogICAgICAgIGV2SlNPTiA9IE5vbmU7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIGV2SlNPTiA9IGpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOg0KICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsNCiAgICAgICAgDQoNCiAgICAgICAgYW5zd2VyID0gTm9uZTsNCg0KICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGlja3NfbXMoKSkrJ10uRXZlbnQuZmluZCgpJykubWV0aG9kKCdmaW5kJykuY2xhc3NOYW1lKCdFdmVudCcpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7DQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KICAgICAgICANCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICBhbnN3ZXIgPSBFdmVudCgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQogICAgICAgIA0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCg0KDQoNCiAgICAgICAgaWYgJ0V2ZW50X2ZpbmQnIGluIGRpcigpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICc9PT4gRXZlbnRfZmluZCgpJyk7DQogICAgICAgICAgICBhbnN3ZXIgPSBFdmVudF9maW5kKHNlbGYsIF9fZXZlbnQsIGFuc3dlciwgX190b1N0cmluZyk7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KDQogICAgICAgICAgICANCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQoNCiAgICAgICAgcmV0dXJuIGFuc3dlcjsNCg0KICAgIA0KICAgIGRlZiBsaXN0ZW4oc2VsZiwgX19ldmVudD1Ob25lLCBub2RlPU5vbmUpOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ0V2ZW50OjpsaXN0ZW4oKTogJzsNCiAgICAgICAgDQogICAgICAgIGV2SlNPTiA9IE5vbmU7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIGV2SlNPTiA9IGpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOg0KICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsNCiAgICAgICAgDQogICAgICAgICAgICBpZiAnbm9kZScgaW4gZXZKU09OOg0KICAgICAgICAgICAgICAgIG5vZGUgPSBldkpTT05bJ25vZGUnXTsNCiAgICAgICAgDQoNCiAgICAgICAgYW5zd2VyID0gTm9uZTsNCg0KICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGlja3NfbXMoKSkrJ10uRXZlbnQubGlzdGVuKCknKS5tZXRob2QoJ2xpc3RlbicpLmNsYXNzTmFtZSgnRXZlbnQnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOw0KICAgICAgICANCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCiAgICAgICAgDQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgYW5zd2VyID0gZXZKU09OOw0KICAgICAgICANCiAgICAgICAgDQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KDQoNCg0KICAgICAgICBpZiAnRXZlbnRfbGlzdGVuJyBpbiBkaXIoKToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnPT0+IEV2ZW50X2xpc3RlbigpJyk7DQogICAgICAgICAgICBhbnN3ZXIgPSBFdmVudF9saXN0ZW4oc2VsZiwgX19ldmVudCwgYW5zd2VyLCBfX3RvU3RyaW5nKTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChzdHIoYW5zd2VyKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCg0KICAgICAgICByZXR1cm4gYW5zd2VyOw0KDQogICAgDQogICAgZGVmIHRyaWdnZXIoc2VsZiwgX19ldmVudD1Ob25lKToNCiAgICAgICAgX190b1N0cmluZyA9ICdFdmVudDo6dHJpZ2dlcigpOiAnOw0KICAgICAgICANCiAgICAgICAgZXZKU09OID0gTm9uZTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgZXZKU09OID0ganNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046DQogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOw0KICAgICAgICANCg0KICAgICAgICBhbnN3ZXIgPSBOb25lOw0KDQogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aWNrc19tcygpKSsnXS5FdmVudC50cmlnZ2VyKCknKS5tZXRob2QoJ3RyaWdnZXInKS5jbGFzc05hbWUoJ0V2ZW50JykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOw0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsNCiAgICAgICAgDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQogICAgICAgIA0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgIGFuc3dlciA9IGV2SlNPTjsNCiAgICAgICAgDQogICAgICAgIA0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCgogICAgICAgICAgICByZXR1cm4gbXF0dF9jbGllbnQucHVibGlzaChtcXR0X3RvcGljLCB1anNvbi5kdW1wcyhzZWxmLl90b0RvY3VtZW50KCkpKTsKCQkNCg0KDQogICAgICAgIGlmICdFdmVudF90cmlnZ2VyJyBpbiBkaXIoKToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnPT0+IEV2ZW50X3RyaWdnZXIoKScpOw0KICAgICAgICAgICAgYW5zd2VyID0gRXZlbnRfdHJpZ2dlcihzZWxmLCBfX2V2ZW50LCBhbnN3ZXIsIF9fdG9TdHJpbmcpOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHN0cihhbnN3ZXIpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCg0KICAgICAgICAgICAgDQoNCiAgICAgICAgcmV0dXJuIGFuc3dlcjsNCg0KICAgIA0KICAgIGRlZiBwcm9jZXNzKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6DQogICAgICAgIF9fdG9TdHJpbmcgPSAnRXZlbnQ6OnByb2Nlc3MoKTogJzsNCiAgICAgICAgDQogICAgICAgIGV2SlNPTiA9IE5vbmU7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIGV2SlNPTiA9IGpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOg0KICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsNCiAgICAgICAgDQoNCiAgICAgICAgYW5zd2VyID0gTm9uZTsNCg0KICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGlja3NfbXMoKSkrJ10uRXZlbnQucHJvY2VzcygpJykubWV0aG9kKCdwcm9jZXNzJykuY2xhc3NOYW1lKCdFdmVudCcpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7DQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KICAgICAgICANCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICBhbnN3ZXIgPSBFdmVudCgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQogICAgICAgIA0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCgogICAgICAgICAgICBpZiBzZWxmLnNlbmRlcigpLmNvZGUoKT09bm9kZS5jb2RlKCk6CiAgICAgICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImlnbm9yaW5nIG15IGV2ZW50cyIpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICBlbGlmIHNlbGYucmVjaXBpZW50KCkuY29kZSgpIT1ub2RlLmNvZGUoKToKICAgICAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAibm90IHNlbnQgdG8gbWUiKTsKICAgICAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgICAgIHJldHVybiBnZXRhdHRyKGdsb2JhbHMoKVtzZWxmLmNsYXNzTmFtZSgpXSgpLCBzZWxmLm1ldGhvZCgpKSgpOwoJCQ0KDQoNCiAgICAgICAgaWYgJ0V2ZW50X3Byb2Nlc3MnIGluIGRpcigpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICc9PT4gRXZlbnRfcHJvY2VzcygpJyk7DQogICAgICAgICAgICBhbnN3ZXIgPSBFdmVudF9wcm9jZXNzKHNlbGYsIF9fZXZlbnQsIGFuc3dlciwgX190b1N0cmluZyk7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KDQogICAgICAgICAgICANCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQoNCiAgICAgICAgcmV0dXJuIGFuc3dlcjsNCg0KICAgIA0KDQoNCmNsYXNzIE5vZGUoKToNCiAgICBkZWYgX19pbml0X18oc2VsZiwgSWQ9Tm9uZSwgYWN0aXZlPU5vbmUsIGVuYWJsZWQ9Tm9uZSwgY29kZT1Ob25lLCBvcmRlcj1Ob25lLCBkYXRlPU5vbmUsIG5hbWU9Tm9uZSwgcmVtYXJrPU5vbmUsIGFkZHJlc3M9Tm9uZSwgYmFja3VwPU5vbmUsIHBhcmVudD1Ob25lLCBncm91cD1Ob25lLCBjb250ZXh0PU5vbmUsIHBvcnQ9Tm9uZSwgb25saW5lPU5vbmUsIHNlY3VyZT1Ob25lLCB0eXBlPU5vbmUpOg0KICAgICAgICBzdXBlcigpLl9faW5pdF9fKCk7DQoNCiAgICAgICAgI3ByaW50KCdOb2RlOjpfX2luaXRfXygpJyk7DQogICAgICAgIGlmIElkIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgc2VsZi5JZCA9IElkOw0KDQogICAgICAgIA0KICAgICAgICBzZWxmLmFjdGl2ZShhY3RpdmUpOw0KICAgICAgICBzZWxmLmVuYWJsZWQoZW5hYmxlZCk7DQogICAgICAgIHNlbGYuY29kZShjb2RlKTsNCiAgICAgICAgc2VsZi5vcmRlcihvcmRlcik7DQogICAgICAgIHNlbGYuZGF0ZShkYXRlKTsNCiAgICAgICAgc2VsZi5uYW1lKG5hbWUpOw0KICAgICAgICBzZWxmLnJlbWFyayhyZW1hcmspOw0KICAgICAgICBzZWxmLmFkZHJlc3MoYWRkcmVzcyk7DQogICAgICAgIHNlbGYuYmFja3VwKGJhY2t1cCk7DQogICAgICAgIHNlbGYucGFyZW50KHBhcmVudCk7DQogICAgICAgIHNlbGYuZ3JvdXAoZ3JvdXApOw0KICAgICAgICBzZWxmLmNvbnRleHQoY29udGV4dCk7DQogICAgICAgIHNlbGYucG9ydChwb3J0KTsNCiAgICAgICAgc2VsZi5vbmxpbmUob25saW5lKTsNCiAgICAgICAgc2VsZi5zZWN1cmUoc2VjdXJlKTsNCiAgICAgICAgc2VsZi50eXBlKHR5cGUpOw0KICAgICAgICANCiAgICBJZCA9IE5vbmU7DQogICAgDQogICAgDQogICAgIyBhY3RpdmU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfYWN0aXZlID0gTm9uZTsNCiAgICBkZWYgYWN0aXZlKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2FjdGl2ZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9hY3RpdmU7DQoNCg0KICAgIA0KICAgICMgZW5hYmxlZDogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9lbmFibGVkID0gTm9uZTsNCiAgICBkZWYgZW5hYmxlZChzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9lbmFibGVkID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2VuYWJsZWQ7DQoNCg0KICAgIA0KICAgICMgY29kZTogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9jb2RlID0gTm9uZTsNCiAgICBkZWYgY29kZShzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9jb2RlID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2NvZGU7DQoNCg0KICAgIA0KICAgICMgb3JkZXI6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfb3JkZXIgPSBOb25lOw0KICAgIGRlZiBvcmRlcihzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9vcmRlciA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9vcmRlcjsNCg0KDQogICAgDQogICAgIyBkYXRlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2RhdGUgPSBOb25lOw0KICAgIGRlZiBkYXRlKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2RhdGUgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fZGF0ZTsNCg0KDQogICAgDQogICAgIyBuYW1lOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX25hbWUgPSBOb25lOw0KICAgIGRlZiBuYW1lKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX25hbWUgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fbmFtZTsNCg0KDQogICAgDQogICAgIyByZW1hcms6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfcmVtYXJrID0gTm9uZTsNCiAgICBkZWYgcmVtYXJrKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX3JlbWFyayA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9yZW1hcms7DQoNCg0KICAgIA0KICAgICMgYWRkcmVzczogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9hZGRyZXNzID0gTm9uZTsNCiAgICBkZWYgYWRkcmVzcyhzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9hZGRyZXNzID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2FkZHJlc3M7DQoNCg0KICAgIA0KICAgICMgYmFja3VwOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2JhY2t1cCA9IE5vbmU7DQogICAgZGVmIGJhY2t1cChzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9iYWNrdXAgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fYmFja3VwOw0KDQoNCiAgICANCiAgICAjIHBhcmVudDogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9wYXJlbnQgPSBOb25lOw0KICAgIGRlZiBwYXJlbnQoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fcGFyZW50ID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3BhcmVudDsNCg0KDQogICAgDQogICAgIyBncm91cDogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9ncm91cCA9IE5vbmU7DQogICAgZGVmIGdyb3VwKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2dyb3VwID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2dyb3VwOw0KDQoNCiAgICANCiAgICAjIGNvbnRleHQ6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfY29udGV4dCA9IE5vbmU7DQogICAgZGVmIGNvbnRleHQoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fY29udGV4dCA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9jb250ZXh0Ow0KDQoNCiAgICANCiAgICAjIHBvcnQ6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfcG9ydCA9IE5vbmU7DQogICAgZGVmIHBvcnQoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fcG9ydCA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9wb3J0Ow0KDQoNCiAgICANCiAgICAjIG9ubGluZTogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9vbmxpbmUgPSBOb25lOw0KICAgIGRlZiBvbmxpbmUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fb25saW5lID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX29ubGluZTsNCg0KDQogICAgDQogICAgIyBzZWN1cmU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfc2VjdXJlID0gTm9uZTsNCiAgICBkZWYgc2VjdXJlKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX3NlY3VyZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9zZWN1cmU7DQoNCg0KICAgIA0KICAgICMgdHlwZTogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF90eXBlID0gTm9uZTsNCiAgICBkZWYgdHlwZShzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl90eXBlID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3R5cGU7DQoNCg0KICAgIA0KICAgIA0KICAgIGRlZiBfZnJvbURvY3VtZW50KHNlbGYsIG9iaik6DQogICAgICAgIF9fdG9TdHJpbmcgPSAnTm9kZTo6X2Zyb21Eb2N1bWVudCgpOiAnOw0KDQogICAgICAgIGlmIG9iaiBpcyBOb25lOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIA0KICAgICAgICBpZiBpc2luc3RhbmNlKG9iaiwgYnl0ZXMpOg0KICAgICAgICAgICAgb2JqID0gc3RyKG9iaiwgInV0Zi04Iik7DQoNCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIHN0cikgb3IgdHlwZShvYmopIGlzIHN0cjoNCiAgICAgICAgICAgIG9iaiA9IGpzb24ubG9hZHMob2JqKTsNCiAgICAgICAgDQogICAgICAgIGlmIG5vdCBpc2luc3RhbmNlKG9iaiwgKHN0ciwgYnl0ZXMsIGRpY3QpKToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnR09UIEhFUkU6ICcgKyBzdHIodHlwZShvYmopKSk7DQogICAgICAgICAgICByZXR1cm4gb2JqOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBmb3IgaSBpbiBvYmo6DQogICAgICAgICAgICAgICAgb2JqW2ldID0gTm9kZSgpLl9mcm9tRG9jdW1lbnQob2JqW2ldKTsNCiAgICAgICAgICAgIHJldHVybiBvYmo7DQoNCg0KICAgICAgICBpZiAnSWQnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuSWQgPSBvYmpbJ0lkJ107DQoNCiAgICANCiAgICAgICAgaWYgJ2FjdGl2ZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5hY3RpdmUob2JqWydhY3RpdmUnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnZW5hYmxlZCcgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5lbmFibGVkKG9ialsnZW5hYmxlZCddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdjb2RlJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmNvZGUob2JqWydjb2RlJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ29yZGVyJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLm9yZGVyKG9ialsnb3JkZXInXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnZGF0ZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5kYXRlKG9ialsnZGF0ZSddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICduYW1lJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLm5hbWUob2JqWyduYW1lJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ3JlbWFyaycgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5yZW1hcmsob2JqWydyZW1hcmsnXSk7DQogICAgICAgIA0KICAgICAgICAgICAgc2VsZi5yZW1hcmsoIGJhc2U2NC5iNjRlbmNvZGUoc2VsZi5yZW1hcmsoKS5lbmNvZGUoImFzY2lpIikpLmRlY29kZSgiYXNjaWkiKSApOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ2FkZHJlc3MnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuYWRkcmVzcyhvYmpbJ2FkZHJlc3MnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnYmFja3VwJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmJhY2t1cChOb2RlKCkuX2Zyb21Eb2N1bWVudChvYmpbJ2JhY2t1cCddKSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAncGFyZW50JyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLnBhcmVudChOb2RlKCkuX2Zyb21Eb2N1bWVudChvYmpbJ3BhcmVudCddKSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnZ3JvdXAnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuZ3JvdXAoTm9kZV9Hcm91cCgpLl9mcm9tRG9jdW1lbnQob2JqWydncm91cCddKSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnY29udGV4dCcgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5jb250ZXh0KE5vZGVfQ29udGV4dCgpLl9mcm9tRG9jdW1lbnQob2JqWydjb250ZXh0J10pKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdwb3J0JyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLnBvcnQob2JqWydwb3J0J10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ29ubGluZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5vbmxpbmUob2JqWydvbmxpbmUnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnc2VjdXJlJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLnNlY3VyZShvYmpbJ3NlY3VyZSddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICd0eXBlJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLnR5cGUoTm9kZV9UeXBlKCkuX2Zyb21Eb2N1bWVudChvYmpbJ3R5cGUnXSkpOw0KICAgICAgICANCiAgICANCg0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIHJldHVybiBzZWxmOw0KICAgIA0KICAgIGRlZiBfdG9Eb2N1bWVudChzZWxmKToNCiAgICAgICAgcmV0ID0ge307DQogICAgICAgIGlmIHNlbGYuSWQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbIklkIl0gPSBzZWxmLklkOw0KDQogICAgDQogICAgICAgIGlmIHNlbGYuYWN0aXZlKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbImFjdGl2ZSJdID0gc2VsZi5hY3RpdmUoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYuZW5hYmxlZCgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJlbmFibGVkIl0gPSBzZWxmLmVuYWJsZWQoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYuY29kZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJjb2RlIl0gPSBzZWxmLmNvZGUoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYub3JkZXIoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsib3JkZXIiXSA9IHNlbGYub3JkZXIoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYuZGF0ZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJkYXRlIl0gPSBzZWxmLmRhdGUoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYubmFtZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJuYW1lIl0gPSBzZWxmLm5hbWUoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYucmVtYXJrKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbInJlbWFyayJdID0gc2VsZi5yZW1hcmsoKTsNCiAgICAgICAgDQogICAgICAgICAgICBpZiBpc2luc3RhbmNlKHJldFsicmVtYXJrIl0sIGRpY3QpOg0KICAgICAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSBqc29uLmR1bXBzKHJldFsicmVtYXJrIl0pOw0KICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IHViaW5hc2NpaS5iMmFfYmFzZTY0KHJldFsicmVtYXJrIl0pLnN0cmlwKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmFkZHJlc3MoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiYWRkcmVzcyJdID0gc2VsZi5hZGRyZXNzKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmJhY2t1cCgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJiYWNrdXAiXSA9IHNlbGYuYmFja3VwKCkuX3RvRG9jdW1lbnQoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYucGFyZW50KCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbInBhcmVudCJdID0gc2VsZi5wYXJlbnQoKS5fdG9Eb2N1bWVudCgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5ncm91cCgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJncm91cCJdID0gc2VsZi5ncm91cCgpLl90b0RvY3VtZW50KCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmNvbnRleHQoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiY29udGV4dCJdID0gc2VsZi5jb250ZXh0KCkuX3RvRG9jdW1lbnQoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYucG9ydCgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJwb3J0Il0gPSBzZWxmLnBvcnQoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYub25saW5lKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbIm9ubGluZSJdID0gc2VsZi5vbmxpbmUoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYuc2VjdXJlKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbInNlY3VyZSJdID0gc2VsZi5zZWN1cmUoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYudHlwZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJ0eXBlIl0gPSBzZWxmLnR5cGUoKS5fdG9Eb2N1bWVudCgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgcmV0dXJuIHJldDsNCg0KICAgIA0KICAgIGRlZiBzdG9yZShzZWxmLCBfX2V2ZW50PU5vbmUpOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ05vZGU6OnN0b3JlKCk6ICc7DQogICAgICAgIA0KICAgICAgICBldkpTT04gPSBOb25lOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBldkpTT04gPSBqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoNCiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7DQogICAgICAgIA0KDQogICAgICAgIGFuc3dlciA9IE5vbmU7DQoNCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpY2tzX21zKCkpKyddLk5vZGUuc3RvcmUoKScpLm1ldGhvZCgnc3RvcmUnKS5jbGFzc05hbWUoJ05vZGUnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOw0KICAgICAgICANCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCiAgICAgICAgDQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgYW5zd2VyID0gTm9kZSgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQogICAgICAgIAogICAgICAgIA0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCg0KDQoNCiAgICAgICAgaWYgJ05vZGVfc3RvcmUnIGluIGRpcigpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICc9PT4gTm9kZV9zdG9yZSgpJyk7DQogICAgICAgICAgICBhbnN3ZXIgPSBOb2RlX3N0b3JlKHNlbGYsIF9fZXZlbnQsIGFuc3dlciwgX190b1N0cmluZyk7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KDQogICAgICAgICAgICANCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQoNCiAgICAgICAgcmV0dXJuIGFuc3dlcjsNCg0KICAgIA0KICAgIGRlZiBmaW5kQWxsKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6DQogICAgICAgIF9fdG9TdHJpbmcgPSAnTm9kZTo6ZmluZEFsbCgpOiAnOw0KICAgICAgICANCiAgICAgICAgZXZKU09OID0gTm9uZTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgZXZKU09OID0ganNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046DQogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOw0KICAgICAgICANCg0KICAgICAgICBhbnN3ZXIgPSBOb25lOw0KDQogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aWNrc19tcygpKSsnXS5Ob2RlLmZpbmRBbGwoKScpLm1ldGhvZCgnZmluZEFsbCcpLmNsYXNzTmFtZSgnTm9kZScpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7DQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KICAgICAgICANCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICBhbnN3ZXIgPSBOb2RlKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCiAgICAgICAgDQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KDQoNCg0KICAgICAgICBpZiAnTm9kZV9maW5kQWxsJyBpbiBkaXIoKToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnPT0+IE5vZGVfZmluZEFsbCgpJyk7DQogICAgICAgICAgICBhbnN3ZXIgPSBOb2RlX2ZpbmRBbGwoc2VsZiwgX19ldmVudCwgYW5zd2VyLCBfX3RvU3RyaW5nKTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCg0KICAgICAgICByZXR1cm4gYW5zd2VyOw0KDQogICAgDQogICAgZGVmIGZpbmQoc2VsZiwgX19ldmVudD1Ob25lKToNCiAgICAgICAgX190b1N0cmluZyA9ICdOb2RlOjpmaW5kKCk6ICc7DQogICAgICAgIA0KICAgICAgICBldkpTT04gPSBOb25lOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBldkpTT04gPSBqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoNCiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7DQogICAgICAgIA0KDQogICAgICAgIGFuc3dlciA9IE5vbmU7DQoNCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpY2tzX21zKCkpKyddLk5vZGUuZmluZCgpJykubWV0aG9kKCdmaW5kJykuY2xhc3NOYW1lKCdOb2RlJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOw0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsNCiAgICAgICAgDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQogICAgICAgIA0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgIGFuc3dlciA9IE5vZGUoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KICAgICAgICANCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQoNCg0KDQogICAgICAgIGlmICdOb2RlX2ZpbmQnIGluIGRpcigpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICc9PT4gTm9kZV9maW5kKCknKTsNCiAgICAgICAgICAgIGFuc3dlciA9IE5vZGVfZmluZChzZWxmLCBfX2V2ZW50LCBhbnN3ZXIsIF9fdG9TdHJpbmcpOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCg0KICAgICAgICAgICAgDQogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KDQogICAgICAgIHJldHVybiBhbnN3ZXI7DQoNCiAgICANCiAgICBkZWYgYXV0aENvZGUoc2VsZiwgX19ldmVudD1Ob25lLCBjb2RlPU5vbmUsIHRvb2w9Tm9uZSk6DQogICAgICAgIF9fdG9TdHJpbmcgPSAnTm9kZTo6YXV0aENvZGUoKTogJzsNCiAgICAgICAgDQogICAgICAgIGV2SlNPTiA9IE5vbmU7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIGV2SlNPTiA9IGpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOg0KICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsNCiAgICAgICAgDQogICAgICAgICAgICBpZiAnY29kZScgaW4gZXZKU09OOg0KICAgICAgICAgICAgICAgIGNvZGUgPSBldkpTT05bJ2NvZGUnXTsNCiAgICAgICAgDQogICAgICAgICAgICBpZiAndG9vbCcgaW4gZXZKU09OOg0KICAgICAgICAgICAgICAgIHRvb2wgPSBldkpTT05bJ3Rvb2wnXTsNCiAgICAgICAgDQoNCiAgICAgICAgYW5zd2VyID0gTm9uZTsNCg0KICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGlja3NfbXMoKSkrJ10uTm9kZS5hdXRoQ29kZSgpJykubWV0aG9kKCdhdXRoQ29kZScpLmNsYXNzTmFtZSgnTm9kZScpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7DQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KICAgICAgICANCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICBhbnN3ZXIgPSBldkpTT047DQogICAgICAgIA0KICAgICAgICANCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQoNCg0KDQogICAgICAgIGlmICdOb2RlX2F1dGhDb2RlJyBpbiBkaXIoKToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnPT0+IE5vZGVfYXV0aENvZGUoKScpOw0KICAgICAgICAgICAgYW5zd2VyID0gTm9kZV9hdXRoQ29kZShzZWxmLCBfX2V2ZW50LCBhbnN3ZXIsIF9fdG9TdHJpbmcpOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHN0cihhbnN3ZXIpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCg0KICAgICAgICAgICAgDQogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KDQogICAgICAgIHJldHVybiBhbnN3ZXI7DQoNCiAgICANCiAgICBkZWYgaW5pdChzZWxmLCBfX2V2ZW50PU5vbmUsIG9ubGluZT1Ob25lLCBjb2RlPU5vbmUsIHVpZD1Ob25lKToNCiAgICAgICAgX190b1N0cmluZyA9ICdOb2RlOjppbml0KCk6ICc7DQogICAgICAgIA0KICAgICAgICBldkpTT04gPSBOb25lOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBldkpTT04gPSBqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoNCiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7DQogICAgICAgIA0KICAgICAgICAgICAgaWYgJ29ubGluZScgaW4gZXZKU09OOg0KICAgICAgICAgICAgICAgIG9ubGluZSA9IGV2SlNPTlsnb25saW5lJ107DQogICAgICAgIA0KICAgICAgICAgICAgaWYgJ2NvZGUnIGluIGV2SlNPTjoNCiAgICAgICAgICAgICAgICBjb2RlID0gZXZKU09OWydjb2RlJ107DQogICAgICAgIA0KICAgICAgICAgICAgaWYgJ3VpZCcgaW4gZXZKU09OOg0KICAgICAgICAgICAgICAgIHVpZCA9IGV2SlNPTlsndWlkJ107DQogICAgICAgIA0KDQogICAgICAgIGFuc3dlciA9IE5vbmU7DQoNCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpY2tzX21zKCkpKyddLk5vZGUuaW5pdCgpJykubWV0aG9kKCdpbml0JykuY2xhc3NOYW1lKCdOb2RlJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOw0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsNCiAgICAgICAgDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQogICAgICAgIA0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgIGFuc3dlciA9IE5vZGUoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KICAgICAgICANCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQoNCg0KDQogICAgICAgIGlmICdOb2RlX2luaXQnIGluIGRpcigpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICc9PT4gTm9kZV9pbml0KCknKTsNCiAgICAgICAgICAgIGFuc3dlciA9IE5vZGVfaW5pdChzZWxmLCBfX2V2ZW50LCBhbnN3ZXIsIF9fdG9TdHJpbmcpOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCg0KICAgICAgICAgICAgDQogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KDQogICAgICAgIHJldHVybiBhbnN3ZXI7DQoNCiAgICANCiAgICBkZWYgcmVzdGFydChzZWxmLCBfX2V2ZW50PU5vbmUpOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ05vZGU6OnJlc3RhcnQoKTogJzsNCiAgICAgICAgDQogICAgICAgIGV2SlNPTiA9IE5vbmU7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIGV2SlNPTiA9IGpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOg0KICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsNCiAgICAgICAgDQoNCiAgICAgICAgYW5zd2VyID0gTm9uZTsNCg0KICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGlja3NfbXMoKSkrJ10uTm9kZS5yZXN0YXJ0KCknKS5tZXRob2QoJ3Jlc3RhcnQnKS5jbGFzc05hbWUoJ05vZGUnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOw0KICAgICAgICANCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCiAgICAgICAgDQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgYW5zd2VyID0gZXZKU09OOw0KICAgICAgICANCiAgICAgICAgDQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KDQoNCg0KICAgICAgICBpZiAnTm9kZV9yZXN0YXJ0JyBpbiBkaXIoKToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnPT0+IE5vZGVfcmVzdGFydCgpJyk7DQogICAgICAgICAgICBhbnN3ZXIgPSBOb2RlX3Jlc3RhcnQoc2VsZiwgX19ldmVudCwgYW5zd2VyLCBfX3RvU3RyaW5nKTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChzdHIoYW5zd2VyKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCg0KICAgICAgICByZXR1cm4gYW5zd2VyOw0KDQogICAgDQogICAgZGVmIHN0YXR1cyhzZWxmLCBfX2V2ZW50PU5vbmUpOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ05vZGU6OnN0YXR1cygpOiAnOw0KICAgICAgICANCiAgICAgICAgZXZKU09OID0gTm9uZTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgZXZKU09OID0ganNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046DQogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOw0KICAgICAgICANCg0KICAgICAgICBhbnN3ZXIgPSBOb25lOw0KDQogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aWNrc19tcygpKSsnXS5Ob2RlLnN0YXR1cygpJykubWV0aG9kKCdzdGF0dXMnKS5jbGFzc05hbWUoJ05vZGUnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOw0KICAgICAgICANCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCiAgICAgICAgDQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgYW5zd2VyID0gZXZKU09OOw0KICAgICAgICANCiAgICAgICAgDQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KDQoNCg0KICAgICAgICBpZiAnTm9kZV9zdGF0dXMnIGluIGRpcigpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICc9PT4gTm9kZV9zdGF0dXMoKScpOw0KICAgICAgICAgICAgYW5zd2VyID0gTm9kZV9zdGF0dXMoc2VsZiwgX19ldmVudCwgYW5zd2VyLCBfX3RvU3RyaW5nKTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChzdHIoYW5zd2VyKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCg0KICAgICAgICByZXR1cm4gYW5zd2VyOw0KDQogICAgDQoNCg0KY2xhc3MgTm9kZV9Db250ZXh0KCk6DQogICAgZGVmIF9faW5pdF9fKHNlbGYsIElkPU5vbmUsIGFjdGl2ZT1Ob25lLCBlbmFibGVkPU5vbmUsIGNvZGU9Tm9uZSwgb3JkZXI9Tm9uZSwgZGF0ZT1Ob25lLCBuYW1lPU5vbmUsIHJlbWFyaz1Ob25lKToNCiAgICAgICAgc3VwZXIoKS5fX2luaXRfXygpOw0KDQogICAgICAgICNwcmludCgnTm9kZV9Db250ZXh0OjpfX2luaXRfXygpJyk7DQogICAgICAgIGlmIElkIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgc2VsZi5JZCA9IElkOw0KDQogICAgICAgIA0KICAgICAgICBzZWxmLmFjdGl2ZShhY3RpdmUpOw0KICAgICAgICBzZWxmLmVuYWJsZWQoZW5hYmxlZCk7DQogICAgICAgIHNlbGYuY29kZShjb2RlKTsNCiAgICAgICAgc2VsZi5vcmRlcihvcmRlcik7DQogICAgICAgIHNlbGYuZGF0ZShkYXRlKTsNCiAgICAgICAgc2VsZi5uYW1lKG5hbWUpOw0KICAgICAgICBzZWxmLnJlbWFyayhyZW1hcmspOw0KICAgICAgICANCiAgICBJZCA9IE5vbmU7DQogICAgDQogICAgDQogICAgIyBhY3RpdmU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfYWN0aXZlID0gTm9uZTsNCiAgICBkZWYgYWN0aXZlKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2FjdGl2ZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9hY3RpdmU7DQoNCg0KICAgIA0KICAgICMgZW5hYmxlZDogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9lbmFibGVkID0gTm9uZTsNCiAgICBkZWYgZW5hYmxlZChzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9lbmFibGVkID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2VuYWJsZWQ7DQoNCg0KICAgIA0KICAgICMgY29kZTogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9jb2RlID0gTm9uZTsNCiAgICBkZWYgY29kZShzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9jb2RlID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2NvZGU7DQoNCg0KICAgIA0KICAgICMgb3JkZXI6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfb3JkZXIgPSBOb25lOw0KICAgIGRlZiBvcmRlcihzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9vcmRlciA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9vcmRlcjsNCg0KDQogICAgDQogICAgIyBkYXRlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2RhdGUgPSBOb25lOw0KICAgIGRlZiBkYXRlKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2RhdGUgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fZGF0ZTsNCg0KDQogICAgDQogICAgIyBuYW1lOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX25hbWUgPSBOb25lOw0KICAgIGRlZiBuYW1lKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX25hbWUgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fbmFtZTsNCg0KDQogICAgDQogICAgIyByZW1hcms6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfcmVtYXJrID0gTm9uZTsNCiAgICBkZWYgcmVtYXJrKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX3JlbWFyayA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9yZW1hcms7DQoNCg0KICAgIA0KICAgIA0KICAgIGRlZiBfZnJvbURvY3VtZW50KHNlbGYsIG9iaik6DQogICAgICAgIF9fdG9TdHJpbmcgPSAnTm9kZV9Db250ZXh0OjpfZnJvbURvY3VtZW50KCk6ICc7DQoNCiAgICAgICAgaWYgb2JqIGlzIE5vbmU6DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgDQogICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLCBieXRlcyk6DQogICAgICAgICAgICBvYmogPSBzdHIob2JqLCAidXRmLTgiKTsNCg0KICAgICAgICBpZiBpc2luc3RhbmNlKG9iaiwgc3RyKSBvciB0eXBlKG9iaikgaXMgc3RyOg0KICAgICAgICAgICAgb2JqID0ganNvbi5sb2FkcyhvYmopOw0KICAgICAgICANCiAgICAgICAgaWYgbm90IGlzaW5zdGFuY2Uob2JqLCAoc3RyLCBieXRlcywgZGljdCkpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICdHT1QgSEVSRTogJyArIHN0cih0eXBlKG9iaikpKTsNCiAgICAgICAgICAgIHJldHVybiBvYmo7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGZvciBpIGluIG9iajoNCiAgICAgICAgICAgICAgICBvYmpbaV0gPSBOb2RlX0NvbnRleHQoKS5fZnJvbURvY3VtZW50KG9ialtpXSk7DQogICAgICAgICAgICByZXR1cm4gb2JqOw0KDQoNCiAgICAgICAgaWYgJ0lkJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLklkID0gb2JqWydJZCddOw0KDQogICAgDQogICAgICAgIGlmICdhY3RpdmUnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuYWN0aXZlKG9ialsnYWN0aXZlJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ2VuYWJsZWQnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuZW5hYmxlZChvYmpbJ2VuYWJsZWQnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnY29kZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5jb2RlKG9ialsnY29kZSddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdvcmRlcicgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5vcmRlcihvYmpbJ29yZGVyJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ2RhdGUnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuZGF0ZShvYmpbJ2RhdGUnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnbmFtZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5uYW1lKG9ialsnbmFtZSddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdyZW1hcmsnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYucmVtYXJrKG9ialsncmVtYXJrJ10pOw0KICAgICAgICANCiAgICAgICAgICAgIHNlbGYucmVtYXJrKCBiYXNlNjQuYjY0ZW5jb2RlKHNlbGYucmVtYXJrKCkuZW5jb2RlKCJhc2NpaSIpKS5kZWNvZGUoImFzY2lpIikgKTsNCiAgICAgICAgDQogICAgDQoNCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICByZXR1cm4gc2VsZjsNCiAgICANCiAgICBkZWYgX3RvRG9jdW1lbnQoc2VsZik6DQogICAgICAgIHJldCA9IHt9Ow0KICAgICAgICBpZiBzZWxmLklkIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJJZCJdID0gc2VsZi5JZDsNCg0KICAgIA0KICAgICAgICBpZiBzZWxmLmFjdGl2ZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJhY3RpdmUiXSA9IHNlbGYuYWN0aXZlKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmVuYWJsZWQoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiZW5hYmxlZCJdID0gc2VsZi5lbmFibGVkKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmNvZGUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiY29kZSJdID0gc2VsZi5jb2RlKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLm9yZGVyKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbIm9yZGVyIl0gPSBzZWxmLm9yZGVyKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmRhdGUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiZGF0ZSJdID0gc2VsZi5kYXRlKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLm5hbWUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsibmFtZSJdID0gc2VsZi5uYW1lKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLnJlbWFyaygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IHNlbGYucmVtYXJrKCk7DQogICAgICAgIA0KICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShyZXRbInJlbWFyayJdLCBkaWN0KToNCiAgICAgICAgICAgICAgICByZXRbInJlbWFyayJdID0ganNvbi5kdW1wcyhyZXRbInJlbWFyayJdKTsNCiAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSB1YmluYXNjaWkuYjJhX2Jhc2U2NChyZXRbInJlbWFyayJdKS5zdHJpcCgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgcmV0dXJuIHJldDsNCg0KICAgIA0KICAgIGRlZiBzdG9yZShzZWxmLCBfX2V2ZW50PU5vbmUpOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ05vZGVfQ29udGV4dDo6c3RvcmUoKTogJzsNCiAgICAgICAgDQogICAgICAgIGV2SlNPTiA9IE5vbmU7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIGV2SlNPTiA9IGpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOg0KICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsNCiAgICAgICAgDQoNCiAgICAgICAgYW5zd2VyID0gTm9uZTsNCg0KICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGlja3NfbXMoKSkrJ10uTm9kZV9Db250ZXh0LnN0b3JlKCknKS5tZXRob2QoJ3N0b3JlJykuY2xhc3NOYW1lKCdOb2RlX0NvbnRleHQnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOw0KICAgICAgICANCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCiAgICAgICAgDQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgYW5zd2VyID0gTm9kZV9Db250ZXh0KCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCiAgICAgICAgDQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KDQoNCg0KICAgICAgICBpZiAnTm9kZV9Db250ZXh0X3N0b3JlJyBpbiBkaXIoKToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnPT0+IE5vZGVfQ29udGV4dF9zdG9yZSgpJyk7DQogICAgICAgICAgICBhbnN3ZXIgPSBOb2RlX0NvbnRleHRfc3RvcmUoc2VsZiwgX19ldmVudCwgYW5zd2VyLCBfX3RvU3RyaW5nKTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCg0KICAgICAgICByZXR1cm4gYW5zd2VyOw0KDQogICAgDQogICAgZGVmIGZpbmRBbGwoc2VsZiwgX19ldmVudD1Ob25lKToNCiAgICAgICAgX190b1N0cmluZyA9ICdOb2RlX0NvbnRleHQ6OmZpbmRBbGwoKTogJzsNCiAgICAgICAgDQogICAgICAgIGV2SlNPTiA9IE5vbmU7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIGV2SlNPTiA9IGpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOg0KICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsNCiAgICAgICAgDQoNCiAgICAgICAgYW5zd2VyID0gTm9uZTsNCg0KICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGlja3NfbXMoKSkrJ10uTm9kZV9Db250ZXh0LmZpbmRBbGwoKScpLm1ldGhvZCgnZmluZEFsbCcpLmNsYXNzTmFtZSgnTm9kZV9Db250ZXh0JykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOw0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsNCiAgICAgICAgDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQogICAgICAgIA0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgIGFuc3dlciA9IE5vZGVfQ29udGV4dCgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQogICAgICAgIA0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCg0KDQoNCiAgICAgICAgaWYgJ05vZGVfQ29udGV4dF9maW5kQWxsJyBpbiBkaXIoKToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnPT0+IE5vZGVfQ29udGV4dF9maW5kQWxsKCknKTsNCiAgICAgICAgICAgIGFuc3dlciA9IE5vZGVfQ29udGV4dF9maW5kQWxsKHNlbGYsIF9fZXZlbnQsIGFuc3dlciwgX190b1N0cmluZyk7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KDQogICAgICAgICAgICANCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQoNCiAgICAgICAgcmV0dXJuIGFuc3dlcjsNCg0KICAgIA0KICAgIGRlZiBmaW5kKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6DQogICAgICAgIF9fdG9TdHJpbmcgPSAnTm9kZV9Db250ZXh0OjpmaW5kKCk6ICc7DQogICAgICAgIA0KICAgICAgICBldkpTT04gPSBOb25lOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBldkpTT04gPSBqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoNCiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7DQogICAgICAgIA0KDQogICAgICAgIGFuc3dlciA9IE5vbmU7DQoNCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpY2tzX21zKCkpKyddLk5vZGVfQ29udGV4dC5maW5kKCknKS5tZXRob2QoJ2ZpbmQnKS5jbGFzc05hbWUoJ05vZGVfQ29udGV4dCcpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7DQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KICAgICAgICANCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICBhbnN3ZXIgPSBOb2RlX0NvbnRleHQoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KICAgICAgICANCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQoNCg0KDQogICAgICAgIGlmICdOb2RlX0NvbnRleHRfZmluZCcgaW4gZGlyKCk6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJz09PiBOb2RlX0NvbnRleHRfZmluZCgpJyk7DQogICAgICAgICAgICBhbnN3ZXIgPSBOb2RlX0NvbnRleHRfZmluZChzZWxmLCBfX2V2ZW50LCBhbnN3ZXIsIF9fdG9TdHJpbmcpOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCg0KICAgICAgICAgICAgDQogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KDQogICAgICAgIHJldHVybiBhbnN3ZXI7DQoNCiAgICANCg0KDQpjbGFzcyBOb2RlX0dyb3VwKCk6DQogICAgZGVmIF9faW5pdF9fKHNlbGYsIElkPU5vbmUsIGFjdGl2ZT1Ob25lLCBlbmFibGVkPU5vbmUsIGNvZGU9Tm9uZSwgb3JkZXI9Tm9uZSwgZGF0ZT1Ob25lLCBuYW1lPU5vbmUsIHJlbWFyaz1Ob25lKToNCiAgICAgICAgc3VwZXIoKS5fX2luaXRfXygpOw0KDQogICAgICAgICNwcmludCgnTm9kZV9Hcm91cDo6X19pbml0X18oKScpOw0KICAgICAgICBpZiBJZCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHNlbGYuSWQgPSBJZDsNCg0KICAgICAgICANCiAgICAgICAgc2VsZi5hY3RpdmUoYWN0aXZlKTsNCiAgICAgICAgc2VsZi5lbmFibGVkKGVuYWJsZWQpOw0KICAgICAgICBzZWxmLmNvZGUoY29kZSk7DQogICAgICAgIHNlbGYub3JkZXIob3JkZXIpOw0KICAgICAgICBzZWxmLmRhdGUoZGF0ZSk7DQogICAgICAgIHNlbGYubmFtZShuYW1lKTsNCiAgICAgICAgc2VsZi5yZW1hcmsocmVtYXJrKTsNCiAgICAgICAgDQogICAgSWQgPSBOb25lOw0KICAgIA0KICAgIA0KICAgICMgYWN0aXZlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2FjdGl2ZSA9IE5vbmU7DQogICAgZGVmIGFjdGl2ZShzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9hY3RpdmUgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fYWN0aXZlOw0KDQoNCiAgICANCiAgICAjIGVuYWJsZWQ6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfZW5hYmxlZCA9IE5vbmU7DQogICAgZGVmIGVuYWJsZWQoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fZW5hYmxlZCA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9lbmFibGVkOw0KDQoNCiAgICANCiAgICAjIGNvZGU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfY29kZSA9IE5vbmU7DQogICAgZGVmIGNvZGUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fY29kZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9jb2RlOw0KDQoNCiAgICANCiAgICAjIG9yZGVyOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX29yZGVyID0gTm9uZTsNCiAgICBkZWYgb3JkZXIoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fb3JkZXIgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fb3JkZXI7DQoNCg0KICAgIA0KICAgICMgZGF0ZTogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9kYXRlID0gTm9uZTsNCiAgICBkZWYgZGF0ZShzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9kYXRlID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2RhdGU7DQoNCg0KICAgIA0KICAgICMgbmFtZTogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9uYW1lID0gTm9uZTsNCiAgICBkZWYgbmFtZShzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9uYW1lID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX25hbWU7DQoNCg0KICAgIA0KICAgICMgcmVtYXJrOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX3JlbWFyayA9IE5vbmU7DQogICAgZGVmIHJlbWFyayhzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9yZW1hcmsgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fcmVtYXJrOw0KDQoNCiAgICANCiAgICANCiAgICBkZWYgX2Zyb21Eb2N1bWVudChzZWxmLCBvYmopOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ05vZGVfR3JvdXA6Ol9mcm9tRG9jdW1lbnQoKTogJzsNCg0KICAgICAgICBpZiBvYmogaXMgTm9uZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICANCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIGJ5dGVzKToNCiAgICAgICAgICAgIG9iaiA9IHN0cihvYmosICJ1dGYtOCIpOw0KDQogICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLCBzdHIpIG9yIHR5cGUob2JqKSBpcyBzdHI6DQogICAgICAgICAgICBvYmogPSBqc29uLmxvYWRzKG9iaik7DQogICAgICAgIA0KICAgICAgICBpZiBub3QgaXNpbnN0YW5jZShvYmosIChzdHIsIGJ5dGVzLCBkaWN0KSk6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJ0dPVCBIRVJFOiAnICsgc3RyKHR5cGUob2JqKSkpOw0KICAgICAgICAgICAgcmV0dXJuIG9iajsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZm9yIGkgaW4gb2JqOg0KICAgICAgICAgICAgICAgIG9ialtpXSA9IE5vZGVfR3JvdXAoKS5fZnJvbURvY3VtZW50KG9ialtpXSk7DQogICAgICAgICAgICByZXR1cm4gb2JqOw0KDQoNCiAgICAgICAgaWYgJ0lkJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLklkID0gb2JqWydJZCddOw0KDQogICAgDQogICAgICAgIGlmICdhY3RpdmUnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuYWN0aXZlKG9ialsnYWN0aXZlJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ2VuYWJsZWQnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuZW5hYmxlZChvYmpbJ2VuYWJsZWQnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnY29kZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5jb2RlKG9ialsnY29kZSddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdvcmRlcicgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5vcmRlcihvYmpbJ29yZGVyJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ2RhdGUnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuZGF0ZShvYmpbJ2RhdGUnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnbmFtZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5uYW1lKG9ialsnbmFtZSddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdyZW1hcmsnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYucmVtYXJrKG9ialsncmVtYXJrJ10pOw0KICAgICAgICANCiAgICAgICAgICAgIHNlbGYucmVtYXJrKCBiYXNlNjQuYjY0ZW5jb2RlKHNlbGYucmVtYXJrKCkuZW5jb2RlKCJhc2NpaSIpKS5kZWNvZGUoImFzY2lpIikgKTsNCiAgICAgICAgDQogICAgDQoNCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICByZXR1cm4gc2VsZjsNCiAgICANCiAgICBkZWYgX3RvRG9jdW1lbnQoc2VsZik6DQogICAgICAgIHJldCA9IHt9Ow0KICAgICAgICBpZiBzZWxmLklkIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJJZCJdID0gc2VsZi5JZDsNCg0KICAgIA0KICAgICAgICBpZiBzZWxmLmFjdGl2ZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJhY3RpdmUiXSA9IHNlbGYuYWN0aXZlKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmVuYWJsZWQoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiZW5hYmxlZCJdID0gc2VsZi5lbmFibGVkKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmNvZGUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiY29kZSJdID0gc2VsZi5jb2RlKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLm9yZGVyKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbIm9yZGVyIl0gPSBzZWxmLm9yZGVyKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmRhdGUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiZGF0ZSJdID0gc2VsZi5kYXRlKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLm5hbWUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsibmFtZSJdID0gc2VsZi5uYW1lKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLnJlbWFyaygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IHNlbGYucmVtYXJrKCk7DQogICAgICAgIA0KICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShyZXRbInJlbWFyayJdLCBkaWN0KToNCiAgICAgICAgICAgICAgICByZXRbInJlbWFyayJdID0ganNvbi5kdW1wcyhyZXRbInJlbWFyayJdKTsNCiAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSB1YmluYXNjaWkuYjJhX2Jhc2U2NChyZXRbInJlbWFyayJdKS5zdHJpcCgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgcmV0dXJuIHJldDsNCg0KICAgIA0KICAgIGRlZiBzdG9yZShzZWxmLCBfX2V2ZW50PU5vbmUpOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ05vZGVfR3JvdXA6OnN0b3JlKCk6ICc7DQogICAgICAgIA0KICAgICAgICBldkpTT04gPSBOb25lOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBldkpTT04gPSBqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoNCiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7DQogICAgICAgIA0KDQogICAgICAgIGFuc3dlciA9IE5vbmU7DQoNCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpY2tzX21zKCkpKyddLk5vZGVfR3JvdXAuc3RvcmUoKScpLm1ldGhvZCgnc3RvcmUnKS5jbGFzc05hbWUoJ05vZGVfR3JvdXAnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOw0KICAgICAgICANCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCiAgICAgICAgDQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgYW5zd2VyID0gTm9kZV9Hcm91cCgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQogICAgICAgIA0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCg0KDQoNCiAgICAgICAgaWYgJ05vZGVfR3JvdXBfc3RvcmUnIGluIGRpcigpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICc9PT4gTm9kZV9Hcm91cF9zdG9yZSgpJyk7DQogICAgICAgICAgICBhbnN3ZXIgPSBOb2RlX0dyb3VwX3N0b3JlKHNlbGYsIF9fZXZlbnQsIGFuc3dlciwgX190b1N0cmluZyk7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KDQogICAgICAgICAgICANCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQoNCiAgICAgICAgcmV0dXJuIGFuc3dlcjsNCg0KICAgIA0KICAgIGRlZiBmaW5kQWxsKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6DQogICAgICAgIF9fdG9TdHJpbmcgPSAnTm9kZV9Hcm91cDo6ZmluZEFsbCgpOiAnOw0KICAgICAgICANCiAgICAgICAgZXZKU09OID0gTm9uZTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgZXZKU09OID0ganNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046DQogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOw0KICAgICAgICANCg0KICAgICAgICBhbnN3ZXIgPSBOb25lOw0KDQogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aWNrc19tcygpKSsnXS5Ob2RlX0dyb3VwLmZpbmRBbGwoKScpLm1ldGhvZCgnZmluZEFsbCcpLmNsYXNzTmFtZSgnTm9kZV9Hcm91cCcpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7DQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KICAgICAgICANCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICBhbnN3ZXIgPSBOb2RlX0dyb3VwKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCiAgICAgICAgDQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KDQoNCg0KICAgICAgICBpZiAnTm9kZV9Hcm91cF9maW5kQWxsJyBpbiBkaXIoKToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnPT0+IE5vZGVfR3JvdXBfZmluZEFsbCgpJyk7DQogICAgICAgICAgICBhbnN3ZXIgPSBOb2RlX0dyb3VwX2ZpbmRBbGwoc2VsZiwgX19ldmVudCwgYW5zd2VyLCBfX3RvU3RyaW5nKTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCg0KICAgICAgICByZXR1cm4gYW5zd2VyOw0KDQogICAgDQogICAgZGVmIGZpbmQoc2VsZiwgX19ldmVudD1Ob25lKToNCiAgICAgICAgX190b1N0cmluZyA9ICdOb2RlX0dyb3VwOjpmaW5kKCk6ICc7DQogICAgICAgIA0KICAgICAgICBldkpTT04gPSBOb25lOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBldkpTT04gPSBqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoNCiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7DQogICAgICAgIA0KDQogICAgICAgIGFuc3dlciA9IE5vbmU7DQoNCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpY2tzX21zKCkpKyddLk5vZGVfR3JvdXAuZmluZCgpJykubWV0aG9kKCdmaW5kJykuY2xhc3NOYW1lKCdOb2RlX0dyb3VwJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOw0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsNCiAgICAgICAgDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQogICAgICAgIA0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgIGFuc3dlciA9IE5vZGVfR3JvdXAoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KICAgICAgICANCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQoNCg0KDQogICAgICAgIGlmICdOb2RlX0dyb3VwX2ZpbmQnIGluIGRpcigpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICc9PT4gTm9kZV9Hcm91cF9maW5kKCknKTsNCiAgICAgICAgICAgIGFuc3dlciA9IE5vZGVfR3JvdXBfZmluZChzZWxmLCBfX2V2ZW50LCBhbnN3ZXIsIF9fdG9TdHJpbmcpOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCg0KICAgICAgICAgICAgDQogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KDQogICAgICAgIHJldHVybiBhbnN3ZXI7DQoNCiAgICANCg0KDQpjbGFzcyBOb2RlX1R5cGUoKToNCiAgICBkZWYgX19pbml0X18oc2VsZiwgSWQ9Tm9uZSwgYWN0aXZlPU5vbmUsIGVuYWJsZWQ9Tm9uZSwgY29kZT1Ob25lLCBvcmRlcj1Ob25lLCBkYXRlPU5vbmUsIG5hbWU9Tm9uZSwgcmVtYXJrPU5vbmUsIGR5bmFtaWM9Tm9uZSk6DQogICAgICAgIHN1cGVyKCkuX19pbml0X18oKTsNCg0KICAgICAgICAjcHJpbnQoJ05vZGVfVHlwZTo6X19pbml0X18oKScpOw0KICAgICAgICBpZiBJZCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHNlbGYuSWQgPSBJZDsNCg0KICAgICAgICANCiAgICAgICAgc2VsZi5hY3RpdmUoYWN0aXZlKTsNCiAgICAgICAgc2VsZi5lbmFibGVkKGVuYWJsZWQpOw0KICAgICAgICBzZWxmLmNvZGUoY29kZSk7DQogICAgICAgIHNlbGYub3JkZXIob3JkZXIpOw0KICAgICAgICBzZWxmLmRhdGUoZGF0ZSk7DQogICAgICAgIHNlbGYubmFtZShuYW1lKTsNCiAgICAgICAgc2VsZi5yZW1hcmsocmVtYXJrKTsNCiAgICAgICAgc2VsZi5keW5hbWljKGR5bmFtaWMpOw0KICAgICAgICANCiAgICBJZCA9IE5vbmU7DQogICAgDQogICAgDQogICAgIyBhY3RpdmU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfYWN0aXZlID0gTm9uZTsNCiAgICBkZWYgYWN0aXZlKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2FjdGl2ZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9hY3RpdmU7DQoNCg0KICAgIA0KICAgICMgZW5hYmxlZDogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9lbmFibGVkID0gTm9uZTsNCiAgICBkZWYgZW5hYmxlZChzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9lbmFibGVkID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2VuYWJsZWQ7DQoNCg0KICAgIA0KICAgICMgY29kZTogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9jb2RlID0gTm9uZTsNCiAgICBkZWYgY29kZShzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9jb2RlID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2NvZGU7DQoNCg0KICAgIA0KICAgICMgb3JkZXI6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfb3JkZXIgPSBOb25lOw0KICAgIGRlZiBvcmRlcihzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9vcmRlciA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9vcmRlcjsNCg0KDQogICAgDQogICAgIyBkYXRlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2RhdGUgPSBOb25lOw0KICAgIGRlZiBkYXRlKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2RhdGUgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fZGF0ZTsNCg0KDQogICAgDQogICAgIyBuYW1lOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX25hbWUgPSBOb25lOw0KICAgIGRlZiBuYW1lKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX25hbWUgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fbmFtZTsNCg0KDQogICAgDQogICAgIyByZW1hcms6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfcmVtYXJrID0gTm9uZTsNCiAgICBkZWYgcmVtYXJrKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX3JlbWFyayA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9yZW1hcms7DQoNCg0KICAgIA0KICAgICMgZHluYW1pYzogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9keW5hbWljID0gTm9uZTsNCiAgICBkZWYgZHluYW1pYyhzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9keW5hbWljID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2R5bmFtaWM7DQoNCg0KICAgIA0KICAgIA0KICAgIGRlZiBfZnJvbURvY3VtZW50KHNlbGYsIG9iaik6DQogICAgICAgIF9fdG9TdHJpbmcgPSAnTm9kZV9UeXBlOjpfZnJvbURvY3VtZW50KCk6ICc7DQoNCiAgICAgICAgaWYgb2JqIGlzIE5vbmU6DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgDQogICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLCBieXRlcyk6DQogICAgICAgICAgICBvYmogPSBzdHIob2JqLCAidXRmLTgiKTsNCg0KICAgICAgICBpZiBpc2luc3RhbmNlKG9iaiwgc3RyKSBvciB0eXBlKG9iaikgaXMgc3RyOg0KICAgICAgICAgICAgb2JqID0ganNvbi5sb2FkcyhvYmopOw0KICAgICAgICANCiAgICAgICAgaWYgbm90IGlzaW5zdGFuY2Uob2JqLCAoc3RyLCBieXRlcywgZGljdCkpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICdHT1QgSEVSRTogJyArIHN0cih0eXBlKG9iaikpKTsNCiAgICAgICAgICAgIHJldHVybiBvYmo7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGZvciBpIGluIG9iajoNCiAgICAgICAgICAgICAgICBvYmpbaV0gPSBOb2RlX1R5cGUoKS5fZnJvbURvY3VtZW50KG9ialtpXSk7DQogICAgICAgICAgICByZXR1cm4gb2JqOw0KDQoNCiAgICAgICAgaWYgJ0lkJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLklkID0gb2JqWydJZCddOw0KDQogICAgDQogICAgICAgIGlmICdhY3RpdmUnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuYWN0aXZlKG9ialsnYWN0aXZlJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ2VuYWJsZWQnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuZW5hYmxlZChvYmpbJ2VuYWJsZWQnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnY29kZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5jb2RlKG9ialsnY29kZSddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdvcmRlcicgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5vcmRlcihvYmpbJ29yZGVyJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ2RhdGUnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuZGF0ZShvYmpbJ2RhdGUnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnbmFtZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5uYW1lKG9ialsnbmFtZSddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdyZW1hcmsnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYucmVtYXJrKG9ialsncmVtYXJrJ10pOw0KICAgICAgICANCiAgICAgICAgICAgIHNlbGYucmVtYXJrKCBiYXNlNjQuYjY0ZW5jb2RlKHNlbGYucmVtYXJrKCkuZW5jb2RlKCJhc2NpaSIpKS5kZWNvZGUoImFzY2lpIikgKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdkeW5hbWljJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmR5bmFtaWMob2JqWydkeW5hbWljJ10pOw0KICAgICAgICANCiAgICANCg0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIHJldHVybiBzZWxmOw0KICAgIA0KICAgIGRlZiBfdG9Eb2N1bWVudChzZWxmKToNCiAgICAgICAgcmV0ID0ge307DQogICAgICAgIGlmIHNlbGYuSWQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbIklkIl0gPSBzZWxmLklkOw0KDQogICAgDQogICAgICAgIGlmIHNlbGYuYWN0aXZlKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbImFjdGl2ZSJdID0gc2VsZi5hY3RpdmUoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYuZW5hYmxlZCgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJlbmFibGVkIl0gPSBzZWxmLmVuYWJsZWQoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYuY29kZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJjb2RlIl0gPSBzZWxmLmNvZGUoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYub3JkZXIoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsib3JkZXIiXSA9IHNlbGYub3JkZXIoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYuZGF0ZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJkYXRlIl0gPSBzZWxmLmRhdGUoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYubmFtZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJuYW1lIl0gPSBzZWxmLm5hbWUoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYucmVtYXJrKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbInJlbWFyayJdID0gc2VsZi5yZW1hcmsoKTsNCiAgICAgICAgDQogICAgICAgICAgICBpZiBpc2luc3RhbmNlKHJldFsicmVtYXJrIl0sIGRpY3QpOg0KICAgICAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSBqc29uLmR1bXBzKHJldFsicmVtYXJrIl0pOw0KICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IHViaW5hc2NpaS5iMmFfYmFzZTY0KHJldFsicmVtYXJrIl0pLnN0cmlwKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmR5bmFtaWMoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiZHluYW1pYyJdID0gc2VsZi5keW5hbWljKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICANCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICByZXR1cm4gcmV0Ow0KDQogICAgDQogICAgZGVmIHN0b3JlKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6DQogICAgICAgIF9fdG9TdHJpbmcgPSAnTm9kZV9UeXBlOjpzdG9yZSgpOiAnOw0KICAgICAgICANCiAgICAgICAgZXZKU09OID0gTm9uZTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgZXZKU09OID0ganNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046DQogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOw0KICAgICAgICANCg0KICAgICAgICBhbnN3ZXIgPSBOb25lOw0KDQogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aWNrc19tcygpKSsnXS5Ob2RlX1R5cGUuc3RvcmUoKScpLm1ldGhvZCgnc3RvcmUnKS5jbGFzc05hbWUoJ05vZGVfVHlwZScpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7DQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KICAgICAgICANCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICBhbnN3ZXIgPSBOb2RlX1R5cGUoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KICAgICAgICANCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQoNCg0KDQogICAgICAgIGlmICdOb2RlX1R5cGVfc3RvcmUnIGluIGRpcigpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICc9PT4gTm9kZV9UeXBlX3N0b3JlKCknKTsNCiAgICAgICAgICAgIGFuc3dlciA9IE5vZGVfVHlwZV9zdG9yZShzZWxmLCBfX2V2ZW50LCBhbnN3ZXIsIF9fdG9TdHJpbmcpOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCg0KICAgICAgICAgICAgDQogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KDQogICAgICAgIHJldHVybiBhbnN3ZXI7DQoNCiAgICANCiAgICBkZWYgZmluZEFsbChzZWxmLCBfX2V2ZW50PU5vbmUpOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ05vZGVfVHlwZTo6ZmluZEFsbCgpOiAnOw0KICAgICAgICANCiAgICAgICAgZXZKU09OID0gTm9uZTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgZXZKU09OID0ganNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046DQogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOw0KICAgICAgICANCg0KICAgICAgICBhbnN3ZXIgPSBOb25lOw0KDQogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aWNrc19tcygpKSsnXS5Ob2RlX1R5cGUuZmluZEFsbCgpJykubWV0aG9kKCdmaW5kQWxsJykuY2xhc3NOYW1lKCdOb2RlX1R5cGUnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOw0KICAgICAgICANCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCiAgICAgICAgDQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgYW5zd2VyID0gTm9kZV9UeXBlKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCiAgICAgICAgDQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KDQoNCg0KICAgICAgICBpZiAnTm9kZV9UeXBlX2ZpbmRBbGwnIGluIGRpcigpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICc9PT4gTm9kZV9UeXBlX2ZpbmRBbGwoKScpOw0KICAgICAgICAgICAgYW5zd2VyID0gTm9kZV9UeXBlX2ZpbmRBbGwoc2VsZiwgX19ldmVudCwgYW5zd2VyLCBfX3RvU3RyaW5nKTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCg0KICAgICAgICByZXR1cm4gYW5zd2VyOw0KDQogICAgDQogICAgZGVmIGZpbmQoc2VsZiwgX19ldmVudD1Ob25lKToNCiAgICAgICAgX190b1N0cmluZyA9ICdOb2RlX1R5cGU6OmZpbmQoKTogJzsNCiAgICAgICAgDQogICAgICAgIGV2SlNPTiA9IE5vbmU7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIGV2SlNPTiA9IGpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOg0KICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsNCiAgICAgICAgDQoNCiAgICAgICAgYW5zd2VyID0gTm9uZTsNCg0KICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGlja3NfbXMoKSkrJ10uTm9kZV9UeXBlLmZpbmQoKScpLm1ldGhvZCgnZmluZCcpLmNsYXNzTmFtZSgnTm9kZV9UeXBlJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOw0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsNCiAgICAgICAgDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQogICAgICAgIA0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgIGFuc3dlciA9IE5vZGVfVHlwZSgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQogICAgICAgIA0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCg0KDQoNCiAgICAgICAgaWYgJ05vZGVfVHlwZV9maW5kJyBpbiBkaXIoKToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnPT0+IE5vZGVfVHlwZV9maW5kKCknKTsNCiAgICAgICAgICAgIGFuc3dlciA9IE5vZGVfVHlwZV9maW5kKHNlbGYsIF9fZXZlbnQsIGFuc3dlciwgX190b1N0cmluZyk7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KDQogICAgICAgICAgICANCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQoNCiAgICAgICAgcmV0dXJuIGFuc3dlcjsNCg0KICAgIA0KICAgIGRlZiBkZXBsb3koc2VsZiwgX19ldmVudD1Ob25lKToNCiAgICAgICAgX190b1N0cmluZyA9ICdOb2RlX1R5cGU6OmRlcGxveSgpOiAnOw0KICAgICAgICANCiAgICAgICAgZXZKU09OID0gTm9uZTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgZXZKU09OID0ganNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046DQogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOw0KICAgICAgICANCg0KICAgICAgICBhbnN3ZXIgPSBOb25lOw0KDQogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aWNrc19tcygpKSsnXS5Ob2RlX1R5cGUuZGVwbG95KCknKS5tZXRob2QoJ2RlcGxveScpLmNsYXNzTmFtZSgnTm9kZV9UeXBlJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOw0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsNCiAgICAgICAgDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQogICAgICAgIA0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgIGFuc3dlciA9IGV2SlNPTjsNCiAgICAgICAgDQogICAgICAgIAoJCQkKICAgICAgICAgICAgDQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KDQoNCg0KICAgICAgICBpZiAnTm9kZV9UeXBlX2RlcGxveScgaW4gZGlyKCk6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJz09PiBOb2RlX1R5cGVfZGVwbG95KCknKTsNCiAgICAgICAgICAgIGFuc3dlciA9IE5vZGVfVHlwZV9kZXBsb3koc2VsZiwgX19ldmVudCwgYW5zd2VyLCBfX3RvU3RyaW5nKTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChzdHIoYW5zd2VyKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCg0KICAgICAgICByZXR1cm4gYW5zd2VyOw0KDQogICAgDQoNCg0KY2xhc3MgTWFwcGluZygpOg0KICAgIGRlZiBfX2luaXRfXyhzZWxmLCBJZD1Ob25lLCBhY3RpdmU9Tm9uZSwgZW5hYmxlZD1Ob25lLCBvcmRlcj1Ob25lLCBjbGFzc05hbWU9Tm9uZSwgc2NvcGU9Tm9uZSwgY29udGV4dD1Ob25lLCBzb3VyY2U9Tm9uZSwgdGFyZ2V0PU5vbmUsIG9wZXJhdG9yPU5vbmUsIGluU2NyaXB0PU5vbmUsIG91dFNjcmlwdD1Ob25lLCB0b29sPU5vbmUsIGdyb3VwPU5vbmUsIHR5cGU9Tm9uZSk6DQogICAgICAgIHN1cGVyKCkuX19pbml0X18oKTsNCg0KICAgICAgICAjcHJpbnQoJ01hcHBpbmc6Ol9faW5pdF9fKCknKTsNCiAgICAgICAgaWYgSWQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBzZWxmLklkID0gSWQ7DQoNCiAgICAgICAgDQogICAgICAgIHNlbGYuYWN0aXZlKGFjdGl2ZSk7DQogICAgICAgIHNlbGYuZW5hYmxlZChlbmFibGVkKTsNCiAgICAgICAgc2VsZi5vcmRlcihvcmRlcik7DQogICAgICAgIHNlbGYuY2xhc3NOYW1lKGNsYXNzTmFtZSk7DQogICAgICAgIHNlbGYuc2NvcGUoc2NvcGUpOw0KICAgICAgICBzZWxmLmNvbnRleHQoY29udGV4dCk7DQogICAgICAgIHNlbGYuc291cmNlKHNvdXJjZSk7DQogICAgICAgIHNlbGYudGFyZ2V0KHRhcmdldCk7DQogICAgICAgIHNlbGYub3BlcmF0b3Iob3BlcmF0b3IpOw0KICAgICAgICBzZWxmLmluU2NyaXB0KGluU2NyaXB0KTsNCiAgICAgICAgc2VsZi5vdXRTY3JpcHQob3V0U2NyaXB0KTsNCiAgICAgICAgc2VsZi50b29sKHRvb2wpOw0KICAgICAgICBzZWxmLmdyb3VwKGdyb3VwKTsNCiAgICAgICAgc2VsZi50eXBlKHR5cGUpOw0KICAgICAgICANCiAgICBJZCA9IE5vbmU7DQogICAgDQogICAgDQogICAgIyBhY3RpdmU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfYWN0aXZlID0gTm9uZTsNCiAgICBkZWYgYWN0aXZlKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2FjdGl2ZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9hY3RpdmU7DQoNCg0KICAgIA0KICAgICMgZW5hYmxlZDogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9lbmFibGVkID0gTm9uZTsNCiAgICBkZWYgZW5hYmxlZChzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9lbmFibGVkID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2VuYWJsZWQ7DQoNCg0KICAgIA0KICAgICMgb3JkZXI6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfb3JkZXIgPSBOb25lOw0KICAgIGRlZiBvcmRlcihzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9vcmRlciA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9vcmRlcjsNCg0KDQogICAgDQogICAgIyBjbGFzc05hbWU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfY2xhc3NOYW1lID0gTm9uZTsNCiAgICBkZWYgY2xhc3NOYW1lKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2NsYXNzTmFtZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9jbGFzc05hbWU7DQoNCg0KICAgIA0KICAgICMgc2NvcGU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfc2NvcGUgPSBOb25lOw0KICAgIGRlZiBzY29wZShzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9zY29wZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9zY29wZTsNCg0KDQogICAgDQogICAgIyBjb250ZXh0OiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2NvbnRleHQgPSBOb25lOw0KICAgIGRlZiBjb250ZXh0KHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2NvbnRleHQgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fY29udGV4dDsNCg0KDQogICAgDQogICAgIyBzb3VyY2U6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfc291cmNlID0gTm9uZTsNCiAgICBkZWYgc291cmNlKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX3NvdXJjZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9zb3VyY2U7DQoNCg0KICAgIA0KICAgICMgdGFyZ2V0OiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX3RhcmdldCA9IE5vbmU7DQogICAgZGVmIHRhcmdldChzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl90YXJnZXQgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fdGFyZ2V0Ow0KDQoNCiAgICANCiAgICAjIG9wZXJhdG9yOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX29wZXJhdG9yID0gTm9uZTsNCiAgICBkZWYgb3BlcmF0b3Ioc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fb3BlcmF0b3IgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fb3BlcmF0b3I7DQoNCg0KICAgIA0KICAgICMgaW5TY3JpcHQ6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfaW5TY3JpcHQgPSBOb25lOw0KICAgIGRlZiBpblNjcmlwdChzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9pblNjcmlwdCA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9pblNjcmlwdDsNCg0KDQogICAgDQogICAgIyBvdXRTY3JpcHQ6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfb3V0U2NyaXB0ID0gTm9uZTsNCiAgICBkZWYgb3V0U2NyaXB0KHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX291dFNjcmlwdCA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9vdXRTY3JpcHQ7DQoNCg0KICAgIA0KICAgICMgdG9vbDogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF90b29sID0gTm9uZTsNCiAgICBkZWYgdG9vbChzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl90b29sID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3Rvb2w7DQoNCg0KICAgIA0KICAgICMgZ3JvdXA6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfZ3JvdXAgPSBOb25lOw0KICAgIGRlZiBncm91cChzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9ncm91cCA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9ncm91cDsNCg0KDQogICAgDQogICAgIyB0eXBlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX3R5cGUgPSBOb25lOw0KICAgIGRlZiB0eXBlKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX3R5cGUgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fdHlwZTsNCg0KDQogICAgDQogICAgDQogICAgZGVmIF9mcm9tRG9jdW1lbnQoc2VsZiwgb2JqKToNCiAgICAgICAgX190b1N0cmluZyA9ICdNYXBwaW5nOjpfZnJvbURvY3VtZW50KCk6ICc7DQoNCiAgICAgICAgaWYgb2JqIGlzIE5vbmU6DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgDQogICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLCBieXRlcyk6DQogICAgICAgICAgICBvYmogPSBzdHIob2JqLCAidXRmLTgiKTsNCg0KICAgICAgICBpZiBpc2luc3RhbmNlKG9iaiwgc3RyKSBvciB0eXBlKG9iaikgaXMgc3RyOg0KICAgICAgICAgICAgb2JqID0ganNvbi5sb2FkcyhvYmopOw0KICAgICAgICANCiAgICAgICAgaWYgbm90IGlzaW5zdGFuY2Uob2JqLCAoc3RyLCBieXRlcywgZGljdCkpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICdHT1QgSEVSRTogJyArIHN0cih0eXBlKG9iaikpKTsNCiAgICAgICAgICAgIHJldHVybiBvYmo7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGZvciBpIGluIG9iajoNCiAgICAgICAgICAgICAgICBvYmpbaV0gPSBNYXBwaW5nKCkuX2Zyb21Eb2N1bWVudChvYmpbaV0pOw0KICAgICAgICAgICAgcmV0dXJuIG9iajsNCg0KDQogICAgICAgIGlmICdJZCcgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5JZCA9IG9ialsnSWQnXTsNCg0KICAgIA0KICAgICAgICBpZiAnYWN0aXZlJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmFjdGl2ZShvYmpbJ2FjdGl2ZSddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdlbmFibGVkJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmVuYWJsZWQob2JqWydlbmFibGVkJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ29yZGVyJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLm9yZGVyKG9ialsnb3JkZXInXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnY2xhc3NOYW1lJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmNsYXNzTmFtZShvYmpbJ2NsYXNzTmFtZSddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdzY29wZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5zY29wZShvYmpbJ3Njb3BlJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ2NvbnRleHQnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuY29udGV4dChvYmpbJ2NvbnRleHQnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnc291cmNlJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLnNvdXJjZShvYmpbJ3NvdXJjZSddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICd0YXJnZXQnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYudGFyZ2V0KG9ialsndGFyZ2V0J10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ29wZXJhdG9yJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLm9wZXJhdG9yKG9ialsnb3BlcmF0b3InXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnaW5TY3JpcHQnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuaW5TY3JpcHQob2JqWydpblNjcmlwdCddKTsNCiAgICAgICAgDQogICAgICAgICAgICBzZWxmLmluU2NyaXB0KCBiYXNlNjQuYjY0ZW5jb2RlKHNlbGYuaW5TY3JpcHQoKS5lbmNvZGUoImFzY2lpIikpLmRlY29kZSgiYXNjaWkiKSApOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ291dFNjcmlwdCcgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5vdXRTY3JpcHQob2JqWydvdXRTY3JpcHQnXSk7DQogICAgICAgIA0KICAgICAgICAgICAgc2VsZi5vdXRTY3JpcHQoIGJhc2U2NC5iNjRlbmNvZGUoc2VsZi5vdXRTY3JpcHQoKS5lbmNvZGUoImFzY2lpIikpLmRlY29kZSgiYXNjaWkiKSApOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ3Rvb2wnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYudG9vbChUb29sKCkuX2Zyb21Eb2N1bWVudChvYmpbJ3Rvb2wnXSkpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ2dyb3VwJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmdyb3VwKENvbmZpZ19Hcm91cCgpLl9mcm9tRG9jdW1lbnQob2JqWydncm91cCddKSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAndHlwZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi50eXBlKFRvb2xfVHlwZSgpLl9mcm9tRG9jdW1lbnQob2JqWyd0eXBlJ10pKTsNCiAgICAgICAgDQogICAgDQoNCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICByZXR1cm4gc2VsZjsNCiAgICANCiAgICBkZWYgX3RvRG9jdW1lbnQoc2VsZik6DQogICAgICAgIHJldCA9IHt9Ow0KICAgICAgICBpZiBzZWxmLklkIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJJZCJdID0gc2VsZi5JZDsNCg0KICAgIA0KICAgICAgICBpZiBzZWxmLmFjdGl2ZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJhY3RpdmUiXSA9IHNlbGYuYWN0aXZlKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmVuYWJsZWQoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiZW5hYmxlZCJdID0gc2VsZi5lbmFibGVkKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLm9yZGVyKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbIm9yZGVyIl0gPSBzZWxmLm9yZGVyKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmNsYXNzTmFtZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJjbGFzc05hbWUiXSA9IHNlbGYuY2xhc3NOYW1lKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLnNjb3BlKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbInNjb3BlIl0gPSBzZWxmLnNjb3BlKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmNvbnRleHQoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiY29udGV4dCJdID0gc2VsZi5jb250ZXh0KCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLnNvdXJjZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJzb3VyY2UiXSA9IHNlbGYuc291cmNlKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLnRhcmdldCgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJ0YXJnZXQiXSA9IHNlbGYudGFyZ2V0KCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLm9wZXJhdG9yKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbIm9wZXJhdG9yIl0gPSBzZWxmLm9wZXJhdG9yKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmluU2NyaXB0KCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbImluU2NyaXB0Il0gPSBzZWxmLmluU2NyaXB0KCk7DQogICAgICAgIA0KICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShyZXRbImluU2NyaXB0Il0sIGRpY3QpOg0KICAgICAgICAgICAgICAgIHJldFsiaW5TY3JpcHQiXSA9IGpzb24uZHVtcHMocmV0WyJpblNjcmlwdCJdKTsNCiAgICAgICAgICAgIHJldFsiaW5TY3JpcHQiXSA9IHViaW5hc2NpaS5iMmFfYmFzZTY0KHJldFsiaW5TY3JpcHQiXSkuc3RyaXAoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYub3V0U2NyaXB0KCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbIm91dFNjcmlwdCJdID0gc2VsZi5vdXRTY3JpcHQoKTsNCiAgICAgICAgDQogICAgICAgICAgICBpZiBpc2luc3RhbmNlKHJldFsib3V0U2NyaXB0Il0sIGRpY3QpOg0KICAgICAgICAgICAgICAgIHJldFsib3V0U2NyaXB0Il0gPSBqc29uLmR1bXBzKHJldFsib3V0U2NyaXB0Il0pOw0KICAgICAgICAgICAgcmV0WyJvdXRTY3JpcHQiXSA9IHViaW5hc2NpaS5iMmFfYmFzZTY0KHJldFsib3V0U2NyaXB0Il0pLnN0cmlwKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLnRvb2woKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsidG9vbCJdID0gc2VsZi50b29sKCkuX3RvRG9jdW1lbnQoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYuZ3JvdXAoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiZ3JvdXAiXSA9IHNlbGYuZ3JvdXAoKS5fdG9Eb2N1bWVudCgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi50eXBlKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbInR5cGUiXSA9IHNlbGYudHlwZSgpLl90b0RvY3VtZW50KCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICANCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICByZXR1cm4gcmV0Ow0KDQogICAgDQogICAgZGVmIHN0b3JlKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6DQogICAgICAgIF9fdG9TdHJpbmcgPSAnTWFwcGluZzo6c3RvcmUoKTogJzsNCiAgICAgICAgDQogICAgICAgIGV2SlNPTiA9IE5vbmU7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIGV2SlNPTiA9IGpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOg0KICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsNCiAgICAgICAgDQoNCiAgICAgICAgYW5zd2VyID0gTm9uZTsNCg0KICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGlja3NfbXMoKSkrJ10uTWFwcGluZy5zdG9yZSgpJykubWV0aG9kKCdzdG9yZScpLmNsYXNzTmFtZSgnTWFwcGluZycpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7DQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KICAgICAgICANCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICBhbnN3ZXIgPSBNYXBwaW5nKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCiAgICAgICAgDQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KDQoNCg0KICAgICAgICBpZiAnTWFwcGluZ19zdG9yZScgaW4gZGlyKCk6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJz09PiBNYXBwaW5nX3N0b3JlKCknKTsNCiAgICAgICAgICAgIGFuc3dlciA9IE1hcHBpbmdfc3RvcmUoc2VsZiwgX19ldmVudCwgYW5zd2VyLCBfX3RvU3RyaW5nKTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCg0KICAgICAgICByZXR1cm4gYW5zd2VyOw0KDQogICAgDQogICAgZGVmIGZpbmRBbGwoc2VsZiwgX19ldmVudD1Ob25lKToNCiAgICAgICAgX190b1N0cmluZyA9ICdNYXBwaW5nOjpmaW5kQWxsKCk6ICc7DQogICAgICAgIA0KICAgICAgICBldkpTT04gPSBOb25lOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBldkpTT04gPSBqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoNCiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7DQogICAgICAgIA0KDQogICAgICAgIGFuc3dlciA9IE5vbmU7DQoNCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpY2tzX21zKCkpKyddLk1hcHBpbmcuZmluZEFsbCgpJykubWV0aG9kKCdmaW5kQWxsJykuY2xhc3NOYW1lKCdNYXBwaW5nJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOw0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsNCiAgICAgICAgDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQogICAgICAgIA0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgIGFuc3dlciA9IE1hcHBpbmcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KICAgICAgICANCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQoNCg0KDQogICAgICAgIGlmICdNYXBwaW5nX2ZpbmRBbGwnIGluIGRpcigpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICc9PT4gTWFwcGluZ19maW5kQWxsKCknKTsNCiAgICAgICAgICAgIGFuc3dlciA9IE1hcHBpbmdfZmluZEFsbChzZWxmLCBfX2V2ZW50LCBhbnN3ZXIsIF9fdG9TdHJpbmcpOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCg0KICAgICAgICAgICAgDQogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KDQogICAgICAgIHJldHVybiBhbnN3ZXI7DQoNCiAgICANCiAgICBkZWYgZmluZChzZWxmLCBfX2V2ZW50PU5vbmUpOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ01hcHBpbmc6OmZpbmQoKTogJzsNCiAgICAgICAgDQogICAgICAgIGV2SlNPTiA9IE5vbmU7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIGV2SlNPTiA9IGpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOg0KICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsNCiAgICAgICAgDQoNCiAgICAgICAgYW5zd2VyID0gTm9uZTsNCg0KICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGlja3NfbXMoKSkrJ10uTWFwcGluZy5maW5kKCknKS5tZXRob2QoJ2ZpbmQnKS5jbGFzc05hbWUoJ01hcHBpbmcnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOw0KICAgICAgICANCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCiAgICAgICAgDQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgYW5zd2VyID0gTWFwcGluZygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQogICAgICAgIA0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCg0KDQoNCiAgICAgICAgaWYgJ01hcHBpbmdfZmluZCcgaW4gZGlyKCk6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJz09PiBNYXBwaW5nX2ZpbmQoKScpOw0KICAgICAgICAgICAgYW5zd2VyID0gTWFwcGluZ19maW5kKHNlbGYsIF9fZXZlbnQsIGFuc3dlciwgX190b1N0cmluZyk7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KDQogICAgICAgICAgICANCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQoNCiAgICAgICAgcmV0dXJuIGFuc3dlcjsNCg0KICAgIA0KDQoNCg0KDQoNCiAgICANCm5jb2RlID0gImFwaXNlcnZlci9lc3B0ZXN0L3B5Y2xpZW50IjsNCiAgICANCg0Kbm9kZSA9IE5vZGUoY29kZT1uY29kZSwgcGFyZW50PU5vZGUoY29kZT0nYXBpc2VydmVyL2VzcHRlc3QvbWFzdGVyJykpOw0KDQoNCiMjIyMjIyMjIyMjIE1RVFQgQ29ubmVjdGlvbiAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIw0KcHJpbnQoJ21haW4oKScsICJDb25uZWN0aW5nIHRvIE1RVFQgc2VydmVyIiwgIi4uLiAiLCBlbmQ9IiIpOw0KbXF0dF90b3BpYyA9ICdhcGlzZXJ2ZXIvZXNwdGVzdCc7DQoNCm1xdHRfY2xpZW50ID0gcGFoby5tcXR0LmNsaWVudC5DbGllbnQoY2FsbGJhY2tfYXBpX3ZlcnNpb249cGFoby5tcXR0LmNsaWVudC5DYWxsYmFja0FQSVZlcnNpb24uVkVSU0lPTjIsIGNsaWVudF9pZD1tcXR0X3RvcGljKycvJytub2RlLmNvZGUoKSwgdHJhbnNwb3J0PSd0Y3AnKTsNCg0KbXF0dF9jbGllbnQub25fbWVzc2FnZSA9IGxhbWJkYSBjbGllbnQsIHVzZXJkYXRhLCBvTXNnIDogRXZlbnQoKS5fZnJvbURvY3VtZW50KG9Nc2cucGF5bG9hZCkucHJvY2VzcygpOw0KbXF0dF9jbGllbnQuY29ubmVjdCgndGVzdC5tb3NxdWl0dG8ub3JnJyk7DQoNCg0KbXF0dF9jbGllbnQuc3Vic2NyaWJlKG1xdHRfdG9waWMpOw0KcHJpbnQoIkNvbm5lY3RlZCEiKTsNCiMjIyMjIyMjIyMjIE1RVFQgQ29ubmVjdGlvbiAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIw0KDQoNCg0KIyMjIyMjIyMjIyMgTWV0aG9kIFRyaWdnZXJzICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjDQoNCiMjIyMjIyMjIyMjIE1ldGhvZCBUcmlnZ2VycyAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIw0KDQpub2RlLnN0b3JlKCk7DQoNCnByaW50KCdtYWluKCknLCAnbG9vcGluZyBmb3IgbXF0dCBldmVudHMnKTsNCndoaWxlIFRydWU6DQogICAgbXF0dF9jbGllbnQud2FpdF9tc2coKTsNCiAgICB0aW1lLnNsZWVwKDEpOw0KDQo=",
	"__keys": ["name"],
	"__trMap": []
}