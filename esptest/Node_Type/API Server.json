{
	"Id": "3ef0571b4f0c8eb79bf50c3b15968dfe070df612",
	"active": "true",
	"enabled": "true",
	"code": "apiserver",
	"date": "Mon Sep 30 2024 22:27:33 GMT+0300 (Eastern European Summer Time)",
	"name": "API Server",
	"remark": "IyBpbXBvcnQgdXJsbGliLnJlcXVlc3QsIGpzb24sIGJhc2U2NDsNCiMgZXhlYyhiYXNlNjQuYjY0ZGVjb2RlKGpzb24ubG9hZCh1cmxsaWIucmVxdWVzdC51cmxvcGVuKCJodHRwczovL2Fyemhvc3BpdGFsLmdpdGh1Yi5pby9lc3B0ZXN0L05vZGVfVHlwZS9BUEkrU2VydmVyLmpzb24iKSlbInJlbWFyayJdKSk7DQoNCmltcG9ydCBwYWhvLm1xdHQuY2xpZW50LGpzb24semxpYix0aW1lLGdjLGlvOw0KDQoNCmNsYXNzIFVzZXIoKToNCiAgICBkZWYgX19pbml0X18oc2VsZiwgSWQ9Tm9uZSwgYWN0aXZlPU5vbmUsIGVuYWJsZWQ9Tm9uZSwgY29kZT1Ob25lLCBvcmRlcj1Ob25lLCBkYXRlPU5vbmUsIG5hbWU9Tm9uZSwgcmVtYXJrPU5vbmUsIHVzZXJuYW1lPU5vbmUsIHBhc3N3b3JkPU5vbmUpOg0KICAgICAgICBzdXBlcigpLl9faW5pdF9fKCk7DQoNCiAgICAgICAgI3ByaW50KCdVc2VyOjpfX2luaXRfXygpJyk7DQogICAgICAgIGlmIElkIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgc2VsZi5JZCA9IElkOw0KDQogICAgICAgIA0KICAgICAgICBzZWxmLmFjdGl2ZShhY3RpdmUpOw0KICAgICAgICBzZWxmLmVuYWJsZWQoZW5hYmxlZCk7DQogICAgICAgIHNlbGYuY29kZShjb2RlKTsNCiAgICAgICAgc2VsZi5vcmRlcihvcmRlcik7DQogICAgICAgIHNlbGYuZGF0ZShkYXRlKTsNCiAgICAgICAgc2VsZi5uYW1lKG5hbWUpOw0KICAgICAgICBzZWxmLnJlbWFyayhyZW1hcmspOw0KICAgICAgICBzZWxmLnVzZXJuYW1lKHVzZXJuYW1lKTsNCiAgICAgICAgc2VsZi5wYXNzd29yZChwYXNzd29yZCk7DQogICAgICAgIA0KICAgIElkID0gTm9uZTsNCiAgICANCiAgICANCiAgICAjIGFjdGl2ZTogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9hY3RpdmUgPSBOb25lOw0KICAgIGRlZiBhY3RpdmUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fYWN0aXZlID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2FjdGl2ZTsNCg0KDQogICAgDQogICAgIyBlbmFibGVkOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2VuYWJsZWQgPSBOb25lOw0KICAgIGRlZiBlbmFibGVkKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2VuYWJsZWQgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fZW5hYmxlZDsNCg0KDQogICAgDQogICAgIyBjb2RlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2NvZGUgPSBOb25lOw0KICAgIGRlZiBjb2RlKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2NvZGUgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fY29kZTsNCg0KDQogICAgDQogICAgIyBvcmRlcjogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9vcmRlciA9IE5vbmU7DQogICAgZGVmIG9yZGVyKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX29yZGVyID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX29yZGVyOw0KDQoNCiAgICANCiAgICAjIGRhdGU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfZGF0ZSA9IE5vbmU7DQogICAgZGVmIGRhdGUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fZGF0ZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9kYXRlOw0KDQoNCiAgICANCiAgICAjIG5hbWU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfbmFtZSA9IE5vbmU7DQogICAgZGVmIG5hbWUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fbmFtZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9uYW1lOw0KDQoNCiAgICANCiAgICAjIHJlbWFyazogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9yZW1hcmsgPSBOb25lOw0KICAgIGRlZiByZW1hcmsoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fcmVtYXJrID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3JlbWFyazsNCg0KDQogICAgDQogICAgIyB1c2VybmFtZTogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF91c2VybmFtZSA9IE5vbmU7DQogICAgZGVmIHVzZXJuYW1lKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX3VzZXJuYW1lID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3VzZXJuYW1lOw0KDQoNCiAgICANCiAgICAjIHBhc3N3b3JkOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX3Bhc3N3b3JkID0gTm9uZTsNCiAgICBkZWYgcGFzc3dvcmQoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fcGFzc3dvcmQgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fcGFzc3dvcmQ7DQoNCg0KICAgIA0KICAgIA0KICAgIGRlZiBfZnJvbURvY3VtZW50KHNlbGYsIG9iaik6DQogICAgICAgIF9fdG9TdHJpbmcgPSAnVXNlcjo6X2Zyb21Eb2N1bWVudCgpOiAnOw0KDQogICAgICAgIGlmIG9iaiBpcyBOb25lOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIA0KICAgICAgICBpZiBpc2luc3RhbmNlKG9iaiwgYnl0ZXMpOg0KICAgICAgICAgICAgb2JqID0gc3RyKG9iaiwgInV0Zi04Iik7DQoNCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIHN0cikgb3IgdHlwZShvYmopIGlzIHN0cjoNCiAgICAgICAgICAgIG9iaiA9IGpzb24ubG9hZHMob2JqKTsNCiAgICAgICAgDQogICAgICAgIGlmIG5vdCBpc2luc3RhbmNlKG9iaiwgKHN0ciwgYnl0ZXMsIGRpY3QpKToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnR09UIEhFUkU6ICcgKyBzdHIodHlwZShvYmopKSk7DQogICAgICAgICAgICByZXR1cm4gb2JqOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBmb3IgaSBpbiBvYmo6DQogICAgICAgICAgICAgICAgb2JqW2ldID0gVXNlcigpLl9mcm9tRG9jdW1lbnQob2JqW2ldKTsNCiAgICAgICAgICAgIHJldHVybiBvYmo7DQoNCg0KICAgICAgICBpZiAnSWQnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuSWQgPSBvYmpbJ0lkJ107DQoNCiAgICANCiAgICAgICAgaWYgJ2FjdGl2ZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5hY3RpdmUob2JqWydhY3RpdmUnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnZW5hYmxlZCcgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5lbmFibGVkKG9ialsnZW5hYmxlZCddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdjb2RlJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmNvZGUob2JqWydjb2RlJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ29yZGVyJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLm9yZGVyKG9ialsnb3JkZXInXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnZGF0ZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5kYXRlKG9ialsnZGF0ZSddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICduYW1lJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLm5hbWUob2JqWyduYW1lJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ3JlbWFyaycgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5yZW1hcmsob2JqWydyZW1hcmsnXSk7DQogICAgICAgIA0KICAgICAgICAgICAgc2VsZi5yZW1hcmsoIGJhc2U2NC5iNjRlbmNvZGUoc2VsZi5yZW1hcmsoKS5lbmNvZGUoImFzY2lpIikpLmRlY29kZSgiYXNjaWkiKSApOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ3VzZXJuYW1lJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLnVzZXJuYW1lKG9ialsndXNlcm5hbWUnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAncGFzc3dvcmQnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYucGFzc3dvcmQob2JqWydwYXNzd29yZCddKTsNCiAgICAgICAgDQogICAgDQoNCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICByZXR1cm4gc2VsZjsNCiAgICANCiAgICBkZWYgX3RvRG9jdW1lbnQoc2VsZik6DQogICAgICAgIHJldCA9IHt9Ow0KICAgICAgICBpZiBzZWxmLklkIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJJZCJdID0gc2VsZi5JZDsNCg0KICAgIA0KICAgICAgICBpZiBzZWxmLmFjdGl2ZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJhY3RpdmUiXSA9IHNlbGYuYWN0aXZlKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmVuYWJsZWQoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiZW5hYmxlZCJdID0gc2VsZi5lbmFibGVkKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmNvZGUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiY29kZSJdID0gc2VsZi5jb2RlKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLm9yZGVyKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbIm9yZGVyIl0gPSBzZWxmLm9yZGVyKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmRhdGUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiZGF0ZSJdID0gc2VsZi5kYXRlKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLm5hbWUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsibmFtZSJdID0gc2VsZi5uYW1lKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLnJlbWFyaygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IHNlbGYucmVtYXJrKCk7DQogICAgICAgIA0KICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShyZXRbInJlbWFyayJdLCBkaWN0KToNCiAgICAgICAgICAgICAgICByZXRbInJlbWFyayJdID0ganNvbi5kdW1wcyhyZXRbInJlbWFyayJdKTsNCiAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSB1YmluYXNjaWkuYjJhX2Jhc2U2NChyZXRbInJlbWFyayJdKS5zdHJpcCgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi51c2VybmFtZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJ1c2VybmFtZSJdID0gc2VsZi51c2VybmFtZSgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5wYXNzd29yZCgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJwYXNzd29yZCJdID0gc2VsZi5wYXNzd29yZCgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgcmV0dXJuIHJldDsNCg0KICAgIA0KICAgIGRlZiBzdG9yZShzZWxmLCBfX2V2ZW50PU5vbmUpOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ1VzZXI6OnN0b3JlKCk6ICc7DQogICAgICAgIA0KICAgICAgICBldkpTT04gPSBOb25lOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBldkpTT04gPSBqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoNCiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7DQogICAgICAgIA0KDQogICAgICAgIGFuc3dlciA9IE5vbmU7DQoNCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpbWUudGltZSgpKSsnXS5Vc2VyLnN0b3JlKCknKS5tZXRob2QoJ3N0b3JlJykuY2xhc3NOYW1lKCdVc2VyJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOw0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsNCiAgICAgICAgDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQogICAgICAgIA0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgIGFuc3dlciA9IFVzZXIoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KICAgICAgICANCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQoNCg0KDQogICAgICAgIGlmICdVc2VyX3N0b3JlJyBpbiBkaXIoKToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnPT0+IFVzZXJfc3RvcmUoKScpOw0KICAgICAgICAgICAgYW5zd2VyID0gVXNlcl9zdG9yZShzZWxmLCBfX2V2ZW50LCBhbnN3ZXIsIF9fdG9TdHJpbmcpOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCg0KICAgICAgICAgICAgDQogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KDQogICAgICAgIHJldHVybiBhbnN3ZXI7DQoNCiAgICANCiAgICBkZWYgZmluZEFsbChzZWxmLCBfX2V2ZW50PU5vbmUpOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ1VzZXI6OmZpbmRBbGwoKTogJzsNCiAgICAgICAgDQogICAgICAgIGV2SlNPTiA9IE5vbmU7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIGV2SlNPTiA9IGpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOg0KICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsNCiAgICAgICAgDQoNCiAgICAgICAgYW5zd2VyID0gTm9uZTsNCg0KICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGltZS50aW1lKCkpKyddLlVzZXIuZmluZEFsbCgpJykubWV0aG9kKCdmaW5kQWxsJykuY2xhc3NOYW1lKCdVc2VyJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOw0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsNCiAgICAgICAgDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQogICAgICAgIA0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgIGFuc3dlciA9IFVzZXIoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KICAgICAgICANCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQoNCg0KDQogICAgICAgIGlmICdVc2VyX2ZpbmRBbGwnIGluIGRpcigpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICc9PT4gVXNlcl9maW5kQWxsKCknKTsNCiAgICAgICAgICAgIGFuc3dlciA9IFVzZXJfZmluZEFsbChzZWxmLCBfX2V2ZW50LCBhbnN3ZXIsIF9fdG9TdHJpbmcpOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCg0KICAgICAgICAgICAgDQogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KDQogICAgICAgIHJldHVybiBhbnN3ZXI7DQoNCiAgICANCiAgICBkZWYgZmluZChzZWxmLCBfX2V2ZW50PU5vbmUpOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ1VzZXI6OmZpbmQoKTogJzsNCiAgICAgICAgDQogICAgICAgIGV2SlNPTiA9IE5vbmU7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIGV2SlNPTiA9IGpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOg0KICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsNCiAgICAgICAgDQoNCiAgICAgICAgYW5zd2VyID0gTm9uZTsNCg0KICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGltZS50aW1lKCkpKyddLlVzZXIuZmluZCgpJykubWV0aG9kKCdmaW5kJykuY2xhc3NOYW1lKCdVc2VyJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOw0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsNCiAgICAgICAgDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQogICAgICAgIA0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgIGFuc3dlciA9IFVzZXIoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KICAgICAgICANCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQoNCg0KDQogICAgICAgIGlmICdVc2VyX2ZpbmQnIGluIGRpcigpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICc9PT4gVXNlcl9maW5kKCknKTsNCiAgICAgICAgICAgIGFuc3dlciA9IFVzZXJfZmluZChzZWxmLCBfX2V2ZW50LCBhbnN3ZXIsIF9fdG9TdHJpbmcpOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCg0KICAgICAgICAgICAgDQogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KDQogICAgICAgIHJldHVybiBhbnN3ZXI7DQoNCiAgICANCiAgICBkZWYgaW5pdChzZWxmLCBfX2V2ZW50PU5vbmUpOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ1VzZXI6OmluaXQoKTogJzsNCiAgICAgICAgDQogICAgICAgIGV2SlNPTiA9IE5vbmU7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIGV2SlNPTiA9IGpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOg0KICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsNCiAgICAgICAgDQoNCiAgICAgICAgYW5zd2VyID0gTm9uZTsNCg0KICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGltZS50aW1lKCkpKyddLlVzZXIuaW5pdCgpJykubWV0aG9kKCdpbml0JykuY2xhc3NOYW1lKCdVc2VyJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOw0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsNCiAgICAgICAgDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQogICAgICAgIA0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgIGFuc3dlciA9IGV2SlNPTjsNCiAgICAgICAgDQogICAgICAgIA0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCg0KDQoNCiAgICAgICAgaWYgJ1VzZXJfaW5pdCcgaW4gZGlyKCk6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJz09PiBVc2VyX2luaXQoKScpOw0KICAgICAgICAgICAgYW5zd2VyID0gVXNlcl9pbml0KHNlbGYsIF9fZXZlbnQsIGFuc3dlciwgX190b1N0cmluZyk7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoc3RyKGFuc3dlcikpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KDQogICAgICAgICAgICANCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQoNCiAgICAgICAgcmV0dXJuIGFuc3dlcjsNCg0KICAgIA0KDQoNCmNsYXNzIEFjdGlvbl9FeGVjdXRpb24oKToNCiAgICBkZWYgX19pbml0X18oc2VsZiwgSWQ9Tm9uZSwgYWN0aXZlPU5vbmUsIGVuYWJsZWQ9Tm9uZSwgY29kZT1Ob25lLCBvcmRlcj1Ob25lLCBkYXRlPU5vbmUsIG5hbWU9Tm9uZSwgcmVtYXJrPU5vbmUsIGRldmljZT1Ob25lLCBhY3Rpb249Tm9uZSwgcmVzdWx0PU5vbmUsIGNvbXBsZXRlZD1Ob25lKToNCiAgICAgICAgc3VwZXIoKS5fX2luaXRfXygpOw0KDQogICAgICAgICNwcmludCgnQWN0aW9uX0V4ZWN1dGlvbjo6X19pbml0X18oKScpOw0KICAgICAgICBpZiBJZCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHNlbGYuSWQgPSBJZDsNCg0KICAgICAgICANCiAgICAgICAgc2VsZi5hY3RpdmUoYWN0aXZlKTsNCiAgICAgICAgc2VsZi5lbmFibGVkKGVuYWJsZWQpOw0KICAgICAgICBzZWxmLmNvZGUoY29kZSk7DQogICAgICAgIHNlbGYub3JkZXIob3JkZXIpOw0KICAgICAgICBzZWxmLmRhdGUoZGF0ZSk7DQogICAgICAgIHNlbGYubmFtZShuYW1lKTsNCiAgICAgICAgc2VsZi5yZW1hcmsocmVtYXJrKTsNCiAgICAgICAgc2VsZi5kZXZpY2UoZGV2aWNlKTsNCiAgICAgICAgc2VsZi5hY3Rpb24oYWN0aW9uKTsNCiAgICAgICAgc2VsZi5yZXN1bHQocmVzdWx0KTsNCiAgICAgICAgc2VsZi5jb21wbGV0ZWQoY29tcGxldGVkKTsNCiAgICAgICAgDQogICAgSWQgPSBOb25lOw0KICAgIA0KICAgIA0KICAgICMgYWN0aXZlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2FjdGl2ZSA9IE5vbmU7DQogICAgZGVmIGFjdGl2ZShzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9hY3RpdmUgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fYWN0aXZlOw0KDQoNCiAgICANCiAgICAjIGVuYWJsZWQ6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfZW5hYmxlZCA9IE5vbmU7DQogICAgZGVmIGVuYWJsZWQoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fZW5hYmxlZCA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9lbmFibGVkOw0KDQoNCiAgICANCiAgICAjIGNvZGU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfY29kZSA9IE5vbmU7DQogICAgZGVmIGNvZGUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fY29kZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9jb2RlOw0KDQoNCiAgICANCiAgICAjIG9yZGVyOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX29yZGVyID0gTm9uZTsNCiAgICBkZWYgb3JkZXIoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fb3JkZXIgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fb3JkZXI7DQoNCg0KICAgIA0KICAgICMgZGF0ZTogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9kYXRlID0gTm9uZTsNCiAgICBkZWYgZGF0ZShzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9kYXRlID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2RhdGU7DQoNCg0KICAgIA0KICAgICMgbmFtZTogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9uYW1lID0gTm9uZTsNCiAgICBkZWYgbmFtZShzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9uYW1lID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX25hbWU7DQoNCg0KICAgIA0KICAgICMgcmVtYXJrOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX3JlbWFyayA9IE5vbmU7DQogICAgZGVmIHJlbWFyayhzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9yZW1hcmsgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fcmVtYXJrOw0KDQoNCiAgICANCiAgICAjIGRldmljZTogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9kZXZpY2UgPSBOb25lOw0KICAgIGRlZiBkZXZpY2Uoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fZGV2aWNlID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2RldmljZTsNCg0KDQogICAgDQogICAgIyBhY3Rpb246IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfYWN0aW9uID0gTm9uZTsNCiAgICBkZWYgYWN0aW9uKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2FjdGlvbiA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9hY3Rpb247DQoNCg0KICAgIA0KICAgICMgcmVzdWx0OiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX3Jlc3VsdCA9IE5vbmU7DQogICAgZGVmIHJlc3VsdChzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9yZXN1bHQgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fcmVzdWx0Ow0KDQoNCiAgICANCiAgICAjIGNvbXBsZXRlZDogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9jb21wbGV0ZWQgPSBOb25lOw0KICAgIGRlZiBjb21wbGV0ZWQoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fY29tcGxldGVkID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2NvbXBsZXRlZDsNCg0KDQogICAgDQogICAgDQogICAgZGVmIF9mcm9tRG9jdW1lbnQoc2VsZiwgb2JqKToNCiAgICAgICAgX190b1N0cmluZyA9ICdBY3Rpb25fRXhlY3V0aW9uOjpfZnJvbURvY3VtZW50KCk6ICc7DQoNCiAgICAgICAgaWYgb2JqIGlzIE5vbmU6DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgDQogICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLCBieXRlcyk6DQogICAgICAgICAgICBvYmogPSBzdHIob2JqLCAidXRmLTgiKTsNCg0KICAgICAgICBpZiBpc2luc3RhbmNlKG9iaiwgc3RyKSBvciB0eXBlKG9iaikgaXMgc3RyOg0KICAgICAgICAgICAgb2JqID0ganNvbi5sb2FkcyhvYmopOw0KICAgICAgICANCiAgICAgICAgaWYgbm90IGlzaW5zdGFuY2Uob2JqLCAoc3RyLCBieXRlcywgZGljdCkpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICdHT1QgSEVSRTogJyArIHN0cih0eXBlKG9iaikpKTsNCiAgICAgICAgICAgIHJldHVybiBvYmo7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGZvciBpIGluIG9iajoNCiAgICAgICAgICAgICAgICBvYmpbaV0gPSBBY3Rpb25fRXhlY3V0aW9uKCkuX2Zyb21Eb2N1bWVudChvYmpbaV0pOw0KICAgICAgICAgICAgcmV0dXJuIG9iajsNCg0KDQogICAgICAgIGlmICdJZCcgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5JZCA9IG9ialsnSWQnXTsNCg0KICAgIA0KICAgICAgICBpZiAnYWN0aXZlJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmFjdGl2ZShvYmpbJ2FjdGl2ZSddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdlbmFibGVkJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmVuYWJsZWQob2JqWydlbmFibGVkJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ2NvZGUnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuY29kZShvYmpbJ2NvZGUnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnb3JkZXInIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYub3JkZXIob2JqWydvcmRlciddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdkYXRlJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmRhdGUob2JqWydkYXRlJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ25hbWUnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYubmFtZShvYmpbJ25hbWUnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAncmVtYXJrJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLnJlbWFyayhvYmpbJ3JlbWFyayddKTsNCiAgICAgICAgDQogICAgICAgICAgICBzZWxmLnJlbWFyayggYmFzZTY0LmI2NGVuY29kZShzZWxmLnJlbWFyaygpLmVuY29kZSgiYXNjaWkiKSkuZGVjb2RlKCJhc2NpaSIpICk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnZGV2aWNlJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmRldmljZShEZXZpY2UoKS5fZnJvbURvY3VtZW50KG9ialsnZGV2aWNlJ10pKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdhY3Rpb24nIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuYWN0aW9uKERldmljZV9BY3Rpb24oKS5fZnJvbURvY3VtZW50KG9ialsnYWN0aW9uJ10pKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdyZXN1bHQnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYucmVzdWx0KG9ialsncmVzdWx0J10pOw0KICAgICAgICANCiAgICAgICAgICAgIHNlbGYucmVzdWx0KCBiYXNlNjQuYjY0ZW5jb2RlKHNlbGYucmVzdWx0KCkuZW5jb2RlKCJhc2NpaSIpKS5kZWNvZGUoImFzY2lpIikgKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdjb21wbGV0ZWQnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuY29tcGxldGVkKG9ialsnY29tcGxldGVkJ10pOw0KICAgICAgICANCiAgICANCg0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIHJldHVybiBzZWxmOw0KICAgIA0KICAgIGRlZiBfdG9Eb2N1bWVudChzZWxmKToNCiAgICAgICAgcmV0ID0ge307DQogICAgICAgIGlmIHNlbGYuSWQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbIklkIl0gPSBzZWxmLklkOw0KDQogICAgDQogICAgICAgIGlmIHNlbGYuYWN0aXZlKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbImFjdGl2ZSJdID0gc2VsZi5hY3RpdmUoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYuZW5hYmxlZCgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJlbmFibGVkIl0gPSBzZWxmLmVuYWJsZWQoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYuY29kZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJjb2RlIl0gPSBzZWxmLmNvZGUoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYub3JkZXIoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsib3JkZXIiXSA9IHNlbGYub3JkZXIoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYuZGF0ZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJkYXRlIl0gPSBzZWxmLmRhdGUoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYubmFtZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJuYW1lIl0gPSBzZWxmLm5hbWUoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYucmVtYXJrKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbInJlbWFyayJdID0gc2VsZi5yZW1hcmsoKTsNCiAgICAgICAgDQogICAgICAgICAgICBpZiBpc2luc3RhbmNlKHJldFsicmVtYXJrIl0sIGRpY3QpOg0KICAgICAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSBqc29uLmR1bXBzKHJldFsicmVtYXJrIl0pOw0KICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IHViaW5hc2NpaS5iMmFfYmFzZTY0KHJldFsicmVtYXJrIl0pLnN0cmlwKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmRldmljZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJkZXZpY2UiXSA9IHNlbGYuZGV2aWNlKCkuX3RvRG9jdW1lbnQoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYuYWN0aW9uKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbImFjdGlvbiJdID0gc2VsZi5hY3Rpb24oKS5fdG9Eb2N1bWVudCgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5yZXN1bHQoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsicmVzdWx0Il0gPSBzZWxmLnJlc3VsdCgpOw0KICAgICAgICANCiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UocmV0WyJyZXN1bHQiXSwgZGljdCk6DQogICAgICAgICAgICAgICAgcmV0WyJyZXN1bHQiXSA9IGpzb24uZHVtcHMocmV0WyJyZXN1bHQiXSk7DQogICAgICAgICAgICByZXRbInJlc3VsdCJdID0gdWJpbmFzY2lpLmIyYV9iYXNlNjQocmV0WyJyZXN1bHQiXSkuc3RyaXAoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYuY29tcGxldGVkKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbImNvbXBsZXRlZCJdID0gc2VsZi5jb21wbGV0ZWQoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIHJldHVybiByZXQ7DQoNCiAgICANCiAgICBkZWYgc3RvcmUoc2VsZiwgX19ldmVudD1Ob25lKToNCiAgICAgICAgX190b1N0cmluZyA9ICdBY3Rpb25fRXhlY3V0aW9uOjpzdG9yZSgpOiAnOw0KICAgICAgICANCiAgICAgICAgZXZKU09OID0gTm9uZTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgZXZKU09OID0ganNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046DQogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOw0KICAgICAgICANCg0KICAgICAgICBhbnN3ZXIgPSBOb25lOw0KDQogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aW1lLnRpbWUoKSkrJ10uQWN0aW9uX0V4ZWN1dGlvbi5zdG9yZSgpJykubWV0aG9kKCdzdG9yZScpLmNsYXNzTmFtZSgnQWN0aW9uX0V4ZWN1dGlvbicpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7DQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KICAgICAgICANCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICBhbnN3ZXIgPSBBY3Rpb25fRXhlY3V0aW9uKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCiAgICAgICAgDQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KDQoNCg0KICAgICAgICBpZiAnQWN0aW9uX0V4ZWN1dGlvbl9zdG9yZScgaW4gZGlyKCk6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJz09PiBBY3Rpb25fRXhlY3V0aW9uX3N0b3JlKCknKTsNCiAgICAgICAgICAgIGFuc3dlciA9IEFjdGlvbl9FeGVjdXRpb25fc3RvcmUoc2VsZiwgX19ldmVudCwgYW5zd2VyLCBfX3RvU3RyaW5nKTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCg0KICAgICAgICByZXR1cm4gYW5zd2VyOw0KDQogICAgDQogICAgZGVmIGZpbmRBbGwoc2VsZiwgX19ldmVudD1Ob25lKToNCiAgICAgICAgX190b1N0cmluZyA9ICdBY3Rpb25fRXhlY3V0aW9uOjpmaW5kQWxsKCk6ICc7DQogICAgICAgIA0KICAgICAgICBldkpTT04gPSBOb25lOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBldkpTT04gPSBqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoNCiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7DQogICAgICAgIA0KDQogICAgICAgIGFuc3dlciA9IE5vbmU7DQoNCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpbWUudGltZSgpKSsnXS5BY3Rpb25fRXhlY3V0aW9uLmZpbmRBbGwoKScpLm1ldGhvZCgnZmluZEFsbCcpLmNsYXNzTmFtZSgnQWN0aW9uX0V4ZWN1dGlvbicpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7DQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KICAgICAgICANCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICBhbnN3ZXIgPSBBY3Rpb25fRXhlY3V0aW9uKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCiAgICAgICAgDQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KDQoNCg0KICAgICAgICBpZiAnQWN0aW9uX0V4ZWN1dGlvbl9maW5kQWxsJyBpbiBkaXIoKToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnPT0+IEFjdGlvbl9FeGVjdXRpb25fZmluZEFsbCgpJyk7DQogICAgICAgICAgICBhbnN3ZXIgPSBBY3Rpb25fRXhlY3V0aW9uX2ZpbmRBbGwoc2VsZiwgX19ldmVudCwgYW5zd2VyLCBfX3RvU3RyaW5nKTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCg0KICAgICAgICByZXR1cm4gYW5zd2VyOw0KDQogICAgDQogICAgZGVmIGZpbmQoc2VsZiwgX19ldmVudD1Ob25lKToNCiAgICAgICAgX190b1N0cmluZyA9ICdBY3Rpb25fRXhlY3V0aW9uOjpmaW5kKCk6ICc7DQogICAgICAgIA0KICAgICAgICBldkpTT04gPSBOb25lOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBldkpTT04gPSBqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoNCiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7DQogICAgICAgIA0KDQogICAgICAgIGFuc3dlciA9IE5vbmU7DQoNCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpbWUudGltZSgpKSsnXS5BY3Rpb25fRXhlY3V0aW9uLmZpbmQoKScpLm1ldGhvZCgnZmluZCcpLmNsYXNzTmFtZSgnQWN0aW9uX0V4ZWN1dGlvbicpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7DQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KICAgICAgICANCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICBhbnN3ZXIgPSBBY3Rpb25fRXhlY3V0aW9uKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCiAgICAgICAgDQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiY29tcGxldGVkPSIrYW5zd2VyLmNvbXBsZXRlZCgpKTsKICAgICAgICAgICAgIyBpZiBhbmQgYW5zd2VyLnJlc3VsdCgpIGlzIE5vbmUgYW5kIGFuc3dlci5jb21wbGV0ZWQoKSBpcyBOb25lIGFuZCBhbnN3ZXIuYWN0aW9uKCkuc2NyaXB0KCkgaXMgbm90IE5vbmUKICAgICAgICAgICAgI3ByaW50KF9fdG9TdHJpbmcgKyBhbnN3ZXIuYWN0aW9uKCkuY29kZSgpICsgJyBpcyBleGVjdXRpbmcnKTsKCSAgICANCg0KDQogICAgICAgIGlmICdBY3Rpb25fRXhlY3V0aW9uX2ZpbmQnIGluIGRpcigpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICc9PT4gQWN0aW9uX0V4ZWN1dGlvbl9maW5kKCknKTsNCiAgICAgICAgICAgIGFuc3dlciA9IEFjdGlvbl9FeGVjdXRpb25fZmluZChzZWxmLCBfX2V2ZW50LCBhbnN3ZXIsIF9fdG9TdHJpbmcpOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCg0KICAgICAgICAgICAgDQogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KDQogICAgICAgIHJldHVybiBhbnN3ZXI7DQoNCiAgICANCg0KDQpjbGFzcyBEZXZpY2VfQWN0aW9uKCk6DQogICAgZGVmIF9faW5pdF9fKHNlbGYsIElkPU5vbmUsIGFjdGl2ZT1Ob25lLCBlbmFibGVkPU5vbmUsIGNvZGU9Tm9uZSwgb3JkZXI9Tm9uZSwgZGF0ZT1Ob25lLCBuYW1lPU5vbmUsIHJlbWFyaz1Ob25lLCBzY3JpcHQ9Tm9uZSwgdHlwZT1Ob25lKToNCiAgICAgICAgc3VwZXIoKS5fX2luaXRfXygpOw0KDQogICAgICAgICNwcmludCgnRGV2aWNlX0FjdGlvbjo6X19pbml0X18oKScpOw0KICAgICAgICBpZiBJZCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHNlbGYuSWQgPSBJZDsNCg0KICAgICAgICANCiAgICAgICAgc2VsZi5hY3RpdmUoYWN0aXZlKTsNCiAgICAgICAgc2VsZi5lbmFibGVkKGVuYWJsZWQpOw0KICAgICAgICBzZWxmLmNvZGUoY29kZSk7DQogICAgICAgIHNlbGYub3JkZXIob3JkZXIpOw0KICAgICAgICBzZWxmLmRhdGUoZGF0ZSk7DQogICAgICAgIHNlbGYubmFtZShuYW1lKTsNCiAgICAgICAgc2VsZi5yZW1hcmsocmVtYXJrKTsNCiAgICAgICAgc2VsZi5zY3JpcHQoc2NyaXB0KTsNCiAgICAgICAgc2VsZi50eXBlKHR5cGUpOw0KICAgICAgICANCiAgICBJZCA9IE5vbmU7DQogICAgDQogICAgDQogICAgIyBhY3RpdmU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfYWN0aXZlID0gTm9uZTsNCiAgICBkZWYgYWN0aXZlKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2FjdGl2ZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9hY3RpdmU7DQoNCg0KICAgIA0KICAgICMgZW5hYmxlZDogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9lbmFibGVkID0gTm9uZTsNCiAgICBkZWYgZW5hYmxlZChzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9lbmFibGVkID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2VuYWJsZWQ7DQoNCg0KICAgIA0KICAgICMgY29kZTogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9jb2RlID0gTm9uZTsNCiAgICBkZWYgY29kZShzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9jb2RlID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2NvZGU7DQoNCg0KICAgIA0KICAgICMgb3JkZXI6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfb3JkZXIgPSBOb25lOw0KICAgIGRlZiBvcmRlcihzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9vcmRlciA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9vcmRlcjsNCg0KDQogICAgDQogICAgIyBkYXRlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2RhdGUgPSBOb25lOw0KICAgIGRlZiBkYXRlKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2RhdGUgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fZGF0ZTsNCg0KDQogICAgDQogICAgIyBuYW1lOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX25hbWUgPSBOb25lOw0KICAgIGRlZiBuYW1lKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX25hbWUgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fbmFtZTsNCg0KDQogICAgDQogICAgIyByZW1hcms6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfcmVtYXJrID0gTm9uZTsNCiAgICBkZWYgcmVtYXJrKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX3JlbWFyayA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9yZW1hcms7DQoNCg0KICAgIA0KICAgICMgc2NyaXB0OiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX3NjcmlwdCA9IE5vbmU7DQogICAgZGVmIHNjcmlwdChzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9zY3JpcHQgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fc2NyaXB0Ow0KDQoNCiAgICANCiAgICAjIHR5cGU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfdHlwZSA9IE5vbmU7DQogICAgZGVmIHR5cGUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fdHlwZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl90eXBlOw0KDQoNCiAgICANCiAgICANCiAgICBkZWYgX2Zyb21Eb2N1bWVudChzZWxmLCBvYmopOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ0RldmljZV9BY3Rpb246Ol9mcm9tRG9jdW1lbnQoKTogJzsNCg0KICAgICAgICBpZiBvYmogaXMgTm9uZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICANCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIGJ5dGVzKToNCiAgICAgICAgICAgIG9iaiA9IHN0cihvYmosICJ1dGYtOCIpOw0KDQogICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLCBzdHIpIG9yIHR5cGUob2JqKSBpcyBzdHI6DQogICAgICAgICAgICBvYmogPSBqc29uLmxvYWRzKG9iaik7DQogICAgICAgIA0KICAgICAgICBpZiBub3QgaXNpbnN0YW5jZShvYmosIChzdHIsIGJ5dGVzLCBkaWN0KSk6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJ0dPVCBIRVJFOiAnICsgc3RyKHR5cGUob2JqKSkpOw0KICAgICAgICAgICAgcmV0dXJuIG9iajsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZm9yIGkgaW4gb2JqOg0KICAgICAgICAgICAgICAgIG9ialtpXSA9IERldmljZV9BY3Rpb24oKS5fZnJvbURvY3VtZW50KG9ialtpXSk7DQogICAgICAgICAgICByZXR1cm4gb2JqOw0KDQoNCiAgICAgICAgaWYgJ0lkJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLklkID0gb2JqWydJZCddOw0KDQogICAgDQogICAgICAgIGlmICdhY3RpdmUnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuYWN0aXZlKG9ialsnYWN0aXZlJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ2VuYWJsZWQnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuZW5hYmxlZChvYmpbJ2VuYWJsZWQnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnY29kZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5jb2RlKG9ialsnY29kZSddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdvcmRlcicgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5vcmRlcihvYmpbJ29yZGVyJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ2RhdGUnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuZGF0ZShvYmpbJ2RhdGUnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnbmFtZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5uYW1lKG9ialsnbmFtZSddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdyZW1hcmsnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYucmVtYXJrKG9ialsncmVtYXJrJ10pOw0KICAgICAgICANCiAgICAgICAgICAgIHNlbGYucmVtYXJrKCBiYXNlNjQuYjY0ZW5jb2RlKHNlbGYucmVtYXJrKCkuZW5jb2RlKCJhc2NpaSIpKS5kZWNvZGUoImFzY2lpIikgKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdzY3JpcHQnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuc2NyaXB0KG9ialsnc2NyaXB0J10pOw0KICAgICAgICANCiAgICAgICAgICAgIHNlbGYuc2NyaXB0KCBiYXNlNjQuYjY0ZW5jb2RlKHNlbGYuc2NyaXB0KCkuZW5jb2RlKCJhc2NpaSIpKS5kZWNvZGUoImFzY2lpIikgKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICd0eXBlJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLnR5cGUoRGV2aWNlX1R5cGUoKS5fZnJvbURvY3VtZW50KG9ialsndHlwZSddKSk7DQogICAgICAgIA0KICAgIA0KDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgDQogICAgZGVmIF90b0RvY3VtZW50KHNlbGYpOg0KICAgICAgICByZXQgPSB7fTsNCiAgICAgICAgaWYgc2VsZi5JZCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiSWQiXSA9IHNlbGYuSWQ7DQoNCiAgICANCiAgICAgICAgaWYgc2VsZi5hY3RpdmUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiYWN0aXZlIl0gPSBzZWxmLmFjdGl2ZSgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5lbmFibGVkKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbImVuYWJsZWQiXSA9IHNlbGYuZW5hYmxlZCgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5jb2RlKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbImNvZGUiXSA9IHNlbGYuY29kZSgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5vcmRlcigpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJvcmRlciJdID0gc2VsZi5vcmRlcigpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5kYXRlKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbImRhdGUiXSA9IHNlbGYuZGF0ZSgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5uYW1lKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbIm5hbWUiXSA9IHNlbGYubmFtZSgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5yZW1hcmsoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSBzZWxmLnJlbWFyaygpOw0KICAgICAgICANCiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UocmV0WyJyZW1hcmsiXSwgZGljdCk6DQogICAgICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IGpzb24uZHVtcHMocmV0WyJyZW1hcmsiXSk7DQogICAgICAgICAgICByZXRbInJlbWFyayJdID0gdWJpbmFzY2lpLmIyYV9iYXNlNjQocmV0WyJyZW1hcmsiXSkuc3RyaXAoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYuc2NyaXB0KCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbInNjcmlwdCJdID0gc2VsZi5zY3JpcHQoKTsNCiAgICAgICAgDQogICAgICAgICAgICBpZiBpc2luc3RhbmNlKHJldFsic2NyaXB0Il0sIGRpY3QpOg0KICAgICAgICAgICAgICAgIHJldFsic2NyaXB0Il0gPSBqc29uLmR1bXBzKHJldFsic2NyaXB0Il0pOw0KICAgICAgICAgICAgcmV0WyJzY3JpcHQiXSA9IHViaW5hc2NpaS5iMmFfYmFzZTY0KHJldFsic2NyaXB0Il0pLnN0cmlwKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLnR5cGUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsidHlwZSJdID0gc2VsZi50eXBlKCkuX3RvRG9jdW1lbnQoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIHJldHVybiByZXQ7DQoNCiAgICANCiAgICBkZWYgc3RvcmUoc2VsZiwgX19ldmVudD1Ob25lKToNCiAgICAgICAgX190b1N0cmluZyA9ICdEZXZpY2VfQWN0aW9uOjpzdG9yZSgpOiAnOw0KICAgICAgICANCiAgICAgICAgZXZKU09OID0gTm9uZTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgZXZKU09OID0ganNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046DQogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOw0KICAgICAgICANCg0KICAgICAgICBhbnN3ZXIgPSBOb25lOw0KDQogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aW1lLnRpbWUoKSkrJ10uRGV2aWNlX0FjdGlvbi5zdG9yZSgpJykubWV0aG9kKCdzdG9yZScpLmNsYXNzTmFtZSgnRGV2aWNlX0FjdGlvbicpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7DQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KICAgICAgICANCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICBhbnN3ZXIgPSBEZXZpY2VfQWN0aW9uKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCiAgICAgICAgDQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KDQoNCg0KICAgICAgICBpZiAnRGV2aWNlX0FjdGlvbl9zdG9yZScgaW4gZGlyKCk6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJz09PiBEZXZpY2VfQWN0aW9uX3N0b3JlKCknKTsNCiAgICAgICAgICAgIGFuc3dlciA9IERldmljZV9BY3Rpb25fc3RvcmUoc2VsZiwgX19ldmVudCwgYW5zd2VyLCBfX3RvU3RyaW5nKTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCg0KICAgICAgICByZXR1cm4gYW5zd2VyOw0KDQogICAgDQogICAgZGVmIGZpbmRBbGwoc2VsZiwgX19ldmVudD1Ob25lKToNCiAgICAgICAgX190b1N0cmluZyA9ICdEZXZpY2VfQWN0aW9uOjpmaW5kQWxsKCk6ICc7DQogICAgICAgIA0KICAgICAgICBldkpTT04gPSBOb25lOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBldkpTT04gPSBqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoNCiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7DQogICAgICAgIA0KDQogICAgICAgIGFuc3dlciA9IE5vbmU7DQoNCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpbWUudGltZSgpKSsnXS5EZXZpY2VfQWN0aW9uLmZpbmRBbGwoKScpLm1ldGhvZCgnZmluZEFsbCcpLmNsYXNzTmFtZSgnRGV2aWNlX0FjdGlvbicpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7DQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KICAgICAgICANCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICBhbnN3ZXIgPSBEZXZpY2VfQWN0aW9uKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCiAgICAgICAgDQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KDQoNCg0KICAgICAgICBpZiAnRGV2aWNlX0FjdGlvbl9maW5kQWxsJyBpbiBkaXIoKToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnPT0+IERldmljZV9BY3Rpb25fZmluZEFsbCgpJyk7DQogICAgICAgICAgICBhbnN3ZXIgPSBEZXZpY2VfQWN0aW9uX2ZpbmRBbGwoc2VsZiwgX19ldmVudCwgYW5zd2VyLCBfX3RvU3RyaW5nKTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCg0KICAgICAgICByZXR1cm4gYW5zd2VyOw0KDQogICAgDQogICAgZGVmIGZpbmQoc2VsZiwgX19ldmVudD1Ob25lKToNCiAgICAgICAgX190b1N0cmluZyA9ICdEZXZpY2VfQWN0aW9uOjpmaW5kKCk6ICc7DQogICAgICAgIA0KICAgICAgICBldkpTT04gPSBOb25lOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBldkpTT04gPSBqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoNCiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7DQogICAgICAgIA0KDQogICAgICAgIGFuc3dlciA9IE5vbmU7DQoNCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpbWUudGltZSgpKSsnXS5EZXZpY2VfQWN0aW9uLmZpbmQoKScpLm1ldGhvZCgnZmluZCcpLmNsYXNzTmFtZSgnRGV2aWNlX0FjdGlvbicpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7DQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KICAgICAgICANCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICBhbnN3ZXIgPSBEZXZpY2VfQWN0aW9uKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCiAgICAgICAgDQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KDQoNCg0KICAgICAgICBpZiAnRGV2aWNlX0FjdGlvbl9maW5kJyBpbiBkaXIoKToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnPT0+IERldmljZV9BY3Rpb25fZmluZCgpJyk7DQogICAgICAgICAgICBhbnN3ZXIgPSBEZXZpY2VfQWN0aW9uX2ZpbmQoc2VsZiwgX19ldmVudCwgYW5zd2VyLCBfX3RvU3RyaW5nKTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCg0KICAgICAgICByZXR1cm4gYW5zd2VyOw0KDQogICAgDQoNCg0KY2xhc3MgRGV2aWNlKCk6DQogICAgZGVmIF9faW5pdF9fKHNlbGYsIElkPU5vbmUsIGFjdGl2ZT1Ob25lLCBlbmFibGVkPU5vbmUsIGNvZGU9Tm9uZSwgb3JkZXI9Tm9uZSwgZGF0ZT1Ob25lLCBuYW1lPU5vbmUsIHJlbWFyaz1Ob25lLCB0eXBlPU5vbmUsIGNvbnRyb2xsZXI9Tm9uZSk6DQogICAgICAgIHN1cGVyKCkuX19pbml0X18oKTsNCg0KICAgICAgICAjcHJpbnQoJ0RldmljZTo6X19pbml0X18oKScpOw0KICAgICAgICBpZiBJZCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHNlbGYuSWQgPSBJZDsNCg0KICAgICAgICANCiAgICAgICAgc2VsZi5hY3RpdmUoYWN0aXZlKTsNCiAgICAgICAgc2VsZi5lbmFibGVkKGVuYWJsZWQpOw0KICAgICAgICBzZWxmLmNvZGUoY29kZSk7DQogICAgICAgIHNlbGYub3JkZXIob3JkZXIpOw0KICAgICAgICBzZWxmLmRhdGUoZGF0ZSk7DQogICAgICAgIHNlbGYubmFtZShuYW1lKTsNCiAgICAgICAgc2VsZi5yZW1hcmsocmVtYXJrKTsNCiAgICAgICAgc2VsZi50eXBlKHR5cGUpOw0KICAgICAgICBzZWxmLmNvbnRyb2xsZXIoY29udHJvbGxlcik7DQogICAgICAgIA0KICAgIElkID0gTm9uZTsNCiAgICANCiAgICANCiAgICAjIGFjdGl2ZTogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9hY3RpdmUgPSBOb25lOw0KICAgIGRlZiBhY3RpdmUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fYWN0aXZlID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2FjdGl2ZTsNCg0KDQogICAgDQogICAgIyBlbmFibGVkOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2VuYWJsZWQgPSBOb25lOw0KICAgIGRlZiBlbmFibGVkKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2VuYWJsZWQgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fZW5hYmxlZDsNCg0KDQogICAgDQogICAgIyBjb2RlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2NvZGUgPSBOb25lOw0KICAgIGRlZiBjb2RlKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2NvZGUgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fY29kZTsNCg0KDQogICAgDQogICAgIyBvcmRlcjogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9vcmRlciA9IE5vbmU7DQogICAgZGVmIG9yZGVyKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX29yZGVyID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX29yZGVyOw0KDQoNCiAgICANCiAgICAjIGRhdGU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfZGF0ZSA9IE5vbmU7DQogICAgZGVmIGRhdGUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fZGF0ZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9kYXRlOw0KDQoNCiAgICANCiAgICAjIG5hbWU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfbmFtZSA9IE5vbmU7DQogICAgZGVmIG5hbWUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fbmFtZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9uYW1lOw0KDQoNCiAgICANCiAgICAjIHJlbWFyazogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9yZW1hcmsgPSBOb25lOw0KICAgIGRlZiByZW1hcmsoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fcmVtYXJrID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3JlbWFyazsNCg0KDQogICAgDQogICAgIyB0eXBlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX3R5cGUgPSBOb25lOw0KICAgIGRlZiB0eXBlKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX3R5cGUgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fdHlwZTsNCg0KDQogICAgDQogICAgIyBjb250cm9sbGVyOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2NvbnRyb2xsZXIgPSBOb25lOw0KICAgIGRlZiBjb250cm9sbGVyKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2NvbnRyb2xsZXIgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fY29udHJvbGxlcjsNCg0KDQogICAgDQogICAgDQogICAgZGVmIF9mcm9tRG9jdW1lbnQoc2VsZiwgb2JqKToNCiAgICAgICAgX190b1N0cmluZyA9ICdEZXZpY2U6Ol9mcm9tRG9jdW1lbnQoKTogJzsNCg0KICAgICAgICBpZiBvYmogaXMgTm9uZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICANCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIGJ5dGVzKToNCiAgICAgICAgICAgIG9iaiA9IHN0cihvYmosICJ1dGYtOCIpOw0KDQogICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLCBzdHIpIG9yIHR5cGUob2JqKSBpcyBzdHI6DQogICAgICAgICAgICBvYmogPSBqc29uLmxvYWRzKG9iaik7DQogICAgICAgIA0KICAgICAgICBpZiBub3QgaXNpbnN0YW5jZShvYmosIChzdHIsIGJ5dGVzLCBkaWN0KSk6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJ0dPVCBIRVJFOiAnICsgc3RyKHR5cGUob2JqKSkpOw0KICAgICAgICAgICAgcmV0dXJuIG9iajsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZm9yIGkgaW4gb2JqOg0KICAgICAgICAgICAgICAgIG9ialtpXSA9IERldmljZSgpLl9mcm9tRG9jdW1lbnQob2JqW2ldKTsNCiAgICAgICAgICAgIHJldHVybiBvYmo7DQoNCg0KICAgICAgICBpZiAnSWQnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuSWQgPSBvYmpbJ0lkJ107DQoNCiAgICANCiAgICAgICAgaWYgJ2FjdGl2ZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5hY3RpdmUob2JqWydhY3RpdmUnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnZW5hYmxlZCcgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5lbmFibGVkKG9ialsnZW5hYmxlZCddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdjb2RlJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmNvZGUob2JqWydjb2RlJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ29yZGVyJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLm9yZGVyKG9ialsnb3JkZXInXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnZGF0ZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5kYXRlKG9ialsnZGF0ZSddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICduYW1lJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLm5hbWUob2JqWyduYW1lJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ3JlbWFyaycgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5yZW1hcmsob2JqWydyZW1hcmsnXSk7DQogICAgICAgIA0KICAgICAgICAgICAgc2VsZi5yZW1hcmsoIGJhc2U2NC5iNjRlbmNvZGUoc2VsZi5yZW1hcmsoKS5lbmNvZGUoImFzY2lpIikpLmRlY29kZSgiYXNjaWkiKSApOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ3R5cGUnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYudHlwZShEZXZpY2VfVHlwZSgpLl9mcm9tRG9jdW1lbnQob2JqWyd0eXBlJ10pKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdjb250cm9sbGVyJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmNvbnRyb2xsZXIoTm9kZSgpLl9mcm9tRG9jdW1lbnQob2JqWydjb250cm9sbGVyJ10pKTsNCiAgICAgICAgDQogICAgDQoNCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICByZXR1cm4gc2VsZjsNCiAgICANCiAgICBkZWYgX3RvRG9jdW1lbnQoc2VsZik6DQogICAgICAgIHJldCA9IHt9Ow0KICAgICAgICBpZiBzZWxmLklkIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJJZCJdID0gc2VsZi5JZDsNCg0KICAgIA0KICAgICAgICBpZiBzZWxmLmFjdGl2ZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJhY3RpdmUiXSA9IHNlbGYuYWN0aXZlKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmVuYWJsZWQoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiZW5hYmxlZCJdID0gc2VsZi5lbmFibGVkKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmNvZGUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiY29kZSJdID0gc2VsZi5jb2RlKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLm9yZGVyKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbIm9yZGVyIl0gPSBzZWxmLm9yZGVyKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmRhdGUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiZGF0ZSJdID0gc2VsZi5kYXRlKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLm5hbWUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsibmFtZSJdID0gc2VsZi5uYW1lKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLnJlbWFyaygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IHNlbGYucmVtYXJrKCk7DQogICAgICAgIA0KICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShyZXRbInJlbWFyayJdLCBkaWN0KToNCiAgICAgICAgICAgICAgICByZXRbInJlbWFyayJdID0ganNvbi5kdW1wcyhyZXRbInJlbWFyayJdKTsNCiAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSB1YmluYXNjaWkuYjJhX2Jhc2U2NChyZXRbInJlbWFyayJdKS5zdHJpcCgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi50eXBlKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbInR5cGUiXSA9IHNlbGYudHlwZSgpLl90b0RvY3VtZW50KCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmNvbnRyb2xsZXIoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiY29udHJvbGxlciJdID0gc2VsZi5jb250cm9sbGVyKCkuX3RvRG9jdW1lbnQoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIHJldHVybiByZXQ7DQoNCiAgICANCiAgICBkZWYgc3RvcmUoc2VsZiwgX19ldmVudD1Ob25lKToNCiAgICAgICAgX190b1N0cmluZyA9ICdEZXZpY2U6OnN0b3JlKCk6ICc7DQogICAgICAgIA0KICAgICAgICBldkpTT04gPSBOb25lOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBldkpTT04gPSBqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoNCiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7DQogICAgICAgIA0KDQogICAgICAgIGFuc3dlciA9IE5vbmU7DQoNCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpbWUudGltZSgpKSsnXS5EZXZpY2Uuc3RvcmUoKScpLm1ldGhvZCgnc3RvcmUnKS5jbGFzc05hbWUoJ0RldmljZScpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7DQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KICAgICAgICANCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICBhbnN3ZXIgPSBEZXZpY2UoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KICAgICAgICANCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQoNCg0KDQogICAgICAgIGlmICdEZXZpY2Vfc3RvcmUnIGluIGRpcigpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICc9PT4gRGV2aWNlX3N0b3JlKCknKTsNCiAgICAgICAgICAgIGFuc3dlciA9IERldmljZV9zdG9yZShzZWxmLCBfX2V2ZW50LCBhbnN3ZXIsIF9fdG9TdHJpbmcpOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCg0KICAgICAgICAgICAgDQogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KDQogICAgICAgIHJldHVybiBhbnN3ZXI7DQoNCiAgICANCiAgICBkZWYgZmluZEFsbChzZWxmLCBfX2V2ZW50PU5vbmUpOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ0RldmljZTo6ZmluZEFsbCgpOiAnOw0KICAgICAgICANCiAgICAgICAgZXZKU09OID0gTm9uZTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgZXZKU09OID0ganNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046DQogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOw0KICAgICAgICANCg0KICAgICAgICBhbnN3ZXIgPSBOb25lOw0KDQogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aW1lLnRpbWUoKSkrJ10uRGV2aWNlLmZpbmRBbGwoKScpLm1ldGhvZCgnZmluZEFsbCcpLmNsYXNzTmFtZSgnRGV2aWNlJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOw0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsNCiAgICAgICAgDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQogICAgICAgIA0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgIGFuc3dlciA9IERldmljZSgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQogICAgICAgIA0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCg0KDQoNCiAgICAgICAgaWYgJ0RldmljZV9maW5kQWxsJyBpbiBkaXIoKToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnPT0+IERldmljZV9maW5kQWxsKCknKTsNCiAgICAgICAgICAgIGFuc3dlciA9IERldmljZV9maW5kQWxsKHNlbGYsIF9fZXZlbnQsIGFuc3dlciwgX190b1N0cmluZyk7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KDQogICAgICAgICAgICANCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQoNCiAgICAgICAgcmV0dXJuIGFuc3dlcjsNCg0KICAgIA0KICAgIGRlZiBmaW5kKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6DQogICAgICAgIF9fdG9TdHJpbmcgPSAnRGV2aWNlOjpmaW5kKCk6ICc7DQogICAgICAgIA0KICAgICAgICBldkpTT04gPSBOb25lOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBldkpTT04gPSBqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoNCiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7DQogICAgICAgIA0KDQogICAgICAgIGFuc3dlciA9IE5vbmU7DQoNCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpbWUudGltZSgpKSsnXS5EZXZpY2UuZmluZCgpJykubWV0aG9kKCdmaW5kJykuY2xhc3NOYW1lKCdEZXZpY2UnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOw0KICAgICAgICANCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCiAgICAgICAgDQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgYW5zd2VyID0gRGV2aWNlKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCiAgICAgICAgDQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KDQoNCg0KICAgICAgICBpZiAnRGV2aWNlX2ZpbmQnIGluIGRpcigpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICc9PT4gRGV2aWNlX2ZpbmQoKScpOw0KICAgICAgICAgICAgYW5zd2VyID0gRGV2aWNlX2ZpbmQoc2VsZiwgX19ldmVudCwgYW5zd2VyLCBfX3RvU3RyaW5nKTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCg0KICAgICAgICByZXR1cm4gYW5zd2VyOw0KDQogICAgDQoNCg0KY2xhc3MgRGV2aWNlX0NhdGVnb3J5KCk6DQogICAgZGVmIF9faW5pdF9fKHNlbGYsIElkPU5vbmUsIGFjdGl2ZT1Ob25lLCBlbmFibGVkPU5vbmUsIGNvZGU9Tm9uZSwgb3JkZXI9Tm9uZSwgZGF0ZT1Ob25lLCBuYW1lPU5vbmUsIHJlbWFyaz1Ob25lLCBwYXJlbnQ9Tm9uZSk6DQogICAgICAgIHN1cGVyKCkuX19pbml0X18oKTsNCg0KICAgICAgICAjcHJpbnQoJ0RldmljZV9DYXRlZ29yeTo6X19pbml0X18oKScpOw0KICAgICAgICBpZiBJZCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHNlbGYuSWQgPSBJZDsNCg0KICAgICAgICANCiAgICAgICAgc2VsZi5hY3RpdmUoYWN0aXZlKTsNCiAgICAgICAgc2VsZi5lbmFibGVkKGVuYWJsZWQpOw0KICAgICAgICBzZWxmLmNvZGUoY29kZSk7DQogICAgICAgIHNlbGYub3JkZXIob3JkZXIpOw0KICAgICAgICBzZWxmLmRhdGUoZGF0ZSk7DQogICAgICAgIHNlbGYubmFtZShuYW1lKTsNCiAgICAgICAgc2VsZi5yZW1hcmsocmVtYXJrKTsNCiAgICAgICAgc2VsZi5wYXJlbnQocGFyZW50KTsNCiAgICAgICAgDQogICAgSWQgPSBOb25lOw0KICAgIA0KICAgIA0KICAgICMgYWN0aXZlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2FjdGl2ZSA9IE5vbmU7DQogICAgZGVmIGFjdGl2ZShzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9hY3RpdmUgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fYWN0aXZlOw0KDQoNCiAgICANCiAgICAjIGVuYWJsZWQ6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfZW5hYmxlZCA9IE5vbmU7DQogICAgZGVmIGVuYWJsZWQoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fZW5hYmxlZCA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9lbmFibGVkOw0KDQoNCiAgICANCiAgICAjIGNvZGU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfY29kZSA9IE5vbmU7DQogICAgZGVmIGNvZGUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fY29kZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9jb2RlOw0KDQoNCiAgICANCiAgICAjIG9yZGVyOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX29yZGVyID0gTm9uZTsNCiAgICBkZWYgb3JkZXIoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fb3JkZXIgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fb3JkZXI7DQoNCg0KICAgIA0KICAgICMgZGF0ZTogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9kYXRlID0gTm9uZTsNCiAgICBkZWYgZGF0ZShzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9kYXRlID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2RhdGU7DQoNCg0KICAgIA0KICAgICMgbmFtZTogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9uYW1lID0gTm9uZTsNCiAgICBkZWYgbmFtZShzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9uYW1lID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX25hbWU7DQoNCg0KICAgIA0KICAgICMgcmVtYXJrOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX3JlbWFyayA9IE5vbmU7DQogICAgZGVmIHJlbWFyayhzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9yZW1hcmsgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fcmVtYXJrOw0KDQoNCiAgICANCiAgICAjIHBhcmVudDogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9wYXJlbnQgPSBOb25lOw0KICAgIGRlZiBwYXJlbnQoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fcGFyZW50ID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3BhcmVudDsNCg0KDQogICAgDQogICAgDQogICAgZGVmIF9mcm9tRG9jdW1lbnQoc2VsZiwgb2JqKToNCiAgICAgICAgX190b1N0cmluZyA9ICdEZXZpY2VfQ2F0ZWdvcnk6Ol9mcm9tRG9jdW1lbnQoKTogJzsNCg0KICAgICAgICBpZiBvYmogaXMgTm9uZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICANCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIGJ5dGVzKToNCiAgICAgICAgICAgIG9iaiA9IHN0cihvYmosICJ1dGYtOCIpOw0KDQogICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLCBzdHIpIG9yIHR5cGUob2JqKSBpcyBzdHI6DQogICAgICAgICAgICBvYmogPSBqc29uLmxvYWRzKG9iaik7DQogICAgICAgIA0KICAgICAgICBpZiBub3QgaXNpbnN0YW5jZShvYmosIChzdHIsIGJ5dGVzLCBkaWN0KSk6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJ0dPVCBIRVJFOiAnICsgc3RyKHR5cGUob2JqKSkpOw0KICAgICAgICAgICAgcmV0dXJuIG9iajsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZm9yIGkgaW4gb2JqOg0KICAgICAgICAgICAgICAgIG9ialtpXSA9IERldmljZV9DYXRlZ29yeSgpLl9mcm9tRG9jdW1lbnQob2JqW2ldKTsNCiAgICAgICAgICAgIHJldHVybiBvYmo7DQoNCg0KICAgICAgICBpZiAnSWQnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuSWQgPSBvYmpbJ0lkJ107DQoNCiAgICANCiAgICAgICAgaWYgJ2FjdGl2ZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5hY3RpdmUob2JqWydhY3RpdmUnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnZW5hYmxlZCcgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5lbmFibGVkKG9ialsnZW5hYmxlZCddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdjb2RlJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmNvZGUob2JqWydjb2RlJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ29yZGVyJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLm9yZGVyKG9ialsnb3JkZXInXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnZGF0ZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5kYXRlKG9ialsnZGF0ZSddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICduYW1lJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLm5hbWUob2JqWyduYW1lJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ3JlbWFyaycgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5yZW1hcmsob2JqWydyZW1hcmsnXSk7DQogICAgICAgIA0KICAgICAgICAgICAgc2VsZi5yZW1hcmsoIGJhc2U2NC5iNjRlbmNvZGUoc2VsZi5yZW1hcmsoKS5lbmNvZGUoImFzY2lpIikpLmRlY29kZSgiYXNjaWkiKSApOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ3BhcmVudCcgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5wYXJlbnQob2JqWydwYXJlbnQnXSk7DQogICAgICAgIA0KICAgIA0KDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgDQogICAgZGVmIF90b0RvY3VtZW50KHNlbGYpOg0KICAgICAgICByZXQgPSB7fTsNCiAgICAgICAgaWYgc2VsZi5JZCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiSWQiXSA9IHNlbGYuSWQ7DQoNCiAgICANCiAgICAgICAgaWYgc2VsZi5hY3RpdmUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiYWN0aXZlIl0gPSBzZWxmLmFjdGl2ZSgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5lbmFibGVkKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbImVuYWJsZWQiXSA9IHNlbGYuZW5hYmxlZCgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5jb2RlKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbImNvZGUiXSA9IHNlbGYuY29kZSgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5vcmRlcigpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJvcmRlciJdID0gc2VsZi5vcmRlcigpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5kYXRlKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbImRhdGUiXSA9IHNlbGYuZGF0ZSgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5uYW1lKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbIm5hbWUiXSA9IHNlbGYubmFtZSgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5yZW1hcmsoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSBzZWxmLnJlbWFyaygpOw0KICAgICAgICANCiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UocmV0WyJyZW1hcmsiXSwgZGljdCk6DQogICAgICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IGpzb24uZHVtcHMocmV0WyJyZW1hcmsiXSk7DQogICAgICAgICAgICByZXRbInJlbWFyayJdID0gdWJpbmFzY2lpLmIyYV9iYXNlNjQocmV0WyJyZW1hcmsiXSkuc3RyaXAoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYucGFyZW50KCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbInBhcmVudCJdID0gc2VsZi5wYXJlbnQoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIHJldHVybiByZXQ7DQoNCiAgICANCiAgICBkZWYgc3RvcmUoc2VsZiwgX19ldmVudD1Ob25lKToNCiAgICAgICAgX190b1N0cmluZyA9ICdEZXZpY2VfQ2F0ZWdvcnk6OnN0b3JlKCk6ICc7DQogICAgICAgIA0KICAgICAgICBldkpTT04gPSBOb25lOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBldkpTT04gPSBqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoNCiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7DQogICAgICAgIA0KDQogICAgICAgIGFuc3dlciA9IE5vbmU7DQoNCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpbWUudGltZSgpKSsnXS5EZXZpY2VfQ2F0ZWdvcnkuc3RvcmUoKScpLm1ldGhvZCgnc3RvcmUnKS5jbGFzc05hbWUoJ0RldmljZV9DYXRlZ29yeScpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7DQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KICAgICAgICANCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICBhbnN3ZXIgPSBEZXZpY2VfQ2F0ZWdvcnkoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KICAgICAgICANCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQoNCg0KDQogICAgICAgIGlmICdEZXZpY2VfQ2F0ZWdvcnlfc3RvcmUnIGluIGRpcigpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICc9PT4gRGV2aWNlX0NhdGVnb3J5X3N0b3JlKCknKTsNCiAgICAgICAgICAgIGFuc3dlciA9IERldmljZV9DYXRlZ29yeV9zdG9yZShzZWxmLCBfX2V2ZW50LCBhbnN3ZXIsIF9fdG9TdHJpbmcpOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCg0KICAgICAgICAgICAgDQogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KDQogICAgICAgIHJldHVybiBhbnN3ZXI7DQoNCiAgICANCiAgICBkZWYgZmluZEFsbChzZWxmLCBfX2V2ZW50PU5vbmUpOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ0RldmljZV9DYXRlZ29yeTo6ZmluZEFsbCgpOiAnOw0KICAgICAgICANCiAgICAgICAgZXZKU09OID0gTm9uZTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgZXZKU09OID0ganNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046DQogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOw0KICAgICAgICANCg0KICAgICAgICBhbnN3ZXIgPSBOb25lOw0KDQogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aW1lLnRpbWUoKSkrJ10uRGV2aWNlX0NhdGVnb3J5LmZpbmRBbGwoKScpLm1ldGhvZCgnZmluZEFsbCcpLmNsYXNzTmFtZSgnRGV2aWNlX0NhdGVnb3J5JykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOw0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsNCiAgICAgICAgDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQogICAgICAgIA0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgIGFuc3dlciA9IERldmljZV9DYXRlZ29yeSgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQogICAgICAgIA0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCg0KDQoNCiAgICAgICAgaWYgJ0RldmljZV9DYXRlZ29yeV9maW5kQWxsJyBpbiBkaXIoKToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnPT0+IERldmljZV9DYXRlZ29yeV9maW5kQWxsKCknKTsNCiAgICAgICAgICAgIGFuc3dlciA9IERldmljZV9DYXRlZ29yeV9maW5kQWxsKHNlbGYsIF9fZXZlbnQsIGFuc3dlciwgX190b1N0cmluZyk7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KDQogICAgICAgICAgICANCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQoNCiAgICAgICAgcmV0dXJuIGFuc3dlcjsNCg0KICAgIA0KICAgIGRlZiBmaW5kKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6DQogICAgICAgIF9fdG9TdHJpbmcgPSAnRGV2aWNlX0NhdGVnb3J5OjpmaW5kKCk6ICc7DQogICAgICAgIA0KICAgICAgICBldkpTT04gPSBOb25lOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBldkpTT04gPSBqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoNCiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7DQogICAgICAgIA0KDQogICAgICAgIGFuc3dlciA9IE5vbmU7DQoNCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpbWUudGltZSgpKSsnXS5EZXZpY2VfQ2F0ZWdvcnkuZmluZCgpJykubWV0aG9kKCdmaW5kJykuY2xhc3NOYW1lKCdEZXZpY2VfQ2F0ZWdvcnknKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOw0KICAgICAgICANCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCiAgICAgICAgDQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgYW5zd2VyID0gRGV2aWNlX0NhdGVnb3J5KCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCiAgICAgICAgDQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KDQoNCg0KICAgICAgICBpZiAnRGV2aWNlX0NhdGVnb3J5X2ZpbmQnIGluIGRpcigpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICc9PT4gRGV2aWNlX0NhdGVnb3J5X2ZpbmQoKScpOw0KICAgICAgICAgICAgYW5zd2VyID0gRGV2aWNlX0NhdGVnb3J5X2ZpbmQoc2VsZiwgX19ldmVudCwgYW5zd2VyLCBfX3RvU3RyaW5nKTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCg0KICAgICAgICByZXR1cm4gYW5zd2VyOw0KDQogICAgDQoNCg0KY2xhc3MgRGV2aWNlX1R5cGUoKToNCiAgICBkZWYgX19pbml0X18oc2VsZiwgSWQ9Tm9uZSwgYWN0aXZlPU5vbmUsIGVuYWJsZWQ9Tm9uZSwgY29kZT1Ob25lLCBvcmRlcj1Ob25lLCBkYXRlPU5vbmUsIG5hbWU9Tm9uZSwgcmVtYXJrPU5vbmUsIGNhdGVnb3J5PU5vbmUpOg0KICAgICAgICBzdXBlcigpLl9faW5pdF9fKCk7DQoNCiAgICAgICAgI3ByaW50KCdEZXZpY2VfVHlwZTo6X19pbml0X18oKScpOw0KICAgICAgICBpZiBJZCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHNlbGYuSWQgPSBJZDsNCg0KICAgICAgICANCiAgICAgICAgc2VsZi5hY3RpdmUoYWN0aXZlKTsNCiAgICAgICAgc2VsZi5lbmFibGVkKGVuYWJsZWQpOw0KICAgICAgICBzZWxmLmNvZGUoY29kZSk7DQogICAgICAgIHNlbGYub3JkZXIob3JkZXIpOw0KICAgICAgICBzZWxmLmRhdGUoZGF0ZSk7DQogICAgICAgIHNlbGYubmFtZShuYW1lKTsNCiAgICAgICAgc2VsZi5yZW1hcmsocmVtYXJrKTsNCiAgICAgICAgc2VsZi5jYXRlZ29yeShjYXRlZ29yeSk7DQogICAgICAgIA0KICAgIElkID0gTm9uZTsNCiAgICANCiAgICANCiAgICAjIGFjdGl2ZTogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9hY3RpdmUgPSBOb25lOw0KICAgIGRlZiBhY3RpdmUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fYWN0aXZlID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2FjdGl2ZTsNCg0KDQogICAgDQogICAgIyBlbmFibGVkOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2VuYWJsZWQgPSBOb25lOw0KICAgIGRlZiBlbmFibGVkKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2VuYWJsZWQgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fZW5hYmxlZDsNCg0KDQogICAgDQogICAgIyBjb2RlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2NvZGUgPSBOb25lOw0KICAgIGRlZiBjb2RlKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2NvZGUgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fY29kZTsNCg0KDQogICAgDQogICAgIyBvcmRlcjogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9vcmRlciA9IE5vbmU7DQogICAgZGVmIG9yZGVyKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX29yZGVyID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX29yZGVyOw0KDQoNCiAgICANCiAgICAjIGRhdGU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfZGF0ZSA9IE5vbmU7DQogICAgZGVmIGRhdGUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fZGF0ZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9kYXRlOw0KDQoNCiAgICANCiAgICAjIG5hbWU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfbmFtZSA9IE5vbmU7DQogICAgZGVmIG5hbWUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fbmFtZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9uYW1lOw0KDQoNCiAgICANCiAgICAjIHJlbWFyazogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9yZW1hcmsgPSBOb25lOw0KICAgIGRlZiByZW1hcmsoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fcmVtYXJrID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3JlbWFyazsNCg0KDQogICAgDQogICAgIyBjYXRlZ29yeTogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9jYXRlZ29yeSA9IE5vbmU7DQogICAgZGVmIGNhdGVnb3J5KHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2NhdGVnb3J5ID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2NhdGVnb3J5Ow0KDQoNCiAgICANCiAgICANCiAgICBkZWYgX2Zyb21Eb2N1bWVudChzZWxmLCBvYmopOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ0RldmljZV9UeXBlOjpfZnJvbURvY3VtZW50KCk6ICc7DQoNCiAgICAgICAgaWYgb2JqIGlzIE5vbmU6DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgDQogICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLCBieXRlcyk6DQogICAgICAgICAgICBvYmogPSBzdHIob2JqLCAidXRmLTgiKTsNCg0KICAgICAgICBpZiBpc2luc3RhbmNlKG9iaiwgc3RyKSBvciB0eXBlKG9iaikgaXMgc3RyOg0KICAgICAgICAgICAgb2JqID0ganNvbi5sb2FkcyhvYmopOw0KICAgICAgICANCiAgICAgICAgaWYgbm90IGlzaW5zdGFuY2Uob2JqLCAoc3RyLCBieXRlcywgZGljdCkpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICdHT1QgSEVSRTogJyArIHN0cih0eXBlKG9iaikpKTsNCiAgICAgICAgICAgIHJldHVybiBvYmo7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGZvciBpIGluIG9iajoNCiAgICAgICAgICAgICAgICBvYmpbaV0gPSBEZXZpY2VfVHlwZSgpLl9mcm9tRG9jdW1lbnQob2JqW2ldKTsNCiAgICAgICAgICAgIHJldHVybiBvYmo7DQoNCg0KICAgICAgICBpZiAnSWQnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuSWQgPSBvYmpbJ0lkJ107DQoNCiAgICANCiAgICAgICAgaWYgJ2FjdGl2ZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5hY3RpdmUob2JqWydhY3RpdmUnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnZW5hYmxlZCcgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5lbmFibGVkKG9ialsnZW5hYmxlZCddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdjb2RlJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmNvZGUob2JqWydjb2RlJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ29yZGVyJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLm9yZGVyKG9ialsnb3JkZXInXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnZGF0ZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5kYXRlKG9ialsnZGF0ZSddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICduYW1lJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLm5hbWUob2JqWyduYW1lJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ3JlbWFyaycgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5yZW1hcmsob2JqWydyZW1hcmsnXSk7DQogICAgICAgIA0KICAgICAgICAgICAgc2VsZi5yZW1hcmsoIGJhc2U2NC5iNjRlbmNvZGUoc2VsZi5yZW1hcmsoKS5lbmNvZGUoImFzY2lpIikpLmRlY29kZSgiYXNjaWkiKSApOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ2NhdGVnb3J5JyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmNhdGVnb3J5KERldmljZV9DYXRlZ29yeSgpLl9mcm9tRG9jdW1lbnQob2JqWydjYXRlZ29yeSddKSk7DQogICAgICAgIA0KICAgIA0KDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgDQogICAgZGVmIF90b0RvY3VtZW50KHNlbGYpOg0KICAgICAgICByZXQgPSB7fTsNCiAgICAgICAgaWYgc2VsZi5JZCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiSWQiXSA9IHNlbGYuSWQ7DQoNCiAgICANCiAgICAgICAgaWYgc2VsZi5hY3RpdmUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiYWN0aXZlIl0gPSBzZWxmLmFjdGl2ZSgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5lbmFibGVkKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbImVuYWJsZWQiXSA9IHNlbGYuZW5hYmxlZCgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5jb2RlKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbImNvZGUiXSA9IHNlbGYuY29kZSgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5vcmRlcigpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJvcmRlciJdID0gc2VsZi5vcmRlcigpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5kYXRlKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbImRhdGUiXSA9IHNlbGYuZGF0ZSgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5uYW1lKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbIm5hbWUiXSA9IHNlbGYubmFtZSgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5yZW1hcmsoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSBzZWxmLnJlbWFyaygpOw0KICAgICAgICANCiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UocmV0WyJyZW1hcmsiXSwgZGljdCk6DQogICAgICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IGpzb24uZHVtcHMocmV0WyJyZW1hcmsiXSk7DQogICAgICAgICAgICByZXRbInJlbWFyayJdID0gdWJpbmFzY2lpLmIyYV9iYXNlNjQocmV0WyJyZW1hcmsiXSkuc3RyaXAoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYuY2F0ZWdvcnkoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiY2F0ZWdvcnkiXSA9IHNlbGYuY2F0ZWdvcnkoKS5fdG9Eb2N1bWVudCgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgcmV0dXJuIHJldDsNCg0KICAgIA0KICAgIGRlZiBzdG9yZShzZWxmLCBfX2V2ZW50PU5vbmUpOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ0RldmljZV9UeXBlOjpzdG9yZSgpOiAnOw0KICAgICAgICANCiAgICAgICAgZXZKU09OID0gTm9uZTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgZXZKU09OID0ganNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046DQogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOw0KICAgICAgICANCg0KICAgICAgICBhbnN3ZXIgPSBOb25lOw0KDQogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aW1lLnRpbWUoKSkrJ10uRGV2aWNlX1R5cGUuc3RvcmUoKScpLm1ldGhvZCgnc3RvcmUnKS5jbGFzc05hbWUoJ0RldmljZV9UeXBlJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOw0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsNCiAgICAgICAgDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQogICAgICAgIA0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgIGFuc3dlciA9IERldmljZV9UeXBlKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCiAgICAgICAgDQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KDQoNCg0KICAgICAgICBpZiAnRGV2aWNlX1R5cGVfc3RvcmUnIGluIGRpcigpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICc9PT4gRGV2aWNlX1R5cGVfc3RvcmUoKScpOw0KICAgICAgICAgICAgYW5zd2VyID0gRGV2aWNlX1R5cGVfc3RvcmUoc2VsZiwgX19ldmVudCwgYW5zd2VyLCBfX3RvU3RyaW5nKTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCg0KICAgICAgICByZXR1cm4gYW5zd2VyOw0KDQogICAgDQogICAgZGVmIGZpbmRBbGwoc2VsZiwgX19ldmVudD1Ob25lKToNCiAgICAgICAgX190b1N0cmluZyA9ICdEZXZpY2VfVHlwZTo6ZmluZEFsbCgpOiAnOw0KICAgICAgICANCiAgICAgICAgZXZKU09OID0gTm9uZTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgZXZKU09OID0ganNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046DQogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOw0KICAgICAgICANCg0KICAgICAgICBhbnN3ZXIgPSBOb25lOw0KDQogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aW1lLnRpbWUoKSkrJ10uRGV2aWNlX1R5cGUuZmluZEFsbCgpJykubWV0aG9kKCdmaW5kQWxsJykuY2xhc3NOYW1lKCdEZXZpY2VfVHlwZScpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7DQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KICAgICAgICANCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICBhbnN3ZXIgPSBEZXZpY2VfVHlwZSgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQogICAgICAgIA0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCg0KDQoNCiAgICAgICAgaWYgJ0RldmljZV9UeXBlX2ZpbmRBbGwnIGluIGRpcigpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICc9PT4gRGV2aWNlX1R5cGVfZmluZEFsbCgpJyk7DQogICAgICAgICAgICBhbnN3ZXIgPSBEZXZpY2VfVHlwZV9maW5kQWxsKHNlbGYsIF9fZXZlbnQsIGFuc3dlciwgX190b1N0cmluZyk7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KDQogICAgICAgICAgICANCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQoNCiAgICAgICAgcmV0dXJuIGFuc3dlcjsNCg0KICAgIA0KICAgIGRlZiBmaW5kKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6DQogICAgICAgIF9fdG9TdHJpbmcgPSAnRGV2aWNlX1R5cGU6OmZpbmQoKTogJzsNCiAgICAgICAgDQogICAgICAgIGV2SlNPTiA9IE5vbmU7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIGV2SlNPTiA9IGpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOg0KICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsNCiAgICAgICAgDQoNCiAgICAgICAgYW5zd2VyID0gTm9uZTsNCg0KICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGltZS50aW1lKCkpKyddLkRldmljZV9UeXBlLmZpbmQoKScpLm1ldGhvZCgnZmluZCcpLmNsYXNzTmFtZSgnRGV2aWNlX1R5cGUnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOw0KICAgICAgICANCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCiAgICAgICAgDQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgYW5zd2VyID0gRGV2aWNlX1R5cGUoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KICAgICAgICANCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQoNCg0KDQogICAgICAgIGlmICdEZXZpY2VfVHlwZV9maW5kJyBpbiBkaXIoKToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnPT0+IERldmljZV9UeXBlX2ZpbmQoKScpOw0KICAgICAgICAgICAgYW5zd2VyID0gRGV2aWNlX1R5cGVfZmluZChzZWxmLCBfX2V2ZW50LCBhbnN3ZXIsIF9fdG9TdHJpbmcpOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCg0KICAgICAgICAgICAgDQogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KDQogICAgICAgIHJldHVybiBhbnN3ZXI7DQoNCiAgICANCg0KDQpjbGFzcyBNZXRyaWNfR3JvdXAoKToNCiAgICBkZWYgX19pbml0X18oc2VsZiwgSWQ9Tm9uZSwgYWN0aXZlPU5vbmUsIGVuYWJsZWQ9Tm9uZSwgY29kZT1Ob25lLCBvcmRlcj1Ob25lLCBkYXRlPU5vbmUsIG5hbWU9Tm9uZSwgcmVtYXJrPU5vbmUpOg0KICAgICAgICBzdXBlcigpLl9faW5pdF9fKCk7DQoNCiAgICAgICAgI3ByaW50KCdNZXRyaWNfR3JvdXA6Ol9faW5pdF9fKCknKTsNCiAgICAgICAgaWYgSWQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBzZWxmLklkID0gSWQ7DQoNCiAgICAgICAgDQogICAgICAgIHNlbGYuYWN0aXZlKGFjdGl2ZSk7DQogICAgICAgIHNlbGYuZW5hYmxlZChlbmFibGVkKTsNCiAgICAgICAgc2VsZi5jb2RlKGNvZGUpOw0KICAgICAgICBzZWxmLm9yZGVyKG9yZGVyKTsNCiAgICAgICAgc2VsZi5kYXRlKGRhdGUpOw0KICAgICAgICBzZWxmLm5hbWUobmFtZSk7DQogICAgICAgIHNlbGYucmVtYXJrKHJlbWFyayk7DQogICAgICAgIA0KICAgIElkID0gTm9uZTsNCiAgICANCiAgICANCiAgICAjIGFjdGl2ZTogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9hY3RpdmUgPSBOb25lOw0KICAgIGRlZiBhY3RpdmUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fYWN0aXZlID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2FjdGl2ZTsNCg0KDQogICAgDQogICAgIyBlbmFibGVkOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2VuYWJsZWQgPSBOb25lOw0KICAgIGRlZiBlbmFibGVkKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2VuYWJsZWQgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fZW5hYmxlZDsNCg0KDQogICAgDQogICAgIyBjb2RlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2NvZGUgPSBOb25lOw0KICAgIGRlZiBjb2RlKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2NvZGUgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fY29kZTsNCg0KDQogICAgDQogICAgIyBvcmRlcjogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9vcmRlciA9IE5vbmU7DQogICAgZGVmIG9yZGVyKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX29yZGVyID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX29yZGVyOw0KDQoNCiAgICANCiAgICAjIGRhdGU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfZGF0ZSA9IE5vbmU7DQogICAgZGVmIGRhdGUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fZGF0ZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9kYXRlOw0KDQoNCiAgICANCiAgICAjIG5hbWU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfbmFtZSA9IE5vbmU7DQogICAgZGVmIG5hbWUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fbmFtZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9uYW1lOw0KDQoNCiAgICANCiAgICAjIHJlbWFyazogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9yZW1hcmsgPSBOb25lOw0KICAgIGRlZiByZW1hcmsoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fcmVtYXJrID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3JlbWFyazsNCg0KDQogICAgDQogICAgDQogICAgZGVmIF9mcm9tRG9jdW1lbnQoc2VsZiwgb2JqKToNCiAgICAgICAgX190b1N0cmluZyA9ICdNZXRyaWNfR3JvdXA6Ol9mcm9tRG9jdW1lbnQoKTogJzsNCg0KICAgICAgICBpZiBvYmogaXMgTm9uZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICANCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIGJ5dGVzKToNCiAgICAgICAgICAgIG9iaiA9IHN0cihvYmosICJ1dGYtOCIpOw0KDQogICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLCBzdHIpIG9yIHR5cGUob2JqKSBpcyBzdHI6DQogICAgICAgICAgICBvYmogPSBqc29uLmxvYWRzKG9iaik7DQogICAgICAgIA0KICAgICAgICBpZiBub3QgaXNpbnN0YW5jZShvYmosIChzdHIsIGJ5dGVzLCBkaWN0KSk6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJ0dPVCBIRVJFOiAnICsgc3RyKHR5cGUob2JqKSkpOw0KICAgICAgICAgICAgcmV0dXJuIG9iajsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZm9yIGkgaW4gb2JqOg0KICAgICAgICAgICAgICAgIG9ialtpXSA9IE1ldHJpY19Hcm91cCgpLl9mcm9tRG9jdW1lbnQob2JqW2ldKTsNCiAgICAgICAgICAgIHJldHVybiBvYmo7DQoNCg0KICAgICAgICBpZiAnSWQnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuSWQgPSBvYmpbJ0lkJ107DQoNCiAgICANCiAgICAgICAgaWYgJ2FjdGl2ZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5hY3RpdmUob2JqWydhY3RpdmUnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnZW5hYmxlZCcgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5lbmFibGVkKG9ialsnZW5hYmxlZCddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdjb2RlJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmNvZGUob2JqWydjb2RlJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ29yZGVyJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLm9yZGVyKG9ialsnb3JkZXInXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnZGF0ZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5kYXRlKG9ialsnZGF0ZSddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICduYW1lJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLm5hbWUob2JqWyduYW1lJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ3JlbWFyaycgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5yZW1hcmsob2JqWydyZW1hcmsnXSk7DQogICAgICAgIA0KICAgICAgICAgICAgc2VsZi5yZW1hcmsoIGJhc2U2NC5iNjRlbmNvZGUoc2VsZi5yZW1hcmsoKS5lbmNvZGUoImFzY2lpIikpLmRlY29kZSgiYXNjaWkiKSApOw0KICAgICAgICANCiAgICANCg0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIHJldHVybiBzZWxmOw0KICAgIA0KICAgIGRlZiBfdG9Eb2N1bWVudChzZWxmKToNCiAgICAgICAgcmV0ID0ge307DQogICAgICAgIGlmIHNlbGYuSWQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbIklkIl0gPSBzZWxmLklkOw0KDQogICAgDQogICAgICAgIGlmIHNlbGYuYWN0aXZlKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbImFjdGl2ZSJdID0gc2VsZi5hY3RpdmUoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYuZW5hYmxlZCgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJlbmFibGVkIl0gPSBzZWxmLmVuYWJsZWQoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYuY29kZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJjb2RlIl0gPSBzZWxmLmNvZGUoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYub3JkZXIoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsib3JkZXIiXSA9IHNlbGYub3JkZXIoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYuZGF0ZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJkYXRlIl0gPSBzZWxmLmRhdGUoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYubmFtZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJuYW1lIl0gPSBzZWxmLm5hbWUoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYucmVtYXJrKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbInJlbWFyayJdID0gc2VsZi5yZW1hcmsoKTsNCiAgICAgICAgDQogICAgICAgICAgICBpZiBpc2luc3RhbmNlKHJldFsicmVtYXJrIl0sIGRpY3QpOg0KICAgICAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSBqc29uLmR1bXBzKHJldFsicmVtYXJrIl0pOw0KICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IHViaW5hc2NpaS5iMmFfYmFzZTY0KHJldFsicmVtYXJrIl0pLnN0cmlwKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICANCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICByZXR1cm4gcmV0Ow0KDQogICAgDQogICAgZGVmIHN0b3JlKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6DQogICAgICAgIF9fdG9TdHJpbmcgPSAnTWV0cmljX0dyb3VwOjpzdG9yZSgpOiAnOw0KICAgICAgICANCiAgICAgICAgZXZKU09OID0gTm9uZTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgZXZKU09OID0ganNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046DQogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOw0KICAgICAgICANCg0KICAgICAgICBhbnN3ZXIgPSBOb25lOw0KDQogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aW1lLnRpbWUoKSkrJ10uTWV0cmljX0dyb3VwLnN0b3JlKCknKS5tZXRob2QoJ3N0b3JlJykuY2xhc3NOYW1lKCdNZXRyaWNfR3JvdXAnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOw0KICAgICAgICANCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCiAgICAgICAgDQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgYW5zd2VyID0gTWV0cmljX0dyb3VwKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCiAgICAgICAgDQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KDQoNCg0KICAgICAgICBpZiAnTWV0cmljX0dyb3VwX3N0b3JlJyBpbiBkaXIoKToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnPT0+IE1ldHJpY19Hcm91cF9zdG9yZSgpJyk7DQogICAgICAgICAgICBhbnN3ZXIgPSBNZXRyaWNfR3JvdXBfc3RvcmUoc2VsZiwgX19ldmVudCwgYW5zd2VyLCBfX3RvU3RyaW5nKTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCg0KICAgICAgICByZXR1cm4gYW5zd2VyOw0KDQogICAgDQogICAgZGVmIGZpbmRBbGwoc2VsZiwgX19ldmVudD1Ob25lKToNCiAgICAgICAgX190b1N0cmluZyA9ICdNZXRyaWNfR3JvdXA6OmZpbmRBbGwoKTogJzsNCiAgICAgICAgDQogICAgICAgIGV2SlNPTiA9IE5vbmU7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIGV2SlNPTiA9IGpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOg0KICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsNCiAgICAgICAgDQoNCiAgICAgICAgYW5zd2VyID0gTm9uZTsNCg0KICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGltZS50aW1lKCkpKyddLk1ldHJpY19Hcm91cC5maW5kQWxsKCknKS5tZXRob2QoJ2ZpbmRBbGwnKS5jbGFzc05hbWUoJ01ldHJpY19Hcm91cCcpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7DQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KICAgICAgICANCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICBhbnN3ZXIgPSBNZXRyaWNfR3JvdXAoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KICAgICAgICANCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQoNCg0KDQogICAgICAgIGlmICdNZXRyaWNfR3JvdXBfZmluZEFsbCcgaW4gZGlyKCk6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJz09PiBNZXRyaWNfR3JvdXBfZmluZEFsbCgpJyk7DQogICAgICAgICAgICBhbnN3ZXIgPSBNZXRyaWNfR3JvdXBfZmluZEFsbChzZWxmLCBfX2V2ZW50LCBhbnN3ZXIsIF9fdG9TdHJpbmcpOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCg0KICAgICAgICAgICAgDQogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KDQogICAgICAgIHJldHVybiBhbnN3ZXI7DQoNCiAgICANCiAgICBkZWYgZmluZChzZWxmLCBfX2V2ZW50PU5vbmUpOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ01ldHJpY19Hcm91cDo6ZmluZCgpOiAnOw0KICAgICAgICANCiAgICAgICAgZXZKU09OID0gTm9uZTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgZXZKU09OID0ganNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046DQogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOw0KICAgICAgICANCg0KICAgICAgICBhbnN3ZXIgPSBOb25lOw0KDQogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aW1lLnRpbWUoKSkrJ10uTWV0cmljX0dyb3VwLmZpbmQoKScpLm1ldGhvZCgnZmluZCcpLmNsYXNzTmFtZSgnTWV0cmljX0dyb3VwJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOw0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsNCiAgICAgICAgDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQogICAgICAgIA0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgIGFuc3dlciA9IE1ldHJpY19Hcm91cCgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQogICAgICAgIA0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCg0KDQoNCiAgICAgICAgaWYgJ01ldHJpY19Hcm91cF9maW5kJyBpbiBkaXIoKToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnPT0+IE1ldHJpY19Hcm91cF9maW5kKCknKTsNCiAgICAgICAgICAgIGFuc3dlciA9IE1ldHJpY19Hcm91cF9maW5kKHNlbGYsIF9fZXZlbnQsIGFuc3dlciwgX190b1N0cmluZyk7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KDQogICAgICAgICAgICANCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQoNCiAgICAgICAgcmV0dXJuIGFuc3dlcjsNCg0KICAgIA0KDQoNCmNsYXNzIE1ldHJpY19UeXBlKCk6DQogICAgZGVmIF9faW5pdF9fKHNlbGYsIElkPU5vbmUsIGFjdGl2ZT1Ob25lLCBlbmFibGVkPU5vbmUsIGNvZGU9Tm9uZSwgb3JkZXI9Tm9uZSwgZGF0ZT1Ob25lLCBuYW1lPU5vbmUsIHJlbWFyaz1Ob25lLCBncm91cD1Ob25lKToNCiAgICAgICAgc3VwZXIoKS5fX2luaXRfXygpOw0KDQogICAgICAgICNwcmludCgnTWV0cmljX1R5cGU6Ol9faW5pdF9fKCknKTsNCiAgICAgICAgaWYgSWQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBzZWxmLklkID0gSWQ7DQoNCiAgICAgICAgDQogICAgICAgIHNlbGYuYWN0aXZlKGFjdGl2ZSk7DQogICAgICAgIHNlbGYuZW5hYmxlZChlbmFibGVkKTsNCiAgICAgICAgc2VsZi5jb2RlKGNvZGUpOw0KICAgICAgICBzZWxmLm9yZGVyKG9yZGVyKTsNCiAgICAgICAgc2VsZi5kYXRlKGRhdGUpOw0KICAgICAgICBzZWxmLm5hbWUobmFtZSk7DQogICAgICAgIHNlbGYucmVtYXJrKHJlbWFyayk7DQogICAgICAgIHNlbGYuZ3JvdXAoZ3JvdXApOw0KICAgICAgICANCiAgICBJZCA9IE5vbmU7DQogICAgDQogICAgDQogICAgIyBhY3RpdmU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfYWN0aXZlID0gTm9uZTsNCiAgICBkZWYgYWN0aXZlKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2FjdGl2ZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9hY3RpdmU7DQoNCg0KICAgIA0KICAgICMgZW5hYmxlZDogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9lbmFibGVkID0gTm9uZTsNCiAgICBkZWYgZW5hYmxlZChzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9lbmFibGVkID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2VuYWJsZWQ7DQoNCg0KICAgIA0KICAgICMgY29kZTogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9jb2RlID0gTm9uZTsNCiAgICBkZWYgY29kZShzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9jb2RlID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2NvZGU7DQoNCg0KICAgIA0KICAgICMgb3JkZXI6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfb3JkZXIgPSBOb25lOw0KICAgIGRlZiBvcmRlcihzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9vcmRlciA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9vcmRlcjsNCg0KDQogICAgDQogICAgIyBkYXRlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2RhdGUgPSBOb25lOw0KICAgIGRlZiBkYXRlKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2RhdGUgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fZGF0ZTsNCg0KDQogICAgDQogICAgIyBuYW1lOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX25hbWUgPSBOb25lOw0KICAgIGRlZiBuYW1lKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX25hbWUgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fbmFtZTsNCg0KDQogICAgDQogICAgIyByZW1hcms6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfcmVtYXJrID0gTm9uZTsNCiAgICBkZWYgcmVtYXJrKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX3JlbWFyayA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9yZW1hcms7DQoNCg0KICAgIA0KICAgICMgZ3JvdXA6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfZ3JvdXAgPSBOb25lOw0KICAgIGRlZiBncm91cChzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9ncm91cCA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9ncm91cDsNCg0KDQogICAgDQogICAgDQogICAgZGVmIF9mcm9tRG9jdW1lbnQoc2VsZiwgb2JqKToNCiAgICAgICAgX190b1N0cmluZyA9ICdNZXRyaWNfVHlwZTo6X2Zyb21Eb2N1bWVudCgpOiAnOw0KDQogICAgICAgIGlmIG9iaiBpcyBOb25lOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIA0KICAgICAgICBpZiBpc2luc3RhbmNlKG9iaiwgYnl0ZXMpOg0KICAgICAgICAgICAgb2JqID0gc3RyKG9iaiwgInV0Zi04Iik7DQoNCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIHN0cikgb3IgdHlwZShvYmopIGlzIHN0cjoNCiAgICAgICAgICAgIG9iaiA9IGpzb24ubG9hZHMob2JqKTsNCiAgICAgICAgDQogICAgICAgIGlmIG5vdCBpc2luc3RhbmNlKG9iaiwgKHN0ciwgYnl0ZXMsIGRpY3QpKToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnR09UIEhFUkU6ICcgKyBzdHIodHlwZShvYmopKSk7DQogICAgICAgICAgICByZXR1cm4gb2JqOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBmb3IgaSBpbiBvYmo6DQogICAgICAgICAgICAgICAgb2JqW2ldID0gTWV0cmljX1R5cGUoKS5fZnJvbURvY3VtZW50KG9ialtpXSk7DQogICAgICAgICAgICByZXR1cm4gb2JqOw0KDQoNCiAgICAgICAgaWYgJ0lkJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLklkID0gb2JqWydJZCddOw0KDQogICAgDQogICAgICAgIGlmICdhY3RpdmUnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuYWN0aXZlKG9ialsnYWN0aXZlJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ2VuYWJsZWQnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuZW5hYmxlZChvYmpbJ2VuYWJsZWQnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnY29kZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5jb2RlKG9ialsnY29kZSddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdvcmRlcicgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5vcmRlcihvYmpbJ29yZGVyJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ2RhdGUnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuZGF0ZShvYmpbJ2RhdGUnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnbmFtZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5uYW1lKG9ialsnbmFtZSddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdyZW1hcmsnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYucmVtYXJrKG9ialsncmVtYXJrJ10pOw0KICAgICAgICANCiAgICAgICAgICAgIHNlbGYucmVtYXJrKCBiYXNlNjQuYjY0ZW5jb2RlKHNlbGYucmVtYXJrKCkuZW5jb2RlKCJhc2NpaSIpKS5kZWNvZGUoImFzY2lpIikgKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdncm91cCcgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5ncm91cChNZXRyaWNfR3JvdXAoKS5fZnJvbURvY3VtZW50KG9ialsnZ3JvdXAnXSkpOw0KICAgICAgICANCiAgICANCg0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIHJldHVybiBzZWxmOw0KICAgIA0KICAgIGRlZiBfdG9Eb2N1bWVudChzZWxmKToNCiAgICAgICAgcmV0ID0ge307DQogICAgICAgIGlmIHNlbGYuSWQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbIklkIl0gPSBzZWxmLklkOw0KDQogICAgDQogICAgICAgIGlmIHNlbGYuYWN0aXZlKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbImFjdGl2ZSJdID0gc2VsZi5hY3RpdmUoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYuZW5hYmxlZCgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJlbmFibGVkIl0gPSBzZWxmLmVuYWJsZWQoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYuY29kZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJjb2RlIl0gPSBzZWxmLmNvZGUoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYub3JkZXIoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsib3JkZXIiXSA9IHNlbGYub3JkZXIoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYuZGF0ZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJkYXRlIl0gPSBzZWxmLmRhdGUoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYubmFtZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJuYW1lIl0gPSBzZWxmLm5hbWUoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYucmVtYXJrKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbInJlbWFyayJdID0gc2VsZi5yZW1hcmsoKTsNCiAgICAgICAgDQogICAgICAgICAgICBpZiBpc2luc3RhbmNlKHJldFsicmVtYXJrIl0sIGRpY3QpOg0KICAgICAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSBqc29uLmR1bXBzKHJldFsicmVtYXJrIl0pOw0KICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IHViaW5hc2NpaS5iMmFfYmFzZTY0KHJldFsicmVtYXJrIl0pLnN0cmlwKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmdyb3VwKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbImdyb3VwIl0gPSBzZWxmLmdyb3VwKCkuX3RvRG9jdW1lbnQoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIHJldHVybiByZXQ7DQoNCiAgICANCiAgICBkZWYgc3RvcmUoc2VsZiwgX19ldmVudD1Ob25lKToNCiAgICAgICAgX190b1N0cmluZyA9ICdNZXRyaWNfVHlwZTo6c3RvcmUoKTogJzsNCiAgICAgICAgDQogICAgICAgIGV2SlNPTiA9IE5vbmU7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIGV2SlNPTiA9IGpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOg0KICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsNCiAgICAgICAgDQoNCiAgICAgICAgYW5zd2VyID0gTm9uZTsNCg0KICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGltZS50aW1lKCkpKyddLk1ldHJpY19UeXBlLnN0b3JlKCknKS5tZXRob2QoJ3N0b3JlJykuY2xhc3NOYW1lKCdNZXRyaWNfVHlwZScpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7DQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KICAgICAgICANCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICBhbnN3ZXIgPSBNZXRyaWNfVHlwZSgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQogICAgICAgIA0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCg0KDQoNCiAgICAgICAgaWYgJ01ldHJpY19UeXBlX3N0b3JlJyBpbiBkaXIoKToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnPT0+IE1ldHJpY19UeXBlX3N0b3JlKCknKTsNCiAgICAgICAgICAgIGFuc3dlciA9IE1ldHJpY19UeXBlX3N0b3JlKHNlbGYsIF9fZXZlbnQsIGFuc3dlciwgX190b1N0cmluZyk7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KDQogICAgICAgICAgICANCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQoNCiAgICAgICAgcmV0dXJuIGFuc3dlcjsNCg0KICAgIA0KICAgIGRlZiBmaW5kQWxsKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6DQogICAgICAgIF9fdG9TdHJpbmcgPSAnTWV0cmljX1R5cGU6OmZpbmRBbGwoKTogJzsNCiAgICAgICAgDQogICAgICAgIGV2SlNPTiA9IE5vbmU7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIGV2SlNPTiA9IGpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOg0KICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsNCiAgICAgICAgDQoNCiAgICAgICAgYW5zd2VyID0gTm9uZTsNCg0KICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGltZS50aW1lKCkpKyddLk1ldHJpY19UeXBlLmZpbmRBbGwoKScpLm1ldGhvZCgnZmluZEFsbCcpLmNsYXNzTmFtZSgnTWV0cmljX1R5cGUnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOw0KICAgICAgICANCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCiAgICAgICAgDQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgYW5zd2VyID0gTWV0cmljX1R5cGUoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KICAgICAgICANCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQoNCg0KDQogICAgICAgIGlmICdNZXRyaWNfVHlwZV9maW5kQWxsJyBpbiBkaXIoKToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnPT0+IE1ldHJpY19UeXBlX2ZpbmRBbGwoKScpOw0KICAgICAgICAgICAgYW5zd2VyID0gTWV0cmljX1R5cGVfZmluZEFsbChzZWxmLCBfX2V2ZW50LCBhbnN3ZXIsIF9fdG9TdHJpbmcpOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCg0KICAgICAgICAgICAgDQogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KDQogICAgICAgIHJldHVybiBhbnN3ZXI7DQoNCiAgICANCiAgICBkZWYgZmluZChzZWxmLCBfX2V2ZW50PU5vbmUpOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ01ldHJpY19UeXBlOjpmaW5kKCk6ICc7DQogICAgICAgIA0KICAgICAgICBldkpTT04gPSBOb25lOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBldkpTT04gPSBqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoNCiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7DQogICAgICAgIA0KDQogICAgICAgIGFuc3dlciA9IE5vbmU7DQoNCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpbWUudGltZSgpKSsnXS5NZXRyaWNfVHlwZS5maW5kKCknKS5tZXRob2QoJ2ZpbmQnKS5jbGFzc05hbWUoJ01ldHJpY19UeXBlJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOw0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsNCiAgICAgICAgDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQogICAgICAgIA0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgIGFuc3dlciA9IE1ldHJpY19UeXBlKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCiAgICAgICAgDQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KDQoNCg0KICAgICAgICBpZiAnTWV0cmljX1R5cGVfZmluZCcgaW4gZGlyKCk6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJz09PiBNZXRyaWNfVHlwZV9maW5kKCknKTsNCiAgICAgICAgICAgIGFuc3dlciA9IE1ldHJpY19UeXBlX2ZpbmQoc2VsZiwgX19ldmVudCwgYW5zd2VyLCBfX3RvU3RyaW5nKTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCg0KICAgICAgICByZXR1cm4gYW5zd2VyOw0KDQogICAgDQoNCg0KY2xhc3MgTWV0cmljX1ZhbHVlKCk6DQogICAgZGVmIF9faW5pdF9fKHNlbGYsIElkPU5vbmUsIGFjdGl2ZT1Ob25lLCBlbmFibGVkPU5vbmUsIGNvZGU9Tm9uZSwgb3JkZXI9Tm9uZSwgZGF0ZT1Ob25lLCBuYW1lPU5vbmUsIHJlbWFyaz1Ob25lLCB2YWx1ZT1Ob25lLCBtZXRyaWM9Tm9uZSwgZGV2aWNlPU5vbmUsIGNvbnRyb2xsZXI9Tm9uZSwgZXhlY3V0aW9uPU5vbmUpOg0KICAgICAgICBzdXBlcigpLl9faW5pdF9fKCk7DQoNCiAgICAgICAgI3ByaW50KCdNZXRyaWNfVmFsdWU6Ol9faW5pdF9fKCknKTsNCiAgICAgICAgaWYgSWQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBzZWxmLklkID0gSWQ7DQoNCiAgICAgICAgDQogICAgICAgIHNlbGYuYWN0aXZlKGFjdGl2ZSk7DQogICAgICAgIHNlbGYuZW5hYmxlZChlbmFibGVkKTsNCiAgICAgICAgc2VsZi5jb2RlKGNvZGUpOw0KICAgICAgICBzZWxmLm9yZGVyKG9yZGVyKTsNCiAgICAgICAgc2VsZi5kYXRlKGRhdGUpOw0KICAgICAgICBzZWxmLm5hbWUobmFtZSk7DQogICAgICAgIHNlbGYucmVtYXJrKHJlbWFyayk7DQogICAgICAgIHNlbGYudmFsdWUodmFsdWUpOw0KICAgICAgICBzZWxmLm1ldHJpYyhtZXRyaWMpOw0KICAgICAgICBzZWxmLmRldmljZShkZXZpY2UpOw0KICAgICAgICBzZWxmLmNvbnRyb2xsZXIoY29udHJvbGxlcik7DQogICAgICAgIHNlbGYuZXhlY3V0aW9uKGV4ZWN1dGlvbik7DQogICAgICAgIA0KICAgIElkID0gTm9uZTsNCiAgICANCiAgICANCiAgICAjIGFjdGl2ZTogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9hY3RpdmUgPSBOb25lOw0KICAgIGRlZiBhY3RpdmUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fYWN0aXZlID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2FjdGl2ZTsNCg0KDQogICAgDQogICAgIyBlbmFibGVkOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2VuYWJsZWQgPSBOb25lOw0KICAgIGRlZiBlbmFibGVkKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2VuYWJsZWQgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fZW5hYmxlZDsNCg0KDQogICAgDQogICAgIyBjb2RlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2NvZGUgPSBOb25lOw0KICAgIGRlZiBjb2RlKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2NvZGUgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fY29kZTsNCg0KDQogICAgDQogICAgIyBvcmRlcjogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9vcmRlciA9IE5vbmU7DQogICAgZGVmIG9yZGVyKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX29yZGVyID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX29yZGVyOw0KDQoNCiAgICANCiAgICAjIGRhdGU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfZGF0ZSA9IE5vbmU7DQogICAgZGVmIGRhdGUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fZGF0ZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9kYXRlOw0KDQoNCiAgICANCiAgICAjIG5hbWU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfbmFtZSA9IE5vbmU7DQogICAgZGVmIG5hbWUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fbmFtZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9uYW1lOw0KDQoNCiAgICANCiAgICAjIHJlbWFyazogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9yZW1hcmsgPSBOb25lOw0KICAgIGRlZiByZW1hcmsoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fcmVtYXJrID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3JlbWFyazsNCg0KDQogICAgDQogICAgIyB2YWx1ZTogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF92YWx1ZSA9IE5vbmU7DQogICAgZGVmIHZhbHVlKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX3ZhbHVlID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3ZhbHVlOw0KDQoNCiAgICANCiAgICAjIG1ldHJpYzogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9tZXRyaWMgPSBOb25lOw0KICAgIGRlZiBtZXRyaWMoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fbWV0cmljID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX21ldHJpYzsNCg0KDQogICAgDQogICAgIyBkZXZpY2U6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfZGV2aWNlID0gTm9uZTsNCiAgICBkZWYgZGV2aWNlKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2RldmljZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9kZXZpY2U7DQoNCg0KICAgIA0KICAgICMgY29udHJvbGxlcjogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9jb250cm9sbGVyID0gTm9uZTsNCiAgICBkZWYgY29udHJvbGxlcihzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9jb250cm9sbGVyID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2NvbnRyb2xsZXI7DQoNCg0KICAgIA0KICAgICMgZXhlY3V0aW9uOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2V4ZWN1dGlvbiA9IE5vbmU7DQogICAgZGVmIGV4ZWN1dGlvbihzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9leGVjdXRpb24gPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fZXhlY3V0aW9uOw0KDQoNCiAgICANCiAgICANCiAgICBkZWYgX2Zyb21Eb2N1bWVudChzZWxmLCBvYmopOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ01ldHJpY19WYWx1ZTo6X2Zyb21Eb2N1bWVudCgpOiAnOw0KDQogICAgICAgIGlmIG9iaiBpcyBOb25lOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIA0KICAgICAgICBpZiBpc2luc3RhbmNlKG9iaiwgYnl0ZXMpOg0KICAgICAgICAgICAgb2JqID0gc3RyKG9iaiwgInV0Zi04Iik7DQoNCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIHN0cikgb3IgdHlwZShvYmopIGlzIHN0cjoNCiAgICAgICAgICAgIG9iaiA9IGpzb24ubG9hZHMob2JqKTsNCiAgICAgICAgDQogICAgICAgIGlmIG5vdCBpc2luc3RhbmNlKG9iaiwgKHN0ciwgYnl0ZXMsIGRpY3QpKToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnR09UIEhFUkU6ICcgKyBzdHIodHlwZShvYmopKSk7DQogICAgICAgICAgICByZXR1cm4gb2JqOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBmb3IgaSBpbiBvYmo6DQogICAgICAgICAgICAgICAgb2JqW2ldID0gTWV0cmljX1ZhbHVlKCkuX2Zyb21Eb2N1bWVudChvYmpbaV0pOw0KICAgICAgICAgICAgcmV0dXJuIG9iajsNCg0KDQogICAgICAgIGlmICdJZCcgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5JZCA9IG9ialsnSWQnXTsNCg0KICAgIA0KICAgICAgICBpZiAnYWN0aXZlJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmFjdGl2ZShvYmpbJ2FjdGl2ZSddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdlbmFibGVkJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmVuYWJsZWQob2JqWydlbmFibGVkJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ2NvZGUnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuY29kZShvYmpbJ2NvZGUnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnb3JkZXInIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYub3JkZXIob2JqWydvcmRlciddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdkYXRlJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmRhdGUob2JqWydkYXRlJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ25hbWUnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYubmFtZShvYmpbJ25hbWUnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAncmVtYXJrJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLnJlbWFyayhvYmpbJ3JlbWFyayddKTsNCiAgICAgICAgDQogICAgICAgICAgICBzZWxmLnJlbWFyayggYmFzZTY0LmI2NGVuY29kZShzZWxmLnJlbWFyaygpLmVuY29kZSgiYXNjaWkiKSkuZGVjb2RlKCJhc2NpaSIpICk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAndmFsdWUnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYudmFsdWUob2JqWyd2YWx1ZSddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdtZXRyaWMnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYubWV0cmljKE1ldHJpYygpLl9mcm9tRG9jdW1lbnQob2JqWydtZXRyaWMnXSkpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ2RldmljZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5kZXZpY2UoRGV2aWNlKCkuX2Zyb21Eb2N1bWVudChvYmpbJ2RldmljZSddKSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnY29udHJvbGxlcicgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5jb250cm9sbGVyKE5vZGUoKS5fZnJvbURvY3VtZW50KG9ialsnY29udHJvbGxlciddKSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnZXhlY3V0aW9uJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmV4ZWN1dGlvbihvYmpbJ2V4ZWN1dGlvbiddKTsNCiAgICAgICAgDQogICAgDQoNCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICByZXR1cm4gc2VsZjsNCiAgICANCiAgICBkZWYgX3RvRG9jdW1lbnQoc2VsZik6DQogICAgICAgIHJldCA9IHt9Ow0KICAgICAgICBpZiBzZWxmLklkIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJJZCJdID0gc2VsZi5JZDsNCg0KICAgIA0KICAgICAgICBpZiBzZWxmLmFjdGl2ZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJhY3RpdmUiXSA9IHNlbGYuYWN0aXZlKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmVuYWJsZWQoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiZW5hYmxlZCJdID0gc2VsZi5lbmFibGVkKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmNvZGUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiY29kZSJdID0gc2VsZi5jb2RlKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLm9yZGVyKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbIm9yZGVyIl0gPSBzZWxmLm9yZGVyKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmRhdGUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiZGF0ZSJdID0gc2VsZi5kYXRlKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLm5hbWUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsibmFtZSJdID0gc2VsZi5uYW1lKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLnJlbWFyaygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IHNlbGYucmVtYXJrKCk7DQogICAgICAgIA0KICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShyZXRbInJlbWFyayJdLCBkaWN0KToNCiAgICAgICAgICAgICAgICByZXRbInJlbWFyayJdID0ganNvbi5kdW1wcyhyZXRbInJlbWFyayJdKTsNCiAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSB1YmluYXNjaWkuYjJhX2Jhc2U2NChyZXRbInJlbWFyayJdKS5zdHJpcCgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi52YWx1ZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJ2YWx1ZSJdID0gc2VsZi52YWx1ZSgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5tZXRyaWMoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsibWV0cmljIl0gPSBzZWxmLm1ldHJpYygpLl90b0RvY3VtZW50KCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmRldmljZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJkZXZpY2UiXSA9IHNlbGYuZGV2aWNlKCkuX3RvRG9jdW1lbnQoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYuY29udHJvbGxlcigpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJjb250cm9sbGVyIl0gPSBzZWxmLmNvbnRyb2xsZXIoKS5fdG9Eb2N1bWVudCgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5leGVjdXRpb24oKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiZXhlY3V0aW9uIl0gPSBzZWxmLmV4ZWN1dGlvbigpOw0KICAgICAgICANCiAgICANCiAgICAgICAgDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgcmV0dXJuIHJldDsNCg0KICAgIA0KICAgIGRlZiBzdG9yZShzZWxmLCBfX2V2ZW50PU5vbmUpOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ01ldHJpY19WYWx1ZTo6c3RvcmUoKTogJzsNCiAgICAgICAgDQogICAgICAgIGV2SlNPTiA9IE5vbmU7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIGV2SlNPTiA9IGpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOg0KICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsNCiAgICAgICAgDQoNCiAgICAgICAgYW5zd2VyID0gTm9uZTsNCg0KICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGltZS50aW1lKCkpKyddLk1ldHJpY19WYWx1ZS5zdG9yZSgpJykubWV0aG9kKCdzdG9yZScpLmNsYXNzTmFtZSgnTWV0cmljX1ZhbHVlJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOw0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsNCiAgICAgICAgDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQogICAgICAgIA0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgIGFuc3dlciA9IE1ldHJpY19WYWx1ZSgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQogICAgICAgIA0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCg0KDQoNCiAgICAgICAgaWYgJ01ldHJpY19WYWx1ZV9zdG9yZScgaW4gZGlyKCk6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJz09PiBNZXRyaWNfVmFsdWVfc3RvcmUoKScpOw0KICAgICAgICAgICAgYW5zd2VyID0gTWV0cmljX1ZhbHVlX3N0b3JlKHNlbGYsIF9fZXZlbnQsIGFuc3dlciwgX190b1N0cmluZyk7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KDQogICAgICAgICAgICANCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQoNCiAgICAgICAgcmV0dXJuIGFuc3dlcjsNCg0KICAgIA0KICAgIGRlZiBmaW5kQWxsKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6DQogICAgICAgIF9fdG9TdHJpbmcgPSAnTWV0cmljX1ZhbHVlOjpmaW5kQWxsKCk6ICc7DQogICAgICAgIA0KICAgICAgICBldkpTT04gPSBOb25lOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBldkpTT04gPSBqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoNCiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7DQogICAgICAgIA0KDQogICAgICAgIGFuc3dlciA9IE5vbmU7DQoNCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpbWUudGltZSgpKSsnXS5NZXRyaWNfVmFsdWUuZmluZEFsbCgpJykubWV0aG9kKCdmaW5kQWxsJykuY2xhc3NOYW1lKCdNZXRyaWNfVmFsdWUnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOw0KICAgICAgICANCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCiAgICAgICAgDQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgYW5zd2VyID0gTWV0cmljX1ZhbHVlKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCiAgICAgICAgDQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KDQoNCg0KICAgICAgICBpZiAnTWV0cmljX1ZhbHVlX2ZpbmRBbGwnIGluIGRpcigpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICc9PT4gTWV0cmljX1ZhbHVlX2ZpbmRBbGwoKScpOw0KICAgICAgICAgICAgYW5zd2VyID0gTWV0cmljX1ZhbHVlX2ZpbmRBbGwoc2VsZiwgX19ldmVudCwgYW5zd2VyLCBfX3RvU3RyaW5nKTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCg0KICAgICAgICByZXR1cm4gYW5zd2VyOw0KDQogICAgDQogICAgZGVmIGZpbmQoc2VsZiwgX19ldmVudD1Ob25lKToNCiAgICAgICAgX190b1N0cmluZyA9ICdNZXRyaWNfVmFsdWU6OmZpbmQoKTogJzsNCiAgICAgICAgDQogICAgICAgIGV2SlNPTiA9IE5vbmU7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIGV2SlNPTiA9IGpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOg0KICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsNCiAgICAgICAgDQoNCiAgICAgICAgYW5zd2VyID0gTm9uZTsNCg0KICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGltZS50aW1lKCkpKyddLk1ldHJpY19WYWx1ZS5maW5kKCknKS5tZXRob2QoJ2ZpbmQnKS5jbGFzc05hbWUoJ01ldHJpY19WYWx1ZScpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7DQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KICAgICAgICANCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICBhbnN3ZXIgPSBNZXRyaWNfVmFsdWUoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KICAgICAgICANCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQoNCg0KDQogICAgICAgIGlmICdNZXRyaWNfVmFsdWVfZmluZCcgaW4gZGlyKCk6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJz09PiBNZXRyaWNfVmFsdWVfZmluZCgpJyk7DQogICAgICAgICAgICBhbnN3ZXIgPSBNZXRyaWNfVmFsdWVfZmluZChzZWxmLCBfX2V2ZW50LCBhbnN3ZXIsIF9fdG9TdHJpbmcpOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCg0KICAgICAgICAgICAgDQogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KDQogICAgICAgIHJldHVybiBhbnN3ZXI7DQoNCiAgICANCg0KDQpjbGFzcyBNZXRyaWMoKToNCiAgICBkZWYgX19pbml0X18oc2VsZiwgSWQ9Tm9uZSwgYWN0aXZlPU5vbmUsIGVuYWJsZWQ9Tm9uZSwgY29kZT1Ob25lLCBvcmRlcj1Ob25lLCBkYXRlPU5vbmUsIG5hbWU9Tm9uZSwgcmVtYXJrPU5vbmUsIHR5cGU9Tm9uZSwgZGV2aWNlVHlwZT1Ob25lKToNCiAgICAgICAgc3VwZXIoKS5fX2luaXRfXygpOw0KDQogICAgICAgICNwcmludCgnTWV0cmljOjpfX2luaXRfXygpJyk7DQogICAgICAgIGlmIElkIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgc2VsZi5JZCA9IElkOw0KDQogICAgICAgIA0KICAgICAgICBzZWxmLmFjdGl2ZShhY3RpdmUpOw0KICAgICAgICBzZWxmLmVuYWJsZWQoZW5hYmxlZCk7DQogICAgICAgIHNlbGYuY29kZShjb2RlKTsNCiAgICAgICAgc2VsZi5vcmRlcihvcmRlcik7DQogICAgICAgIHNlbGYuZGF0ZShkYXRlKTsNCiAgICAgICAgc2VsZi5uYW1lKG5hbWUpOw0KICAgICAgICBzZWxmLnJlbWFyayhyZW1hcmspOw0KICAgICAgICBzZWxmLnR5cGUodHlwZSk7DQogICAgICAgIHNlbGYuZGV2aWNlVHlwZShkZXZpY2VUeXBlKTsNCiAgICAgICAgDQogICAgSWQgPSBOb25lOw0KICAgIA0KICAgIA0KICAgICMgYWN0aXZlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2FjdGl2ZSA9IE5vbmU7DQogICAgZGVmIGFjdGl2ZShzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9hY3RpdmUgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fYWN0aXZlOw0KDQoNCiAgICANCiAgICAjIGVuYWJsZWQ6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfZW5hYmxlZCA9IE5vbmU7DQogICAgZGVmIGVuYWJsZWQoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fZW5hYmxlZCA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9lbmFibGVkOw0KDQoNCiAgICANCiAgICAjIGNvZGU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfY29kZSA9IE5vbmU7DQogICAgZGVmIGNvZGUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fY29kZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9jb2RlOw0KDQoNCiAgICANCiAgICAjIG9yZGVyOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX29yZGVyID0gTm9uZTsNCiAgICBkZWYgb3JkZXIoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fb3JkZXIgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fb3JkZXI7DQoNCg0KICAgIA0KICAgICMgZGF0ZTogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9kYXRlID0gTm9uZTsNCiAgICBkZWYgZGF0ZShzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9kYXRlID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2RhdGU7DQoNCg0KICAgIA0KICAgICMgbmFtZTogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9uYW1lID0gTm9uZTsNCiAgICBkZWYgbmFtZShzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9uYW1lID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX25hbWU7DQoNCg0KICAgIA0KICAgICMgcmVtYXJrOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX3JlbWFyayA9IE5vbmU7DQogICAgZGVmIHJlbWFyayhzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9yZW1hcmsgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fcmVtYXJrOw0KDQoNCiAgICANCiAgICAjIHR5cGU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfdHlwZSA9IE5vbmU7DQogICAgZGVmIHR5cGUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fdHlwZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl90eXBlOw0KDQoNCiAgICANCiAgICAjIGRldmljZVR5cGU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfZGV2aWNlVHlwZSA9IE5vbmU7DQogICAgZGVmIGRldmljZVR5cGUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fZGV2aWNlVHlwZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9kZXZpY2VUeXBlOw0KDQoNCiAgICANCiAgICANCiAgICBkZWYgX2Zyb21Eb2N1bWVudChzZWxmLCBvYmopOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ01ldHJpYzo6X2Zyb21Eb2N1bWVudCgpOiAnOw0KDQogICAgICAgIGlmIG9iaiBpcyBOb25lOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIA0KICAgICAgICBpZiBpc2luc3RhbmNlKG9iaiwgYnl0ZXMpOg0KICAgICAgICAgICAgb2JqID0gc3RyKG9iaiwgInV0Zi04Iik7DQoNCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIHN0cikgb3IgdHlwZShvYmopIGlzIHN0cjoNCiAgICAgICAgICAgIG9iaiA9IGpzb24ubG9hZHMob2JqKTsNCiAgICAgICAgDQogICAgICAgIGlmIG5vdCBpc2luc3RhbmNlKG9iaiwgKHN0ciwgYnl0ZXMsIGRpY3QpKToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnR09UIEhFUkU6ICcgKyBzdHIodHlwZShvYmopKSk7DQogICAgICAgICAgICByZXR1cm4gb2JqOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBmb3IgaSBpbiBvYmo6DQogICAgICAgICAgICAgICAgb2JqW2ldID0gTWV0cmljKCkuX2Zyb21Eb2N1bWVudChvYmpbaV0pOw0KICAgICAgICAgICAgcmV0dXJuIG9iajsNCg0KDQogICAgICAgIGlmICdJZCcgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5JZCA9IG9ialsnSWQnXTsNCg0KICAgIA0KICAgICAgICBpZiAnYWN0aXZlJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmFjdGl2ZShvYmpbJ2FjdGl2ZSddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdlbmFibGVkJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmVuYWJsZWQob2JqWydlbmFibGVkJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ2NvZGUnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuY29kZShvYmpbJ2NvZGUnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnb3JkZXInIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYub3JkZXIob2JqWydvcmRlciddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdkYXRlJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmRhdGUob2JqWydkYXRlJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ25hbWUnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYubmFtZShvYmpbJ25hbWUnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAncmVtYXJrJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLnJlbWFyayhvYmpbJ3JlbWFyayddKTsNCiAgICAgICAgDQogICAgICAgICAgICBzZWxmLnJlbWFyayggYmFzZTY0LmI2NGVuY29kZShzZWxmLnJlbWFyaygpLmVuY29kZSgiYXNjaWkiKSkuZGVjb2RlKCJhc2NpaSIpICk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAndHlwZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi50eXBlKE1ldHJpY19UeXBlKCkuX2Zyb21Eb2N1bWVudChvYmpbJ3R5cGUnXSkpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ2RldmljZVR5cGUnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuZGV2aWNlVHlwZShEZXZpY2VfVHlwZSgpLl9mcm9tRG9jdW1lbnQob2JqWydkZXZpY2VUeXBlJ10pKTsNCiAgICAgICAgDQogICAgDQoNCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICByZXR1cm4gc2VsZjsNCiAgICANCiAgICBkZWYgX3RvRG9jdW1lbnQoc2VsZik6DQogICAgICAgIHJldCA9IHt9Ow0KICAgICAgICBpZiBzZWxmLklkIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJJZCJdID0gc2VsZi5JZDsNCg0KICAgIA0KICAgICAgICBpZiBzZWxmLmFjdGl2ZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJhY3RpdmUiXSA9IHNlbGYuYWN0aXZlKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmVuYWJsZWQoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiZW5hYmxlZCJdID0gc2VsZi5lbmFibGVkKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmNvZGUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiY29kZSJdID0gc2VsZi5jb2RlKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLm9yZGVyKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbIm9yZGVyIl0gPSBzZWxmLm9yZGVyKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmRhdGUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiZGF0ZSJdID0gc2VsZi5kYXRlKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLm5hbWUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsibmFtZSJdID0gc2VsZi5uYW1lKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLnJlbWFyaygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IHNlbGYucmVtYXJrKCk7DQogICAgICAgIA0KICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShyZXRbInJlbWFyayJdLCBkaWN0KToNCiAgICAgICAgICAgICAgICByZXRbInJlbWFyayJdID0ganNvbi5kdW1wcyhyZXRbInJlbWFyayJdKTsNCiAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSB1YmluYXNjaWkuYjJhX2Jhc2U2NChyZXRbInJlbWFyayJdKS5zdHJpcCgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi50eXBlKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbInR5cGUiXSA9IHNlbGYudHlwZSgpLl90b0RvY3VtZW50KCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmRldmljZVR5cGUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiZGV2aWNlVHlwZSJdID0gc2VsZi5kZXZpY2VUeXBlKCkuX3RvRG9jdW1lbnQoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIHJldHVybiByZXQ7DQoNCiAgICANCiAgICBkZWYgc3RvcmUoc2VsZiwgX19ldmVudD1Ob25lKToNCiAgICAgICAgX190b1N0cmluZyA9ICdNZXRyaWM6OnN0b3JlKCk6ICc7DQogICAgICAgIA0KICAgICAgICBldkpTT04gPSBOb25lOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBldkpTT04gPSBqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoNCiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7DQogICAgICAgIA0KDQogICAgICAgIGFuc3dlciA9IE5vbmU7DQoNCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpbWUudGltZSgpKSsnXS5NZXRyaWMuc3RvcmUoKScpLm1ldGhvZCgnc3RvcmUnKS5jbGFzc05hbWUoJ01ldHJpYycpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7DQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KICAgICAgICANCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICBhbnN3ZXIgPSBNZXRyaWMoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KICAgICAgICANCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQoNCg0KDQogICAgICAgIGlmICdNZXRyaWNfc3RvcmUnIGluIGRpcigpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICc9PT4gTWV0cmljX3N0b3JlKCknKTsNCiAgICAgICAgICAgIGFuc3dlciA9IE1ldHJpY19zdG9yZShzZWxmLCBfX2V2ZW50LCBhbnN3ZXIsIF9fdG9TdHJpbmcpOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCg0KICAgICAgICAgICAgDQogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KDQogICAgICAgIHJldHVybiBhbnN3ZXI7DQoNCiAgICANCiAgICBkZWYgZmluZEFsbChzZWxmLCBfX2V2ZW50PU5vbmUpOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ01ldHJpYzo6ZmluZEFsbCgpOiAnOw0KICAgICAgICANCiAgICAgICAgZXZKU09OID0gTm9uZTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgZXZKU09OID0ganNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046DQogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOw0KICAgICAgICANCg0KICAgICAgICBhbnN3ZXIgPSBOb25lOw0KDQogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aW1lLnRpbWUoKSkrJ10uTWV0cmljLmZpbmRBbGwoKScpLm1ldGhvZCgnZmluZEFsbCcpLmNsYXNzTmFtZSgnTWV0cmljJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOw0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsNCiAgICAgICAgDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQogICAgICAgIA0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgIGFuc3dlciA9IE1ldHJpYygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQogICAgICAgIA0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCg0KDQoNCiAgICAgICAgaWYgJ01ldHJpY19maW5kQWxsJyBpbiBkaXIoKToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnPT0+IE1ldHJpY19maW5kQWxsKCknKTsNCiAgICAgICAgICAgIGFuc3dlciA9IE1ldHJpY19maW5kQWxsKHNlbGYsIF9fZXZlbnQsIGFuc3dlciwgX190b1N0cmluZyk7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KDQogICAgICAgICAgICANCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQoNCiAgICAgICAgcmV0dXJuIGFuc3dlcjsNCg0KICAgIA0KICAgIGRlZiBmaW5kKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6DQogICAgICAgIF9fdG9TdHJpbmcgPSAnTWV0cmljOjpmaW5kKCk6ICc7DQogICAgICAgIA0KICAgICAgICBldkpTT04gPSBOb25lOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBldkpTT04gPSBqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoNCiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7DQogICAgICAgIA0KDQogICAgICAgIGFuc3dlciA9IE5vbmU7DQoNCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpbWUudGltZSgpKSsnXS5NZXRyaWMuZmluZCgpJykubWV0aG9kKCdmaW5kJykuY2xhc3NOYW1lKCdNZXRyaWMnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOw0KICAgICAgICANCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCiAgICAgICAgDQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgYW5zd2VyID0gTWV0cmljKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCiAgICAgICAgDQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KDQoNCg0KICAgICAgICBpZiAnTWV0cmljX2ZpbmQnIGluIGRpcigpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICc9PT4gTWV0cmljX2ZpbmQoKScpOw0KICAgICAgICAgICAgYW5zd2VyID0gTWV0cmljX2ZpbmQoc2VsZiwgX19ldmVudCwgYW5zd2VyLCBfX3RvU3RyaW5nKTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCg0KICAgICAgICByZXR1cm4gYW5zd2VyOw0KDQogICAgDQoNCg0KY2xhc3MgQ29uZmlnKCk6DQogICAgZGVmIF9faW5pdF9fKHNlbGYsIElkPU5vbmUsIGFjdGl2ZT1Ob25lLCBlbmFibGVkPU5vbmUsIGNvZGU9Tm9uZSwgb3JkZXI9Tm9uZSwgZGF0ZT1Ob25lLCBuYW1lPU5vbmUsIHJlbWFyaz1Ob25lLCB2YWx1ZT1Ob25lLCBzY3JpcHQ9Tm9uZSwgdG9vbD1Ob25lLCBncm91cD1Ob25lLCB0eXBlPU5vbmUsIG5vZGU9Tm9uZSk6DQogICAgICAgIHN1cGVyKCkuX19pbml0X18oKTsNCg0KICAgICAgICAjcHJpbnQoJ0NvbmZpZzo6X19pbml0X18oKScpOw0KICAgICAgICBpZiBJZCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHNlbGYuSWQgPSBJZDsNCg0KICAgICAgICANCiAgICAgICAgc2VsZi5hY3RpdmUoYWN0aXZlKTsNCiAgICAgICAgc2VsZi5lbmFibGVkKGVuYWJsZWQpOw0KICAgICAgICBzZWxmLmNvZGUoY29kZSk7DQogICAgICAgIHNlbGYub3JkZXIob3JkZXIpOw0KICAgICAgICBzZWxmLmRhdGUoZGF0ZSk7DQogICAgICAgIHNlbGYubmFtZShuYW1lKTsNCiAgICAgICAgc2VsZi5yZW1hcmsocmVtYXJrKTsNCiAgICAgICAgc2VsZi52YWx1ZSh2YWx1ZSk7DQogICAgICAgIHNlbGYuc2NyaXB0KHNjcmlwdCk7DQogICAgICAgIHNlbGYudG9vbCh0b29sKTsNCiAgICAgICAgc2VsZi5ncm91cChncm91cCk7DQogICAgICAgIHNlbGYudHlwZSh0eXBlKTsNCiAgICAgICAgc2VsZi5ub2RlKG5vZGUpOw0KICAgICAgICANCiAgICBJZCA9IE5vbmU7DQogICAgDQogICAgDQogICAgIyBhY3RpdmU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfYWN0aXZlID0gTm9uZTsNCiAgICBkZWYgYWN0aXZlKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2FjdGl2ZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9hY3RpdmU7DQoNCg0KICAgIA0KICAgICMgZW5hYmxlZDogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9lbmFibGVkID0gTm9uZTsNCiAgICBkZWYgZW5hYmxlZChzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9lbmFibGVkID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2VuYWJsZWQ7DQoNCg0KICAgIA0KICAgICMgY29kZTogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9jb2RlID0gTm9uZTsNCiAgICBkZWYgY29kZShzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9jb2RlID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2NvZGU7DQoNCg0KICAgIA0KICAgICMgb3JkZXI6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfb3JkZXIgPSBOb25lOw0KICAgIGRlZiBvcmRlcihzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9vcmRlciA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9vcmRlcjsNCg0KDQogICAgDQogICAgIyBkYXRlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2RhdGUgPSBOb25lOw0KICAgIGRlZiBkYXRlKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2RhdGUgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fZGF0ZTsNCg0KDQogICAgDQogICAgIyBuYW1lOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX25hbWUgPSBOb25lOw0KICAgIGRlZiBuYW1lKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX25hbWUgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fbmFtZTsNCg0KDQogICAgDQogICAgIyByZW1hcms6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfcmVtYXJrID0gTm9uZTsNCiAgICBkZWYgcmVtYXJrKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX3JlbWFyayA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9yZW1hcms7DQoNCg0KICAgIA0KICAgICMgdmFsdWU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfdmFsdWUgPSBOb25lOw0KICAgIGRlZiB2YWx1ZShzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl92YWx1ZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl92YWx1ZTsNCg0KDQogICAgDQogICAgIyBzY3JpcHQ6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfc2NyaXB0ID0gTm9uZTsNCiAgICBkZWYgc2NyaXB0KHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX3NjcmlwdCA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9zY3JpcHQ7DQoNCg0KICAgIA0KICAgICMgdG9vbDogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF90b29sID0gTm9uZTsNCiAgICBkZWYgdG9vbChzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl90b29sID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3Rvb2w7DQoNCg0KICAgIA0KICAgICMgZ3JvdXA6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfZ3JvdXAgPSBOb25lOw0KICAgIGRlZiBncm91cChzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9ncm91cCA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9ncm91cDsNCg0KDQogICAgDQogICAgIyB0eXBlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX3R5cGUgPSBOb25lOw0KICAgIGRlZiB0eXBlKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX3R5cGUgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fdHlwZTsNCg0KDQogICAgDQogICAgIyBub2RlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX25vZGUgPSBOb25lOw0KICAgIGRlZiBub2RlKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX25vZGUgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fbm9kZTsNCg0KDQogICAgDQogICAgDQogICAgZGVmIF9mcm9tRG9jdW1lbnQoc2VsZiwgb2JqKToNCiAgICAgICAgX190b1N0cmluZyA9ICdDb25maWc6Ol9mcm9tRG9jdW1lbnQoKTogJzsNCg0KICAgICAgICBpZiBvYmogaXMgTm9uZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICANCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIGJ5dGVzKToNCiAgICAgICAgICAgIG9iaiA9IHN0cihvYmosICJ1dGYtOCIpOw0KDQogICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLCBzdHIpIG9yIHR5cGUob2JqKSBpcyBzdHI6DQogICAgICAgICAgICBvYmogPSBqc29uLmxvYWRzKG9iaik7DQogICAgICAgIA0KICAgICAgICBpZiBub3QgaXNpbnN0YW5jZShvYmosIChzdHIsIGJ5dGVzLCBkaWN0KSk6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJ0dPVCBIRVJFOiAnICsgc3RyKHR5cGUob2JqKSkpOw0KICAgICAgICAgICAgcmV0dXJuIG9iajsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZm9yIGkgaW4gb2JqOg0KICAgICAgICAgICAgICAgIG9ialtpXSA9IENvbmZpZygpLl9mcm9tRG9jdW1lbnQob2JqW2ldKTsNCiAgICAgICAgICAgIHJldHVybiBvYmo7DQoNCg0KICAgICAgICBpZiAnSWQnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuSWQgPSBvYmpbJ0lkJ107DQoNCiAgICANCiAgICAgICAgaWYgJ2FjdGl2ZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5hY3RpdmUob2JqWydhY3RpdmUnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnZW5hYmxlZCcgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5lbmFibGVkKG9ialsnZW5hYmxlZCddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdjb2RlJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmNvZGUob2JqWydjb2RlJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ29yZGVyJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLm9yZGVyKG9ialsnb3JkZXInXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnZGF0ZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5kYXRlKG9ialsnZGF0ZSddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICduYW1lJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLm5hbWUob2JqWyduYW1lJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ3JlbWFyaycgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5yZW1hcmsob2JqWydyZW1hcmsnXSk7DQogICAgICAgIA0KICAgICAgICAgICAgc2VsZi5yZW1hcmsoIGJhc2U2NC5iNjRlbmNvZGUoc2VsZi5yZW1hcmsoKS5lbmNvZGUoImFzY2lpIikpLmRlY29kZSgiYXNjaWkiKSApOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ3ZhbHVlJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLnZhbHVlKG9ialsndmFsdWUnXSk7DQogICAgICAgIA0KICAgICAgICAgICAgc2VsZi52YWx1ZSggYmFzZTY0LmI2NGVuY29kZShzZWxmLnZhbHVlKCkuZW5jb2RlKCJhc2NpaSIpKS5kZWNvZGUoImFzY2lpIikgKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdzY3JpcHQnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuc2NyaXB0KG9ialsnc2NyaXB0J10pOw0KICAgICAgICANCiAgICAgICAgICAgIHNlbGYuc2NyaXB0KCBiYXNlNjQuYjY0ZW5jb2RlKHNlbGYuc2NyaXB0KCkuZW5jb2RlKCJhc2NpaSIpKS5kZWNvZGUoImFzY2lpIikgKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICd0b29sJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLnRvb2woVG9vbCgpLl9mcm9tRG9jdW1lbnQob2JqWyd0b29sJ10pKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdncm91cCcgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5ncm91cChDb25maWdfR3JvdXAoKS5fZnJvbURvY3VtZW50KG9ialsnZ3JvdXAnXSkpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ3R5cGUnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYudHlwZShUb29sX1R5cGUoKS5fZnJvbURvY3VtZW50KG9ialsndHlwZSddKSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnbm9kZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5ub2RlKE5vZGUoKS5fZnJvbURvY3VtZW50KG9ialsnbm9kZSddKSk7DQogICAgICAgIA0KICAgIA0KDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgDQogICAgZGVmIF90b0RvY3VtZW50KHNlbGYpOg0KICAgICAgICByZXQgPSB7fTsNCiAgICAgICAgaWYgc2VsZi5JZCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiSWQiXSA9IHNlbGYuSWQ7DQoNCiAgICANCiAgICAgICAgaWYgc2VsZi5hY3RpdmUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiYWN0aXZlIl0gPSBzZWxmLmFjdGl2ZSgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5lbmFibGVkKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbImVuYWJsZWQiXSA9IHNlbGYuZW5hYmxlZCgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5jb2RlKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbImNvZGUiXSA9IHNlbGYuY29kZSgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5vcmRlcigpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJvcmRlciJdID0gc2VsZi5vcmRlcigpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5kYXRlKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbImRhdGUiXSA9IHNlbGYuZGF0ZSgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5uYW1lKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbIm5hbWUiXSA9IHNlbGYubmFtZSgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5yZW1hcmsoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSBzZWxmLnJlbWFyaygpOw0KICAgICAgICANCiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UocmV0WyJyZW1hcmsiXSwgZGljdCk6DQogICAgICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IGpzb24uZHVtcHMocmV0WyJyZW1hcmsiXSk7DQogICAgICAgICAgICByZXRbInJlbWFyayJdID0gdWJpbmFzY2lpLmIyYV9iYXNlNjQocmV0WyJyZW1hcmsiXSkuc3RyaXAoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYudmFsdWUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsidmFsdWUiXSA9IHNlbGYudmFsdWUoKTsNCiAgICAgICAgDQogICAgICAgICAgICBpZiBpc2luc3RhbmNlKHJldFsidmFsdWUiXSwgZGljdCk6DQogICAgICAgICAgICAgICAgcmV0WyJ2YWx1ZSJdID0ganNvbi5kdW1wcyhyZXRbInZhbHVlIl0pOw0KICAgICAgICAgICAgcmV0WyJ2YWx1ZSJdID0gdWJpbmFzY2lpLmIyYV9iYXNlNjQocmV0WyJ2YWx1ZSJdKS5zdHJpcCgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5zY3JpcHQoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsic2NyaXB0Il0gPSBzZWxmLnNjcmlwdCgpOw0KICAgICAgICANCiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UocmV0WyJzY3JpcHQiXSwgZGljdCk6DQogICAgICAgICAgICAgICAgcmV0WyJzY3JpcHQiXSA9IGpzb24uZHVtcHMocmV0WyJzY3JpcHQiXSk7DQogICAgICAgICAgICByZXRbInNjcmlwdCJdID0gdWJpbmFzY2lpLmIyYV9iYXNlNjQocmV0WyJzY3JpcHQiXSkuc3RyaXAoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYudG9vbCgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJ0b29sIl0gPSBzZWxmLnRvb2woKS5fdG9Eb2N1bWVudCgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5ncm91cCgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJncm91cCJdID0gc2VsZi5ncm91cCgpLl90b0RvY3VtZW50KCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLnR5cGUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsidHlwZSJdID0gc2VsZi50eXBlKCkuX3RvRG9jdW1lbnQoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYubm9kZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJub2RlIl0gPSBzZWxmLm5vZGUoKS5fdG9Eb2N1bWVudCgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgcmV0dXJuIHJldDsNCg0KICAgIA0KICAgIGRlZiBzdG9yZShzZWxmLCBfX2V2ZW50PU5vbmUpOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ0NvbmZpZzo6c3RvcmUoKTogJzsNCiAgICAgICAgDQogICAgICAgIGV2SlNPTiA9IE5vbmU7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIGV2SlNPTiA9IGpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOg0KICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsNCiAgICAgICAgDQoNCiAgICAgICAgYW5zd2VyID0gTm9uZTsNCg0KICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGltZS50aW1lKCkpKyddLkNvbmZpZy5zdG9yZSgpJykubWV0aG9kKCdzdG9yZScpLmNsYXNzTmFtZSgnQ29uZmlnJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOw0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsNCiAgICAgICAgDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQogICAgICAgIA0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgIGFuc3dlciA9IENvbmZpZygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQogICAgICAgIA0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCg0KDQoNCiAgICAgICAgaWYgJ0NvbmZpZ19zdG9yZScgaW4gZGlyKCk6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJz09PiBDb25maWdfc3RvcmUoKScpOw0KICAgICAgICAgICAgYW5zd2VyID0gQ29uZmlnX3N0b3JlKHNlbGYsIF9fZXZlbnQsIGFuc3dlciwgX190b1N0cmluZyk7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KDQogICAgICAgICAgICANCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQoNCiAgICAgICAgcmV0dXJuIGFuc3dlcjsNCg0KICAgIA0KICAgIGRlZiBmaW5kQWxsKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6DQogICAgICAgIF9fdG9TdHJpbmcgPSAnQ29uZmlnOjpmaW5kQWxsKCk6ICc7DQogICAgICAgIA0KICAgICAgICBldkpTT04gPSBOb25lOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBldkpTT04gPSBqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoNCiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7DQogICAgICAgIA0KDQogICAgICAgIGFuc3dlciA9IE5vbmU7DQoNCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpbWUudGltZSgpKSsnXS5Db25maWcuZmluZEFsbCgpJykubWV0aG9kKCdmaW5kQWxsJykuY2xhc3NOYW1lKCdDb25maWcnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOw0KICAgICAgICANCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCiAgICAgICAgDQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgYW5zd2VyID0gQ29uZmlnKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCiAgICAgICAgDQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KDQoNCg0KICAgICAgICBpZiAnQ29uZmlnX2ZpbmRBbGwnIGluIGRpcigpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICc9PT4gQ29uZmlnX2ZpbmRBbGwoKScpOw0KICAgICAgICAgICAgYW5zd2VyID0gQ29uZmlnX2ZpbmRBbGwoc2VsZiwgX19ldmVudCwgYW5zd2VyLCBfX3RvU3RyaW5nKTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCg0KICAgICAgICByZXR1cm4gYW5zd2VyOw0KDQogICAgDQogICAgZGVmIGZpbmQoc2VsZiwgX19ldmVudD1Ob25lKToNCiAgICAgICAgX190b1N0cmluZyA9ICdDb25maWc6OmZpbmQoKTogJzsNCiAgICAgICAgDQogICAgICAgIGV2SlNPTiA9IE5vbmU7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIGV2SlNPTiA9IGpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOg0KICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsNCiAgICAgICAgDQoNCiAgICAgICAgYW5zd2VyID0gTm9uZTsNCg0KICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGltZS50aW1lKCkpKyddLkNvbmZpZy5maW5kKCknKS5tZXRob2QoJ2ZpbmQnKS5jbGFzc05hbWUoJ0NvbmZpZycpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7DQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KICAgICAgICANCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICBhbnN3ZXIgPSBDb25maWcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KICAgICAgICANCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQoNCg0KDQogICAgICAgIGlmICdDb25maWdfZmluZCcgaW4gZGlyKCk6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJz09PiBDb25maWdfZmluZCgpJyk7DQogICAgICAgICAgICBhbnN3ZXIgPSBDb25maWdfZmluZChzZWxmLCBfX2V2ZW50LCBhbnN3ZXIsIF9fdG9TdHJpbmcpOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCg0KICAgICAgICAgICAgDQogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KDQogICAgICAgIHJldHVybiBhbnN3ZXI7DQoNCiAgICANCg0KDQpjbGFzcyBUb29sKCk6DQogICAgZGVmIF9faW5pdF9fKHNlbGYsIElkPU5vbmUsIGFjdGl2ZT1Ob25lLCBlbmFibGVkPU5vbmUsIGNvZGU9Tm9uZSwgb3JkZXI9Tm9uZSwgZGF0ZT1Ob25lLCBuYW1lPU5vbmUsIHJlbWFyaz1Ob25lLCB0eXBlPU5vbmUpOg0KICAgICAgICBzdXBlcigpLl9faW5pdF9fKCk7DQoNCiAgICAgICAgI3ByaW50KCdUb29sOjpfX2luaXRfXygpJyk7DQogICAgICAgIGlmIElkIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgc2VsZi5JZCA9IElkOw0KDQogICAgICAgIA0KICAgICAgICBzZWxmLmFjdGl2ZShhY3RpdmUpOw0KICAgICAgICBzZWxmLmVuYWJsZWQoZW5hYmxlZCk7DQogICAgICAgIHNlbGYuY29kZShjb2RlKTsNCiAgICAgICAgc2VsZi5vcmRlcihvcmRlcik7DQogICAgICAgIHNlbGYuZGF0ZShkYXRlKTsNCiAgICAgICAgc2VsZi5uYW1lKG5hbWUpOw0KICAgICAgICBzZWxmLnJlbWFyayhyZW1hcmspOw0KICAgICAgICBzZWxmLnR5cGUodHlwZSk7DQogICAgICAgIA0KICAgIElkID0gTm9uZTsNCiAgICANCiAgICANCiAgICAjIGFjdGl2ZTogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9hY3RpdmUgPSBOb25lOw0KICAgIGRlZiBhY3RpdmUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fYWN0aXZlID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2FjdGl2ZTsNCg0KDQogICAgDQogICAgIyBlbmFibGVkOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2VuYWJsZWQgPSBOb25lOw0KICAgIGRlZiBlbmFibGVkKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2VuYWJsZWQgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fZW5hYmxlZDsNCg0KDQogICAgDQogICAgIyBjb2RlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2NvZGUgPSBOb25lOw0KICAgIGRlZiBjb2RlKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2NvZGUgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fY29kZTsNCg0KDQogICAgDQogICAgIyBvcmRlcjogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9vcmRlciA9IE5vbmU7DQogICAgZGVmIG9yZGVyKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX29yZGVyID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX29yZGVyOw0KDQoNCiAgICANCiAgICAjIGRhdGU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfZGF0ZSA9IE5vbmU7DQogICAgZGVmIGRhdGUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fZGF0ZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9kYXRlOw0KDQoNCiAgICANCiAgICAjIG5hbWU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfbmFtZSA9IE5vbmU7DQogICAgZGVmIG5hbWUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fbmFtZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9uYW1lOw0KDQoNCiAgICANCiAgICAjIHJlbWFyazogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9yZW1hcmsgPSBOb25lOw0KICAgIGRlZiByZW1hcmsoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fcmVtYXJrID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3JlbWFyazsNCg0KDQogICAgDQogICAgIyB0eXBlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX3R5cGUgPSBOb25lOw0KICAgIGRlZiB0eXBlKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX3R5cGUgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fdHlwZTsNCg0KDQogICAgDQogICAgDQogICAgZGVmIF9mcm9tRG9jdW1lbnQoc2VsZiwgb2JqKToNCiAgICAgICAgX190b1N0cmluZyA9ICdUb29sOjpfZnJvbURvY3VtZW50KCk6ICc7DQoNCiAgICAgICAgaWYgb2JqIGlzIE5vbmU6DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgDQogICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLCBieXRlcyk6DQogICAgICAgICAgICBvYmogPSBzdHIob2JqLCAidXRmLTgiKTsNCg0KICAgICAgICBpZiBpc2luc3RhbmNlKG9iaiwgc3RyKSBvciB0eXBlKG9iaikgaXMgc3RyOg0KICAgICAgICAgICAgb2JqID0ganNvbi5sb2FkcyhvYmopOw0KICAgICAgICANCiAgICAgICAgaWYgbm90IGlzaW5zdGFuY2Uob2JqLCAoc3RyLCBieXRlcywgZGljdCkpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICdHT1QgSEVSRTogJyArIHN0cih0eXBlKG9iaikpKTsNCiAgICAgICAgICAgIHJldHVybiBvYmo7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGZvciBpIGluIG9iajoNCiAgICAgICAgICAgICAgICBvYmpbaV0gPSBUb29sKCkuX2Zyb21Eb2N1bWVudChvYmpbaV0pOw0KICAgICAgICAgICAgcmV0dXJuIG9iajsNCg0KDQogICAgICAgIGlmICdJZCcgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5JZCA9IG9ialsnSWQnXTsNCg0KICAgIA0KICAgICAgICBpZiAnYWN0aXZlJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmFjdGl2ZShvYmpbJ2FjdGl2ZSddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdlbmFibGVkJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmVuYWJsZWQob2JqWydlbmFibGVkJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ2NvZGUnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuY29kZShvYmpbJ2NvZGUnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnb3JkZXInIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYub3JkZXIob2JqWydvcmRlciddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdkYXRlJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmRhdGUob2JqWydkYXRlJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ25hbWUnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYubmFtZShvYmpbJ25hbWUnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAncmVtYXJrJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLnJlbWFyayhvYmpbJ3JlbWFyayddKTsNCiAgICAgICAgDQogICAgICAgICAgICBzZWxmLnJlbWFyayggYmFzZTY0LmI2NGVuY29kZShzZWxmLnJlbWFyaygpLmVuY29kZSgiYXNjaWkiKSkuZGVjb2RlKCJhc2NpaSIpICk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAndHlwZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi50eXBlKFRvb2xfVHlwZSgpLl9mcm9tRG9jdW1lbnQob2JqWyd0eXBlJ10pKTsNCiAgICAgICAgDQogICAgDQoNCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICByZXR1cm4gc2VsZjsNCiAgICANCiAgICBkZWYgX3RvRG9jdW1lbnQoc2VsZik6DQogICAgICAgIHJldCA9IHt9Ow0KICAgICAgICBpZiBzZWxmLklkIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJJZCJdID0gc2VsZi5JZDsNCg0KICAgIA0KICAgICAgICBpZiBzZWxmLmFjdGl2ZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJhY3RpdmUiXSA9IHNlbGYuYWN0aXZlKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmVuYWJsZWQoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiZW5hYmxlZCJdID0gc2VsZi5lbmFibGVkKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmNvZGUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiY29kZSJdID0gc2VsZi5jb2RlKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLm9yZGVyKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbIm9yZGVyIl0gPSBzZWxmLm9yZGVyKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmRhdGUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiZGF0ZSJdID0gc2VsZi5kYXRlKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLm5hbWUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsibmFtZSJdID0gc2VsZi5uYW1lKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLnJlbWFyaygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IHNlbGYucmVtYXJrKCk7DQogICAgICAgIA0KICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShyZXRbInJlbWFyayJdLCBkaWN0KToNCiAgICAgICAgICAgICAgICByZXRbInJlbWFyayJdID0ganNvbi5kdW1wcyhyZXRbInJlbWFyayJdKTsNCiAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSB1YmluYXNjaWkuYjJhX2Jhc2U2NChyZXRbInJlbWFyayJdKS5zdHJpcCgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi50eXBlKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbInR5cGUiXSA9IHNlbGYudHlwZSgpLl90b0RvY3VtZW50KCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICANCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICByZXR1cm4gcmV0Ow0KDQogICAgDQogICAgZGVmIHN0b3JlKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6DQogICAgICAgIF9fdG9TdHJpbmcgPSAnVG9vbDo6c3RvcmUoKTogJzsNCiAgICAgICAgDQogICAgICAgIGV2SlNPTiA9IE5vbmU7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIGV2SlNPTiA9IGpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOg0KICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsNCiAgICAgICAgDQoNCiAgICAgICAgYW5zd2VyID0gTm9uZTsNCg0KICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGltZS50aW1lKCkpKyddLlRvb2wuc3RvcmUoKScpLm1ldGhvZCgnc3RvcmUnKS5jbGFzc05hbWUoJ1Rvb2wnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOw0KICAgICAgICANCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCiAgICAgICAgDQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgYW5zd2VyID0gVG9vbCgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQogICAgICAgIA0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCg0KDQoNCiAgICAgICAgaWYgJ1Rvb2xfc3RvcmUnIGluIGRpcigpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICc9PT4gVG9vbF9zdG9yZSgpJyk7DQogICAgICAgICAgICBhbnN3ZXIgPSBUb29sX3N0b3JlKHNlbGYsIF9fZXZlbnQsIGFuc3dlciwgX190b1N0cmluZyk7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KDQogICAgICAgICAgICANCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQoNCiAgICAgICAgcmV0dXJuIGFuc3dlcjsNCg0KICAgIA0KICAgIGRlZiBmaW5kQWxsKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6DQogICAgICAgIF9fdG9TdHJpbmcgPSAnVG9vbDo6ZmluZEFsbCgpOiAnOw0KICAgICAgICANCiAgICAgICAgZXZKU09OID0gTm9uZTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgZXZKU09OID0ganNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046DQogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOw0KICAgICAgICANCg0KICAgICAgICBhbnN3ZXIgPSBOb25lOw0KDQogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aW1lLnRpbWUoKSkrJ10uVG9vbC5maW5kQWxsKCknKS5tZXRob2QoJ2ZpbmRBbGwnKS5jbGFzc05hbWUoJ1Rvb2wnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOw0KICAgICAgICANCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCiAgICAgICAgDQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgYW5zd2VyID0gVG9vbCgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQogICAgICAgIA0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCg0KDQoNCiAgICAgICAgaWYgJ1Rvb2xfZmluZEFsbCcgaW4gZGlyKCk6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJz09PiBUb29sX2ZpbmRBbGwoKScpOw0KICAgICAgICAgICAgYW5zd2VyID0gVG9vbF9maW5kQWxsKHNlbGYsIF9fZXZlbnQsIGFuc3dlciwgX190b1N0cmluZyk7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KDQogICAgICAgICAgICANCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQoNCiAgICAgICAgcmV0dXJuIGFuc3dlcjsNCg0KICAgIA0KICAgIGRlZiBmaW5kKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6DQogICAgICAgIF9fdG9TdHJpbmcgPSAnVG9vbDo6ZmluZCgpOiAnOw0KICAgICAgICANCiAgICAgICAgZXZKU09OID0gTm9uZTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgZXZKU09OID0ganNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046DQogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOw0KICAgICAgICANCg0KICAgICAgICBhbnN3ZXIgPSBOb25lOw0KDQogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aW1lLnRpbWUoKSkrJ10uVG9vbC5maW5kKCknKS5tZXRob2QoJ2ZpbmQnKS5jbGFzc05hbWUoJ1Rvb2wnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOw0KICAgICAgICANCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCiAgICAgICAgDQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgYW5zd2VyID0gVG9vbCgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQogICAgICAgIA0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCg0KDQoNCiAgICAgICAgaWYgJ1Rvb2xfZmluZCcgaW4gZGlyKCk6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJz09PiBUb29sX2ZpbmQoKScpOw0KICAgICAgICAgICAgYW5zd2VyID0gVG9vbF9maW5kKHNlbGYsIF9fZXZlbnQsIGFuc3dlciwgX190b1N0cmluZyk7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KDQogICAgICAgICAgICANCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQoNCiAgICAgICAgcmV0dXJuIGFuc3dlcjsNCg0KICAgIA0KDQoNCmNsYXNzIENvbmZpZ19Hcm91cCgpOg0KICAgIGRlZiBfX2luaXRfXyhzZWxmLCBJZD1Ob25lLCBhY3RpdmU9Tm9uZSwgZW5hYmxlZD1Ob25lLCBjb2RlPU5vbmUsIG9yZGVyPU5vbmUsIGRhdGU9Tm9uZSwgbmFtZT1Ob25lLCByZW1hcms9Tm9uZSk6DQogICAgICAgIHN1cGVyKCkuX19pbml0X18oKTsNCg0KICAgICAgICAjcHJpbnQoJ0NvbmZpZ19Hcm91cDo6X19pbml0X18oKScpOw0KICAgICAgICBpZiBJZCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHNlbGYuSWQgPSBJZDsNCg0KICAgICAgICANCiAgICAgICAgc2VsZi5hY3RpdmUoYWN0aXZlKTsNCiAgICAgICAgc2VsZi5lbmFibGVkKGVuYWJsZWQpOw0KICAgICAgICBzZWxmLmNvZGUoY29kZSk7DQogICAgICAgIHNlbGYub3JkZXIob3JkZXIpOw0KICAgICAgICBzZWxmLmRhdGUoZGF0ZSk7DQogICAgICAgIHNlbGYubmFtZShuYW1lKTsNCiAgICAgICAgc2VsZi5yZW1hcmsocmVtYXJrKTsNCiAgICAgICAgDQogICAgSWQgPSBOb25lOw0KICAgIA0KICAgIA0KICAgICMgYWN0aXZlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2FjdGl2ZSA9IE5vbmU7DQogICAgZGVmIGFjdGl2ZShzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9hY3RpdmUgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fYWN0aXZlOw0KDQoNCiAgICANCiAgICAjIGVuYWJsZWQ6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfZW5hYmxlZCA9IE5vbmU7DQogICAgZGVmIGVuYWJsZWQoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fZW5hYmxlZCA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9lbmFibGVkOw0KDQoNCiAgICANCiAgICAjIGNvZGU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfY29kZSA9IE5vbmU7DQogICAgZGVmIGNvZGUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fY29kZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9jb2RlOw0KDQoNCiAgICANCiAgICAjIG9yZGVyOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX29yZGVyID0gTm9uZTsNCiAgICBkZWYgb3JkZXIoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fb3JkZXIgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fb3JkZXI7DQoNCg0KICAgIA0KICAgICMgZGF0ZTogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9kYXRlID0gTm9uZTsNCiAgICBkZWYgZGF0ZShzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9kYXRlID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2RhdGU7DQoNCg0KICAgIA0KICAgICMgbmFtZTogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9uYW1lID0gTm9uZTsNCiAgICBkZWYgbmFtZShzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9uYW1lID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX25hbWU7DQoNCg0KICAgIA0KICAgICMgcmVtYXJrOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX3JlbWFyayA9IE5vbmU7DQogICAgZGVmIHJlbWFyayhzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9yZW1hcmsgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fcmVtYXJrOw0KDQoNCiAgICANCiAgICANCiAgICBkZWYgX2Zyb21Eb2N1bWVudChzZWxmLCBvYmopOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ0NvbmZpZ19Hcm91cDo6X2Zyb21Eb2N1bWVudCgpOiAnOw0KDQogICAgICAgIGlmIG9iaiBpcyBOb25lOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIA0KICAgICAgICBpZiBpc2luc3RhbmNlKG9iaiwgYnl0ZXMpOg0KICAgICAgICAgICAgb2JqID0gc3RyKG9iaiwgInV0Zi04Iik7DQoNCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIHN0cikgb3IgdHlwZShvYmopIGlzIHN0cjoNCiAgICAgICAgICAgIG9iaiA9IGpzb24ubG9hZHMob2JqKTsNCiAgICAgICAgDQogICAgICAgIGlmIG5vdCBpc2luc3RhbmNlKG9iaiwgKHN0ciwgYnl0ZXMsIGRpY3QpKToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnR09UIEhFUkU6ICcgKyBzdHIodHlwZShvYmopKSk7DQogICAgICAgICAgICByZXR1cm4gb2JqOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBmb3IgaSBpbiBvYmo6DQogICAgICAgICAgICAgICAgb2JqW2ldID0gQ29uZmlnX0dyb3VwKCkuX2Zyb21Eb2N1bWVudChvYmpbaV0pOw0KICAgICAgICAgICAgcmV0dXJuIG9iajsNCg0KDQogICAgICAgIGlmICdJZCcgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5JZCA9IG9ialsnSWQnXTsNCg0KICAgIA0KICAgICAgICBpZiAnYWN0aXZlJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmFjdGl2ZShvYmpbJ2FjdGl2ZSddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdlbmFibGVkJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmVuYWJsZWQob2JqWydlbmFibGVkJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ2NvZGUnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuY29kZShvYmpbJ2NvZGUnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnb3JkZXInIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYub3JkZXIob2JqWydvcmRlciddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdkYXRlJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmRhdGUob2JqWydkYXRlJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ25hbWUnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYubmFtZShvYmpbJ25hbWUnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAncmVtYXJrJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLnJlbWFyayhvYmpbJ3JlbWFyayddKTsNCiAgICAgICAgDQogICAgICAgICAgICBzZWxmLnJlbWFyayggYmFzZTY0LmI2NGVuY29kZShzZWxmLnJlbWFyaygpLmVuY29kZSgiYXNjaWkiKSkuZGVjb2RlKCJhc2NpaSIpICk7DQogICAgICAgIA0KICAgIA0KDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgDQogICAgZGVmIF90b0RvY3VtZW50KHNlbGYpOg0KICAgICAgICByZXQgPSB7fTsNCiAgICAgICAgaWYgc2VsZi5JZCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiSWQiXSA9IHNlbGYuSWQ7DQoNCiAgICANCiAgICAgICAgaWYgc2VsZi5hY3RpdmUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiYWN0aXZlIl0gPSBzZWxmLmFjdGl2ZSgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5lbmFibGVkKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbImVuYWJsZWQiXSA9IHNlbGYuZW5hYmxlZCgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5jb2RlKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbImNvZGUiXSA9IHNlbGYuY29kZSgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5vcmRlcigpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJvcmRlciJdID0gc2VsZi5vcmRlcigpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5kYXRlKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbImRhdGUiXSA9IHNlbGYuZGF0ZSgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5uYW1lKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbIm5hbWUiXSA9IHNlbGYubmFtZSgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5yZW1hcmsoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSBzZWxmLnJlbWFyaygpOw0KICAgICAgICANCiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UocmV0WyJyZW1hcmsiXSwgZGljdCk6DQogICAgICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IGpzb24uZHVtcHMocmV0WyJyZW1hcmsiXSk7DQogICAgICAgICAgICByZXRbInJlbWFyayJdID0gdWJpbmFzY2lpLmIyYV9iYXNlNjQocmV0WyJyZW1hcmsiXSkuc3RyaXAoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIHJldHVybiByZXQ7DQoNCiAgICANCiAgICBkZWYgc3RvcmUoc2VsZiwgX19ldmVudD1Ob25lKToNCiAgICAgICAgX190b1N0cmluZyA9ICdDb25maWdfR3JvdXA6OnN0b3JlKCk6ICc7DQogICAgICAgIA0KICAgICAgICBldkpTT04gPSBOb25lOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBldkpTT04gPSBqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoNCiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7DQogICAgICAgIA0KDQogICAgICAgIGFuc3dlciA9IE5vbmU7DQoNCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpbWUudGltZSgpKSsnXS5Db25maWdfR3JvdXAuc3RvcmUoKScpLm1ldGhvZCgnc3RvcmUnKS5jbGFzc05hbWUoJ0NvbmZpZ19Hcm91cCcpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7DQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KICAgICAgICANCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICBhbnN3ZXIgPSBDb25maWdfR3JvdXAoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KICAgICAgICANCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQoNCg0KDQogICAgICAgIGlmICdDb25maWdfR3JvdXBfc3RvcmUnIGluIGRpcigpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICc9PT4gQ29uZmlnX0dyb3VwX3N0b3JlKCknKTsNCiAgICAgICAgICAgIGFuc3dlciA9IENvbmZpZ19Hcm91cF9zdG9yZShzZWxmLCBfX2V2ZW50LCBhbnN3ZXIsIF9fdG9TdHJpbmcpOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCg0KICAgICAgICAgICAgDQogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KDQogICAgICAgIHJldHVybiBhbnN3ZXI7DQoNCiAgICANCiAgICBkZWYgZmluZEFsbChzZWxmLCBfX2V2ZW50PU5vbmUpOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ0NvbmZpZ19Hcm91cDo6ZmluZEFsbCgpOiAnOw0KICAgICAgICANCiAgICAgICAgZXZKU09OID0gTm9uZTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgZXZKU09OID0ganNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046DQogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOw0KICAgICAgICANCg0KICAgICAgICBhbnN3ZXIgPSBOb25lOw0KDQogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aW1lLnRpbWUoKSkrJ10uQ29uZmlnX0dyb3VwLmZpbmRBbGwoKScpLm1ldGhvZCgnZmluZEFsbCcpLmNsYXNzTmFtZSgnQ29uZmlnX0dyb3VwJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOw0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsNCiAgICAgICAgDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQogICAgICAgIA0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgIGFuc3dlciA9IENvbmZpZ19Hcm91cCgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQogICAgICAgIA0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCg0KDQoNCiAgICAgICAgaWYgJ0NvbmZpZ19Hcm91cF9maW5kQWxsJyBpbiBkaXIoKToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnPT0+IENvbmZpZ19Hcm91cF9maW5kQWxsKCknKTsNCiAgICAgICAgICAgIGFuc3dlciA9IENvbmZpZ19Hcm91cF9maW5kQWxsKHNlbGYsIF9fZXZlbnQsIGFuc3dlciwgX190b1N0cmluZyk7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KDQogICAgICAgICAgICANCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQoNCiAgICAgICAgcmV0dXJuIGFuc3dlcjsNCg0KICAgIA0KICAgIGRlZiBmaW5kKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6DQogICAgICAgIF9fdG9TdHJpbmcgPSAnQ29uZmlnX0dyb3VwOjpmaW5kKCk6ICc7DQogICAgICAgIA0KICAgICAgICBldkpTT04gPSBOb25lOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBldkpTT04gPSBqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoNCiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7DQogICAgICAgIA0KDQogICAgICAgIGFuc3dlciA9IE5vbmU7DQoNCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpbWUudGltZSgpKSsnXS5Db25maWdfR3JvdXAuZmluZCgpJykubWV0aG9kKCdmaW5kJykuY2xhc3NOYW1lKCdDb25maWdfR3JvdXAnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOw0KICAgICAgICANCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCiAgICAgICAgDQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgYW5zd2VyID0gQ29uZmlnX0dyb3VwKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCiAgICAgICAgDQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KDQoNCg0KICAgICAgICBpZiAnQ29uZmlnX0dyb3VwX2ZpbmQnIGluIGRpcigpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICc9PT4gQ29uZmlnX0dyb3VwX2ZpbmQoKScpOw0KICAgICAgICAgICAgYW5zd2VyID0gQ29uZmlnX0dyb3VwX2ZpbmQoc2VsZiwgX19ldmVudCwgYW5zd2VyLCBfX3RvU3RyaW5nKTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCg0KICAgICAgICByZXR1cm4gYW5zd2VyOw0KDQogICAgDQoNCg0KY2xhc3MgTWFwcGluZ19Hcm91cCgpOg0KICAgIGRlZiBfX2luaXRfXyhzZWxmLCBJZD1Ob25lLCBhY3RpdmU9Tm9uZSwgZW5hYmxlZD1Ob25lLCBjb2RlPU5vbmUsIG9yZGVyPU5vbmUsIGRhdGU9Tm9uZSwgbmFtZT1Ob25lLCByZW1hcms9Tm9uZSk6DQogICAgICAgIHN1cGVyKCkuX19pbml0X18oKTsNCg0KICAgICAgICAjcHJpbnQoJ01hcHBpbmdfR3JvdXA6Ol9faW5pdF9fKCknKTsNCiAgICAgICAgaWYgSWQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBzZWxmLklkID0gSWQ7DQoNCiAgICAgICAgDQogICAgICAgIHNlbGYuYWN0aXZlKGFjdGl2ZSk7DQogICAgICAgIHNlbGYuZW5hYmxlZChlbmFibGVkKTsNCiAgICAgICAgc2VsZi5jb2RlKGNvZGUpOw0KICAgICAgICBzZWxmLm9yZGVyKG9yZGVyKTsNCiAgICAgICAgc2VsZi5kYXRlKGRhdGUpOw0KICAgICAgICBzZWxmLm5hbWUobmFtZSk7DQogICAgICAgIHNlbGYucmVtYXJrKHJlbWFyayk7DQogICAgICAgIA0KICAgIElkID0gTm9uZTsNCiAgICANCiAgICANCiAgICAjIGFjdGl2ZTogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9hY3RpdmUgPSBOb25lOw0KICAgIGRlZiBhY3RpdmUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fYWN0aXZlID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2FjdGl2ZTsNCg0KDQogICAgDQogICAgIyBlbmFibGVkOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2VuYWJsZWQgPSBOb25lOw0KICAgIGRlZiBlbmFibGVkKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2VuYWJsZWQgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fZW5hYmxlZDsNCg0KDQogICAgDQogICAgIyBjb2RlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2NvZGUgPSBOb25lOw0KICAgIGRlZiBjb2RlKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2NvZGUgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fY29kZTsNCg0KDQogICAgDQogICAgIyBvcmRlcjogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9vcmRlciA9IE5vbmU7DQogICAgZGVmIG9yZGVyKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX29yZGVyID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX29yZGVyOw0KDQoNCiAgICANCiAgICAjIGRhdGU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfZGF0ZSA9IE5vbmU7DQogICAgZGVmIGRhdGUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fZGF0ZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9kYXRlOw0KDQoNCiAgICANCiAgICAjIG5hbWU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfbmFtZSA9IE5vbmU7DQogICAgZGVmIG5hbWUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fbmFtZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9uYW1lOw0KDQoNCiAgICANCiAgICAjIHJlbWFyazogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9yZW1hcmsgPSBOb25lOw0KICAgIGRlZiByZW1hcmsoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fcmVtYXJrID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3JlbWFyazsNCg0KDQogICAgDQogICAgDQogICAgZGVmIF9mcm9tRG9jdW1lbnQoc2VsZiwgb2JqKToNCiAgICAgICAgX190b1N0cmluZyA9ICdNYXBwaW5nX0dyb3VwOjpfZnJvbURvY3VtZW50KCk6ICc7DQoNCiAgICAgICAgaWYgb2JqIGlzIE5vbmU6DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgDQogICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLCBieXRlcyk6DQogICAgICAgICAgICBvYmogPSBzdHIob2JqLCAidXRmLTgiKTsNCg0KICAgICAgICBpZiBpc2luc3RhbmNlKG9iaiwgc3RyKSBvciB0eXBlKG9iaikgaXMgc3RyOg0KICAgICAgICAgICAgb2JqID0ganNvbi5sb2FkcyhvYmopOw0KICAgICAgICANCiAgICAgICAgaWYgbm90IGlzaW5zdGFuY2Uob2JqLCAoc3RyLCBieXRlcywgZGljdCkpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICdHT1QgSEVSRTogJyArIHN0cih0eXBlKG9iaikpKTsNCiAgICAgICAgICAgIHJldHVybiBvYmo7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGZvciBpIGluIG9iajoNCiAgICAgICAgICAgICAgICBvYmpbaV0gPSBNYXBwaW5nX0dyb3VwKCkuX2Zyb21Eb2N1bWVudChvYmpbaV0pOw0KICAgICAgICAgICAgcmV0dXJuIG9iajsNCg0KDQogICAgICAgIGlmICdJZCcgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5JZCA9IG9ialsnSWQnXTsNCg0KICAgIA0KICAgICAgICBpZiAnYWN0aXZlJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmFjdGl2ZShvYmpbJ2FjdGl2ZSddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdlbmFibGVkJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmVuYWJsZWQob2JqWydlbmFibGVkJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ2NvZGUnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuY29kZShvYmpbJ2NvZGUnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnb3JkZXInIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYub3JkZXIob2JqWydvcmRlciddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdkYXRlJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmRhdGUob2JqWydkYXRlJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ25hbWUnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYubmFtZShvYmpbJ25hbWUnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAncmVtYXJrJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLnJlbWFyayhvYmpbJ3JlbWFyayddKTsNCiAgICAgICAgDQogICAgICAgICAgICBzZWxmLnJlbWFyayggYmFzZTY0LmI2NGVuY29kZShzZWxmLnJlbWFyaygpLmVuY29kZSgiYXNjaWkiKSkuZGVjb2RlKCJhc2NpaSIpICk7DQogICAgICAgIA0KICAgIA0KDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgDQogICAgZGVmIF90b0RvY3VtZW50KHNlbGYpOg0KICAgICAgICByZXQgPSB7fTsNCiAgICAgICAgaWYgc2VsZi5JZCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiSWQiXSA9IHNlbGYuSWQ7DQoNCiAgICANCiAgICAgICAgaWYgc2VsZi5hY3RpdmUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiYWN0aXZlIl0gPSBzZWxmLmFjdGl2ZSgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5lbmFibGVkKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbImVuYWJsZWQiXSA9IHNlbGYuZW5hYmxlZCgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5jb2RlKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbImNvZGUiXSA9IHNlbGYuY29kZSgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5vcmRlcigpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJvcmRlciJdID0gc2VsZi5vcmRlcigpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5kYXRlKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbImRhdGUiXSA9IHNlbGYuZGF0ZSgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5uYW1lKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbIm5hbWUiXSA9IHNlbGYubmFtZSgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5yZW1hcmsoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSBzZWxmLnJlbWFyaygpOw0KICAgICAgICANCiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UocmV0WyJyZW1hcmsiXSwgZGljdCk6DQogICAgICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IGpzb24uZHVtcHMocmV0WyJyZW1hcmsiXSk7DQogICAgICAgICAgICByZXRbInJlbWFyayJdID0gdWJpbmFzY2lpLmIyYV9iYXNlNjQocmV0WyJyZW1hcmsiXSkuc3RyaXAoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIHJldHVybiByZXQ7DQoNCiAgICANCiAgICBkZWYgc3RvcmUoc2VsZiwgX19ldmVudD1Ob25lKToNCiAgICAgICAgX190b1N0cmluZyA9ICdNYXBwaW5nX0dyb3VwOjpzdG9yZSgpOiAnOw0KICAgICAgICANCiAgICAgICAgZXZKU09OID0gTm9uZTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgZXZKU09OID0ganNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046DQogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOw0KICAgICAgICANCg0KICAgICAgICBhbnN3ZXIgPSBOb25lOw0KDQogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aW1lLnRpbWUoKSkrJ10uTWFwcGluZ19Hcm91cC5zdG9yZSgpJykubWV0aG9kKCdzdG9yZScpLmNsYXNzTmFtZSgnTWFwcGluZ19Hcm91cCcpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7DQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KICAgICAgICANCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICBhbnN3ZXIgPSBNYXBwaW5nX0dyb3VwKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCiAgICAgICAgDQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KDQoNCg0KICAgICAgICBpZiAnTWFwcGluZ19Hcm91cF9zdG9yZScgaW4gZGlyKCk6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJz09PiBNYXBwaW5nX0dyb3VwX3N0b3JlKCknKTsNCiAgICAgICAgICAgIGFuc3dlciA9IE1hcHBpbmdfR3JvdXBfc3RvcmUoc2VsZiwgX19ldmVudCwgYW5zd2VyLCBfX3RvU3RyaW5nKTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCg0KICAgICAgICByZXR1cm4gYW5zd2VyOw0KDQogICAgDQogICAgZGVmIGZpbmRBbGwoc2VsZiwgX19ldmVudD1Ob25lKToNCiAgICAgICAgX190b1N0cmluZyA9ICdNYXBwaW5nX0dyb3VwOjpmaW5kQWxsKCk6ICc7DQogICAgICAgIA0KICAgICAgICBldkpTT04gPSBOb25lOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBldkpTT04gPSBqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoNCiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7DQogICAgICAgIA0KDQogICAgICAgIGFuc3dlciA9IE5vbmU7DQoNCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpbWUudGltZSgpKSsnXS5NYXBwaW5nX0dyb3VwLmZpbmRBbGwoKScpLm1ldGhvZCgnZmluZEFsbCcpLmNsYXNzTmFtZSgnTWFwcGluZ19Hcm91cCcpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7DQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KICAgICAgICANCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICBhbnN3ZXIgPSBNYXBwaW5nX0dyb3VwKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCiAgICAgICAgDQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KDQoNCg0KICAgICAgICBpZiAnTWFwcGluZ19Hcm91cF9maW5kQWxsJyBpbiBkaXIoKToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnPT0+IE1hcHBpbmdfR3JvdXBfZmluZEFsbCgpJyk7DQogICAgICAgICAgICBhbnN3ZXIgPSBNYXBwaW5nX0dyb3VwX2ZpbmRBbGwoc2VsZiwgX19ldmVudCwgYW5zd2VyLCBfX3RvU3RyaW5nKTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCg0KICAgICAgICByZXR1cm4gYW5zd2VyOw0KDQogICAgDQogICAgZGVmIGZpbmQoc2VsZiwgX19ldmVudD1Ob25lKToNCiAgICAgICAgX190b1N0cmluZyA9ICdNYXBwaW5nX0dyb3VwOjpmaW5kKCk6ICc7DQogICAgICAgIA0KICAgICAgICBldkpTT04gPSBOb25lOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBldkpTT04gPSBqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoNCiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7DQogICAgICAgIA0KDQogICAgICAgIGFuc3dlciA9IE5vbmU7DQoNCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpbWUudGltZSgpKSsnXS5NYXBwaW5nX0dyb3VwLmZpbmQoKScpLm1ldGhvZCgnZmluZCcpLmNsYXNzTmFtZSgnTWFwcGluZ19Hcm91cCcpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7DQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KICAgICAgICANCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICBhbnN3ZXIgPSBNYXBwaW5nX0dyb3VwKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCiAgICAgICAgDQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KDQoNCg0KICAgICAgICBpZiAnTWFwcGluZ19Hcm91cF9maW5kJyBpbiBkaXIoKToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnPT0+IE1hcHBpbmdfR3JvdXBfZmluZCgpJyk7DQogICAgICAgICAgICBhbnN3ZXIgPSBNYXBwaW5nX0dyb3VwX2ZpbmQoc2VsZiwgX19ldmVudCwgYW5zd2VyLCBfX3RvU3RyaW5nKTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCg0KICAgICAgICByZXR1cm4gYW5zd2VyOw0KDQogICAgDQoNCg0KY2xhc3MgVG9vbF9UeXBlKCk6DQogICAgZGVmIF9faW5pdF9fKHNlbGYsIElkPU5vbmUsIGFjdGl2ZT1Ob25lLCBlbmFibGVkPU5vbmUsIGNvZGU9Tm9uZSwgb3JkZXI9Tm9uZSwgZGF0ZT1Ob25lLCBuYW1lPU5vbmUsIHJlbWFyaz1Ob25lKToNCiAgICAgICAgc3VwZXIoKS5fX2luaXRfXygpOw0KDQogICAgICAgICNwcmludCgnVG9vbF9UeXBlOjpfX2luaXRfXygpJyk7DQogICAgICAgIGlmIElkIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgc2VsZi5JZCA9IElkOw0KDQogICAgICAgIA0KICAgICAgICBzZWxmLmFjdGl2ZShhY3RpdmUpOw0KICAgICAgICBzZWxmLmVuYWJsZWQoZW5hYmxlZCk7DQogICAgICAgIHNlbGYuY29kZShjb2RlKTsNCiAgICAgICAgc2VsZi5vcmRlcihvcmRlcik7DQogICAgICAgIHNlbGYuZGF0ZShkYXRlKTsNCiAgICAgICAgc2VsZi5uYW1lKG5hbWUpOw0KICAgICAgICBzZWxmLnJlbWFyayhyZW1hcmspOw0KICAgICAgICANCiAgICBJZCA9IE5vbmU7DQogICAgDQogICAgDQogICAgIyBhY3RpdmU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfYWN0aXZlID0gTm9uZTsNCiAgICBkZWYgYWN0aXZlKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2FjdGl2ZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9hY3RpdmU7DQoNCg0KICAgIA0KICAgICMgZW5hYmxlZDogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9lbmFibGVkID0gTm9uZTsNCiAgICBkZWYgZW5hYmxlZChzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9lbmFibGVkID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2VuYWJsZWQ7DQoNCg0KICAgIA0KICAgICMgY29kZTogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9jb2RlID0gTm9uZTsNCiAgICBkZWYgY29kZShzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9jb2RlID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2NvZGU7DQoNCg0KICAgIA0KICAgICMgb3JkZXI6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfb3JkZXIgPSBOb25lOw0KICAgIGRlZiBvcmRlcihzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9vcmRlciA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9vcmRlcjsNCg0KDQogICAgDQogICAgIyBkYXRlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2RhdGUgPSBOb25lOw0KICAgIGRlZiBkYXRlKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2RhdGUgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fZGF0ZTsNCg0KDQogICAgDQogICAgIyBuYW1lOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX25hbWUgPSBOb25lOw0KICAgIGRlZiBuYW1lKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX25hbWUgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fbmFtZTsNCg0KDQogICAgDQogICAgIyByZW1hcms6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfcmVtYXJrID0gTm9uZTsNCiAgICBkZWYgcmVtYXJrKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX3JlbWFyayA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9yZW1hcms7DQoNCg0KICAgIA0KICAgIA0KICAgIGRlZiBfZnJvbURvY3VtZW50KHNlbGYsIG9iaik6DQogICAgICAgIF9fdG9TdHJpbmcgPSAnVG9vbF9UeXBlOjpfZnJvbURvY3VtZW50KCk6ICc7DQoNCiAgICAgICAgaWYgb2JqIGlzIE5vbmU6DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgDQogICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLCBieXRlcyk6DQogICAgICAgICAgICBvYmogPSBzdHIob2JqLCAidXRmLTgiKTsNCg0KICAgICAgICBpZiBpc2luc3RhbmNlKG9iaiwgc3RyKSBvciB0eXBlKG9iaikgaXMgc3RyOg0KICAgICAgICAgICAgb2JqID0ganNvbi5sb2FkcyhvYmopOw0KICAgICAgICANCiAgICAgICAgaWYgbm90IGlzaW5zdGFuY2Uob2JqLCAoc3RyLCBieXRlcywgZGljdCkpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICdHT1QgSEVSRTogJyArIHN0cih0eXBlKG9iaikpKTsNCiAgICAgICAgICAgIHJldHVybiBvYmo7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGZvciBpIGluIG9iajoNCiAgICAgICAgICAgICAgICBvYmpbaV0gPSBUb29sX1R5cGUoKS5fZnJvbURvY3VtZW50KG9ialtpXSk7DQogICAgICAgICAgICByZXR1cm4gb2JqOw0KDQoNCiAgICAgICAgaWYgJ0lkJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLklkID0gb2JqWydJZCddOw0KDQogICAgDQogICAgICAgIGlmICdhY3RpdmUnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuYWN0aXZlKG9ialsnYWN0aXZlJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ2VuYWJsZWQnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuZW5hYmxlZChvYmpbJ2VuYWJsZWQnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnY29kZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5jb2RlKG9ialsnY29kZSddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdvcmRlcicgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5vcmRlcihvYmpbJ29yZGVyJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ2RhdGUnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuZGF0ZShvYmpbJ2RhdGUnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnbmFtZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5uYW1lKG9ialsnbmFtZSddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdyZW1hcmsnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYucmVtYXJrKG9ialsncmVtYXJrJ10pOw0KICAgICAgICANCiAgICAgICAgICAgIHNlbGYucmVtYXJrKCBiYXNlNjQuYjY0ZW5jb2RlKHNlbGYucmVtYXJrKCkuZW5jb2RlKCJhc2NpaSIpKS5kZWNvZGUoImFzY2lpIikgKTsNCiAgICAgICAgDQogICAgDQoNCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICByZXR1cm4gc2VsZjsNCiAgICANCiAgICBkZWYgX3RvRG9jdW1lbnQoc2VsZik6DQogICAgICAgIHJldCA9IHt9Ow0KICAgICAgICBpZiBzZWxmLklkIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJJZCJdID0gc2VsZi5JZDsNCg0KICAgIA0KICAgICAgICBpZiBzZWxmLmFjdGl2ZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJhY3RpdmUiXSA9IHNlbGYuYWN0aXZlKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmVuYWJsZWQoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiZW5hYmxlZCJdID0gc2VsZi5lbmFibGVkKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmNvZGUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiY29kZSJdID0gc2VsZi5jb2RlKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLm9yZGVyKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbIm9yZGVyIl0gPSBzZWxmLm9yZGVyKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmRhdGUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiZGF0ZSJdID0gc2VsZi5kYXRlKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLm5hbWUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsibmFtZSJdID0gc2VsZi5uYW1lKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLnJlbWFyaygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IHNlbGYucmVtYXJrKCk7DQogICAgICAgIA0KICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShyZXRbInJlbWFyayJdLCBkaWN0KToNCiAgICAgICAgICAgICAgICByZXRbInJlbWFyayJdID0ganNvbi5kdW1wcyhyZXRbInJlbWFyayJdKTsNCiAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSB1YmluYXNjaWkuYjJhX2Jhc2U2NChyZXRbInJlbWFyayJdKS5zdHJpcCgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgcmV0dXJuIHJldDsNCg0KICAgIA0KICAgIGRlZiBzdG9yZShzZWxmLCBfX2V2ZW50PU5vbmUpOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ1Rvb2xfVHlwZTo6c3RvcmUoKTogJzsNCiAgICAgICAgDQogICAgICAgIGV2SlNPTiA9IE5vbmU7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIGV2SlNPTiA9IGpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOg0KICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsNCiAgICAgICAgDQoNCiAgICAgICAgYW5zd2VyID0gTm9uZTsNCg0KICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGltZS50aW1lKCkpKyddLlRvb2xfVHlwZS5zdG9yZSgpJykubWV0aG9kKCdzdG9yZScpLmNsYXNzTmFtZSgnVG9vbF9UeXBlJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOw0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsNCiAgICAgICAgDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQogICAgICAgIA0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgIGFuc3dlciA9IFRvb2xfVHlwZSgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQogICAgICAgIA0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCg0KDQoNCiAgICAgICAgaWYgJ1Rvb2xfVHlwZV9zdG9yZScgaW4gZGlyKCk6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJz09PiBUb29sX1R5cGVfc3RvcmUoKScpOw0KICAgICAgICAgICAgYW5zd2VyID0gVG9vbF9UeXBlX3N0b3JlKHNlbGYsIF9fZXZlbnQsIGFuc3dlciwgX190b1N0cmluZyk7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KDQogICAgICAgICAgICANCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQoNCiAgICAgICAgcmV0dXJuIGFuc3dlcjsNCg0KICAgIA0KICAgIGRlZiBmaW5kQWxsKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6DQogICAgICAgIF9fdG9TdHJpbmcgPSAnVG9vbF9UeXBlOjpmaW5kQWxsKCk6ICc7DQogICAgICAgIA0KICAgICAgICBldkpTT04gPSBOb25lOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBldkpTT04gPSBqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoNCiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7DQogICAgICAgIA0KDQogICAgICAgIGFuc3dlciA9IE5vbmU7DQoNCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpbWUudGltZSgpKSsnXS5Ub29sX1R5cGUuZmluZEFsbCgpJykubWV0aG9kKCdmaW5kQWxsJykuY2xhc3NOYW1lKCdUb29sX1R5cGUnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOw0KICAgICAgICANCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCiAgICAgICAgDQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgYW5zd2VyID0gVG9vbF9UeXBlKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCiAgICAgICAgDQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KDQoNCg0KICAgICAgICBpZiAnVG9vbF9UeXBlX2ZpbmRBbGwnIGluIGRpcigpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICc9PT4gVG9vbF9UeXBlX2ZpbmRBbGwoKScpOw0KICAgICAgICAgICAgYW5zd2VyID0gVG9vbF9UeXBlX2ZpbmRBbGwoc2VsZiwgX19ldmVudCwgYW5zd2VyLCBfX3RvU3RyaW5nKTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCg0KICAgICAgICByZXR1cm4gYW5zd2VyOw0KDQogICAgDQogICAgZGVmIGZpbmQoc2VsZiwgX19ldmVudD1Ob25lKToNCiAgICAgICAgX190b1N0cmluZyA9ICdUb29sX1R5cGU6OmZpbmQoKTogJzsNCiAgICAgICAgDQogICAgICAgIGV2SlNPTiA9IE5vbmU7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIGV2SlNPTiA9IGpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOg0KICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsNCiAgICAgICAgDQoNCiAgICAgICAgYW5zd2VyID0gTm9uZTsNCg0KICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGltZS50aW1lKCkpKyddLlRvb2xfVHlwZS5maW5kKCknKS5tZXRob2QoJ2ZpbmQnKS5jbGFzc05hbWUoJ1Rvb2xfVHlwZScpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7DQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KICAgICAgICANCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICBhbnN3ZXIgPSBUb29sX1R5cGUoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KICAgICAgICANCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQoNCg0KDQogICAgICAgIGlmICdUb29sX1R5cGVfZmluZCcgaW4gZGlyKCk6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJz09PiBUb29sX1R5cGVfZmluZCgpJyk7DQogICAgICAgICAgICBhbnN3ZXIgPSBUb29sX1R5cGVfZmluZChzZWxmLCBfX2V2ZW50LCBhbnN3ZXIsIF9fdG9TdHJpbmcpOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCg0KICAgICAgICAgICAgDQogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KDQogICAgICAgIHJldHVybiBhbnN3ZXI7DQoNCiAgICANCg0KDQpjbGFzcyBFdmVudCgpOg0KICAgIGRlZiBfX2luaXRfXyhzZWxmLCBJZD1Ob25lLCBhY3RpdmU9Tm9uZSwgZW5hYmxlZD1Ob25lLCBjb2RlPU5vbmUsIG9yZGVyPU5vbmUsIGRhdGU9Tm9uZSwgbmFtZT1Ob25lLCByZW1hcms9Tm9uZSwgY2xhc3NOYW1lPU5vbmUsIG1ldGhvZD1Ob25lLCBwYXlsb2FkPU5vbmUsIGNhcnJpZXI9Tm9uZSwgc2VuZGVyPU5vbmUsIHJlY2lwaWVudD1Ob25lLCByZXNwb25zZVRvPU5vbmUpOg0KICAgICAgICBzdXBlcigpLl9faW5pdF9fKCk7DQoNCiAgICAgICAgI3ByaW50KCdFdmVudDo6X19pbml0X18oKScpOw0KICAgICAgICBpZiBJZCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHNlbGYuSWQgPSBJZDsNCg0KICAgICAgICANCiAgICAgICAgc2VsZi5hY3RpdmUoYWN0aXZlKTsNCiAgICAgICAgc2VsZi5lbmFibGVkKGVuYWJsZWQpOw0KICAgICAgICBzZWxmLmNvZGUoY29kZSk7DQogICAgICAgIHNlbGYub3JkZXIob3JkZXIpOw0KICAgICAgICBzZWxmLmRhdGUoZGF0ZSk7DQogICAgICAgIHNlbGYubmFtZShuYW1lKTsNCiAgICAgICAgc2VsZi5yZW1hcmsocmVtYXJrKTsNCiAgICAgICAgc2VsZi5jbGFzc05hbWUoY2xhc3NOYW1lKTsNCiAgICAgICAgc2VsZi5tZXRob2QobWV0aG9kKTsNCiAgICAgICAgc2VsZi5wYXlsb2FkKHBheWxvYWQpOw0KICAgICAgICBzZWxmLmNhcnJpZXIoY2Fycmllcik7DQogICAgICAgIHNlbGYuc2VuZGVyKHNlbmRlcik7DQogICAgICAgIHNlbGYucmVjaXBpZW50KHJlY2lwaWVudCk7DQogICAgICAgIHNlbGYucmVzcG9uc2VUbyhyZXNwb25zZVRvKTsNCiAgICAgICAgDQogICAgSWQgPSBOb25lOw0KICAgIA0KICAgIA0KICAgICMgYWN0aXZlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2FjdGl2ZSA9IE5vbmU7DQogICAgZGVmIGFjdGl2ZShzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9hY3RpdmUgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fYWN0aXZlOw0KDQoNCiAgICANCiAgICAjIGVuYWJsZWQ6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfZW5hYmxlZCA9IE5vbmU7DQogICAgZGVmIGVuYWJsZWQoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fZW5hYmxlZCA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9lbmFibGVkOw0KDQoNCiAgICANCiAgICAjIGNvZGU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfY29kZSA9IE5vbmU7DQogICAgZGVmIGNvZGUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fY29kZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9jb2RlOw0KDQoNCiAgICANCiAgICAjIG9yZGVyOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX29yZGVyID0gTm9uZTsNCiAgICBkZWYgb3JkZXIoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fb3JkZXIgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fb3JkZXI7DQoNCg0KICAgIA0KICAgICMgZGF0ZTogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9kYXRlID0gTm9uZTsNCiAgICBkZWYgZGF0ZShzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9kYXRlID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2RhdGU7DQoNCg0KICAgIA0KICAgICMgbmFtZTogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9uYW1lID0gTm9uZTsNCiAgICBkZWYgbmFtZShzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9uYW1lID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX25hbWU7DQoNCg0KICAgIA0KICAgICMgcmVtYXJrOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX3JlbWFyayA9IE5vbmU7DQogICAgZGVmIHJlbWFyayhzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9yZW1hcmsgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fcmVtYXJrOw0KDQoNCiAgICANCiAgICAjIGNsYXNzTmFtZTogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9jbGFzc05hbWUgPSBOb25lOw0KICAgIGRlZiBjbGFzc05hbWUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fY2xhc3NOYW1lID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2NsYXNzTmFtZTsNCg0KDQogICAgDQogICAgIyBtZXRob2Q6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfbWV0aG9kID0gTm9uZTsNCiAgICBkZWYgbWV0aG9kKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX21ldGhvZCA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9tZXRob2Q7DQoNCg0KICAgIA0KICAgICMgcGF5bG9hZDogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9wYXlsb2FkID0gTm9uZTsNCiAgICBkZWYgcGF5bG9hZChzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9wYXlsb2FkID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3BheWxvYWQ7DQoNCg0KICAgIA0KICAgICMgY2FycmllcjogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9jYXJyaWVyID0gTm9uZTsNCiAgICBkZWYgY2FycmllcihzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9jYXJyaWVyID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2NhcnJpZXI7DQoNCg0KICAgIA0KICAgICMgc2VuZGVyOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX3NlbmRlciA9IE5vbmU7DQogICAgZGVmIHNlbmRlcihzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9zZW5kZXIgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fc2VuZGVyOw0KDQoNCiAgICANCiAgICAjIHJlY2lwaWVudDogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9yZWNpcGllbnQgPSBOb25lOw0KICAgIGRlZiByZWNpcGllbnQoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fcmVjaXBpZW50ID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3JlY2lwaWVudDsNCg0KDQogICAgDQogICAgIyByZXNwb25zZVRvOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX3Jlc3BvbnNlVG8gPSBOb25lOw0KICAgIGRlZiByZXNwb25zZVRvKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX3Jlc3BvbnNlVG8gPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fcmVzcG9uc2VUbzsNCg0KDQogICAgDQogICAgDQogICAgZGVmIF9mcm9tRG9jdW1lbnQoc2VsZiwgb2JqKToNCiAgICAgICAgX190b1N0cmluZyA9ICdFdmVudDo6X2Zyb21Eb2N1bWVudCgpOiAnOw0KDQogICAgICAgIGlmIG9iaiBpcyBOb25lOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIA0KICAgICAgICBpZiBpc2luc3RhbmNlKG9iaiwgYnl0ZXMpOg0KICAgICAgICAgICAgb2JqID0gc3RyKG9iaiwgInV0Zi04Iik7DQoNCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIHN0cikgb3IgdHlwZShvYmopIGlzIHN0cjoNCiAgICAgICAgICAgIG9iaiA9IGpzb24ubG9hZHMob2JqKTsNCiAgICAgICAgDQogICAgICAgIGlmIG5vdCBpc2luc3RhbmNlKG9iaiwgKHN0ciwgYnl0ZXMsIGRpY3QpKToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnR09UIEhFUkU6ICcgKyBzdHIodHlwZShvYmopKSk7DQogICAgICAgICAgICByZXR1cm4gb2JqOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBmb3IgaSBpbiBvYmo6DQogICAgICAgICAgICAgICAgb2JqW2ldID0gRXZlbnQoKS5fZnJvbURvY3VtZW50KG9ialtpXSk7DQogICAgICAgICAgICByZXR1cm4gb2JqOw0KDQoNCiAgICAgICAgaWYgJ0lkJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLklkID0gb2JqWydJZCddOw0KDQogICAgDQogICAgICAgIGlmICdhY3RpdmUnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuYWN0aXZlKG9ialsnYWN0aXZlJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ2VuYWJsZWQnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuZW5hYmxlZChvYmpbJ2VuYWJsZWQnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnY29kZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5jb2RlKG9ialsnY29kZSddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdvcmRlcicgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5vcmRlcihvYmpbJ29yZGVyJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ2RhdGUnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuZGF0ZShvYmpbJ2RhdGUnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnbmFtZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5uYW1lKG9ialsnbmFtZSddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdyZW1hcmsnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYucmVtYXJrKG9ialsncmVtYXJrJ10pOw0KICAgICAgICANCiAgICAgICAgICAgIHNlbGYucmVtYXJrKCBiYXNlNjQuYjY0ZW5jb2RlKHNlbGYucmVtYXJrKCkuZW5jb2RlKCJhc2NpaSIpKS5kZWNvZGUoImFzY2lpIikgKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdjbGFzc05hbWUnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuY2xhc3NOYW1lKG9ialsnY2xhc3NOYW1lJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ21ldGhvZCcgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5tZXRob2Qob2JqWydtZXRob2QnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAncGF5bG9hZCcgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5wYXlsb2FkKG9ialsncGF5bG9hZCddKTsNCiAgICAgICAgDQogICAgICAgICAgICBzZWxmLnBheWxvYWQoIGJhc2U2NC5iNjRlbmNvZGUoc2VsZi5wYXlsb2FkKCkuZW5jb2RlKCJhc2NpaSIpKS5kZWNvZGUoImFzY2lpIikgKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdjYXJyaWVyJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmNhcnJpZXIoTm9kZSgpLl9mcm9tRG9jdW1lbnQob2JqWydjYXJyaWVyJ10pKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdzZW5kZXInIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuc2VuZGVyKE5vZGUoKS5fZnJvbURvY3VtZW50KG9ialsnc2VuZGVyJ10pKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdyZWNpcGllbnQnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYucmVjaXBpZW50KE5vZGUoKS5fZnJvbURvY3VtZW50KG9ialsncmVjaXBpZW50J10pKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdyZXNwb25zZVRvJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLnJlc3BvbnNlVG8oRXZlbnQoKS5fZnJvbURvY3VtZW50KG9ialsncmVzcG9uc2VUbyddKSk7DQogICAgICAgIA0KICAgIA0KDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgDQogICAgZGVmIF90b0RvY3VtZW50KHNlbGYpOg0KICAgICAgICByZXQgPSB7fTsNCiAgICAgICAgaWYgc2VsZi5JZCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiSWQiXSA9IHNlbGYuSWQ7DQoNCiAgICANCiAgICAgICAgaWYgc2VsZi5hY3RpdmUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiYWN0aXZlIl0gPSBzZWxmLmFjdGl2ZSgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5lbmFibGVkKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbImVuYWJsZWQiXSA9IHNlbGYuZW5hYmxlZCgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5jb2RlKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbImNvZGUiXSA9IHNlbGYuY29kZSgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5vcmRlcigpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJvcmRlciJdID0gc2VsZi5vcmRlcigpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5kYXRlKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbImRhdGUiXSA9IHNlbGYuZGF0ZSgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5uYW1lKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbIm5hbWUiXSA9IHNlbGYubmFtZSgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5yZW1hcmsoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSBzZWxmLnJlbWFyaygpOw0KICAgICAgICANCiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UocmV0WyJyZW1hcmsiXSwgZGljdCk6DQogICAgICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IGpzb24uZHVtcHMocmV0WyJyZW1hcmsiXSk7DQogICAgICAgICAgICByZXRbInJlbWFyayJdID0gdWJpbmFzY2lpLmIyYV9iYXNlNjQocmV0WyJyZW1hcmsiXSkuc3RyaXAoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYuY2xhc3NOYW1lKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbImNsYXNzTmFtZSJdID0gc2VsZi5jbGFzc05hbWUoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYubWV0aG9kKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbIm1ldGhvZCJdID0gc2VsZi5tZXRob2QoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYucGF5bG9hZCgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJwYXlsb2FkIl0gPSBzZWxmLnBheWxvYWQoKTsNCiAgICAgICAgDQogICAgICAgICAgICBpZiBpc2luc3RhbmNlKHJldFsicGF5bG9hZCJdLCBkaWN0KToNCiAgICAgICAgICAgICAgICByZXRbInBheWxvYWQiXSA9IGpzb24uZHVtcHMocmV0WyJwYXlsb2FkIl0pOw0KICAgICAgICAgICAgcmV0WyJwYXlsb2FkIl0gPSB1YmluYXNjaWkuYjJhX2Jhc2U2NChyZXRbInBheWxvYWQiXSkuc3RyaXAoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYuY2FycmllcigpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJjYXJyaWVyIl0gPSBzZWxmLmNhcnJpZXIoKS5fdG9Eb2N1bWVudCgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5zZW5kZXIoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsic2VuZGVyIl0gPSBzZWxmLnNlbmRlcigpLl90b0RvY3VtZW50KCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLnJlY2lwaWVudCgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJyZWNpcGllbnQiXSA9IHNlbGYucmVjaXBpZW50KCkuX3RvRG9jdW1lbnQoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJyZXNwb25zZVRvIl0gPSBzZWxmLnJlc3BvbnNlVG8oKS5fdG9Eb2N1bWVudCgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgcmV0dXJuIHJldDsNCg0KICAgIA0KICAgIGRlZiBzdG9yZShzZWxmLCBfX2V2ZW50PU5vbmUpOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ0V2ZW50OjpzdG9yZSgpOiAnOw0KICAgICAgICANCiAgICAgICAgZXZKU09OID0gTm9uZTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgZXZKU09OID0ganNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046DQogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOw0KICAgICAgICANCg0KICAgICAgICBhbnN3ZXIgPSBOb25lOw0KDQogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aW1lLnRpbWUoKSkrJ10uRXZlbnQuc3RvcmUoKScpLm1ldGhvZCgnc3RvcmUnKS5jbGFzc05hbWUoJ0V2ZW50JykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOw0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsNCiAgICAgICAgDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQogICAgICAgIA0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgIGFuc3dlciA9IEV2ZW50KCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCiAgICAgICAgDQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KDQoNCg0KICAgICAgICBpZiAnRXZlbnRfc3RvcmUnIGluIGRpcigpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICc9PT4gRXZlbnRfc3RvcmUoKScpOw0KICAgICAgICAgICAgYW5zd2VyID0gRXZlbnRfc3RvcmUoc2VsZiwgX19ldmVudCwgYW5zd2VyLCBfX3RvU3RyaW5nKTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCg0KICAgICAgICByZXR1cm4gYW5zd2VyOw0KDQogICAgDQogICAgZGVmIGZpbmRBbGwoc2VsZiwgX19ldmVudD1Ob25lKToNCiAgICAgICAgX190b1N0cmluZyA9ICdFdmVudDo6ZmluZEFsbCgpOiAnOw0KICAgICAgICANCiAgICAgICAgZXZKU09OID0gTm9uZTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgZXZKU09OID0ganNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046DQogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOw0KICAgICAgICANCg0KICAgICAgICBhbnN3ZXIgPSBOb25lOw0KDQogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aW1lLnRpbWUoKSkrJ10uRXZlbnQuZmluZEFsbCgpJykubWV0aG9kKCdmaW5kQWxsJykuY2xhc3NOYW1lKCdFdmVudCcpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7DQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KICAgICAgICANCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICBhbnN3ZXIgPSBFdmVudCgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQogICAgICAgIA0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCg0KDQoNCiAgICAgICAgaWYgJ0V2ZW50X2ZpbmRBbGwnIGluIGRpcigpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICc9PT4gRXZlbnRfZmluZEFsbCgpJyk7DQogICAgICAgICAgICBhbnN3ZXIgPSBFdmVudF9maW5kQWxsKHNlbGYsIF9fZXZlbnQsIGFuc3dlciwgX190b1N0cmluZyk7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KDQogICAgICAgICAgICANCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQoNCiAgICAgICAgcmV0dXJuIGFuc3dlcjsNCg0KICAgIA0KICAgIGRlZiBmaW5kKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6DQogICAgICAgIF9fdG9TdHJpbmcgPSAnRXZlbnQ6OmZpbmQoKTogJzsNCiAgICAgICAgDQogICAgICAgIGV2SlNPTiA9IE5vbmU7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIGV2SlNPTiA9IGpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOg0KICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsNCiAgICAgICAgDQoNCiAgICAgICAgYW5zd2VyID0gTm9uZTsNCg0KICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGltZS50aW1lKCkpKyddLkV2ZW50LmZpbmQoKScpLm1ldGhvZCgnZmluZCcpLmNsYXNzTmFtZSgnRXZlbnQnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOw0KICAgICAgICANCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCiAgICAgICAgDQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgYW5zd2VyID0gRXZlbnQoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KICAgICAgICANCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQoNCg0KDQogICAgICAgIGlmICdFdmVudF9maW5kJyBpbiBkaXIoKToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnPT0+IEV2ZW50X2ZpbmQoKScpOw0KICAgICAgICAgICAgYW5zd2VyID0gRXZlbnRfZmluZChzZWxmLCBfX2V2ZW50LCBhbnN3ZXIsIF9fdG9TdHJpbmcpOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCg0KICAgICAgICAgICAgDQogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KDQogICAgICAgIHJldHVybiBhbnN3ZXI7DQoNCiAgICANCiAgICBkZWYgbGlzdGVuKHNlbGYsIF9fZXZlbnQ9Tm9uZSwgbm9kZT1Ob25lKToNCiAgICAgICAgX190b1N0cmluZyA9ICdFdmVudDo6bGlzdGVuKCk6ICc7DQogICAgICAgIA0KICAgICAgICBldkpTT04gPSBOb25lOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBldkpTT04gPSBqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoNCiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7DQogICAgICAgIA0KICAgICAgICAgICAgaWYgJ25vZGUnIGluIGV2SlNPTjoNCiAgICAgICAgICAgICAgICBub2RlID0gZXZKU09OWydub2RlJ107DQogICAgICAgIA0KDQogICAgICAgIGFuc3dlciA9IE5vbmU7DQoNCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpbWUudGltZSgpKSsnXS5FdmVudC5saXN0ZW4oKScpLm1ldGhvZCgnbGlzdGVuJykuY2xhc3NOYW1lKCdFdmVudCcpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7DQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KICAgICAgICANCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICBhbnN3ZXIgPSBldkpTT047DQogICAgICAgIA0KICAgICAgICANCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQoNCg0KDQogICAgICAgIGlmICdFdmVudF9saXN0ZW4nIGluIGRpcigpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICc9PT4gRXZlbnRfbGlzdGVuKCknKTsNCiAgICAgICAgICAgIGFuc3dlciA9IEV2ZW50X2xpc3RlbihzZWxmLCBfX2V2ZW50LCBhbnN3ZXIsIF9fdG9TdHJpbmcpOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHN0cihhbnN3ZXIpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCg0KICAgICAgICAgICAgDQogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KDQogICAgICAgIHJldHVybiBhbnN3ZXI7DQoNCiAgICANCiAgICBkZWYgdHJpZ2dlcihzZWxmLCBfX2V2ZW50PU5vbmUpOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ0V2ZW50Ojp0cmlnZ2VyKCk6ICc7DQogICAgICAgIA0KICAgICAgICBldkpTT04gPSBOb25lOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBldkpTT04gPSBqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoNCiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7DQogICAgICAgIA0KDQogICAgICAgIGFuc3dlciA9IE5vbmU7DQoNCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpbWUudGltZSgpKSsnXS5FdmVudC50cmlnZ2VyKCknKS5tZXRob2QoJ3RyaWdnZXInKS5jbGFzc05hbWUoJ0V2ZW50JykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOw0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsNCiAgICAgICAgDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQogICAgICAgIA0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgIGFuc3dlciA9IGV2SlNPTjsNCiAgICAgICAgDQogICAgICAgIA0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCgogICAgICAgICAgICByZXR1cm4gbXF0dF9jbGllbnQucHVibGlzaChtcXR0X3RvcGljLCB1anNvbi5kdW1wcyhzZWxmLl90b0RvY3VtZW50KCkpKTsKCQkNCg0KDQogICAgICAgIGlmICdFdmVudF90cmlnZ2VyJyBpbiBkaXIoKToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnPT0+IEV2ZW50X3RyaWdnZXIoKScpOw0KICAgICAgICAgICAgYW5zd2VyID0gRXZlbnRfdHJpZ2dlcihzZWxmLCBfX2V2ZW50LCBhbnN3ZXIsIF9fdG9TdHJpbmcpOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHN0cihhbnN3ZXIpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCg0KICAgICAgICAgICAgDQoNCiAgICAgICAgcmV0dXJuIGFuc3dlcjsNCg0KICAgIA0KICAgIGRlZiBwcm9jZXNzKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6DQogICAgICAgIF9fdG9TdHJpbmcgPSAnRXZlbnQ6OnByb2Nlc3MoKTogJzsNCiAgICAgICAgDQogICAgICAgIGV2SlNPTiA9IE5vbmU7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIGV2SlNPTiA9IGpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOg0KICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsNCiAgICAgICAgDQoNCiAgICAgICAgYW5zd2VyID0gTm9uZTsNCg0KICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGltZS50aW1lKCkpKyddLkV2ZW50LnByb2Nlc3MoKScpLm1ldGhvZCgncHJvY2VzcycpLmNsYXNzTmFtZSgnRXZlbnQnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOw0KICAgICAgICANCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCiAgICAgICAgDQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgYW5zd2VyID0gRXZlbnQoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KICAgICAgICANCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQoKICAgICAgICAgICAgaWYgc2VsZi5zZW5kZXIoKS5jb2RlKCk9PW5vZGUuY29kZSgpOgogICAgICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJpZ25vcmluZyBteSBldmVudHMiKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgZWxpZiBzZWxmLnJlY2lwaWVudCgpLmNvZGUoKSE9bm9kZS5jb2RlKCk6CiAgICAgICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIm5vdCBzZW50IHRvIG1lIik7CiAgICAgICAgICAgICAgICByZXR1cm47CgogICAgICAgICAgICByZXR1cm4gZ2V0YXR0cihnbG9iYWxzKClbc2VsZi5jbGFzc05hbWUoKV0oKSwgc2VsZi5tZXRob2QoKSkoKTsKCQkNCg0KDQogICAgICAgIGlmICdFdmVudF9wcm9jZXNzJyBpbiBkaXIoKToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnPT0+IEV2ZW50X3Byb2Nlc3MoKScpOw0KICAgICAgICAgICAgYW5zd2VyID0gRXZlbnRfcHJvY2VzcyhzZWxmLCBfX2V2ZW50LCBhbnN3ZXIsIF9fdG9TdHJpbmcpOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCg0KICAgICAgICAgICAgDQogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KDQogICAgICAgIHJldHVybiBhbnN3ZXI7DQoNCiAgICANCg0KDQpjbGFzcyBOb2RlKCk6DQogICAgZGVmIF9faW5pdF9fKHNlbGYsIElkPU5vbmUsIGFjdGl2ZT1Ob25lLCBlbmFibGVkPU5vbmUsIGNvZGU9Tm9uZSwgb3JkZXI9Tm9uZSwgZGF0ZT1Ob25lLCBuYW1lPU5vbmUsIHJlbWFyaz1Ob25lLCBhZGRyZXNzPU5vbmUsIGJhY2t1cD1Ob25lLCBwYXJlbnQ9Tm9uZSwgZ3JvdXA9Tm9uZSwgY29udGV4dD1Ob25lLCBwb3J0PU5vbmUsIG9ubGluZT1Ob25lLCBzZWN1cmU9Tm9uZSwgdHlwZT1Ob25lKToNCiAgICAgICAgc3VwZXIoKS5fX2luaXRfXygpOw0KDQogICAgICAgICNwcmludCgnTm9kZTo6X19pbml0X18oKScpOw0KICAgICAgICBpZiBJZCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHNlbGYuSWQgPSBJZDsNCg0KICAgICAgICANCiAgICAgICAgc2VsZi5hY3RpdmUoYWN0aXZlKTsNCiAgICAgICAgc2VsZi5lbmFibGVkKGVuYWJsZWQpOw0KICAgICAgICBzZWxmLmNvZGUoY29kZSk7DQogICAgICAgIHNlbGYub3JkZXIob3JkZXIpOw0KICAgICAgICBzZWxmLmRhdGUoZGF0ZSk7DQogICAgICAgIHNlbGYubmFtZShuYW1lKTsNCiAgICAgICAgc2VsZi5yZW1hcmsocmVtYXJrKTsNCiAgICAgICAgc2VsZi5hZGRyZXNzKGFkZHJlc3MpOw0KICAgICAgICBzZWxmLmJhY2t1cChiYWNrdXApOw0KICAgICAgICBzZWxmLnBhcmVudChwYXJlbnQpOw0KICAgICAgICBzZWxmLmdyb3VwKGdyb3VwKTsNCiAgICAgICAgc2VsZi5jb250ZXh0KGNvbnRleHQpOw0KICAgICAgICBzZWxmLnBvcnQocG9ydCk7DQogICAgICAgIHNlbGYub25saW5lKG9ubGluZSk7DQogICAgICAgIHNlbGYuc2VjdXJlKHNlY3VyZSk7DQogICAgICAgIHNlbGYudHlwZSh0eXBlKTsNCiAgICAgICAgDQogICAgSWQgPSBOb25lOw0KICAgIA0KICAgIA0KICAgICMgYWN0aXZlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2FjdGl2ZSA9IE5vbmU7DQogICAgZGVmIGFjdGl2ZShzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9hY3RpdmUgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fYWN0aXZlOw0KDQoNCiAgICANCiAgICAjIGVuYWJsZWQ6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfZW5hYmxlZCA9IE5vbmU7DQogICAgZGVmIGVuYWJsZWQoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fZW5hYmxlZCA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9lbmFibGVkOw0KDQoNCiAgICANCiAgICAjIGNvZGU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfY29kZSA9IE5vbmU7DQogICAgZGVmIGNvZGUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fY29kZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9jb2RlOw0KDQoNCiAgICANCiAgICAjIG9yZGVyOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX29yZGVyID0gTm9uZTsNCiAgICBkZWYgb3JkZXIoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fb3JkZXIgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fb3JkZXI7DQoNCg0KICAgIA0KICAgICMgZGF0ZTogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9kYXRlID0gTm9uZTsNCiAgICBkZWYgZGF0ZShzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9kYXRlID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2RhdGU7DQoNCg0KICAgIA0KICAgICMgbmFtZTogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9uYW1lID0gTm9uZTsNCiAgICBkZWYgbmFtZShzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9uYW1lID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX25hbWU7DQoNCg0KICAgIA0KICAgICMgcmVtYXJrOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX3JlbWFyayA9IE5vbmU7DQogICAgZGVmIHJlbWFyayhzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9yZW1hcmsgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fcmVtYXJrOw0KDQoNCiAgICANCiAgICAjIGFkZHJlc3M6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfYWRkcmVzcyA9IE5vbmU7DQogICAgZGVmIGFkZHJlc3Moc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fYWRkcmVzcyA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9hZGRyZXNzOw0KDQoNCiAgICANCiAgICAjIGJhY2t1cDogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9iYWNrdXAgPSBOb25lOw0KICAgIGRlZiBiYWNrdXAoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fYmFja3VwID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2JhY2t1cDsNCg0KDQogICAgDQogICAgIyBwYXJlbnQ6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfcGFyZW50ID0gTm9uZTsNCiAgICBkZWYgcGFyZW50KHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX3BhcmVudCA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9wYXJlbnQ7DQoNCg0KICAgIA0KICAgICMgZ3JvdXA6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfZ3JvdXAgPSBOb25lOw0KICAgIGRlZiBncm91cChzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9ncm91cCA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9ncm91cDsNCg0KDQogICAgDQogICAgIyBjb250ZXh0OiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2NvbnRleHQgPSBOb25lOw0KICAgIGRlZiBjb250ZXh0KHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2NvbnRleHQgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fY29udGV4dDsNCg0KDQogICAgDQogICAgIyBwb3J0OiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX3BvcnQgPSBOb25lOw0KICAgIGRlZiBwb3J0KHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX3BvcnQgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fcG9ydDsNCg0KDQogICAgDQogICAgIyBvbmxpbmU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfb25saW5lID0gTm9uZTsNCiAgICBkZWYgb25saW5lKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX29ubGluZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9vbmxpbmU7DQoNCg0KICAgIA0KICAgICMgc2VjdXJlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX3NlY3VyZSA9IE5vbmU7DQogICAgZGVmIHNlY3VyZShzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9zZWN1cmUgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fc2VjdXJlOw0KDQoNCiAgICANCiAgICAjIHR5cGU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfdHlwZSA9IE5vbmU7DQogICAgZGVmIHR5cGUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fdHlwZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl90eXBlOw0KDQoNCiAgICANCiAgICANCiAgICBkZWYgX2Zyb21Eb2N1bWVudChzZWxmLCBvYmopOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ05vZGU6Ol9mcm9tRG9jdW1lbnQoKTogJzsNCg0KICAgICAgICBpZiBvYmogaXMgTm9uZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICANCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIGJ5dGVzKToNCiAgICAgICAgICAgIG9iaiA9IHN0cihvYmosICJ1dGYtOCIpOw0KDQogICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLCBzdHIpIG9yIHR5cGUob2JqKSBpcyBzdHI6DQogICAgICAgICAgICBvYmogPSBqc29uLmxvYWRzKG9iaik7DQogICAgICAgIA0KICAgICAgICBpZiBub3QgaXNpbnN0YW5jZShvYmosIChzdHIsIGJ5dGVzLCBkaWN0KSk6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJ0dPVCBIRVJFOiAnICsgc3RyKHR5cGUob2JqKSkpOw0KICAgICAgICAgICAgcmV0dXJuIG9iajsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZm9yIGkgaW4gb2JqOg0KICAgICAgICAgICAgICAgIG9ialtpXSA9IE5vZGUoKS5fZnJvbURvY3VtZW50KG9ialtpXSk7DQogICAgICAgICAgICByZXR1cm4gb2JqOw0KDQoNCiAgICAgICAgaWYgJ0lkJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLklkID0gb2JqWydJZCddOw0KDQogICAgDQogICAgICAgIGlmICdhY3RpdmUnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuYWN0aXZlKG9ialsnYWN0aXZlJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ2VuYWJsZWQnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuZW5hYmxlZChvYmpbJ2VuYWJsZWQnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnY29kZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5jb2RlKG9ialsnY29kZSddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdvcmRlcicgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5vcmRlcihvYmpbJ29yZGVyJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ2RhdGUnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuZGF0ZShvYmpbJ2RhdGUnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnbmFtZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5uYW1lKG9ialsnbmFtZSddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdyZW1hcmsnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYucmVtYXJrKG9ialsncmVtYXJrJ10pOw0KICAgICAgICANCiAgICAgICAgICAgIHNlbGYucmVtYXJrKCBiYXNlNjQuYjY0ZW5jb2RlKHNlbGYucmVtYXJrKCkuZW5jb2RlKCJhc2NpaSIpKS5kZWNvZGUoImFzY2lpIikgKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdhZGRyZXNzJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmFkZHJlc3Mob2JqWydhZGRyZXNzJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ2JhY2t1cCcgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5iYWNrdXAoTm9kZSgpLl9mcm9tRG9jdW1lbnQob2JqWydiYWNrdXAnXSkpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ3BhcmVudCcgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5wYXJlbnQoTm9kZSgpLl9mcm9tRG9jdW1lbnQob2JqWydwYXJlbnQnXSkpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ2dyb3VwJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmdyb3VwKE5vZGVfR3JvdXAoKS5fZnJvbURvY3VtZW50KG9ialsnZ3JvdXAnXSkpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ2NvbnRleHQnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuY29udGV4dChOb2RlX0NvbnRleHQoKS5fZnJvbURvY3VtZW50KG9ialsnY29udGV4dCddKSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAncG9ydCcgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5wb3J0KG9ialsncG9ydCddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdvbmxpbmUnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYub25saW5lKG9ialsnb25saW5lJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ3NlY3VyZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5zZWN1cmUob2JqWydzZWN1cmUnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAndHlwZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi50eXBlKE5vZGVfVHlwZSgpLl9mcm9tRG9jdW1lbnQob2JqWyd0eXBlJ10pKTsNCiAgICAgICAgDQogICAgDQoNCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICByZXR1cm4gc2VsZjsNCiAgICANCiAgICBkZWYgX3RvRG9jdW1lbnQoc2VsZik6DQogICAgICAgIHJldCA9IHt9Ow0KICAgICAgICBpZiBzZWxmLklkIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJJZCJdID0gc2VsZi5JZDsNCg0KICAgIA0KICAgICAgICBpZiBzZWxmLmFjdGl2ZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJhY3RpdmUiXSA9IHNlbGYuYWN0aXZlKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmVuYWJsZWQoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiZW5hYmxlZCJdID0gc2VsZi5lbmFibGVkKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmNvZGUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiY29kZSJdID0gc2VsZi5jb2RlKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLm9yZGVyKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbIm9yZGVyIl0gPSBzZWxmLm9yZGVyKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmRhdGUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiZGF0ZSJdID0gc2VsZi5kYXRlKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLm5hbWUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsibmFtZSJdID0gc2VsZi5uYW1lKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLnJlbWFyaygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IHNlbGYucmVtYXJrKCk7DQogICAgICAgIA0KICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShyZXRbInJlbWFyayJdLCBkaWN0KToNCiAgICAgICAgICAgICAgICByZXRbInJlbWFyayJdID0ganNvbi5kdW1wcyhyZXRbInJlbWFyayJdKTsNCiAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSB1YmluYXNjaWkuYjJhX2Jhc2U2NChyZXRbInJlbWFyayJdKS5zdHJpcCgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5hZGRyZXNzKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbImFkZHJlc3MiXSA9IHNlbGYuYWRkcmVzcygpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5iYWNrdXAoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiYmFja3VwIl0gPSBzZWxmLmJhY2t1cCgpLl90b0RvY3VtZW50KCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLnBhcmVudCgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJwYXJlbnQiXSA9IHNlbGYucGFyZW50KCkuX3RvRG9jdW1lbnQoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYuZ3JvdXAoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiZ3JvdXAiXSA9IHNlbGYuZ3JvdXAoKS5fdG9Eb2N1bWVudCgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5jb250ZXh0KCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbImNvbnRleHQiXSA9IHNlbGYuY29udGV4dCgpLl90b0RvY3VtZW50KCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLnBvcnQoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsicG9ydCJdID0gc2VsZi5wb3J0KCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLm9ubGluZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJvbmxpbmUiXSA9IHNlbGYub25saW5lKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLnNlY3VyZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJzZWN1cmUiXSA9IHNlbGYuc2VjdXJlKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLnR5cGUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsidHlwZSJdID0gc2VsZi50eXBlKCkuX3RvRG9jdW1lbnQoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIHJldHVybiByZXQ7DQoNCiAgICANCiAgICBkZWYgc3RvcmUoc2VsZiwgX19ldmVudD1Ob25lKToNCiAgICAgICAgX190b1N0cmluZyA9ICdOb2RlOjpzdG9yZSgpOiAnOw0KICAgICAgICANCiAgICAgICAgZXZKU09OID0gTm9uZTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgZXZKU09OID0ganNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046DQogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOw0KICAgICAgICANCg0KICAgICAgICBhbnN3ZXIgPSBOb25lOw0KDQogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aW1lLnRpbWUoKSkrJ10uTm9kZS5zdG9yZSgpJykubWV0aG9kKCdzdG9yZScpLmNsYXNzTmFtZSgnTm9kZScpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7DQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KICAgICAgICANCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICBhbnN3ZXIgPSBOb2RlKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCiAgICAgICAgCiAgICAgICAgDQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KDQoNCg0KICAgICAgICBpZiAnTm9kZV9zdG9yZScgaW4gZGlyKCk6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJz09PiBOb2RlX3N0b3JlKCknKTsNCiAgICAgICAgICAgIGFuc3dlciA9IE5vZGVfc3RvcmUoc2VsZiwgX19ldmVudCwgYW5zd2VyLCBfX3RvU3RyaW5nKTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCg0KICAgICAgICByZXR1cm4gYW5zd2VyOw0KDQogICAgDQogICAgZGVmIGZpbmRBbGwoc2VsZiwgX19ldmVudD1Ob25lKToNCiAgICAgICAgX190b1N0cmluZyA9ICdOb2RlOjpmaW5kQWxsKCk6ICc7DQogICAgICAgIA0KICAgICAgICBldkpTT04gPSBOb25lOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBldkpTT04gPSBqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoNCiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7DQogICAgICAgIA0KDQogICAgICAgIGFuc3dlciA9IE5vbmU7DQoNCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpbWUudGltZSgpKSsnXS5Ob2RlLmZpbmRBbGwoKScpLm1ldGhvZCgnZmluZEFsbCcpLmNsYXNzTmFtZSgnTm9kZScpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7DQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KICAgICAgICANCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICBhbnN3ZXIgPSBOb2RlKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCiAgICAgICAgDQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KDQoNCg0KICAgICAgICBpZiAnTm9kZV9maW5kQWxsJyBpbiBkaXIoKToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnPT0+IE5vZGVfZmluZEFsbCgpJyk7DQogICAgICAgICAgICBhbnN3ZXIgPSBOb2RlX2ZpbmRBbGwoc2VsZiwgX19ldmVudCwgYW5zd2VyLCBfX3RvU3RyaW5nKTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCg0KICAgICAgICByZXR1cm4gYW5zd2VyOw0KDQogICAgDQogICAgZGVmIGZpbmQoc2VsZiwgX19ldmVudD1Ob25lKToNCiAgICAgICAgX190b1N0cmluZyA9ICdOb2RlOjpmaW5kKCk6ICc7DQogICAgICAgIA0KICAgICAgICBldkpTT04gPSBOb25lOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBldkpTT04gPSBqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoNCiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7DQogICAgICAgIA0KDQogICAgICAgIGFuc3dlciA9IE5vbmU7DQoNCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpbWUudGltZSgpKSsnXS5Ob2RlLmZpbmQoKScpLm1ldGhvZCgnZmluZCcpLmNsYXNzTmFtZSgnTm9kZScpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7DQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KICAgICAgICANCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICBhbnN3ZXIgPSBOb2RlKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCiAgICAgICAgDQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KDQoNCg0KICAgICAgICBpZiAnTm9kZV9maW5kJyBpbiBkaXIoKToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnPT0+IE5vZGVfZmluZCgpJyk7DQogICAgICAgICAgICBhbnN3ZXIgPSBOb2RlX2ZpbmQoc2VsZiwgX19ldmVudCwgYW5zd2VyLCBfX3RvU3RyaW5nKTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCg0KICAgICAgICByZXR1cm4gYW5zd2VyOw0KDQogICAgDQogICAgZGVmIGF1dGhDb2RlKHNlbGYsIF9fZXZlbnQ9Tm9uZSwgY29kZT1Ob25lLCB0b29sPU5vbmUpOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ05vZGU6OmF1dGhDb2RlKCk6ICc7DQogICAgICAgIA0KICAgICAgICBldkpTT04gPSBOb25lOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBldkpTT04gPSBqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoNCiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7DQogICAgICAgIA0KICAgICAgICAgICAgaWYgJ2NvZGUnIGluIGV2SlNPTjoNCiAgICAgICAgICAgICAgICBjb2RlID0gZXZKU09OWydjb2RlJ107DQogICAgICAgIA0KICAgICAgICAgICAgaWYgJ3Rvb2wnIGluIGV2SlNPTjoNCiAgICAgICAgICAgICAgICB0b29sID0gZXZKU09OWyd0b29sJ107DQogICAgICAgIA0KDQogICAgICAgIGFuc3dlciA9IE5vbmU7DQoNCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpbWUudGltZSgpKSsnXS5Ob2RlLmF1dGhDb2RlKCknKS5tZXRob2QoJ2F1dGhDb2RlJykuY2xhc3NOYW1lKCdOb2RlJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOw0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsNCiAgICAgICAgDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQogICAgICAgIA0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgIGFuc3dlciA9IGV2SlNPTjsNCiAgICAgICAgDQogICAgICAgIA0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCg0KDQoNCiAgICAgICAgaWYgJ05vZGVfYXV0aENvZGUnIGluIGRpcigpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICc9PT4gTm9kZV9hdXRoQ29kZSgpJyk7DQogICAgICAgICAgICBhbnN3ZXIgPSBOb2RlX2F1dGhDb2RlKHNlbGYsIF9fZXZlbnQsIGFuc3dlciwgX190b1N0cmluZyk7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoc3RyKGFuc3dlcikpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KDQogICAgICAgICAgICANCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQoNCiAgICAgICAgcmV0dXJuIGFuc3dlcjsNCg0KICAgIA0KICAgIGRlZiBpbml0KHNlbGYsIF9fZXZlbnQ9Tm9uZSwgb25saW5lPU5vbmUsIGNvZGU9Tm9uZSwgdWlkPU5vbmUpOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ05vZGU6OmluaXQoKTogJzsNCiAgICAgICAgDQogICAgICAgIGV2SlNPTiA9IE5vbmU7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIGV2SlNPTiA9IGpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOg0KICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsNCiAgICAgICAgDQogICAgICAgICAgICBpZiAnb25saW5lJyBpbiBldkpTT046DQogICAgICAgICAgICAgICAgb25saW5lID0gZXZKU09OWydvbmxpbmUnXTsNCiAgICAgICAgDQogICAgICAgICAgICBpZiAnY29kZScgaW4gZXZKU09OOg0KICAgICAgICAgICAgICAgIGNvZGUgPSBldkpTT05bJ2NvZGUnXTsNCiAgICAgICAgDQogICAgICAgICAgICBpZiAndWlkJyBpbiBldkpTT046DQogICAgICAgICAgICAgICAgdWlkID0gZXZKU09OWyd1aWQnXTsNCiAgICAgICAgDQoNCiAgICAgICAgYW5zd2VyID0gTm9uZTsNCg0KICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGltZS50aW1lKCkpKyddLk5vZGUuaW5pdCgpJykubWV0aG9kKCdpbml0JykuY2xhc3NOYW1lKCdOb2RlJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOw0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsNCiAgICAgICAgDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQogICAgICAgIA0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgIGFuc3dlciA9IE5vZGUoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KICAgICAgICANCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQoNCg0KDQogICAgICAgIGlmICdOb2RlX2luaXQnIGluIGRpcigpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICc9PT4gTm9kZV9pbml0KCknKTsNCiAgICAgICAgICAgIGFuc3dlciA9IE5vZGVfaW5pdChzZWxmLCBfX2V2ZW50LCBhbnN3ZXIsIF9fdG9TdHJpbmcpOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCg0KICAgICAgICAgICAgDQogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KDQogICAgICAgIHJldHVybiBhbnN3ZXI7DQoNCiAgICANCiAgICBkZWYgcmVzdGFydChzZWxmLCBfX2V2ZW50PU5vbmUpOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ05vZGU6OnJlc3RhcnQoKTogJzsNCiAgICAgICAgDQogICAgICAgIGV2SlNPTiA9IE5vbmU7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIGV2SlNPTiA9IGpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOg0KICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsNCiAgICAgICAgDQoNCiAgICAgICAgYW5zd2VyID0gTm9uZTsNCg0KICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGltZS50aW1lKCkpKyddLk5vZGUucmVzdGFydCgpJykubWV0aG9kKCdyZXN0YXJ0JykuY2xhc3NOYW1lKCdOb2RlJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOw0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsNCiAgICAgICAgDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQogICAgICAgIA0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgIGFuc3dlciA9IGV2SlNPTjsNCiAgICAgICAgDQogICAgICAgIA0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCg0KDQoNCiAgICAgICAgaWYgJ05vZGVfcmVzdGFydCcgaW4gZGlyKCk6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJz09PiBOb2RlX3Jlc3RhcnQoKScpOw0KICAgICAgICAgICAgYW5zd2VyID0gTm9kZV9yZXN0YXJ0KHNlbGYsIF9fZXZlbnQsIGFuc3dlciwgX190b1N0cmluZyk7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoc3RyKGFuc3dlcikpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KDQogICAgICAgICAgICANCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQoNCiAgICAgICAgcmV0dXJuIGFuc3dlcjsNCg0KICAgIA0KICAgIGRlZiBzdGF0dXMoc2VsZiwgX19ldmVudD1Ob25lKToNCiAgICAgICAgX190b1N0cmluZyA9ICdOb2RlOjpzdGF0dXMoKTogJzsNCiAgICAgICAgDQogICAgICAgIGV2SlNPTiA9IE5vbmU7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIGV2SlNPTiA9IGpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOg0KICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsNCiAgICAgICAgDQoNCiAgICAgICAgYW5zd2VyID0gTm9uZTsNCg0KICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGltZS50aW1lKCkpKyddLk5vZGUuc3RhdHVzKCknKS5tZXRob2QoJ3N0YXR1cycpLmNsYXNzTmFtZSgnTm9kZScpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7DQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KICAgICAgICANCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICBhbnN3ZXIgPSBldkpTT047DQogICAgICAgIA0KICAgICAgICANCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQoNCg0KDQogICAgICAgIGlmICdOb2RlX3N0YXR1cycgaW4gZGlyKCk6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJz09PiBOb2RlX3N0YXR1cygpJyk7DQogICAgICAgICAgICBhbnN3ZXIgPSBOb2RlX3N0YXR1cyhzZWxmLCBfX2V2ZW50LCBhbnN3ZXIsIF9fdG9TdHJpbmcpOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHN0cihhbnN3ZXIpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCg0KICAgICAgICAgICAgDQogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KDQogICAgICAgIHJldHVybiBhbnN3ZXI7DQoNCiAgICANCg0KDQpjbGFzcyBOb2RlX0NvbnRleHQoKToNCiAgICBkZWYgX19pbml0X18oc2VsZiwgSWQ9Tm9uZSwgYWN0aXZlPU5vbmUsIGVuYWJsZWQ9Tm9uZSwgY29kZT1Ob25lLCBvcmRlcj1Ob25lLCBkYXRlPU5vbmUsIG5hbWU9Tm9uZSwgcmVtYXJrPU5vbmUpOg0KICAgICAgICBzdXBlcigpLl9faW5pdF9fKCk7DQoNCiAgICAgICAgI3ByaW50KCdOb2RlX0NvbnRleHQ6Ol9faW5pdF9fKCknKTsNCiAgICAgICAgaWYgSWQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBzZWxmLklkID0gSWQ7DQoNCiAgICAgICAgDQogICAgICAgIHNlbGYuYWN0aXZlKGFjdGl2ZSk7DQogICAgICAgIHNlbGYuZW5hYmxlZChlbmFibGVkKTsNCiAgICAgICAgc2VsZi5jb2RlKGNvZGUpOw0KICAgICAgICBzZWxmLm9yZGVyKG9yZGVyKTsNCiAgICAgICAgc2VsZi5kYXRlKGRhdGUpOw0KICAgICAgICBzZWxmLm5hbWUobmFtZSk7DQogICAgICAgIHNlbGYucmVtYXJrKHJlbWFyayk7DQogICAgICAgIA0KICAgIElkID0gTm9uZTsNCiAgICANCiAgICANCiAgICAjIGFjdGl2ZTogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9hY3RpdmUgPSBOb25lOw0KICAgIGRlZiBhY3RpdmUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fYWN0aXZlID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2FjdGl2ZTsNCg0KDQogICAgDQogICAgIyBlbmFibGVkOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2VuYWJsZWQgPSBOb25lOw0KICAgIGRlZiBlbmFibGVkKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2VuYWJsZWQgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fZW5hYmxlZDsNCg0KDQogICAgDQogICAgIyBjb2RlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2NvZGUgPSBOb25lOw0KICAgIGRlZiBjb2RlKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2NvZGUgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fY29kZTsNCg0KDQogICAgDQogICAgIyBvcmRlcjogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9vcmRlciA9IE5vbmU7DQogICAgZGVmIG9yZGVyKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX29yZGVyID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX29yZGVyOw0KDQoNCiAgICANCiAgICAjIGRhdGU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfZGF0ZSA9IE5vbmU7DQogICAgZGVmIGRhdGUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fZGF0ZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9kYXRlOw0KDQoNCiAgICANCiAgICAjIG5hbWU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfbmFtZSA9IE5vbmU7DQogICAgZGVmIG5hbWUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fbmFtZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9uYW1lOw0KDQoNCiAgICANCiAgICAjIHJlbWFyazogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9yZW1hcmsgPSBOb25lOw0KICAgIGRlZiByZW1hcmsoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fcmVtYXJrID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3JlbWFyazsNCg0KDQogICAgDQogICAgDQogICAgZGVmIF9mcm9tRG9jdW1lbnQoc2VsZiwgb2JqKToNCiAgICAgICAgX190b1N0cmluZyA9ICdOb2RlX0NvbnRleHQ6Ol9mcm9tRG9jdW1lbnQoKTogJzsNCg0KICAgICAgICBpZiBvYmogaXMgTm9uZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICANCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIGJ5dGVzKToNCiAgICAgICAgICAgIG9iaiA9IHN0cihvYmosICJ1dGYtOCIpOw0KDQogICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLCBzdHIpIG9yIHR5cGUob2JqKSBpcyBzdHI6DQogICAgICAgICAgICBvYmogPSBqc29uLmxvYWRzKG9iaik7DQogICAgICAgIA0KICAgICAgICBpZiBub3QgaXNpbnN0YW5jZShvYmosIChzdHIsIGJ5dGVzLCBkaWN0KSk6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJ0dPVCBIRVJFOiAnICsgc3RyKHR5cGUob2JqKSkpOw0KICAgICAgICAgICAgcmV0dXJuIG9iajsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZm9yIGkgaW4gb2JqOg0KICAgICAgICAgICAgICAgIG9ialtpXSA9IE5vZGVfQ29udGV4dCgpLl9mcm9tRG9jdW1lbnQob2JqW2ldKTsNCiAgICAgICAgICAgIHJldHVybiBvYmo7DQoNCg0KICAgICAgICBpZiAnSWQnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuSWQgPSBvYmpbJ0lkJ107DQoNCiAgICANCiAgICAgICAgaWYgJ2FjdGl2ZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5hY3RpdmUob2JqWydhY3RpdmUnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnZW5hYmxlZCcgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5lbmFibGVkKG9ialsnZW5hYmxlZCddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdjb2RlJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmNvZGUob2JqWydjb2RlJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ29yZGVyJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLm9yZGVyKG9ialsnb3JkZXInXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnZGF0ZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5kYXRlKG9ialsnZGF0ZSddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICduYW1lJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLm5hbWUob2JqWyduYW1lJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ3JlbWFyaycgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5yZW1hcmsob2JqWydyZW1hcmsnXSk7DQogICAgICAgIA0KICAgICAgICAgICAgc2VsZi5yZW1hcmsoIGJhc2U2NC5iNjRlbmNvZGUoc2VsZi5yZW1hcmsoKS5lbmNvZGUoImFzY2lpIikpLmRlY29kZSgiYXNjaWkiKSApOw0KICAgICAgICANCiAgICANCg0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIHJldHVybiBzZWxmOw0KICAgIA0KICAgIGRlZiBfdG9Eb2N1bWVudChzZWxmKToNCiAgICAgICAgcmV0ID0ge307DQogICAgICAgIGlmIHNlbGYuSWQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbIklkIl0gPSBzZWxmLklkOw0KDQogICAgDQogICAgICAgIGlmIHNlbGYuYWN0aXZlKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbImFjdGl2ZSJdID0gc2VsZi5hY3RpdmUoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYuZW5hYmxlZCgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJlbmFibGVkIl0gPSBzZWxmLmVuYWJsZWQoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYuY29kZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJjb2RlIl0gPSBzZWxmLmNvZGUoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYub3JkZXIoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsib3JkZXIiXSA9IHNlbGYub3JkZXIoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYuZGF0ZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJkYXRlIl0gPSBzZWxmLmRhdGUoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYubmFtZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJuYW1lIl0gPSBzZWxmLm5hbWUoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYucmVtYXJrKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbInJlbWFyayJdID0gc2VsZi5yZW1hcmsoKTsNCiAgICAgICAgDQogICAgICAgICAgICBpZiBpc2luc3RhbmNlKHJldFsicmVtYXJrIl0sIGRpY3QpOg0KICAgICAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSBqc29uLmR1bXBzKHJldFsicmVtYXJrIl0pOw0KICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IHViaW5hc2NpaS5iMmFfYmFzZTY0KHJldFsicmVtYXJrIl0pLnN0cmlwKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICANCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICByZXR1cm4gcmV0Ow0KDQogICAgDQogICAgZGVmIHN0b3JlKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6DQogICAgICAgIF9fdG9TdHJpbmcgPSAnTm9kZV9Db250ZXh0OjpzdG9yZSgpOiAnOw0KICAgICAgICANCiAgICAgICAgZXZKU09OID0gTm9uZTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgZXZKU09OID0ganNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046DQogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOw0KICAgICAgICANCg0KICAgICAgICBhbnN3ZXIgPSBOb25lOw0KDQogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aW1lLnRpbWUoKSkrJ10uTm9kZV9Db250ZXh0LnN0b3JlKCknKS5tZXRob2QoJ3N0b3JlJykuY2xhc3NOYW1lKCdOb2RlX0NvbnRleHQnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOw0KICAgICAgICANCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCiAgICAgICAgDQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgYW5zd2VyID0gTm9kZV9Db250ZXh0KCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCiAgICAgICAgDQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KDQoNCg0KICAgICAgICBpZiAnTm9kZV9Db250ZXh0X3N0b3JlJyBpbiBkaXIoKToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnPT0+IE5vZGVfQ29udGV4dF9zdG9yZSgpJyk7DQogICAgICAgICAgICBhbnN3ZXIgPSBOb2RlX0NvbnRleHRfc3RvcmUoc2VsZiwgX19ldmVudCwgYW5zd2VyLCBfX3RvU3RyaW5nKTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCg0KICAgICAgICByZXR1cm4gYW5zd2VyOw0KDQogICAgDQogICAgZGVmIGZpbmRBbGwoc2VsZiwgX19ldmVudD1Ob25lKToNCiAgICAgICAgX190b1N0cmluZyA9ICdOb2RlX0NvbnRleHQ6OmZpbmRBbGwoKTogJzsNCiAgICAgICAgDQogICAgICAgIGV2SlNPTiA9IE5vbmU7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIGV2SlNPTiA9IGpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOg0KICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsNCiAgICAgICAgDQoNCiAgICAgICAgYW5zd2VyID0gTm9uZTsNCg0KICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGltZS50aW1lKCkpKyddLk5vZGVfQ29udGV4dC5maW5kQWxsKCknKS5tZXRob2QoJ2ZpbmRBbGwnKS5jbGFzc05hbWUoJ05vZGVfQ29udGV4dCcpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7DQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KICAgICAgICANCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICBhbnN3ZXIgPSBOb2RlX0NvbnRleHQoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KICAgICAgICANCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQoNCg0KDQogICAgICAgIGlmICdOb2RlX0NvbnRleHRfZmluZEFsbCcgaW4gZGlyKCk6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJz09PiBOb2RlX0NvbnRleHRfZmluZEFsbCgpJyk7DQogICAgICAgICAgICBhbnN3ZXIgPSBOb2RlX0NvbnRleHRfZmluZEFsbChzZWxmLCBfX2V2ZW50LCBhbnN3ZXIsIF9fdG9TdHJpbmcpOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCg0KICAgICAgICAgICAgDQogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KDQogICAgICAgIHJldHVybiBhbnN3ZXI7DQoNCiAgICANCiAgICBkZWYgZmluZChzZWxmLCBfX2V2ZW50PU5vbmUpOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ05vZGVfQ29udGV4dDo6ZmluZCgpOiAnOw0KICAgICAgICANCiAgICAgICAgZXZKU09OID0gTm9uZTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgZXZKU09OID0ganNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046DQogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOw0KICAgICAgICANCg0KICAgICAgICBhbnN3ZXIgPSBOb25lOw0KDQogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aW1lLnRpbWUoKSkrJ10uTm9kZV9Db250ZXh0LmZpbmQoKScpLm1ldGhvZCgnZmluZCcpLmNsYXNzTmFtZSgnTm9kZV9Db250ZXh0JykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOw0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsNCiAgICAgICAgDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQogICAgICAgIA0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgIGFuc3dlciA9IE5vZGVfQ29udGV4dCgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQogICAgICAgIA0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCg0KDQoNCiAgICAgICAgaWYgJ05vZGVfQ29udGV4dF9maW5kJyBpbiBkaXIoKToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnPT0+IE5vZGVfQ29udGV4dF9maW5kKCknKTsNCiAgICAgICAgICAgIGFuc3dlciA9IE5vZGVfQ29udGV4dF9maW5kKHNlbGYsIF9fZXZlbnQsIGFuc3dlciwgX190b1N0cmluZyk7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KDQogICAgICAgICAgICANCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQoNCiAgICAgICAgcmV0dXJuIGFuc3dlcjsNCg0KICAgIA0KDQoNCmNsYXNzIE5vZGVfR3JvdXAoKToNCiAgICBkZWYgX19pbml0X18oc2VsZiwgSWQ9Tm9uZSwgYWN0aXZlPU5vbmUsIGVuYWJsZWQ9Tm9uZSwgY29kZT1Ob25lLCBvcmRlcj1Ob25lLCBkYXRlPU5vbmUsIG5hbWU9Tm9uZSwgcmVtYXJrPU5vbmUpOg0KICAgICAgICBzdXBlcigpLl9faW5pdF9fKCk7DQoNCiAgICAgICAgI3ByaW50KCdOb2RlX0dyb3VwOjpfX2luaXRfXygpJyk7DQogICAgICAgIGlmIElkIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgc2VsZi5JZCA9IElkOw0KDQogICAgICAgIA0KICAgICAgICBzZWxmLmFjdGl2ZShhY3RpdmUpOw0KICAgICAgICBzZWxmLmVuYWJsZWQoZW5hYmxlZCk7DQogICAgICAgIHNlbGYuY29kZShjb2RlKTsNCiAgICAgICAgc2VsZi5vcmRlcihvcmRlcik7DQogICAgICAgIHNlbGYuZGF0ZShkYXRlKTsNCiAgICAgICAgc2VsZi5uYW1lKG5hbWUpOw0KICAgICAgICBzZWxmLnJlbWFyayhyZW1hcmspOw0KICAgICAgICANCiAgICBJZCA9IE5vbmU7DQogICAgDQogICAgDQogICAgIyBhY3RpdmU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfYWN0aXZlID0gTm9uZTsNCiAgICBkZWYgYWN0aXZlKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2FjdGl2ZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9hY3RpdmU7DQoNCg0KICAgIA0KICAgICMgZW5hYmxlZDogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9lbmFibGVkID0gTm9uZTsNCiAgICBkZWYgZW5hYmxlZChzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9lbmFibGVkID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2VuYWJsZWQ7DQoNCg0KICAgIA0KICAgICMgY29kZTogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9jb2RlID0gTm9uZTsNCiAgICBkZWYgY29kZShzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9jb2RlID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2NvZGU7DQoNCg0KICAgIA0KICAgICMgb3JkZXI6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfb3JkZXIgPSBOb25lOw0KICAgIGRlZiBvcmRlcihzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9vcmRlciA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9vcmRlcjsNCg0KDQogICAgDQogICAgIyBkYXRlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2RhdGUgPSBOb25lOw0KICAgIGRlZiBkYXRlKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2RhdGUgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fZGF0ZTsNCg0KDQogICAgDQogICAgIyBuYW1lOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX25hbWUgPSBOb25lOw0KICAgIGRlZiBuYW1lKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX25hbWUgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fbmFtZTsNCg0KDQogICAgDQogICAgIyByZW1hcms6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfcmVtYXJrID0gTm9uZTsNCiAgICBkZWYgcmVtYXJrKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX3JlbWFyayA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9yZW1hcms7DQoNCg0KICAgIA0KICAgIA0KICAgIGRlZiBfZnJvbURvY3VtZW50KHNlbGYsIG9iaik6DQogICAgICAgIF9fdG9TdHJpbmcgPSAnTm9kZV9Hcm91cDo6X2Zyb21Eb2N1bWVudCgpOiAnOw0KDQogICAgICAgIGlmIG9iaiBpcyBOb25lOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIA0KICAgICAgICBpZiBpc2luc3RhbmNlKG9iaiwgYnl0ZXMpOg0KICAgICAgICAgICAgb2JqID0gc3RyKG9iaiwgInV0Zi04Iik7DQoNCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIHN0cikgb3IgdHlwZShvYmopIGlzIHN0cjoNCiAgICAgICAgICAgIG9iaiA9IGpzb24ubG9hZHMob2JqKTsNCiAgICAgICAgDQogICAgICAgIGlmIG5vdCBpc2luc3RhbmNlKG9iaiwgKHN0ciwgYnl0ZXMsIGRpY3QpKToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnR09UIEhFUkU6ICcgKyBzdHIodHlwZShvYmopKSk7DQogICAgICAgICAgICByZXR1cm4gb2JqOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBmb3IgaSBpbiBvYmo6DQogICAgICAgICAgICAgICAgb2JqW2ldID0gTm9kZV9Hcm91cCgpLl9mcm9tRG9jdW1lbnQob2JqW2ldKTsNCiAgICAgICAgICAgIHJldHVybiBvYmo7DQoNCg0KICAgICAgICBpZiAnSWQnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuSWQgPSBvYmpbJ0lkJ107DQoNCiAgICANCiAgICAgICAgaWYgJ2FjdGl2ZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5hY3RpdmUob2JqWydhY3RpdmUnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnZW5hYmxlZCcgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5lbmFibGVkKG9ialsnZW5hYmxlZCddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdjb2RlJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmNvZGUob2JqWydjb2RlJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ29yZGVyJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLm9yZGVyKG9ialsnb3JkZXInXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnZGF0ZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5kYXRlKG9ialsnZGF0ZSddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICduYW1lJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLm5hbWUob2JqWyduYW1lJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ3JlbWFyaycgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5yZW1hcmsob2JqWydyZW1hcmsnXSk7DQogICAgICAgIA0KICAgICAgICAgICAgc2VsZi5yZW1hcmsoIGJhc2U2NC5iNjRlbmNvZGUoc2VsZi5yZW1hcmsoKS5lbmNvZGUoImFzY2lpIikpLmRlY29kZSgiYXNjaWkiKSApOw0KICAgICAgICANCiAgICANCg0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIHJldHVybiBzZWxmOw0KICAgIA0KICAgIGRlZiBfdG9Eb2N1bWVudChzZWxmKToNCiAgICAgICAgcmV0ID0ge307DQogICAgICAgIGlmIHNlbGYuSWQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbIklkIl0gPSBzZWxmLklkOw0KDQogICAgDQogICAgICAgIGlmIHNlbGYuYWN0aXZlKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbImFjdGl2ZSJdID0gc2VsZi5hY3RpdmUoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYuZW5hYmxlZCgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJlbmFibGVkIl0gPSBzZWxmLmVuYWJsZWQoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYuY29kZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJjb2RlIl0gPSBzZWxmLmNvZGUoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYub3JkZXIoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsib3JkZXIiXSA9IHNlbGYub3JkZXIoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYuZGF0ZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJkYXRlIl0gPSBzZWxmLmRhdGUoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYubmFtZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJuYW1lIl0gPSBzZWxmLm5hbWUoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYucmVtYXJrKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbInJlbWFyayJdID0gc2VsZi5yZW1hcmsoKTsNCiAgICAgICAgDQogICAgICAgICAgICBpZiBpc2luc3RhbmNlKHJldFsicmVtYXJrIl0sIGRpY3QpOg0KICAgICAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSBqc29uLmR1bXBzKHJldFsicmVtYXJrIl0pOw0KICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IHViaW5hc2NpaS5iMmFfYmFzZTY0KHJldFsicmVtYXJrIl0pLnN0cmlwKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICANCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICByZXR1cm4gcmV0Ow0KDQogICAgDQogICAgZGVmIHN0b3JlKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6DQogICAgICAgIF9fdG9TdHJpbmcgPSAnTm9kZV9Hcm91cDo6c3RvcmUoKTogJzsNCiAgICAgICAgDQogICAgICAgIGV2SlNPTiA9IE5vbmU7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIGV2SlNPTiA9IGpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOg0KICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsNCiAgICAgICAgDQoNCiAgICAgICAgYW5zd2VyID0gTm9uZTsNCg0KICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGltZS50aW1lKCkpKyddLk5vZGVfR3JvdXAuc3RvcmUoKScpLm1ldGhvZCgnc3RvcmUnKS5jbGFzc05hbWUoJ05vZGVfR3JvdXAnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOw0KICAgICAgICANCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCiAgICAgICAgDQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgYW5zd2VyID0gTm9kZV9Hcm91cCgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQogICAgICAgIA0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCg0KDQoNCiAgICAgICAgaWYgJ05vZGVfR3JvdXBfc3RvcmUnIGluIGRpcigpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICc9PT4gTm9kZV9Hcm91cF9zdG9yZSgpJyk7DQogICAgICAgICAgICBhbnN3ZXIgPSBOb2RlX0dyb3VwX3N0b3JlKHNlbGYsIF9fZXZlbnQsIGFuc3dlciwgX190b1N0cmluZyk7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KDQogICAgICAgICAgICANCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQoNCiAgICAgICAgcmV0dXJuIGFuc3dlcjsNCg0KICAgIA0KICAgIGRlZiBmaW5kQWxsKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6DQogICAgICAgIF9fdG9TdHJpbmcgPSAnTm9kZV9Hcm91cDo6ZmluZEFsbCgpOiAnOw0KICAgICAgICANCiAgICAgICAgZXZKU09OID0gTm9uZTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgZXZKU09OID0ganNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046DQogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOw0KICAgICAgICANCg0KICAgICAgICBhbnN3ZXIgPSBOb25lOw0KDQogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aW1lLnRpbWUoKSkrJ10uTm9kZV9Hcm91cC5maW5kQWxsKCknKS5tZXRob2QoJ2ZpbmRBbGwnKS5jbGFzc05hbWUoJ05vZGVfR3JvdXAnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOw0KICAgICAgICANCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCiAgICAgICAgDQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgYW5zd2VyID0gTm9kZV9Hcm91cCgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQogICAgICAgIA0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCg0KDQoNCiAgICAgICAgaWYgJ05vZGVfR3JvdXBfZmluZEFsbCcgaW4gZGlyKCk6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJz09PiBOb2RlX0dyb3VwX2ZpbmRBbGwoKScpOw0KICAgICAgICAgICAgYW5zd2VyID0gTm9kZV9Hcm91cF9maW5kQWxsKHNlbGYsIF9fZXZlbnQsIGFuc3dlciwgX190b1N0cmluZyk7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KDQogICAgICAgICAgICANCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQoNCiAgICAgICAgcmV0dXJuIGFuc3dlcjsNCg0KICAgIA0KICAgIGRlZiBmaW5kKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6DQogICAgICAgIF9fdG9TdHJpbmcgPSAnTm9kZV9Hcm91cDo6ZmluZCgpOiAnOw0KICAgICAgICANCiAgICAgICAgZXZKU09OID0gTm9uZTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgZXZKU09OID0ganNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046DQogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOw0KICAgICAgICANCg0KICAgICAgICBhbnN3ZXIgPSBOb25lOw0KDQogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aW1lLnRpbWUoKSkrJ10uTm9kZV9Hcm91cC5maW5kKCknKS5tZXRob2QoJ2ZpbmQnKS5jbGFzc05hbWUoJ05vZGVfR3JvdXAnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOw0KICAgICAgICANCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCiAgICAgICAgDQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgYW5zd2VyID0gTm9kZV9Hcm91cCgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQogICAgICAgIA0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCg0KDQoNCiAgICAgICAgaWYgJ05vZGVfR3JvdXBfZmluZCcgaW4gZGlyKCk6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJz09PiBOb2RlX0dyb3VwX2ZpbmQoKScpOw0KICAgICAgICAgICAgYW5zd2VyID0gTm9kZV9Hcm91cF9maW5kKHNlbGYsIF9fZXZlbnQsIGFuc3dlciwgX190b1N0cmluZyk7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KDQogICAgICAgICAgICANCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQoNCiAgICAgICAgcmV0dXJuIGFuc3dlcjsNCg0KICAgIA0KDQoNCmNsYXNzIE5vZGVfVHlwZSgpOg0KICAgIGRlZiBfX2luaXRfXyhzZWxmLCBJZD1Ob25lLCBhY3RpdmU9Tm9uZSwgZW5hYmxlZD1Ob25lLCBjb2RlPU5vbmUsIG9yZGVyPU5vbmUsIGRhdGU9Tm9uZSwgbmFtZT1Ob25lLCByZW1hcms9Tm9uZSwgZHluYW1pYz1Ob25lKToNCiAgICAgICAgc3VwZXIoKS5fX2luaXRfXygpOw0KDQogICAgICAgICNwcmludCgnTm9kZV9UeXBlOjpfX2luaXRfXygpJyk7DQogICAgICAgIGlmIElkIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgc2VsZi5JZCA9IElkOw0KDQogICAgICAgIA0KICAgICAgICBzZWxmLmFjdGl2ZShhY3RpdmUpOw0KICAgICAgICBzZWxmLmVuYWJsZWQoZW5hYmxlZCk7DQogICAgICAgIHNlbGYuY29kZShjb2RlKTsNCiAgICAgICAgc2VsZi5vcmRlcihvcmRlcik7DQogICAgICAgIHNlbGYuZGF0ZShkYXRlKTsNCiAgICAgICAgc2VsZi5uYW1lKG5hbWUpOw0KICAgICAgICBzZWxmLnJlbWFyayhyZW1hcmspOw0KICAgICAgICBzZWxmLmR5bmFtaWMoZHluYW1pYyk7DQogICAgICAgIA0KICAgIElkID0gTm9uZTsNCiAgICANCiAgICANCiAgICAjIGFjdGl2ZTogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9hY3RpdmUgPSBOb25lOw0KICAgIGRlZiBhY3RpdmUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fYWN0aXZlID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2FjdGl2ZTsNCg0KDQogICAgDQogICAgIyBlbmFibGVkOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2VuYWJsZWQgPSBOb25lOw0KICAgIGRlZiBlbmFibGVkKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2VuYWJsZWQgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fZW5hYmxlZDsNCg0KDQogICAgDQogICAgIyBjb2RlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2NvZGUgPSBOb25lOw0KICAgIGRlZiBjb2RlKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2NvZGUgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fY29kZTsNCg0KDQogICAgDQogICAgIyBvcmRlcjogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9vcmRlciA9IE5vbmU7DQogICAgZGVmIG9yZGVyKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX29yZGVyID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX29yZGVyOw0KDQoNCiAgICANCiAgICAjIGRhdGU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfZGF0ZSA9IE5vbmU7DQogICAgZGVmIGRhdGUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fZGF0ZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9kYXRlOw0KDQoNCiAgICANCiAgICAjIG5hbWU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfbmFtZSA9IE5vbmU7DQogICAgZGVmIG5hbWUoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fbmFtZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9uYW1lOw0KDQoNCiAgICANCiAgICAjIHJlbWFyazogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9yZW1hcmsgPSBOb25lOw0KICAgIGRlZiByZW1hcmsoc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fcmVtYXJrID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3JlbWFyazsNCg0KDQogICAgDQogICAgIyBkeW5hbWljOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2R5bmFtaWMgPSBOb25lOw0KICAgIGRlZiBkeW5hbWljKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2R5bmFtaWMgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fZHluYW1pYzsNCg0KDQogICAgDQogICAgDQogICAgZGVmIF9mcm9tRG9jdW1lbnQoc2VsZiwgb2JqKToNCiAgICAgICAgX190b1N0cmluZyA9ICdOb2RlX1R5cGU6Ol9mcm9tRG9jdW1lbnQoKTogJzsNCg0KICAgICAgICBpZiBvYmogaXMgTm9uZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICANCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIGJ5dGVzKToNCiAgICAgICAgICAgIG9iaiA9IHN0cihvYmosICJ1dGYtOCIpOw0KDQogICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLCBzdHIpIG9yIHR5cGUob2JqKSBpcyBzdHI6DQogICAgICAgICAgICBvYmogPSBqc29uLmxvYWRzKG9iaik7DQogICAgICAgIA0KICAgICAgICBpZiBub3QgaXNpbnN0YW5jZShvYmosIChzdHIsIGJ5dGVzLCBkaWN0KSk6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJ0dPVCBIRVJFOiAnICsgc3RyKHR5cGUob2JqKSkpOw0KICAgICAgICAgICAgcmV0dXJuIG9iajsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZm9yIGkgaW4gb2JqOg0KICAgICAgICAgICAgICAgIG9ialtpXSA9IE5vZGVfVHlwZSgpLl9mcm9tRG9jdW1lbnQob2JqW2ldKTsNCiAgICAgICAgICAgIHJldHVybiBvYmo7DQoNCg0KICAgICAgICBpZiAnSWQnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuSWQgPSBvYmpbJ0lkJ107DQoNCiAgICANCiAgICAgICAgaWYgJ2FjdGl2ZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5hY3RpdmUob2JqWydhY3RpdmUnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnZW5hYmxlZCcgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5lbmFibGVkKG9ialsnZW5hYmxlZCddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdjb2RlJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmNvZGUob2JqWydjb2RlJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ29yZGVyJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLm9yZGVyKG9ialsnb3JkZXInXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnZGF0ZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5kYXRlKG9ialsnZGF0ZSddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICduYW1lJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLm5hbWUob2JqWyduYW1lJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ3JlbWFyaycgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5yZW1hcmsob2JqWydyZW1hcmsnXSk7DQogICAgICAgIA0KICAgICAgICAgICAgc2VsZi5yZW1hcmsoIGJhc2U2NC5iNjRlbmNvZGUoc2VsZi5yZW1hcmsoKS5lbmNvZGUoImFzY2lpIikpLmRlY29kZSgiYXNjaWkiKSApOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ2R5bmFtaWMnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuZHluYW1pYyhvYmpbJ2R5bmFtaWMnXSk7DQogICAgICAgIA0KICAgIA0KDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgDQogICAgZGVmIF90b0RvY3VtZW50KHNlbGYpOg0KICAgICAgICByZXQgPSB7fTsNCiAgICAgICAgaWYgc2VsZi5JZCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiSWQiXSA9IHNlbGYuSWQ7DQoNCiAgICANCiAgICAgICAgaWYgc2VsZi5hY3RpdmUoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiYWN0aXZlIl0gPSBzZWxmLmFjdGl2ZSgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5lbmFibGVkKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbImVuYWJsZWQiXSA9IHNlbGYuZW5hYmxlZCgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5jb2RlKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbImNvZGUiXSA9IHNlbGYuY29kZSgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5vcmRlcigpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJvcmRlciJdID0gc2VsZi5vcmRlcigpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5kYXRlKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbImRhdGUiXSA9IHNlbGYuZGF0ZSgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5uYW1lKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbIm5hbWUiXSA9IHNlbGYubmFtZSgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi5yZW1hcmsoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSBzZWxmLnJlbWFyaygpOw0KICAgICAgICANCiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UocmV0WyJyZW1hcmsiXSwgZGljdCk6DQogICAgICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IGpzb24uZHVtcHMocmV0WyJyZW1hcmsiXSk7DQogICAgICAgICAgICByZXRbInJlbWFyayJdID0gdWJpbmFzY2lpLmIyYV9iYXNlNjQocmV0WyJyZW1hcmsiXSkuc3RyaXAoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYuZHluYW1pYygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJkeW5hbWljIl0gPSBzZWxmLmR5bmFtaWMoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIHJldHVybiByZXQ7DQoNCiAgICANCiAgICBkZWYgc3RvcmUoc2VsZiwgX19ldmVudD1Ob25lKToNCiAgICAgICAgX190b1N0cmluZyA9ICdOb2RlX1R5cGU6OnN0b3JlKCk6ICc7DQogICAgICAgIA0KICAgICAgICBldkpTT04gPSBOb25lOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBldkpTT04gPSBqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoNCiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7DQogICAgICAgIA0KDQogICAgICAgIGFuc3dlciA9IE5vbmU7DQoNCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpbWUudGltZSgpKSsnXS5Ob2RlX1R5cGUuc3RvcmUoKScpLm1ldGhvZCgnc3RvcmUnKS5jbGFzc05hbWUoJ05vZGVfVHlwZScpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7DQogICAgICAgIA0KICAgICAgICBnYy5jb2xsZWN0KCk7DQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOw0KICAgICAgICANCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsNCiAgICAgICAgDQogICAgICAgICAgICBhbnN3ZXIgPSBOb2RlX1R5cGUoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7DQogICAgICAgIA0KICAgICAgICANCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7DQoNCg0KDQogICAgICAgIGlmICdOb2RlX1R5cGVfc3RvcmUnIGluIGRpcigpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICc9PT4gTm9kZV9UeXBlX3N0b3JlKCknKTsNCiAgICAgICAgICAgIGFuc3dlciA9IE5vZGVfVHlwZV9zdG9yZShzZWxmLCBfX2V2ZW50LCBhbnN3ZXIsIF9fdG9TdHJpbmcpOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOg0KICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsNCg0KICAgICAgICAgICAgDQogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsNCiAgICAgICAgICAgIA0KDQogICAgICAgIHJldHVybiBhbnN3ZXI7DQoNCiAgICANCiAgICBkZWYgZmluZEFsbChzZWxmLCBfX2V2ZW50PU5vbmUpOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ05vZGVfVHlwZTo6ZmluZEFsbCgpOiAnOw0KICAgICAgICANCiAgICAgICAgZXZKU09OID0gTm9uZTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgZXZKU09OID0ganNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046DQogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOw0KICAgICAgICANCg0KICAgICAgICBhbnN3ZXIgPSBOb25lOw0KDQogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aW1lLnRpbWUoKSkrJ10uTm9kZV9UeXBlLmZpbmRBbGwoKScpLm1ldGhvZCgnZmluZEFsbCcpLmNsYXNzTmFtZSgnTm9kZV9UeXBlJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOw0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsNCiAgICAgICAgDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQogICAgICAgIA0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgIGFuc3dlciA9IE5vZGVfVHlwZSgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQogICAgICAgIA0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCg0KDQoNCiAgICAgICAgaWYgJ05vZGVfVHlwZV9maW5kQWxsJyBpbiBkaXIoKToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnPT0+IE5vZGVfVHlwZV9maW5kQWxsKCknKTsNCiAgICAgICAgICAgIGFuc3dlciA9IE5vZGVfVHlwZV9maW5kQWxsKHNlbGYsIF9fZXZlbnQsIGFuc3dlciwgX190b1N0cmluZyk7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KDQogICAgICAgICAgICANCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQoNCiAgICAgICAgcmV0dXJuIGFuc3dlcjsNCg0KICAgIA0KICAgIGRlZiBmaW5kKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6DQogICAgICAgIF9fdG9TdHJpbmcgPSAnTm9kZV9UeXBlOjpmaW5kKCk6ICc7DQogICAgICAgIA0KICAgICAgICBldkpTT04gPSBOb25lOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBldkpTT04gPSBqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoNCiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7DQogICAgICAgIA0KDQogICAgICAgIGFuc3dlciA9IE5vbmU7DQoNCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpbWUudGltZSgpKSsnXS5Ob2RlX1R5cGUuZmluZCgpJykubWV0aG9kKCdmaW5kJykuY2xhc3NOYW1lKCdOb2RlX1R5cGUnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOw0KICAgICAgICANCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCiAgICAgICAgDQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgYW5zd2VyID0gTm9kZV9UeXBlKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOw0KICAgICAgICANCiAgICAgICAgDQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KDQoNCg0KICAgICAgICBpZiAnTm9kZV9UeXBlX2ZpbmQnIGluIGRpcigpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICc9PT4gTm9kZV9UeXBlX2ZpbmQoKScpOw0KICAgICAgICAgICAgYW5zd2VyID0gTm9kZV9UeXBlX2ZpbmQoc2VsZiwgX19ldmVudCwgYW5zd2VyLCBfX3RvU3RyaW5nKTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCg0KICAgICAgICByZXR1cm4gYW5zd2VyOw0KDQogICAgDQogICAgZGVmIGRlcGxveShzZWxmLCBfX2V2ZW50PU5vbmUpOg0KICAgICAgICBfX3RvU3RyaW5nID0gJ05vZGVfVHlwZTo6ZGVwbG95KCk6ICc7DQogICAgICAgIA0KICAgICAgICBldkpTT04gPSBOb25lOw0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBldkpTT04gPSBqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsNCiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoNCiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7DQogICAgICAgIA0KDQogICAgICAgIGFuc3dlciA9IE5vbmU7DQoNCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpbWUudGltZSgpKSsnXS5Ob2RlX1R5cGUuZGVwbG95KCknKS5tZXRob2QoJ2RlcGxveScpLmNsYXNzTmFtZSgnTm9kZV9UeXBlJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOw0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsNCiAgICAgICAgDQogICAgICAgIGdjLmNvbGxlY3QoKTsNCiAgICAgICAgDQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7DQogICAgICAgIA0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOw0KICAgICAgICANCiAgICAgICAgICAgIGFuc3dlciA9IGV2SlNPTjsNCiAgICAgICAgDQogICAgICAgIAoJCQkKICAgICAgICAgICAgDQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOw0KDQoNCg0KICAgICAgICBpZiAnTm9kZV9UeXBlX2RlcGxveScgaW4gZGlyKCk6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJz09PiBOb2RlX1R5cGVfZGVwbG95KCknKTsNCiAgICAgICAgICAgIGFuc3dlciA9IE5vZGVfVHlwZV9kZXBsb3koc2VsZiwgX19ldmVudCwgYW5zd2VyLCBfX3RvU3RyaW5nKTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChzdHIoYW5zd2VyKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7DQogICAgICAgICAgICANCg0KICAgICAgICByZXR1cm4gYW5zd2VyOw0KDQogICAgDQoNCg0KY2xhc3MgTWFwcGluZygpOg0KICAgIGRlZiBfX2luaXRfXyhzZWxmLCBJZD1Ob25lLCBhY3RpdmU9Tm9uZSwgZW5hYmxlZD1Ob25lLCBvcmRlcj1Ob25lLCBjbGFzc05hbWU9Tm9uZSwgc2NvcGU9Tm9uZSwgY29udGV4dD1Ob25lLCBzb3VyY2U9Tm9uZSwgdGFyZ2V0PU5vbmUsIG9wZXJhdG9yPU5vbmUsIGluU2NyaXB0PU5vbmUsIG91dFNjcmlwdD1Ob25lLCB0b29sPU5vbmUsIGdyb3VwPU5vbmUsIHR5cGU9Tm9uZSk6DQogICAgICAgIHN1cGVyKCkuX19pbml0X18oKTsNCg0KICAgICAgICAjcHJpbnQoJ01hcHBpbmc6Ol9faW5pdF9fKCknKTsNCiAgICAgICAgaWYgSWQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBzZWxmLklkID0gSWQ7DQoNCiAgICAgICAgDQogICAgICAgIHNlbGYuYWN0aXZlKGFjdGl2ZSk7DQogICAgICAgIHNlbGYuZW5hYmxlZChlbmFibGVkKTsNCiAgICAgICAgc2VsZi5vcmRlcihvcmRlcik7DQogICAgICAgIHNlbGYuY2xhc3NOYW1lKGNsYXNzTmFtZSk7DQogICAgICAgIHNlbGYuc2NvcGUoc2NvcGUpOw0KICAgICAgICBzZWxmLmNvbnRleHQoY29udGV4dCk7DQogICAgICAgIHNlbGYuc291cmNlKHNvdXJjZSk7DQogICAgICAgIHNlbGYudGFyZ2V0KHRhcmdldCk7DQogICAgICAgIHNlbGYub3BlcmF0b3Iob3BlcmF0b3IpOw0KICAgICAgICBzZWxmLmluU2NyaXB0KGluU2NyaXB0KTsNCiAgICAgICAgc2VsZi5vdXRTY3JpcHQob3V0U2NyaXB0KTsNCiAgICAgICAgc2VsZi50b29sKHRvb2wpOw0KICAgICAgICBzZWxmLmdyb3VwKGdyb3VwKTsNCiAgICAgICAgc2VsZi50eXBlKHR5cGUpOw0KICAgICAgICANCiAgICBJZCA9IE5vbmU7DQogICAgDQogICAgDQogICAgIyBhY3RpdmU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfYWN0aXZlID0gTm9uZTsNCiAgICBkZWYgYWN0aXZlKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2FjdGl2ZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9hY3RpdmU7DQoNCg0KICAgIA0KICAgICMgZW5hYmxlZDogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF9lbmFibGVkID0gTm9uZTsNCiAgICBkZWYgZW5hYmxlZChzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9lbmFibGVkID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2VuYWJsZWQ7DQoNCg0KICAgIA0KICAgICMgb3JkZXI6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfb3JkZXIgPSBOb25lOw0KICAgIGRlZiBvcmRlcihzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9vcmRlciA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9vcmRlcjsNCg0KDQogICAgDQogICAgIyBjbGFzc05hbWU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfY2xhc3NOYW1lID0gTm9uZTsNCiAgICBkZWYgY2xhc3NOYW1lKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2NsYXNzTmFtZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9jbGFzc05hbWU7DQoNCg0KICAgIA0KICAgICMgc2NvcGU6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfc2NvcGUgPSBOb25lOw0KICAgIGRlZiBzY29wZShzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9zY29wZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9zY29wZTsNCg0KDQogICAgDQogICAgIyBjb250ZXh0OiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX2NvbnRleHQgPSBOb25lOw0KICAgIGRlZiBjb250ZXh0KHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX2NvbnRleHQgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fY29udGV4dDsNCg0KDQogICAgDQogICAgIyBzb3VyY2U6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfc291cmNlID0gTm9uZTsNCiAgICBkZWYgc291cmNlKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX3NvdXJjZSA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9zb3VyY2U7DQoNCg0KICAgIA0KICAgICMgdGFyZ2V0OiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX3RhcmdldCA9IE5vbmU7DQogICAgZGVmIHRhcmdldChzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl90YXJnZXQgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fdGFyZ2V0Ow0KDQoNCiAgICANCiAgICAjIG9wZXJhdG9yOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX29wZXJhdG9yID0gTm9uZTsNCiAgICBkZWYgb3BlcmF0b3Ioc2VsZiwgKmFyZ3MpOg0KICAgICAgICBpZiBhcmdzOg0KICAgICAgICAgICAgc2VsZi5fb3BlcmF0b3IgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fb3BlcmF0b3I7DQoNCg0KICAgIA0KICAgICMgaW5TY3JpcHQ6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfaW5TY3JpcHQgPSBOb25lOw0KICAgIGRlZiBpblNjcmlwdChzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9pblNjcmlwdCA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9pblNjcmlwdDsNCg0KDQogICAgDQogICAgIyBvdXRTY3JpcHQ6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfb3V0U2NyaXB0ID0gTm9uZTsNCiAgICBkZWYgb3V0U2NyaXB0KHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX291dFNjcmlwdCA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9vdXRTY3JpcHQ7DQoNCg0KICAgIA0KICAgICMgdG9vbDogR2V0dGVycyBhbmQgU2V0dGVycw0KICAgIF90b29sID0gTm9uZTsNCiAgICBkZWYgdG9vbChzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl90b29sID0gYXJnc1swXTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmOw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3Rvb2w7DQoNCg0KICAgIA0KICAgICMgZ3JvdXA6IEdldHRlcnMgYW5kIFNldHRlcnMNCiAgICBfZ3JvdXAgPSBOb25lOw0KICAgIGRlZiBncm91cChzZWxmLCAqYXJncyk6DQogICAgICAgIGlmIGFyZ3M6DQogICAgICAgICAgICBzZWxmLl9ncm91cCA9IGFyZ3NbMF07DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9ncm91cDsNCg0KDQogICAgDQogICAgIyB0eXBlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzDQogICAgX3R5cGUgPSBOb25lOw0KICAgIGRlZiB0eXBlKHNlbGYsICphcmdzKToNCiAgICAgICAgaWYgYXJnczoNCiAgICAgICAgICAgIHNlbGYuX3R5cGUgPSBhcmdzWzBdOw0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fdHlwZTsNCg0KDQogICAgDQogICAgDQogICAgZGVmIF9mcm9tRG9jdW1lbnQoc2VsZiwgb2JqKToNCiAgICAgICAgX190b1N0cmluZyA9ICdNYXBwaW5nOjpfZnJvbURvY3VtZW50KCk6ICc7DQoNCiAgICAgICAgaWYgb2JqIGlzIE5vbmU6DQogICAgICAgICAgICByZXR1cm4gc2VsZjsNCiAgICAgICAgDQogICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLCBieXRlcyk6DQogICAgICAgICAgICBvYmogPSBzdHIob2JqLCAidXRmLTgiKTsNCg0KICAgICAgICBpZiBpc2luc3RhbmNlKG9iaiwgc3RyKSBvciB0eXBlKG9iaikgaXMgc3RyOg0KICAgICAgICAgICAgb2JqID0ganNvbi5sb2FkcyhvYmopOw0KICAgICAgICANCiAgICAgICAgaWYgbm90IGlzaW5zdGFuY2Uob2JqLCAoc3RyLCBieXRlcywgZGljdCkpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICdHT1QgSEVSRTogJyArIHN0cih0eXBlKG9iaikpKTsNCiAgICAgICAgICAgIHJldHVybiBvYmo7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGZvciBpIGluIG9iajoNCiAgICAgICAgICAgICAgICBvYmpbaV0gPSBNYXBwaW5nKCkuX2Zyb21Eb2N1bWVudChvYmpbaV0pOw0KICAgICAgICAgICAgcmV0dXJuIG9iajsNCg0KDQogICAgICAgIGlmICdJZCcgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5JZCA9IG9ialsnSWQnXTsNCg0KICAgIA0KICAgICAgICBpZiAnYWN0aXZlJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmFjdGl2ZShvYmpbJ2FjdGl2ZSddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdlbmFibGVkJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmVuYWJsZWQob2JqWydlbmFibGVkJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ29yZGVyJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLm9yZGVyKG9ialsnb3JkZXInXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnY2xhc3NOYW1lJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmNsYXNzTmFtZShvYmpbJ2NsYXNzTmFtZSddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICdzY29wZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5zY29wZShvYmpbJ3Njb3BlJ10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ2NvbnRleHQnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuY29udGV4dChvYmpbJ2NvbnRleHQnXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnc291cmNlJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLnNvdXJjZShvYmpbJ3NvdXJjZSddKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmICd0YXJnZXQnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYudGFyZ2V0KG9ialsndGFyZ2V0J10pOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ29wZXJhdG9yJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLm9wZXJhdG9yKG9ialsnb3BlcmF0b3InXSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAnaW5TY3JpcHQnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYuaW5TY3JpcHQob2JqWydpblNjcmlwdCddKTsNCiAgICAgICAgDQogICAgICAgICAgICBzZWxmLmluU2NyaXB0KCBiYXNlNjQuYjY0ZW5jb2RlKHNlbGYuaW5TY3JpcHQoKS5lbmNvZGUoImFzY2lpIikpLmRlY29kZSgiYXNjaWkiKSApOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ291dFNjcmlwdCcgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi5vdXRTY3JpcHQob2JqWydvdXRTY3JpcHQnXSk7DQogICAgICAgIA0KICAgICAgICAgICAgc2VsZi5vdXRTY3JpcHQoIGJhc2U2NC5iNjRlbmNvZGUoc2VsZi5vdXRTY3JpcHQoKS5lbmNvZGUoImFzY2lpIikpLmRlY29kZSgiYXNjaWkiKSApOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ3Rvb2wnIGluIG9iajoNCiAgICAgICAgICAgIHNlbGYudG9vbChUb29sKCkuX2Zyb21Eb2N1bWVudChvYmpbJ3Rvb2wnXSkpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgJ2dyb3VwJyBpbiBvYmo6DQogICAgICAgICAgICBzZWxmLmdyb3VwKENvbmZpZ19Hcm91cCgpLl9mcm9tRG9jdW1lbnQob2JqWydncm91cCddKSk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiAndHlwZScgaW4gb2JqOg0KICAgICAgICAgICAgc2VsZi50eXBlKFRvb2xfVHlwZSgpLl9mcm9tRG9jdW1lbnQob2JqWyd0eXBlJ10pKTsNCiAgICAgICAgDQogICAgDQoNCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICByZXR1cm4gc2VsZjsNCiAgICANCiAgICBkZWYgX3RvRG9jdW1lbnQoc2VsZik6DQogICAgICAgIHJldCA9IHt9Ow0KICAgICAgICBpZiBzZWxmLklkIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJJZCJdID0gc2VsZi5JZDsNCg0KICAgIA0KICAgICAgICBpZiBzZWxmLmFjdGl2ZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJhY3RpdmUiXSA9IHNlbGYuYWN0aXZlKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmVuYWJsZWQoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiZW5hYmxlZCJdID0gc2VsZi5lbmFibGVkKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLm9yZGVyKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbIm9yZGVyIl0gPSBzZWxmLm9yZGVyKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmNsYXNzTmFtZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJjbGFzc05hbWUiXSA9IHNlbGYuY2xhc3NOYW1lKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLnNjb3BlKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbInNjb3BlIl0gPSBzZWxmLnNjb3BlKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmNvbnRleHQoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiY29udGV4dCJdID0gc2VsZi5jb250ZXh0KCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLnNvdXJjZSgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJzb3VyY2UiXSA9IHNlbGYuc291cmNlKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLnRhcmdldCgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgcmV0WyJ0YXJnZXQiXSA9IHNlbGYudGFyZ2V0KCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLm9wZXJhdG9yKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbIm9wZXJhdG9yIl0gPSBzZWxmLm9wZXJhdG9yKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLmluU2NyaXB0KCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbImluU2NyaXB0Il0gPSBzZWxmLmluU2NyaXB0KCk7DQogICAgICAgIA0KICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShyZXRbImluU2NyaXB0Il0sIGRpY3QpOg0KICAgICAgICAgICAgICAgIHJldFsiaW5TY3JpcHQiXSA9IGpzb24uZHVtcHMocmV0WyJpblNjcmlwdCJdKTsNCiAgICAgICAgICAgIHJldFsiaW5TY3JpcHQiXSA9IHViaW5hc2NpaS5iMmFfYmFzZTY0KHJldFsiaW5TY3JpcHQiXSkuc3RyaXAoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYub3V0U2NyaXB0KCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbIm91dFNjcmlwdCJdID0gc2VsZi5vdXRTY3JpcHQoKTsNCiAgICAgICAgDQogICAgICAgICAgICBpZiBpc2luc3RhbmNlKHJldFsib3V0U2NyaXB0Il0sIGRpY3QpOg0KICAgICAgICAgICAgICAgIHJldFsib3V0U2NyaXB0Il0gPSBqc29uLmR1bXBzKHJldFsib3V0U2NyaXB0Il0pOw0KICAgICAgICAgICAgcmV0WyJvdXRTY3JpcHQiXSA9IHViaW5hc2NpaS5iMmFfYmFzZTY0KHJldFsib3V0U2NyaXB0Il0pLnN0cmlwKCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICBpZiBzZWxmLnRvb2woKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsidG9vbCJdID0gc2VsZi50b29sKCkuX3RvRG9jdW1lbnQoKTsNCiAgICAgICAgDQogICAgDQogICAgICAgIGlmIHNlbGYuZ3JvdXAoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHJldFsiZ3JvdXAiXSA9IHNlbGYuZ3JvdXAoKS5fdG9Eb2N1bWVudCgpOw0KICAgICAgICANCiAgICANCiAgICAgICAgaWYgc2VsZi50eXBlKCkgaXMgbm90IE5vbmU6DQogICAgICAgICAgICByZXRbInR5cGUiXSA9IHNlbGYudHlwZSgpLl90b0RvY3VtZW50KCk7DQogICAgICAgIA0KICAgIA0KICAgICAgICANCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICByZXR1cm4gcmV0Ow0KDQogICAgDQogICAgZGVmIHN0b3JlKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6DQogICAgICAgIF9fdG9TdHJpbmcgPSAnTWFwcGluZzo6c3RvcmUoKTogJzsNCiAgICAgICAgDQogICAgICAgIGV2SlNPTiA9IE5vbmU7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIGV2SlNPTiA9IGpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOw0KICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOg0KICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsNCiAgICAgICAgDQoNCiAgICAgICAgYW5zd2VyID0gTm9uZTsNCg0KICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGltZS50aW1lKCkpKyddLk1hcHBpbmcuc3RvcmUoKScpLm1ldGhvZCgnc3RvcmUnKS5jbGFzc05hbWUoJ01hcHBpbmcnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOw0KICAgICAgICANCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCiAgICAgICAgDQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgYW5zd2VyID0gTWFwcGluZygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQogICAgICAgIA0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCg0KDQoNCiAgICAgICAgaWYgJ01hcHBpbmdfc3RvcmUnIGluIGRpcigpOg0KICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICc9PT4gTWFwcGluZ19zdG9yZSgpJyk7DQogICAgICAgICAgICBhbnN3ZXIgPSBNYXBwaW5nX3N0b3JlKHNlbGYsIF9fZXZlbnQsIGFuc3dlciwgX190b1N0cmluZyk7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KDQogICAgICAgICAgICANCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQoNCiAgICAgICAgcmV0dXJuIGFuc3dlcjsNCg0KICAgIA0KICAgIGRlZiBmaW5kQWxsKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6DQogICAgICAgIF9fdG9TdHJpbmcgPSAnTWFwcGluZzo6ZmluZEFsbCgpOiAnOw0KICAgICAgICANCiAgICAgICAgZXZKU09OID0gTm9uZTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgZXZKU09OID0ganNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046DQogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOw0KICAgICAgICANCg0KICAgICAgICBhbnN3ZXIgPSBOb25lOw0KDQogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aW1lLnRpbWUoKSkrJ10uTWFwcGluZy5maW5kQWxsKCknKS5tZXRob2QoJ2ZpbmRBbGwnKS5jbGFzc05hbWUoJ01hcHBpbmcnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOw0KICAgICAgICANCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCiAgICAgICAgDQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgYW5zd2VyID0gTWFwcGluZygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQogICAgICAgIA0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCg0KDQoNCiAgICAgICAgaWYgJ01hcHBpbmdfZmluZEFsbCcgaW4gZGlyKCk6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJz09PiBNYXBwaW5nX2ZpbmRBbGwoKScpOw0KICAgICAgICAgICAgYW5zd2VyID0gTWFwcGluZ19maW5kQWxsKHNlbGYsIF9fZXZlbnQsIGFuc3dlciwgX190b1N0cmluZyk7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KDQogICAgICAgICAgICANCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQoNCiAgICAgICAgcmV0dXJuIGFuc3dlcjsNCg0KICAgIA0KICAgIGRlZiBmaW5kKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6DQogICAgICAgIF9fdG9TdHJpbmcgPSAnTWFwcGluZzo6ZmluZCgpOiAnOw0KICAgICAgICANCiAgICAgICAgZXZKU09OID0gTm9uZTsNCg0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgZXZKU09OID0ganNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7DQogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046DQogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOw0KICAgICAgICANCg0KICAgICAgICBhbnN3ZXIgPSBOb25lOw0KDQogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aW1lLnRpbWUoKSkrJ10uTWFwcGluZy5maW5kKCknKS5tZXRob2QoJ2ZpbmQnKS5jbGFzc05hbWUoJ01hcHBpbmcnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7DQogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6DQogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOw0KICAgICAgICANCiAgICAgICAgZ2MuY29sbGVjdCgpOw0KICAgICAgICANCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsNCiAgICAgICAgDQogICAgICAgIA0KICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7DQogICAgICAgIA0KICAgICAgICAgICAgYW5zd2VyID0gTWFwcGluZygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsNCiAgICAgICAgDQogICAgICAgIA0KDQogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToNCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsNCg0KDQoNCiAgICAgICAgaWYgJ01hcHBpbmdfZmluZCcgaW4gZGlyKCk6DQogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJz09PiBNYXBwaW5nX2ZpbmQoKScpOw0KICAgICAgICAgICAgYW5zd2VyID0gTWFwcGluZ19maW5kKHNlbGYsIF9fZXZlbnQsIGFuc3dlciwgX190b1N0cmluZyk7DQoNCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6DQogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOw0KDQogICAgICAgICAgICANCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOw0KICAgICAgICAgICAgDQoNCiAgICAgICAgcmV0dXJuIGFuc3dlcjsNCg0KICAgIA0KDQoNCg0KDQoNCiAgICANCm5jb2RlID0gImFwaXNlcnZlci9lc3B0ZXN0L3B5Y2xpZW50IjsNCiAgICANCg0Kbm9kZSA9IE5vZGUoY29kZT1uY29kZSwgcGFyZW50PU5vZGUoY29kZT0nYXBpc2VydmVyL2VzcHRlc3QvbWFzdGVyJykpOw0KDQoNCiMjIyMjIyMjIyMjIE1RVFQgQ29ubmVjdGlvbiAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIw0KcHJpbnQoJ21haW4oKScsICJDb25uZWN0aW5nIHRvIE1RVFQgc2VydmVyIiwgIi4uLiAiLCBlbmQ9IiIpOw0KbXF0dF90b3BpYyA9ICdhcGlzZXJ2ZXIvZXNwdGVzdCc7DQoNCm1xdHRfY2xpZW50ID0gcGFoby5tcXR0LmNsaWVudC5DbGllbnQoY2FsbGJhY2tfYXBpX3ZlcnNpb249cGFoby5tcXR0LmNsaWVudC5DYWxsYmFja0FQSVZlcnNpb24uVkVSU0lPTjIsIGNsaWVudF9pZD1tcXR0X3RvcGljKycvJytub2RlLmNvZGUoKSwgdHJhbnNwb3J0PSd0Y3AnKTsNCg0KbXF0dF9jbGllbnQub25fbWVzc2FnZSA9IGxhbWJkYSBjbGllbnQsIHVzZXJkYXRhLCBvTXNnIDogRXZlbnQoKS5fZnJvbURvY3VtZW50KG9Nc2cucGF5bG9hZCkucHJvY2VzcygpOw0KbXF0dF9jbGllbnQuY29ubmVjdCgndGVzdC5tb3NxdWl0dG8ub3JnJyk7DQoNCg0KbXF0dF9jbGllbnQuc3Vic2NyaWJlKG1xdHRfdG9waWMpOw0KcHJpbnQoIkNvbm5lY3RlZCEiKTsNCiMjIyMjIyMjIyMjIE1RVFQgQ29ubmVjdGlvbiAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIw0KDQoNCg0KIyMjIyMjIyMjIyMgTWV0aG9kIFRyaWdnZXJzICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjDQoNCiMjIyMjIyMjIyMjIE1ldGhvZCBUcmlnZ2VycyAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIw0KDQpub2RlLnN0b3JlKCk7DQoNCnByaW50KCdtYWluKCknLCAnbG9vcGluZyBmb3IgbXF0dCBldmVudHMnKTsNCg0KbXF0dF9jbGllbnQubG9vcF9mb3JldmVyKCk7DQoNCg0K",
	"__keys": ["name"],
	"__trMap": []
}