{
	"Id": "7085816e8ae657bcc32283c548ce433983273e5c",
	"active": "true",
	"enabled": "true",
	"code": "python",
	"date": "2024-10-06T17:55:34.936Z",
	"name": "Python",
	"remark": "IyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiMjIyMjIyMjIyMjIyMjIyMjIyMjICAgQVBJIFNlcnZlciBTdHViIGZvciAoTWljcm8pUHl0aG9uICAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwojIyMjIyMjIyMjIyMjIyMjIyMjIyBWRVJTSU9OOiAyMDI0LTEwLTA2VDE3OjU1OjMyLjk3OFogICMjIyMjIyMjIyMjIyMjIyMjIyMjCiMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwoKCiNpbXBvcnQgdXJsbGliMywganNvbiwgYmFzZTY0OwojZXhlYyhiYXNlNjQuYjY0ZGVjb2RlKGpzb24ubG9hZHModXJsbGliMy5Qb29sTWFuYWdlcigpLnJlcXVlc3QoJ0dFVCcsICJodHRwczovL2Fyemhvc3BpdGFsLmdpdGh1Yi5pby9lc3B0ZXN0L05vZGVfVHlwZS9QeXRob24uanNvbiIpLmRhdGEuZGVjb2RlKCd1dGYtOCcpKVsicmVtYXJrIl0pKTsKCiMgaW1wb3J0IHJlcXVlc3RzLCB1YmluYXNjaWksIHVqc29uOwojIGV4ZWModWJpbmFzY2lpLmEyYl9iYXNlNjQodWpzb24ubG9hZHMocmVxdWVzdHMuZ2V0KCJodHRwczovL2Fyemhvc3BpdGFsLmdpdGh1Yi5pby9lc3B0ZXN0L05vZGVfVHlwZS9QeXRob24uanNvbiIpLnRleHQpWyJyZW1hcmsiXSkpOwoKaW1wb3J0IHBhaG8ubXF0dC5jbGllbnQsanNvbix1cmxsaWIzLHRocmVhZGluZyx1dWlkLHBhdGhsaWIsdGltZSxnYyxpbyxkYXRldGltZSxyZSxvcyxzeXM7CgoKY2xhc3MgVXNlcigpOgogICAgZGVmIF9faW5pdF9fKHNlbGYsIElkPU5vbmUsIGFjdGl2ZT1Ob25lLCBlbmFibGVkPU5vbmUsIGNvZGU9Tm9uZSwgb3JkZXI9Tm9uZSwgZGF0ZT1Ob25lLCBuYW1lPU5vbmUsIHJlbWFyaz1Ob25lLCB1c2VybmFtZT1Ob25lLCBwYXNzd29yZD1Ob25lKToKICAgICAgICBzdXBlcigpLl9faW5pdF9fKCk7CgogICAgICAgICNwcmludCgnVXNlcjo6X19pbml0X18oKScpOwogICAgICAgIGlmIElkIGlzIG5vdCBOb25lOgogICAgICAgICAgICBzZWxmLklkID0gSWQ7CgogICAgICAgIAogICAgICAgIHNlbGYuYWN0aXZlKGFjdGl2ZSk7CiAgICAgICAgc2VsZi5lbmFibGVkKGVuYWJsZWQpOwogICAgICAgIHNlbGYuY29kZShjb2RlKTsKICAgICAgICBzZWxmLm9yZGVyKG9yZGVyKTsKICAgICAgICBzZWxmLmRhdGUoZGF0ZSk7CiAgICAgICAgc2VsZi5uYW1lKG5hbWUpOwogICAgICAgIHNlbGYucmVtYXJrKHJlbWFyayk7CiAgICAgICAgc2VsZi51c2VybmFtZSh1c2VybmFtZSk7CiAgICAgICAgc2VsZi5wYXNzd29yZChwYXNzd29yZCk7CiAgICAgICAgCiAgICBJZCA9IE5vbmU7CiAgICAKICAgIAogICAgIyBhY3RpdmU6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9hY3RpdmUgPSBOb25lOwogICAgZGVmIGFjdGl2ZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fYWN0aXZlID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2FjdGl2ZTsKICAgIAogICAgIyBlbmFibGVkOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfZW5hYmxlZCA9IE5vbmU7CiAgICBkZWYgZW5hYmxlZChzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fZW5hYmxlZCA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9lbmFibGVkOwogICAgCiAgICAjIGNvZGU6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9jb2RlID0gTm9uZTsKICAgIGRlZiBjb2RlKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9jb2RlID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2NvZGU7CiAgICAKICAgICMgb3JkZXI6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9vcmRlciA9IE5vbmU7CiAgICBkZWYgb3JkZXIoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX29yZGVyID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX29yZGVyOwogICAgCiAgICAjIGRhdGU6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9kYXRlID0gTm9uZTsKICAgIGRlZiBkYXRlKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9kYXRlID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2RhdGU7CiAgICAKICAgICMgbmFtZTogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX25hbWUgPSBOb25lOwogICAgZGVmIG5hbWUoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX25hbWUgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fbmFtZTsKICAgIAogICAgIyByZW1hcms6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9yZW1hcmsgPSBOb25lOwogICAgZGVmIHJlbWFyayhzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fcmVtYXJrID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3JlbWFyazsKICAgIAogICAgIyB1c2VybmFtZTogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX3VzZXJuYW1lID0gTm9uZTsKICAgIGRlZiB1c2VybmFtZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fdXNlcm5hbWUgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fdXNlcm5hbWU7CiAgICAKICAgICMgcGFzc3dvcmQ6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9wYXNzd29yZCA9IE5vbmU7CiAgICBkZWYgcGFzc3dvcmQoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX3Bhc3N3b3JkID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3Bhc3N3b3JkOwogICAgCiAgICAKICAgIAogICAgCiAgICBkZWYgX2Zyb21Eb2N1bWVudChzZWxmLCBvYmopOgogICAgICAgIF9fdG9TdHJpbmcgPSAnVXNlcjo6X2Zyb21Eb2N1bWVudCgpOiAnOwogICAgICAgIAogICAgICAgIGlmIG9iaiBpcyBOb25lOgogICAgICAgICAgICByZXR1cm4gc2VsZjsKCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIGJ5dGVzKToKICAgICAgICAgICAgb2JqID0gc3RyKG9iaiwgInV0Zi04Iik7CgogICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLCBzdHIpIG9yIHR5cGUob2JqKSBpcyBzdHI6CiAgICAgICAgICAgIGlmIHJlLm1hdGNoKHIiKCgoW0EtWmEtel17Myw5fTooPzpcL1wvKT8pKD86Wy07OiY9XCtcJCxcd10rQCk/W0EtWmEtejAtOS4tXSt8KD86d3d3LnxbLTs6Jj1cK1wkLFx3XStAKVtBLVphLXowLTkuLV0rKSgoPzpcL1tcK34lXC8uXHdcLV9dKik/XD8/KD86Wy1cKz0mOyVALlx3X10qKSM/KD86W1x3XSopKT8pIiwgb2JqKToKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBvYmogPSBqc29uLmxvYWRzKHVybGxpYjMuUG9vbE1hbmFnZXIoKS5yZXF1ZXN0KCdHRVQnLCBvYmopLmRhdGEuZGVjb2RlKCd1dGYtOCcpKTsKICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICBvYmogPSB7fTsKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIG9iaiA9IGpzb24ubG9hZHMob2JqKTsKICAgICAgICAKICAgICAgICBpZiBpc2luc3RhbmNlKG9iaiwgbGlzdCk6CiAgICAgICAgICAgIHJldHVybiBbVXNlcigpLl9mcm9tRG9jdW1lbnQobykgZm9yIG8gaW4gb2JqXTsKICAgICAgICAgICAgCiAgICAgICAgaWYgbm90IGlzaW5zdGFuY2Uob2JqLCAoc3RyLCBieXRlcywgZGljdCkpOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJ3VuaGFuZGxlZCB0eXBlOiAnICsgc3RyKHR5cGUob2JqKSkpOwogICAgICAgICAgICByZXR1cm4gb2JqOwoKICAgICAgICBpZiAnSWQnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5JZCA9IG9ialsnSWQnXTsKCiAgICAKICAgICAgICBpZiAnYWN0aXZlJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuYWN0aXZlKG9ialsnYWN0aXZlJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ2VuYWJsZWQnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5lbmFibGVkKG9ialsnZW5hYmxlZCddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdjb2RlJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuY29kZShvYmpbJ2NvZGUnXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnb3JkZXInIGluIG9iajoKICAgICAgICAgICAgc2VsZi5vcmRlcihvYmpbJ29yZGVyJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ2RhdGUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5kYXRlKG9ialsnZGF0ZSddKTsKICAgICAgICAKICAgICAgICAgICAgc2VsZi5kYXRlKGRhdGV0aW1lLmRhdGV0aW1lLmZyb21pc29mb3JtYXQoc2VsZi5kYXRlKCkpKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICduYW1lJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYubmFtZShvYmpbJ25hbWUnXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAncmVtYXJrJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYucmVtYXJrKG9ialsncmVtYXJrJ10pOwogICAgICAgIAogICAgICAgICAgICBzZWxmLnJlbWFyayggYmFzZTY0LmI2NGRlY29kZShzZWxmLnJlbWFyaygpKSApOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ3VzZXJuYW1lJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYudXNlcm5hbWUob2JqWyd1c2VybmFtZSddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdwYXNzd29yZCcgaW4gb2JqOgogICAgICAgICAgICBzZWxmLnBhc3N3b3JkKG9ialsncGFzc3dvcmQnXSk7CiAgICAgICAgCiAgICAKCiAgICAKCiAgICAgICAgZ2MuY29sbGVjdCgpOwogICAgICAgIHJldHVybiBzZWxmOwogICAgCiAgICBkZWYgX3RvRG9jdW1lbnQoc2VsZiwgYkpTT049Tm9uZSk6CiAgICAgICAgX190b1N0cmluZyA9ICdVc2VyOjpfdG9Eb2N1bWVudCgpOiAnOwoKICAgICAgICByZXQgPSB7fTsKICAgICAgICBpZiBzZWxmLklkIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbIklkIl0gPSBzZWxmLklkOwoKICAgIAogICAgICAgIGlmIHNlbGYuYWN0aXZlKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiYWN0aXZlIl0gPSBzZWxmLmFjdGl2ZSgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5lbmFibGVkKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiZW5hYmxlZCJdID0gc2VsZi5lbmFibGVkKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLmNvZGUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJjb2RlIl0gPSBzZWxmLmNvZGUoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYub3JkZXIoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJvcmRlciJdID0gc2VsZi5vcmRlcigpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5kYXRlKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiZGF0ZSJdID0gc2VsZi5kYXRlKCk7CiAgICAgICAgCiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UocmV0WyJkYXRlIl0sIGRhdGV0aW1lLmRhdGV0aW1lKToKICAgICAgICAgICAgICAgIHJldFsiZGF0ZSJdID0gcmV0WyJkYXRlIl0uaXNvZm9ybWF0KCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLm5hbWUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJuYW1lIl0gPSBzZWxmLm5hbWUoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYucmVtYXJrKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSBzZWxmLnJlbWFyaygpOwogICAgICAgIAogICAgICAgICAgICBpZiBpc2luc3RhbmNlKHJldFsicmVtYXJrIl0sIGRpY3QpOgogICAgICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IGpzb24uZHVtcHMocmV0WyJyZW1hcmsiXSkuZW5jb2RlKCd1dGYtOCcpOwoKICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9ICBiYXNlNjQuYjY0ZW5jb2RlKHJldFsicmVtYXJrIl0pLmRlY29kZSgndXRmLTgnKS5zdHJpcCgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi51c2VybmFtZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbInVzZXJuYW1lIl0gPSBzZWxmLnVzZXJuYW1lKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLnBhc3N3b3JkKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsicGFzc3dvcmQiXSA9IHNlbGYucGFzc3dvcmQoKTsKICAgICAgICAKICAgIAogICAgICAgIAogICAgCgogICAgICAgIGlmIGJKU09OIGlzIG5vdCBOb25lOgogICAgICAgICAgICAjcHJpbnQoX190b1N0cmluZyArICJHT1QgSEVSRSIsIHR5cGUocmV0KSwgcmV0KTsKICAgICAgICAgICAgcmV0ID0ganNvbi5kdW1wcyhyZXQpOwogICAgICAgIGdjLmNvbGxlY3QoKTsKICAgICAgICByZXR1cm4gcmV0OwoKICAgIAogICAgZGVmIHN0b3JlKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6CiAgICAgICAgX190b1N0cmluZyA9ICdVc2VyOjpzdG9yZSgpOiAnOwogICAgICAgIAogICAgICAgIGV2SlNPTiA9IE5vbmU7CgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIGV2SlNPTiA9IGpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOwogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046CiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7CiAgICAgICAgCgogICAgICAgIGFuc3dlciA9IE5vbmU7CgogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aW1lKCkpKyddLlVzZXIuc3RvcmUoKScpLm1ldGhvZCgnc3RvcmUnKS5jbGFzc05hbWUoJ1VzZXInKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7CiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsKICAgICAgICAKICAgICAgICBnYy5jb2xsZWN0KCk7CgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsKCiAgICAgICAgCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7CiAgICAgICAgCiAgICAgICAgICAgIGFuc3dlciA9IFVzZXIoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7CiAgICAgICAgCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsKCgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsKCiAgICAgICAgICAgIAogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsKICAgICAgICAgICAgCgogICAgICAgIHJldHVybiBhbnN3ZXI7CgogICAgCiAgICBkZWYgZmluZEFsbChzZWxmLCBfX2V2ZW50PU5vbmUpOgogICAgICAgIF9fdG9TdHJpbmcgPSAnVXNlcjo6ZmluZEFsbCgpOiAnOwogICAgICAgIAogICAgICAgIGV2SlNPTiA9IE5vbmU7CgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIGV2SlNPTiA9IGpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOwogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046CiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7CiAgICAgICAgCgogICAgICAgIGFuc3dlciA9IE5vbmU7CgogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aW1lKCkpKyddLlVzZXIuZmluZEFsbCgpJykubWV0aG9kKCdmaW5kQWxsJykuY2xhc3NOYW1lKCdVc2VyJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOwogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7CiAgICAgICAgCiAgICAgICAgZ2MuY29sbGVjdCgpOwoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7CgogICAgICAgIAogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOwogICAgICAgIAogICAgICAgICAgICBhbnN3ZXIgPSBVc2VyKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOwogICAgICAgIAoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7CgoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOgogICAgICAgICAgICAKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7CgogICAgICAgICAgICAKICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7CiAgICAgICAgICAgIAoKICAgICAgICByZXR1cm4gYW5zd2VyOwoKICAgIAogICAgZGVmIGZpbmQoc2VsZiwgX19ldmVudD1Ob25lKToKICAgICAgICBfX3RvU3RyaW5nID0gJ1VzZXI6OmZpbmQoKTogJzsKICAgICAgICAKICAgICAgICBldkpTT04gPSBOb25lOwoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBldkpTT04gPSBqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsKICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOgogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOwogICAgICAgIAoKICAgICAgICBhbnN3ZXIgPSBOb25lOwoKICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGltZSgpKSsnXS5Vc2VyLmZpbmQoKScpLm1ldGhvZCgnZmluZCcpLmNsYXNzTmFtZSgnVXNlcicpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOwogICAgICAgIAogICAgICAgIGdjLmNvbGxlY3QoKTsKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOwoKICAgICAgICAKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsKICAgICAgICAKICAgICAgICAgICAgYW5zd2VyID0gVXNlcigpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsKICAgICAgICAKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOwoKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOwogICAgICAgICAgICAKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOwoKICAgICAgICAgICAgCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOwogICAgICAgICAgICAKCiAgICAgICAgcmV0dXJuIGFuc3dlcjsKCiAgICAKICAgIGRlZiBpbml0KHNlbGYsIF9fZXZlbnQ9Tm9uZSk6CiAgICAgICAgX190b1N0cmluZyA9ICdVc2VyOjppbml0KCk6ICc7CiAgICAgICAgCiAgICAgICAgZXZKU09OID0gTm9uZTsKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgZXZKU09OID0ganNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7CiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoKICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsKICAgICAgICAKCiAgICAgICAgYW5zd2VyID0gTm9uZTsKCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpbWUoKSkrJ10uVXNlci5pbml0KCknKS5tZXRob2QoJ2luaXQnKS5jbGFzc05hbWUoJ1VzZXInKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7CiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsKICAgICAgICAKICAgICAgICBnYy5jb2xsZWN0KCk7CgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsKCiAgICAgICAgCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7CiAgICAgICAgCiAgICAgICAgICAgIGFuc3dlciA9IGV2SlNPTjsKICAgICAgICAKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOwoKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoc3RyKGFuc3dlcikpOwogICAgICAgICAgICAKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOwoKICAgICAgICAgICAgCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOwogICAgICAgICAgICAKCiAgICAgICAgcmV0dXJuIGFuc3dlcjsKCiAgICAKCgpjbGFzcyBNZXRyaWMoKToKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBJZD1Ob25lLCBhY3RpdmU9Tm9uZSwgZW5hYmxlZD1Ob25lLCBjb2RlPU5vbmUsIG9yZGVyPU5vbmUsIGRhdGU9Tm9uZSwgbmFtZT1Ob25lLCByZW1hcms9Tm9uZSwgc2NyaXB0PU5vbmUsIHR5cGU9Tm9uZSwgZGV2aWNlVHlwZT1Ob25lKToKICAgICAgICBzdXBlcigpLl9faW5pdF9fKCk7CgogICAgICAgICNwcmludCgnTWV0cmljOjpfX2luaXRfXygpJyk7CiAgICAgICAgaWYgSWQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHNlbGYuSWQgPSBJZDsKCiAgICAgICAgCiAgICAgICAgc2VsZi5hY3RpdmUoYWN0aXZlKTsKICAgICAgICBzZWxmLmVuYWJsZWQoZW5hYmxlZCk7CiAgICAgICAgc2VsZi5jb2RlKGNvZGUpOwogICAgICAgIHNlbGYub3JkZXIob3JkZXIpOwogICAgICAgIHNlbGYuZGF0ZShkYXRlKTsKICAgICAgICBzZWxmLm5hbWUobmFtZSk7CiAgICAgICAgc2VsZi5yZW1hcmsocmVtYXJrKTsKICAgICAgICBzZWxmLnNjcmlwdChzY3JpcHQpOwogICAgICAgIHNlbGYudHlwZSh0eXBlKTsKICAgICAgICBzZWxmLmRldmljZVR5cGUoZGV2aWNlVHlwZSk7CiAgICAgICAgCiAgICBJZCA9IE5vbmU7CiAgICAKICAgIAogICAgIyBhY3RpdmU6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9hY3RpdmUgPSBOb25lOwogICAgZGVmIGFjdGl2ZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fYWN0aXZlID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2FjdGl2ZTsKICAgIAogICAgIyBlbmFibGVkOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfZW5hYmxlZCA9IE5vbmU7CiAgICBkZWYgZW5hYmxlZChzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fZW5hYmxlZCA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9lbmFibGVkOwogICAgCiAgICAjIGNvZGU6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9jb2RlID0gTm9uZTsKICAgIGRlZiBjb2RlKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9jb2RlID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2NvZGU7CiAgICAKICAgICMgb3JkZXI6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9vcmRlciA9IE5vbmU7CiAgICBkZWYgb3JkZXIoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX29yZGVyID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX29yZGVyOwogICAgCiAgICAjIGRhdGU6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9kYXRlID0gTm9uZTsKICAgIGRlZiBkYXRlKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9kYXRlID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2RhdGU7CiAgICAKICAgICMgbmFtZTogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX25hbWUgPSBOb25lOwogICAgZGVmIG5hbWUoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX25hbWUgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fbmFtZTsKICAgIAogICAgIyByZW1hcms6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9yZW1hcmsgPSBOb25lOwogICAgZGVmIHJlbWFyayhzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fcmVtYXJrID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3JlbWFyazsKICAgIAogICAgIyBzY3JpcHQ6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9zY3JpcHQgPSBOb25lOwogICAgZGVmIHNjcmlwdChzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fc2NyaXB0ID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3NjcmlwdDsKICAgIAogICAgIyB0eXBlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfdHlwZSA9IE5vbmU7CiAgICBkZWYgdHlwZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fdHlwZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl90eXBlOwogICAgCiAgICAjIGRldmljZVR5cGU6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9kZXZpY2VUeXBlID0gTm9uZTsKICAgIGRlZiBkZXZpY2VUeXBlKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9kZXZpY2VUeXBlID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2RldmljZVR5cGU7CiAgICAKICAgIAogICAgCiAgICAjIG1ldHJpY19NZXRyaWNfVmFsdWVzOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfbWV0cmljX01ldHJpY19WYWx1ZXMgPSBOb25lOwogICAgZGVmIG1ldHJpY19NZXRyaWNfVmFsdWVzKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9tZXRyaWNfTWV0cmljX1ZhbHVlcyA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9tZXRyaWNfTWV0cmljX1ZhbHVlczsKICAgIAogICAgCiAgICBkZWYgX2Zyb21Eb2N1bWVudChzZWxmLCBvYmopOgogICAgICAgIF9fdG9TdHJpbmcgPSAnTWV0cmljOjpfZnJvbURvY3VtZW50KCk6ICc7CiAgICAgICAgCiAgICAgICAgaWYgb2JqIGlzIE5vbmU6CiAgICAgICAgICAgIHJldHVybiBzZWxmOwoKICAgICAgICBpZiBpc2luc3RhbmNlKG9iaiwgYnl0ZXMpOgogICAgICAgICAgICBvYmogPSBzdHIob2JqLCAidXRmLTgiKTsKCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIHN0cikgb3IgdHlwZShvYmopIGlzIHN0cjoKICAgICAgICAgICAgaWYgcmUubWF0Y2gociIoKChbQS1aYS16XXszLDl9Oig/OlwvXC8pPykoPzpbLTs6Jj1cK1wkLFx3XStAKT9bQS1aYS16MC05Li1dK3woPzp3d3cufFstOzomPVwrXCQsXHddK0ApW0EtWmEtejAtOS4tXSspKCg/OlwvW1wrfiVcLy5cd1wtX10qKT9cPz8oPzpbLVwrPSY7JUAuXHdfXSopIz8oPzpbXHddKikpPykiLCBvYmopOgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIG9iaiA9IGpzb24ubG9hZHModXJsbGliMy5Qb29sTWFuYWdlcigpLnJlcXVlc3QoJ0dFVCcsIG9iaikuZGF0YS5kZWNvZGUoJ3V0Zi04JykpOwogICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgIG9iaiA9IHt9OwogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgb2JqID0ganNvbi5sb2FkcyhvYmopOwogICAgICAgIAogICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLCBsaXN0KToKICAgICAgICAgICAgcmV0dXJuIFtNZXRyaWMoKS5fZnJvbURvY3VtZW50KG8pIGZvciBvIGluIG9ial07CiAgICAgICAgICAgIAogICAgICAgIGlmIG5vdCBpc2luc3RhbmNlKG9iaiwgKHN0ciwgYnl0ZXMsIGRpY3QpKToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICd1bmhhbmRsZWQgdHlwZTogJyArIHN0cih0eXBlKG9iaikpKTsKICAgICAgICAgICAgcmV0dXJuIG9iajsKCiAgICAgICAgaWYgJ0lkJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuSWQgPSBvYmpbJ0lkJ107CgogICAgCiAgICAgICAgaWYgJ2FjdGl2ZScgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmFjdGl2ZShvYmpbJ2FjdGl2ZSddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdlbmFibGVkJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuZW5hYmxlZChvYmpbJ2VuYWJsZWQnXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnY29kZScgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmNvZGUob2JqWydjb2RlJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ29yZGVyJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYub3JkZXIob2JqWydvcmRlciddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdkYXRlJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuZGF0ZShvYmpbJ2RhdGUnXSk7CiAgICAgICAgCiAgICAgICAgICAgIHNlbGYuZGF0ZShkYXRldGltZS5kYXRldGltZS5mcm9taXNvZm9ybWF0KHNlbGYuZGF0ZSgpKSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnbmFtZScgaW4gb2JqOgogICAgICAgICAgICBzZWxmLm5hbWUob2JqWyduYW1lJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ3JlbWFyaycgaW4gb2JqOgogICAgICAgICAgICBzZWxmLnJlbWFyayhvYmpbJ3JlbWFyayddKTsKICAgICAgICAKICAgICAgICAgICAgc2VsZi5yZW1hcmsoIGJhc2U2NC5iNjRkZWNvZGUoc2VsZi5yZW1hcmsoKSkgKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdzY3JpcHQnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5zY3JpcHQob2JqWydzY3JpcHQnXSk7CiAgICAgICAgCiAgICAgICAgICAgIHNlbGYuc2NyaXB0KCBiYXNlNjQuYjY0ZGVjb2RlKHNlbGYuc2NyaXB0KCkpICk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAndHlwZScgaW4gb2JqOgogICAgICAgICAgICBzZWxmLnR5cGUoTWV0cmljX1R5cGUoKS5fZnJvbURvY3VtZW50KG9ialsndHlwZSddKSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnZGV2aWNlVHlwZScgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmRldmljZVR5cGUoRGV2aWNlX1R5cGUoKS5fZnJvbURvY3VtZW50KG9ialsnZGV2aWNlVHlwZSddKSk7CiAgICAgICAgCiAgICAKCiAgICAKICAgICAgICBpZiAnbWV0cmljX01ldHJpY19WYWx1ZXMnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5tZXRyaWNfTWV0cmljX1ZhbHVlcyhNZXRyaWNfVmFsdWUoKS5fZnJvbURvY3VtZW50KG9ialsnbWV0cmljX01ldHJpY19WYWx1ZXMnXSkpOwogICAgCgogICAgICAgIGdjLmNvbGxlY3QoKTsKICAgICAgICByZXR1cm4gc2VsZjsKICAgIAogICAgZGVmIF90b0RvY3VtZW50KHNlbGYsIGJKU09OPU5vbmUpOgogICAgICAgIF9fdG9TdHJpbmcgPSAnTWV0cmljOjpfdG9Eb2N1bWVudCgpOiAnOwoKICAgICAgICByZXQgPSB7fTsKICAgICAgICBpZiBzZWxmLklkIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbIklkIl0gPSBzZWxmLklkOwoKICAgIAogICAgICAgIGlmIHNlbGYuYWN0aXZlKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiYWN0aXZlIl0gPSBzZWxmLmFjdGl2ZSgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5lbmFibGVkKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiZW5hYmxlZCJdID0gc2VsZi5lbmFibGVkKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLmNvZGUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJjb2RlIl0gPSBzZWxmLmNvZGUoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYub3JkZXIoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJvcmRlciJdID0gc2VsZi5vcmRlcigpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5kYXRlKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiZGF0ZSJdID0gc2VsZi5kYXRlKCk7CiAgICAgICAgCiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UocmV0WyJkYXRlIl0sIGRhdGV0aW1lLmRhdGV0aW1lKToKICAgICAgICAgICAgICAgIHJldFsiZGF0ZSJdID0gcmV0WyJkYXRlIl0uaXNvZm9ybWF0KCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLm5hbWUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJuYW1lIl0gPSBzZWxmLm5hbWUoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYucmVtYXJrKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSBzZWxmLnJlbWFyaygpOwogICAgICAgIAogICAgICAgICAgICBpZiBpc2luc3RhbmNlKHJldFsicmVtYXJrIl0sIGRpY3QpOgogICAgICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IGpzb24uZHVtcHMocmV0WyJyZW1hcmsiXSkuZW5jb2RlKCd1dGYtOCcpOwoKICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9ICBiYXNlNjQuYjY0ZW5jb2RlKHJldFsicmVtYXJrIl0pLmRlY29kZSgndXRmLTgnKS5zdHJpcCgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5zY3JpcHQoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJzY3JpcHQiXSA9IHNlbGYuc2NyaXB0KCk7CiAgICAgICAgCiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UocmV0WyJzY3JpcHQiXSwgZGljdCk6CiAgICAgICAgICAgICAgICByZXRbInNjcmlwdCJdID0ganNvbi5kdW1wcyhyZXRbInNjcmlwdCJdKS5lbmNvZGUoJ3V0Zi04Jyk7CgogICAgICAgICAgICByZXRbInNjcmlwdCJdID0gIGJhc2U2NC5iNjRlbmNvZGUocmV0WyJzY3JpcHQiXSkuZGVjb2RlKCd1dGYtOCcpLnN0cmlwKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLnR5cGUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJ0eXBlIl0gPSBzZWxmLnR5cGUoKS5fdG9Eb2N1bWVudCgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5kZXZpY2VUeXBlKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiZGV2aWNlVHlwZSJdID0gc2VsZi5kZXZpY2VUeXBlKCkuX3RvRG9jdW1lbnQoKTsKICAgICAgICAKICAgIAogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5tZXRyaWNfTWV0cmljX1ZhbHVlcygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbIm1ldHJpY19NZXRyaWNfVmFsdWVzIl0gPSBbdGEuX3RvRG9jdW1lbnQoKSBmb3IgdGEgaW4gc2VsZi5tZXRyaWNfTWV0cmljX1ZhbHVlcygpXTsKICAgIAoKICAgICAgICBpZiBiSlNPTiBpcyBub3QgTm9uZToKICAgICAgICAgICAgI3ByaW50KF9fdG9TdHJpbmcgKyAiR09UIEhFUkUiLCB0eXBlKHJldCksIHJldCk7CiAgICAgICAgICAgIHJldCA9IGpzb24uZHVtcHMocmV0KTsKICAgICAgICBnYy5jb2xsZWN0KCk7CiAgICAgICAgcmV0dXJuIHJldDsKCiAgICAKICAgIGRlZiBzdG9yZShzZWxmLCBfX2V2ZW50PU5vbmUpOgogICAgICAgIF9fdG9TdHJpbmcgPSAnTWV0cmljOjpzdG9yZSgpOiAnOwogICAgICAgIAogICAgICAgIGV2SlNPTiA9IE5vbmU7CgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIGV2SlNPTiA9IGpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOwogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046CiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7CiAgICAgICAgCgogICAgICAgIGFuc3dlciA9IE5vbmU7CgogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aW1lKCkpKyddLk1ldHJpYy5zdG9yZSgpJykubWV0aG9kKCdzdG9yZScpLmNsYXNzTmFtZSgnTWV0cmljJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOwogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7CiAgICAgICAgCiAgICAgICAgZ2MuY29sbGVjdCgpOwoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7CgogICAgICAgIAogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOwogICAgICAgIAogICAgICAgICAgICBhbnN3ZXIgPSBNZXRyaWMoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7CiAgICAgICAgCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsKCgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsKCiAgICAgICAgICAgIAogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsKICAgICAgICAgICAgCgogICAgICAgIHJldHVybiBhbnN3ZXI7CgogICAgCiAgICBkZWYgZmluZEFsbChzZWxmLCBfX2V2ZW50PU5vbmUpOgogICAgICAgIF9fdG9TdHJpbmcgPSAnTWV0cmljOjpmaW5kQWxsKCk6ICc7CiAgICAgICAgCiAgICAgICAgZXZKU09OID0gTm9uZTsKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgZXZKU09OID0ganNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7CiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoKICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsKICAgICAgICAKCiAgICAgICAgYW5zd2VyID0gTm9uZTsKCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpbWUoKSkrJ10uTWV0cmljLmZpbmRBbGwoKScpLm1ldGhvZCgnZmluZEFsbCcpLmNsYXNzTmFtZSgnTWV0cmljJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOwogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7CiAgICAgICAgCiAgICAgICAgZ2MuY29sbGVjdCgpOwoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7CgogICAgICAgIAogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOwogICAgICAgIAogICAgICAgICAgICBhbnN3ZXIgPSBNZXRyaWMoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7CiAgICAgICAgCgogICAgICAgICAgICBmb3IgbSBpbiBhbnN3ZXI6CiAgICAgICAgICAgICAgICBzID0gImRlZiAiICsgbS5jb2RlKCkgKyAiOgoiICsgbS5zY3JpcHQoKTsKICAgICAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyBzKTsKICAgICAgICAgICAgICAgIHNlbGZbIl8iICsgbS5jb2RlKCldID0gZXhlYyhzKTsKICAgICAgICAKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7CgoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOgogICAgICAgICAgICAKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7CgogICAgICAgICAgICAKICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7CiAgICAgICAgICAgIAoKICAgICAgICByZXR1cm4gYW5zd2VyOwoKICAgIAogICAgZGVmIGZpbmQoc2VsZiwgX19ldmVudD1Ob25lKToKICAgICAgICBfX3RvU3RyaW5nID0gJ01ldHJpYzo6ZmluZCgpOiAnOwogICAgICAgIAogICAgICAgIGV2SlNPTiA9IE5vbmU7CgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIGV2SlNPTiA9IGpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOwogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046CiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7CiAgICAgICAgCgogICAgICAgIGFuc3dlciA9IE5vbmU7CgogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aW1lKCkpKyddLk1ldHJpYy5maW5kKCknKS5tZXRob2QoJ2ZpbmQnKS5jbGFzc05hbWUoJ01ldHJpYycpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOwogICAgICAgIAogICAgICAgIGdjLmNvbGxlY3QoKTsKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOwoKICAgICAgICAKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsKICAgICAgICAKICAgICAgICAgICAgYW5zd2VyID0gTWV0cmljKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOwogICAgICAgIAoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7CgoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOgogICAgICAgICAgICAKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7CgogICAgICAgICAgICAKICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7CiAgICAgICAgICAgIAoKICAgICAgICByZXR1cm4gYW5zd2VyOwoKICAgIAoKCmNsYXNzIE1ldHJpY19WYWx1ZSgpOgogICAgZGVmIF9faW5pdF9fKHNlbGYsIElkPU5vbmUsIGFjdGl2ZT1Ob25lLCBlbmFibGVkPU5vbmUsIGNvZGU9Tm9uZSwgb3JkZXI9Tm9uZSwgZGF0ZT1Ob25lLCBuYW1lPU5vbmUsIHJlbWFyaz1Ob25lLCB2YWx1ZT1Ob25lLCBtZWFzdXJlZD1Ob25lLCBtZXRyaWM9Tm9uZSwgZGV2aWNlPU5vbmUpOgogICAgICAgIHN1cGVyKCkuX19pbml0X18oKTsKCiAgICAgICAgI3ByaW50KCdNZXRyaWNfVmFsdWU6Ol9faW5pdF9fKCknKTsKICAgICAgICBpZiBJZCBpcyBub3QgTm9uZToKICAgICAgICAgICAgc2VsZi5JZCA9IElkOwoKICAgICAgICAKICAgICAgICBzZWxmLmFjdGl2ZShhY3RpdmUpOwogICAgICAgIHNlbGYuZW5hYmxlZChlbmFibGVkKTsKICAgICAgICBzZWxmLmNvZGUoY29kZSk7CiAgICAgICAgc2VsZi5vcmRlcihvcmRlcik7CiAgICAgICAgc2VsZi5kYXRlKGRhdGUpOwogICAgICAgIHNlbGYubmFtZShuYW1lKTsKICAgICAgICBzZWxmLnJlbWFyayhyZW1hcmspOwogICAgICAgIHNlbGYudmFsdWUodmFsdWUpOwogICAgICAgIHNlbGYubWVhc3VyZWQobWVhc3VyZWQpOwogICAgICAgIHNlbGYubWV0cmljKG1ldHJpYyk7CiAgICAgICAgc2VsZi5kZXZpY2UoZGV2aWNlKTsKICAgICAgICAKICAgIElkID0gTm9uZTsKICAgIAogICAgCiAgICAjIGFjdGl2ZTogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX2FjdGl2ZSA9IE5vbmU7CiAgICBkZWYgYWN0aXZlKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9hY3RpdmUgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fYWN0aXZlOwogICAgCiAgICAjIGVuYWJsZWQ6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9lbmFibGVkID0gTm9uZTsKICAgIGRlZiBlbmFibGVkKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9lbmFibGVkID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2VuYWJsZWQ7CiAgICAKICAgICMgY29kZTogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX2NvZGUgPSBOb25lOwogICAgZGVmIGNvZGUoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2NvZGUgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fY29kZTsKICAgIAogICAgIyBvcmRlcjogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX29yZGVyID0gTm9uZTsKICAgIGRlZiBvcmRlcihzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fb3JkZXIgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fb3JkZXI7CiAgICAKICAgICMgZGF0ZTogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX2RhdGUgPSBOb25lOwogICAgZGVmIGRhdGUoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2RhdGUgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fZGF0ZTsKICAgIAogICAgIyBuYW1lOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfbmFtZSA9IE5vbmU7CiAgICBkZWYgbmFtZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fbmFtZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9uYW1lOwogICAgCiAgICAjIHJlbWFyazogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX3JlbWFyayA9IE5vbmU7CiAgICBkZWYgcmVtYXJrKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9yZW1hcmsgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fcmVtYXJrOwogICAgCiAgICAjIHZhbHVlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfdmFsdWUgPSBOb25lOwogICAgZGVmIHZhbHVlKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl92YWx1ZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl92YWx1ZTsKICAgIAogICAgIyBtZWFzdXJlZDogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX21lYXN1cmVkID0gTm9uZTsKICAgIGRlZiBtZWFzdXJlZChzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fbWVhc3VyZWQgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fbWVhc3VyZWQ7CiAgICAKICAgICMgbWV0cmljOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfbWV0cmljID0gTm9uZTsKICAgIGRlZiBtZXRyaWMoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX21ldHJpYyA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9tZXRyaWM7CiAgICAKICAgICMgZGV2aWNlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfZGV2aWNlID0gTm9uZTsKICAgIGRlZiBkZXZpY2Uoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2RldmljZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9kZXZpY2U7CiAgICAKICAgIAogICAgCiAgICAKICAgIGRlZiBfZnJvbURvY3VtZW50KHNlbGYsIG9iaik6CiAgICAgICAgX190b1N0cmluZyA9ICdNZXRyaWNfVmFsdWU6Ol9mcm9tRG9jdW1lbnQoKTogJzsKICAgICAgICAKICAgICAgICBpZiBvYmogaXMgTm9uZToKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CgogICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLCBieXRlcyk6CiAgICAgICAgICAgIG9iaiA9IHN0cihvYmosICJ1dGYtOCIpOwoKICAgICAgICBpZiBpc2luc3RhbmNlKG9iaiwgc3RyKSBvciB0eXBlKG9iaikgaXMgc3RyOgogICAgICAgICAgICBpZiByZS5tYXRjaChyIigoKFtBLVphLXpdezMsOX06KD86XC9cLyk/KSg/OlstOzomPVwrXCQsXHddK0ApP1tBLVphLXowLTkuLV0rfCg/Ond3dy58Wy07OiY9XCtcJCxcd10rQClbQS1aYS16MC05Li1dKykoKD86XC9bXCt+JVwvLlx3XC1fXSopP1w/Pyg/OlstXCs9JjslQC5cd19dKikjPyg/Oltcd10qKSk/KSIsIG9iaik6CiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgb2JqID0ganNvbi5sb2Fkcyh1cmxsaWIzLlBvb2xNYW5hZ2VyKCkucmVxdWVzdCgnR0VUJywgb2JqKS5kYXRhLmRlY29kZSgndXRmLTgnKSk7CiAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgb2JqID0ge307CiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBvYmogPSBqc29uLmxvYWRzKG9iaik7CiAgICAgICAgCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIGxpc3QpOgogICAgICAgICAgICByZXR1cm4gW01ldHJpY19WYWx1ZSgpLl9mcm9tRG9jdW1lbnQobykgZm9yIG8gaW4gb2JqXTsKICAgICAgICAgICAgCiAgICAgICAgaWYgbm90IGlzaW5zdGFuY2Uob2JqLCAoc3RyLCBieXRlcywgZGljdCkpOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJ3VuaGFuZGxlZCB0eXBlOiAnICsgc3RyKHR5cGUob2JqKSkpOwogICAgICAgICAgICByZXR1cm4gb2JqOwoKICAgICAgICBpZiAnSWQnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5JZCA9IG9ialsnSWQnXTsKCiAgICAKICAgICAgICBpZiAnYWN0aXZlJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuYWN0aXZlKG9ialsnYWN0aXZlJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ2VuYWJsZWQnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5lbmFibGVkKG9ialsnZW5hYmxlZCddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdjb2RlJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuY29kZShvYmpbJ2NvZGUnXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnb3JkZXInIGluIG9iajoKICAgICAgICAgICAgc2VsZi5vcmRlcihvYmpbJ29yZGVyJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ2RhdGUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5kYXRlKG9ialsnZGF0ZSddKTsKICAgICAgICAKICAgICAgICAgICAgc2VsZi5kYXRlKGRhdGV0aW1lLmRhdGV0aW1lLmZyb21pc29mb3JtYXQoc2VsZi5kYXRlKCkpKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICduYW1lJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYubmFtZShvYmpbJ25hbWUnXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAncmVtYXJrJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYucmVtYXJrKG9ialsncmVtYXJrJ10pOwogICAgICAgIAogICAgICAgICAgICBzZWxmLnJlbWFyayggYmFzZTY0LmI2NGRlY29kZShzZWxmLnJlbWFyaygpKSApOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ3ZhbHVlJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYudmFsdWUob2JqWyd2YWx1ZSddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdtZWFzdXJlZCcgaW4gb2JqOgogICAgICAgICAgICBzZWxmLm1lYXN1cmVkKG9ialsnbWVhc3VyZWQnXSk7CiAgICAgICAgCiAgICAgICAgICAgIHNlbGYubWVhc3VyZWQoZGF0ZXRpbWUuZGF0ZXRpbWUuZnJvbWlzb2Zvcm1hdChzZWxmLm1lYXN1cmVkKCkpKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdtZXRyaWMnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5tZXRyaWMoTWV0cmljKCkuX2Zyb21Eb2N1bWVudChvYmpbJ21ldHJpYyddKSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnZGV2aWNlJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuZGV2aWNlKERldmljZSgpLl9mcm9tRG9jdW1lbnQob2JqWydkZXZpY2UnXSkpOwogICAgICAgIAogICAgCgogICAgCgogICAgICAgIGdjLmNvbGxlY3QoKTsKICAgICAgICByZXR1cm4gc2VsZjsKICAgIAogICAgZGVmIF90b0RvY3VtZW50KHNlbGYsIGJKU09OPU5vbmUpOgogICAgICAgIF9fdG9TdHJpbmcgPSAnTWV0cmljX1ZhbHVlOjpfdG9Eb2N1bWVudCgpOiAnOwoKICAgICAgICByZXQgPSB7fTsKICAgICAgICBpZiBzZWxmLklkIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbIklkIl0gPSBzZWxmLklkOwoKICAgIAogICAgICAgIGlmIHNlbGYuYWN0aXZlKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiYWN0aXZlIl0gPSBzZWxmLmFjdGl2ZSgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5lbmFibGVkKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiZW5hYmxlZCJdID0gc2VsZi5lbmFibGVkKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLmNvZGUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJjb2RlIl0gPSBzZWxmLmNvZGUoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYub3JkZXIoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJvcmRlciJdID0gc2VsZi5vcmRlcigpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5kYXRlKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiZGF0ZSJdID0gc2VsZi5kYXRlKCk7CiAgICAgICAgCiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UocmV0WyJkYXRlIl0sIGRhdGV0aW1lLmRhdGV0aW1lKToKICAgICAgICAgICAgICAgIHJldFsiZGF0ZSJdID0gcmV0WyJkYXRlIl0uaXNvZm9ybWF0KCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLm5hbWUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJuYW1lIl0gPSBzZWxmLm5hbWUoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYucmVtYXJrKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSBzZWxmLnJlbWFyaygpOwogICAgICAgIAogICAgICAgICAgICBpZiBpc2luc3RhbmNlKHJldFsicmVtYXJrIl0sIGRpY3QpOgogICAgICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IGpzb24uZHVtcHMocmV0WyJyZW1hcmsiXSkuZW5jb2RlKCd1dGYtOCcpOwoKICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9ICBiYXNlNjQuYjY0ZW5jb2RlKHJldFsicmVtYXJrIl0pLmRlY29kZSgndXRmLTgnKS5zdHJpcCgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi52YWx1ZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbInZhbHVlIl0gPSBzZWxmLnZhbHVlKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLm1lYXN1cmVkKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsibWVhc3VyZWQiXSA9IHNlbGYubWVhc3VyZWQoKTsKICAgICAgICAKICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShyZXRbIm1lYXN1cmVkIl0sIGRhdGV0aW1lLmRhdGV0aW1lKToKICAgICAgICAgICAgICAgIHJldFsibWVhc3VyZWQiXSA9IHJldFsibWVhc3VyZWQiXS5pc29mb3JtYXQoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYubWV0cmljKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsibWV0cmljIl0gPSBzZWxmLm1ldHJpYygpLl90b0RvY3VtZW50KCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLmRldmljZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbImRldmljZSJdID0gc2VsZi5kZXZpY2UoKS5fdG9Eb2N1bWVudCgpOwogICAgICAgIAogICAgCiAgICAgICAgCiAgICAKCiAgICAgICAgaWYgYkpTT04gaXMgbm90IE5vbmU6CiAgICAgICAgICAgICNwcmludChfX3RvU3RyaW5nICsgIkdPVCBIRVJFIiwgdHlwZShyZXQpLCByZXQpOwogICAgICAgICAgICByZXQgPSBqc29uLmR1bXBzKHJldCk7CiAgICAgICAgZ2MuY29sbGVjdCgpOwogICAgICAgIHJldHVybiByZXQ7CgogICAgCiAgICBkZWYgc3RvcmUoc2VsZiwgX19ldmVudD1Ob25lKToKICAgICAgICBfX3RvU3RyaW5nID0gJ01ldHJpY19WYWx1ZTo6c3RvcmUoKTogJzsKICAgICAgICAKICAgICAgICBldkpTT04gPSBOb25lOwoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBldkpTT04gPSBqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsKICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOgogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOwogICAgICAgIAoKICAgICAgICBhbnN3ZXIgPSBOb25lOwoKICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGltZSgpKSsnXS5NZXRyaWNfVmFsdWUuc3RvcmUoKScpLm1ldGhvZCgnc3RvcmUnKS5jbGFzc05hbWUoJ01ldHJpY19WYWx1ZScpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOwogICAgICAgIAogICAgICAgIGdjLmNvbGxlY3QoKTsKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOwoKICAgICAgICAgICAgaWYgc2VsZi5tZWFzdXJlZCgpIGlzIE5vbmU6CiAgICAgICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgInJlYWRpbmcuLi4iKTsKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAid3JpdGluZy4uLiIpOwogICAgICAgIAogICAgICAgIAogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOwogICAgICAgIAogICAgICAgICAgICBhbnN3ZXIgPSBNZXRyaWNfVmFsdWUoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7CiAgICAgICAgCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsKCgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsKCiAgICAgICAgICAgIAogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsKICAgICAgICAgICAgCgogICAgICAgIHJldHVybiBhbnN3ZXI7CgogICAgCiAgICBkZWYgZmluZEFsbChzZWxmLCBfX2V2ZW50PU5vbmUpOgogICAgICAgIF9fdG9TdHJpbmcgPSAnTWV0cmljX1ZhbHVlOjpmaW5kQWxsKCk6ICc7CiAgICAgICAgCiAgICAgICAgZXZKU09OID0gTm9uZTsKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgZXZKU09OID0ganNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7CiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoKICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsKICAgICAgICAKCiAgICAgICAgYW5zd2VyID0gTm9uZTsKCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpbWUoKSkrJ10uTWV0cmljX1ZhbHVlLmZpbmRBbGwoKScpLm1ldGhvZCgnZmluZEFsbCcpLmNsYXNzTmFtZSgnTWV0cmljX1ZhbHVlJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOwogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7CiAgICAgICAgCiAgICAgICAgZ2MuY29sbGVjdCgpOwoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7CgogICAgICAgIAogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOwogICAgICAgIAogICAgICAgICAgICBhbnN3ZXIgPSBNZXRyaWNfVmFsdWUoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7CiAgICAgICAgCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsKCgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsKCiAgICAgICAgICAgIAogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsKICAgICAgICAgICAgCgogICAgICAgIHJldHVybiBhbnN3ZXI7CgogICAgCiAgICBkZWYgZmluZChzZWxmLCBfX2V2ZW50PU5vbmUpOgogICAgICAgIF9fdG9TdHJpbmcgPSAnTWV0cmljX1ZhbHVlOjpmaW5kKCk6ICc7CiAgICAgICAgCiAgICAgICAgZXZKU09OID0gTm9uZTsKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgZXZKU09OID0ganNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7CiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoKICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsKICAgICAgICAKCiAgICAgICAgYW5zd2VyID0gTm9uZTsKCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpbWUoKSkrJ10uTWV0cmljX1ZhbHVlLmZpbmQoKScpLm1ldGhvZCgnZmluZCcpLmNsYXNzTmFtZSgnTWV0cmljX1ZhbHVlJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOwogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7CiAgICAgICAgCiAgICAgICAgZ2MuY29sbGVjdCgpOwoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7CgogICAgICAgIAogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOwogICAgICAgIAogICAgICAgICAgICBhbnN3ZXIgPSBNZXRyaWNfVmFsdWUoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7CiAgICAgICAgCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsKCgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsKCiAgICAgICAgICAgIAogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsKICAgICAgICAgICAgCgogICAgICAgIHJldHVybiBhbnN3ZXI7CgogICAgCgoKY2xhc3MgRGV2aWNlKCk6CiAgICBkZWYgX19pbml0X18oc2VsZiwgSWQ9Tm9uZSwgYWN0aXZlPU5vbmUsIGVuYWJsZWQ9Tm9uZSwgY29kZT1Ob25lLCBvcmRlcj1Ob25lLCBkYXRlPU5vbmUsIG5hbWU9Tm9uZSwgcmVtYXJrPU5vbmUsIHR5cGU9Tm9uZSwgY29udHJvbGxlcj1Ob25lKToKICAgICAgICBzdXBlcigpLl9faW5pdF9fKCk7CgogICAgICAgICNwcmludCgnRGV2aWNlOjpfX2luaXRfXygpJyk7CiAgICAgICAgaWYgSWQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHNlbGYuSWQgPSBJZDsKCiAgICAgICAgCiAgICAgICAgc2VsZi5hY3RpdmUoYWN0aXZlKTsKICAgICAgICBzZWxmLmVuYWJsZWQoZW5hYmxlZCk7CiAgICAgICAgc2VsZi5jb2RlKGNvZGUpOwogICAgICAgIHNlbGYub3JkZXIob3JkZXIpOwogICAgICAgIHNlbGYuZGF0ZShkYXRlKTsKICAgICAgICBzZWxmLm5hbWUobmFtZSk7CiAgICAgICAgc2VsZi5yZW1hcmsocmVtYXJrKTsKICAgICAgICBzZWxmLnR5cGUodHlwZSk7CiAgICAgICAgc2VsZi5jb250cm9sbGVyKGNvbnRyb2xsZXIpOwogICAgICAgIAogICAgSWQgPSBOb25lOwogICAgCiAgICAKICAgICMgYWN0aXZlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfYWN0aXZlID0gTm9uZTsKICAgIGRlZiBhY3RpdmUoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2FjdGl2ZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9hY3RpdmU7CiAgICAKICAgICMgZW5hYmxlZDogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX2VuYWJsZWQgPSBOb25lOwogICAgZGVmIGVuYWJsZWQoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2VuYWJsZWQgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fZW5hYmxlZDsKICAgIAogICAgIyBjb2RlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfY29kZSA9IE5vbmU7CiAgICBkZWYgY29kZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fY29kZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9jb2RlOwogICAgCiAgICAjIG9yZGVyOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfb3JkZXIgPSBOb25lOwogICAgZGVmIG9yZGVyKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9vcmRlciA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9vcmRlcjsKICAgIAogICAgIyBkYXRlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfZGF0ZSA9IE5vbmU7CiAgICBkZWYgZGF0ZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fZGF0ZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9kYXRlOwogICAgCiAgICAjIG5hbWU6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9uYW1lID0gTm9uZTsKICAgIGRlZiBuYW1lKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9uYW1lID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX25hbWU7CiAgICAKICAgICMgcmVtYXJrOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfcmVtYXJrID0gTm9uZTsKICAgIGRlZiByZW1hcmsoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX3JlbWFyayA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9yZW1hcms7CiAgICAKICAgICMgdHlwZTogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX3R5cGUgPSBOb25lOwogICAgZGVmIHR5cGUoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX3R5cGUgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fdHlwZTsKICAgIAogICAgIyBjb250cm9sbGVyOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfY29udHJvbGxlciA9IE5vbmU7CiAgICBkZWYgY29udHJvbGxlcihzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fY29udHJvbGxlciA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9jb250cm9sbGVyOwogICAgCiAgICAKICAgIAogICAgIyBkZXZpY2VfTWV0cmljX1ZhbHVlczogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX2RldmljZV9NZXRyaWNfVmFsdWVzID0gTm9uZTsKICAgIGRlZiBkZXZpY2VfTWV0cmljX1ZhbHVlcyhzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fZGV2aWNlX01ldHJpY19WYWx1ZXMgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fZGV2aWNlX01ldHJpY19WYWx1ZXM7CiAgICAKICAgIAogICAgZGVmIF9mcm9tRG9jdW1lbnQoc2VsZiwgb2JqKToKICAgICAgICBfX3RvU3RyaW5nID0gJ0RldmljZTo6X2Zyb21Eb2N1bWVudCgpOiAnOwogICAgICAgIAogICAgICAgIGlmIG9iaiBpcyBOb25lOgogICAgICAgICAgICByZXR1cm4gc2VsZjsKCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIGJ5dGVzKToKICAgICAgICAgICAgb2JqID0gc3RyKG9iaiwgInV0Zi04Iik7CgogICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLCBzdHIpIG9yIHR5cGUob2JqKSBpcyBzdHI6CiAgICAgICAgICAgIGlmIHJlLm1hdGNoKHIiKCgoW0EtWmEtel17Myw5fTooPzpcL1wvKT8pKD86Wy07OiY9XCtcJCxcd10rQCk/W0EtWmEtejAtOS4tXSt8KD86d3d3LnxbLTs6Jj1cK1wkLFx3XStAKVtBLVphLXowLTkuLV0rKSgoPzpcL1tcK34lXC8uXHdcLV9dKik/XD8/KD86Wy1cKz0mOyVALlx3X10qKSM/KD86W1x3XSopKT8pIiwgb2JqKToKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBvYmogPSBqc29uLmxvYWRzKHVybGxpYjMuUG9vbE1hbmFnZXIoKS5yZXF1ZXN0KCdHRVQnLCBvYmopLmRhdGEuZGVjb2RlKCd1dGYtOCcpKTsKICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICBvYmogPSB7fTsKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIG9iaiA9IGpzb24ubG9hZHMob2JqKTsKICAgICAgICAKICAgICAgICBpZiBpc2luc3RhbmNlKG9iaiwgbGlzdCk6CiAgICAgICAgICAgIHJldHVybiBbRGV2aWNlKCkuX2Zyb21Eb2N1bWVudChvKSBmb3IgbyBpbiBvYmpdOwogICAgICAgICAgICAKICAgICAgICBpZiBub3QgaXNpbnN0YW5jZShvYmosIChzdHIsIGJ5dGVzLCBkaWN0KSk6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAndW5oYW5kbGVkIHR5cGU6ICcgKyBzdHIodHlwZShvYmopKSk7CiAgICAgICAgICAgIHJldHVybiBvYmo7CgogICAgICAgIGlmICdJZCcgaW4gb2JqOgogICAgICAgICAgICBzZWxmLklkID0gb2JqWydJZCddOwoKICAgIAogICAgICAgIGlmICdhY3RpdmUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5hY3RpdmUob2JqWydhY3RpdmUnXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnZW5hYmxlZCcgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmVuYWJsZWQob2JqWydlbmFibGVkJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ2NvZGUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5jb2RlKG9ialsnY29kZSddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdvcmRlcicgaW4gb2JqOgogICAgICAgICAgICBzZWxmLm9yZGVyKG9ialsnb3JkZXInXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnZGF0ZScgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmRhdGUob2JqWydkYXRlJ10pOwogICAgICAgIAogICAgICAgICAgICBzZWxmLmRhdGUoZGF0ZXRpbWUuZGF0ZXRpbWUuZnJvbWlzb2Zvcm1hdChzZWxmLmRhdGUoKSkpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ25hbWUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5uYW1lKG9ialsnbmFtZSddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdyZW1hcmsnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5yZW1hcmsob2JqWydyZW1hcmsnXSk7CiAgICAgICAgCiAgICAgICAgICAgIHNlbGYucmVtYXJrKCBiYXNlNjQuYjY0ZGVjb2RlKHNlbGYucmVtYXJrKCkpICk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAndHlwZScgaW4gb2JqOgogICAgICAgICAgICBzZWxmLnR5cGUoRGV2aWNlX1R5cGUoKS5fZnJvbURvY3VtZW50KG9ialsndHlwZSddKSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnY29udHJvbGxlcicgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmNvbnRyb2xsZXIoTm9kZSgpLl9mcm9tRG9jdW1lbnQob2JqWydjb250cm9sbGVyJ10pKTsKICAgICAgICAKICAgIAoKICAgIAogICAgICAgIGlmICdkZXZpY2VfTWV0cmljX1ZhbHVlcycgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmRldmljZV9NZXRyaWNfVmFsdWVzKE1ldHJpY19WYWx1ZSgpLl9mcm9tRG9jdW1lbnQob2JqWydkZXZpY2VfTWV0cmljX1ZhbHVlcyddKSk7CiAgICAKCiAgICAgICAgZ2MuY29sbGVjdCgpOwogICAgICAgIHJldHVybiBzZWxmOwogICAgCiAgICBkZWYgX3RvRG9jdW1lbnQoc2VsZiwgYkpTT049Tm9uZSk6CiAgICAgICAgX190b1N0cmluZyA9ICdEZXZpY2U6Ol90b0RvY3VtZW50KCk6ICc7CgogICAgICAgIHJldCA9IHt9OwogICAgICAgIGlmIHNlbGYuSWQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiSWQiXSA9IHNlbGYuSWQ7CgogICAgCiAgICAgICAgaWYgc2VsZi5hY3RpdmUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJhY3RpdmUiXSA9IHNlbGYuYWN0aXZlKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLmVuYWJsZWQoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJlbmFibGVkIl0gPSBzZWxmLmVuYWJsZWQoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYuY29kZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbImNvZGUiXSA9IHNlbGYuY29kZSgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5vcmRlcigpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbIm9yZGVyIl0gPSBzZWxmLm9yZGVyKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLmRhdGUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJkYXRlIl0gPSBzZWxmLmRhdGUoKTsKICAgICAgICAKICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShyZXRbImRhdGUiXSwgZGF0ZXRpbWUuZGF0ZXRpbWUpOgogICAgICAgICAgICAgICAgcmV0WyJkYXRlIl0gPSByZXRbImRhdGUiXS5pc29mb3JtYXQoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYubmFtZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbIm5hbWUiXSA9IHNlbGYubmFtZSgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5yZW1hcmsoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IHNlbGYucmVtYXJrKCk7CiAgICAgICAgCiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UocmV0WyJyZW1hcmsiXSwgZGljdCk6CiAgICAgICAgICAgICAgICByZXRbInJlbWFyayJdID0ganNvbi5kdW1wcyhyZXRbInJlbWFyayJdKS5lbmNvZGUoJ3V0Zi04Jyk7CgogICAgICAgICAgICByZXRbInJlbWFyayJdID0gIGJhc2U2NC5iNjRlbmNvZGUocmV0WyJyZW1hcmsiXSkuZGVjb2RlKCd1dGYtOCcpLnN0cmlwKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLnR5cGUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJ0eXBlIl0gPSBzZWxmLnR5cGUoKS5fdG9Eb2N1bWVudCgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5jb250cm9sbGVyKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiY29udHJvbGxlciJdID0gc2VsZi5jb250cm9sbGVyKCkuX3RvRG9jdW1lbnQoKTsKICAgICAgICAKICAgIAogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5kZXZpY2VfTWV0cmljX1ZhbHVlcygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbImRldmljZV9NZXRyaWNfVmFsdWVzIl0gPSBbdGEuX3RvRG9jdW1lbnQoKSBmb3IgdGEgaW4gc2VsZi5kZXZpY2VfTWV0cmljX1ZhbHVlcygpXTsKICAgIAoKICAgICAgICBpZiBiSlNPTiBpcyBub3QgTm9uZToKICAgICAgICAgICAgI3ByaW50KF9fdG9TdHJpbmcgKyAiR09UIEhFUkUiLCB0eXBlKHJldCksIHJldCk7CiAgICAgICAgICAgIHJldCA9IGpzb24uZHVtcHMocmV0KTsKICAgICAgICBnYy5jb2xsZWN0KCk7CiAgICAgICAgcmV0dXJuIHJldDsKCiAgICAKICAgIGRlZiBzdG9yZShzZWxmLCBfX2V2ZW50PU5vbmUpOgogICAgICAgIF9fdG9TdHJpbmcgPSAnRGV2aWNlOjpzdG9yZSgpOiAnOwogICAgICAgIAogICAgICAgIGV2SlNPTiA9IE5vbmU7CgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIGV2SlNPTiA9IGpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOwogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046CiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7CiAgICAgICAgCgogICAgICAgIGFuc3dlciA9IE5vbmU7CgogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aW1lKCkpKyddLkRldmljZS5zdG9yZSgpJykubWV0aG9kKCdzdG9yZScpLmNsYXNzTmFtZSgnRGV2aWNlJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOwogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7CiAgICAgICAgCiAgICAgICAgZ2MuY29sbGVjdCgpOwoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7CgogICAgICAgIAogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOwogICAgICAgIAogICAgICAgICAgICBhbnN3ZXIgPSBEZXZpY2UoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7CiAgICAgICAgCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsKCgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsKCiAgICAgICAgICAgIAogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsKICAgICAgICAgICAgCgogICAgICAgIHJldHVybiBhbnN3ZXI7CgogICAgCiAgICBkZWYgZmluZEFsbChzZWxmLCBfX2V2ZW50PU5vbmUpOgogICAgICAgIF9fdG9TdHJpbmcgPSAnRGV2aWNlOjpmaW5kQWxsKCk6ICc7CiAgICAgICAgCiAgICAgICAgZXZKU09OID0gTm9uZTsKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgZXZKU09OID0ganNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7CiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoKICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsKICAgICAgICAKCiAgICAgICAgYW5zd2VyID0gTm9uZTsKCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpbWUoKSkrJ10uRGV2aWNlLmZpbmRBbGwoKScpLm1ldGhvZCgnZmluZEFsbCcpLmNsYXNzTmFtZSgnRGV2aWNlJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOwogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7CiAgICAgICAgCiAgICAgICAgZ2MuY29sbGVjdCgpOwoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7CgogICAgICAgIAogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOwogICAgICAgIAogICAgICAgICAgICBhbnN3ZXIgPSBEZXZpY2UoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7CiAgICAgICAgCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsKCgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsKCiAgICAgICAgICAgIAogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsKICAgICAgICAgICAgCgogICAgICAgIHJldHVybiBhbnN3ZXI7CgogICAgCiAgICBkZWYgZmluZChzZWxmLCBfX2V2ZW50PU5vbmUpOgogICAgICAgIF9fdG9TdHJpbmcgPSAnRGV2aWNlOjpmaW5kKCk6ICc7CiAgICAgICAgCiAgICAgICAgZXZKU09OID0gTm9uZTsKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgZXZKU09OID0ganNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7CiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoKICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsKICAgICAgICAKCiAgICAgICAgYW5zd2VyID0gTm9uZTsKCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpbWUoKSkrJ10uRGV2aWNlLmZpbmQoKScpLm1ldGhvZCgnZmluZCcpLmNsYXNzTmFtZSgnRGV2aWNlJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOwogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7CiAgICAgICAgCiAgICAgICAgZ2MuY29sbGVjdCgpOwoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7CgogICAgICAgIAogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOwogICAgICAgIAogICAgICAgICAgICBhbnN3ZXIgPSBEZXZpY2UoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7CiAgICAgICAgCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsKCgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsKCiAgICAgICAgICAgIAogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsKICAgICAgICAgICAgCgogICAgICAgIHJldHVybiBhbnN3ZXI7CgogICAgCgoKY2xhc3MgRGV2aWNlX0NhdGVnb3J5KCk6CiAgICBkZWYgX19pbml0X18oc2VsZiwgSWQ9Tm9uZSwgYWN0aXZlPU5vbmUsIGVuYWJsZWQ9Tm9uZSwgY29kZT1Ob25lLCBvcmRlcj1Ob25lLCBkYXRlPU5vbmUsIG5hbWU9Tm9uZSwgcmVtYXJrPU5vbmUsIHBhcmVudD1Ob25lKToKICAgICAgICBzdXBlcigpLl9faW5pdF9fKCk7CgogICAgICAgICNwcmludCgnRGV2aWNlX0NhdGVnb3J5OjpfX2luaXRfXygpJyk7CiAgICAgICAgaWYgSWQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHNlbGYuSWQgPSBJZDsKCiAgICAgICAgCiAgICAgICAgc2VsZi5hY3RpdmUoYWN0aXZlKTsKICAgICAgICBzZWxmLmVuYWJsZWQoZW5hYmxlZCk7CiAgICAgICAgc2VsZi5jb2RlKGNvZGUpOwogICAgICAgIHNlbGYub3JkZXIob3JkZXIpOwogICAgICAgIHNlbGYuZGF0ZShkYXRlKTsKICAgICAgICBzZWxmLm5hbWUobmFtZSk7CiAgICAgICAgc2VsZi5yZW1hcmsocmVtYXJrKTsKICAgICAgICBzZWxmLnBhcmVudChwYXJlbnQpOwogICAgICAgIAogICAgSWQgPSBOb25lOwogICAgCiAgICAKICAgICMgYWN0aXZlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfYWN0aXZlID0gTm9uZTsKICAgIGRlZiBhY3RpdmUoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2FjdGl2ZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9hY3RpdmU7CiAgICAKICAgICMgZW5hYmxlZDogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX2VuYWJsZWQgPSBOb25lOwogICAgZGVmIGVuYWJsZWQoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2VuYWJsZWQgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fZW5hYmxlZDsKICAgIAogICAgIyBjb2RlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfY29kZSA9IE5vbmU7CiAgICBkZWYgY29kZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fY29kZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9jb2RlOwogICAgCiAgICAjIG9yZGVyOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfb3JkZXIgPSBOb25lOwogICAgZGVmIG9yZGVyKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9vcmRlciA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9vcmRlcjsKICAgIAogICAgIyBkYXRlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfZGF0ZSA9IE5vbmU7CiAgICBkZWYgZGF0ZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fZGF0ZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9kYXRlOwogICAgCiAgICAjIG5hbWU6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9uYW1lID0gTm9uZTsKICAgIGRlZiBuYW1lKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9uYW1lID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX25hbWU7CiAgICAKICAgICMgcmVtYXJrOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfcmVtYXJrID0gTm9uZTsKICAgIGRlZiByZW1hcmsoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX3JlbWFyayA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9yZW1hcms7CiAgICAKICAgICMgcGFyZW50OiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfcGFyZW50ID0gTm9uZTsKICAgIGRlZiBwYXJlbnQoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX3BhcmVudCA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9wYXJlbnQ7CiAgICAKICAgIAogICAgCiAgICAjIGNhdGVnb3J5X0RldmljZV9UeXBlczogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX2NhdGVnb3J5X0RldmljZV9UeXBlcyA9IE5vbmU7CiAgICBkZWYgY2F0ZWdvcnlfRGV2aWNlX1R5cGVzKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9jYXRlZ29yeV9EZXZpY2VfVHlwZXMgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fY2F0ZWdvcnlfRGV2aWNlX1R5cGVzOwogICAgCiAgICAKICAgIGRlZiBfZnJvbURvY3VtZW50KHNlbGYsIG9iaik6CiAgICAgICAgX190b1N0cmluZyA9ICdEZXZpY2VfQ2F0ZWdvcnk6Ol9mcm9tRG9jdW1lbnQoKTogJzsKICAgICAgICAKICAgICAgICBpZiBvYmogaXMgTm9uZToKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CgogICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLCBieXRlcyk6CiAgICAgICAgICAgIG9iaiA9IHN0cihvYmosICJ1dGYtOCIpOwoKICAgICAgICBpZiBpc2luc3RhbmNlKG9iaiwgc3RyKSBvciB0eXBlKG9iaikgaXMgc3RyOgogICAgICAgICAgICBpZiByZS5tYXRjaChyIigoKFtBLVphLXpdezMsOX06KD86XC9cLyk/KSg/OlstOzomPVwrXCQsXHddK0ApP1tBLVphLXowLTkuLV0rfCg/Ond3dy58Wy07OiY9XCtcJCxcd10rQClbQS1aYS16MC05Li1dKykoKD86XC9bXCt+JVwvLlx3XC1fXSopP1w/Pyg/OlstXCs9JjslQC5cd19dKikjPyg/Oltcd10qKSk/KSIsIG9iaik6CiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgb2JqID0ganNvbi5sb2Fkcyh1cmxsaWIzLlBvb2xNYW5hZ2VyKCkucmVxdWVzdCgnR0VUJywgb2JqKS5kYXRhLmRlY29kZSgndXRmLTgnKSk7CiAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgb2JqID0ge307CiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBvYmogPSBqc29uLmxvYWRzKG9iaik7CiAgICAgICAgCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIGxpc3QpOgogICAgICAgICAgICByZXR1cm4gW0RldmljZV9DYXRlZ29yeSgpLl9mcm9tRG9jdW1lbnQobykgZm9yIG8gaW4gb2JqXTsKICAgICAgICAgICAgCiAgICAgICAgaWYgbm90IGlzaW5zdGFuY2Uob2JqLCAoc3RyLCBieXRlcywgZGljdCkpOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJ3VuaGFuZGxlZCB0eXBlOiAnICsgc3RyKHR5cGUob2JqKSkpOwogICAgICAgICAgICByZXR1cm4gb2JqOwoKICAgICAgICBpZiAnSWQnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5JZCA9IG9ialsnSWQnXTsKCiAgICAKICAgICAgICBpZiAnYWN0aXZlJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuYWN0aXZlKG9ialsnYWN0aXZlJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ2VuYWJsZWQnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5lbmFibGVkKG9ialsnZW5hYmxlZCddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdjb2RlJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuY29kZShvYmpbJ2NvZGUnXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnb3JkZXInIGluIG9iajoKICAgICAgICAgICAgc2VsZi5vcmRlcihvYmpbJ29yZGVyJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ2RhdGUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5kYXRlKG9ialsnZGF0ZSddKTsKICAgICAgICAKICAgICAgICAgICAgc2VsZi5kYXRlKGRhdGV0aW1lLmRhdGV0aW1lLmZyb21pc29mb3JtYXQoc2VsZi5kYXRlKCkpKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICduYW1lJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYubmFtZShvYmpbJ25hbWUnXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAncmVtYXJrJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYucmVtYXJrKG9ialsncmVtYXJrJ10pOwogICAgICAgIAogICAgICAgICAgICBzZWxmLnJlbWFyayggYmFzZTY0LmI2NGRlY29kZShzZWxmLnJlbWFyaygpKSApOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ3BhcmVudCcgaW4gb2JqOgogICAgICAgICAgICBzZWxmLnBhcmVudChvYmpbJ3BhcmVudCddKTsKICAgICAgICAKICAgIAoKICAgIAogICAgICAgIGlmICdjYXRlZ29yeV9EZXZpY2VfVHlwZXMnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5jYXRlZ29yeV9EZXZpY2VfVHlwZXMoRGV2aWNlX1R5cGUoKS5fZnJvbURvY3VtZW50KG9ialsnY2F0ZWdvcnlfRGV2aWNlX1R5cGVzJ10pKTsKICAgIAoKICAgICAgICBnYy5jb2xsZWN0KCk7CiAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAKICAgIGRlZiBfdG9Eb2N1bWVudChzZWxmLCBiSlNPTj1Ob25lKToKICAgICAgICBfX3RvU3RyaW5nID0gJ0RldmljZV9DYXRlZ29yeTo6X3RvRG9jdW1lbnQoKTogJzsKCiAgICAgICAgcmV0ID0ge307CiAgICAgICAgaWYgc2VsZi5JZCBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJJZCJdID0gc2VsZi5JZDsKCiAgICAKICAgICAgICBpZiBzZWxmLmFjdGl2ZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbImFjdGl2ZSJdID0gc2VsZi5hY3RpdmUoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYuZW5hYmxlZCgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbImVuYWJsZWQiXSA9IHNlbGYuZW5hYmxlZCgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5jb2RlKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiY29kZSJdID0gc2VsZi5jb2RlKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLm9yZGVyKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsib3JkZXIiXSA9IHNlbGYub3JkZXIoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYuZGF0ZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbImRhdGUiXSA9IHNlbGYuZGF0ZSgpOwogICAgICAgIAogICAgICAgICAgICBpZiBpc2luc3RhbmNlKHJldFsiZGF0ZSJdLCBkYXRldGltZS5kYXRldGltZSk6CiAgICAgICAgICAgICAgICByZXRbImRhdGUiXSA9IHJldFsiZGF0ZSJdLmlzb2Zvcm1hdCgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5uYW1lKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsibmFtZSJdID0gc2VsZi5uYW1lKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLnJlbWFyaygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbInJlbWFyayJdID0gc2VsZi5yZW1hcmsoKTsKICAgICAgICAKICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShyZXRbInJlbWFyayJdLCBkaWN0KToKICAgICAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSBqc29uLmR1bXBzKHJldFsicmVtYXJrIl0pLmVuY29kZSgndXRmLTgnKTsKCiAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSAgYmFzZTY0LmI2NGVuY29kZShyZXRbInJlbWFyayJdKS5kZWNvZGUoJ3V0Zi04Jykuc3RyaXAoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYucGFyZW50KCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsicGFyZW50Il0gPSBzZWxmLnBhcmVudCgpOwogICAgICAgIAogICAgCiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLmNhdGVnb3J5X0RldmljZV9UeXBlcygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbImNhdGVnb3J5X0RldmljZV9UeXBlcyJdID0gW3RhLl90b0RvY3VtZW50KCkgZm9yIHRhIGluIHNlbGYuY2F0ZWdvcnlfRGV2aWNlX1R5cGVzKCldOwogICAgCgogICAgICAgIGlmIGJKU09OIGlzIG5vdCBOb25lOgogICAgICAgICAgICAjcHJpbnQoX190b1N0cmluZyArICJHT1QgSEVSRSIsIHR5cGUocmV0KSwgcmV0KTsKICAgICAgICAgICAgcmV0ID0ganNvbi5kdW1wcyhyZXQpOwogICAgICAgIGdjLmNvbGxlY3QoKTsKICAgICAgICByZXR1cm4gcmV0OwoKICAgIAogICAgZGVmIHN0b3JlKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6CiAgICAgICAgX190b1N0cmluZyA9ICdEZXZpY2VfQ2F0ZWdvcnk6OnN0b3JlKCk6ICc7CiAgICAgICAgCiAgICAgICAgZXZKU09OID0gTm9uZTsKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgZXZKU09OID0ganNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7CiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoKICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsKICAgICAgICAKCiAgICAgICAgYW5zd2VyID0gTm9uZTsKCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpbWUoKSkrJ10uRGV2aWNlX0NhdGVnb3J5LnN0b3JlKCknKS5tZXRob2QoJ3N0b3JlJykuY2xhc3NOYW1lKCdEZXZpY2VfQ2F0ZWdvcnknKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7CiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsKICAgICAgICAKICAgICAgICBnYy5jb2xsZWN0KCk7CgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsKCiAgICAgICAgCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7CiAgICAgICAgCiAgICAgICAgICAgIGFuc3dlciA9IERldmljZV9DYXRlZ29yeSgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsKICAgICAgICAKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOwoKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOwogICAgICAgICAgICAKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOwoKICAgICAgICAgICAgCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOwogICAgICAgICAgICAKCiAgICAgICAgcmV0dXJuIGFuc3dlcjsKCiAgICAKICAgIGRlZiBmaW5kQWxsKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6CiAgICAgICAgX190b1N0cmluZyA9ICdEZXZpY2VfQ2F0ZWdvcnk6OmZpbmRBbGwoKTogJzsKICAgICAgICAKICAgICAgICBldkpTT04gPSBOb25lOwoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBldkpTT04gPSBqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsKICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOgogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOwogICAgICAgIAoKICAgICAgICBhbnN3ZXIgPSBOb25lOwoKICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGltZSgpKSsnXS5EZXZpY2VfQ2F0ZWdvcnkuZmluZEFsbCgpJykubWV0aG9kKCdmaW5kQWxsJykuY2xhc3NOYW1lKCdEZXZpY2VfQ2F0ZWdvcnknKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7CiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsKICAgICAgICAKICAgICAgICBnYy5jb2xsZWN0KCk7CgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsKCiAgICAgICAgCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7CiAgICAgICAgCiAgICAgICAgICAgIGFuc3dlciA9IERldmljZV9DYXRlZ29yeSgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsKICAgICAgICAKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOwoKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOwogICAgICAgICAgICAKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOwoKICAgICAgICAgICAgCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOwogICAgICAgICAgICAKCiAgICAgICAgcmV0dXJuIGFuc3dlcjsKCiAgICAKICAgIGRlZiBmaW5kKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6CiAgICAgICAgX190b1N0cmluZyA9ICdEZXZpY2VfQ2F0ZWdvcnk6OmZpbmQoKTogJzsKICAgICAgICAKICAgICAgICBldkpTT04gPSBOb25lOwoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBldkpTT04gPSBqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsKICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOgogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOwogICAgICAgIAoKICAgICAgICBhbnN3ZXIgPSBOb25lOwoKICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGltZSgpKSsnXS5EZXZpY2VfQ2F0ZWdvcnkuZmluZCgpJykubWV0aG9kKCdmaW5kJykuY2xhc3NOYW1lKCdEZXZpY2VfQ2F0ZWdvcnknKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7CiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsKICAgICAgICAKICAgICAgICBnYy5jb2xsZWN0KCk7CgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsKCiAgICAgICAgCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7CiAgICAgICAgCiAgICAgICAgICAgIGFuc3dlciA9IERldmljZV9DYXRlZ29yeSgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsKICAgICAgICAKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOwoKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOwogICAgICAgICAgICAKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOwoKICAgICAgICAgICAgCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOwogICAgICAgICAgICAKCiAgICAgICAgcmV0dXJuIGFuc3dlcjsKCiAgICAKCgpjbGFzcyBEZXZpY2VfVHlwZSgpOgogICAgZGVmIF9faW5pdF9fKHNlbGYsIElkPU5vbmUsIGFjdGl2ZT1Ob25lLCBlbmFibGVkPU5vbmUsIGNvZGU9Tm9uZSwgb3JkZXI9Tm9uZSwgZGF0ZT1Ob25lLCBuYW1lPU5vbmUsIHJlbWFyaz1Ob25lLCBjYXRlZ29yeT1Ob25lKToKICAgICAgICBzdXBlcigpLl9faW5pdF9fKCk7CgogICAgICAgICNwcmludCgnRGV2aWNlX1R5cGU6Ol9faW5pdF9fKCknKTsKICAgICAgICBpZiBJZCBpcyBub3QgTm9uZToKICAgICAgICAgICAgc2VsZi5JZCA9IElkOwoKICAgICAgICAKICAgICAgICBzZWxmLmFjdGl2ZShhY3RpdmUpOwogICAgICAgIHNlbGYuZW5hYmxlZChlbmFibGVkKTsKICAgICAgICBzZWxmLmNvZGUoY29kZSk7CiAgICAgICAgc2VsZi5vcmRlcihvcmRlcik7CiAgICAgICAgc2VsZi5kYXRlKGRhdGUpOwogICAgICAgIHNlbGYubmFtZShuYW1lKTsKICAgICAgICBzZWxmLnJlbWFyayhyZW1hcmspOwogICAgICAgIHNlbGYuY2F0ZWdvcnkoY2F0ZWdvcnkpOwogICAgICAgIAogICAgSWQgPSBOb25lOwogICAgCiAgICAKICAgICMgYWN0aXZlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfYWN0aXZlID0gTm9uZTsKICAgIGRlZiBhY3RpdmUoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2FjdGl2ZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9hY3RpdmU7CiAgICAKICAgICMgZW5hYmxlZDogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX2VuYWJsZWQgPSBOb25lOwogICAgZGVmIGVuYWJsZWQoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2VuYWJsZWQgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fZW5hYmxlZDsKICAgIAogICAgIyBjb2RlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfY29kZSA9IE5vbmU7CiAgICBkZWYgY29kZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fY29kZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9jb2RlOwogICAgCiAgICAjIG9yZGVyOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfb3JkZXIgPSBOb25lOwogICAgZGVmIG9yZGVyKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9vcmRlciA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9vcmRlcjsKICAgIAogICAgIyBkYXRlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfZGF0ZSA9IE5vbmU7CiAgICBkZWYgZGF0ZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fZGF0ZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9kYXRlOwogICAgCiAgICAjIG5hbWU6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9uYW1lID0gTm9uZTsKICAgIGRlZiBuYW1lKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9uYW1lID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX25hbWU7CiAgICAKICAgICMgcmVtYXJrOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfcmVtYXJrID0gTm9uZTsKICAgIGRlZiByZW1hcmsoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX3JlbWFyayA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9yZW1hcms7CiAgICAKICAgICMgY2F0ZWdvcnk6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9jYXRlZ29yeSA9IE5vbmU7CiAgICBkZWYgY2F0ZWdvcnkoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2NhdGVnb3J5ID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2NhdGVnb3J5OwogICAgCiAgICAKICAgIAogICAgIyBkZXZpY2VUeXBlX01ldHJpY3M6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9kZXZpY2VUeXBlX01ldHJpY3MgPSBOb25lOwogICAgZGVmIGRldmljZVR5cGVfTWV0cmljcyhzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fZGV2aWNlVHlwZV9NZXRyaWNzID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2RldmljZVR5cGVfTWV0cmljczsKICAgIAogICAgIyB0eXBlX0RldmljZXM6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF90eXBlX0RldmljZXMgPSBOb25lOwogICAgZGVmIHR5cGVfRGV2aWNlcyhzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fdHlwZV9EZXZpY2VzID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3R5cGVfRGV2aWNlczsKICAgIAogICAgCiAgICBkZWYgX2Zyb21Eb2N1bWVudChzZWxmLCBvYmopOgogICAgICAgIF9fdG9TdHJpbmcgPSAnRGV2aWNlX1R5cGU6Ol9mcm9tRG9jdW1lbnQoKTogJzsKICAgICAgICAKICAgICAgICBpZiBvYmogaXMgTm9uZToKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CgogICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLCBieXRlcyk6CiAgICAgICAgICAgIG9iaiA9IHN0cihvYmosICJ1dGYtOCIpOwoKICAgICAgICBpZiBpc2luc3RhbmNlKG9iaiwgc3RyKSBvciB0eXBlKG9iaikgaXMgc3RyOgogICAgICAgICAgICBpZiByZS5tYXRjaChyIigoKFtBLVphLXpdezMsOX06KD86XC9cLyk/KSg/OlstOzomPVwrXCQsXHddK0ApP1tBLVphLXowLTkuLV0rfCg/Ond3dy58Wy07OiY9XCtcJCxcd10rQClbQS1aYS16MC05Li1dKykoKD86XC9bXCt+JVwvLlx3XC1fXSopP1w/Pyg/OlstXCs9JjslQC5cd19dKikjPyg/Oltcd10qKSk/KSIsIG9iaik6CiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgb2JqID0ganNvbi5sb2Fkcyh1cmxsaWIzLlBvb2xNYW5hZ2VyKCkucmVxdWVzdCgnR0VUJywgb2JqKS5kYXRhLmRlY29kZSgndXRmLTgnKSk7CiAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgb2JqID0ge307CiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBvYmogPSBqc29uLmxvYWRzKG9iaik7CiAgICAgICAgCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIGxpc3QpOgogICAgICAgICAgICByZXR1cm4gW0RldmljZV9UeXBlKCkuX2Zyb21Eb2N1bWVudChvKSBmb3IgbyBpbiBvYmpdOwogICAgICAgICAgICAKICAgICAgICBpZiBub3QgaXNpbnN0YW5jZShvYmosIChzdHIsIGJ5dGVzLCBkaWN0KSk6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAndW5oYW5kbGVkIHR5cGU6ICcgKyBzdHIodHlwZShvYmopKSk7CiAgICAgICAgICAgIHJldHVybiBvYmo7CgogICAgICAgIGlmICdJZCcgaW4gb2JqOgogICAgICAgICAgICBzZWxmLklkID0gb2JqWydJZCddOwoKICAgIAogICAgICAgIGlmICdhY3RpdmUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5hY3RpdmUob2JqWydhY3RpdmUnXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnZW5hYmxlZCcgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmVuYWJsZWQob2JqWydlbmFibGVkJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ2NvZGUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5jb2RlKG9ialsnY29kZSddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdvcmRlcicgaW4gb2JqOgogICAgICAgICAgICBzZWxmLm9yZGVyKG9ialsnb3JkZXInXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnZGF0ZScgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmRhdGUob2JqWydkYXRlJ10pOwogICAgICAgIAogICAgICAgICAgICBzZWxmLmRhdGUoZGF0ZXRpbWUuZGF0ZXRpbWUuZnJvbWlzb2Zvcm1hdChzZWxmLmRhdGUoKSkpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ25hbWUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5uYW1lKG9ialsnbmFtZSddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdyZW1hcmsnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5yZW1hcmsob2JqWydyZW1hcmsnXSk7CiAgICAgICAgCiAgICAgICAgICAgIHNlbGYucmVtYXJrKCBiYXNlNjQuYjY0ZGVjb2RlKHNlbGYucmVtYXJrKCkpICk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnY2F0ZWdvcnknIGluIG9iajoKICAgICAgICAgICAgc2VsZi5jYXRlZ29yeShEZXZpY2VfQ2F0ZWdvcnkoKS5fZnJvbURvY3VtZW50KG9ialsnY2F0ZWdvcnknXSkpOwogICAgICAgIAogICAgCgogICAgCiAgICAgICAgaWYgJ2RldmljZVR5cGVfTWV0cmljcycgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmRldmljZVR5cGVfTWV0cmljcyhNZXRyaWMoKS5fZnJvbURvY3VtZW50KG9ialsnZGV2aWNlVHlwZV9NZXRyaWNzJ10pKTsKICAgIAogICAgICAgIGlmICd0eXBlX0RldmljZXMnIGluIG9iajoKICAgICAgICAgICAgc2VsZi50eXBlX0RldmljZXMoRGV2aWNlKCkuX2Zyb21Eb2N1bWVudChvYmpbJ3R5cGVfRGV2aWNlcyddKSk7CiAgICAKCiAgICAgICAgZ2MuY29sbGVjdCgpOwogICAgICAgIHJldHVybiBzZWxmOwogICAgCiAgICBkZWYgX3RvRG9jdW1lbnQoc2VsZiwgYkpTT049Tm9uZSk6CiAgICAgICAgX190b1N0cmluZyA9ICdEZXZpY2VfVHlwZTo6X3RvRG9jdW1lbnQoKTogJzsKCiAgICAgICAgcmV0ID0ge307CiAgICAgICAgaWYgc2VsZi5JZCBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJJZCJdID0gc2VsZi5JZDsKCiAgICAKICAgICAgICBpZiBzZWxmLmFjdGl2ZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbImFjdGl2ZSJdID0gc2VsZi5hY3RpdmUoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYuZW5hYmxlZCgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbImVuYWJsZWQiXSA9IHNlbGYuZW5hYmxlZCgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5jb2RlKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiY29kZSJdID0gc2VsZi5jb2RlKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLm9yZGVyKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsib3JkZXIiXSA9IHNlbGYub3JkZXIoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYuZGF0ZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbImRhdGUiXSA9IHNlbGYuZGF0ZSgpOwogICAgICAgIAogICAgICAgICAgICBpZiBpc2luc3RhbmNlKHJldFsiZGF0ZSJdLCBkYXRldGltZS5kYXRldGltZSk6CiAgICAgICAgICAgICAgICByZXRbImRhdGUiXSA9IHJldFsiZGF0ZSJdLmlzb2Zvcm1hdCgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5uYW1lKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsibmFtZSJdID0gc2VsZi5uYW1lKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLnJlbWFyaygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbInJlbWFyayJdID0gc2VsZi5yZW1hcmsoKTsKICAgICAgICAKICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShyZXRbInJlbWFyayJdLCBkaWN0KToKICAgICAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSBqc29uLmR1bXBzKHJldFsicmVtYXJrIl0pLmVuY29kZSgndXRmLTgnKTsKCiAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSAgYmFzZTY0LmI2NGVuY29kZShyZXRbInJlbWFyayJdKS5kZWNvZGUoJ3V0Zi04Jykuc3RyaXAoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYuY2F0ZWdvcnkoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJjYXRlZ29yeSJdID0gc2VsZi5jYXRlZ29yeSgpLl90b0RvY3VtZW50KCk7CiAgICAgICAgCiAgICAKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYuZGV2aWNlVHlwZV9NZXRyaWNzKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiZGV2aWNlVHlwZV9NZXRyaWNzIl0gPSBbdGEuX3RvRG9jdW1lbnQoKSBmb3IgdGEgaW4gc2VsZi5kZXZpY2VUeXBlX01ldHJpY3MoKV07CiAgICAKICAgICAgICBpZiBzZWxmLnR5cGVfRGV2aWNlcygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbInR5cGVfRGV2aWNlcyJdID0gW3RhLl90b0RvY3VtZW50KCkgZm9yIHRhIGluIHNlbGYudHlwZV9EZXZpY2VzKCldOwogICAgCgogICAgICAgIGlmIGJKU09OIGlzIG5vdCBOb25lOgogICAgICAgICAgICAjcHJpbnQoX190b1N0cmluZyArICJHT1QgSEVSRSIsIHR5cGUocmV0KSwgcmV0KTsKICAgICAgICAgICAgcmV0ID0ganNvbi5kdW1wcyhyZXQpOwogICAgICAgIGdjLmNvbGxlY3QoKTsKICAgICAgICByZXR1cm4gcmV0OwoKICAgIAogICAgZGVmIHN0b3JlKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6CiAgICAgICAgX190b1N0cmluZyA9ICdEZXZpY2VfVHlwZTo6c3RvcmUoKTogJzsKICAgICAgICAKICAgICAgICBldkpTT04gPSBOb25lOwoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBldkpTT04gPSBqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsKICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOgogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOwogICAgICAgIAoKICAgICAgICBhbnN3ZXIgPSBOb25lOwoKICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGltZSgpKSsnXS5EZXZpY2VfVHlwZS5zdG9yZSgpJykubWV0aG9kKCdzdG9yZScpLmNsYXNzTmFtZSgnRGV2aWNlX1R5cGUnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7CiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsKICAgICAgICAKICAgICAgICBnYy5jb2xsZWN0KCk7CgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsKCiAgICAgICAgCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7CiAgICAgICAgCiAgICAgICAgICAgIGFuc3dlciA9IERldmljZV9UeXBlKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOwogICAgICAgIAoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7CgoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOgogICAgICAgICAgICAKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7CgogICAgICAgICAgICAKICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7CiAgICAgICAgICAgIAoKICAgICAgICByZXR1cm4gYW5zd2VyOwoKICAgIAogICAgZGVmIGZpbmRBbGwoc2VsZiwgX19ldmVudD1Ob25lKToKICAgICAgICBfX3RvU3RyaW5nID0gJ0RldmljZV9UeXBlOjpmaW5kQWxsKCk6ICc7CiAgICAgICAgCiAgICAgICAgZXZKU09OID0gTm9uZTsKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgZXZKU09OID0ganNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7CiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoKICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsKICAgICAgICAKCiAgICAgICAgYW5zd2VyID0gTm9uZTsKCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpbWUoKSkrJ10uRGV2aWNlX1R5cGUuZmluZEFsbCgpJykubWV0aG9kKCdmaW5kQWxsJykuY2xhc3NOYW1lKCdEZXZpY2VfVHlwZScpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOwogICAgICAgIAogICAgICAgIGdjLmNvbGxlY3QoKTsKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOwoKICAgICAgICAKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsKICAgICAgICAKICAgICAgICAgICAgYW5zd2VyID0gRGV2aWNlX1R5cGUoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7CiAgICAgICAgCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsKCgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsKCiAgICAgICAgICAgIAogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsKICAgICAgICAgICAgCgogICAgICAgIHJldHVybiBhbnN3ZXI7CgogICAgCiAgICBkZWYgZmluZChzZWxmLCBfX2V2ZW50PU5vbmUpOgogICAgICAgIF9fdG9TdHJpbmcgPSAnRGV2aWNlX1R5cGU6OmZpbmQoKTogJzsKICAgICAgICAKICAgICAgICBldkpTT04gPSBOb25lOwoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBldkpTT04gPSBqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsKICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOgogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOwogICAgICAgIAoKICAgICAgICBhbnN3ZXIgPSBOb25lOwoKICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGltZSgpKSsnXS5EZXZpY2VfVHlwZS5maW5kKCknKS5tZXRob2QoJ2ZpbmQnKS5jbGFzc05hbWUoJ0RldmljZV9UeXBlJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOwogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7CiAgICAgICAgCiAgICAgICAgZ2MuY29sbGVjdCgpOwoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7CgogICAgICAgIAogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOwogICAgICAgIAogICAgICAgICAgICBhbnN3ZXIgPSBEZXZpY2VfVHlwZSgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsKICAgICAgICAKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOwoKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOwogICAgICAgICAgICAKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOwoKICAgICAgICAgICAgCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOwogICAgICAgICAgICAKCiAgICAgICAgcmV0dXJuIGFuc3dlcjsKCiAgICAKCgpjbGFzcyBNZXRyaWNfR3JvdXAoKToKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBJZD1Ob25lLCBhY3RpdmU9Tm9uZSwgZW5hYmxlZD1Ob25lLCBjb2RlPU5vbmUsIG9yZGVyPU5vbmUsIGRhdGU9Tm9uZSwgbmFtZT1Ob25lLCByZW1hcms9Tm9uZSk6CiAgICAgICAgc3VwZXIoKS5fX2luaXRfXygpOwoKICAgICAgICAjcHJpbnQoJ01ldHJpY19Hcm91cDo6X19pbml0X18oKScpOwogICAgICAgIGlmIElkIGlzIG5vdCBOb25lOgogICAgICAgICAgICBzZWxmLklkID0gSWQ7CgogICAgICAgIAogICAgICAgIHNlbGYuYWN0aXZlKGFjdGl2ZSk7CiAgICAgICAgc2VsZi5lbmFibGVkKGVuYWJsZWQpOwogICAgICAgIHNlbGYuY29kZShjb2RlKTsKICAgICAgICBzZWxmLm9yZGVyKG9yZGVyKTsKICAgICAgICBzZWxmLmRhdGUoZGF0ZSk7CiAgICAgICAgc2VsZi5uYW1lKG5hbWUpOwogICAgICAgIHNlbGYucmVtYXJrKHJlbWFyayk7CiAgICAgICAgCiAgICBJZCA9IE5vbmU7CiAgICAKICAgIAogICAgIyBhY3RpdmU6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9hY3RpdmUgPSBOb25lOwogICAgZGVmIGFjdGl2ZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fYWN0aXZlID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2FjdGl2ZTsKICAgIAogICAgIyBlbmFibGVkOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfZW5hYmxlZCA9IE5vbmU7CiAgICBkZWYgZW5hYmxlZChzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fZW5hYmxlZCA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9lbmFibGVkOwogICAgCiAgICAjIGNvZGU6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9jb2RlID0gTm9uZTsKICAgIGRlZiBjb2RlKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9jb2RlID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2NvZGU7CiAgICAKICAgICMgb3JkZXI6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9vcmRlciA9IE5vbmU7CiAgICBkZWYgb3JkZXIoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX29yZGVyID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX29yZGVyOwogICAgCiAgICAjIGRhdGU6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9kYXRlID0gTm9uZTsKICAgIGRlZiBkYXRlKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9kYXRlID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2RhdGU7CiAgICAKICAgICMgbmFtZTogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX25hbWUgPSBOb25lOwogICAgZGVmIG5hbWUoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX25hbWUgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fbmFtZTsKICAgIAogICAgIyByZW1hcms6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9yZW1hcmsgPSBOb25lOwogICAgZGVmIHJlbWFyayhzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fcmVtYXJrID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3JlbWFyazsKICAgIAogICAgCiAgICAKICAgICMgZ3JvdXBfTWV0cmljX1R5cGVzOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfZ3JvdXBfTWV0cmljX1R5cGVzID0gTm9uZTsKICAgIGRlZiBncm91cF9NZXRyaWNfVHlwZXMoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2dyb3VwX01ldHJpY19UeXBlcyA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9ncm91cF9NZXRyaWNfVHlwZXM7CiAgICAKICAgIAogICAgZGVmIF9mcm9tRG9jdW1lbnQoc2VsZiwgb2JqKToKICAgICAgICBfX3RvU3RyaW5nID0gJ01ldHJpY19Hcm91cDo6X2Zyb21Eb2N1bWVudCgpOiAnOwogICAgICAgIAogICAgICAgIGlmIG9iaiBpcyBOb25lOgogICAgICAgICAgICByZXR1cm4gc2VsZjsKCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIGJ5dGVzKToKICAgICAgICAgICAgb2JqID0gc3RyKG9iaiwgInV0Zi04Iik7CgogICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLCBzdHIpIG9yIHR5cGUob2JqKSBpcyBzdHI6CiAgICAgICAgICAgIGlmIHJlLm1hdGNoKHIiKCgoW0EtWmEtel17Myw5fTooPzpcL1wvKT8pKD86Wy07OiY9XCtcJCxcd10rQCk/W0EtWmEtejAtOS4tXSt8KD86d3d3LnxbLTs6Jj1cK1wkLFx3XStAKVtBLVphLXowLTkuLV0rKSgoPzpcL1tcK34lXC8uXHdcLV9dKik/XD8/KD86Wy1cKz0mOyVALlx3X10qKSM/KD86W1x3XSopKT8pIiwgb2JqKToKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBvYmogPSBqc29uLmxvYWRzKHVybGxpYjMuUG9vbE1hbmFnZXIoKS5yZXF1ZXN0KCdHRVQnLCBvYmopLmRhdGEuZGVjb2RlKCd1dGYtOCcpKTsKICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICBvYmogPSB7fTsKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIG9iaiA9IGpzb24ubG9hZHMob2JqKTsKICAgICAgICAKICAgICAgICBpZiBpc2luc3RhbmNlKG9iaiwgbGlzdCk6CiAgICAgICAgICAgIHJldHVybiBbTWV0cmljX0dyb3VwKCkuX2Zyb21Eb2N1bWVudChvKSBmb3IgbyBpbiBvYmpdOwogICAgICAgICAgICAKICAgICAgICBpZiBub3QgaXNpbnN0YW5jZShvYmosIChzdHIsIGJ5dGVzLCBkaWN0KSk6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAndW5oYW5kbGVkIHR5cGU6ICcgKyBzdHIodHlwZShvYmopKSk7CiAgICAgICAgICAgIHJldHVybiBvYmo7CgogICAgICAgIGlmICdJZCcgaW4gb2JqOgogICAgICAgICAgICBzZWxmLklkID0gb2JqWydJZCddOwoKICAgIAogICAgICAgIGlmICdhY3RpdmUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5hY3RpdmUob2JqWydhY3RpdmUnXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnZW5hYmxlZCcgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmVuYWJsZWQob2JqWydlbmFibGVkJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ2NvZGUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5jb2RlKG9ialsnY29kZSddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdvcmRlcicgaW4gb2JqOgogICAgICAgICAgICBzZWxmLm9yZGVyKG9ialsnb3JkZXInXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnZGF0ZScgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmRhdGUob2JqWydkYXRlJ10pOwogICAgICAgIAogICAgICAgICAgICBzZWxmLmRhdGUoZGF0ZXRpbWUuZGF0ZXRpbWUuZnJvbWlzb2Zvcm1hdChzZWxmLmRhdGUoKSkpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ25hbWUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5uYW1lKG9ialsnbmFtZSddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdyZW1hcmsnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5yZW1hcmsob2JqWydyZW1hcmsnXSk7CiAgICAgICAgCiAgICAgICAgICAgIHNlbGYucmVtYXJrKCBiYXNlNjQuYjY0ZGVjb2RlKHNlbGYucmVtYXJrKCkpICk7CiAgICAgICAgCiAgICAKCiAgICAKICAgICAgICBpZiAnZ3JvdXBfTWV0cmljX1R5cGVzJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuZ3JvdXBfTWV0cmljX1R5cGVzKE1ldHJpY19UeXBlKCkuX2Zyb21Eb2N1bWVudChvYmpbJ2dyb3VwX01ldHJpY19UeXBlcyddKSk7CiAgICAKCiAgICAgICAgZ2MuY29sbGVjdCgpOwogICAgICAgIHJldHVybiBzZWxmOwogICAgCiAgICBkZWYgX3RvRG9jdW1lbnQoc2VsZiwgYkpTT049Tm9uZSk6CiAgICAgICAgX190b1N0cmluZyA9ICdNZXRyaWNfR3JvdXA6Ol90b0RvY3VtZW50KCk6ICc7CgogICAgICAgIHJldCA9IHt9OwogICAgICAgIGlmIHNlbGYuSWQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiSWQiXSA9IHNlbGYuSWQ7CgogICAgCiAgICAgICAgaWYgc2VsZi5hY3RpdmUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJhY3RpdmUiXSA9IHNlbGYuYWN0aXZlKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLmVuYWJsZWQoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJlbmFibGVkIl0gPSBzZWxmLmVuYWJsZWQoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYuY29kZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbImNvZGUiXSA9IHNlbGYuY29kZSgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5vcmRlcigpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbIm9yZGVyIl0gPSBzZWxmLm9yZGVyKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLmRhdGUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJkYXRlIl0gPSBzZWxmLmRhdGUoKTsKICAgICAgICAKICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShyZXRbImRhdGUiXSwgZGF0ZXRpbWUuZGF0ZXRpbWUpOgogICAgICAgICAgICAgICAgcmV0WyJkYXRlIl0gPSByZXRbImRhdGUiXS5pc29mb3JtYXQoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYubmFtZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbIm5hbWUiXSA9IHNlbGYubmFtZSgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5yZW1hcmsoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IHNlbGYucmVtYXJrKCk7CiAgICAgICAgCiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UocmV0WyJyZW1hcmsiXSwgZGljdCk6CiAgICAgICAgICAgICAgICByZXRbInJlbWFyayJdID0ganNvbi5kdW1wcyhyZXRbInJlbWFyayJdKS5lbmNvZGUoJ3V0Zi04Jyk7CgogICAgICAgICAgICByZXRbInJlbWFyayJdID0gIGJhc2U2NC5iNjRlbmNvZGUocmV0WyJyZW1hcmsiXSkuZGVjb2RlKCd1dGYtOCcpLnN0cmlwKCk7CiAgICAgICAgCiAgICAKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYuZ3JvdXBfTWV0cmljX1R5cGVzKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiZ3JvdXBfTWV0cmljX1R5cGVzIl0gPSBbdGEuX3RvRG9jdW1lbnQoKSBmb3IgdGEgaW4gc2VsZi5ncm91cF9NZXRyaWNfVHlwZXMoKV07CiAgICAKCiAgICAgICAgaWYgYkpTT04gaXMgbm90IE5vbmU6CiAgICAgICAgICAgICNwcmludChfX3RvU3RyaW5nICsgIkdPVCBIRVJFIiwgdHlwZShyZXQpLCByZXQpOwogICAgICAgICAgICByZXQgPSBqc29uLmR1bXBzKHJldCk7CiAgICAgICAgZ2MuY29sbGVjdCgpOwogICAgICAgIHJldHVybiByZXQ7CgogICAgCiAgICBkZWYgc3RvcmUoc2VsZiwgX19ldmVudD1Ob25lKToKICAgICAgICBfX3RvU3RyaW5nID0gJ01ldHJpY19Hcm91cDo6c3RvcmUoKTogJzsKICAgICAgICAKICAgICAgICBldkpTT04gPSBOb25lOwoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBldkpTT04gPSBqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsKICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOgogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOwogICAgICAgIAoKICAgICAgICBhbnN3ZXIgPSBOb25lOwoKICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGltZSgpKSsnXS5NZXRyaWNfR3JvdXAuc3RvcmUoKScpLm1ldGhvZCgnc3RvcmUnKS5jbGFzc05hbWUoJ01ldHJpY19Hcm91cCcpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOwogICAgICAgIAogICAgICAgIGdjLmNvbGxlY3QoKTsKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOwoKICAgICAgICAKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsKICAgICAgICAKICAgICAgICAgICAgYW5zd2VyID0gTWV0cmljX0dyb3VwKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOwogICAgICAgIAoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7CgoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOgogICAgICAgICAgICAKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7CgogICAgICAgICAgICAKICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7CiAgICAgICAgICAgIAoKICAgICAgICByZXR1cm4gYW5zd2VyOwoKICAgIAogICAgZGVmIGZpbmRBbGwoc2VsZiwgX19ldmVudD1Ob25lKToKICAgICAgICBfX3RvU3RyaW5nID0gJ01ldHJpY19Hcm91cDo6ZmluZEFsbCgpOiAnOwogICAgICAgIAogICAgICAgIGV2SlNPTiA9IE5vbmU7CgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIGV2SlNPTiA9IGpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOwogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046CiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7CiAgICAgICAgCgogICAgICAgIGFuc3dlciA9IE5vbmU7CgogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aW1lKCkpKyddLk1ldHJpY19Hcm91cC5maW5kQWxsKCknKS5tZXRob2QoJ2ZpbmRBbGwnKS5jbGFzc05hbWUoJ01ldHJpY19Hcm91cCcpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOwogICAgICAgIAogICAgICAgIGdjLmNvbGxlY3QoKTsKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOwoKICAgICAgICAKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsKICAgICAgICAKICAgICAgICAgICAgYW5zd2VyID0gTWV0cmljX0dyb3VwKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOwogICAgICAgIAoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7CgoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOgogICAgICAgICAgICAKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7CgogICAgICAgICAgICAKICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7CiAgICAgICAgICAgIAoKICAgICAgICByZXR1cm4gYW5zd2VyOwoKICAgIAogICAgZGVmIGZpbmQoc2VsZiwgX19ldmVudD1Ob25lKToKICAgICAgICBfX3RvU3RyaW5nID0gJ01ldHJpY19Hcm91cDo6ZmluZCgpOiAnOwogICAgICAgIAogICAgICAgIGV2SlNPTiA9IE5vbmU7CgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIGV2SlNPTiA9IGpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOwogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046CiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7CiAgICAgICAgCgogICAgICAgIGFuc3dlciA9IE5vbmU7CgogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aW1lKCkpKyddLk1ldHJpY19Hcm91cC5maW5kKCknKS5tZXRob2QoJ2ZpbmQnKS5jbGFzc05hbWUoJ01ldHJpY19Hcm91cCcpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOwogICAgICAgIAogICAgICAgIGdjLmNvbGxlY3QoKTsKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOwoKICAgICAgICAKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsKICAgICAgICAKICAgICAgICAgICAgYW5zd2VyID0gTWV0cmljX0dyb3VwKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOwogICAgICAgIAoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7CgoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOgogICAgICAgICAgICAKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7CgogICAgICAgICAgICAKICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7CiAgICAgICAgICAgIAoKICAgICAgICByZXR1cm4gYW5zd2VyOwoKICAgIAoKCmNsYXNzIE1ldHJpY19UeXBlKCk6CiAgICBkZWYgX19pbml0X18oc2VsZiwgSWQ9Tm9uZSwgYWN0aXZlPU5vbmUsIGVuYWJsZWQ9Tm9uZSwgY29kZT1Ob25lLCBvcmRlcj1Ob25lLCBkYXRlPU5vbmUsIG5hbWU9Tm9uZSwgcmVtYXJrPU5vbmUsIGdyb3VwPU5vbmUpOgogICAgICAgIHN1cGVyKCkuX19pbml0X18oKTsKCiAgICAgICAgI3ByaW50KCdNZXRyaWNfVHlwZTo6X19pbml0X18oKScpOwogICAgICAgIGlmIElkIGlzIG5vdCBOb25lOgogICAgICAgICAgICBzZWxmLklkID0gSWQ7CgogICAgICAgIAogICAgICAgIHNlbGYuYWN0aXZlKGFjdGl2ZSk7CiAgICAgICAgc2VsZi5lbmFibGVkKGVuYWJsZWQpOwogICAgICAgIHNlbGYuY29kZShjb2RlKTsKICAgICAgICBzZWxmLm9yZGVyKG9yZGVyKTsKICAgICAgICBzZWxmLmRhdGUoZGF0ZSk7CiAgICAgICAgc2VsZi5uYW1lKG5hbWUpOwogICAgICAgIHNlbGYucmVtYXJrKHJlbWFyayk7CiAgICAgICAgc2VsZi5ncm91cChncm91cCk7CiAgICAgICAgCiAgICBJZCA9IE5vbmU7CiAgICAKICAgIAogICAgIyBhY3RpdmU6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9hY3RpdmUgPSBOb25lOwogICAgZGVmIGFjdGl2ZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fYWN0aXZlID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2FjdGl2ZTsKICAgIAogICAgIyBlbmFibGVkOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfZW5hYmxlZCA9IE5vbmU7CiAgICBkZWYgZW5hYmxlZChzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fZW5hYmxlZCA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9lbmFibGVkOwogICAgCiAgICAjIGNvZGU6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9jb2RlID0gTm9uZTsKICAgIGRlZiBjb2RlKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9jb2RlID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2NvZGU7CiAgICAKICAgICMgb3JkZXI6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9vcmRlciA9IE5vbmU7CiAgICBkZWYgb3JkZXIoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX29yZGVyID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX29yZGVyOwogICAgCiAgICAjIGRhdGU6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9kYXRlID0gTm9uZTsKICAgIGRlZiBkYXRlKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9kYXRlID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2RhdGU7CiAgICAKICAgICMgbmFtZTogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX25hbWUgPSBOb25lOwogICAgZGVmIG5hbWUoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX25hbWUgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fbmFtZTsKICAgIAogICAgIyByZW1hcms6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9yZW1hcmsgPSBOb25lOwogICAgZGVmIHJlbWFyayhzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fcmVtYXJrID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3JlbWFyazsKICAgIAogICAgIyBncm91cDogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX2dyb3VwID0gTm9uZTsKICAgIGRlZiBncm91cChzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fZ3JvdXAgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fZ3JvdXA7CiAgICAKICAgIAogICAgCiAgICAjIHR5cGVfTWV0cmljczogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX3R5cGVfTWV0cmljcyA9IE5vbmU7CiAgICBkZWYgdHlwZV9NZXRyaWNzKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl90eXBlX01ldHJpY3MgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fdHlwZV9NZXRyaWNzOwogICAgCiAgICAKICAgIGRlZiBfZnJvbURvY3VtZW50KHNlbGYsIG9iaik6CiAgICAgICAgX190b1N0cmluZyA9ICdNZXRyaWNfVHlwZTo6X2Zyb21Eb2N1bWVudCgpOiAnOwogICAgICAgIAogICAgICAgIGlmIG9iaiBpcyBOb25lOgogICAgICAgICAgICByZXR1cm4gc2VsZjsKCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIGJ5dGVzKToKICAgICAgICAgICAgb2JqID0gc3RyKG9iaiwgInV0Zi04Iik7CgogICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLCBzdHIpIG9yIHR5cGUob2JqKSBpcyBzdHI6CiAgICAgICAgICAgIGlmIHJlLm1hdGNoKHIiKCgoW0EtWmEtel17Myw5fTooPzpcL1wvKT8pKD86Wy07OiY9XCtcJCxcd10rQCk/W0EtWmEtejAtOS4tXSt8KD86d3d3LnxbLTs6Jj1cK1wkLFx3XStAKVtBLVphLXowLTkuLV0rKSgoPzpcL1tcK34lXC8uXHdcLV9dKik/XD8/KD86Wy1cKz0mOyVALlx3X10qKSM/KD86W1x3XSopKT8pIiwgb2JqKToKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBvYmogPSBqc29uLmxvYWRzKHVybGxpYjMuUG9vbE1hbmFnZXIoKS5yZXF1ZXN0KCdHRVQnLCBvYmopLmRhdGEuZGVjb2RlKCd1dGYtOCcpKTsKICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICBvYmogPSB7fTsKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIG9iaiA9IGpzb24ubG9hZHMob2JqKTsKICAgICAgICAKICAgICAgICBpZiBpc2luc3RhbmNlKG9iaiwgbGlzdCk6CiAgICAgICAgICAgIHJldHVybiBbTWV0cmljX1R5cGUoKS5fZnJvbURvY3VtZW50KG8pIGZvciBvIGluIG9ial07CiAgICAgICAgICAgIAogICAgICAgIGlmIG5vdCBpc2luc3RhbmNlKG9iaiwgKHN0ciwgYnl0ZXMsIGRpY3QpKToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICd1bmhhbmRsZWQgdHlwZTogJyArIHN0cih0eXBlKG9iaikpKTsKICAgICAgICAgICAgcmV0dXJuIG9iajsKCiAgICAgICAgaWYgJ0lkJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuSWQgPSBvYmpbJ0lkJ107CgogICAgCiAgICAgICAgaWYgJ2FjdGl2ZScgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmFjdGl2ZShvYmpbJ2FjdGl2ZSddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdlbmFibGVkJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuZW5hYmxlZChvYmpbJ2VuYWJsZWQnXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnY29kZScgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmNvZGUob2JqWydjb2RlJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ29yZGVyJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYub3JkZXIob2JqWydvcmRlciddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdkYXRlJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuZGF0ZShvYmpbJ2RhdGUnXSk7CiAgICAgICAgCiAgICAgICAgICAgIHNlbGYuZGF0ZShkYXRldGltZS5kYXRldGltZS5mcm9taXNvZm9ybWF0KHNlbGYuZGF0ZSgpKSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnbmFtZScgaW4gb2JqOgogICAgICAgICAgICBzZWxmLm5hbWUob2JqWyduYW1lJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ3JlbWFyaycgaW4gb2JqOgogICAgICAgICAgICBzZWxmLnJlbWFyayhvYmpbJ3JlbWFyayddKTsKICAgICAgICAKICAgICAgICAgICAgc2VsZi5yZW1hcmsoIGJhc2U2NC5iNjRkZWNvZGUoc2VsZi5yZW1hcmsoKSkgKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdncm91cCcgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmdyb3VwKE1ldHJpY19Hcm91cCgpLl9mcm9tRG9jdW1lbnQob2JqWydncm91cCddKSk7CiAgICAgICAgCiAgICAKCiAgICAKICAgICAgICBpZiAndHlwZV9NZXRyaWNzJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYudHlwZV9NZXRyaWNzKE1ldHJpYygpLl9mcm9tRG9jdW1lbnQob2JqWyd0eXBlX01ldHJpY3MnXSkpOwogICAgCgogICAgICAgIGdjLmNvbGxlY3QoKTsKICAgICAgICByZXR1cm4gc2VsZjsKICAgIAogICAgZGVmIF90b0RvY3VtZW50KHNlbGYsIGJKU09OPU5vbmUpOgogICAgICAgIF9fdG9TdHJpbmcgPSAnTWV0cmljX1R5cGU6Ol90b0RvY3VtZW50KCk6ICc7CgogICAgICAgIHJldCA9IHt9OwogICAgICAgIGlmIHNlbGYuSWQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiSWQiXSA9IHNlbGYuSWQ7CgogICAgCiAgICAgICAgaWYgc2VsZi5hY3RpdmUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJhY3RpdmUiXSA9IHNlbGYuYWN0aXZlKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLmVuYWJsZWQoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJlbmFibGVkIl0gPSBzZWxmLmVuYWJsZWQoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYuY29kZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbImNvZGUiXSA9IHNlbGYuY29kZSgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5vcmRlcigpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbIm9yZGVyIl0gPSBzZWxmLm9yZGVyKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLmRhdGUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJkYXRlIl0gPSBzZWxmLmRhdGUoKTsKICAgICAgICAKICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShyZXRbImRhdGUiXSwgZGF0ZXRpbWUuZGF0ZXRpbWUpOgogICAgICAgICAgICAgICAgcmV0WyJkYXRlIl0gPSByZXRbImRhdGUiXS5pc29mb3JtYXQoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYubmFtZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbIm5hbWUiXSA9IHNlbGYubmFtZSgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5yZW1hcmsoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IHNlbGYucmVtYXJrKCk7CiAgICAgICAgCiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UocmV0WyJyZW1hcmsiXSwgZGljdCk6CiAgICAgICAgICAgICAgICByZXRbInJlbWFyayJdID0ganNvbi5kdW1wcyhyZXRbInJlbWFyayJdKS5lbmNvZGUoJ3V0Zi04Jyk7CgogICAgICAgICAgICByZXRbInJlbWFyayJdID0gIGJhc2U2NC5iNjRlbmNvZGUocmV0WyJyZW1hcmsiXSkuZGVjb2RlKCd1dGYtOCcpLnN0cmlwKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLmdyb3VwKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiZ3JvdXAiXSA9IHNlbGYuZ3JvdXAoKS5fdG9Eb2N1bWVudCgpOwogICAgICAgIAogICAgCiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLnR5cGVfTWV0cmljcygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbInR5cGVfTWV0cmljcyJdID0gW3RhLl90b0RvY3VtZW50KCkgZm9yIHRhIGluIHNlbGYudHlwZV9NZXRyaWNzKCldOwogICAgCgogICAgICAgIGlmIGJKU09OIGlzIG5vdCBOb25lOgogICAgICAgICAgICAjcHJpbnQoX190b1N0cmluZyArICJHT1QgSEVSRSIsIHR5cGUocmV0KSwgcmV0KTsKICAgICAgICAgICAgcmV0ID0ganNvbi5kdW1wcyhyZXQpOwogICAgICAgIGdjLmNvbGxlY3QoKTsKICAgICAgICByZXR1cm4gcmV0OwoKICAgIAogICAgZGVmIHN0b3JlKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6CiAgICAgICAgX190b1N0cmluZyA9ICdNZXRyaWNfVHlwZTo6c3RvcmUoKTogJzsKICAgICAgICAKICAgICAgICBldkpTT04gPSBOb25lOwoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBldkpTT04gPSBqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsKICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOgogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOwogICAgICAgIAoKICAgICAgICBhbnN3ZXIgPSBOb25lOwoKICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGltZSgpKSsnXS5NZXRyaWNfVHlwZS5zdG9yZSgpJykubWV0aG9kKCdzdG9yZScpLmNsYXNzTmFtZSgnTWV0cmljX1R5cGUnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7CiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsKICAgICAgICAKICAgICAgICBnYy5jb2xsZWN0KCk7CgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsKCiAgICAgICAgCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7CiAgICAgICAgCiAgICAgICAgICAgIGFuc3dlciA9IE1ldHJpY19UeXBlKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOwogICAgICAgIAoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7CgoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOgogICAgICAgICAgICAKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7CgogICAgICAgICAgICAKICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7CiAgICAgICAgICAgIAoKICAgICAgICByZXR1cm4gYW5zd2VyOwoKICAgIAogICAgZGVmIGZpbmRBbGwoc2VsZiwgX19ldmVudD1Ob25lKToKICAgICAgICBfX3RvU3RyaW5nID0gJ01ldHJpY19UeXBlOjpmaW5kQWxsKCk6ICc7CiAgICAgICAgCiAgICAgICAgZXZKU09OID0gTm9uZTsKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgZXZKU09OID0ganNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7CiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoKICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsKICAgICAgICAKCiAgICAgICAgYW5zd2VyID0gTm9uZTsKCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpbWUoKSkrJ10uTWV0cmljX1R5cGUuZmluZEFsbCgpJykubWV0aG9kKCdmaW5kQWxsJykuY2xhc3NOYW1lKCdNZXRyaWNfVHlwZScpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOwogICAgICAgIAogICAgICAgIGdjLmNvbGxlY3QoKTsKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOwoKICAgICAgICAKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsKICAgICAgICAKICAgICAgICAgICAgYW5zd2VyID0gTWV0cmljX1R5cGUoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7CiAgICAgICAgCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsKCgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsKCiAgICAgICAgICAgIAogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsKICAgICAgICAgICAgCgogICAgICAgIHJldHVybiBhbnN3ZXI7CgogICAgCiAgICBkZWYgZmluZChzZWxmLCBfX2V2ZW50PU5vbmUpOgogICAgICAgIF9fdG9TdHJpbmcgPSAnTWV0cmljX1R5cGU6OmZpbmQoKTogJzsKICAgICAgICAKICAgICAgICBldkpTT04gPSBOb25lOwoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBldkpTT04gPSBqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsKICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOgogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOwogICAgICAgIAoKICAgICAgICBhbnN3ZXIgPSBOb25lOwoKICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGltZSgpKSsnXS5NZXRyaWNfVHlwZS5maW5kKCknKS5tZXRob2QoJ2ZpbmQnKS5jbGFzc05hbWUoJ01ldHJpY19UeXBlJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOwogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7CiAgICAgICAgCiAgICAgICAgZ2MuY29sbGVjdCgpOwoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7CgogICAgICAgIAogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOwogICAgICAgIAogICAgICAgICAgICBhbnN3ZXIgPSBNZXRyaWNfVHlwZSgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsKICAgICAgICAKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOwoKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOwogICAgICAgICAgICAKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOwoKICAgICAgICAgICAgCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOwogICAgICAgICAgICAKCiAgICAgICAgcmV0dXJuIGFuc3dlcjsKCiAgICAKCgpjbGFzcyBDb25maWcoKToKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBJZD1Ob25lLCBhY3RpdmU9Tm9uZSwgZW5hYmxlZD1Ob25lLCBjb2RlPU5vbmUsIG9yZGVyPU5vbmUsIGRhdGU9Tm9uZSwgbmFtZT1Ob25lLCByZW1hcms9Tm9uZSwgdmFsdWU9Tm9uZSwgc2NyaXB0PU5vbmUsIHRvb2w9Tm9uZSwgZ3JvdXA9Tm9uZSwgdHlwZT1Ob25lLCBub2RlPU5vbmUpOgogICAgICAgIHN1cGVyKCkuX19pbml0X18oKTsKCiAgICAgICAgI3ByaW50KCdDb25maWc6Ol9faW5pdF9fKCknKTsKICAgICAgICBpZiBJZCBpcyBub3QgTm9uZToKICAgICAgICAgICAgc2VsZi5JZCA9IElkOwoKICAgICAgICAKICAgICAgICBzZWxmLmFjdGl2ZShhY3RpdmUpOwogICAgICAgIHNlbGYuZW5hYmxlZChlbmFibGVkKTsKICAgICAgICBzZWxmLmNvZGUoY29kZSk7CiAgICAgICAgc2VsZi5vcmRlcihvcmRlcik7CiAgICAgICAgc2VsZi5kYXRlKGRhdGUpOwogICAgICAgIHNlbGYubmFtZShuYW1lKTsKICAgICAgICBzZWxmLnJlbWFyayhyZW1hcmspOwogICAgICAgIHNlbGYudmFsdWUodmFsdWUpOwogICAgICAgIHNlbGYuc2NyaXB0KHNjcmlwdCk7CiAgICAgICAgc2VsZi50b29sKHRvb2wpOwogICAgICAgIHNlbGYuZ3JvdXAoZ3JvdXApOwogICAgICAgIHNlbGYudHlwZSh0eXBlKTsKICAgICAgICBzZWxmLm5vZGUobm9kZSk7CiAgICAgICAgCiAgICBJZCA9IE5vbmU7CiAgICAKICAgIAogICAgIyBhY3RpdmU6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9hY3RpdmUgPSBOb25lOwogICAgZGVmIGFjdGl2ZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fYWN0aXZlID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2FjdGl2ZTsKICAgIAogICAgIyBlbmFibGVkOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfZW5hYmxlZCA9IE5vbmU7CiAgICBkZWYgZW5hYmxlZChzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fZW5hYmxlZCA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9lbmFibGVkOwogICAgCiAgICAjIGNvZGU6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9jb2RlID0gTm9uZTsKICAgIGRlZiBjb2RlKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9jb2RlID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2NvZGU7CiAgICAKICAgICMgb3JkZXI6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9vcmRlciA9IE5vbmU7CiAgICBkZWYgb3JkZXIoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX29yZGVyID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX29yZGVyOwogICAgCiAgICAjIGRhdGU6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9kYXRlID0gTm9uZTsKICAgIGRlZiBkYXRlKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9kYXRlID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2RhdGU7CiAgICAKICAgICMgbmFtZTogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX25hbWUgPSBOb25lOwogICAgZGVmIG5hbWUoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX25hbWUgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fbmFtZTsKICAgIAogICAgIyByZW1hcms6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9yZW1hcmsgPSBOb25lOwogICAgZGVmIHJlbWFyayhzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fcmVtYXJrID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3JlbWFyazsKICAgIAogICAgIyB2YWx1ZTogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX3ZhbHVlID0gTm9uZTsKICAgIGRlZiB2YWx1ZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fdmFsdWUgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fdmFsdWU7CiAgICAKICAgICMgc2NyaXB0OiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfc2NyaXB0ID0gTm9uZTsKICAgIGRlZiBzY3JpcHQoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX3NjcmlwdCA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9zY3JpcHQ7CiAgICAKICAgICMgdG9vbDogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX3Rvb2wgPSBOb25lOwogICAgZGVmIHRvb2woc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX3Rvb2wgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fdG9vbDsKICAgIAogICAgIyBncm91cDogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX2dyb3VwID0gTm9uZTsKICAgIGRlZiBncm91cChzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fZ3JvdXAgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fZ3JvdXA7CiAgICAKICAgICMgdHlwZTogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX3R5cGUgPSBOb25lOwogICAgZGVmIHR5cGUoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX3R5cGUgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fdHlwZTsKICAgIAogICAgIyBub2RlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfbm9kZSA9IE5vbmU7CiAgICBkZWYgbm9kZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fbm9kZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9ub2RlOwogICAgCiAgICAKICAgIAogICAgCiAgICBkZWYgX2Zyb21Eb2N1bWVudChzZWxmLCBvYmopOgogICAgICAgIF9fdG9TdHJpbmcgPSAnQ29uZmlnOjpfZnJvbURvY3VtZW50KCk6ICc7CiAgICAgICAgCiAgICAgICAgaWYgb2JqIGlzIE5vbmU6CiAgICAgICAgICAgIHJldHVybiBzZWxmOwoKICAgICAgICBpZiBpc2luc3RhbmNlKG9iaiwgYnl0ZXMpOgogICAgICAgICAgICBvYmogPSBzdHIob2JqLCAidXRmLTgiKTsKCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIHN0cikgb3IgdHlwZShvYmopIGlzIHN0cjoKICAgICAgICAgICAgaWYgcmUubWF0Y2gociIoKChbQS1aYS16XXszLDl9Oig/OlwvXC8pPykoPzpbLTs6Jj1cK1wkLFx3XStAKT9bQS1aYS16MC05Li1dK3woPzp3d3cufFstOzomPVwrXCQsXHddK0ApW0EtWmEtejAtOS4tXSspKCg/OlwvW1wrfiVcLy5cd1wtX10qKT9cPz8oPzpbLVwrPSY7JUAuXHdfXSopIz8oPzpbXHddKikpPykiLCBvYmopOgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIG9iaiA9IGpzb24ubG9hZHModXJsbGliMy5Qb29sTWFuYWdlcigpLnJlcXVlc3QoJ0dFVCcsIG9iaikuZGF0YS5kZWNvZGUoJ3V0Zi04JykpOwogICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgIG9iaiA9IHt9OwogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgb2JqID0ganNvbi5sb2FkcyhvYmopOwogICAgICAgIAogICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLCBsaXN0KToKICAgICAgICAgICAgcmV0dXJuIFtDb25maWcoKS5fZnJvbURvY3VtZW50KG8pIGZvciBvIGluIG9ial07CiAgICAgICAgICAgIAogICAgICAgIGlmIG5vdCBpc2luc3RhbmNlKG9iaiwgKHN0ciwgYnl0ZXMsIGRpY3QpKToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICd1bmhhbmRsZWQgdHlwZTogJyArIHN0cih0eXBlKG9iaikpKTsKICAgICAgICAgICAgcmV0dXJuIG9iajsKCiAgICAgICAgaWYgJ0lkJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuSWQgPSBvYmpbJ0lkJ107CgogICAgCiAgICAgICAgaWYgJ2FjdGl2ZScgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmFjdGl2ZShvYmpbJ2FjdGl2ZSddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdlbmFibGVkJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuZW5hYmxlZChvYmpbJ2VuYWJsZWQnXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnY29kZScgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmNvZGUob2JqWydjb2RlJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ29yZGVyJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYub3JkZXIob2JqWydvcmRlciddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdkYXRlJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuZGF0ZShvYmpbJ2RhdGUnXSk7CiAgICAgICAgCiAgICAgICAgICAgIHNlbGYuZGF0ZShkYXRldGltZS5kYXRldGltZS5mcm9taXNvZm9ybWF0KHNlbGYuZGF0ZSgpKSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnbmFtZScgaW4gb2JqOgogICAgICAgICAgICBzZWxmLm5hbWUob2JqWyduYW1lJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ3JlbWFyaycgaW4gb2JqOgogICAgICAgICAgICBzZWxmLnJlbWFyayhvYmpbJ3JlbWFyayddKTsKICAgICAgICAKICAgICAgICAgICAgc2VsZi5yZW1hcmsoIGJhc2U2NC5iNjRkZWNvZGUoc2VsZi5yZW1hcmsoKSkgKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICd2YWx1ZScgaW4gb2JqOgogICAgICAgICAgICBzZWxmLnZhbHVlKG9ialsndmFsdWUnXSk7CiAgICAgICAgCiAgICAgICAgICAgIHNlbGYudmFsdWUoIGJhc2U2NC5iNjRkZWNvZGUoc2VsZi52YWx1ZSgpKSApOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ3NjcmlwdCcgaW4gb2JqOgogICAgICAgICAgICBzZWxmLnNjcmlwdChvYmpbJ3NjcmlwdCddKTsKICAgICAgICAKICAgICAgICAgICAgc2VsZi5zY3JpcHQoIGJhc2U2NC5iNjRkZWNvZGUoc2VsZi5zY3JpcHQoKSkgKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICd0b29sJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYudG9vbChUb29sKCkuX2Zyb21Eb2N1bWVudChvYmpbJ3Rvb2wnXSkpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ2dyb3VwJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuZ3JvdXAoQ29uZmlnX0dyb3VwKCkuX2Zyb21Eb2N1bWVudChvYmpbJ2dyb3VwJ10pKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICd0eXBlJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYudHlwZShUb29sX1R5cGUoKS5fZnJvbURvY3VtZW50KG9ialsndHlwZSddKSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnbm9kZScgaW4gb2JqOgogICAgICAgICAgICBzZWxmLm5vZGUoTm9kZSgpLl9mcm9tRG9jdW1lbnQob2JqWydub2RlJ10pKTsKICAgICAgICAKICAgIAoKICAgIAoKICAgICAgICBnYy5jb2xsZWN0KCk7CiAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAKICAgIGRlZiBfdG9Eb2N1bWVudChzZWxmLCBiSlNPTj1Ob25lKToKICAgICAgICBfX3RvU3RyaW5nID0gJ0NvbmZpZzo6X3RvRG9jdW1lbnQoKTogJzsKCiAgICAgICAgcmV0ID0ge307CiAgICAgICAgaWYgc2VsZi5JZCBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJJZCJdID0gc2VsZi5JZDsKCiAgICAKICAgICAgICBpZiBzZWxmLmFjdGl2ZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbImFjdGl2ZSJdID0gc2VsZi5hY3RpdmUoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYuZW5hYmxlZCgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbImVuYWJsZWQiXSA9IHNlbGYuZW5hYmxlZCgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5jb2RlKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiY29kZSJdID0gc2VsZi5jb2RlKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLm9yZGVyKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsib3JkZXIiXSA9IHNlbGYub3JkZXIoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYuZGF0ZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbImRhdGUiXSA9IHNlbGYuZGF0ZSgpOwogICAgICAgIAogICAgICAgICAgICBpZiBpc2luc3RhbmNlKHJldFsiZGF0ZSJdLCBkYXRldGltZS5kYXRldGltZSk6CiAgICAgICAgICAgICAgICByZXRbImRhdGUiXSA9IHJldFsiZGF0ZSJdLmlzb2Zvcm1hdCgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5uYW1lKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsibmFtZSJdID0gc2VsZi5uYW1lKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLnJlbWFyaygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbInJlbWFyayJdID0gc2VsZi5yZW1hcmsoKTsKICAgICAgICAKICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShyZXRbInJlbWFyayJdLCBkaWN0KToKICAgICAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSBqc29uLmR1bXBzKHJldFsicmVtYXJrIl0pLmVuY29kZSgndXRmLTgnKTsKCiAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSAgYmFzZTY0LmI2NGVuY29kZShyZXRbInJlbWFyayJdKS5kZWNvZGUoJ3V0Zi04Jykuc3RyaXAoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYudmFsdWUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJ2YWx1ZSJdID0gc2VsZi52YWx1ZSgpOwogICAgICAgIAogICAgICAgICAgICBpZiBpc2luc3RhbmNlKHJldFsidmFsdWUiXSwgZGljdCk6CiAgICAgICAgICAgICAgICByZXRbInZhbHVlIl0gPSBqc29uLmR1bXBzKHJldFsidmFsdWUiXSkuZW5jb2RlKCd1dGYtOCcpOwoKICAgICAgICAgICAgcmV0WyJ2YWx1ZSJdID0gIGJhc2U2NC5iNjRlbmNvZGUocmV0WyJ2YWx1ZSJdKS5kZWNvZGUoJ3V0Zi04Jykuc3RyaXAoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYuc2NyaXB0KCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsic2NyaXB0Il0gPSBzZWxmLnNjcmlwdCgpOwogICAgICAgIAogICAgICAgICAgICBpZiBpc2luc3RhbmNlKHJldFsic2NyaXB0Il0sIGRpY3QpOgogICAgICAgICAgICAgICAgcmV0WyJzY3JpcHQiXSA9IGpzb24uZHVtcHMocmV0WyJzY3JpcHQiXSkuZW5jb2RlKCd1dGYtOCcpOwoKICAgICAgICAgICAgcmV0WyJzY3JpcHQiXSA9ICBiYXNlNjQuYjY0ZW5jb2RlKHJldFsic2NyaXB0Il0pLmRlY29kZSgndXRmLTgnKS5zdHJpcCgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi50b29sKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsidG9vbCJdID0gc2VsZi50b29sKCkuX3RvRG9jdW1lbnQoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYuZ3JvdXAoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJncm91cCJdID0gc2VsZi5ncm91cCgpLl90b0RvY3VtZW50KCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLnR5cGUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJ0eXBlIl0gPSBzZWxmLnR5cGUoKS5fdG9Eb2N1bWVudCgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5ub2RlKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsibm9kZSJdID0gc2VsZi5ub2RlKCkuX3RvRG9jdW1lbnQoKTsKICAgICAgICAKICAgIAogICAgICAgIAogICAgCgogICAgICAgIGlmIGJKU09OIGlzIG5vdCBOb25lOgogICAgICAgICAgICAjcHJpbnQoX190b1N0cmluZyArICJHT1QgSEVSRSIsIHR5cGUocmV0KSwgcmV0KTsKICAgICAgICAgICAgcmV0ID0ganNvbi5kdW1wcyhyZXQpOwogICAgICAgIGdjLmNvbGxlY3QoKTsKICAgICAgICByZXR1cm4gcmV0OwoKICAgIAogICAgZGVmIHN0b3JlKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6CiAgICAgICAgX190b1N0cmluZyA9ICdDb25maWc6OnN0b3JlKCk6ICc7CiAgICAgICAgCiAgICAgICAgZXZKU09OID0gTm9uZTsKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgZXZKU09OID0ganNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7CiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoKICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsKICAgICAgICAKCiAgICAgICAgYW5zd2VyID0gTm9uZTsKCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpbWUoKSkrJ10uQ29uZmlnLnN0b3JlKCknKS5tZXRob2QoJ3N0b3JlJykuY2xhc3NOYW1lKCdDb25maWcnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7CiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsKICAgICAgICAKICAgICAgICBnYy5jb2xsZWN0KCk7CgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsKCiAgICAgICAgCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7CiAgICAgICAgCiAgICAgICAgICAgIGFuc3dlciA9IENvbmZpZygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsKICAgICAgICAKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOwoKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOwogICAgICAgICAgICAKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOwoKICAgICAgICAgICAgCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOwogICAgICAgICAgICAKCiAgICAgICAgcmV0dXJuIGFuc3dlcjsKCiAgICAKICAgIGRlZiBmaW5kQWxsKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6CiAgICAgICAgX190b1N0cmluZyA9ICdDb25maWc6OmZpbmRBbGwoKTogJzsKICAgICAgICAKICAgICAgICBldkpTT04gPSBOb25lOwoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBldkpTT04gPSBqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsKICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOgogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOwogICAgICAgIAoKICAgICAgICBhbnN3ZXIgPSBOb25lOwoKICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGltZSgpKSsnXS5Db25maWcuZmluZEFsbCgpJykubWV0aG9kKCdmaW5kQWxsJykuY2xhc3NOYW1lKCdDb25maWcnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7CiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsKICAgICAgICAKICAgICAgICBnYy5jb2xsZWN0KCk7CgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsKCiAgICAgICAgCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7CiAgICAgICAgCiAgICAgICAgICAgIGFuc3dlciA9IENvbmZpZygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsKICAgICAgICAKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOwoKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOwogICAgICAgICAgICAKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOwoKICAgICAgICAgICAgCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOwogICAgICAgICAgICAKCiAgICAgICAgcmV0dXJuIGFuc3dlcjsKCiAgICAKICAgIGRlZiBmaW5kKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6CiAgICAgICAgX190b1N0cmluZyA9ICdDb25maWc6OmZpbmQoKTogJzsKICAgICAgICAKICAgICAgICBldkpTT04gPSBOb25lOwoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBldkpTT04gPSBqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsKICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOgogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOwogICAgICAgIAoKICAgICAgICBhbnN3ZXIgPSBOb25lOwoKICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGltZSgpKSsnXS5Db25maWcuZmluZCgpJykubWV0aG9kKCdmaW5kJykuY2xhc3NOYW1lKCdDb25maWcnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7CiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsKICAgICAgICAKICAgICAgICBnYy5jb2xsZWN0KCk7CgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsKCiAgICAgICAgCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7CiAgICAgICAgCiAgICAgICAgICAgIGFuc3dlciA9IENvbmZpZygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsKICAgICAgICAKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOwoKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOwogICAgICAgICAgICAKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOwoKICAgICAgICAgICAgCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOwogICAgICAgICAgICAKCiAgICAgICAgcmV0dXJuIGFuc3dlcjsKCiAgICAKCgpjbGFzcyBUb29sKCk6CiAgICBkZWYgX19pbml0X18oc2VsZiwgSWQ9Tm9uZSwgYWN0aXZlPU5vbmUsIGVuYWJsZWQ9Tm9uZSwgY29kZT1Ob25lLCBvcmRlcj1Ob25lLCBkYXRlPU5vbmUsIG5hbWU9Tm9uZSwgcmVtYXJrPU5vbmUsIHR5cGU9Tm9uZSk6CiAgICAgICAgc3VwZXIoKS5fX2luaXRfXygpOwoKICAgICAgICAjcHJpbnQoJ1Rvb2w6Ol9faW5pdF9fKCknKTsKICAgICAgICBpZiBJZCBpcyBub3QgTm9uZToKICAgICAgICAgICAgc2VsZi5JZCA9IElkOwoKICAgICAgICAKICAgICAgICBzZWxmLmFjdGl2ZShhY3RpdmUpOwogICAgICAgIHNlbGYuZW5hYmxlZChlbmFibGVkKTsKICAgICAgICBzZWxmLmNvZGUoY29kZSk7CiAgICAgICAgc2VsZi5vcmRlcihvcmRlcik7CiAgICAgICAgc2VsZi5kYXRlKGRhdGUpOwogICAgICAgIHNlbGYubmFtZShuYW1lKTsKICAgICAgICBzZWxmLnJlbWFyayhyZW1hcmspOwogICAgICAgIHNlbGYudHlwZSh0eXBlKTsKICAgICAgICAKICAgIElkID0gTm9uZTsKICAgIAogICAgCiAgICAjIGFjdGl2ZTogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX2FjdGl2ZSA9IE5vbmU7CiAgICBkZWYgYWN0aXZlKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9hY3RpdmUgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fYWN0aXZlOwogICAgCiAgICAjIGVuYWJsZWQ6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9lbmFibGVkID0gTm9uZTsKICAgIGRlZiBlbmFibGVkKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9lbmFibGVkID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2VuYWJsZWQ7CiAgICAKICAgICMgY29kZTogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX2NvZGUgPSBOb25lOwogICAgZGVmIGNvZGUoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2NvZGUgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fY29kZTsKICAgIAogICAgIyBvcmRlcjogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX29yZGVyID0gTm9uZTsKICAgIGRlZiBvcmRlcihzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fb3JkZXIgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fb3JkZXI7CiAgICAKICAgICMgZGF0ZTogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX2RhdGUgPSBOb25lOwogICAgZGVmIGRhdGUoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2RhdGUgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fZGF0ZTsKICAgIAogICAgIyBuYW1lOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfbmFtZSA9IE5vbmU7CiAgICBkZWYgbmFtZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fbmFtZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9uYW1lOwogICAgCiAgICAjIHJlbWFyazogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX3JlbWFyayA9IE5vbmU7CiAgICBkZWYgcmVtYXJrKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9yZW1hcmsgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fcmVtYXJrOwogICAgCiAgICAjIHR5cGU6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF90eXBlID0gTm9uZTsKICAgIGRlZiB0eXBlKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl90eXBlID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3R5cGU7CiAgICAKICAgIAogICAgCiAgICAjIHRvb2xfQ29uZmlnczogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX3Rvb2xfQ29uZmlncyA9IE5vbmU7CiAgICBkZWYgdG9vbF9Db25maWdzKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl90b29sX0NvbmZpZ3MgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fdG9vbF9Db25maWdzOwogICAgCiAgICAjIHRvb2xfTWFwcGluZ3M6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF90b29sX01hcHBpbmdzID0gTm9uZTsKICAgIGRlZiB0b29sX01hcHBpbmdzKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl90b29sX01hcHBpbmdzID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3Rvb2xfTWFwcGluZ3M7CiAgICAKICAgIAogICAgZGVmIF9mcm9tRG9jdW1lbnQoc2VsZiwgb2JqKToKICAgICAgICBfX3RvU3RyaW5nID0gJ1Rvb2w6Ol9mcm9tRG9jdW1lbnQoKTogJzsKICAgICAgICAKICAgICAgICBpZiBvYmogaXMgTm9uZToKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CgogICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLCBieXRlcyk6CiAgICAgICAgICAgIG9iaiA9IHN0cihvYmosICJ1dGYtOCIpOwoKICAgICAgICBpZiBpc2luc3RhbmNlKG9iaiwgc3RyKSBvciB0eXBlKG9iaikgaXMgc3RyOgogICAgICAgICAgICBpZiByZS5tYXRjaChyIigoKFtBLVphLXpdezMsOX06KD86XC9cLyk/KSg/OlstOzomPVwrXCQsXHddK0ApP1tBLVphLXowLTkuLV0rfCg/Ond3dy58Wy07OiY9XCtcJCxcd10rQClbQS1aYS16MC05Li1dKykoKD86XC9bXCt+JVwvLlx3XC1fXSopP1w/Pyg/OlstXCs9JjslQC5cd19dKikjPyg/Oltcd10qKSk/KSIsIG9iaik6CiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgb2JqID0ganNvbi5sb2Fkcyh1cmxsaWIzLlBvb2xNYW5hZ2VyKCkucmVxdWVzdCgnR0VUJywgb2JqKS5kYXRhLmRlY29kZSgndXRmLTgnKSk7CiAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgb2JqID0ge307CiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBvYmogPSBqc29uLmxvYWRzKG9iaik7CiAgICAgICAgCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIGxpc3QpOgogICAgICAgICAgICByZXR1cm4gW1Rvb2woKS5fZnJvbURvY3VtZW50KG8pIGZvciBvIGluIG9ial07CiAgICAgICAgICAgIAogICAgICAgIGlmIG5vdCBpc2luc3RhbmNlKG9iaiwgKHN0ciwgYnl0ZXMsIGRpY3QpKToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICd1bmhhbmRsZWQgdHlwZTogJyArIHN0cih0eXBlKG9iaikpKTsKICAgICAgICAgICAgcmV0dXJuIG9iajsKCiAgICAgICAgaWYgJ0lkJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuSWQgPSBvYmpbJ0lkJ107CgogICAgCiAgICAgICAgaWYgJ2FjdGl2ZScgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmFjdGl2ZShvYmpbJ2FjdGl2ZSddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdlbmFibGVkJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuZW5hYmxlZChvYmpbJ2VuYWJsZWQnXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnY29kZScgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmNvZGUob2JqWydjb2RlJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ29yZGVyJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYub3JkZXIob2JqWydvcmRlciddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdkYXRlJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuZGF0ZShvYmpbJ2RhdGUnXSk7CiAgICAgICAgCiAgICAgICAgICAgIHNlbGYuZGF0ZShkYXRldGltZS5kYXRldGltZS5mcm9taXNvZm9ybWF0KHNlbGYuZGF0ZSgpKSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnbmFtZScgaW4gb2JqOgogICAgICAgICAgICBzZWxmLm5hbWUob2JqWyduYW1lJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ3JlbWFyaycgaW4gb2JqOgogICAgICAgICAgICBzZWxmLnJlbWFyayhvYmpbJ3JlbWFyayddKTsKICAgICAgICAKICAgICAgICAgICAgc2VsZi5yZW1hcmsoIGJhc2U2NC5iNjRkZWNvZGUoc2VsZi5yZW1hcmsoKSkgKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICd0eXBlJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYudHlwZShUb29sX1R5cGUoKS5fZnJvbURvY3VtZW50KG9ialsndHlwZSddKSk7CiAgICAgICAgCiAgICAKCiAgICAKICAgICAgICBpZiAndG9vbF9Db25maWdzJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYudG9vbF9Db25maWdzKENvbmZpZygpLl9mcm9tRG9jdW1lbnQob2JqWyd0b29sX0NvbmZpZ3MnXSkpOwogICAgCiAgICAgICAgaWYgJ3Rvb2xfTWFwcGluZ3MnIGluIG9iajoKICAgICAgICAgICAgc2VsZi50b29sX01hcHBpbmdzKE1hcHBpbmcoKS5fZnJvbURvY3VtZW50KG9ialsndG9vbF9NYXBwaW5ncyddKSk7CiAgICAKCiAgICAgICAgZ2MuY29sbGVjdCgpOwogICAgICAgIHJldHVybiBzZWxmOwogICAgCiAgICBkZWYgX3RvRG9jdW1lbnQoc2VsZiwgYkpTT049Tm9uZSk6CiAgICAgICAgX190b1N0cmluZyA9ICdUb29sOjpfdG9Eb2N1bWVudCgpOiAnOwoKICAgICAgICByZXQgPSB7fTsKICAgICAgICBpZiBzZWxmLklkIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbIklkIl0gPSBzZWxmLklkOwoKICAgIAogICAgICAgIGlmIHNlbGYuYWN0aXZlKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiYWN0aXZlIl0gPSBzZWxmLmFjdGl2ZSgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5lbmFibGVkKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiZW5hYmxlZCJdID0gc2VsZi5lbmFibGVkKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLmNvZGUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJjb2RlIl0gPSBzZWxmLmNvZGUoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYub3JkZXIoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJvcmRlciJdID0gc2VsZi5vcmRlcigpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5kYXRlKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiZGF0ZSJdID0gc2VsZi5kYXRlKCk7CiAgICAgICAgCiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UocmV0WyJkYXRlIl0sIGRhdGV0aW1lLmRhdGV0aW1lKToKICAgICAgICAgICAgICAgIHJldFsiZGF0ZSJdID0gcmV0WyJkYXRlIl0uaXNvZm9ybWF0KCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLm5hbWUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJuYW1lIl0gPSBzZWxmLm5hbWUoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYucmVtYXJrKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSBzZWxmLnJlbWFyaygpOwogICAgICAgIAogICAgICAgICAgICBpZiBpc2luc3RhbmNlKHJldFsicmVtYXJrIl0sIGRpY3QpOgogICAgICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IGpzb24uZHVtcHMocmV0WyJyZW1hcmsiXSkuZW5jb2RlKCd1dGYtOCcpOwoKICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9ICBiYXNlNjQuYjY0ZW5jb2RlKHJldFsicmVtYXJrIl0pLmRlY29kZSgndXRmLTgnKS5zdHJpcCgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi50eXBlKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsidHlwZSJdID0gc2VsZi50eXBlKCkuX3RvRG9jdW1lbnQoKTsKICAgICAgICAKICAgIAogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi50b29sX0NvbmZpZ3MoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJ0b29sX0NvbmZpZ3MiXSA9IFt0YS5fdG9Eb2N1bWVudCgpIGZvciB0YSBpbiBzZWxmLnRvb2xfQ29uZmlncygpXTsKICAgIAogICAgICAgIGlmIHNlbGYudG9vbF9NYXBwaW5ncygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbInRvb2xfTWFwcGluZ3MiXSA9IFt0YS5fdG9Eb2N1bWVudCgpIGZvciB0YSBpbiBzZWxmLnRvb2xfTWFwcGluZ3MoKV07CiAgICAKCiAgICAgICAgaWYgYkpTT04gaXMgbm90IE5vbmU6CiAgICAgICAgICAgICNwcmludChfX3RvU3RyaW5nICsgIkdPVCBIRVJFIiwgdHlwZShyZXQpLCByZXQpOwogICAgICAgICAgICByZXQgPSBqc29uLmR1bXBzKHJldCk7CiAgICAgICAgZ2MuY29sbGVjdCgpOwogICAgICAgIHJldHVybiByZXQ7CgogICAgCiAgICBkZWYgc3RvcmUoc2VsZiwgX19ldmVudD1Ob25lKToKICAgICAgICBfX3RvU3RyaW5nID0gJ1Rvb2w6OnN0b3JlKCk6ICc7CiAgICAgICAgCiAgICAgICAgZXZKU09OID0gTm9uZTsKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgZXZKU09OID0ganNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7CiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoKICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsKICAgICAgICAKCiAgICAgICAgYW5zd2VyID0gTm9uZTsKCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpbWUoKSkrJ10uVG9vbC5zdG9yZSgpJykubWV0aG9kKCdzdG9yZScpLmNsYXNzTmFtZSgnVG9vbCcpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOwogICAgICAgIAogICAgICAgIGdjLmNvbGxlY3QoKTsKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOwoKICAgICAgICAKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsKICAgICAgICAKICAgICAgICAgICAgYW5zd2VyID0gVG9vbCgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsKICAgICAgICAKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOwoKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOwogICAgICAgICAgICAKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOwoKICAgICAgICAgICAgCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOwogICAgICAgICAgICAKCiAgICAgICAgcmV0dXJuIGFuc3dlcjsKCiAgICAKICAgIGRlZiBmaW5kQWxsKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6CiAgICAgICAgX190b1N0cmluZyA9ICdUb29sOjpmaW5kQWxsKCk6ICc7CiAgICAgICAgCiAgICAgICAgZXZKU09OID0gTm9uZTsKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgZXZKU09OID0ganNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7CiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoKICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsKICAgICAgICAKCiAgICAgICAgYW5zd2VyID0gTm9uZTsKCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpbWUoKSkrJ10uVG9vbC5maW5kQWxsKCknKS5tZXRob2QoJ2ZpbmRBbGwnKS5jbGFzc05hbWUoJ1Rvb2wnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7CiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsKICAgICAgICAKICAgICAgICBnYy5jb2xsZWN0KCk7CgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsKCiAgICAgICAgCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7CiAgICAgICAgCiAgICAgICAgICAgIGFuc3dlciA9IFRvb2woKS5fZnJvbURvY3VtZW50KGV2SlNPTik7CiAgICAgICAgCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsKCgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsKCiAgICAgICAgICAgIAogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsKICAgICAgICAgICAgCgogICAgICAgIHJldHVybiBhbnN3ZXI7CgogICAgCiAgICBkZWYgZmluZChzZWxmLCBfX2V2ZW50PU5vbmUpOgogICAgICAgIF9fdG9TdHJpbmcgPSAnVG9vbDo6ZmluZCgpOiAnOwogICAgICAgIAogICAgICAgIGV2SlNPTiA9IE5vbmU7CgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIGV2SlNPTiA9IGpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOwogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046CiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7CiAgICAgICAgCgogICAgICAgIGFuc3dlciA9IE5vbmU7CgogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aW1lKCkpKyddLlRvb2wuZmluZCgpJykubWV0aG9kKCdmaW5kJykuY2xhc3NOYW1lKCdUb29sJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOwogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7CiAgICAgICAgCiAgICAgICAgZ2MuY29sbGVjdCgpOwoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7CgogICAgICAgIAogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOwogICAgICAgIAogICAgICAgICAgICBhbnN3ZXIgPSBUb29sKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOwogICAgICAgIAoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7CgoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOgogICAgICAgICAgICAKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7CgogICAgICAgICAgICAKICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7CiAgICAgICAgICAgIAoKICAgICAgICByZXR1cm4gYW5zd2VyOwoKICAgIAoKCmNsYXNzIENvbmZpZ19Hcm91cCgpOgogICAgZGVmIF9faW5pdF9fKHNlbGYsIElkPU5vbmUsIGFjdGl2ZT1Ob25lLCBlbmFibGVkPU5vbmUsIGNvZGU9Tm9uZSwgb3JkZXI9Tm9uZSwgZGF0ZT1Ob25lLCBuYW1lPU5vbmUsIHJlbWFyaz1Ob25lKToKICAgICAgICBzdXBlcigpLl9faW5pdF9fKCk7CgogICAgICAgICNwcmludCgnQ29uZmlnX0dyb3VwOjpfX2luaXRfXygpJyk7CiAgICAgICAgaWYgSWQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHNlbGYuSWQgPSBJZDsKCiAgICAgICAgCiAgICAgICAgc2VsZi5hY3RpdmUoYWN0aXZlKTsKICAgICAgICBzZWxmLmVuYWJsZWQoZW5hYmxlZCk7CiAgICAgICAgc2VsZi5jb2RlKGNvZGUpOwogICAgICAgIHNlbGYub3JkZXIob3JkZXIpOwogICAgICAgIHNlbGYuZGF0ZShkYXRlKTsKICAgICAgICBzZWxmLm5hbWUobmFtZSk7CiAgICAgICAgc2VsZi5yZW1hcmsocmVtYXJrKTsKICAgICAgICAKICAgIElkID0gTm9uZTsKICAgIAogICAgCiAgICAjIGFjdGl2ZTogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX2FjdGl2ZSA9IE5vbmU7CiAgICBkZWYgYWN0aXZlKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9hY3RpdmUgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fYWN0aXZlOwogICAgCiAgICAjIGVuYWJsZWQ6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9lbmFibGVkID0gTm9uZTsKICAgIGRlZiBlbmFibGVkKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9lbmFibGVkID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2VuYWJsZWQ7CiAgICAKICAgICMgY29kZTogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX2NvZGUgPSBOb25lOwogICAgZGVmIGNvZGUoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2NvZGUgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fY29kZTsKICAgIAogICAgIyBvcmRlcjogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX29yZGVyID0gTm9uZTsKICAgIGRlZiBvcmRlcihzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fb3JkZXIgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fb3JkZXI7CiAgICAKICAgICMgZGF0ZTogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX2RhdGUgPSBOb25lOwogICAgZGVmIGRhdGUoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2RhdGUgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fZGF0ZTsKICAgIAogICAgIyBuYW1lOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfbmFtZSA9IE5vbmU7CiAgICBkZWYgbmFtZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fbmFtZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9uYW1lOwogICAgCiAgICAjIHJlbWFyazogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX3JlbWFyayA9IE5vbmU7CiAgICBkZWYgcmVtYXJrKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9yZW1hcmsgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fcmVtYXJrOwogICAgCiAgICAKICAgIAogICAgIyBncm91cF9Db25maWdzOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfZ3JvdXBfQ29uZmlncyA9IE5vbmU7CiAgICBkZWYgZ3JvdXBfQ29uZmlncyhzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fZ3JvdXBfQ29uZmlncyA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9ncm91cF9Db25maWdzOwogICAgCiAgICAjIGdyb3VwX01hcHBpbmdzOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfZ3JvdXBfTWFwcGluZ3MgPSBOb25lOwogICAgZGVmIGdyb3VwX01hcHBpbmdzKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9ncm91cF9NYXBwaW5ncyA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9ncm91cF9NYXBwaW5nczsKICAgIAogICAgCiAgICBkZWYgX2Zyb21Eb2N1bWVudChzZWxmLCBvYmopOgogICAgICAgIF9fdG9TdHJpbmcgPSAnQ29uZmlnX0dyb3VwOjpfZnJvbURvY3VtZW50KCk6ICc7CiAgICAgICAgCiAgICAgICAgaWYgb2JqIGlzIE5vbmU6CiAgICAgICAgICAgIHJldHVybiBzZWxmOwoKICAgICAgICBpZiBpc2luc3RhbmNlKG9iaiwgYnl0ZXMpOgogICAgICAgICAgICBvYmogPSBzdHIob2JqLCAidXRmLTgiKTsKCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIHN0cikgb3IgdHlwZShvYmopIGlzIHN0cjoKICAgICAgICAgICAgaWYgcmUubWF0Y2gociIoKChbQS1aYS16XXszLDl9Oig/OlwvXC8pPykoPzpbLTs6Jj1cK1wkLFx3XStAKT9bQS1aYS16MC05Li1dK3woPzp3d3cufFstOzomPVwrXCQsXHddK0ApW0EtWmEtejAtOS4tXSspKCg/OlwvW1wrfiVcLy5cd1wtX10qKT9cPz8oPzpbLVwrPSY7JUAuXHdfXSopIz8oPzpbXHddKikpPykiLCBvYmopOgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIG9iaiA9IGpzb24ubG9hZHModXJsbGliMy5Qb29sTWFuYWdlcigpLnJlcXVlc3QoJ0dFVCcsIG9iaikuZGF0YS5kZWNvZGUoJ3V0Zi04JykpOwogICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgIG9iaiA9IHt9OwogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgb2JqID0ganNvbi5sb2FkcyhvYmopOwogICAgICAgIAogICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLCBsaXN0KToKICAgICAgICAgICAgcmV0dXJuIFtDb25maWdfR3JvdXAoKS5fZnJvbURvY3VtZW50KG8pIGZvciBvIGluIG9ial07CiAgICAgICAgICAgIAogICAgICAgIGlmIG5vdCBpc2luc3RhbmNlKG9iaiwgKHN0ciwgYnl0ZXMsIGRpY3QpKToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICd1bmhhbmRsZWQgdHlwZTogJyArIHN0cih0eXBlKG9iaikpKTsKICAgICAgICAgICAgcmV0dXJuIG9iajsKCiAgICAgICAgaWYgJ0lkJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuSWQgPSBvYmpbJ0lkJ107CgogICAgCiAgICAgICAgaWYgJ2FjdGl2ZScgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmFjdGl2ZShvYmpbJ2FjdGl2ZSddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdlbmFibGVkJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuZW5hYmxlZChvYmpbJ2VuYWJsZWQnXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnY29kZScgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmNvZGUob2JqWydjb2RlJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ29yZGVyJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYub3JkZXIob2JqWydvcmRlciddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdkYXRlJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuZGF0ZShvYmpbJ2RhdGUnXSk7CiAgICAgICAgCiAgICAgICAgICAgIHNlbGYuZGF0ZShkYXRldGltZS5kYXRldGltZS5mcm9taXNvZm9ybWF0KHNlbGYuZGF0ZSgpKSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnbmFtZScgaW4gb2JqOgogICAgICAgICAgICBzZWxmLm5hbWUob2JqWyduYW1lJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ3JlbWFyaycgaW4gb2JqOgogICAgICAgICAgICBzZWxmLnJlbWFyayhvYmpbJ3JlbWFyayddKTsKICAgICAgICAKICAgICAgICAgICAgc2VsZi5yZW1hcmsoIGJhc2U2NC5iNjRkZWNvZGUoc2VsZi5yZW1hcmsoKSkgKTsKICAgICAgICAKICAgIAoKICAgIAogICAgICAgIGlmICdncm91cF9Db25maWdzJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuZ3JvdXBfQ29uZmlncyhDb25maWcoKS5fZnJvbURvY3VtZW50KG9ialsnZ3JvdXBfQ29uZmlncyddKSk7CiAgICAKICAgICAgICBpZiAnZ3JvdXBfTWFwcGluZ3MnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5ncm91cF9NYXBwaW5ncyhNYXBwaW5nKCkuX2Zyb21Eb2N1bWVudChvYmpbJ2dyb3VwX01hcHBpbmdzJ10pKTsKICAgIAoKICAgICAgICBnYy5jb2xsZWN0KCk7CiAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAKICAgIGRlZiBfdG9Eb2N1bWVudChzZWxmLCBiSlNPTj1Ob25lKToKICAgICAgICBfX3RvU3RyaW5nID0gJ0NvbmZpZ19Hcm91cDo6X3RvRG9jdW1lbnQoKTogJzsKCiAgICAgICAgcmV0ID0ge307CiAgICAgICAgaWYgc2VsZi5JZCBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJJZCJdID0gc2VsZi5JZDsKCiAgICAKICAgICAgICBpZiBzZWxmLmFjdGl2ZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbImFjdGl2ZSJdID0gc2VsZi5hY3RpdmUoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYuZW5hYmxlZCgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbImVuYWJsZWQiXSA9IHNlbGYuZW5hYmxlZCgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5jb2RlKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiY29kZSJdID0gc2VsZi5jb2RlKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLm9yZGVyKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsib3JkZXIiXSA9IHNlbGYub3JkZXIoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYuZGF0ZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbImRhdGUiXSA9IHNlbGYuZGF0ZSgpOwogICAgICAgIAogICAgICAgICAgICBpZiBpc2luc3RhbmNlKHJldFsiZGF0ZSJdLCBkYXRldGltZS5kYXRldGltZSk6CiAgICAgICAgICAgICAgICByZXRbImRhdGUiXSA9IHJldFsiZGF0ZSJdLmlzb2Zvcm1hdCgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5uYW1lKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsibmFtZSJdID0gc2VsZi5uYW1lKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLnJlbWFyaygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbInJlbWFyayJdID0gc2VsZi5yZW1hcmsoKTsKICAgICAgICAKICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShyZXRbInJlbWFyayJdLCBkaWN0KToKICAgICAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSBqc29uLmR1bXBzKHJldFsicmVtYXJrIl0pLmVuY29kZSgndXRmLTgnKTsKCiAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSAgYmFzZTY0LmI2NGVuY29kZShyZXRbInJlbWFyayJdKS5kZWNvZGUoJ3V0Zi04Jykuc3RyaXAoKTsKICAgICAgICAKICAgIAogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5ncm91cF9Db25maWdzKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiZ3JvdXBfQ29uZmlncyJdID0gW3RhLl90b0RvY3VtZW50KCkgZm9yIHRhIGluIHNlbGYuZ3JvdXBfQ29uZmlncygpXTsKICAgIAogICAgICAgIGlmIHNlbGYuZ3JvdXBfTWFwcGluZ3MoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJncm91cF9NYXBwaW5ncyJdID0gW3RhLl90b0RvY3VtZW50KCkgZm9yIHRhIGluIHNlbGYuZ3JvdXBfTWFwcGluZ3MoKV07CiAgICAKCiAgICAgICAgaWYgYkpTT04gaXMgbm90IE5vbmU6CiAgICAgICAgICAgICNwcmludChfX3RvU3RyaW5nICsgIkdPVCBIRVJFIiwgdHlwZShyZXQpLCByZXQpOwogICAgICAgICAgICByZXQgPSBqc29uLmR1bXBzKHJldCk7CiAgICAgICAgZ2MuY29sbGVjdCgpOwogICAgICAgIHJldHVybiByZXQ7CgogICAgCiAgICBkZWYgc3RvcmUoc2VsZiwgX19ldmVudD1Ob25lKToKICAgICAgICBfX3RvU3RyaW5nID0gJ0NvbmZpZ19Hcm91cDo6c3RvcmUoKTogJzsKICAgICAgICAKICAgICAgICBldkpTT04gPSBOb25lOwoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBldkpTT04gPSBqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsKICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOgogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOwogICAgICAgIAoKICAgICAgICBhbnN3ZXIgPSBOb25lOwoKICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGltZSgpKSsnXS5Db25maWdfR3JvdXAuc3RvcmUoKScpLm1ldGhvZCgnc3RvcmUnKS5jbGFzc05hbWUoJ0NvbmZpZ19Hcm91cCcpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOwogICAgICAgIAogICAgICAgIGdjLmNvbGxlY3QoKTsKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOwoKICAgICAgICAKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsKICAgICAgICAKICAgICAgICAgICAgYW5zd2VyID0gQ29uZmlnX0dyb3VwKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOwogICAgICAgIAoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7CgoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOgogICAgICAgICAgICAKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7CgogICAgICAgICAgICAKICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7CiAgICAgICAgICAgIAoKICAgICAgICByZXR1cm4gYW5zd2VyOwoKICAgIAogICAgZGVmIGZpbmRBbGwoc2VsZiwgX19ldmVudD1Ob25lKToKICAgICAgICBfX3RvU3RyaW5nID0gJ0NvbmZpZ19Hcm91cDo6ZmluZEFsbCgpOiAnOwogICAgICAgIAogICAgICAgIGV2SlNPTiA9IE5vbmU7CgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIGV2SlNPTiA9IGpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOwogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046CiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7CiAgICAgICAgCgogICAgICAgIGFuc3dlciA9IE5vbmU7CgogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aW1lKCkpKyddLkNvbmZpZ19Hcm91cC5maW5kQWxsKCknKS5tZXRob2QoJ2ZpbmRBbGwnKS5jbGFzc05hbWUoJ0NvbmZpZ19Hcm91cCcpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOwogICAgICAgIAogICAgICAgIGdjLmNvbGxlY3QoKTsKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOwoKICAgICAgICAKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsKICAgICAgICAKICAgICAgICAgICAgYW5zd2VyID0gQ29uZmlnX0dyb3VwKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOwogICAgICAgIAoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7CgoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOgogICAgICAgICAgICAKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7CgogICAgICAgICAgICAKICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7CiAgICAgICAgICAgIAoKICAgICAgICByZXR1cm4gYW5zd2VyOwoKICAgIAogICAgZGVmIGZpbmQoc2VsZiwgX19ldmVudD1Ob25lKToKICAgICAgICBfX3RvU3RyaW5nID0gJ0NvbmZpZ19Hcm91cDo6ZmluZCgpOiAnOwogICAgICAgIAogICAgICAgIGV2SlNPTiA9IE5vbmU7CgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIGV2SlNPTiA9IGpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOwogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046CiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7CiAgICAgICAgCgogICAgICAgIGFuc3dlciA9IE5vbmU7CgogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aW1lKCkpKyddLkNvbmZpZ19Hcm91cC5maW5kKCknKS5tZXRob2QoJ2ZpbmQnKS5jbGFzc05hbWUoJ0NvbmZpZ19Hcm91cCcpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOwogICAgICAgIAogICAgICAgIGdjLmNvbGxlY3QoKTsKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOwoKICAgICAgICAKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsKICAgICAgICAKICAgICAgICAgICAgYW5zd2VyID0gQ29uZmlnX0dyb3VwKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOwogICAgICAgIAoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7CgoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOgogICAgICAgICAgICAKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7CgogICAgICAgICAgICAKICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7CiAgICAgICAgICAgIAoKICAgICAgICByZXR1cm4gYW5zd2VyOwoKICAgIAoKCmNsYXNzIE1hcHBpbmdfR3JvdXAoKToKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBJZD1Ob25lLCBhY3RpdmU9Tm9uZSwgZW5hYmxlZD1Ob25lLCBjb2RlPU5vbmUsIG9yZGVyPU5vbmUsIGRhdGU9Tm9uZSwgbmFtZT1Ob25lLCByZW1hcms9Tm9uZSk6CiAgICAgICAgc3VwZXIoKS5fX2luaXRfXygpOwoKICAgICAgICAjcHJpbnQoJ01hcHBpbmdfR3JvdXA6Ol9faW5pdF9fKCknKTsKICAgICAgICBpZiBJZCBpcyBub3QgTm9uZToKICAgICAgICAgICAgc2VsZi5JZCA9IElkOwoKICAgICAgICAKICAgICAgICBzZWxmLmFjdGl2ZShhY3RpdmUpOwogICAgICAgIHNlbGYuZW5hYmxlZChlbmFibGVkKTsKICAgICAgICBzZWxmLmNvZGUoY29kZSk7CiAgICAgICAgc2VsZi5vcmRlcihvcmRlcik7CiAgICAgICAgc2VsZi5kYXRlKGRhdGUpOwogICAgICAgIHNlbGYubmFtZShuYW1lKTsKICAgICAgICBzZWxmLnJlbWFyayhyZW1hcmspOwogICAgICAgIAogICAgSWQgPSBOb25lOwogICAgCiAgICAKICAgICMgYWN0aXZlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfYWN0aXZlID0gTm9uZTsKICAgIGRlZiBhY3RpdmUoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2FjdGl2ZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9hY3RpdmU7CiAgICAKICAgICMgZW5hYmxlZDogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX2VuYWJsZWQgPSBOb25lOwogICAgZGVmIGVuYWJsZWQoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2VuYWJsZWQgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fZW5hYmxlZDsKICAgIAogICAgIyBjb2RlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfY29kZSA9IE5vbmU7CiAgICBkZWYgY29kZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fY29kZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9jb2RlOwogICAgCiAgICAjIG9yZGVyOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfb3JkZXIgPSBOb25lOwogICAgZGVmIG9yZGVyKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9vcmRlciA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9vcmRlcjsKICAgIAogICAgIyBkYXRlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfZGF0ZSA9IE5vbmU7CiAgICBkZWYgZGF0ZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fZGF0ZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9kYXRlOwogICAgCiAgICAjIG5hbWU6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9uYW1lID0gTm9uZTsKICAgIGRlZiBuYW1lKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9uYW1lID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX25hbWU7CiAgICAKICAgICMgcmVtYXJrOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfcmVtYXJrID0gTm9uZTsKICAgIGRlZiByZW1hcmsoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX3JlbWFyayA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9yZW1hcms7CiAgICAKICAgIAogICAgCiAgICAKICAgIGRlZiBfZnJvbURvY3VtZW50KHNlbGYsIG9iaik6CiAgICAgICAgX190b1N0cmluZyA9ICdNYXBwaW5nX0dyb3VwOjpfZnJvbURvY3VtZW50KCk6ICc7CiAgICAgICAgCiAgICAgICAgaWYgb2JqIGlzIE5vbmU6CiAgICAgICAgICAgIHJldHVybiBzZWxmOwoKICAgICAgICBpZiBpc2luc3RhbmNlKG9iaiwgYnl0ZXMpOgogICAgICAgICAgICBvYmogPSBzdHIob2JqLCAidXRmLTgiKTsKCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIHN0cikgb3IgdHlwZShvYmopIGlzIHN0cjoKICAgICAgICAgICAgaWYgcmUubWF0Y2gociIoKChbQS1aYS16XXszLDl9Oig/OlwvXC8pPykoPzpbLTs6Jj1cK1wkLFx3XStAKT9bQS1aYS16MC05Li1dK3woPzp3d3cufFstOzomPVwrXCQsXHddK0ApW0EtWmEtejAtOS4tXSspKCg/OlwvW1wrfiVcLy5cd1wtX10qKT9cPz8oPzpbLVwrPSY7JUAuXHdfXSopIz8oPzpbXHddKikpPykiLCBvYmopOgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIG9iaiA9IGpzb24ubG9hZHModXJsbGliMy5Qb29sTWFuYWdlcigpLnJlcXVlc3QoJ0dFVCcsIG9iaikuZGF0YS5kZWNvZGUoJ3V0Zi04JykpOwogICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgIG9iaiA9IHt9OwogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgb2JqID0ganNvbi5sb2FkcyhvYmopOwogICAgICAgIAogICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLCBsaXN0KToKICAgICAgICAgICAgcmV0dXJuIFtNYXBwaW5nX0dyb3VwKCkuX2Zyb21Eb2N1bWVudChvKSBmb3IgbyBpbiBvYmpdOwogICAgICAgICAgICAKICAgICAgICBpZiBub3QgaXNpbnN0YW5jZShvYmosIChzdHIsIGJ5dGVzLCBkaWN0KSk6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAndW5oYW5kbGVkIHR5cGU6ICcgKyBzdHIodHlwZShvYmopKSk7CiAgICAgICAgICAgIHJldHVybiBvYmo7CgogICAgICAgIGlmICdJZCcgaW4gb2JqOgogICAgICAgICAgICBzZWxmLklkID0gb2JqWydJZCddOwoKICAgIAogICAgICAgIGlmICdhY3RpdmUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5hY3RpdmUob2JqWydhY3RpdmUnXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnZW5hYmxlZCcgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmVuYWJsZWQob2JqWydlbmFibGVkJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ2NvZGUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5jb2RlKG9ialsnY29kZSddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdvcmRlcicgaW4gb2JqOgogICAgICAgICAgICBzZWxmLm9yZGVyKG9ialsnb3JkZXInXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnZGF0ZScgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmRhdGUob2JqWydkYXRlJ10pOwogICAgICAgIAogICAgICAgICAgICBzZWxmLmRhdGUoZGF0ZXRpbWUuZGF0ZXRpbWUuZnJvbWlzb2Zvcm1hdChzZWxmLmRhdGUoKSkpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ25hbWUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5uYW1lKG9ialsnbmFtZSddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdyZW1hcmsnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5yZW1hcmsob2JqWydyZW1hcmsnXSk7CiAgICAgICAgCiAgICAgICAgICAgIHNlbGYucmVtYXJrKCBiYXNlNjQuYjY0ZGVjb2RlKHNlbGYucmVtYXJrKCkpICk7CiAgICAgICAgCiAgICAKCiAgICAKCiAgICAgICAgZ2MuY29sbGVjdCgpOwogICAgICAgIHJldHVybiBzZWxmOwogICAgCiAgICBkZWYgX3RvRG9jdW1lbnQoc2VsZiwgYkpTT049Tm9uZSk6CiAgICAgICAgX190b1N0cmluZyA9ICdNYXBwaW5nX0dyb3VwOjpfdG9Eb2N1bWVudCgpOiAnOwoKICAgICAgICByZXQgPSB7fTsKICAgICAgICBpZiBzZWxmLklkIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbIklkIl0gPSBzZWxmLklkOwoKICAgIAogICAgICAgIGlmIHNlbGYuYWN0aXZlKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiYWN0aXZlIl0gPSBzZWxmLmFjdGl2ZSgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5lbmFibGVkKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiZW5hYmxlZCJdID0gc2VsZi5lbmFibGVkKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLmNvZGUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJjb2RlIl0gPSBzZWxmLmNvZGUoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYub3JkZXIoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJvcmRlciJdID0gc2VsZi5vcmRlcigpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5kYXRlKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiZGF0ZSJdID0gc2VsZi5kYXRlKCk7CiAgICAgICAgCiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UocmV0WyJkYXRlIl0sIGRhdGV0aW1lLmRhdGV0aW1lKToKICAgICAgICAgICAgICAgIHJldFsiZGF0ZSJdID0gcmV0WyJkYXRlIl0uaXNvZm9ybWF0KCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLm5hbWUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJuYW1lIl0gPSBzZWxmLm5hbWUoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYucmVtYXJrKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSBzZWxmLnJlbWFyaygpOwogICAgICAgIAogICAgICAgICAgICBpZiBpc2luc3RhbmNlKHJldFsicmVtYXJrIl0sIGRpY3QpOgogICAgICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IGpzb24uZHVtcHMocmV0WyJyZW1hcmsiXSkuZW5jb2RlKCd1dGYtOCcpOwoKICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9ICBiYXNlNjQuYjY0ZW5jb2RlKHJldFsicmVtYXJrIl0pLmRlY29kZSgndXRmLTgnKS5zdHJpcCgpOwogICAgICAgIAogICAgCiAgICAgICAgCiAgICAKCiAgICAgICAgaWYgYkpTT04gaXMgbm90IE5vbmU6CiAgICAgICAgICAgICNwcmludChfX3RvU3RyaW5nICsgIkdPVCBIRVJFIiwgdHlwZShyZXQpLCByZXQpOwogICAgICAgICAgICByZXQgPSBqc29uLmR1bXBzKHJldCk7CiAgICAgICAgZ2MuY29sbGVjdCgpOwogICAgICAgIHJldHVybiByZXQ7CgogICAgCiAgICBkZWYgc3RvcmUoc2VsZiwgX19ldmVudD1Ob25lKToKICAgICAgICBfX3RvU3RyaW5nID0gJ01hcHBpbmdfR3JvdXA6OnN0b3JlKCk6ICc7CiAgICAgICAgCiAgICAgICAgZXZKU09OID0gTm9uZTsKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgZXZKU09OID0ganNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7CiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoKICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsKICAgICAgICAKCiAgICAgICAgYW5zd2VyID0gTm9uZTsKCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpbWUoKSkrJ10uTWFwcGluZ19Hcm91cC5zdG9yZSgpJykubWV0aG9kKCdzdG9yZScpLmNsYXNzTmFtZSgnTWFwcGluZ19Hcm91cCcpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOwogICAgICAgIAogICAgICAgIGdjLmNvbGxlY3QoKTsKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOwoKICAgICAgICAKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsKICAgICAgICAKICAgICAgICAgICAgYW5zd2VyID0gTWFwcGluZ19Hcm91cCgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsKICAgICAgICAKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOwoKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOwogICAgICAgICAgICAKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOwoKICAgICAgICAgICAgCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOwogICAgICAgICAgICAKCiAgICAgICAgcmV0dXJuIGFuc3dlcjsKCiAgICAKICAgIGRlZiBmaW5kQWxsKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6CiAgICAgICAgX190b1N0cmluZyA9ICdNYXBwaW5nX0dyb3VwOjpmaW5kQWxsKCk6ICc7CiAgICAgICAgCiAgICAgICAgZXZKU09OID0gTm9uZTsKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgZXZKU09OID0ganNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7CiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoKICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsKICAgICAgICAKCiAgICAgICAgYW5zd2VyID0gTm9uZTsKCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpbWUoKSkrJ10uTWFwcGluZ19Hcm91cC5maW5kQWxsKCknKS5tZXRob2QoJ2ZpbmRBbGwnKS5jbGFzc05hbWUoJ01hcHBpbmdfR3JvdXAnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7CiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsKICAgICAgICAKICAgICAgICBnYy5jb2xsZWN0KCk7CgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsKCiAgICAgICAgCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7CiAgICAgICAgCiAgICAgICAgICAgIGFuc3dlciA9IE1hcHBpbmdfR3JvdXAoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7CiAgICAgICAgCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsKCgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsKCiAgICAgICAgICAgIAogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsKICAgICAgICAgICAgCgogICAgICAgIHJldHVybiBhbnN3ZXI7CgogICAgCiAgICBkZWYgZmluZChzZWxmLCBfX2V2ZW50PU5vbmUpOgogICAgICAgIF9fdG9TdHJpbmcgPSAnTWFwcGluZ19Hcm91cDo6ZmluZCgpOiAnOwogICAgICAgIAogICAgICAgIGV2SlNPTiA9IE5vbmU7CgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIGV2SlNPTiA9IGpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOwogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046CiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7CiAgICAgICAgCgogICAgICAgIGFuc3dlciA9IE5vbmU7CgogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aW1lKCkpKyddLk1hcHBpbmdfR3JvdXAuZmluZCgpJykubWV0aG9kKCdmaW5kJykuY2xhc3NOYW1lKCdNYXBwaW5nX0dyb3VwJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOwogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7CiAgICAgICAgCiAgICAgICAgZ2MuY29sbGVjdCgpOwoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7CgogICAgICAgIAogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOwogICAgICAgIAogICAgICAgICAgICBhbnN3ZXIgPSBNYXBwaW5nX0dyb3VwKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOwogICAgICAgIAoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7CgoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOgogICAgICAgICAgICAKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7CgogICAgICAgICAgICAKICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7CiAgICAgICAgICAgIAoKICAgICAgICByZXR1cm4gYW5zd2VyOwoKICAgIAoKCmNsYXNzIFRvb2xfVHlwZSgpOgogICAgZGVmIF9faW5pdF9fKHNlbGYsIElkPU5vbmUsIGFjdGl2ZT1Ob25lLCBlbmFibGVkPU5vbmUsIGNvZGU9Tm9uZSwgb3JkZXI9Tm9uZSwgZGF0ZT1Ob25lLCBuYW1lPU5vbmUsIHJlbWFyaz1Ob25lKToKICAgICAgICBzdXBlcigpLl9faW5pdF9fKCk7CgogICAgICAgICNwcmludCgnVG9vbF9UeXBlOjpfX2luaXRfXygpJyk7CiAgICAgICAgaWYgSWQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHNlbGYuSWQgPSBJZDsKCiAgICAgICAgCiAgICAgICAgc2VsZi5hY3RpdmUoYWN0aXZlKTsKICAgICAgICBzZWxmLmVuYWJsZWQoZW5hYmxlZCk7CiAgICAgICAgc2VsZi5jb2RlKGNvZGUpOwogICAgICAgIHNlbGYub3JkZXIob3JkZXIpOwogICAgICAgIHNlbGYuZGF0ZShkYXRlKTsKICAgICAgICBzZWxmLm5hbWUobmFtZSk7CiAgICAgICAgc2VsZi5yZW1hcmsocmVtYXJrKTsKICAgICAgICAKICAgIElkID0gTm9uZTsKICAgIAogICAgCiAgICAjIGFjdGl2ZTogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX2FjdGl2ZSA9IE5vbmU7CiAgICBkZWYgYWN0aXZlKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9hY3RpdmUgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fYWN0aXZlOwogICAgCiAgICAjIGVuYWJsZWQ6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9lbmFibGVkID0gTm9uZTsKICAgIGRlZiBlbmFibGVkKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9lbmFibGVkID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2VuYWJsZWQ7CiAgICAKICAgICMgY29kZTogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX2NvZGUgPSBOb25lOwogICAgZGVmIGNvZGUoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2NvZGUgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fY29kZTsKICAgIAogICAgIyBvcmRlcjogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX29yZGVyID0gTm9uZTsKICAgIGRlZiBvcmRlcihzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fb3JkZXIgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fb3JkZXI7CiAgICAKICAgICMgZGF0ZTogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX2RhdGUgPSBOb25lOwogICAgZGVmIGRhdGUoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2RhdGUgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fZGF0ZTsKICAgIAogICAgIyBuYW1lOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfbmFtZSA9IE5vbmU7CiAgICBkZWYgbmFtZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fbmFtZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9uYW1lOwogICAgCiAgICAjIHJlbWFyazogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX3JlbWFyayA9IE5vbmU7CiAgICBkZWYgcmVtYXJrKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9yZW1hcmsgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fcmVtYXJrOwogICAgCiAgICAKICAgIAogICAgIyB0eXBlX0NvbmZpZ3M6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF90eXBlX0NvbmZpZ3MgPSBOb25lOwogICAgZGVmIHR5cGVfQ29uZmlncyhzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fdHlwZV9Db25maWdzID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3R5cGVfQ29uZmlnczsKICAgIAogICAgIyB0eXBlX1Rvb2xzOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfdHlwZV9Ub29scyA9IE5vbmU7CiAgICBkZWYgdHlwZV9Ub29scyhzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fdHlwZV9Ub29scyA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl90eXBlX1Rvb2xzOwogICAgCiAgICAjIHR5cGVfTWFwcGluZ3M6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF90eXBlX01hcHBpbmdzID0gTm9uZTsKICAgIGRlZiB0eXBlX01hcHBpbmdzKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl90eXBlX01hcHBpbmdzID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3R5cGVfTWFwcGluZ3M7CiAgICAKICAgIAogICAgZGVmIF9mcm9tRG9jdW1lbnQoc2VsZiwgb2JqKToKICAgICAgICBfX3RvU3RyaW5nID0gJ1Rvb2xfVHlwZTo6X2Zyb21Eb2N1bWVudCgpOiAnOwogICAgICAgIAogICAgICAgIGlmIG9iaiBpcyBOb25lOgogICAgICAgICAgICByZXR1cm4gc2VsZjsKCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIGJ5dGVzKToKICAgICAgICAgICAgb2JqID0gc3RyKG9iaiwgInV0Zi04Iik7CgogICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLCBzdHIpIG9yIHR5cGUob2JqKSBpcyBzdHI6CiAgICAgICAgICAgIGlmIHJlLm1hdGNoKHIiKCgoW0EtWmEtel17Myw5fTooPzpcL1wvKT8pKD86Wy07OiY9XCtcJCxcd10rQCk/W0EtWmEtejAtOS4tXSt8KD86d3d3LnxbLTs6Jj1cK1wkLFx3XStAKVtBLVphLXowLTkuLV0rKSgoPzpcL1tcK34lXC8uXHdcLV9dKik/XD8/KD86Wy1cKz0mOyVALlx3X10qKSM/KD86W1x3XSopKT8pIiwgb2JqKToKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBvYmogPSBqc29uLmxvYWRzKHVybGxpYjMuUG9vbE1hbmFnZXIoKS5yZXF1ZXN0KCdHRVQnLCBvYmopLmRhdGEuZGVjb2RlKCd1dGYtOCcpKTsKICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICBvYmogPSB7fTsKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIG9iaiA9IGpzb24ubG9hZHMob2JqKTsKICAgICAgICAKICAgICAgICBpZiBpc2luc3RhbmNlKG9iaiwgbGlzdCk6CiAgICAgICAgICAgIHJldHVybiBbVG9vbF9UeXBlKCkuX2Zyb21Eb2N1bWVudChvKSBmb3IgbyBpbiBvYmpdOwogICAgICAgICAgICAKICAgICAgICBpZiBub3QgaXNpbnN0YW5jZShvYmosIChzdHIsIGJ5dGVzLCBkaWN0KSk6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAndW5oYW5kbGVkIHR5cGU6ICcgKyBzdHIodHlwZShvYmopKSk7CiAgICAgICAgICAgIHJldHVybiBvYmo7CgogICAgICAgIGlmICdJZCcgaW4gb2JqOgogICAgICAgICAgICBzZWxmLklkID0gb2JqWydJZCddOwoKICAgIAogICAgICAgIGlmICdhY3RpdmUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5hY3RpdmUob2JqWydhY3RpdmUnXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnZW5hYmxlZCcgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmVuYWJsZWQob2JqWydlbmFibGVkJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ2NvZGUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5jb2RlKG9ialsnY29kZSddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdvcmRlcicgaW4gb2JqOgogICAgICAgICAgICBzZWxmLm9yZGVyKG9ialsnb3JkZXInXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnZGF0ZScgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmRhdGUob2JqWydkYXRlJ10pOwogICAgICAgIAogICAgICAgICAgICBzZWxmLmRhdGUoZGF0ZXRpbWUuZGF0ZXRpbWUuZnJvbWlzb2Zvcm1hdChzZWxmLmRhdGUoKSkpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ25hbWUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5uYW1lKG9ialsnbmFtZSddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdyZW1hcmsnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5yZW1hcmsob2JqWydyZW1hcmsnXSk7CiAgICAgICAgCiAgICAgICAgICAgIHNlbGYucmVtYXJrKCBiYXNlNjQuYjY0ZGVjb2RlKHNlbGYucmVtYXJrKCkpICk7CiAgICAgICAgCiAgICAKCiAgICAKICAgICAgICBpZiAndHlwZV9Db25maWdzJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYudHlwZV9Db25maWdzKENvbmZpZygpLl9mcm9tRG9jdW1lbnQob2JqWyd0eXBlX0NvbmZpZ3MnXSkpOwogICAgCiAgICAgICAgaWYgJ3R5cGVfVG9vbHMnIGluIG9iajoKICAgICAgICAgICAgc2VsZi50eXBlX1Rvb2xzKFRvb2woKS5fZnJvbURvY3VtZW50KG9ialsndHlwZV9Ub29scyddKSk7CiAgICAKICAgICAgICBpZiAndHlwZV9NYXBwaW5ncycgaW4gb2JqOgogICAgICAgICAgICBzZWxmLnR5cGVfTWFwcGluZ3MoTWFwcGluZygpLl9mcm9tRG9jdW1lbnQob2JqWyd0eXBlX01hcHBpbmdzJ10pKTsKICAgIAoKICAgICAgICBnYy5jb2xsZWN0KCk7CiAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAKICAgIGRlZiBfdG9Eb2N1bWVudChzZWxmLCBiSlNPTj1Ob25lKToKICAgICAgICBfX3RvU3RyaW5nID0gJ1Rvb2xfVHlwZTo6X3RvRG9jdW1lbnQoKTogJzsKCiAgICAgICAgcmV0ID0ge307CiAgICAgICAgaWYgc2VsZi5JZCBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJJZCJdID0gc2VsZi5JZDsKCiAgICAKICAgICAgICBpZiBzZWxmLmFjdGl2ZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbImFjdGl2ZSJdID0gc2VsZi5hY3RpdmUoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYuZW5hYmxlZCgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbImVuYWJsZWQiXSA9IHNlbGYuZW5hYmxlZCgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5jb2RlKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiY29kZSJdID0gc2VsZi5jb2RlKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLm9yZGVyKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsib3JkZXIiXSA9IHNlbGYub3JkZXIoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYuZGF0ZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbImRhdGUiXSA9IHNlbGYuZGF0ZSgpOwogICAgICAgIAogICAgICAgICAgICBpZiBpc2luc3RhbmNlKHJldFsiZGF0ZSJdLCBkYXRldGltZS5kYXRldGltZSk6CiAgICAgICAgICAgICAgICByZXRbImRhdGUiXSA9IHJldFsiZGF0ZSJdLmlzb2Zvcm1hdCgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5uYW1lKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsibmFtZSJdID0gc2VsZi5uYW1lKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLnJlbWFyaygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbInJlbWFyayJdID0gc2VsZi5yZW1hcmsoKTsKICAgICAgICAKICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShyZXRbInJlbWFyayJdLCBkaWN0KToKICAgICAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSBqc29uLmR1bXBzKHJldFsicmVtYXJrIl0pLmVuY29kZSgndXRmLTgnKTsKCiAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSAgYmFzZTY0LmI2NGVuY29kZShyZXRbInJlbWFyayJdKS5kZWNvZGUoJ3V0Zi04Jykuc3RyaXAoKTsKICAgICAgICAKICAgIAogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi50eXBlX0NvbmZpZ3MoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJ0eXBlX0NvbmZpZ3MiXSA9IFt0YS5fdG9Eb2N1bWVudCgpIGZvciB0YSBpbiBzZWxmLnR5cGVfQ29uZmlncygpXTsKICAgIAogICAgICAgIGlmIHNlbGYudHlwZV9Ub29scygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbInR5cGVfVG9vbHMiXSA9IFt0YS5fdG9Eb2N1bWVudCgpIGZvciB0YSBpbiBzZWxmLnR5cGVfVG9vbHMoKV07CiAgICAKICAgICAgICBpZiBzZWxmLnR5cGVfTWFwcGluZ3MoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJ0eXBlX01hcHBpbmdzIl0gPSBbdGEuX3RvRG9jdW1lbnQoKSBmb3IgdGEgaW4gc2VsZi50eXBlX01hcHBpbmdzKCldOwogICAgCgogICAgICAgIGlmIGJKU09OIGlzIG5vdCBOb25lOgogICAgICAgICAgICAjcHJpbnQoX190b1N0cmluZyArICJHT1QgSEVSRSIsIHR5cGUocmV0KSwgcmV0KTsKICAgICAgICAgICAgcmV0ID0ganNvbi5kdW1wcyhyZXQpOwogICAgICAgIGdjLmNvbGxlY3QoKTsKICAgICAgICByZXR1cm4gcmV0OwoKICAgIAogICAgZGVmIHN0b3JlKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6CiAgICAgICAgX190b1N0cmluZyA9ICdUb29sX1R5cGU6OnN0b3JlKCk6ICc7CiAgICAgICAgCiAgICAgICAgZXZKU09OID0gTm9uZTsKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgZXZKU09OID0ganNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7CiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoKICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsKICAgICAgICAKCiAgICAgICAgYW5zd2VyID0gTm9uZTsKCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpbWUoKSkrJ10uVG9vbF9UeXBlLnN0b3JlKCknKS5tZXRob2QoJ3N0b3JlJykuY2xhc3NOYW1lKCdUb29sX1R5cGUnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7CiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsKICAgICAgICAKICAgICAgICBnYy5jb2xsZWN0KCk7CgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsKCiAgICAgICAgCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7CiAgICAgICAgCiAgICAgICAgICAgIGFuc3dlciA9IFRvb2xfVHlwZSgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsKICAgICAgICAKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOwoKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOwogICAgICAgICAgICAKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOwoKICAgICAgICAgICAgCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOwogICAgICAgICAgICAKCiAgICAgICAgcmV0dXJuIGFuc3dlcjsKCiAgICAKICAgIGRlZiBmaW5kQWxsKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6CiAgICAgICAgX190b1N0cmluZyA9ICdUb29sX1R5cGU6OmZpbmRBbGwoKTogJzsKICAgICAgICAKICAgICAgICBldkpTT04gPSBOb25lOwoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBldkpTT04gPSBqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsKICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOgogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOwogICAgICAgIAoKICAgICAgICBhbnN3ZXIgPSBOb25lOwoKICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGltZSgpKSsnXS5Ub29sX1R5cGUuZmluZEFsbCgpJykubWV0aG9kKCdmaW5kQWxsJykuY2xhc3NOYW1lKCdUb29sX1R5cGUnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7CiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsKICAgICAgICAKICAgICAgICBnYy5jb2xsZWN0KCk7CgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsKCiAgICAgICAgCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7CiAgICAgICAgCiAgICAgICAgICAgIGFuc3dlciA9IFRvb2xfVHlwZSgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsKICAgICAgICAKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOwoKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOwogICAgICAgICAgICAKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOwoKICAgICAgICAgICAgCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOwogICAgICAgICAgICAKCiAgICAgICAgcmV0dXJuIGFuc3dlcjsKCiAgICAKICAgIGRlZiBmaW5kKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6CiAgICAgICAgX190b1N0cmluZyA9ICdUb29sX1R5cGU6OmZpbmQoKTogJzsKICAgICAgICAKICAgICAgICBldkpTT04gPSBOb25lOwoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBldkpTT04gPSBqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsKICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOgogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOwogICAgICAgIAoKICAgICAgICBhbnN3ZXIgPSBOb25lOwoKICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGltZSgpKSsnXS5Ub29sX1R5cGUuZmluZCgpJykubWV0aG9kKCdmaW5kJykuY2xhc3NOYW1lKCdUb29sX1R5cGUnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7CiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsKICAgICAgICAKICAgICAgICBnYy5jb2xsZWN0KCk7CgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsKCiAgICAgICAgCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7CiAgICAgICAgCiAgICAgICAgICAgIGFuc3dlciA9IFRvb2xfVHlwZSgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsKICAgICAgICAKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOwoKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOwogICAgICAgICAgICAKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOwoKICAgICAgICAgICAgCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOwogICAgICAgICAgICAKCiAgICAgICAgcmV0dXJuIGFuc3dlcjsKCiAgICAKCgpjbGFzcyBFdmVudCgpOgogICAgZGVmIF9faW5pdF9fKHNlbGYsIElkPU5vbmUsIGFjdGl2ZT1Ob25lLCBlbmFibGVkPU5vbmUsIGNvZGU9Tm9uZSwgb3JkZXI9Tm9uZSwgZGF0ZT1Ob25lLCBuYW1lPU5vbmUsIHJlbWFyaz1Ob25lLCBjbGFzc05hbWU9Tm9uZSwgbWV0aG9kPU5vbmUsIHBheWxvYWQ9Tm9uZSwgY2Fycmllcj1Ob25lLCBzZW5kZXI9Tm9uZSwgcmVjaXBpZW50PU5vbmUsIHJlc3BvbnNlVG89Tm9uZSk6CiAgICAgICAgc3VwZXIoKS5fX2luaXRfXygpOwoKICAgICAgICAjcHJpbnQoJ0V2ZW50OjpfX2luaXRfXygpJyk7CiAgICAgICAgaWYgSWQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHNlbGYuSWQgPSBJZDsKCiAgICAgICAgCiAgICAgICAgc2VsZi5hY3RpdmUoYWN0aXZlKTsKICAgICAgICBzZWxmLmVuYWJsZWQoZW5hYmxlZCk7CiAgICAgICAgc2VsZi5jb2RlKGNvZGUpOwogICAgICAgIHNlbGYub3JkZXIob3JkZXIpOwogICAgICAgIHNlbGYuZGF0ZShkYXRlKTsKICAgICAgICBzZWxmLm5hbWUobmFtZSk7CiAgICAgICAgc2VsZi5yZW1hcmsocmVtYXJrKTsKICAgICAgICBzZWxmLmNsYXNzTmFtZShjbGFzc05hbWUpOwogICAgICAgIHNlbGYubWV0aG9kKG1ldGhvZCk7CiAgICAgICAgc2VsZi5wYXlsb2FkKHBheWxvYWQpOwogICAgICAgIHNlbGYuY2FycmllcihjYXJyaWVyKTsKICAgICAgICBzZWxmLnNlbmRlcihzZW5kZXIpOwogICAgICAgIHNlbGYucmVjaXBpZW50KHJlY2lwaWVudCk7CiAgICAgICAgc2VsZi5yZXNwb25zZVRvKHJlc3BvbnNlVG8pOwogICAgICAgIAogICAgSWQgPSBOb25lOwogICAgCiAgICAKICAgICMgYWN0aXZlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfYWN0aXZlID0gTm9uZTsKICAgIGRlZiBhY3RpdmUoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2FjdGl2ZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9hY3RpdmU7CiAgICAKICAgICMgZW5hYmxlZDogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX2VuYWJsZWQgPSBOb25lOwogICAgZGVmIGVuYWJsZWQoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2VuYWJsZWQgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fZW5hYmxlZDsKICAgIAogICAgIyBjb2RlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfY29kZSA9IE5vbmU7CiAgICBkZWYgY29kZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fY29kZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9jb2RlOwogICAgCiAgICAjIG9yZGVyOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfb3JkZXIgPSBOb25lOwogICAgZGVmIG9yZGVyKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9vcmRlciA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9vcmRlcjsKICAgIAogICAgIyBkYXRlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfZGF0ZSA9IE5vbmU7CiAgICBkZWYgZGF0ZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fZGF0ZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9kYXRlOwogICAgCiAgICAjIG5hbWU6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9uYW1lID0gTm9uZTsKICAgIGRlZiBuYW1lKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9uYW1lID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX25hbWU7CiAgICAKICAgICMgcmVtYXJrOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfcmVtYXJrID0gTm9uZTsKICAgIGRlZiByZW1hcmsoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX3JlbWFyayA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9yZW1hcms7CiAgICAKICAgICMgY2xhc3NOYW1lOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfY2xhc3NOYW1lID0gTm9uZTsKICAgIGRlZiBjbGFzc05hbWUoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2NsYXNzTmFtZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9jbGFzc05hbWU7CiAgICAKICAgICMgbWV0aG9kOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfbWV0aG9kID0gTm9uZTsKICAgIGRlZiBtZXRob2Qoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX21ldGhvZCA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9tZXRob2Q7CiAgICAKICAgICMgcGF5bG9hZDogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX3BheWxvYWQgPSBOb25lOwogICAgZGVmIHBheWxvYWQoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX3BheWxvYWQgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fcGF5bG9hZDsKICAgIAogICAgIyBjYXJyaWVyOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfY2FycmllciA9IE5vbmU7CiAgICBkZWYgY2FycmllcihzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fY2FycmllciA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9jYXJyaWVyOwogICAgCiAgICAjIHNlbmRlcjogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX3NlbmRlciA9IE5vbmU7CiAgICBkZWYgc2VuZGVyKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9zZW5kZXIgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fc2VuZGVyOwogICAgCiAgICAjIHJlY2lwaWVudDogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX3JlY2lwaWVudCA9IE5vbmU7CiAgICBkZWYgcmVjaXBpZW50KHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9yZWNpcGllbnQgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fcmVjaXBpZW50OwogICAgCiAgICAjIHJlc3BvbnNlVG86IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9yZXNwb25zZVRvID0gTm9uZTsKICAgIGRlZiByZXNwb25zZVRvKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9yZXNwb25zZVRvID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3Jlc3BvbnNlVG87CiAgICAKICAgIAogICAgCiAgICAjIHJlc3BvbnNlVG9fRXZlbnRzOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfcmVzcG9uc2VUb19FdmVudHMgPSBOb25lOwogICAgZGVmIHJlc3BvbnNlVG9fRXZlbnRzKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9yZXNwb25zZVRvX0V2ZW50cyA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9yZXNwb25zZVRvX0V2ZW50czsKICAgIAogICAgCiAgICBkZWYgX2Zyb21Eb2N1bWVudChzZWxmLCBvYmopOgogICAgICAgIF9fdG9TdHJpbmcgPSAnRXZlbnQ6Ol9mcm9tRG9jdW1lbnQoKTogJzsKICAgICAgICAKICAgICAgICBpZiBvYmogaXMgTm9uZToKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CgogICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLCBieXRlcyk6CiAgICAgICAgICAgIG9iaiA9IHN0cihvYmosICJ1dGYtOCIpOwoKICAgICAgICBpZiBpc2luc3RhbmNlKG9iaiwgc3RyKSBvciB0eXBlKG9iaikgaXMgc3RyOgogICAgICAgICAgICBpZiByZS5tYXRjaChyIigoKFtBLVphLXpdezMsOX06KD86XC9cLyk/KSg/OlstOzomPVwrXCQsXHddK0ApP1tBLVphLXowLTkuLV0rfCg/Ond3dy58Wy07OiY9XCtcJCxcd10rQClbQS1aYS16MC05Li1dKykoKD86XC9bXCt+JVwvLlx3XC1fXSopP1w/Pyg/OlstXCs9JjslQC5cd19dKikjPyg/Oltcd10qKSk/KSIsIG9iaik6CiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgb2JqID0ganNvbi5sb2Fkcyh1cmxsaWIzLlBvb2xNYW5hZ2VyKCkucmVxdWVzdCgnR0VUJywgb2JqKS5kYXRhLmRlY29kZSgndXRmLTgnKSk7CiAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgb2JqID0ge307CiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBvYmogPSBqc29uLmxvYWRzKG9iaik7CiAgICAgICAgCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIGxpc3QpOgogICAgICAgICAgICByZXR1cm4gW0V2ZW50KCkuX2Zyb21Eb2N1bWVudChvKSBmb3IgbyBpbiBvYmpdOwogICAgICAgICAgICAKICAgICAgICBpZiBub3QgaXNpbnN0YW5jZShvYmosIChzdHIsIGJ5dGVzLCBkaWN0KSk6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAndW5oYW5kbGVkIHR5cGU6ICcgKyBzdHIodHlwZShvYmopKSk7CiAgICAgICAgICAgIHJldHVybiBvYmo7CgogICAgICAgIGlmICdJZCcgaW4gb2JqOgogICAgICAgICAgICBzZWxmLklkID0gb2JqWydJZCddOwoKICAgIAogICAgICAgIGlmICdhY3RpdmUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5hY3RpdmUob2JqWydhY3RpdmUnXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnZW5hYmxlZCcgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmVuYWJsZWQob2JqWydlbmFibGVkJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ2NvZGUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5jb2RlKG9ialsnY29kZSddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdvcmRlcicgaW4gb2JqOgogICAgICAgICAgICBzZWxmLm9yZGVyKG9ialsnb3JkZXInXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnZGF0ZScgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmRhdGUob2JqWydkYXRlJ10pOwogICAgICAgIAogICAgICAgICAgICBzZWxmLmRhdGUoZGF0ZXRpbWUuZGF0ZXRpbWUuZnJvbWlzb2Zvcm1hdChzZWxmLmRhdGUoKSkpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ25hbWUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5uYW1lKG9ialsnbmFtZSddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdyZW1hcmsnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5yZW1hcmsob2JqWydyZW1hcmsnXSk7CiAgICAgICAgCiAgICAgICAgICAgIHNlbGYucmVtYXJrKCBiYXNlNjQuYjY0ZGVjb2RlKHNlbGYucmVtYXJrKCkpICk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnY2xhc3NOYW1lJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuY2xhc3NOYW1lKG9ialsnY2xhc3NOYW1lJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ21ldGhvZCcgaW4gb2JqOgogICAgICAgICAgICBzZWxmLm1ldGhvZChvYmpbJ21ldGhvZCddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdwYXlsb2FkJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYucGF5bG9hZChvYmpbJ3BheWxvYWQnXSk7CiAgICAgICAgCiAgICAgICAgICAgIHNlbGYucGF5bG9hZCggYmFzZTY0LmI2NGRlY29kZShzZWxmLnBheWxvYWQoKSkgKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdjYXJyaWVyJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuY2FycmllcihOb2RlKCkuX2Zyb21Eb2N1bWVudChvYmpbJ2NhcnJpZXInXSkpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ3NlbmRlcicgaW4gb2JqOgogICAgICAgICAgICBzZWxmLnNlbmRlcihOb2RlKCkuX2Zyb21Eb2N1bWVudChvYmpbJ3NlbmRlciddKSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAncmVjaXBpZW50JyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYucmVjaXBpZW50KE5vZGUoKS5fZnJvbURvY3VtZW50KG9ialsncmVjaXBpZW50J10pKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdyZXNwb25zZVRvJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYucmVzcG9uc2VUbyhFdmVudCgpLl9mcm9tRG9jdW1lbnQob2JqWydyZXNwb25zZVRvJ10pKTsKICAgICAgICAKICAgIAoKICAgIAogICAgICAgIGlmICdyZXNwb25zZVRvX0V2ZW50cycgaW4gb2JqOgogICAgICAgICAgICBzZWxmLnJlc3BvbnNlVG9fRXZlbnRzKEV2ZW50KCkuX2Zyb21Eb2N1bWVudChvYmpbJ3Jlc3BvbnNlVG9fRXZlbnRzJ10pKTsKICAgIAoKICAgICAgICBnYy5jb2xsZWN0KCk7CiAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAKICAgIGRlZiBfdG9Eb2N1bWVudChzZWxmLCBiSlNPTj1Ob25lKToKICAgICAgICBfX3RvU3RyaW5nID0gJ0V2ZW50OjpfdG9Eb2N1bWVudCgpOiAnOwoKICAgICAgICByZXQgPSB7fTsKICAgICAgICBpZiBzZWxmLklkIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbIklkIl0gPSBzZWxmLklkOwoKICAgIAogICAgICAgIGlmIHNlbGYuYWN0aXZlKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiYWN0aXZlIl0gPSBzZWxmLmFjdGl2ZSgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5lbmFibGVkKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiZW5hYmxlZCJdID0gc2VsZi5lbmFibGVkKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLmNvZGUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJjb2RlIl0gPSBzZWxmLmNvZGUoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYub3JkZXIoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJvcmRlciJdID0gc2VsZi5vcmRlcigpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5kYXRlKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiZGF0ZSJdID0gc2VsZi5kYXRlKCk7CiAgICAgICAgCiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UocmV0WyJkYXRlIl0sIGRhdGV0aW1lLmRhdGV0aW1lKToKICAgICAgICAgICAgICAgIHJldFsiZGF0ZSJdID0gcmV0WyJkYXRlIl0uaXNvZm9ybWF0KCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLm5hbWUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJuYW1lIl0gPSBzZWxmLm5hbWUoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYucmVtYXJrKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSBzZWxmLnJlbWFyaygpOwogICAgICAgIAogICAgICAgICAgICBpZiBpc2luc3RhbmNlKHJldFsicmVtYXJrIl0sIGRpY3QpOgogICAgICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IGpzb24uZHVtcHMocmV0WyJyZW1hcmsiXSkuZW5jb2RlKCd1dGYtOCcpOwoKICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9ICBiYXNlNjQuYjY0ZW5jb2RlKHJldFsicmVtYXJrIl0pLmRlY29kZSgndXRmLTgnKS5zdHJpcCgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5jbGFzc05hbWUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJjbGFzc05hbWUiXSA9IHNlbGYuY2xhc3NOYW1lKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLm1ldGhvZCgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbIm1ldGhvZCJdID0gc2VsZi5tZXRob2QoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYucGF5bG9hZCgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbInBheWxvYWQiXSA9IHNlbGYucGF5bG9hZCgpOwogICAgICAgIAogICAgICAgICAgICBpZiBpc2luc3RhbmNlKHJldFsicGF5bG9hZCJdLCBkaWN0KToKICAgICAgICAgICAgICAgIHJldFsicGF5bG9hZCJdID0ganNvbi5kdW1wcyhyZXRbInBheWxvYWQiXSkuZW5jb2RlKCd1dGYtOCcpOwoKICAgICAgICAgICAgcmV0WyJwYXlsb2FkIl0gPSAgYmFzZTY0LmI2NGVuY29kZShyZXRbInBheWxvYWQiXSkuZGVjb2RlKCd1dGYtOCcpLnN0cmlwKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLmNhcnJpZXIoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJjYXJyaWVyIl0gPSBzZWxmLmNhcnJpZXIoKS5fdG9Eb2N1bWVudCgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5zZW5kZXIoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJzZW5kZXIiXSA9IHNlbGYuc2VuZGVyKCkuX3RvRG9jdW1lbnQoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYucmVjaXBpZW50KCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsicmVjaXBpZW50Il0gPSBzZWxmLnJlY2lwaWVudCgpLl90b0RvY3VtZW50KCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJyZXNwb25zZVRvIl0gPSBzZWxmLnJlc3BvbnNlVG8oKS5fdG9Eb2N1bWVudCgpOwogICAgICAgIAogICAgCiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLnJlc3BvbnNlVG9fRXZlbnRzKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsicmVzcG9uc2VUb19FdmVudHMiXSA9IFt0YS5fdG9Eb2N1bWVudCgpIGZvciB0YSBpbiBzZWxmLnJlc3BvbnNlVG9fRXZlbnRzKCldOwogICAgCgogICAgICAgIGlmIGJKU09OIGlzIG5vdCBOb25lOgogICAgICAgICAgICAjcHJpbnQoX190b1N0cmluZyArICJHT1QgSEVSRSIsIHR5cGUocmV0KSwgcmV0KTsKICAgICAgICAgICAgcmV0ID0ganNvbi5kdW1wcyhyZXQpOwogICAgICAgIGdjLmNvbGxlY3QoKTsKICAgICAgICByZXR1cm4gcmV0OwoKICAgIAogICAgZGVmIHN0b3JlKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6CiAgICAgICAgX190b1N0cmluZyA9ICdFdmVudDo6c3RvcmUoKTogJzsKICAgICAgICAKICAgICAgICBldkpTT04gPSBOb25lOwoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBldkpTT04gPSBqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsKICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOgogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOwogICAgICAgIAoKICAgICAgICBhbnN3ZXIgPSBOb25lOwoKICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGltZSgpKSsnXS5FdmVudC5zdG9yZSgpJykubWV0aG9kKCdzdG9yZScpLmNsYXNzTmFtZSgnRXZlbnQnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7CiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsKICAgICAgICAKICAgICAgICBnYy5jb2xsZWN0KCk7CgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsKCiAgICAgICAgCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7CiAgICAgICAgCiAgICAgICAgICAgIGFuc3dlciA9IEV2ZW50KCkuX2Zyb21Eb2N1bWVudChldkpTT04pOwogICAgICAgIAoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7CgoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOgogICAgICAgICAgICAKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7CgogICAgICAgICAgICAKICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7CiAgICAgICAgICAgIAoKICAgICAgICByZXR1cm4gYW5zd2VyOwoKICAgIAogICAgZGVmIGZpbmRBbGwoc2VsZiwgX19ldmVudD1Ob25lKToKICAgICAgICBfX3RvU3RyaW5nID0gJ0V2ZW50OjpmaW5kQWxsKCk6ICc7CiAgICAgICAgCiAgICAgICAgZXZKU09OID0gTm9uZTsKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgZXZKU09OID0ganNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7CiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoKICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsKICAgICAgICAKCiAgICAgICAgYW5zd2VyID0gTm9uZTsKCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpbWUoKSkrJ10uRXZlbnQuZmluZEFsbCgpJykubWV0aG9kKCdmaW5kQWxsJykuY2xhc3NOYW1lKCdFdmVudCcpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOwogICAgICAgIAogICAgICAgIGdjLmNvbGxlY3QoKTsKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOwoKICAgICAgICAKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsKICAgICAgICAKICAgICAgICAgICAgYW5zd2VyID0gRXZlbnQoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7CiAgICAgICAgCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsKCgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsKCiAgICAgICAgICAgIAogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsKICAgICAgICAgICAgCgogICAgICAgIHJldHVybiBhbnN3ZXI7CgogICAgCiAgICBkZWYgZmluZChzZWxmLCBfX2V2ZW50PU5vbmUpOgogICAgICAgIF9fdG9TdHJpbmcgPSAnRXZlbnQ6OmZpbmQoKTogJzsKICAgICAgICAKICAgICAgICBldkpTT04gPSBOb25lOwoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBldkpTT04gPSBqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsKICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOgogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOwogICAgICAgIAoKICAgICAgICBhbnN3ZXIgPSBOb25lOwoKICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGltZSgpKSsnXS5FdmVudC5maW5kKCknKS5tZXRob2QoJ2ZpbmQnKS5jbGFzc05hbWUoJ0V2ZW50JykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOwogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7CiAgICAgICAgCiAgICAgICAgZ2MuY29sbGVjdCgpOwoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7CgogICAgICAgIAogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOwogICAgICAgIAogICAgICAgICAgICBhbnN3ZXIgPSBFdmVudCgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsKICAgICAgICAKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOwoKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOwogICAgICAgICAgICAKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOwoKICAgICAgICAgICAgCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOwogICAgICAgICAgICAKCiAgICAgICAgcmV0dXJuIGFuc3dlcjsKCiAgICAKICAgIGRlZiBsaXN0ZW4oc2VsZiwgX19ldmVudD1Ob25lLCBub2RlPU5vbmUpOgogICAgICAgIF9fdG9TdHJpbmcgPSAnRXZlbnQ6Omxpc3RlbigpOiAnOwogICAgICAgIAogICAgICAgIGV2SlNPTiA9IE5vbmU7CgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIGV2SlNPTiA9IGpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOwogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046CiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7CiAgICAgICAgCiAgICAgICAgICAgIGlmICdub2RlJyBpbiBldkpTT046CiAgICAgICAgICAgICAgICBub2RlID0gZXZKU09OWydub2RlJ107CiAgICAgICAgCgogICAgICAgIGFuc3dlciA9IE5vbmU7CgogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aW1lKCkpKyddLkV2ZW50Lmxpc3RlbigpJykubWV0aG9kKCdsaXN0ZW4nKS5jbGFzc05hbWUoJ0V2ZW50JykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOwogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7CiAgICAgICAgCiAgICAgICAgZ2MuY29sbGVjdCgpOwoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7CgogICAgICAgIAogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOwogICAgICAgIAogICAgICAgICAgICBhbnN3ZXIgPSBldkpTT047CiAgICAgICAgCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsKCgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHN0cihhbnN3ZXIpKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsKCiAgICAgICAgICAgIAogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsKICAgICAgICAgICAgCgogICAgICAgIHJldHVybiBhbnN3ZXI7CgogICAgCiAgICBkZWYgdHJpZ2dlcihzZWxmLCBfX2V2ZW50PU5vbmUpOgogICAgICAgIF9fdG9TdHJpbmcgPSAnRXZlbnQ6OnRyaWdnZXIoKTogJzsKICAgICAgICAKICAgICAgICBldkpTT04gPSBOb25lOwoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBldkpTT04gPSBqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsKICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOgogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOwogICAgICAgIAoKICAgICAgICBhbnN3ZXIgPSBOb25lOwoKICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGltZSgpKSsnXS5FdmVudC50cmlnZ2VyKCknKS5tZXRob2QoJ3RyaWdnZXInKS5jbGFzc05hbWUoJ0V2ZW50JykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOwogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7CiAgICAgICAgCiAgICAgICAgZ2MuY29sbGVjdCgpOwoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7CgogICAgICAgIAogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOwogICAgICAgIAogICAgICAgICAgICBhbnN3ZXIgPSBldkpTT047CiAgICAgICAgCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsKCiAgICAgICAgICAgIHJldHVybiBtcXR0X2NsaWVudC5wdWJsaXNoKG1xdHRfdG9waWMsIHNlbGYuX3RvRG9jdW1lbnQoVHJ1ZSkpOwogICAgICAgIAoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOgogICAgICAgICAgICAKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChzdHIoYW5zd2VyKSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7CgogICAgICAgICAgICAKCiAgICAgICAgcmV0dXJuIGFuc3dlcjsKCiAgICAKICAgIGRlZiBwcm9jZXNzKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6CiAgICAgICAgX190b1N0cmluZyA9ICdFdmVudDo6cHJvY2VzcygpOiAnOwogICAgICAgIAogICAgICAgIGV2SlNPTiA9IE5vbmU7CgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIGV2SlNPTiA9IGpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOwogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046CiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7CiAgICAgICAgCgogICAgICAgIGFuc3dlciA9IE5vbmU7CgogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aW1lKCkpKyddLkV2ZW50LnByb2Nlc3MoKScpLm1ldGhvZCgncHJvY2VzcycpLmNsYXNzTmFtZSgnRXZlbnQnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7CiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsKICAgICAgICAKICAgICAgICBnYy5jb2xsZWN0KCk7CgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsKCiAgICAgICAgCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7CiAgICAgICAgCiAgICAgICAgICAgIGFuc3dlciA9IEV2ZW50KCkuX2Zyb21Eb2N1bWVudChldkpTT04pOwogICAgICAgIAoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7CgogICAgICAgICAgICBpZiBzZWxmLnNlbmRlcigpLmNvZGUoKT09bm9kZS5jb2RlKCk6CiAgICAgICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImlnbm9yaW5nIG15IGV2ZW50cyIpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICBlbGlmIHNlbGYucmVjaXBpZW50KCkuY29kZSgpIT1ub2RlLmNvZGUoKToKICAgICAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAibm90IHNlbnQgdG8gbWUiKTsKICAgICAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgICAgIHJldHVybiBnZXRhdHRyKGdsb2JhbHMoKVtzZWxmLmNsYXNzTmFtZSgpXSgpLCBzZWxmLm1ldGhvZCgpKShzZWxmKTsKICAgICAgICAKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOwogICAgICAgICAgICAKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOwoKICAgICAgICAgICAgCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOwogICAgICAgICAgICAKCiAgICAgICAgcmV0dXJuIGFuc3dlcjsKCiAgICAKCgpjbGFzcyBOb2RlKCk6CiAgICBkZWYgX19pbml0X18oc2VsZiwgSWQ9Tm9uZSwgYWN0aXZlPU5vbmUsIGVuYWJsZWQ9Tm9uZSwgY29kZT1Ob25lLCBvcmRlcj1Ob25lLCBkYXRlPU5vbmUsIG5hbWU9Tm9uZSwgcmVtYXJrPU5vbmUsIGFkZHJlc3M9Tm9uZSwgYmFja3VwPU5vbmUsIHBhcmVudD1Ob25lLCBncm91cD1Ob25lLCBjb250ZXh0PU5vbmUsIHBvcnQ9Tm9uZSwgb25saW5lPU5vbmUsIHNlY3VyZT1Ob25lLCB0eXBlPU5vbmUpOgogICAgICAgIHN1cGVyKCkuX19pbml0X18oKTsKCiAgICAgICAgI3ByaW50KCdOb2RlOjpfX2luaXRfXygpJyk7CiAgICAgICAgaWYgSWQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHNlbGYuSWQgPSBJZDsKCiAgICAgICAgCiAgICAgICAgc2VsZi5hY3RpdmUoYWN0aXZlKTsKICAgICAgICBzZWxmLmVuYWJsZWQoZW5hYmxlZCk7CiAgICAgICAgc2VsZi5jb2RlKGNvZGUpOwogICAgICAgIHNlbGYub3JkZXIob3JkZXIpOwogICAgICAgIHNlbGYuZGF0ZShkYXRlKTsKICAgICAgICBzZWxmLm5hbWUobmFtZSk7CiAgICAgICAgc2VsZi5yZW1hcmsocmVtYXJrKTsKICAgICAgICBzZWxmLmFkZHJlc3MoYWRkcmVzcyk7CiAgICAgICAgc2VsZi5iYWNrdXAoYmFja3VwKTsKICAgICAgICBzZWxmLnBhcmVudChwYXJlbnQpOwogICAgICAgIHNlbGYuZ3JvdXAoZ3JvdXApOwogICAgICAgIHNlbGYuY29udGV4dChjb250ZXh0KTsKICAgICAgICBzZWxmLnBvcnQocG9ydCk7CiAgICAgICAgc2VsZi5vbmxpbmUob25saW5lKTsKICAgICAgICBzZWxmLnNlY3VyZShzZWN1cmUpOwogICAgICAgIHNlbGYudHlwZSh0eXBlKTsKICAgICAgICAKICAgIElkID0gTm9uZTsKICAgIAogICAgCiAgICAjIGFjdGl2ZTogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX2FjdGl2ZSA9IE5vbmU7CiAgICBkZWYgYWN0aXZlKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9hY3RpdmUgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fYWN0aXZlOwogICAgCiAgICAjIGVuYWJsZWQ6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9lbmFibGVkID0gTm9uZTsKICAgIGRlZiBlbmFibGVkKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9lbmFibGVkID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2VuYWJsZWQ7CiAgICAKICAgICMgY29kZTogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX2NvZGUgPSBOb25lOwogICAgZGVmIGNvZGUoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2NvZGUgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fY29kZTsKICAgIAogICAgIyBvcmRlcjogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX29yZGVyID0gTm9uZTsKICAgIGRlZiBvcmRlcihzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fb3JkZXIgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fb3JkZXI7CiAgICAKICAgICMgZGF0ZTogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX2RhdGUgPSBOb25lOwogICAgZGVmIGRhdGUoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2RhdGUgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fZGF0ZTsKICAgIAogICAgIyBuYW1lOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfbmFtZSA9IE5vbmU7CiAgICBkZWYgbmFtZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fbmFtZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9uYW1lOwogICAgCiAgICAjIHJlbWFyazogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX3JlbWFyayA9IE5vbmU7CiAgICBkZWYgcmVtYXJrKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9yZW1hcmsgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fcmVtYXJrOwogICAgCiAgICAjIGFkZHJlc3M6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9hZGRyZXNzID0gTm9uZTsKICAgIGRlZiBhZGRyZXNzKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9hZGRyZXNzID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2FkZHJlc3M7CiAgICAKICAgICMgYmFja3VwOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfYmFja3VwID0gTm9uZTsKICAgIGRlZiBiYWNrdXAoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2JhY2t1cCA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9iYWNrdXA7CiAgICAKICAgICMgcGFyZW50OiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfcGFyZW50ID0gTm9uZTsKICAgIGRlZiBwYXJlbnQoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX3BhcmVudCA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9wYXJlbnQ7CiAgICAKICAgICMgZ3JvdXA6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9ncm91cCA9IE5vbmU7CiAgICBkZWYgZ3JvdXAoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2dyb3VwID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2dyb3VwOwogICAgCiAgICAjIGNvbnRleHQ6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9jb250ZXh0ID0gTm9uZTsKICAgIGRlZiBjb250ZXh0KHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9jb250ZXh0ID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2NvbnRleHQ7CiAgICAKICAgICMgcG9ydDogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX3BvcnQgPSBOb25lOwogICAgZGVmIHBvcnQoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX3BvcnQgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fcG9ydDsKICAgIAogICAgIyBvbmxpbmU6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9vbmxpbmUgPSBOb25lOwogICAgZGVmIG9ubGluZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fb25saW5lID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX29ubGluZTsKICAgIAogICAgIyBzZWN1cmU6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9zZWN1cmUgPSBOb25lOwogICAgZGVmIHNlY3VyZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fc2VjdXJlID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3NlY3VyZTsKICAgIAogICAgIyB0eXBlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfdHlwZSA9IE5vbmU7CiAgICBkZWYgdHlwZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fdHlwZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl90eXBlOwogICAgCiAgICAKICAgIAogICAgIyBjb250cm9sbGVyX0RldmljZXM6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9jb250cm9sbGVyX0RldmljZXMgPSBOb25lOwogICAgZGVmIGNvbnRyb2xsZXJfRGV2aWNlcyhzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fY29udHJvbGxlcl9EZXZpY2VzID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2NvbnRyb2xsZXJfRGV2aWNlczsKICAgIAogICAgIyBub2RlX0NvbmZpZ3M6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9ub2RlX0NvbmZpZ3MgPSBOb25lOwogICAgZGVmIG5vZGVfQ29uZmlncyhzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fbm9kZV9Db25maWdzID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX25vZGVfQ29uZmlnczsKICAgIAogICAgIyBjYXJyaWVyX0V2ZW50czogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX2NhcnJpZXJfRXZlbnRzID0gTm9uZTsKICAgIGRlZiBjYXJyaWVyX0V2ZW50cyhzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fY2Fycmllcl9FdmVudHMgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fY2Fycmllcl9FdmVudHM7CiAgICAKICAgICMgc2VuZGVyX0V2ZW50czogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX3NlbmRlcl9FdmVudHMgPSBOb25lOwogICAgZGVmIHNlbmRlcl9FdmVudHMoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX3NlbmRlcl9FdmVudHMgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fc2VuZGVyX0V2ZW50czsKICAgIAogICAgIyByZWNpcGllbnRfRXZlbnRzOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfcmVjaXBpZW50X0V2ZW50cyA9IE5vbmU7CiAgICBkZWYgcmVjaXBpZW50X0V2ZW50cyhzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fcmVjaXBpZW50X0V2ZW50cyA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9yZWNpcGllbnRfRXZlbnRzOwogICAgCiAgICAjIGJhY2t1cF9Ob2RlczogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX2JhY2t1cF9Ob2RlcyA9IE5vbmU7CiAgICBkZWYgYmFja3VwX05vZGVzKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9iYWNrdXBfTm9kZXMgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fYmFja3VwX05vZGVzOwogICAgCiAgICAjIHBhcmVudF9Ob2RlczogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX3BhcmVudF9Ob2RlcyA9IE5vbmU7CiAgICBkZWYgcGFyZW50X05vZGVzKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9wYXJlbnRfTm9kZXMgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fcGFyZW50X05vZGVzOwogICAgCiAgICAKICAgIGRlZiBfZnJvbURvY3VtZW50KHNlbGYsIG9iaik6CiAgICAgICAgX190b1N0cmluZyA9ICdOb2RlOjpfZnJvbURvY3VtZW50KCk6ICc7CiAgICAgICAgCiAgICAgICAgaWYgb2JqIGlzIE5vbmU6CiAgICAgICAgICAgIHJldHVybiBzZWxmOwoKICAgICAgICBpZiBpc2luc3RhbmNlKG9iaiwgYnl0ZXMpOgogICAgICAgICAgICBvYmogPSBzdHIob2JqLCAidXRmLTgiKTsKCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIHN0cikgb3IgdHlwZShvYmopIGlzIHN0cjoKICAgICAgICAgICAgaWYgcmUubWF0Y2gociIoKChbQS1aYS16XXszLDl9Oig/OlwvXC8pPykoPzpbLTs6Jj1cK1wkLFx3XStAKT9bQS1aYS16MC05Li1dK3woPzp3d3cufFstOzomPVwrXCQsXHddK0ApW0EtWmEtejAtOS4tXSspKCg/OlwvW1wrfiVcLy5cd1wtX10qKT9cPz8oPzpbLVwrPSY7JUAuXHdfXSopIz8oPzpbXHddKikpPykiLCBvYmopOgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIG9iaiA9IGpzb24ubG9hZHModXJsbGliMy5Qb29sTWFuYWdlcigpLnJlcXVlc3QoJ0dFVCcsIG9iaikuZGF0YS5kZWNvZGUoJ3V0Zi04JykpOwogICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgIG9iaiA9IHt9OwogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgb2JqID0ganNvbi5sb2FkcyhvYmopOwogICAgICAgIAogICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLCBsaXN0KToKICAgICAgICAgICAgcmV0dXJuIFtOb2RlKCkuX2Zyb21Eb2N1bWVudChvKSBmb3IgbyBpbiBvYmpdOwogICAgICAgICAgICAKICAgICAgICBpZiBub3QgaXNpbnN0YW5jZShvYmosIChzdHIsIGJ5dGVzLCBkaWN0KSk6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAndW5oYW5kbGVkIHR5cGU6ICcgKyBzdHIodHlwZShvYmopKSk7CiAgICAgICAgICAgIHJldHVybiBvYmo7CgogICAgICAgIGlmICdJZCcgaW4gb2JqOgogICAgICAgICAgICBzZWxmLklkID0gb2JqWydJZCddOwoKICAgIAogICAgICAgIGlmICdhY3RpdmUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5hY3RpdmUob2JqWydhY3RpdmUnXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnZW5hYmxlZCcgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmVuYWJsZWQob2JqWydlbmFibGVkJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ2NvZGUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5jb2RlKG9ialsnY29kZSddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdvcmRlcicgaW4gb2JqOgogICAgICAgICAgICBzZWxmLm9yZGVyKG9ialsnb3JkZXInXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnZGF0ZScgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmRhdGUob2JqWydkYXRlJ10pOwogICAgICAgIAogICAgICAgICAgICBzZWxmLmRhdGUoZGF0ZXRpbWUuZGF0ZXRpbWUuZnJvbWlzb2Zvcm1hdChzZWxmLmRhdGUoKSkpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ25hbWUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5uYW1lKG9ialsnbmFtZSddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdyZW1hcmsnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5yZW1hcmsob2JqWydyZW1hcmsnXSk7CiAgICAgICAgCiAgICAgICAgICAgIHNlbGYucmVtYXJrKCBiYXNlNjQuYjY0ZGVjb2RlKHNlbGYucmVtYXJrKCkpICk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnYWRkcmVzcycgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmFkZHJlc3Mob2JqWydhZGRyZXNzJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ2JhY2t1cCcgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmJhY2t1cChOb2RlKCkuX2Zyb21Eb2N1bWVudChvYmpbJ2JhY2t1cCddKSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAncGFyZW50JyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYucGFyZW50KE5vZGUoKS5fZnJvbURvY3VtZW50KG9ialsncGFyZW50J10pKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdncm91cCcgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmdyb3VwKE5vZGVfR3JvdXAoKS5fZnJvbURvY3VtZW50KG9ialsnZ3JvdXAnXSkpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ2NvbnRleHQnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5jb250ZXh0KE5vZGVfQ29udGV4dCgpLl9mcm9tRG9jdW1lbnQob2JqWydjb250ZXh0J10pKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdwb3J0JyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYucG9ydChvYmpbJ3BvcnQnXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnb25saW5lJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYub25saW5lKG9ialsnb25saW5lJ10pOwogICAgICAgIAogICAgICAgICAgICBzZWxmLm9ubGluZShkYXRldGltZS5kYXRldGltZS5mcm9taXNvZm9ybWF0KHNlbGYub25saW5lKCkpKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdzZWN1cmUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5zZWN1cmUob2JqWydzZWN1cmUnXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAndHlwZScgaW4gb2JqOgogICAgICAgICAgICBzZWxmLnR5cGUoTm9kZV9UeXBlKCkuX2Zyb21Eb2N1bWVudChvYmpbJ3R5cGUnXSkpOwogICAgICAgIAogICAgCgogICAgCiAgICAgICAgaWYgJ2NvbnRyb2xsZXJfRGV2aWNlcycgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmNvbnRyb2xsZXJfRGV2aWNlcyhEZXZpY2UoKS5fZnJvbURvY3VtZW50KG9ialsnY29udHJvbGxlcl9EZXZpY2VzJ10pKTsKICAgIAogICAgICAgIGlmICdub2RlX0NvbmZpZ3MnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5ub2RlX0NvbmZpZ3MoQ29uZmlnKCkuX2Zyb21Eb2N1bWVudChvYmpbJ25vZGVfQ29uZmlncyddKSk7CiAgICAKICAgICAgICBpZiAnY2Fycmllcl9FdmVudHMnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5jYXJyaWVyX0V2ZW50cyhFdmVudCgpLl9mcm9tRG9jdW1lbnQob2JqWydjYXJyaWVyX0V2ZW50cyddKSk7CiAgICAKICAgICAgICBpZiAnc2VuZGVyX0V2ZW50cycgaW4gb2JqOgogICAgICAgICAgICBzZWxmLnNlbmRlcl9FdmVudHMoRXZlbnQoKS5fZnJvbURvY3VtZW50KG9ialsnc2VuZGVyX0V2ZW50cyddKSk7CiAgICAKICAgICAgICBpZiAncmVjaXBpZW50X0V2ZW50cycgaW4gb2JqOgogICAgICAgICAgICBzZWxmLnJlY2lwaWVudF9FdmVudHMoRXZlbnQoKS5fZnJvbURvY3VtZW50KG9ialsncmVjaXBpZW50X0V2ZW50cyddKSk7CiAgICAKICAgICAgICBpZiAnYmFja3VwX05vZGVzJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuYmFja3VwX05vZGVzKE5vZGUoKS5fZnJvbURvY3VtZW50KG9ialsnYmFja3VwX05vZGVzJ10pKTsKICAgIAogICAgICAgIGlmICdwYXJlbnRfTm9kZXMnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5wYXJlbnRfTm9kZXMoTm9kZSgpLl9mcm9tRG9jdW1lbnQob2JqWydwYXJlbnRfTm9kZXMnXSkpOwogICAgCgogICAgICAgIGdjLmNvbGxlY3QoKTsKICAgICAgICByZXR1cm4gc2VsZjsKICAgIAogICAgZGVmIF90b0RvY3VtZW50KHNlbGYsIGJKU09OPU5vbmUpOgogICAgICAgIF9fdG9TdHJpbmcgPSAnTm9kZTo6X3RvRG9jdW1lbnQoKTogJzsKCiAgICAgICAgcmV0ID0ge307CiAgICAgICAgaWYgc2VsZi5JZCBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJJZCJdID0gc2VsZi5JZDsKCiAgICAKICAgICAgICBpZiBzZWxmLmFjdGl2ZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbImFjdGl2ZSJdID0gc2VsZi5hY3RpdmUoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYuZW5hYmxlZCgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbImVuYWJsZWQiXSA9IHNlbGYuZW5hYmxlZCgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5jb2RlKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiY29kZSJdID0gc2VsZi5jb2RlKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLm9yZGVyKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsib3JkZXIiXSA9IHNlbGYub3JkZXIoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYuZGF0ZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbImRhdGUiXSA9IHNlbGYuZGF0ZSgpOwogICAgICAgIAogICAgICAgICAgICBpZiBpc2luc3RhbmNlKHJldFsiZGF0ZSJdLCBkYXRldGltZS5kYXRldGltZSk6CiAgICAgICAgICAgICAgICByZXRbImRhdGUiXSA9IHJldFsiZGF0ZSJdLmlzb2Zvcm1hdCgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5uYW1lKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsibmFtZSJdID0gc2VsZi5uYW1lKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLnJlbWFyaygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbInJlbWFyayJdID0gc2VsZi5yZW1hcmsoKTsKICAgICAgICAKICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShyZXRbInJlbWFyayJdLCBkaWN0KToKICAgICAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSBqc29uLmR1bXBzKHJldFsicmVtYXJrIl0pLmVuY29kZSgndXRmLTgnKTsKCiAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSAgYmFzZTY0LmI2NGVuY29kZShyZXRbInJlbWFyayJdKS5kZWNvZGUoJ3V0Zi04Jykuc3RyaXAoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYuYWRkcmVzcygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbImFkZHJlc3MiXSA9IHNlbGYuYWRkcmVzcygpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5iYWNrdXAoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJiYWNrdXAiXSA9IHNlbGYuYmFja3VwKCkuX3RvRG9jdW1lbnQoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYucGFyZW50KCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsicGFyZW50Il0gPSBzZWxmLnBhcmVudCgpLl90b0RvY3VtZW50KCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLmdyb3VwKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiZ3JvdXAiXSA9IHNlbGYuZ3JvdXAoKS5fdG9Eb2N1bWVudCgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5jb250ZXh0KCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiY29udGV4dCJdID0gc2VsZi5jb250ZXh0KCkuX3RvRG9jdW1lbnQoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYucG9ydCgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbInBvcnQiXSA9IHNlbGYucG9ydCgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5vbmxpbmUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJvbmxpbmUiXSA9IHNlbGYub25saW5lKCk7CiAgICAgICAgCiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UocmV0WyJvbmxpbmUiXSwgZGF0ZXRpbWUuZGF0ZXRpbWUpOgogICAgICAgICAgICAgICAgcmV0WyJvbmxpbmUiXSA9IHJldFsib25saW5lIl0uaXNvZm9ybWF0KCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLnNlY3VyZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbInNlY3VyZSJdID0gc2VsZi5zZWN1cmUoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYudHlwZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbInR5cGUiXSA9IHNlbGYudHlwZSgpLl90b0RvY3VtZW50KCk7CiAgICAgICAgCiAgICAKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYuY29udHJvbGxlcl9EZXZpY2VzKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiY29udHJvbGxlcl9EZXZpY2VzIl0gPSBbdGEuX3RvRG9jdW1lbnQoKSBmb3IgdGEgaW4gc2VsZi5jb250cm9sbGVyX0RldmljZXMoKV07CiAgICAKICAgICAgICBpZiBzZWxmLm5vZGVfQ29uZmlncygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbIm5vZGVfQ29uZmlncyJdID0gW3RhLl90b0RvY3VtZW50KCkgZm9yIHRhIGluIHNlbGYubm9kZV9Db25maWdzKCldOwogICAgCiAgICAgICAgaWYgc2VsZi5jYXJyaWVyX0V2ZW50cygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbImNhcnJpZXJfRXZlbnRzIl0gPSBbdGEuX3RvRG9jdW1lbnQoKSBmb3IgdGEgaW4gc2VsZi5jYXJyaWVyX0V2ZW50cygpXTsKICAgIAogICAgICAgIGlmIHNlbGYuc2VuZGVyX0V2ZW50cygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbInNlbmRlcl9FdmVudHMiXSA9IFt0YS5fdG9Eb2N1bWVudCgpIGZvciB0YSBpbiBzZWxmLnNlbmRlcl9FdmVudHMoKV07CiAgICAKICAgICAgICBpZiBzZWxmLnJlY2lwaWVudF9FdmVudHMoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJyZWNpcGllbnRfRXZlbnRzIl0gPSBbdGEuX3RvRG9jdW1lbnQoKSBmb3IgdGEgaW4gc2VsZi5yZWNpcGllbnRfRXZlbnRzKCldOwogICAgCiAgICAgICAgaWYgc2VsZi5iYWNrdXBfTm9kZXMoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJiYWNrdXBfTm9kZXMiXSA9IFt0YS5fdG9Eb2N1bWVudCgpIGZvciB0YSBpbiBzZWxmLmJhY2t1cF9Ob2RlcygpXTsKICAgIAogICAgICAgIGlmIHNlbGYucGFyZW50X05vZGVzKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsicGFyZW50X05vZGVzIl0gPSBbdGEuX3RvRG9jdW1lbnQoKSBmb3IgdGEgaW4gc2VsZi5wYXJlbnRfTm9kZXMoKV07CiAgICAKCiAgICAgICAgaWYgYkpTT04gaXMgbm90IE5vbmU6CiAgICAgICAgICAgICNwcmludChfX3RvU3RyaW5nICsgIkdPVCBIRVJFIiwgdHlwZShyZXQpLCByZXQpOwogICAgICAgICAgICByZXQgPSBqc29uLmR1bXBzKHJldCk7CiAgICAgICAgZ2MuY29sbGVjdCgpOwogICAgICAgIHJldHVybiByZXQ7CgogICAgCiAgICBkZWYgc3RvcmUoc2VsZiwgX19ldmVudD1Ob25lKToKICAgICAgICBfX3RvU3RyaW5nID0gJ05vZGU6OnN0b3JlKCk6ICc7CiAgICAgICAgCiAgICAgICAgZXZKU09OID0gTm9uZTsKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgZXZKU09OID0ganNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7CiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoKICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsKICAgICAgICAKCiAgICAgICAgYW5zd2VyID0gTm9uZTsKCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpbWUoKSkrJ10uTm9kZS5zdG9yZSgpJykubWV0aG9kKCdzdG9yZScpLmNsYXNzTmFtZSgnTm9kZScpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOwogICAgICAgIAogICAgICAgIGdjLmNvbGxlY3QoKTsKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOwoKICAgICAgICAKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsKICAgICAgICAKICAgICAgICAgICAgYW5zd2VyID0gTm9kZSgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsKICAgICAgICAKCiAgICAgICAgICAgIE1ldHJpYygpLmRldmljZVR5cGUoRGV2aWNlX1R5cGUoKS50eXBlX0RldmljZXMoW0RldmljZSgpLmNvbnRyb2xsZXIobm9kZSldKSkuZmluZEFsbCgpOwoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7CgoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOgogICAgICAgICAgICAKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7CgogICAgICAgICAgICAKICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7CiAgICAgICAgICAgIAoKICAgICAgICByZXR1cm4gYW5zd2VyOwoKICAgIAogICAgZGVmIGZpbmRBbGwoc2VsZiwgX19ldmVudD1Ob25lKToKICAgICAgICBfX3RvU3RyaW5nID0gJ05vZGU6OmZpbmRBbGwoKTogJzsKICAgICAgICAKICAgICAgICBldkpTT04gPSBOb25lOwoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBldkpTT04gPSBqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsKICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOgogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOwogICAgICAgIAoKICAgICAgICBhbnN3ZXIgPSBOb25lOwoKICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGltZSgpKSsnXS5Ob2RlLmZpbmRBbGwoKScpLm1ldGhvZCgnZmluZEFsbCcpLmNsYXNzTmFtZSgnTm9kZScpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOwogICAgICAgIAogICAgICAgIGdjLmNvbGxlY3QoKTsKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOwoKICAgICAgICAKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsKICAgICAgICAKICAgICAgICAgICAgYW5zd2VyID0gTm9kZSgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsKICAgICAgICAKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOwoKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOwogICAgICAgICAgICAKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOwoKICAgICAgICAgICAgCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOwogICAgICAgICAgICAKCiAgICAgICAgcmV0dXJuIGFuc3dlcjsKCiAgICAKICAgIGRlZiBmaW5kKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6CiAgICAgICAgX190b1N0cmluZyA9ICdOb2RlOjpmaW5kKCk6ICc7CiAgICAgICAgCiAgICAgICAgZXZKU09OID0gTm9uZTsKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgZXZKU09OID0ganNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7CiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoKICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsKICAgICAgICAKCiAgICAgICAgYW5zd2VyID0gTm9uZTsKCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpbWUoKSkrJ10uTm9kZS5maW5kKCknKS5tZXRob2QoJ2ZpbmQnKS5jbGFzc05hbWUoJ05vZGUnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7CiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsKICAgICAgICAKICAgICAgICBnYy5jb2xsZWN0KCk7CgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsKCiAgICAgICAgCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7CiAgICAgICAgCiAgICAgICAgICAgIGFuc3dlciA9IE5vZGUoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7CiAgICAgICAgCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsKCgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsKCiAgICAgICAgICAgIAogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsKICAgICAgICAgICAgCgogICAgICAgIHJldHVybiBhbnN3ZXI7CgogICAgCiAgICBkZWYgYXV0aENvZGUoc2VsZiwgX19ldmVudD1Ob25lLCBjb2RlPU5vbmUsIHRvb2w9Tm9uZSk6CiAgICAgICAgX190b1N0cmluZyA9ICdOb2RlOjphdXRoQ29kZSgpOiAnOwogICAgICAgIAogICAgICAgIGV2SlNPTiA9IE5vbmU7CgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIGV2SlNPTiA9IGpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOwogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046CiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7CiAgICAgICAgCiAgICAgICAgICAgIGlmICdjb2RlJyBpbiBldkpTT046CiAgICAgICAgICAgICAgICBjb2RlID0gZXZKU09OWydjb2RlJ107CiAgICAgICAgCiAgICAgICAgICAgIGlmICd0b29sJyBpbiBldkpTT046CiAgICAgICAgICAgICAgICB0b29sID0gZXZKU09OWyd0b29sJ107CiAgICAgICAgCgogICAgICAgIGFuc3dlciA9IE5vbmU7CgogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aW1lKCkpKyddLk5vZGUuYXV0aENvZGUoKScpLm1ldGhvZCgnYXV0aENvZGUnKS5jbGFzc05hbWUoJ05vZGUnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7CiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsKICAgICAgICAKICAgICAgICBnYy5jb2xsZWN0KCk7CgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsKCiAgICAgICAgCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7CiAgICAgICAgCiAgICAgICAgICAgIGFuc3dlciA9IGV2SlNPTjsKICAgICAgICAKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOwoKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoc3RyKGFuc3dlcikpOwogICAgICAgICAgICAKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOwoKICAgICAgICAgICAgCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOwogICAgICAgICAgICAKCiAgICAgICAgcmV0dXJuIGFuc3dlcjsKCiAgICAKICAgIGRlZiBpbml0KHNlbGYsIF9fZXZlbnQ9Tm9uZSwgb25saW5lPU5vbmUsIGNvZGU9Tm9uZSwgdWlkPU5vbmUpOgogICAgICAgIF9fdG9TdHJpbmcgPSAnTm9kZTo6aW5pdCgpOiAnOwogICAgICAgIAogICAgICAgIGV2SlNPTiA9IE5vbmU7CgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIGV2SlNPTiA9IGpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOwogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046CiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7CiAgICAgICAgCiAgICAgICAgICAgIGlmICdvbmxpbmUnIGluIGV2SlNPTjoKICAgICAgICAgICAgICAgIG9ubGluZSA9IGV2SlNPTlsnb25saW5lJ107CiAgICAgICAgCiAgICAgICAgICAgIGlmICdjb2RlJyBpbiBldkpTT046CiAgICAgICAgICAgICAgICBjb2RlID0gZXZKU09OWydjb2RlJ107CiAgICAgICAgCiAgICAgICAgICAgIGlmICd1aWQnIGluIGV2SlNPTjoKICAgICAgICAgICAgICAgIHVpZCA9IGV2SlNPTlsndWlkJ107CiAgICAgICAgCgogICAgICAgIGFuc3dlciA9IE5vbmU7CgogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aW1lKCkpKyddLk5vZGUuaW5pdCgpJykubWV0aG9kKCdpbml0JykuY2xhc3NOYW1lKCdOb2RlJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOwogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7CiAgICAgICAgCiAgICAgICAgZ2MuY29sbGVjdCgpOwoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7CgogICAgICAgIAogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOwogICAgICAgIAogICAgICAgICAgICBhbnN3ZXIgPSBOb2RlKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOwogICAgICAgIAoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7CgoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOgogICAgICAgICAgICAKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7CgogICAgICAgICAgICAKICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7CiAgICAgICAgICAgIAoKICAgICAgICByZXR1cm4gYW5zd2VyOwoKICAgIAoKCmNsYXNzIE5vZGVfQ29udGV4dCgpOgogICAgZGVmIF9faW5pdF9fKHNlbGYsIElkPU5vbmUsIGFjdGl2ZT1Ob25lLCBlbmFibGVkPU5vbmUsIGNvZGU9Tm9uZSwgb3JkZXI9Tm9uZSwgZGF0ZT1Ob25lLCBuYW1lPU5vbmUsIHJlbWFyaz1Ob25lKToKICAgICAgICBzdXBlcigpLl9faW5pdF9fKCk7CgogICAgICAgICNwcmludCgnTm9kZV9Db250ZXh0OjpfX2luaXRfXygpJyk7CiAgICAgICAgaWYgSWQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHNlbGYuSWQgPSBJZDsKCiAgICAgICAgCiAgICAgICAgc2VsZi5hY3RpdmUoYWN0aXZlKTsKICAgICAgICBzZWxmLmVuYWJsZWQoZW5hYmxlZCk7CiAgICAgICAgc2VsZi5jb2RlKGNvZGUpOwogICAgICAgIHNlbGYub3JkZXIob3JkZXIpOwogICAgICAgIHNlbGYuZGF0ZShkYXRlKTsKICAgICAgICBzZWxmLm5hbWUobmFtZSk7CiAgICAgICAgc2VsZi5yZW1hcmsocmVtYXJrKTsKICAgICAgICAKICAgIElkID0gTm9uZTsKICAgIAogICAgCiAgICAjIGFjdGl2ZTogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX2FjdGl2ZSA9IE5vbmU7CiAgICBkZWYgYWN0aXZlKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9hY3RpdmUgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fYWN0aXZlOwogICAgCiAgICAjIGVuYWJsZWQ6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9lbmFibGVkID0gTm9uZTsKICAgIGRlZiBlbmFibGVkKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9lbmFibGVkID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2VuYWJsZWQ7CiAgICAKICAgICMgY29kZTogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX2NvZGUgPSBOb25lOwogICAgZGVmIGNvZGUoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2NvZGUgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fY29kZTsKICAgIAogICAgIyBvcmRlcjogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX29yZGVyID0gTm9uZTsKICAgIGRlZiBvcmRlcihzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fb3JkZXIgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fb3JkZXI7CiAgICAKICAgICMgZGF0ZTogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX2RhdGUgPSBOb25lOwogICAgZGVmIGRhdGUoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2RhdGUgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fZGF0ZTsKICAgIAogICAgIyBuYW1lOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfbmFtZSA9IE5vbmU7CiAgICBkZWYgbmFtZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fbmFtZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9uYW1lOwogICAgCiAgICAjIHJlbWFyazogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX3JlbWFyayA9IE5vbmU7CiAgICBkZWYgcmVtYXJrKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9yZW1hcmsgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fcmVtYXJrOwogICAgCiAgICAKICAgIAogICAgIyBjb250ZXh0X05vZGVzOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfY29udGV4dF9Ob2RlcyA9IE5vbmU7CiAgICBkZWYgY29udGV4dF9Ob2RlcyhzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fY29udGV4dF9Ob2RlcyA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9jb250ZXh0X05vZGVzOwogICAgCiAgICAKICAgIGRlZiBfZnJvbURvY3VtZW50KHNlbGYsIG9iaik6CiAgICAgICAgX190b1N0cmluZyA9ICdOb2RlX0NvbnRleHQ6Ol9mcm9tRG9jdW1lbnQoKTogJzsKICAgICAgICAKICAgICAgICBpZiBvYmogaXMgTm9uZToKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CgogICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLCBieXRlcyk6CiAgICAgICAgICAgIG9iaiA9IHN0cihvYmosICJ1dGYtOCIpOwoKICAgICAgICBpZiBpc2luc3RhbmNlKG9iaiwgc3RyKSBvciB0eXBlKG9iaikgaXMgc3RyOgogICAgICAgICAgICBpZiByZS5tYXRjaChyIigoKFtBLVphLXpdezMsOX06KD86XC9cLyk/KSg/OlstOzomPVwrXCQsXHddK0ApP1tBLVphLXowLTkuLV0rfCg/Ond3dy58Wy07OiY9XCtcJCxcd10rQClbQS1aYS16MC05Li1dKykoKD86XC9bXCt+JVwvLlx3XC1fXSopP1w/Pyg/OlstXCs9JjslQC5cd19dKikjPyg/Oltcd10qKSk/KSIsIG9iaik6CiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgb2JqID0ganNvbi5sb2Fkcyh1cmxsaWIzLlBvb2xNYW5hZ2VyKCkucmVxdWVzdCgnR0VUJywgb2JqKS5kYXRhLmRlY29kZSgndXRmLTgnKSk7CiAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgb2JqID0ge307CiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBvYmogPSBqc29uLmxvYWRzKG9iaik7CiAgICAgICAgCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIGxpc3QpOgogICAgICAgICAgICByZXR1cm4gW05vZGVfQ29udGV4dCgpLl9mcm9tRG9jdW1lbnQobykgZm9yIG8gaW4gb2JqXTsKICAgICAgICAgICAgCiAgICAgICAgaWYgbm90IGlzaW5zdGFuY2Uob2JqLCAoc3RyLCBieXRlcywgZGljdCkpOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJ3VuaGFuZGxlZCB0eXBlOiAnICsgc3RyKHR5cGUob2JqKSkpOwogICAgICAgICAgICByZXR1cm4gb2JqOwoKICAgICAgICBpZiAnSWQnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5JZCA9IG9ialsnSWQnXTsKCiAgICAKICAgICAgICBpZiAnYWN0aXZlJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuYWN0aXZlKG9ialsnYWN0aXZlJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ2VuYWJsZWQnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5lbmFibGVkKG9ialsnZW5hYmxlZCddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdjb2RlJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuY29kZShvYmpbJ2NvZGUnXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnb3JkZXInIGluIG9iajoKICAgICAgICAgICAgc2VsZi5vcmRlcihvYmpbJ29yZGVyJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ2RhdGUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5kYXRlKG9ialsnZGF0ZSddKTsKICAgICAgICAKICAgICAgICAgICAgc2VsZi5kYXRlKGRhdGV0aW1lLmRhdGV0aW1lLmZyb21pc29mb3JtYXQoc2VsZi5kYXRlKCkpKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICduYW1lJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYubmFtZShvYmpbJ25hbWUnXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAncmVtYXJrJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYucmVtYXJrKG9ialsncmVtYXJrJ10pOwogICAgICAgIAogICAgICAgICAgICBzZWxmLnJlbWFyayggYmFzZTY0LmI2NGRlY29kZShzZWxmLnJlbWFyaygpKSApOwogICAgICAgIAogICAgCgogICAgCiAgICAgICAgaWYgJ2NvbnRleHRfTm9kZXMnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5jb250ZXh0X05vZGVzKE5vZGUoKS5fZnJvbURvY3VtZW50KG9ialsnY29udGV4dF9Ob2RlcyddKSk7CiAgICAKCiAgICAgICAgZ2MuY29sbGVjdCgpOwogICAgICAgIHJldHVybiBzZWxmOwogICAgCiAgICBkZWYgX3RvRG9jdW1lbnQoc2VsZiwgYkpTT049Tm9uZSk6CiAgICAgICAgX190b1N0cmluZyA9ICdOb2RlX0NvbnRleHQ6Ol90b0RvY3VtZW50KCk6ICc7CgogICAgICAgIHJldCA9IHt9OwogICAgICAgIGlmIHNlbGYuSWQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiSWQiXSA9IHNlbGYuSWQ7CgogICAgCiAgICAgICAgaWYgc2VsZi5hY3RpdmUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJhY3RpdmUiXSA9IHNlbGYuYWN0aXZlKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLmVuYWJsZWQoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJlbmFibGVkIl0gPSBzZWxmLmVuYWJsZWQoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYuY29kZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbImNvZGUiXSA9IHNlbGYuY29kZSgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5vcmRlcigpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbIm9yZGVyIl0gPSBzZWxmLm9yZGVyKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLmRhdGUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJkYXRlIl0gPSBzZWxmLmRhdGUoKTsKICAgICAgICAKICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShyZXRbImRhdGUiXSwgZGF0ZXRpbWUuZGF0ZXRpbWUpOgogICAgICAgICAgICAgICAgcmV0WyJkYXRlIl0gPSByZXRbImRhdGUiXS5pc29mb3JtYXQoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYubmFtZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbIm5hbWUiXSA9IHNlbGYubmFtZSgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5yZW1hcmsoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IHNlbGYucmVtYXJrKCk7CiAgICAgICAgCiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UocmV0WyJyZW1hcmsiXSwgZGljdCk6CiAgICAgICAgICAgICAgICByZXRbInJlbWFyayJdID0ganNvbi5kdW1wcyhyZXRbInJlbWFyayJdKS5lbmNvZGUoJ3V0Zi04Jyk7CgogICAgICAgICAgICByZXRbInJlbWFyayJdID0gIGJhc2U2NC5iNjRlbmNvZGUocmV0WyJyZW1hcmsiXSkuZGVjb2RlKCd1dGYtOCcpLnN0cmlwKCk7CiAgICAgICAgCiAgICAKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYuY29udGV4dF9Ob2RlcygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbImNvbnRleHRfTm9kZXMiXSA9IFt0YS5fdG9Eb2N1bWVudCgpIGZvciB0YSBpbiBzZWxmLmNvbnRleHRfTm9kZXMoKV07CiAgICAKCiAgICAgICAgaWYgYkpTT04gaXMgbm90IE5vbmU6CiAgICAgICAgICAgICNwcmludChfX3RvU3RyaW5nICsgIkdPVCBIRVJFIiwgdHlwZShyZXQpLCByZXQpOwogICAgICAgICAgICByZXQgPSBqc29uLmR1bXBzKHJldCk7CiAgICAgICAgZ2MuY29sbGVjdCgpOwogICAgICAgIHJldHVybiByZXQ7CgogICAgCiAgICBkZWYgc3RvcmUoc2VsZiwgX19ldmVudD1Ob25lKToKICAgICAgICBfX3RvU3RyaW5nID0gJ05vZGVfQ29udGV4dDo6c3RvcmUoKTogJzsKICAgICAgICAKICAgICAgICBldkpTT04gPSBOb25lOwoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBldkpTT04gPSBqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsKICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOgogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOwogICAgICAgIAoKICAgICAgICBhbnN3ZXIgPSBOb25lOwoKICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGltZSgpKSsnXS5Ob2RlX0NvbnRleHQuc3RvcmUoKScpLm1ldGhvZCgnc3RvcmUnKS5jbGFzc05hbWUoJ05vZGVfQ29udGV4dCcpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOwogICAgICAgIAogICAgICAgIGdjLmNvbGxlY3QoKTsKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOwoKICAgICAgICAKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsKICAgICAgICAKICAgICAgICAgICAgYW5zd2VyID0gTm9kZV9Db250ZXh0KCkuX2Zyb21Eb2N1bWVudChldkpTT04pOwogICAgICAgIAoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7CgoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOgogICAgICAgICAgICAKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7CgogICAgICAgICAgICAKICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7CiAgICAgICAgICAgIAoKICAgICAgICByZXR1cm4gYW5zd2VyOwoKICAgIAogICAgZGVmIGZpbmRBbGwoc2VsZiwgX19ldmVudD1Ob25lKToKICAgICAgICBfX3RvU3RyaW5nID0gJ05vZGVfQ29udGV4dDo6ZmluZEFsbCgpOiAnOwogICAgICAgIAogICAgICAgIGV2SlNPTiA9IE5vbmU7CgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIGV2SlNPTiA9IGpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOwogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046CiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7CiAgICAgICAgCgogICAgICAgIGFuc3dlciA9IE5vbmU7CgogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aW1lKCkpKyddLk5vZGVfQ29udGV4dC5maW5kQWxsKCknKS5tZXRob2QoJ2ZpbmRBbGwnKS5jbGFzc05hbWUoJ05vZGVfQ29udGV4dCcpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOwogICAgICAgIAogICAgICAgIGdjLmNvbGxlY3QoKTsKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOwoKICAgICAgICAKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsKICAgICAgICAKICAgICAgICAgICAgYW5zd2VyID0gTm9kZV9Db250ZXh0KCkuX2Zyb21Eb2N1bWVudChldkpTT04pOwogICAgICAgIAoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7CgoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOgogICAgICAgICAgICAKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7CgogICAgICAgICAgICAKICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7CiAgICAgICAgICAgIAoKICAgICAgICByZXR1cm4gYW5zd2VyOwoKICAgIAogICAgZGVmIGZpbmQoc2VsZiwgX19ldmVudD1Ob25lKToKICAgICAgICBfX3RvU3RyaW5nID0gJ05vZGVfQ29udGV4dDo6ZmluZCgpOiAnOwogICAgICAgIAogICAgICAgIGV2SlNPTiA9IE5vbmU7CgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIGV2SlNPTiA9IGpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOwogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046CiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7CiAgICAgICAgCgogICAgICAgIGFuc3dlciA9IE5vbmU7CgogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aW1lKCkpKyddLk5vZGVfQ29udGV4dC5maW5kKCknKS5tZXRob2QoJ2ZpbmQnKS5jbGFzc05hbWUoJ05vZGVfQ29udGV4dCcpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOwogICAgICAgIAogICAgICAgIGdjLmNvbGxlY3QoKTsKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOwoKICAgICAgICAKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsKICAgICAgICAKICAgICAgICAgICAgYW5zd2VyID0gTm9kZV9Db250ZXh0KCkuX2Zyb21Eb2N1bWVudChldkpTT04pOwogICAgICAgIAoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7CgoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOgogICAgICAgICAgICAKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7CgogICAgICAgICAgICAKICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7CiAgICAgICAgICAgIAoKICAgICAgICByZXR1cm4gYW5zd2VyOwoKICAgIAoKCmNsYXNzIE5vZGVfR3JvdXAoKToKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBJZD1Ob25lLCBhY3RpdmU9Tm9uZSwgZW5hYmxlZD1Ob25lLCBjb2RlPU5vbmUsIG9yZGVyPU5vbmUsIGRhdGU9Tm9uZSwgbmFtZT1Ob25lLCByZW1hcms9Tm9uZSk6CiAgICAgICAgc3VwZXIoKS5fX2luaXRfXygpOwoKICAgICAgICAjcHJpbnQoJ05vZGVfR3JvdXA6Ol9faW5pdF9fKCknKTsKICAgICAgICBpZiBJZCBpcyBub3QgTm9uZToKICAgICAgICAgICAgc2VsZi5JZCA9IElkOwoKICAgICAgICAKICAgICAgICBzZWxmLmFjdGl2ZShhY3RpdmUpOwogICAgICAgIHNlbGYuZW5hYmxlZChlbmFibGVkKTsKICAgICAgICBzZWxmLmNvZGUoY29kZSk7CiAgICAgICAgc2VsZi5vcmRlcihvcmRlcik7CiAgICAgICAgc2VsZi5kYXRlKGRhdGUpOwogICAgICAgIHNlbGYubmFtZShuYW1lKTsKICAgICAgICBzZWxmLnJlbWFyayhyZW1hcmspOwogICAgICAgIAogICAgSWQgPSBOb25lOwogICAgCiAgICAKICAgICMgYWN0aXZlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfYWN0aXZlID0gTm9uZTsKICAgIGRlZiBhY3RpdmUoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2FjdGl2ZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9hY3RpdmU7CiAgICAKICAgICMgZW5hYmxlZDogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX2VuYWJsZWQgPSBOb25lOwogICAgZGVmIGVuYWJsZWQoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2VuYWJsZWQgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fZW5hYmxlZDsKICAgIAogICAgIyBjb2RlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfY29kZSA9IE5vbmU7CiAgICBkZWYgY29kZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fY29kZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9jb2RlOwogICAgCiAgICAjIG9yZGVyOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfb3JkZXIgPSBOb25lOwogICAgZGVmIG9yZGVyKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9vcmRlciA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9vcmRlcjsKICAgIAogICAgIyBkYXRlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfZGF0ZSA9IE5vbmU7CiAgICBkZWYgZGF0ZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fZGF0ZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9kYXRlOwogICAgCiAgICAjIG5hbWU6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9uYW1lID0gTm9uZTsKICAgIGRlZiBuYW1lKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9uYW1lID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX25hbWU7CiAgICAKICAgICMgcmVtYXJrOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfcmVtYXJrID0gTm9uZTsKICAgIGRlZiByZW1hcmsoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX3JlbWFyayA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9yZW1hcms7CiAgICAKICAgIAogICAgCiAgICAjIGdyb3VwX05vZGVzOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfZ3JvdXBfTm9kZXMgPSBOb25lOwogICAgZGVmIGdyb3VwX05vZGVzKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9ncm91cF9Ob2RlcyA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9ncm91cF9Ob2RlczsKICAgIAogICAgCiAgICBkZWYgX2Zyb21Eb2N1bWVudChzZWxmLCBvYmopOgogICAgICAgIF9fdG9TdHJpbmcgPSAnTm9kZV9Hcm91cDo6X2Zyb21Eb2N1bWVudCgpOiAnOwogICAgICAgIAogICAgICAgIGlmIG9iaiBpcyBOb25lOgogICAgICAgICAgICByZXR1cm4gc2VsZjsKCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIGJ5dGVzKToKICAgICAgICAgICAgb2JqID0gc3RyKG9iaiwgInV0Zi04Iik7CgogICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLCBzdHIpIG9yIHR5cGUob2JqKSBpcyBzdHI6CiAgICAgICAgICAgIGlmIHJlLm1hdGNoKHIiKCgoW0EtWmEtel17Myw5fTooPzpcL1wvKT8pKD86Wy07OiY9XCtcJCxcd10rQCk/W0EtWmEtejAtOS4tXSt8KD86d3d3LnxbLTs6Jj1cK1wkLFx3XStAKVtBLVphLXowLTkuLV0rKSgoPzpcL1tcK34lXC8uXHdcLV9dKik/XD8/KD86Wy1cKz0mOyVALlx3X10qKSM/KD86W1x3XSopKT8pIiwgb2JqKToKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBvYmogPSBqc29uLmxvYWRzKHVybGxpYjMuUG9vbE1hbmFnZXIoKS5yZXF1ZXN0KCdHRVQnLCBvYmopLmRhdGEuZGVjb2RlKCd1dGYtOCcpKTsKICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICBvYmogPSB7fTsKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIG9iaiA9IGpzb24ubG9hZHMob2JqKTsKICAgICAgICAKICAgICAgICBpZiBpc2luc3RhbmNlKG9iaiwgbGlzdCk6CiAgICAgICAgICAgIHJldHVybiBbTm9kZV9Hcm91cCgpLl9mcm9tRG9jdW1lbnQobykgZm9yIG8gaW4gb2JqXTsKICAgICAgICAgICAgCiAgICAgICAgaWYgbm90IGlzaW5zdGFuY2Uob2JqLCAoc3RyLCBieXRlcywgZGljdCkpOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJ3VuaGFuZGxlZCB0eXBlOiAnICsgc3RyKHR5cGUob2JqKSkpOwogICAgICAgICAgICByZXR1cm4gb2JqOwoKICAgICAgICBpZiAnSWQnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5JZCA9IG9ialsnSWQnXTsKCiAgICAKICAgICAgICBpZiAnYWN0aXZlJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuYWN0aXZlKG9ialsnYWN0aXZlJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ2VuYWJsZWQnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5lbmFibGVkKG9ialsnZW5hYmxlZCddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdjb2RlJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuY29kZShvYmpbJ2NvZGUnXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnb3JkZXInIGluIG9iajoKICAgICAgICAgICAgc2VsZi5vcmRlcihvYmpbJ29yZGVyJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ2RhdGUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5kYXRlKG9ialsnZGF0ZSddKTsKICAgICAgICAKICAgICAgICAgICAgc2VsZi5kYXRlKGRhdGV0aW1lLmRhdGV0aW1lLmZyb21pc29mb3JtYXQoc2VsZi5kYXRlKCkpKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICduYW1lJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYubmFtZShvYmpbJ25hbWUnXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAncmVtYXJrJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYucmVtYXJrKG9ialsncmVtYXJrJ10pOwogICAgICAgIAogICAgICAgICAgICBzZWxmLnJlbWFyayggYmFzZTY0LmI2NGRlY29kZShzZWxmLnJlbWFyaygpKSApOwogICAgICAgIAogICAgCgogICAgCiAgICAgICAgaWYgJ2dyb3VwX05vZGVzJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuZ3JvdXBfTm9kZXMoTm9kZSgpLl9mcm9tRG9jdW1lbnQob2JqWydncm91cF9Ob2RlcyddKSk7CiAgICAKCiAgICAgICAgZ2MuY29sbGVjdCgpOwogICAgICAgIHJldHVybiBzZWxmOwogICAgCiAgICBkZWYgX3RvRG9jdW1lbnQoc2VsZiwgYkpTT049Tm9uZSk6CiAgICAgICAgX190b1N0cmluZyA9ICdOb2RlX0dyb3VwOjpfdG9Eb2N1bWVudCgpOiAnOwoKICAgICAgICByZXQgPSB7fTsKICAgICAgICBpZiBzZWxmLklkIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbIklkIl0gPSBzZWxmLklkOwoKICAgIAogICAgICAgIGlmIHNlbGYuYWN0aXZlKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiYWN0aXZlIl0gPSBzZWxmLmFjdGl2ZSgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5lbmFibGVkKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiZW5hYmxlZCJdID0gc2VsZi5lbmFibGVkKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLmNvZGUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJjb2RlIl0gPSBzZWxmLmNvZGUoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYub3JkZXIoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJvcmRlciJdID0gc2VsZi5vcmRlcigpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5kYXRlKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiZGF0ZSJdID0gc2VsZi5kYXRlKCk7CiAgICAgICAgCiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UocmV0WyJkYXRlIl0sIGRhdGV0aW1lLmRhdGV0aW1lKToKICAgICAgICAgICAgICAgIHJldFsiZGF0ZSJdID0gcmV0WyJkYXRlIl0uaXNvZm9ybWF0KCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLm5hbWUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJuYW1lIl0gPSBzZWxmLm5hbWUoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYucmVtYXJrKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSBzZWxmLnJlbWFyaygpOwogICAgICAgIAogICAgICAgICAgICBpZiBpc2luc3RhbmNlKHJldFsicmVtYXJrIl0sIGRpY3QpOgogICAgICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IGpzb24uZHVtcHMocmV0WyJyZW1hcmsiXSkuZW5jb2RlKCd1dGYtOCcpOwoKICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9ICBiYXNlNjQuYjY0ZW5jb2RlKHJldFsicmVtYXJrIl0pLmRlY29kZSgndXRmLTgnKS5zdHJpcCgpOwogICAgICAgIAogICAgCiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLmdyb3VwX05vZGVzKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiZ3JvdXBfTm9kZXMiXSA9IFt0YS5fdG9Eb2N1bWVudCgpIGZvciB0YSBpbiBzZWxmLmdyb3VwX05vZGVzKCldOwogICAgCgogICAgICAgIGlmIGJKU09OIGlzIG5vdCBOb25lOgogICAgICAgICAgICAjcHJpbnQoX190b1N0cmluZyArICJHT1QgSEVSRSIsIHR5cGUocmV0KSwgcmV0KTsKICAgICAgICAgICAgcmV0ID0ganNvbi5kdW1wcyhyZXQpOwogICAgICAgIGdjLmNvbGxlY3QoKTsKICAgICAgICByZXR1cm4gcmV0OwoKICAgIAogICAgZGVmIHN0b3JlKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6CiAgICAgICAgX190b1N0cmluZyA9ICdOb2RlX0dyb3VwOjpzdG9yZSgpOiAnOwogICAgICAgIAogICAgICAgIGV2SlNPTiA9IE5vbmU7CgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIGV2SlNPTiA9IGpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOwogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046CiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7CiAgICAgICAgCgogICAgICAgIGFuc3dlciA9IE5vbmU7CgogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aW1lKCkpKyddLk5vZGVfR3JvdXAuc3RvcmUoKScpLm1ldGhvZCgnc3RvcmUnKS5jbGFzc05hbWUoJ05vZGVfR3JvdXAnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7CiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsKICAgICAgICAKICAgICAgICBnYy5jb2xsZWN0KCk7CgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsKCiAgICAgICAgCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7CiAgICAgICAgCiAgICAgICAgICAgIGFuc3dlciA9IE5vZGVfR3JvdXAoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7CiAgICAgICAgCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsKCgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsKCiAgICAgICAgICAgIAogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsKICAgICAgICAgICAgCgogICAgICAgIHJldHVybiBhbnN3ZXI7CgogICAgCiAgICBkZWYgZmluZEFsbChzZWxmLCBfX2V2ZW50PU5vbmUpOgogICAgICAgIF9fdG9TdHJpbmcgPSAnTm9kZV9Hcm91cDo6ZmluZEFsbCgpOiAnOwogICAgICAgIAogICAgICAgIGV2SlNPTiA9IE5vbmU7CgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIGV2SlNPTiA9IGpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOwogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046CiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7CiAgICAgICAgCgogICAgICAgIGFuc3dlciA9IE5vbmU7CgogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aW1lKCkpKyddLk5vZGVfR3JvdXAuZmluZEFsbCgpJykubWV0aG9kKCdmaW5kQWxsJykuY2xhc3NOYW1lKCdOb2RlX0dyb3VwJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOwogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7CiAgICAgICAgCiAgICAgICAgZ2MuY29sbGVjdCgpOwoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7CgogICAgICAgIAogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOwogICAgICAgIAogICAgICAgICAgICBhbnN3ZXIgPSBOb2RlX0dyb3VwKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOwogICAgICAgIAoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7CgoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOgogICAgICAgICAgICAKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7CgogICAgICAgICAgICAKICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7CiAgICAgICAgICAgIAoKICAgICAgICByZXR1cm4gYW5zd2VyOwoKICAgIAogICAgZGVmIGZpbmQoc2VsZiwgX19ldmVudD1Ob25lKToKICAgICAgICBfX3RvU3RyaW5nID0gJ05vZGVfR3JvdXA6OmZpbmQoKTogJzsKICAgICAgICAKICAgICAgICBldkpTT04gPSBOb25lOwoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBldkpTT04gPSBqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsKICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOgogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOwogICAgICAgIAoKICAgICAgICBhbnN3ZXIgPSBOb25lOwoKICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGltZSgpKSsnXS5Ob2RlX0dyb3VwLmZpbmQoKScpLm1ldGhvZCgnZmluZCcpLmNsYXNzTmFtZSgnTm9kZV9Hcm91cCcpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOwogICAgICAgIAogICAgICAgIGdjLmNvbGxlY3QoKTsKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOwoKICAgICAgICAKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsKICAgICAgICAKICAgICAgICAgICAgYW5zd2VyID0gTm9kZV9Hcm91cCgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsKICAgICAgICAKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOwoKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOwogICAgICAgICAgICAKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOwoKICAgICAgICAgICAgCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOwogICAgICAgICAgICAKCiAgICAgICAgcmV0dXJuIGFuc3dlcjsKCiAgICAKCgpjbGFzcyBOb2RlX1R5cGUoKToKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBJZD1Ob25lLCBhY3RpdmU9Tm9uZSwgZW5hYmxlZD1Ob25lLCBjb2RlPU5vbmUsIG9yZGVyPU5vbmUsIGRhdGU9Tm9uZSwgbmFtZT1Ob25lLCByZW1hcms9Tm9uZSwgZHluYW1pYz1Ob25lKToKICAgICAgICBzdXBlcigpLl9faW5pdF9fKCk7CgogICAgICAgICNwcmludCgnTm9kZV9UeXBlOjpfX2luaXRfXygpJyk7CiAgICAgICAgaWYgSWQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHNlbGYuSWQgPSBJZDsKCiAgICAgICAgCiAgICAgICAgc2VsZi5hY3RpdmUoYWN0aXZlKTsKICAgICAgICBzZWxmLmVuYWJsZWQoZW5hYmxlZCk7CiAgICAgICAgc2VsZi5jb2RlKGNvZGUpOwogICAgICAgIHNlbGYub3JkZXIob3JkZXIpOwogICAgICAgIHNlbGYuZGF0ZShkYXRlKTsKICAgICAgICBzZWxmLm5hbWUobmFtZSk7CiAgICAgICAgc2VsZi5yZW1hcmsocmVtYXJrKTsKICAgICAgICBzZWxmLmR5bmFtaWMoZHluYW1pYyk7CiAgICAgICAgCiAgICBJZCA9IE5vbmU7CiAgICAKICAgIAogICAgIyBhY3RpdmU6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9hY3RpdmUgPSBOb25lOwogICAgZGVmIGFjdGl2ZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fYWN0aXZlID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2FjdGl2ZTsKICAgIAogICAgIyBlbmFibGVkOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfZW5hYmxlZCA9IE5vbmU7CiAgICBkZWYgZW5hYmxlZChzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fZW5hYmxlZCA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9lbmFibGVkOwogICAgCiAgICAjIGNvZGU6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9jb2RlID0gTm9uZTsKICAgIGRlZiBjb2RlKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9jb2RlID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2NvZGU7CiAgICAKICAgICMgb3JkZXI6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9vcmRlciA9IE5vbmU7CiAgICBkZWYgb3JkZXIoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX29yZGVyID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX29yZGVyOwogICAgCiAgICAjIGRhdGU6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9kYXRlID0gTm9uZTsKICAgIGRlZiBkYXRlKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9kYXRlID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2RhdGU7CiAgICAKICAgICMgbmFtZTogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX25hbWUgPSBOb25lOwogICAgZGVmIG5hbWUoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX25hbWUgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fbmFtZTsKICAgIAogICAgIyByZW1hcms6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9yZW1hcmsgPSBOb25lOwogICAgZGVmIHJlbWFyayhzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fcmVtYXJrID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3JlbWFyazsKICAgIAogICAgIyBkeW5hbWljOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfZHluYW1pYyA9IE5vbmU7CiAgICBkZWYgZHluYW1pYyhzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fZHluYW1pYyA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9keW5hbWljOwogICAgCiAgICAKICAgIAogICAgIyB0eXBlX05vZGVzOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfdHlwZV9Ob2RlcyA9IE5vbmU7CiAgICBkZWYgdHlwZV9Ob2RlcyhzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fdHlwZV9Ob2RlcyA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl90eXBlX05vZGVzOwogICAgCiAgICAKICAgIGRlZiBfZnJvbURvY3VtZW50KHNlbGYsIG9iaik6CiAgICAgICAgX190b1N0cmluZyA9ICdOb2RlX1R5cGU6Ol9mcm9tRG9jdW1lbnQoKTogJzsKICAgICAgICAKICAgICAgICBpZiBvYmogaXMgTm9uZToKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CgogICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLCBieXRlcyk6CiAgICAgICAgICAgIG9iaiA9IHN0cihvYmosICJ1dGYtOCIpOwoKICAgICAgICBpZiBpc2luc3RhbmNlKG9iaiwgc3RyKSBvciB0eXBlKG9iaikgaXMgc3RyOgogICAgICAgICAgICBpZiByZS5tYXRjaChyIigoKFtBLVphLXpdezMsOX06KD86XC9cLyk/KSg/OlstOzomPVwrXCQsXHddK0ApP1tBLVphLXowLTkuLV0rfCg/Ond3dy58Wy07OiY9XCtcJCxcd10rQClbQS1aYS16MC05Li1dKykoKD86XC9bXCt+JVwvLlx3XC1fXSopP1w/Pyg/OlstXCs9JjslQC5cd19dKikjPyg/Oltcd10qKSk/KSIsIG9iaik6CiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgb2JqID0ganNvbi5sb2Fkcyh1cmxsaWIzLlBvb2xNYW5hZ2VyKCkucmVxdWVzdCgnR0VUJywgb2JqKS5kYXRhLmRlY29kZSgndXRmLTgnKSk7CiAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgb2JqID0ge307CiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBvYmogPSBqc29uLmxvYWRzKG9iaik7CiAgICAgICAgCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIGxpc3QpOgogICAgICAgICAgICByZXR1cm4gW05vZGVfVHlwZSgpLl9mcm9tRG9jdW1lbnQobykgZm9yIG8gaW4gb2JqXTsKICAgICAgICAgICAgCiAgICAgICAgaWYgbm90IGlzaW5zdGFuY2Uob2JqLCAoc3RyLCBieXRlcywgZGljdCkpOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJ3VuaGFuZGxlZCB0eXBlOiAnICsgc3RyKHR5cGUob2JqKSkpOwogICAgICAgICAgICByZXR1cm4gb2JqOwoKICAgICAgICBpZiAnSWQnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5JZCA9IG9ialsnSWQnXTsKCiAgICAKICAgICAgICBpZiAnYWN0aXZlJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuYWN0aXZlKG9ialsnYWN0aXZlJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ2VuYWJsZWQnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5lbmFibGVkKG9ialsnZW5hYmxlZCddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdjb2RlJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuY29kZShvYmpbJ2NvZGUnXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnb3JkZXInIGluIG9iajoKICAgICAgICAgICAgc2VsZi5vcmRlcihvYmpbJ29yZGVyJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ2RhdGUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5kYXRlKG9ialsnZGF0ZSddKTsKICAgICAgICAKICAgICAgICAgICAgc2VsZi5kYXRlKGRhdGV0aW1lLmRhdGV0aW1lLmZyb21pc29mb3JtYXQoc2VsZi5kYXRlKCkpKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICduYW1lJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYubmFtZShvYmpbJ25hbWUnXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAncmVtYXJrJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYucmVtYXJrKG9ialsncmVtYXJrJ10pOwogICAgICAgIAogICAgICAgICAgICBzZWxmLnJlbWFyayggYmFzZTY0LmI2NGRlY29kZShzZWxmLnJlbWFyaygpKSApOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ2R5bmFtaWMnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5keW5hbWljKG9ialsnZHluYW1pYyddKTsKICAgICAgICAKICAgIAoKICAgIAogICAgICAgIGlmICd0eXBlX05vZGVzJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYudHlwZV9Ob2RlcyhOb2RlKCkuX2Zyb21Eb2N1bWVudChvYmpbJ3R5cGVfTm9kZXMnXSkpOwogICAgCgogICAgICAgIGdjLmNvbGxlY3QoKTsKICAgICAgICByZXR1cm4gc2VsZjsKICAgIAogICAgZGVmIF90b0RvY3VtZW50KHNlbGYsIGJKU09OPU5vbmUpOgogICAgICAgIF9fdG9TdHJpbmcgPSAnTm9kZV9UeXBlOjpfdG9Eb2N1bWVudCgpOiAnOwoKICAgICAgICByZXQgPSB7fTsKICAgICAgICBpZiBzZWxmLklkIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbIklkIl0gPSBzZWxmLklkOwoKICAgIAogICAgICAgIGlmIHNlbGYuYWN0aXZlKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiYWN0aXZlIl0gPSBzZWxmLmFjdGl2ZSgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5lbmFibGVkKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiZW5hYmxlZCJdID0gc2VsZi5lbmFibGVkKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLmNvZGUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJjb2RlIl0gPSBzZWxmLmNvZGUoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYub3JkZXIoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJvcmRlciJdID0gc2VsZi5vcmRlcigpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5kYXRlKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiZGF0ZSJdID0gc2VsZi5kYXRlKCk7CiAgICAgICAgCiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UocmV0WyJkYXRlIl0sIGRhdGV0aW1lLmRhdGV0aW1lKToKICAgICAgICAgICAgICAgIHJldFsiZGF0ZSJdID0gcmV0WyJkYXRlIl0uaXNvZm9ybWF0KCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLm5hbWUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJuYW1lIl0gPSBzZWxmLm5hbWUoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYucmVtYXJrKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSBzZWxmLnJlbWFyaygpOwogICAgICAgIAogICAgICAgICAgICBpZiBpc2luc3RhbmNlKHJldFsicmVtYXJrIl0sIGRpY3QpOgogICAgICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IGpzb24uZHVtcHMocmV0WyJyZW1hcmsiXSkuZW5jb2RlKCd1dGYtOCcpOwoKICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9ICBiYXNlNjQuYjY0ZW5jb2RlKHJldFsicmVtYXJrIl0pLmRlY29kZSgndXRmLTgnKS5zdHJpcCgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5keW5hbWljKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiZHluYW1pYyJdID0gc2VsZi5keW5hbWljKCk7CiAgICAgICAgCiAgICAKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYudHlwZV9Ob2RlcygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbInR5cGVfTm9kZXMiXSA9IFt0YS5fdG9Eb2N1bWVudCgpIGZvciB0YSBpbiBzZWxmLnR5cGVfTm9kZXMoKV07CiAgICAKCiAgICAgICAgaWYgYkpTT04gaXMgbm90IE5vbmU6CiAgICAgICAgICAgICNwcmludChfX3RvU3RyaW5nICsgIkdPVCBIRVJFIiwgdHlwZShyZXQpLCByZXQpOwogICAgICAgICAgICByZXQgPSBqc29uLmR1bXBzKHJldCk7CiAgICAgICAgZ2MuY29sbGVjdCgpOwogICAgICAgIHJldHVybiByZXQ7CgogICAgCiAgICBkZWYgc3RvcmUoc2VsZiwgX19ldmVudD1Ob25lKToKICAgICAgICBfX3RvU3RyaW5nID0gJ05vZGVfVHlwZTo6c3RvcmUoKTogJzsKICAgICAgICAKICAgICAgICBldkpTT04gPSBOb25lOwoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBldkpTT04gPSBqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsKICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOgogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOwogICAgICAgIAoKICAgICAgICBhbnN3ZXIgPSBOb25lOwoKICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGltZSgpKSsnXS5Ob2RlX1R5cGUuc3RvcmUoKScpLm1ldGhvZCgnc3RvcmUnKS5jbGFzc05hbWUoJ05vZGVfVHlwZScpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOwogICAgICAgIAogICAgICAgIGdjLmNvbGxlY3QoKTsKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOwoKICAgICAgICAKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsKICAgICAgICAKICAgICAgICAgICAgYW5zd2VyID0gTm9kZV9UeXBlKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOwogICAgICAgIAoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7CgoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOgogICAgICAgICAgICAKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7CgogICAgICAgICAgICAKICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7CiAgICAgICAgICAgIAoKICAgICAgICByZXR1cm4gYW5zd2VyOwoKICAgIAogICAgZGVmIGZpbmRBbGwoc2VsZiwgX19ldmVudD1Ob25lKToKICAgICAgICBfX3RvU3RyaW5nID0gJ05vZGVfVHlwZTo6ZmluZEFsbCgpOiAnOwogICAgICAgIAogICAgICAgIGV2SlNPTiA9IE5vbmU7CgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIGV2SlNPTiA9IGpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOwogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046CiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7CiAgICAgICAgCgogICAgICAgIGFuc3dlciA9IE5vbmU7CgogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aW1lKCkpKyddLk5vZGVfVHlwZS5maW5kQWxsKCknKS5tZXRob2QoJ2ZpbmRBbGwnKS5jbGFzc05hbWUoJ05vZGVfVHlwZScpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOwogICAgICAgIAogICAgICAgIGdjLmNvbGxlY3QoKTsKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOwoKICAgICAgICAKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsKICAgICAgICAKICAgICAgICAgICAgYW5zd2VyID0gTm9kZV9UeXBlKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOwogICAgICAgIAoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7CgoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOgogICAgICAgICAgICAKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7CgogICAgICAgICAgICAKICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7CiAgICAgICAgICAgIAoKICAgICAgICByZXR1cm4gYW5zd2VyOwoKICAgIAogICAgZGVmIGZpbmQoc2VsZiwgX19ldmVudD1Ob25lKToKICAgICAgICBfX3RvU3RyaW5nID0gJ05vZGVfVHlwZTo6ZmluZCgpOiAnOwogICAgICAgIAogICAgICAgIGV2SlNPTiA9IE5vbmU7CgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIGV2SlNPTiA9IGpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOwogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046CiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7CiAgICAgICAgCgogICAgICAgIGFuc3dlciA9IE5vbmU7CgogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aW1lKCkpKyddLk5vZGVfVHlwZS5maW5kKCknKS5tZXRob2QoJ2ZpbmQnKS5jbGFzc05hbWUoJ05vZGVfVHlwZScpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOwogICAgICAgIAogICAgICAgIGdjLmNvbGxlY3QoKTsKCgogICAgICAgIGxhc3RVcGRhdGUgPSBzZWxmLmRhdGUoKTsKICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoYmFzZV91cmwpOwoKICAgICAgICBpZiBzZWxmLmRhdGUoKT5sYXN0VXBkYXRlOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIm5ld2VyIHZlcnNpb246ICIgKyBzdHIoc2VsZi5kYXRlKCkpICsgIiwgcmVib290aW5nLi4uIik7CiAgICAgICAgICAgIG9zLmV4ZWNsKHN5cy5leGVjdXRhYmxlLCBzeXMuZXhlY3V0YWJsZSwgKnN5cy5hcmd2KTsKCiAgICAgICAgdGltZS5zbGVlcCgzMCk7CiAgICAgICAgcmV0dXJuIHNlbGYuZmluZCgpOwogICAgICAgIAoKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOwoKICAgICAgICAKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsKICAgICAgICAKICAgICAgICAgICAgYW5zd2VyID0gTm9kZV9UeXBlKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOwogICAgICAgIAoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7CgoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOgogICAgICAgICAgICAKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7CgogICAgICAgICAgICAKICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7CiAgICAgICAgICAgIAoKICAgICAgICByZXR1cm4gYW5zd2VyOwoKICAgIAoKCmNsYXNzIE1hcHBpbmcoKToKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBJZD1Ob25lLCBhY3RpdmU9Tm9uZSwgZW5hYmxlZD1Ob25lLCBvcmRlcj1Ob25lLCBjbGFzc05hbWU9Tm9uZSwgc2NvcGU9Tm9uZSwgY29udGV4dD1Ob25lLCBzb3VyY2U9Tm9uZSwgdGFyZ2V0PU5vbmUsIG9wZXJhdG9yPU5vbmUsIGluU2NyaXB0PU5vbmUsIG91dFNjcmlwdD1Ob25lLCB0b29sPU5vbmUsIGdyb3VwPU5vbmUsIHR5cGU9Tm9uZSk6CiAgICAgICAgc3VwZXIoKS5fX2luaXRfXygpOwoKICAgICAgICAjcHJpbnQoJ01hcHBpbmc6Ol9faW5pdF9fKCknKTsKICAgICAgICBpZiBJZCBpcyBub3QgTm9uZToKICAgICAgICAgICAgc2VsZi5JZCA9IElkOwoKICAgICAgICAKICAgICAgICBzZWxmLmFjdGl2ZShhY3RpdmUpOwogICAgICAgIHNlbGYuZW5hYmxlZChlbmFibGVkKTsKICAgICAgICBzZWxmLm9yZGVyKG9yZGVyKTsKICAgICAgICBzZWxmLmNsYXNzTmFtZShjbGFzc05hbWUpOwogICAgICAgIHNlbGYuc2NvcGUoc2NvcGUpOwogICAgICAgIHNlbGYuY29udGV4dChjb250ZXh0KTsKICAgICAgICBzZWxmLnNvdXJjZShzb3VyY2UpOwogICAgICAgIHNlbGYudGFyZ2V0KHRhcmdldCk7CiAgICAgICAgc2VsZi5vcGVyYXRvcihvcGVyYXRvcik7CiAgICAgICAgc2VsZi5pblNjcmlwdChpblNjcmlwdCk7CiAgICAgICAgc2VsZi5vdXRTY3JpcHQob3V0U2NyaXB0KTsKICAgICAgICBzZWxmLnRvb2wodG9vbCk7CiAgICAgICAgc2VsZi5ncm91cChncm91cCk7CiAgICAgICAgc2VsZi50eXBlKHR5cGUpOwogICAgICAgIAogICAgSWQgPSBOb25lOwogICAgCiAgICAKICAgICMgYWN0aXZlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfYWN0aXZlID0gTm9uZTsKICAgIGRlZiBhY3RpdmUoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2FjdGl2ZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9hY3RpdmU7CiAgICAKICAgICMgZW5hYmxlZDogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX2VuYWJsZWQgPSBOb25lOwogICAgZGVmIGVuYWJsZWQoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2VuYWJsZWQgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fZW5hYmxlZDsKICAgIAogICAgIyBvcmRlcjogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX29yZGVyID0gTm9uZTsKICAgIGRlZiBvcmRlcihzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fb3JkZXIgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fb3JkZXI7CiAgICAKICAgICMgY2xhc3NOYW1lOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfY2xhc3NOYW1lID0gTm9uZTsKICAgIGRlZiBjbGFzc05hbWUoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2NsYXNzTmFtZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9jbGFzc05hbWU7CiAgICAKICAgICMgc2NvcGU6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9zY29wZSA9IE5vbmU7CiAgICBkZWYgc2NvcGUoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX3Njb3BlID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3Njb3BlOwogICAgCiAgICAjIGNvbnRleHQ6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9jb250ZXh0ID0gTm9uZTsKICAgIGRlZiBjb250ZXh0KHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9jb250ZXh0ID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2NvbnRleHQ7CiAgICAKICAgICMgc291cmNlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfc291cmNlID0gTm9uZTsKICAgIGRlZiBzb3VyY2Uoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX3NvdXJjZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9zb3VyY2U7CiAgICAKICAgICMgdGFyZ2V0OiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfdGFyZ2V0ID0gTm9uZTsKICAgIGRlZiB0YXJnZXQoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX3RhcmdldCA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl90YXJnZXQ7CiAgICAKICAgICMgb3BlcmF0b3I6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9vcGVyYXRvciA9IE5vbmU7CiAgICBkZWYgb3BlcmF0b3Ioc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX29wZXJhdG9yID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX29wZXJhdG9yOwogICAgCiAgICAjIGluU2NyaXB0OiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfaW5TY3JpcHQgPSBOb25lOwogICAgZGVmIGluU2NyaXB0KHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9pblNjcmlwdCA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9pblNjcmlwdDsKICAgIAogICAgIyBvdXRTY3JpcHQ6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9vdXRTY3JpcHQgPSBOb25lOwogICAgZGVmIG91dFNjcmlwdChzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fb3V0U2NyaXB0ID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX291dFNjcmlwdDsKICAgIAogICAgIyB0b29sOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfdG9vbCA9IE5vbmU7CiAgICBkZWYgdG9vbChzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fdG9vbCA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl90b29sOwogICAgCiAgICAjIGdyb3VwOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfZ3JvdXAgPSBOb25lOwogICAgZGVmIGdyb3VwKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9ncm91cCA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9ncm91cDsKICAgIAogICAgIyB0eXBlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfdHlwZSA9IE5vbmU7CiAgICBkZWYgdHlwZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fdHlwZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl90eXBlOwogICAgCiAgICAKICAgIAogICAgCiAgICBkZWYgX2Zyb21Eb2N1bWVudChzZWxmLCBvYmopOgogICAgICAgIF9fdG9TdHJpbmcgPSAnTWFwcGluZzo6X2Zyb21Eb2N1bWVudCgpOiAnOwogICAgICAgIAogICAgICAgIGlmIG9iaiBpcyBOb25lOgogICAgICAgICAgICByZXR1cm4gc2VsZjsKCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIGJ5dGVzKToKICAgICAgICAgICAgb2JqID0gc3RyKG9iaiwgInV0Zi04Iik7CgogICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLCBzdHIpIG9yIHR5cGUob2JqKSBpcyBzdHI6CiAgICAgICAgICAgIGlmIHJlLm1hdGNoKHIiKCgoW0EtWmEtel17Myw5fTooPzpcL1wvKT8pKD86Wy07OiY9XCtcJCxcd10rQCk/W0EtWmEtejAtOS4tXSt8KD86d3d3LnxbLTs6Jj1cK1wkLFx3XStAKVtBLVphLXowLTkuLV0rKSgoPzpcL1tcK34lXC8uXHdcLV9dKik/XD8/KD86Wy1cKz0mOyVALlx3X10qKSM/KD86W1x3XSopKT8pIiwgb2JqKToKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBvYmogPSBqc29uLmxvYWRzKHVybGxpYjMuUG9vbE1hbmFnZXIoKS5yZXF1ZXN0KCdHRVQnLCBvYmopLmRhdGEuZGVjb2RlKCd1dGYtOCcpKTsKICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICBvYmogPSB7fTsKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIG9iaiA9IGpzb24ubG9hZHMob2JqKTsKICAgICAgICAKICAgICAgICBpZiBpc2luc3RhbmNlKG9iaiwgbGlzdCk6CiAgICAgICAgICAgIHJldHVybiBbTWFwcGluZygpLl9mcm9tRG9jdW1lbnQobykgZm9yIG8gaW4gb2JqXTsKICAgICAgICAgICAgCiAgICAgICAgaWYgbm90IGlzaW5zdGFuY2Uob2JqLCAoc3RyLCBieXRlcywgZGljdCkpOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJ3VuaGFuZGxlZCB0eXBlOiAnICsgc3RyKHR5cGUob2JqKSkpOwogICAgICAgICAgICByZXR1cm4gb2JqOwoKICAgICAgICBpZiAnSWQnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5JZCA9IG9ialsnSWQnXTsKCiAgICAKICAgICAgICBpZiAnYWN0aXZlJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuYWN0aXZlKG9ialsnYWN0aXZlJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ2VuYWJsZWQnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5lbmFibGVkKG9ialsnZW5hYmxlZCddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdvcmRlcicgaW4gb2JqOgogICAgICAgICAgICBzZWxmLm9yZGVyKG9ialsnb3JkZXInXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnY2xhc3NOYW1lJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuY2xhc3NOYW1lKG9ialsnY2xhc3NOYW1lJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ3Njb3BlJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuc2NvcGUob2JqWydzY29wZSddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdjb250ZXh0JyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuY29udGV4dChvYmpbJ2NvbnRleHQnXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnc291cmNlJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuc291cmNlKG9ialsnc291cmNlJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ3RhcmdldCcgaW4gb2JqOgogICAgICAgICAgICBzZWxmLnRhcmdldChvYmpbJ3RhcmdldCddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdvcGVyYXRvcicgaW4gb2JqOgogICAgICAgICAgICBzZWxmLm9wZXJhdG9yKG9ialsnb3BlcmF0b3InXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnaW5TY3JpcHQnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5pblNjcmlwdChvYmpbJ2luU2NyaXB0J10pOwogICAgICAgIAogICAgICAgICAgICBzZWxmLmluU2NyaXB0KCBiYXNlNjQuYjY0ZGVjb2RlKHNlbGYuaW5TY3JpcHQoKSkgKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdvdXRTY3JpcHQnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5vdXRTY3JpcHQob2JqWydvdXRTY3JpcHQnXSk7CiAgICAgICAgCiAgICAgICAgICAgIHNlbGYub3V0U2NyaXB0KCBiYXNlNjQuYjY0ZGVjb2RlKHNlbGYub3V0U2NyaXB0KCkpICk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAndG9vbCcgaW4gb2JqOgogICAgICAgICAgICBzZWxmLnRvb2woVG9vbCgpLl9mcm9tRG9jdW1lbnQob2JqWyd0b29sJ10pKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdncm91cCcgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmdyb3VwKENvbmZpZ19Hcm91cCgpLl9mcm9tRG9jdW1lbnQob2JqWydncm91cCddKSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAndHlwZScgaW4gb2JqOgogICAgICAgICAgICBzZWxmLnR5cGUoVG9vbF9UeXBlKCkuX2Zyb21Eb2N1bWVudChvYmpbJ3R5cGUnXSkpOwogICAgICAgIAogICAgCgogICAgCgogICAgICAgIGdjLmNvbGxlY3QoKTsKICAgICAgICByZXR1cm4gc2VsZjsKICAgIAogICAgZGVmIF90b0RvY3VtZW50KHNlbGYsIGJKU09OPU5vbmUpOgogICAgICAgIF9fdG9TdHJpbmcgPSAnTWFwcGluZzo6X3RvRG9jdW1lbnQoKTogJzsKCiAgICAgICAgcmV0ID0ge307CiAgICAgICAgaWYgc2VsZi5JZCBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJJZCJdID0gc2VsZi5JZDsKCiAgICAKICAgICAgICBpZiBzZWxmLmFjdGl2ZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbImFjdGl2ZSJdID0gc2VsZi5hY3RpdmUoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYuZW5hYmxlZCgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbImVuYWJsZWQiXSA9IHNlbGYuZW5hYmxlZCgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5vcmRlcigpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbIm9yZGVyIl0gPSBzZWxmLm9yZGVyKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLmNsYXNzTmFtZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbImNsYXNzTmFtZSJdID0gc2VsZi5jbGFzc05hbWUoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYuc2NvcGUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJzY29wZSJdID0gc2VsZi5zY29wZSgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5jb250ZXh0KCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiY29udGV4dCJdID0gc2VsZi5jb250ZXh0KCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLnNvdXJjZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbInNvdXJjZSJdID0gc2VsZi5zb3VyY2UoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYudGFyZ2V0KCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsidGFyZ2V0Il0gPSBzZWxmLnRhcmdldCgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5vcGVyYXRvcigpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbIm9wZXJhdG9yIl0gPSBzZWxmLm9wZXJhdG9yKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLmluU2NyaXB0KCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiaW5TY3JpcHQiXSA9IHNlbGYuaW5TY3JpcHQoKTsKICAgICAgICAKICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShyZXRbImluU2NyaXB0Il0sIGRpY3QpOgogICAgICAgICAgICAgICAgcmV0WyJpblNjcmlwdCJdID0ganNvbi5kdW1wcyhyZXRbImluU2NyaXB0Il0pLmVuY29kZSgndXRmLTgnKTsKCiAgICAgICAgICAgIHJldFsiaW5TY3JpcHQiXSA9ICBiYXNlNjQuYjY0ZW5jb2RlKHJldFsiaW5TY3JpcHQiXSkuZGVjb2RlKCd1dGYtOCcpLnN0cmlwKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLm91dFNjcmlwdCgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbIm91dFNjcmlwdCJdID0gc2VsZi5vdXRTY3JpcHQoKTsKICAgICAgICAKICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShyZXRbIm91dFNjcmlwdCJdLCBkaWN0KToKICAgICAgICAgICAgICAgIHJldFsib3V0U2NyaXB0Il0gPSBqc29uLmR1bXBzKHJldFsib3V0U2NyaXB0Il0pLmVuY29kZSgndXRmLTgnKTsKCiAgICAgICAgICAgIHJldFsib3V0U2NyaXB0Il0gPSAgYmFzZTY0LmI2NGVuY29kZShyZXRbIm91dFNjcmlwdCJdKS5kZWNvZGUoJ3V0Zi04Jykuc3RyaXAoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYudG9vbCgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbInRvb2wiXSA9IHNlbGYudG9vbCgpLl90b0RvY3VtZW50KCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLmdyb3VwKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiZ3JvdXAiXSA9IHNlbGYuZ3JvdXAoKS5fdG9Eb2N1bWVudCgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi50eXBlKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsidHlwZSJdID0gc2VsZi50eXBlKCkuX3RvRG9jdW1lbnQoKTsKICAgICAgICAKICAgIAogICAgICAgIAogICAgCgogICAgICAgIGlmIGJKU09OIGlzIG5vdCBOb25lOgogICAgICAgICAgICAjcHJpbnQoX190b1N0cmluZyArICJHT1QgSEVSRSIsIHR5cGUocmV0KSwgcmV0KTsKICAgICAgICAgICAgcmV0ID0ganNvbi5kdW1wcyhyZXQpOwogICAgICAgIGdjLmNvbGxlY3QoKTsKICAgICAgICByZXR1cm4gcmV0OwoKICAgIAogICAgZGVmIHN0b3JlKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6CiAgICAgICAgX190b1N0cmluZyA9ICdNYXBwaW5nOjpzdG9yZSgpOiAnOwogICAgICAgIAogICAgICAgIGV2SlNPTiA9IE5vbmU7CgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIGV2SlNPTiA9IGpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOwogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046CiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7CiAgICAgICAgCgogICAgICAgIGFuc3dlciA9IE5vbmU7CgogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aW1lKCkpKyddLk1hcHBpbmcuc3RvcmUoKScpLm1ldGhvZCgnc3RvcmUnKS5jbGFzc05hbWUoJ01hcHBpbmcnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7CiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsKICAgICAgICAKICAgICAgICBnYy5jb2xsZWN0KCk7CgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsKCiAgICAgICAgCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7CiAgICAgICAgCiAgICAgICAgICAgIGFuc3dlciA9IE1hcHBpbmcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7CiAgICAgICAgCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsKCgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsKCiAgICAgICAgICAgIAogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsKICAgICAgICAgICAgCgogICAgICAgIHJldHVybiBhbnN3ZXI7CgogICAgCiAgICBkZWYgZmluZEFsbChzZWxmLCBfX2V2ZW50PU5vbmUpOgogICAgICAgIF9fdG9TdHJpbmcgPSAnTWFwcGluZzo6ZmluZEFsbCgpOiAnOwogICAgICAgIAogICAgICAgIGV2SlNPTiA9IE5vbmU7CgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIGV2SlNPTiA9IGpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOwogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046CiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7CiAgICAgICAgCgogICAgICAgIGFuc3dlciA9IE5vbmU7CgogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aW1lKCkpKyddLk1hcHBpbmcuZmluZEFsbCgpJykubWV0aG9kKCdmaW5kQWxsJykuY2xhc3NOYW1lKCdNYXBwaW5nJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOwogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7CiAgICAgICAgCiAgICAgICAgZ2MuY29sbGVjdCgpOwoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7CgogICAgICAgIAogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOwogICAgICAgIAogICAgICAgICAgICBhbnN3ZXIgPSBNYXBwaW5nKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOwogICAgICAgIAoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7CgoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOgogICAgICAgICAgICAKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7CgogICAgICAgICAgICAKICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7CiAgICAgICAgICAgIAoKICAgICAgICByZXR1cm4gYW5zd2VyOwoKICAgIAogICAgZGVmIGZpbmQoc2VsZiwgX19ldmVudD1Ob25lKToKICAgICAgICBfX3RvU3RyaW5nID0gJ01hcHBpbmc6OmZpbmQoKTogJzsKICAgICAgICAKICAgICAgICBldkpTT04gPSBOb25lOwoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBldkpTT04gPSBqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsKICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOgogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOwogICAgICAgIAoKICAgICAgICBhbnN3ZXIgPSBOb25lOwoKICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGltZSgpKSsnXS5NYXBwaW5nLmZpbmQoKScpLm1ldGhvZCgnZmluZCcpLmNsYXNzTmFtZSgnTWFwcGluZycpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOwogICAgICAgIAogICAgICAgIGdjLmNvbGxlY3QoKTsKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOwoKICAgICAgICAKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsKICAgICAgICAKICAgICAgICAgICAgYW5zd2VyID0gTWFwcGluZygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsKICAgICAgICAKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOwoKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOwogICAgICAgICAgICAKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOwoKICAgICAgICAgICAgCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOwogICAgICAgICAgICAKCiAgICAgICAgcmV0dXJuIGFuc3dlcjsKCiAgICAKCgoKCgogICAgCm5jb2RlID0gaGV4KHV1aWQuZ2V0bm9kZSgpKTsKICAgIAoKbm9kZSA9IE5vZGUoY29kZT1uY29kZSwgcGFyZW50PU5vZGUoY29kZT0nYXBpc2VydmVyL2VzcHRlc3QvbWFzdGVyJykpOwoKCiMjIyMjIyMjIyMjIE1RVFQgQ29ubmVjdGlvbiAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwpwcmludCgnbWFpbigpJywgIkNvbm5lY3RpbmcgdG8gTVFUVCBzZXJ2ZXIiLCAiLi4uICIsIGVuZD0iIik7Cm1xdHRfdG9waWMgPSAnYXBpc2VydmVyL2VzcHRlc3QnOwoKbXF0dF9jbGllbnQgPSBwYWhvLm1xdHQuY2xpZW50LkNsaWVudChjYWxsYmFja19hcGlfdmVyc2lvbj1wYWhvLm1xdHQuY2xpZW50LkNhbGxiYWNrQVBJVmVyc2lvbi5WRVJTSU9OMiwgY2xpZW50X2lkPW1xdHRfdG9waWMrJy8nK25vZGUuY29kZSgpLCB0cmFuc3BvcnQ9J3RjcCcpOwoKbXF0dF9jbGllbnQub25fbWVzc2FnZSA9IGxhbWJkYSBjbGllbnQsIHVzZXJkYXRhLCBvTXNnIDogRXZlbnQoKS5fZnJvbURvY3VtZW50KG9Nc2cucGF5bG9hZCkucHJvY2VzcygpOwptcXR0X2NsaWVudC5jb25uZWN0KCd0ZXN0Lm1vc3F1aXR0by5vcmcnKTsKCgptcXR0X2NsaWVudC5zdWJzY3JpYmUobXF0dF90b3BpYyk7CnByaW50KCJDb25uZWN0ZWQhIik7CiMjIyMjIyMjIyMjIE1RVFQgQ29ubmVjdGlvbiAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwoKCiMjIyMjIyMjIyMgQ0hFQ0sgRk9SIFVQREFURVMgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwpiYXNlX3VybCA9ICJodHRwczovL2Fyemhvc3BpdGFsLmdpdGh1Yi5pby9lc3B0ZXN0L05vZGVfVHlwZS9QeXRob24uanNvbiI7CnRocmVhZGluZy5UaHJlYWQodGFyZ2V0PWxhbWJkYSA6IE5vZGVfVHlwZSgpLm5hbWUoIlB5dGhvbiIpLmRhdGUoZGF0ZXRpbWUuZGF0ZXRpbWUubm93KGRhdGV0aW1lLnRpbWV6b25lLnV0YykpLmZpbmQoKSkuc3RhcnQoKTsKIyMjIyMjIyMjIyBDSEVDSyBGT1IgVVBEQVRFUyAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCgoKbm9kZS5zdG9yZSgpOwoKcHJpbnQoJ21haW4oKScsICdsb29waW5nIGZvciBtcXR0IGV2ZW50cycpOwoKbXF0dF9jbGllbnQubG9vcF9mb3JldmVyKCk7CgoK",
	"__keys": ["name"],
	"__trMap": []
}