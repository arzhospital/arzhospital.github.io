{
	"Id": "029d68170944e43a1f9447db8cc905219e37dcfb",
	"active": "true",
	"enabled": "true",
	"code": "python",
	"date": "2024-10-06T08:45:25.213Z",
	"name": "Python",
	"remark": "IyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiMjIyMjIyMjIyMjIyMjIyMjIyMjICAgQVBJIFNlcnZlciBTdHViIGZvciAoTWljcm8pUHl0aG9uICAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwojIyMjIyMjIyMjIyMjIyMjIyMjIyBWRVJTSU9OOiAyMDI0LTEwLTA2VDA4OjQ1OjEzLjgwOFogICMjIyMjIyMjIyMjIyMjIyMjIyMjCiMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwoKCiNpbXBvcnQgdXJsbGliMywganNvbiwgYmFzZTY0OwojZXhlYyhiYXNlNjQuYjY0ZGVjb2RlKGpzb24ubG9hZHModXJsbGliMy5Qb29sTWFuYWdlcigpLnJlcXVlc3QoJ0dFVCcsICJodHRwczovL2Fyemhvc3BpdGFsLmdpdGh1Yi5pby9lc3B0ZXN0L05vZGVfVHlwZS9QeXRob24uanNvbiIpLmRhdGEuZGVjb2RlKCd1dGYtOCcpKVsicmVtYXJrIl0pKTsKCiMgaW1wb3J0IHJlcXVlc3RzLCB1YmluYXNjaWksIHVqc29uOwojIGV4ZWModWJpbmFzY2lpLmEyYl9iYXNlNjQodWpzb24ubG9hZHMocmVxdWVzdHMuZ2V0KCJodHRwczovL2Fyemhvc3BpdGFsLmdpdGh1Yi5pby9lc3B0ZXN0L05vZGVfVHlwZS9QeXRob24uanNvbiIpLnRleHQpWyJyZW1hcmsiXSkpOwoKaW1wb3J0IHBhaG8ubXF0dC5jbGllbnQsanNvbix1cmxsaWIzLHRocmVhZGluZyx1dWlkLHBhdGhsaWIsdGltZSxnYyxpbyxkYXRldGltZSxyZSxvcyxzeXM7CgoKY2xhc3MgVXNlcigpOgogICAgZGVmIF9faW5pdF9fKHNlbGYsIElkPU5vbmUsIGFjdGl2ZT1Ob25lLCBlbmFibGVkPU5vbmUsIGNvZGU9Tm9uZSwgb3JkZXI9Tm9uZSwgZGF0ZT1Ob25lLCBuYW1lPU5vbmUsIHJlbWFyaz1Ob25lLCB1c2VybmFtZT1Ob25lLCBwYXNzd29yZD1Ob25lKToKICAgICAgICBzdXBlcigpLl9faW5pdF9fKCk7CgogICAgICAgICNwcmludCgnVXNlcjo6X19pbml0X18oKScpOwogICAgICAgIGlmIElkIGlzIG5vdCBOb25lOgogICAgICAgICAgICBzZWxmLklkID0gSWQ7CgogICAgICAgIAogICAgICAgIHNlbGYuYWN0aXZlKGFjdGl2ZSk7CiAgICAgICAgc2VsZi5lbmFibGVkKGVuYWJsZWQpOwogICAgICAgIHNlbGYuY29kZShjb2RlKTsKICAgICAgICBzZWxmLm9yZGVyKG9yZGVyKTsKICAgICAgICBzZWxmLmRhdGUoZGF0ZSk7CiAgICAgICAgc2VsZi5uYW1lKG5hbWUpOwogICAgICAgIHNlbGYucmVtYXJrKHJlbWFyayk7CiAgICAgICAgc2VsZi51c2VybmFtZSh1c2VybmFtZSk7CiAgICAgICAgc2VsZi5wYXNzd29yZChwYXNzd29yZCk7CiAgICAgICAgCiAgICBJZCA9IE5vbmU7CiAgICAKICAgIAogICAgIyBhY3RpdmU6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9hY3RpdmUgPSBOb25lOwogICAgZGVmIGFjdGl2ZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fYWN0aXZlID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2FjdGl2ZTsKCgogICAgCiAgICAjIGVuYWJsZWQ6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9lbmFibGVkID0gTm9uZTsKICAgIGRlZiBlbmFibGVkKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9lbmFibGVkID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2VuYWJsZWQ7CgoKICAgIAogICAgIyBjb2RlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfY29kZSA9IE5vbmU7CiAgICBkZWYgY29kZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fY29kZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9jb2RlOwoKCiAgICAKICAgICMgb3JkZXI6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9vcmRlciA9IE5vbmU7CiAgICBkZWYgb3JkZXIoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX29yZGVyID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX29yZGVyOwoKCiAgICAKICAgICMgZGF0ZTogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX2RhdGUgPSBOb25lOwogICAgZGVmIGRhdGUoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2RhdGUgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fZGF0ZTsKCgogICAgCiAgICAjIG5hbWU6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9uYW1lID0gTm9uZTsKICAgIGRlZiBuYW1lKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9uYW1lID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX25hbWU7CgoKICAgIAogICAgIyByZW1hcms6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9yZW1hcmsgPSBOb25lOwogICAgZGVmIHJlbWFyayhzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fcmVtYXJrID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3JlbWFyazsKCgogICAgCiAgICAjIHVzZXJuYW1lOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfdXNlcm5hbWUgPSBOb25lOwogICAgZGVmIHVzZXJuYW1lKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl91c2VybmFtZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl91c2VybmFtZTsKCgogICAgCiAgICAjIHBhc3N3b3JkOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfcGFzc3dvcmQgPSBOb25lOwogICAgZGVmIHBhc3N3b3JkKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9wYXNzd29yZCA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9wYXNzd29yZDsKCgogICAgCiAgICAKICAgIGRlZiBfZnJvbURvY3VtZW50KHNlbGYsIG9iaik6CiAgICAgICAgX190b1N0cmluZyA9ICdVc2VyOjpfZnJvbURvY3VtZW50KCk6ICc7CiAgICAgICAgCiAgICAgICAgaWYgb2JqIGlzIE5vbmU6CiAgICAgICAgICAgIHJldHVybiBzZWxmOwoKICAgICAgICBpZiBpc2luc3RhbmNlKG9iaiwgYnl0ZXMpOgogICAgICAgICAgICBvYmogPSBzdHIob2JqLCAidXRmLTgiKTsKICAgICAgICAKICAgICAgICBpZiBpc2luc3RhbmNlKG9iaiwgc3RyKSBvciB0eXBlKG9iaikgaXMgc3RyOgogICAgICAgICAgICBpZiByZS5tYXRjaChyIigoKFtBLVphLXpdezMsOX06KD86XC9cLyk/KSg/OlstOzomPVwrXCQsXHddK0ApP1tBLVphLXowLTkuLV0rfCg/Ond3dy58Wy07OiY9XCtcJCxcd10rQClbQS1aYS16MC05Li1dKykoKD86XC9bXCt+JVwvLlx3XC1fXSopP1w/Pyg/OlstXCs9JjslQC5cd19dKikjPyg/Oltcd10qKSk/KSIsIG9iaik6CiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgb2JqID0ganNvbi5sb2Fkcyh1cmxsaWIzLlBvb2xNYW5hZ2VyKCkucmVxdWVzdCgnR0VUJywgb2JqKS5kYXRhLmRlY29kZSgndXRmLTgnKSk7CiAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgb2JqID0ge307CiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBvYmogPSBqc29uLmxvYWRzKG9iaik7CiAgICAgICAgCiAgICAgICAgaWYgbm90IGlzaW5zdGFuY2Uob2JqLCAoc3RyLCBieXRlcywgZGljdCkpOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJ0dPVCBIRVJFOiAnICsgc3RyKHR5cGUob2JqKSkpOwogICAgICAgICAgICByZXR1cm4gb2JqOwoKICAgICAgICAgICAgZm9yIGkgaW4gb2JqOgogICAgICAgICAgICAgICAgb2JqW2ldID0gVXNlcigpLl9mcm9tRG9jdW1lbnQob2JqW2ldKTsKICAgICAgICAgICAgcmV0dXJuIG9iajsKCgogICAgICAgIGlmICdJZCcgaW4gb2JqOgogICAgICAgICAgICBzZWxmLklkID0gb2JqWydJZCddOwoKICAgIAogICAgICAgIGlmICdhY3RpdmUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5hY3RpdmUob2JqWydhY3RpdmUnXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnZW5hYmxlZCcgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmVuYWJsZWQob2JqWydlbmFibGVkJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ2NvZGUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5jb2RlKG9ialsnY29kZSddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdvcmRlcicgaW4gb2JqOgogICAgICAgICAgICBzZWxmLm9yZGVyKG9ialsnb3JkZXInXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnZGF0ZScgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmRhdGUob2JqWydkYXRlJ10pOwogICAgICAgIAogICAgICAgICAgICBzZWxmLmRhdGUoZGF0ZXRpbWUuZGF0ZXRpbWUuZnJvbWlzb2Zvcm1hdChzZWxmLmRhdGUoKSkpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ25hbWUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5uYW1lKG9ialsnbmFtZSddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdyZW1hcmsnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5yZW1hcmsob2JqWydyZW1hcmsnXSk7CiAgICAgICAgCiAgICAgICAgICAgIHNlbGYucmVtYXJrKCBiYXNlNjQuYjY0ZGVjb2RlKHNlbGYucmVtYXJrKCkpICk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAndXNlcm5hbWUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi51c2VybmFtZShvYmpbJ3VzZXJuYW1lJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ3Bhc3N3b3JkJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYucGFzc3dvcmQob2JqWydwYXNzd29yZCddKTsKICAgICAgICAKICAgIAoKICAgICAgICBnYy5jb2xsZWN0KCk7CiAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAKICAgIGRlZiBfdG9Eb2N1bWVudChzZWxmLCBiSlNPTj1Ob25lKToKICAgICAgICBfX3RvU3RyaW5nID0gJ1VzZXI6Ol90b0RvY3VtZW50KCk6ICc7CgogICAgICAgIHJldCA9IHt9OwogICAgICAgIGlmIHNlbGYuSWQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiSWQiXSA9IHNlbGYuSWQ7CgogICAgCiAgICAgICAgaWYgc2VsZi5hY3RpdmUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJhY3RpdmUiXSA9IHNlbGYuYWN0aXZlKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLmVuYWJsZWQoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJlbmFibGVkIl0gPSBzZWxmLmVuYWJsZWQoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYuY29kZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbImNvZGUiXSA9IHNlbGYuY29kZSgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5vcmRlcigpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbIm9yZGVyIl0gPSBzZWxmLm9yZGVyKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLmRhdGUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJkYXRlIl0gPSBzZWxmLmRhdGUoKTsKICAgICAgICAKICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShyZXRbImRhdGUiXSwgZGF0ZXRpbWUuZGF0ZXRpbWUpOgogICAgICAgICAgICAgICAgcmV0WyJkYXRlIl0gPSByZXRbImRhdGUiXS5pc29mb3JtYXQoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYubmFtZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbIm5hbWUiXSA9IHNlbGYubmFtZSgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5yZW1hcmsoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IHNlbGYucmVtYXJrKCk7CiAgICAgICAgCiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UocmV0WyJyZW1hcmsiXSwgZGljdCk6CiAgICAgICAgICAgICAgICByZXRbInJlbWFyayJdID0ganNvbi5kdW1wcyhyZXRbInJlbWFyayJdKS5lbmNvZGUoJ3V0Zi04Jyk7CgogICAgICAgICAgICByZXRbInJlbWFyayJdID0gIGJhc2U2NC5iNjRlbmNvZGUocmV0WyJyZW1hcmsiXSkuZGVjb2RlKCd1dGYtOCcpLnN0cmlwKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLnVzZXJuYW1lKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsidXNlcm5hbWUiXSA9IHNlbGYudXNlcm5hbWUoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYucGFzc3dvcmQoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJwYXNzd29yZCJdID0gc2VsZi5wYXNzd29yZCgpOwogICAgICAgIAogICAgCiAgICAgICAgCiAgICAgICAgaWYgYkpTT04gaXMgbm90IE5vbmU6CiAgICAgICAgICAgICNwcmludChfX3RvU3RyaW5nICsgIkdPVCBIRVJFIiwgdHlwZShyZXQpLCByZXQpOwogICAgICAgICAgICByZXQgPSBqc29uLmR1bXBzKHJldCk7CiAgICAgICAgZ2MuY29sbGVjdCgpOwogICAgICAgIHJldHVybiByZXQ7CgogICAgCiAgICBkZWYgc3RvcmUoc2VsZiwgX19ldmVudD1Ob25lKToKICAgICAgICBfX3RvU3RyaW5nID0gJ1VzZXI6OnN0b3JlKCk6ICc7CiAgICAgICAgCiAgICAgICAgZXZKU09OID0gTm9uZTsKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgZXZKU09OID0ganNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7CiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoKICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsKICAgICAgICAKCiAgICAgICAgYW5zd2VyID0gTm9uZTsKCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpbWUoKSkrJ10uVXNlci5zdG9yZSgpJykubWV0aG9kKCdzdG9yZScpLmNsYXNzTmFtZSgnVXNlcicpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOwogICAgICAgIAogICAgICAgIGdjLmNvbGxlY3QoKTsKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOwoKICAgICAgICAKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsKICAgICAgICAKICAgICAgICAgICAgYW5zd2VyID0gVXNlcigpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsKICAgICAgICAKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOwoKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOwogICAgICAgICAgICAKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOwoKICAgICAgICAgICAgCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOwogICAgICAgICAgICAKCiAgICAgICAgcmV0dXJuIGFuc3dlcjsKCiAgICAKICAgIGRlZiBmaW5kQWxsKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6CiAgICAgICAgX190b1N0cmluZyA9ICdVc2VyOjpmaW5kQWxsKCk6ICc7CiAgICAgICAgCiAgICAgICAgZXZKU09OID0gTm9uZTsKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgZXZKU09OID0ganNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7CiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoKICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsKICAgICAgICAKCiAgICAgICAgYW5zd2VyID0gTm9uZTsKCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpbWUoKSkrJ10uVXNlci5maW5kQWxsKCknKS5tZXRob2QoJ2ZpbmRBbGwnKS5jbGFzc05hbWUoJ1VzZXInKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7CiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsKICAgICAgICAKICAgICAgICBnYy5jb2xsZWN0KCk7CgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsKCiAgICAgICAgCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7CiAgICAgICAgCiAgICAgICAgICAgIGFuc3dlciA9IFVzZXIoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7CiAgICAgICAgCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsKCgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsKCiAgICAgICAgICAgIAogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsKICAgICAgICAgICAgCgogICAgICAgIHJldHVybiBhbnN3ZXI7CgogICAgCiAgICBkZWYgZmluZChzZWxmLCBfX2V2ZW50PU5vbmUpOgogICAgICAgIF9fdG9TdHJpbmcgPSAnVXNlcjo6ZmluZCgpOiAnOwogICAgICAgIAogICAgICAgIGV2SlNPTiA9IE5vbmU7CgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIGV2SlNPTiA9IGpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOwogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046CiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7CiAgICAgICAgCgogICAgICAgIGFuc3dlciA9IE5vbmU7CgogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aW1lKCkpKyddLlVzZXIuZmluZCgpJykubWV0aG9kKCdmaW5kJykuY2xhc3NOYW1lKCdVc2VyJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOwogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7CiAgICAgICAgCiAgICAgICAgZ2MuY29sbGVjdCgpOwoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7CgogICAgICAgIAogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOwogICAgICAgIAogICAgICAgICAgICBhbnN3ZXIgPSBVc2VyKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOwogICAgICAgIAoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7CgoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOgogICAgICAgICAgICAKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7CgogICAgICAgICAgICAKICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7CiAgICAgICAgICAgIAoKICAgICAgICByZXR1cm4gYW5zd2VyOwoKICAgIAogICAgZGVmIGluaXQoc2VsZiwgX19ldmVudD1Ob25lKToKICAgICAgICBfX3RvU3RyaW5nID0gJ1VzZXI6OmluaXQoKTogJzsKICAgICAgICAKICAgICAgICBldkpTT04gPSBOb25lOwoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBldkpTT04gPSBqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsKICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOgogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOwogICAgICAgIAoKICAgICAgICBhbnN3ZXIgPSBOb25lOwoKICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGltZSgpKSsnXS5Vc2VyLmluaXQoKScpLm1ldGhvZCgnaW5pdCcpLmNsYXNzTmFtZSgnVXNlcicpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOwogICAgICAgIAogICAgICAgIGdjLmNvbGxlY3QoKTsKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOwoKICAgICAgICAKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsKICAgICAgICAKICAgICAgICAgICAgYW5zd2VyID0gZXZKU09OOwogICAgICAgIAoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7CgoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOgogICAgICAgICAgICAKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChzdHIoYW5zd2VyKSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7CgogICAgICAgICAgICAKICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7CiAgICAgICAgICAgIAoKICAgICAgICByZXR1cm4gYW5zd2VyOwoKICAgIAoKCmNsYXNzIE1ldHJpYygpOgogICAgZGVmIF9faW5pdF9fKHNlbGYsIElkPU5vbmUsIGFjdGl2ZT1Ob25lLCBlbmFibGVkPU5vbmUsIGNvZGU9Tm9uZSwgb3JkZXI9Tm9uZSwgZGF0ZT1Ob25lLCBuYW1lPU5vbmUsIHJlbWFyaz1Ob25lLCBzY3JpcHQ9Tm9uZSwgdHlwZT1Ob25lLCBkZXZpY2VUeXBlPU5vbmUpOgogICAgICAgIHN1cGVyKCkuX19pbml0X18oKTsKCiAgICAgICAgI3ByaW50KCdNZXRyaWM6Ol9faW5pdF9fKCknKTsKICAgICAgICBpZiBJZCBpcyBub3QgTm9uZToKICAgICAgICAgICAgc2VsZi5JZCA9IElkOwoKICAgICAgICAKICAgICAgICBzZWxmLmFjdGl2ZShhY3RpdmUpOwogICAgICAgIHNlbGYuZW5hYmxlZChlbmFibGVkKTsKICAgICAgICBzZWxmLmNvZGUoY29kZSk7CiAgICAgICAgc2VsZi5vcmRlcihvcmRlcik7CiAgICAgICAgc2VsZi5kYXRlKGRhdGUpOwogICAgICAgIHNlbGYubmFtZShuYW1lKTsKICAgICAgICBzZWxmLnJlbWFyayhyZW1hcmspOwogICAgICAgIHNlbGYuc2NyaXB0KHNjcmlwdCk7CiAgICAgICAgc2VsZi50eXBlKHR5cGUpOwogICAgICAgIHNlbGYuZGV2aWNlVHlwZShkZXZpY2VUeXBlKTsKICAgICAgICAKICAgIElkID0gTm9uZTsKICAgIAogICAgCiAgICAjIGFjdGl2ZTogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX2FjdGl2ZSA9IE5vbmU7CiAgICBkZWYgYWN0aXZlKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9hY3RpdmUgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fYWN0aXZlOwoKCiAgICAKICAgICMgZW5hYmxlZDogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX2VuYWJsZWQgPSBOb25lOwogICAgZGVmIGVuYWJsZWQoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2VuYWJsZWQgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fZW5hYmxlZDsKCgogICAgCiAgICAjIGNvZGU6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9jb2RlID0gTm9uZTsKICAgIGRlZiBjb2RlKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9jb2RlID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2NvZGU7CgoKICAgIAogICAgIyBvcmRlcjogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX29yZGVyID0gTm9uZTsKICAgIGRlZiBvcmRlcihzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fb3JkZXIgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fb3JkZXI7CgoKICAgIAogICAgIyBkYXRlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfZGF0ZSA9IE5vbmU7CiAgICBkZWYgZGF0ZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fZGF0ZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9kYXRlOwoKCiAgICAKICAgICMgbmFtZTogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX25hbWUgPSBOb25lOwogICAgZGVmIG5hbWUoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX25hbWUgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fbmFtZTsKCgogICAgCiAgICAjIHJlbWFyazogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX3JlbWFyayA9IE5vbmU7CiAgICBkZWYgcmVtYXJrKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9yZW1hcmsgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fcmVtYXJrOwoKCiAgICAKICAgICMgc2NyaXB0OiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfc2NyaXB0ID0gTm9uZTsKICAgIGRlZiBzY3JpcHQoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX3NjcmlwdCA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9zY3JpcHQ7CgoKICAgIAogICAgIyB0eXBlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfdHlwZSA9IE5vbmU7CiAgICBkZWYgdHlwZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fdHlwZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl90eXBlOwoKCiAgICAKICAgICMgZGV2aWNlVHlwZTogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX2RldmljZVR5cGUgPSBOb25lOwogICAgZGVmIGRldmljZVR5cGUoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2RldmljZVR5cGUgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fZGV2aWNlVHlwZTsKCgogICAgCiAgICAKICAgIGRlZiBfZnJvbURvY3VtZW50KHNlbGYsIG9iaik6CiAgICAgICAgX190b1N0cmluZyA9ICdNZXRyaWM6Ol9mcm9tRG9jdW1lbnQoKTogJzsKICAgICAgICAKICAgICAgICBpZiBvYmogaXMgTm9uZToKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CgogICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLCBieXRlcyk6CiAgICAgICAgICAgIG9iaiA9IHN0cihvYmosICJ1dGYtOCIpOwogICAgICAgIAogICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLCBzdHIpIG9yIHR5cGUob2JqKSBpcyBzdHI6CiAgICAgICAgICAgIGlmIHJlLm1hdGNoKHIiKCgoW0EtWmEtel17Myw5fTooPzpcL1wvKT8pKD86Wy07OiY9XCtcJCxcd10rQCk/W0EtWmEtejAtOS4tXSt8KD86d3d3LnxbLTs6Jj1cK1wkLFx3XStAKVtBLVphLXowLTkuLV0rKSgoPzpcL1tcK34lXC8uXHdcLV9dKik/XD8/KD86Wy1cKz0mOyVALlx3X10qKSM/KD86W1x3XSopKT8pIiwgb2JqKToKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBvYmogPSBqc29uLmxvYWRzKHVybGxpYjMuUG9vbE1hbmFnZXIoKS5yZXF1ZXN0KCdHRVQnLCBvYmopLmRhdGEuZGVjb2RlKCd1dGYtOCcpKTsKICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICBvYmogPSB7fTsKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIG9iaiA9IGpzb24ubG9hZHMob2JqKTsKICAgICAgICAKICAgICAgICBpZiBub3QgaXNpbnN0YW5jZShvYmosIChzdHIsIGJ5dGVzLCBkaWN0KSk6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnR09UIEhFUkU6ICcgKyBzdHIodHlwZShvYmopKSk7CiAgICAgICAgICAgIHJldHVybiBvYmo7CgogICAgICAgICAgICBmb3IgaSBpbiBvYmo6CiAgICAgICAgICAgICAgICBvYmpbaV0gPSBNZXRyaWMoKS5fZnJvbURvY3VtZW50KG9ialtpXSk7CiAgICAgICAgICAgIHJldHVybiBvYmo7CgoKICAgICAgICBpZiAnSWQnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5JZCA9IG9ialsnSWQnXTsKCiAgICAKICAgICAgICBpZiAnYWN0aXZlJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuYWN0aXZlKG9ialsnYWN0aXZlJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ2VuYWJsZWQnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5lbmFibGVkKG9ialsnZW5hYmxlZCddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdjb2RlJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuY29kZShvYmpbJ2NvZGUnXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnb3JkZXInIGluIG9iajoKICAgICAgICAgICAgc2VsZi5vcmRlcihvYmpbJ29yZGVyJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ2RhdGUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5kYXRlKG9ialsnZGF0ZSddKTsKICAgICAgICAKICAgICAgICAgICAgc2VsZi5kYXRlKGRhdGV0aW1lLmRhdGV0aW1lLmZyb21pc29mb3JtYXQoc2VsZi5kYXRlKCkpKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICduYW1lJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYubmFtZShvYmpbJ25hbWUnXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAncmVtYXJrJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYucmVtYXJrKG9ialsncmVtYXJrJ10pOwogICAgICAgIAogICAgICAgICAgICBzZWxmLnJlbWFyayggYmFzZTY0LmI2NGRlY29kZShzZWxmLnJlbWFyaygpKSApOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ3NjcmlwdCcgaW4gb2JqOgogICAgICAgICAgICBzZWxmLnNjcmlwdChvYmpbJ3NjcmlwdCddKTsKICAgICAgICAKICAgICAgICAgICAgc2VsZi5zY3JpcHQoIGJhc2U2NC5iNjRkZWNvZGUoc2VsZi5zY3JpcHQoKSkgKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICd0eXBlJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYudHlwZShNZXRyaWNfVHlwZSgpLl9mcm9tRG9jdW1lbnQob2JqWyd0eXBlJ10pKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdkZXZpY2VUeXBlJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuZGV2aWNlVHlwZShEZXZpY2VfVHlwZSgpLl9mcm9tRG9jdW1lbnQob2JqWydkZXZpY2VUeXBlJ10pKTsKICAgICAgICAKICAgIAoKICAgICAgICBnYy5jb2xsZWN0KCk7CiAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAKICAgIGRlZiBfdG9Eb2N1bWVudChzZWxmLCBiSlNPTj1Ob25lKToKICAgICAgICBfX3RvU3RyaW5nID0gJ01ldHJpYzo6X3RvRG9jdW1lbnQoKTogJzsKCiAgICAgICAgcmV0ID0ge307CiAgICAgICAgaWYgc2VsZi5JZCBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJJZCJdID0gc2VsZi5JZDsKCiAgICAKICAgICAgICBpZiBzZWxmLmFjdGl2ZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbImFjdGl2ZSJdID0gc2VsZi5hY3RpdmUoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYuZW5hYmxlZCgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbImVuYWJsZWQiXSA9IHNlbGYuZW5hYmxlZCgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5jb2RlKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiY29kZSJdID0gc2VsZi5jb2RlKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLm9yZGVyKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsib3JkZXIiXSA9IHNlbGYub3JkZXIoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYuZGF0ZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbImRhdGUiXSA9IHNlbGYuZGF0ZSgpOwogICAgICAgIAogICAgICAgICAgICBpZiBpc2luc3RhbmNlKHJldFsiZGF0ZSJdLCBkYXRldGltZS5kYXRldGltZSk6CiAgICAgICAgICAgICAgICByZXRbImRhdGUiXSA9IHJldFsiZGF0ZSJdLmlzb2Zvcm1hdCgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5uYW1lKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsibmFtZSJdID0gc2VsZi5uYW1lKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLnJlbWFyaygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbInJlbWFyayJdID0gc2VsZi5yZW1hcmsoKTsKICAgICAgICAKICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShyZXRbInJlbWFyayJdLCBkaWN0KToKICAgICAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSBqc29uLmR1bXBzKHJldFsicmVtYXJrIl0pLmVuY29kZSgndXRmLTgnKTsKCiAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSAgYmFzZTY0LmI2NGVuY29kZShyZXRbInJlbWFyayJdKS5kZWNvZGUoJ3V0Zi04Jykuc3RyaXAoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYuc2NyaXB0KCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsic2NyaXB0Il0gPSBzZWxmLnNjcmlwdCgpOwogICAgICAgIAogICAgICAgICAgICBpZiBpc2luc3RhbmNlKHJldFsic2NyaXB0Il0sIGRpY3QpOgogICAgICAgICAgICAgICAgcmV0WyJzY3JpcHQiXSA9IGpzb24uZHVtcHMocmV0WyJzY3JpcHQiXSkuZW5jb2RlKCd1dGYtOCcpOwoKICAgICAgICAgICAgcmV0WyJzY3JpcHQiXSA9ICBiYXNlNjQuYjY0ZW5jb2RlKHJldFsic2NyaXB0Il0pLmRlY29kZSgndXRmLTgnKS5zdHJpcCgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi50eXBlKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsidHlwZSJdID0gc2VsZi50eXBlKCkuX3RvRG9jdW1lbnQoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYuZGV2aWNlVHlwZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbImRldmljZVR5cGUiXSA9IHNlbGYuZGV2aWNlVHlwZSgpLl90b0RvY3VtZW50KCk7CiAgICAgICAgCiAgICAKICAgICAgICAKICAgICAgICBpZiBiSlNPTiBpcyBub3QgTm9uZToKICAgICAgICAgICAgI3ByaW50KF9fdG9TdHJpbmcgKyAiR09UIEhFUkUiLCB0eXBlKHJldCksIHJldCk7CiAgICAgICAgICAgIHJldCA9IGpzb24uZHVtcHMocmV0KTsKICAgICAgICBnYy5jb2xsZWN0KCk7CiAgICAgICAgcmV0dXJuIHJldDsKCiAgICAKICAgIGRlZiBzdG9yZShzZWxmLCBfX2V2ZW50PU5vbmUpOgogICAgICAgIF9fdG9TdHJpbmcgPSAnTWV0cmljOjpzdG9yZSgpOiAnOwogICAgICAgIAogICAgICAgIGV2SlNPTiA9IE5vbmU7CgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIGV2SlNPTiA9IGpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOwogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046CiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7CiAgICAgICAgCgogICAgICAgIGFuc3dlciA9IE5vbmU7CgogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aW1lKCkpKyddLk1ldHJpYy5zdG9yZSgpJykubWV0aG9kKCdzdG9yZScpLmNsYXNzTmFtZSgnTWV0cmljJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOwogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7CiAgICAgICAgCiAgICAgICAgZ2MuY29sbGVjdCgpOwoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7CgogICAgICAgIAogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOwogICAgICAgIAogICAgICAgICAgICBhbnN3ZXIgPSBNZXRyaWMoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7CiAgICAgICAgCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsKCgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsKCiAgICAgICAgICAgIAogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsKICAgICAgICAgICAgCgogICAgICAgIHJldHVybiBhbnN3ZXI7CgogICAgCiAgICBkZWYgZmluZEFsbChzZWxmLCBfX2V2ZW50PU5vbmUpOgogICAgICAgIF9fdG9TdHJpbmcgPSAnTWV0cmljOjpmaW5kQWxsKCk6ICc7CiAgICAgICAgCiAgICAgICAgZXZKU09OID0gTm9uZTsKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgZXZKU09OID0ganNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7CiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoKICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsKICAgICAgICAKCiAgICAgICAgYW5zd2VyID0gTm9uZTsKCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpbWUoKSkrJ10uTWV0cmljLmZpbmRBbGwoKScpLm1ldGhvZCgnZmluZEFsbCcpLmNsYXNzTmFtZSgnTWV0cmljJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOwogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7CiAgICAgICAgCiAgICAgICAgZ2MuY29sbGVjdCgpOwoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7CgogICAgICAgIAogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOwogICAgICAgIAogICAgICAgICAgICBhbnN3ZXIgPSBNZXRyaWMoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7CiAgICAgICAgCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsKCgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsKCiAgICAgICAgICAgIAogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsKICAgICAgICAgICAgCgogICAgICAgIHJldHVybiBhbnN3ZXI7CgogICAgCiAgICBkZWYgZmluZChzZWxmLCBfX2V2ZW50PU5vbmUpOgogICAgICAgIF9fdG9TdHJpbmcgPSAnTWV0cmljOjpmaW5kKCk6ICc7CiAgICAgICAgCiAgICAgICAgZXZKU09OID0gTm9uZTsKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgZXZKU09OID0ganNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7CiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoKICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsKICAgICAgICAKCiAgICAgICAgYW5zd2VyID0gTm9uZTsKCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpbWUoKSkrJ10uTWV0cmljLmZpbmQoKScpLm1ldGhvZCgnZmluZCcpLmNsYXNzTmFtZSgnTWV0cmljJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOwogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7CiAgICAgICAgCiAgICAgICAgZ2MuY29sbGVjdCgpOwoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7CgogICAgICAgIAogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOwogICAgICAgIAogICAgICAgICAgICBhbnN3ZXIgPSBNZXRyaWMoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7CiAgICAgICAgCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsKCgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsKCiAgICAgICAgICAgIAogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsKICAgICAgICAgICAgCgogICAgICAgIHJldHVybiBhbnN3ZXI7CgogICAgCgoKY2xhc3MgTWV0cmljX1ZhbHVlKCk6CiAgICBkZWYgX19pbml0X18oc2VsZiwgSWQ9Tm9uZSwgYWN0aXZlPU5vbmUsIGVuYWJsZWQ9Tm9uZSwgY29kZT1Ob25lLCBvcmRlcj1Ob25lLCBkYXRlPU5vbmUsIG5hbWU9Tm9uZSwgcmVtYXJrPU5vbmUsIHZhbHVlPU5vbmUsIG1lYXN1cmVkPU5vbmUsIG1ldHJpYz1Ob25lLCBkZXZpY2U9Tm9uZSk6CiAgICAgICAgc3VwZXIoKS5fX2luaXRfXygpOwoKICAgICAgICAjcHJpbnQoJ01ldHJpY19WYWx1ZTo6X19pbml0X18oKScpOwogICAgICAgIGlmIElkIGlzIG5vdCBOb25lOgogICAgICAgICAgICBzZWxmLklkID0gSWQ7CgogICAgICAgIAogICAgICAgIHNlbGYuYWN0aXZlKGFjdGl2ZSk7CiAgICAgICAgc2VsZi5lbmFibGVkKGVuYWJsZWQpOwogICAgICAgIHNlbGYuY29kZShjb2RlKTsKICAgICAgICBzZWxmLm9yZGVyKG9yZGVyKTsKICAgICAgICBzZWxmLmRhdGUoZGF0ZSk7CiAgICAgICAgc2VsZi5uYW1lKG5hbWUpOwogICAgICAgIHNlbGYucmVtYXJrKHJlbWFyayk7CiAgICAgICAgc2VsZi52YWx1ZSh2YWx1ZSk7CiAgICAgICAgc2VsZi5tZWFzdXJlZChtZWFzdXJlZCk7CiAgICAgICAgc2VsZi5tZXRyaWMobWV0cmljKTsKICAgICAgICBzZWxmLmRldmljZShkZXZpY2UpOwogICAgICAgIAogICAgSWQgPSBOb25lOwogICAgCiAgICAKICAgICMgYWN0aXZlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfYWN0aXZlID0gTm9uZTsKICAgIGRlZiBhY3RpdmUoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2FjdGl2ZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9hY3RpdmU7CgoKICAgIAogICAgIyBlbmFibGVkOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfZW5hYmxlZCA9IE5vbmU7CiAgICBkZWYgZW5hYmxlZChzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fZW5hYmxlZCA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9lbmFibGVkOwoKCiAgICAKICAgICMgY29kZTogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX2NvZGUgPSBOb25lOwogICAgZGVmIGNvZGUoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2NvZGUgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fY29kZTsKCgogICAgCiAgICAjIG9yZGVyOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfb3JkZXIgPSBOb25lOwogICAgZGVmIG9yZGVyKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9vcmRlciA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9vcmRlcjsKCgogICAgCiAgICAjIGRhdGU6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9kYXRlID0gTm9uZTsKICAgIGRlZiBkYXRlKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9kYXRlID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2RhdGU7CgoKICAgIAogICAgIyBuYW1lOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfbmFtZSA9IE5vbmU7CiAgICBkZWYgbmFtZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fbmFtZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9uYW1lOwoKCiAgICAKICAgICMgcmVtYXJrOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfcmVtYXJrID0gTm9uZTsKICAgIGRlZiByZW1hcmsoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX3JlbWFyayA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9yZW1hcms7CgoKICAgIAogICAgIyB2YWx1ZTogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX3ZhbHVlID0gTm9uZTsKICAgIGRlZiB2YWx1ZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fdmFsdWUgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fdmFsdWU7CgoKICAgIAogICAgIyBtZWFzdXJlZDogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX21lYXN1cmVkID0gTm9uZTsKICAgIGRlZiBtZWFzdXJlZChzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fbWVhc3VyZWQgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fbWVhc3VyZWQ7CgoKICAgIAogICAgIyBtZXRyaWM6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9tZXRyaWMgPSBOb25lOwogICAgZGVmIG1ldHJpYyhzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fbWV0cmljID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX21ldHJpYzsKCgogICAgCiAgICAjIGRldmljZTogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX2RldmljZSA9IE5vbmU7CiAgICBkZWYgZGV2aWNlKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9kZXZpY2UgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fZGV2aWNlOwoKCiAgICAKICAgIAogICAgZGVmIF9mcm9tRG9jdW1lbnQoc2VsZiwgb2JqKToKICAgICAgICBfX3RvU3RyaW5nID0gJ01ldHJpY19WYWx1ZTo6X2Zyb21Eb2N1bWVudCgpOiAnOwogICAgICAgIAogICAgICAgIGlmIG9iaiBpcyBOb25lOgogICAgICAgICAgICByZXR1cm4gc2VsZjsKCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIGJ5dGVzKToKICAgICAgICAgICAgb2JqID0gc3RyKG9iaiwgInV0Zi04Iik7CiAgICAgICAgCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIHN0cikgb3IgdHlwZShvYmopIGlzIHN0cjoKICAgICAgICAgICAgaWYgcmUubWF0Y2gociIoKChbQS1aYS16XXszLDl9Oig/OlwvXC8pPykoPzpbLTs6Jj1cK1wkLFx3XStAKT9bQS1aYS16MC05Li1dK3woPzp3d3cufFstOzomPVwrXCQsXHddK0ApW0EtWmEtejAtOS4tXSspKCg/OlwvW1wrfiVcLy5cd1wtX10qKT9cPz8oPzpbLVwrPSY7JUAuXHdfXSopIz8oPzpbXHddKikpPykiLCBvYmopOgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIG9iaiA9IGpzb24ubG9hZHModXJsbGliMy5Qb29sTWFuYWdlcigpLnJlcXVlc3QoJ0dFVCcsIG9iaikuZGF0YS5kZWNvZGUoJ3V0Zi04JykpOwogICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgIG9iaiA9IHt9OwogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgb2JqID0ganNvbi5sb2FkcyhvYmopOwogICAgICAgIAogICAgICAgIGlmIG5vdCBpc2luc3RhbmNlKG9iaiwgKHN0ciwgYnl0ZXMsIGRpY3QpKToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICdHT1QgSEVSRTogJyArIHN0cih0eXBlKG9iaikpKTsKICAgICAgICAgICAgcmV0dXJuIG9iajsKCiAgICAgICAgICAgIGZvciBpIGluIG9iajoKICAgICAgICAgICAgICAgIG9ialtpXSA9IE1ldHJpY19WYWx1ZSgpLl9mcm9tRG9jdW1lbnQob2JqW2ldKTsKICAgICAgICAgICAgcmV0dXJuIG9iajsKCgogICAgICAgIGlmICdJZCcgaW4gb2JqOgogICAgICAgICAgICBzZWxmLklkID0gb2JqWydJZCddOwoKICAgIAogICAgICAgIGlmICdhY3RpdmUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5hY3RpdmUob2JqWydhY3RpdmUnXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnZW5hYmxlZCcgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmVuYWJsZWQob2JqWydlbmFibGVkJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ2NvZGUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5jb2RlKG9ialsnY29kZSddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdvcmRlcicgaW4gb2JqOgogICAgICAgICAgICBzZWxmLm9yZGVyKG9ialsnb3JkZXInXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnZGF0ZScgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmRhdGUob2JqWydkYXRlJ10pOwogICAgICAgIAogICAgICAgICAgICBzZWxmLmRhdGUoZGF0ZXRpbWUuZGF0ZXRpbWUuZnJvbWlzb2Zvcm1hdChzZWxmLmRhdGUoKSkpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ25hbWUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5uYW1lKG9ialsnbmFtZSddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdyZW1hcmsnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5yZW1hcmsob2JqWydyZW1hcmsnXSk7CiAgICAgICAgCiAgICAgICAgICAgIHNlbGYucmVtYXJrKCBiYXNlNjQuYjY0ZGVjb2RlKHNlbGYucmVtYXJrKCkpICk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAndmFsdWUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi52YWx1ZShvYmpbJ3ZhbHVlJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ21lYXN1cmVkJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYubWVhc3VyZWQob2JqWydtZWFzdXJlZCddKTsKICAgICAgICAKICAgICAgICAgICAgc2VsZi5tZWFzdXJlZChkYXRldGltZS5kYXRldGltZS5mcm9taXNvZm9ybWF0KHNlbGYubWVhc3VyZWQoKSkpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ21ldHJpYycgaW4gb2JqOgogICAgICAgICAgICBzZWxmLm1ldHJpYyhNZXRyaWMoKS5fZnJvbURvY3VtZW50KG9ialsnbWV0cmljJ10pKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdkZXZpY2UnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5kZXZpY2UoRGV2aWNlKCkuX2Zyb21Eb2N1bWVudChvYmpbJ2RldmljZSddKSk7CiAgICAgICAgCiAgICAKCiAgICAgICAgZ2MuY29sbGVjdCgpOwogICAgICAgIHJldHVybiBzZWxmOwogICAgCiAgICBkZWYgX3RvRG9jdW1lbnQoc2VsZiwgYkpTT049Tm9uZSk6CiAgICAgICAgX190b1N0cmluZyA9ICdNZXRyaWNfVmFsdWU6Ol90b0RvY3VtZW50KCk6ICc7CgogICAgICAgIHJldCA9IHt9OwogICAgICAgIGlmIHNlbGYuSWQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiSWQiXSA9IHNlbGYuSWQ7CgogICAgCiAgICAgICAgaWYgc2VsZi5hY3RpdmUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJhY3RpdmUiXSA9IHNlbGYuYWN0aXZlKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLmVuYWJsZWQoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJlbmFibGVkIl0gPSBzZWxmLmVuYWJsZWQoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYuY29kZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbImNvZGUiXSA9IHNlbGYuY29kZSgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5vcmRlcigpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbIm9yZGVyIl0gPSBzZWxmLm9yZGVyKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLmRhdGUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJkYXRlIl0gPSBzZWxmLmRhdGUoKTsKICAgICAgICAKICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShyZXRbImRhdGUiXSwgZGF0ZXRpbWUuZGF0ZXRpbWUpOgogICAgICAgICAgICAgICAgcmV0WyJkYXRlIl0gPSByZXRbImRhdGUiXS5pc29mb3JtYXQoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYubmFtZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbIm5hbWUiXSA9IHNlbGYubmFtZSgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5yZW1hcmsoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IHNlbGYucmVtYXJrKCk7CiAgICAgICAgCiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UocmV0WyJyZW1hcmsiXSwgZGljdCk6CiAgICAgICAgICAgICAgICByZXRbInJlbWFyayJdID0ganNvbi5kdW1wcyhyZXRbInJlbWFyayJdKS5lbmNvZGUoJ3V0Zi04Jyk7CgogICAgICAgICAgICByZXRbInJlbWFyayJdID0gIGJhc2U2NC5iNjRlbmNvZGUocmV0WyJyZW1hcmsiXSkuZGVjb2RlKCd1dGYtOCcpLnN0cmlwKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLnZhbHVlKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsidmFsdWUiXSA9IHNlbGYudmFsdWUoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYubWVhc3VyZWQoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJtZWFzdXJlZCJdID0gc2VsZi5tZWFzdXJlZCgpOwogICAgICAgIAogICAgICAgICAgICBpZiBpc2luc3RhbmNlKHJldFsibWVhc3VyZWQiXSwgZGF0ZXRpbWUuZGF0ZXRpbWUpOgogICAgICAgICAgICAgICAgcmV0WyJtZWFzdXJlZCJdID0gcmV0WyJtZWFzdXJlZCJdLmlzb2Zvcm1hdCgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5tZXRyaWMoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJtZXRyaWMiXSA9IHNlbGYubWV0cmljKCkuX3RvRG9jdW1lbnQoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYuZGV2aWNlKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiZGV2aWNlIl0gPSBzZWxmLmRldmljZSgpLl90b0RvY3VtZW50KCk7CiAgICAgICAgCiAgICAKICAgICAgICAKICAgICAgICBpZiBiSlNPTiBpcyBub3QgTm9uZToKICAgICAgICAgICAgI3ByaW50KF9fdG9TdHJpbmcgKyAiR09UIEhFUkUiLCB0eXBlKHJldCksIHJldCk7CiAgICAgICAgICAgIHJldCA9IGpzb24uZHVtcHMocmV0KTsKICAgICAgICBnYy5jb2xsZWN0KCk7CiAgICAgICAgcmV0dXJuIHJldDsKCiAgICAKICAgIGRlZiBzdG9yZShzZWxmLCBfX2V2ZW50PU5vbmUpOgogICAgICAgIF9fdG9TdHJpbmcgPSAnTWV0cmljX1ZhbHVlOjpzdG9yZSgpOiAnOwogICAgICAgIAogICAgICAgIGV2SlNPTiA9IE5vbmU7CgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIGV2SlNPTiA9IGpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOwogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046CiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7CiAgICAgICAgCgogICAgICAgIGFuc3dlciA9IE5vbmU7CgogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aW1lKCkpKyddLk1ldHJpY19WYWx1ZS5zdG9yZSgpJykubWV0aG9kKCdzdG9yZScpLmNsYXNzTmFtZSgnTWV0cmljX1ZhbHVlJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOwogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7CiAgICAgICAgCiAgICAgICAgZ2MuY29sbGVjdCgpOwoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7CgogICAgICAgICAgICBpZiBzZWxmLm1lYXN1cmVkKCkgaXMgTm9uZToKICAgICAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAicmVhZGluZy4uLiIpOwogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJ3cml0aW5nLi4uIik7CiAgICAgICAgCiAgICAgICAgCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7CiAgICAgICAgCiAgICAgICAgICAgIGFuc3dlciA9IE1ldHJpY19WYWx1ZSgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsKICAgICAgICAKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOwoKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOwogICAgICAgICAgICAKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOwoKICAgICAgICAgICAgCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOwogICAgICAgICAgICAKCiAgICAgICAgcmV0dXJuIGFuc3dlcjsKCiAgICAKICAgIGRlZiBmaW5kQWxsKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6CiAgICAgICAgX190b1N0cmluZyA9ICdNZXRyaWNfVmFsdWU6OmZpbmRBbGwoKTogJzsKICAgICAgICAKICAgICAgICBldkpTT04gPSBOb25lOwoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBldkpTT04gPSBqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsKICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOgogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOwogICAgICAgIAoKICAgICAgICBhbnN3ZXIgPSBOb25lOwoKICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGltZSgpKSsnXS5NZXRyaWNfVmFsdWUuZmluZEFsbCgpJykubWV0aG9kKCdmaW5kQWxsJykuY2xhc3NOYW1lKCdNZXRyaWNfVmFsdWUnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7CiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsKICAgICAgICAKICAgICAgICBnYy5jb2xsZWN0KCk7CgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsKCiAgICAgICAgCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7CiAgICAgICAgCiAgICAgICAgICAgIGFuc3dlciA9IE1ldHJpY19WYWx1ZSgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsKICAgICAgICAKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOwoKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOwogICAgICAgICAgICAKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOwoKICAgICAgICAgICAgCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOwogICAgICAgICAgICAKCiAgICAgICAgcmV0dXJuIGFuc3dlcjsKCiAgICAKICAgIGRlZiBmaW5kKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6CiAgICAgICAgX190b1N0cmluZyA9ICdNZXRyaWNfVmFsdWU6OmZpbmQoKTogJzsKICAgICAgICAKICAgICAgICBldkpTT04gPSBOb25lOwoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBldkpTT04gPSBqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsKICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOgogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOwogICAgICAgIAoKICAgICAgICBhbnN3ZXIgPSBOb25lOwoKICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGltZSgpKSsnXS5NZXRyaWNfVmFsdWUuZmluZCgpJykubWV0aG9kKCdmaW5kJykuY2xhc3NOYW1lKCdNZXRyaWNfVmFsdWUnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7CiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsKICAgICAgICAKICAgICAgICBnYy5jb2xsZWN0KCk7CgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsKCiAgICAgICAgCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7CiAgICAgICAgCiAgICAgICAgICAgIGFuc3dlciA9IE1ldHJpY19WYWx1ZSgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsKICAgICAgICAKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOwoKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOwogICAgICAgICAgICAKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOwoKICAgICAgICAgICAgCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOwogICAgICAgICAgICAKCiAgICAgICAgcmV0dXJuIGFuc3dlcjsKCiAgICAKCgpjbGFzcyBEZXZpY2UoKToKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBJZD1Ob25lLCBhY3RpdmU9Tm9uZSwgZW5hYmxlZD1Ob25lLCBjb2RlPU5vbmUsIG9yZGVyPU5vbmUsIGRhdGU9Tm9uZSwgbmFtZT1Ob25lLCByZW1hcms9Tm9uZSwgdHlwZT1Ob25lLCBjb250cm9sbGVyPU5vbmUpOgogICAgICAgIHN1cGVyKCkuX19pbml0X18oKTsKCiAgICAgICAgI3ByaW50KCdEZXZpY2U6Ol9faW5pdF9fKCknKTsKICAgICAgICBpZiBJZCBpcyBub3QgTm9uZToKICAgICAgICAgICAgc2VsZi5JZCA9IElkOwoKICAgICAgICAKICAgICAgICBzZWxmLmFjdGl2ZShhY3RpdmUpOwogICAgICAgIHNlbGYuZW5hYmxlZChlbmFibGVkKTsKICAgICAgICBzZWxmLmNvZGUoY29kZSk7CiAgICAgICAgc2VsZi5vcmRlcihvcmRlcik7CiAgICAgICAgc2VsZi5kYXRlKGRhdGUpOwogICAgICAgIHNlbGYubmFtZShuYW1lKTsKICAgICAgICBzZWxmLnJlbWFyayhyZW1hcmspOwogICAgICAgIHNlbGYudHlwZSh0eXBlKTsKICAgICAgICBzZWxmLmNvbnRyb2xsZXIoY29udHJvbGxlcik7CiAgICAgICAgCiAgICBJZCA9IE5vbmU7CiAgICAKICAgIAogICAgIyBhY3RpdmU6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9hY3RpdmUgPSBOb25lOwogICAgZGVmIGFjdGl2ZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fYWN0aXZlID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2FjdGl2ZTsKCgogICAgCiAgICAjIGVuYWJsZWQ6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9lbmFibGVkID0gTm9uZTsKICAgIGRlZiBlbmFibGVkKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9lbmFibGVkID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2VuYWJsZWQ7CgoKICAgIAogICAgIyBjb2RlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfY29kZSA9IE5vbmU7CiAgICBkZWYgY29kZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fY29kZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9jb2RlOwoKCiAgICAKICAgICMgb3JkZXI6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9vcmRlciA9IE5vbmU7CiAgICBkZWYgb3JkZXIoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX29yZGVyID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX29yZGVyOwoKCiAgICAKICAgICMgZGF0ZTogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX2RhdGUgPSBOb25lOwogICAgZGVmIGRhdGUoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2RhdGUgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fZGF0ZTsKCgogICAgCiAgICAjIG5hbWU6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9uYW1lID0gTm9uZTsKICAgIGRlZiBuYW1lKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9uYW1lID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX25hbWU7CgoKICAgIAogICAgIyByZW1hcms6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9yZW1hcmsgPSBOb25lOwogICAgZGVmIHJlbWFyayhzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fcmVtYXJrID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3JlbWFyazsKCgogICAgCiAgICAjIHR5cGU6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF90eXBlID0gTm9uZTsKICAgIGRlZiB0eXBlKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl90eXBlID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3R5cGU7CgoKICAgIAogICAgIyBjb250cm9sbGVyOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfY29udHJvbGxlciA9IE5vbmU7CiAgICBkZWYgY29udHJvbGxlcihzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fY29udHJvbGxlciA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9jb250cm9sbGVyOwoKCiAgICAKICAgIAogICAgZGVmIF9mcm9tRG9jdW1lbnQoc2VsZiwgb2JqKToKICAgICAgICBfX3RvU3RyaW5nID0gJ0RldmljZTo6X2Zyb21Eb2N1bWVudCgpOiAnOwogICAgICAgIAogICAgICAgIGlmIG9iaiBpcyBOb25lOgogICAgICAgICAgICByZXR1cm4gc2VsZjsKCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIGJ5dGVzKToKICAgICAgICAgICAgb2JqID0gc3RyKG9iaiwgInV0Zi04Iik7CiAgICAgICAgCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIHN0cikgb3IgdHlwZShvYmopIGlzIHN0cjoKICAgICAgICAgICAgaWYgcmUubWF0Y2gociIoKChbQS1aYS16XXszLDl9Oig/OlwvXC8pPykoPzpbLTs6Jj1cK1wkLFx3XStAKT9bQS1aYS16MC05Li1dK3woPzp3d3cufFstOzomPVwrXCQsXHddK0ApW0EtWmEtejAtOS4tXSspKCg/OlwvW1wrfiVcLy5cd1wtX10qKT9cPz8oPzpbLVwrPSY7JUAuXHdfXSopIz8oPzpbXHddKikpPykiLCBvYmopOgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIG9iaiA9IGpzb24ubG9hZHModXJsbGliMy5Qb29sTWFuYWdlcigpLnJlcXVlc3QoJ0dFVCcsIG9iaikuZGF0YS5kZWNvZGUoJ3V0Zi04JykpOwogICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgIG9iaiA9IHt9OwogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgb2JqID0ganNvbi5sb2FkcyhvYmopOwogICAgICAgIAogICAgICAgIGlmIG5vdCBpc2luc3RhbmNlKG9iaiwgKHN0ciwgYnl0ZXMsIGRpY3QpKToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICdHT1QgSEVSRTogJyArIHN0cih0eXBlKG9iaikpKTsKICAgICAgICAgICAgcmV0dXJuIG9iajsKCiAgICAgICAgICAgIGZvciBpIGluIG9iajoKICAgICAgICAgICAgICAgIG9ialtpXSA9IERldmljZSgpLl9mcm9tRG9jdW1lbnQob2JqW2ldKTsKICAgICAgICAgICAgcmV0dXJuIG9iajsKCgogICAgICAgIGlmICdJZCcgaW4gb2JqOgogICAgICAgICAgICBzZWxmLklkID0gb2JqWydJZCddOwoKICAgIAogICAgICAgIGlmICdhY3RpdmUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5hY3RpdmUob2JqWydhY3RpdmUnXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnZW5hYmxlZCcgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmVuYWJsZWQob2JqWydlbmFibGVkJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ2NvZGUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5jb2RlKG9ialsnY29kZSddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdvcmRlcicgaW4gb2JqOgogICAgICAgICAgICBzZWxmLm9yZGVyKG9ialsnb3JkZXInXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnZGF0ZScgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmRhdGUob2JqWydkYXRlJ10pOwogICAgICAgIAogICAgICAgICAgICBzZWxmLmRhdGUoZGF0ZXRpbWUuZGF0ZXRpbWUuZnJvbWlzb2Zvcm1hdChzZWxmLmRhdGUoKSkpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ25hbWUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5uYW1lKG9ialsnbmFtZSddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdyZW1hcmsnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5yZW1hcmsob2JqWydyZW1hcmsnXSk7CiAgICAgICAgCiAgICAgICAgICAgIHNlbGYucmVtYXJrKCBiYXNlNjQuYjY0ZGVjb2RlKHNlbGYucmVtYXJrKCkpICk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAndHlwZScgaW4gb2JqOgogICAgICAgICAgICBzZWxmLnR5cGUoRGV2aWNlX1R5cGUoKS5fZnJvbURvY3VtZW50KG9ialsndHlwZSddKSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnY29udHJvbGxlcicgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmNvbnRyb2xsZXIoTm9kZSgpLl9mcm9tRG9jdW1lbnQob2JqWydjb250cm9sbGVyJ10pKTsKICAgICAgICAKICAgIAoKICAgICAgICBnYy5jb2xsZWN0KCk7CiAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAKICAgIGRlZiBfdG9Eb2N1bWVudChzZWxmLCBiSlNPTj1Ob25lKToKICAgICAgICBfX3RvU3RyaW5nID0gJ0RldmljZTo6X3RvRG9jdW1lbnQoKTogJzsKCiAgICAgICAgcmV0ID0ge307CiAgICAgICAgaWYgc2VsZi5JZCBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJJZCJdID0gc2VsZi5JZDsKCiAgICAKICAgICAgICBpZiBzZWxmLmFjdGl2ZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbImFjdGl2ZSJdID0gc2VsZi5hY3RpdmUoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYuZW5hYmxlZCgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbImVuYWJsZWQiXSA9IHNlbGYuZW5hYmxlZCgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5jb2RlKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiY29kZSJdID0gc2VsZi5jb2RlKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLm9yZGVyKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsib3JkZXIiXSA9IHNlbGYub3JkZXIoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYuZGF0ZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbImRhdGUiXSA9IHNlbGYuZGF0ZSgpOwogICAgICAgIAogICAgICAgICAgICBpZiBpc2luc3RhbmNlKHJldFsiZGF0ZSJdLCBkYXRldGltZS5kYXRldGltZSk6CiAgICAgICAgICAgICAgICByZXRbImRhdGUiXSA9IHJldFsiZGF0ZSJdLmlzb2Zvcm1hdCgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5uYW1lKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsibmFtZSJdID0gc2VsZi5uYW1lKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLnJlbWFyaygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbInJlbWFyayJdID0gc2VsZi5yZW1hcmsoKTsKICAgICAgICAKICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShyZXRbInJlbWFyayJdLCBkaWN0KToKICAgICAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSBqc29uLmR1bXBzKHJldFsicmVtYXJrIl0pLmVuY29kZSgndXRmLTgnKTsKCiAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSAgYmFzZTY0LmI2NGVuY29kZShyZXRbInJlbWFyayJdKS5kZWNvZGUoJ3V0Zi04Jykuc3RyaXAoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYudHlwZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbInR5cGUiXSA9IHNlbGYudHlwZSgpLl90b0RvY3VtZW50KCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLmNvbnRyb2xsZXIoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJjb250cm9sbGVyIl0gPSBzZWxmLmNvbnRyb2xsZXIoKS5fdG9Eb2N1bWVudCgpOwogICAgICAgIAogICAgCiAgICAgICAgCiAgICAgICAgaWYgYkpTT04gaXMgbm90IE5vbmU6CiAgICAgICAgICAgICNwcmludChfX3RvU3RyaW5nICsgIkdPVCBIRVJFIiwgdHlwZShyZXQpLCByZXQpOwogICAgICAgICAgICByZXQgPSBqc29uLmR1bXBzKHJldCk7CiAgICAgICAgZ2MuY29sbGVjdCgpOwogICAgICAgIHJldHVybiByZXQ7CgogICAgCiAgICBkZWYgc3RvcmUoc2VsZiwgX19ldmVudD1Ob25lKToKICAgICAgICBfX3RvU3RyaW5nID0gJ0RldmljZTo6c3RvcmUoKTogJzsKICAgICAgICAKICAgICAgICBldkpTT04gPSBOb25lOwoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBldkpTT04gPSBqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsKICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOgogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOwogICAgICAgIAoKICAgICAgICBhbnN3ZXIgPSBOb25lOwoKICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGltZSgpKSsnXS5EZXZpY2Uuc3RvcmUoKScpLm1ldGhvZCgnc3RvcmUnKS5jbGFzc05hbWUoJ0RldmljZScpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOwogICAgICAgIAogICAgICAgIGdjLmNvbGxlY3QoKTsKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOwoKICAgICAgICAKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsKICAgICAgICAKICAgICAgICAgICAgYW5zd2VyID0gRGV2aWNlKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOwogICAgICAgIAoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7CgoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOgogICAgICAgICAgICAKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7CgogICAgICAgICAgICAKICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7CiAgICAgICAgICAgIAoKICAgICAgICByZXR1cm4gYW5zd2VyOwoKICAgIAogICAgZGVmIGZpbmRBbGwoc2VsZiwgX19ldmVudD1Ob25lKToKICAgICAgICBfX3RvU3RyaW5nID0gJ0RldmljZTo6ZmluZEFsbCgpOiAnOwogICAgICAgIAogICAgICAgIGV2SlNPTiA9IE5vbmU7CgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIGV2SlNPTiA9IGpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOwogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046CiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7CiAgICAgICAgCgogICAgICAgIGFuc3dlciA9IE5vbmU7CgogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aW1lKCkpKyddLkRldmljZS5maW5kQWxsKCknKS5tZXRob2QoJ2ZpbmRBbGwnKS5jbGFzc05hbWUoJ0RldmljZScpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOwogICAgICAgIAogICAgICAgIGdjLmNvbGxlY3QoKTsKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOwoKICAgICAgICAKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsKICAgICAgICAKICAgICAgICAgICAgYW5zd2VyID0gRGV2aWNlKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOwogICAgICAgIAoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7CgoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOgogICAgICAgICAgICAKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7CgogICAgICAgICAgICAKICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7CiAgICAgICAgICAgIAoKICAgICAgICByZXR1cm4gYW5zd2VyOwoKICAgIAogICAgZGVmIGZpbmQoc2VsZiwgX19ldmVudD1Ob25lKToKICAgICAgICBfX3RvU3RyaW5nID0gJ0RldmljZTo6ZmluZCgpOiAnOwogICAgICAgIAogICAgICAgIGV2SlNPTiA9IE5vbmU7CgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIGV2SlNPTiA9IGpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOwogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046CiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7CiAgICAgICAgCgogICAgICAgIGFuc3dlciA9IE5vbmU7CgogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aW1lKCkpKyddLkRldmljZS5maW5kKCknKS5tZXRob2QoJ2ZpbmQnKS5jbGFzc05hbWUoJ0RldmljZScpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOwogICAgICAgIAogICAgICAgIGdjLmNvbGxlY3QoKTsKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOwoKICAgICAgICAKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsKICAgICAgICAKICAgICAgICAgICAgYW5zd2VyID0gRGV2aWNlKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOwogICAgICAgIAoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7CgoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOgogICAgICAgICAgICAKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7CgogICAgICAgICAgICAKICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7CiAgICAgICAgICAgIAoKICAgICAgICByZXR1cm4gYW5zd2VyOwoKICAgIAoKCmNsYXNzIERldmljZV9DYXRlZ29yeSgpOgogICAgZGVmIF9faW5pdF9fKHNlbGYsIElkPU5vbmUsIGFjdGl2ZT1Ob25lLCBlbmFibGVkPU5vbmUsIGNvZGU9Tm9uZSwgb3JkZXI9Tm9uZSwgZGF0ZT1Ob25lLCBuYW1lPU5vbmUsIHJlbWFyaz1Ob25lLCBwYXJlbnQ9Tm9uZSk6CiAgICAgICAgc3VwZXIoKS5fX2luaXRfXygpOwoKICAgICAgICAjcHJpbnQoJ0RldmljZV9DYXRlZ29yeTo6X19pbml0X18oKScpOwogICAgICAgIGlmIElkIGlzIG5vdCBOb25lOgogICAgICAgICAgICBzZWxmLklkID0gSWQ7CgogICAgICAgIAogICAgICAgIHNlbGYuYWN0aXZlKGFjdGl2ZSk7CiAgICAgICAgc2VsZi5lbmFibGVkKGVuYWJsZWQpOwogICAgICAgIHNlbGYuY29kZShjb2RlKTsKICAgICAgICBzZWxmLm9yZGVyKG9yZGVyKTsKICAgICAgICBzZWxmLmRhdGUoZGF0ZSk7CiAgICAgICAgc2VsZi5uYW1lKG5hbWUpOwogICAgICAgIHNlbGYucmVtYXJrKHJlbWFyayk7CiAgICAgICAgc2VsZi5wYXJlbnQocGFyZW50KTsKICAgICAgICAKICAgIElkID0gTm9uZTsKICAgIAogICAgCiAgICAjIGFjdGl2ZTogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX2FjdGl2ZSA9IE5vbmU7CiAgICBkZWYgYWN0aXZlKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9hY3RpdmUgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fYWN0aXZlOwoKCiAgICAKICAgICMgZW5hYmxlZDogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX2VuYWJsZWQgPSBOb25lOwogICAgZGVmIGVuYWJsZWQoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2VuYWJsZWQgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fZW5hYmxlZDsKCgogICAgCiAgICAjIGNvZGU6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9jb2RlID0gTm9uZTsKICAgIGRlZiBjb2RlKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9jb2RlID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2NvZGU7CgoKICAgIAogICAgIyBvcmRlcjogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX29yZGVyID0gTm9uZTsKICAgIGRlZiBvcmRlcihzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fb3JkZXIgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fb3JkZXI7CgoKICAgIAogICAgIyBkYXRlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfZGF0ZSA9IE5vbmU7CiAgICBkZWYgZGF0ZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fZGF0ZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9kYXRlOwoKCiAgICAKICAgICMgbmFtZTogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX25hbWUgPSBOb25lOwogICAgZGVmIG5hbWUoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX25hbWUgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fbmFtZTsKCgogICAgCiAgICAjIHJlbWFyazogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX3JlbWFyayA9IE5vbmU7CiAgICBkZWYgcmVtYXJrKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9yZW1hcmsgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fcmVtYXJrOwoKCiAgICAKICAgICMgcGFyZW50OiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfcGFyZW50ID0gTm9uZTsKICAgIGRlZiBwYXJlbnQoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX3BhcmVudCA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9wYXJlbnQ7CgoKICAgIAogICAgCiAgICBkZWYgX2Zyb21Eb2N1bWVudChzZWxmLCBvYmopOgogICAgICAgIF9fdG9TdHJpbmcgPSAnRGV2aWNlX0NhdGVnb3J5OjpfZnJvbURvY3VtZW50KCk6ICc7CiAgICAgICAgCiAgICAgICAgaWYgb2JqIGlzIE5vbmU6CiAgICAgICAgICAgIHJldHVybiBzZWxmOwoKICAgICAgICBpZiBpc2luc3RhbmNlKG9iaiwgYnl0ZXMpOgogICAgICAgICAgICBvYmogPSBzdHIob2JqLCAidXRmLTgiKTsKICAgICAgICAKICAgICAgICBpZiBpc2luc3RhbmNlKG9iaiwgc3RyKSBvciB0eXBlKG9iaikgaXMgc3RyOgogICAgICAgICAgICBpZiByZS5tYXRjaChyIigoKFtBLVphLXpdezMsOX06KD86XC9cLyk/KSg/OlstOzomPVwrXCQsXHddK0ApP1tBLVphLXowLTkuLV0rfCg/Ond3dy58Wy07OiY9XCtcJCxcd10rQClbQS1aYS16MC05Li1dKykoKD86XC9bXCt+JVwvLlx3XC1fXSopP1w/Pyg/OlstXCs9JjslQC5cd19dKikjPyg/Oltcd10qKSk/KSIsIG9iaik6CiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgb2JqID0ganNvbi5sb2Fkcyh1cmxsaWIzLlBvb2xNYW5hZ2VyKCkucmVxdWVzdCgnR0VUJywgb2JqKS5kYXRhLmRlY29kZSgndXRmLTgnKSk7CiAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgb2JqID0ge307CiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBvYmogPSBqc29uLmxvYWRzKG9iaik7CiAgICAgICAgCiAgICAgICAgaWYgbm90IGlzaW5zdGFuY2Uob2JqLCAoc3RyLCBieXRlcywgZGljdCkpOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJ0dPVCBIRVJFOiAnICsgc3RyKHR5cGUob2JqKSkpOwogICAgICAgICAgICByZXR1cm4gb2JqOwoKICAgICAgICAgICAgZm9yIGkgaW4gb2JqOgogICAgICAgICAgICAgICAgb2JqW2ldID0gRGV2aWNlX0NhdGVnb3J5KCkuX2Zyb21Eb2N1bWVudChvYmpbaV0pOwogICAgICAgICAgICByZXR1cm4gb2JqOwoKCiAgICAgICAgaWYgJ0lkJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuSWQgPSBvYmpbJ0lkJ107CgogICAgCiAgICAgICAgaWYgJ2FjdGl2ZScgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmFjdGl2ZShvYmpbJ2FjdGl2ZSddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdlbmFibGVkJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuZW5hYmxlZChvYmpbJ2VuYWJsZWQnXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnY29kZScgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmNvZGUob2JqWydjb2RlJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ29yZGVyJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYub3JkZXIob2JqWydvcmRlciddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdkYXRlJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuZGF0ZShvYmpbJ2RhdGUnXSk7CiAgICAgICAgCiAgICAgICAgICAgIHNlbGYuZGF0ZShkYXRldGltZS5kYXRldGltZS5mcm9taXNvZm9ybWF0KHNlbGYuZGF0ZSgpKSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnbmFtZScgaW4gb2JqOgogICAgICAgICAgICBzZWxmLm5hbWUob2JqWyduYW1lJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ3JlbWFyaycgaW4gb2JqOgogICAgICAgICAgICBzZWxmLnJlbWFyayhvYmpbJ3JlbWFyayddKTsKICAgICAgICAKICAgICAgICAgICAgc2VsZi5yZW1hcmsoIGJhc2U2NC5iNjRkZWNvZGUoc2VsZi5yZW1hcmsoKSkgKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdwYXJlbnQnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5wYXJlbnQob2JqWydwYXJlbnQnXSk7CiAgICAgICAgCiAgICAKCiAgICAgICAgZ2MuY29sbGVjdCgpOwogICAgICAgIHJldHVybiBzZWxmOwogICAgCiAgICBkZWYgX3RvRG9jdW1lbnQoc2VsZiwgYkpTT049Tm9uZSk6CiAgICAgICAgX190b1N0cmluZyA9ICdEZXZpY2VfQ2F0ZWdvcnk6Ol90b0RvY3VtZW50KCk6ICc7CgogICAgICAgIHJldCA9IHt9OwogICAgICAgIGlmIHNlbGYuSWQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiSWQiXSA9IHNlbGYuSWQ7CgogICAgCiAgICAgICAgaWYgc2VsZi5hY3RpdmUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJhY3RpdmUiXSA9IHNlbGYuYWN0aXZlKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLmVuYWJsZWQoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJlbmFibGVkIl0gPSBzZWxmLmVuYWJsZWQoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYuY29kZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbImNvZGUiXSA9IHNlbGYuY29kZSgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5vcmRlcigpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbIm9yZGVyIl0gPSBzZWxmLm9yZGVyKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLmRhdGUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJkYXRlIl0gPSBzZWxmLmRhdGUoKTsKICAgICAgICAKICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShyZXRbImRhdGUiXSwgZGF0ZXRpbWUuZGF0ZXRpbWUpOgogICAgICAgICAgICAgICAgcmV0WyJkYXRlIl0gPSByZXRbImRhdGUiXS5pc29mb3JtYXQoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYubmFtZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbIm5hbWUiXSA9IHNlbGYubmFtZSgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5yZW1hcmsoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IHNlbGYucmVtYXJrKCk7CiAgICAgICAgCiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UocmV0WyJyZW1hcmsiXSwgZGljdCk6CiAgICAgICAgICAgICAgICByZXRbInJlbWFyayJdID0ganNvbi5kdW1wcyhyZXRbInJlbWFyayJdKS5lbmNvZGUoJ3V0Zi04Jyk7CgogICAgICAgICAgICByZXRbInJlbWFyayJdID0gIGJhc2U2NC5iNjRlbmNvZGUocmV0WyJyZW1hcmsiXSkuZGVjb2RlKCd1dGYtOCcpLnN0cmlwKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLnBhcmVudCgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbInBhcmVudCJdID0gc2VsZi5wYXJlbnQoKTsKICAgICAgICAKICAgIAogICAgICAgIAogICAgICAgIGlmIGJKU09OIGlzIG5vdCBOb25lOgogICAgICAgICAgICAjcHJpbnQoX190b1N0cmluZyArICJHT1QgSEVSRSIsIHR5cGUocmV0KSwgcmV0KTsKICAgICAgICAgICAgcmV0ID0ganNvbi5kdW1wcyhyZXQpOwogICAgICAgIGdjLmNvbGxlY3QoKTsKICAgICAgICByZXR1cm4gcmV0OwoKICAgIAogICAgZGVmIHN0b3JlKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6CiAgICAgICAgX190b1N0cmluZyA9ICdEZXZpY2VfQ2F0ZWdvcnk6OnN0b3JlKCk6ICc7CiAgICAgICAgCiAgICAgICAgZXZKU09OID0gTm9uZTsKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgZXZKU09OID0ganNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7CiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoKICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsKICAgICAgICAKCiAgICAgICAgYW5zd2VyID0gTm9uZTsKCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpbWUoKSkrJ10uRGV2aWNlX0NhdGVnb3J5LnN0b3JlKCknKS5tZXRob2QoJ3N0b3JlJykuY2xhc3NOYW1lKCdEZXZpY2VfQ2F0ZWdvcnknKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7CiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsKICAgICAgICAKICAgICAgICBnYy5jb2xsZWN0KCk7CgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsKCiAgICAgICAgCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7CiAgICAgICAgCiAgICAgICAgICAgIGFuc3dlciA9IERldmljZV9DYXRlZ29yeSgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsKICAgICAgICAKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOwoKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOwogICAgICAgICAgICAKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOwoKICAgICAgICAgICAgCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOwogICAgICAgICAgICAKCiAgICAgICAgcmV0dXJuIGFuc3dlcjsKCiAgICAKICAgIGRlZiBmaW5kQWxsKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6CiAgICAgICAgX190b1N0cmluZyA9ICdEZXZpY2VfQ2F0ZWdvcnk6OmZpbmRBbGwoKTogJzsKICAgICAgICAKICAgICAgICBldkpTT04gPSBOb25lOwoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBldkpTT04gPSBqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsKICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOgogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOwogICAgICAgIAoKICAgICAgICBhbnN3ZXIgPSBOb25lOwoKICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGltZSgpKSsnXS5EZXZpY2VfQ2F0ZWdvcnkuZmluZEFsbCgpJykubWV0aG9kKCdmaW5kQWxsJykuY2xhc3NOYW1lKCdEZXZpY2VfQ2F0ZWdvcnknKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7CiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsKICAgICAgICAKICAgICAgICBnYy5jb2xsZWN0KCk7CgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsKCiAgICAgICAgCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7CiAgICAgICAgCiAgICAgICAgICAgIGFuc3dlciA9IERldmljZV9DYXRlZ29yeSgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsKICAgICAgICAKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOwoKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOwogICAgICAgICAgICAKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOwoKICAgICAgICAgICAgCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOwogICAgICAgICAgICAKCiAgICAgICAgcmV0dXJuIGFuc3dlcjsKCiAgICAKICAgIGRlZiBmaW5kKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6CiAgICAgICAgX190b1N0cmluZyA9ICdEZXZpY2VfQ2F0ZWdvcnk6OmZpbmQoKTogJzsKICAgICAgICAKICAgICAgICBldkpTT04gPSBOb25lOwoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBldkpTT04gPSBqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsKICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOgogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOwogICAgICAgIAoKICAgICAgICBhbnN3ZXIgPSBOb25lOwoKICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGltZSgpKSsnXS5EZXZpY2VfQ2F0ZWdvcnkuZmluZCgpJykubWV0aG9kKCdmaW5kJykuY2xhc3NOYW1lKCdEZXZpY2VfQ2F0ZWdvcnknKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7CiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsKICAgICAgICAKICAgICAgICBnYy5jb2xsZWN0KCk7CgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsKCiAgICAgICAgCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7CiAgICAgICAgCiAgICAgICAgICAgIGFuc3dlciA9IERldmljZV9DYXRlZ29yeSgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsKICAgICAgICAKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOwoKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOwogICAgICAgICAgICAKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOwoKICAgICAgICAgICAgCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOwogICAgICAgICAgICAKCiAgICAgICAgcmV0dXJuIGFuc3dlcjsKCiAgICAKCgpjbGFzcyBEZXZpY2VfVHlwZSgpOgogICAgZGVmIF9faW5pdF9fKHNlbGYsIElkPU5vbmUsIGFjdGl2ZT1Ob25lLCBlbmFibGVkPU5vbmUsIGNvZGU9Tm9uZSwgb3JkZXI9Tm9uZSwgZGF0ZT1Ob25lLCBuYW1lPU5vbmUsIHJlbWFyaz1Ob25lLCBjYXRlZ29yeT1Ob25lKToKICAgICAgICBzdXBlcigpLl9faW5pdF9fKCk7CgogICAgICAgICNwcmludCgnRGV2aWNlX1R5cGU6Ol9faW5pdF9fKCknKTsKICAgICAgICBpZiBJZCBpcyBub3QgTm9uZToKICAgICAgICAgICAgc2VsZi5JZCA9IElkOwoKICAgICAgICAKICAgICAgICBzZWxmLmFjdGl2ZShhY3RpdmUpOwogICAgICAgIHNlbGYuZW5hYmxlZChlbmFibGVkKTsKICAgICAgICBzZWxmLmNvZGUoY29kZSk7CiAgICAgICAgc2VsZi5vcmRlcihvcmRlcik7CiAgICAgICAgc2VsZi5kYXRlKGRhdGUpOwogICAgICAgIHNlbGYubmFtZShuYW1lKTsKICAgICAgICBzZWxmLnJlbWFyayhyZW1hcmspOwogICAgICAgIHNlbGYuY2F0ZWdvcnkoY2F0ZWdvcnkpOwogICAgICAgIAogICAgSWQgPSBOb25lOwogICAgCiAgICAKICAgICMgYWN0aXZlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfYWN0aXZlID0gTm9uZTsKICAgIGRlZiBhY3RpdmUoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2FjdGl2ZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9hY3RpdmU7CgoKICAgIAogICAgIyBlbmFibGVkOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfZW5hYmxlZCA9IE5vbmU7CiAgICBkZWYgZW5hYmxlZChzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fZW5hYmxlZCA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9lbmFibGVkOwoKCiAgICAKICAgICMgY29kZTogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX2NvZGUgPSBOb25lOwogICAgZGVmIGNvZGUoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2NvZGUgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fY29kZTsKCgogICAgCiAgICAjIG9yZGVyOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfb3JkZXIgPSBOb25lOwogICAgZGVmIG9yZGVyKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9vcmRlciA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9vcmRlcjsKCgogICAgCiAgICAjIGRhdGU6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9kYXRlID0gTm9uZTsKICAgIGRlZiBkYXRlKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9kYXRlID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2RhdGU7CgoKICAgIAogICAgIyBuYW1lOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfbmFtZSA9IE5vbmU7CiAgICBkZWYgbmFtZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fbmFtZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9uYW1lOwoKCiAgICAKICAgICMgcmVtYXJrOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfcmVtYXJrID0gTm9uZTsKICAgIGRlZiByZW1hcmsoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX3JlbWFyayA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9yZW1hcms7CgoKICAgIAogICAgIyBjYXRlZ29yeTogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX2NhdGVnb3J5ID0gTm9uZTsKICAgIGRlZiBjYXRlZ29yeShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fY2F0ZWdvcnkgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fY2F0ZWdvcnk7CgoKICAgIAogICAgCiAgICBkZWYgX2Zyb21Eb2N1bWVudChzZWxmLCBvYmopOgogICAgICAgIF9fdG9TdHJpbmcgPSAnRGV2aWNlX1R5cGU6Ol9mcm9tRG9jdW1lbnQoKTogJzsKICAgICAgICAKICAgICAgICBpZiBvYmogaXMgTm9uZToKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CgogICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLCBieXRlcyk6CiAgICAgICAgICAgIG9iaiA9IHN0cihvYmosICJ1dGYtOCIpOwogICAgICAgIAogICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLCBzdHIpIG9yIHR5cGUob2JqKSBpcyBzdHI6CiAgICAgICAgICAgIGlmIHJlLm1hdGNoKHIiKCgoW0EtWmEtel17Myw5fTooPzpcL1wvKT8pKD86Wy07OiY9XCtcJCxcd10rQCk/W0EtWmEtejAtOS4tXSt8KD86d3d3LnxbLTs6Jj1cK1wkLFx3XStAKVtBLVphLXowLTkuLV0rKSgoPzpcL1tcK34lXC8uXHdcLV9dKik/XD8/KD86Wy1cKz0mOyVALlx3X10qKSM/KD86W1x3XSopKT8pIiwgb2JqKToKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBvYmogPSBqc29uLmxvYWRzKHVybGxpYjMuUG9vbE1hbmFnZXIoKS5yZXF1ZXN0KCdHRVQnLCBvYmopLmRhdGEuZGVjb2RlKCd1dGYtOCcpKTsKICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICBvYmogPSB7fTsKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIG9iaiA9IGpzb24ubG9hZHMob2JqKTsKICAgICAgICAKICAgICAgICBpZiBub3QgaXNpbnN0YW5jZShvYmosIChzdHIsIGJ5dGVzLCBkaWN0KSk6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnR09UIEhFUkU6ICcgKyBzdHIodHlwZShvYmopKSk7CiAgICAgICAgICAgIHJldHVybiBvYmo7CgogICAgICAgICAgICBmb3IgaSBpbiBvYmo6CiAgICAgICAgICAgICAgICBvYmpbaV0gPSBEZXZpY2VfVHlwZSgpLl9mcm9tRG9jdW1lbnQob2JqW2ldKTsKICAgICAgICAgICAgcmV0dXJuIG9iajsKCgogICAgICAgIGlmICdJZCcgaW4gb2JqOgogICAgICAgICAgICBzZWxmLklkID0gb2JqWydJZCddOwoKICAgIAogICAgICAgIGlmICdhY3RpdmUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5hY3RpdmUob2JqWydhY3RpdmUnXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnZW5hYmxlZCcgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmVuYWJsZWQob2JqWydlbmFibGVkJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ2NvZGUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5jb2RlKG9ialsnY29kZSddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdvcmRlcicgaW4gb2JqOgogICAgICAgICAgICBzZWxmLm9yZGVyKG9ialsnb3JkZXInXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnZGF0ZScgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmRhdGUob2JqWydkYXRlJ10pOwogICAgICAgIAogICAgICAgICAgICBzZWxmLmRhdGUoZGF0ZXRpbWUuZGF0ZXRpbWUuZnJvbWlzb2Zvcm1hdChzZWxmLmRhdGUoKSkpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ25hbWUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5uYW1lKG9ialsnbmFtZSddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdyZW1hcmsnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5yZW1hcmsob2JqWydyZW1hcmsnXSk7CiAgICAgICAgCiAgICAgICAgICAgIHNlbGYucmVtYXJrKCBiYXNlNjQuYjY0ZGVjb2RlKHNlbGYucmVtYXJrKCkpICk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnY2F0ZWdvcnknIGluIG9iajoKICAgICAgICAgICAgc2VsZi5jYXRlZ29yeShEZXZpY2VfQ2F0ZWdvcnkoKS5fZnJvbURvY3VtZW50KG9ialsnY2F0ZWdvcnknXSkpOwogICAgICAgIAogICAgCgogICAgICAgIGdjLmNvbGxlY3QoKTsKICAgICAgICByZXR1cm4gc2VsZjsKICAgIAogICAgZGVmIF90b0RvY3VtZW50KHNlbGYsIGJKU09OPU5vbmUpOgogICAgICAgIF9fdG9TdHJpbmcgPSAnRGV2aWNlX1R5cGU6Ol90b0RvY3VtZW50KCk6ICc7CgogICAgICAgIHJldCA9IHt9OwogICAgICAgIGlmIHNlbGYuSWQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiSWQiXSA9IHNlbGYuSWQ7CgogICAgCiAgICAgICAgaWYgc2VsZi5hY3RpdmUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJhY3RpdmUiXSA9IHNlbGYuYWN0aXZlKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLmVuYWJsZWQoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJlbmFibGVkIl0gPSBzZWxmLmVuYWJsZWQoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYuY29kZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbImNvZGUiXSA9IHNlbGYuY29kZSgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5vcmRlcigpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbIm9yZGVyIl0gPSBzZWxmLm9yZGVyKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLmRhdGUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJkYXRlIl0gPSBzZWxmLmRhdGUoKTsKICAgICAgICAKICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShyZXRbImRhdGUiXSwgZGF0ZXRpbWUuZGF0ZXRpbWUpOgogICAgICAgICAgICAgICAgcmV0WyJkYXRlIl0gPSByZXRbImRhdGUiXS5pc29mb3JtYXQoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYubmFtZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbIm5hbWUiXSA9IHNlbGYubmFtZSgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5yZW1hcmsoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IHNlbGYucmVtYXJrKCk7CiAgICAgICAgCiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UocmV0WyJyZW1hcmsiXSwgZGljdCk6CiAgICAgICAgICAgICAgICByZXRbInJlbWFyayJdID0ganNvbi5kdW1wcyhyZXRbInJlbWFyayJdKS5lbmNvZGUoJ3V0Zi04Jyk7CgogICAgICAgICAgICByZXRbInJlbWFyayJdID0gIGJhc2U2NC5iNjRlbmNvZGUocmV0WyJyZW1hcmsiXSkuZGVjb2RlKCd1dGYtOCcpLnN0cmlwKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLmNhdGVnb3J5KCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiY2F0ZWdvcnkiXSA9IHNlbGYuY2F0ZWdvcnkoKS5fdG9Eb2N1bWVudCgpOwogICAgICAgIAogICAgCiAgICAgICAgCiAgICAgICAgaWYgYkpTT04gaXMgbm90IE5vbmU6CiAgICAgICAgICAgICNwcmludChfX3RvU3RyaW5nICsgIkdPVCBIRVJFIiwgdHlwZShyZXQpLCByZXQpOwogICAgICAgICAgICByZXQgPSBqc29uLmR1bXBzKHJldCk7CiAgICAgICAgZ2MuY29sbGVjdCgpOwogICAgICAgIHJldHVybiByZXQ7CgogICAgCiAgICBkZWYgc3RvcmUoc2VsZiwgX19ldmVudD1Ob25lKToKICAgICAgICBfX3RvU3RyaW5nID0gJ0RldmljZV9UeXBlOjpzdG9yZSgpOiAnOwogICAgICAgIAogICAgICAgIGV2SlNPTiA9IE5vbmU7CgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIGV2SlNPTiA9IGpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOwogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046CiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7CiAgICAgICAgCgogICAgICAgIGFuc3dlciA9IE5vbmU7CgogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aW1lKCkpKyddLkRldmljZV9UeXBlLnN0b3JlKCknKS5tZXRob2QoJ3N0b3JlJykuY2xhc3NOYW1lKCdEZXZpY2VfVHlwZScpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOwogICAgICAgIAogICAgICAgIGdjLmNvbGxlY3QoKTsKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOwoKICAgICAgICAKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsKICAgICAgICAKICAgICAgICAgICAgYW5zd2VyID0gRGV2aWNlX1R5cGUoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7CiAgICAgICAgCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsKCgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsKCiAgICAgICAgICAgIAogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsKICAgICAgICAgICAgCgogICAgICAgIHJldHVybiBhbnN3ZXI7CgogICAgCiAgICBkZWYgZmluZEFsbChzZWxmLCBfX2V2ZW50PU5vbmUpOgogICAgICAgIF9fdG9TdHJpbmcgPSAnRGV2aWNlX1R5cGU6OmZpbmRBbGwoKTogJzsKICAgICAgICAKICAgICAgICBldkpTT04gPSBOb25lOwoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBldkpTT04gPSBqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsKICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOgogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOwogICAgICAgIAoKICAgICAgICBhbnN3ZXIgPSBOb25lOwoKICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGltZSgpKSsnXS5EZXZpY2VfVHlwZS5maW5kQWxsKCknKS5tZXRob2QoJ2ZpbmRBbGwnKS5jbGFzc05hbWUoJ0RldmljZV9UeXBlJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOwogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7CiAgICAgICAgCiAgICAgICAgZ2MuY29sbGVjdCgpOwoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7CgogICAgICAgIAogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOwogICAgICAgIAogICAgICAgICAgICBhbnN3ZXIgPSBEZXZpY2VfVHlwZSgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsKICAgICAgICAKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOwoKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOwogICAgICAgICAgICAKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOwoKICAgICAgICAgICAgCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOwogICAgICAgICAgICAKCiAgICAgICAgcmV0dXJuIGFuc3dlcjsKCiAgICAKICAgIGRlZiBmaW5kKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6CiAgICAgICAgX190b1N0cmluZyA9ICdEZXZpY2VfVHlwZTo6ZmluZCgpOiAnOwogICAgICAgIAogICAgICAgIGV2SlNPTiA9IE5vbmU7CgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIGV2SlNPTiA9IGpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOwogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046CiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7CiAgICAgICAgCgogICAgICAgIGFuc3dlciA9IE5vbmU7CgogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aW1lKCkpKyddLkRldmljZV9UeXBlLmZpbmQoKScpLm1ldGhvZCgnZmluZCcpLmNsYXNzTmFtZSgnRGV2aWNlX1R5cGUnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7CiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsKICAgICAgICAKICAgICAgICBnYy5jb2xsZWN0KCk7CgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsKCiAgICAgICAgCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7CiAgICAgICAgCiAgICAgICAgICAgIGFuc3dlciA9IERldmljZV9UeXBlKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOwogICAgICAgIAoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7CgoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOgogICAgICAgICAgICAKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7CgogICAgICAgICAgICAKICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7CiAgICAgICAgICAgIAoKICAgICAgICByZXR1cm4gYW5zd2VyOwoKICAgIAoKCmNsYXNzIE1ldHJpY19Hcm91cCgpOgogICAgZGVmIF9faW5pdF9fKHNlbGYsIElkPU5vbmUsIGFjdGl2ZT1Ob25lLCBlbmFibGVkPU5vbmUsIGNvZGU9Tm9uZSwgb3JkZXI9Tm9uZSwgZGF0ZT1Ob25lLCBuYW1lPU5vbmUsIHJlbWFyaz1Ob25lKToKICAgICAgICBzdXBlcigpLl9faW5pdF9fKCk7CgogICAgICAgICNwcmludCgnTWV0cmljX0dyb3VwOjpfX2luaXRfXygpJyk7CiAgICAgICAgaWYgSWQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHNlbGYuSWQgPSBJZDsKCiAgICAgICAgCiAgICAgICAgc2VsZi5hY3RpdmUoYWN0aXZlKTsKICAgICAgICBzZWxmLmVuYWJsZWQoZW5hYmxlZCk7CiAgICAgICAgc2VsZi5jb2RlKGNvZGUpOwogICAgICAgIHNlbGYub3JkZXIob3JkZXIpOwogICAgICAgIHNlbGYuZGF0ZShkYXRlKTsKICAgICAgICBzZWxmLm5hbWUobmFtZSk7CiAgICAgICAgc2VsZi5yZW1hcmsocmVtYXJrKTsKICAgICAgICAKICAgIElkID0gTm9uZTsKICAgIAogICAgCiAgICAjIGFjdGl2ZTogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX2FjdGl2ZSA9IE5vbmU7CiAgICBkZWYgYWN0aXZlKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9hY3RpdmUgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fYWN0aXZlOwoKCiAgICAKICAgICMgZW5hYmxlZDogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX2VuYWJsZWQgPSBOb25lOwogICAgZGVmIGVuYWJsZWQoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2VuYWJsZWQgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fZW5hYmxlZDsKCgogICAgCiAgICAjIGNvZGU6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9jb2RlID0gTm9uZTsKICAgIGRlZiBjb2RlKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9jb2RlID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2NvZGU7CgoKICAgIAogICAgIyBvcmRlcjogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX29yZGVyID0gTm9uZTsKICAgIGRlZiBvcmRlcihzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fb3JkZXIgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fb3JkZXI7CgoKICAgIAogICAgIyBkYXRlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfZGF0ZSA9IE5vbmU7CiAgICBkZWYgZGF0ZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fZGF0ZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9kYXRlOwoKCiAgICAKICAgICMgbmFtZTogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX25hbWUgPSBOb25lOwogICAgZGVmIG5hbWUoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX25hbWUgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fbmFtZTsKCgogICAgCiAgICAjIHJlbWFyazogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX3JlbWFyayA9IE5vbmU7CiAgICBkZWYgcmVtYXJrKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9yZW1hcmsgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fcmVtYXJrOwoKCiAgICAKICAgIAogICAgZGVmIF9mcm9tRG9jdW1lbnQoc2VsZiwgb2JqKToKICAgICAgICBfX3RvU3RyaW5nID0gJ01ldHJpY19Hcm91cDo6X2Zyb21Eb2N1bWVudCgpOiAnOwogICAgICAgIAogICAgICAgIGlmIG9iaiBpcyBOb25lOgogICAgICAgICAgICByZXR1cm4gc2VsZjsKCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIGJ5dGVzKToKICAgICAgICAgICAgb2JqID0gc3RyKG9iaiwgInV0Zi04Iik7CiAgICAgICAgCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIHN0cikgb3IgdHlwZShvYmopIGlzIHN0cjoKICAgICAgICAgICAgaWYgcmUubWF0Y2gociIoKChbQS1aYS16XXszLDl9Oig/OlwvXC8pPykoPzpbLTs6Jj1cK1wkLFx3XStAKT9bQS1aYS16MC05Li1dK3woPzp3d3cufFstOzomPVwrXCQsXHddK0ApW0EtWmEtejAtOS4tXSspKCg/OlwvW1wrfiVcLy5cd1wtX10qKT9cPz8oPzpbLVwrPSY7JUAuXHdfXSopIz8oPzpbXHddKikpPykiLCBvYmopOgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIG9iaiA9IGpzb24ubG9hZHModXJsbGliMy5Qb29sTWFuYWdlcigpLnJlcXVlc3QoJ0dFVCcsIG9iaikuZGF0YS5kZWNvZGUoJ3V0Zi04JykpOwogICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgIG9iaiA9IHt9OwogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgb2JqID0ganNvbi5sb2FkcyhvYmopOwogICAgICAgIAogICAgICAgIGlmIG5vdCBpc2luc3RhbmNlKG9iaiwgKHN0ciwgYnl0ZXMsIGRpY3QpKToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICdHT1QgSEVSRTogJyArIHN0cih0eXBlKG9iaikpKTsKICAgICAgICAgICAgcmV0dXJuIG9iajsKCiAgICAgICAgICAgIGZvciBpIGluIG9iajoKICAgICAgICAgICAgICAgIG9ialtpXSA9IE1ldHJpY19Hcm91cCgpLl9mcm9tRG9jdW1lbnQob2JqW2ldKTsKICAgICAgICAgICAgcmV0dXJuIG9iajsKCgogICAgICAgIGlmICdJZCcgaW4gb2JqOgogICAgICAgICAgICBzZWxmLklkID0gb2JqWydJZCddOwoKICAgIAogICAgICAgIGlmICdhY3RpdmUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5hY3RpdmUob2JqWydhY3RpdmUnXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnZW5hYmxlZCcgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmVuYWJsZWQob2JqWydlbmFibGVkJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ2NvZGUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5jb2RlKG9ialsnY29kZSddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdvcmRlcicgaW4gb2JqOgogICAgICAgICAgICBzZWxmLm9yZGVyKG9ialsnb3JkZXInXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnZGF0ZScgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmRhdGUob2JqWydkYXRlJ10pOwogICAgICAgIAogICAgICAgICAgICBzZWxmLmRhdGUoZGF0ZXRpbWUuZGF0ZXRpbWUuZnJvbWlzb2Zvcm1hdChzZWxmLmRhdGUoKSkpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ25hbWUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5uYW1lKG9ialsnbmFtZSddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdyZW1hcmsnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5yZW1hcmsob2JqWydyZW1hcmsnXSk7CiAgICAgICAgCiAgICAgICAgICAgIHNlbGYucmVtYXJrKCBiYXNlNjQuYjY0ZGVjb2RlKHNlbGYucmVtYXJrKCkpICk7CiAgICAgICAgCiAgICAKCiAgICAgICAgZ2MuY29sbGVjdCgpOwogICAgICAgIHJldHVybiBzZWxmOwogICAgCiAgICBkZWYgX3RvRG9jdW1lbnQoc2VsZiwgYkpTT049Tm9uZSk6CiAgICAgICAgX190b1N0cmluZyA9ICdNZXRyaWNfR3JvdXA6Ol90b0RvY3VtZW50KCk6ICc7CgogICAgICAgIHJldCA9IHt9OwogICAgICAgIGlmIHNlbGYuSWQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiSWQiXSA9IHNlbGYuSWQ7CgogICAgCiAgICAgICAgaWYgc2VsZi5hY3RpdmUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJhY3RpdmUiXSA9IHNlbGYuYWN0aXZlKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLmVuYWJsZWQoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJlbmFibGVkIl0gPSBzZWxmLmVuYWJsZWQoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYuY29kZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbImNvZGUiXSA9IHNlbGYuY29kZSgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5vcmRlcigpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbIm9yZGVyIl0gPSBzZWxmLm9yZGVyKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLmRhdGUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJkYXRlIl0gPSBzZWxmLmRhdGUoKTsKICAgICAgICAKICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShyZXRbImRhdGUiXSwgZGF0ZXRpbWUuZGF0ZXRpbWUpOgogICAgICAgICAgICAgICAgcmV0WyJkYXRlIl0gPSByZXRbImRhdGUiXS5pc29mb3JtYXQoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYubmFtZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbIm5hbWUiXSA9IHNlbGYubmFtZSgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5yZW1hcmsoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IHNlbGYucmVtYXJrKCk7CiAgICAgICAgCiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UocmV0WyJyZW1hcmsiXSwgZGljdCk6CiAgICAgICAgICAgICAgICByZXRbInJlbWFyayJdID0ganNvbi5kdW1wcyhyZXRbInJlbWFyayJdKS5lbmNvZGUoJ3V0Zi04Jyk7CgogICAgICAgICAgICByZXRbInJlbWFyayJdID0gIGJhc2U2NC5iNjRlbmNvZGUocmV0WyJyZW1hcmsiXSkuZGVjb2RlKCd1dGYtOCcpLnN0cmlwKCk7CiAgICAgICAgCiAgICAKICAgICAgICAKICAgICAgICBpZiBiSlNPTiBpcyBub3QgTm9uZToKICAgICAgICAgICAgI3ByaW50KF9fdG9TdHJpbmcgKyAiR09UIEhFUkUiLCB0eXBlKHJldCksIHJldCk7CiAgICAgICAgICAgIHJldCA9IGpzb24uZHVtcHMocmV0KTsKICAgICAgICBnYy5jb2xsZWN0KCk7CiAgICAgICAgcmV0dXJuIHJldDsKCiAgICAKICAgIGRlZiBzdG9yZShzZWxmLCBfX2V2ZW50PU5vbmUpOgogICAgICAgIF9fdG9TdHJpbmcgPSAnTWV0cmljX0dyb3VwOjpzdG9yZSgpOiAnOwogICAgICAgIAogICAgICAgIGV2SlNPTiA9IE5vbmU7CgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIGV2SlNPTiA9IGpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOwogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046CiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7CiAgICAgICAgCgogICAgICAgIGFuc3dlciA9IE5vbmU7CgogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aW1lKCkpKyddLk1ldHJpY19Hcm91cC5zdG9yZSgpJykubWV0aG9kKCdzdG9yZScpLmNsYXNzTmFtZSgnTWV0cmljX0dyb3VwJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOwogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7CiAgICAgICAgCiAgICAgICAgZ2MuY29sbGVjdCgpOwoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7CgogICAgICAgIAogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOwogICAgICAgIAogICAgICAgICAgICBhbnN3ZXIgPSBNZXRyaWNfR3JvdXAoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7CiAgICAgICAgCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsKCgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsKCiAgICAgICAgICAgIAogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsKICAgICAgICAgICAgCgogICAgICAgIHJldHVybiBhbnN3ZXI7CgogICAgCiAgICBkZWYgZmluZEFsbChzZWxmLCBfX2V2ZW50PU5vbmUpOgogICAgICAgIF9fdG9TdHJpbmcgPSAnTWV0cmljX0dyb3VwOjpmaW5kQWxsKCk6ICc7CiAgICAgICAgCiAgICAgICAgZXZKU09OID0gTm9uZTsKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgZXZKU09OID0ganNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7CiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoKICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsKICAgICAgICAKCiAgICAgICAgYW5zd2VyID0gTm9uZTsKCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpbWUoKSkrJ10uTWV0cmljX0dyb3VwLmZpbmRBbGwoKScpLm1ldGhvZCgnZmluZEFsbCcpLmNsYXNzTmFtZSgnTWV0cmljX0dyb3VwJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOwogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7CiAgICAgICAgCiAgICAgICAgZ2MuY29sbGVjdCgpOwoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7CgogICAgICAgIAogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOwogICAgICAgIAogICAgICAgICAgICBhbnN3ZXIgPSBNZXRyaWNfR3JvdXAoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7CiAgICAgICAgCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsKCgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsKCiAgICAgICAgICAgIAogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsKICAgICAgICAgICAgCgogICAgICAgIHJldHVybiBhbnN3ZXI7CgogICAgCiAgICBkZWYgZmluZChzZWxmLCBfX2V2ZW50PU5vbmUpOgogICAgICAgIF9fdG9TdHJpbmcgPSAnTWV0cmljX0dyb3VwOjpmaW5kKCk6ICc7CiAgICAgICAgCiAgICAgICAgZXZKU09OID0gTm9uZTsKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgZXZKU09OID0ganNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7CiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoKICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsKICAgICAgICAKCiAgICAgICAgYW5zd2VyID0gTm9uZTsKCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpbWUoKSkrJ10uTWV0cmljX0dyb3VwLmZpbmQoKScpLm1ldGhvZCgnZmluZCcpLmNsYXNzTmFtZSgnTWV0cmljX0dyb3VwJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOwogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7CiAgICAgICAgCiAgICAgICAgZ2MuY29sbGVjdCgpOwoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7CgogICAgICAgIAogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOwogICAgICAgIAogICAgICAgICAgICBhbnN3ZXIgPSBNZXRyaWNfR3JvdXAoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7CiAgICAgICAgCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsKCgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsKCiAgICAgICAgICAgIAogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsKICAgICAgICAgICAgCgogICAgICAgIHJldHVybiBhbnN3ZXI7CgogICAgCgoKY2xhc3MgTWV0cmljX1R5cGUoKToKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBJZD1Ob25lLCBhY3RpdmU9Tm9uZSwgZW5hYmxlZD1Ob25lLCBjb2RlPU5vbmUsIG9yZGVyPU5vbmUsIGRhdGU9Tm9uZSwgbmFtZT1Ob25lLCByZW1hcms9Tm9uZSwgZ3JvdXA9Tm9uZSk6CiAgICAgICAgc3VwZXIoKS5fX2luaXRfXygpOwoKICAgICAgICAjcHJpbnQoJ01ldHJpY19UeXBlOjpfX2luaXRfXygpJyk7CiAgICAgICAgaWYgSWQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHNlbGYuSWQgPSBJZDsKCiAgICAgICAgCiAgICAgICAgc2VsZi5hY3RpdmUoYWN0aXZlKTsKICAgICAgICBzZWxmLmVuYWJsZWQoZW5hYmxlZCk7CiAgICAgICAgc2VsZi5jb2RlKGNvZGUpOwogICAgICAgIHNlbGYub3JkZXIob3JkZXIpOwogICAgICAgIHNlbGYuZGF0ZShkYXRlKTsKICAgICAgICBzZWxmLm5hbWUobmFtZSk7CiAgICAgICAgc2VsZi5yZW1hcmsocmVtYXJrKTsKICAgICAgICBzZWxmLmdyb3VwKGdyb3VwKTsKICAgICAgICAKICAgIElkID0gTm9uZTsKICAgIAogICAgCiAgICAjIGFjdGl2ZTogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX2FjdGl2ZSA9IE5vbmU7CiAgICBkZWYgYWN0aXZlKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9hY3RpdmUgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fYWN0aXZlOwoKCiAgICAKICAgICMgZW5hYmxlZDogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX2VuYWJsZWQgPSBOb25lOwogICAgZGVmIGVuYWJsZWQoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2VuYWJsZWQgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fZW5hYmxlZDsKCgogICAgCiAgICAjIGNvZGU6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9jb2RlID0gTm9uZTsKICAgIGRlZiBjb2RlKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9jb2RlID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2NvZGU7CgoKICAgIAogICAgIyBvcmRlcjogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX29yZGVyID0gTm9uZTsKICAgIGRlZiBvcmRlcihzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fb3JkZXIgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fb3JkZXI7CgoKICAgIAogICAgIyBkYXRlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfZGF0ZSA9IE5vbmU7CiAgICBkZWYgZGF0ZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fZGF0ZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9kYXRlOwoKCiAgICAKICAgICMgbmFtZTogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX25hbWUgPSBOb25lOwogICAgZGVmIG5hbWUoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX25hbWUgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fbmFtZTsKCgogICAgCiAgICAjIHJlbWFyazogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX3JlbWFyayA9IE5vbmU7CiAgICBkZWYgcmVtYXJrKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9yZW1hcmsgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fcmVtYXJrOwoKCiAgICAKICAgICMgZ3JvdXA6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9ncm91cCA9IE5vbmU7CiAgICBkZWYgZ3JvdXAoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2dyb3VwID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2dyb3VwOwoKCiAgICAKICAgIAogICAgZGVmIF9mcm9tRG9jdW1lbnQoc2VsZiwgb2JqKToKICAgICAgICBfX3RvU3RyaW5nID0gJ01ldHJpY19UeXBlOjpfZnJvbURvY3VtZW50KCk6ICc7CiAgICAgICAgCiAgICAgICAgaWYgb2JqIGlzIE5vbmU6CiAgICAgICAgICAgIHJldHVybiBzZWxmOwoKICAgICAgICBpZiBpc2luc3RhbmNlKG9iaiwgYnl0ZXMpOgogICAgICAgICAgICBvYmogPSBzdHIob2JqLCAidXRmLTgiKTsKICAgICAgICAKICAgICAgICBpZiBpc2luc3RhbmNlKG9iaiwgc3RyKSBvciB0eXBlKG9iaikgaXMgc3RyOgogICAgICAgICAgICBpZiByZS5tYXRjaChyIigoKFtBLVphLXpdezMsOX06KD86XC9cLyk/KSg/OlstOzomPVwrXCQsXHddK0ApP1tBLVphLXowLTkuLV0rfCg/Ond3dy58Wy07OiY9XCtcJCxcd10rQClbQS1aYS16MC05Li1dKykoKD86XC9bXCt+JVwvLlx3XC1fXSopP1w/Pyg/OlstXCs9JjslQC5cd19dKikjPyg/Oltcd10qKSk/KSIsIG9iaik6CiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgb2JqID0ganNvbi5sb2Fkcyh1cmxsaWIzLlBvb2xNYW5hZ2VyKCkucmVxdWVzdCgnR0VUJywgb2JqKS5kYXRhLmRlY29kZSgndXRmLTgnKSk7CiAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgb2JqID0ge307CiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBvYmogPSBqc29uLmxvYWRzKG9iaik7CiAgICAgICAgCiAgICAgICAgaWYgbm90IGlzaW5zdGFuY2Uob2JqLCAoc3RyLCBieXRlcywgZGljdCkpOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJ0dPVCBIRVJFOiAnICsgc3RyKHR5cGUob2JqKSkpOwogICAgICAgICAgICByZXR1cm4gb2JqOwoKICAgICAgICAgICAgZm9yIGkgaW4gb2JqOgogICAgICAgICAgICAgICAgb2JqW2ldID0gTWV0cmljX1R5cGUoKS5fZnJvbURvY3VtZW50KG9ialtpXSk7CiAgICAgICAgICAgIHJldHVybiBvYmo7CgoKICAgICAgICBpZiAnSWQnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5JZCA9IG9ialsnSWQnXTsKCiAgICAKICAgICAgICBpZiAnYWN0aXZlJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuYWN0aXZlKG9ialsnYWN0aXZlJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ2VuYWJsZWQnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5lbmFibGVkKG9ialsnZW5hYmxlZCddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdjb2RlJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuY29kZShvYmpbJ2NvZGUnXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnb3JkZXInIGluIG9iajoKICAgICAgICAgICAgc2VsZi5vcmRlcihvYmpbJ29yZGVyJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ2RhdGUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5kYXRlKG9ialsnZGF0ZSddKTsKICAgICAgICAKICAgICAgICAgICAgc2VsZi5kYXRlKGRhdGV0aW1lLmRhdGV0aW1lLmZyb21pc29mb3JtYXQoc2VsZi5kYXRlKCkpKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICduYW1lJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYubmFtZShvYmpbJ25hbWUnXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAncmVtYXJrJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYucmVtYXJrKG9ialsncmVtYXJrJ10pOwogICAgICAgIAogICAgICAgICAgICBzZWxmLnJlbWFyayggYmFzZTY0LmI2NGRlY29kZShzZWxmLnJlbWFyaygpKSApOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ2dyb3VwJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuZ3JvdXAoTWV0cmljX0dyb3VwKCkuX2Zyb21Eb2N1bWVudChvYmpbJ2dyb3VwJ10pKTsKICAgICAgICAKICAgIAoKICAgICAgICBnYy5jb2xsZWN0KCk7CiAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAKICAgIGRlZiBfdG9Eb2N1bWVudChzZWxmLCBiSlNPTj1Ob25lKToKICAgICAgICBfX3RvU3RyaW5nID0gJ01ldHJpY19UeXBlOjpfdG9Eb2N1bWVudCgpOiAnOwoKICAgICAgICByZXQgPSB7fTsKICAgICAgICBpZiBzZWxmLklkIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbIklkIl0gPSBzZWxmLklkOwoKICAgIAogICAgICAgIGlmIHNlbGYuYWN0aXZlKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiYWN0aXZlIl0gPSBzZWxmLmFjdGl2ZSgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5lbmFibGVkKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiZW5hYmxlZCJdID0gc2VsZi5lbmFibGVkKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLmNvZGUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJjb2RlIl0gPSBzZWxmLmNvZGUoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYub3JkZXIoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJvcmRlciJdID0gc2VsZi5vcmRlcigpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5kYXRlKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiZGF0ZSJdID0gc2VsZi5kYXRlKCk7CiAgICAgICAgCiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UocmV0WyJkYXRlIl0sIGRhdGV0aW1lLmRhdGV0aW1lKToKICAgICAgICAgICAgICAgIHJldFsiZGF0ZSJdID0gcmV0WyJkYXRlIl0uaXNvZm9ybWF0KCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLm5hbWUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJuYW1lIl0gPSBzZWxmLm5hbWUoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYucmVtYXJrKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSBzZWxmLnJlbWFyaygpOwogICAgICAgIAogICAgICAgICAgICBpZiBpc2luc3RhbmNlKHJldFsicmVtYXJrIl0sIGRpY3QpOgogICAgICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IGpzb24uZHVtcHMocmV0WyJyZW1hcmsiXSkuZW5jb2RlKCd1dGYtOCcpOwoKICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9ICBiYXNlNjQuYjY0ZW5jb2RlKHJldFsicmVtYXJrIl0pLmRlY29kZSgndXRmLTgnKS5zdHJpcCgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5ncm91cCgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbImdyb3VwIl0gPSBzZWxmLmdyb3VwKCkuX3RvRG9jdW1lbnQoKTsKICAgICAgICAKICAgIAogICAgICAgIAogICAgICAgIGlmIGJKU09OIGlzIG5vdCBOb25lOgogICAgICAgICAgICAjcHJpbnQoX190b1N0cmluZyArICJHT1QgSEVSRSIsIHR5cGUocmV0KSwgcmV0KTsKICAgICAgICAgICAgcmV0ID0ganNvbi5kdW1wcyhyZXQpOwogICAgICAgIGdjLmNvbGxlY3QoKTsKICAgICAgICByZXR1cm4gcmV0OwoKICAgIAogICAgZGVmIHN0b3JlKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6CiAgICAgICAgX190b1N0cmluZyA9ICdNZXRyaWNfVHlwZTo6c3RvcmUoKTogJzsKICAgICAgICAKICAgICAgICBldkpTT04gPSBOb25lOwoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBldkpTT04gPSBqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsKICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOgogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOwogICAgICAgIAoKICAgICAgICBhbnN3ZXIgPSBOb25lOwoKICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGltZSgpKSsnXS5NZXRyaWNfVHlwZS5zdG9yZSgpJykubWV0aG9kKCdzdG9yZScpLmNsYXNzTmFtZSgnTWV0cmljX1R5cGUnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7CiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsKICAgICAgICAKICAgICAgICBnYy5jb2xsZWN0KCk7CgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsKCiAgICAgICAgCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7CiAgICAgICAgCiAgICAgICAgICAgIGFuc3dlciA9IE1ldHJpY19UeXBlKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOwogICAgICAgIAoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7CgoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOgogICAgICAgICAgICAKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7CgogICAgICAgICAgICAKICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7CiAgICAgICAgICAgIAoKICAgICAgICByZXR1cm4gYW5zd2VyOwoKICAgIAogICAgZGVmIGZpbmRBbGwoc2VsZiwgX19ldmVudD1Ob25lKToKICAgICAgICBfX3RvU3RyaW5nID0gJ01ldHJpY19UeXBlOjpmaW5kQWxsKCk6ICc7CiAgICAgICAgCiAgICAgICAgZXZKU09OID0gTm9uZTsKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgZXZKU09OID0ganNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7CiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoKICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsKICAgICAgICAKCiAgICAgICAgYW5zd2VyID0gTm9uZTsKCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpbWUoKSkrJ10uTWV0cmljX1R5cGUuZmluZEFsbCgpJykubWV0aG9kKCdmaW5kQWxsJykuY2xhc3NOYW1lKCdNZXRyaWNfVHlwZScpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOwogICAgICAgIAogICAgICAgIGdjLmNvbGxlY3QoKTsKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOwoKICAgICAgICAKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsKICAgICAgICAKICAgICAgICAgICAgYW5zd2VyID0gTWV0cmljX1R5cGUoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7CiAgICAgICAgCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsKCgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsKCiAgICAgICAgICAgIAogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsKICAgICAgICAgICAgCgogICAgICAgIHJldHVybiBhbnN3ZXI7CgogICAgCiAgICBkZWYgZmluZChzZWxmLCBfX2V2ZW50PU5vbmUpOgogICAgICAgIF9fdG9TdHJpbmcgPSAnTWV0cmljX1R5cGU6OmZpbmQoKTogJzsKICAgICAgICAKICAgICAgICBldkpTT04gPSBOb25lOwoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBldkpTT04gPSBqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsKICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOgogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOwogICAgICAgIAoKICAgICAgICBhbnN3ZXIgPSBOb25lOwoKICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGltZSgpKSsnXS5NZXRyaWNfVHlwZS5maW5kKCknKS5tZXRob2QoJ2ZpbmQnKS5jbGFzc05hbWUoJ01ldHJpY19UeXBlJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOwogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7CiAgICAgICAgCiAgICAgICAgZ2MuY29sbGVjdCgpOwoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7CgogICAgICAgIAogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOwogICAgICAgIAogICAgICAgICAgICBhbnN3ZXIgPSBNZXRyaWNfVHlwZSgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsKICAgICAgICAKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOwoKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOwogICAgICAgICAgICAKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOwoKICAgICAgICAgICAgCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOwogICAgICAgICAgICAKCiAgICAgICAgcmV0dXJuIGFuc3dlcjsKCiAgICAKCgpjbGFzcyBDb25maWcoKToKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBJZD1Ob25lLCBhY3RpdmU9Tm9uZSwgZW5hYmxlZD1Ob25lLCBjb2RlPU5vbmUsIG9yZGVyPU5vbmUsIGRhdGU9Tm9uZSwgbmFtZT1Ob25lLCByZW1hcms9Tm9uZSwgdmFsdWU9Tm9uZSwgc2NyaXB0PU5vbmUsIHRvb2w9Tm9uZSwgZ3JvdXA9Tm9uZSwgdHlwZT1Ob25lLCBub2RlPU5vbmUpOgogICAgICAgIHN1cGVyKCkuX19pbml0X18oKTsKCiAgICAgICAgI3ByaW50KCdDb25maWc6Ol9faW5pdF9fKCknKTsKICAgICAgICBpZiBJZCBpcyBub3QgTm9uZToKICAgICAgICAgICAgc2VsZi5JZCA9IElkOwoKICAgICAgICAKICAgICAgICBzZWxmLmFjdGl2ZShhY3RpdmUpOwogICAgICAgIHNlbGYuZW5hYmxlZChlbmFibGVkKTsKICAgICAgICBzZWxmLmNvZGUoY29kZSk7CiAgICAgICAgc2VsZi5vcmRlcihvcmRlcik7CiAgICAgICAgc2VsZi5kYXRlKGRhdGUpOwogICAgICAgIHNlbGYubmFtZShuYW1lKTsKICAgICAgICBzZWxmLnJlbWFyayhyZW1hcmspOwogICAgICAgIHNlbGYudmFsdWUodmFsdWUpOwogICAgICAgIHNlbGYuc2NyaXB0KHNjcmlwdCk7CiAgICAgICAgc2VsZi50b29sKHRvb2wpOwogICAgICAgIHNlbGYuZ3JvdXAoZ3JvdXApOwogICAgICAgIHNlbGYudHlwZSh0eXBlKTsKICAgICAgICBzZWxmLm5vZGUobm9kZSk7CiAgICAgICAgCiAgICBJZCA9IE5vbmU7CiAgICAKICAgIAogICAgIyBhY3RpdmU6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9hY3RpdmUgPSBOb25lOwogICAgZGVmIGFjdGl2ZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fYWN0aXZlID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2FjdGl2ZTsKCgogICAgCiAgICAjIGVuYWJsZWQ6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9lbmFibGVkID0gTm9uZTsKICAgIGRlZiBlbmFibGVkKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9lbmFibGVkID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2VuYWJsZWQ7CgoKICAgIAogICAgIyBjb2RlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfY29kZSA9IE5vbmU7CiAgICBkZWYgY29kZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fY29kZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9jb2RlOwoKCiAgICAKICAgICMgb3JkZXI6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9vcmRlciA9IE5vbmU7CiAgICBkZWYgb3JkZXIoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX29yZGVyID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX29yZGVyOwoKCiAgICAKICAgICMgZGF0ZTogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX2RhdGUgPSBOb25lOwogICAgZGVmIGRhdGUoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2RhdGUgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fZGF0ZTsKCgogICAgCiAgICAjIG5hbWU6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9uYW1lID0gTm9uZTsKICAgIGRlZiBuYW1lKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9uYW1lID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX25hbWU7CgoKICAgIAogICAgIyByZW1hcms6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9yZW1hcmsgPSBOb25lOwogICAgZGVmIHJlbWFyayhzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fcmVtYXJrID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3JlbWFyazsKCgogICAgCiAgICAjIHZhbHVlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfdmFsdWUgPSBOb25lOwogICAgZGVmIHZhbHVlKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl92YWx1ZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl92YWx1ZTsKCgogICAgCiAgICAjIHNjcmlwdDogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX3NjcmlwdCA9IE5vbmU7CiAgICBkZWYgc2NyaXB0KHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9zY3JpcHQgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fc2NyaXB0OwoKCiAgICAKICAgICMgdG9vbDogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX3Rvb2wgPSBOb25lOwogICAgZGVmIHRvb2woc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX3Rvb2wgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fdG9vbDsKCgogICAgCiAgICAjIGdyb3VwOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfZ3JvdXAgPSBOb25lOwogICAgZGVmIGdyb3VwKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9ncm91cCA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9ncm91cDsKCgogICAgCiAgICAjIHR5cGU6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF90eXBlID0gTm9uZTsKICAgIGRlZiB0eXBlKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl90eXBlID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3R5cGU7CgoKICAgIAogICAgIyBub2RlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfbm9kZSA9IE5vbmU7CiAgICBkZWYgbm9kZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fbm9kZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9ub2RlOwoKCiAgICAKICAgIAogICAgZGVmIF9mcm9tRG9jdW1lbnQoc2VsZiwgb2JqKToKICAgICAgICBfX3RvU3RyaW5nID0gJ0NvbmZpZzo6X2Zyb21Eb2N1bWVudCgpOiAnOwogICAgICAgIAogICAgICAgIGlmIG9iaiBpcyBOb25lOgogICAgICAgICAgICByZXR1cm4gc2VsZjsKCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIGJ5dGVzKToKICAgICAgICAgICAgb2JqID0gc3RyKG9iaiwgInV0Zi04Iik7CiAgICAgICAgCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIHN0cikgb3IgdHlwZShvYmopIGlzIHN0cjoKICAgICAgICAgICAgaWYgcmUubWF0Y2gociIoKChbQS1aYS16XXszLDl9Oig/OlwvXC8pPykoPzpbLTs6Jj1cK1wkLFx3XStAKT9bQS1aYS16MC05Li1dK3woPzp3d3cufFstOzomPVwrXCQsXHddK0ApW0EtWmEtejAtOS4tXSspKCg/OlwvW1wrfiVcLy5cd1wtX10qKT9cPz8oPzpbLVwrPSY7JUAuXHdfXSopIz8oPzpbXHddKikpPykiLCBvYmopOgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIG9iaiA9IGpzb24ubG9hZHModXJsbGliMy5Qb29sTWFuYWdlcigpLnJlcXVlc3QoJ0dFVCcsIG9iaikuZGF0YS5kZWNvZGUoJ3V0Zi04JykpOwogICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgIG9iaiA9IHt9OwogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgb2JqID0ganNvbi5sb2FkcyhvYmopOwogICAgICAgIAogICAgICAgIGlmIG5vdCBpc2luc3RhbmNlKG9iaiwgKHN0ciwgYnl0ZXMsIGRpY3QpKToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICdHT1QgSEVSRTogJyArIHN0cih0eXBlKG9iaikpKTsKICAgICAgICAgICAgcmV0dXJuIG9iajsKCiAgICAgICAgICAgIGZvciBpIGluIG9iajoKICAgICAgICAgICAgICAgIG9ialtpXSA9IENvbmZpZygpLl9mcm9tRG9jdW1lbnQob2JqW2ldKTsKICAgICAgICAgICAgcmV0dXJuIG9iajsKCgogICAgICAgIGlmICdJZCcgaW4gb2JqOgogICAgICAgICAgICBzZWxmLklkID0gb2JqWydJZCddOwoKICAgIAogICAgICAgIGlmICdhY3RpdmUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5hY3RpdmUob2JqWydhY3RpdmUnXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnZW5hYmxlZCcgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmVuYWJsZWQob2JqWydlbmFibGVkJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ2NvZGUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5jb2RlKG9ialsnY29kZSddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdvcmRlcicgaW4gb2JqOgogICAgICAgICAgICBzZWxmLm9yZGVyKG9ialsnb3JkZXInXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnZGF0ZScgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmRhdGUob2JqWydkYXRlJ10pOwogICAgICAgIAogICAgICAgICAgICBzZWxmLmRhdGUoZGF0ZXRpbWUuZGF0ZXRpbWUuZnJvbWlzb2Zvcm1hdChzZWxmLmRhdGUoKSkpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ25hbWUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5uYW1lKG9ialsnbmFtZSddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdyZW1hcmsnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5yZW1hcmsob2JqWydyZW1hcmsnXSk7CiAgICAgICAgCiAgICAgICAgICAgIHNlbGYucmVtYXJrKCBiYXNlNjQuYjY0ZGVjb2RlKHNlbGYucmVtYXJrKCkpICk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAndmFsdWUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi52YWx1ZShvYmpbJ3ZhbHVlJ10pOwogICAgICAgIAogICAgICAgICAgICBzZWxmLnZhbHVlKCBiYXNlNjQuYjY0ZGVjb2RlKHNlbGYudmFsdWUoKSkgKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdzY3JpcHQnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5zY3JpcHQob2JqWydzY3JpcHQnXSk7CiAgICAgICAgCiAgICAgICAgICAgIHNlbGYuc2NyaXB0KCBiYXNlNjQuYjY0ZGVjb2RlKHNlbGYuc2NyaXB0KCkpICk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAndG9vbCcgaW4gb2JqOgogICAgICAgICAgICBzZWxmLnRvb2woVG9vbCgpLl9mcm9tRG9jdW1lbnQob2JqWyd0b29sJ10pKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdncm91cCcgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmdyb3VwKENvbmZpZ19Hcm91cCgpLl9mcm9tRG9jdW1lbnQob2JqWydncm91cCddKSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAndHlwZScgaW4gb2JqOgogICAgICAgICAgICBzZWxmLnR5cGUoVG9vbF9UeXBlKCkuX2Zyb21Eb2N1bWVudChvYmpbJ3R5cGUnXSkpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ25vZGUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5ub2RlKE5vZGUoKS5fZnJvbURvY3VtZW50KG9ialsnbm9kZSddKSk7CiAgICAgICAgCiAgICAKCiAgICAgICAgZ2MuY29sbGVjdCgpOwogICAgICAgIHJldHVybiBzZWxmOwogICAgCiAgICBkZWYgX3RvRG9jdW1lbnQoc2VsZiwgYkpTT049Tm9uZSk6CiAgICAgICAgX190b1N0cmluZyA9ICdDb25maWc6Ol90b0RvY3VtZW50KCk6ICc7CgogICAgICAgIHJldCA9IHt9OwogICAgICAgIGlmIHNlbGYuSWQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiSWQiXSA9IHNlbGYuSWQ7CgogICAgCiAgICAgICAgaWYgc2VsZi5hY3RpdmUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJhY3RpdmUiXSA9IHNlbGYuYWN0aXZlKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLmVuYWJsZWQoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJlbmFibGVkIl0gPSBzZWxmLmVuYWJsZWQoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYuY29kZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbImNvZGUiXSA9IHNlbGYuY29kZSgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5vcmRlcigpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbIm9yZGVyIl0gPSBzZWxmLm9yZGVyKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLmRhdGUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJkYXRlIl0gPSBzZWxmLmRhdGUoKTsKICAgICAgICAKICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShyZXRbImRhdGUiXSwgZGF0ZXRpbWUuZGF0ZXRpbWUpOgogICAgICAgICAgICAgICAgcmV0WyJkYXRlIl0gPSByZXRbImRhdGUiXS5pc29mb3JtYXQoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYubmFtZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbIm5hbWUiXSA9IHNlbGYubmFtZSgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5yZW1hcmsoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IHNlbGYucmVtYXJrKCk7CiAgICAgICAgCiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UocmV0WyJyZW1hcmsiXSwgZGljdCk6CiAgICAgICAgICAgICAgICByZXRbInJlbWFyayJdID0ganNvbi5kdW1wcyhyZXRbInJlbWFyayJdKS5lbmNvZGUoJ3V0Zi04Jyk7CgogICAgICAgICAgICByZXRbInJlbWFyayJdID0gIGJhc2U2NC5iNjRlbmNvZGUocmV0WyJyZW1hcmsiXSkuZGVjb2RlKCd1dGYtOCcpLnN0cmlwKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLnZhbHVlKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsidmFsdWUiXSA9IHNlbGYudmFsdWUoKTsKICAgICAgICAKICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShyZXRbInZhbHVlIl0sIGRpY3QpOgogICAgICAgICAgICAgICAgcmV0WyJ2YWx1ZSJdID0ganNvbi5kdW1wcyhyZXRbInZhbHVlIl0pLmVuY29kZSgndXRmLTgnKTsKCiAgICAgICAgICAgIHJldFsidmFsdWUiXSA9ICBiYXNlNjQuYjY0ZW5jb2RlKHJldFsidmFsdWUiXSkuZGVjb2RlKCd1dGYtOCcpLnN0cmlwKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLnNjcmlwdCgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbInNjcmlwdCJdID0gc2VsZi5zY3JpcHQoKTsKICAgICAgICAKICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShyZXRbInNjcmlwdCJdLCBkaWN0KToKICAgICAgICAgICAgICAgIHJldFsic2NyaXB0Il0gPSBqc29uLmR1bXBzKHJldFsic2NyaXB0Il0pLmVuY29kZSgndXRmLTgnKTsKCiAgICAgICAgICAgIHJldFsic2NyaXB0Il0gPSAgYmFzZTY0LmI2NGVuY29kZShyZXRbInNjcmlwdCJdKS5kZWNvZGUoJ3V0Zi04Jykuc3RyaXAoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYudG9vbCgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbInRvb2wiXSA9IHNlbGYudG9vbCgpLl90b0RvY3VtZW50KCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLmdyb3VwKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiZ3JvdXAiXSA9IHNlbGYuZ3JvdXAoKS5fdG9Eb2N1bWVudCgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi50eXBlKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsidHlwZSJdID0gc2VsZi50eXBlKCkuX3RvRG9jdW1lbnQoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYubm9kZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbIm5vZGUiXSA9IHNlbGYubm9kZSgpLl90b0RvY3VtZW50KCk7CiAgICAgICAgCiAgICAKICAgICAgICAKICAgICAgICBpZiBiSlNPTiBpcyBub3QgTm9uZToKICAgICAgICAgICAgI3ByaW50KF9fdG9TdHJpbmcgKyAiR09UIEhFUkUiLCB0eXBlKHJldCksIHJldCk7CiAgICAgICAgICAgIHJldCA9IGpzb24uZHVtcHMocmV0KTsKICAgICAgICBnYy5jb2xsZWN0KCk7CiAgICAgICAgcmV0dXJuIHJldDsKCiAgICAKICAgIGRlZiBzdG9yZShzZWxmLCBfX2V2ZW50PU5vbmUpOgogICAgICAgIF9fdG9TdHJpbmcgPSAnQ29uZmlnOjpzdG9yZSgpOiAnOwogICAgICAgIAogICAgICAgIGV2SlNPTiA9IE5vbmU7CgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIGV2SlNPTiA9IGpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOwogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046CiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7CiAgICAgICAgCgogICAgICAgIGFuc3dlciA9IE5vbmU7CgogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aW1lKCkpKyddLkNvbmZpZy5zdG9yZSgpJykubWV0aG9kKCdzdG9yZScpLmNsYXNzTmFtZSgnQ29uZmlnJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOwogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7CiAgICAgICAgCiAgICAgICAgZ2MuY29sbGVjdCgpOwoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7CgogICAgICAgIAogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOwogICAgICAgIAogICAgICAgICAgICBhbnN3ZXIgPSBDb25maWcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7CiAgICAgICAgCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsKCgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsKCiAgICAgICAgICAgIAogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsKICAgICAgICAgICAgCgogICAgICAgIHJldHVybiBhbnN3ZXI7CgogICAgCiAgICBkZWYgZmluZEFsbChzZWxmLCBfX2V2ZW50PU5vbmUpOgogICAgICAgIF9fdG9TdHJpbmcgPSAnQ29uZmlnOjpmaW5kQWxsKCk6ICc7CiAgICAgICAgCiAgICAgICAgZXZKU09OID0gTm9uZTsKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgZXZKU09OID0ganNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7CiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoKICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsKICAgICAgICAKCiAgICAgICAgYW5zd2VyID0gTm9uZTsKCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpbWUoKSkrJ10uQ29uZmlnLmZpbmRBbGwoKScpLm1ldGhvZCgnZmluZEFsbCcpLmNsYXNzTmFtZSgnQ29uZmlnJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOwogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7CiAgICAgICAgCiAgICAgICAgZ2MuY29sbGVjdCgpOwoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7CgogICAgICAgIAogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOwogICAgICAgIAogICAgICAgICAgICBhbnN3ZXIgPSBDb25maWcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7CiAgICAgICAgCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsKCgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsKCiAgICAgICAgICAgIAogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsKICAgICAgICAgICAgCgogICAgICAgIHJldHVybiBhbnN3ZXI7CgogICAgCiAgICBkZWYgZmluZChzZWxmLCBfX2V2ZW50PU5vbmUpOgogICAgICAgIF9fdG9TdHJpbmcgPSAnQ29uZmlnOjpmaW5kKCk6ICc7CiAgICAgICAgCiAgICAgICAgZXZKU09OID0gTm9uZTsKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgZXZKU09OID0ganNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7CiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoKICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsKICAgICAgICAKCiAgICAgICAgYW5zd2VyID0gTm9uZTsKCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpbWUoKSkrJ10uQ29uZmlnLmZpbmQoKScpLm1ldGhvZCgnZmluZCcpLmNsYXNzTmFtZSgnQ29uZmlnJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOwogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7CiAgICAgICAgCiAgICAgICAgZ2MuY29sbGVjdCgpOwoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7CgogICAgICAgIAogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOwogICAgICAgIAogICAgICAgICAgICBhbnN3ZXIgPSBDb25maWcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7CiAgICAgICAgCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsKCgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsKCiAgICAgICAgICAgIAogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsKICAgICAgICAgICAgCgogICAgICAgIHJldHVybiBhbnN3ZXI7CgogICAgCgoKY2xhc3MgVG9vbCgpOgogICAgZGVmIF9faW5pdF9fKHNlbGYsIElkPU5vbmUsIGFjdGl2ZT1Ob25lLCBlbmFibGVkPU5vbmUsIGNvZGU9Tm9uZSwgb3JkZXI9Tm9uZSwgZGF0ZT1Ob25lLCBuYW1lPU5vbmUsIHJlbWFyaz1Ob25lLCB0eXBlPU5vbmUpOgogICAgICAgIHN1cGVyKCkuX19pbml0X18oKTsKCiAgICAgICAgI3ByaW50KCdUb29sOjpfX2luaXRfXygpJyk7CiAgICAgICAgaWYgSWQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHNlbGYuSWQgPSBJZDsKCiAgICAgICAgCiAgICAgICAgc2VsZi5hY3RpdmUoYWN0aXZlKTsKICAgICAgICBzZWxmLmVuYWJsZWQoZW5hYmxlZCk7CiAgICAgICAgc2VsZi5jb2RlKGNvZGUpOwogICAgICAgIHNlbGYub3JkZXIob3JkZXIpOwogICAgICAgIHNlbGYuZGF0ZShkYXRlKTsKICAgICAgICBzZWxmLm5hbWUobmFtZSk7CiAgICAgICAgc2VsZi5yZW1hcmsocmVtYXJrKTsKICAgICAgICBzZWxmLnR5cGUodHlwZSk7CiAgICAgICAgCiAgICBJZCA9IE5vbmU7CiAgICAKICAgIAogICAgIyBhY3RpdmU6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9hY3RpdmUgPSBOb25lOwogICAgZGVmIGFjdGl2ZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fYWN0aXZlID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2FjdGl2ZTsKCgogICAgCiAgICAjIGVuYWJsZWQ6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9lbmFibGVkID0gTm9uZTsKICAgIGRlZiBlbmFibGVkKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9lbmFibGVkID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2VuYWJsZWQ7CgoKICAgIAogICAgIyBjb2RlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfY29kZSA9IE5vbmU7CiAgICBkZWYgY29kZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fY29kZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9jb2RlOwoKCiAgICAKICAgICMgb3JkZXI6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9vcmRlciA9IE5vbmU7CiAgICBkZWYgb3JkZXIoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX29yZGVyID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX29yZGVyOwoKCiAgICAKICAgICMgZGF0ZTogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX2RhdGUgPSBOb25lOwogICAgZGVmIGRhdGUoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2RhdGUgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fZGF0ZTsKCgogICAgCiAgICAjIG5hbWU6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9uYW1lID0gTm9uZTsKICAgIGRlZiBuYW1lKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9uYW1lID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX25hbWU7CgoKICAgIAogICAgIyByZW1hcms6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9yZW1hcmsgPSBOb25lOwogICAgZGVmIHJlbWFyayhzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fcmVtYXJrID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3JlbWFyazsKCgogICAgCiAgICAjIHR5cGU6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF90eXBlID0gTm9uZTsKICAgIGRlZiB0eXBlKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl90eXBlID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3R5cGU7CgoKICAgIAogICAgCiAgICBkZWYgX2Zyb21Eb2N1bWVudChzZWxmLCBvYmopOgogICAgICAgIF9fdG9TdHJpbmcgPSAnVG9vbDo6X2Zyb21Eb2N1bWVudCgpOiAnOwogICAgICAgIAogICAgICAgIGlmIG9iaiBpcyBOb25lOgogICAgICAgICAgICByZXR1cm4gc2VsZjsKCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIGJ5dGVzKToKICAgICAgICAgICAgb2JqID0gc3RyKG9iaiwgInV0Zi04Iik7CiAgICAgICAgCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIHN0cikgb3IgdHlwZShvYmopIGlzIHN0cjoKICAgICAgICAgICAgaWYgcmUubWF0Y2gociIoKChbQS1aYS16XXszLDl9Oig/OlwvXC8pPykoPzpbLTs6Jj1cK1wkLFx3XStAKT9bQS1aYS16MC05Li1dK3woPzp3d3cufFstOzomPVwrXCQsXHddK0ApW0EtWmEtejAtOS4tXSspKCg/OlwvW1wrfiVcLy5cd1wtX10qKT9cPz8oPzpbLVwrPSY7JUAuXHdfXSopIz8oPzpbXHddKikpPykiLCBvYmopOgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIG9iaiA9IGpzb24ubG9hZHModXJsbGliMy5Qb29sTWFuYWdlcigpLnJlcXVlc3QoJ0dFVCcsIG9iaikuZGF0YS5kZWNvZGUoJ3V0Zi04JykpOwogICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgIG9iaiA9IHt9OwogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgb2JqID0ganNvbi5sb2FkcyhvYmopOwogICAgICAgIAogICAgICAgIGlmIG5vdCBpc2luc3RhbmNlKG9iaiwgKHN0ciwgYnl0ZXMsIGRpY3QpKToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICdHT1QgSEVSRTogJyArIHN0cih0eXBlKG9iaikpKTsKICAgICAgICAgICAgcmV0dXJuIG9iajsKCiAgICAgICAgICAgIGZvciBpIGluIG9iajoKICAgICAgICAgICAgICAgIG9ialtpXSA9IFRvb2woKS5fZnJvbURvY3VtZW50KG9ialtpXSk7CiAgICAgICAgICAgIHJldHVybiBvYmo7CgoKICAgICAgICBpZiAnSWQnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5JZCA9IG9ialsnSWQnXTsKCiAgICAKICAgICAgICBpZiAnYWN0aXZlJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuYWN0aXZlKG9ialsnYWN0aXZlJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ2VuYWJsZWQnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5lbmFibGVkKG9ialsnZW5hYmxlZCddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdjb2RlJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuY29kZShvYmpbJ2NvZGUnXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnb3JkZXInIGluIG9iajoKICAgICAgICAgICAgc2VsZi5vcmRlcihvYmpbJ29yZGVyJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ2RhdGUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5kYXRlKG9ialsnZGF0ZSddKTsKICAgICAgICAKICAgICAgICAgICAgc2VsZi5kYXRlKGRhdGV0aW1lLmRhdGV0aW1lLmZyb21pc29mb3JtYXQoc2VsZi5kYXRlKCkpKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICduYW1lJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYubmFtZShvYmpbJ25hbWUnXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAncmVtYXJrJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYucmVtYXJrKG9ialsncmVtYXJrJ10pOwogICAgICAgIAogICAgICAgICAgICBzZWxmLnJlbWFyayggYmFzZTY0LmI2NGRlY29kZShzZWxmLnJlbWFyaygpKSApOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ3R5cGUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi50eXBlKFRvb2xfVHlwZSgpLl9mcm9tRG9jdW1lbnQob2JqWyd0eXBlJ10pKTsKICAgICAgICAKICAgIAoKICAgICAgICBnYy5jb2xsZWN0KCk7CiAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAKICAgIGRlZiBfdG9Eb2N1bWVudChzZWxmLCBiSlNPTj1Ob25lKToKICAgICAgICBfX3RvU3RyaW5nID0gJ1Rvb2w6Ol90b0RvY3VtZW50KCk6ICc7CgogICAgICAgIHJldCA9IHt9OwogICAgICAgIGlmIHNlbGYuSWQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiSWQiXSA9IHNlbGYuSWQ7CgogICAgCiAgICAgICAgaWYgc2VsZi5hY3RpdmUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJhY3RpdmUiXSA9IHNlbGYuYWN0aXZlKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLmVuYWJsZWQoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJlbmFibGVkIl0gPSBzZWxmLmVuYWJsZWQoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYuY29kZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbImNvZGUiXSA9IHNlbGYuY29kZSgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5vcmRlcigpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbIm9yZGVyIl0gPSBzZWxmLm9yZGVyKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLmRhdGUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJkYXRlIl0gPSBzZWxmLmRhdGUoKTsKICAgICAgICAKICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShyZXRbImRhdGUiXSwgZGF0ZXRpbWUuZGF0ZXRpbWUpOgogICAgICAgICAgICAgICAgcmV0WyJkYXRlIl0gPSByZXRbImRhdGUiXS5pc29mb3JtYXQoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYubmFtZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbIm5hbWUiXSA9IHNlbGYubmFtZSgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5yZW1hcmsoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IHNlbGYucmVtYXJrKCk7CiAgICAgICAgCiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UocmV0WyJyZW1hcmsiXSwgZGljdCk6CiAgICAgICAgICAgICAgICByZXRbInJlbWFyayJdID0ganNvbi5kdW1wcyhyZXRbInJlbWFyayJdKS5lbmNvZGUoJ3V0Zi04Jyk7CgogICAgICAgICAgICByZXRbInJlbWFyayJdID0gIGJhc2U2NC5iNjRlbmNvZGUocmV0WyJyZW1hcmsiXSkuZGVjb2RlKCd1dGYtOCcpLnN0cmlwKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLnR5cGUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJ0eXBlIl0gPSBzZWxmLnR5cGUoKS5fdG9Eb2N1bWVudCgpOwogICAgICAgIAogICAgCiAgICAgICAgCiAgICAgICAgaWYgYkpTT04gaXMgbm90IE5vbmU6CiAgICAgICAgICAgICNwcmludChfX3RvU3RyaW5nICsgIkdPVCBIRVJFIiwgdHlwZShyZXQpLCByZXQpOwogICAgICAgICAgICByZXQgPSBqc29uLmR1bXBzKHJldCk7CiAgICAgICAgZ2MuY29sbGVjdCgpOwogICAgICAgIHJldHVybiByZXQ7CgogICAgCiAgICBkZWYgc3RvcmUoc2VsZiwgX19ldmVudD1Ob25lKToKICAgICAgICBfX3RvU3RyaW5nID0gJ1Rvb2w6OnN0b3JlKCk6ICc7CiAgICAgICAgCiAgICAgICAgZXZKU09OID0gTm9uZTsKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgZXZKU09OID0ganNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7CiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoKICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsKICAgICAgICAKCiAgICAgICAgYW5zd2VyID0gTm9uZTsKCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpbWUoKSkrJ10uVG9vbC5zdG9yZSgpJykubWV0aG9kKCdzdG9yZScpLmNsYXNzTmFtZSgnVG9vbCcpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOwogICAgICAgIAogICAgICAgIGdjLmNvbGxlY3QoKTsKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOwoKICAgICAgICAKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsKICAgICAgICAKICAgICAgICAgICAgYW5zd2VyID0gVG9vbCgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsKICAgICAgICAKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOwoKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOwogICAgICAgICAgICAKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOwoKICAgICAgICAgICAgCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOwogICAgICAgICAgICAKCiAgICAgICAgcmV0dXJuIGFuc3dlcjsKCiAgICAKICAgIGRlZiBmaW5kQWxsKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6CiAgICAgICAgX190b1N0cmluZyA9ICdUb29sOjpmaW5kQWxsKCk6ICc7CiAgICAgICAgCiAgICAgICAgZXZKU09OID0gTm9uZTsKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgZXZKU09OID0ganNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7CiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoKICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsKICAgICAgICAKCiAgICAgICAgYW5zd2VyID0gTm9uZTsKCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpbWUoKSkrJ10uVG9vbC5maW5kQWxsKCknKS5tZXRob2QoJ2ZpbmRBbGwnKS5jbGFzc05hbWUoJ1Rvb2wnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7CiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsKICAgICAgICAKICAgICAgICBnYy5jb2xsZWN0KCk7CgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsKCiAgICAgICAgCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7CiAgICAgICAgCiAgICAgICAgICAgIGFuc3dlciA9IFRvb2woKS5fZnJvbURvY3VtZW50KGV2SlNPTik7CiAgICAgICAgCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsKCgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsKCiAgICAgICAgICAgIAogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsKICAgICAgICAgICAgCgogICAgICAgIHJldHVybiBhbnN3ZXI7CgogICAgCiAgICBkZWYgZmluZChzZWxmLCBfX2V2ZW50PU5vbmUpOgogICAgICAgIF9fdG9TdHJpbmcgPSAnVG9vbDo6ZmluZCgpOiAnOwogICAgICAgIAogICAgICAgIGV2SlNPTiA9IE5vbmU7CgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIGV2SlNPTiA9IGpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOwogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046CiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7CiAgICAgICAgCgogICAgICAgIGFuc3dlciA9IE5vbmU7CgogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aW1lKCkpKyddLlRvb2wuZmluZCgpJykubWV0aG9kKCdmaW5kJykuY2xhc3NOYW1lKCdUb29sJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOwogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7CiAgICAgICAgCiAgICAgICAgZ2MuY29sbGVjdCgpOwoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7CgogICAgICAgIAogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOwogICAgICAgIAogICAgICAgICAgICBhbnN3ZXIgPSBUb29sKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOwogICAgICAgIAoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7CgoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOgogICAgICAgICAgICAKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7CgogICAgICAgICAgICAKICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7CiAgICAgICAgICAgIAoKICAgICAgICByZXR1cm4gYW5zd2VyOwoKICAgIAoKCmNsYXNzIENvbmZpZ19Hcm91cCgpOgogICAgZGVmIF9faW5pdF9fKHNlbGYsIElkPU5vbmUsIGFjdGl2ZT1Ob25lLCBlbmFibGVkPU5vbmUsIGNvZGU9Tm9uZSwgb3JkZXI9Tm9uZSwgZGF0ZT1Ob25lLCBuYW1lPU5vbmUsIHJlbWFyaz1Ob25lKToKICAgICAgICBzdXBlcigpLl9faW5pdF9fKCk7CgogICAgICAgICNwcmludCgnQ29uZmlnX0dyb3VwOjpfX2luaXRfXygpJyk7CiAgICAgICAgaWYgSWQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHNlbGYuSWQgPSBJZDsKCiAgICAgICAgCiAgICAgICAgc2VsZi5hY3RpdmUoYWN0aXZlKTsKICAgICAgICBzZWxmLmVuYWJsZWQoZW5hYmxlZCk7CiAgICAgICAgc2VsZi5jb2RlKGNvZGUpOwogICAgICAgIHNlbGYub3JkZXIob3JkZXIpOwogICAgICAgIHNlbGYuZGF0ZShkYXRlKTsKICAgICAgICBzZWxmLm5hbWUobmFtZSk7CiAgICAgICAgc2VsZi5yZW1hcmsocmVtYXJrKTsKICAgICAgICAKICAgIElkID0gTm9uZTsKICAgIAogICAgCiAgICAjIGFjdGl2ZTogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX2FjdGl2ZSA9IE5vbmU7CiAgICBkZWYgYWN0aXZlKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9hY3RpdmUgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fYWN0aXZlOwoKCiAgICAKICAgICMgZW5hYmxlZDogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX2VuYWJsZWQgPSBOb25lOwogICAgZGVmIGVuYWJsZWQoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2VuYWJsZWQgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fZW5hYmxlZDsKCgogICAgCiAgICAjIGNvZGU6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9jb2RlID0gTm9uZTsKICAgIGRlZiBjb2RlKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9jb2RlID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2NvZGU7CgoKICAgIAogICAgIyBvcmRlcjogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX29yZGVyID0gTm9uZTsKICAgIGRlZiBvcmRlcihzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fb3JkZXIgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fb3JkZXI7CgoKICAgIAogICAgIyBkYXRlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfZGF0ZSA9IE5vbmU7CiAgICBkZWYgZGF0ZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fZGF0ZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9kYXRlOwoKCiAgICAKICAgICMgbmFtZTogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX25hbWUgPSBOb25lOwogICAgZGVmIG5hbWUoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX25hbWUgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fbmFtZTsKCgogICAgCiAgICAjIHJlbWFyazogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX3JlbWFyayA9IE5vbmU7CiAgICBkZWYgcmVtYXJrKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9yZW1hcmsgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fcmVtYXJrOwoKCiAgICAKICAgIAogICAgZGVmIF9mcm9tRG9jdW1lbnQoc2VsZiwgb2JqKToKICAgICAgICBfX3RvU3RyaW5nID0gJ0NvbmZpZ19Hcm91cDo6X2Zyb21Eb2N1bWVudCgpOiAnOwogICAgICAgIAogICAgICAgIGlmIG9iaiBpcyBOb25lOgogICAgICAgICAgICByZXR1cm4gc2VsZjsKCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIGJ5dGVzKToKICAgICAgICAgICAgb2JqID0gc3RyKG9iaiwgInV0Zi04Iik7CiAgICAgICAgCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIHN0cikgb3IgdHlwZShvYmopIGlzIHN0cjoKICAgICAgICAgICAgaWYgcmUubWF0Y2gociIoKChbQS1aYS16XXszLDl9Oig/OlwvXC8pPykoPzpbLTs6Jj1cK1wkLFx3XStAKT9bQS1aYS16MC05Li1dK3woPzp3d3cufFstOzomPVwrXCQsXHddK0ApW0EtWmEtejAtOS4tXSspKCg/OlwvW1wrfiVcLy5cd1wtX10qKT9cPz8oPzpbLVwrPSY7JUAuXHdfXSopIz8oPzpbXHddKikpPykiLCBvYmopOgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIG9iaiA9IGpzb24ubG9hZHModXJsbGliMy5Qb29sTWFuYWdlcigpLnJlcXVlc3QoJ0dFVCcsIG9iaikuZGF0YS5kZWNvZGUoJ3V0Zi04JykpOwogICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgIG9iaiA9IHt9OwogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgb2JqID0ganNvbi5sb2FkcyhvYmopOwogICAgICAgIAogICAgICAgIGlmIG5vdCBpc2luc3RhbmNlKG9iaiwgKHN0ciwgYnl0ZXMsIGRpY3QpKToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICdHT1QgSEVSRTogJyArIHN0cih0eXBlKG9iaikpKTsKICAgICAgICAgICAgcmV0dXJuIG9iajsKCiAgICAgICAgICAgIGZvciBpIGluIG9iajoKICAgICAgICAgICAgICAgIG9ialtpXSA9IENvbmZpZ19Hcm91cCgpLl9mcm9tRG9jdW1lbnQob2JqW2ldKTsKICAgICAgICAgICAgcmV0dXJuIG9iajsKCgogICAgICAgIGlmICdJZCcgaW4gb2JqOgogICAgICAgICAgICBzZWxmLklkID0gb2JqWydJZCddOwoKICAgIAogICAgICAgIGlmICdhY3RpdmUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5hY3RpdmUob2JqWydhY3RpdmUnXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnZW5hYmxlZCcgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmVuYWJsZWQob2JqWydlbmFibGVkJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ2NvZGUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5jb2RlKG9ialsnY29kZSddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdvcmRlcicgaW4gb2JqOgogICAgICAgICAgICBzZWxmLm9yZGVyKG9ialsnb3JkZXInXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnZGF0ZScgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmRhdGUob2JqWydkYXRlJ10pOwogICAgICAgIAogICAgICAgICAgICBzZWxmLmRhdGUoZGF0ZXRpbWUuZGF0ZXRpbWUuZnJvbWlzb2Zvcm1hdChzZWxmLmRhdGUoKSkpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ25hbWUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5uYW1lKG9ialsnbmFtZSddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdyZW1hcmsnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5yZW1hcmsob2JqWydyZW1hcmsnXSk7CiAgICAgICAgCiAgICAgICAgICAgIHNlbGYucmVtYXJrKCBiYXNlNjQuYjY0ZGVjb2RlKHNlbGYucmVtYXJrKCkpICk7CiAgICAgICAgCiAgICAKCiAgICAgICAgZ2MuY29sbGVjdCgpOwogICAgICAgIHJldHVybiBzZWxmOwogICAgCiAgICBkZWYgX3RvRG9jdW1lbnQoc2VsZiwgYkpTT049Tm9uZSk6CiAgICAgICAgX190b1N0cmluZyA9ICdDb25maWdfR3JvdXA6Ol90b0RvY3VtZW50KCk6ICc7CgogICAgICAgIHJldCA9IHt9OwogICAgICAgIGlmIHNlbGYuSWQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiSWQiXSA9IHNlbGYuSWQ7CgogICAgCiAgICAgICAgaWYgc2VsZi5hY3RpdmUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJhY3RpdmUiXSA9IHNlbGYuYWN0aXZlKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLmVuYWJsZWQoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJlbmFibGVkIl0gPSBzZWxmLmVuYWJsZWQoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYuY29kZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbImNvZGUiXSA9IHNlbGYuY29kZSgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5vcmRlcigpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbIm9yZGVyIl0gPSBzZWxmLm9yZGVyKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLmRhdGUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJkYXRlIl0gPSBzZWxmLmRhdGUoKTsKICAgICAgICAKICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShyZXRbImRhdGUiXSwgZGF0ZXRpbWUuZGF0ZXRpbWUpOgogICAgICAgICAgICAgICAgcmV0WyJkYXRlIl0gPSByZXRbImRhdGUiXS5pc29mb3JtYXQoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYubmFtZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbIm5hbWUiXSA9IHNlbGYubmFtZSgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5yZW1hcmsoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IHNlbGYucmVtYXJrKCk7CiAgICAgICAgCiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UocmV0WyJyZW1hcmsiXSwgZGljdCk6CiAgICAgICAgICAgICAgICByZXRbInJlbWFyayJdID0ganNvbi5kdW1wcyhyZXRbInJlbWFyayJdKS5lbmNvZGUoJ3V0Zi04Jyk7CgogICAgICAgICAgICByZXRbInJlbWFyayJdID0gIGJhc2U2NC5iNjRlbmNvZGUocmV0WyJyZW1hcmsiXSkuZGVjb2RlKCd1dGYtOCcpLnN0cmlwKCk7CiAgICAgICAgCiAgICAKICAgICAgICAKICAgICAgICBpZiBiSlNPTiBpcyBub3QgTm9uZToKICAgICAgICAgICAgI3ByaW50KF9fdG9TdHJpbmcgKyAiR09UIEhFUkUiLCB0eXBlKHJldCksIHJldCk7CiAgICAgICAgICAgIHJldCA9IGpzb24uZHVtcHMocmV0KTsKICAgICAgICBnYy5jb2xsZWN0KCk7CiAgICAgICAgcmV0dXJuIHJldDsKCiAgICAKICAgIGRlZiBzdG9yZShzZWxmLCBfX2V2ZW50PU5vbmUpOgogICAgICAgIF9fdG9TdHJpbmcgPSAnQ29uZmlnX0dyb3VwOjpzdG9yZSgpOiAnOwogICAgICAgIAogICAgICAgIGV2SlNPTiA9IE5vbmU7CgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIGV2SlNPTiA9IGpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOwogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046CiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7CiAgICAgICAgCgogICAgICAgIGFuc3dlciA9IE5vbmU7CgogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aW1lKCkpKyddLkNvbmZpZ19Hcm91cC5zdG9yZSgpJykubWV0aG9kKCdzdG9yZScpLmNsYXNzTmFtZSgnQ29uZmlnX0dyb3VwJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOwogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7CiAgICAgICAgCiAgICAgICAgZ2MuY29sbGVjdCgpOwoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7CgogICAgICAgIAogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOwogICAgICAgIAogICAgICAgICAgICBhbnN3ZXIgPSBDb25maWdfR3JvdXAoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7CiAgICAgICAgCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsKCgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsKCiAgICAgICAgICAgIAogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsKICAgICAgICAgICAgCgogICAgICAgIHJldHVybiBhbnN3ZXI7CgogICAgCiAgICBkZWYgZmluZEFsbChzZWxmLCBfX2V2ZW50PU5vbmUpOgogICAgICAgIF9fdG9TdHJpbmcgPSAnQ29uZmlnX0dyb3VwOjpmaW5kQWxsKCk6ICc7CiAgICAgICAgCiAgICAgICAgZXZKU09OID0gTm9uZTsKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgZXZKU09OID0ganNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7CiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoKICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsKICAgICAgICAKCiAgICAgICAgYW5zd2VyID0gTm9uZTsKCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpbWUoKSkrJ10uQ29uZmlnX0dyb3VwLmZpbmRBbGwoKScpLm1ldGhvZCgnZmluZEFsbCcpLmNsYXNzTmFtZSgnQ29uZmlnX0dyb3VwJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOwogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7CiAgICAgICAgCiAgICAgICAgZ2MuY29sbGVjdCgpOwoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7CgogICAgICAgIAogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOwogICAgICAgIAogICAgICAgICAgICBhbnN3ZXIgPSBDb25maWdfR3JvdXAoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7CiAgICAgICAgCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsKCgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsKCiAgICAgICAgICAgIAogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsKICAgICAgICAgICAgCgogICAgICAgIHJldHVybiBhbnN3ZXI7CgogICAgCiAgICBkZWYgZmluZChzZWxmLCBfX2V2ZW50PU5vbmUpOgogICAgICAgIF9fdG9TdHJpbmcgPSAnQ29uZmlnX0dyb3VwOjpmaW5kKCk6ICc7CiAgICAgICAgCiAgICAgICAgZXZKU09OID0gTm9uZTsKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgZXZKU09OID0ganNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7CiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoKICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsKICAgICAgICAKCiAgICAgICAgYW5zd2VyID0gTm9uZTsKCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpbWUoKSkrJ10uQ29uZmlnX0dyb3VwLmZpbmQoKScpLm1ldGhvZCgnZmluZCcpLmNsYXNzTmFtZSgnQ29uZmlnX0dyb3VwJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOwogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7CiAgICAgICAgCiAgICAgICAgZ2MuY29sbGVjdCgpOwoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7CgogICAgICAgIAogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOwogICAgICAgIAogICAgICAgICAgICBhbnN3ZXIgPSBDb25maWdfR3JvdXAoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7CiAgICAgICAgCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsKCgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsKCiAgICAgICAgICAgIAogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsKICAgICAgICAgICAgCgogICAgICAgIHJldHVybiBhbnN3ZXI7CgogICAgCgoKY2xhc3MgTWFwcGluZ19Hcm91cCgpOgogICAgZGVmIF9faW5pdF9fKHNlbGYsIElkPU5vbmUsIGFjdGl2ZT1Ob25lLCBlbmFibGVkPU5vbmUsIGNvZGU9Tm9uZSwgb3JkZXI9Tm9uZSwgZGF0ZT1Ob25lLCBuYW1lPU5vbmUsIHJlbWFyaz1Ob25lKToKICAgICAgICBzdXBlcigpLl9faW5pdF9fKCk7CgogICAgICAgICNwcmludCgnTWFwcGluZ19Hcm91cDo6X19pbml0X18oKScpOwogICAgICAgIGlmIElkIGlzIG5vdCBOb25lOgogICAgICAgICAgICBzZWxmLklkID0gSWQ7CgogICAgICAgIAogICAgICAgIHNlbGYuYWN0aXZlKGFjdGl2ZSk7CiAgICAgICAgc2VsZi5lbmFibGVkKGVuYWJsZWQpOwogICAgICAgIHNlbGYuY29kZShjb2RlKTsKICAgICAgICBzZWxmLm9yZGVyKG9yZGVyKTsKICAgICAgICBzZWxmLmRhdGUoZGF0ZSk7CiAgICAgICAgc2VsZi5uYW1lKG5hbWUpOwogICAgICAgIHNlbGYucmVtYXJrKHJlbWFyayk7CiAgICAgICAgCiAgICBJZCA9IE5vbmU7CiAgICAKICAgIAogICAgIyBhY3RpdmU6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9hY3RpdmUgPSBOb25lOwogICAgZGVmIGFjdGl2ZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fYWN0aXZlID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2FjdGl2ZTsKCgogICAgCiAgICAjIGVuYWJsZWQ6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9lbmFibGVkID0gTm9uZTsKICAgIGRlZiBlbmFibGVkKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9lbmFibGVkID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2VuYWJsZWQ7CgoKICAgIAogICAgIyBjb2RlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfY29kZSA9IE5vbmU7CiAgICBkZWYgY29kZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fY29kZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9jb2RlOwoKCiAgICAKICAgICMgb3JkZXI6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9vcmRlciA9IE5vbmU7CiAgICBkZWYgb3JkZXIoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX29yZGVyID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX29yZGVyOwoKCiAgICAKICAgICMgZGF0ZTogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX2RhdGUgPSBOb25lOwogICAgZGVmIGRhdGUoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2RhdGUgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fZGF0ZTsKCgogICAgCiAgICAjIG5hbWU6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9uYW1lID0gTm9uZTsKICAgIGRlZiBuYW1lKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9uYW1lID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX25hbWU7CgoKICAgIAogICAgIyByZW1hcms6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9yZW1hcmsgPSBOb25lOwogICAgZGVmIHJlbWFyayhzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fcmVtYXJrID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3JlbWFyazsKCgogICAgCiAgICAKICAgIGRlZiBfZnJvbURvY3VtZW50KHNlbGYsIG9iaik6CiAgICAgICAgX190b1N0cmluZyA9ICdNYXBwaW5nX0dyb3VwOjpfZnJvbURvY3VtZW50KCk6ICc7CiAgICAgICAgCiAgICAgICAgaWYgb2JqIGlzIE5vbmU6CiAgICAgICAgICAgIHJldHVybiBzZWxmOwoKICAgICAgICBpZiBpc2luc3RhbmNlKG9iaiwgYnl0ZXMpOgogICAgICAgICAgICBvYmogPSBzdHIob2JqLCAidXRmLTgiKTsKICAgICAgICAKICAgICAgICBpZiBpc2luc3RhbmNlKG9iaiwgc3RyKSBvciB0eXBlKG9iaikgaXMgc3RyOgogICAgICAgICAgICBpZiByZS5tYXRjaChyIigoKFtBLVphLXpdezMsOX06KD86XC9cLyk/KSg/OlstOzomPVwrXCQsXHddK0ApP1tBLVphLXowLTkuLV0rfCg/Ond3dy58Wy07OiY9XCtcJCxcd10rQClbQS1aYS16MC05Li1dKykoKD86XC9bXCt+JVwvLlx3XC1fXSopP1w/Pyg/OlstXCs9JjslQC5cd19dKikjPyg/Oltcd10qKSk/KSIsIG9iaik6CiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgb2JqID0ganNvbi5sb2Fkcyh1cmxsaWIzLlBvb2xNYW5hZ2VyKCkucmVxdWVzdCgnR0VUJywgb2JqKS5kYXRhLmRlY29kZSgndXRmLTgnKSk7CiAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgb2JqID0ge307CiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBvYmogPSBqc29uLmxvYWRzKG9iaik7CiAgICAgICAgCiAgICAgICAgaWYgbm90IGlzaW5zdGFuY2Uob2JqLCAoc3RyLCBieXRlcywgZGljdCkpOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJ0dPVCBIRVJFOiAnICsgc3RyKHR5cGUob2JqKSkpOwogICAgICAgICAgICByZXR1cm4gb2JqOwoKICAgICAgICAgICAgZm9yIGkgaW4gb2JqOgogICAgICAgICAgICAgICAgb2JqW2ldID0gTWFwcGluZ19Hcm91cCgpLl9mcm9tRG9jdW1lbnQob2JqW2ldKTsKICAgICAgICAgICAgcmV0dXJuIG9iajsKCgogICAgICAgIGlmICdJZCcgaW4gb2JqOgogICAgICAgICAgICBzZWxmLklkID0gb2JqWydJZCddOwoKICAgIAogICAgICAgIGlmICdhY3RpdmUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5hY3RpdmUob2JqWydhY3RpdmUnXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnZW5hYmxlZCcgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmVuYWJsZWQob2JqWydlbmFibGVkJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ2NvZGUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5jb2RlKG9ialsnY29kZSddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdvcmRlcicgaW4gb2JqOgogICAgICAgICAgICBzZWxmLm9yZGVyKG9ialsnb3JkZXInXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnZGF0ZScgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmRhdGUob2JqWydkYXRlJ10pOwogICAgICAgIAogICAgICAgICAgICBzZWxmLmRhdGUoZGF0ZXRpbWUuZGF0ZXRpbWUuZnJvbWlzb2Zvcm1hdChzZWxmLmRhdGUoKSkpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ25hbWUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5uYW1lKG9ialsnbmFtZSddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdyZW1hcmsnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5yZW1hcmsob2JqWydyZW1hcmsnXSk7CiAgICAgICAgCiAgICAgICAgICAgIHNlbGYucmVtYXJrKCBiYXNlNjQuYjY0ZGVjb2RlKHNlbGYucmVtYXJrKCkpICk7CiAgICAgICAgCiAgICAKCiAgICAgICAgZ2MuY29sbGVjdCgpOwogICAgICAgIHJldHVybiBzZWxmOwogICAgCiAgICBkZWYgX3RvRG9jdW1lbnQoc2VsZiwgYkpTT049Tm9uZSk6CiAgICAgICAgX190b1N0cmluZyA9ICdNYXBwaW5nX0dyb3VwOjpfdG9Eb2N1bWVudCgpOiAnOwoKICAgICAgICByZXQgPSB7fTsKICAgICAgICBpZiBzZWxmLklkIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbIklkIl0gPSBzZWxmLklkOwoKICAgIAogICAgICAgIGlmIHNlbGYuYWN0aXZlKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiYWN0aXZlIl0gPSBzZWxmLmFjdGl2ZSgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5lbmFibGVkKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiZW5hYmxlZCJdID0gc2VsZi5lbmFibGVkKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLmNvZGUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJjb2RlIl0gPSBzZWxmLmNvZGUoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYub3JkZXIoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJvcmRlciJdID0gc2VsZi5vcmRlcigpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5kYXRlKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiZGF0ZSJdID0gc2VsZi5kYXRlKCk7CiAgICAgICAgCiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UocmV0WyJkYXRlIl0sIGRhdGV0aW1lLmRhdGV0aW1lKToKICAgICAgICAgICAgICAgIHJldFsiZGF0ZSJdID0gcmV0WyJkYXRlIl0uaXNvZm9ybWF0KCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLm5hbWUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJuYW1lIl0gPSBzZWxmLm5hbWUoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYucmVtYXJrKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSBzZWxmLnJlbWFyaygpOwogICAgICAgIAogICAgICAgICAgICBpZiBpc2luc3RhbmNlKHJldFsicmVtYXJrIl0sIGRpY3QpOgogICAgICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IGpzb24uZHVtcHMocmV0WyJyZW1hcmsiXSkuZW5jb2RlKCd1dGYtOCcpOwoKICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9ICBiYXNlNjQuYjY0ZW5jb2RlKHJldFsicmVtYXJrIl0pLmRlY29kZSgndXRmLTgnKS5zdHJpcCgpOwogICAgICAgIAogICAgCiAgICAgICAgCiAgICAgICAgaWYgYkpTT04gaXMgbm90IE5vbmU6CiAgICAgICAgICAgICNwcmludChfX3RvU3RyaW5nICsgIkdPVCBIRVJFIiwgdHlwZShyZXQpLCByZXQpOwogICAgICAgICAgICByZXQgPSBqc29uLmR1bXBzKHJldCk7CiAgICAgICAgZ2MuY29sbGVjdCgpOwogICAgICAgIHJldHVybiByZXQ7CgogICAgCiAgICBkZWYgc3RvcmUoc2VsZiwgX19ldmVudD1Ob25lKToKICAgICAgICBfX3RvU3RyaW5nID0gJ01hcHBpbmdfR3JvdXA6OnN0b3JlKCk6ICc7CiAgICAgICAgCiAgICAgICAgZXZKU09OID0gTm9uZTsKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgZXZKU09OID0ganNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7CiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoKICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsKICAgICAgICAKCiAgICAgICAgYW5zd2VyID0gTm9uZTsKCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpbWUoKSkrJ10uTWFwcGluZ19Hcm91cC5zdG9yZSgpJykubWV0aG9kKCdzdG9yZScpLmNsYXNzTmFtZSgnTWFwcGluZ19Hcm91cCcpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOwogICAgICAgIAogICAgICAgIGdjLmNvbGxlY3QoKTsKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOwoKICAgICAgICAKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsKICAgICAgICAKICAgICAgICAgICAgYW5zd2VyID0gTWFwcGluZ19Hcm91cCgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsKICAgICAgICAKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOwoKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOwogICAgICAgICAgICAKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOwoKICAgICAgICAgICAgCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOwogICAgICAgICAgICAKCiAgICAgICAgcmV0dXJuIGFuc3dlcjsKCiAgICAKICAgIGRlZiBmaW5kQWxsKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6CiAgICAgICAgX190b1N0cmluZyA9ICdNYXBwaW5nX0dyb3VwOjpmaW5kQWxsKCk6ICc7CiAgICAgICAgCiAgICAgICAgZXZKU09OID0gTm9uZTsKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgZXZKU09OID0ganNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7CiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoKICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsKICAgICAgICAKCiAgICAgICAgYW5zd2VyID0gTm9uZTsKCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpbWUoKSkrJ10uTWFwcGluZ19Hcm91cC5maW5kQWxsKCknKS5tZXRob2QoJ2ZpbmRBbGwnKS5jbGFzc05hbWUoJ01hcHBpbmdfR3JvdXAnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7CiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsKICAgICAgICAKICAgICAgICBnYy5jb2xsZWN0KCk7CgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsKCiAgICAgICAgCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7CiAgICAgICAgCiAgICAgICAgICAgIGFuc3dlciA9IE1hcHBpbmdfR3JvdXAoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7CiAgICAgICAgCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsKCgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsKCiAgICAgICAgICAgIAogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsKICAgICAgICAgICAgCgogICAgICAgIHJldHVybiBhbnN3ZXI7CgogICAgCiAgICBkZWYgZmluZChzZWxmLCBfX2V2ZW50PU5vbmUpOgogICAgICAgIF9fdG9TdHJpbmcgPSAnTWFwcGluZ19Hcm91cDo6ZmluZCgpOiAnOwogICAgICAgIAogICAgICAgIGV2SlNPTiA9IE5vbmU7CgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIGV2SlNPTiA9IGpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOwogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046CiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7CiAgICAgICAgCgogICAgICAgIGFuc3dlciA9IE5vbmU7CgogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aW1lKCkpKyddLk1hcHBpbmdfR3JvdXAuZmluZCgpJykubWV0aG9kKCdmaW5kJykuY2xhc3NOYW1lKCdNYXBwaW5nX0dyb3VwJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOwogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7CiAgICAgICAgCiAgICAgICAgZ2MuY29sbGVjdCgpOwoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7CgogICAgICAgIAogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOwogICAgICAgIAogICAgICAgICAgICBhbnN3ZXIgPSBNYXBwaW5nX0dyb3VwKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOwogICAgICAgIAoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7CgoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOgogICAgICAgICAgICAKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7CgogICAgICAgICAgICAKICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7CiAgICAgICAgICAgIAoKICAgICAgICByZXR1cm4gYW5zd2VyOwoKICAgIAoKCmNsYXNzIFRvb2xfVHlwZSgpOgogICAgZGVmIF9faW5pdF9fKHNlbGYsIElkPU5vbmUsIGFjdGl2ZT1Ob25lLCBlbmFibGVkPU5vbmUsIGNvZGU9Tm9uZSwgb3JkZXI9Tm9uZSwgZGF0ZT1Ob25lLCBuYW1lPU5vbmUsIHJlbWFyaz1Ob25lKToKICAgICAgICBzdXBlcigpLl9faW5pdF9fKCk7CgogICAgICAgICNwcmludCgnVG9vbF9UeXBlOjpfX2luaXRfXygpJyk7CiAgICAgICAgaWYgSWQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHNlbGYuSWQgPSBJZDsKCiAgICAgICAgCiAgICAgICAgc2VsZi5hY3RpdmUoYWN0aXZlKTsKICAgICAgICBzZWxmLmVuYWJsZWQoZW5hYmxlZCk7CiAgICAgICAgc2VsZi5jb2RlKGNvZGUpOwogICAgICAgIHNlbGYub3JkZXIob3JkZXIpOwogICAgICAgIHNlbGYuZGF0ZShkYXRlKTsKICAgICAgICBzZWxmLm5hbWUobmFtZSk7CiAgICAgICAgc2VsZi5yZW1hcmsocmVtYXJrKTsKICAgICAgICAKICAgIElkID0gTm9uZTsKICAgIAogICAgCiAgICAjIGFjdGl2ZTogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX2FjdGl2ZSA9IE5vbmU7CiAgICBkZWYgYWN0aXZlKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9hY3RpdmUgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fYWN0aXZlOwoKCiAgICAKICAgICMgZW5hYmxlZDogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX2VuYWJsZWQgPSBOb25lOwogICAgZGVmIGVuYWJsZWQoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2VuYWJsZWQgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fZW5hYmxlZDsKCgogICAgCiAgICAjIGNvZGU6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9jb2RlID0gTm9uZTsKICAgIGRlZiBjb2RlKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9jb2RlID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2NvZGU7CgoKICAgIAogICAgIyBvcmRlcjogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX29yZGVyID0gTm9uZTsKICAgIGRlZiBvcmRlcihzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fb3JkZXIgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fb3JkZXI7CgoKICAgIAogICAgIyBkYXRlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfZGF0ZSA9IE5vbmU7CiAgICBkZWYgZGF0ZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fZGF0ZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9kYXRlOwoKCiAgICAKICAgICMgbmFtZTogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX25hbWUgPSBOb25lOwogICAgZGVmIG5hbWUoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX25hbWUgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fbmFtZTsKCgogICAgCiAgICAjIHJlbWFyazogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX3JlbWFyayA9IE5vbmU7CiAgICBkZWYgcmVtYXJrKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9yZW1hcmsgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fcmVtYXJrOwoKCiAgICAKICAgIAogICAgZGVmIF9mcm9tRG9jdW1lbnQoc2VsZiwgb2JqKToKICAgICAgICBfX3RvU3RyaW5nID0gJ1Rvb2xfVHlwZTo6X2Zyb21Eb2N1bWVudCgpOiAnOwogICAgICAgIAogICAgICAgIGlmIG9iaiBpcyBOb25lOgogICAgICAgICAgICByZXR1cm4gc2VsZjsKCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIGJ5dGVzKToKICAgICAgICAgICAgb2JqID0gc3RyKG9iaiwgInV0Zi04Iik7CiAgICAgICAgCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIHN0cikgb3IgdHlwZShvYmopIGlzIHN0cjoKICAgICAgICAgICAgaWYgcmUubWF0Y2gociIoKChbQS1aYS16XXszLDl9Oig/OlwvXC8pPykoPzpbLTs6Jj1cK1wkLFx3XStAKT9bQS1aYS16MC05Li1dK3woPzp3d3cufFstOzomPVwrXCQsXHddK0ApW0EtWmEtejAtOS4tXSspKCg/OlwvW1wrfiVcLy5cd1wtX10qKT9cPz8oPzpbLVwrPSY7JUAuXHdfXSopIz8oPzpbXHddKikpPykiLCBvYmopOgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIG9iaiA9IGpzb24ubG9hZHModXJsbGliMy5Qb29sTWFuYWdlcigpLnJlcXVlc3QoJ0dFVCcsIG9iaikuZGF0YS5kZWNvZGUoJ3V0Zi04JykpOwogICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgIG9iaiA9IHt9OwogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgb2JqID0ganNvbi5sb2FkcyhvYmopOwogICAgICAgIAogICAgICAgIGlmIG5vdCBpc2luc3RhbmNlKG9iaiwgKHN0ciwgYnl0ZXMsIGRpY3QpKToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICdHT1QgSEVSRTogJyArIHN0cih0eXBlKG9iaikpKTsKICAgICAgICAgICAgcmV0dXJuIG9iajsKCiAgICAgICAgICAgIGZvciBpIGluIG9iajoKICAgICAgICAgICAgICAgIG9ialtpXSA9IFRvb2xfVHlwZSgpLl9mcm9tRG9jdW1lbnQob2JqW2ldKTsKICAgICAgICAgICAgcmV0dXJuIG9iajsKCgogICAgICAgIGlmICdJZCcgaW4gb2JqOgogICAgICAgICAgICBzZWxmLklkID0gb2JqWydJZCddOwoKICAgIAogICAgICAgIGlmICdhY3RpdmUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5hY3RpdmUob2JqWydhY3RpdmUnXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnZW5hYmxlZCcgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmVuYWJsZWQob2JqWydlbmFibGVkJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ2NvZGUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5jb2RlKG9ialsnY29kZSddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdvcmRlcicgaW4gb2JqOgogICAgICAgICAgICBzZWxmLm9yZGVyKG9ialsnb3JkZXInXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnZGF0ZScgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmRhdGUob2JqWydkYXRlJ10pOwogICAgICAgIAogICAgICAgICAgICBzZWxmLmRhdGUoZGF0ZXRpbWUuZGF0ZXRpbWUuZnJvbWlzb2Zvcm1hdChzZWxmLmRhdGUoKSkpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ25hbWUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5uYW1lKG9ialsnbmFtZSddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdyZW1hcmsnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5yZW1hcmsob2JqWydyZW1hcmsnXSk7CiAgICAgICAgCiAgICAgICAgICAgIHNlbGYucmVtYXJrKCBiYXNlNjQuYjY0ZGVjb2RlKHNlbGYucmVtYXJrKCkpICk7CiAgICAgICAgCiAgICAKCiAgICAgICAgZ2MuY29sbGVjdCgpOwogICAgICAgIHJldHVybiBzZWxmOwogICAgCiAgICBkZWYgX3RvRG9jdW1lbnQoc2VsZiwgYkpTT049Tm9uZSk6CiAgICAgICAgX190b1N0cmluZyA9ICdUb29sX1R5cGU6Ol90b0RvY3VtZW50KCk6ICc7CgogICAgICAgIHJldCA9IHt9OwogICAgICAgIGlmIHNlbGYuSWQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiSWQiXSA9IHNlbGYuSWQ7CgogICAgCiAgICAgICAgaWYgc2VsZi5hY3RpdmUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJhY3RpdmUiXSA9IHNlbGYuYWN0aXZlKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLmVuYWJsZWQoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJlbmFibGVkIl0gPSBzZWxmLmVuYWJsZWQoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYuY29kZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbImNvZGUiXSA9IHNlbGYuY29kZSgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5vcmRlcigpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbIm9yZGVyIl0gPSBzZWxmLm9yZGVyKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLmRhdGUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJkYXRlIl0gPSBzZWxmLmRhdGUoKTsKICAgICAgICAKICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShyZXRbImRhdGUiXSwgZGF0ZXRpbWUuZGF0ZXRpbWUpOgogICAgICAgICAgICAgICAgcmV0WyJkYXRlIl0gPSByZXRbImRhdGUiXS5pc29mb3JtYXQoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYubmFtZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbIm5hbWUiXSA9IHNlbGYubmFtZSgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5yZW1hcmsoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IHNlbGYucmVtYXJrKCk7CiAgICAgICAgCiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UocmV0WyJyZW1hcmsiXSwgZGljdCk6CiAgICAgICAgICAgICAgICByZXRbInJlbWFyayJdID0ganNvbi5kdW1wcyhyZXRbInJlbWFyayJdKS5lbmNvZGUoJ3V0Zi04Jyk7CgogICAgICAgICAgICByZXRbInJlbWFyayJdID0gIGJhc2U2NC5iNjRlbmNvZGUocmV0WyJyZW1hcmsiXSkuZGVjb2RlKCd1dGYtOCcpLnN0cmlwKCk7CiAgICAgICAgCiAgICAKICAgICAgICAKICAgICAgICBpZiBiSlNPTiBpcyBub3QgTm9uZToKICAgICAgICAgICAgI3ByaW50KF9fdG9TdHJpbmcgKyAiR09UIEhFUkUiLCB0eXBlKHJldCksIHJldCk7CiAgICAgICAgICAgIHJldCA9IGpzb24uZHVtcHMocmV0KTsKICAgICAgICBnYy5jb2xsZWN0KCk7CiAgICAgICAgcmV0dXJuIHJldDsKCiAgICAKICAgIGRlZiBzdG9yZShzZWxmLCBfX2V2ZW50PU5vbmUpOgogICAgICAgIF9fdG9TdHJpbmcgPSAnVG9vbF9UeXBlOjpzdG9yZSgpOiAnOwogICAgICAgIAogICAgICAgIGV2SlNPTiA9IE5vbmU7CgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIGV2SlNPTiA9IGpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOwogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046CiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7CiAgICAgICAgCgogICAgICAgIGFuc3dlciA9IE5vbmU7CgogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aW1lKCkpKyddLlRvb2xfVHlwZS5zdG9yZSgpJykubWV0aG9kKCdzdG9yZScpLmNsYXNzTmFtZSgnVG9vbF9UeXBlJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOwogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7CiAgICAgICAgCiAgICAgICAgZ2MuY29sbGVjdCgpOwoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7CgogICAgICAgIAogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOwogICAgICAgIAogICAgICAgICAgICBhbnN3ZXIgPSBUb29sX1R5cGUoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7CiAgICAgICAgCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsKCgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsKCiAgICAgICAgICAgIAogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsKICAgICAgICAgICAgCgogICAgICAgIHJldHVybiBhbnN3ZXI7CgogICAgCiAgICBkZWYgZmluZEFsbChzZWxmLCBfX2V2ZW50PU5vbmUpOgogICAgICAgIF9fdG9TdHJpbmcgPSAnVG9vbF9UeXBlOjpmaW5kQWxsKCk6ICc7CiAgICAgICAgCiAgICAgICAgZXZKU09OID0gTm9uZTsKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgZXZKU09OID0ganNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7CiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoKICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsKICAgICAgICAKCiAgICAgICAgYW5zd2VyID0gTm9uZTsKCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpbWUoKSkrJ10uVG9vbF9UeXBlLmZpbmRBbGwoKScpLm1ldGhvZCgnZmluZEFsbCcpLmNsYXNzTmFtZSgnVG9vbF9UeXBlJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOwogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7CiAgICAgICAgCiAgICAgICAgZ2MuY29sbGVjdCgpOwoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7CgogICAgICAgIAogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOwogICAgICAgIAogICAgICAgICAgICBhbnN3ZXIgPSBUb29sX1R5cGUoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7CiAgICAgICAgCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsKCgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsKCiAgICAgICAgICAgIAogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsKICAgICAgICAgICAgCgogICAgICAgIHJldHVybiBhbnN3ZXI7CgogICAgCiAgICBkZWYgZmluZChzZWxmLCBfX2V2ZW50PU5vbmUpOgogICAgICAgIF9fdG9TdHJpbmcgPSAnVG9vbF9UeXBlOjpmaW5kKCk6ICc7CiAgICAgICAgCiAgICAgICAgZXZKU09OID0gTm9uZTsKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgZXZKU09OID0ganNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7CiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoKICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsKICAgICAgICAKCiAgICAgICAgYW5zd2VyID0gTm9uZTsKCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpbWUoKSkrJ10uVG9vbF9UeXBlLmZpbmQoKScpLm1ldGhvZCgnZmluZCcpLmNsYXNzTmFtZSgnVG9vbF9UeXBlJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOwogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7CiAgICAgICAgCiAgICAgICAgZ2MuY29sbGVjdCgpOwoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7CgogICAgICAgIAogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOwogICAgICAgIAogICAgICAgICAgICBhbnN3ZXIgPSBUb29sX1R5cGUoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7CiAgICAgICAgCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsKCgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsKCiAgICAgICAgICAgIAogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsKICAgICAgICAgICAgCgogICAgICAgIHJldHVybiBhbnN3ZXI7CgogICAgCgoKY2xhc3MgRXZlbnQoKToKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBJZD1Ob25lLCBhY3RpdmU9Tm9uZSwgZW5hYmxlZD1Ob25lLCBjb2RlPU5vbmUsIG9yZGVyPU5vbmUsIGRhdGU9Tm9uZSwgbmFtZT1Ob25lLCByZW1hcms9Tm9uZSwgY2xhc3NOYW1lPU5vbmUsIG1ldGhvZD1Ob25lLCBwYXlsb2FkPU5vbmUsIGNhcnJpZXI9Tm9uZSwgc2VuZGVyPU5vbmUsIHJlY2lwaWVudD1Ob25lLCByZXNwb25zZVRvPU5vbmUpOgogICAgICAgIHN1cGVyKCkuX19pbml0X18oKTsKCiAgICAgICAgI3ByaW50KCdFdmVudDo6X19pbml0X18oKScpOwogICAgICAgIGlmIElkIGlzIG5vdCBOb25lOgogICAgICAgICAgICBzZWxmLklkID0gSWQ7CgogICAgICAgIAogICAgICAgIHNlbGYuYWN0aXZlKGFjdGl2ZSk7CiAgICAgICAgc2VsZi5lbmFibGVkKGVuYWJsZWQpOwogICAgICAgIHNlbGYuY29kZShjb2RlKTsKICAgICAgICBzZWxmLm9yZGVyKG9yZGVyKTsKICAgICAgICBzZWxmLmRhdGUoZGF0ZSk7CiAgICAgICAgc2VsZi5uYW1lKG5hbWUpOwogICAgICAgIHNlbGYucmVtYXJrKHJlbWFyayk7CiAgICAgICAgc2VsZi5jbGFzc05hbWUoY2xhc3NOYW1lKTsKICAgICAgICBzZWxmLm1ldGhvZChtZXRob2QpOwogICAgICAgIHNlbGYucGF5bG9hZChwYXlsb2FkKTsKICAgICAgICBzZWxmLmNhcnJpZXIoY2Fycmllcik7CiAgICAgICAgc2VsZi5zZW5kZXIoc2VuZGVyKTsKICAgICAgICBzZWxmLnJlY2lwaWVudChyZWNpcGllbnQpOwogICAgICAgIHNlbGYucmVzcG9uc2VUbyhyZXNwb25zZVRvKTsKICAgICAgICAKICAgIElkID0gTm9uZTsKICAgIAogICAgCiAgICAjIGFjdGl2ZTogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX2FjdGl2ZSA9IE5vbmU7CiAgICBkZWYgYWN0aXZlKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9hY3RpdmUgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fYWN0aXZlOwoKCiAgICAKICAgICMgZW5hYmxlZDogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX2VuYWJsZWQgPSBOb25lOwogICAgZGVmIGVuYWJsZWQoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2VuYWJsZWQgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fZW5hYmxlZDsKCgogICAgCiAgICAjIGNvZGU6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9jb2RlID0gTm9uZTsKICAgIGRlZiBjb2RlKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9jb2RlID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2NvZGU7CgoKICAgIAogICAgIyBvcmRlcjogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX29yZGVyID0gTm9uZTsKICAgIGRlZiBvcmRlcihzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fb3JkZXIgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fb3JkZXI7CgoKICAgIAogICAgIyBkYXRlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfZGF0ZSA9IE5vbmU7CiAgICBkZWYgZGF0ZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fZGF0ZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9kYXRlOwoKCiAgICAKICAgICMgbmFtZTogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX25hbWUgPSBOb25lOwogICAgZGVmIG5hbWUoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX25hbWUgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fbmFtZTsKCgogICAgCiAgICAjIHJlbWFyazogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX3JlbWFyayA9IE5vbmU7CiAgICBkZWYgcmVtYXJrKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9yZW1hcmsgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fcmVtYXJrOwoKCiAgICAKICAgICMgY2xhc3NOYW1lOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfY2xhc3NOYW1lID0gTm9uZTsKICAgIGRlZiBjbGFzc05hbWUoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2NsYXNzTmFtZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9jbGFzc05hbWU7CgoKICAgIAogICAgIyBtZXRob2Q6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9tZXRob2QgPSBOb25lOwogICAgZGVmIG1ldGhvZChzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fbWV0aG9kID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX21ldGhvZDsKCgogICAgCiAgICAjIHBheWxvYWQ6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9wYXlsb2FkID0gTm9uZTsKICAgIGRlZiBwYXlsb2FkKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9wYXlsb2FkID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3BheWxvYWQ7CgoKICAgIAogICAgIyBjYXJyaWVyOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfY2FycmllciA9IE5vbmU7CiAgICBkZWYgY2FycmllcihzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fY2FycmllciA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9jYXJyaWVyOwoKCiAgICAKICAgICMgc2VuZGVyOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfc2VuZGVyID0gTm9uZTsKICAgIGRlZiBzZW5kZXIoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX3NlbmRlciA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9zZW5kZXI7CgoKICAgIAogICAgIyByZWNpcGllbnQ6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9yZWNpcGllbnQgPSBOb25lOwogICAgZGVmIHJlY2lwaWVudChzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fcmVjaXBpZW50ID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3JlY2lwaWVudDsKCgogICAgCiAgICAjIHJlc3BvbnNlVG86IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9yZXNwb25zZVRvID0gTm9uZTsKICAgIGRlZiByZXNwb25zZVRvKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9yZXNwb25zZVRvID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3Jlc3BvbnNlVG87CgoKICAgIAogICAgCiAgICBkZWYgX2Zyb21Eb2N1bWVudChzZWxmLCBvYmopOgogICAgICAgIF9fdG9TdHJpbmcgPSAnRXZlbnQ6Ol9mcm9tRG9jdW1lbnQoKTogJzsKICAgICAgICAKICAgICAgICBpZiBvYmogaXMgTm9uZToKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CgogICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLCBieXRlcyk6CiAgICAgICAgICAgIG9iaiA9IHN0cihvYmosICJ1dGYtOCIpOwogICAgICAgIAogICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLCBzdHIpIG9yIHR5cGUob2JqKSBpcyBzdHI6CiAgICAgICAgICAgIGlmIHJlLm1hdGNoKHIiKCgoW0EtWmEtel17Myw5fTooPzpcL1wvKT8pKD86Wy07OiY9XCtcJCxcd10rQCk/W0EtWmEtejAtOS4tXSt8KD86d3d3LnxbLTs6Jj1cK1wkLFx3XStAKVtBLVphLXowLTkuLV0rKSgoPzpcL1tcK34lXC8uXHdcLV9dKik/XD8/KD86Wy1cKz0mOyVALlx3X10qKSM/KD86W1x3XSopKT8pIiwgb2JqKToKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBvYmogPSBqc29uLmxvYWRzKHVybGxpYjMuUG9vbE1hbmFnZXIoKS5yZXF1ZXN0KCdHRVQnLCBvYmopLmRhdGEuZGVjb2RlKCd1dGYtOCcpKTsKICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICBvYmogPSB7fTsKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIG9iaiA9IGpzb24ubG9hZHMob2JqKTsKICAgICAgICAKICAgICAgICBpZiBub3QgaXNpbnN0YW5jZShvYmosIChzdHIsIGJ5dGVzLCBkaWN0KSk6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnR09UIEhFUkU6ICcgKyBzdHIodHlwZShvYmopKSk7CiAgICAgICAgICAgIHJldHVybiBvYmo7CgogICAgICAgICAgICBmb3IgaSBpbiBvYmo6CiAgICAgICAgICAgICAgICBvYmpbaV0gPSBFdmVudCgpLl9mcm9tRG9jdW1lbnQob2JqW2ldKTsKICAgICAgICAgICAgcmV0dXJuIG9iajsKCgogICAgICAgIGlmICdJZCcgaW4gb2JqOgogICAgICAgICAgICBzZWxmLklkID0gb2JqWydJZCddOwoKICAgIAogICAgICAgIGlmICdhY3RpdmUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5hY3RpdmUob2JqWydhY3RpdmUnXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnZW5hYmxlZCcgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmVuYWJsZWQob2JqWydlbmFibGVkJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ2NvZGUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5jb2RlKG9ialsnY29kZSddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdvcmRlcicgaW4gb2JqOgogICAgICAgICAgICBzZWxmLm9yZGVyKG9ialsnb3JkZXInXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnZGF0ZScgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmRhdGUob2JqWydkYXRlJ10pOwogICAgICAgIAogICAgICAgICAgICBzZWxmLmRhdGUoZGF0ZXRpbWUuZGF0ZXRpbWUuZnJvbWlzb2Zvcm1hdChzZWxmLmRhdGUoKSkpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ25hbWUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5uYW1lKG9ialsnbmFtZSddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdyZW1hcmsnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5yZW1hcmsob2JqWydyZW1hcmsnXSk7CiAgICAgICAgCiAgICAgICAgICAgIHNlbGYucmVtYXJrKCBiYXNlNjQuYjY0ZGVjb2RlKHNlbGYucmVtYXJrKCkpICk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnY2xhc3NOYW1lJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuY2xhc3NOYW1lKG9ialsnY2xhc3NOYW1lJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ21ldGhvZCcgaW4gb2JqOgogICAgICAgICAgICBzZWxmLm1ldGhvZChvYmpbJ21ldGhvZCddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdwYXlsb2FkJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYucGF5bG9hZChvYmpbJ3BheWxvYWQnXSk7CiAgICAgICAgCiAgICAgICAgICAgIHNlbGYucGF5bG9hZCggYmFzZTY0LmI2NGRlY29kZShzZWxmLnBheWxvYWQoKSkgKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdjYXJyaWVyJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuY2FycmllcihOb2RlKCkuX2Zyb21Eb2N1bWVudChvYmpbJ2NhcnJpZXInXSkpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ3NlbmRlcicgaW4gb2JqOgogICAgICAgICAgICBzZWxmLnNlbmRlcihOb2RlKCkuX2Zyb21Eb2N1bWVudChvYmpbJ3NlbmRlciddKSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAncmVjaXBpZW50JyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYucmVjaXBpZW50KE5vZGUoKS5fZnJvbURvY3VtZW50KG9ialsncmVjaXBpZW50J10pKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdyZXNwb25zZVRvJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYucmVzcG9uc2VUbyhFdmVudCgpLl9mcm9tRG9jdW1lbnQob2JqWydyZXNwb25zZVRvJ10pKTsKICAgICAgICAKICAgIAoKICAgICAgICBnYy5jb2xsZWN0KCk7CiAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAKICAgIGRlZiBfdG9Eb2N1bWVudChzZWxmLCBiSlNPTj1Ob25lKToKICAgICAgICBfX3RvU3RyaW5nID0gJ0V2ZW50OjpfdG9Eb2N1bWVudCgpOiAnOwoKICAgICAgICByZXQgPSB7fTsKICAgICAgICBpZiBzZWxmLklkIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbIklkIl0gPSBzZWxmLklkOwoKICAgIAogICAgICAgIGlmIHNlbGYuYWN0aXZlKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiYWN0aXZlIl0gPSBzZWxmLmFjdGl2ZSgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5lbmFibGVkKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiZW5hYmxlZCJdID0gc2VsZi5lbmFibGVkKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLmNvZGUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJjb2RlIl0gPSBzZWxmLmNvZGUoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYub3JkZXIoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJvcmRlciJdID0gc2VsZi5vcmRlcigpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5kYXRlKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiZGF0ZSJdID0gc2VsZi5kYXRlKCk7CiAgICAgICAgCiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UocmV0WyJkYXRlIl0sIGRhdGV0aW1lLmRhdGV0aW1lKToKICAgICAgICAgICAgICAgIHJldFsiZGF0ZSJdID0gcmV0WyJkYXRlIl0uaXNvZm9ybWF0KCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLm5hbWUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJuYW1lIl0gPSBzZWxmLm5hbWUoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYucmVtYXJrKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSBzZWxmLnJlbWFyaygpOwogICAgICAgIAogICAgICAgICAgICBpZiBpc2luc3RhbmNlKHJldFsicmVtYXJrIl0sIGRpY3QpOgogICAgICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IGpzb24uZHVtcHMocmV0WyJyZW1hcmsiXSkuZW5jb2RlKCd1dGYtOCcpOwoKICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9ICBiYXNlNjQuYjY0ZW5jb2RlKHJldFsicmVtYXJrIl0pLmRlY29kZSgndXRmLTgnKS5zdHJpcCgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5jbGFzc05hbWUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJjbGFzc05hbWUiXSA9IHNlbGYuY2xhc3NOYW1lKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLm1ldGhvZCgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbIm1ldGhvZCJdID0gc2VsZi5tZXRob2QoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYucGF5bG9hZCgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbInBheWxvYWQiXSA9IHNlbGYucGF5bG9hZCgpOwogICAgICAgIAogICAgICAgICAgICBpZiBpc2luc3RhbmNlKHJldFsicGF5bG9hZCJdLCBkaWN0KToKICAgICAgICAgICAgICAgIHJldFsicGF5bG9hZCJdID0ganNvbi5kdW1wcyhyZXRbInBheWxvYWQiXSkuZW5jb2RlKCd1dGYtOCcpOwoKICAgICAgICAgICAgcmV0WyJwYXlsb2FkIl0gPSAgYmFzZTY0LmI2NGVuY29kZShyZXRbInBheWxvYWQiXSkuZGVjb2RlKCd1dGYtOCcpLnN0cmlwKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLmNhcnJpZXIoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJjYXJyaWVyIl0gPSBzZWxmLmNhcnJpZXIoKS5fdG9Eb2N1bWVudCgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5zZW5kZXIoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJzZW5kZXIiXSA9IHNlbGYuc2VuZGVyKCkuX3RvRG9jdW1lbnQoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYucmVjaXBpZW50KCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsicmVjaXBpZW50Il0gPSBzZWxmLnJlY2lwaWVudCgpLl90b0RvY3VtZW50KCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJyZXNwb25zZVRvIl0gPSBzZWxmLnJlc3BvbnNlVG8oKS5fdG9Eb2N1bWVudCgpOwogICAgICAgIAogICAgCiAgICAgICAgCiAgICAgICAgaWYgYkpTT04gaXMgbm90IE5vbmU6CiAgICAgICAgICAgICNwcmludChfX3RvU3RyaW5nICsgIkdPVCBIRVJFIiwgdHlwZShyZXQpLCByZXQpOwogICAgICAgICAgICByZXQgPSBqc29uLmR1bXBzKHJldCk7CiAgICAgICAgZ2MuY29sbGVjdCgpOwogICAgICAgIHJldHVybiByZXQ7CgogICAgCiAgICBkZWYgc3RvcmUoc2VsZiwgX19ldmVudD1Ob25lKToKICAgICAgICBfX3RvU3RyaW5nID0gJ0V2ZW50OjpzdG9yZSgpOiAnOwogICAgICAgIAogICAgICAgIGV2SlNPTiA9IE5vbmU7CgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIGV2SlNPTiA9IGpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOwogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046CiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7CiAgICAgICAgCgogICAgICAgIGFuc3dlciA9IE5vbmU7CgogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aW1lKCkpKyddLkV2ZW50LnN0b3JlKCknKS5tZXRob2QoJ3N0b3JlJykuY2xhc3NOYW1lKCdFdmVudCcpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOwogICAgICAgIAogICAgICAgIGdjLmNvbGxlY3QoKTsKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOwoKICAgICAgICAKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsKICAgICAgICAKICAgICAgICAgICAgYW5zd2VyID0gRXZlbnQoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7CiAgICAgICAgCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsKCgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsKCiAgICAgICAgICAgIAogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsKICAgICAgICAgICAgCgogICAgICAgIHJldHVybiBhbnN3ZXI7CgogICAgCiAgICBkZWYgZmluZEFsbChzZWxmLCBfX2V2ZW50PU5vbmUpOgogICAgICAgIF9fdG9TdHJpbmcgPSAnRXZlbnQ6OmZpbmRBbGwoKTogJzsKICAgICAgICAKICAgICAgICBldkpTT04gPSBOb25lOwoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBldkpTT04gPSBqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsKICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOgogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOwogICAgICAgIAoKICAgICAgICBhbnN3ZXIgPSBOb25lOwoKICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGltZSgpKSsnXS5FdmVudC5maW5kQWxsKCknKS5tZXRob2QoJ2ZpbmRBbGwnKS5jbGFzc05hbWUoJ0V2ZW50JykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOwogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7CiAgICAgICAgCiAgICAgICAgZ2MuY29sbGVjdCgpOwoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7CgogICAgICAgIAogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOwogICAgICAgIAogICAgICAgICAgICBhbnN3ZXIgPSBFdmVudCgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsKICAgICAgICAKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOwoKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOwogICAgICAgICAgICAKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOwoKICAgICAgICAgICAgCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOwogICAgICAgICAgICAKCiAgICAgICAgcmV0dXJuIGFuc3dlcjsKCiAgICAKICAgIGRlZiBmaW5kKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6CiAgICAgICAgX190b1N0cmluZyA9ICdFdmVudDo6ZmluZCgpOiAnOwogICAgICAgIAogICAgICAgIGV2SlNPTiA9IE5vbmU7CgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIGV2SlNPTiA9IGpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOwogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046CiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7CiAgICAgICAgCgogICAgICAgIGFuc3dlciA9IE5vbmU7CgogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aW1lKCkpKyddLkV2ZW50LmZpbmQoKScpLm1ldGhvZCgnZmluZCcpLmNsYXNzTmFtZSgnRXZlbnQnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7CiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsKICAgICAgICAKICAgICAgICBnYy5jb2xsZWN0KCk7CgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsKCiAgICAgICAgCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7CiAgICAgICAgCiAgICAgICAgICAgIGFuc3dlciA9IEV2ZW50KCkuX2Zyb21Eb2N1bWVudChldkpTT04pOwogICAgICAgIAoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7CgoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOgogICAgICAgICAgICAKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7CgogICAgICAgICAgICAKICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7CiAgICAgICAgICAgIAoKICAgICAgICByZXR1cm4gYW5zd2VyOwoKICAgIAogICAgZGVmIGxpc3RlbihzZWxmLCBfX2V2ZW50PU5vbmUsIG5vZGU9Tm9uZSk6CiAgICAgICAgX190b1N0cmluZyA9ICdFdmVudDo6bGlzdGVuKCk6ICc7CiAgICAgICAgCiAgICAgICAgZXZKU09OID0gTm9uZTsKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgZXZKU09OID0ganNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7CiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoKICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsKICAgICAgICAKICAgICAgICAgICAgaWYgJ25vZGUnIGluIGV2SlNPTjoKICAgICAgICAgICAgICAgIG5vZGUgPSBldkpTT05bJ25vZGUnXTsKICAgICAgICAKCiAgICAgICAgYW5zd2VyID0gTm9uZTsKCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpbWUoKSkrJ10uRXZlbnQubGlzdGVuKCknKS5tZXRob2QoJ2xpc3RlbicpLmNsYXNzTmFtZSgnRXZlbnQnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7CiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsKICAgICAgICAKICAgICAgICBnYy5jb2xsZWN0KCk7CgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsKCiAgICAgICAgCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7CiAgICAgICAgCiAgICAgICAgICAgIGFuc3dlciA9IGV2SlNPTjsKICAgICAgICAKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOwoKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoc3RyKGFuc3dlcikpOwogICAgICAgICAgICAKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOwoKICAgICAgICAgICAgCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOwogICAgICAgICAgICAKCiAgICAgICAgcmV0dXJuIGFuc3dlcjsKCiAgICAKICAgIGRlZiB0cmlnZ2VyKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6CiAgICAgICAgX190b1N0cmluZyA9ICdFdmVudDo6dHJpZ2dlcigpOiAnOwogICAgICAgIAogICAgICAgIGV2SlNPTiA9IE5vbmU7CgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIGV2SlNPTiA9IGpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOwogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046CiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7CiAgICAgICAgCgogICAgICAgIGFuc3dlciA9IE5vbmU7CgogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aW1lKCkpKyddLkV2ZW50LnRyaWdnZXIoKScpLm1ldGhvZCgndHJpZ2dlcicpLmNsYXNzTmFtZSgnRXZlbnQnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7CiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsKICAgICAgICAKICAgICAgICBnYy5jb2xsZWN0KCk7CgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsKCiAgICAgICAgCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7CiAgICAgICAgCiAgICAgICAgICAgIGFuc3dlciA9IGV2SlNPTjsKICAgICAgICAKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOwoKICAgICAgICAgICAgcmV0dXJuIG1xdHRfY2xpZW50LnB1Ymxpc2gobXF0dF90b3BpYywgc2VsZi5fdG9Eb2N1bWVudChUcnVlKSk7CiAgICAgICAgCgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHN0cihhbnN3ZXIpKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsKCiAgICAgICAgICAgIAoKICAgICAgICByZXR1cm4gYW5zd2VyOwoKICAgIAogICAgZGVmIHByb2Nlc3Moc2VsZiwgX19ldmVudD1Ob25lKToKICAgICAgICBfX3RvU3RyaW5nID0gJ0V2ZW50Ojpwcm9jZXNzKCk6ICc7CiAgICAgICAgCiAgICAgICAgZXZKU09OID0gTm9uZTsKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgZXZKU09OID0ganNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7CiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoKICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsKICAgICAgICAKCiAgICAgICAgYW5zd2VyID0gTm9uZTsKCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpbWUoKSkrJ10uRXZlbnQucHJvY2VzcygpJykubWV0aG9kKCdwcm9jZXNzJykuY2xhc3NOYW1lKCdFdmVudCcpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOwogICAgICAgIAogICAgICAgIGdjLmNvbGxlY3QoKTsKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOwoKICAgICAgICAKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsKICAgICAgICAKICAgICAgICAgICAgYW5zd2VyID0gRXZlbnQoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7CiAgICAgICAgCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsKCiAgICAgICAgICAgIGlmIHNlbGYuc2VuZGVyKCkuY29kZSgpPT1ub2RlLmNvZGUoKToKICAgICAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiaWdub3JpbmcgbXkgZXZlbnRzIik7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIGVsaWYgc2VsZi5yZWNpcGllbnQoKS5jb2RlKCkhPW5vZGUuY29kZSgpOgogICAgICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJub3Qgc2VudCB0byBtZSIpOwogICAgICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAgICAgcmV0dXJuIGdldGF0dHIoZ2xvYmFscygpW3NlbGYuY2xhc3NOYW1lKCldKCksIHNlbGYubWV0aG9kKCkpKHNlbGYpOwogICAgICAgIAoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOgogICAgICAgICAgICAKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7CgogICAgICAgICAgICAKICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7CiAgICAgICAgICAgIAoKICAgICAgICByZXR1cm4gYW5zd2VyOwoKICAgIAoKCmNsYXNzIE5vZGUoKToKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBJZD1Ob25lLCBhY3RpdmU9Tm9uZSwgZW5hYmxlZD1Ob25lLCBjb2RlPU5vbmUsIG9yZGVyPU5vbmUsIGRhdGU9Tm9uZSwgbmFtZT1Ob25lLCByZW1hcms9Tm9uZSwgYWRkcmVzcz1Ob25lLCBiYWNrdXA9Tm9uZSwgcGFyZW50PU5vbmUsIGdyb3VwPU5vbmUsIGNvbnRleHQ9Tm9uZSwgcG9ydD1Ob25lLCBvbmxpbmU9Tm9uZSwgc2VjdXJlPU5vbmUsIHR5cGU9Tm9uZSk6CiAgICAgICAgc3VwZXIoKS5fX2luaXRfXygpOwoKICAgICAgICAjcHJpbnQoJ05vZGU6Ol9faW5pdF9fKCknKTsKICAgICAgICBpZiBJZCBpcyBub3QgTm9uZToKICAgICAgICAgICAgc2VsZi5JZCA9IElkOwoKICAgICAgICAKICAgICAgICBzZWxmLmFjdGl2ZShhY3RpdmUpOwogICAgICAgIHNlbGYuZW5hYmxlZChlbmFibGVkKTsKICAgICAgICBzZWxmLmNvZGUoY29kZSk7CiAgICAgICAgc2VsZi5vcmRlcihvcmRlcik7CiAgICAgICAgc2VsZi5kYXRlKGRhdGUpOwogICAgICAgIHNlbGYubmFtZShuYW1lKTsKICAgICAgICBzZWxmLnJlbWFyayhyZW1hcmspOwogICAgICAgIHNlbGYuYWRkcmVzcyhhZGRyZXNzKTsKICAgICAgICBzZWxmLmJhY2t1cChiYWNrdXApOwogICAgICAgIHNlbGYucGFyZW50KHBhcmVudCk7CiAgICAgICAgc2VsZi5ncm91cChncm91cCk7CiAgICAgICAgc2VsZi5jb250ZXh0KGNvbnRleHQpOwogICAgICAgIHNlbGYucG9ydChwb3J0KTsKICAgICAgICBzZWxmLm9ubGluZShvbmxpbmUpOwogICAgICAgIHNlbGYuc2VjdXJlKHNlY3VyZSk7CiAgICAgICAgc2VsZi50eXBlKHR5cGUpOwogICAgICAgIAogICAgSWQgPSBOb25lOwogICAgCiAgICAKICAgICMgYWN0aXZlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfYWN0aXZlID0gTm9uZTsKICAgIGRlZiBhY3RpdmUoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2FjdGl2ZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9hY3RpdmU7CgoKICAgIAogICAgIyBlbmFibGVkOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfZW5hYmxlZCA9IE5vbmU7CiAgICBkZWYgZW5hYmxlZChzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fZW5hYmxlZCA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9lbmFibGVkOwoKCiAgICAKICAgICMgY29kZTogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX2NvZGUgPSBOb25lOwogICAgZGVmIGNvZGUoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2NvZGUgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fY29kZTsKCgogICAgCiAgICAjIG9yZGVyOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfb3JkZXIgPSBOb25lOwogICAgZGVmIG9yZGVyKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9vcmRlciA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9vcmRlcjsKCgogICAgCiAgICAjIGRhdGU6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9kYXRlID0gTm9uZTsKICAgIGRlZiBkYXRlKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9kYXRlID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2RhdGU7CgoKICAgIAogICAgIyBuYW1lOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfbmFtZSA9IE5vbmU7CiAgICBkZWYgbmFtZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fbmFtZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9uYW1lOwoKCiAgICAKICAgICMgcmVtYXJrOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfcmVtYXJrID0gTm9uZTsKICAgIGRlZiByZW1hcmsoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX3JlbWFyayA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9yZW1hcms7CgoKICAgIAogICAgIyBhZGRyZXNzOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfYWRkcmVzcyA9IE5vbmU7CiAgICBkZWYgYWRkcmVzcyhzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fYWRkcmVzcyA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9hZGRyZXNzOwoKCiAgICAKICAgICMgYmFja3VwOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfYmFja3VwID0gTm9uZTsKICAgIGRlZiBiYWNrdXAoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2JhY2t1cCA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9iYWNrdXA7CgoKICAgIAogICAgIyBwYXJlbnQ6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9wYXJlbnQgPSBOb25lOwogICAgZGVmIHBhcmVudChzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fcGFyZW50ID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3BhcmVudDsKCgogICAgCiAgICAjIGdyb3VwOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfZ3JvdXAgPSBOb25lOwogICAgZGVmIGdyb3VwKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9ncm91cCA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9ncm91cDsKCgogICAgCiAgICAjIGNvbnRleHQ6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9jb250ZXh0ID0gTm9uZTsKICAgIGRlZiBjb250ZXh0KHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9jb250ZXh0ID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2NvbnRleHQ7CgoKICAgIAogICAgIyBwb3J0OiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfcG9ydCA9IE5vbmU7CiAgICBkZWYgcG9ydChzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fcG9ydCA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9wb3J0OwoKCiAgICAKICAgICMgb25saW5lOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfb25saW5lID0gTm9uZTsKICAgIGRlZiBvbmxpbmUoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX29ubGluZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9vbmxpbmU7CgoKICAgIAogICAgIyBzZWN1cmU6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9zZWN1cmUgPSBOb25lOwogICAgZGVmIHNlY3VyZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fc2VjdXJlID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3NlY3VyZTsKCgogICAgCiAgICAjIHR5cGU6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF90eXBlID0gTm9uZTsKICAgIGRlZiB0eXBlKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl90eXBlID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3R5cGU7CgoKICAgIAogICAgCiAgICBkZWYgX2Zyb21Eb2N1bWVudChzZWxmLCBvYmopOgogICAgICAgIF9fdG9TdHJpbmcgPSAnTm9kZTo6X2Zyb21Eb2N1bWVudCgpOiAnOwogICAgICAgIAogICAgICAgIGlmIG9iaiBpcyBOb25lOgogICAgICAgICAgICByZXR1cm4gc2VsZjsKCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIGJ5dGVzKToKICAgICAgICAgICAgb2JqID0gc3RyKG9iaiwgInV0Zi04Iik7CiAgICAgICAgCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIHN0cikgb3IgdHlwZShvYmopIGlzIHN0cjoKICAgICAgICAgICAgaWYgcmUubWF0Y2gociIoKChbQS1aYS16XXszLDl9Oig/OlwvXC8pPykoPzpbLTs6Jj1cK1wkLFx3XStAKT9bQS1aYS16MC05Li1dK3woPzp3d3cufFstOzomPVwrXCQsXHddK0ApW0EtWmEtejAtOS4tXSspKCg/OlwvW1wrfiVcLy5cd1wtX10qKT9cPz8oPzpbLVwrPSY7JUAuXHdfXSopIz8oPzpbXHddKikpPykiLCBvYmopOgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIG9iaiA9IGpzb24ubG9hZHModXJsbGliMy5Qb29sTWFuYWdlcigpLnJlcXVlc3QoJ0dFVCcsIG9iaikuZGF0YS5kZWNvZGUoJ3V0Zi04JykpOwogICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgIG9iaiA9IHt9OwogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgb2JqID0ganNvbi5sb2FkcyhvYmopOwogICAgICAgIAogICAgICAgIGlmIG5vdCBpc2luc3RhbmNlKG9iaiwgKHN0ciwgYnl0ZXMsIGRpY3QpKToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICdHT1QgSEVSRTogJyArIHN0cih0eXBlKG9iaikpKTsKICAgICAgICAgICAgcmV0dXJuIG9iajsKCiAgICAgICAgICAgIGZvciBpIGluIG9iajoKICAgICAgICAgICAgICAgIG9ialtpXSA9IE5vZGUoKS5fZnJvbURvY3VtZW50KG9ialtpXSk7CiAgICAgICAgICAgIHJldHVybiBvYmo7CgoKICAgICAgICBpZiAnSWQnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5JZCA9IG9ialsnSWQnXTsKCiAgICAKICAgICAgICBpZiAnYWN0aXZlJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuYWN0aXZlKG9ialsnYWN0aXZlJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ2VuYWJsZWQnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5lbmFibGVkKG9ialsnZW5hYmxlZCddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdjb2RlJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuY29kZShvYmpbJ2NvZGUnXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnb3JkZXInIGluIG9iajoKICAgICAgICAgICAgc2VsZi5vcmRlcihvYmpbJ29yZGVyJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ2RhdGUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5kYXRlKG9ialsnZGF0ZSddKTsKICAgICAgICAKICAgICAgICAgICAgc2VsZi5kYXRlKGRhdGV0aW1lLmRhdGV0aW1lLmZyb21pc29mb3JtYXQoc2VsZi5kYXRlKCkpKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICduYW1lJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYubmFtZShvYmpbJ25hbWUnXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAncmVtYXJrJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYucmVtYXJrKG9ialsncmVtYXJrJ10pOwogICAgICAgIAogICAgICAgICAgICBzZWxmLnJlbWFyayggYmFzZTY0LmI2NGRlY29kZShzZWxmLnJlbWFyaygpKSApOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ2FkZHJlc3MnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5hZGRyZXNzKG9ialsnYWRkcmVzcyddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdiYWNrdXAnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5iYWNrdXAoTm9kZSgpLl9mcm9tRG9jdW1lbnQob2JqWydiYWNrdXAnXSkpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ3BhcmVudCcgaW4gb2JqOgogICAgICAgICAgICBzZWxmLnBhcmVudChOb2RlKCkuX2Zyb21Eb2N1bWVudChvYmpbJ3BhcmVudCddKSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnZ3JvdXAnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5ncm91cChOb2RlX0dyb3VwKCkuX2Zyb21Eb2N1bWVudChvYmpbJ2dyb3VwJ10pKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdjb250ZXh0JyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuY29udGV4dChOb2RlX0NvbnRleHQoKS5fZnJvbURvY3VtZW50KG9ialsnY29udGV4dCddKSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAncG9ydCcgaW4gb2JqOgogICAgICAgICAgICBzZWxmLnBvcnQob2JqWydwb3J0J10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ29ubGluZScgaW4gb2JqOgogICAgICAgICAgICBzZWxmLm9ubGluZShvYmpbJ29ubGluZSddKTsKICAgICAgICAKICAgICAgICAgICAgc2VsZi5vbmxpbmUoZGF0ZXRpbWUuZGF0ZXRpbWUuZnJvbWlzb2Zvcm1hdChzZWxmLm9ubGluZSgpKSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnc2VjdXJlJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuc2VjdXJlKG9ialsnc2VjdXJlJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ3R5cGUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi50eXBlKE5vZGVfVHlwZSgpLl9mcm9tRG9jdW1lbnQob2JqWyd0eXBlJ10pKTsKICAgICAgICAKICAgIAoKICAgICAgICBnYy5jb2xsZWN0KCk7CiAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAKICAgIGRlZiBfdG9Eb2N1bWVudChzZWxmLCBiSlNPTj1Ob25lKToKICAgICAgICBfX3RvU3RyaW5nID0gJ05vZGU6Ol90b0RvY3VtZW50KCk6ICc7CgogICAgICAgIHJldCA9IHt9OwogICAgICAgIGlmIHNlbGYuSWQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiSWQiXSA9IHNlbGYuSWQ7CgogICAgCiAgICAgICAgaWYgc2VsZi5hY3RpdmUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJhY3RpdmUiXSA9IHNlbGYuYWN0aXZlKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLmVuYWJsZWQoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJlbmFibGVkIl0gPSBzZWxmLmVuYWJsZWQoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYuY29kZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbImNvZGUiXSA9IHNlbGYuY29kZSgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5vcmRlcigpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbIm9yZGVyIl0gPSBzZWxmLm9yZGVyKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLmRhdGUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJkYXRlIl0gPSBzZWxmLmRhdGUoKTsKICAgICAgICAKICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShyZXRbImRhdGUiXSwgZGF0ZXRpbWUuZGF0ZXRpbWUpOgogICAgICAgICAgICAgICAgcmV0WyJkYXRlIl0gPSByZXRbImRhdGUiXS5pc29mb3JtYXQoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYubmFtZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbIm5hbWUiXSA9IHNlbGYubmFtZSgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5yZW1hcmsoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IHNlbGYucmVtYXJrKCk7CiAgICAgICAgCiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UocmV0WyJyZW1hcmsiXSwgZGljdCk6CiAgICAgICAgICAgICAgICByZXRbInJlbWFyayJdID0ganNvbi5kdW1wcyhyZXRbInJlbWFyayJdKS5lbmNvZGUoJ3V0Zi04Jyk7CgogICAgICAgICAgICByZXRbInJlbWFyayJdID0gIGJhc2U2NC5iNjRlbmNvZGUocmV0WyJyZW1hcmsiXSkuZGVjb2RlKCd1dGYtOCcpLnN0cmlwKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLmFkZHJlc3MoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJhZGRyZXNzIl0gPSBzZWxmLmFkZHJlc3MoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYuYmFja3VwKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiYmFja3VwIl0gPSBzZWxmLmJhY2t1cCgpLl90b0RvY3VtZW50KCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLnBhcmVudCgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbInBhcmVudCJdID0gc2VsZi5wYXJlbnQoKS5fdG9Eb2N1bWVudCgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5ncm91cCgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbImdyb3VwIl0gPSBzZWxmLmdyb3VwKCkuX3RvRG9jdW1lbnQoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYuY29udGV4dCgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbImNvbnRleHQiXSA9IHNlbGYuY29udGV4dCgpLl90b0RvY3VtZW50KCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLnBvcnQoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJwb3J0Il0gPSBzZWxmLnBvcnQoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYub25saW5lKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsib25saW5lIl0gPSBzZWxmLm9ubGluZSgpOwogICAgICAgIAogICAgICAgICAgICBpZiBpc2luc3RhbmNlKHJldFsib25saW5lIl0sIGRhdGV0aW1lLmRhdGV0aW1lKToKICAgICAgICAgICAgICAgIHJldFsib25saW5lIl0gPSByZXRbIm9ubGluZSJdLmlzb2Zvcm1hdCgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5zZWN1cmUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJzZWN1cmUiXSA9IHNlbGYuc2VjdXJlKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLnR5cGUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJ0eXBlIl0gPSBzZWxmLnR5cGUoKS5fdG9Eb2N1bWVudCgpOwogICAgICAgIAogICAgCiAgICAgICAgCiAgICAgICAgaWYgYkpTT04gaXMgbm90IE5vbmU6CiAgICAgICAgICAgICNwcmludChfX3RvU3RyaW5nICsgIkdPVCBIRVJFIiwgdHlwZShyZXQpLCByZXQpOwogICAgICAgICAgICByZXQgPSBqc29uLmR1bXBzKHJldCk7CiAgICAgICAgZ2MuY29sbGVjdCgpOwogICAgICAgIHJldHVybiByZXQ7CgogICAgCiAgICBkZWYgc3RvcmUoc2VsZiwgX19ldmVudD1Ob25lKToKICAgICAgICBfX3RvU3RyaW5nID0gJ05vZGU6OnN0b3JlKCk6ICc7CiAgICAgICAgCiAgICAgICAgZXZKU09OID0gTm9uZTsKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgZXZKU09OID0ganNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7CiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoKICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsKICAgICAgICAKCiAgICAgICAgYW5zd2VyID0gTm9uZTsKCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpbWUoKSkrJ10uTm9kZS5zdG9yZSgpJykubWV0aG9kKCdzdG9yZScpLmNsYXNzTmFtZSgnTm9kZScpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOwogICAgICAgIAogICAgICAgIGdjLmNvbGxlY3QoKTsKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOwoKICAgICAgICAKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsKICAgICAgICAKICAgICAgICAgICAgYW5zd2VyID0gTm9kZSgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsKICAgICAgICAKCiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnOiBHT1QgSEVSRScpOwoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7CgoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOgogICAgICAgICAgICAKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7CgogICAgICAgICAgICAKICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7CiAgICAgICAgICAgIAoKICAgICAgICByZXR1cm4gYW5zd2VyOwoKICAgIAogICAgZGVmIGZpbmRBbGwoc2VsZiwgX19ldmVudD1Ob25lKToKICAgICAgICBfX3RvU3RyaW5nID0gJ05vZGU6OmZpbmRBbGwoKTogJzsKICAgICAgICAKICAgICAgICBldkpTT04gPSBOb25lOwoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBldkpTT04gPSBqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsKICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOgogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOwogICAgICAgIAoKICAgICAgICBhbnN3ZXIgPSBOb25lOwoKICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGltZSgpKSsnXS5Ob2RlLmZpbmRBbGwoKScpLm1ldGhvZCgnZmluZEFsbCcpLmNsYXNzTmFtZSgnTm9kZScpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOwogICAgICAgIAogICAgICAgIGdjLmNvbGxlY3QoKTsKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOwoKICAgICAgICAKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsKICAgICAgICAKICAgICAgICAgICAgYW5zd2VyID0gTm9kZSgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsKICAgICAgICAKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOwoKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOwogICAgICAgICAgICAKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOwoKICAgICAgICAgICAgCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOwogICAgICAgICAgICAKCiAgICAgICAgcmV0dXJuIGFuc3dlcjsKCiAgICAKICAgIGRlZiBmaW5kKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6CiAgICAgICAgX190b1N0cmluZyA9ICdOb2RlOjpmaW5kKCk6ICc7CiAgICAgICAgCiAgICAgICAgZXZKU09OID0gTm9uZTsKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgZXZKU09OID0ganNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7CiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoKICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsKICAgICAgICAKCiAgICAgICAgYW5zd2VyID0gTm9uZTsKCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpbWUoKSkrJ10uTm9kZS5maW5kKCknKS5tZXRob2QoJ2ZpbmQnKS5jbGFzc05hbWUoJ05vZGUnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7CiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsKICAgICAgICAKICAgICAgICBnYy5jb2xsZWN0KCk7CgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsKCiAgICAgICAgCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7CiAgICAgICAgCiAgICAgICAgICAgIGFuc3dlciA9IE5vZGUoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7CiAgICAgICAgCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsKCgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsKCiAgICAgICAgICAgIAogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsKICAgICAgICAgICAgCgogICAgICAgIHJldHVybiBhbnN3ZXI7CgogICAgCiAgICBkZWYgYXV0aENvZGUoc2VsZiwgX19ldmVudD1Ob25lLCBjb2RlPU5vbmUsIHRvb2w9Tm9uZSk6CiAgICAgICAgX190b1N0cmluZyA9ICdOb2RlOjphdXRoQ29kZSgpOiAnOwogICAgICAgIAogICAgICAgIGV2SlNPTiA9IE5vbmU7CgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIGV2SlNPTiA9IGpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOwogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046CiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7CiAgICAgICAgCiAgICAgICAgICAgIGlmICdjb2RlJyBpbiBldkpTT046CiAgICAgICAgICAgICAgICBjb2RlID0gZXZKU09OWydjb2RlJ107CiAgICAgICAgCiAgICAgICAgICAgIGlmICd0b29sJyBpbiBldkpTT046CiAgICAgICAgICAgICAgICB0b29sID0gZXZKU09OWyd0b29sJ107CiAgICAgICAgCgogICAgICAgIGFuc3dlciA9IE5vbmU7CgogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aW1lKCkpKyddLk5vZGUuYXV0aENvZGUoKScpLm1ldGhvZCgnYXV0aENvZGUnKS5jbGFzc05hbWUoJ05vZGUnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7CiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsKICAgICAgICAKICAgICAgICBnYy5jb2xsZWN0KCk7CgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsKCiAgICAgICAgCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7CiAgICAgICAgCiAgICAgICAgICAgIGFuc3dlciA9IGV2SlNPTjsKICAgICAgICAKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOwoKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoc3RyKGFuc3dlcikpOwogICAgICAgICAgICAKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOwoKICAgICAgICAgICAgCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOwogICAgICAgICAgICAKCiAgICAgICAgcmV0dXJuIGFuc3dlcjsKCiAgICAKICAgIGRlZiBpbml0KHNlbGYsIF9fZXZlbnQ9Tm9uZSwgb25saW5lPU5vbmUsIGNvZGU9Tm9uZSwgdWlkPU5vbmUpOgogICAgICAgIF9fdG9TdHJpbmcgPSAnTm9kZTo6aW5pdCgpOiAnOwogICAgICAgIAogICAgICAgIGV2SlNPTiA9IE5vbmU7CgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIGV2SlNPTiA9IGpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOwogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046CiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7CiAgICAgICAgCiAgICAgICAgICAgIGlmICdvbmxpbmUnIGluIGV2SlNPTjoKICAgICAgICAgICAgICAgIG9ubGluZSA9IGV2SlNPTlsnb25saW5lJ107CiAgICAgICAgCiAgICAgICAgICAgIGlmICdjb2RlJyBpbiBldkpTT046CiAgICAgICAgICAgICAgICBjb2RlID0gZXZKU09OWydjb2RlJ107CiAgICAgICAgCiAgICAgICAgICAgIGlmICd1aWQnIGluIGV2SlNPTjoKICAgICAgICAgICAgICAgIHVpZCA9IGV2SlNPTlsndWlkJ107CiAgICAgICAgCgogICAgICAgIGFuc3dlciA9IE5vbmU7CgogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aW1lKCkpKyddLk5vZGUuaW5pdCgpJykubWV0aG9kKCdpbml0JykuY2xhc3NOYW1lKCdOb2RlJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOwogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7CiAgICAgICAgCiAgICAgICAgZ2MuY29sbGVjdCgpOwoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7CgogICAgICAgIAogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOwogICAgICAgIAogICAgICAgICAgICBhbnN3ZXIgPSBOb2RlKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOwogICAgICAgIAoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7CgoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOgogICAgICAgICAgICAKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7CgogICAgICAgICAgICAKICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7CiAgICAgICAgICAgIAoKICAgICAgICByZXR1cm4gYW5zd2VyOwoKICAgIAoKCmNsYXNzIE5vZGVfQ29udGV4dCgpOgogICAgZGVmIF9faW5pdF9fKHNlbGYsIElkPU5vbmUsIGFjdGl2ZT1Ob25lLCBlbmFibGVkPU5vbmUsIGNvZGU9Tm9uZSwgb3JkZXI9Tm9uZSwgZGF0ZT1Ob25lLCBuYW1lPU5vbmUsIHJlbWFyaz1Ob25lKToKICAgICAgICBzdXBlcigpLl9faW5pdF9fKCk7CgogICAgICAgICNwcmludCgnTm9kZV9Db250ZXh0OjpfX2luaXRfXygpJyk7CiAgICAgICAgaWYgSWQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHNlbGYuSWQgPSBJZDsKCiAgICAgICAgCiAgICAgICAgc2VsZi5hY3RpdmUoYWN0aXZlKTsKICAgICAgICBzZWxmLmVuYWJsZWQoZW5hYmxlZCk7CiAgICAgICAgc2VsZi5jb2RlKGNvZGUpOwogICAgICAgIHNlbGYub3JkZXIob3JkZXIpOwogICAgICAgIHNlbGYuZGF0ZShkYXRlKTsKICAgICAgICBzZWxmLm5hbWUobmFtZSk7CiAgICAgICAgc2VsZi5yZW1hcmsocmVtYXJrKTsKICAgICAgICAKICAgIElkID0gTm9uZTsKICAgIAogICAgCiAgICAjIGFjdGl2ZTogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX2FjdGl2ZSA9IE5vbmU7CiAgICBkZWYgYWN0aXZlKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9hY3RpdmUgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fYWN0aXZlOwoKCiAgICAKICAgICMgZW5hYmxlZDogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX2VuYWJsZWQgPSBOb25lOwogICAgZGVmIGVuYWJsZWQoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2VuYWJsZWQgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fZW5hYmxlZDsKCgogICAgCiAgICAjIGNvZGU6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9jb2RlID0gTm9uZTsKICAgIGRlZiBjb2RlKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9jb2RlID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2NvZGU7CgoKICAgIAogICAgIyBvcmRlcjogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX29yZGVyID0gTm9uZTsKICAgIGRlZiBvcmRlcihzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fb3JkZXIgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fb3JkZXI7CgoKICAgIAogICAgIyBkYXRlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfZGF0ZSA9IE5vbmU7CiAgICBkZWYgZGF0ZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fZGF0ZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9kYXRlOwoKCiAgICAKICAgICMgbmFtZTogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX25hbWUgPSBOb25lOwogICAgZGVmIG5hbWUoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX25hbWUgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fbmFtZTsKCgogICAgCiAgICAjIHJlbWFyazogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX3JlbWFyayA9IE5vbmU7CiAgICBkZWYgcmVtYXJrKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9yZW1hcmsgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fcmVtYXJrOwoKCiAgICAKICAgIAogICAgZGVmIF9mcm9tRG9jdW1lbnQoc2VsZiwgb2JqKToKICAgICAgICBfX3RvU3RyaW5nID0gJ05vZGVfQ29udGV4dDo6X2Zyb21Eb2N1bWVudCgpOiAnOwogICAgICAgIAogICAgICAgIGlmIG9iaiBpcyBOb25lOgogICAgICAgICAgICByZXR1cm4gc2VsZjsKCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIGJ5dGVzKToKICAgICAgICAgICAgb2JqID0gc3RyKG9iaiwgInV0Zi04Iik7CiAgICAgICAgCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIHN0cikgb3IgdHlwZShvYmopIGlzIHN0cjoKICAgICAgICAgICAgaWYgcmUubWF0Y2gociIoKChbQS1aYS16XXszLDl9Oig/OlwvXC8pPykoPzpbLTs6Jj1cK1wkLFx3XStAKT9bQS1aYS16MC05Li1dK3woPzp3d3cufFstOzomPVwrXCQsXHddK0ApW0EtWmEtejAtOS4tXSspKCg/OlwvW1wrfiVcLy5cd1wtX10qKT9cPz8oPzpbLVwrPSY7JUAuXHdfXSopIz8oPzpbXHddKikpPykiLCBvYmopOgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIG9iaiA9IGpzb24ubG9hZHModXJsbGliMy5Qb29sTWFuYWdlcigpLnJlcXVlc3QoJ0dFVCcsIG9iaikuZGF0YS5kZWNvZGUoJ3V0Zi04JykpOwogICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgIG9iaiA9IHt9OwogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgb2JqID0ganNvbi5sb2FkcyhvYmopOwogICAgICAgIAogICAgICAgIGlmIG5vdCBpc2luc3RhbmNlKG9iaiwgKHN0ciwgYnl0ZXMsIGRpY3QpKToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICdHT1QgSEVSRTogJyArIHN0cih0eXBlKG9iaikpKTsKICAgICAgICAgICAgcmV0dXJuIG9iajsKCiAgICAgICAgICAgIGZvciBpIGluIG9iajoKICAgICAgICAgICAgICAgIG9ialtpXSA9IE5vZGVfQ29udGV4dCgpLl9mcm9tRG9jdW1lbnQob2JqW2ldKTsKICAgICAgICAgICAgcmV0dXJuIG9iajsKCgogICAgICAgIGlmICdJZCcgaW4gb2JqOgogICAgICAgICAgICBzZWxmLklkID0gb2JqWydJZCddOwoKICAgIAogICAgICAgIGlmICdhY3RpdmUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5hY3RpdmUob2JqWydhY3RpdmUnXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnZW5hYmxlZCcgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmVuYWJsZWQob2JqWydlbmFibGVkJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ2NvZGUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5jb2RlKG9ialsnY29kZSddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdvcmRlcicgaW4gb2JqOgogICAgICAgICAgICBzZWxmLm9yZGVyKG9ialsnb3JkZXInXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnZGF0ZScgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmRhdGUob2JqWydkYXRlJ10pOwogICAgICAgIAogICAgICAgICAgICBzZWxmLmRhdGUoZGF0ZXRpbWUuZGF0ZXRpbWUuZnJvbWlzb2Zvcm1hdChzZWxmLmRhdGUoKSkpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ25hbWUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5uYW1lKG9ialsnbmFtZSddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdyZW1hcmsnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5yZW1hcmsob2JqWydyZW1hcmsnXSk7CiAgICAgICAgCiAgICAgICAgICAgIHNlbGYucmVtYXJrKCBiYXNlNjQuYjY0ZGVjb2RlKHNlbGYucmVtYXJrKCkpICk7CiAgICAgICAgCiAgICAKCiAgICAgICAgZ2MuY29sbGVjdCgpOwogICAgICAgIHJldHVybiBzZWxmOwogICAgCiAgICBkZWYgX3RvRG9jdW1lbnQoc2VsZiwgYkpTT049Tm9uZSk6CiAgICAgICAgX190b1N0cmluZyA9ICdOb2RlX0NvbnRleHQ6Ol90b0RvY3VtZW50KCk6ICc7CgogICAgICAgIHJldCA9IHt9OwogICAgICAgIGlmIHNlbGYuSWQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiSWQiXSA9IHNlbGYuSWQ7CgogICAgCiAgICAgICAgaWYgc2VsZi5hY3RpdmUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJhY3RpdmUiXSA9IHNlbGYuYWN0aXZlKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLmVuYWJsZWQoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJlbmFibGVkIl0gPSBzZWxmLmVuYWJsZWQoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYuY29kZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbImNvZGUiXSA9IHNlbGYuY29kZSgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5vcmRlcigpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbIm9yZGVyIl0gPSBzZWxmLm9yZGVyKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLmRhdGUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJkYXRlIl0gPSBzZWxmLmRhdGUoKTsKICAgICAgICAKICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShyZXRbImRhdGUiXSwgZGF0ZXRpbWUuZGF0ZXRpbWUpOgogICAgICAgICAgICAgICAgcmV0WyJkYXRlIl0gPSByZXRbImRhdGUiXS5pc29mb3JtYXQoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYubmFtZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbIm5hbWUiXSA9IHNlbGYubmFtZSgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5yZW1hcmsoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IHNlbGYucmVtYXJrKCk7CiAgICAgICAgCiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UocmV0WyJyZW1hcmsiXSwgZGljdCk6CiAgICAgICAgICAgICAgICByZXRbInJlbWFyayJdID0ganNvbi5kdW1wcyhyZXRbInJlbWFyayJdKS5lbmNvZGUoJ3V0Zi04Jyk7CgogICAgICAgICAgICByZXRbInJlbWFyayJdID0gIGJhc2U2NC5iNjRlbmNvZGUocmV0WyJyZW1hcmsiXSkuZGVjb2RlKCd1dGYtOCcpLnN0cmlwKCk7CiAgICAgICAgCiAgICAKICAgICAgICAKICAgICAgICBpZiBiSlNPTiBpcyBub3QgTm9uZToKICAgICAgICAgICAgI3ByaW50KF9fdG9TdHJpbmcgKyAiR09UIEhFUkUiLCB0eXBlKHJldCksIHJldCk7CiAgICAgICAgICAgIHJldCA9IGpzb24uZHVtcHMocmV0KTsKICAgICAgICBnYy5jb2xsZWN0KCk7CiAgICAgICAgcmV0dXJuIHJldDsKCiAgICAKICAgIGRlZiBzdG9yZShzZWxmLCBfX2V2ZW50PU5vbmUpOgogICAgICAgIF9fdG9TdHJpbmcgPSAnTm9kZV9Db250ZXh0OjpzdG9yZSgpOiAnOwogICAgICAgIAogICAgICAgIGV2SlNPTiA9IE5vbmU7CgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIGV2SlNPTiA9IGpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOwogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046CiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7CiAgICAgICAgCgogICAgICAgIGFuc3dlciA9IE5vbmU7CgogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aW1lKCkpKyddLk5vZGVfQ29udGV4dC5zdG9yZSgpJykubWV0aG9kKCdzdG9yZScpLmNsYXNzTmFtZSgnTm9kZV9Db250ZXh0JykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOwogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7CiAgICAgICAgCiAgICAgICAgZ2MuY29sbGVjdCgpOwoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7CgogICAgICAgIAogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOwogICAgICAgIAogICAgICAgICAgICBhbnN3ZXIgPSBOb2RlX0NvbnRleHQoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7CiAgICAgICAgCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsKCgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsKCiAgICAgICAgICAgIAogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsKICAgICAgICAgICAgCgogICAgICAgIHJldHVybiBhbnN3ZXI7CgogICAgCiAgICBkZWYgZmluZEFsbChzZWxmLCBfX2V2ZW50PU5vbmUpOgogICAgICAgIF9fdG9TdHJpbmcgPSAnTm9kZV9Db250ZXh0OjpmaW5kQWxsKCk6ICc7CiAgICAgICAgCiAgICAgICAgZXZKU09OID0gTm9uZTsKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgZXZKU09OID0ganNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7CiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoKICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsKICAgICAgICAKCiAgICAgICAgYW5zd2VyID0gTm9uZTsKCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpbWUoKSkrJ10uTm9kZV9Db250ZXh0LmZpbmRBbGwoKScpLm1ldGhvZCgnZmluZEFsbCcpLmNsYXNzTmFtZSgnTm9kZV9Db250ZXh0JykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOwogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7CiAgICAgICAgCiAgICAgICAgZ2MuY29sbGVjdCgpOwoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7CgogICAgICAgIAogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOwogICAgICAgIAogICAgICAgICAgICBhbnN3ZXIgPSBOb2RlX0NvbnRleHQoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7CiAgICAgICAgCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsKCgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsKCiAgICAgICAgICAgIAogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsKICAgICAgICAgICAgCgogICAgICAgIHJldHVybiBhbnN3ZXI7CgogICAgCiAgICBkZWYgZmluZChzZWxmLCBfX2V2ZW50PU5vbmUpOgogICAgICAgIF9fdG9TdHJpbmcgPSAnTm9kZV9Db250ZXh0OjpmaW5kKCk6ICc7CiAgICAgICAgCiAgICAgICAgZXZKU09OID0gTm9uZTsKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgZXZKU09OID0ganNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7CiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoKICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsKICAgICAgICAKCiAgICAgICAgYW5zd2VyID0gTm9uZTsKCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpbWUoKSkrJ10uTm9kZV9Db250ZXh0LmZpbmQoKScpLm1ldGhvZCgnZmluZCcpLmNsYXNzTmFtZSgnTm9kZV9Db250ZXh0JykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOwogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7CiAgICAgICAgCiAgICAgICAgZ2MuY29sbGVjdCgpOwoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7CgogICAgICAgIAogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOwogICAgICAgIAogICAgICAgICAgICBhbnN3ZXIgPSBOb2RlX0NvbnRleHQoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7CiAgICAgICAgCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsKCgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsKCiAgICAgICAgICAgIAogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsKICAgICAgICAgICAgCgogICAgICAgIHJldHVybiBhbnN3ZXI7CgogICAgCgoKY2xhc3MgTm9kZV9Hcm91cCgpOgogICAgZGVmIF9faW5pdF9fKHNlbGYsIElkPU5vbmUsIGFjdGl2ZT1Ob25lLCBlbmFibGVkPU5vbmUsIGNvZGU9Tm9uZSwgb3JkZXI9Tm9uZSwgZGF0ZT1Ob25lLCBuYW1lPU5vbmUsIHJlbWFyaz1Ob25lKToKICAgICAgICBzdXBlcigpLl9faW5pdF9fKCk7CgogICAgICAgICNwcmludCgnTm9kZV9Hcm91cDo6X19pbml0X18oKScpOwogICAgICAgIGlmIElkIGlzIG5vdCBOb25lOgogICAgICAgICAgICBzZWxmLklkID0gSWQ7CgogICAgICAgIAogICAgICAgIHNlbGYuYWN0aXZlKGFjdGl2ZSk7CiAgICAgICAgc2VsZi5lbmFibGVkKGVuYWJsZWQpOwogICAgICAgIHNlbGYuY29kZShjb2RlKTsKICAgICAgICBzZWxmLm9yZGVyKG9yZGVyKTsKICAgICAgICBzZWxmLmRhdGUoZGF0ZSk7CiAgICAgICAgc2VsZi5uYW1lKG5hbWUpOwogICAgICAgIHNlbGYucmVtYXJrKHJlbWFyayk7CiAgICAgICAgCiAgICBJZCA9IE5vbmU7CiAgICAKICAgIAogICAgIyBhY3RpdmU6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9hY3RpdmUgPSBOb25lOwogICAgZGVmIGFjdGl2ZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fYWN0aXZlID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2FjdGl2ZTsKCgogICAgCiAgICAjIGVuYWJsZWQ6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9lbmFibGVkID0gTm9uZTsKICAgIGRlZiBlbmFibGVkKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9lbmFibGVkID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2VuYWJsZWQ7CgoKICAgIAogICAgIyBjb2RlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfY29kZSA9IE5vbmU7CiAgICBkZWYgY29kZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fY29kZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9jb2RlOwoKCiAgICAKICAgICMgb3JkZXI6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9vcmRlciA9IE5vbmU7CiAgICBkZWYgb3JkZXIoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX29yZGVyID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX29yZGVyOwoKCiAgICAKICAgICMgZGF0ZTogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX2RhdGUgPSBOb25lOwogICAgZGVmIGRhdGUoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2RhdGUgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fZGF0ZTsKCgogICAgCiAgICAjIG5hbWU6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9uYW1lID0gTm9uZTsKICAgIGRlZiBuYW1lKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9uYW1lID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX25hbWU7CgoKICAgIAogICAgIyByZW1hcms6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9yZW1hcmsgPSBOb25lOwogICAgZGVmIHJlbWFyayhzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fcmVtYXJrID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3JlbWFyazsKCgogICAgCiAgICAKICAgIGRlZiBfZnJvbURvY3VtZW50KHNlbGYsIG9iaik6CiAgICAgICAgX190b1N0cmluZyA9ICdOb2RlX0dyb3VwOjpfZnJvbURvY3VtZW50KCk6ICc7CiAgICAgICAgCiAgICAgICAgaWYgb2JqIGlzIE5vbmU6CiAgICAgICAgICAgIHJldHVybiBzZWxmOwoKICAgICAgICBpZiBpc2luc3RhbmNlKG9iaiwgYnl0ZXMpOgogICAgICAgICAgICBvYmogPSBzdHIob2JqLCAidXRmLTgiKTsKICAgICAgICAKICAgICAgICBpZiBpc2luc3RhbmNlKG9iaiwgc3RyKSBvciB0eXBlKG9iaikgaXMgc3RyOgogICAgICAgICAgICBpZiByZS5tYXRjaChyIigoKFtBLVphLXpdezMsOX06KD86XC9cLyk/KSg/OlstOzomPVwrXCQsXHddK0ApP1tBLVphLXowLTkuLV0rfCg/Ond3dy58Wy07OiY9XCtcJCxcd10rQClbQS1aYS16MC05Li1dKykoKD86XC9bXCt+JVwvLlx3XC1fXSopP1w/Pyg/OlstXCs9JjslQC5cd19dKikjPyg/Oltcd10qKSk/KSIsIG9iaik6CiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgb2JqID0ganNvbi5sb2Fkcyh1cmxsaWIzLlBvb2xNYW5hZ2VyKCkucmVxdWVzdCgnR0VUJywgb2JqKS5kYXRhLmRlY29kZSgndXRmLTgnKSk7CiAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgb2JqID0ge307CiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBvYmogPSBqc29uLmxvYWRzKG9iaik7CiAgICAgICAgCiAgICAgICAgaWYgbm90IGlzaW5zdGFuY2Uob2JqLCAoc3RyLCBieXRlcywgZGljdCkpOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJ0dPVCBIRVJFOiAnICsgc3RyKHR5cGUob2JqKSkpOwogICAgICAgICAgICByZXR1cm4gb2JqOwoKICAgICAgICAgICAgZm9yIGkgaW4gb2JqOgogICAgICAgICAgICAgICAgb2JqW2ldID0gTm9kZV9Hcm91cCgpLl9mcm9tRG9jdW1lbnQob2JqW2ldKTsKICAgICAgICAgICAgcmV0dXJuIG9iajsKCgogICAgICAgIGlmICdJZCcgaW4gb2JqOgogICAgICAgICAgICBzZWxmLklkID0gb2JqWydJZCddOwoKICAgIAogICAgICAgIGlmICdhY3RpdmUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5hY3RpdmUob2JqWydhY3RpdmUnXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnZW5hYmxlZCcgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmVuYWJsZWQob2JqWydlbmFibGVkJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ2NvZGUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5jb2RlKG9ialsnY29kZSddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdvcmRlcicgaW4gb2JqOgogICAgICAgICAgICBzZWxmLm9yZGVyKG9ialsnb3JkZXInXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnZGF0ZScgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmRhdGUob2JqWydkYXRlJ10pOwogICAgICAgIAogICAgICAgICAgICBzZWxmLmRhdGUoZGF0ZXRpbWUuZGF0ZXRpbWUuZnJvbWlzb2Zvcm1hdChzZWxmLmRhdGUoKSkpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ25hbWUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5uYW1lKG9ialsnbmFtZSddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdyZW1hcmsnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5yZW1hcmsob2JqWydyZW1hcmsnXSk7CiAgICAgICAgCiAgICAgICAgICAgIHNlbGYucmVtYXJrKCBiYXNlNjQuYjY0ZGVjb2RlKHNlbGYucmVtYXJrKCkpICk7CiAgICAgICAgCiAgICAKCiAgICAgICAgZ2MuY29sbGVjdCgpOwogICAgICAgIHJldHVybiBzZWxmOwogICAgCiAgICBkZWYgX3RvRG9jdW1lbnQoc2VsZiwgYkpTT049Tm9uZSk6CiAgICAgICAgX190b1N0cmluZyA9ICdOb2RlX0dyb3VwOjpfdG9Eb2N1bWVudCgpOiAnOwoKICAgICAgICByZXQgPSB7fTsKICAgICAgICBpZiBzZWxmLklkIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbIklkIl0gPSBzZWxmLklkOwoKICAgIAogICAgICAgIGlmIHNlbGYuYWN0aXZlKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiYWN0aXZlIl0gPSBzZWxmLmFjdGl2ZSgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5lbmFibGVkKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiZW5hYmxlZCJdID0gc2VsZi5lbmFibGVkKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLmNvZGUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJjb2RlIl0gPSBzZWxmLmNvZGUoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYub3JkZXIoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJvcmRlciJdID0gc2VsZi5vcmRlcigpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5kYXRlKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiZGF0ZSJdID0gc2VsZi5kYXRlKCk7CiAgICAgICAgCiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UocmV0WyJkYXRlIl0sIGRhdGV0aW1lLmRhdGV0aW1lKToKICAgICAgICAgICAgICAgIHJldFsiZGF0ZSJdID0gcmV0WyJkYXRlIl0uaXNvZm9ybWF0KCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLm5hbWUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJuYW1lIl0gPSBzZWxmLm5hbWUoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYucmVtYXJrKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSBzZWxmLnJlbWFyaygpOwogICAgICAgIAogICAgICAgICAgICBpZiBpc2luc3RhbmNlKHJldFsicmVtYXJrIl0sIGRpY3QpOgogICAgICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IGpzb24uZHVtcHMocmV0WyJyZW1hcmsiXSkuZW5jb2RlKCd1dGYtOCcpOwoKICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9ICBiYXNlNjQuYjY0ZW5jb2RlKHJldFsicmVtYXJrIl0pLmRlY29kZSgndXRmLTgnKS5zdHJpcCgpOwogICAgICAgIAogICAgCiAgICAgICAgCiAgICAgICAgaWYgYkpTT04gaXMgbm90IE5vbmU6CiAgICAgICAgICAgICNwcmludChfX3RvU3RyaW5nICsgIkdPVCBIRVJFIiwgdHlwZShyZXQpLCByZXQpOwogICAgICAgICAgICByZXQgPSBqc29uLmR1bXBzKHJldCk7CiAgICAgICAgZ2MuY29sbGVjdCgpOwogICAgICAgIHJldHVybiByZXQ7CgogICAgCiAgICBkZWYgc3RvcmUoc2VsZiwgX19ldmVudD1Ob25lKToKICAgICAgICBfX3RvU3RyaW5nID0gJ05vZGVfR3JvdXA6OnN0b3JlKCk6ICc7CiAgICAgICAgCiAgICAgICAgZXZKU09OID0gTm9uZTsKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgZXZKU09OID0ganNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7CiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoKICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsKICAgICAgICAKCiAgICAgICAgYW5zd2VyID0gTm9uZTsKCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpbWUoKSkrJ10uTm9kZV9Hcm91cC5zdG9yZSgpJykubWV0aG9kKCdzdG9yZScpLmNsYXNzTmFtZSgnTm9kZV9Hcm91cCcpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOwogICAgICAgIAogICAgICAgIGdjLmNvbGxlY3QoKTsKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOwoKICAgICAgICAKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsKICAgICAgICAKICAgICAgICAgICAgYW5zd2VyID0gTm9kZV9Hcm91cCgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsKICAgICAgICAKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOwoKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOwogICAgICAgICAgICAKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOwoKICAgICAgICAgICAgCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOwogICAgICAgICAgICAKCiAgICAgICAgcmV0dXJuIGFuc3dlcjsKCiAgICAKICAgIGRlZiBmaW5kQWxsKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6CiAgICAgICAgX190b1N0cmluZyA9ICdOb2RlX0dyb3VwOjpmaW5kQWxsKCk6ICc7CiAgICAgICAgCiAgICAgICAgZXZKU09OID0gTm9uZTsKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgZXZKU09OID0ganNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7CiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoKICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsKICAgICAgICAKCiAgICAgICAgYW5zd2VyID0gTm9uZTsKCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpbWUoKSkrJ10uTm9kZV9Hcm91cC5maW5kQWxsKCknKS5tZXRob2QoJ2ZpbmRBbGwnKS5jbGFzc05hbWUoJ05vZGVfR3JvdXAnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7CiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsKICAgICAgICAKICAgICAgICBnYy5jb2xsZWN0KCk7CgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsKCiAgICAgICAgCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7CiAgICAgICAgCiAgICAgICAgICAgIGFuc3dlciA9IE5vZGVfR3JvdXAoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7CiAgICAgICAgCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsKCgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsKCiAgICAgICAgICAgIAogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsKICAgICAgICAgICAgCgogICAgICAgIHJldHVybiBhbnN3ZXI7CgogICAgCiAgICBkZWYgZmluZChzZWxmLCBfX2V2ZW50PU5vbmUpOgogICAgICAgIF9fdG9TdHJpbmcgPSAnTm9kZV9Hcm91cDo6ZmluZCgpOiAnOwogICAgICAgIAogICAgICAgIGV2SlNPTiA9IE5vbmU7CgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIGV2SlNPTiA9IGpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOwogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046CiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7CiAgICAgICAgCgogICAgICAgIGFuc3dlciA9IE5vbmU7CgogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aW1lKCkpKyddLk5vZGVfR3JvdXAuZmluZCgpJykubWV0aG9kKCdmaW5kJykuY2xhc3NOYW1lKCdOb2RlX0dyb3VwJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOwogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7CiAgICAgICAgCiAgICAgICAgZ2MuY29sbGVjdCgpOwoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7CgogICAgICAgIAogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOwogICAgICAgIAogICAgICAgICAgICBhbnN3ZXIgPSBOb2RlX0dyb3VwKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOwogICAgICAgIAoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7CgoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOgogICAgICAgICAgICAKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7CgogICAgICAgICAgICAKICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7CiAgICAgICAgICAgIAoKICAgICAgICByZXR1cm4gYW5zd2VyOwoKICAgIAoKCmNsYXNzIE5vZGVfVHlwZSgpOgogICAgZGVmIF9faW5pdF9fKHNlbGYsIElkPU5vbmUsIGFjdGl2ZT1Ob25lLCBlbmFibGVkPU5vbmUsIGNvZGU9Tm9uZSwgb3JkZXI9Tm9uZSwgZGF0ZT1Ob25lLCBuYW1lPU5vbmUsIHJlbWFyaz1Ob25lLCBkeW5hbWljPU5vbmUpOgogICAgICAgIHN1cGVyKCkuX19pbml0X18oKTsKCiAgICAgICAgI3ByaW50KCdOb2RlX1R5cGU6Ol9faW5pdF9fKCknKTsKICAgICAgICBpZiBJZCBpcyBub3QgTm9uZToKICAgICAgICAgICAgc2VsZi5JZCA9IElkOwoKICAgICAgICAKICAgICAgICBzZWxmLmFjdGl2ZShhY3RpdmUpOwogICAgICAgIHNlbGYuZW5hYmxlZChlbmFibGVkKTsKICAgICAgICBzZWxmLmNvZGUoY29kZSk7CiAgICAgICAgc2VsZi5vcmRlcihvcmRlcik7CiAgICAgICAgc2VsZi5kYXRlKGRhdGUpOwogICAgICAgIHNlbGYubmFtZShuYW1lKTsKICAgICAgICBzZWxmLnJlbWFyayhyZW1hcmspOwogICAgICAgIHNlbGYuZHluYW1pYyhkeW5hbWljKTsKICAgICAgICAKICAgIElkID0gTm9uZTsKICAgIAogICAgCiAgICAjIGFjdGl2ZTogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX2FjdGl2ZSA9IE5vbmU7CiAgICBkZWYgYWN0aXZlKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9hY3RpdmUgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fYWN0aXZlOwoKCiAgICAKICAgICMgZW5hYmxlZDogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX2VuYWJsZWQgPSBOb25lOwogICAgZGVmIGVuYWJsZWQoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2VuYWJsZWQgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fZW5hYmxlZDsKCgogICAgCiAgICAjIGNvZGU6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9jb2RlID0gTm9uZTsKICAgIGRlZiBjb2RlKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9jb2RlID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2NvZGU7CgoKICAgIAogICAgIyBvcmRlcjogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX29yZGVyID0gTm9uZTsKICAgIGRlZiBvcmRlcihzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fb3JkZXIgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fb3JkZXI7CgoKICAgIAogICAgIyBkYXRlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfZGF0ZSA9IE5vbmU7CiAgICBkZWYgZGF0ZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fZGF0ZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9kYXRlOwoKCiAgICAKICAgICMgbmFtZTogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX25hbWUgPSBOb25lOwogICAgZGVmIG5hbWUoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX25hbWUgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fbmFtZTsKCgogICAgCiAgICAjIHJlbWFyazogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX3JlbWFyayA9IE5vbmU7CiAgICBkZWYgcmVtYXJrKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9yZW1hcmsgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fcmVtYXJrOwoKCiAgICAKICAgICMgZHluYW1pYzogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX2R5bmFtaWMgPSBOb25lOwogICAgZGVmIGR5bmFtaWMoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2R5bmFtaWMgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fZHluYW1pYzsKCgogICAgCiAgICAKICAgIGRlZiBfZnJvbURvY3VtZW50KHNlbGYsIG9iaik6CiAgICAgICAgX190b1N0cmluZyA9ICdOb2RlX1R5cGU6Ol9mcm9tRG9jdW1lbnQoKTogJzsKICAgICAgICAKICAgICAgICBpZiBvYmogaXMgTm9uZToKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CgogICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLCBieXRlcyk6CiAgICAgICAgICAgIG9iaiA9IHN0cihvYmosICJ1dGYtOCIpOwogICAgICAgIAogICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLCBzdHIpIG9yIHR5cGUob2JqKSBpcyBzdHI6CiAgICAgICAgICAgIGlmIHJlLm1hdGNoKHIiKCgoW0EtWmEtel17Myw5fTooPzpcL1wvKT8pKD86Wy07OiY9XCtcJCxcd10rQCk/W0EtWmEtejAtOS4tXSt8KD86d3d3LnxbLTs6Jj1cK1wkLFx3XStAKVtBLVphLXowLTkuLV0rKSgoPzpcL1tcK34lXC8uXHdcLV9dKik/XD8/KD86Wy1cKz0mOyVALlx3X10qKSM/KD86W1x3XSopKT8pIiwgb2JqKToKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBvYmogPSBqc29uLmxvYWRzKHVybGxpYjMuUG9vbE1hbmFnZXIoKS5yZXF1ZXN0KCdHRVQnLCBvYmopLmRhdGEuZGVjb2RlKCd1dGYtOCcpKTsKICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICBvYmogPSB7fTsKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIG9iaiA9IGpzb24ubG9hZHMob2JqKTsKICAgICAgICAKICAgICAgICBpZiBub3QgaXNpbnN0YW5jZShvYmosIChzdHIsIGJ5dGVzLCBkaWN0KSk6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAnR09UIEhFUkU6ICcgKyBzdHIodHlwZShvYmopKSk7CiAgICAgICAgICAgIHJldHVybiBvYmo7CgogICAgICAgICAgICBmb3IgaSBpbiBvYmo6CiAgICAgICAgICAgICAgICBvYmpbaV0gPSBOb2RlX1R5cGUoKS5fZnJvbURvY3VtZW50KG9ialtpXSk7CiAgICAgICAgICAgIHJldHVybiBvYmo7CgoKICAgICAgICBpZiAnSWQnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5JZCA9IG9ialsnSWQnXTsKCiAgICAKICAgICAgICBpZiAnYWN0aXZlJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuYWN0aXZlKG9ialsnYWN0aXZlJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ2VuYWJsZWQnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5lbmFibGVkKG9ialsnZW5hYmxlZCddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdjb2RlJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuY29kZShvYmpbJ2NvZGUnXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnb3JkZXInIGluIG9iajoKICAgICAgICAgICAgc2VsZi5vcmRlcihvYmpbJ29yZGVyJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ2RhdGUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5kYXRlKG9ialsnZGF0ZSddKTsKICAgICAgICAKICAgICAgICAgICAgc2VsZi5kYXRlKGRhdGV0aW1lLmRhdGV0aW1lLmZyb21pc29mb3JtYXQoc2VsZi5kYXRlKCkpKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICduYW1lJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYubmFtZShvYmpbJ25hbWUnXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAncmVtYXJrJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYucmVtYXJrKG9ialsncmVtYXJrJ10pOwogICAgICAgIAogICAgICAgICAgICBzZWxmLnJlbWFyayggYmFzZTY0LmI2NGRlY29kZShzZWxmLnJlbWFyaygpKSApOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ2R5bmFtaWMnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5keW5hbWljKG9ialsnZHluYW1pYyddKTsKICAgICAgICAKICAgIAoKICAgICAgICBnYy5jb2xsZWN0KCk7CiAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAKICAgIGRlZiBfdG9Eb2N1bWVudChzZWxmLCBiSlNPTj1Ob25lKToKICAgICAgICBfX3RvU3RyaW5nID0gJ05vZGVfVHlwZTo6X3RvRG9jdW1lbnQoKTogJzsKCiAgICAgICAgcmV0ID0ge307CiAgICAgICAgaWYgc2VsZi5JZCBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJJZCJdID0gc2VsZi5JZDsKCiAgICAKICAgICAgICBpZiBzZWxmLmFjdGl2ZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbImFjdGl2ZSJdID0gc2VsZi5hY3RpdmUoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYuZW5hYmxlZCgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbImVuYWJsZWQiXSA9IHNlbGYuZW5hYmxlZCgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5jb2RlKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiY29kZSJdID0gc2VsZi5jb2RlKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLm9yZGVyKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsib3JkZXIiXSA9IHNlbGYub3JkZXIoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYuZGF0ZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbImRhdGUiXSA9IHNlbGYuZGF0ZSgpOwogICAgICAgIAogICAgICAgICAgICBpZiBpc2luc3RhbmNlKHJldFsiZGF0ZSJdLCBkYXRldGltZS5kYXRldGltZSk6CiAgICAgICAgICAgICAgICByZXRbImRhdGUiXSA9IHJldFsiZGF0ZSJdLmlzb2Zvcm1hdCgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5uYW1lKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsibmFtZSJdID0gc2VsZi5uYW1lKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLnJlbWFyaygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbInJlbWFyayJdID0gc2VsZi5yZW1hcmsoKTsKICAgICAgICAKICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShyZXRbInJlbWFyayJdLCBkaWN0KToKICAgICAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSBqc29uLmR1bXBzKHJldFsicmVtYXJrIl0pLmVuY29kZSgndXRmLTgnKTsKCiAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSAgYmFzZTY0LmI2NGVuY29kZShyZXRbInJlbWFyayJdKS5kZWNvZGUoJ3V0Zi04Jykuc3RyaXAoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYuZHluYW1pYygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbImR5bmFtaWMiXSA9IHNlbGYuZHluYW1pYygpOwogICAgICAgIAogICAgCiAgICAgICAgCiAgICAgICAgaWYgYkpTT04gaXMgbm90IE5vbmU6CiAgICAgICAgICAgICNwcmludChfX3RvU3RyaW5nICsgIkdPVCBIRVJFIiwgdHlwZShyZXQpLCByZXQpOwogICAgICAgICAgICByZXQgPSBqc29uLmR1bXBzKHJldCk7CiAgICAgICAgZ2MuY29sbGVjdCgpOwogICAgICAgIHJldHVybiByZXQ7CgogICAgCiAgICBkZWYgc3RvcmUoc2VsZiwgX19ldmVudD1Ob25lKToKICAgICAgICBfX3RvU3RyaW5nID0gJ05vZGVfVHlwZTo6c3RvcmUoKTogJzsKICAgICAgICAKICAgICAgICBldkpTT04gPSBOb25lOwoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBldkpTT04gPSBqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsKICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOgogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOwogICAgICAgIAoKICAgICAgICBhbnN3ZXIgPSBOb25lOwoKICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGltZSgpKSsnXS5Ob2RlX1R5cGUuc3RvcmUoKScpLm1ldGhvZCgnc3RvcmUnKS5jbGFzc05hbWUoJ05vZGVfVHlwZScpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOwogICAgICAgIAogICAgICAgIGdjLmNvbGxlY3QoKTsKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOwoKICAgICAgICAKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsKICAgICAgICAKICAgICAgICAgICAgYW5zd2VyID0gTm9kZV9UeXBlKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOwogICAgICAgIAoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7CgoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOgogICAgICAgICAgICAKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7CgogICAgICAgICAgICAKICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7CiAgICAgICAgICAgIAoKICAgICAgICByZXR1cm4gYW5zd2VyOwoKICAgIAogICAgZGVmIGZpbmRBbGwoc2VsZiwgX19ldmVudD1Ob25lKToKICAgICAgICBfX3RvU3RyaW5nID0gJ05vZGVfVHlwZTo6ZmluZEFsbCgpOiAnOwogICAgICAgIAogICAgICAgIGV2SlNPTiA9IE5vbmU7CgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIGV2SlNPTiA9IGpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOwogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046CiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7CiAgICAgICAgCgogICAgICAgIGFuc3dlciA9IE5vbmU7CgogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aW1lKCkpKyddLk5vZGVfVHlwZS5maW5kQWxsKCknKS5tZXRob2QoJ2ZpbmRBbGwnKS5jbGFzc05hbWUoJ05vZGVfVHlwZScpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOwogICAgICAgIAogICAgICAgIGdjLmNvbGxlY3QoKTsKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOwoKICAgICAgICAKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsKICAgICAgICAKICAgICAgICAgICAgYW5zd2VyID0gTm9kZV9UeXBlKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOwogICAgICAgIAoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7CgoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOgogICAgICAgICAgICAKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7CgogICAgICAgICAgICAKICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7CiAgICAgICAgICAgIAoKICAgICAgICByZXR1cm4gYW5zd2VyOwoKICAgIAogICAgZGVmIGZpbmQoc2VsZiwgX19ldmVudD1Ob25lKToKICAgICAgICBfX3RvU3RyaW5nID0gJ05vZGVfVHlwZTo6ZmluZCgpOiAnOwogICAgICAgIAogICAgICAgIGV2SlNPTiA9IE5vbmU7CgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIGV2SlNPTiA9IGpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOwogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046CiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7CiAgICAgICAgCgogICAgICAgIGFuc3dlciA9IE5vbmU7CgogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aW1lKCkpKyddLk5vZGVfVHlwZS5maW5kKCknKS5tZXRob2QoJ2ZpbmQnKS5jbGFzc05hbWUoJ05vZGVfVHlwZScpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOwogICAgICAgIAogICAgICAgIGdjLmNvbGxlY3QoKTsKCgogICAgICAgIGxhc3RVcGRhdGUgPSBzZWxmLmRhdGUoKTsKICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoYmFzZV91cmwpOwoKICAgICAgICBpZiBzZWxmLmRhdGUoKT5sYXN0VXBkYXRlOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIm5ld2VyIHZlcnNpb246ICIgKyBzdHIoc2VsZi5kYXRlKCkpICsgIiwgcmVib290aW5nLi4uIik7CiAgICAgICAgICAgIG9zLmV4ZWNsKHN5cy5leGVjdXRhYmxlLCBzeXMuZXhlY3V0YWJsZSwgKnN5cy5hcmd2KTsKCiAgICAgICAgdGltZS5zbGVlcCgzMCk7CiAgICAgICAgcmV0dXJuIHNlbGYuZmluZCgpOwogICAgICAgIAoKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOwoKICAgICAgICAKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsKICAgICAgICAKICAgICAgICAgICAgYW5zd2VyID0gTm9kZV9UeXBlKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOwogICAgICAgIAoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7CgoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOgogICAgICAgICAgICAKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7CgogICAgICAgICAgICAKICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7CiAgICAgICAgICAgIAoKICAgICAgICByZXR1cm4gYW5zd2VyOwoKICAgIAoKCmNsYXNzIE1hcHBpbmcoKToKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBJZD1Ob25lLCBhY3RpdmU9Tm9uZSwgZW5hYmxlZD1Ob25lLCBvcmRlcj1Ob25lLCBjbGFzc05hbWU9Tm9uZSwgc2NvcGU9Tm9uZSwgY29udGV4dD1Ob25lLCBzb3VyY2U9Tm9uZSwgdGFyZ2V0PU5vbmUsIG9wZXJhdG9yPU5vbmUsIGluU2NyaXB0PU5vbmUsIG91dFNjcmlwdD1Ob25lLCB0b29sPU5vbmUsIGdyb3VwPU5vbmUsIHR5cGU9Tm9uZSk6CiAgICAgICAgc3VwZXIoKS5fX2luaXRfXygpOwoKICAgICAgICAjcHJpbnQoJ01hcHBpbmc6Ol9faW5pdF9fKCknKTsKICAgICAgICBpZiBJZCBpcyBub3QgTm9uZToKICAgICAgICAgICAgc2VsZi5JZCA9IElkOwoKICAgICAgICAKICAgICAgICBzZWxmLmFjdGl2ZShhY3RpdmUpOwogICAgICAgIHNlbGYuZW5hYmxlZChlbmFibGVkKTsKICAgICAgICBzZWxmLm9yZGVyKG9yZGVyKTsKICAgICAgICBzZWxmLmNsYXNzTmFtZShjbGFzc05hbWUpOwogICAgICAgIHNlbGYuc2NvcGUoc2NvcGUpOwogICAgICAgIHNlbGYuY29udGV4dChjb250ZXh0KTsKICAgICAgICBzZWxmLnNvdXJjZShzb3VyY2UpOwogICAgICAgIHNlbGYudGFyZ2V0KHRhcmdldCk7CiAgICAgICAgc2VsZi5vcGVyYXRvcihvcGVyYXRvcik7CiAgICAgICAgc2VsZi5pblNjcmlwdChpblNjcmlwdCk7CiAgICAgICAgc2VsZi5vdXRTY3JpcHQob3V0U2NyaXB0KTsKICAgICAgICBzZWxmLnRvb2wodG9vbCk7CiAgICAgICAgc2VsZi5ncm91cChncm91cCk7CiAgICAgICAgc2VsZi50eXBlKHR5cGUpOwogICAgICAgIAogICAgSWQgPSBOb25lOwogICAgCiAgICAKICAgICMgYWN0aXZlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfYWN0aXZlID0gTm9uZTsKICAgIGRlZiBhY3RpdmUoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2FjdGl2ZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9hY3RpdmU7CgoKICAgIAogICAgIyBlbmFibGVkOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfZW5hYmxlZCA9IE5vbmU7CiAgICBkZWYgZW5hYmxlZChzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fZW5hYmxlZCA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9lbmFibGVkOwoKCiAgICAKICAgICMgb3JkZXI6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9vcmRlciA9IE5vbmU7CiAgICBkZWYgb3JkZXIoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX29yZGVyID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX29yZGVyOwoKCiAgICAKICAgICMgY2xhc3NOYW1lOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfY2xhc3NOYW1lID0gTm9uZTsKICAgIGRlZiBjbGFzc05hbWUoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2NsYXNzTmFtZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9jbGFzc05hbWU7CgoKICAgIAogICAgIyBzY29wZTogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX3Njb3BlID0gTm9uZTsKICAgIGRlZiBzY29wZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fc2NvcGUgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fc2NvcGU7CgoKICAgIAogICAgIyBjb250ZXh0OiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfY29udGV4dCA9IE5vbmU7CiAgICBkZWYgY29udGV4dChzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fY29udGV4dCA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9jb250ZXh0OwoKCiAgICAKICAgICMgc291cmNlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfc291cmNlID0gTm9uZTsKICAgIGRlZiBzb3VyY2Uoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX3NvdXJjZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9zb3VyY2U7CgoKICAgIAogICAgIyB0YXJnZXQ6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF90YXJnZXQgPSBOb25lOwogICAgZGVmIHRhcmdldChzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fdGFyZ2V0ID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3RhcmdldDsKCgogICAgCiAgICAjIG9wZXJhdG9yOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfb3BlcmF0b3IgPSBOb25lOwogICAgZGVmIG9wZXJhdG9yKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9vcGVyYXRvciA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9vcGVyYXRvcjsKCgogICAgCiAgICAjIGluU2NyaXB0OiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfaW5TY3JpcHQgPSBOb25lOwogICAgZGVmIGluU2NyaXB0KHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9pblNjcmlwdCA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9pblNjcmlwdDsKCgogICAgCiAgICAjIG91dFNjcmlwdDogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX291dFNjcmlwdCA9IE5vbmU7CiAgICBkZWYgb3V0U2NyaXB0KHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9vdXRTY3JpcHQgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fb3V0U2NyaXB0OwoKCiAgICAKICAgICMgdG9vbDogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX3Rvb2wgPSBOb25lOwogICAgZGVmIHRvb2woc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX3Rvb2wgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fdG9vbDsKCgogICAgCiAgICAjIGdyb3VwOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfZ3JvdXAgPSBOb25lOwogICAgZGVmIGdyb3VwKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9ncm91cCA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9ncm91cDsKCgogICAgCiAgICAjIHR5cGU6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF90eXBlID0gTm9uZTsKICAgIGRlZiB0eXBlKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl90eXBlID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3R5cGU7CgoKICAgIAogICAgCiAgICBkZWYgX2Zyb21Eb2N1bWVudChzZWxmLCBvYmopOgogICAgICAgIF9fdG9TdHJpbmcgPSAnTWFwcGluZzo6X2Zyb21Eb2N1bWVudCgpOiAnOwogICAgICAgIAogICAgICAgIGlmIG9iaiBpcyBOb25lOgogICAgICAgICAgICByZXR1cm4gc2VsZjsKCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIGJ5dGVzKToKICAgICAgICAgICAgb2JqID0gc3RyKG9iaiwgInV0Zi04Iik7CiAgICAgICAgCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIHN0cikgb3IgdHlwZShvYmopIGlzIHN0cjoKICAgICAgICAgICAgaWYgcmUubWF0Y2gociIoKChbQS1aYS16XXszLDl9Oig/OlwvXC8pPykoPzpbLTs6Jj1cK1wkLFx3XStAKT9bQS1aYS16MC05Li1dK3woPzp3d3cufFstOzomPVwrXCQsXHddK0ApW0EtWmEtejAtOS4tXSspKCg/OlwvW1wrfiVcLy5cd1wtX10qKT9cPz8oPzpbLVwrPSY7JUAuXHdfXSopIz8oPzpbXHddKikpPykiLCBvYmopOgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIG9iaiA9IGpzb24ubG9hZHModXJsbGliMy5Qb29sTWFuYWdlcigpLnJlcXVlc3QoJ0dFVCcsIG9iaikuZGF0YS5kZWNvZGUoJ3V0Zi04JykpOwogICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgIG9iaiA9IHt9OwogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgb2JqID0ganNvbi5sb2FkcyhvYmopOwogICAgICAgIAogICAgICAgIGlmIG5vdCBpc2luc3RhbmNlKG9iaiwgKHN0ciwgYnl0ZXMsIGRpY3QpKToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICdHT1QgSEVSRTogJyArIHN0cih0eXBlKG9iaikpKTsKICAgICAgICAgICAgcmV0dXJuIG9iajsKCiAgICAgICAgICAgIGZvciBpIGluIG9iajoKICAgICAgICAgICAgICAgIG9ialtpXSA9IE1hcHBpbmcoKS5fZnJvbURvY3VtZW50KG9ialtpXSk7CiAgICAgICAgICAgIHJldHVybiBvYmo7CgoKICAgICAgICBpZiAnSWQnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5JZCA9IG9ialsnSWQnXTsKCiAgICAKICAgICAgICBpZiAnYWN0aXZlJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuYWN0aXZlKG9ialsnYWN0aXZlJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ2VuYWJsZWQnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5lbmFibGVkKG9ialsnZW5hYmxlZCddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdvcmRlcicgaW4gb2JqOgogICAgICAgICAgICBzZWxmLm9yZGVyKG9ialsnb3JkZXInXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnY2xhc3NOYW1lJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuY2xhc3NOYW1lKG9ialsnY2xhc3NOYW1lJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ3Njb3BlJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuc2NvcGUob2JqWydzY29wZSddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdjb250ZXh0JyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuY29udGV4dChvYmpbJ2NvbnRleHQnXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnc291cmNlJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuc291cmNlKG9ialsnc291cmNlJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ3RhcmdldCcgaW4gb2JqOgogICAgICAgICAgICBzZWxmLnRhcmdldChvYmpbJ3RhcmdldCddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdvcGVyYXRvcicgaW4gb2JqOgogICAgICAgICAgICBzZWxmLm9wZXJhdG9yKG9ialsnb3BlcmF0b3InXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnaW5TY3JpcHQnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5pblNjcmlwdChvYmpbJ2luU2NyaXB0J10pOwogICAgICAgIAogICAgICAgICAgICBzZWxmLmluU2NyaXB0KCBiYXNlNjQuYjY0ZGVjb2RlKHNlbGYuaW5TY3JpcHQoKSkgKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdvdXRTY3JpcHQnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5vdXRTY3JpcHQob2JqWydvdXRTY3JpcHQnXSk7CiAgICAgICAgCiAgICAgICAgICAgIHNlbGYub3V0U2NyaXB0KCBiYXNlNjQuYjY0ZGVjb2RlKHNlbGYub3V0U2NyaXB0KCkpICk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAndG9vbCcgaW4gb2JqOgogICAgICAgICAgICBzZWxmLnRvb2woVG9vbCgpLl9mcm9tRG9jdW1lbnQob2JqWyd0b29sJ10pKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdncm91cCcgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmdyb3VwKENvbmZpZ19Hcm91cCgpLl9mcm9tRG9jdW1lbnQob2JqWydncm91cCddKSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAndHlwZScgaW4gb2JqOgogICAgICAgICAgICBzZWxmLnR5cGUoVG9vbF9UeXBlKCkuX2Zyb21Eb2N1bWVudChvYmpbJ3R5cGUnXSkpOwogICAgICAgIAogICAgCgogICAgICAgIGdjLmNvbGxlY3QoKTsKICAgICAgICByZXR1cm4gc2VsZjsKICAgIAogICAgZGVmIF90b0RvY3VtZW50KHNlbGYsIGJKU09OPU5vbmUpOgogICAgICAgIF9fdG9TdHJpbmcgPSAnTWFwcGluZzo6X3RvRG9jdW1lbnQoKTogJzsKCiAgICAgICAgcmV0ID0ge307CiAgICAgICAgaWYgc2VsZi5JZCBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJJZCJdID0gc2VsZi5JZDsKCiAgICAKICAgICAgICBpZiBzZWxmLmFjdGl2ZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbImFjdGl2ZSJdID0gc2VsZi5hY3RpdmUoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYuZW5hYmxlZCgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbImVuYWJsZWQiXSA9IHNlbGYuZW5hYmxlZCgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5vcmRlcigpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbIm9yZGVyIl0gPSBzZWxmLm9yZGVyKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLmNsYXNzTmFtZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbImNsYXNzTmFtZSJdID0gc2VsZi5jbGFzc05hbWUoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYuc2NvcGUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJzY29wZSJdID0gc2VsZi5zY29wZSgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5jb250ZXh0KCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiY29udGV4dCJdID0gc2VsZi5jb250ZXh0KCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLnNvdXJjZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbInNvdXJjZSJdID0gc2VsZi5zb3VyY2UoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYudGFyZ2V0KCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsidGFyZ2V0Il0gPSBzZWxmLnRhcmdldCgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5vcGVyYXRvcigpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbIm9wZXJhdG9yIl0gPSBzZWxmLm9wZXJhdG9yKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLmluU2NyaXB0KCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiaW5TY3JpcHQiXSA9IHNlbGYuaW5TY3JpcHQoKTsKICAgICAgICAKICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShyZXRbImluU2NyaXB0Il0sIGRpY3QpOgogICAgICAgICAgICAgICAgcmV0WyJpblNjcmlwdCJdID0ganNvbi5kdW1wcyhyZXRbImluU2NyaXB0Il0pLmVuY29kZSgndXRmLTgnKTsKCiAgICAgICAgICAgIHJldFsiaW5TY3JpcHQiXSA9ICBiYXNlNjQuYjY0ZW5jb2RlKHJldFsiaW5TY3JpcHQiXSkuZGVjb2RlKCd1dGYtOCcpLnN0cmlwKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLm91dFNjcmlwdCgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbIm91dFNjcmlwdCJdID0gc2VsZi5vdXRTY3JpcHQoKTsKICAgICAgICAKICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShyZXRbIm91dFNjcmlwdCJdLCBkaWN0KToKICAgICAgICAgICAgICAgIHJldFsib3V0U2NyaXB0Il0gPSBqc29uLmR1bXBzKHJldFsib3V0U2NyaXB0Il0pLmVuY29kZSgndXRmLTgnKTsKCiAgICAgICAgICAgIHJldFsib3V0U2NyaXB0Il0gPSAgYmFzZTY0LmI2NGVuY29kZShyZXRbIm91dFNjcmlwdCJdKS5kZWNvZGUoJ3V0Zi04Jykuc3RyaXAoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYudG9vbCgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbInRvb2wiXSA9IHNlbGYudG9vbCgpLl90b0RvY3VtZW50KCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLmdyb3VwKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiZ3JvdXAiXSA9IHNlbGYuZ3JvdXAoKS5fdG9Eb2N1bWVudCgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi50eXBlKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsidHlwZSJdID0gc2VsZi50eXBlKCkuX3RvRG9jdW1lbnQoKTsKICAgICAgICAKICAgIAogICAgICAgIAogICAgICAgIGlmIGJKU09OIGlzIG5vdCBOb25lOgogICAgICAgICAgICAjcHJpbnQoX190b1N0cmluZyArICJHT1QgSEVSRSIsIHR5cGUocmV0KSwgcmV0KTsKICAgICAgICAgICAgcmV0ID0ganNvbi5kdW1wcyhyZXQpOwogICAgICAgIGdjLmNvbGxlY3QoKTsKICAgICAgICByZXR1cm4gcmV0OwoKICAgIAogICAgZGVmIHN0b3JlKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6CiAgICAgICAgX190b1N0cmluZyA9ICdNYXBwaW5nOjpzdG9yZSgpOiAnOwogICAgICAgIAogICAgICAgIGV2SlNPTiA9IE5vbmU7CgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIGV2SlNPTiA9IGpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOwogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046CiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7CiAgICAgICAgCgogICAgICAgIGFuc3dlciA9IE5vbmU7CgogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aW1lKCkpKyddLk1hcHBpbmcuc3RvcmUoKScpLm1ldGhvZCgnc3RvcmUnKS5jbGFzc05hbWUoJ01hcHBpbmcnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7CiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKEV2ZW50KG5hbWU9X19ldmVudC5uYW1lKCksIGNvZGU9X19ldmVudC5jb2RlKCkpKTsKICAgICAgICAKICAgICAgICBnYy5jb2xsZWN0KCk7CgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsKCiAgICAgICAgCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7CiAgICAgICAgCiAgICAgICAgICAgIGFuc3dlciA9IE1hcHBpbmcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7CiAgICAgICAgCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsKCgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsKCiAgICAgICAgICAgIAogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsKICAgICAgICAgICAgCgogICAgICAgIHJldHVybiBhbnN3ZXI7CgogICAgCiAgICBkZWYgZmluZEFsbChzZWxmLCBfX2V2ZW50PU5vbmUpOgogICAgICAgIF9fdG9TdHJpbmcgPSAnTWFwcGluZzo6ZmluZEFsbCgpOiAnOwogICAgICAgIAogICAgICAgIGV2SlNPTiA9IE5vbmU7CgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIGV2SlNPTiA9IGpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOwogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046CiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7CiAgICAgICAgCgogICAgICAgIGFuc3dlciA9IE5vbmU7CgogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aW1lKCkpKyddLk1hcHBpbmcuZmluZEFsbCgpJykubWV0aG9kKCdmaW5kQWxsJykuY2xhc3NOYW1lKCdNYXBwaW5nJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOwogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhFdmVudChuYW1lPV9fZXZlbnQubmFtZSgpLCBjb2RlPV9fZXZlbnQuY29kZSgpKSk7CiAgICAgICAgCiAgICAgICAgZ2MuY29sbGVjdCgpOwoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7CgogICAgICAgIAogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOwogICAgICAgIAogICAgICAgICAgICBhbnN3ZXIgPSBNYXBwaW5nKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOwogICAgICAgIAoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7CgoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOgogICAgICAgICAgICAKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7CgogICAgICAgICAgICAKICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7CiAgICAgICAgICAgIAoKICAgICAgICByZXR1cm4gYW5zd2VyOwoKICAgIAogICAgZGVmIGZpbmQoc2VsZiwgX19ldmVudD1Ob25lKToKICAgICAgICBfX3RvU3RyaW5nID0gJ01hcHBpbmc6OmZpbmQoKTogJzsKICAgICAgICAKICAgICAgICBldkpTT04gPSBOb25lOwoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBldkpTT04gPSBqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsKICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOgogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOwogICAgICAgIAoKICAgICAgICBhbnN3ZXIgPSBOb25lOwoKICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGltZSgpKSsnXS5NYXBwaW5nLmZpbmQoKScpLm1ldGhvZCgnZmluZCcpLmNsYXNzTmFtZSgnTWFwcGluZycpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oRXZlbnQobmFtZT1fX2V2ZW50Lm5hbWUoKSwgY29kZT1fX2V2ZW50LmNvZGUoKSkpOwogICAgICAgIAogICAgICAgIGdjLmNvbGxlY3QoKTsKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOwoKICAgICAgICAKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsKICAgICAgICAKICAgICAgICAgICAgYW5zd2VyID0gTWFwcGluZygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsKICAgICAgICAKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOwoKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOwogICAgICAgICAgICAKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOwoKICAgICAgICAgICAgCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOwogICAgICAgICAgICAKCiAgICAgICAgcmV0dXJuIGFuc3dlcjsKCiAgICAKCgoKCgogICAgCm5jb2RlID0gaGV4KHV1aWQuZ2V0bm9kZSgpKTsKICAgIAoKbm9kZSA9IE5vZGUoY29kZT1uY29kZSwgcGFyZW50PU5vZGUoY29kZT0nYXBpc2VydmVyL2VzcHRlc3QvbWFzdGVyJykpOwoKCiMjIyMjIyMjIyMjIE1RVFQgQ29ubmVjdGlvbiAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwpwcmludCgnbWFpbigpJywgIkNvbm5lY3RpbmcgdG8gTVFUVCBzZXJ2ZXIiLCAiLi4uICIsIGVuZD0iIik7Cm1xdHRfdG9waWMgPSAnYXBpc2VydmVyL2VzcHRlc3QnOwoKbXF0dF9jbGllbnQgPSBwYWhvLm1xdHQuY2xpZW50LkNsaWVudChjYWxsYmFja19hcGlfdmVyc2lvbj1wYWhvLm1xdHQuY2xpZW50LkNhbGxiYWNrQVBJVmVyc2lvbi5WRVJTSU9OMiwgY2xpZW50X2lkPW1xdHRfdG9waWMrJy8nK25vZGUuY29kZSgpLCB0cmFuc3BvcnQ9J3RjcCcpOwoKbXF0dF9jbGllbnQub25fbWVzc2FnZSA9IGxhbWJkYSBjbGllbnQsIHVzZXJkYXRhLCBvTXNnIDogRXZlbnQoKS5fZnJvbURvY3VtZW50KG9Nc2cucGF5bG9hZCkucHJvY2VzcygpOwptcXR0X2NsaWVudC5jb25uZWN0KCd0ZXN0Lm1vc3F1aXR0by5vcmcnKTsKCgptcXR0X2NsaWVudC5zdWJzY3JpYmUobXF0dF90b3BpYyk7CnByaW50KCJDb25uZWN0ZWQhIik7CiMjIyMjIyMjIyMjIE1RVFQgQ29ubmVjdGlvbiAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwoKCiMjIyMjIyMjIyMgQ0hFQ0sgRk9SIFVQREFURVMgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwpiYXNlX3VybCA9ICJodHRwczovL2Fyemhvc3BpdGFsLmdpdGh1Yi5pby9lc3B0ZXN0L05vZGVfVHlwZS9QeXRob24uanNvbiI7CnRocmVhZGluZy5UaHJlYWQodGFyZ2V0PWxhbWJkYSA6IE5vZGVfVHlwZSgpLm5hbWUoIlB5dGhvbiIpLmRhdGUoZGF0ZXRpbWUuZGF0ZXRpbWUubm93KGRhdGV0aW1lLnRpbWV6b25lLnV0YykpLmZpbmQoKSkuc3RhcnQoKTsKIyMjIyMjIyMjIyBDSEVDSyBGT1IgVVBEQVRFUyAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCgoKbm9kZS5zdG9yZSgpOwoKcHJpbnQoJ21haW4oKScsICdsb29waW5nIGZvciBtcXR0IGV2ZW50cycpOwoKbXF0dF9jbGllbnQubG9vcF9mb3JldmVyKCk7CgoK",
	"__keys": ["name"],
	"__trMap": []
}