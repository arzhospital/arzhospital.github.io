{
	"Id": "6f58b1f4c4120f90280bf6b5e0029f56a11990bf",
	"active": "true",
	"enabled": "true",
	"code": "micropython",
	"date": "2024-10-09T16:08:22.698Z",
	"name": "MicroPython",
	"remark": "IyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiMjIyMjIyMjIyMjIyMjIyMjIyMjICAgQVBJIFNlcnZlciBTdHViIGZvciAoTWljcm8pUHl0aG9uICAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwojIyMjIyMjIyMjIyMjIyMjIyMjIyBWRVJTSU9OOiAyMDI0LTEwLTA5VDE2OjA4OjE4Ljc4MlogICMjIyMjIyMjIyMjIyMjIyMjIyMjCiMjIyMjIyMjIyMjIyMjIyMjIyMjICBTWVNURU06IGFwaXNlcnZlci9lc3B0ZXN0ICAgICAjIyMjIyMjIyMjIyMjIyMjIyMjIwojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKCgoKI2ltcG9ydCB1cmxsaWIzLCBqc29uLCBiYXNlNjQ7CiNleGVjKGJhc2U2NC5iNjRkZWNvZGUoanNvbi5sb2Fkcyh1cmxsaWIzLlBvb2xNYW5hZ2VyKCkucmVxdWVzdCgnR0VUJywgImh0dHBzOi8vYXJ6aG9zcGl0YWwuZ2l0aHViLmlvL2VzcHRlc3QvTm9kZV9UeXBlL01pY3JvUHl0aG9uLmpzb24iKS5kYXRhLmRlY29kZSgndXRmLTgnKSlbInJlbWFyayJdKSk7CgojIGltcG9ydCByZXF1ZXN0cywgdWJpbmFzY2lpLCB1anNvbjsKIyBleGVjKHViaW5hc2NpaS5hMmJfYmFzZTY0KHVqc29uLmxvYWRzKHJlcXVlc3RzLmdldCgiaHR0cHM6Ly9hcnpob3NwaXRhbC5naXRodWIuaW8vZXNwdGVzdC9Ob2RlX1R5cGUvTWljcm9QeXRob24uanNvbiIpLnRleHQpWyJyZW1hcmsiXSkpOwoKaW1wb3J0IHVtcXR0LnNpbXBsZSxuZXR3b3JrLHViaW5hc2NpaSx1anNvbixtYWNoaW5lLGRlZmxhdGUsdGltZSxnYyxpbyxyZSxvcyxzeXM7CgoKY2xhc3MgVXNlcigpOgogICAgZGVmIF9faW5pdF9fKHNlbGYsIElkPU5vbmUsIGFjdGl2ZT1Ob25lLCBlbmFibGVkPU5vbmUsIGNvZGU9Tm9uZSwgb3JkZXI9Tm9uZSwgZGF0ZT1Ob25lLCBuYW1lPU5vbmUsIHJlbWFyaz1Ob25lLCB1c2VybmFtZT1Ob25lLCBwYXNzd29yZD1Ob25lKToKICAgICAgICBzdXBlcigpLl9faW5pdF9fKCk7CgogICAgICAgICNwcmludCgnVXNlcjo6X19pbml0X18oKScpOwogICAgICAgIGlmIElkIGlzIG5vdCBOb25lOgogICAgICAgICAgICBzZWxmLklkID0gSWQ7CgogICAgICAgIAogICAgICAgIHNlbGYuYWN0aXZlKGFjdGl2ZSk7CiAgICAgICAgc2VsZi5lbmFibGVkKGVuYWJsZWQpOwogICAgICAgIHNlbGYuY29kZShjb2RlKTsKICAgICAgICBzZWxmLm9yZGVyKG9yZGVyKTsKICAgICAgICBzZWxmLmRhdGUoZGF0ZSk7CiAgICAgICAgc2VsZi5uYW1lKG5hbWUpOwogICAgICAgIHNlbGYucmVtYXJrKHJlbWFyayk7CiAgICAgICAgc2VsZi51c2VybmFtZSh1c2VybmFtZSk7CiAgICAgICAgc2VsZi5wYXNzd29yZChwYXNzd29yZCk7CiAgICAgICAgCiAgICBJZCA9IE5vbmU7CiAgICAKICAgIAogICAgIyBhY3RpdmU6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9hY3RpdmUgPSBOb25lOwogICAgZGVmIGFjdGl2ZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fYWN0aXZlID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2FjdGl2ZTsKICAgIAogICAgIyBlbmFibGVkOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfZW5hYmxlZCA9IE5vbmU7CiAgICBkZWYgZW5hYmxlZChzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fZW5hYmxlZCA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9lbmFibGVkOwogICAgCiAgICAjIGNvZGU6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9jb2RlID0gTm9uZTsKICAgIGRlZiBjb2RlKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9jb2RlID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2NvZGU7CiAgICAKICAgICMgb3JkZXI6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9vcmRlciA9IE5vbmU7CiAgICBkZWYgb3JkZXIoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX29yZGVyID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX29yZGVyOwogICAgCiAgICAjIGRhdGU6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9kYXRlID0gTm9uZTsKICAgIGRlZiBkYXRlKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9kYXRlID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2RhdGU7CiAgICAKICAgICMgbmFtZTogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX25hbWUgPSBOb25lOwogICAgZGVmIG5hbWUoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX25hbWUgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fbmFtZTsKICAgIAogICAgIyByZW1hcms6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9yZW1hcmsgPSBOb25lOwogICAgZGVmIHJlbWFyayhzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fcmVtYXJrID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3JlbWFyazsKICAgIAogICAgIyB1c2VybmFtZTogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX3VzZXJuYW1lID0gTm9uZTsKICAgIGRlZiB1c2VybmFtZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fdXNlcm5hbWUgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fdXNlcm5hbWU7CiAgICAKICAgICMgcGFzc3dvcmQ6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9wYXNzd29yZCA9IE5vbmU7CiAgICBkZWYgcGFzc3dvcmQoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX3Bhc3N3b3JkID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3Bhc3N3b3JkOwogICAgCiAgICAKICAgIAogICAgCiAgICBkZWYgX3VuaXF1ZShzZWxmKToKICAgICAgICBfX3RvU3RyaW5nID0gJ1VzZXI6Ol91bmlxdWUoKTogJzsKICAgICAgICAKICAgICAgICByZXQgPSBVc2VyKCk7CiAgICAgICAgaWYgc2VsZi5JZCBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0LklkID0gc2VsZi5JZDsKICAgIAogICAgICAgIGlmIHNlbGYuY29kZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXQuY29kZShzZWxmLmNvZGUoKSk7CiAgICAKICAgICAgICBpZiBzZWxmLnVzZXJuYW1lKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldC51c2VybmFtZShzZWxmLnVzZXJuYW1lKCkpOwogICAgCiAgICAgICAgZ2MuY29sbGVjdCgpOwogICAgICAgIHJldHVybiByZXQ7CiAgICAKICAgIGRlZiBfZnJvbURvY3VtZW50KHNlbGYsIG9iaik6CiAgICAgICAgX190b1N0cmluZyA9ICdVc2VyOjpfZnJvbURvY3VtZW50KCk6ICc7CiAgICAgICAgCiAgICAgICAgaWYgb2JqIGlzIE5vbmU6CiAgICAgICAgICAgIHJldHVybiBzZWxmOwoKICAgICAgICBpZiBpc2luc3RhbmNlKG9iaiwgYnl0ZXMpOgogICAgICAgICAgICBvYmogPSBzdHIob2JqLCAidXRmLTgiKTsKCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIHN0cikgb3IgdHlwZShvYmopIGlzIHN0cjoKICAgICAgICAgICAgaWYgcmUubWF0Y2gociIoKChbQS1aYS16XXszLDl9Oig/OlwvXC8pPykoPzpbLTs6Jj1cK1wkLFx3XStAKT9bQS1aYS16MC05Li1dK3woPzp3d3cufFstOzomPVwrXCQsXHddK0ApW0EtWmEtejAtOS4tXSspKCg/OlwvW1wrfiVcLy5cd1wtX10qKT9cPz8oPzpbLVwrPSY7JUAuXHdfXSopIz8oPzpbXHddKikpPykiLCBvYmopOgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIG9iaiA9IHVqc29uLmxvYWRzKHVybGxpYjMuUG9vbE1hbmFnZXIoKS5yZXF1ZXN0KCdHRVQnLCBvYmopLmRhdGEuZGVjb2RlKCd1dGYtOCcpKTsKICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICBvYmogPSB7fTsKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIG9iaiA9IHVqc29uLmxvYWRzKG9iaik7CiAgICAgICAgCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIGxpc3QpOgogICAgICAgICAgICByZXR1cm4gW1VzZXIoKS5fZnJvbURvY3VtZW50KG8pIGZvciBvIGluIG9ial07CiAgICAgICAgICAgIAogICAgICAgIGlmIG5vdCBpc2luc3RhbmNlKG9iaiwgKHN0ciwgYnl0ZXMsIGRpY3QpKToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICd1bmhhbmRsZWQgdHlwZTogJyArIHN0cih0eXBlKG9iaikpKTsKICAgICAgICAgICAgcmV0dXJuIG9iajsKCiAgICAgICAgaWYgJ0lkJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuSWQgPSBvYmpbJ0lkJ107CgogICAgCiAgICAgICAgaWYgJ2FjdGl2ZScgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmFjdGl2ZShvYmpbJ2FjdGl2ZSddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdlbmFibGVkJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuZW5hYmxlZChvYmpbJ2VuYWJsZWQnXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnY29kZScgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmNvZGUob2JqWydjb2RlJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ29yZGVyJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYub3JkZXIob2JqWydvcmRlciddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdkYXRlJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuZGF0ZShvYmpbJ2RhdGUnXSk7CiAgICAgICAgCiAgICAgICAgICAgIHNlbGYuZGF0ZShkYXRldGltZS5kYXRldGltZS5mcm9taXNvZm9ybWF0KHNlbGYuZGF0ZSgpKSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnbmFtZScgaW4gb2JqOgogICAgICAgICAgICBzZWxmLm5hbWUob2JqWyduYW1lJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ3JlbWFyaycgaW4gb2JqOgogICAgICAgICAgICBzZWxmLnJlbWFyayhvYmpbJ3JlbWFyayddKTsKICAgICAgICAKICAgICAgICAgICAgc2VsZi5yZW1hcmsoIHViaW5hc2NpaS5hMmJfYmFzZTY0KHNlbGYucmVtYXJrKCkpICk7CiAgICAgICAgICAgIGlmIHNlbGYucmVtYXJrKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5yZW1hcmsoc2VsZi5yZW1hcmsoKS5kZWNvZGUoJ3V0Zi04Jykuc3RyaXAoKSk7CiAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5yZW1hcmsoKTsKICAgICAgICAgICAgICAgICAgICAjcHJpbnQoX190b1N0cmluZyArICJyZW1hcmsgZXhjZXB0aW9uIiwgc2VsZi5yZW1hcmsoKSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAndXNlcm5hbWUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi51c2VybmFtZShvYmpbJ3VzZXJuYW1lJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ3Bhc3N3b3JkJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYucGFzc3dvcmQob2JqWydwYXNzd29yZCddKTsKICAgICAgICAKICAgIAoKICAgIAoKICAgICAgICBnYy5jb2xsZWN0KCk7CiAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAKICAgIGRlZiBfdG9Eb2N1bWVudChzZWxmLCBiSlNPTj1Ob25lKToKICAgICAgICBfX3RvU3RyaW5nID0gJ1VzZXI6Ol90b0RvY3VtZW50KCk6ICc7CgogICAgICAgIHJldCA9IHt9OwogICAgICAgIGlmIHNlbGYuSWQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiSWQiXSA9IHNlbGYuSWQ7CgogICAgCiAgICAgICAgaWYgc2VsZi5hY3RpdmUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJhY3RpdmUiXSA9IHNlbGYuYWN0aXZlKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLmVuYWJsZWQoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJlbmFibGVkIl0gPSBzZWxmLmVuYWJsZWQoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYuY29kZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbImNvZGUiXSA9IHNlbGYuY29kZSgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5vcmRlcigpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbIm9yZGVyIl0gPSBzZWxmLm9yZGVyKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLmRhdGUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJkYXRlIl0gPSBzZWxmLmRhdGUoKTsKICAgICAgICAKICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShyZXRbImRhdGUiXSwgZGF0ZXRpbWUuZGF0ZXRpbWUpOgogICAgICAgICAgICAgICAgcmV0WyJkYXRlIl0gPSByZXRbImRhdGUiXS5pc29mb3JtYXQoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYubmFtZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbIm5hbWUiXSA9IHNlbGYubmFtZSgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5yZW1hcmsoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IHNlbGYucmVtYXJrKCk7CiAgICAgICAgCiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UocmV0WyJyZW1hcmsiXSwgZGljdCk6CiAgICAgICAgICAgICAgICByZXRbInJlbWFyayJdID0gdWpzb24uZHVtcHMocmV0WyJyZW1hcmsiXSkuZW5jb2RlKCd1dGYtOCcpOwoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9ICB1YmluYXNjaWkuYjJhX2Jhc2U2NChyZXRbInJlbWFyayJdKS5kZWNvZGUoJ3V0Zi04Jykuc3RyaXAoKTsKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGNlcHRpb24gd2l0aCByZW1hcms6ICIgKyByZXRbInJlbWFyayJdKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYudXNlcm5hbWUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJ1c2VybmFtZSJdID0gc2VsZi51c2VybmFtZSgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5wYXNzd29yZCgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbInBhc3N3b3JkIl0gPSBzZWxmLnBhc3N3b3JkKCk7CiAgICAgICAgCiAgICAKICAgICAgICAKICAgIAoKICAgICAgICBpZiBiSlNPTiBpcyBub3QgTm9uZToKICAgICAgICAgICAgI3ByaW50KF9fdG9TdHJpbmcgKyAiR09UIEhFUkUiLCB0eXBlKHJldCksIHJldCk7CiAgICAgICAgICAgIHJldCA9IHVqc29uLmR1bXBzKHJldCk7CiAgICAgICAgZ2MuY29sbGVjdCgpOwogICAgICAgIHJldHVybiByZXQ7CgogICAgCiAgICBkZWYgc3RvcmUoc2VsZiwgX19ldmVudD1Ob25lKToKICAgICAgICBfX3RvU3RyaW5nID0gJ1VzZXI6OnN0b3JlKCk6ICc7CiAgICAgICAgCiAgICAgICAgZXZKU09OID0gTm9uZTsKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgZXZKU09OID0gdWpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOwogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046CiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7CiAgICAgICAgCgogICAgICAgIGFuc3dlciA9IE5vbmU7CgogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aWNrc19tcygpKSsnXS5Vc2VyLnN0b3JlKCknKS5tZXRob2QoJ3N0b3JlJykuY2xhc3NOYW1lKCdVc2VyJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOwogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7CiAgICAgICAgCiAgICAgICAgZ2MuY29sbGVjdCgpOwoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7CgogICAgICAgIAogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOwogICAgICAgIAogICAgICAgICAgICBhbnN3ZXIgPSBVc2VyKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOwogICAgICAgIAoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7CgoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOgogICAgICAgICAgICAKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7CgogICAgICAgICAgICAKICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7CiAgICAgICAgICAgIAoKICAgICAgICByZXR1cm4gYW5zd2VyOwoKICAgIAogICAgZGVmIGZpbmRBbGwoc2VsZiwgX19ldmVudD1Ob25lKToKICAgICAgICBfX3RvU3RyaW5nID0gJ1VzZXI6OmZpbmRBbGwoKTogJzsKICAgICAgICAKICAgICAgICBldkpTT04gPSBOb25lOwoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBldkpTT04gPSB1anNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7CiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoKICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsKICAgICAgICAKCiAgICAgICAgYW5zd2VyID0gTm9uZTsKCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpY2tzX21zKCkpKyddLlVzZXIuZmluZEFsbCgpJykubWV0aG9kKCdmaW5kQWxsJykuY2xhc3NOYW1lKCdVc2VyJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOwogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7CiAgICAgICAgCiAgICAgICAgZ2MuY29sbGVjdCgpOwoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7CgogICAgICAgIAogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOwogICAgICAgIAogICAgICAgICAgICBhbnN3ZXIgPSBVc2VyKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOwogICAgICAgIAoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7CgoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOgogICAgICAgICAgICAKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7CgogICAgICAgICAgICAKICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7CiAgICAgICAgICAgIAoKICAgICAgICByZXR1cm4gYW5zd2VyOwoKICAgIAogICAgZGVmIGZpbmQoc2VsZiwgX19ldmVudD1Ob25lKToKICAgICAgICBfX3RvU3RyaW5nID0gJ1VzZXI6OmZpbmQoKTogJzsKICAgICAgICAKICAgICAgICBldkpTT04gPSBOb25lOwoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBldkpTT04gPSB1anNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7CiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoKICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsKICAgICAgICAKCiAgICAgICAgYW5zd2VyID0gTm9uZTsKCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpY2tzX21zKCkpKyddLlVzZXIuZmluZCgpJykubWV0aG9kKCdmaW5kJykuY2xhc3NOYW1lKCdVc2VyJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOwogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7CiAgICAgICAgCiAgICAgICAgZ2MuY29sbGVjdCgpOwoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7CgogICAgICAgIAogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOwogICAgICAgIAogICAgICAgICAgICBhbnN3ZXIgPSBVc2VyKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOwogICAgICAgIAoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7CgoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOgogICAgICAgICAgICAKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7CgogICAgICAgICAgICAKICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7CiAgICAgICAgICAgIAoKICAgICAgICByZXR1cm4gYW5zd2VyOwoKICAgIAogICAgZGVmIGluaXQoc2VsZiwgX19ldmVudD1Ob25lKToKICAgICAgICBfX3RvU3RyaW5nID0gJ1VzZXI6OmluaXQoKTogJzsKICAgICAgICAKICAgICAgICBldkpTT04gPSBOb25lOwoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBldkpTT04gPSB1anNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7CiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoKICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsKICAgICAgICAKCiAgICAgICAgYW5zd2VyID0gTm9uZTsKCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpY2tzX21zKCkpKyddLlVzZXIuaW5pdCgpJykubWV0aG9kKCdpbml0JykuY2xhc3NOYW1lKCdVc2VyJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOwogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7CiAgICAgICAgCiAgICAgICAgZ2MuY29sbGVjdCgpOwoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7CgogICAgICAgIAogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOwogICAgICAgIAogICAgICAgICAgICBhbnN3ZXIgPSBldkpTT047CiAgICAgICAgCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsKCgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHN0cihhbnN3ZXIpKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsKCiAgICAgICAgICAgIAogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsKICAgICAgICAgICAgCgogICAgICAgIHJldHVybiBhbnN3ZXI7CgogICAgCgoKY2xhc3MgTWV0cmljKCk6CiAgICBkZWYgX19pbml0X18oc2VsZiwgSWQ9Tm9uZSwgYWN0aXZlPU5vbmUsIGVuYWJsZWQ9Tm9uZSwgY29kZT1Ob25lLCBvcmRlcj1Ob25lLCBkYXRlPU5vbmUsIG5hbWU9Tm9uZSwgcmVtYXJrPU5vbmUsIHNjcmlwdD1Ob25lLCB0eXBlPU5vbmUsIGRldmljZVR5cGU9Tm9uZSk6CiAgICAgICAgc3VwZXIoKS5fX2luaXRfXygpOwoKICAgICAgICAjcHJpbnQoJ01ldHJpYzo6X19pbml0X18oKScpOwogICAgICAgIGlmIElkIGlzIG5vdCBOb25lOgogICAgICAgICAgICBzZWxmLklkID0gSWQ7CgogICAgICAgIAogICAgICAgIHNlbGYuYWN0aXZlKGFjdGl2ZSk7CiAgICAgICAgc2VsZi5lbmFibGVkKGVuYWJsZWQpOwogICAgICAgIHNlbGYuY29kZShjb2RlKTsKICAgICAgICBzZWxmLm9yZGVyKG9yZGVyKTsKICAgICAgICBzZWxmLmRhdGUoZGF0ZSk7CiAgICAgICAgc2VsZi5uYW1lKG5hbWUpOwogICAgICAgIHNlbGYucmVtYXJrKHJlbWFyayk7CiAgICAgICAgc2VsZi5zY3JpcHQoc2NyaXB0KTsKICAgICAgICBzZWxmLnR5cGUodHlwZSk7CiAgICAgICAgc2VsZi5kZXZpY2VUeXBlKGRldmljZVR5cGUpOwogICAgICAgIAogICAgSWQgPSBOb25lOwogICAgCiAgICAKICAgICMgYWN0aXZlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfYWN0aXZlID0gTm9uZTsKICAgIGRlZiBhY3RpdmUoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2FjdGl2ZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9hY3RpdmU7CiAgICAKICAgICMgZW5hYmxlZDogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX2VuYWJsZWQgPSBOb25lOwogICAgZGVmIGVuYWJsZWQoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2VuYWJsZWQgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fZW5hYmxlZDsKICAgIAogICAgIyBjb2RlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfY29kZSA9IE5vbmU7CiAgICBkZWYgY29kZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fY29kZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9jb2RlOwogICAgCiAgICAjIG9yZGVyOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfb3JkZXIgPSBOb25lOwogICAgZGVmIG9yZGVyKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9vcmRlciA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9vcmRlcjsKICAgIAogICAgIyBkYXRlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfZGF0ZSA9IE5vbmU7CiAgICBkZWYgZGF0ZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fZGF0ZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9kYXRlOwogICAgCiAgICAjIG5hbWU6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9uYW1lID0gTm9uZTsKICAgIGRlZiBuYW1lKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9uYW1lID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX25hbWU7CiAgICAKICAgICMgcmVtYXJrOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfcmVtYXJrID0gTm9uZTsKICAgIGRlZiByZW1hcmsoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX3JlbWFyayA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9yZW1hcms7CiAgICAKICAgICMgc2NyaXB0OiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfc2NyaXB0ID0gTm9uZTsKICAgIGRlZiBzY3JpcHQoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX3NjcmlwdCA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9zY3JpcHQ7CiAgICAKICAgICMgdHlwZTogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX3R5cGUgPSBOb25lOwogICAgZGVmIHR5cGUoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX3R5cGUgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fdHlwZTsKICAgIAogICAgIyBkZXZpY2VUeXBlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfZGV2aWNlVHlwZSA9IE5vbmU7CiAgICBkZWYgZGV2aWNlVHlwZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fZGV2aWNlVHlwZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9kZXZpY2VUeXBlOwogICAgCiAgICAKICAgIAogICAgIyBtZXRyaWNfTWV0cmljX1ZhbHVlczogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX21ldHJpY19NZXRyaWNfVmFsdWVzID0gTm9uZTsKICAgIGRlZiBtZXRyaWNfTWV0cmljX1ZhbHVlcyhzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fbWV0cmljX01ldHJpY19WYWx1ZXMgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fbWV0cmljX01ldHJpY19WYWx1ZXM7CiAgICAKICAgIAogICAgZGVmIF91bmlxdWUoc2VsZik6CiAgICAgICAgX190b1N0cmluZyA9ICdNZXRyaWM6Ol91bmlxdWUoKTogJzsKICAgICAgICAKICAgICAgICByZXQgPSBNZXRyaWMoKTsKICAgICAgICBpZiBzZWxmLklkIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXQuSWQgPSBzZWxmLklkOwogICAgCiAgICAgICAgaWYgc2VsZi5jb2RlKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldC5jb2RlKHNlbGYuY29kZSgpKTsKICAgIAogICAgICAgIGdjLmNvbGxlY3QoKTsKICAgICAgICByZXR1cm4gcmV0OwogICAgCiAgICBkZWYgX2Zyb21Eb2N1bWVudChzZWxmLCBvYmopOgogICAgICAgIF9fdG9TdHJpbmcgPSAnTWV0cmljOjpfZnJvbURvY3VtZW50KCk6ICc7CiAgICAgICAgCiAgICAgICAgaWYgb2JqIGlzIE5vbmU6CiAgICAgICAgICAgIHJldHVybiBzZWxmOwoKICAgICAgICBpZiBpc2luc3RhbmNlKG9iaiwgYnl0ZXMpOgogICAgICAgICAgICBvYmogPSBzdHIob2JqLCAidXRmLTgiKTsKCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIHN0cikgb3IgdHlwZShvYmopIGlzIHN0cjoKICAgICAgICAgICAgaWYgcmUubWF0Y2gociIoKChbQS1aYS16XXszLDl9Oig/OlwvXC8pPykoPzpbLTs6Jj1cK1wkLFx3XStAKT9bQS1aYS16MC05Li1dK3woPzp3d3cufFstOzomPVwrXCQsXHddK0ApW0EtWmEtejAtOS4tXSspKCg/OlwvW1wrfiVcLy5cd1wtX10qKT9cPz8oPzpbLVwrPSY7JUAuXHdfXSopIz8oPzpbXHddKikpPykiLCBvYmopOgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIG9iaiA9IHVqc29uLmxvYWRzKHVybGxpYjMuUG9vbE1hbmFnZXIoKS5yZXF1ZXN0KCdHRVQnLCBvYmopLmRhdGEuZGVjb2RlKCd1dGYtOCcpKTsKICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICBvYmogPSB7fTsKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIG9iaiA9IHVqc29uLmxvYWRzKG9iaik7CiAgICAgICAgCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIGxpc3QpOgogICAgICAgICAgICByZXR1cm4gW01ldHJpYygpLl9mcm9tRG9jdW1lbnQobykgZm9yIG8gaW4gb2JqXTsKICAgICAgICAgICAgCiAgICAgICAgaWYgbm90IGlzaW5zdGFuY2Uob2JqLCAoc3RyLCBieXRlcywgZGljdCkpOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJ3VuaGFuZGxlZCB0eXBlOiAnICsgc3RyKHR5cGUob2JqKSkpOwogICAgICAgICAgICByZXR1cm4gb2JqOwoKICAgICAgICBpZiAnSWQnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5JZCA9IG9ialsnSWQnXTsKCiAgICAKICAgICAgICBpZiAnYWN0aXZlJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuYWN0aXZlKG9ialsnYWN0aXZlJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ2VuYWJsZWQnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5lbmFibGVkKG9ialsnZW5hYmxlZCddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdjb2RlJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuY29kZShvYmpbJ2NvZGUnXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnb3JkZXInIGluIG9iajoKICAgICAgICAgICAgc2VsZi5vcmRlcihvYmpbJ29yZGVyJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ2RhdGUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5kYXRlKG9ialsnZGF0ZSddKTsKICAgICAgICAKICAgICAgICAgICAgc2VsZi5kYXRlKGRhdGV0aW1lLmRhdGV0aW1lLmZyb21pc29mb3JtYXQoc2VsZi5kYXRlKCkpKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICduYW1lJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYubmFtZShvYmpbJ25hbWUnXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAncmVtYXJrJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYucmVtYXJrKG9ialsncmVtYXJrJ10pOwogICAgICAgIAogICAgICAgICAgICBzZWxmLnJlbWFyayggdWJpbmFzY2lpLmEyYl9iYXNlNjQoc2VsZi5yZW1hcmsoKSkgKTsKICAgICAgICAgICAgaWYgc2VsZi5yZW1hcmsoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBzZWxmLnJlbWFyayhzZWxmLnJlbWFyaygpLmRlY29kZSgndXRmLTgnKS5zdHJpcCgpKTsKICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICBzZWxmLnJlbWFyaygpOwogICAgICAgICAgICAgICAgICAgICNwcmludChfX3RvU3RyaW5nICsgInJlbWFyayBleGNlcHRpb24iLCBzZWxmLnJlbWFyaygpKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdzY3JpcHQnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5zY3JpcHQob2JqWydzY3JpcHQnXSk7CiAgICAgICAgCiAgICAgICAgICAgIHNlbGYuc2NyaXB0KCB1YmluYXNjaWkuYTJiX2Jhc2U2NChzZWxmLnNjcmlwdCgpKSApOwogICAgICAgICAgICBpZiBzZWxmLnNjcmlwdCgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIHNlbGYuc2NyaXB0KHNlbGYuc2NyaXB0KCkuZGVjb2RlKCd1dGYtOCcpLnN0cmlwKCkpOwogICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgIHNlbGYuc2NyaXB0KCk7CiAgICAgICAgICAgICAgICAgICAgI3ByaW50KF9fdG9TdHJpbmcgKyAic2NyaXB0IGV4Y2VwdGlvbiIsIHNlbGYuc2NyaXB0KCkpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ3R5cGUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi50eXBlKE1ldHJpY19UeXBlKCkuX2Zyb21Eb2N1bWVudChvYmpbJ3R5cGUnXSkpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ2RldmljZVR5cGUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5kZXZpY2VUeXBlKERldmljZV9UeXBlKCkuX2Zyb21Eb2N1bWVudChvYmpbJ2RldmljZVR5cGUnXSkpOwogICAgICAgIAogICAgCgogICAgCiAgICAgICAgaWYgJ21ldHJpY19NZXRyaWNfVmFsdWVzJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYubWV0cmljX01ldHJpY19WYWx1ZXMoTWV0cmljX1ZhbHVlKCkuX2Zyb21Eb2N1bWVudChvYmpbJ21ldHJpY19NZXRyaWNfVmFsdWVzJ10pKTsKICAgIAoKICAgICAgICBnYy5jb2xsZWN0KCk7CiAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAKICAgIGRlZiBfdG9Eb2N1bWVudChzZWxmLCBiSlNPTj1Ob25lKToKICAgICAgICBfX3RvU3RyaW5nID0gJ01ldHJpYzo6X3RvRG9jdW1lbnQoKTogJzsKCiAgICAgICAgcmV0ID0ge307CiAgICAgICAgaWYgc2VsZi5JZCBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJJZCJdID0gc2VsZi5JZDsKCiAgICAKICAgICAgICBpZiBzZWxmLmFjdGl2ZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbImFjdGl2ZSJdID0gc2VsZi5hY3RpdmUoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYuZW5hYmxlZCgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbImVuYWJsZWQiXSA9IHNlbGYuZW5hYmxlZCgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5jb2RlKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiY29kZSJdID0gc2VsZi5jb2RlKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLm9yZGVyKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsib3JkZXIiXSA9IHNlbGYub3JkZXIoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYuZGF0ZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbImRhdGUiXSA9IHNlbGYuZGF0ZSgpOwogICAgICAgIAogICAgICAgICAgICBpZiBpc2luc3RhbmNlKHJldFsiZGF0ZSJdLCBkYXRldGltZS5kYXRldGltZSk6CiAgICAgICAgICAgICAgICByZXRbImRhdGUiXSA9IHJldFsiZGF0ZSJdLmlzb2Zvcm1hdCgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5uYW1lKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsibmFtZSJdID0gc2VsZi5uYW1lKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLnJlbWFyaygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbInJlbWFyayJdID0gc2VsZi5yZW1hcmsoKTsKICAgICAgICAKICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShyZXRbInJlbWFyayJdLCBkaWN0KToKICAgICAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSB1anNvbi5kdW1wcyhyZXRbInJlbWFyayJdKS5lbmNvZGUoJ3V0Zi04Jyk7CgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICByZXRbInJlbWFyayJdID0gIHViaW5hc2NpaS5iMmFfYmFzZTY0KHJldFsicmVtYXJrIl0pLmRlY29kZSgndXRmLTgnKS5zdHJpcCgpOwogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4Y2VwdGlvbiB3aXRoIHJlbWFyazogIiArIHJldFsicmVtYXJrIl0pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5zY3JpcHQoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJzY3JpcHQiXSA9IHNlbGYuc2NyaXB0KCk7CiAgICAgICAgCiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UocmV0WyJzY3JpcHQiXSwgZGljdCk6CiAgICAgICAgICAgICAgICByZXRbInNjcmlwdCJdID0gdWpzb24uZHVtcHMocmV0WyJzY3JpcHQiXSkuZW5jb2RlKCd1dGYtOCcpOwoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgcmV0WyJzY3JpcHQiXSA9ICB1YmluYXNjaWkuYjJhX2Jhc2U2NChyZXRbInNjcmlwdCJdKS5kZWNvZGUoJ3V0Zi04Jykuc3RyaXAoKTsKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGNlcHRpb24gd2l0aCBzY3JpcHQ6ICIgKyByZXRbInNjcmlwdCJdKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYudHlwZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbInR5cGUiXSA9IHNlbGYudHlwZSgpLl90b0RvY3VtZW50KCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLmRldmljZVR5cGUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJkZXZpY2VUeXBlIl0gPSBzZWxmLmRldmljZVR5cGUoKS5fdG9Eb2N1bWVudCgpOwogICAgICAgIAogICAgCiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLm1ldHJpY19NZXRyaWNfVmFsdWVzKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsibWV0cmljX01ldHJpY19WYWx1ZXMiXSA9IFt0YS5fdG9Eb2N1bWVudCgpIGZvciB0YSBpbiBzZWxmLm1ldHJpY19NZXRyaWNfVmFsdWVzKCldOwogICAgCgogICAgICAgIGlmIGJKU09OIGlzIG5vdCBOb25lOgogICAgICAgICAgICAjcHJpbnQoX190b1N0cmluZyArICJHT1QgSEVSRSIsIHR5cGUocmV0KSwgcmV0KTsKICAgICAgICAgICAgcmV0ID0gdWpzb24uZHVtcHMocmV0KTsKICAgICAgICBnYy5jb2xsZWN0KCk7CiAgICAgICAgcmV0dXJuIHJldDsKCiAgICAKICAgIGRlZiBzdG9yZShzZWxmLCBfX2V2ZW50PU5vbmUpOgogICAgICAgIF9fdG9TdHJpbmcgPSAnTWV0cmljOjpzdG9yZSgpOiAnOwogICAgICAgIAogICAgICAgIGV2SlNPTiA9IE5vbmU7CgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIGV2SlNPTiA9IHVqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsKICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOgogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOwogICAgICAgIAoKICAgICAgICBhbnN3ZXIgPSBOb25lOwoKICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGlja3NfbXMoKSkrJ10uTWV0cmljLnN0b3JlKCknKS5tZXRob2QoJ3N0b3JlJykuY2xhc3NOYW1lKCdNZXRyaWMnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7CiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTsKICAgICAgICAKICAgICAgICBnYy5jb2xsZWN0KCk7CgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsKCiAgICAgICAgCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7CiAgICAgICAgCiAgICAgICAgICAgIGFuc3dlciA9IE1ldHJpYygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsKICAgICAgICAKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOwoKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOwogICAgICAgICAgICAKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOwoKICAgICAgICAgICAgCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOwogICAgICAgICAgICAKCiAgICAgICAgcmV0dXJuIGFuc3dlcjsKCiAgICAKICAgIGRlZiBmaW5kQWxsKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6CiAgICAgICAgX190b1N0cmluZyA9ICdNZXRyaWM6OmZpbmRBbGwoKTogJzsKICAgICAgICAKICAgICAgICBldkpTT04gPSBOb25lOwoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBldkpTT04gPSB1anNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7CiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoKICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsKICAgICAgICAKCiAgICAgICAgYW5zd2VyID0gTm9uZTsKCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpY2tzX21zKCkpKyddLk1ldHJpYy5maW5kQWxsKCknKS5tZXRob2QoJ2ZpbmRBbGwnKS5jbGFzc05hbWUoJ01ldHJpYycpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpOwogICAgICAgIAogICAgICAgIGdjLmNvbGxlY3QoKTsKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOwoKICAgICAgICAKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsKICAgICAgICAKICAgICAgICAgICAgYW5zd2VyID0gTWV0cmljKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOwogICAgICAgIAoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7CgoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOgogICAgICAgICAgICAKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7CgogICAgICAgICAgICAKICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7CiAgICAgICAgICAgIAoKICAgICAgICByZXR1cm4gYW5zd2VyOwoKICAgIAogICAgZGVmIGZpbmQoc2VsZiwgX19ldmVudD1Ob25lKToKICAgICAgICBfX3RvU3RyaW5nID0gJ01ldHJpYzo6ZmluZCgpOiAnOwogICAgICAgIAogICAgICAgIGV2SlNPTiA9IE5vbmU7CgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIGV2SlNPTiA9IHVqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsKICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOgogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOwogICAgICAgIAoKICAgICAgICBhbnN3ZXIgPSBOb25lOwoKICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGlja3NfbXMoKSkrJ10uTWV0cmljLmZpbmQoKScpLm1ldGhvZCgnZmluZCcpLmNsYXNzTmFtZSgnTWV0cmljJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOwogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7CiAgICAgICAgCiAgICAgICAgZ2MuY29sbGVjdCgpOwoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7CgogICAgICAgIAogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOwogICAgICAgIAogICAgICAgICAgICBhbnN3ZXIgPSBNZXRyaWMoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7CiAgICAgICAgCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsKCgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsKCiAgICAgICAgICAgIAogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsKICAgICAgICAgICAgCgogICAgICAgIHJldHVybiBhbnN3ZXI7CgogICAgCgoKY2xhc3MgTWV0cmljX1ZhbHVlKCk6CiAgICBkZWYgX19pbml0X18oc2VsZiwgSWQ9Tm9uZSwgYWN0aXZlPU5vbmUsIGVuYWJsZWQ9Tm9uZSwgY29kZT1Ob25lLCBvcmRlcj1Ob25lLCBkYXRlPU5vbmUsIG5hbWU9Tm9uZSwgcmVtYXJrPU5vbmUsIHZhbHVlPU5vbmUsIG1lYXN1cmVkPU5vbmUsIG1ldHJpYz1Ob25lLCBkZXZpY2U9Tm9uZSk6CiAgICAgICAgc3VwZXIoKS5fX2luaXRfXygpOwoKICAgICAgICAjcHJpbnQoJ01ldHJpY19WYWx1ZTo6X19pbml0X18oKScpOwogICAgICAgIGlmIElkIGlzIG5vdCBOb25lOgogICAgICAgICAgICBzZWxmLklkID0gSWQ7CgogICAgICAgIAogICAgICAgIHNlbGYuYWN0aXZlKGFjdGl2ZSk7CiAgICAgICAgc2VsZi5lbmFibGVkKGVuYWJsZWQpOwogICAgICAgIHNlbGYuY29kZShjb2RlKTsKICAgICAgICBzZWxmLm9yZGVyKG9yZGVyKTsKICAgICAgICBzZWxmLmRhdGUoZGF0ZSk7CiAgICAgICAgc2VsZi5uYW1lKG5hbWUpOwogICAgICAgIHNlbGYucmVtYXJrKHJlbWFyayk7CiAgICAgICAgc2VsZi52YWx1ZSh2YWx1ZSk7CiAgICAgICAgc2VsZi5tZWFzdXJlZChtZWFzdXJlZCk7CiAgICAgICAgc2VsZi5tZXRyaWMobWV0cmljKTsKICAgICAgICBzZWxmLmRldmljZShkZXZpY2UpOwogICAgICAgIAogICAgSWQgPSBOb25lOwogICAgCiAgICAKICAgICMgYWN0aXZlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfYWN0aXZlID0gTm9uZTsKICAgIGRlZiBhY3RpdmUoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2FjdGl2ZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9hY3RpdmU7CiAgICAKICAgICMgZW5hYmxlZDogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX2VuYWJsZWQgPSBOb25lOwogICAgZGVmIGVuYWJsZWQoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2VuYWJsZWQgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fZW5hYmxlZDsKICAgIAogICAgIyBjb2RlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfY29kZSA9IE5vbmU7CiAgICBkZWYgY29kZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fY29kZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9jb2RlOwogICAgCiAgICAjIG9yZGVyOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfb3JkZXIgPSBOb25lOwogICAgZGVmIG9yZGVyKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9vcmRlciA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9vcmRlcjsKICAgIAogICAgIyBkYXRlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfZGF0ZSA9IE5vbmU7CiAgICBkZWYgZGF0ZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fZGF0ZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9kYXRlOwogICAgCiAgICAjIG5hbWU6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9uYW1lID0gTm9uZTsKICAgIGRlZiBuYW1lKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9uYW1lID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX25hbWU7CiAgICAKICAgICMgcmVtYXJrOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfcmVtYXJrID0gTm9uZTsKICAgIGRlZiByZW1hcmsoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX3JlbWFyayA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9yZW1hcms7CiAgICAKICAgICMgdmFsdWU6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF92YWx1ZSA9IE5vbmU7CiAgICBkZWYgdmFsdWUoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX3ZhbHVlID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3ZhbHVlOwogICAgCiAgICAjIG1lYXN1cmVkOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfbWVhc3VyZWQgPSBOb25lOwogICAgZGVmIG1lYXN1cmVkKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9tZWFzdXJlZCA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9tZWFzdXJlZDsKICAgIAogICAgIyBtZXRyaWM6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9tZXRyaWMgPSBOb25lOwogICAgZGVmIG1ldHJpYyhzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fbWV0cmljID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX21ldHJpYzsKICAgIAogICAgIyBkZXZpY2U6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9kZXZpY2UgPSBOb25lOwogICAgZGVmIGRldmljZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fZGV2aWNlID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2RldmljZTsKICAgIAogICAgCiAgICAKICAgIAogICAgZGVmIF91bmlxdWUoc2VsZik6CiAgICAgICAgX190b1N0cmluZyA9ICdNZXRyaWNfVmFsdWU6Ol91bmlxdWUoKTogJzsKICAgICAgICAKICAgICAgICByZXQgPSBNZXRyaWNfVmFsdWUoKTsKICAgICAgICBpZiBzZWxmLklkIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXQuSWQgPSBzZWxmLklkOwogICAgCiAgICAgICAgaWYgc2VsZi5tZXRyaWMoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0Lm1ldHJpYyhzZWxmLm1ldHJpYygpLl91bmlxdWUoKSk7CiAgICAKICAgICAgICBpZiBzZWxmLmRldmljZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXQuZGV2aWNlKHNlbGYuZGV2aWNlKCkuX3VuaXF1ZSgpKTsKICAgIAogICAgICAgIGdjLmNvbGxlY3QoKTsKICAgICAgICByZXR1cm4gcmV0OwogICAgCiAgICBkZWYgX2Zyb21Eb2N1bWVudChzZWxmLCBvYmopOgogICAgICAgIF9fdG9TdHJpbmcgPSAnTWV0cmljX1ZhbHVlOjpfZnJvbURvY3VtZW50KCk6ICc7CiAgICAgICAgCiAgICAgICAgaWYgb2JqIGlzIE5vbmU6CiAgICAgICAgICAgIHJldHVybiBzZWxmOwoKICAgICAgICBpZiBpc2luc3RhbmNlKG9iaiwgYnl0ZXMpOgogICAgICAgICAgICBvYmogPSBzdHIob2JqLCAidXRmLTgiKTsKCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIHN0cikgb3IgdHlwZShvYmopIGlzIHN0cjoKICAgICAgICAgICAgaWYgcmUubWF0Y2gociIoKChbQS1aYS16XXszLDl9Oig/OlwvXC8pPykoPzpbLTs6Jj1cK1wkLFx3XStAKT9bQS1aYS16MC05Li1dK3woPzp3d3cufFstOzomPVwrXCQsXHddK0ApW0EtWmEtejAtOS4tXSspKCg/OlwvW1wrfiVcLy5cd1wtX10qKT9cPz8oPzpbLVwrPSY7JUAuXHdfXSopIz8oPzpbXHddKikpPykiLCBvYmopOgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIG9iaiA9IHVqc29uLmxvYWRzKHVybGxpYjMuUG9vbE1hbmFnZXIoKS5yZXF1ZXN0KCdHRVQnLCBvYmopLmRhdGEuZGVjb2RlKCd1dGYtOCcpKTsKICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICBvYmogPSB7fTsKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIG9iaiA9IHVqc29uLmxvYWRzKG9iaik7CiAgICAgICAgCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIGxpc3QpOgogICAgICAgICAgICByZXR1cm4gW01ldHJpY19WYWx1ZSgpLl9mcm9tRG9jdW1lbnQobykgZm9yIG8gaW4gb2JqXTsKICAgICAgICAgICAgCiAgICAgICAgaWYgbm90IGlzaW5zdGFuY2Uob2JqLCAoc3RyLCBieXRlcywgZGljdCkpOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJ3VuaGFuZGxlZCB0eXBlOiAnICsgc3RyKHR5cGUob2JqKSkpOwogICAgICAgICAgICByZXR1cm4gb2JqOwoKICAgICAgICBpZiAnSWQnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5JZCA9IG9ialsnSWQnXTsKCiAgICAKICAgICAgICBpZiAnYWN0aXZlJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuYWN0aXZlKG9ialsnYWN0aXZlJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ2VuYWJsZWQnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5lbmFibGVkKG9ialsnZW5hYmxlZCddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdjb2RlJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuY29kZShvYmpbJ2NvZGUnXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnb3JkZXInIGluIG9iajoKICAgICAgICAgICAgc2VsZi5vcmRlcihvYmpbJ29yZGVyJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ2RhdGUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5kYXRlKG9ialsnZGF0ZSddKTsKICAgICAgICAKICAgICAgICAgICAgc2VsZi5kYXRlKGRhdGV0aW1lLmRhdGV0aW1lLmZyb21pc29mb3JtYXQoc2VsZi5kYXRlKCkpKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICduYW1lJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYubmFtZShvYmpbJ25hbWUnXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAncmVtYXJrJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYucmVtYXJrKG9ialsncmVtYXJrJ10pOwogICAgICAgIAogICAgICAgICAgICBzZWxmLnJlbWFyayggdWJpbmFzY2lpLmEyYl9iYXNlNjQoc2VsZi5yZW1hcmsoKSkgKTsKICAgICAgICAgICAgaWYgc2VsZi5yZW1hcmsoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBzZWxmLnJlbWFyayhzZWxmLnJlbWFyaygpLmRlY29kZSgndXRmLTgnKS5zdHJpcCgpKTsKICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICBzZWxmLnJlbWFyaygpOwogICAgICAgICAgICAgICAgICAgICNwcmludChfX3RvU3RyaW5nICsgInJlbWFyayBleGNlcHRpb24iLCBzZWxmLnJlbWFyaygpKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICd2YWx1ZScgaW4gb2JqOgogICAgICAgICAgICBzZWxmLnZhbHVlKG9ialsndmFsdWUnXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnbWVhc3VyZWQnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5tZWFzdXJlZChvYmpbJ21lYXN1cmVkJ10pOwogICAgICAgIAogICAgICAgICAgICBzZWxmLm1lYXN1cmVkKGRhdGV0aW1lLmRhdGV0aW1lLmZyb21pc29mb3JtYXQoc2VsZi5tZWFzdXJlZCgpKSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnbWV0cmljJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYubWV0cmljKE1ldHJpYygpLl9mcm9tRG9jdW1lbnQob2JqWydtZXRyaWMnXSkpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ2RldmljZScgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmRldmljZShEZXZpY2UoKS5fZnJvbURvY3VtZW50KG9ialsnZGV2aWNlJ10pKTsKICAgICAgICAKICAgIAoKICAgIAoKICAgICAgICBnYy5jb2xsZWN0KCk7CiAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAKICAgIGRlZiBfdG9Eb2N1bWVudChzZWxmLCBiSlNPTj1Ob25lKToKICAgICAgICBfX3RvU3RyaW5nID0gJ01ldHJpY19WYWx1ZTo6X3RvRG9jdW1lbnQoKTogJzsKCiAgICAgICAgcmV0ID0ge307CiAgICAgICAgaWYgc2VsZi5JZCBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJJZCJdID0gc2VsZi5JZDsKCiAgICAKICAgICAgICBpZiBzZWxmLmFjdGl2ZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbImFjdGl2ZSJdID0gc2VsZi5hY3RpdmUoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYuZW5hYmxlZCgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbImVuYWJsZWQiXSA9IHNlbGYuZW5hYmxlZCgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5jb2RlKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiY29kZSJdID0gc2VsZi5jb2RlKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLm9yZGVyKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsib3JkZXIiXSA9IHNlbGYub3JkZXIoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYuZGF0ZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbImRhdGUiXSA9IHNlbGYuZGF0ZSgpOwogICAgICAgIAogICAgICAgICAgICBpZiBpc2luc3RhbmNlKHJldFsiZGF0ZSJdLCBkYXRldGltZS5kYXRldGltZSk6CiAgICAgICAgICAgICAgICByZXRbImRhdGUiXSA9IHJldFsiZGF0ZSJdLmlzb2Zvcm1hdCgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5uYW1lKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsibmFtZSJdID0gc2VsZi5uYW1lKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLnJlbWFyaygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbInJlbWFyayJdID0gc2VsZi5yZW1hcmsoKTsKICAgICAgICAKICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShyZXRbInJlbWFyayJdLCBkaWN0KToKICAgICAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSB1anNvbi5kdW1wcyhyZXRbInJlbWFyayJdKS5lbmNvZGUoJ3V0Zi04Jyk7CgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICByZXRbInJlbWFyayJdID0gIHViaW5hc2NpaS5iMmFfYmFzZTY0KHJldFsicmVtYXJrIl0pLmRlY29kZSgndXRmLTgnKS5zdHJpcCgpOwogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4Y2VwdGlvbiB3aXRoIHJlbWFyazogIiArIHJldFsicmVtYXJrIl0pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi52YWx1ZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbInZhbHVlIl0gPSBzZWxmLnZhbHVlKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLm1lYXN1cmVkKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsibWVhc3VyZWQiXSA9IHNlbGYubWVhc3VyZWQoKTsKICAgICAgICAKICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShyZXRbIm1lYXN1cmVkIl0sIGRhdGV0aW1lLmRhdGV0aW1lKToKICAgICAgICAgICAgICAgIHJldFsibWVhc3VyZWQiXSA9IHJldFsibWVhc3VyZWQiXS5pc29mb3JtYXQoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYubWV0cmljKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsibWV0cmljIl0gPSBzZWxmLm1ldHJpYygpLl90b0RvY3VtZW50KCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLmRldmljZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbImRldmljZSJdID0gc2VsZi5kZXZpY2UoKS5fdG9Eb2N1bWVudCgpOwogICAgICAgIAogICAgCiAgICAgICAgCiAgICAKCiAgICAgICAgaWYgYkpTT04gaXMgbm90IE5vbmU6CiAgICAgICAgICAgICNwcmludChfX3RvU3RyaW5nICsgIkdPVCBIRVJFIiwgdHlwZShyZXQpLCByZXQpOwogICAgICAgICAgICByZXQgPSB1anNvbi5kdW1wcyhyZXQpOwogICAgICAgIGdjLmNvbGxlY3QoKTsKICAgICAgICByZXR1cm4gcmV0OwoKICAgIAogICAgZGVmIHN0b3JlKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6CiAgICAgICAgX190b1N0cmluZyA9ICdNZXRyaWNfVmFsdWU6OnN0b3JlKCk6ICc7CiAgICAgICAgCiAgICAgICAgZXZKU09OID0gTm9uZTsKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgZXZKU09OID0gdWpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOwogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046CiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7CiAgICAgICAgCgogICAgICAgIGFuc3dlciA9IE5vbmU7CgogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aWNrc19tcygpKSsnXS5NZXRyaWNfVmFsdWUuc3RvcmUoKScpLm1ldGhvZCgnc3RvcmUnKS5jbGFzc05hbWUoJ01ldHJpY19WYWx1ZScpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpOwogICAgICAgIAogICAgICAgIGdjLmNvbGxlY3QoKTsKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOwoKICAgICAgICAgICAgaWYgc2VsZi5tZWFzdXJlZCgpIGlzIE5vbmU6CiAgICAgICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgInJlYWRpbmcgIiArIHNlbGYubWV0cmljKCkuY29kZSgpICsgIi4uLiIpOwogICAgICAgICAgICAgICAgZXhlYygiZGVmICIgKyBzZWxmLm1ldHJpYygpLmNvZGUoKSArICIoc2VsZik6IiArIHJlLnN1YigiXG4iLCAiXG4gICAgIiwgcmUuc3ViKCJcciIsICIiLCAiXG4iK3NlbGYubWV0cmljKCkuc2NyaXB0KCkpKSArICJcblxuc2V0YXR0cihNZXRyaWMsICdfIitzZWxmLm1ldHJpYygpLmNvZGUoKSsiJywgIiArIHNlbGYubWV0cmljKCkuY29kZSgpICsgIik7Iik7CiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5fdW5pcXVlKCkudmFsdWUoc3RyKGdldGF0dHIoc2VsZi5tZXRyaWMoKSwgIl8iICsgc2VsZi5tZXRyaWMoKS5jb2RlKCkpKCkpLnN0cmlwKCkpLm1lYXN1cmVkKGRhdGV0aW1lLmRhdGV0aW1lLm5vdygpKS5zdG9yZSgpOwogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJ3cml0aW5nLi4uLCBwcm9iYWJseSBuZXZlciBuZWVkZWQgYW55d2F5ISIpOwogICAgICAgIAogICAgICAgIAogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOwogICAgICAgIAogICAgICAgICAgICBhbnN3ZXIgPSBNZXRyaWNfVmFsdWUoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7CiAgICAgICAgCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsKCgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsKCiAgICAgICAgICAgIAogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsKICAgICAgICAgICAgCgogICAgICAgIHJldHVybiBhbnN3ZXI7CgogICAgCiAgICBkZWYgZmluZEFsbChzZWxmLCBfX2V2ZW50PU5vbmUpOgogICAgICAgIF9fdG9TdHJpbmcgPSAnTWV0cmljX1ZhbHVlOjpmaW5kQWxsKCk6ICc7CiAgICAgICAgCiAgICAgICAgZXZKU09OID0gTm9uZTsKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgZXZKU09OID0gdWpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOwogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046CiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7CiAgICAgICAgCgogICAgICAgIGFuc3dlciA9IE5vbmU7CgogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aWNrc19tcygpKSsnXS5NZXRyaWNfVmFsdWUuZmluZEFsbCgpJykubWV0aG9kKCdmaW5kQWxsJykuY2xhc3NOYW1lKCdNZXRyaWNfVmFsdWUnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7CiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTsKICAgICAgICAKICAgICAgICBnYy5jb2xsZWN0KCk7CgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsKCiAgICAgICAgCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7CiAgICAgICAgCiAgICAgICAgICAgIGFuc3dlciA9IE1ldHJpY19WYWx1ZSgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsKICAgICAgICAKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOwoKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOwogICAgICAgICAgICAKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOwoKICAgICAgICAgICAgCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOwogICAgICAgICAgICAKCiAgICAgICAgcmV0dXJuIGFuc3dlcjsKCiAgICAKICAgIGRlZiBmaW5kKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6CiAgICAgICAgX190b1N0cmluZyA9ICdNZXRyaWNfVmFsdWU6OmZpbmQoKTogJzsKICAgICAgICAKICAgICAgICBldkpTT04gPSBOb25lOwoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBldkpTT04gPSB1anNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7CiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoKICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsKICAgICAgICAKCiAgICAgICAgYW5zd2VyID0gTm9uZTsKCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpY2tzX21zKCkpKyddLk1ldHJpY19WYWx1ZS5maW5kKCknKS5tZXRob2QoJ2ZpbmQnKS5jbGFzc05hbWUoJ01ldHJpY19WYWx1ZScpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpOwogICAgICAgIAogICAgICAgIGdjLmNvbGxlY3QoKTsKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOwoKICAgICAgICAKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsKICAgICAgICAKICAgICAgICAgICAgYW5zd2VyID0gTWV0cmljX1ZhbHVlKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOwogICAgICAgIAoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7CgoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOgogICAgICAgICAgICAKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7CgogICAgICAgICAgICAKICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7CiAgICAgICAgICAgIAoKICAgICAgICByZXR1cm4gYW5zd2VyOwoKICAgIAoKCmNsYXNzIERldmljZSgpOgogICAgZGVmIF9faW5pdF9fKHNlbGYsIElkPU5vbmUsIGFjdGl2ZT1Ob25lLCBlbmFibGVkPU5vbmUsIGNvZGU9Tm9uZSwgb3JkZXI9Tm9uZSwgZGF0ZT1Ob25lLCBuYW1lPU5vbmUsIHJlbWFyaz1Ob25lLCB0eXBlPU5vbmUsIGNvbnRyb2xsZXI9Tm9uZSk6CiAgICAgICAgc3VwZXIoKS5fX2luaXRfXygpOwoKICAgICAgICAjcHJpbnQoJ0RldmljZTo6X19pbml0X18oKScpOwogICAgICAgIGlmIElkIGlzIG5vdCBOb25lOgogICAgICAgICAgICBzZWxmLklkID0gSWQ7CgogICAgICAgIAogICAgICAgIHNlbGYuYWN0aXZlKGFjdGl2ZSk7CiAgICAgICAgc2VsZi5lbmFibGVkKGVuYWJsZWQpOwogICAgICAgIHNlbGYuY29kZShjb2RlKTsKICAgICAgICBzZWxmLm9yZGVyKG9yZGVyKTsKICAgICAgICBzZWxmLmRhdGUoZGF0ZSk7CiAgICAgICAgc2VsZi5uYW1lKG5hbWUpOwogICAgICAgIHNlbGYucmVtYXJrKHJlbWFyayk7CiAgICAgICAgc2VsZi50eXBlKHR5cGUpOwogICAgICAgIHNlbGYuY29udHJvbGxlcihjb250cm9sbGVyKTsKICAgICAgICAKICAgIElkID0gTm9uZTsKICAgIAogICAgCiAgICAjIGFjdGl2ZTogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX2FjdGl2ZSA9IE5vbmU7CiAgICBkZWYgYWN0aXZlKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9hY3RpdmUgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fYWN0aXZlOwogICAgCiAgICAjIGVuYWJsZWQ6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9lbmFibGVkID0gTm9uZTsKICAgIGRlZiBlbmFibGVkKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9lbmFibGVkID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2VuYWJsZWQ7CiAgICAKICAgICMgY29kZTogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX2NvZGUgPSBOb25lOwogICAgZGVmIGNvZGUoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2NvZGUgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fY29kZTsKICAgIAogICAgIyBvcmRlcjogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX29yZGVyID0gTm9uZTsKICAgIGRlZiBvcmRlcihzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fb3JkZXIgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fb3JkZXI7CiAgICAKICAgICMgZGF0ZTogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX2RhdGUgPSBOb25lOwogICAgZGVmIGRhdGUoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2RhdGUgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fZGF0ZTsKICAgIAogICAgIyBuYW1lOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfbmFtZSA9IE5vbmU7CiAgICBkZWYgbmFtZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fbmFtZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9uYW1lOwogICAgCiAgICAjIHJlbWFyazogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX3JlbWFyayA9IE5vbmU7CiAgICBkZWYgcmVtYXJrKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9yZW1hcmsgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fcmVtYXJrOwogICAgCiAgICAjIHR5cGU6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF90eXBlID0gTm9uZTsKICAgIGRlZiB0eXBlKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl90eXBlID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3R5cGU7CiAgICAKICAgICMgY29udHJvbGxlcjogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX2NvbnRyb2xsZXIgPSBOb25lOwogICAgZGVmIGNvbnRyb2xsZXIoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2NvbnRyb2xsZXIgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fY29udHJvbGxlcjsKICAgIAogICAgCiAgICAKICAgICMgZGV2aWNlX01ldHJpY19WYWx1ZXM6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9kZXZpY2VfTWV0cmljX1ZhbHVlcyA9IE5vbmU7CiAgICBkZWYgZGV2aWNlX01ldHJpY19WYWx1ZXMoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2RldmljZV9NZXRyaWNfVmFsdWVzID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2RldmljZV9NZXRyaWNfVmFsdWVzOwogICAgCiAgICAKICAgIGRlZiBfdW5pcXVlKHNlbGYpOgogICAgICAgIF9fdG9TdHJpbmcgPSAnRGV2aWNlOjpfdW5pcXVlKCk6ICc7CiAgICAgICAgCiAgICAgICAgcmV0ID0gRGV2aWNlKCk7CiAgICAgICAgaWYgc2VsZi5JZCBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0LklkID0gc2VsZi5JZDsKICAgIAogICAgICAgIGlmIHNlbGYuY29kZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXQuY29kZShzZWxmLmNvZGUoKSk7CiAgICAKICAgICAgICBnYy5jb2xsZWN0KCk7CiAgICAgICAgcmV0dXJuIHJldDsKICAgIAogICAgZGVmIF9mcm9tRG9jdW1lbnQoc2VsZiwgb2JqKToKICAgICAgICBfX3RvU3RyaW5nID0gJ0RldmljZTo6X2Zyb21Eb2N1bWVudCgpOiAnOwogICAgICAgIAogICAgICAgIGlmIG9iaiBpcyBOb25lOgogICAgICAgICAgICByZXR1cm4gc2VsZjsKCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIGJ5dGVzKToKICAgICAgICAgICAgb2JqID0gc3RyKG9iaiwgInV0Zi04Iik7CgogICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLCBzdHIpIG9yIHR5cGUob2JqKSBpcyBzdHI6CiAgICAgICAgICAgIGlmIHJlLm1hdGNoKHIiKCgoW0EtWmEtel17Myw5fTooPzpcL1wvKT8pKD86Wy07OiY9XCtcJCxcd10rQCk/W0EtWmEtejAtOS4tXSt8KD86d3d3LnxbLTs6Jj1cK1wkLFx3XStAKVtBLVphLXowLTkuLV0rKSgoPzpcL1tcK34lXC8uXHdcLV9dKik/XD8/KD86Wy1cKz0mOyVALlx3X10qKSM/KD86W1x3XSopKT8pIiwgb2JqKToKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBvYmogPSB1anNvbi5sb2Fkcyh1cmxsaWIzLlBvb2xNYW5hZ2VyKCkucmVxdWVzdCgnR0VUJywgb2JqKS5kYXRhLmRlY29kZSgndXRmLTgnKSk7CiAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgb2JqID0ge307CiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBvYmogPSB1anNvbi5sb2FkcyhvYmopOwogICAgICAgIAogICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLCBsaXN0KToKICAgICAgICAgICAgcmV0dXJuIFtEZXZpY2UoKS5fZnJvbURvY3VtZW50KG8pIGZvciBvIGluIG9ial07CiAgICAgICAgICAgIAogICAgICAgIGlmIG5vdCBpc2luc3RhbmNlKG9iaiwgKHN0ciwgYnl0ZXMsIGRpY3QpKToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICd1bmhhbmRsZWQgdHlwZTogJyArIHN0cih0eXBlKG9iaikpKTsKICAgICAgICAgICAgcmV0dXJuIG9iajsKCiAgICAgICAgaWYgJ0lkJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuSWQgPSBvYmpbJ0lkJ107CgogICAgCiAgICAgICAgaWYgJ2FjdGl2ZScgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmFjdGl2ZShvYmpbJ2FjdGl2ZSddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdlbmFibGVkJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuZW5hYmxlZChvYmpbJ2VuYWJsZWQnXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnY29kZScgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmNvZGUob2JqWydjb2RlJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ29yZGVyJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYub3JkZXIob2JqWydvcmRlciddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdkYXRlJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuZGF0ZShvYmpbJ2RhdGUnXSk7CiAgICAgICAgCiAgICAgICAgICAgIHNlbGYuZGF0ZShkYXRldGltZS5kYXRldGltZS5mcm9taXNvZm9ybWF0KHNlbGYuZGF0ZSgpKSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnbmFtZScgaW4gb2JqOgogICAgICAgICAgICBzZWxmLm5hbWUob2JqWyduYW1lJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ3JlbWFyaycgaW4gb2JqOgogICAgICAgICAgICBzZWxmLnJlbWFyayhvYmpbJ3JlbWFyayddKTsKICAgICAgICAKICAgICAgICAgICAgc2VsZi5yZW1hcmsoIHViaW5hc2NpaS5hMmJfYmFzZTY0KHNlbGYucmVtYXJrKCkpICk7CiAgICAgICAgICAgIGlmIHNlbGYucmVtYXJrKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5yZW1hcmsoc2VsZi5yZW1hcmsoKS5kZWNvZGUoJ3V0Zi04Jykuc3RyaXAoKSk7CiAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5yZW1hcmsoKTsKICAgICAgICAgICAgICAgICAgICAjcHJpbnQoX190b1N0cmluZyArICJyZW1hcmsgZXhjZXB0aW9uIiwgc2VsZi5yZW1hcmsoKSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAndHlwZScgaW4gb2JqOgogICAgICAgICAgICBzZWxmLnR5cGUoRGV2aWNlX1R5cGUoKS5fZnJvbURvY3VtZW50KG9ialsndHlwZSddKSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnY29udHJvbGxlcicgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmNvbnRyb2xsZXIoTm9kZSgpLl9mcm9tRG9jdW1lbnQob2JqWydjb250cm9sbGVyJ10pKTsKICAgICAgICAKICAgIAoKICAgIAogICAgICAgIGlmICdkZXZpY2VfTWV0cmljX1ZhbHVlcycgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmRldmljZV9NZXRyaWNfVmFsdWVzKE1ldHJpY19WYWx1ZSgpLl9mcm9tRG9jdW1lbnQob2JqWydkZXZpY2VfTWV0cmljX1ZhbHVlcyddKSk7CiAgICAKCiAgICAgICAgZ2MuY29sbGVjdCgpOwogICAgICAgIHJldHVybiBzZWxmOwogICAgCiAgICBkZWYgX3RvRG9jdW1lbnQoc2VsZiwgYkpTT049Tm9uZSk6CiAgICAgICAgX190b1N0cmluZyA9ICdEZXZpY2U6Ol90b0RvY3VtZW50KCk6ICc7CgogICAgICAgIHJldCA9IHt9OwogICAgICAgIGlmIHNlbGYuSWQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiSWQiXSA9IHNlbGYuSWQ7CgogICAgCiAgICAgICAgaWYgc2VsZi5hY3RpdmUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJhY3RpdmUiXSA9IHNlbGYuYWN0aXZlKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLmVuYWJsZWQoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJlbmFibGVkIl0gPSBzZWxmLmVuYWJsZWQoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYuY29kZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbImNvZGUiXSA9IHNlbGYuY29kZSgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5vcmRlcigpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbIm9yZGVyIl0gPSBzZWxmLm9yZGVyKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLmRhdGUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJkYXRlIl0gPSBzZWxmLmRhdGUoKTsKICAgICAgICAKICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShyZXRbImRhdGUiXSwgZGF0ZXRpbWUuZGF0ZXRpbWUpOgogICAgICAgICAgICAgICAgcmV0WyJkYXRlIl0gPSByZXRbImRhdGUiXS5pc29mb3JtYXQoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYubmFtZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbIm5hbWUiXSA9IHNlbGYubmFtZSgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5yZW1hcmsoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IHNlbGYucmVtYXJrKCk7CiAgICAgICAgCiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UocmV0WyJyZW1hcmsiXSwgZGljdCk6CiAgICAgICAgICAgICAgICByZXRbInJlbWFyayJdID0gdWpzb24uZHVtcHMocmV0WyJyZW1hcmsiXSkuZW5jb2RlKCd1dGYtOCcpOwoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9ICB1YmluYXNjaWkuYjJhX2Jhc2U2NChyZXRbInJlbWFyayJdKS5kZWNvZGUoJ3V0Zi04Jykuc3RyaXAoKTsKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGNlcHRpb24gd2l0aCByZW1hcms6ICIgKyByZXRbInJlbWFyayJdKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYudHlwZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbInR5cGUiXSA9IHNlbGYudHlwZSgpLl90b0RvY3VtZW50KCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLmNvbnRyb2xsZXIoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJjb250cm9sbGVyIl0gPSBzZWxmLmNvbnRyb2xsZXIoKS5fdG9Eb2N1bWVudCgpOwogICAgICAgIAogICAgCiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLmRldmljZV9NZXRyaWNfVmFsdWVzKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiZGV2aWNlX01ldHJpY19WYWx1ZXMiXSA9IFt0YS5fdG9Eb2N1bWVudCgpIGZvciB0YSBpbiBzZWxmLmRldmljZV9NZXRyaWNfVmFsdWVzKCldOwogICAgCgogICAgICAgIGlmIGJKU09OIGlzIG5vdCBOb25lOgogICAgICAgICAgICAjcHJpbnQoX190b1N0cmluZyArICJHT1QgSEVSRSIsIHR5cGUocmV0KSwgcmV0KTsKICAgICAgICAgICAgcmV0ID0gdWpzb24uZHVtcHMocmV0KTsKICAgICAgICBnYy5jb2xsZWN0KCk7CiAgICAgICAgcmV0dXJuIHJldDsKCiAgICAKICAgIGRlZiBzdG9yZShzZWxmLCBfX2V2ZW50PU5vbmUpOgogICAgICAgIF9fdG9TdHJpbmcgPSAnRGV2aWNlOjpzdG9yZSgpOiAnOwogICAgICAgIAogICAgICAgIGV2SlNPTiA9IE5vbmU7CgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIGV2SlNPTiA9IHVqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsKICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOgogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOwogICAgICAgIAoKICAgICAgICBhbnN3ZXIgPSBOb25lOwoKICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGlja3NfbXMoKSkrJ10uRGV2aWNlLnN0b3JlKCknKS5tZXRob2QoJ3N0b3JlJykuY2xhc3NOYW1lKCdEZXZpY2UnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7CiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTsKICAgICAgICAKICAgICAgICBnYy5jb2xsZWN0KCk7CgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsKCiAgICAgICAgCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7CiAgICAgICAgCiAgICAgICAgICAgIGFuc3dlciA9IERldmljZSgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsKICAgICAgICAKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOwoKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOwogICAgICAgICAgICAKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOwoKICAgICAgICAgICAgCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOwogICAgICAgICAgICAKCiAgICAgICAgcmV0dXJuIGFuc3dlcjsKCiAgICAKICAgIGRlZiBmaW5kQWxsKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6CiAgICAgICAgX190b1N0cmluZyA9ICdEZXZpY2U6OmZpbmRBbGwoKTogJzsKICAgICAgICAKICAgICAgICBldkpTT04gPSBOb25lOwoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBldkpTT04gPSB1anNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7CiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoKICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsKICAgICAgICAKCiAgICAgICAgYW5zd2VyID0gTm9uZTsKCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpY2tzX21zKCkpKyddLkRldmljZS5maW5kQWxsKCknKS5tZXRob2QoJ2ZpbmRBbGwnKS5jbGFzc05hbWUoJ0RldmljZScpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpOwogICAgICAgIAogICAgICAgIGdjLmNvbGxlY3QoKTsKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOwoKICAgICAgICAKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsKICAgICAgICAKICAgICAgICAgICAgYW5zd2VyID0gRGV2aWNlKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOwogICAgICAgIAoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7CgoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOgogICAgICAgICAgICAKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7CgogICAgICAgICAgICAKICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7CiAgICAgICAgICAgIAoKICAgICAgICByZXR1cm4gYW5zd2VyOwoKICAgIAogICAgZGVmIGZpbmQoc2VsZiwgX19ldmVudD1Ob25lKToKICAgICAgICBfX3RvU3RyaW5nID0gJ0RldmljZTo6ZmluZCgpOiAnOwogICAgICAgIAogICAgICAgIGV2SlNPTiA9IE5vbmU7CgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIGV2SlNPTiA9IHVqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsKICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOgogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOwogICAgICAgIAoKICAgICAgICBhbnN3ZXIgPSBOb25lOwoKICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGlja3NfbXMoKSkrJ10uRGV2aWNlLmZpbmQoKScpLm1ldGhvZCgnZmluZCcpLmNsYXNzTmFtZSgnRGV2aWNlJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOwogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7CiAgICAgICAgCiAgICAgICAgZ2MuY29sbGVjdCgpOwoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7CgogICAgICAgIAogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOwogICAgICAgIAogICAgICAgICAgICBhbnN3ZXIgPSBEZXZpY2UoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7CiAgICAgICAgCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsKCgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsKCiAgICAgICAgICAgIAogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsKICAgICAgICAgICAgCgogICAgICAgIHJldHVybiBhbnN3ZXI7CgogICAgCgoKY2xhc3MgRGV2aWNlX0NhdGVnb3J5KCk6CiAgICBkZWYgX19pbml0X18oc2VsZiwgSWQ9Tm9uZSwgYWN0aXZlPU5vbmUsIGVuYWJsZWQ9Tm9uZSwgY29kZT1Ob25lLCBvcmRlcj1Ob25lLCBkYXRlPU5vbmUsIG5hbWU9Tm9uZSwgcmVtYXJrPU5vbmUsIHBhcmVudD1Ob25lKToKICAgICAgICBzdXBlcigpLl9faW5pdF9fKCk7CgogICAgICAgICNwcmludCgnRGV2aWNlX0NhdGVnb3J5OjpfX2luaXRfXygpJyk7CiAgICAgICAgaWYgSWQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHNlbGYuSWQgPSBJZDsKCiAgICAgICAgCiAgICAgICAgc2VsZi5hY3RpdmUoYWN0aXZlKTsKICAgICAgICBzZWxmLmVuYWJsZWQoZW5hYmxlZCk7CiAgICAgICAgc2VsZi5jb2RlKGNvZGUpOwogICAgICAgIHNlbGYub3JkZXIob3JkZXIpOwogICAgICAgIHNlbGYuZGF0ZShkYXRlKTsKICAgICAgICBzZWxmLm5hbWUobmFtZSk7CiAgICAgICAgc2VsZi5yZW1hcmsocmVtYXJrKTsKICAgICAgICBzZWxmLnBhcmVudChwYXJlbnQpOwogICAgICAgIAogICAgSWQgPSBOb25lOwogICAgCiAgICAKICAgICMgYWN0aXZlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfYWN0aXZlID0gTm9uZTsKICAgIGRlZiBhY3RpdmUoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2FjdGl2ZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9hY3RpdmU7CiAgICAKICAgICMgZW5hYmxlZDogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX2VuYWJsZWQgPSBOb25lOwogICAgZGVmIGVuYWJsZWQoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2VuYWJsZWQgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fZW5hYmxlZDsKICAgIAogICAgIyBjb2RlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfY29kZSA9IE5vbmU7CiAgICBkZWYgY29kZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fY29kZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9jb2RlOwogICAgCiAgICAjIG9yZGVyOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfb3JkZXIgPSBOb25lOwogICAgZGVmIG9yZGVyKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9vcmRlciA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9vcmRlcjsKICAgIAogICAgIyBkYXRlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfZGF0ZSA9IE5vbmU7CiAgICBkZWYgZGF0ZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fZGF0ZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9kYXRlOwogICAgCiAgICAjIG5hbWU6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9uYW1lID0gTm9uZTsKICAgIGRlZiBuYW1lKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9uYW1lID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX25hbWU7CiAgICAKICAgICMgcmVtYXJrOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfcmVtYXJrID0gTm9uZTsKICAgIGRlZiByZW1hcmsoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX3JlbWFyayA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9yZW1hcms7CiAgICAKICAgICMgcGFyZW50OiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfcGFyZW50ID0gTm9uZTsKICAgIGRlZiBwYXJlbnQoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX3BhcmVudCA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9wYXJlbnQ7CiAgICAKICAgIAogICAgCiAgICAjIGNhdGVnb3J5X0RldmljZV9UeXBlczogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX2NhdGVnb3J5X0RldmljZV9UeXBlcyA9IE5vbmU7CiAgICBkZWYgY2F0ZWdvcnlfRGV2aWNlX1R5cGVzKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9jYXRlZ29yeV9EZXZpY2VfVHlwZXMgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fY2F0ZWdvcnlfRGV2aWNlX1R5cGVzOwogICAgCiAgICAKICAgIGRlZiBfdW5pcXVlKHNlbGYpOgogICAgICAgIF9fdG9TdHJpbmcgPSAnRGV2aWNlX0NhdGVnb3J5OjpfdW5pcXVlKCk6ICc7CiAgICAgICAgCiAgICAgICAgcmV0ID0gRGV2aWNlX0NhdGVnb3J5KCk7CiAgICAgICAgaWYgc2VsZi5JZCBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0LklkID0gc2VsZi5JZDsKICAgIAogICAgICAgIGlmIHNlbGYuY29kZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXQuY29kZShzZWxmLmNvZGUoKSk7CiAgICAKICAgICAgICBnYy5jb2xsZWN0KCk7CiAgICAgICAgcmV0dXJuIHJldDsKICAgIAogICAgZGVmIF9mcm9tRG9jdW1lbnQoc2VsZiwgb2JqKToKICAgICAgICBfX3RvU3RyaW5nID0gJ0RldmljZV9DYXRlZ29yeTo6X2Zyb21Eb2N1bWVudCgpOiAnOwogICAgICAgIAogICAgICAgIGlmIG9iaiBpcyBOb25lOgogICAgICAgICAgICByZXR1cm4gc2VsZjsKCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIGJ5dGVzKToKICAgICAgICAgICAgb2JqID0gc3RyKG9iaiwgInV0Zi04Iik7CgogICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLCBzdHIpIG9yIHR5cGUob2JqKSBpcyBzdHI6CiAgICAgICAgICAgIGlmIHJlLm1hdGNoKHIiKCgoW0EtWmEtel17Myw5fTooPzpcL1wvKT8pKD86Wy07OiY9XCtcJCxcd10rQCk/W0EtWmEtejAtOS4tXSt8KD86d3d3LnxbLTs6Jj1cK1wkLFx3XStAKVtBLVphLXowLTkuLV0rKSgoPzpcL1tcK34lXC8uXHdcLV9dKik/XD8/KD86Wy1cKz0mOyVALlx3X10qKSM/KD86W1x3XSopKT8pIiwgb2JqKToKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBvYmogPSB1anNvbi5sb2Fkcyh1cmxsaWIzLlBvb2xNYW5hZ2VyKCkucmVxdWVzdCgnR0VUJywgb2JqKS5kYXRhLmRlY29kZSgndXRmLTgnKSk7CiAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgb2JqID0ge307CiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBvYmogPSB1anNvbi5sb2FkcyhvYmopOwogICAgICAgIAogICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLCBsaXN0KToKICAgICAgICAgICAgcmV0dXJuIFtEZXZpY2VfQ2F0ZWdvcnkoKS5fZnJvbURvY3VtZW50KG8pIGZvciBvIGluIG9ial07CiAgICAgICAgICAgIAogICAgICAgIGlmIG5vdCBpc2luc3RhbmNlKG9iaiwgKHN0ciwgYnl0ZXMsIGRpY3QpKToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICd1bmhhbmRsZWQgdHlwZTogJyArIHN0cih0eXBlKG9iaikpKTsKICAgICAgICAgICAgcmV0dXJuIG9iajsKCiAgICAgICAgaWYgJ0lkJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuSWQgPSBvYmpbJ0lkJ107CgogICAgCiAgICAgICAgaWYgJ2FjdGl2ZScgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmFjdGl2ZShvYmpbJ2FjdGl2ZSddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdlbmFibGVkJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuZW5hYmxlZChvYmpbJ2VuYWJsZWQnXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnY29kZScgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmNvZGUob2JqWydjb2RlJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ29yZGVyJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYub3JkZXIob2JqWydvcmRlciddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdkYXRlJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuZGF0ZShvYmpbJ2RhdGUnXSk7CiAgICAgICAgCiAgICAgICAgICAgIHNlbGYuZGF0ZShkYXRldGltZS5kYXRldGltZS5mcm9taXNvZm9ybWF0KHNlbGYuZGF0ZSgpKSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnbmFtZScgaW4gb2JqOgogICAgICAgICAgICBzZWxmLm5hbWUob2JqWyduYW1lJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ3JlbWFyaycgaW4gb2JqOgogICAgICAgICAgICBzZWxmLnJlbWFyayhvYmpbJ3JlbWFyayddKTsKICAgICAgICAKICAgICAgICAgICAgc2VsZi5yZW1hcmsoIHViaW5hc2NpaS5hMmJfYmFzZTY0KHNlbGYucmVtYXJrKCkpICk7CiAgICAgICAgICAgIGlmIHNlbGYucmVtYXJrKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5yZW1hcmsoc2VsZi5yZW1hcmsoKS5kZWNvZGUoJ3V0Zi04Jykuc3RyaXAoKSk7CiAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5yZW1hcmsoKTsKICAgICAgICAgICAgICAgICAgICAjcHJpbnQoX190b1N0cmluZyArICJyZW1hcmsgZXhjZXB0aW9uIiwgc2VsZi5yZW1hcmsoKSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAncGFyZW50JyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYucGFyZW50KG9ialsncGFyZW50J10pOwogICAgICAgIAogICAgCgogICAgCiAgICAgICAgaWYgJ2NhdGVnb3J5X0RldmljZV9UeXBlcycgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmNhdGVnb3J5X0RldmljZV9UeXBlcyhEZXZpY2VfVHlwZSgpLl9mcm9tRG9jdW1lbnQob2JqWydjYXRlZ29yeV9EZXZpY2VfVHlwZXMnXSkpOwogICAgCgogICAgICAgIGdjLmNvbGxlY3QoKTsKICAgICAgICByZXR1cm4gc2VsZjsKICAgIAogICAgZGVmIF90b0RvY3VtZW50KHNlbGYsIGJKU09OPU5vbmUpOgogICAgICAgIF9fdG9TdHJpbmcgPSAnRGV2aWNlX0NhdGVnb3J5OjpfdG9Eb2N1bWVudCgpOiAnOwoKICAgICAgICByZXQgPSB7fTsKICAgICAgICBpZiBzZWxmLklkIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbIklkIl0gPSBzZWxmLklkOwoKICAgIAogICAgICAgIGlmIHNlbGYuYWN0aXZlKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiYWN0aXZlIl0gPSBzZWxmLmFjdGl2ZSgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5lbmFibGVkKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiZW5hYmxlZCJdID0gc2VsZi5lbmFibGVkKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLmNvZGUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJjb2RlIl0gPSBzZWxmLmNvZGUoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYub3JkZXIoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJvcmRlciJdID0gc2VsZi5vcmRlcigpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5kYXRlKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiZGF0ZSJdID0gc2VsZi5kYXRlKCk7CiAgICAgICAgCiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UocmV0WyJkYXRlIl0sIGRhdGV0aW1lLmRhdGV0aW1lKToKICAgICAgICAgICAgICAgIHJldFsiZGF0ZSJdID0gcmV0WyJkYXRlIl0uaXNvZm9ybWF0KCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLm5hbWUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJuYW1lIl0gPSBzZWxmLm5hbWUoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYucmVtYXJrKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSBzZWxmLnJlbWFyaygpOwogICAgICAgIAogICAgICAgICAgICBpZiBpc2luc3RhbmNlKHJldFsicmVtYXJrIl0sIGRpY3QpOgogICAgICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IHVqc29uLmR1bXBzKHJldFsicmVtYXJrIl0pLmVuY29kZSgndXRmLTgnKTsKCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSAgdWJpbmFzY2lpLmIyYV9iYXNlNjQocmV0WyJyZW1hcmsiXSkuZGVjb2RlKCd1dGYtOCcpLnN0cmlwKCk7CiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhjZXB0aW9uIHdpdGggcmVtYXJrOiAiICsgcmV0WyJyZW1hcmsiXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLnBhcmVudCgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbInBhcmVudCJdID0gc2VsZi5wYXJlbnQoKTsKICAgICAgICAKICAgIAogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5jYXRlZ29yeV9EZXZpY2VfVHlwZXMoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJjYXRlZ29yeV9EZXZpY2VfVHlwZXMiXSA9IFt0YS5fdG9Eb2N1bWVudCgpIGZvciB0YSBpbiBzZWxmLmNhdGVnb3J5X0RldmljZV9UeXBlcygpXTsKICAgIAoKICAgICAgICBpZiBiSlNPTiBpcyBub3QgTm9uZToKICAgICAgICAgICAgI3ByaW50KF9fdG9TdHJpbmcgKyAiR09UIEhFUkUiLCB0eXBlKHJldCksIHJldCk7CiAgICAgICAgICAgIHJldCA9IHVqc29uLmR1bXBzKHJldCk7CiAgICAgICAgZ2MuY29sbGVjdCgpOwogICAgICAgIHJldHVybiByZXQ7CgogICAgCiAgICBkZWYgc3RvcmUoc2VsZiwgX19ldmVudD1Ob25lKToKICAgICAgICBfX3RvU3RyaW5nID0gJ0RldmljZV9DYXRlZ29yeTo6c3RvcmUoKTogJzsKICAgICAgICAKICAgICAgICBldkpTT04gPSBOb25lOwoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBldkpTT04gPSB1anNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7CiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoKICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsKICAgICAgICAKCiAgICAgICAgYW5zd2VyID0gTm9uZTsKCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpY2tzX21zKCkpKyddLkRldmljZV9DYXRlZ29yeS5zdG9yZSgpJykubWV0aG9kKCdzdG9yZScpLmNsYXNzTmFtZSgnRGV2aWNlX0NhdGVnb3J5JykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOwogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7CiAgICAgICAgCiAgICAgICAgZ2MuY29sbGVjdCgpOwoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7CgogICAgICAgIAogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOwogICAgICAgIAogICAgICAgICAgICBhbnN3ZXIgPSBEZXZpY2VfQ2F0ZWdvcnkoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7CiAgICAgICAgCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsKCgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsKCiAgICAgICAgICAgIAogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsKICAgICAgICAgICAgCgogICAgICAgIHJldHVybiBhbnN3ZXI7CgogICAgCiAgICBkZWYgZmluZEFsbChzZWxmLCBfX2V2ZW50PU5vbmUpOgogICAgICAgIF9fdG9TdHJpbmcgPSAnRGV2aWNlX0NhdGVnb3J5OjpmaW5kQWxsKCk6ICc7CiAgICAgICAgCiAgICAgICAgZXZKU09OID0gTm9uZTsKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgZXZKU09OID0gdWpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOwogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046CiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7CiAgICAgICAgCgogICAgICAgIGFuc3dlciA9IE5vbmU7CgogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aWNrc19tcygpKSsnXS5EZXZpY2VfQ2F0ZWdvcnkuZmluZEFsbCgpJykubWV0aG9kKCdmaW5kQWxsJykuY2xhc3NOYW1lKCdEZXZpY2VfQ2F0ZWdvcnknKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7CiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTsKICAgICAgICAKICAgICAgICBnYy5jb2xsZWN0KCk7CgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsKCiAgICAgICAgCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7CiAgICAgICAgCiAgICAgICAgICAgIGFuc3dlciA9IERldmljZV9DYXRlZ29yeSgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsKICAgICAgICAKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOwoKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOwogICAgICAgICAgICAKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOwoKICAgICAgICAgICAgCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOwogICAgICAgICAgICAKCiAgICAgICAgcmV0dXJuIGFuc3dlcjsKCiAgICAKICAgIGRlZiBmaW5kKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6CiAgICAgICAgX190b1N0cmluZyA9ICdEZXZpY2VfQ2F0ZWdvcnk6OmZpbmQoKTogJzsKICAgICAgICAKICAgICAgICBldkpTT04gPSBOb25lOwoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBldkpTT04gPSB1anNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7CiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoKICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsKICAgICAgICAKCiAgICAgICAgYW5zd2VyID0gTm9uZTsKCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpY2tzX21zKCkpKyddLkRldmljZV9DYXRlZ29yeS5maW5kKCknKS5tZXRob2QoJ2ZpbmQnKS5jbGFzc05hbWUoJ0RldmljZV9DYXRlZ29yeScpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpOwogICAgICAgIAogICAgICAgIGdjLmNvbGxlY3QoKTsKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOwoKICAgICAgICAKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsKICAgICAgICAKICAgICAgICAgICAgYW5zd2VyID0gRGV2aWNlX0NhdGVnb3J5KCkuX2Zyb21Eb2N1bWVudChldkpTT04pOwogICAgICAgIAoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7CgoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOgogICAgICAgICAgICAKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7CgogICAgICAgICAgICAKICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7CiAgICAgICAgICAgIAoKICAgICAgICByZXR1cm4gYW5zd2VyOwoKICAgIAoKCmNsYXNzIERldmljZV9UeXBlKCk6CiAgICBkZWYgX19pbml0X18oc2VsZiwgSWQ9Tm9uZSwgYWN0aXZlPU5vbmUsIGVuYWJsZWQ9Tm9uZSwgY29kZT1Ob25lLCBvcmRlcj1Ob25lLCBkYXRlPU5vbmUsIG5hbWU9Tm9uZSwgcmVtYXJrPU5vbmUsIGNhdGVnb3J5PU5vbmUpOgogICAgICAgIHN1cGVyKCkuX19pbml0X18oKTsKCiAgICAgICAgI3ByaW50KCdEZXZpY2VfVHlwZTo6X19pbml0X18oKScpOwogICAgICAgIGlmIElkIGlzIG5vdCBOb25lOgogICAgICAgICAgICBzZWxmLklkID0gSWQ7CgogICAgICAgIAogICAgICAgIHNlbGYuYWN0aXZlKGFjdGl2ZSk7CiAgICAgICAgc2VsZi5lbmFibGVkKGVuYWJsZWQpOwogICAgICAgIHNlbGYuY29kZShjb2RlKTsKICAgICAgICBzZWxmLm9yZGVyKG9yZGVyKTsKICAgICAgICBzZWxmLmRhdGUoZGF0ZSk7CiAgICAgICAgc2VsZi5uYW1lKG5hbWUpOwogICAgICAgIHNlbGYucmVtYXJrKHJlbWFyayk7CiAgICAgICAgc2VsZi5jYXRlZ29yeShjYXRlZ29yeSk7CiAgICAgICAgCiAgICBJZCA9IE5vbmU7CiAgICAKICAgIAogICAgIyBhY3RpdmU6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9hY3RpdmUgPSBOb25lOwogICAgZGVmIGFjdGl2ZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fYWN0aXZlID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2FjdGl2ZTsKICAgIAogICAgIyBlbmFibGVkOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfZW5hYmxlZCA9IE5vbmU7CiAgICBkZWYgZW5hYmxlZChzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fZW5hYmxlZCA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9lbmFibGVkOwogICAgCiAgICAjIGNvZGU6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9jb2RlID0gTm9uZTsKICAgIGRlZiBjb2RlKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9jb2RlID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2NvZGU7CiAgICAKICAgICMgb3JkZXI6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9vcmRlciA9IE5vbmU7CiAgICBkZWYgb3JkZXIoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX29yZGVyID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX29yZGVyOwogICAgCiAgICAjIGRhdGU6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9kYXRlID0gTm9uZTsKICAgIGRlZiBkYXRlKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9kYXRlID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2RhdGU7CiAgICAKICAgICMgbmFtZTogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX25hbWUgPSBOb25lOwogICAgZGVmIG5hbWUoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX25hbWUgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fbmFtZTsKICAgIAogICAgIyByZW1hcms6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9yZW1hcmsgPSBOb25lOwogICAgZGVmIHJlbWFyayhzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fcmVtYXJrID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3JlbWFyazsKICAgIAogICAgIyBjYXRlZ29yeTogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX2NhdGVnb3J5ID0gTm9uZTsKICAgIGRlZiBjYXRlZ29yeShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fY2F0ZWdvcnkgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fY2F0ZWdvcnk7CiAgICAKICAgIAogICAgCiAgICAjIGRldmljZVR5cGVfTWV0cmljczogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX2RldmljZVR5cGVfTWV0cmljcyA9IE5vbmU7CiAgICBkZWYgZGV2aWNlVHlwZV9NZXRyaWNzKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9kZXZpY2VUeXBlX01ldHJpY3MgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fZGV2aWNlVHlwZV9NZXRyaWNzOwogICAgCiAgICAjIHR5cGVfRGV2aWNlczogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX3R5cGVfRGV2aWNlcyA9IE5vbmU7CiAgICBkZWYgdHlwZV9EZXZpY2VzKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl90eXBlX0RldmljZXMgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fdHlwZV9EZXZpY2VzOwogICAgCiAgICAKICAgIGRlZiBfdW5pcXVlKHNlbGYpOgogICAgICAgIF9fdG9TdHJpbmcgPSAnRGV2aWNlX1R5cGU6Ol91bmlxdWUoKTogJzsKICAgICAgICAKICAgICAgICByZXQgPSBEZXZpY2VfVHlwZSgpOwogICAgICAgIGlmIHNlbGYuSWQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldC5JZCA9IHNlbGYuSWQ7CiAgICAKICAgICAgICBpZiBzZWxmLmNvZGUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0LmNvZGUoc2VsZi5jb2RlKCkpOwogICAgCiAgICAgICAgZ2MuY29sbGVjdCgpOwogICAgICAgIHJldHVybiByZXQ7CiAgICAKICAgIGRlZiBfZnJvbURvY3VtZW50KHNlbGYsIG9iaik6CiAgICAgICAgX190b1N0cmluZyA9ICdEZXZpY2VfVHlwZTo6X2Zyb21Eb2N1bWVudCgpOiAnOwogICAgICAgIAogICAgICAgIGlmIG9iaiBpcyBOb25lOgogICAgICAgICAgICByZXR1cm4gc2VsZjsKCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIGJ5dGVzKToKICAgICAgICAgICAgb2JqID0gc3RyKG9iaiwgInV0Zi04Iik7CgogICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLCBzdHIpIG9yIHR5cGUob2JqKSBpcyBzdHI6CiAgICAgICAgICAgIGlmIHJlLm1hdGNoKHIiKCgoW0EtWmEtel17Myw5fTooPzpcL1wvKT8pKD86Wy07OiY9XCtcJCxcd10rQCk/W0EtWmEtejAtOS4tXSt8KD86d3d3LnxbLTs6Jj1cK1wkLFx3XStAKVtBLVphLXowLTkuLV0rKSgoPzpcL1tcK34lXC8uXHdcLV9dKik/XD8/KD86Wy1cKz0mOyVALlx3X10qKSM/KD86W1x3XSopKT8pIiwgb2JqKToKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBvYmogPSB1anNvbi5sb2Fkcyh1cmxsaWIzLlBvb2xNYW5hZ2VyKCkucmVxdWVzdCgnR0VUJywgb2JqKS5kYXRhLmRlY29kZSgndXRmLTgnKSk7CiAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgb2JqID0ge307CiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBvYmogPSB1anNvbi5sb2FkcyhvYmopOwogICAgICAgIAogICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLCBsaXN0KToKICAgICAgICAgICAgcmV0dXJuIFtEZXZpY2VfVHlwZSgpLl9mcm9tRG9jdW1lbnQobykgZm9yIG8gaW4gb2JqXTsKICAgICAgICAgICAgCiAgICAgICAgaWYgbm90IGlzaW5zdGFuY2Uob2JqLCAoc3RyLCBieXRlcywgZGljdCkpOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJ3VuaGFuZGxlZCB0eXBlOiAnICsgc3RyKHR5cGUob2JqKSkpOwogICAgICAgICAgICByZXR1cm4gb2JqOwoKICAgICAgICBpZiAnSWQnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5JZCA9IG9ialsnSWQnXTsKCiAgICAKICAgICAgICBpZiAnYWN0aXZlJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuYWN0aXZlKG9ialsnYWN0aXZlJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ2VuYWJsZWQnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5lbmFibGVkKG9ialsnZW5hYmxlZCddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdjb2RlJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuY29kZShvYmpbJ2NvZGUnXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnb3JkZXInIGluIG9iajoKICAgICAgICAgICAgc2VsZi5vcmRlcihvYmpbJ29yZGVyJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ2RhdGUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5kYXRlKG9ialsnZGF0ZSddKTsKICAgICAgICAKICAgICAgICAgICAgc2VsZi5kYXRlKGRhdGV0aW1lLmRhdGV0aW1lLmZyb21pc29mb3JtYXQoc2VsZi5kYXRlKCkpKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICduYW1lJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYubmFtZShvYmpbJ25hbWUnXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAncmVtYXJrJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYucmVtYXJrKG9ialsncmVtYXJrJ10pOwogICAgICAgIAogICAgICAgICAgICBzZWxmLnJlbWFyayggdWJpbmFzY2lpLmEyYl9iYXNlNjQoc2VsZi5yZW1hcmsoKSkgKTsKICAgICAgICAgICAgaWYgc2VsZi5yZW1hcmsoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBzZWxmLnJlbWFyayhzZWxmLnJlbWFyaygpLmRlY29kZSgndXRmLTgnKS5zdHJpcCgpKTsKICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICBzZWxmLnJlbWFyaygpOwogICAgICAgICAgICAgICAgICAgICNwcmludChfX3RvU3RyaW5nICsgInJlbWFyayBleGNlcHRpb24iLCBzZWxmLnJlbWFyaygpKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdjYXRlZ29yeScgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmNhdGVnb3J5KERldmljZV9DYXRlZ29yeSgpLl9mcm9tRG9jdW1lbnQob2JqWydjYXRlZ29yeSddKSk7CiAgICAgICAgCiAgICAKCiAgICAKICAgICAgICBpZiAnZGV2aWNlVHlwZV9NZXRyaWNzJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuZGV2aWNlVHlwZV9NZXRyaWNzKE1ldHJpYygpLl9mcm9tRG9jdW1lbnQob2JqWydkZXZpY2VUeXBlX01ldHJpY3MnXSkpOwogICAgCiAgICAgICAgaWYgJ3R5cGVfRGV2aWNlcycgaW4gb2JqOgogICAgICAgICAgICBzZWxmLnR5cGVfRGV2aWNlcyhEZXZpY2UoKS5fZnJvbURvY3VtZW50KG9ialsndHlwZV9EZXZpY2VzJ10pKTsKICAgIAoKICAgICAgICBnYy5jb2xsZWN0KCk7CiAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAKICAgIGRlZiBfdG9Eb2N1bWVudChzZWxmLCBiSlNPTj1Ob25lKToKICAgICAgICBfX3RvU3RyaW5nID0gJ0RldmljZV9UeXBlOjpfdG9Eb2N1bWVudCgpOiAnOwoKICAgICAgICByZXQgPSB7fTsKICAgICAgICBpZiBzZWxmLklkIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbIklkIl0gPSBzZWxmLklkOwoKICAgIAogICAgICAgIGlmIHNlbGYuYWN0aXZlKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiYWN0aXZlIl0gPSBzZWxmLmFjdGl2ZSgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5lbmFibGVkKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiZW5hYmxlZCJdID0gc2VsZi5lbmFibGVkKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLmNvZGUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJjb2RlIl0gPSBzZWxmLmNvZGUoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYub3JkZXIoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJvcmRlciJdID0gc2VsZi5vcmRlcigpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5kYXRlKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiZGF0ZSJdID0gc2VsZi5kYXRlKCk7CiAgICAgICAgCiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UocmV0WyJkYXRlIl0sIGRhdGV0aW1lLmRhdGV0aW1lKToKICAgICAgICAgICAgICAgIHJldFsiZGF0ZSJdID0gcmV0WyJkYXRlIl0uaXNvZm9ybWF0KCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLm5hbWUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJuYW1lIl0gPSBzZWxmLm5hbWUoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYucmVtYXJrKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSBzZWxmLnJlbWFyaygpOwogICAgICAgIAogICAgICAgICAgICBpZiBpc2luc3RhbmNlKHJldFsicmVtYXJrIl0sIGRpY3QpOgogICAgICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IHVqc29uLmR1bXBzKHJldFsicmVtYXJrIl0pLmVuY29kZSgndXRmLTgnKTsKCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSAgdWJpbmFzY2lpLmIyYV9iYXNlNjQocmV0WyJyZW1hcmsiXSkuZGVjb2RlKCd1dGYtOCcpLnN0cmlwKCk7CiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhjZXB0aW9uIHdpdGggcmVtYXJrOiAiICsgcmV0WyJyZW1hcmsiXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLmNhdGVnb3J5KCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiY2F0ZWdvcnkiXSA9IHNlbGYuY2F0ZWdvcnkoKS5fdG9Eb2N1bWVudCgpOwogICAgICAgIAogICAgCiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLmRldmljZVR5cGVfTWV0cmljcygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbImRldmljZVR5cGVfTWV0cmljcyJdID0gW3RhLl90b0RvY3VtZW50KCkgZm9yIHRhIGluIHNlbGYuZGV2aWNlVHlwZV9NZXRyaWNzKCldOwogICAgCiAgICAgICAgaWYgc2VsZi50eXBlX0RldmljZXMoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJ0eXBlX0RldmljZXMiXSA9IFt0YS5fdG9Eb2N1bWVudCgpIGZvciB0YSBpbiBzZWxmLnR5cGVfRGV2aWNlcygpXTsKICAgIAoKICAgICAgICBpZiBiSlNPTiBpcyBub3QgTm9uZToKICAgICAgICAgICAgI3ByaW50KF9fdG9TdHJpbmcgKyAiR09UIEhFUkUiLCB0eXBlKHJldCksIHJldCk7CiAgICAgICAgICAgIHJldCA9IHVqc29uLmR1bXBzKHJldCk7CiAgICAgICAgZ2MuY29sbGVjdCgpOwogICAgICAgIHJldHVybiByZXQ7CgogICAgCiAgICBkZWYgc3RvcmUoc2VsZiwgX19ldmVudD1Ob25lKToKICAgICAgICBfX3RvU3RyaW5nID0gJ0RldmljZV9UeXBlOjpzdG9yZSgpOiAnOwogICAgICAgIAogICAgICAgIGV2SlNPTiA9IE5vbmU7CgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIGV2SlNPTiA9IHVqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsKICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOgogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOwogICAgICAgIAoKICAgICAgICBhbnN3ZXIgPSBOb25lOwoKICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGlja3NfbXMoKSkrJ10uRGV2aWNlX1R5cGUuc3RvcmUoKScpLm1ldGhvZCgnc3RvcmUnKS5jbGFzc05hbWUoJ0RldmljZV9UeXBlJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOwogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7CiAgICAgICAgCiAgICAgICAgZ2MuY29sbGVjdCgpOwoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7CgogICAgICAgIAogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOwogICAgICAgIAogICAgICAgICAgICBhbnN3ZXIgPSBEZXZpY2VfVHlwZSgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsKICAgICAgICAKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOwoKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOwogICAgICAgICAgICAKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOwoKICAgICAgICAgICAgCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOwogICAgICAgICAgICAKCiAgICAgICAgcmV0dXJuIGFuc3dlcjsKCiAgICAKICAgIGRlZiBmaW5kQWxsKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6CiAgICAgICAgX190b1N0cmluZyA9ICdEZXZpY2VfVHlwZTo6ZmluZEFsbCgpOiAnOwogICAgICAgIAogICAgICAgIGV2SlNPTiA9IE5vbmU7CgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIGV2SlNPTiA9IHVqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsKICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOgogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOwogICAgICAgIAoKICAgICAgICBhbnN3ZXIgPSBOb25lOwoKICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGlja3NfbXMoKSkrJ10uRGV2aWNlX1R5cGUuZmluZEFsbCgpJykubWV0aG9kKCdmaW5kQWxsJykuY2xhc3NOYW1lKCdEZXZpY2VfVHlwZScpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpOwogICAgICAgIAogICAgICAgIGdjLmNvbGxlY3QoKTsKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOwoKICAgICAgICAKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsKICAgICAgICAKICAgICAgICAgICAgYW5zd2VyID0gRGV2aWNlX1R5cGUoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7CiAgICAgICAgCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsKCgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsKCiAgICAgICAgICAgIAogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsKICAgICAgICAgICAgCgogICAgICAgIHJldHVybiBhbnN3ZXI7CgogICAgCiAgICBkZWYgZmluZChzZWxmLCBfX2V2ZW50PU5vbmUpOgogICAgICAgIF9fdG9TdHJpbmcgPSAnRGV2aWNlX1R5cGU6OmZpbmQoKTogJzsKICAgICAgICAKICAgICAgICBldkpTT04gPSBOb25lOwoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBldkpTT04gPSB1anNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7CiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoKICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsKICAgICAgICAKCiAgICAgICAgYW5zd2VyID0gTm9uZTsKCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpY2tzX21zKCkpKyddLkRldmljZV9UeXBlLmZpbmQoKScpLm1ldGhvZCgnZmluZCcpLmNsYXNzTmFtZSgnRGV2aWNlX1R5cGUnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7CiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTsKICAgICAgICAKICAgICAgICBnYy5jb2xsZWN0KCk7CgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsKCiAgICAgICAgCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7CiAgICAgICAgCiAgICAgICAgICAgIGFuc3dlciA9IERldmljZV9UeXBlKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOwogICAgICAgIAoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7CgoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOgogICAgICAgICAgICAKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7CgogICAgICAgICAgICAKICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7CiAgICAgICAgICAgIAoKICAgICAgICByZXR1cm4gYW5zd2VyOwoKICAgIAoKCmNsYXNzIE1ldHJpY19Hcm91cCgpOgogICAgZGVmIF9faW5pdF9fKHNlbGYsIElkPU5vbmUsIGFjdGl2ZT1Ob25lLCBlbmFibGVkPU5vbmUsIGNvZGU9Tm9uZSwgb3JkZXI9Tm9uZSwgZGF0ZT1Ob25lLCBuYW1lPU5vbmUsIHJlbWFyaz1Ob25lKToKICAgICAgICBzdXBlcigpLl9faW5pdF9fKCk7CgogICAgICAgICNwcmludCgnTWV0cmljX0dyb3VwOjpfX2luaXRfXygpJyk7CiAgICAgICAgaWYgSWQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHNlbGYuSWQgPSBJZDsKCiAgICAgICAgCiAgICAgICAgc2VsZi5hY3RpdmUoYWN0aXZlKTsKICAgICAgICBzZWxmLmVuYWJsZWQoZW5hYmxlZCk7CiAgICAgICAgc2VsZi5jb2RlKGNvZGUpOwogICAgICAgIHNlbGYub3JkZXIob3JkZXIpOwogICAgICAgIHNlbGYuZGF0ZShkYXRlKTsKICAgICAgICBzZWxmLm5hbWUobmFtZSk7CiAgICAgICAgc2VsZi5yZW1hcmsocmVtYXJrKTsKICAgICAgICAKICAgIElkID0gTm9uZTsKICAgIAogICAgCiAgICAjIGFjdGl2ZTogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX2FjdGl2ZSA9IE5vbmU7CiAgICBkZWYgYWN0aXZlKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9hY3RpdmUgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fYWN0aXZlOwogICAgCiAgICAjIGVuYWJsZWQ6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9lbmFibGVkID0gTm9uZTsKICAgIGRlZiBlbmFibGVkKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9lbmFibGVkID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2VuYWJsZWQ7CiAgICAKICAgICMgY29kZTogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX2NvZGUgPSBOb25lOwogICAgZGVmIGNvZGUoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2NvZGUgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fY29kZTsKICAgIAogICAgIyBvcmRlcjogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX29yZGVyID0gTm9uZTsKICAgIGRlZiBvcmRlcihzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fb3JkZXIgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fb3JkZXI7CiAgICAKICAgICMgZGF0ZTogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX2RhdGUgPSBOb25lOwogICAgZGVmIGRhdGUoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2RhdGUgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fZGF0ZTsKICAgIAogICAgIyBuYW1lOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfbmFtZSA9IE5vbmU7CiAgICBkZWYgbmFtZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fbmFtZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9uYW1lOwogICAgCiAgICAjIHJlbWFyazogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX3JlbWFyayA9IE5vbmU7CiAgICBkZWYgcmVtYXJrKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9yZW1hcmsgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fcmVtYXJrOwogICAgCiAgICAKICAgIAogICAgIyBncm91cF9NZXRyaWNfVHlwZXM6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9ncm91cF9NZXRyaWNfVHlwZXMgPSBOb25lOwogICAgZGVmIGdyb3VwX01ldHJpY19UeXBlcyhzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fZ3JvdXBfTWV0cmljX1R5cGVzID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2dyb3VwX01ldHJpY19UeXBlczsKICAgIAogICAgCiAgICBkZWYgX3VuaXF1ZShzZWxmKToKICAgICAgICBfX3RvU3RyaW5nID0gJ01ldHJpY19Hcm91cDo6X3VuaXF1ZSgpOiAnOwogICAgICAgIAogICAgICAgIHJldCA9IE1ldHJpY19Hcm91cCgpOwogICAgICAgIGlmIHNlbGYuSWQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldC5JZCA9IHNlbGYuSWQ7CiAgICAKICAgICAgICBpZiBzZWxmLmNvZGUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0LmNvZGUoc2VsZi5jb2RlKCkpOwogICAgCiAgICAgICAgZ2MuY29sbGVjdCgpOwogICAgICAgIHJldHVybiByZXQ7CiAgICAKICAgIGRlZiBfZnJvbURvY3VtZW50KHNlbGYsIG9iaik6CiAgICAgICAgX190b1N0cmluZyA9ICdNZXRyaWNfR3JvdXA6Ol9mcm9tRG9jdW1lbnQoKTogJzsKICAgICAgICAKICAgICAgICBpZiBvYmogaXMgTm9uZToKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CgogICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLCBieXRlcyk6CiAgICAgICAgICAgIG9iaiA9IHN0cihvYmosICJ1dGYtOCIpOwoKICAgICAgICBpZiBpc2luc3RhbmNlKG9iaiwgc3RyKSBvciB0eXBlKG9iaikgaXMgc3RyOgogICAgICAgICAgICBpZiByZS5tYXRjaChyIigoKFtBLVphLXpdezMsOX06KD86XC9cLyk/KSg/OlstOzomPVwrXCQsXHddK0ApP1tBLVphLXowLTkuLV0rfCg/Ond3dy58Wy07OiY9XCtcJCxcd10rQClbQS1aYS16MC05Li1dKykoKD86XC9bXCt+JVwvLlx3XC1fXSopP1w/Pyg/OlstXCs9JjslQC5cd19dKikjPyg/Oltcd10qKSk/KSIsIG9iaik6CiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgb2JqID0gdWpzb24ubG9hZHModXJsbGliMy5Qb29sTWFuYWdlcigpLnJlcXVlc3QoJ0dFVCcsIG9iaikuZGF0YS5kZWNvZGUoJ3V0Zi04JykpOwogICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgIG9iaiA9IHt9OwogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgb2JqID0gdWpzb24ubG9hZHMob2JqKTsKICAgICAgICAKICAgICAgICBpZiBpc2luc3RhbmNlKG9iaiwgbGlzdCk6CiAgICAgICAgICAgIHJldHVybiBbTWV0cmljX0dyb3VwKCkuX2Zyb21Eb2N1bWVudChvKSBmb3IgbyBpbiBvYmpdOwogICAgICAgICAgICAKICAgICAgICBpZiBub3QgaXNpbnN0YW5jZShvYmosIChzdHIsIGJ5dGVzLCBkaWN0KSk6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAndW5oYW5kbGVkIHR5cGU6ICcgKyBzdHIodHlwZShvYmopKSk7CiAgICAgICAgICAgIHJldHVybiBvYmo7CgogICAgICAgIGlmICdJZCcgaW4gb2JqOgogICAgICAgICAgICBzZWxmLklkID0gb2JqWydJZCddOwoKICAgIAogICAgICAgIGlmICdhY3RpdmUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5hY3RpdmUob2JqWydhY3RpdmUnXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnZW5hYmxlZCcgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmVuYWJsZWQob2JqWydlbmFibGVkJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ2NvZGUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5jb2RlKG9ialsnY29kZSddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdvcmRlcicgaW4gb2JqOgogICAgICAgICAgICBzZWxmLm9yZGVyKG9ialsnb3JkZXInXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnZGF0ZScgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmRhdGUob2JqWydkYXRlJ10pOwogICAgICAgIAogICAgICAgICAgICBzZWxmLmRhdGUoZGF0ZXRpbWUuZGF0ZXRpbWUuZnJvbWlzb2Zvcm1hdChzZWxmLmRhdGUoKSkpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ25hbWUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5uYW1lKG9ialsnbmFtZSddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdyZW1hcmsnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5yZW1hcmsob2JqWydyZW1hcmsnXSk7CiAgICAgICAgCiAgICAgICAgICAgIHNlbGYucmVtYXJrKCB1YmluYXNjaWkuYTJiX2Jhc2U2NChzZWxmLnJlbWFyaygpKSApOwogICAgICAgICAgICBpZiBzZWxmLnJlbWFyaygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIHNlbGYucmVtYXJrKHNlbGYucmVtYXJrKCkuZGVjb2RlKCd1dGYtOCcpLnN0cmlwKCkpOwogICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgIHNlbGYucmVtYXJrKCk7CiAgICAgICAgICAgICAgICAgICAgI3ByaW50KF9fdG9TdHJpbmcgKyAicmVtYXJrIGV4Y2VwdGlvbiIsIHNlbGYucmVtYXJrKCkpOwogICAgICAgIAogICAgCgogICAgCiAgICAgICAgaWYgJ2dyb3VwX01ldHJpY19UeXBlcycgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmdyb3VwX01ldHJpY19UeXBlcyhNZXRyaWNfVHlwZSgpLl9mcm9tRG9jdW1lbnQob2JqWydncm91cF9NZXRyaWNfVHlwZXMnXSkpOwogICAgCgogICAgICAgIGdjLmNvbGxlY3QoKTsKICAgICAgICByZXR1cm4gc2VsZjsKICAgIAogICAgZGVmIF90b0RvY3VtZW50KHNlbGYsIGJKU09OPU5vbmUpOgogICAgICAgIF9fdG9TdHJpbmcgPSAnTWV0cmljX0dyb3VwOjpfdG9Eb2N1bWVudCgpOiAnOwoKICAgICAgICByZXQgPSB7fTsKICAgICAgICBpZiBzZWxmLklkIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbIklkIl0gPSBzZWxmLklkOwoKICAgIAogICAgICAgIGlmIHNlbGYuYWN0aXZlKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiYWN0aXZlIl0gPSBzZWxmLmFjdGl2ZSgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5lbmFibGVkKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiZW5hYmxlZCJdID0gc2VsZi5lbmFibGVkKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLmNvZGUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJjb2RlIl0gPSBzZWxmLmNvZGUoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYub3JkZXIoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJvcmRlciJdID0gc2VsZi5vcmRlcigpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5kYXRlKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiZGF0ZSJdID0gc2VsZi5kYXRlKCk7CiAgICAgICAgCiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UocmV0WyJkYXRlIl0sIGRhdGV0aW1lLmRhdGV0aW1lKToKICAgICAgICAgICAgICAgIHJldFsiZGF0ZSJdID0gcmV0WyJkYXRlIl0uaXNvZm9ybWF0KCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLm5hbWUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJuYW1lIl0gPSBzZWxmLm5hbWUoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYucmVtYXJrKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSBzZWxmLnJlbWFyaygpOwogICAgICAgIAogICAgICAgICAgICBpZiBpc2luc3RhbmNlKHJldFsicmVtYXJrIl0sIGRpY3QpOgogICAgICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IHVqc29uLmR1bXBzKHJldFsicmVtYXJrIl0pLmVuY29kZSgndXRmLTgnKTsKCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSAgdWJpbmFzY2lpLmIyYV9iYXNlNjQocmV0WyJyZW1hcmsiXSkuZGVjb2RlKCd1dGYtOCcpLnN0cmlwKCk7CiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhjZXB0aW9uIHdpdGggcmVtYXJrOiAiICsgcmV0WyJyZW1hcmsiXSk7CiAgICAgICAgCiAgICAKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYuZ3JvdXBfTWV0cmljX1R5cGVzKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiZ3JvdXBfTWV0cmljX1R5cGVzIl0gPSBbdGEuX3RvRG9jdW1lbnQoKSBmb3IgdGEgaW4gc2VsZi5ncm91cF9NZXRyaWNfVHlwZXMoKV07CiAgICAKCiAgICAgICAgaWYgYkpTT04gaXMgbm90IE5vbmU6CiAgICAgICAgICAgICNwcmludChfX3RvU3RyaW5nICsgIkdPVCBIRVJFIiwgdHlwZShyZXQpLCByZXQpOwogICAgICAgICAgICByZXQgPSB1anNvbi5kdW1wcyhyZXQpOwogICAgICAgIGdjLmNvbGxlY3QoKTsKICAgICAgICByZXR1cm4gcmV0OwoKICAgIAogICAgZGVmIHN0b3JlKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6CiAgICAgICAgX190b1N0cmluZyA9ICdNZXRyaWNfR3JvdXA6OnN0b3JlKCk6ICc7CiAgICAgICAgCiAgICAgICAgZXZKU09OID0gTm9uZTsKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgZXZKU09OID0gdWpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOwogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046CiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7CiAgICAgICAgCgogICAgICAgIGFuc3dlciA9IE5vbmU7CgogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aWNrc19tcygpKSsnXS5NZXRyaWNfR3JvdXAuc3RvcmUoKScpLm1ldGhvZCgnc3RvcmUnKS5jbGFzc05hbWUoJ01ldHJpY19Hcm91cCcpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpOwogICAgICAgIAogICAgICAgIGdjLmNvbGxlY3QoKTsKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOwoKICAgICAgICAKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsKICAgICAgICAKICAgICAgICAgICAgYW5zd2VyID0gTWV0cmljX0dyb3VwKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOwogICAgICAgIAoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7CgoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOgogICAgICAgICAgICAKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7CgogICAgICAgICAgICAKICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7CiAgICAgICAgICAgIAoKICAgICAgICByZXR1cm4gYW5zd2VyOwoKICAgIAogICAgZGVmIGZpbmRBbGwoc2VsZiwgX19ldmVudD1Ob25lKToKICAgICAgICBfX3RvU3RyaW5nID0gJ01ldHJpY19Hcm91cDo6ZmluZEFsbCgpOiAnOwogICAgICAgIAogICAgICAgIGV2SlNPTiA9IE5vbmU7CgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIGV2SlNPTiA9IHVqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsKICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOgogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOwogICAgICAgIAoKICAgICAgICBhbnN3ZXIgPSBOb25lOwoKICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGlja3NfbXMoKSkrJ10uTWV0cmljX0dyb3VwLmZpbmRBbGwoKScpLm1ldGhvZCgnZmluZEFsbCcpLmNsYXNzTmFtZSgnTWV0cmljX0dyb3VwJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOwogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7CiAgICAgICAgCiAgICAgICAgZ2MuY29sbGVjdCgpOwoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7CgogICAgICAgIAogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOwogICAgICAgIAogICAgICAgICAgICBhbnN3ZXIgPSBNZXRyaWNfR3JvdXAoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7CiAgICAgICAgCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsKCgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsKCiAgICAgICAgICAgIAogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsKICAgICAgICAgICAgCgogICAgICAgIHJldHVybiBhbnN3ZXI7CgogICAgCiAgICBkZWYgZmluZChzZWxmLCBfX2V2ZW50PU5vbmUpOgogICAgICAgIF9fdG9TdHJpbmcgPSAnTWV0cmljX0dyb3VwOjpmaW5kKCk6ICc7CiAgICAgICAgCiAgICAgICAgZXZKU09OID0gTm9uZTsKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgZXZKU09OID0gdWpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOwogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046CiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7CiAgICAgICAgCgogICAgICAgIGFuc3dlciA9IE5vbmU7CgogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aWNrc19tcygpKSsnXS5NZXRyaWNfR3JvdXAuZmluZCgpJykubWV0aG9kKCdmaW5kJykuY2xhc3NOYW1lKCdNZXRyaWNfR3JvdXAnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7CiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTsKICAgICAgICAKICAgICAgICBnYy5jb2xsZWN0KCk7CgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsKCiAgICAgICAgCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7CiAgICAgICAgCiAgICAgICAgICAgIGFuc3dlciA9IE1ldHJpY19Hcm91cCgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsKICAgICAgICAKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOwoKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOwogICAgICAgICAgICAKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOwoKICAgICAgICAgICAgCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOwogICAgICAgICAgICAKCiAgICAgICAgcmV0dXJuIGFuc3dlcjsKCiAgICAKCgpjbGFzcyBNZXRyaWNfVHlwZSgpOgogICAgZGVmIF9faW5pdF9fKHNlbGYsIElkPU5vbmUsIGFjdGl2ZT1Ob25lLCBlbmFibGVkPU5vbmUsIGNvZGU9Tm9uZSwgb3JkZXI9Tm9uZSwgZGF0ZT1Ob25lLCBuYW1lPU5vbmUsIHJlbWFyaz1Ob25lLCBncm91cD1Ob25lKToKICAgICAgICBzdXBlcigpLl9faW5pdF9fKCk7CgogICAgICAgICNwcmludCgnTWV0cmljX1R5cGU6Ol9faW5pdF9fKCknKTsKICAgICAgICBpZiBJZCBpcyBub3QgTm9uZToKICAgICAgICAgICAgc2VsZi5JZCA9IElkOwoKICAgICAgICAKICAgICAgICBzZWxmLmFjdGl2ZShhY3RpdmUpOwogICAgICAgIHNlbGYuZW5hYmxlZChlbmFibGVkKTsKICAgICAgICBzZWxmLmNvZGUoY29kZSk7CiAgICAgICAgc2VsZi5vcmRlcihvcmRlcik7CiAgICAgICAgc2VsZi5kYXRlKGRhdGUpOwogICAgICAgIHNlbGYubmFtZShuYW1lKTsKICAgICAgICBzZWxmLnJlbWFyayhyZW1hcmspOwogICAgICAgIHNlbGYuZ3JvdXAoZ3JvdXApOwogICAgICAgIAogICAgSWQgPSBOb25lOwogICAgCiAgICAKICAgICMgYWN0aXZlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfYWN0aXZlID0gTm9uZTsKICAgIGRlZiBhY3RpdmUoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2FjdGl2ZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9hY3RpdmU7CiAgICAKICAgICMgZW5hYmxlZDogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX2VuYWJsZWQgPSBOb25lOwogICAgZGVmIGVuYWJsZWQoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2VuYWJsZWQgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fZW5hYmxlZDsKICAgIAogICAgIyBjb2RlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfY29kZSA9IE5vbmU7CiAgICBkZWYgY29kZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fY29kZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9jb2RlOwogICAgCiAgICAjIG9yZGVyOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfb3JkZXIgPSBOb25lOwogICAgZGVmIG9yZGVyKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9vcmRlciA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9vcmRlcjsKICAgIAogICAgIyBkYXRlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfZGF0ZSA9IE5vbmU7CiAgICBkZWYgZGF0ZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fZGF0ZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9kYXRlOwogICAgCiAgICAjIG5hbWU6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9uYW1lID0gTm9uZTsKICAgIGRlZiBuYW1lKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9uYW1lID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX25hbWU7CiAgICAKICAgICMgcmVtYXJrOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfcmVtYXJrID0gTm9uZTsKICAgIGRlZiByZW1hcmsoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX3JlbWFyayA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9yZW1hcms7CiAgICAKICAgICMgZ3JvdXA6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9ncm91cCA9IE5vbmU7CiAgICBkZWYgZ3JvdXAoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2dyb3VwID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2dyb3VwOwogICAgCiAgICAKICAgIAogICAgIyB0eXBlX01ldHJpY3M6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF90eXBlX01ldHJpY3MgPSBOb25lOwogICAgZGVmIHR5cGVfTWV0cmljcyhzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fdHlwZV9NZXRyaWNzID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3R5cGVfTWV0cmljczsKICAgIAogICAgCiAgICBkZWYgX3VuaXF1ZShzZWxmKToKICAgICAgICBfX3RvU3RyaW5nID0gJ01ldHJpY19UeXBlOjpfdW5pcXVlKCk6ICc7CiAgICAgICAgCiAgICAgICAgcmV0ID0gTWV0cmljX1R5cGUoKTsKICAgICAgICBpZiBzZWxmLklkIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXQuSWQgPSBzZWxmLklkOwogICAgCiAgICAgICAgaWYgc2VsZi5jb2RlKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldC5jb2RlKHNlbGYuY29kZSgpKTsKICAgIAogICAgICAgIGdjLmNvbGxlY3QoKTsKICAgICAgICByZXR1cm4gcmV0OwogICAgCiAgICBkZWYgX2Zyb21Eb2N1bWVudChzZWxmLCBvYmopOgogICAgICAgIF9fdG9TdHJpbmcgPSAnTWV0cmljX1R5cGU6Ol9mcm9tRG9jdW1lbnQoKTogJzsKICAgICAgICAKICAgICAgICBpZiBvYmogaXMgTm9uZToKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CgogICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLCBieXRlcyk6CiAgICAgICAgICAgIG9iaiA9IHN0cihvYmosICJ1dGYtOCIpOwoKICAgICAgICBpZiBpc2luc3RhbmNlKG9iaiwgc3RyKSBvciB0eXBlKG9iaikgaXMgc3RyOgogICAgICAgICAgICBpZiByZS5tYXRjaChyIigoKFtBLVphLXpdezMsOX06KD86XC9cLyk/KSg/OlstOzomPVwrXCQsXHddK0ApP1tBLVphLXowLTkuLV0rfCg/Ond3dy58Wy07OiY9XCtcJCxcd10rQClbQS1aYS16MC05Li1dKykoKD86XC9bXCt+JVwvLlx3XC1fXSopP1w/Pyg/OlstXCs9JjslQC5cd19dKikjPyg/Oltcd10qKSk/KSIsIG9iaik6CiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgb2JqID0gdWpzb24ubG9hZHModXJsbGliMy5Qb29sTWFuYWdlcigpLnJlcXVlc3QoJ0dFVCcsIG9iaikuZGF0YS5kZWNvZGUoJ3V0Zi04JykpOwogICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgIG9iaiA9IHt9OwogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgb2JqID0gdWpzb24ubG9hZHMob2JqKTsKICAgICAgICAKICAgICAgICBpZiBpc2luc3RhbmNlKG9iaiwgbGlzdCk6CiAgICAgICAgICAgIHJldHVybiBbTWV0cmljX1R5cGUoKS5fZnJvbURvY3VtZW50KG8pIGZvciBvIGluIG9ial07CiAgICAgICAgICAgIAogICAgICAgIGlmIG5vdCBpc2luc3RhbmNlKG9iaiwgKHN0ciwgYnl0ZXMsIGRpY3QpKToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICd1bmhhbmRsZWQgdHlwZTogJyArIHN0cih0eXBlKG9iaikpKTsKICAgICAgICAgICAgcmV0dXJuIG9iajsKCiAgICAgICAgaWYgJ0lkJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuSWQgPSBvYmpbJ0lkJ107CgogICAgCiAgICAgICAgaWYgJ2FjdGl2ZScgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmFjdGl2ZShvYmpbJ2FjdGl2ZSddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdlbmFibGVkJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuZW5hYmxlZChvYmpbJ2VuYWJsZWQnXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnY29kZScgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmNvZGUob2JqWydjb2RlJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ29yZGVyJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYub3JkZXIob2JqWydvcmRlciddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdkYXRlJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuZGF0ZShvYmpbJ2RhdGUnXSk7CiAgICAgICAgCiAgICAgICAgICAgIHNlbGYuZGF0ZShkYXRldGltZS5kYXRldGltZS5mcm9taXNvZm9ybWF0KHNlbGYuZGF0ZSgpKSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnbmFtZScgaW4gb2JqOgogICAgICAgICAgICBzZWxmLm5hbWUob2JqWyduYW1lJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ3JlbWFyaycgaW4gb2JqOgogICAgICAgICAgICBzZWxmLnJlbWFyayhvYmpbJ3JlbWFyayddKTsKICAgICAgICAKICAgICAgICAgICAgc2VsZi5yZW1hcmsoIHViaW5hc2NpaS5hMmJfYmFzZTY0KHNlbGYucmVtYXJrKCkpICk7CiAgICAgICAgICAgIGlmIHNlbGYucmVtYXJrKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5yZW1hcmsoc2VsZi5yZW1hcmsoKS5kZWNvZGUoJ3V0Zi04Jykuc3RyaXAoKSk7CiAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5yZW1hcmsoKTsKICAgICAgICAgICAgICAgICAgICAjcHJpbnQoX190b1N0cmluZyArICJyZW1hcmsgZXhjZXB0aW9uIiwgc2VsZi5yZW1hcmsoKSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnZ3JvdXAnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5ncm91cChNZXRyaWNfR3JvdXAoKS5fZnJvbURvY3VtZW50KG9ialsnZ3JvdXAnXSkpOwogICAgICAgIAogICAgCgogICAgCiAgICAgICAgaWYgJ3R5cGVfTWV0cmljcycgaW4gb2JqOgogICAgICAgICAgICBzZWxmLnR5cGVfTWV0cmljcyhNZXRyaWMoKS5fZnJvbURvY3VtZW50KG9ialsndHlwZV9NZXRyaWNzJ10pKTsKICAgIAoKICAgICAgICBnYy5jb2xsZWN0KCk7CiAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAKICAgIGRlZiBfdG9Eb2N1bWVudChzZWxmLCBiSlNPTj1Ob25lKToKICAgICAgICBfX3RvU3RyaW5nID0gJ01ldHJpY19UeXBlOjpfdG9Eb2N1bWVudCgpOiAnOwoKICAgICAgICByZXQgPSB7fTsKICAgICAgICBpZiBzZWxmLklkIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbIklkIl0gPSBzZWxmLklkOwoKICAgIAogICAgICAgIGlmIHNlbGYuYWN0aXZlKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiYWN0aXZlIl0gPSBzZWxmLmFjdGl2ZSgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5lbmFibGVkKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiZW5hYmxlZCJdID0gc2VsZi5lbmFibGVkKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLmNvZGUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJjb2RlIl0gPSBzZWxmLmNvZGUoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYub3JkZXIoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJvcmRlciJdID0gc2VsZi5vcmRlcigpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5kYXRlKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiZGF0ZSJdID0gc2VsZi5kYXRlKCk7CiAgICAgICAgCiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UocmV0WyJkYXRlIl0sIGRhdGV0aW1lLmRhdGV0aW1lKToKICAgICAgICAgICAgICAgIHJldFsiZGF0ZSJdID0gcmV0WyJkYXRlIl0uaXNvZm9ybWF0KCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLm5hbWUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJuYW1lIl0gPSBzZWxmLm5hbWUoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYucmVtYXJrKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSBzZWxmLnJlbWFyaygpOwogICAgICAgIAogICAgICAgICAgICBpZiBpc2luc3RhbmNlKHJldFsicmVtYXJrIl0sIGRpY3QpOgogICAgICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IHVqc29uLmR1bXBzKHJldFsicmVtYXJrIl0pLmVuY29kZSgndXRmLTgnKTsKCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSAgdWJpbmFzY2lpLmIyYV9iYXNlNjQocmV0WyJyZW1hcmsiXSkuZGVjb2RlKCd1dGYtOCcpLnN0cmlwKCk7CiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhjZXB0aW9uIHdpdGggcmVtYXJrOiAiICsgcmV0WyJyZW1hcmsiXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLmdyb3VwKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiZ3JvdXAiXSA9IHNlbGYuZ3JvdXAoKS5fdG9Eb2N1bWVudCgpOwogICAgICAgIAogICAgCiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLnR5cGVfTWV0cmljcygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbInR5cGVfTWV0cmljcyJdID0gW3RhLl90b0RvY3VtZW50KCkgZm9yIHRhIGluIHNlbGYudHlwZV9NZXRyaWNzKCldOwogICAgCgogICAgICAgIGlmIGJKU09OIGlzIG5vdCBOb25lOgogICAgICAgICAgICAjcHJpbnQoX190b1N0cmluZyArICJHT1QgSEVSRSIsIHR5cGUocmV0KSwgcmV0KTsKICAgICAgICAgICAgcmV0ID0gdWpzb24uZHVtcHMocmV0KTsKICAgICAgICBnYy5jb2xsZWN0KCk7CiAgICAgICAgcmV0dXJuIHJldDsKCiAgICAKICAgIGRlZiBzdG9yZShzZWxmLCBfX2V2ZW50PU5vbmUpOgogICAgICAgIF9fdG9TdHJpbmcgPSAnTWV0cmljX1R5cGU6OnN0b3JlKCk6ICc7CiAgICAgICAgCiAgICAgICAgZXZKU09OID0gTm9uZTsKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgZXZKU09OID0gdWpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOwogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046CiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7CiAgICAgICAgCgogICAgICAgIGFuc3dlciA9IE5vbmU7CgogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aWNrc19tcygpKSsnXS5NZXRyaWNfVHlwZS5zdG9yZSgpJykubWV0aG9kKCdzdG9yZScpLmNsYXNzTmFtZSgnTWV0cmljX1R5cGUnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7CiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTsKICAgICAgICAKICAgICAgICBnYy5jb2xsZWN0KCk7CgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsKCiAgICAgICAgCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7CiAgICAgICAgCiAgICAgICAgICAgIGFuc3dlciA9IE1ldHJpY19UeXBlKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOwogICAgICAgIAoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7CgoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOgogICAgICAgICAgICAKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7CgogICAgICAgICAgICAKICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7CiAgICAgICAgICAgIAoKICAgICAgICByZXR1cm4gYW5zd2VyOwoKICAgIAogICAgZGVmIGZpbmRBbGwoc2VsZiwgX19ldmVudD1Ob25lKToKICAgICAgICBfX3RvU3RyaW5nID0gJ01ldHJpY19UeXBlOjpmaW5kQWxsKCk6ICc7CiAgICAgICAgCiAgICAgICAgZXZKU09OID0gTm9uZTsKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgZXZKU09OID0gdWpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOwogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046CiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7CiAgICAgICAgCgogICAgICAgIGFuc3dlciA9IE5vbmU7CgogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aWNrc19tcygpKSsnXS5NZXRyaWNfVHlwZS5maW5kQWxsKCknKS5tZXRob2QoJ2ZpbmRBbGwnKS5jbGFzc05hbWUoJ01ldHJpY19UeXBlJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOwogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7CiAgICAgICAgCiAgICAgICAgZ2MuY29sbGVjdCgpOwoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7CgogICAgICAgIAogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOwogICAgICAgIAogICAgICAgICAgICBhbnN3ZXIgPSBNZXRyaWNfVHlwZSgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsKICAgICAgICAKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOwoKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOwogICAgICAgICAgICAKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOwoKICAgICAgICAgICAgCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOwogICAgICAgICAgICAKCiAgICAgICAgcmV0dXJuIGFuc3dlcjsKCiAgICAKICAgIGRlZiBmaW5kKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6CiAgICAgICAgX190b1N0cmluZyA9ICdNZXRyaWNfVHlwZTo6ZmluZCgpOiAnOwogICAgICAgIAogICAgICAgIGV2SlNPTiA9IE5vbmU7CgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIGV2SlNPTiA9IHVqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsKICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOgogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOwogICAgICAgIAoKICAgICAgICBhbnN3ZXIgPSBOb25lOwoKICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGlja3NfbXMoKSkrJ10uTWV0cmljX1R5cGUuZmluZCgpJykubWV0aG9kKCdmaW5kJykuY2xhc3NOYW1lKCdNZXRyaWNfVHlwZScpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpOwogICAgICAgIAogICAgICAgIGdjLmNvbGxlY3QoKTsKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOwoKICAgICAgICAKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsKICAgICAgICAKICAgICAgICAgICAgYW5zd2VyID0gTWV0cmljX1R5cGUoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7CiAgICAgICAgCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsKCgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsKCiAgICAgICAgICAgIAogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsKICAgICAgICAgICAgCgogICAgICAgIHJldHVybiBhbnN3ZXI7CgogICAgCgoKY2xhc3MgQ29uZmlnKCk6CiAgICBkZWYgX19pbml0X18oc2VsZiwgSWQ9Tm9uZSwgYWN0aXZlPU5vbmUsIGVuYWJsZWQ9Tm9uZSwgY29kZT1Ob25lLCBvcmRlcj1Ob25lLCBkYXRlPU5vbmUsIG5hbWU9Tm9uZSwgcmVtYXJrPU5vbmUsIHZhbHVlPU5vbmUsIHNjcmlwdD1Ob25lLCB0b29sPU5vbmUsIGdyb3VwPU5vbmUsIHR5cGU9Tm9uZSwgbm9kZT1Ob25lKToKICAgICAgICBzdXBlcigpLl9faW5pdF9fKCk7CgogICAgICAgICNwcmludCgnQ29uZmlnOjpfX2luaXRfXygpJyk7CiAgICAgICAgaWYgSWQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHNlbGYuSWQgPSBJZDsKCiAgICAgICAgCiAgICAgICAgc2VsZi5hY3RpdmUoYWN0aXZlKTsKICAgICAgICBzZWxmLmVuYWJsZWQoZW5hYmxlZCk7CiAgICAgICAgc2VsZi5jb2RlKGNvZGUpOwogICAgICAgIHNlbGYub3JkZXIob3JkZXIpOwogICAgICAgIHNlbGYuZGF0ZShkYXRlKTsKICAgICAgICBzZWxmLm5hbWUobmFtZSk7CiAgICAgICAgc2VsZi5yZW1hcmsocmVtYXJrKTsKICAgICAgICBzZWxmLnZhbHVlKHZhbHVlKTsKICAgICAgICBzZWxmLnNjcmlwdChzY3JpcHQpOwogICAgICAgIHNlbGYudG9vbCh0b29sKTsKICAgICAgICBzZWxmLmdyb3VwKGdyb3VwKTsKICAgICAgICBzZWxmLnR5cGUodHlwZSk7CiAgICAgICAgc2VsZi5ub2RlKG5vZGUpOwogICAgICAgIAogICAgSWQgPSBOb25lOwogICAgCiAgICAKICAgICMgYWN0aXZlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfYWN0aXZlID0gTm9uZTsKICAgIGRlZiBhY3RpdmUoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2FjdGl2ZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9hY3RpdmU7CiAgICAKICAgICMgZW5hYmxlZDogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX2VuYWJsZWQgPSBOb25lOwogICAgZGVmIGVuYWJsZWQoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2VuYWJsZWQgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fZW5hYmxlZDsKICAgIAogICAgIyBjb2RlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfY29kZSA9IE5vbmU7CiAgICBkZWYgY29kZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fY29kZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9jb2RlOwogICAgCiAgICAjIG9yZGVyOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfb3JkZXIgPSBOb25lOwogICAgZGVmIG9yZGVyKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9vcmRlciA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9vcmRlcjsKICAgIAogICAgIyBkYXRlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfZGF0ZSA9IE5vbmU7CiAgICBkZWYgZGF0ZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fZGF0ZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9kYXRlOwogICAgCiAgICAjIG5hbWU6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9uYW1lID0gTm9uZTsKICAgIGRlZiBuYW1lKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9uYW1lID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX25hbWU7CiAgICAKICAgICMgcmVtYXJrOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfcmVtYXJrID0gTm9uZTsKICAgIGRlZiByZW1hcmsoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX3JlbWFyayA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9yZW1hcms7CiAgICAKICAgICMgdmFsdWU6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF92YWx1ZSA9IE5vbmU7CiAgICBkZWYgdmFsdWUoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX3ZhbHVlID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3ZhbHVlOwogICAgCiAgICAjIHNjcmlwdDogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX3NjcmlwdCA9IE5vbmU7CiAgICBkZWYgc2NyaXB0KHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9zY3JpcHQgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fc2NyaXB0OwogICAgCiAgICAjIHRvb2w6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF90b29sID0gTm9uZTsKICAgIGRlZiB0b29sKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl90b29sID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3Rvb2w7CiAgICAKICAgICMgZ3JvdXA6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9ncm91cCA9IE5vbmU7CiAgICBkZWYgZ3JvdXAoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2dyb3VwID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2dyb3VwOwogICAgCiAgICAjIHR5cGU6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF90eXBlID0gTm9uZTsKICAgIGRlZiB0eXBlKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl90eXBlID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3R5cGU7CiAgICAKICAgICMgbm9kZTogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX25vZGUgPSBOb25lOwogICAgZGVmIG5vZGUoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX25vZGUgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fbm9kZTsKICAgIAogICAgCiAgICAKICAgIAogICAgZGVmIF91bmlxdWUoc2VsZik6CiAgICAgICAgX190b1N0cmluZyA9ICdDb25maWc6Ol91bmlxdWUoKTogJzsKICAgICAgICAKICAgICAgICByZXQgPSBDb25maWcoKTsKICAgICAgICBpZiBzZWxmLklkIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXQuSWQgPSBzZWxmLklkOwogICAgCiAgICAgICAgaWYgc2VsZi5uYW1lKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldC5uYW1lKHNlbGYubmFtZSgpKTsKICAgIAogICAgICAgIGdjLmNvbGxlY3QoKTsKICAgICAgICByZXR1cm4gcmV0OwogICAgCiAgICBkZWYgX2Zyb21Eb2N1bWVudChzZWxmLCBvYmopOgogICAgICAgIF9fdG9TdHJpbmcgPSAnQ29uZmlnOjpfZnJvbURvY3VtZW50KCk6ICc7CiAgICAgICAgCiAgICAgICAgaWYgb2JqIGlzIE5vbmU6CiAgICAgICAgICAgIHJldHVybiBzZWxmOwoKICAgICAgICBpZiBpc2luc3RhbmNlKG9iaiwgYnl0ZXMpOgogICAgICAgICAgICBvYmogPSBzdHIob2JqLCAidXRmLTgiKTsKCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIHN0cikgb3IgdHlwZShvYmopIGlzIHN0cjoKICAgICAgICAgICAgaWYgcmUubWF0Y2gociIoKChbQS1aYS16XXszLDl9Oig/OlwvXC8pPykoPzpbLTs6Jj1cK1wkLFx3XStAKT9bQS1aYS16MC05Li1dK3woPzp3d3cufFstOzomPVwrXCQsXHddK0ApW0EtWmEtejAtOS4tXSspKCg/OlwvW1wrfiVcLy5cd1wtX10qKT9cPz8oPzpbLVwrPSY7JUAuXHdfXSopIz8oPzpbXHddKikpPykiLCBvYmopOgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIG9iaiA9IHVqc29uLmxvYWRzKHVybGxpYjMuUG9vbE1hbmFnZXIoKS5yZXF1ZXN0KCdHRVQnLCBvYmopLmRhdGEuZGVjb2RlKCd1dGYtOCcpKTsKICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICBvYmogPSB7fTsKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIG9iaiA9IHVqc29uLmxvYWRzKG9iaik7CiAgICAgICAgCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIGxpc3QpOgogICAgICAgICAgICByZXR1cm4gW0NvbmZpZygpLl9mcm9tRG9jdW1lbnQobykgZm9yIG8gaW4gb2JqXTsKICAgICAgICAgICAgCiAgICAgICAgaWYgbm90IGlzaW5zdGFuY2Uob2JqLCAoc3RyLCBieXRlcywgZGljdCkpOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJ3VuaGFuZGxlZCB0eXBlOiAnICsgc3RyKHR5cGUob2JqKSkpOwogICAgICAgICAgICByZXR1cm4gb2JqOwoKICAgICAgICBpZiAnSWQnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5JZCA9IG9ialsnSWQnXTsKCiAgICAKICAgICAgICBpZiAnYWN0aXZlJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuYWN0aXZlKG9ialsnYWN0aXZlJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ2VuYWJsZWQnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5lbmFibGVkKG9ialsnZW5hYmxlZCddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdjb2RlJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuY29kZShvYmpbJ2NvZGUnXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnb3JkZXInIGluIG9iajoKICAgICAgICAgICAgc2VsZi5vcmRlcihvYmpbJ29yZGVyJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ2RhdGUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5kYXRlKG9ialsnZGF0ZSddKTsKICAgICAgICAKICAgICAgICAgICAgc2VsZi5kYXRlKGRhdGV0aW1lLmRhdGV0aW1lLmZyb21pc29mb3JtYXQoc2VsZi5kYXRlKCkpKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICduYW1lJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYubmFtZShvYmpbJ25hbWUnXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAncmVtYXJrJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYucmVtYXJrKG9ialsncmVtYXJrJ10pOwogICAgICAgIAogICAgICAgICAgICBzZWxmLnJlbWFyayggdWJpbmFzY2lpLmEyYl9iYXNlNjQoc2VsZi5yZW1hcmsoKSkgKTsKICAgICAgICAgICAgaWYgc2VsZi5yZW1hcmsoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBzZWxmLnJlbWFyayhzZWxmLnJlbWFyaygpLmRlY29kZSgndXRmLTgnKS5zdHJpcCgpKTsKICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICBzZWxmLnJlbWFyaygpOwogICAgICAgICAgICAgICAgICAgICNwcmludChfX3RvU3RyaW5nICsgInJlbWFyayBleGNlcHRpb24iLCBzZWxmLnJlbWFyaygpKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICd2YWx1ZScgaW4gb2JqOgogICAgICAgICAgICBzZWxmLnZhbHVlKG9ialsndmFsdWUnXSk7CiAgICAgICAgCiAgICAgICAgICAgIHNlbGYudmFsdWUoIHViaW5hc2NpaS5hMmJfYmFzZTY0KHNlbGYudmFsdWUoKSkgKTsKICAgICAgICAgICAgaWYgc2VsZi52YWx1ZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIHNlbGYudmFsdWUoc2VsZi52YWx1ZSgpLmRlY29kZSgndXRmLTgnKS5zdHJpcCgpKTsKICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICBzZWxmLnZhbHVlKCk7CiAgICAgICAgICAgICAgICAgICAgI3ByaW50KF9fdG9TdHJpbmcgKyAidmFsdWUgZXhjZXB0aW9uIiwgc2VsZi52YWx1ZSgpKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdzY3JpcHQnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5zY3JpcHQob2JqWydzY3JpcHQnXSk7CiAgICAgICAgCiAgICAgICAgICAgIHNlbGYuc2NyaXB0KCB1YmluYXNjaWkuYTJiX2Jhc2U2NChzZWxmLnNjcmlwdCgpKSApOwogICAgICAgICAgICBpZiBzZWxmLnNjcmlwdCgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIHNlbGYuc2NyaXB0KHNlbGYuc2NyaXB0KCkuZGVjb2RlKCd1dGYtOCcpLnN0cmlwKCkpOwogICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgIHNlbGYuc2NyaXB0KCk7CiAgICAgICAgICAgICAgICAgICAgI3ByaW50KF9fdG9TdHJpbmcgKyAic2NyaXB0IGV4Y2VwdGlvbiIsIHNlbGYuc2NyaXB0KCkpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ3Rvb2wnIGluIG9iajoKICAgICAgICAgICAgc2VsZi50b29sKFRvb2woKS5fZnJvbURvY3VtZW50KG9ialsndG9vbCddKSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnZ3JvdXAnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5ncm91cChDb25maWdfR3JvdXAoKS5fZnJvbURvY3VtZW50KG9ialsnZ3JvdXAnXSkpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ3R5cGUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi50eXBlKFRvb2xfVHlwZSgpLl9mcm9tRG9jdW1lbnQob2JqWyd0eXBlJ10pKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdub2RlJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYubm9kZShOb2RlKCkuX2Zyb21Eb2N1bWVudChvYmpbJ25vZGUnXSkpOwogICAgICAgIAogICAgCgogICAgCgogICAgICAgIGdjLmNvbGxlY3QoKTsKICAgICAgICByZXR1cm4gc2VsZjsKICAgIAogICAgZGVmIF90b0RvY3VtZW50KHNlbGYsIGJKU09OPU5vbmUpOgogICAgICAgIF9fdG9TdHJpbmcgPSAnQ29uZmlnOjpfdG9Eb2N1bWVudCgpOiAnOwoKICAgICAgICByZXQgPSB7fTsKICAgICAgICBpZiBzZWxmLklkIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbIklkIl0gPSBzZWxmLklkOwoKICAgIAogICAgICAgIGlmIHNlbGYuYWN0aXZlKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiYWN0aXZlIl0gPSBzZWxmLmFjdGl2ZSgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5lbmFibGVkKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiZW5hYmxlZCJdID0gc2VsZi5lbmFibGVkKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLmNvZGUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJjb2RlIl0gPSBzZWxmLmNvZGUoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYub3JkZXIoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJvcmRlciJdID0gc2VsZi5vcmRlcigpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5kYXRlKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiZGF0ZSJdID0gc2VsZi5kYXRlKCk7CiAgICAgICAgCiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UocmV0WyJkYXRlIl0sIGRhdGV0aW1lLmRhdGV0aW1lKToKICAgICAgICAgICAgICAgIHJldFsiZGF0ZSJdID0gcmV0WyJkYXRlIl0uaXNvZm9ybWF0KCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLm5hbWUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJuYW1lIl0gPSBzZWxmLm5hbWUoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYucmVtYXJrKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSBzZWxmLnJlbWFyaygpOwogICAgICAgIAogICAgICAgICAgICBpZiBpc2luc3RhbmNlKHJldFsicmVtYXJrIl0sIGRpY3QpOgogICAgICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IHVqc29uLmR1bXBzKHJldFsicmVtYXJrIl0pLmVuY29kZSgndXRmLTgnKTsKCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSAgdWJpbmFzY2lpLmIyYV9iYXNlNjQocmV0WyJyZW1hcmsiXSkuZGVjb2RlKCd1dGYtOCcpLnN0cmlwKCk7CiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhjZXB0aW9uIHdpdGggcmVtYXJrOiAiICsgcmV0WyJyZW1hcmsiXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLnZhbHVlKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsidmFsdWUiXSA9IHNlbGYudmFsdWUoKTsKICAgICAgICAKICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShyZXRbInZhbHVlIl0sIGRpY3QpOgogICAgICAgICAgICAgICAgcmV0WyJ2YWx1ZSJdID0gdWpzb24uZHVtcHMocmV0WyJ2YWx1ZSJdKS5lbmNvZGUoJ3V0Zi04Jyk7CgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICByZXRbInZhbHVlIl0gPSAgdWJpbmFzY2lpLmIyYV9iYXNlNjQocmV0WyJ2YWx1ZSJdKS5kZWNvZGUoJ3V0Zi04Jykuc3RyaXAoKTsKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGNlcHRpb24gd2l0aCB2YWx1ZTogIiArIHJldFsidmFsdWUiXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLnNjcmlwdCgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbInNjcmlwdCJdID0gc2VsZi5zY3JpcHQoKTsKICAgICAgICAKICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShyZXRbInNjcmlwdCJdLCBkaWN0KToKICAgICAgICAgICAgICAgIHJldFsic2NyaXB0Il0gPSB1anNvbi5kdW1wcyhyZXRbInNjcmlwdCJdKS5lbmNvZGUoJ3V0Zi04Jyk7CgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICByZXRbInNjcmlwdCJdID0gIHViaW5hc2NpaS5iMmFfYmFzZTY0KHJldFsic2NyaXB0Il0pLmRlY29kZSgndXRmLTgnKS5zdHJpcCgpOwogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4Y2VwdGlvbiB3aXRoIHNjcmlwdDogIiArIHJldFsic2NyaXB0Il0pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi50b29sKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsidG9vbCJdID0gc2VsZi50b29sKCkuX3RvRG9jdW1lbnQoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYuZ3JvdXAoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJncm91cCJdID0gc2VsZi5ncm91cCgpLl90b0RvY3VtZW50KCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLnR5cGUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJ0eXBlIl0gPSBzZWxmLnR5cGUoKS5fdG9Eb2N1bWVudCgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5ub2RlKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsibm9kZSJdID0gc2VsZi5ub2RlKCkuX3RvRG9jdW1lbnQoKTsKICAgICAgICAKICAgIAogICAgICAgIAogICAgCgogICAgICAgIGlmIGJKU09OIGlzIG5vdCBOb25lOgogICAgICAgICAgICAjcHJpbnQoX190b1N0cmluZyArICJHT1QgSEVSRSIsIHR5cGUocmV0KSwgcmV0KTsKICAgICAgICAgICAgcmV0ID0gdWpzb24uZHVtcHMocmV0KTsKICAgICAgICBnYy5jb2xsZWN0KCk7CiAgICAgICAgcmV0dXJuIHJldDsKCiAgICAKICAgIGRlZiBzdG9yZShzZWxmLCBfX2V2ZW50PU5vbmUpOgogICAgICAgIF9fdG9TdHJpbmcgPSAnQ29uZmlnOjpzdG9yZSgpOiAnOwogICAgICAgIAogICAgICAgIGV2SlNPTiA9IE5vbmU7CgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIGV2SlNPTiA9IHVqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsKICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOgogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOwogICAgICAgIAoKICAgICAgICBhbnN3ZXIgPSBOb25lOwoKICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGlja3NfbXMoKSkrJ10uQ29uZmlnLnN0b3JlKCknKS5tZXRob2QoJ3N0b3JlJykuY2xhc3NOYW1lKCdDb25maWcnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7CiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTsKICAgICAgICAKICAgICAgICBnYy5jb2xsZWN0KCk7CgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsKCiAgICAgICAgCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7CiAgICAgICAgCiAgICAgICAgICAgIGFuc3dlciA9IENvbmZpZygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsKICAgICAgICAKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOwoKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOwogICAgICAgICAgICAKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOwoKICAgICAgICAgICAgCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOwogICAgICAgICAgICAKCiAgICAgICAgcmV0dXJuIGFuc3dlcjsKCiAgICAKICAgIGRlZiBmaW5kQWxsKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6CiAgICAgICAgX190b1N0cmluZyA9ICdDb25maWc6OmZpbmRBbGwoKTogJzsKICAgICAgICAKICAgICAgICBldkpTT04gPSBOb25lOwoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBldkpTT04gPSB1anNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7CiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoKICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsKICAgICAgICAKCiAgICAgICAgYW5zd2VyID0gTm9uZTsKCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpY2tzX21zKCkpKyddLkNvbmZpZy5maW5kQWxsKCknKS5tZXRob2QoJ2ZpbmRBbGwnKS5jbGFzc05hbWUoJ0NvbmZpZycpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpOwogICAgICAgIAogICAgICAgIGdjLmNvbGxlY3QoKTsKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOwoKICAgICAgICAKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsKICAgICAgICAKICAgICAgICAgICAgYW5zd2VyID0gQ29uZmlnKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOwogICAgICAgIAoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7CgoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOgogICAgICAgICAgICAKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7CgogICAgICAgICAgICAKICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7CiAgICAgICAgICAgIAoKICAgICAgICByZXR1cm4gYW5zd2VyOwoKICAgIAogICAgZGVmIGZpbmQoc2VsZiwgX19ldmVudD1Ob25lKToKICAgICAgICBfX3RvU3RyaW5nID0gJ0NvbmZpZzo6ZmluZCgpOiAnOwogICAgICAgIAogICAgICAgIGV2SlNPTiA9IE5vbmU7CgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIGV2SlNPTiA9IHVqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsKICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOgogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOwogICAgICAgIAoKICAgICAgICBhbnN3ZXIgPSBOb25lOwoKICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGlja3NfbXMoKSkrJ10uQ29uZmlnLmZpbmQoKScpLm1ldGhvZCgnZmluZCcpLmNsYXNzTmFtZSgnQ29uZmlnJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOwogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7CiAgICAgICAgCiAgICAgICAgZ2MuY29sbGVjdCgpOwoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7CgogICAgICAgIAogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOwogICAgICAgIAogICAgICAgICAgICBhbnN3ZXIgPSBDb25maWcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7CiAgICAgICAgCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsKCgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsKCiAgICAgICAgICAgIAogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsKICAgICAgICAgICAgCgogICAgICAgIHJldHVybiBhbnN3ZXI7CgogICAgCgoKY2xhc3MgVG9vbCgpOgogICAgZGVmIF9faW5pdF9fKHNlbGYsIElkPU5vbmUsIGFjdGl2ZT1Ob25lLCBlbmFibGVkPU5vbmUsIGNvZGU9Tm9uZSwgb3JkZXI9Tm9uZSwgZGF0ZT1Ob25lLCBuYW1lPU5vbmUsIHJlbWFyaz1Ob25lLCB0eXBlPU5vbmUpOgogICAgICAgIHN1cGVyKCkuX19pbml0X18oKTsKCiAgICAgICAgI3ByaW50KCdUb29sOjpfX2luaXRfXygpJyk7CiAgICAgICAgaWYgSWQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHNlbGYuSWQgPSBJZDsKCiAgICAgICAgCiAgICAgICAgc2VsZi5hY3RpdmUoYWN0aXZlKTsKICAgICAgICBzZWxmLmVuYWJsZWQoZW5hYmxlZCk7CiAgICAgICAgc2VsZi5jb2RlKGNvZGUpOwogICAgICAgIHNlbGYub3JkZXIob3JkZXIpOwogICAgICAgIHNlbGYuZGF0ZShkYXRlKTsKICAgICAgICBzZWxmLm5hbWUobmFtZSk7CiAgICAgICAgc2VsZi5yZW1hcmsocmVtYXJrKTsKICAgICAgICBzZWxmLnR5cGUodHlwZSk7CiAgICAgICAgCiAgICBJZCA9IE5vbmU7CiAgICAKICAgIAogICAgIyBhY3RpdmU6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9hY3RpdmUgPSBOb25lOwogICAgZGVmIGFjdGl2ZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fYWN0aXZlID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2FjdGl2ZTsKICAgIAogICAgIyBlbmFibGVkOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfZW5hYmxlZCA9IE5vbmU7CiAgICBkZWYgZW5hYmxlZChzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fZW5hYmxlZCA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9lbmFibGVkOwogICAgCiAgICAjIGNvZGU6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9jb2RlID0gTm9uZTsKICAgIGRlZiBjb2RlKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9jb2RlID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2NvZGU7CiAgICAKICAgICMgb3JkZXI6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9vcmRlciA9IE5vbmU7CiAgICBkZWYgb3JkZXIoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX29yZGVyID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX29yZGVyOwogICAgCiAgICAjIGRhdGU6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9kYXRlID0gTm9uZTsKICAgIGRlZiBkYXRlKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9kYXRlID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2RhdGU7CiAgICAKICAgICMgbmFtZTogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX25hbWUgPSBOb25lOwogICAgZGVmIG5hbWUoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX25hbWUgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fbmFtZTsKICAgIAogICAgIyByZW1hcms6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9yZW1hcmsgPSBOb25lOwogICAgZGVmIHJlbWFyayhzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fcmVtYXJrID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3JlbWFyazsKICAgIAogICAgIyB0eXBlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfdHlwZSA9IE5vbmU7CiAgICBkZWYgdHlwZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fdHlwZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl90eXBlOwogICAgCiAgICAKICAgIAogICAgIyB0b29sX0NvbmZpZ3M6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF90b29sX0NvbmZpZ3MgPSBOb25lOwogICAgZGVmIHRvb2xfQ29uZmlncyhzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fdG9vbF9Db25maWdzID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3Rvb2xfQ29uZmlnczsKICAgIAogICAgIyB0b29sX01hcHBpbmdzOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfdG9vbF9NYXBwaW5ncyA9IE5vbmU7CiAgICBkZWYgdG9vbF9NYXBwaW5ncyhzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fdG9vbF9NYXBwaW5ncyA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl90b29sX01hcHBpbmdzOwogICAgCiAgICAKICAgIGRlZiBfdW5pcXVlKHNlbGYpOgogICAgICAgIF9fdG9TdHJpbmcgPSAnVG9vbDo6X3VuaXF1ZSgpOiAnOwogICAgICAgIAogICAgICAgIHJldCA9IFRvb2woKTsKICAgICAgICBpZiBzZWxmLklkIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXQuSWQgPSBzZWxmLklkOwogICAgCiAgICAgICAgaWYgc2VsZi5uYW1lKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldC5uYW1lKHNlbGYubmFtZSgpKTsKICAgIAogICAgICAgIGdjLmNvbGxlY3QoKTsKICAgICAgICByZXR1cm4gcmV0OwogICAgCiAgICBkZWYgX2Zyb21Eb2N1bWVudChzZWxmLCBvYmopOgogICAgICAgIF9fdG9TdHJpbmcgPSAnVG9vbDo6X2Zyb21Eb2N1bWVudCgpOiAnOwogICAgICAgIAogICAgICAgIGlmIG9iaiBpcyBOb25lOgogICAgICAgICAgICByZXR1cm4gc2VsZjsKCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIGJ5dGVzKToKICAgICAgICAgICAgb2JqID0gc3RyKG9iaiwgInV0Zi04Iik7CgogICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLCBzdHIpIG9yIHR5cGUob2JqKSBpcyBzdHI6CiAgICAgICAgICAgIGlmIHJlLm1hdGNoKHIiKCgoW0EtWmEtel17Myw5fTooPzpcL1wvKT8pKD86Wy07OiY9XCtcJCxcd10rQCk/W0EtWmEtejAtOS4tXSt8KD86d3d3LnxbLTs6Jj1cK1wkLFx3XStAKVtBLVphLXowLTkuLV0rKSgoPzpcL1tcK34lXC8uXHdcLV9dKik/XD8/KD86Wy1cKz0mOyVALlx3X10qKSM/KD86W1x3XSopKT8pIiwgb2JqKToKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBvYmogPSB1anNvbi5sb2Fkcyh1cmxsaWIzLlBvb2xNYW5hZ2VyKCkucmVxdWVzdCgnR0VUJywgb2JqKS5kYXRhLmRlY29kZSgndXRmLTgnKSk7CiAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgb2JqID0ge307CiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBvYmogPSB1anNvbi5sb2FkcyhvYmopOwogICAgICAgIAogICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLCBsaXN0KToKICAgICAgICAgICAgcmV0dXJuIFtUb29sKCkuX2Zyb21Eb2N1bWVudChvKSBmb3IgbyBpbiBvYmpdOwogICAgICAgICAgICAKICAgICAgICBpZiBub3QgaXNpbnN0YW5jZShvYmosIChzdHIsIGJ5dGVzLCBkaWN0KSk6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAndW5oYW5kbGVkIHR5cGU6ICcgKyBzdHIodHlwZShvYmopKSk7CiAgICAgICAgICAgIHJldHVybiBvYmo7CgogICAgICAgIGlmICdJZCcgaW4gb2JqOgogICAgICAgICAgICBzZWxmLklkID0gb2JqWydJZCddOwoKICAgIAogICAgICAgIGlmICdhY3RpdmUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5hY3RpdmUob2JqWydhY3RpdmUnXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnZW5hYmxlZCcgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmVuYWJsZWQob2JqWydlbmFibGVkJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ2NvZGUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5jb2RlKG9ialsnY29kZSddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdvcmRlcicgaW4gb2JqOgogICAgICAgICAgICBzZWxmLm9yZGVyKG9ialsnb3JkZXInXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnZGF0ZScgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmRhdGUob2JqWydkYXRlJ10pOwogICAgICAgIAogICAgICAgICAgICBzZWxmLmRhdGUoZGF0ZXRpbWUuZGF0ZXRpbWUuZnJvbWlzb2Zvcm1hdChzZWxmLmRhdGUoKSkpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ25hbWUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5uYW1lKG9ialsnbmFtZSddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdyZW1hcmsnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5yZW1hcmsob2JqWydyZW1hcmsnXSk7CiAgICAgICAgCiAgICAgICAgICAgIHNlbGYucmVtYXJrKCB1YmluYXNjaWkuYTJiX2Jhc2U2NChzZWxmLnJlbWFyaygpKSApOwogICAgICAgICAgICBpZiBzZWxmLnJlbWFyaygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIHNlbGYucmVtYXJrKHNlbGYucmVtYXJrKCkuZGVjb2RlKCd1dGYtOCcpLnN0cmlwKCkpOwogICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgIHNlbGYucmVtYXJrKCk7CiAgICAgICAgICAgICAgICAgICAgI3ByaW50KF9fdG9TdHJpbmcgKyAicmVtYXJrIGV4Y2VwdGlvbiIsIHNlbGYucmVtYXJrKCkpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ3R5cGUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi50eXBlKFRvb2xfVHlwZSgpLl9mcm9tRG9jdW1lbnQob2JqWyd0eXBlJ10pKTsKICAgICAgICAKICAgIAoKICAgIAogICAgICAgIGlmICd0b29sX0NvbmZpZ3MnIGluIG9iajoKICAgICAgICAgICAgc2VsZi50b29sX0NvbmZpZ3MoQ29uZmlnKCkuX2Zyb21Eb2N1bWVudChvYmpbJ3Rvb2xfQ29uZmlncyddKSk7CiAgICAKICAgICAgICBpZiAndG9vbF9NYXBwaW5ncycgaW4gb2JqOgogICAgICAgICAgICBzZWxmLnRvb2xfTWFwcGluZ3MoTWFwcGluZygpLl9mcm9tRG9jdW1lbnQob2JqWyd0b29sX01hcHBpbmdzJ10pKTsKICAgIAoKICAgICAgICBnYy5jb2xsZWN0KCk7CiAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAKICAgIGRlZiBfdG9Eb2N1bWVudChzZWxmLCBiSlNPTj1Ob25lKToKICAgICAgICBfX3RvU3RyaW5nID0gJ1Rvb2w6Ol90b0RvY3VtZW50KCk6ICc7CgogICAgICAgIHJldCA9IHt9OwogICAgICAgIGlmIHNlbGYuSWQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiSWQiXSA9IHNlbGYuSWQ7CgogICAgCiAgICAgICAgaWYgc2VsZi5hY3RpdmUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJhY3RpdmUiXSA9IHNlbGYuYWN0aXZlKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLmVuYWJsZWQoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJlbmFibGVkIl0gPSBzZWxmLmVuYWJsZWQoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYuY29kZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbImNvZGUiXSA9IHNlbGYuY29kZSgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5vcmRlcigpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbIm9yZGVyIl0gPSBzZWxmLm9yZGVyKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLmRhdGUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJkYXRlIl0gPSBzZWxmLmRhdGUoKTsKICAgICAgICAKICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShyZXRbImRhdGUiXSwgZGF0ZXRpbWUuZGF0ZXRpbWUpOgogICAgICAgICAgICAgICAgcmV0WyJkYXRlIl0gPSByZXRbImRhdGUiXS5pc29mb3JtYXQoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYubmFtZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbIm5hbWUiXSA9IHNlbGYubmFtZSgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5yZW1hcmsoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IHNlbGYucmVtYXJrKCk7CiAgICAgICAgCiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UocmV0WyJyZW1hcmsiXSwgZGljdCk6CiAgICAgICAgICAgICAgICByZXRbInJlbWFyayJdID0gdWpzb24uZHVtcHMocmV0WyJyZW1hcmsiXSkuZW5jb2RlKCd1dGYtOCcpOwoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9ICB1YmluYXNjaWkuYjJhX2Jhc2U2NChyZXRbInJlbWFyayJdKS5kZWNvZGUoJ3V0Zi04Jykuc3RyaXAoKTsKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGNlcHRpb24gd2l0aCByZW1hcms6ICIgKyByZXRbInJlbWFyayJdKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYudHlwZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbInR5cGUiXSA9IHNlbGYudHlwZSgpLl90b0RvY3VtZW50KCk7CiAgICAgICAgCiAgICAKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYudG9vbF9Db25maWdzKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsidG9vbF9Db25maWdzIl0gPSBbdGEuX3RvRG9jdW1lbnQoKSBmb3IgdGEgaW4gc2VsZi50b29sX0NvbmZpZ3MoKV07CiAgICAKICAgICAgICBpZiBzZWxmLnRvb2xfTWFwcGluZ3MoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJ0b29sX01hcHBpbmdzIl0gPSBbdGEuX3RvRG9jdW1lbnQoKSBmb3IgdGEgaW4gc2VsZi50b29sX01hcHBpbmdzKCldOwogICAgCgogICAgICAgIGlmIGJKU09OIGlzIG5vdCBOb25lOgogICAgICAgICAgICAjcHJpbnQoX190b1N0cmluZyArICJHT1QgSEVSRSIsIHR5cGUocmV0KSwgcmV0KTsKICAgICAgICAgICAgcmV0ID0gdWpzb24uZHVtcHMocmV0KTsKICAgICAgICBnYy5jb2xsZWN0KCk7CiAgICAgICAgcmV0dXJuIHJldDsKCiAgICAKICAgIGRlZiBzdG9yZShzZWxmLCBfX2V2ZW50PU5vbmUpOgogICAgICAgIF9fdG9TdHJpbmcgPSAnVG9vbDo6c3RvcmUoKTogJzsKICAgICAgICAKICAgICAgICBldkpTT04gPSBOb25lOwoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBldkpTT04gPSB1anNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7CiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoKICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsKICAgICAgICAKCiAgICAgICAgYW5zd2VyID0gTm9uZTsKCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpY2tzX21zKCkpKyddLlRvb2wuc3RvcmUoKScpLm1ldGhvZCgnc3RvcmUnKS5jbGFzc05hbWUoJ1Rvb2wnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7CiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTsKICAgICAgICAKICAgICAgICBnYy5jb2xsZWN0KCk7CgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsKCiAgICAgICAgCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7CiAgICAgICAgCiAgICAgICAgICAgIGFuc3dlciA9IFRvb2woKS5fZnJvbURvY3VtZW50KGV2SlNPTik7CiAgICAgICAgCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsKCgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsKCiAgICAgICAgICAgIAogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsKICAgICAgICAgICAgCgogICAgICAgIHJldHVybiBhbnN3ZXI7CgogICAgCiAgICBkZWYgZmluZEFsbChzZWxmLCBfX2V2ZW50PU5vbmUpOgogICAgICAgIF9fdG9TdHJpbmcgPSAnVG9vbDo6ZmluZEFsbCgpOiAnOwogICAgICAgIAogICAgICAgIGV2SlNPTiA9IE5vbmU7CgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIGV2SlNPTiA9IHVqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsKICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOgogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOwogICAgICAgIAoKICAgICAgICBhbnN3ZXIgPSBOb25lOwoKICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGlja3NfbXMoKSkrJ10uVG9vbC5maW5kQWxsKCknKS5tZXRob2QoJ2ZpbmRBbGwnKS5jbGFzc05hbWUoJ1Rvb2wnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7CiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTsKICAgICAgICAKICAgICAgICBnYy5jb2xsZWN0KCk7CgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsKCiAgICAgICAgCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7CiAgICAgICAgCiAgICAgICAgICAgIGFuc3dlciA9IFRvb2woKS5fZnJvbURvY3VtZW50KGV2SlNPTik7CiAgICAgICAgCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsKCgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsKCiAgICAgICAgICAgIAogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsKICAgICAgICAgICAgCgogICAgICAgIHJldHVybiBhbnN3ZXI7CgogICAgCiAgICBkZWYgZmluZChzZWxmLCBfX2V2ZW50PU5vbmUpOgogICAgICAgIF9fdG9TdHJpbmcgPSAnVG9vbDo6ZmluZCgpOiAnOwogICAgICAgIAogICAgICAgIGV2SlNPTiA9IE5vbmU7CgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIGV2SlNPTiA9IHVqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsKICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOgogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOwogICAgICAgIAoKICAgICAgICBhbnN3ZXIgPSBOb25lOwoKICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGlja3NfbXMoKSkrJ10uVG9vbC5maW5kKCknKS5tZXRob2QoJ2ZpbmQnKS5jbGFzc05hbWUoJ1Rvb2wnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7CiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTsKICAgICAgICAKICAgICAgICBnYy5jb2xsZWN0KCk7CgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsKCiAgICAgICAgCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7CiAgICAgICAgCiAgICAgICAgICAgIGFuc3dlciA9IFRvb2woKS5fZnJvbURvY3VtZW50KGV2SlNPTik7CiAgICAgICAgCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsKCgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsKCiAgICAgICAgICAgIAogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsKICAgICAgICAgICAgCgogICAgICAgIHJldHVybiBhbnN3ZXI7CgogICAgCgoKY2xhc3MgQ29uZmlnX0dyb3VwKCk6CiAgICBkZWYgX19pbml0X18oc2VsZiwgSWQ9Tm9uZSwgYWN0aXZlPU5vbmUsIGVuYWJsZWQ9Tm9uZSwgY29kZT1Ob25lLCBvcmRlcj1Ob25lLCBkYXRlPU5vbmUsIG5hbWU9Tm9uZSwgcmVtYXJrPU5vbmUpOgogICAgICAgIHN1cGVyKCkuX19pbml0X18oKTsKCiAgICAgICAgI3ByaW50KCdDb25maWdfR3JvdXA6Ol9faW5pdF9fKCknKTsKICAgICAgICBpZiBJZCBpcyBub3QgTm9uZToKICAgICAgICAgICAgc2VsZi5JZCA9IElkOwoKICAgICAgICAKICAgICAgICBzZWxmLmFjdGl2ZShhY3RpdmUpOwogICAgICAgIHNlbGYuZW5hYmxlZChlbmFibGVkKTsKICAgICAgICBzZWxmLmNvZGUoY29kZSk7CiAgICAgICAgc2VsZi5vcmRlcihvcmRlcik7CiAgICAgICAgc2VsZi5kYXRlKGRhdGUpOwogICAgICAgIHNlbGYubmFtZShuYW1lKTsKICAgICAgICBzZWxmLnJlbWFyayhyZW1hcmspOwogICAgICAgIAogICAgSWQgPSBOb25lOwogICAgCiAgICAKICAgICMgYWN0aXZlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfYWN0aXZlID0gTm9uZTsKICAgIGRlZiBhY3RpdmUoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2FjdGl2ZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9hY3RpdmU7CiAgICAKICAgICMgZW5hYmxlZDogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX2VuYWJsZWQgPSBOb25lOwogICAgZGVmIGVuYWJsZWQoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2VuYWJsZWQgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fZW5hYmxlZDsKICAgIAogICAgIyBjb2RlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfY29kZSA9IE5vbmU7CiAgICBkZWYgY29kZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fY29kZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9jb2RlOwogICAgCiAgICAjIG9yZGVyOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfb3JkZXIgPSBOb25lOwogICAgZGVmIG9yZGVyKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9vcmRlciA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9vcmRlcjsKICAgIAogICAgIyBkYXRlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfZGF0ZSA9IE5vbmU7CiAgICBkZWYgZGF0ZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fZGF0ZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9kYXRlOwogICAgCiAgICAjIG5hbWU6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9uYW1lID0gTm9uZTsKICAgIGRlZiBuYW1lKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9uYW1lID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX25hbWU7CiAgICAKICAgICMgcmVtYXJrOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfcmVtYXJrID0gTm9uZTsKICAgIGRlZiByZW1hcmsoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX3JlbWFyayA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9yZW1hcms7CiAgICAKICAgIAogICAgCiAgICAjIGdyb3VwX0NvbmZpZ3M6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9ncm91cF9Db25maWdzID0gTm9uZTsKICAgIGRlZiBncm91cF9Db25maWdzKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9ncm91cF9Db25maWdzID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2dyb3VwX0NvbmZpZ3M7CiAgICAKICAgICMgZ3JvdXBfTWFwcGluZ3M6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9ncm91cF9NYXBwaW5ncyA9IE5vbmU7CiAgICBkZWYgZ3JvdXBfTWFwcGluZ3Moc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2dyb3VwX01hcHBpbmdzID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2dyb3VwX01hcHBpbmdzOwogICAgCiAgICAKICAgIGRlZiBfdW5pcXVlKHNlbGYpOgogICAgICAgIF9fdG9TdHJpbmcgPSAnQ29uZmlnX0dyb3VwOjpfdW5pcXVlKCk6ICc7CiAgICAgICAgCiAgICAgICAgcmV0ID0gQ29uZmlnX0dyb3VwKCk7CiAgICAgICAgaWYgc2VsZi5JZCBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0LklkID0gc2VsZi5JZDsKICAgIAogICAgICAgIGlmIHNlbGYuY29kZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXQuY29kZShzZWxmLmNvZGUoKSk7CiAgICAKICAgICAgICBnYy5jb2xsZWN0KCk7CiAgICAgICAgcmV0dXJuIHJldDsKICAgIAogICAgZGVmIF9mcm9tRG9jdW1lbnQoc2VsZiwgb2JqKToKICAgICAgICBfX3RvU3RyaW5nID0gJ0NvbmZpZ19Hcm91cDo6X2Zyb21Eb2N1bWVudCgpOiAnOwogICAgICAgIAogICAgICAgIGlmIG9iaiBpcyBOb25lOgogICAgICAgICAgICByZXR1cm4gc2VsZjsKCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIGJ5dGVzKToKICAgICAgICAgICAgb2JqID0gc3RyKG9iaiwgInV0Zi04Iik7CgogICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLCBzdHIpIG9yIHR5cGUob2JqKSBpcyBzdHI6CiAgICAgICAgICAgIGlmIHJlLm1hdGNoKHIiKCgoW0EtWmEtel17Myw5fTooPzpcL1wvKT8pKD86Wy07OiY9XCtcJCxcd10rQCk/W0EtWmEtejAtOS4tXSt8KD86d3d3LnxbLTs6Jj1cK1wkLFx3XStAKVtBLVphLXowLTkuLV0rKSgoPzpcL1tcK34lXC8uXHdcLV9dKik/XD8/KD86Wy1cKz0mOyVALlx3X10qKSM/KD86W1x3XSopKT8pIiwgb2JqKToKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBvYmogPSB1anNvbi5sb2Fkcyh1cmxsaWIzLlBvb2xNYW5hZ2VyKCkucmVxdWVzdCgnR0VUJywgb2JqKS5kYXRhLmRlY29kZSgndXRmLTgnKSk7CiAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgb2JqID0ge307CiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBvYmogPSB1anNvbi5sb2FkcyhvYmopOwogICAgICAgIAogICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLCBsaXN0KToKICAgICAgICAgICAgcmV0dXJuIFtDb25maWdfR3JvdXAoKS5fZnJvbURvY3VtZW50KG8pIGZvciBvIGluIG9ial07CiAgICAgICAgICAgIAogICAgICAgIGlmIG5vdCBpc2luc3RhbmNlKG9iaiwgKHN0ciwgYnl0ZXMsIGRpY3QpKToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICd1bmhhbmRsZWQgdHlwZTogJyArIHN0cih0eXBlKG9iaikpKTsKICAgICAgICAgICAgcmV0dXJuIG9iajsKCiAgICAgICAgaWYgJ0lkJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuSWQgPSBvYmpbJ0lkJ107CgogICAgCiAgICAgICAgaWYgJ2FjdGl2ZScgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmFjdGl2ZShvYmpbJ2FjdGl2ZSddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdlbmFibGVkJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuZW5hYmxlZChvYmpbJ2VuYWJsZWQnXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnY29kZScgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmNvZGUob2JqWydjb2RlJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ29yZGVyJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYub3JkZXIob2JqWydvcmRlciddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdkYXRlJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuZGF0ZShvYmpbJ2RhdGUnXSk7CiAgICAgICAgCiAgICAgICAgICAgIHNlbGYuZGF0ZShkYXRldGltZS5kYXRldGltZS5mcm9taXNvZm9ybWF0KHNlbGYuZGF0ZSgpKSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnbmFtZScgaW4gb2JqOgogICAgICAgICAgICBzZWxmLm5hbWUob2JqWyduYW1lJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ3JlbWFyaycgaW4gb2JqOgogICAgICAgICAgICBzZWxmLnJlbWFyayhvYmpbJ3JlbWFyayddKTsKICAgICAgICAKICAgICAgICAgICAgc2VsZi5yZW1hcmsoIHViaW5hc2NpaS5hMmJfYmFzZTY0KHNlbGYucmVtYXJrKCkpICk7CiAgICAgICAgICAgIGlmIHNlbGYucmVtYXJrKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5yZW1hcmsoc2VsZi5yZW1hcmsoKS5kZWNvZGUoJ3V0Zi04Jykuc3RyaXAoKSk7CiAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5yZW1hcmsoKTsKICAgICAgICAgICAgICAgICAgICAjcHJpbnQoX190b1N0cmluZyArICJyZW1hcmsgZXhjZXB0aW9uIiwgc2VsZi5yZW1hcmsoKSk7CiAgICAgICAgCiAgICAKCiAgICAKICAgICAgICBpZiAnZ3JvdXBfQ29uZmlncycgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmdyb3VwX0NvbmZpZ3MoQ29uZmlnKCkuX2Zyb21Eb2N1bWVudChvYmpbJ2dyb3VwX0NvbmZpZ3MnXSkpOwogICAgCiAgICAgICAgaWYgJ2dyb3VwX01hcHBpbmdzJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuZ3JvdXBfTWFwcGluZ3MoTWFwcGluZygpLl9mcm9tRG9jdW1lbnQob2JqWydncm91cF9NYXBwaW5ncyddKSk7CiAgICAKCiAgICAgICAgZ2MuY29sbGVjdCgpOwogICAgICAgIHJldHVybiBzZWxmOwogICAgCiAgICBkZWYgX3RvRG9jdW1lbnQoc2VsZiwgYkpTT049Tm9uZSk6CiAgICAgICAgX190b1N0cmluZyA9ICdDb25maWdfR3JvdXA6Ol90b0RvY3VtZW50KCk6ICc7CgogICAgICAgIHJldCA9IHt9OwogICAgICAgIGlmIHNlbGYuSWQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiSWQiXSA9IHNlbGYuSWQ7CgogICAgCiAgICAgICAgaWYgc2VsZi5hY3RpdmUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJhY3RpdmUiXSA9IHNlbGYuYWN0aXZlKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLmVuYWJsZWQoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJlbmFibGVkIl0gPSBzZWxmLmVuYWJsZWQoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYuY29kZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbImNvZGUiXSA9IHNlbGYuY29kZSgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5vcmRlcigpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbIm9yZGVyIl0gPSBzZWxmLm9yZGVyKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLmRhdGUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJkYXRlIl0gPSBzZWxmLmRhdGUoKTsKICAgICAgICAKICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShyZXRbImRhdGUiXSwgZGF0ZXRpbWUuZGF0ZXRpbWUpOgogICAgICAgICAgICAgICAgcmV0WyJkYXRlIl0gPSByZXRbImRhdGUiXS5pc29mb3JtYXQoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYubmFtZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbIm5hbWUiXSA9IHNlbGYubmFtZSgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5yZW1hcmsoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IHNlbGYucmVtYXJrKCk7CiAgICAgICAgCiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UocmV0WyJyZW1hcmsiXSwgZGljdCk6CiAgICAgICAgICAgICAgICByZXRbInJlbWFyayJdID0gdWpzb24uZHVtcHMocmV0WyJyZW1hcmsiXSkuZW5jb2RlKCd1dGYtOCcpOwoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9ICB1YmluYXNjaWkuYjJhX2Jhc2U2NChyZXRbInJlbWFyayJdKS5kZWNvZGUoJ3V0Zi04Jykuc3RyaXAoKTsKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGNlcHRpb24gd2l0aCByZW1hcms6ICIgKyByZXRbInJlbWFyayJdKTsKICAgICAgICAKICAgIAogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5ncm91cF9Db25maWdzKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiZ3JvdXBfQ29uZmlncyJdID0gW3RhLl90b0RvY3VtZW50KCkgZm9yIHRhIGluIHNlbGYuZ3JvdXBfQ29uZmlncygpXTsKICAgIAogICAgICAgIGlmIHNlbGYuZ3JvdXBfTWFwcGluZ3MoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJncm91cF9NYXBwaW5ncyJdID0gW3RhLl90b0RvY3VtZW50KCkgZm9yIHRhIGluIHNlbGYuZ3JvdXBfTWFwcGluZ3MoKV07CiAgICAKCiAgICAgICAgaWYgYkpTT04gaXMgbm90IE5vbmU6CiAgICAgICAgICAgICNwcmludChfX3RvU3RyaW5nICsgIkdPVCBIRVJFIiwgdHlwZShyZXQpLCByZXQpOwogICAgICAgICAgICByZXQgPSB1anNvbi5kdW1wcyhyZXQpOwogICAgICAgIGdjLmNvbGxlY3QoKTsKICAgICAgICByZXR1cm4gcmV0OwoKICAgIAogICAgZGVmIHN0b3JlKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6CiAgICAgICAgX190b1N0cmluZyA9ICdDb25maWdfR3JvdXA6OnN0b3JlKCk6ICc7CiAgICAgICAgCiAgICAgICAgZXZKU09OID0gTm9uZTsKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgZXZKU09OID0gdWpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOwogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046CiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7CiAgICAgICAgCgogICAgICAgIGFuc3dlciA9IE5vbmU7CgogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aWNrc19tcygpKSsnXS5Db25maWdfR3JvdXAuc3RvcmUoKScpLm1ldGhvZCgnc3RvcmUnKS5jbGFzc05hbWUoJ0NvbmZpZ19Hcm91cCcpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpOwogICAgICAgIAogICAgICAgIGdjLmNvbGxlY3QoKTsKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOwoKICAgICAgICAKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsKICAgICAgICAKICAgICAgICAgICAgYW5zd2VyID0gQ29uZmlnX0dyb3VwKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOwogICAgICAgIAoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7CgoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOgogICAgICAgICAgICAKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7CgogICAgICAgICAgICAKICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7CiAgICAgICAgICAgIAoKICAgICAgICByZXR1cm4gYW5zd2VyOwoKICAgIAogICAgZGVmIGZpbmRBbGwoc2VsZiwgX19ldmVudD1Ob25lKToKICAgICAgICBfX3RvU3RyaW5nID0gJ0NvbmZpZ19Hcm91cDo6ZmluZEFsbCgpOiAnOwogICAgICAgIAogICAgICAgIGV2SlNPTiA9IE5vbmU7CgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIGV2SlNPTiA9IHVqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsKICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOgogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOwogICAgICAgIAoKICAgICAgICBhbnN3ZXIgPSBOb25lOwoKICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGlja3NfbXMoKSkrJ10uQ29uZmlnX0dyb3VwLmZpbmRBbGwoKScpLm1ldGhvZCgnZmluZEFsbCcpLmNsYXNzTmFtZSgnQ29uZmlnX0dyb3VwJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOwogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7CiAgICAgICAgCiAgICAgICAgZ2MuY29sbGVjdCgpOwoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7CgogICAgICAgIAogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOwogICAgICAgIAogICAgICAgICAgICBhbnN3ZXIgPSBDb25maWdfR3JvdXAoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7CiAgICAgICAgCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsKCgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsKCiAgICAgICAgICAgIAogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsKICAgICAgICAgICAgCgogICAgICAgIHJldHVybiBhbnN3ZXI7CgogICAgCiAgICBkZWYgZmluZChzZWxmLCBfX2V2ZW50PU5vbmUpOgogICAgICAgIF9fdG9TdHJpbmcgPSAnQ29uZmlnX0dyb3VwOjpmaW5kKCk6ICc7CiAgICAgICAgCiAgICAgICAgZXZKU09OID0gTm9uZTsKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgZXZKU09OID0gdWpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOwogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046CiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7CiAgICAgICAgCgogICAgICAgIGFuc3dlciA9IE5vbmU7CgogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aWNrc19tcygpKSsnXS5Db25maWdfR3JvdXAuZmluZCgpJykubWV0aG9kKCdmaW5kJykuY2xhc3NOYW1lKCdDb25maWdfR3JvdXAnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7CiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTsKICAgICAgICAKICAgICAgICBnYy5jb2xsZWN0KCk7CgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsKCiAgICAgICAgCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7CiAgICAgICAgCiAgICAgICAgICAgIGFuc3dlciA9IENvbmZpZ19Hcm91cCgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsKICAgICAgICAKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOwoKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOwogICAgICAgICAgICAKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOwoKICAgICAgICAgICAgCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOwogICAgICAgICAgICAKCiAgICAgICAgcmV0dXJuIGFuc3dlcjsKCiAgICAKCgpjbGFzcyBNYXBwaW5nX0dyb3VwKCk6CiAgICBkZWYgX19pbml0X18oc2VsZiwgSWQ9Tm9uZSwgYWN0aXZlPU5vbmUsIGVuYWJsZWQ9Tm9uZSwgY29kZT1Ob25lLCBvcmRlcj1Ob25lLCBkYXRlPU5vbmUsIG5hbWU9Tm9uZSwgcmVtYXJrPU5vbmUpOgogICAgICAgIHN1cGVyKCkuX19pbml0X18oKTsKCiAgICAgICAgI3ByaW50KCdNYXBwaW5nX0dyb3VwOjpfX2luaXRfXygpJyk7CiAgICAgICAgaWYgSWQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHNlbGYuSWQgPSBJZDsKCiAgICAgICAgCiAgICAgICAgc2VsZi5hY3RpdmUoYWN0aXZlKTsKICAgICAgICBzZWxmLmVuYWJsZWQoZW5hYmxlZCk7CiAgICAgICAgc2VsZi5jb2RlKGNvZGUpOwogICAgICAgIHNlbGYub3JkZXIob3JkZXIpOwogICAgICAgIHNlbGYuZGF0ZShkYXRlKTsKICAgICAgICBzZWxmLm5hbWUobmFtZSk7CiAgICAgICAgc2VsZi5yZW1hcmsocmVtYXJrKTsKICAgICAgICAKICAgIElkID0gTm9uZTsKICAgIAogICAgCiAgICAjIGFjdGl2ZTogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX2FjdGl2ZSA9IE5vbmU7CiAgICBkZWYgYWN0aXZlKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9hY3RpdmUgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fYWN0aXZlOwogICAgCiAgICAjIGVuYWJsZWQ6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9lbmFibGVkID0gTm9uZTsKICAgIGRlZiBlbmFibGVkKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9lbmFibGVkID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2VuYWJsZWQ7CiAgICAKICAgICMgY29kZTogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX2NvZGUgPSBOb25lOwogICAgZGVmIGNvZGUoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2NvZGUgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fY29kZTsKICAgIAogICAgIyBvcmRlcjogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX29yZGVyID0gTm9uZTsKICAgIGRlZiBvcmRlcihzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fb3JkZXIgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fb3JkZXI7CiAgICAKICAgICMgZGF0ZTogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX2RhdGUgPSBOb25lOwogICAgZGVmIGRhdGUoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2RhdGUgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fZGF0ZTsKICAgIAogICAgIyBuYW1lOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfbmFtZSA9IE5vbmU7CiAgICBkZWYgbmFtZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fbmFtZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9uYW1lOwogICAgCiAgICAjIHJlbWFyazogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX3JlbWFyayA9IE5vbmU7CiAgICBkZWYgcmVtYXJrKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9yZW1hcmsgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fcmVtYXJrOwogICAgCiAgICAKICAgIAogICAgCiAgICBkZWYgX3VuaXF1ZShzZWxmKToKICAgICAgICBfX3RvU3RyaW5nID0gJ01hcHBpbmdfR3JvdXA6Ol91bmlxdWUoKTogJzsKICAgICAgICAKICAgICAgICByZXQgPSBNYXBwaW5nX0dyb3VwKCk7CiAgICAgICAgaWYgc2VsZi5JZCBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0LklkID0gc2VsZi5JZDsKICAgIAogICAgICAgIGlmIHNlbGYuY29kZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXQuY29kZShzZWxmLmNvZGUoKSk7CiAgICAKICAgICAgICBnYy5jb2xsZWN0KCk7CiAgICAgICAgcmV0dXJuIHJldDsKICAgIAogICAgZGVmIF9mcm9tRG9jdW1lbnQoc2VsZiwgb2JqKToKICAgICAgICBfX3RvU3RyaW5nID0gJ01hcHBpbmdfR3JvdXA6Ol9mcm9tRG9jdW1lbnQoKTogJzsKICAgICAgICAKICAgICAgICBpZiBvYmogaXMgTm9uZToKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CgogICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLCBieXRlcyk6CiAgICAgICAgICAgIG9iaiA9IHN0cihvYmosICJ1dGYtOCIpOwoKICAgICAgICBpZiBpc2luc3RhbmNlKG9iaiwgc3RyKSBvciB0eXBlKG9iaikgaXMgc3RyOgogICAgICAgICAgICBpZiByZS5tYXRjaChyIigoKFtBLVphLXpdezMsOX06KD86XC9cLyk/KSg/OlstOzomPVwrXCQsXHddK0ApP1tBLVphLXowLTkuLV0rfCg/Ond3dy58Wy07OiY9XCtcJCxcd10rQClbQS1aYS16MC05Li1dKykoKD86XC9bXCt+JVwvLlx3XC1fXSopP1w/Pyg/OlstXCs9JjslQC5cd19dKikjPyg/Oltcd10qKSk/KSIsIG9iaik6CiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgb2JqID0gdWpzb24ubG9hZHModXJsbGliMy5Qb29sTWFuYWdlcigpLnJlcXVlc3QoJ0dFVCcsIG9iaikuZGF0YS5kZWNvZGUoJ3V0Zi04JykpOwogICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgIG9iaiA9IHt9OwogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgb2JqID0gdWpzb24ubG9hZHMob2JqKTsKICAgICAgICAKICAgICAgICBpZiBpc2luc3RhbmNlKG9iaiwgbGlzdCk6CiAgICAgICAgICAgIHJldHVybiBbTWFwcGluZ19Hcm91cCgpLl9mcm9tRG9jdW1lbnQobykgZm9yIG8gaW4gb2JqXTsKICAgICAgICAgICAgCiAgICAgICAgaWYgbm90IGlzaW5zdGFuY2Uob2JqLCAoc3RyLCBieXRlcywgZGljdCkpOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgJ3VuaGFuZGxlZCB0eXBlOiAnICsgc3RyKHR5cGUob2JqKSkpOwogICAgICAgICAgICByZXR1cm4gb2JqOwoKICAgICAgICBpZiAnSWQnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5JZCA9IG9ialsnSWQnXTsKCiAgICAKICAgICAgICBpZiAnYWN0aXZlJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuYWN0aXZlKG9ialsnYWN0aXZlJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ2VuYWJsZWQnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5lbmFibGVkKG9ialsnZW5hYmxlZCddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdjb2RlJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuY29kZShvYmpbJ2NvZGUnXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnb3JkZXInIGluIG9iajoKICAgICAgICAgICAgc2VsZi5vcmRlcihvYmpbJ29yZGVyJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ2RhdGUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5kYXRlKG9ialsnZGF0ZSddKTsKICAgICAgICAKICAgICAgICAgICAgc2VsZi5kYXRlKGRhdGV0aW1lLmRhdGV0aW1lLmZyb21pc29mb3JtYXQoc2VsZi5kYXRlKCkpKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICduYW1lJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYubmFtZShvYmpbJ25hbWUnXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAncmVtYXJrJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYucmVtYXJrKG9ialsncmVtYXJrJ10pOwogICAgICAgIAogICAgICAgICAgICBzZWxmLnJlbWFyayggdWJpbmFzY2lpLmEyYl9iYXNlNjQoc2VsZi5yZW1hcmsoKSkgKTsKICAgICAgICAgICAgaWYgc2VsZi5yZW1hcmsoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBzZWxmLnJlbWFyayhzZWxmLnJlbWFyaygpLmRlY29kZSgndXRmLTgnKS5zdHJpcCgpKTsKICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICBzZWxmLnJlbWFyaygpOwogICAgICAgICAgICAgICAgICAgICNwcmludChfX3RvU3RyaW5nICsgInJlbWFyayBleGNlcHRpb24iLCBzZWxmLnJlbWFyaygpKTsKICAgICAgICAKICAgIAoKICAgIAoKICAgICAgICBnYy5jb2xsZWN0KCk7CiAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAKICAgIGRlZiBfdG9Eb2N1bWVudChzZWxmLCBiSlNPTj1Ob25lKToKICAgICAgICBfX3RvU3RyaW5nID0gJ01hcHBpbmdfR3JvdXA6Ol90b0RvY3VtZW50KCk6ICc7CgogICAgICAgIHJldCA9IHt9OwogICAgICAgIGlmIHNlbGYuSWQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiSWQiXSA9IHNlbGYuSWQ7CgogICAgCiAgICAgICAgaWYgc2VsZi5hY3RpdmUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJhY3RpdmUiXSA9IHNlbGYuYWN0aXZlKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLmVuYWJsZWQoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJlbmFibGVkIl0gPSBzZWxmLmVuYWJsZWQoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYuY29kZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbImNvZGUiXSA9IHNlbGYuY29kZSgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5vcmRlcigpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbIm9yZGVyIl0gPSBzZWxmLm9yZGVyKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLmRhdGUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJkYXRlIl0gPSBzZWxmLmRhdGUoKTsKICAgICAgICAKICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShyZXRbImRhdGUiXSwgZGF0ZXRpbWUuZGF0ZXRpbWUpOgogICAgICAgICAgICAgICAgcmV0WyJkYXRlIl0gPSByZXRbImRhdGUiXS5pc29mb3JtYXQoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYubmFtZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbIm5hbWUiXSA9IHNlbGYubmFtZSgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5yZW1hcmsoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IHNlbGYucmVtYXJrKCk7CiAgICAgICAgCiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UocmV0WyJyZW1hcmsiXSwgZGljdCk6CiAgICAgICAgICAgICAgICByZXRbInJlbWFyayJdID0gdWpzb24uZHVtcHMocmV0WyJyZW1hcmsiXSkuZW5jb2RlKCd1dGYtOCcpOwoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9ICB1YmluYXNjaWkuYjJhX2Jhc2U2NChyZXRbInJlbWFyayJdKS5kZWNvZGUoJ3V0Zi04Jykuc3RyaXAoKTsKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGNlcHRpb24gd2l0aCByZW1hcms6ICIgKyByZXRbInJlbWFyayJdKTsKICAgICAgICAKICAgIAogICAgICAgIAogICAgCgogICAgICAgIGlmIGJKU09OIGlzIG5vdCBOb25lOgogICAgICAgICAgICAjcHJpbnQoX190b1N0cmluZyArICJHT1QgSEVSRSIsIHR5cGUocmV0KSwgcmV0KTsKICAgICAgICAgICAgcmV0ID0gdWpzb24uZHVtcHMocmV0KTsKICAgICAgICBnYy5jb2xsZWN0KCk7CiAgICAgICAgcmV0dXJuIHJldDsKCiAgICAKICAgIGRlZiBzdG9yZShzZWxmLCBfX2V2ZW50PU5vbmUpOgogICAgICAgIF9fdG9TdHJpbmcgPSAnTWFwcGluZ19Hcm91cDo6c3RvcmUoKTogJzsKICAgICAgICAKICAgICAgICBldkpTT04gPSBOb25lOwoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBldkpTT04gPSB1anNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7CiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoKICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsKICAgICAgICAKCiAgICAgICAgYW5zd2VyID0gTm9uZTsKCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpY2tzX21zKCkpKyddLk1hcHBpbmdfR3JvdXAuc3RvcmUoKScpLm1ldGhvZCgnc3RvcmUnKS5jbGFzc05hbWUoJ01hcHBpbmdfR3JvdXAnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7CiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTsKICAgICAgICAKICAgICAgICBnYy5jb2xsZWN0KCk7CgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsKCiAgICAgICAgCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7CiAgICAgICAgCiAgICAgICAgICAgIGFuc3dlciA9IE1hcHBpbmdfR3JvdXAoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7CiAgICAgICAgCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsKCgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsKCiAgICAgICAgICAgIAogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsKICAgICAgICAgICAgCgogICAgICAgIHJldHVybiBhbnN3ZXI7CgogICAgCiAgICBkZWYgZmluZEFsbChzZWxmLCBfX2V2ZW50PU5vbmUpOgogICAgICAgIF9fdG9TdHJpbmcgPSAnTWFwcGluZ19Hcm91cDo6ZmluZEFsbCgpOiAnOwogICAgICAgIAogICAgICAgIGV2SlNPTiA9IE5vbmU7CgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIGV2SlNPTiA9IHVqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsKICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOgogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOwogICAgICAgIAoKICAgICAgICBhbnN3ZXIgPSBOb25lOwoKICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGlja3NfbXMoKSkrJ10uTWFwcGluZ19Hcm91cC5maW5kQWxsKCknKS5tZXRob2QoJ2ZpbmRBbGwnKS5jbGFzc05hbWUoJ01hcHBpbmdfR3JvdXAnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7CiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTsKICAgICAgICAKICAgICAgICBnYy5jb2xsZWN0KCk7CgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsKCiAgICAgICAgCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7CiAgICAgICAgCiAgICAgICAgICAgIGFuc3dlciA9IE1hcHBpbmdfR3JvdXAoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7CiAgICAgICAgCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsKCgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsKCiAgICAgICAgICAgIAogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsKICAgICAgICAgICAgCgogICAgICAgIHJldHVybiBhbnN3ZXI7CgogICAgCiAgICBkZWYgZmluZChzZWxmLCBfX2V2ZW50PU5vbmUpOgogICAgICAgIF9fdG9TdHJpbmcgPSAnTWFwcGluZ19Hcm91cDo6ZmluZCgpOiAnOwogICAgICAgIAogICAgICAgIGV2SlNPTiA9IE5vbmU7CgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIGV2SlNPTiA9IHVqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsKICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOgogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOwogICAgICAgIAoKICAgICAgICBhbnN3ZXIgPSBOb25lOwoKICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGlja3NfbXMoKSkrJ10uTWFwcGluZ19Hcm91cC5maW5kKCknKS5tZXRob2QoJ2ZpbmQnKS5jbGFzc05hbWUoJ01hcHBpbmdfR3JvdXAnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7CiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTsKICAgICAgICAKICAgICAgICBnYy5jb2xsZWN0KCk7CgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsKCiAgICAgICAgCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7CiAgICAgICAgCiAgICAgICAgICAgIGFuc3dlciA9IE1hcHBpbmdfR3JvdXAoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7CiAgICAgICAgCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsKCgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsKCiAgICAgICAgICAgIAogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsKICAgICAgICAgICAgCgogICAgICAgIHJldHVybiBhbnN3ZXI7CgogICAgCgoKY2xhc3MgVG9vbF9UeXBlKCk6CiAgICBkZWYgX19pbml0X18oc2VsZiwgSWQ9Tm9uZSwgYWN0aXZlPU5vbmUsIGVuYWJsZWQ9Tm9uZSwgY29kZT1Ob25lLCBvcmRlcj1Ob25lLCBkYXRlPU5vbmUsIG5hbWU9Tm9uZSwgcmVtYXJrPU5vbmUpOgogICAgICAgIHN1cGVyKCkuX19pbml0X18oKTsKCiAgICAgICAgI3ByaW50KCdUb29sX1R5cGU6Ol9faW5pdF9fKCknKTsKICAgICAgICBpZiBJZCBpcyBub3QgTm9uZToKICAgICAgICAgICAgc2VsZi5JZCA9IElkOwoKICAgICAgICAKICAgICAgICBzZWxmLmFjdGl2ZShhY3RpdmUpOwogICAgICAgIHNlbGYuZW5hYmxlZChlbmFibGVkKTsKICAgICAgICBzZWxmLmNvZGUoY29kZSk7CiAgICAgICAgc2VsZi5vcmRlcihvcmRlcik7CiAgICAgICAgc2VsZi5kYXRlKGRhdGUpOwogICAgICAgIHNlbGYubmFtZShuYW1lKTsKICAgICAgICBzZWxmLnJlbWFyayhyZW1hcmspOwogICAgICAgIAogICAgSWQgPSBOb25lOwogICAgCiAgICAKICAgICMgYWN0aXZlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfYWN0aXZlID0gTm9uZTsKICAgIGRlZiBhY3RpdmUoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2FjdGl2ZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9hY3RpdmU7CiAgICAKICAgICMgZW5hYmxlZDogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX2VuYWJsZWQgPSBOb25lOwogICAgZGVmIGVuYWJsZWQoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2VuYWJsZWQgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fZW5hYmxlZDsKICAgIAogICAgIyBjb2RlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfY29kZSA9IE5vbmU7CiAgICBkZWYgY29kZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fY29kZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9jb2RlOwogICAgCiAgICAjIG9yZGVyOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfb3JkZXIgPSBOb25lOwogICAgZGVmIG9yZGVyKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9vcmRlciA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9vcmRlcjsKICAgIAogICAgIyBkYXRlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfZGF0ZSA9IE5vbmU7CiAgICBkZWYgZGF0ZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fZGF0ZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9kYXRlOwogICAgCiAgICAjIG5hbWU6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9uYW1lID0gTm9uZTsKICAgIGRlZiBuYW1lKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9uYW1lID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX25hbWU7CiAgICAKICAgICMgcmVtYXJrOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfcmVtYXJrID0gTm9uZTsKICAgIGRlZiByZW1hcmsoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX3JlbWFyayA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9yZW1hcms7CiAgICAKICAgIAogICAgCiAgICAjIHR5cGVfQ29uZmlnczogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX3R5cGVfQ29uZmlncyA9IE5vbmU7CiAgICBkZWYgdHlwZV9Db25maWdzKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl90eXBlX0NvbmZpZ3MgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fdHlwZV9Db25maWdzOwogICAgCiAgICAjIHR5cGVfVG9vbHM6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF90eXBlX1Rvb2xzID0gTm9uZTsKICAgIGRlZiB0eXBlX1Rvb2xzKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl90eXBlX1Rvb2xzID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3R5cGVfVG9vbHM7CiAgICAKICAgICMgdHlwZV9NYXBwaW5nczogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX3R5cGVfTWFwcGluZ3MgPSBOb25lOwogICAgZGVmIHR5cGVfTWFwcGluZ3Moc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX3R5cGVfTWFwcGluZ3MgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fdHlwZV9NYXBwaW5nczsKICAgIAogICAgCiAgICBkZWYgX3VuaXF1ZShzZWxmKToKICAgICAgICBfX3RvU3RyaW5nID0gJ1Rvb2xfVHlwZTo6X3VuaXF1ZSgpOiAnOwogICAgICAgIAogICAgICAgIHJldCA9IFRvb2xfVHlwZSgpOwogICAgICAgIGlmIHNlbGYuSWQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldC5JZCA9IHNlbGYuSWQ7CiAgICAKICAgICAgICBpZiBzZWxmLm5hbWUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0Lm5hbWUoc2VsZi5uYW1lKCkpOwogICAgCiAgICAgICAgZ2MuY29sbGVjdCgpOwogICAgICAgIHJldHVybiByZXQ7CiAgICAKICAgIGRlZiBfZnJvbURvY3VtZW50KHNlbGYsIG9iaik6CiAgICAgICAgX190b1N0cmluZyA9ICdUb29sX1R5cGU6Ol9mcm9tRG9jdW1lbnQoKTogJzsKICAgICAgICAKICAgICAgICBpZiBvYmogaXMgTm9uZToKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CgogICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLCBieXRlcyk6CiAgICAgICAgICAgIG9iaiA9IHN0cihvYmosICJ1dGYtOCIpOwoKICAgICAgICBpZiBpc2luc3RhbmNlKG9iaiwgc3RyKSBvciB0eXBlKG9iaikgaXMgc3RyOgogICAgICAgICAgICBpZiByZS5tYXRjaChyIigoKFtBLVphLXpdezMsOX06KD86XC9cLyk/KSg/OlstOzomPVwrXCQsXHddK0ApP1tBLVphLXowLTkuLV0rfCg/Ond3dy58Wy07OiY9XCtcJCxcd10rQClbQS1aYS16MC05Li1dKykoKD86XC9bXCt+JVwvLlx3XC1fXSopP1w/Pyg/OlstXCs9JjslQC5cd19dKikjPyg/Oltcd10qKSk/KSIsIG9iaik6CiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgb2JqID0gdWpzb24ubG9hZHModXJsbGliMy5Qb29sTWFuYWdlcigpLnJlcXVlc3QoJ0dFVCcsIG9iaikuZGF0YS5kZWNvZGUoJ3V0Zi04JykpOwogICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgIG9iaiA9IHt9OwogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgb2JqID0gdWpzb24ubG9hZHMob2JqKTsKICAgICAgICAKICAgICAgICBpZiBpc2luc3RhbmNlKG9iaiwgbGlzdCk6CiAgICAgICAgICAgIHJldHVybiBbVG9vbF9UeXBlKCkuX2Zyb21Eb2N1bWVudChvKSBmb3IgbyBpbiBvYmpdOwogICAgICAgICAgICAKICAgICAgICBpZiBub3QgaXNpbnN0YW5jZShvYmosIChzdHIsIGJ5dGVzLCBkaWN0KSk6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAndW5oYW5kbGVkIHR5cGU6ICcgKyBzdHIodHlwZShvYmopKSk7CiAgICAgICAgICAgIHJldHVybiBvYmo7CgogICAgICAgIGlmICdJZCcgaW4gb2JqOgogICAgICAgICAgICBzZWxmLklkID0gb2JqWydJZCddOwoKICAgIAogICAgICAgIGlmICdhY3RpdmUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5hY3RpdmUob2JqWydhY3RpdmUnXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnZW5hYmxlZCcgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmVuYWJsZWQob2JqWydlbmFibGVkJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ2NvZGUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5jb2RlKG9ialsnY29kZSddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdvcmRlcicgaW4gb2JqOgogICAgICAgICAgICBzZWxmLm9yZGVyKG9ialsnb3JkZXInXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnZGF0ZScgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmRhdGUob2JqWydkYXRlJ10pOwogICAgICAgIAogICAgICAgICAgICBzZWxmLmRhdGUoZGF0ZXRpbWUuZGF0ZXRpbWUuZnJvbWlzb2Zvcm1hdChzZWxmLmRhdGUoKSkpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ25hbWUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5uYW1lKG9ialsnbmFtZSddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdyZW1hcmsnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5yZW1hcmsob2JqWydyZW1hcmsnXSk7CiAgICAgICAgCiAgICAgICAgICAgIHNlbGYucmVtYXJrKCB1YmluYXNjaWkuYTJiX2Jhc2U2NChzZWxmLnJlbWFyaygpKSApOwogICAgICAgICAgICBpZiBzZWxmLnJlbWFyaygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIHNlbGYucmVtYXJrKHNlbGYucmVtYXJrKCkuZGVjb2RlKCd1dGYtOCcpLnN0cmlwKCkpOwogICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgIHNlbGYucmVtYXJrKCk7CiAgICAgICAgICAgICAgICAgICAgI3ByaW50KF9fdG9TdHJpbmcgKyAicmVtYXJrIGV4Y2VwdGlvbiIsIHNlbGYucmVtYXJrKCkpOwogICAgICAgIAogICAgCgogICAgCiAgICAgICAgaWYgJ3R5cGVfQ29uZmlncycgaW4gb2JqOgogICAgICAgICAgICBzZWxmLnR5cGVfQ29uZmlncyhDb25maWcoKS5fZnJvbURvY3VtZW50KG9ialsndHlwZV9Db25maWdzJ10pKTsKICAgIAogICAgICAgIGlmICd0eXBlX1Rvb2xzJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYudHlwZV9Ub29scyhUb29sKCkuX2Zyb21Eb2N1bWVudChvYmpbJ3R5cGVfVG9vbHMnXSkpOwogICAgCiAgICAgICAgaWYgJ3R5cGVfTWFwcGluZ3MnIGluIG9iajoKICAgICAgICAgICAgc2VsZi50eXBlX01hcHBpbmdzKE1hcHBpbmcoKS5fZnJvbURvY3VtZW50KG9ialsndHlwZV9NYXBwaW5ncyddKSk7CiAgICAKCiAgICAgICAgZ2MuY29sbGVjdCgpOwogICAgICAgIHJldHVybiBzZWxmOwogICAgCiAgICBkZWYgX3RvRG9jdW1lbnQoc2VsZiwgYkpTT049Tm9uZSk6CiAgICAgICAgX190b1N0cmluZyA9ICdUb29sX1R5cGU6Ol90b0RvY3VtZW50KCk6ICc7CgogICAgICAgIHJldCA9IHt9OwogICAgICAgIGlmIHNlbGYuSWQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiSWQiXSA9IHNlbGYuSWQ7CgogICAgCiAgICAgICAgaWYgc2VsZi5hY3RpdmUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJhY3RpdmUiXSA9IHNlbGYuYWN0aXZlKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLmVuYWJsZWQoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJlbmFibGVkIl0gPSBzZWxmLmVuYWJsZWQoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYuY29kZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbImNvZGUiXSA9IHNlbGYuY29kZSgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5vcmRlcigpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbIm9yZGVyIl0gPSBzZWxmLm9yZGVyKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLmRhdGUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJkYXRlIl0gPSBzZWxmLmRhdGUoKTsKICAgICAgICAKICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShyZXRbImRhdGUiXSwgZGF0ZXRpbWUuZGF0ZXRpbWUpOgogICAgICAgICAgICAgICAgcmV0WyJkYXRlIl0gPSByZXRbImRhdGUiXS5pc29mb3JtYXQoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYubmFtZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbIm5hbWUiXSA9IHNlbGYubmFtZSgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5yZW1hcmsoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IHNlbGYucmVtYXJrKCk7CiAgICAgICAgCiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UocmV0WyJyZW1hcmsiXSwgZGljdCk6CiAgICAgICAgICAgICAgICByZXRbInJlbWFyayJdID0gdWpzb24uZHVtcHMocmV0WyJyZW1hcmsiXSkuZW5jb2RlKCd1dGYtOCcpOwoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9ICB1YmluYXNjaWkuYjJhX2Jhc2U2NChyZXRbInJlbWFyayJdKS5kZWNvZGUoJ3V0Zi04Jykuc3RyaXAoKTsKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGNlcHRpb24gd2l0aCByZW1hcms6ICIgKyByZXRbInJlbWFyayJdKTsKICAgICAgICAKICAgIAogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi50eXBlX0NvbmZpZ3MoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJ0eXBlX0NvbmZpZ3MiXSA9IFt0YS5fdG9Eb2N1bWVudCgpIGZvciB0YSBpbiBzZWxmLnR5cGVfQ29uZmlncygpXTsKICAgIAogICAgICAgIGlmIHNlbGYudHlwZV9Ub29scygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbInR5cGVfVG9vbHMiXSA9IFt0YS5fdG9Eb2N1bWVudCgpIGZvciB0YSBpbiBzZWxmLnR5cGVfVG9vbHMoKV07CiAgICAKICAgICAgICBpZiBzZWxmLnR5cGVfTWFwcGluZ3MoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJ0eXBlX01hcHBpbmdzIl0gPSBbdGEuX3RvRG9jdW1lbnQoKSBmb3IgdGEgaW4gc2VsZi50eXBlX01hcHBpbmdzKCldOwogICAgCgogICAgICAgIGlmIGJKU09OIGlzIG5vdCBOb25lOgogICAgICAgICAgICAjcHJpbnQoX190b1N0cmluZyArICJHT1QgSEVSRSIsIHR5cGUocmV0KSwgcmV0KTsKICAgICAgICAgICAgcmV0ID0gdWpzb24uZHVtcHMocmV0KTsKICAgICAgICBnYy5jb2xsZWN0KCk7CiAgICAgICAgcmV0dXJuIHJldDsKCiAgICAKICAgIGRlZiBzdG9yZShzZWxmLCBfX2V2ZW50PU5vbmUpOgogICAgICAgIF9fdG9TdHJpbmcgPSAnVG9vbF9UeXBlOjpzdG9yZSgpOiAnOwogICAgICAgIAogICAgICAgIGV2SlNPTiA9IE5vbmU7CgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIGV2SlNPTiA9IHVqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsKICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOgogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOwogICAgICAgIAoKICAgICAgICBhbnN3ZXIgPSBOb25lOwoKICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGlja3NfbXMoKSkrJ10uVG9vbF9UeXBlLnN0b3JlKCknKS5tZXRob2QoJ3N0b3JlJykuY2xhc3NOYW1lKCdUb29sX1R5cGUnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7CiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTsKICAgICAgICAKICAgICAgICBnYy5jb2xsZWN0KCk7CgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsKCiAgICAgICAgCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7CiAgICAgICAgCiAgICAgICAgICAgIGFuc3dlciA9IFRvb2xfVHlwZSgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsKICAgICAgICAKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOwoKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOwogICAgICAgICAgICAKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOwoKICAgICAgICAgICAgCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOwogICAgICAgICAgICAKCiAgICAgICAgcmV0dXJuIGFuc3dlcjsKCiAgICAKICAgIGRlZiBmaW5kQWxsKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6CiAgICAgICAgX190b1N0cmluZyA9ICdUb29sX1R5cGU6OmZpbmRBbGwoKTogJzsKICAgICAgICAKICAgICAgICBldkpTT04gPSBOb25lOwoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBldkpTT04gPSB1anNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7CiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoKICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsKICAgICAgICAKCiAgICAgICAgYW5zd2VyID0gTm9uZTsKCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpY2tzX21zKCkpKyddLlRvb2xfVHlwZS5maW5kQWxsKCknKS5tZXRob2QoJ2ZpbmRBbGwnKS5jbGFzc05hbWUoJ1Rvb2xfVHlwZScpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpOwogICAgICAgIAogICAgICAgIGdjLmNvbGxlY3QoKTsKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOwoKICAgICAgICAKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsKICAgICAgICAKICAgICAgICAgICAgYW5zd2VyID0gVG9vbF9UeXBlKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOwogICAgICAgIAoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7CgoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOgogICAgICAgICAgICAKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7CgogICAgICAgICAgICAKICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7CiAgICAgICAgICAgIAoKICAgICAgICByZXR1cm4gYW5zd2VyOwoKICAgIAogICAgZGVmIGZpbmQoc2VsZiwgX19ldmVudD1Ob25lKToKICAgICAgICBfX3RvU3RyaW5nID0gJ1Rvb2xfVHlwZTo6ZmluZCgpOiAnOwogICAgICAgIAogICAgICAgIGV2SlNPTiA9IE5vbmU7CgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIGV2SlNPTiA9IHVqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsKICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOgogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOwogICAgICAgIAoKICAgICAgICBhbnN3ZXIgPSBOb25lOwoKICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGlja3NfbXMoKSkrJ10uVG9vbF9UeXBlLmZpbmQoKScpLm1ldGhvZCgnZmluZCcpLmNsYXNzTmFtZSgnVG9vbF9UeXBlJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOwogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7CiAgICAgICAgCiAgICAgICAgZ2MuY29sbGVjdCgpOwoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7CgogICAgICAgIAogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOwogICAgICAgIAogICAgICAgICAgICBhbnN3ZXIgPSBUb29sX1R5cGUoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7CiAgICAgICAgCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsKCgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsKCiAgICAgICAgICAgIAogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsKICAgICAgICAgICAgCgogICAgICAgIHJldHVybiBhbnN3ZXI7CgogICAgCgoKY2xhc3MgRXZlbnQoKToKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBJZD1Ob25lLCBhY3RpdmU9Tm9uZSwgZW5hYmxlZD1Ob25lLCBjb2RlPU5vbmUsIG9yZGVyPU5vbmUsIGRhdGU9Tm9uZSwgbmFtZT1Ob25lLCByZW1hcms9Tm9uZSwgY2xhc3NOYW1lPU5vbmUsIG1ldGhvZD1Ob25lLCBwYXlsb2FkPU5vbmUsIGNhcnJpZXI9Tm9uZSwgc2VuZGVyPU5vbmUsIHJlY2lwaWVudD1Ob25lLCByZXNwb25zZVRvPU5vbmUpOgogICAgICAgIHN1cGVyKCkuX19pbml0X18oKTsKCiAgICAgICAgI3ByaW50KCdFdmVudDo6X19pbml0X18oKScpOwogICAgICAgIGlmIElkIGlzIG5vdCBOb25lOgogICAgICAgICAgICBzZWxmLklkID0gSWQ7CgogICAgICAgIAogICAgICAgIHNlbGYuYWN0aXZlKGFjdGl2ZSk7CiAgICAgICAgc2VsZi5lbmFibGVkKGVuYWJsZWQpOwogICAgICAgIHNlbGYuY29kZShjb2RlKTsKICAgICAgICBzZWxmLm9yZGVyKG9yZGVyKTsKICAgICAgICBzZWxmLmRhdGUoZGF0ZSk7CiAgICAgICAgc2VsZi5uYW1lKG5hbWUpOwogICAgICAgIHNlbGYucmVtYXJrKHJlbWFyayk7CiAgICAgICAgc2VsZi5jbGFzc05hbWUoY2xhc3NOYW1lKTsKICAgICAgICBzZWxmLm1ldGhvZChtZXRob2QpOwogICAgICAgIHNlbGYucGF5bG9hZChwYXlsb2FkKTsKICAgICAgICBzZWxmLmNhcnJpZXIoY2Fycmllcik7CiAgICAgICAgc2VsZi5zZW5kZXIoc2VuZGVyKTsKICAgICAgICBzZWxmLnJlY2lwaWVudChyZWNpcGllbnQpOwogICAgICAgIHNlbGYucmVzcG9uc2VUbyhyZXNwb25zZVRvKTsKICAgICAgICAKICAgIElkID0gTm9uZTsKICAgIAogICAgCiAgICAjIGFjdGl2ZTogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX2FjdGl2ZSA9IE5vbmU7CiAgICBkZWYgYWN0aXZlKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9hY3RpdmUgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fYWN0aXZlOwogICAgCiAgICAjIGVuYWJsZWQ6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9lbmFibGVkID0gTm9uZTsKICAgIGRlZiBlbmFibGVkKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9lbmFibGVkID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2VuYWJsZWQ7CiAgICAKICAgICMgY29kZTogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX2NvZGUgPSBOb25lOwogICAgZGVmIGNvZGUoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2NvZGUgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fY29kZTsKICAgIAogICAgIyBvcmRlcjogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX29yZGVyID0gTm9uZTsKICAgIGRlZiBvcmRlcihzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fb3JkZXIgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fb3JkZXI7CiAgICAKICAgICMgZGF0ZTogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX2RhdGUgPSBOb25lOwogICAgZGVmIGRhdGUoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2RhdGUgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fZGF0ZTsKICAgIAogICAgIyBuYW1lOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfbmFtZSA9IE5vbmU7CiAgICBkZWYgbmFtZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fbmFtZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9uYW1lOwogICAgCiAgICAjIHJlbWFyazogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX3JlbWFyayA9IE5vbmU7CiAgICBkZWYgcmVtYXJrKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9yZW1hcmsgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fcmVtYXJrOwogICAgCiAgICAjIGNsYXNzTmFtZTogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX2NsYXNzTmFtZSA9IE5vbmU7CiAgICBkZWYgY2xhc3NOYW1lKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9jbGFzc05hbWUgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fY2xhc3NOYW1lOwogICAgCiAgICAjIG1ldGhvZDogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX21ldGhvZCA9IE5vbmU7CiAgICBkZWYgbWV0aG9kKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9tZXRob2QgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fbWV0aG9kOwogICAgCiAgICAjIHBheWxvYWQ6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9wYXlsb2FkID0gTm9uZTsKICAgIGRlZiBwYXlsb2FkKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9wYXlsb2FkID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3BheWxvYWQ7CiAgICAKICAgICMgY2FycmllcjogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX2NhcnJpZXIgPSBOb25lOwogICAgZGVmIGNhcnJpZXIoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2NhcnJpZXIgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fY2FycmllcjsKICAgIAogICAgIyBzZW5kZXI6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9zZW5kZXIgPSBOb25lOwogICAgZGVmIHNlbmRlcihzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fc2VuZGVyID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3NlbmRlcjsKICAgIAogICAgIyByZWNpcGllbnQ6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9yZWNpcGllbnQgPSBOb25lOwogICAgZGVmIHJlY2lwaWVudChzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fcmVjaXBpZW50ID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3JlY2lwaWVudDsKICAgIAogICAgIyByZXNwb25zZVRvOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfcmVzcG9uc2VUbyA9IE5vbmU7CiAgICBkZWYgcmVzcG9uc2VUbyhzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fcmVzcG9uc2VUbyA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9yZXNwb25zZVRvOwogICAgCiAgICAKICAgIAogICAgIyByZXNwb25zZVRvX0V2ZW50czogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX3Jlc3BvbnNlVG9fRXZlbnRzID0gTm9uZTsKICAgIGRlZiByZXNwb25zZVRvX0V2ZW50cyhzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fcmVzcG9uc2VUb19FdmVudHMgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fcmVzcG9uc2VUb19FdmVudHM7CiAgICAKICAgIAogICAgZGVmIF91bmlxdWUoc2VsZik6CiAgICAgICAgX190b1N0cmluZyA9ICdFdmVudDo6X3VuaXF1ZSgpOiAnOwogICAgICAgIAogICAgICAgIHJldCA9IEV2ZW50KCk7CiAgICAgICAgaWYgc2VsZi5JZCBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0LklkID0gc2VsZi5JZDsKICAgIAogICAgICAgIGlmIHNlbGYuY29kZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXQuY29kZShzZWxmLmNvZGUoKSk7CiAgICAKICAgICAgICBnYy5jb2xsZWN0KCk7CiAgICAgICAgcmV0dXJuIHJldDsKICAgIAogICAgZGVmIF9mcm9tRG9jdW1lbnQoc2VsZiwgb2JqKToKICAgICAgICBfX3RvU3RyaW5nID0gJ0V2ZW50OjpfZnJvbURvY3VtZW50KCk6ICc7CiAgICAgICAgCiAgICAgICAgaWYgb2JqIGlzIE5vbmU6CiAgICAgICAgICAgIHJldHVybiBzZWxmOwoKICAgICAgICBpZiBpc2luc3RhbmNlKG9iaiwgYnl0ZXMpOgogICAgICAgICAgICBvYmogPSBzdHIob2JqLCAidXRmLTgiKTsKCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIHN0cikgb3IgdHlwZShvYmopIGlzIHN0cjoKICAgICAgICAgICAgaWYgcmUubWF0Y2gociIoKChbQS1aYS16XXszLDl9Oig/OlwvXC8pPykoPzpbLTs6Jj1cK1wkLFx3XStAKT9bQS1aYS16MC05Li1dK3woPzp3d3cufFstOzomPVwrXCQsXHddK0ApW0EtWmEtejAtOS4tXSspKCg/OlwvW1wrfiVcLy5cd1wtX10qKT9cPz8oPzpbLVwrPSY7JUAuXHdfXSopIz8oPzpbXHddKikpPykiLCBvYmopOgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIG9iaiA9IHVqc29uLmxvYWRzKHVybGxpYjMuUG9vbE1hbmFnZXIoKS5yZXF1ZXN0KCdHRVQnLCBvYmopLmRhdGEuZGVjb2RlKCd1dGYtOCcpKTsKICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICBvYmogPSB7fTsKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIG9iaiA9IHVqc29uLmxvYWRzKG9iaik7CiAgICAgICAgCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIGxpc3QpOgogICAgICAgICAgICByZXR1cm4gW0V2ZW50KCkuX2Zyb21Eb2N1bWVudChvKSBmb3IgbyBpbiBvYmpdOwogICAgICAgICAgICAKICAgICAgICBpZiBub3QgaXNpbnN0YW5jZShvYmosIChzdHIsIGJ5dGVzLCBkaWN0KSk6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAndW5oYW5kbGVkIHR5cGU6ICcgKyBzdHIodHlwZShvYmopKSk7CiAgICAgICAgICAgIHJldHVybiBvYmo7CgogICAgICAgIGlmICdJZCcgaW4gb2JqOgogICAgICAgICAgICBzZWxmLklkID0gb2JqWydJZCddOwoKICAgIAogICAgICAgIGlmICdhY3RpdmUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5hY3RpdmUob2JqWydhY3RpdmUnXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnZW5hYmxlZCcgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmVuYWJsZWQob2JqWydlbmFibGVkJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ2NvZGUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5jb2RlKG9ialsnY29kZSddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdvcmRlcicgaW4gb2JqOgogICAgICAgICAgICBzZWxmLm9yZGVyKG9ialsnb3JkZXInXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnZGF0ZScgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmRhdGUob2JqWydkYXRlJ10pOwogICAgICAgIAogICAgICAgICAgICBzZWxmLmRhdGUoZGF0ZXRpbWUuZGF0ZXRpbWUuZnJvbWlzb2Zvcm1hdChzZWxmLmRhdGUoKSkpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ25hbWUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5uYW1lKG9ialsnbmFtZSddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdyZW1hcmsnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5yZW1hcmsob2JqWydyZW1hcmsnXSk7CiAgICAgICAgCiAgICAgICAgICAgIHNlbGYucmVtYXJrKCB1YmluYXNjaWkuYTJiX2Jhc2U2NChzZWxmLnJlbWFyaygpKSApOwogICAgICAgICAgICBpZiBzZWxmLnJlbWFyaygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIHNlbGYucmVtYXJrKHNlbGYucmVtYXJrKCkuZGVjb2RlKCd1dGYtOCcpLnN0cmlwKCkpOwogICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgIHNlbGYucmVtYXJrKCk7CiAgICAgICAgICAgICAgICAgICAgI3ByaW50KF9fdG9TdHJpbmcgKyAicmVtYXJrIGV4Y2VwdGlvbiIsIHNlbGYucmVtYXJrKCkpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ2NsYXNzTmFtZScgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmNsYXNzTmFtZShvYmpbJ2NsYXNzTmFtZSddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdtZXRob2QnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5tZXRob2Qob2JqWydtZXRob2QnXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAncGF5bG9hZCcgaW4gb2JqOgogICAgICAgICAgICBzZWxmLnBheWxvYWQob2JqWydwYXlsb2FkJ10pOwogICAgICAgIAogICAgICAgICAgICBzZWxmLnBheWxvYWQoIHViaW5hc2NpaS5hMmJfYmFzZTY0KHNlbGYucGF5bG9hZCgpKSApOwogICAgICAgICAgICBpZiBzZWxmLnBheWxvYWQoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBzZWxmLnBheWxvYWQoc2VsZi5wYXlsb2FkKCkuZGVjb2RlKCd1dGYtOCcpLnN0cmlwKCkpOwogICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgIHNlbGYucGF5bG9hZCgpOwogICAgICAgICAgICAgICAgICAgICNwcmludChfX3RvU3RyaW5nICsgInBheWxvYWQgZXhjZXB0aW9uIiwgc2VsZi5wYXlsb2FkKCkpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ2NhcnJpZXInIGluIG9iajoKICAgICAgICAgICAgc2VsZi5jYXJyaWVyKE5vZGUoKS5fZnJvbURvY3VtZW50KG9ialsnY2FycmllciddKSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnc2VuZGVyJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuc2VuZGVyKE5vZGUoKS5fZnJvbURvY3VtZW50KG9ialsnc2VuZGVyJ10pKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdyZWNpcGllbnQnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5yZWNpcGllbnQoTm9kZSgpLl9mcm9tRG9jdW1lbnQob2JqWydyZWNpcGllbnQnXSkpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ3Jlc3BvbnNlVG8nIGluIG9iajoKICAgICAgICAgICAgc2VsZi5yZXNwb25zZVRvKEV2ZW50KCkuX2Zyb21Eb2N1bWVudChvYmpbJ3Jlc3BvbnNlVG8nXSkpOwogICAgICAgIAogICAgCgogICAgCiAgICAgICAgaWYgJ3Jlc3BvbnNlVG9fRXZlbnRzJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYucmVzcG9uc2VUb19FdmVudHMoRXZlbnQoKS5fZnJvbURvY3VtZW50KG9ialsncmVzcG9uc2VUb19FdmVudHMnXSkpOwogICAgCgogICAgICAgIGdjLmNvbGxlY3QoKTsKICAgICAgICByZXR1cm4gc2VsZjsKICAgIAogICAgZGVmIF90b0RvY3VtZW50KHNlbGYsIGJKU09OPU5vbmUpOgogICAgICAgIF9fdG9TdHJpbmcgPSAnRXZlbnQ6Ol90b0RvY3VtZW50KCk6ICc7CgogICAgICAgIHJldCA9IHt9OwogICAgICAgIGlmIHNlbGYuSWQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiSWQiXSA9IHNlbGYuSWQ7CgogICAgCiAgICAgICAgaWYgc2VsZi5hY3RpdmUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJhY3RpdmUiXSA9IHNlbGYuYWN0aXZlKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLmVuYWJsZWQoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJlbmFibGVkIl0gPSBzZWxmLmVuYWJsZWQoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYuY29kZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbImNvZGUiXSA9IHNlbGYuY29kZSgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5vcmRlcigpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbIm9yZGVyIl0gPSBzZWxmLm9yZGVyKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLmRhdGUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJkYXRlIl0gPSBzZWxmLmRhdGUoKTsKICAgICAgICAKICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShyZXRbImRhdGUiXSwgZGF0ZXRpbWUuZGF0ZXRpbWUpOgogICAgICAgICAgICAgICAgcmV0WyJkYXRlIl0gPSByZXRbImRhdGUiXS5pc29mb3JtYXQoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYubmFtZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbIm5hbWUiXSA9IHNlbGYubmFtZSgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5yZW1hcmsoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IHNlbGYucmVtYXJrKCk7CiAgICAgICAgCiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UocmV0WyJyZW1hcmsiXSwgZGljdCk6CiAgICAgICAgICAgICAgICByZXRbInJlbWFyayJdID0gdWpzb24uZHVtcHMocmV0WyJyZW1hcmsiXSkuZW5jb2RlKCd1dGYtOCcpOwoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9ICB1YmluYXNjaWkuYjJhX2Jhc2U2NChyZXRbInJlbWFyayJdKS5kZWNvZGUoJ3V0Zi04Jykuc3RyaXAoKTsKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGNlcHRpb24gd2l0aCByZW1hcms6ICIgKyByZXRbInJlbWFyayJdKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYuY2xhc3NOYW1lKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiY2xhc3NOYW1lIl0gPSBzZWxmLmNsYXNzTmFtZSgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5tZXRob2QoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJtZXRob2QiXSA9IHNlbGYubWV0aG9kKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLnBheWxvYWQoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJwYXlsb2FkIl0gPSBzZWxmLnBheWxvYWQoKTsKICAgICAgICAKICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShyZXRbInBheWxvYWQiXSwgZGljdCk6CiAgICAgICAgICAgICAgICByZXRbInBheWxvYWQiXSA9IHVqc29uLmR1bXBzKHJldFsicGF5bG9hZCJdKS5lbmNvZGUoJ3V0Zi04Jyk7CgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICByZXRbInBheWxvYWQiXSA9ICB1YmluYXNjaWkuYjJhX2Jhc2U2NChyZXRbInBheWxvYWQiXSkuZGVjb2RlKCd1dGYtOCcpLnN0cmlwKCk7CiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhjZXB0aW9uIHdpdGggcGF5bG9hZDogIiArIHJldFsicGF5bG9hZCJdKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYuY2FycmllcigpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbImNhcnJpZXIiXSA9IHNlbGYuY2FycmllcigpLl90b0RvY3VtZW50KCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLnNlbmRlcigpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbInNlbmRlciJdID0gc2VsZi5zZW5kZXIoKS5fdG9Eb2N1bWVudCgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5yZWNpcGllbnQoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJyZWNpcGllbnQiXSA9IHNlbGYucmVjaXBpZW50KCkuX3RvRG9jdW1lbnQoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbInJlc3BvbnNlVG8iXSA9IHNlbGYucmVzcG9uc2VUbygpLl90b0RvY3VtZW50KCk7CiAgICAgICAgCiAgICAKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYucmVzcG9uc2VUb19FdmVudHMoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJyZXNwb25zZVRvX0V2ZW50cyJdID0gW3RhLl90b0RvY3VtZW50KCkgZm9yIHRhIGluIHNlbGYucmVzcG9uc2VUb19FdmVudHMoKV07CiAgICAKCiAgICAgICAgaWYgYkpTT04gaXMgbm90IE5vbmU6CiAgICAgICAgICAgICNwcmludChfX3RvU3RyaW5nICsgIkdPVCBIRVJFIiwgdHlwZShyZXQpLCByZXQpOwogICAgICAgICAgICByZXQgPSB1anNvbi5kdW1wcyhyZXQpOwogICAgICAgIGdjLmNvbGxlY3QoKTsKICAgICAgICByZXR1cm4gcmV0OwoKICAgIAogICAgZGVmIHN0b3JlKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6CiAgICAgICAgX190b1N0cmluZyA9ICdFdmVudDo6c3RvcmUoKTogJzsKICAgICAgICAKICAgICAgICBldkpTT04gPSBOb25lOwoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBldkpTT04gPSB1anNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7CiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoKICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsKICAgICAgICAKCiAgICAgICAgYW5zd2VyID0gTm9uZTsKCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpY2tzX21zKCkpKyddLkV2ZW50LnN0b3JlKCknKS5tZXRob2QoJ3N0b3JlJykuY2xhc3NOYW1lKCdFdmVudCcpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpOwogICAgICAgIAogICAgICAgIGdjLmNvbGxlY3QoKTsKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOwoKICAgICAgICAKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsKICAgICAgICAKICAgICAgICAgICAgYW5zd2VyID0gRXZlbnQoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7CiAgICAgICAgCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsKCgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsKCiAgICAgICAgICAgIAogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsKICAgICAgICAgICAgCgogICAgICAgIHJldHVybiBhbnN3ZXI7CgogICAgCiAgICBkZWYgZmluZEFsbChzZWxmLCBfX2V2ZW50PU5vbmUpOgogICAgICAgIF9fdG9TdHJpbmcgPSAnRXZlbnQ6OmZpbmRBbGwoKTogJzsKICAgICAgICAKICAgICAgICBldkpTT04gPSBOb25lOwoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBldkpTT04gPSB1anNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7CiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoKICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsKICAgICAgICAKCiAgICAgICAgYW5zd2VyID0gTm9uZTsKCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpY2tzX21zKCkpKyddLkV2ZW50LmZpbmRBbGwoKScpLm1ldGhvZCgnZmluZEFsbCcpLmNsYXNzTmFtZSgnRXZlbnQnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7CiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTsKICAgICAgICAKICAgICAgICBnYy5jb2xsZWN0KCk7CgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsKCiAgICAgICAgCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7CiAgICAgICAgCiAgICAgICAgICAgIGFuc3dlciA9IEV2ZW50KCkuX2Zyb21Eb2N1bWVudChldkpTT04pOwogICAgICAgIAoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7CgoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOgogICAgICAgICAgICAKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7CgogICAgICAgICAgICAKICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7CiAgICAgICAgICAgIAoKICAgICAgICByZXR1cm4gYW5zd2VyOwoKICAgIAogICAgZGVmIGZpbmQoc2VsZiwgX19ldmVudD1Ob25lKToKICAgICAgICBfX3RvU3RyaW5nID0gJ0V2ZW50OjpmaW5kKCk6ICc7CiAgICAgICAgCiAgICAgICAgZXZKU09OID0gTm9uZTsKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgZXZKU09OID0gdWpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOwogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046CiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7CiAgICAgICAgCgogICAgICAgIGFuc3dlciA9IE5vbmU7CgogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aWNrc19tcygpKSsnXS5FdmVudC5maW5kKCknKS5tZXRob2QoJ2ZpbmQnKS5jbGFzc05hbWUoJ0V2ZW50JykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOwogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7CiAgICAgICAgCiAgICAgICAgZ2MuY29sbGVjdCgpOwoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7CgogICAgICAgIAogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOwogICAgICAgIAogICAgICAgICAgICBhbnN3ZXIgPSBFdmVudCgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsKICAgICAgICAKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOwoKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOwogICAgICAgICAgICAKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOwoKICAgICAgICAgICAgCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOwogICAgICAgICAgICAKCiAgICAgICAgcmV0dXJuIGFuc3dlcjsKCiAgICAKICAgIGRlZiBsaXN0ZW4oc2VsZiwgX19ldmVudD1Ob25lLCBub2RlPU5vbmUpOgogICAgICAgIF9fdG9TdHJpbmcgPSAnRXZlbnQ6Omxpc3RlbigpOiAnOwogICAgICAgIAogICAgICAgIGV2SlNPTiA9IE5vbmU7CgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIGV2SlNPTiA9IHVqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsKICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOgogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOwogICAgICAgIAogICAgICAgICAgICBpZiAnbm9kZScgaW4gZXZKU09OOgogICAgICAgICAgICAgICAgbm9kZSA9IGV2SlNPTlsnbm9kZSddOwogICAgICAgIAoKICAgICAgICBhbnN3ZXIgPSBOb25lOwoKICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGlja3NfbXMoKSkrJ10uRXZlbnQubGlzdGVuKCknKS5tZXRob2QoJ2xpc3RlbicpLmNsYXNzTmFtZSgnRXZlbnQnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7CiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTsKICAgICAgICAKICAgICAgICBnYy5jb2xsZWN0KCk7CgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsKCiAgICAgICAgCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7CiAgICAgICAgCiAgICAgICAgICAgIGFuc3dlciA9IGV2SlNPTjsKICAgICAgICAKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOwoKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoc3RyKGFuc3dlcikpOwogICAgICAgICAgICAKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOwoKICAgICAgICAgICAgCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOwogICAgICAgICAgICAKCiAgICAgICAgcmV0dXJuIGFuc3dlcjsKCiAgICAKICAgIGRlZiB0cmlnZ2VyKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6CiAgICAgICAgX190b1N0cmluZyA9ICdFdmVudDo6dHJpZ2dlcigpOiAnOwogICAgICAgIAogICAgICAgIGV2SlNPTiA9IE5vbmU7CgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIGV2SlNPTiA9IHVqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsKICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOgogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOwogICAgICAgIAoKICAgICAgICBhbnN3ZXIgPSBOb25lOwoKICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGlja3NfbXMoKSkrJ10uRXZlbnQudHJpZ2dlcigpJykubWV0aG9kKCd0cmlnZ2VyJykuY2xhc3NOYW1lKCdFdmVudCcpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpOwogICAgICAgIAogICAgICAgIGdjLmNvbGxlY3QoKTsKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOwoKICAgICAgICAKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsKICAgICAgICAKICAgICAgICAgICAgYW5zd2VyID0gZXZKU09OOwogICAgICAgIAoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7CgogICAgICAgICAgICByZXR1cm4gbXF0dF9jbGllbnQucHVibGlzaChtcXR0X3RvcGljLCBzZWxmLl90b0RvY3VtZW50KFRydWUpKTsKICAgICAgICAKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoc3RyKGFuc3dlcikpOwogICAgICAgICAgICAKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOwoKICAgICAgICAgICAgCgogICAgICAgIHJldHVybiBhbnN3ZXI7CgogICAgCiAgICBkZWYgcHJvY2VzcyhzZWxmLCBfX2V2ZW50PU5vbmUpOgogICAgICAgIF9fdG9TdHJpbmcgPSAnRXZlbnQ6OnByb2Nlc3MoKTogJzsKICAgICAgICAKICAgICAgICBldkpTT04gPSBOb25lOwoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBldkpTT04gPSB1anNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7CiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoKICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsKICAgICAgICAKCiAgICAgICAgYW5zd2VyID0gTm9uZTsKCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpY2tzX21zKCkpKyddLkV2ZW50LnByb2Nlc3MoKScpLm1ldGhvZCgncHJvY2VzcycpLmNsYXNzTmFtZSgnRXZlbnQnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7CiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTsKICAgICAgICAKICAgICAgICBnYy5jb2xsZWN0KCk7CgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsKCiAgICAgICAgCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7CiAgICAgICAgCiAgICAgICAgICAgIGFuc3dlciA9IEV2ZW50KCkuX2Zyb21Eb2N1bWVudChldkpTT04pOwogICAgICAgIAoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7CgogICAgICAgICAgICBpZiBzZWxmLnNlbmRlcigpLmNvZGUoKT09bm9kZS5jb2RlKCk6CiAgICAgICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImlnbm9yaW5nIG15IGV2ZW50cyIpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICBlbGlmIHNlbGYucmVjaXBpZW50KCkuY29kZSgpIT1ub2RlLmNvZGUoKToKICAgICAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAibm90IHNlbnQgdG8gbWUiKTsKICAgICAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgICAgIHJldHVybiBnZXRhdHRyKGdsb2JhbHMoKVtzZWxmLmNsYXNzTmFtZSgpXSgpLCBzZWxmLm1ldGhvZCgpKShzZWxmKTsKICAgICAgICAKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOwogICAgICAgICAgICAKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOwoKICAgICAgICAgICAgCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOwogICAgICAgICAgICAKCiAgICAgICAgcmV0dXJuIGFuc3dlcjsKCiAgICAKCgpjbGFzcyBOb2RlKCk6CiAgICBkZWYgX19pbml0X18oc2VsZiwgSWQ9Tm9uZSwgYWN0aXZlPU5vbmUsIGVuYWJsZWQ9Tm9uZSwgY29kZT1Ob25lLCBvcmRlcj1Ob25lLCBkYXRlPU5vbmUsIG5hbWU9Tm9uZSwgcmVtYXJrPU5vbmUsIGFkZHJlc3M9Tm9uZSwgYmFja3VwPU5vbmUsIHBhcmVudD1Ob25lLCBncm91cD1Ob25lLCBjb250ZXh0PU5vbmUsIHBvcnQ9Tm9uZSwgb25saW5lPU5vbmUsIHNlY3VyZT1Ob25lLCB0eXBlPU5vbmUpOgogICAgICAgIHN1cGVyKCkuX19pbml0X18oKTsKCiAgICAgICAgI3ByaW50KCdOb2RlOjpfX2luaXRfXygpJyk7CiAgICAgICAgaWYgSWQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHNlbGYuSWQgPSBJZDsKCiAgICAgICAgCiAgICAgICAgc2VsZi5hY3RpdmUoYWN0aXZlKTsKICAgICAgICBzZWxmLmVuYWJsZWQoZW5hYmxlZCk7CiAgICAgICAgc2VsZi5jb2RlKGNvZGUpOwogICAgICAgIHNlbGYub3JkZXIob3JkZXIpOwogICAgICAgIHNlbGYuZGF0ZShkYXRlKTsKICAgICAgICBzZWxmLm5hbWUobmFtZSk7CiAgICAgICAgc2VsZi5yZW1hcmsocmVtYXJrKTsKICAgICAgICBzZWxmLmFkZHJlc3MoYWRkcmVzcyk7CiAgICAgICAgc2VsZi5iYWNrdXAoYmFja3VwKTsKICAgICAgICBzZWxmLnBhcmVudChwYXJlbnQpOwogICAgICAgIHNlbGYuZ3JvdXAoZ3JvdXApOwogICAgICAgIHNlbGYuY29udGV4dChjb250ZXh0KTsKICAgICAgICBzZWxmLnBvcnQocG9ydCk7CiAgICAgICAgc2VsZi5vbmxpbmUob25saW5lKTsKICAgICAgICBzZWxmLnNlY3VyZShzZWN1cmUpOwogICAgICAgIHNlbGYudHlwZSh0eXBlKTsKICAgICAgICAKICAgIElkID0gTm9uZTsKICAgIAogICAgCiAgICAjIGFjdGl2ZTogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX2FjdGl2ZSA9IE5vbmU7CiAgICBkZWYgYWN0aXZlKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9hY3RpdmUgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fYWN0aXZlOwogICAgCiAgICAjIGVuYWJsZWQ6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9lbmFibGVkID0gTm9uZTsKICAgIGRlZiBlbmFibGVkKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9lbmFibGVkID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2VuYWJsZWQ7CiAgICAKICAgICMgY29kZTogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX2NvZGUgPSBOb25lOwogICAgZGVmIGNvZGUoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2NvZGUgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fY29kZTsKICAgIAogICAgIyBvcmRlcjogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX29yZGVyID0gTm9uZTsKICAgIGRlZiBvcmRlcihzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fb3JkZXIgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fb3JkZXI7CiAgICAKICAgICMgZGF0ZTogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX2RhdGUgPSBOb25lOwogICAgZGVmIGRhdGUoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2RhdGUgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fZGF0ZTsKICAgIAogICAgIyBuYW1lOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfbmFtZSA9IE5vbmU7CiAgICBkZWYgbmFtZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fbmFtZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9uYW1lOwogICAgCiAgICAjIHJlbWFyazogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX3JlbWFyayA9IE5vbmU7CiAgICBkZWYgcmVtYXJrKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9yZW1hcmsgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fcmVtYXJrOwogICAgCiAgICAjIGFkZHJlc3M6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9hZGRyZXNzID0gTm9uZTsKICAgIGRlZiBhZGRyZXNzKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9hZGRyZXNzID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2FkZHJlc3M7CiAgICAKICAgICMgYmFja3VwOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfYmFja3VwID0gTm9uZTsKICAgIGRlZiBiYWNrdXAoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2JhY2t1cCA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9iYWNrdXA7CiAgICAKICAgICMgcGFyZW50OiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfcGFyZW50ID0gTm9uZTsKICAgIGRlZiBwYXJlbnQoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX3BhcmVudCA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9wYXJlbnQ7CiAgICAKICAgICMgZ3JvdXA6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9ncm91cCA9IE5vbmU7CiAgICBkZWYgZ3JvdXAoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2dyb3VwID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2dyb3VwOwogICAgCiAgICAjIGNvbnRleHQ6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9jb250ZXh0ID0gTm9uZTsKICAgIGRlZiBjb250ZXh0KHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9jb250ZXh0ID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2NvbnRleHQ7CiAgICAKICAgICMgcG9ydDogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX3BvcnQgPSBOb25lOwogICAgZGVmIHBvcnQoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX3BvcnQgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fcG9ydDsKICAgIAogICAgIyBvbmxpbmU6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9vbmxpbmUgPSBOb25lOwogICAgZGVmIG9ubGluZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fb25saW5lID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX29ubGluZTsKICAgIAogICAgIyBzZWN1cmU6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9zZWN1cmUgPSBOb25lOwogICAgZGVmIHNlY3VyZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fc2VjdXJlID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3NlY3VyZTsKICAgIAogICAgIyB0eXBlOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfdHlwZSA9IE5vbmU7CiAgICBkZWYgdHlwZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fdHlwZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl90eXBlOwogICAgCiAgICAKICAgIAogICAgIyBjb250cm9sbGVyX0RldmljZXM6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9jb250cm9sbGVyX0RldmljZXMgPSBOb25lOwogICAgZGVmIGNvbnRyb2xsZXJfRGV2aWNlcyhzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fY29udHJvbGxlcl9EZXZpY2VzID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2NvbnRyb2xsZXJfRGV2aWNlczsKICAgIAogICAgIyBub2RlX0NvbmZpZ3M6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9ub2RlX0NvbmZpZ3MgPSBOb25lOwogICAgZGVmIG5vZGVfQ29uZmlncyhzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fbm9kZV9Db25maWdzID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX25vZGVfQ29uZmlnczsKICAgIAogICAgIyBjYXJyaWVyX0V2ZW50czogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX2NhcnJpZXJfRXZlbnRzID0gTm9uZTsKICAgIGRlZiBjYXJyaWVyX0V2ZW50cyhzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fY2Fycmllcl9FdmVudHMgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fY2Fycmllcl9FdmVudHM7CiAgICAKICAgICMgc2VuZGVyX0V2ZW50czogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX3NlbmRlcl9FdmVudHMgPSBOb25lOwogICAgZGVmIHNlbmRlcl9FdmVudHMoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX3NlbmRlcl9FdmVudHMgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fc2VuZGVyX0V2ZW50czsKICAgIAogICAgIyByZWNpcGllbnRfRXZlbnRzOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfcmVjaXBpZW50X0V2ZW50cyA9IE5vbmU7CiAgICBkZWYgcmVjaXBpZW50X0V2ZW50cyhzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fcmVjaXBpZW50X0V2ZW50cyA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9yZWNpcGllbnRfRXZlbnRzOwogICAgCiAgICAjIGJhY2t1cF9Ob2RlczogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX2JhY2t1cF9Ob2RlcyA9IE5vbmU7CiAgICBkZWYgYmFja3VwX05vZGVzKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9iYWNrdXBfTm9kZXMgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fYmFja3VwX05vZGVzOwogICAgCiAgICAjIHBhcmVudF9Ob2RlczogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX3BhcmVudF9Ob2RlcyA9IE5vbmU7CiAgICBkZWYgcGFyZW50X05vZGVzKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9wYXJlbnRfTm9kZXMgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fcGFyZW50X05vZGVzOwogICAgCiAgICAKICAgIGRlZiBfdW5pcXVlKHNlbGYpOgogICAgICAgIF9fdG9TdHJpbmcgPSAnTm9kZTo6X3VuaXF1ZSgpOiAnOwogICAgICAgIAogICAgICAgIHJldCA9IE5vZGUoKTsKICAgICAgICBpZiBzZWxmLklkIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXQuSWQgPSBzZWxmLklkOwogICAgCiAgICAgICAgaWYgc2VsZi5jb2RlKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldC5jb2RlKHNlbGYuY29kZSgpKTsKICAgIAogICAgICAgIGdjLmNvbGxlY3QoKTsKICAgICAgICByZXR1cm4gcmV0OwogICAgCiAgICBkZWYgX2Zyb21Eb2N1bWVudChzZWxmLCBvYmopOgogICAgICAgIF9fdG9TdHJpbmcgPSAnTm9kZTo6X2Zyb21Eb2N1bWVudCgpOiAnOwogICAgICAgIAogICAgICAgIGlmIG9iaiBpcyBOb25lOgogICAgICAgICAgICByZXR1cm4gc2VsZjsKCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIGJ5dGVzKToKICAgICAgICAgICAgb2JqID0gc3RyKG9iaiwgInV0Zi04Iik7CgogICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLCBzdHIpIG9yIHR5cGUob2JqKSBpcyBzdHI6CiAgICAgICAgICAgIGlmIHJlLm1hdGNoKHIiKCgoW0EtWmEtel17Myw5fTooPzpcL1wvKT8pKD86Wy07OiY9XCtcJCxcd10rQCk/W0EtWmEtejAtOS4tXSt8KD86d3d3LnxbLTs6Jj1cK1wkLFx3XStAKVtBLVphLXowLTkuLV0rKSgoPzpcL1tcK34lXC8uXHdcLV9dKik/XD8/KD86Wy1cKz0mOyVALlx3X10qKSM/KD86W1x3XSopKT8pIiwgb2JqKToKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBvYmogPSB1anNvbi5sb2Fkcyh1cmxsaWIzLlBvb2xNYW5hZ2VyKCkucmVxdWVzdCgnR0VUJywgb2JqKS5kYXRhLmRlY29kZSgndXRmLTgnKSk7CiAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgb2JqID0ge307CiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBvYmogPSB1anNvbi5sb2FkcyhvYmopOwogICAgICAgIAogICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLCBsaXN0KToKICAgICAgICAgICAgcmV0dXJuIFtOb2RlKCkuX2Zyb21Eb2N1bWVudChvKSBmb3IgbyBpbiBvYmpdOwogICAgICAgICAgICAKICAgICAgICBpZiBub3QgaXNpbnN0YW5jZShvYmosIChzdHIsIGJ5dGVzLCBkaWN0KSk6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAndW5oYW5kbGVkIHR5cGU6ICcgKyBzdHIodHlwZShvYmopKSk7CiAgICAgICAgICAgIHJldHVybiBvYmo7CgogICAgICAgIGlmICdJZCcgaW4gb2JqOgogICAgICAgICAgICBzZWxmLklkID0gb2JqWydJZCddOwoKICAgIAogICAgICAgIGlmICdhY3RpdmUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5hY3RpdmUob2JqWydhY3RpdmUnXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnZW5hYmxlZCcgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmVuYWJsZWQob2JqWydlbmFibGVkJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ2NvZGUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5jb2RlKG9ialsnY29kZSddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdvcmRlcicgaW4gb2JqOgogICAgICAgICAgICBzZWxmLm9yZGVyKG9ialsnb3JkZXInXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnZGF0ZScgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmRhdGUob2JqWydkYXRlJ10pOwogICAgICAgIAogICAgICAgICAgICBzZWxmLmRhdGUoZGF0ZXRpbWUuZGF0ZXRpbWUuZnJvbWlzb2Zvcm1hdChzZWxmLmRhdGUoKSkpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ25hbWUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5uYW1lKG9ialsnbmFtZSddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdyZW1hcmsnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5yZW1hcmsob2JqWydyZW1hcmsnXSk7CiAgICAgICAgCiAgICAgICAgICAgIHNlbGYucmVtYXJrKCB1YmluYXNjaWkuYTJiX2Jhc2U2NChzZWxmLnJlbWFyaygpKSApOwogICAgICAgICAgICBpZiBzZWxmLnJlbWFyaygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIHNlbGYucmVtYXJrKHNlbGYucmVtYXJrKCkuZGVjb2RlKCd1dGYtOCcpLnN0cmlwKCkpOwogICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgIHNlbGYucmVtYXJrKCk7CiAgICAgICAgICAgICAgICAgICAgI3ByaW50KF9fdG9TdHJpbmcgKyAicmVtYXJrIGV4Y2VwdGlvbiIsIHNlbGYucmVtYXJrKCkpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ2FkZHJlc3MnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5hZGRyZXNzKG9ialsnYWRkcmVzcyddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdiYWNrdXAnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5iYWNrdXAoTm9kZSgpLl9mcm9tRG9jdW1lbnQob2JqWydiYWNrdXAnXSkpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ3BhcmVudCcgaW4gb2JqOgogICAgICAgICAgICBzZWxmLnBhcmVudChOb2RlKCkuX2Zyb21Eb2N1bWVudChvYmpbJ3BhcmVudCddKSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnZ3JvdXAnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5ncm91cChOb2RlX0dyb3VwKCkuX2Zyb21Eb2N1bWVudChvYmpbJ2dyb3VwJ10pKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdjb250ZXh0JyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuY29udGV4dChOb2RlX0NvbnRleHQoKS5fZnJvbURvY3VtZW50KG9ialsnY29udGV4dCddKSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAncG9ydCcgaW4gb2JqOgogICAgICAgICAgICBzZWxmLnBvcnQob2JqWydwb3J0J10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ29ubGluZScgaW4gb2JqOgogICAgICAgICAgICBzZWxmLm9ubGluZShvYmpbJ29ubGluZSddKTsKICAgICAgICAKICAgICAgICAgICAgc2VsZi5vbmxpbmUoZGF0ZXRpbWUuZGF0ZXRpbWUuZnJvbWlzb2Zvcm1hdChzZWxmLm9ubGluZSgpKSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnc2VjdXJlJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuc2VjdXJlKG9ialsnc2VjdXJlJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ3R5cGUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi50eXBlKE5vZGVfVHlwZSgpLl9mcm9tRG9jdW1lbnQob2JqWyd0eXBlJ10pKTsKICAgICAgICAKICAgIAoKICAgIAogICAgICAgIGlmICdjb250cm9sbGVyX0RldmljZXMnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5jb250cm9sbGVyX0RldmljZXMoRGV2aWNlKCkuX2Zyb21Eb2N1bWVudChvYmpbJ2NvbnRyb2xsZXJfRGV2aWNlcyddKSk7CiAgICAKICAgICAgICBpZiAnbm9kZV9Db25maWdzJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYubm9kZV9Db25maWdzKENvbmZpZygpLl9mcm9tRG9jdW1lbnQob2JqWydub2RlX0NvbmZpZ3MnXSkpOwogICAgCiAgICAgICAgaWYgJ2NhcnJpZXJfRXZlbnRzJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuY2Fycmllcl9FdmVudHMoRXZlbnQoKS5fZnJvbURvY3VtZW50KG9ialsnY2Fycmllcl9FdmVudHMnXSkpOwogICAgCiAgICAgICAgaWYgJ3NlbmRlcl9FdmVudHMnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5zZW5kZXJfRXZlbnRzKEV2ZW50KCkuX2Zyb21Eb2N1bWVudChvYmpbJ3NlbmRlcl9FdmVudHMnXSkpOwogICAgCiAgICAgICAgaWYgJ3JlY2lwaWVudF9FdmVudHMnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5yZWNpcGllbnRfRXZlbnRzKEV2ZW50KCkuX2Zyb21Eb2N1bWVudChvYmpbJ3JlY2lwaWVudF9FdmVudHMnXSkpOwogICAgCiAgICAgICAgaWYgJ2JhY2t1cF9Ob2RlcycgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmJhY2t1cF9Ob2RlcyhOb2RlKCkuX2Zyb21Eb2N1bWVudChvYmpbJ2JhY2t1cF9Ob2RlcyddKSk7CiAgICAKICAgICAgICBpZiAncGFyZW50X05vZGVzJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYucGFyZW50X05vZGVzKE5vZGUoKS5fZnJvbURvY3VtZW50KG9ialsncGFyZW50X05vZGVzJ10pKTsKICAgIAoKICAgICAgICBnYy5jb2xsZWN0KCk7CiAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAKICAgIGRlZiBfdG9Eb2N1bWVudChzZWxmLCBiSlNPTj1Ob25lKToKICAgICAgICBfX3RvU3RyaW5nID0gJ05vZGU6Ol90b0RvY3VtZW50KCk6ICc7CgogICAgICAgIHJldCA9IHt9OwogICAgICAgIGlmIHNlbGYuSWQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiSWQiXSA9IHNlbGYuSWQ7CgogICAgCiAgICAgICAgaWYgc2VsZi5hY3RpdmUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJhY3RpdmUiXSA9IHNlbGYuYWN0aXZlKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLmVuYWJsZWQoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJlbmFibGVkIl0gPSBzZWxmLmVuYWJsZWQoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYuY29kZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbImNvZGUiXSA9IHNlbGYuY29kZSgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5vcmRlcigpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbIm9yZGVyIl0gPSBzZWxmLm9yZGVyKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLmRhdGUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJkYXRlIl0gPSBzZWxmLmRhdGUoKTsKICAgICAgICAKICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShyZXRbImRhdGUiXSwgZGF0ZXRpbWUuZGF0ZXRpbWUpOgogICAgICAgICAgICAgICAgcmV0WyJkYXRlIl0gPSByZXRbImRhdGUiXS5pc29mb3JtYXQoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYubmFtZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbIm5hbWUiXSA9IHNlbGYubmFtZSgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5yZW1hcmsoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IHNlbGYucmVtYXJrKCk7CiAgICAgICAgCiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UocmV0WyJyZW1hcmsiXSwgZGljdCk6CiAgICAgICAgICAgICAgICByZXRbInJlbWFyayJdID0gdWpzb24uZHVtcHMocmV0WyJyZW1hcmsiXSkuZW5jb2RlKCd1dGYtOCcpOwoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9ICB1YmluYXNjaWkuYjJhX2Jhc2U2NChyZXRbInJlbWFyayJdKS5kZWNvZGUoJ3V0Zi04Jykuc3RyaXAoKTsKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGNlcHRpb24gd2l0aCByZW1hcms6ICIgKyByZXRbInJlbWFyayJdKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYuYWRkcmVzcygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbImFkZHJlc3MiXSA9IHNlbGYuYWRkcmVzcygpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5iYWNrdXAoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJiYWNrdXAiXSA9IHNlbGYuYmFja3VwKCkuX3RvRG9jdW1lbnQoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYucGFyZW50KCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsicGFyZW50Il0gPSBzZWxmLnBhcmVudCgpLl90b0RvY3VtZW50KCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLmdyb3VwKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiZ3JvdXAiXSA9IHNlbGYuZ3JvdXAoKS5fdG9Eb2N1bWVudCgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5jb250ZXh0KCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiY29udGV4dCJdID0gc2VsZi5jb250ZXh0KCkuX3RvRG9jdW1lbnQoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYucG9ydCgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbInBvcnQiXSA9IHNlbGYucG9ydCgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5vbmxpbmUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJvbmxpbmUiXSA9IHNlbGYub25saW5lKCk7CiAgICAgICAgCiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UocmV0WyJvbmxpbmUiXSwgZGF0ZXRpbWUuZGF0ZXRpbWUpOgogICAgICAgICAgICAgICAgcmV0WyJvbmxpbmUiXSA9IHJldFsib25saW5lIl0uaXNvZm9ybWF0KCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLnNlY3VyZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbInNlY3VyZSJdID0gc2VsZi5zZWN1cmUoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYudHlwZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbInR5cGUiXSA9IHNlbGYudHlwZSgpLl90b0RvY3VtZW50KCk7CiAgICAgICAgCiAgICAKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYuY29udHJvbGxlcl9EZXZpY2VzKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiY29udHJvbGxlcl9EZXZpY2VzIl0gPSBbdGEuX3RvRG9jdW1lbnQoKSBmb3IgdGEgaW4gc2VsZi5jb250cm9sbGVyX0RldmljZXMoKV07CiAgICAKICAgICAgICBpZiBzZWxmLm5vZGVfQ29uZmlncygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbIm5vZGVfQ29uZmlncyJdID0gW3RhLl90b0RvY3VtZW50KCkgZm9yIHRhIGluIHNlbGYubm9kZV9Db25maWdzKCldOwogICAgCiAgICAgICAgaWYgc2VsZi5jYXJyaWVyX0V2ZW50cygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbImNhcnJpZXJfRXZlbnRzIl0gPSBbdGEuX3RvRG9jdW1lbnQoKSBmb3IgdGEgaW4gc2VsZi5jYXJyaWVyX0V2ZW50cygpXTsKICAgIAogICAgICAgIGlmIHNlbGYuc2VuZGVyX0V2ZW50cygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbInNlbmRlcl9FdmVudHMiXSA9IFt0YS5fdG9Eb2N1bWVudCgpIGZvciB0YSBpbiBzZWxmLnNlbmRlcl9FdmVudHMoKV07CiAgICAKICAgICAgICBpZiBzZWxmLnJlY2lwaWVudF9FdmVudHMoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJyZWNpcGllbnRfRXZlbnRzIl0gPSBbdGEuX3RvRG9jdW1lbnQoKSBmb3IgdGEgaW4gc2VsZi5yZWNpcGllbnRfRXZlbnRzKCldOwogICAgCiAgICAgICAgaWYgc2VsZi5iYWNrdXBfTm9kZXMoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJiYWNrdXBfTm9kZXMiXSA9IFt0YS5fdG9Eb2N1bWVudCgpIGZvciB0YSBpbiBzZWxmLmJhY2t1cF9Ob2RlcygpXTsKICAgIAogICAgICAgIGlmIHNlbGYucGFyZW50X05vZGVzKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsicGFyZW50X05vZGVzIl0gPSBbdGEuX3RvRG9jdW1lbnQoKSBmb3IgdGEgaW4gc2VsZi5wYXJlbnRfTm9kZXMoKV07CiAgICAKCiAgICAgICAgaWYgYkpTT04gaXMgbm90IE5vbmU6CiAgICAgICAgICAgICNwcmludChfX3RvU3RyaW5nICsgIkdPVCBIRVJFIiwgdHlwZShyZXQpLCByZXQpOwogICAgICAgICAgICByZXQgPSB1anNvbi5kdW1wcyhyZXQpOwogICAgICAgIGdjLmNvbGxlY3QoKTsKICAgICAgICByZXR1cm4gcmV0OwoKICAgIAogICAgZGVmIHN0b3JlKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6CiAgICAgICAgX190b1N0cmluZyA9ICdOb2RlOjpzdG9yZSgpOiAnOwogICAgICAgIAogICAgICAgIGV2SlNPTiA9IE5vbmU7CgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIGV2SlNPTiA9IHVqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsKICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOgogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOwogICAgICAgIAoKICAgICAgICBhbnN3ZXIgPSBOb25lOwoKICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGlja3NfbXMoKSkrJ10uTm9kZS5zdG9yZSgpJykubWV0aG9kKCdzdG9yZScpLmNsYXNzTmFtZSgnTm9kZScpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpOwogICAgICAgIAogICAgICAgIGdjLmNvbGxlY3QoKTsKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOwoKICAgICAgICAKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsKICAgICAgICAKICAgICAgICAgICAgYW5zd2VyID0gTm9kZSgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsKICAgICAgICAKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOwoKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOwogICAgICAgICAgICAKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOwoKICAgICAgICAgICAgCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOwogICAgICAgICAgICAKCiAgICAgICAgcmV0dXJuIGFuc3dlcjsKCiAgICAKICAgIGRlZiBmaW5kQWxsKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6CiAgICAgICAgX190b1N0cmluZyA9ICdOb2RlOjpmaW5kQWxsKCk6ICc7CiAgICAgICAgCiAgICAgICAgZXZKU09OID0gTm9uZTsKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgZXZKU09OID0gdWpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOwogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046CiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7CiAgICAgICAgCgogICAgICAgIGFuc3dlciA9IE5vbmU7CgogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aWNrc19tcygpKSsnXS5Ob2RlLmZpbmRBbGwoKScpLm1ldGhvZCgnZmluZEFsbCcpLmNsYXNzTmFtZSgnTm9kZScpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpOwogICAgICAgIAogICAgICAgIGdjLmNvbGxlY3QoKTsKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOwoKICAgICAgICAKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsKICAgICAgICAKICAgICAgICAgICAgYW5zd2VyID0gTm9kZSgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsKICAgICAgICAKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOwoKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOwogICAgICAgICAgICAKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOwoKICAgICAgICAgICAgCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOwogICAgICAgICAgICAKCiAgICAgICAgcmV0dXJuIGFuc3dlcjsKCiAgICAKICAgIGRlZiBmaW5kKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6CiAgICAgICAgX190b1N0cmluZyA9ICdOb2RlOjpmaW5kKCk6ICc7CiAgICAgICAgCiAgICAgICAgZXZKU09OID0gTm9uZTsKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgZXZKU09OID0gdWpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOwogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046CiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7CiAgICAgICAgCgogICAgICAgIGFuc3dlciA9IE5vbmU7CgogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aWNrc19tcygpKSsnXS5Ob2RlLmZpbmQoKScpLm1ldGhvZCgnZmluZCcpLmNsYXNzTmFtZSgnTm9kZScpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpOwogICAgICAgIAogICAgICAgIGdjLmNvbGxlY3QoKTsKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOwoKICAgICAgICAKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsKICAgICAgICAKICAgICAgICAgICAgYW5zd2VyID0gTm9kZSgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsKICAgICAgICAKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOwoKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOwogICAgICAgICAgICAKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOwoKICAgICAgICAgICAgCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOwogICAgICAgICAgICAKCiAgICAgICAgcmV0dXJuIGFuc3dlcjsKCiAgICAKICAgIGRlZiBhdXRoQ29kZShzZWxmLCBfX2V2ZW50PU5vbmUsIGNvZGU9Tm9uZSwgdG9vbD1Ob25lKToKICAgICAgICBfX3RvU3RyaW5nID0gJ05vZGU6OmF1dGhDb2RlKCk6ICc7CiAgICAgICAgCiAgICAgICAgZXZKU09OID0gTm9uZTsKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgZXZKU09OID0gdWpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOwogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046CiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7CiAgICAgICAgCiAgICAgICAgICAgIGlmICdjb2RlJyBpbiBldkpTT046CiAgICAgICAgICAgICAgICBjb2RlID0gZXZKU09OWydjb2RlJ107CiAgICAgICAgCiAgICAgICAgICAgIGlmICd0b29sJyBpbiBldkpTT046CiAgICAgICAgICAgICAgICB0b29sID0gZXZKU09OWyd0b29sJ107CiAgICAgICAgCgogICAgICAgIGFuc3dlciA9IE5vbmU7CgogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aWNrc19tcygpKSsnXS5Ob2RlLmF1dGhDb2RlKCknKS5tZXRob2QoJ2F1dGhDb2RlJykuY2xhc3NOYW1lKCdOb2RlJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOwogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7CiAgICAgICAgCiAgICAgICAgZ2MuY29sbGVjdCgpOwoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7CgogICAgICAgIAogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOwogICAgICAgIAogICAgICAgICAgICBhbnN3ZXIgPSBldkpTT047CiAgICAgICAgCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsKCgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHN0cihhbnN3ZXIpKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsKCiAgICAgICAgICAgIAogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsKICAgICAgICAgICAgCgogICAgICAgIHJldHVybiBhbnN3ZXI7CgogICAgCiAgICBkZWYgaW5pdChzZWxmLCBfX2V2ZW50PU5vbmUsIG9ubGluZT1Ob25lLCBjb2RlPU5vbmUsIHVpZD1Ob25lKToKICAgICAgICBfX3RvU3RyaW5nID0gJ05vZGU6OmluaXQoKTogJzsKICAgICAgICAKICAgICAgICBldkpTT04gPSBOb25lOwoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBldkpTT04gPSB1anNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7CiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoKICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsKICAgICAgICAKICAgICAgICAgICAgaWYgJ29ubGluZScgaW4gZXZKU09OOgogICAgICAgICAgICAgICAgb25saW5lID0gZXZKU09OWydvbmxpbmUnXTsKICAgICAgICAKICAgICAgICAgICAgaWYgJ2NvZGUnIGluIGV2SlNPTjoKICAgICAgICAgICAgICAgIGNvZGUgPSBldkpTT05bJ2NvZGUnXTsKICAgICAgICAKICAgICAgICAgICAgaWYgJ3VpZCcgaW4gZXZKU09OOgogICAgICAgICAgICAgICAgdWlkID0gZXZKU09OWyd1aWQnXTsKICAgICAgICAKCiAgICAgICAgYW5zd2VyID0gTm9uZTsKCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpY2tzX21zKCkpKyddLk5vZGUuaW5pdCgpJykubWV0aG9kKCdpbml0JykuY2xhc3NOYW1lKCdOb2RlJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOwogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7CiAgICAgICAgCiAgICAgICAgZ2MuY29sbGVjdCgpOwoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7CgogICAgICAgIAogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOwogICAgICAgIAogICAgICAgICAgICBhbnN3ZXIgPSBOb2RlKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOwogICAgICAgIAoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7CgoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOgogICAgICAgICAgICAKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7CgogICAgICAgICAgICAKICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7CiAgICAgICAgICAgIAoKICAgICAgICByZXR1cm4gYW5zd2VyOwoKICAgIAoKCmNsYXNzIE5vZGVfQ29udGV4dCgpOgogICAgZGVmIF9faW5pdF9fKHNlbGYsIElkPU5vbmUsIGFjdGl2ZT1Ob25lLCBlbmFibGVkPU5vbmUsIGNvZGU9Tm9uZSwgb3JkZXI9Tm9uZSwgZGF0ZT1Ob25lLCBuYW1lPU5vbmUsIHJlbWFyaz1Ob25lKToKICAgICAgICBzdXBlcigpLl9faW5pdF9fKCk7CgogICAgICAgICNwcmludCgnTm9kZV9Db250ZXh0OjpfX2luaXRfXygpJyk7CiAgICAgICAgaWYgSWQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHNlbGYuSWQgPSBJZDsKCiAgICAgICAgCiAgICAgICAgc2VsZi5hY3RpdmUoYWN0aXZlKTsKICAgICAgICBzZWxmLmVuYWJsZWQoZW5hYmxlZCk7CiAgICAgICAgc2VsZi5jb2RlKGNvZGUpOwogICAgICAgIHNlbGYub3JkZXIob3JkZXIpOwogICAgICAgIHNlbGYuZGF0ZShkYXRlKTsKICAgICAgICBzZWxmLm5hbWUobmFtZSk7CiAgICAgICAgc2VsZi5yZW1hcmsocmVtYXJrKTsKICAgICAgICAKICAgIElkID0gTm9uZTsKICAgIAogICAgCiAgICAjIGFjdGl2ZTogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX2FjdGl2ZSA9IE5vbmU7CiAgICBkZWYgYWN0aXZlKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9hY3RpdmUgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fYWN0aXZlOwogICAgCiAgICAjIGVuYWJsZWQ6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9lbmFibGVkID0gTm9uZTsKICAgIGRlZiBlbmFibGVkKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9lbmFibGVkID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2VuYWJsZWQ7CiAgICAKICAgICMgY29kZTogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX2NvZGUgPSBOb25lOwogICAgZGVmIGNvZGUoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2NvZGUgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fY29kZTsKICAgIAogICAgIyBvcmRlcjogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX29yZGVyID0gTm9uZTsKICAgIGRlZiBvcmRlcihzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fb3JkZXIgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fb3JkZXI7CiAgICAKICAgICMgZGF0ZTogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX2RhdGUgPSBOb25lOwogICAgZGVmIGRhdGUoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2RhdGUgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fZGF0ZTsKICAgIAogICAgIyBuYW1lOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfbmFtZSA9IE5vbmU7CiAgICBkZWYgbmFtZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fbmFtZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9uYW1lOwogICAgCiAgICAjIHJlbWFyazogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX3JlbWFyayA9IE5vbmU7CiAgICBkZWYgcmVtYXJrKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9yZW1hcmsgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fcmVtYXJrOwogICAgCiAgICAKICAgIAogICAgIyBjb250ZXh0X05vZGVzOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfY29udGV4dF9Ob2RlcyA9IE5vbmU7CiAgICBkZWYgY29udGV4dF9Ob2RlcyhzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fY29udGV4dF9Ob2RlcyA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9jb250ZXh0X05vZGVzOwogICAgCiAgICAKICAgIGRlZiBfdW5pcXVlKHNlbGYpOgogICAgICAgIF9fdG9TdHJpbmcgPSAnTm9kZV9Db250ZXh0OjpfdW5pcXVlKCk6ICc7CiAgICAgICAgCiAgICAgICAgcmV0ID0gTm9kZV9Db250ZXh0KCk7CiAgICAgICAgaWYgc2VsZi5JZCBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0LklkID0gc2VsZi5JZDsKICAgIAogICAgICAgIGlmIHNlbGYuY29kZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXQuY29kZShzZWxmLmNvZGUoKSk7CiAgICAKICAgICAgICBnYy5jb2xsZWN0KCk7CiAgICAgICAgcmV0dXJuIHJldDsKICAgIAogICAgZGVmIF9mcm9tRG9jdW1lbnQoc2VsZiwgb2JqKToKICAgICAgICBfX3RvU3RyaW5nID0gJ05vZGVfQ29udGV4dDo6X2Zyb21Eb2N1bWVudCgpOiAnOwogICAgICAgIAogICAgICAgIGlmIG9iaiBpcyBOb25lOgogICAgICAgICAgICByZXR1cm4gc2VsZjsKCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIGJ5dGVzKToKICAgICAgICAgICAgb2JqID0gc3RyKG9iaiwgInV0Zi04Iik7CgogICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLCBzdHIpIG9yIHR5cGUob2JqKSBpcyBzdHI6CiAgICAgICAgICAgIGlmIHJlLm1hdGNoKHIiKCgoW0EtWmEtel17Myw5fTooPzpcL1wvKT8pKD86Wy07OiY9XCtcJCxcd10rQCk/W0EtWmEtejAtOS4tXSt8KD86d3d3LnxbLTs6Jj1cK1wkLFx3XStAKVtBLVphLXowLTkuLV0rKSgoPzpcL1tcK34lXC8uXHdcLV9dKik/XD8/KD86Wy1cKz0mOyVALlx3X10qKSM/KD86W1x3XSopKT8pIiwgb2JqKToKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBvYmogPSB1anNvbi5sb2Fkcyh1cmxsaWIzLlBvb2xNYW5hZ2VyKCkucmVxdWVzdCgnR0VUJywgb2JqKS5kYXRhLmRlY29kZSgndXRmLTgnKSk7CiAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgb2JqID0ge307CiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBvYmogPSB1anNvbi5sb2FkcyhvYmopOwogICAgICAgIAogICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLCBsaXN0KToKICAgICAgICAgICAgcmV0dXJuIFtOb2RlX0NvbnRleHQoKS5fZnJvbURvY3VtZW50KG8pIGZvciBvIGluIG9ial07CiAgICAgICAgICAgIAogICAgICAgIGlmIG5vdCBpc2luc3RhbmNlKG9iaiwgKHN0ciwgYnl0ZXMsIGRpY3QpKToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICd1bmhhbmRsZWQgdHlwZTogJyArIHN0cih0eXBlKG9iaikpKTsKICAgICAgICAgICAgcmV0dXJuIG9iajsKCiAgICAgICAgaWYgJ0lkJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuSWQgPSBvYmpbJ0lkJ107CgogICAgCiAgICAgICAgaWYgJ2FjdGl2ZScgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmFjdGl2ZShvYmpbJ2FjdGl2ZSddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdlbmFibGVkJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuZW5hYmxlZChvYmpbJ2VuYWJsZWQnXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnY29kZScgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmNvZGUob2JqWydjb2RlJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ29yZGVyJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYub3JkZXIob2JqWydvcmRlciddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdkYXRlJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuZGF0ZShvYmpbJ2RhdGUnXSk7CiAgICAgICAgCiAgICAgICAgICAgIHNlbGYuZGF0ZShkYXRldGltZS5kYXRldGltZS5mcm9taXNvZm9ybWF0KHNlbGYuZGF0ZSgpKSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnbmFtZScgaW4gb2JqOgogICAgICAgICAgICBzZWxmLm5hbWUob2JqWyduYW1lJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ3JlbWFyaycgaW4gb2JqOgogICAgICAgICAgICBzZWxmLnJlbWFyayhvYmpbJ3JlbWFyayddKTsKICAgICAgICAKICAgICAgICAgICAgc2VsZi5yZW1hcmsoIHViaW5hc2NpaS5hMmJfYmFzZTY0KHNlbGYucmVtYXJrKCkpICk7CiAgICAgICAgICAgIGlmIHNlbGYucmVtYXJrKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5yZW1hcmsoc2VsZi5yZW1hcmsoKS5kZWNvZGUoJ3V0Zi04Jykuc3RyaXAoKSk7CiAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5yZW1hcmsoKTsKICAgICAgICAgICAgICAgICAgICAjcHJpbnQoX190b1N0cmluZyArICJyZW1hcmsgZXhjZXB0aW9uIiwgc2VsZi5yZW1hcmsoKSk7CiAgICAgICAgCiAgICAKCiAgICAKICAgICAgICBpZiAnY29udGV4dF9Ob2RlcycgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmNvbnRleHRfTm9kZXMoTm9kZSgpLl9mcm9tRG9jdW1lbnQob2JqWydjb250ZXh0X05vZGVzJ10pKTsKICAgIAoKICAgICAgICBnYy5jb2xsZWN0KCk7CiAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAKICAgIGRlZiBfdG9Eb2N1bWVudChzZWxmLCBiSlNPTj1Ob25lKToKICAgICAgICBfX3RvU3RyaW5nID0gJ05vZGVfQ29udGV4dDo6X3RvRG9jdW1lbnQoKTogJzsKCiAgICAgICAgcmV0ID0ge307CiAgICAgICAgaWYgc2VsZi5JZCBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJJZCJdID0gc2VsZi5JZDsKCiAgICAKICAgICAgICBpZiBzZWxmLmFjdGl2ZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbImFjdGl2ZSJdID0gc2VsZi5hY3RpdmUoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYuZW5hYmxlZCgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbImVuYWJsZWQiXSA9IHNlbGYuZW5hYmxlZCgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5jb2RlKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiY29kZSJdID0gc2VsZi5jb2RlKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLm9yZGVyKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsib3JkZXIiXSA9IHNlbGYub3JkZXIoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYuZGF0ZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbImRhdGUiXSA9IHNlbGYuZGF0ZSgpOwogICAgICAgIAogICAgICAgICAgICBpZiBpc2luc3RhbmNlKHJldFsiZGF0ZSJdLCBkYXRldGltZS5kYXRldGltZSk6CiAgICAgICAgICAgICAgICByZXRbImRhdGUiXSA9IHJldFsiZGF0ZSJdLmlzb2Zvcm1hdCgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5uYW1lKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsibmFtZSJdID0gc2VsZi5uYW1lKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLnJlbWFyaygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbInJlbWFyayJdID0gc2VsZi5yZW1hcmsoKTsKICAgICAgICAKICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShyZXRbInJlbWFyayJdLCBkaWN0KToKICAgICAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSB1anNvbi5kdW1wcyhyZXRbInJlbWFyayJdKS5lbmNvZGUoJ3V0Zi04Jyk7CgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICByZXRbInJlbWFyayJdID0gIHViaW5hc2NpaS5iMmFfYmFzZTY0KHJldFsicmVtYXJrIl0pLmRlY29kZSgndXRmLTgnKS5zdHJpcCgpOwogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4Y2VwdGlvbiB3aXRoIHJlbWFyazogIiArIHJldFsicmVtYXJrIl0pOwogICAgICAgIAogICAgCiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLmNvbnRleHRfTm9kZXMoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJjb250ZXh0X05vZGVzIl0gPSBbdGEuX3RvRG9jdW1lbnQoKSBmb3IgdGEgaW4gc2VsZi5jb250ZXh0X05vZGVzKCldOwogICAgCgogICAgICAgIGlmIGJKU09OIGlzIG5vdCBOb25lOgogICAgICAgICAgICAjcHJpbnQoX190b1N0cmluZyArICJHT1QgSEVSRSIsIHR5cGUocmV0KSwgcmV0KTsKICAgICAgICAgICAgcmV0ID0gdWpzb24uZHVtcHMocmV0KTsKICAgICAgICBnYy5jb2xsZWN0KCk7CiAgICAgICAgcmV0dXJuIHJldDsKCiAgICAKICAgIGRlZiBzdG9yZShzZWxmLCBfX2V2ZW50PU5vbmUpOgogICAgICAgIF9fdG9TdHJpbmcgPSAnTm9kZV9Db250ZXh0OjpzdG9yZSgpOiAnOwogICAgICAgIAogICAgICAgIGV2SlNPTiA9IE5vbmU7CgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIGV2SlNPTiA9IHVqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsKICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOgogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOwogICAgICAgIAoKICAgICAgICBhbnN3ZXIgPSBOb25lOwoKICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGlja3NfbXMoKSkrJ10uTm9kZV9Db250ZXh0LnN0b3JlKCknKS5tZXRob2QoJ3N0b3JlJykuY2xhc3NOYW1lKCdOb2RlX0NvbnRleHQnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7CiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTsKICAgICAgICAKICAgICAgICBnYy5jb2xsZWN0KCk7CgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsKCiAgICAgICAgCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7CiAgICAgICAgCiAgICAgICAgICAgIGFuc3dlciA9IE5vZGVfQ29udGV4dCgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsKICAgICAgICAKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOwoKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOwogICAgICAgICAgICAKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOwoKICAgICAgICAgICAgCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOwogICAgICAgICAgICAKCiAgICAgICAgcmV0dXJuIGFuc3dlcjsKCiAgICAKICAgIGRlZiBmaW5kQWxsKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6CiAgICAgICAgX190b1N0cmluZyA9ICdOb2RlX0NvbnRleHQ6OmZpbmRBbGwoKTogJzsKICAgICAgICAKICAgICAgICBldkpTT04gPSBOb25lOwoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBldkpTT04gPSB1anNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7CiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoKICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsKICAgICAgICAKCiAgICAgICAgYW5zd2VyID0gTm9uZTsKCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpY2tzX21zKCkpKyddLk5vZGVfQ29udGV4dC5maW5kQWxsKCknKS5tZXRob2QoJ2ZpbmRBbGwnKS5jbGFzc05hbWUoJ05vZGVfQ29udGV4dCcpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpOwogICAgICAgIAogICAgICAgIGdjLmNvbGxlY3QoKTsKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOwoKICAgICAgICAKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsKICAgICAgICAKICAgICAgICAgICAgYW5zd2VyID0gTm9kZV9Db250ZXh0KCkuX2Zyb21Eb2N1bWVudChldkpTT04pOwogICAgICAgIAoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7CgoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOgogICAgICAgICAgICAKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7CgogICAgICAgICAgICAKICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7CiAgICAgICAgICAgIAoKICAgICAgICByZXR1cm4gYW5zd2VyOwoKICAgIAogICAgZGVmIGZpbmQoc2VsZiwgX19ldmVudD1Ob25lKToKICAgICAgICBfX3RvU3RyaW5nID0gJ05vZGVfQ29udGV4dDo6ZmluZCgpOiAnOwogICAgICAgIAogICAgICAgIGV2SlNPTiA9IE5vbmU7CgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIGV2SlNPTiA9IHVqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsKICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOgogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOwogICAgICAgIAoKICAgICAgICBhbnN3ZXIgPSBOb25lOwoKICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGlja3NfbXMoKSkrJ10uTm9kZV9Db250ZXh0LmZpbmQoKScpLm1ldGhvZCgnZmluZCcpLmNsYXNzTmFtZSgnTm9kZV9Db250ZXh0JykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOwogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7CiAgICAgICAgCiAgICAgICAgZ2MuY29sbGVjdCgpOwoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7CgogICAgICAgIAogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOwogICAgICAgIAogICAgICAgICAgICBhbnN3ZXIgPSBOb2RlX0NvbnRleHQoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7CiAgICAgICAgCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsKCgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsKCiAgICAgICAgICAgIAogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsKICAgICAgICAgICAgCgogICAgICAgIHJldHVybiBhbnN3ZXI7CgogICAgCgoKY2xhc3MgTm9kZV9Hcm91cCgpOgogICAgZGVmIF9faW5pdF9fKHNlbGYsIElkPU5vbmUsIGFjdGl2ZT1Ob25lLCBlbmFibGVkPU5vbmUsIGNvZGU9Tm9uZSwgb3JkZXI9Tm9uZSwgZGF0ZT1Ob25lLCBuYW1lPU5vbmUsIHJlbWFyaz1Ob25lKToKICAgICAgICBzdXBlcigpLl9faW5pdF9fKCk7CgogICAgICAgICNwcmludCgnTm9kZV9Hcm91cDo6X19pbml0X18oKScpOwogICAgICAgIGlmIElkIGlzIG5vdCBOb25lOgogICAgICAgICAgICBzZWxmLklkID0gSWQ7CgogICAgICAgIAogICAgICAgIHNlbGYuYWN0aXZlKGFjdGl2ZSk7CiAgICAgICAgc2VsZi5lbmFibGVkKGVuYWJsZWQpOwogICAgICAgIHNlbGYuY29kZShjb2RlKTsKICAgICAgICBzZWxmLm9yZGVyKG9yZGVyKTsKICAgICAgICBzZWxmLmRhdGUoZGF0ZSk7CiAgICAgICAgc2VsZi5uYW1lKG5hbWUpOwogICAgICAgIHNlbGYucmVtYXJrKHJlbWFyayk7CiAgICAgICAgCiAgICBJZCA9IE5vbmU7CiAgICAKICAgIAogICAgIyBhY3RpdmU6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9hY3RpdmUgPSBOb25lOwogICAgZGVmIGFjdGl2ZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fYWN0aXZlID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2FjdGl2ZTsKICAgIAogICAgIyBlbmFibGVkOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfZW5hYmxlZCA9IE5vbmU7CiAgICBkZWYgZW5hYmxlZChzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fZW5hYmxlZCA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9lbmFibGVkOwogICAgCiAgICAjIGNvZGU6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9jb2RlID0gTm9uZTsKICAgIGRlZiBjb2RlKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9jb2RlID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2NvZGU7CiAgICAKICAgICMgb3JkZXI6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9vcmRlciA9IE5vbmU7CiAgICBkZWYgb3JkZXIoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX29yZGVyID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX29yZGVyOwogICAgCiAgICAjIGRhdGU6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9kYXRlID0gTm9uZTsKICAgIGRlZiBkYXRlKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9kYXRlID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2RhdGU7CiAgICAKICAgICMgbmFtZTogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX25hbWUgPSBOb25lOwogICAgZGVmIG5hbWUoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX25hbWUgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fbmFtZTsKICAgIAogICAgIyByZW1hcms6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9yZW1hcmsgPSBOb25lOwogICAgZGVmIHJlbWFyayhzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fcmVtYXJrID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3JlbWFyazsKICAgIAogICAgCiAgICAKICAgICMgZ3JvdXBfTm9kZXM6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9ncm91cF9Ob2RlcyA9IE5vbmU7CiAgICBkZWYgZ3JvdXBfTm9kZXMoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2dyb3VwX05vZGVzID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2dyb3VwX05vZGVzOwogICAgCiAgICAKICAgIGRlZiBfdW5pcXVlKHNlbGYpOgogICAgICAgIF9fdG9TdHJpbmcgPSAnTm9kZV9Hcm91cDo6X3VuaXF1ZSgpOiAnOwogICAgICAgIAogICAgICAgIHJldCA9IE5vZGVfR3JvdXAoKTsKICAgICAgICBpZiBzZWxmLklkIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXQuSWQgPSBzZWxmLklkOwogICAgCiAgICAgICAgaWYgc2VsZi5uYW1lKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldC5uYW1lKHNlbGYubmFtZSgpKTsKICAgIAogICAgICAgIGdjLmNvbGxlY3QoKTsKICAgICAgICByZXR1cm4gcmV0OwogICAgCiAgICBkZWYgX2Zyb21Eb2N1bWVudChzZWxmLCBvYmopOgogICAgICAgIF9fdG9TdHJpbmcgPSAnTm9kZV9Hcm91cDo6X2Zyb21Eb2N1bWVudCgpOiAnOwogICAgICAgIAogICAgICAgIGlmIG9iaiBpcyBOb25lOgogICAgICAgICAgICByZXR1cm4gc2VsZjsKCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIGJ5dGVzKToKICAgICAgICAgICAgb2JqID0gc3RyKG9iaiwgInV0Zi04Iik7CgogICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLCBzdHIpIG9yIHR5cGUob2JqKSBpcyBzdHI6CiAgICAgICAgICAgIGlmIHJlLm1hdGNoKHIiKCgoW0EtWmEtel17Myw5fTooPzpcL1wvKT8pKD86Wy07OiY9XCtcJCxcd10rQCk/W0EtWmEtejAtOS4tXSt8KD86d3d3LnxbLTs6Jj1cK1wkLFx3XStAKVtBLVphLXowLTkuLV0rKSgoPzpcL1tcK34lXC8uXHdcLV9dKik/XD8/KD86Wy1cKz0mOyVALlx3X10qKSM/KD86W1x3XSopKT8pIiwgb2JqKToKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBvYmogPSB1anNvbi5sb2Fkcyh1cmxsaWIzLlBvb2xNYW5hZ2VyKCkucmVxdWVzdCgnR0VUJywgb2JqKS5kYXRhLmRlY29kZSgndXRmLTgnKSk7CiAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgb2JqID0ge307CiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBvYmogPSB1anNvbi5sb2FkcyhvYmopOwogICAgICAgIAogICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLCBsaXN0KToKICAgICAgICAgICAgcmV0dXJuIFtOb2RlX0dyb3VwKCkuX2Zyb21Eb2N1bWVudChvKSBmb3IgbyBpbiBvYmpdOwogICAgICAgICAgICAKICAgICAgICBpZiBub3QgaXNpbnN0YW5jZShvYmosIChzdHIsIGJ5dGVzLCBkaWN0KSk6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAndW5oYW5kbGVkIHR5cGU6ICcgKyBzdHIodHlwZShvYmopKSk7CiAgICAgICAgICAgIHJldHVybiBvYmo7CgogICAgICAgIGlmICdJZCcgaW4gb2JqOgogICAgICAgICAgICBzZWxmLklkID0gb2JqWydJZCddOwoKICAgIAogICAgICAgIGlmICdhY3RpdmUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5hY3RpdmUob2JqWydhY3RpdmUnXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnZW5hYmxlZCcgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmVuYWJsZWQob2JqWydlbmFibGVkJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ2NvZGUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5jb2RlKG9ialsnY29kZSddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdvcmRlcicgaW4gb2JqOgogICAgICAgICAgICBzZWxmLm9yZGVyKG9ialsnb3JkZXInXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnZGF0ZScgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmRhdGUob2JqWydkYXRlJ10pOwogICAgICAgIAogICAgICAgICAgICBzZWxmLmRhdGUoZGF0ZXRpbWUuZGF0ZXRpbWUuZnJvbWlzb2Zvcm1hdChzZWxmLmRhdGUoKSkpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ25hbWUnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5uYW1lKG9ialsnbmFtZSddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdyZW1hcmsnIGluIG9iajoKICAgICAgICAgICAgc2VsZi5yZW1hcmsob2JqWydyZW1hcmsnXSk7CiAgICAgICAgCiAgICAgICAgICAgIHNlbGYucmVtYXJrKCB1YmluYXNjaWkuYTJiX2Jhc2U2NChzZWxmLnJlbWFyaygpKSApOwogICAgICAgICAgICBpZiBzZWxmLnJlbWFyaygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIHNlbGYucmVtYXJrKHNlbGYucmVtYXJrKCkuZGVjb2RlKCd1dGYtOCcpLnN0cmlwKCkpOwogICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgIHNlbGYucmVtYXJrKCk7CiAgICAgICAgICAgICAgICAgICAgI3ByaW50KF9fdG9TdHJpbmcgKyAicmVtYXJrIGV4Y2VwdGlvbiIsIHNlbGYucmVtYXJrKCkpOwogICAgICAgIAogICAgCgogICAgCiAgICAgICAgaWYgJ2dyb3VwX05vZGVzJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuZ3JvdXBfTm9kZXMoTm9kZSgpLl9mcm9tRG9jdW1lbnQob2JqWydncm91cF9Ob2RlcyddKSk7CiAgICAKCiAgICAgICAgZ2MuY29sbGVjdCgpOwogICAgICAgIHJldHVybiBzZWxmOwogICAgCiAgICBkZWYgX3RvRG9jdW1lbnQoc2VsZiwgYkpTT049Tm9uZSk6CiAgICAgICAgX190b1N0cmluZyA9ICdOb2RlX0dyb3VwOjpfdG9Eb2N1bWVudCgpOiAnOwoKICAgICAgICByZXQgPSB7fTsKICAgICAgICBpZiBzZWxmLklkIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbIklkIl0gPSBzZWxmLklkOwoKICAgIAogICAgICAgIGlmIHNlbGYuYWN0aXZlKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiYWN0aXZlIl0gPSBzZWxmLmFjdGl2ZSgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5lbmFibGVkKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiZW5hYmxlZCJdID0gc2VsZi5lbmFibGVkKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLmNvZGUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJjb2RlIl0gPSBzZWxmLmNvZGUoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYub3JkZXIoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJvcmRlciJdID0gc2VsZi5vcmRlcigpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5kYXRlKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiZGF0ZSJdID0gc2VsZi5kYXRlKCk7CiAgICAgICAgCiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UocmV0WyJkYXRlIl0sIGRhdGV0aW1lLmRhdGV0aW1lKToKICAgICAgICAgICAgICAgIHJldFsiZGF0ZSJdID0gcmV0WyJkYXRlIl0uaXNvZm9ybWF0KCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLm5hbWUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJuYW1lIl0gPSBzZWxmLm5hbWUoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYucmVtYXJrKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSBzZWxmLnJlbWFyaygpOwogICAgICAgIAogICAgICAgICAgICBpZiBpc2luc3RhbmNlKHJldFsicmVtYXJrIl0sIGRpY3QpOgogICAgICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IHVqc29uLmR1bXBzKHJldFsicmVtYXJrIl0pLmVuY29kZSgndXRmLTgnKTsKCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHJldFsicmVtYXJrIl0gPSAgdWJpbmFzY2lpLmIyYV9iYXNlNjQocmV0WyJyZW1hcmsiXSkuZGVjb2RlKCd1dGYtOCcpLnN0cmlwKCk7CiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhjZXB0aW9uIHdpdGggcmVtYXJrOiAiICsgcmV0WyJyZW1hcmsiXSk7CiAgICAgICAgCiAgICAKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYuZ3JvdXBfTm9kZXMoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJncm91cF9Ob2RlcyJdID0gW3RhLl90b0RvY3VtZW50KCkgZm9yIHRhIGluIHNlbGYuZ3JvdXBfTm9kZXMoKV07CiAgICAKCiAgICAgICAgaWYgYkpTT04gaXMgbm90IE5vbmU6CiAgICAgICAgICAgICNwcmludChfX3RvU3RyaW5nICsgIkdPVCBIRVJFIiwgdHlwZShyZXQpLCByZXQpOwogICAgICAgICAgICByZXQgPSB1anNvbi5kdW1wcyhyZXQpOwogICAgICAgIGdjLmNvbGxlY3QoKTsKICAgICAgICByZXR1cm4gcmV0OwoKICAgIAogICAgZGVmIHN0b3JlKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6CiAgICAgICAgX190b1N0cmluZyA9ICdOb2RlX0dyb3VwOjpzdG9yZSgpOiAnOwogICAgICAgIAogICAgICAgIGV2SlNPTiA9IE5vbmU7CgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIGV2SlNPTiA9IHVqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsKICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOgogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOwogICAgICAgIAoKICAgICAgICBhbnN3ZXIgPSBOb25lOwoKICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGlja3NfbXMoKSkrJ10uTm9kZV9Hcm91cC5zdG9yZSgpJykubWV0aG9kKCdzdG9yZScpLmNsYXNzTmFtZSgnTm9kZV9Hcm91cCcpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpOwogICAgICAgIAogICAgICAgIGdjLmNvbGxlY3QoKTsKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOwoKICAgICAgICAKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsKICAgICAgICAKICAgICAgICAgICAgYW5zd2VyID0gTm9kZV9Hcm91cCgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsKICAgICAgICAKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOwoKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOwogICAgICAgICAgICAKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOwoKICAgICAgICAgICAgCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOwogICAgICAgICAgICAKCiAgICAgICAgcmV0dXJuIGFuc3dlcjsKCiAgICAKICAgIGRlZiBmaW5kQWxsKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6CiAgICAgICAgX190b1N0cmluZyA9ICdOb2RlX0dyb3VwOjpmaW5kQWxsKCk6ICc7CiAgICAgICAgCiAgICAgICAgZXZKU09OID0gTm9uZTsKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgZXZKU09OID0gdWpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOwogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046CiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7CiAgICAgICAgCgogICAgICAgIGFuc3dlciA9IE5vbmU7CgogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aWNrc19tcygpKSsnXS5Ob2RlX0dyb3VwLmZpbmRBbGwoKScpLm1ldGhvZCgnZmluZEFsbCcpLmNsYXNzTmFtZSgnTm9kZV9Hcm91cCcpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpOwogICAgICAgIAogICAgICAgIGdjLmNvbGxlY3QoKTsKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOwoKICAgICAgICAKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsKICAgICAgICAKICAgICAgICAgICAgYW5zd2VyID0gTm9kZV9Hcm91cCgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsKICAgICAgICAKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOwoKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOwogICAgICAgICAgICAKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOwoKICAgICAgICAgICAgCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOwogICAgICAgICAgICAKCiAgICAgICAgcmV0dXJuIGFuc3dlcjsKCiAgICAKICAgIGRlZiBmaW5kKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6CiAgICAgICAgX190b1N0cmluZyA9ICdOb2RlX0dyb3VwOjpmaW5kKCk6ICc7CiAgICAgICAgCiAgICAgICAgZXZKU09OID0gTm9uZTsKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgZXZKU09OID0gdWpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOwogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046CiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7CiAgICAgICAgCgogICAgICAgIGFuc3dlciA9IE5vbmU7CgogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aWNrc19tcygpKSsnXS5Ob2RlX0dyb3VwLmZpbmQoKScpLm1ldGhvZCgnZmluZCcpLmNsYXNzTmFtZSgnTm9kZV9Hcm91cCcpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpOwogICAgICAgIAogICAgICAgIGdjLmNvbGxlY3QoKTsKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOwoKICAgICAgICAKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsKICAgICAgICAKICAgICAgICAgICAgYW5zd2VyID0gTm9kZV9Hcm91cCgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsKICAgICAgICAKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOwoKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOwogICAgICAgICAgICAKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOwoKICAgICAgICAgICAgCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOwogICAgICAgICAgICAKCiAgICAgICAgcmV0dXJuIGFuc3dlcjsKCiAgICAKCgpjbGFzcyBOb2RlX1R5cGUoKToKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBJZD1Ob25lLCBhY3RpdmU9Tm9uZSwgZW5hYmxlZD1Ob25lLCBjb2RlPU5vbmUsIG9yZGVyPU5vbmUsIGRhdGU9Tm9uZSwgbmFtZT1Ob25lLCByZW1hcms9Tm9uZSwgZHluYW1pYz1Ob25lKToKICAgICAgICBzdXBlcigpLl9faW5pdF9fKCk7CgogICAgICAgICNwcmludCgnTm9kZV9UeXBlOjpfX2luaXRfXygpJyk7CiAgICAgICAgaWYgSWQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHNlbGYuSWQgPSBJZDsKCiAgICAgICAgCiAgICAgICAgc2VsZi5hY3RpdmUoYWN0aXZlKTsKICAgICAgICBzZWxmLmVuYWJsZWQoZW5hYmxlZCk7CiAgICAgICAgc2VsZi5jb2RlKGNvZGUpOwogICAgICAgIHNlbGYub3JkZXIob3JkZXIpOwogICAgICAgIHNlbGYuZGF0ZShkYXRlKTsKICAgICAgICBzZWxmLm5hbWUobmFtZSk7CiAgICAgICAgc2VsZi5yZW1hcmsocmVtYXJrKTsKICAgICAgICBzZWxmLmR5bmFtaWMoZHluYW1pYyk7CiAgICAgICAgCiAgICBJZCA9IE5vbmU7CiAgICAKICAgIAogICAgIyBhY3RpdmU6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9hY3RpdmUgPSBOb25lOwogICAgZGVmIGFjdGl2ZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fYWN0aXZlID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2FjdGl2ZTsKICAgIAogICAgIyBlbmFibGVkOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfZW5hYmxlZCA9IE5vbmU7CiAgICBkZWYgZW5hYmxlZChzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fZW5hYmxlZCA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9lbmFibGVkOwogICAgCiAgICAjIGNvZGU6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9jb2RlID0gTm9uZTsKICAgIGRlZiBjb2RlKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9jb2RlID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2NvZGU7CiAgICAKICAgICMgb3JkZXI6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9vcmRlciA9IE5vbmU7CiAgICBkZWYgb3JkZXIoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX29yZGVyID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX29yZGVyOwogICAgCiAgICAjIGRhdGU6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9kYXRlID0gTm9uZTsKICAgIGRlZiBkYXRlKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9kYXRlID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2RhdGU7CiAgICAKICAgICMgbmFtZTogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX25hbWUgPSBOb25lOwogICAgZGVmIG5hbWUoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX25hbWUgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fbmFtZTsKICAgIAogICAgIyByZW1hcms6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9yZW1hcmsgPSBOb25lOwogICAgZGVmIHJlbWFyayhzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fcmVtYXJrID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3JlbWFyazsKICAgIAogICAgIyBkeW5hbWljOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfZHluYW1pYyA9IE5vbmU7CiAgICBkZWYgZHluYW1pYyhzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fZHluYW1pYyA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9keW5hbWljOwogICAgCiAgICAKICAgIAogICAgIyB0eXBlX05vZGVzOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfdHlwZV9Ob2RlcyA9IE5vbmU7CiAgICBkZWYgdHlwZV9Ob2RlcyhzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fdHlwZV9Ob2RlcyA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl90eXBlX05vZGVzOwogICAgCiAgICAKICAgIGRlZiBfdW5pcXVlKHNlbGYpOgogICAgICAgIF9fdG9TdHJpbmcgPSAnTm9kZV9UeXBlOjpfdW5pcXVlKCk6ICc7CiAgICAgICAgCiAgICAgICAgcmV0ID0gTm9kZV9UeXBlKCk7CiAgICAgICAgaWYgc2VsZi5JZCBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0LklkID0gc2VsZi5JZDsKICAgIAogICAgICAgIGlmIHNlbGYubmFtZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXQubmFtZShzZWxmLm5hbWUoKSk7CiAgICAKICAgICAgICBnYy5jb2xsZWN0KCk7CiAgICAgICAgcmV0dXJuIHJldDsKICAgIAogICAgZGVmIF9mcm9tRG9jdW1lbnQoc2VsZiwgb2JqKToKICAgICAgICBfX3RvU3RyaW5nID0gJ05vZGVfVHlwZTo6X2Zyb21Eb2N1bWVudCgpOiAnOwogICAgICAgIAogICAgICAgIGlmIG9iaiBpcyBOb25lOgogICAgICAgICAgICByZXR1cm4gc2VsZjsKCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIGJ5dGVzKToKICAgICAgICAgICAgb2JqID0gc3RyKG9iaiwgInV0Zi04Iik7CgogICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLCBzdHIpIG9yIHR5cGUob2JqKSBpcyBzdHI6CiAgICAgICAgICAgIGlmIHJlLm1hdGNoKHIiKCgoW0EtWmEtel17Myw5fTooPzpcL1wvKT8pKD86Wy07OiY9XCtcJCxcd10rQCk/W0EtWmEtejAtOS4tXSt8KD86d3d3LnxbLTs6Jj1cK1wkLFx3XStAKVtBLVphLXowLTkuLV0rKSgoPzpcL1tcK34lXC8uXHdcLV9dKik/XD8/KD86Wy1cKz0mOyVALlx3X10qKSM/KD86W1x3XSopKT8pIiwgb2JqKToKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBvYmogPSB1anNvbi5sb2Fkcyh1cmxsaWIzLlBvb2xNYW5hZ2VyKCkucmVxdWVzdCgnR0VUJywgb2JqKS5kYXRhLmRlY29kZSgndXRmLTgnKSk7CiAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgb2JqID0ge307CiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBvYmogPSB1anNvbi5sb2FkcyhvYmopOwogICAgICAgIAogICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLCBsaXN0KToKICAgICAgICAgICAgcmV0dXJuIFtOb2RlX1R5cGUoKS5fZnJvbURvY3VtZW50KG8pIGZvciBvIGluIG9ial07CiAgICAgICAgICAgIAogICAgICAgIGlmIG5vdCBpc2luc3RhbmNlKG9iaiwgKHN0ciwgYnl0ZXMsIGRpY3QpKToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICd1bmhhbmRsZWQgdHlwZTogJyArIHN0cih0eXBlKG9iaikpKTsKICAgICAgICAgICAgcmV0dXJuIG9iajsKCiAgICAgICAgaWYgJ0lkJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuSWQgPSBvYmpbJ0lkJ107CgogICAgCiAgICAgICAgaWYgJ2FjdGl2ZScgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmFjdGl2ZShvYmpbJ2FjdGl2ZSddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdlbmFibGVkJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuZW5hYmxlZChvYmpbJ2VuYWJsZWQnXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnY29kZScgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmNvZGUob2JqWydjb2RlJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ29yZGVyJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYub3JkZXIob2JqWydvcmRlciddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdkYXRlJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuZGF0ZShvYmpbJ2RhdGUnXSk7CiAgICAgICAgCiAgICAgICAgICAgIHNlbGYuZGF0ZShkYXRldGltZS5kYXRldGltZS5mcm9taXNvZm9ybWF0KHNlbGYuZGF0ZSgpKSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnbmFtZScgaW4gb2JqOgogICAgICAgICAgICBzZWxmLm5hbWUob2JqWyduYW1lJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ3JlbWFyaycgaW4gb2JqOgogICAgICAgICAgICBzZWxmLnJlbWFyayhvYmpbJ3JlbWFyayddKTsKICAgICAgICAKICAgICAgICAgICAgc2VsZi5yZW1hcmsoIHViaW5hc2NpaS5hMmJfYmFzZTY0KHNlbGYucmVtYXJrKCkpICk7CiAgICAgICAgICAgIGlmIHNlbGYucmVtYXJrKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5yZW1hcmsoc2VsZi5yZW1hcmsoKS5kZWNvZGUoJ3V0Zi04Jykuc3RyaXAoKSk7CiAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5yZW1hcmsoKTsKICAgICAgICAgICAgICAgICAgICAjcHJpbnQoX190b1N0cmluZyArICJyZW1hcmsgZXhjZXB0aW9uIiwgc2VsZi5yZW1hcmsoKSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnZHluYW1pYycgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmR5bmFtaWMob2JqWydkeW5hbWljJ10pOwogICAgICAgIAogICAgCgogICAgCiAgICAgICAgaWYgJ3R5cGVfTm9kZXMnIGluIG9iajoKICAgICAgICAgICAgc2VsZi50eXBlX05vZGVzKE5vZGUoKS5fZnJvbURvY3VtZW50KG9ialsndHlwZV9Ob2RlcyddKSk7CiAgICAKCiAgICAgICAgZ2MuY29sbGVjdCgpOwogICAgICAgIHJldHVybiBzZWxmOwogICAgCiAgICBkZWYgX3RvRG9jdW1lbnQoc2VsZiwgYkpTT049Tm9uZSk6CiAgICAgICAgX190b1N0cmluZyA9ICdOb2RlX1R5cGU6Ol90b0RvY3VtZW50KCk6ICc7CgogICAgICAgIHJldCA9IHt9OwogICAgICAgIGlmIHNlbGYuSWQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiSWQiXSA9IHNlbGYuSWQ7CgogICAgCiAgICAgICAgaWYgc2VsZi5hY3RpdmUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJhY3RpdmUiXSA9IHNlbGYuYWN0aXZlKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLmVuYWJsZWQoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJlbmFibGVkIl0gPSBzZWxmLmVuYWJsZWQoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYuY29kZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbImNvZGUiXSA9IHNlbGYuY29kZSgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5vcmRlcigpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbIm9yZGVyIl0gPSBzZWxmLm9yZGVyKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLmRhdGUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJkYXRlIl0gPSBzZWxmLmRhdGUoKTsKICAgICAgICAKICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShyZXRbImRhdGUiXSwgZGF0ZXRpbWUuZGF0ZXRpbWUpOgogICAgICAgICAgICAgICAgcmV0WyJkYXRlIl0gPSByZXRbImRhdGUiXS5pc29mb3JtYXQoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYubmFtZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbIm5hbWUiXSA9IHNlbGYubmFtZSgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5yZW1hcmsoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9IHNlbGYucmVtYXJrKCk7CiAgICAgICAgCiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UocmV0WyJyZW1hcmsiXSwgZGljdCk6CiAgICAgICAgICAgICAgICByZXRbInJlbWFyayJdID0gdWpzb24uZHVtcHMocmV0WyJyZW1hcmsiXSkuZW5jb2RlKCd1dGYtOCcpOwoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgcmV0WyJyZW1hcmsiXSA9ICB1YmluYXNjaWkuYjJhX2Jhc2U2NChyZXRbInJlbWFyayJdKS5kZWNvZGUoJ3V0Zi04Jykuc3RyaXAoKTsKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGNlcHRpb24gd2l0aCByZW1hcms6ICIgKyByZXRbInJlbWFyayJdKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYuZHluYW1pYygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbImR5bmFtaWMiXSA9IHNlbGYuZHluYW1pYygpOwogICAgICAgIAogICAgCiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLnR5cGVfTm9kZXMoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJ0eXBlX05vZGVzIl0gPSBbdGEuX3RvRG9jdW1lbnQoKSBmb3IgdGEgaW4gc2VsZi50eXBlX05vZGVzKCldOwogICAgCgogICAgICAgIGlmIGJKU09OIGlzIG5vdCBOb25lOgogICAgICAgICAgICAjcHJpbnQoX190b1N0cmluZyArICJHT1QgSEVSRSIsIHR5cGUocmV0KSwgcmV0KTsKICAgICAgICAgICAgcmV0ID0gdWpzb24uZHVtcHMocmV0KTsKICAgICAgICBnYy5jb2xsZWN0KCk7CiAgICAgICAgcmV0dXJuIHJldDsKCiAgICAKICAgIGRlZiBzdG9yZShzZWxmLCBfX2V2ZW50PU5vbmUpOgogICAgICAgIF9fdG9TdHJpbmcgPSAnTm9kZV9UeXBlOjpzdG9yZSgpOiAnOwogICAgICAgIAogICAgICAgIGV2SlNPTiA9IE5vbmU7CgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIGV2SlNPTiA9IHVqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsKICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOgogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOwogICAgICAgIAoKICAgICAgICBhbnN3ZXIgPSBOb25lOwoKICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGlja3NfbXMoKSkrJ10uTm9kZV9UeXBlLnN0b3JlKCknKS5tZXRob2QoJ3N0b3JlJykuY2xhc3NOYW1lKCdOb2RlX1R5cGUnKS5jYXJyaWVyKG5vZGUpLnNlbmRlcihub2RlKS5yZWNpcGllbnQobm9kZS5wYXJlbnQoKSk7CiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgX19yZXNwb25zZS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTsKICAgICAgICAKICAgICAgICBnYy5jb2xsZWN0KCk7CgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiIGhhbmRsaW5nIGV2ZW50WyIrX19ldmVudC5jb2RlKCkrIl0iKTsKCiAgICAgICAgCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiYSByZXNwb25zZSB0byBteSBldmVudCgiK19fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSsiKSBbIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyAiKCkuIiArIF9fZXZlbnQubWV0aG9kKCkgKyAiKCldIik7CiAgICAgICAgCiAgICAgICAgICAgIGFuc3dlciA9IE5vZGVfVHlwZSgpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsKICAgICAgICAKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOwoKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOwogICAgICAgICAgICAKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOwoKICAgICAgICAgICAgCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOwogICAgICAgICAgICAKCiAgICAgICAgcmV0dXJuIGFuc3dlcjsKCiAgICAKICAgIGRlZiBmaW5kQWxsKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6CiAgICAgICAgX190b1N0cmluZyA9ICdOb2RlX1R5cGU6OmZpbmRBbGwoKTogJzsKICAgICAgICAKICAgICAgICBldkpTT04gPSBOb25lOwoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBldkpTT04gPSB1anNvbi5sb2FkcyhfX2V2ZW50LnBheWxvYWQoKSk7CiAgICAgICAgICAgIGlmICdfX3RoaXMnIGluIGV2SlNPTjoKICAgICAgICAgICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChldkpTT05bJ19fdGhpcyddKTsKICAgICAgICAKCiAgICAgICAgYW5zd2VyID0gTm9uZTsKCiAgICAgICAgX19yZXNwb25zZSA9IEV2ZW50KCkuY29kZSgnWycrbm9kZS5jb2RlKCkrJ0AnK3N0cih0aW1lLnRpY2tzX21zKCkpKyddLk5vZGVfVHlwZS5maW5kQWxsKCknKS5tZXRob2QoJ2ZpbmRBbGwnKS5jbGFzc05hbWUoJ05vZGVfVHlwZScpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpOwogICAgICAgIAogICAgICAgIGdjLmNvbGxlY3QoKTsKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOwoKICAgICAgICAKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsKICAgICAgICAKICAgICAgICAgICAgYW5zd2VyID0gTm9kZV9UeXBlKCkuX2Zyb21Eb2N1bWVudChldkpTT04pOwogICAgICAgIAoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4ZWN1dGluZyBsb2NhbGx5Iik7CgoKCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmUgb3IgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgaWYgYW5zd2VyIGlzIG5vdCBOb25lOgogICAgICAgICAgICAKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKHsiX190aGlzIjogc2VsZi5fdG9Eb2N1bWVudCgpfSk7CgogICAgICAgICAgICAKICAgICAgICAgICAgX19yZXNwb25zZS50cmlnZ2VyKCk7CiAgICAgICAgICAgIAoKICAgICAgICByZXR1cm4gYW5zd2VyOwoKICAgIAogICAgZGVmIGZpbmQoc2VsZiwgX19ldmVudD1Ob25lKToKICAgICAgICBfX3RvU3RyaW5nID0gJ05vZGVfVHlwZTo6ZmluZCgpOiAnOwogICAgICAgIAogICAgICAgIGV2SlNPTiA9IE5vbmU7CgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIGV2SlNPTiA9IHVqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsKICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOgogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOwogICAgICAgIAoKICAgICAgICBhbnN3ZXIgPSBOb25lOwoKICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGlja3NfbXMoKSkrJ10uTm9kZV9UeXBlLmZpbmQoKScpLm1ldGhvZCgnZmluZCcpLmNsYXNzTmFtZSgnTm9kZV9UeXBlJykuY2Fycmllcihub2RlKS5zZW5kZXIobm9kZSkucmVjaXBpZW50KG5vZGUucGFyZW50KCkpOwogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIF9fcmVzcG9uc2UucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7CiAgICAgICAgCiAgICAgICAgZ2MuY29sbGVjdCgpOwoKCiAgICAgICAgbGFzdFVwZGF0ZSA9IHNlbGYuZGF0ZSgpOwogICAgICAgIHNlbGYuX2Zyb21Eb2N1bWVudChiYXNlX3VybCk7CgogICAgICAgIGlmIHNlbGYuZGF0ZSgpPmxhc3RVcGRhdGU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAibmV3ZXIgdmVyc2lvbjogIiArIHN0cihzZWxmLmRhdGUoKSkgKyAiLCByZWJvb3RpbmcuLi4iKTsKICAgICAgICAgICAgb3MuZXhlY2woc3lzLmV4ZWN1dGFibGUsIHN5cy5leGVjdXRhYmxlLCAqc3lzLmFyZ3YpOwoKICAgICAgICB0aW1lLnNsZWVwKDMwKTsKICAgICAgICByZXR1cm4gc2VsZi5maW5kKCk7CiAgICAgICAgCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgIiBoYW5kbGluZyBldmVudFsiK19fZXZlbnQuY29kZSgpKyJdIik7CgogICAgICAgIAogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmUgYW5kIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIG5vdCBOb25lOgogICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoIitfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkrIikgWyIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgIigpLiIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgIigpXSIpOwogICAgICAgIAogICAgICAgICAgICBhbnN3ZXIgPSBOb2RlX1R5cGUoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7CiAgICAgICAgCgoKICAgICAgICBpZiBfX2V2ZW50IGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KF9fdG9TdHJpbmcgKyAiZXhlY3V0aW5nIGxvY2FsbHkiKTsKCgoKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZSBvciBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBOb25lOgogICAgICAgICAgICBpZiBhbnN3ZXIgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgX19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoeyJfX3RoaXMiOiBzZWxmLl90b0RvY3VtZW50KCl9KTsKCiAgICAgICAgICAgIAogICAgICAgICAgICBfX3Jlc3BvbnNlLnRyaWdnZXIoKTsKICAgICAgICAgICAgCgogICAgICAgIHJldHVybiBhbnN3ZXI7CgogICAgCgoKY2xhc3MgTWFwcGluZygpOgogICAgZGVmIF9faW5pdF9fKHNlbGYsIElkPU5vbmUsIGFjdGl2ZT1Ob25lLCBlbmFibGVkPU5vbmUsIG9yZGVyPU5vbmUsIGNsYXNzTmFtZT1Ob25lLCBzY29wZT1Ob25lLCBjb250ZXh0PU5vbmUsIHNvdXJjZT1Ob25lLCB0YXJnZXQ9Tm9uZSwgb3BlcmF0b3I9Tm9uZSwgaW5TY3JpcHQ9Tm9uZSwgb3V0U2NyaXB0PU5vbmUsIHRvb2w9Tm9uZSwgZ3JvdXA9Tm9uZSwgdHlwZT1Ob25lKToKICAgICAgICBzdXBlcigpLl9faW5pdF9fKCk7CgogICAgICAgICNwcmludCgnTWFwcGluZzo6X19pbml0X18oKScpOwogICAgICAgIGlmIElkIGlzIG5vdCBOb25lOgogICAgICAgICAgICBzZWxmLklkID0gSWQ7CgogICAgICAgIAogICAgICAgIHNlbGYuYWN0aXZlKGFjdGl2ZSk7CiAgICAgICAgc2VsZi5lbmFibGVkKGVuYWJsZWQpOwogICAgICAgIHNlbGYub3JkZXIob3JkZXIpOwogICAgICAgIHNlbGYuY2xhc3NOYW1lKGNsYXNzTmFtZSk7CiAgICAgICAgc2VsZi5zY29wZShzY29wZSk7CiAgICAgICAgc2VsZi5jb250ZXh0KGNvbnRleHQpOwogICAgICAgIHNlbGYuc291cmNlKHNvdXJjZSk7CiAgICAgICAgc2VsZi50YXJnZXQodGFyZ2V0KTsKICAgICAgICBzZWxmLm9wZXJhdG9yKG9wZXJhdG9yKTsKICAgICAgICBzZWxmLmluU2NyaXB0KGluU2NyaXB0KTsKICAgICAgICBzZWxmLm91dFNjcmlwdChvdXRTY3JpcHQpOwogICAgICAgIHNlbGYudG9vbCh0b29sKTsKICAgICAgICBzZWxmLmdyb3VwKGdyb3VwKTsKICAgICAgICBzZWxmLnR5cGUodHlwZSk7CiAgICAgICAgCiAgICBJZCA9IE5vbmU7CiAgICAKICAgIAogICAgIyBhY3RpdmU6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9hY3RpdmUgPSBOb25lOwogICAgZGVmIGFjdGl2ZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fYWN0aXZlID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2FjdGl2ZTsKICAgIAogICAgIyBlbmFibGVkOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfZW5hYmxlZCA9IE5vbmU7CiAgICBkZWYgZW5hYmxlZChzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fZW5hYmxlZCA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9lbmFibGVkOwogICAgCiAgICAjIG9yZGVyOiBHZXR0ZXJzIGFuZCBTZXR0ZXJzCiAgICBfb3JkZXIgPSBOb25lOwogICAgZGVmIG9yZGVyKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9vcmRlciA9IGFyZ3NbMF07CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9vcmRlcjsKICAgIAogICAgIyBjbGFzc05hbWU6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9jbGFzc05hbWUgPSBOb25lOwogICAgZGVmIGNsYXNzTmFtZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fY2xhc3NOYW1lID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2NsYXNzTmFtZTsKICAgIAogICAgIyBzY29wZTogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX3Njb3BlID0gTm9uZTsKICAgIGRlZiBzY29wZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fc2NvcGUgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fc2NvcGU7CiAgICAKICAgICMgY29udGV4dDogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX2NvbnRleHQgPSBOb25lOwogICAgZGVmIGNvbnRleHQoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2NvbnRleHQgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fY29udGV4dDsKICAgIAogICAgIyBzb3VyY2U6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9zb3VyY2UgPSBOb25lOwogICAgZGVmIHNvdXJjZShzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fc291cmNlID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3NvdXJjZTsKICAgIAogICAgIyB0YXJnZXQ6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF90YXJnZXQgPSBOb25lOwogICAgZGVmIHRhcmdldChzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fdGFyZ2V0ID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3RhcmdldDsKICAgIAogICAgIyBvcGVyYXRvcjogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX29wZXJhdG9yID0gTm9uZTsKICAgIGRlZiBvcGVyYXRvcihzZWxmLCAqYXJncyk6CiAgICAgICAgaWYgYXJnczoKICAgICAgICAgICAgc2VsZi5fb3BlcmF0b3IgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fb3BlcmF0b3I7CiAgICAKICAgICMgaW5TY3JpcHQ6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9pblNjcmlwdCA9IE5vbmU7CiAgICBkZWYgaW5TY3JpcHQoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2luU2NyaXB0ID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2luU2NyaXB0OwogICAgCiAgICAjIG91dFNjcmlwdDogR2V0dGVycyBhbmQgU2V0dGVycwogICAgX291dFNjcmlwdCA9IE5vbmU7CiAgICBkZWYgb3V0U2NyaXB0KHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl9vdXRTY3JpcHQgPSBhcmdzWzBdOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fb3V0U2NyaXB0OwogICAgCiAgICAjIHRvb2w6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF90b29sID0gTm9uZTsKICAgIGRlZiB0b29sKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl90b29sID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3Rvb2w7CiAgICAKICAgICMgZ3JvdXA6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF9ncm91cCA9IE5vbmU7CiAgICBkZWYgZ3JvdXAoc2VsZiwgKmFyZ3MpOgogICAgICAgIGlmIGFyZ3M6CiAgICAgICAgICAgIHNlbGYuX2dyb3VwID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2dyb3VwOwogICAgCiAgICAjIHR5cGU6IEdldHRlcnMgYW5kIFNldHRlcnMKICAgIF90eXBlID0gTm9uZTsKICAgIGRlZiB0eXBlKHNlbGYsICphcmdzKToKICAgICAgICBpZiBhcmdzOgogICAgICAgICAgICBzZWxmLl90eXBlID0gYXJnc1swXTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3R5cGU7CiAgICAKICAgIAogICAgCiAgICAKICAgIGRlZiBfdW5pcXVlKHNlbGYpOgogICAgICAgIF9fdG9TdHJpbmcgPSAnTWFwcGluZzo6X3VuaXF1ZSgpOiAnOwogICAgICAgIAogICAgICAgIHJldCA9IE1hcHBpbmcoKTsKICAgICAgICBpZiBzZWxmLklkIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXQuSWQgPSBzZWxmLklkOwogICAgCiAgICAgICAgZ2MuY29sbGVjdCgpOwogICAgICAgIHJldHVybiByZXQ7CiAgICAKICAgIGRlZiBfZnJvbURvY3VtZW50KHNlbGYsIG9iaik6CiAgICAgICAgX190b1N0cmluZyA9ICdNYXBwaW5nOjpfZnJvbURvY3VtZW50KCk6ICc7CiAgICAgICAgCiAgICAgICAgaWYgb2JqIGlzIE5vbmU6CiAgICAgICAgICAgIHJldHVybiBzZWxmOwoKICAgICAgICBpZiBpc2luc3RhbmNlKG9iaiwgYnl0ZXMpOgogICAgICAgICAgICBvYmogPSBzdHIob2JqLCAidXRmLTgiKTsKCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIHN0cikgb3IgdHlwZShvYmopIGlzIHN0cjoKICAgICAgICAgICAgaWYgcmUubWF0Y2gociIoKChbQS1aYS16XXszLDl9Oig/OlwvXC8pPykoPzpbLTs6Jj1cK1wkLFx3XStAKT9bQS1aYS16MC05Li1dK3woPzp3d3cufFstOzomPVwrXCQsXHddK0ApW0EtWmEtejAtOS4tXSspKCg/OlwvW1wrfiVcLy5cd1wtX10qKT9cPz8oPzpbLVwrPSY7JUAuXHdfXSopIz8oPzpbXHddKikpPykiLCBvYmopOgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIG9iaiA9IHVqc29uLmxvYWRzKHVybGxpYjMuUG9vbE1hbmFnZXIoKS5yZXF1ZXN0KCdHRVQnLCBvYmopLmRhdGEuZGVjb2RlKCd1dGYtOCcpKTsKICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICBvYmogPSB7fTsKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIG9iaiA9IHVqc29uLmxvYWRzKG9iaik7CiAgICAgICAgCiAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosIGxpc3QpOgogICAgICAgICAgICByZXR1cm4gW01hcHBpbmcoKS5fZnJvbURvY3VtZW50KG8pIGZvciBvIGluIG9ial07CiAgICAgICAgICAgIAogICAgICAgIGlmIG5vdCBpc2luc3RhbmNlKG9iaiwgKHN0ciwgYnl0ZXMsIGRpY3QpKToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICd1bmhhbmRsZWQgdHlwZTogJyArIHN0cih0eXBlKG9iaikpKTsKICAgICAgICAgICAgcmV0dXJuIG9iajsKCiAgICAgICAgaWYgJ0lkJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuSWQgPSBvYmpbJ0lkJ107CgogICAgCiAgICAgICAgaWYgJ2FjdGl2ZScgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmFjdGl2ZShvYmpbJ2FjdGl2ZSddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdlbmFibGVkJyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuZW5hYmxlZChvYmpbJ2VuYWJsZWQnXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnb3JkZXInIGluIG9iajoKICAgICAgICAgICAgc2VsZi5vcmRlcihvYmpbJ29yZGVyJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ2NsYXNzTmFtZScgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmNsYXNzTmFtZShvYmpbJ2NsYXNzTmFtZSddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdzY29wZScgaW4gb2JqOgogICAgICAgICAgICBzZWxmLnNjb3BlKG9ialsnc2NvcGUnXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnY29udGV4dCcgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmNvbnRleHQob2JqWydjb250ZXh0J10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ3NvdXJjZScgaW4gb2JqOgogICAgICAgICAgICBzZWxmLnNvdXJjZShvYmpbJ3NvdXJjZSddKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICd0YXJnZXQnIGluIG9iajoKICAgICAgICAgICAgc2VsZi50YXJnZXQob2JqWyd0YXJnZXQnXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAnb3BlcmF0b3InIGluIG9iajoKICAgICAgICAgICAgc2VsZi5vcGVyYXRvcihvYmpbJ29wZXJhdG9yJ10pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ2luU2NyaXB0JyBpbiBvYmo6CiAgICAgICAgICAgIHNlbGYuaW5TY3JpcHQob2JqWydpblNjcmlwdCddKTsKICAgICAgICAKICAgICAgICAgICAgc2VsZi5pblNjcmlwdCggdWJpbmFzY2lpLmEyYl9iYXNlNjQoc2VsZi5pblNjcmlwdCgpKSApOwogICAgICAgICAgICBpZiBzZWxmLmluU2NyaXB0KCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5pblNjcmlwdChzZWxmLmluU2NyaXB0KCkuZGVjb2RlKCd1dGYtOCcpLnN0cmlwKCkpOwogICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgIHNlbGYuaW5TY3JpcHQoKTsKICAgICAgICAgICAgICAgICAgICAjcHJpbnQoX190b1N0cmluZyArICJpblNjcmlwdCBleGNlcHRpb24iLCBzZWxmLmluU2NyaXB0KCkpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgJ291dFNjcmlwdCcgaW4gb2JqOgogICAgICAgICAgICBzZWxmLm91dFNjcmlwdChvYmpbJ291dFNjcmlwdCddKTsKICAgICAgICAKICAgICAgICAgICAgc2VsZi5vdXRTY3JpcHQoIHViaW5hc2NpaS5hMmJfYmFzZTY0KHNlbGYub3V0U2NyaXB0KCkpICk7CiAgICAgICAgICAgIGlmIHNlbGYub3V0U2NyaXB0KCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5vdXRTY3JpcHQoc2VsZi5vdXRTY3JpcHQoKS5kZWNvZGUoJ3V0Zi04Jykuc3RyaXAoKSk7CiAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5vdXRTY3JpcHQoKTsKICAgICAgICAgICAgICAgICAgICAjcHJpbnQoX190b1N0cmluZyArICJvdXRTY3JpcHQgZXhjZXB0aW9uIiwgc2VsZi5vdXRTY3JpcHQoKSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAndG9vbCcgaW4gb2JqOgogICAgICAgICAgICBzZWxmLnRvb2woVG9vbCgpLl9mcm9tRG9jdW1lbnQob2JqWyd0b29sJ10pKTsKICAgICAgICAKICAgIAogICAgICAgIGlmICdncm91cCcgaW4gb2JqOgogICAgICAgICAgICBzZWxmLmdyb3VwKENvbmZpZ19Hcm91cCgpLl9mcm9tRG9jdW1lbnQob2JqWydncm91cCddKSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiAndHlwZScgaW4gb2JqOgogICAgICAgICAgICBzZWxmLnR5cGUoVG9vbF9UeXBlKCkuX2Zyb21Eb2N1bWVudChvYmpbJ3R5cGUnXSkpOwogICAgICAgIAogICAgCgogICAgCgogICAgICAgIGdjLmNvbGxlY3QoKTsKICAgICAgICByZXR1cm4gc2VsZjsKICAgIAogICAgZGVmIF90b0RvY3VtZW50KHNlbGYsIGJKU09OPU5vbmUpOgogICAgICAgIF9fdG9TdHJpbmcgPSAnTWFwcGluZzo6X3RvRG9jdW1lbnQoKTogJzsKCiAgICAgICAgcmV0ID0ge307CiAgICAgICAgaWYgc2VsZi5JZCBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJJZCJdID0gc2VsZi5JZDsKCiAgICAKICAgICAgICBpZiBzZWxmLmFjdGl2ZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbImFjdGl2ZSJdID0gc2VsZi5hY3RpdmUoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYuZW5hYmxlZCgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbImVuYWJsZWQiXSA9IHNlbGYuZW5hYmxlZCgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5vcmRlcigpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbIm9yZGVyIl0gPSBzZWxmLm9yZGVyKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLmNsYXNzTmFtZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbImNsYXNzTmFtZSJdID0gc2VsZi5jbGFzc05hbWUoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYuc2NvcGUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJzY29wZSJdID0gc2VsZi5zY29wZSgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5jb250ZXh0KCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiY29udGV4dCJdID0gc2VsZi5jb250ZXh0KCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLnNvdXJjZSgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbInNvdXJjZSJdID0gc2VsZi5zb3VyY2UoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYudGFyZ2V0KCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsidGFyZ2V0Il0gPSBzZWxmLnRhcmdldCgpOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi5vcGVyYXRvcigpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbIm9wZXJhdG9yIl0gPSBzZWxmLm9wZXJhdG9yKCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLmluU2NyaXB0KCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsiaW5TY3JpcHQiXSA9IHNlbGYuaW5TY3JpcHQoKTsKICAgICAgICAKICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShyZXRbImluU2NyaXB0Il0sIGRpY3QpOgogICAgICAgICAgICAgICAgcmV0WyJpblNjcmlwdCJdID0gdWpzb24uZHVtcHMocmV0WyJpblNjcmlwdCJdKS5lbmNvZGUoJ3V0Zi04Jyk7CgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICByZXRbImluU2NyaXB0Il0gPSAgdWJpbmFzY2lpLmIyYV9iYXNlNjQocmV0WyJpblNjcmlwdCJdKS5kZWNvZGUoJ3V0Zi04Jykuc3RyaXAoKTsKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGNlcHRpb24gd2l0aCBpblNjcmlwdDogIiArIHJldFsiaW5TY3JpcHQiXSk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLm91dFNjcmlwdCgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICByZXRbIm91dFNjcmlwdCJdID0gc2VsZi5vdXRTY3JpcHQoKTsKICAgICAgICAKICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShyZXRbIm91dFNjcmlwdCJdLCBkaWN0KToKICAgICAgICAgICAgICAgIHJldFsib3V0U2NyaXB0Il0gPSB1anNvbi5kdW1wcyhyZXRbIm91dFNjcmlwdCJdKS5lbmNvZGUoJ3V0Zi04Jyk7CgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICByZXRbIm91dFNjcmlwdCJdID0gIHViaW5hc2NpaS5iMmFfYmFzZTY0KHJldFsib3V0U2NyaXB0Il0pLmRlY29kZSgndXRmLTgnKS5zdHJpcCgpOwogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICBwcmludChfX3RvU3RyaW5nICsgImV4Y2VwdGlvbiB3aXRoIG91dFNjcmlwdDogIiArIHJldFsib3V0U2NyaXB0Il0pOwogICAgICAgIAogICAgCiAgICAgICAgaWYgc2VsZi50b29sKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldFsidG9vbCJdID0gc2VsZi50b29sKCkuX3RvRG9jdW1lbnQoKTsKICAgICAgICAKICAgIAogICAgICAgIGlmIHNlbGYuZ3JvdXAoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJncm91cCJdID0gc2VsZi5ncm91cCgpLl90b0RvY3VtZW50KCk7CiAgICAgICAgCiAgICAKICAgICAgICBpZiBzZWxmLnR5cGUoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0WyJ0eXBlIl0gPSBzZWxmLnR5cGUoKS5fdG9Eb2N1bWVudCgpOwogICAgICAgIAogICAgCiAgICAgICAgCiAgICAKCiAgICAgICAgaWYgYkpTT04gaXMgbm90IE5vbmU6CiAgICAgICAgICAgICNwcmludChfX3RvU3RyaW5nICsgIkdPVCBIRVJFIiwgdHlwZShyZXQpLCByZXQpOwogICAgICAgICAgICByZXQgPSB1anNvbi5kdW1wcyhyZXQpOwogICAgICAgIGdjLmNvbGxlY3QoKTsKICAgICAgICByZXR1cm4gcmV0OwoKICAgIAogICAgZGVmIHN0b3JlKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6CiAgICAgICAgX190b1N0cmluZyA9ICdNYXBwaW5nOjpzdG9yZSgpOiAnOwogICAgICAgIAogICAgICAgIGV2SlNPTiA9IE5vbmU7CgogICAgICAgIGlmIF9fZXZlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIGV2SlNPTiA9IHVqc29uLmxvYWRzKF9fZXZlbnQucGF5bG9hZCgpKTsKICAgICAgICAgICAgaWYgJ19fdGhpcycgaW4gZXZKU09OOgogICAgICAgICAgICAgICAgc2VsZi5fZnJvbURvY3VtZW50KGV2SlNPTlsnX190aGlzJ10pOwogICAgICAgIAoKICAgICAgICBhbnN3ZXIgPSBOb25lOwoKICAgICAgICBfX3Jlc3BvbnNlID0gRXZlbnQoKS5jb2RlKCdbJytub2RlLmNvZGUoKSsnQCcrc3RyKHRpbWUudGlja3NfbXMoKSkrJ10uTWFwcGluZy5zdG9yZSgpJykubWV0aG9kKCdzdG9yZScpLmNsYXNzTmFtZSgnTWFwcGluZycpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpOwogICAgICAgIAogICAgICAgIGdjLmNvbGxlY3QoKTsKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOwoKICAgICAgICAKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsKICAgICAgICAKICAgICAgICAgICAgYW5zd2VyID0gTWFwcGluZygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsKICAgICAgICAKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOwoKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOwogICAgICAgICAgICAKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOwoKICAgICAgICAgICAgCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOwogICAgICAgICAgICAKCiAgICAgICAgcmV0dXJuIGFuc3dlcjsKCiAgICAKICAgIGRlZiBmaW5kQWxsKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6CiAgICAgICAgX190b1N0cmluZyA9ICdNYXBwaW5nOjpmaW5kQWxsKCk6ICc7CiAgICAgICAgCiAgICAgICAgZXZKU09OID0gTm9uZTsKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgZXZKU09OID0gdWpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOwogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046CiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7CiAgICAgICAgCgogICAgICAgIGFuc3dlciA9IE5vbmU7CgogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aWNrc19tcygpKSsnXS5NYXBwaW5nLmZpbmRBbGwoKScpLm1ldGhvZCgnZmluZEFsbCcpLmNsYXNzTmFtZSgnTWFwcGluZycpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpOwogICAgICAgIAogICAgICAgIGdjLmNvbGxlY3QoKTsKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOwoKICAgICAgICAKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsKICAgICAgICAKICAgICAgICAgICAgYW5zd2VyID0gTWFwcGluZygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsKICAgICAgICAKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOwoKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOwogICAgICAgICAgICAKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOwoKICAgICAgICAgICAgCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOwogICAgICAgICAgICAKCiAgICAgICAgcmV0dXJuIGFuc3dlcjsKCiAgICAKICAgIGRlZiBmaW5kKHNlbGYsIF9fZXZlbnQ9Tm9uZSk6CiAgICAgICAgX190b1N0cmluZyA9ICdNYXBwaW5nOjpmaW5kKCk6ICc7CiAgICAgICAgCiAgICAgICAgZXZKU09OID0gTm9uZTsKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZToKICAgICAgICAgICAgZXZKU09OID0gdWpzb24ubG9hZHMoX19ldmVudC5wYXlsb2FkKCkpOwogICAgICAgICAgICBpZiAnX190aGlzJyBpbiBldkpTT046CiAgICAgICAgICAgICAgICBzZWxmLl9mcm9tRG9jdW1lbnQoZXZKU09OWydfX3RoaXMnXSk7CiAgICAgICAgCgogICAgICAgIGFuc3dlciA9IE5vbmU7CgogICAgICAgIF9fcmVzcG9uc2UgPSBFdmVudCgpLmNvZGUoJ1snK25vZGUuY29kZSgpKydAJytzdHIodGltZS50aWNrc19tcygpKSsnXS5NYXBwaW5nLmZpbmQoKScpLm1ldGhvZCgnZmluZCcpLmNsYXNzTmFtZSgnTWFwcGluZycpLmNhcnJpZXIobm9kZSkuc2VuZGVyKG5vZGUpLnJlY2lwaWVudChub2RlLnBhcmVudCgpKTsKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBfX3Jlc3BvbnNlLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpOwogICAgICAgIAogICAgICAgIGdjLmNvbGxlY3QoKTsKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBub3QgTm9uZSBhbmQgX19ldmVudC5yZXNwb25zZVRvKCkgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICIgaGFuZGxpbmcgZXZlbnRbIitfX2V2ZW50LmNvZGUoKSsiXSIpOwoKICAgICAgICAKICAgICAgICBpZiBfX2V2ZW50IGlzIG5vdCBOb25lIGFuZCBfX2V2ZW50LnJlc3BvbnNlVG8oKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KCIrX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpKyIpIFsiICsgX19ldmVudC5jbGFzc05hbWUoKSArICIoKS4iICsgX19ldmVudC5tZXRob2QoKSArICIoKV0iKTsKICAgICAgICAKICAgICAgICAgICAgYW5zd2VyID0gTWFwcGluZygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTsKICAgICAgICAKCgogICAgICAgIGlmIF9fZXZlbnQgaXMgTm9uZToKICAgICAgICAgICAgcHJpbnQoX190b1N0cmluZyArICJleGVjdXRpbmcgbG9jYWxseSIpOwoKCgoKCiAgICAgICAgaWYgX19ldmVudCBpcyBOb25lIG9yIF9fZXZlbnQucmVzcG9uc2VUbygpIGlzIE5vbmU6CiAgICAgICAgICAgIGlmIGFuc3dlciBpcyBub3QgTm9uZToKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpOwogICAgICAgICAgICAKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIF9fcmVzcG9uc2UucGF5bG9hZCh7Il9fdGhpcyI6IHNlbGYuX3RvRG9jdW1lbnQoKX0pOwoKICAgICAgICAgICAgCiAgICAgICAgICAgIF9fcmVzcG9uc2UudHJpZ2dlcigpOwogICAgICAgICAgICAKCiAgICAgICAgcmV0dXJuIGFuc3dlcjsKCiAgICAKCgoKCgogICAgCiMjIyMjIyMjIyMjIFdJRkkgQ29ubmVjdGlvbiAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwpwcmludCgnbWFpbigpJywgIkNvbm5lY3RpbmcgdG8gV2lGaS4uLiIsIGVuZD0iIik7Cm5ldF9pZiA9IG5ldHdvcmsuV0xBTihuZXR3b3JrLlNUQV9JRik7Cm5ldF9pZi5hY3RpdmUoVHJ1ZSk7Cm5ldF9pZi5jb25uZWN0KCdXb2t3aS1HVUVTVCcsICcnKTsKd2hpbGUgbm90IG5ldF9pZi5pc2Nvbm5lY3RlZCgpOgogICAgdGltZS5zbGVlcCgwLjEpOwogICAgcHJpbnQoIi4iLCBlbmQ9IiIpOwoKbmNvZGUgPSB1YmluYXNjaWkuaGV4bGlmeShuZXRfaWYuY29uZmlnKCdtYWMnKSkuZGVjb2RlKCk7CnByaW50KCJEb25lIik7CiMjIyMjIyMjIyMjIFdJRkkgQ29ubmVjdGlvbiAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgCgpub2RlID0gTm9kZShjb2RlPW5jb2RlLCBwYXJlbnQ9Tm9kZShjb2RlPSdhcGlzZXJ2ZXIvZXNwdGVzdC9tYXN0ZXInKSk7CgoKIyMjIyMjIyMjIyMgTVFUVCBDb25uZWN0aW9uICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCnByaW50KCdtYWluKCknLCAiQ29ubmVjdGluZyB0byBNUVRUIHNlcnZlciIsICIuLi4gIiwgZW5kPSIiKTsKbXF0dF90b3BpYyA9ICdhcGlzZXJ2ZXIvZXNwdGVzdCc7CgptcXR0X2NsaWVudCA9IHVtcXR0LnNpbXBsZS5NUVRUQ2xpZW50KG1xdHRfdG9waWMrJy8nK25vZGUuY29kZSgpLCAndGVzdC5tb3NxdWl0dG8ub3JnJywgdXNlcj0nJywgcGFzc3dvcmQ9JycpOwptcXR0X2NsaWVudC5zZXRfY2FsbGJhY2sobGFtYmRhIHRvcGljLCBtc2cgOiBFdmVudCgpLl9mcm9tRG9jdW1lbnQobXNnKS5wcm9jZXNzKCkpOwptcXR0X2NsaWVudC5jb25uZWN0KCk7CgoKbXF0dF9jbGllbnQuc3Vic2NyaWJlKG1xdHRfdG9waWMpOwpwcmludCgiQ29ubmVjdGVkISIpOwojIyMjIyMjIyMjIyBNUVRUIENvbm5lY3Rpb24gIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKCgoKCm5vZGUuc3RvcmUoKTsKCnByaW50KCdtYWluKCknLCAnbG9vcGluZyBmb3IgbXF0dCBldmVudHMnKTsKCndoaWxlIFRydWU6CiAgICBtcXR0X2NsaWVudC53YWl0X21zZygpOwogICAgdGltZS5zbGVlcCgxKTsKCgo=",
	"__keys": ["name"],
	"__trMap": []
}