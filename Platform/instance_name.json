{
	"Id": "01977f5ddc1a769ab9468b77aaa6ad2f",
	"code": "instance_name",
	"date": "2025-06-17T19:29:07.098Z",
	"name": "SnMQTT",
	"remark": "W3siYWN0aXZlIjp0cnVlLCJhY2Nlc3MiOiJwYWNrYWdlX3ByaXZhdGUiLCJjYWxsZXJfYWNjZXNzIjpudWxsLCJzeXNfbmFtZSI6InBsYXRmb3JtbWFuYWdlcl9BZ2VuZGFfSXRlbSIsImFwaV9uYW1lIjoieF83ODYxMV9wbGF0Zm9ybV8wLnBsYXRmb3JtbWFuYWdlcl9BZ2VuZGFfSXRlbSIsIm5hbWUiOiJwbGF0Zm9ybW1hbmFnZXJfQWdlbmRhX0l0ZW0iLCJzY3JpcHQiOiJjbGFzcyBwbGF0Zm9ybW1hbmFnZXJfQWdlbmRhX0l0ZW0ge1xuXHRjb25zdHJ1Y3RvcihpZCkge1xuXHRcdHVuZGVmaW5lZFxuXHRcdHRoaXMuSWQgPSBpZDtcblx0XHR0aGlzLl9fbW9kdWxlID0gXCJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwicGxhdGZvcm1tYW5hZ2VyX0FnZW5kYV9JdGVtXCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJwbGF0Zm9ybW1hbmFnZXJcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInBsYXRmb3JtbWFuYWdlclwiO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWdlbmRhX0l0ZW0uYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBZ2VuZGFfSXRlbS5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWdlbmRhX0l0ZW0uY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFnZW5kYV9JdGVtLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFnZW5kYV9JdGVtLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly9ncy5pbmZvKFwiQWdlbmRhX0l0ZW0uZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFnZW5kYV9JdGVtLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBZ2VuZGFfSXRlbS5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFnZW5kYV9JdGVtLmFnZW5kYSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFnZW5kYSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYWdlbmRhID0gdjtcblx0XHRcdHRoaXMuX2FnZW5kYV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hZ2VuZGE7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQWdlbmRhX0l0ZW0ucmVxdWlyZW1lbnQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZXF1aXJlbWVudCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVxdWlyZW1lbnQgPSB2O1xuXHRcdFx0dGhpcy5fcmVxdWlyZW1lbnRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVxdWlyZW1lbnQ7XG5cdFx0fVxuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2NvZGUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3JlbWFyaycgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodGhpcy5fYWdlbmRhKSByZXQgKz0gLyoodGhpcy5fYWdlbmRhX2Nvb3AgfHwgJz0nKSArICovIHRoaXMuYWdlbmRhKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ2FnZW5kYS4nKTtcblxuXHRcdGlmICh0aGlzLl9yZXF1aXJlbWVudCkgcmV0ICs9IC8qKHRoaXMuX3JlcXVpcmVtZW50X2Nvb3AgfHwgJz0nKSArICovIHRoaXMucmVxdWlyZW1lbnQoKS5fdG9FUXVlcnkoc1BhdGggKyAncmVxdWlyZW1lbnQuJyk7XG5cblx0XHRncy5pbmZvKFwiQWdlbmRhX0l0ZW0uX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSByZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHRncy5pbmZvKFwiQWdlbmRhX0l0ZW0uX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXG5cdFx0c3dpdGNoIChtZXRob2QpIHtcblxuXHRcdFx0Y2FzZSBcInN0b3JlXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuc3RvcmUoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRBbGxcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHRncy5pbmZvKFwiQWdlbmRhX0l0ZW0uX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpczsgLy8gdGVzdFxuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBwbGF0Zm9ybW1hbmFnZXJfQWdlbmRhX0l0ZW0oKS5fZnJvbURvY3VtZW50KG8pKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKG9iaikgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHR0cnkge1xuXHRcdFx0XHRvYmogPSBKU09OLnBhcnNlKG9iaik7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHQvKmdzLmluZm8oXCJBZ2VuZGFfSXRlbS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0XHR9O1xuXHRcdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdFx0b2JqID0gX29iajtcblx0XHRcdH1cblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdFx0XHRpZiAob2JqLmdldFRhYmxlTmFtZSgpID09ICdlY2NfcXVldWUnICYmIFwiQWdlbmRhX0l0ZW1cIiAhPSAnZWNjX3F1ZXVlJyAmJiBvYmouc291cmNlID09IFwiQWdlbmRhX0l0ZW1cIikge1xuXHRcdFx0XHRcdFx0b2JqLnN0YXRlID0gXCJwcm9jZXNzaW5nXCI7XG5cdFx0XHRcdFx0XHRvYmoudXBkYXRlKCk7XG5cblx0XHRcdFx0XHRcdGxldCByZXNwID0gbmV3IEdsaWRlUmVjb3JkKCdlY2NfcXVldWUnKTtcblx0XHRcdFx0XHRcdHJlc3AucmVzcG9uc2VfdG8gPSBvYmouc3lzX2lkO1xuXHRcdFx0XHRcdFx0cmVzcC5xdWV1ZSA9ICdvdXRwdXQnO1xuXHRcdFx0XHRcdFx0cmVzcC5hZ2VudCA9IG9iai5hZ2VudDtcblx0XHRcdFx0XHRcdHJlc3AudG9waWMgPSBvYmoudG9waWM7XG5cdFx0XHRcdFx0XHRyZXNwLm5hbWUgPSBvYmoubmFtZTtcblx0XHRcdFx0XHRcdHJlc3Auc291cmNlID0gb2JqLnNvdXJjZTtcblx0XHRcdFx0XHRcdHJlc3AuZnJvbV9ob3N0ID0gb2JqLmFnZW50X2NvcnJlbGF0b3I7XG5cdFx0XHRcdFx0XHRyZXNwLmFnZW50X2NvcnJlbGF0b3IgPSBvYmouZnJvbV9ob3N0O1xuXG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gbmV3IHBsYXRmb3JtbWFuYWdlcl9BZ2VuZGFfSXRlbSgpLl9mcm9tRG9jdW1lbnQoKS5faW52b2tlKG9iai5uYW1lLnRvU3RyaW5nKCksIG9iai5wYXlsb2FkLnRvU3RyaW5nKCkpO1xuXHRcdFx0XHRcdFx0aWYgKEFycmF5LmlzQXJyYXkocmV0KSkge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByZXQubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gKHIgJiYgdHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nKSA/IHIuX3RvRG9jdW1lbnQoKSA6IHI7XG5cdFx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmIChyZXQgJiYgdHlwZW9mKHJldC5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gcmV0Ll90b0RvY3VtZW50KCk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXNwLnBheWxvYWQgPSBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpO1xuXG5cdFx0XHRcdFx0XHRyZXNwLmluc2VydCgpO1xuXG5cdFx0XHRcdFx0XHRvYmouc3RhdGUgPSBcInByb2Nlc3NlZFwiO1xuXHRcdFx0XHRcdFx0b2JqLnVwZGF0ZSgpO1xuXHRcdFx0XHRcdFx0cmV0dXJuIHJlc3A7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0XHRjb2RlOiBvYmouZ2V0VmFsdWUoXCJjb2RlXCIpLFxuXG5cdFx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRcdG5hbWU6IG9iai5nZXRWYWx1ZShcIm5hbWVcIiksXG5cblx0XHRcdFx0XHRcdHJlbWFyazogb2JqLmdldFZhbHVlKFwicmVtYXJrXCIpLFxuXG5cdFx0XHRcdFx0XHRhZ2VuZGE6IG9iai5nZXRWYWx1ZShcImFnZW5kYVwiKSxcblxuXHRcdFx0XHRcdFx0cmVxdWlyZW1lbnQ6IG9iai5nZXRWYWx1ZShcInJlcXVpcmVtZW50XCIpLFxuXG5cdFx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21Eb2N1bWVudChvYmopKTtcblx0XHRcdFx0XHQvKmdzLmluZm8oXCJBZ2VuZGFfSXRlbS5fZnJvbURvY3VtZW50KCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0XHRcdHJldHVybiBnclJldDtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0XHRncy5pbmZvKFwiQWdlbmRhX0l0ZW0uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRcdHJldHVybiBvYmo7XG5cdFx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdFx0cmV0dXJuIG5ldyBwbGF0Zm9ybW1hbmFnZXJfQWdlbmRhX0l0ZW0oKS5fZnJvbURvY3VtZW50KG8pXG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqLmNvbnN0cnVjdG9yKSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdGlmIChvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIk9iamVjdFwiKSB7XG5cblx0XHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkob2JqKSkpKTtcblxuXHRcdFx0XHRcdC8qZ3MuaW5mbyhcIkFnZW5kYV9JdGVtLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5jb2RlKG9iai5jb2RlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5uYW1lKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLnJlbWFyaykpKTtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLnJlbWFyayk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWdlbmRhKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hZ2VuZGEobmV3IHBsYXRmb3JtbWFuYWdlcl9NZWV0aW5nX0FnZW5kYSgpLl9mcm9tRG9jdW1lbnQob2JqLmFnZW5kYSkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlcXVpcmVtZW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZXF1aXJlbWVudChuZXcgcGxhdGZvcm1tYW5hZ2VyX1JlcXVpcmVtZW50KCkuX2Zyb21Eb2N1bWVudChvYmoucmVxdWlyZW1lbnQpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiQWdlbmRhX0l0ZW1cIil7XG5cdFx0XHRcdFx0Z3MuaW5mbyhcIkFnZW5kYV9JdGVtLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Z3MuaW5mbyhcIkFnZW5kYV9JdGVtLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IFwiICsgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHRncy5pbmZvKFwiQWdlbmRhX0l0ZW0uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwiaW52YWxpZCBvYmplY3QgXCIgKyBcInR5cGVvZihvYmopOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZihvYmopLCBudWxsLCA0KSk7XG5cdFx0fVxuXG5cdFx0Lypncy5pbmZvKFwiQWdlbmRhX0l0ZW0uX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHRcdC8qZ3MuaW5mbyhcIkFnZW5kYV9JdGVtLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7Ki9cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9uZXcoYykge1xuXHRcdGlmICghYykgYyA9IHRoaXMuX190eXBlO1xuXHRcdGlmIChjLmluZGV4T2YoJ3BsYXRmb3JtbWFuYWdlcl8nKSAhPSAwKSBjID0gKHtcblx0XHRcdFBsYXRmb3JtOiBcInBsYXRmb3JtbWFuYWdlcl9QbGF0Zm9ybVwiLFxuXHRcdFx0VXNlcjogXCJwbGF0Zm9ybW1hbmFnZXJfVXNlclwiLFxuXHRcdFx0UmVxdWlyZW1lbnQ6IFwicGxhdGZvcm1tYW5hZ2VyX1JlcXVpcmVtZW50XCIsXG5cdFx0XHRFZmZvcnRfRXN0aW1hdGU6IFwicGxhdGZvcm1tYW5hZ2VyX0VmZm9ydF9Fc3RpbWF0ZVwiLFxuXHRcdFx0RWZmb3J0OiBcInBsYXRmb3JtbWFuYWdlcl9FZmZvcnRcIixcblx0XHRcdEJ1ZGdldDogXCJwbGF0Zm9ybW1hbmFnZXJfQnVkZ2V0XCIsXG5cdFx0XHRBZ2VuZGFfSXRlbTogXCJwbGF0Zm9ybW1hbmFnZXJfQWdlbmRhX0l0ZW1cIixcblx0XHRcdE1lZXRpbmdfQWdlbmRhOiBcInBsYXRmb3JtbWFuYWdlcl9NZWV0aW5nX0FnZW5kYVwiLFxuXHRcdFx0RGVjaXNpb25fT3B0aW9uOiBcInBsYXRmb3JtbWFuYWdlcl9EZWNpc2lvbl9PcHRpb25cIixcblx0XHRcdERlY2lzaW9uOiBcInBsYXRmb3JtbWFuYWdlcl9EZWNpc2lvblwiLFxuXHRcdFx0TWVldGluZ19NaW51dGU6IFwicGxhdGZvcm1tYW5hZ2VyX01lZXRpbmdfTWludXRlXCIsXG5cdFx0XHRNZWV0aW5nX1NlcmllczogXCJwbGF0Zm9ybW1hbmFnZXJfTWVldGluZ19TZXJpZXNcIixcblx0XHRcdE1lZXRpbmc6IFwicGxhdGZvcm1tYW5hZ2VyX01lZXRpbmdcIixcblx0XHRcdEJvYXJkOiBcInBsYXRmb3JtbWFuYWdlcl9Cb2FyZFwiLFxuXHRcdFx0Qm9hcmRfTWVtYmVyOiBcInBsYXRmb3JtbWFuYWdlcl9Cb2FyZF9NZW1iZXJcIixcblx0XHRcdEZyZXF1ZW5jeTogXCJwbGF0Zm9ybW1hbmFnZXJfRnJlcXVlbmN5XCIsXG5cdFx0XHRNb2R1bGU6IFwicGxhdGZvcm1tYW5hZ2VyX01vZHVsZVwiLFxuXHRcdFx0Q2FwYWJpbGl0eTogXCJwbGF0Zm9ybW1hbmFnZXJfQ2FwYWJpbGl0eVwiLFxuXHRcdFx0VGVhbTogXCJwbGF0Zm9ybW1hbmFnZXJfVGVhbVwiLFxuXHRcdFx0UHJvamVjdDogXCJwbGF0Zm9ybW1hbmFnZXJfUHJvamVjdFwiLFxuXHRcdFx0VGVhbV9NZW1iZXI6IFwicGxhdGZvcm1tYW5hZ2VyX1RlYW1fTWVtYmVyXCIsXG5cdFx0XHRSb2xlOiBcInBsYXRmb3JtbWFuYWdlcl9Sb2xlXCIsXG5cdFx0fSlbY107XG5cdFx0cmV0dXJuIG5ldyhncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBnbG9iYWwgOiB4Xzc4NjExX3BsYXRmb3JtXzApW2NdKCk7XG5cdH1cblxuXHRfdG9Eb2N1bWVudChhckZpZWxkcykge1xuXG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCB7fTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSByZXQuc3lzX2lkID0gdGhpcy5JZDtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5hY3RpdmUgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5lbmFibGVkID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmNvZGUgPSB0aGlzLmNvZGUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm9yZGVyID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5kYXRlID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmIChyZXQuZGF0ZSAmJiB0eXBlb2YocmV0LmRhdGUudG9JU09TdHJpbmcpID09PSAnZnVuY3Rpb24nKSByZXQuZGF0ZSA9IHJldC5kYXRlLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5uYW1lID0gdGhpcy5uYW1lKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQucmVtYXJrID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKHR5cGVvZihyZXQucmVtYXJrKSA9PT0gJ29iamVjdCcpIHJldC5yZW1hcmsgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NEVuY29kZShKU09OLnN0cmluZ2lmeShyZXQucmVtYXJrKSk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FnZW5kYSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWdlbmRhID0gdGhpcy5hZ2VuZGEoKTtcblxuXHRcdFx0aWYgKHJldC5hZ2VuZGEpIHtcblx0XHRcdFx0cmV0LmFnZW5kYSA9IHJldC5hZ2VuZGEuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQuYWdlbmRhKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5hZ2VuZGEpLmxlbmd0aCkgcmV0LmFnZW5kYSA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlcXVpcmVtZW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5yZXF1aXJlbWVudCA9IHRoaXMucmVxdWlyZW1lbnQoKTtcblxuXHRcdFx0aWYgKHJldC5yZXF1aXJlbWVudCkge1xuXHRcdFx0XHRyZXQucmVxdWlyZW1lbnQgPSByZXQucmVxdWlyZW1lbnQuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQucmVxdWlyZW1lbnQpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LnJlcXVpcmVtZW50KS5sZW5ndGgpIHJldC5yZXF1aXJlbWVudCA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHRcdH0pO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0ZGVsZXRlIHJldFtrXTtcblx0XHR9KTtcblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfdW5pcXVlKGtleXMsIHJldCkge1xuXHRcdHJldCA9IHJldCB8fCBuZXcgcGxhdGZvcm1tYW5hZ2VyX0FnZW5kYV9JdGVtKCk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdC8vIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7XG5cdFx0aWYgKCFrZXlzKSB7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuYWdlbmRhKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFnZW5kYSh0aGlzLmFnZW5kYSgpLl91bmlxdWUoKSk7XG5cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImVuYWJsZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmFibGVkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuYWJsZWQodGhpcy5lbmFibGVkKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY29kZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVtYXJrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFnZW5kYVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFnZW5kYSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hZ2VuZGEodGhpcy5hZ2VuZGEoKS5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVxdWlyZW1lbnRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZXF1aXJlbWVudCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZXF1aXJlbWVudCh0aGlzLnJlcXVpcmVtZW50KCkuX3VuaXF1ZSgpKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfcXVlcnkoZ3EpIHtcblx0XHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4Xzc4NjExX3BsYXRmb3JtXzBfYWdlbmRhX2l0ZW0nLCBbJyonXSlbJ3hfNzg2MTFfcGxhdGZvcm1fMF9hZ2VuZGFfaXRlbSddKTtcblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgneF83ODYxMV9wbGF0Zm9ybV8wX2FnZW5kYV9pdGVtJyk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKHRoaXMpKTtcblx0XHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0XHQvKiBncy5pbmZvKFwiQWdlbmRhX0l0ZW0uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0XHQvKiBncy5pbmZvKFwiQWdlbmRhX0l0ZW0uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdFx0LyogZ3MuaW5mbyhcIkFnZW5kYV9JdGVtLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdjb2RlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHRcdC8qIGdzLmluZm8oXCJBZ2VuZGFfSXRlbS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF0ZScpID49IDApIHtcblx0XHRcdFx0LyogZ3MuaW5mbyhcIkFnZW5kYV9JdGVtLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qIGdzLmluZm8oXCJBZ2VuZGFfSXRlbS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3JlbWFyaycpID49IDApIHtcblx0XHRcdFx0LyogZ3MuaW5mbyhcIkFnZW5kYV9JdGVtLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVtYXJrJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FnZW5kYSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FnZW5kYV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFnZW5kYSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIkFnZW5kYSBJdGVtXCI9PVwiQ29sdW1uXCIpIGdzLmluZm8oXCJBZ2VuZGFfSXRlbS5fcXVlcnkoKTogXCIrIFwiYWdlbmRhIFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdGdzLmluZm8oXCJBZ2VuZGFfSXRlbS5fcXVlcnkoKTogXCIgKyBcImFnZW5kYVthZ2VuZGFdIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuYWdlbmRhKCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FnZW5kYScpID49IDApIHtcblx0XHRcdFx0LyogZ3MuaW5mbyhcIkFnZW5kYV9JdGVtLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWdlbmRhJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhZ2VuZGEnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWdlbmRhJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlcXVpcmVtZW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcmVxdWlyZW1lbnRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yZXF1aXJlbWVudCgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIkFnZW5kYSBJdGVtXCI9PVwiQ29sdW1uXCIpIGdzLmluZm8oXCJBZ2VuZGFfSXRlbS5fcXVlcnkoKTogXCIrIFwicmVxdWlyZW1lbnQgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0Z3MuaW5mbyhcIkFnZW5kYV9JdGVtLl9xdWVyeSgpOiBcIiArIFwicmVxdWlyZW1lbnRbcmVxdWlyZW1lbnRdIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMucmVxdWlyZW1lbnQoKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVxdWlyZW1lbnQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qIGdzLmluZm8oXCJBZ2VuZGFfSXRlbS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlcXVpcmVtZW50Jyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZXF1aXJlbWVudCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZXF1aXJlbWVudCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdFx0LyogZ3MuaW5mbyhcIkFnZW5kYV9JdGVtLl9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdHJldHVybiB0aGlzLl9xdWVyeUdRO1xuXHR9XG5cblx0X3NhdmUob2JqKSB7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0cmV0dXJuIG5ldyBwbGF0Zm9ybW1hbmFnZXJfQWdlbmRhX0l0ZW0oKS5fc2F2ZShvKVxuXHRcdH0pO1xuXG5cdFx0bGV0IF9vYmogPSB7fTtcblxuXHRcdC8qZ3MuaW5mbyhcIkFnZW5kYV9JdGVtLl9zYXZlKCk6IFwiKyBcIi4uLiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4Xzc4NjExX3BsYXRmb3JtXzBfYWdlbmRhX2l0ZW0nLCBbJyonXSlbJ3hfNzg2MTFfcGxhdGZvcm1fMF9hZ2VuZGFfaXRlbSddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdFx0fSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHRcdGdzLmluZm8oXCJBZ2VuZGFfSXRlbS5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0XHRncy5pbmZvKFwiQWdlbmRhX0l0ZW0uX3NhdmUoKTogXCIgKyBcInN5c19pZCB0byBzdHJpbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRsZXQgX3RoaXMgPSBudWxsO1xuXHRcdGlmIChvYmouX19rZXlzKSB7XG5cdFx0XHRsZXQga09iaiA9IHt9O1xuXHRcdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShfb2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKSkpO1xuXHRcdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHRcdH0pO1xuXHRcdFx0X3RoaXMgPSBuZXcgcGxhdGZvcm1tYW5hZ2VyX0FnZW5kYV9JdGVtKCkuX2Zyb21Eb2N1bWVudChrT2JqKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0X3RoaXMgPSBuZXcgcGxhdGZvcm1tYW5hZ2VyX0FnZW5kYV9JdGVtKCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdFx0fVxuXG5cdFx0Lypncy5pbmZvKFwiQWdlbmRhX0l0ZW0uX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRcdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0XHRkZWxldGUgX29iai5fX2lkRmllbGQ7XG5cblx0XHR0cnkge1xuXHRcdFx0Z3MuaW5mbyhcIkFnZW5kYV9JdGVtLl9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0Z3MuaW5mbyhcIkFnZW5kYV9JdGVtLl9zYXZlKCk6IFwiICsgXCJyZW5hbWluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0pO1xuXG5cdFx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAneF83ODYxMV9wbGF0Zm9ybV8wX2FnZW5kYV9pdGVtJyk7XG5cdFx0XHQvKmdzLmluZm8oXCJBZ2VuZGFfSXRlbS5fc2F2ZSgpOiBcIisgXCJ1cHNlcnRpbmcuLi4gXCIrIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7Ki9cblx0XHRcdGlmIChfb2JqLnN5c19pZCkge1xuXHRcdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X29iai5zeXNfaWQgPSBncy5nZW5lcmF0ZUdVSUQoKTtcblx0XHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0XHR9XG5cdFx0XHRsZXQgX2ZPYmogPSB7fTtcblx0XHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpKSk7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4Xzc4NjExX3BsYXRmb3JtXzBfYWdlbmRhX2l0ZW0nLCBbJyonXSlbJ3hfNzg2MTFfcGxhdGZvcm1fMF9hZ2VuZGFfaXRlbSddKSkpKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0Z3MuaW5mbyhcIkFnZW5kYV9JdGVtLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0XHRncy5pbmZvKFwiQWdlbmRhX0l0ZW0uX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEFnZW5kYV9JdGVtLnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RvcmUoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihsb2dPYmopIHtcblx0XHRcdGdzLmluZm8oXCJBZ2VuZGFfSXRlbS5zdG9yZSgpOiBcIiArIFwibG9nT2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KGxvZ09iaiwgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdGdzLmluZm8oXCJBZ2VuZGFfSXRlbS5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGdzLmluZm8oXCJBZ2VuZGFfSXRlbS5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0Z3MuaW5mbyhcIkFnZW5kYV9JdGVtLnN0b3JlKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRcdGxldCBfdGhpcyA9IHRoaXMuX3VuaXF1ZSgpLmZpbmQoKTtcblx0XHRcdGlmIChfdGhpcykgdGhpcy5JZCA9IF90aGlzLklkO1xuXG5cdFx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBZ2VuZGFfSXRlbS5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZEFsbChfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKGxvZ09iaikge1xuXHRcdFx0Z3MuaW5mbyhcIkFnZW5kYV9JdGVtLmZpbmRBbGwoKTogXCIgKyBcImxvZ09iajogXCIgKyBKU09OLnN0cmluZ2lmeShsb2dPYmosIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHRncy5pbmZvKFwiQWdlbmRhX0l0ZW0uZmluZEFsbCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGdzLmluZm8oXCJBZ2VuZGFfSXRlbS5maW5kQWxsKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHRncy5pbmZvKFwiQWdlbmRhX0l0ZW0uZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZChcIkFnZW5kYV9JdGVtXCIpO1xuXHRcdFx0Z3IuYWRkRW5jb2RlZFF1ZXJ5KHRoaXMuX3RvRVF1ZXJ5KCkpO1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChncik7XG5cblx0XHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4Xzc4NjExX3BsYXRmb3JtXzBfYWdlbmRhX2l0ZW0nLCBbJyonXSlbJ3hfNzg2MTFfcGxhdGZvcm1fMF9hZ2VuZGFfaXRlbSddKSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBBZ2VuZGFfSXRlbS5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZChfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKGxvZ09iaikge1xuXHRcdFx0Z3MuaW5mbyhcIkFnZW5kYV9JdGVtLmZpbmQoKTogXCIgKyBcImxvZ09iajogXCIgKyBKU09OLnN0cmluZ2lmeShsb2dPYmosIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHRncy5pbmZvKFwiQWdlbmRhX0l0ZW0uZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGdzLmluZm8oXCJBZ2VuZGFfSXRlbS5maW5kKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHRncy5pbmZvKFwiQWdlbmRhX0l0ZW0uZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG59In0seyJhY3RpdmUiOnRydWUsImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInN5c19uYW1lIjoicGxhdGZvcm1tYW5hZ2VyX01lZXRpbmdfQWdlbmRhIiwiYXBpX25hbWUiOiJ4Xzc4NjExX3BsYXRmb3JtXzAucGxhdGZvcm1tYW5hZ2VyX01lZXRpbmdfQWdlbmRhIiwibmFtZSI6InBsYXRmb3JtbWFuYWdlcl9NZWV0aW5nX0FnZW5kYSIsInNjcmlwdCI6ImNsYXNzIHBsYXRmb3JtbWFuYWdlcl9NZWV0aW5nX0FnZW5kYSB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7XG5cdFx0dW5kZWZpbmVkXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIlwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJwbGF0Zm9ybW1hbmFnZXJfTWVldGluZ19BZ2VuZGFcIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInBsYXRmb3JtbWFuYWdlclwiO1xuXHRcdHRoaXMuX19zY29wZSA9IFwicGxhdGZvcm1tYW5hZ2VyXCI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNZWV0aW5nX0FnZW5kYS5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1lZXRpbmdfQWdlbmRhLmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmFibGVkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lbmFibGVkID0gdjtcblx0XHRcdHRoaXMuX2VuYWJsZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5hYmxlZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNZWV0aW5nX0FnZW5kYS5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29kZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29kZSA9IHY7XG5cdFx0XHR0aGlzLl9jb2RlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvZGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogTWVldGluZ19BZ2VuZGEub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogTWVldGluZ19BZ2VuZGEuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRhdGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvL2dzLmluZm8oXCJNZWV0aW5nX0FnZW5kYS5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogTWVldGluZ19BZ2VuZGEubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG5hbWUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX25hbWUgPSB2O1xuXHRcdFx0dGhpcy5fbmFtZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9uYW1lO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1lZXRpbmdfQWdlbmRhLnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlbWFyayh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVtYXJrID0gdjtcblx0XHRcdHRoaXMuX3JlbWFya19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZW1hcms7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogTWVldGluZ19BZ2VuZGEubWVldGluZyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG1lZXRpbmcodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX21lZXRpbmcgPSB2O1xuXHRcdFx0dGhpcy5fbWVldGluZ19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9tZWV0aW5nO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1lZXRpbmdfQWdlbmRhLmFnZW5kYV9BZ2VuZGFfSXRlbXMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhZ2VuZGFfQWdlbmRhX0l0ZW1zKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fYWdlbmRhX0FnZW5kYV9JdGVtcyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX2FnZW5kYV9BZ2VuZGFfSXRlbXNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FnZW5kYV9BZ2VuZGFfSXRlbXM7XG5cdFx0fVxuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2NvZGUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3JlbWFyaycgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodGhpcy5fbWVldGluZykgcmV0ICs9IC8qKHRoaXMuX21lZXRpbmdfY29vcCB8fCAnPScpICsgKi8gdGhpcy5tZWV0aW5nKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ21lZXRpbmcuJyk7XG5cblx0XHQodGhpcy5hZ2VuZGFfQWdlbmRhX0l0ZW1zKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllBZ2VuZGFfSXRlbS5hZ2VuZGEsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdGdzLmluZm8oXCJNZWV0aW5nX0FnZW5kYS5fdG9FUXVlcnkoKTogXCIgKyBcInJldDogXCIgKyBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X2ludm9rZShtZXRob2QsIHBheWxvYWQpIHtcblx0XHRpZiAoIW1ldGhvZCkgcmV0dXJuIG51bGw7XG5cdFx0aWYgKHR5cGVvZihwYXlsb2FkKSA9PT0gJ3N0cmluZycpIHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKHBheWxvYWQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBwKTtcblx0XHR9KTtcblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdGdzLmluZm8oXCJNZWV0aW5nX0FnZW5kYS5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdGdzLmluZm8oXCJNZWV0aW5nX0FnZW5kYS5faW52b2tlKCk6IFwiICsgXCJpbnZhbGlkIG1ldGhvZCBcIiArIG1ldGhvZCk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzOyAvLyB0ZXN0XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHBsYXRmb3JtbWFuYWdlcl9NZWV0aW5nX0FnZW5kYSgpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdHRyeSB7XG5cdFx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdC8qZ3MuaW5mbyhcIk1lZXRpbmdfQWdlbmRhLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0XHRsZXQgX29iaiA9IHtcblx0XHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHRcdH07XG5cdFx0XHRcdF9vYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSldID0gb2JqO1xuXHRcdFx0XHRvYmogPSBfb2JqO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChvYmopO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRpZiAob2JqLmlzVmFsaWRSZWNvcmQoKSkge1xuXHRcdFx0XHRcdGlmIChvYmouZ2V0VGFibGVOYW1lKCkgPT0gJ2VjY19xdWV1ZScgJiYgXCJNZWV0aW5nX0FnZW5kYVwiICE9ICdlY2NfcXVldWUnICYmIG9iai5zb3VyY2UgPT0gXCJNZWV0aW5nX0FnZW5kYVwiKSB7XG5cdFx0XHRcdFx0XHRvYmouc3RhdGUgPSBcInByb2Nlc3NpbmdcIjtcblx0XHRcdFx0XHRcdG9iai51cGRhdGUoKTtcblxuXHRcdFx0XHRcdFx0bGV0IHJlc3AgPSBuZXcgR2xpZGVSZWNvcmQoJ2VjY19xdWV1ZScpO1xuXHRcdFx0XHRcdFx0cmVzcC5yZXNwb25zZV90byA9IG9iai5zeXNfaWQ7XG5cdFx0XHRcdFx0XHRyZXNwLnF1ZXVlID0gJ291dHB1dCc7XG5cdFx0XHRcdFx0XHRyZXNwLmFnZW50ID0gb2JqLmFnZW50O1xuXHRcdFx0XHRcdFx0cmVzcC50b3BpYyA9IG9iai50b3BpYztcblx0XHRcdFx0XHRcdHJlc3AubmFtZSA9IG9iai5uYW1lO1xuXHRcdFx0XHRcdFx0cmVzcC5zb3VyY2UgPSBvYmouc291cmNlO1xuXHRcdFx0XHRcdFx0cmVzcC5mcm9tX2hvc3QgPSBvYmouYWdlbnRfY29ycmVsYXRvcjtcblx0XHRcdFx0XHRcdHJlc3AuYWdlbnRfY29ycmVsYXRvciA9IG9iai5mcm9tX2hvc3Q7XG5cblx0XHRcdFx0XHRcdGxldCByZXQgPSBuZXcgcGxhdGZvcm1tYW5hZ2VyX01lZXRpbmdfQWdlbmRhKCkuX2Zyb21Eb2N1bWVudCgpLl9pbnZva2Uob2JqLm5hbWUudG9TdHJpbmcoKSwgb2JqLnBheWxvYWQudG9TdHJpbmcoKSk7XG5cdFx0XHRcdFx0XHRpZiAoQXJyYXkuaXNBcnJheShyZXQpKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHJldC5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiAociAmJiB0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicpID8gci5fdG9Eb2N1bWVudCgpIDogcjtcblx0XHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHJldCAmJiB0eXBlb2YocmV0Ll90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByZXQuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJlc3AucGF5bG9hZCA9IEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCk7XG5cblx0XHRcdFx0XHRcdHJlc3AuaW5zZXJ0KCk7XG5cblx0XHRcdFx0XHRcdG9iai5zdGF0ZSA9IFwicHJvY2Vzc2VkXCI7XG5cdFx0XHRcdFx0XHRvYmoudXBkYXRlKCk7XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmVzcDtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRcdGVuYWJsZWQ6IG9iai5nZXRWYWx1ZShcImVuYWJsZWRcIiksXG5cblx0XHRcdFx0XHRcdGNvZGU6IG9iai5nZXRWYWx1ZShcImNvZGVcIiksXG5cblx0XHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdFx0cmVtYXJrOiBvYmouZ2V0VmFsdWUoXCJyZW1hcmtcIiksXG5cblx0XHRcdFx0XHRcdG1lZXRpbmc6IG9iai5nZXRWYWx1ZShcIm1lZXRpbmdcIiksXG5cblx0XHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbURvY3VtZW50KG9iaikpO1xuXHRcdFx0XHRcdC8qZ3MuaW5mbyhcIk1lZXRpbmdfQWdlbmRhLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHRcdGdzLmluZm8oXCJNZWV0aW5nX0FnZW5kYS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdFx0cmV0dXJuIG9iajtcblx0XHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0XHRyZXR1cm4gbmV3IHBsYXRmb3JtbWFuYWdlcl9NZWV0aW5nX0FnZW5kYSgpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdFx0Lypncy5pbmZvKFwiTWVldGluZ19BZ2VuZGEuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmNvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLmNvZGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLm5hbWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmoucmVtYXJrKSkpO1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmoucmVtYXJrKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5tZWV0aW5nKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5tZWV0aW5nKG5ldyBwbGF0Zm9ybW1hbmFnZXJfTWVldGluZygpLl9mcm9tRG9jdW1lbnQob2JqLm1lZXRpbmcpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hZ2VuZGFfQWdlbmRhX0l0ZW1zKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuYWdlbmRhX0FnZW5kYV9JdGVtcyhuZXcgcGxhdGZvcm1tYW5hZ2VyX0FnZW5kYV9JdGVtKCkuX2Zyb21Eb2N1bWVudChvYmouYWdlbmRhX0FnZW5kYV9JdGVtcykpO1xuXG5cdFx0XHRcdH0gZWxzZSB7IC8vIGlmKG9iai5jb25zdHJ1Y3Rvci5uYW1lPT1cIk1lZXRpbmdfQWdlbmRhXCIpe1xuXHRcdFx0XHRcdGdzLmluZm8oXCJNZWV0aW5nX0FnZW5kYS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGdzLmluZm8oXCJNZWV0aW5nX0FnZW5kYS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0Z3MuaW5mbyhcIk1lZXRpbmdfQWdlbmRhLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHRcdH1cblxuXHRcdC8qZ3MuaW5mbyhcIk1lZXRpbmdfQWdlbmRhLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0XHQvKmdzLmluZm8oXCJNZWV0aW5nX0FnZW5kYS5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfbmV3KGMpIHtcblx0XHRpZiAoIWMpIGMgPSB0aGlzLl9fdHlwZTtcblx0XHRpZiAoYy5pbmRleE9mKCdwbGF0Zm9ybW1hbmFnZXJfJykgIT0gMCkgYyA9ICh7XG5cdFx0XHRQbGF0Zm9ybTogXCJwbGF0Zm9ybW1hbmFnZXJfUGxhdGZvcm1cIixcblx0XHRcdFVzZXI6IFwicGxhdGZvcm1tYW5hZ2VyX1VzZXJcIixcblx0XHRcdFJlcXVpcmVtZW50OiBcInBsYXRmb3JtbWFuYWdlcl9SZXF1aXJlbWVudFwiLFxuXHRcdFx0RWZmb3J0X0VzdGltYXRlOiBcInBsYXRmb3JtbWFuYWdlcl9FZmZvcnRfRXN0aW1hdGVcIixcblx0XHRcdEVmZm9ydDogXCJwbGF0Zm9ybW1hbmFnZXJfRWZmb3J0XCIsXG5cdFx0XHRCdWRnZXQ6IFwicGxhdGZvcm1tYW5hZ2VyX0J1ZGdldFwiLFxuXHRcdFx0QWdlbmRhX0l0ZW06IFwicGxhdGZvcm1tYW5hZ2VyX0FnZW5kYV9JdGVtXCIsXG5cdFx0XHRNZWV0aW5nX0FnZW5kYTogXCJwbGF0Zm9ybW1hbmFnZXJfTWVldGluZ19BZ2VuZGFcIixcblx0XHRcdERlY2lzaW9uX09wdGlvbjogXCJwbGF0Zm9ybW1hbmFnZXJfRGVjaXNpb25fT3B0aW9uXCIsXG5cdFx0XHREZWNpc2lvbjogXCJwbGF0Zm9ybW1hbmFnZXJfRGVjaXNpb25cIixcblx0XHRcdE1lZXRpbmdfTWludXRlOiBcInBsYXRmb3JtbWFuYWdlcl9NZWV0aW5nX01pbnV0ZVwiLFxuXHRcdFx0TWVldGluZ19TZXJpZXM6IFwicGxhdGZvcm1tYW5hZ2VyX01lZXRpbmdfU2VyaWVzXCIsXG5cdFx0XHRNZWV0aW5nOiBcInBsYXRmb3JtbWFuYWdlcl9NZWV0aW5nXCIsXG5cdFx0XHRCb2FyZDogXCJwbGF0Zm9ybW1hbmFnZXJfQm9hcmRcIixcblx0XHRcdEJvYXJkX01lbWJlcjogXCJwbGF0Zm9ybW1hbmFnZXJfQm9hcmRfTWVtYmVyXCIsXG5cdFx0XHRGcmVxdWVuY3k6IFwicGxhdGZvcm1tYW5hZ2VyX0ZyZXF1ZW5jeVwiLFxuXHRcdFx0TW9kdWxlOiBcInBsYXRmb3JtbWFuYWdlcl9Nb2R1bGVcIixcblx0XHRcdENhcGFiaWxpdHk6IFwicGxhdGZvcm1tYW5hZ2VyX0NhcGFiaWxpdHlcIixcblx0XHRcdFRlYW06IFwicGxhdGZvcm1tYW5hZ2VyX1RlYW1cIixcblx0XHRcdFByb2plY3Q6IFwicGxhdGZvcm1tYW5hZ2VyX1Byb2plY3RcIixcblx0XHRcdFRlYW1fTWVtYmVyOiBcInBsYXRmb3JtbWFuYWdlcl9UZWFtX01lbWJlclwiLFxuXHRcdFx0Um9sZTogXCJwbGF0Zm9ybW1hbmFnZXJfUm9sZVwiLFxuXHRcdH0pW2NdO1xuXHRcdHJldHVybiBuZXcoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gZ2xvYmFsIDogeF83ODYxMV9wbGF0Zm9ybV8wKVtjXSgpO1xuXHR9XG5cblx0X3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5jb2RlID0gdGhpcy5jb2RlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9tZWV0aW5nKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5tZWV0aW5nID0gdGhpcy5tZWV0aW5nKCk7XG5cblx0XHRcdGlmIChyZXQubWVldGluZykge1xuXHRcdFx0XHRyZXQubWVldGluZyA9IHJldC5tZWV0aW5nLl90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0Lm1lZXRpbmcpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0Lm1lZXRpbmcpLmxlbmd0aCkgcmV0Lm1lZXRpbmcgPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmFnZW5kYV9BZ2VuZGFfSXRlbXMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWdlbmRhX0FnZW5kYV9JdGVtcyA9IHRoaXMuYWdlbmRhX0FnZW5kYV9JdGVtcygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHRcdH0pO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0ZGVsZXRlIHJldFtrXTtcblx0XHR9KTtcblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfdW5pcXVlKGtleXMsIHJldCkge1xuXHRcdHJldCA9IHJldCB8fCBuZXcgcGxhdGZvcm1tYW5hZ2VyX01lZXRpbmdfQWdlbmRhKCk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdC8vIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7XG5cdFx0aWYgKCFrZXlzKSB7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMubWVldGluZygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5tZWV0aW5nKHRoaXMubWVldGluZygpLl91bmlxdWUoKSk7XG5cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImVuYWJsZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmFibGVkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuYWJsZWQodGhpcy5lbmFibGVkKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY29kZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVtYXJrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm1lZXRpbmdcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5tZWV0aW5nKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm1lZXRpbmcodGhpcy5tZWV0aW5nKCkuX3VuaXF1ZSgpKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfcXVlcnkoZ3EpIHtcblx0XHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4Xzc4NjExX3BsYXRmb3JtXzBfbWVldGluZ19hZ2VuZGEnLCBbJyonXSlbJ3hfNzg2MTFfcGxhdGZvcm1fMF9tZWV0aW5nX2FnZW5kYSddKTtcblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgneF83ODYxMV9wbGF0Zm9ybV8wX21lZXRpbmdfYWdlbmRhJyk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKHRoaXMpKTtcblx0XHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0XHQvKiBncy5pbmZvKFwiTWVldGluZ19BZ2VuZGEuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0XHQvKiBncy5pbmZvKFwiTWVldGluZ19BZ2VuZGEuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdFx0LyogZ3MuaW5mbyhcIk1lZXRpbmdfQWdlbmRhLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdjb2RlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHRcdC8qIGdzLmluZm8oXCJNZWV0aW5nX0FnZW5kYS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF0ZScpID49IDApIHtcblx0XHRcdFx0LyogZ3MuaW5mbyhcIk1lZXRpbmdfQWdlbmRhLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qIGdzLmluZm8oXCJNZWV0aW5nX0FnZW5kYS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3JlbWFyaycpID49IDApIHtcblx0XHRcdFx0LyogZ3MuaW5mbyhcIk1lZXRpbmdfQWdlbmRhLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVtYXJrJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX21lZXRpbmcpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9tZWV0aW5nX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubWVldGluZygpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIk1lZXRpbmcgQWdlbmRhXCI9PVwiQ29sdW1uXCIpIGdzLmluZm8oXCJNZWV0aW5nX0FnZW5kYS5fcXVlcnkoKTogXCIrIFwibWVldGluZyBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHRncy5pbmZvKFwiTWVldGluZ19BZ2VuZGEuX3F1ZXJ5KCk6IFwiICsgXCJtZWV0aW5nW21lZXRpbmddIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMubWVldGluZygpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdtZWV0aW5nJykgPj0gMCkge1xuXHRcdFx0XHQvKiBncy5pbmZvKFwiTWVldGluZ19BZ2VuZGEuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdtZWV0aW5nJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdtZWV0aW5nJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ21lZXRpbmcnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHRcdC8qIGdzLmluZm8oXCJNZWV0aW5nX0FnZW5kYS5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0XHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcblx0fVxuXG5cdF9zYXZlKG9iaikge1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdHJldHVybiBuZXcgcGxhdGZvcm1tYW5hZ2VyX01lZXRpbmdfQWdlbmRhKCkuX3NhdmUobylcblx0XHR9KTtcblxuXHRcdGxldCBfb2JqID0ge307XG5cblx0XHQvKmdzLmluZm8oXCJNZWV0aW5nX0FnZW5kYS5fc2F2ZSgpOiBcIisgXCIuLi4gXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRPYmplY3Qua2V5cyhvYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF83ODYxMV9wbGF0Zm9ybV8wX21lZXRpbmdfYWdlbmRhJywgWycqJ10pWyd4Xzc4NjExX3BsYXRmb3JtXzBfbWVldGluZ19hZ2VuZGEnXSkuZmlsdGVyKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiB0cnVlIHx8IFsnc3lzX3VwZGF0ZWRfb24nLCAnc3lzX2NyZWF0ZWRfb24nLCAndXBkYXRlcycsICdzeXNfY3JlYXRlZF9ieScsICdzeXNfdXBkYXRlZF9ieSddLmluZGV4T2YoX2spIDwgMFxuXHRcdFx0fSkuaW5kZXhPZihrLnRvTG93ZXJDYXNlKCkpID49IDBcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdF9vYmpbay50b0xvd2VyQ2FzZSgpXSA9IG9ialtrXVxuXHRcdH0pO1xuXG5cdFx0T2JqZWN0LmtleXMoX29iaikuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKF9vYmpba10pID09PSBcIltvYmplY3QgRGF0ZV1cIiAmJiBpc05hTihfb2JqW2tdKSkge1xuXHRcdFx0XHRncy5pbmZvKFwiTWVldGluZ19BZ2VuZGEuX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdFx0Z3MuaW5mbyhcIk1lZXRpbmdfQWdlbmRhLl9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0bGV0IF90aGlzID0gbnVsbDtcblx0XHRpZiAob2JqLl9fa2V5cykge1xuXHRcdFx0bGV0IGtPYmogPSB7fTtcblx0XHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSkpKTtcblx0XHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0XHR9KTtcblx0XHRcdF90aGlzID0gbmV3IHBsYXRmb3JtbWFuYWdlcl9NZWV0aW5nX0FnZW5kYSgpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF90aGlzID0gbmV3IHBsYXRmb3JtbWFuYWdlcl9NZWV0aW5nX0FnZW5kYSgpLl9mcm9tRG9jdW1lbnQoX29iaikuX3VuaXF1ZSgpO1xuXHRcdH1cblxuXHRcdC8qZ3MuaW5mbyhcIk1lZXRpbmdfQWdlbmRhLl9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0XHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdFx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdFx0dHJ5IHtcblx0XHRcdGdzLmluZm8oXCJNZWV0aW5nX0FnZW5kYS5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdGdzLmluZm8oXCJNZWV0aW5nX0FnZW5kYS5fc2F2ZSgpOiBcIiArIFwicmVuYW1pbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHR2YXIgbGsgPSBrLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRcdF9vYmpbbGtdID0gX29ialtrXTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9KTtcblxuXHRcdFx0bGV0IGdxID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KG9iai5fX3R5cGUgfHwgJ3hfNzg2MTFfcGxhdGZvcm1fMF9tZWV0aW5nX2FnZW5kYScpO1xuXHRcdFx0Lypncy5pbmZvKFwiTWVldGluZ19BZ2VuZGEuX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdFx0fVxuXHRcdFx0bGV0IF9mT2JqID0ge307XG5cdFx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKSkpO1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF83ODYxMV9wbGF0Zm9ybV8wX21lZXRpbmdfYWdlbmRhJywgWycqJ10pWyd4Xzc4NjExX3BsYXRmb3JtXzBfbWVldGluZ19hZ2VuZGEnXSkpKSk7XG5cdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdGdzLmluZm8oXCJNZWV0aW5nX0FnZW5kYS5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdFx0Z3MuaW5mbyhcIk1lZXRpbmdfQWdlbmRhLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fVxuXG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLmFnZW5kYV9BZ2VuZGFfSXRlbXMpKSB0aGlzLmFnZW5kYV9BZ2VuZGFfSXRlbXMob2JqLmFnZW5kYV9BZ2VuZGFfSXRlbXMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHBsYXRmb3JtbWFuYWdlcl9BZ2VuZGFfSXRlbSgpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogTWVldGluZ19BZ2VuZGEuc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzdG9yZShfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKGxvZ09iaikge1xuXHRcdFx0Z3MuaW5mbyhcIk1lZXRpbmdfQWdlbmRhLnN0b3JlKCk6IFwiICsgXCJsb2dPYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkobG9nT2JqLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0Z3MuaW5mbyhcIk1lZXRpbmdfQWdlbmRhLnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Z3MuaW5mbyhcIk1lZXRpbmdfQWdlbmRhLnN0b3JlKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHRncy5pbmZvKFwiTWVldGluZ19BZ2VuZGEuc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdFx0bGV0IF90aGlzID0gdGhpcy5fdW5pcXVlKCkuZmluZCgpO1xuXHRcdFx0aWYgKF90aGlzKSB0aGlzLklkID0gX3RoaXMuSWQ7XG5cblx0XHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1lZXRpbmdfQWdlbmRhLmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kQWxsKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obG9nT2JqKSB7XG5cdFx0XHRncy5pbmZvKFwiTWVldGluZ19BZ2VuZGEuZmluZEFsbCgpOiBcIiArIFwibG9nT2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KGxvZ09iaiwgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdGdzLmluZm8oXCJNZWV0aW5nX0FnZW5kYS5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Z3MuaW5mbyhcIk1lZXRpbmdfQWdlbmRhLmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdGdzLmluZm8oXCJNZWV0aW5nX0FnZW5kYS5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIGZpbmRBbGwgbG9jYWxseVxuXHRcdFx0bGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKFwiTWVldGluZ19BZ2VuZGFcIik7XG5cdFx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfNzg2MTFfcGxhdGZvcm1fMF9tZWV0aW5nX2FnZW5kYScsIFsnKiddKVsneF83ODYxMV9wbGF0Zm9ybV8wX21lZXRpbmdfYWdlbmRhJ10pKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1lZXRpbmdfQWdlbmRhLmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obG9nT2JqKSB7XG5cdFx0XHRncy5pbmZvKFwiTWVldGluZ19BZ2VuZGEuZmluZCgpOiBcIiArIFwibG9nT2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KGxvZ09iaiwgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdGdzLmluZm8oXCJNZWV0aW5nX0FnZW5kYS5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Z3MuaW5mbyhcIk1lZXRpbmdfQWdlbmRhLmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdGdzLmluZm8oXCJNZWV0aW5nX0FnZW5kYS5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic3lzX25hbWUiOiJwbGF0Zm9ybW1hbmFnZXJfTWVldGluZ19NaW51dGUiLCJhcGlfbmFtZSI6InhfNzg2MTFfcGxhdGZvcm1fMC5wbGF0Zm9ybW1hbmFnZXJfTWVldGluZ19NaW51dGUiLCJuYW1lIjoicGxhdGZvcm1tYW5hZ2VyX01lZXRpbmdfTWludXRlIiwic2NyaXB0IjoiY2xhc3MgcGxhdGZvcm1tYW5hZ2VyX01lZXRpbmdfTWludXRlIHtcblx0Y29uc3RydWN0b3IoaWQpIHtcblx0XHR1bmRlZmluZWRcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInBsYXRmb3JtbWFuYWdlcl9NZWV0aW5nX01pbnV0ZVwiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwicGxhdGZvcm1tYW5hZ2VyXCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJwbGF0Zm9ybW1hbmFnZXJcIjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1lZXRpbmdfTWludXRlLmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdGl2ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYWN0aXZlID0gdjtcblx0XHRcdHRoaXMuX2FjdGl2ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3RpdmU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogTWVldGluZ19NaW51dGUuZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVuYWJsZWQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2VuYWJsZWQgPSB2O1xuXHRcdFx0dGhpcy5fZW5hYmxlZF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lbmFibGVkO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1lZXRpbmdfTWludXRlLmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNZWV0aW5nX01pbnV0ZS5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG9yZGVyKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9vcmRlciA9IHY7XG5cdFx0XHR0aGlzLl9vcmRlcl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9vcmRlcjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNZWV0aW5nX01pbnV0ZS5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGF0ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vZ3MuaW5mbyhcIk1lZXRpbmdfTWludXRlLmRhdGUoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9kYXRlID0gdjtcblx0XHRcdHRoaXMuX2RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGF0ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNZWV0aW5nX01pbnV0ZS5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogTWVldGluZ19NaW51dGUucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNZWV0aW5nX01pbnV0ZS5tZWV0aW5nIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bWVldGluZyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbWVldGluZyA9IHY7XG5cdFx0XHR0aGlzLl9tZWV0aW5nX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX21lZXRpbmc7XG5cdFx0fVxuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2NvZGUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3JlbWFyaycgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodGhpcy5fbWVldGluZykgcmV0ICs9IC8qKHRoaXMuX21lZXRpbmdfY29vcCB8fCAnPScpICsgKi8gdGhpcy5tZWV0aW5nKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ21lZXRpbmcuJyk7XG5cblx0XHRncy5pbmZvKFwiTWVldGluZ19NaW51dGUuX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSByZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHRncy5pbmZvKFwiTWVldGluZ19NaW51dGUuX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXG5cdFx0c3dpdGNoIChtZXRob2QpIHtcblxuXHRcdFx0Y2FzZSBcInN0b3JlXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuc3RvcmUoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRBbGxcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHRncy5pbmZvKFwiTWVldGluZ19NaW51dGUuX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpczsgLy8gdGVzdFxuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBwbGF0Zm9ybW1hbmFnZXJfTWVldGluZ19NaW51dGUoKS5fZnJvbURvY3VtZW50KG8pKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKG9iaikgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHR0cnkge1xuXHRcdFx0XHRvYmogPSBKU09OLnBhcnNlKG9iaik7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHQvKmdzLmluZm8oXCJNZWV0aW5nX01pbnV0ZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0XHR9O1xuXHRcdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdFx0b2JqID0gX29iajtcblx0XHRcdH1cblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdFx0XHRpZiAob2JqLmdldFRhYmxlTmFtZSgpID09ICdlY2NfcXVldWUnICYmIFwiTWVldGluZ19NaW51dGVcIiAhPSAnZWNjX3F1ZXVlJyAmJiBvYmouc291cmNlID09IFwiTWVldGluZ19NaW51dGVcIikge1xuXHRcdFx0XHRcdFx0b2JqLnN0YXRlID0gXCJwcm9jZXNzaW5nXCI7XG5cdFx0XHRcdFx0XHRvYmoudXBkYXRlKCk7XG5cblx0XHRcdFx0XHRcdGxldCByZXNwID0gbmV3IEdsaWRlUmVjb3JkKCdlY2NfcXVldWUnKTtcblx0XHRcdFx0XHRcdHJlc3AucmVzcG9uc2VfdG8gPSBvYmouc3lzX2lkO1xuXHRcdFx0XHRcdFx0cmVzcC5xdWV1ZSA9ICdvdXRwdXQnO1xuXHRcdFx0XHRcdFx0cmVzcC5hZ2VudCA9IG9iai5hZ2VudDtcblx0XHRcdFx0XHRcdHJlc3AudG9waWMgPSBvYmoudG9waWM7XG5cdFx0XHRcdFx0XHRyZXNwLm5hbWUgPSBvYmoubmFtZTtcblx0XHRcdFx0XHRcdHJlc3Auc291cmNlID0gb2JqLnNvdXJjZTtcblx0XHRcdFx0XHRcdHJlc3AuZnJvbV9ob3N0ID0gb2JqLmFnZW50X2NvcnJlbGF0b3I7XG5cdFx0XHRcdFx0XHRyZXNwLmFnZW50X2NvcnJlbGF0b3IgPSBvYmouZnJvbV9ob3N0O1xuXG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gbmV3IHBsYXRmb3JtbWFuYWdlcl9NZWV0aW5nX01pbnV0ZSgpLl9mcm9tRG9jdW1lbnQoKS5faW52b2tlKG9iai5uYW1lLnRvU3RyaW5nKCksIG9iai5wYXlsb2FkLnRvU3RyaW5nKCkpO1xuXHRcdFx0XHRcdFx0aWYgKEFycmF5LmlzQXJyYXkocmV0KSkge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByZXQubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gKHIgJiYgdHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nKSA/IHIuX3RvRG9jdW1lbnQoKSA6IHI7XG5cdFx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmIChyZXQgJiYgdHlwZW9mKHJldC5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gcmV0Ll90b0RvY3VtZW50KCk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXNwLnBheWxvYWQgPSBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpO1xuXG5cdFx0XHRcdFx0XHRyZXNwLmluc2VydCgpO1xuXG5cdFx0XHRcdFx0XHRvYmouc3RhdGUgPSBcInByb2Nlc3NlZFwiO1xuXHRcdFx0XHRcdFx0b2JqLnVwZGF0ZSgpO1xuXHRcdFx0XHRcdFx0cmV0dXJuIHJlc3A7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0XHRjb2RlOiBvYmouZ2V0VmFsdWUoXCJjb2RlXCIpLFxuXG5cdFx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRcdG5hbWU6IG9iai5nZXRWYWx1ZShcIm5hbWVcIiksXG5cblx0XHRcdFx0XHRcdHJlbWFyazogb2JqLmdldFZhbHVlKFwicmVtYXJrXCIpLFxuXG5cdFx0XHRcdFx0XHRtZWV0aW5nOiBvYmouZ2V0VmFsdWUoXCJtZWV0aW5nXCIpLFxuXG5cdFx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21Eb2N1bWVudChvYmopKTtcblx0XHRcdFx0XHQvKmdzLmluZm8oXCJNZWV0aW5nX01pbnV0ZS5fZnJvbURvY3VtZW50KCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0XHRcdHJldHVybiBnclJldDtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0XHRncy5pbmZvKFwiTWVldGluZ19NaW51dGUuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRcdHJldHVybiBvYmo7XG5cdFx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdFx0cmV0dXJuIG5ldyBwbGF0Zm9ybW1hbmFnZXJfTWVldGluZ19NaW51dGUoKS5fZnJvbURvY3VtZW50KG8pXG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqLmNvbnN0cnVjdG9yKSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdGlmIChvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIk9iamVjdFwiKSB7XG5cblx0XHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkob2JqKSkpKTtcblxuXHRcdFx0XHRcdC8qZ3MuaW5mbyhcIk1lZXRpbmdfTWludXRlLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5jb2RlKG9iai5jb2RlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5uYW1lKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLnJlbWFyaykpKTtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLnJlbWFyayk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubWVldGluZykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubWVldGluZyhuZXcgcGxhdGZvcm1tYW5hZ2VyX01lZXRpbmcoKS5fZnJvbURvY3VtZW50KG9iai5tZWV0aW5nKSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdH0gZWxzZSB7IC8vIGlmKG9iai5jb25zdHJ1Y3Rvci5uYW1lPT1cIk1lZXRpbmdfTWludXRlXCIpe1xuXHRcdFx0XHRcdGdzLmluZm8oXCJNZWV0aW5nX01pbnV0ZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGdzLmluZm8oXCJNZWV0aW5nX01pbnV0ZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0Z3MuaW5mbyhcIk1lZXRpbmdfTWludXRlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHRcdH1cblxuXHRcdC8qZ3MuaW5mbyhcIk1lZXRpbmdfTWludXRlLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0XHQvKmdzLmluZm8oXCJNZWV0aW5nX01pbnV0ZS5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfbmV3KGMpIHtcblx0XHRpZiAoIWMpIGMgPSB0aGlzLl9fdHlwZTtcblx0XHRpZiAoYy5pbmRleE9mKCdwbGF0Zm9ybW1hbmFnZXJfJykgIT0gMCkgYyA9ICh7XG5cdFx0XHRQbGF0Zm9ybTogXCJwbGF0Zm9ybW1hbmFnZXJfUGxhdGZvcm1cIixcblx0XHRcdFVzZXI6IFwicGxhdGZvcm1tYW5hZ2VyX1VzZXJcIixcblx0XHRcdFJlcXVpcmVtZW50OiBcInBsYXRmb3JtbWFuYWdlcl9SZXF1aXJlbWVudFwiLFxuXHRcdFx0RWZmb3J0X0VzdGltYXRlOiBcInBsYXRmb3JtbWFuYWdlcl9FZmZvcnRfRXN0aW1hdGVcIixcblx0XHRcdEVmZm9ydDogXCJwbGF0Zm9ybW1hbmFnZXJfRWZmb3J0XCIsXG5cdFx0XHRCdWRnZXQ6IFwicGxhdGZvcm1tYW5hZ2VyX0J1ZGdldFwiLFxuXHRcdFx0QWdlbmRhX0l0ZW06IFwicGxhdGZvcm1tYW5hZ2VyX0FnZW5kYV9JdGVtXCIsXG5cdFx0XHRNZWV0aW5nX0FnZW5kYTogXCJwbGF0Zm9ybW1hbmFnZXJfTWVldGluZ19BZ2VuZGFcIixcblx0XHRcdERlY2lzaW9uX09wdGlvbjogXCJwbGF0Zm9ybW1hbmFnZXJfRGVjaXNpb25fT3B0aW9uXCIsXG5cdFx0XHREZWNpc2lvbjogXCJwbGF0Zm9ybW1hbmFnZXJfRGVjaXNpb25cIixcblx0XHRcdE1lZXRpbmdfTWludXRlOiBcInBsYXRmb3JtbWFuYWdlcl9NZWV0aW5nX01pbnV0ZVwiLFxuXHRcdFx0TWVldGluZ19TZXJpZXM6IFwicGxhdGZvcm1tYW5hZ2VyX01lZXRpbmdfU2VyaWVzXCIsXG5cdFx0XHRNZWV0aW5nOiBcInBsYXRmb3JtbWFuYWdlcl9NZWV0aW5nXCIsXG5cdFx0XHRCb2FyZDogXCJwbGF0Zm9ybW1hbmFnZXJfQm9hcmRcIixcblx0XHRcdEJvYXJkX01lbWJlcjogXCJwbGF0Zm9ybW1hbmFnZXJfQm9hcmRfTWVtYmVyXCIsXG5cdFx0XHRGcmVxdWVuY3k6IFwicGxhdGZvcm1tYW5hZ2VyX0ZyZXF1ZW5jeVwiLFxuXHRcdFx0TW9kdWxlOiBcInBsYXRmb3JtbWFuYWdlcl9Nb2R1bGVcIixcblx0XHRcdENhcGFiaWxpdHk6IFwicGxhdGZvcm1tYW5hZ2VyX0NhcGFiaWxpdHlcIixcblx0XHRcdFRlYW06IFwicGxhdGZvcm1tYW5hZ2VyX1RlYW1cIixcblx0XHRcdFByb2plY3Q6IFwicGxhdGZvcm1tYW5hZ2VyX1Byb2plY3RcIixcblx0XHRcdFRlYW1fTWVtYmVyOiBcInBsYXRmb3JtbWFuYWdlcl9UZWFtX01lbWJlclwiLFxuXHRcdFx0Um9sZTogXCJwbGF0Zm9ybW1hbmFnZXJfUm9sZVwiLFxuXHRcdH0pW2NdO1xuXHRcdHJldHVybiBuZXcoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gZ2xvYmFsIDogeF83ODYxMV9wbGF0Zm9ybV8wKVtjXSgpO1xuXHR9XG5cblx0X3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5jb2RlID0gdGhpcy5jb2RlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9tZWV0aW5nKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5tZWV0aW5nID0gdGhpcy5tZWV0aW5nKCk7XG5cblx0XHRcdGlmIChyZXQubWVldGluZykge1xuXHRcdFx0XHRyZXQubWVldGluZyA9IHJldC5tZWV0aW5nLl90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0Lm1lZXRpbmcpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0Lm1lZXRpbmcpLmxlbmd0aCkgcmV0Lm1lZXRpbmcgPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0XHR9KTtcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGRlbGV0ZSByZXRba107XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3VuaXF1ZShrZXlzLCByZXQpIHtcblx0XHRyZXQgPSByZXQgfHwgbmV3IHBsYXRmb3JtbWFuYWdlcl9NZWV0aW5nX01pbnV0ZSgpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRcdGlmICgha2V5cykge1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLm1lZXRpbmcoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubWVldGluZyh0aGlzLm1lZXRpbmcoKS5fdW5pcXVlKCkpO1xuXG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImNvZGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJuYW1lXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubmFtZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInJlbWFya1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJtZWV0aW5nXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubWVldGluZygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5tZWV0aW5nKHRoaXMubWVldGluZygpLl91bmlxdWUoKSk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3F1ZXJ5KGdxKSB7XG5cdFx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF83ODYxMV9wbGF0Zm9ybV8wX21lZXRpbmdfbWludXRlJywgWycqJ10pWyd4Xzc4NjExX3BsYXRmb3JtXzBfbWVldGluZ19taW51dGUnXSk7XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EpIHRoaXMuX3F1ZXJ5R1EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkoJ3hfNzg2MTFfcGxhdGZvcm1fMF9tZWV0aW5nX21pbnV0ZScpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KSh0aGlzKSk7XG5cdFx0aWYgKGlkZiA9PSAnSWQnKSBpZGYgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3RpdmVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdFx0LyogZ3MuaW5mbyhcIk1lZXRpbmdfTWludXRlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdFx0LyogZ3MuaW5mbyhcIk1lZXRpbmdfTWludXRlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmFibGVkJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX2NvZGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmNvZGUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2NvZGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qIGdzLmluZm8oXCJNZWV0aW5nX01pbnV0ZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnY29kZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZGVyJykgPj0gMCkge1xuXHRcdFx0XHQvKiBncy5pbmZvKFwiTWVldGluZ19NaW51dGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2RhdGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qIGdzLmluZm8oXCJNZWV0aW5nX01pbnV0ZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGF0ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fbmFtZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9uYW1lX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5uYW1lKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCduYW1lJykgPj0gMCkge1xuXHRcdFx0XHQvKiBncy5pbmZvKFwiTWVldGluZ19NaW51dGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ25hbWUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX3JlbWFya19jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZW1hcmsnKSA+PSAwKSB7XG5cdFx0XHRcdC8qIGdzLmluZm8oXCJNZWV0aW5nX01pbnV0ZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3JlbWFyaycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9tZWV0aW5nKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fbWVldGluZ19jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm1lZXRpbmcoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJNZWV0aW5nIE1pbnV0ZVwiPT1cIkNvbHVtblwiKSBncy5pbmZvKFwiTWVldGluZ19NaW51dGUuX3F1ZXJ5KCk6IFwiKyBcIm1lZXRpbmcgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0Z3MuaW5mbyhcIk1lZXRpbmdfTWludXRlLl9xdWVyeSgpOiBcIiArIFwibWVldGluZ1ttZWV0aW5nXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLm1lZXRpbmcoKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbWVldGluZycpID49IDApIHtcblx0XHRcdFx0LyogZ3MuaW5mbyhcIk1lZXRpbmdfTWludXRlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbWVldGluZycpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbWVldGluZycpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdtZWV0aW5nJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0XHQvKiBncy5pbmZvKFwiTWVldGluZ19NaW51dGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdFx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG5cdH1cblxuXHRfc2F2ZShvYmopIHtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHBsYXRmb3JtbWFuYWdlcl9NZWV0aW5nX01pbnV0ZSgpLl9zYXZlKG8pXG5cdFx0fSk7XG5cblx0XHRsZXQgX29iaiA9IHt9O1xuXG5cdFx0Lypncy5pbmZvKFwiTWVldGluZ19NaW51dGUuX3NhdmUoKTogXCIrIFwiLi4uIFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfNzg2MTFfcGxhdGZvcm1fMF9tZWV0aW5nX21pbnV0ZScsIFsnKiddKVsneF83ODYxMV9wbGF0Zm9ybV8wX21lZXRpbmdfbWludXRlJ10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0XHR9KTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdFx0Z3MuaW5mbyhcIk1lZXRpbmdfTWludXRlLl9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHRcdGdzLmluZm8oXCJNZWV0aW5nX01pbnV0ZS5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGxldCBfdGhpcyA9IG51bGw7XG5cdFx0aWYgKG9iai5fX2tleXMpIHtcblx0XHRcdGxldCBrT2JqID0ge307XG5cdFx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpKSk7XG5cdFx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHRrT2JqW2tdID0gX29ialtrXVxuXHRcdFx0fSk7XG5cdFx0XHRfdGhpcyA9IG5ldyBwbGF0Zm9ybW1hbmFnZXJfTWVldGluZ19NaW51dGUoKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfdGhpcyA9IG5ldyBwbGF0Zm9ybW1hbmFnZXJfTWVldGluZ19NaW51dGUoKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0XHR9XG5cblx0XHQvKmdzLmluZm8oXCJNZWV0aW5nX01pbnV0ZS5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdFx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRcdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHRcdHRyeSB7XG5cdFx0XHRncy5pbmZvKFwiTWVldGluZ19NaW51dGUuX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRcdHJldHVybiBrLnRvTG93ZXJDYXNlKCkgIT0gaztcblx0XHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHRncy5pbmZvKFwiTWVldGluZ19NaW51dGUuX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSk7XG5cblx0XHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICd4Xzc4NjExX3BsYXRmb3JtXzBfbWVldGluZ19taW51dGUnKTtcblx0XHRcdC8qZ3MuaW5mbyhcIk1lZXRpbmdfTWludXRlLl9zYXZlKCk6IFwiKyBcInVwc2VydGluZy4uLiBcIisgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTsqL1xuXHRcdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRcdGdxID0gZ3Eud2hlcmUoJ3N5c19pZCcsIF9vYmouc3lzX2lkKS51cGRhdGUoX29iaik7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0XHRncSA9IGdxLmluc2VydChfb2JqKTtcblx0XHRcdH1cblx0XHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdFx0X2ZPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSkpKTtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChfb2JqID0gT2JqZWN0LmFzc2lnbihfZk9iaiwgZ3EuZ2V0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfNzg2MTFfcGxhdGZvcm1fMF9tZWV0aW5nX21pbnV0ZScsIFsnKiddKVsneF83ODYxMV9wbGF0Zm9ybV8wX21lZXRpbmdfbWludXRlJ10pKSkpO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRncy5pbmZvKFwiTWVldGluZ19NaW51dGUuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiZXg6IFwiICsgSlNPTi5zdHJpbmdpZnkoZXgsIG51bGwsIDQpKTtcblx0XHRcdGdzLmluZm8oXCJNZWV0aW5nX01pbnV0ZS5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH1cblxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogTWVldGluZ19NaW51dGUuc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzdG9yZShfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKGxvZ09iaikge1xuXHRcdFx0Z3MuaW5mbyhcIk1lZXRpbmdfTWludXRlLnN0b3JlKCk6IFwiICsgXCJsb2dPYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkobG9nT2JqLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0Z3MuaW5mbyhcIk1lZXRpbmdfTWludXRlLnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Z3MuaW5mbyhcIk1lZXRpbmdfTWludXRlLnN0b3JlKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHRncy5pbmZvKFwiTWVldGluZ19NaW51dGUuc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdFx0bGV0IF90aGlzID0gdGhpcy5fdW5pcXVlKCkuZmluZCgpO1xuXHRcdFx0aWYgKF90aGlzKSB0aGlzLklkID0gX3RoaXMuSWQ7XG5cblx0XHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1lZXRpbmdfTWludXRlLmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kQWxsKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obG9nT2JqKSB7XG5cdFx0XHRncy5pbmZvKFwiTWVldGluZ19NaW51dGUuZmluZEFsbCgpOiBcIiArIFwibG9nT2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KGxvZ09iaiwgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdGdzLmluZm8oXCJNZWV0aW5nX01pbnV0ZS5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Z3MuaW5mbyhcIk1lZXRpbmdfTWludXRlLmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdGdzLmluZm8oXCJNZWV0aW5nX01pbnV0ZS5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIGZpbmRBbGwgbG9jYWxseVxuXHRcdFx0bGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKFwiTWVldGluZ19NaW51dGVcIik7XG5cdFx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfNzg2MTFfcGxhdGZvcm1fMF9tZWV0aW5nX21pbnV0ZScsIFsnKiddKVsneF83ODYxMV9wbGF0Zm9ybV8wX21lZXRpbmdfbWludXRlJ10pKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1lZXRpbmdfTWludXRlLmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obG9nT2JqKSB7XG5cdFx0XHRncy5pbmZvKFwiTWVldGluZ19NaW51dGUuZmluZCgpOiBcIiArIFwibG9nT2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KGxvZ09iaiwgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdGdzLmluZm8oXCJNZWV0aW5nX01pbnV0ZS5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Z3MuaW5mbyhcIk1lZXRpbmdfTWludXRlLmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdGdzLmluZm8oXCJNZWV0aW5nX01pbnV0ZS5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic3lzX25hbWUiOiJwbGF0Zm9ybW1hbmFnZXJfRWZmb3J0X0VzdGltYXRlIiwiYXBpX25hbWUiOiJ4Xzc4NjExX3BsYXRmb3JtXzAucGxhdGZvcm1tYW5hZ2VyX0VmZm9ydF9Fc3RpbWF0ZSIsIm5hbWUiOiJwbGF0Zm9ybW1hbmFnZXJfRWZmb3J0X0VzdGltYXRlIiwic2NyaXB0IjoiY2xhc3MgcGxhdGZvcm1tYW5hZ2VyX0VmZm9ydF9Fc3RpbWF0ZSB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7XG5cdFx0dW5kZWZpbmVkXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIlwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJwbGF0Zm9ybW1hbmFnZXJfRWZmb3J0X0VzdGltYXRlXCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJwbGF0Zm9ybW1hbmFnZXJcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInBsYXRmb3JtbWFuYWdlclwiO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRWZmb3J0X0VzdGltYXRlLmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdGl2ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYWN0aXZlID0gdjtcblx0XHRcdHRoaXMuX2FjdGl2ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3RpdmU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRWZmb3J0X0VzdGltYXRlLmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmFibGVkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lbmFibGVkID0gdjtcblx0XHRcdHRoaXMuX2VuYWJsZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5hYmxlZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBFZmZvcnRfRXN0aW1hdGUuY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEVmZm9ydF9Fc3RpbWF0ZS5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG9yZGVyKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9vcmRlciA9IHY7XG5cdFx0XHR0aGlzLl9vcmRlcl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9vcmRlcjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBFZmZvcnRfRXN0aW1hdGUuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRhdGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvL2dzLmluZm8oXCJFZmZvcnRfRXN0aW1hdGUuZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEVmZm9ydF9Fc3RpbWF0ZS5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRWZmb3J0X0VzdGltYXRlLnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlbWFyayh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVtYXJrID0gdjtcblx0XHRcdHRoaXMuX3JlbWFya19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZW1hcms7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRWZmb3J0X0VzdGltYXRlLnBlcnNvbkRheSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHBlcnNvbkRheSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcGVyc29uRGF5ID0gdjtcblx0XHRcdHRoaXMuX3BlcnNvbkRheV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9wZXJzb25EYXk7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRWZmb3J0X0VzdGltYXRlLmVmZm9ydCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVmZm9ydCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZWZmb3J0ID0gdjtcblx0XHRcdHRoaXMuX2VmZm9ydF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lZmZvcnQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRWZmb3J0X0VzdGltYXRlLnJlcXVpcmVtZW50IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVxdWlyZW1lbnQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlcXVpcmVtZW50ID0gdjtcblx0XHRcdHRoaXMuX3JlcXVpcmVtZW50X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlcXVpcmVtZW50O1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEVmZm9ydF9Fc3RpbWF0ZS5yb2xlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cm9sZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcm9sZSA9IHY7XG5cdFx0XHR0aGlzLl9yb2xlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JvbGU7XG5cdFx0fVxuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2NvZGUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3JlbWFyaycgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodGhpcy5fcGVyc29uRGF5KSByZXQgKz0gJ14nICsgc1BhdGggKyAncGVyc29uRGF5JyArICh0aGlzLl9wZXJzb25EYXlfY29vcCB8fCAnPScpICsgdGhpcy5wZXJzb25EYXkoKTtcblxuXHRcdGlmICh0aGlzLl9lZmZvcnQpIHJldCArPSAvKih0aGlzLl9lZmZvcnRfY29vcCB8fCAnPScpICsgKi8gdGhpcy5lZmZvcnQoKS5fdG9FUXVlcnkoc1BhdGggKyAnZWZmb3J0LicpO1xuXG5cdFx0aWYgKHRoaXMuX3JlcXVpcmVtZW50KSByZXQgKz0gLyoodGhpcy5fcmVxdWlyZW1lbnRfY29vcCB8fCAnPScpICsgKi8gdGhpcy5yZXF1aXJlbWVudCgpLl90b0VRdWVyeShzUGF0aCArICdyZXF1aXJlbWVudC4nKTtcblxuXHRcdGlmICh0aGlzLl9yb2xlKSByZXQgKz0gLyoodGhpcy5fcm9sZV9jb29wIHx8ICc9JykgKyAqLyB0aGlzLnJvbGUoKS5fdG9FUXVlcnkoc1BhdGggKyAncm9sZS4nKTtcblxuXHRcdGdzLmluZm8oXCJFZmZvcnRfRXN0aW1hdGUuX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSByZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHRncy5pbmZvKFwiRWZmb3J0X0VzdGltYXRlLl9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0Z3MuaW5mbyhcIkVmZm9ydF9Fc3RpbWF0ZS5faW52b2tlKCk6IFwiICsgXCJpbnZhbGlkIG1ldGhvZCBcIiArIG1ldGhvZCk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzOyAvLyB0ZXN0XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHBsYXRmb3JtbWFuYWdlcl9FZmZvcnRfRXN0aW1hdGUoKS5fZnJvbURvY3VtZW50KG8pKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKG9iaikgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHR0cnkge1xuXHRcdFx0XHRvYmogPSBKU09OLnBhcnNlKG9iaik7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHQvKmdzLmluZm8oXCJFZmZvcnRfRXN0aW1hdGUuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdFx0fTtcblx0XHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRcdFx0aWYgKG9iai5nZXRUYWJsZU5hbWUoKSA9PSAnZWNjX3F1ZXVlJyAmJiBcIkVmZm9ydF9Fc3RpbWF0ZVwiICE9ICdlY2NfcXVldWUnICYmIG9iai5zb3VyY2UgPT0gXCJFZmZvcnRfRXN0aW1hdGVcIikge1xuXHRcdFx0XHRcdFx0b2JqLnN0YXRlID0gXCJwcm9jZXNzaW5nXCI7XG5cdFx0XHRcdFx0XHRvYmoudXBkYXRlKCk7XG5cblx0XHRcdFx0XHRcdGxldCByZXNwID0gbmV3IEdsaWRlUmVjb3JkKCdlY2NfcXVldWUnKTtcblx0XHRcdFx0XHRcdHJlc3AucmVzcG9uc2VfdG8gPSBvYmouc3lzX2lkO1xuXHRcdFx0XHRcdFx0cmVzcC5xdWV1ZSA9ICdvdXRwdXQnO1xuXHRcdFx0XHRcdFx0cmVzcC5hZ2VudCA9IG9iai5hZ2VudDtcblx0XHRcdFx0XHRcdHJlc3AudG9waWMgPSBvYmoudG9waWM7XG5cdFx0XHRcdFx0XHRyZXNwLm5hbWUgPSBvYmoubmFtZTtcblx0XHRcdFx0XHRcdHJlc3Auc291cmNlID0gb2JqLnNvdXJjZTtcblx0XHRcdFx0XHRcdHJlc3AuZnJvbV9ob3N0ID0gb2JqLmFnZW50X2NvcnJlbGF0b3I7XG5cdFx0XHRcdFx0XHRyZXNwLmFnZW50X2NvcnJlbGF0b3IgPSBvYmouZnJvbV9ob3N0O1xuXG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gbmV3IHBsYXRmb3JtbWFuYWdlcl9FZmZvcnRfRXN0aW1hdGUoKS5fZnJvbURvY3VtZW50KCkuX2ludm9rZShvYmoubmFtZS50b1N0cmluZygpLCBvYmoucGF5bG9hZC50b1N0cmluZygpKTtcblx0XHRcdFx0XHRcdGlmIChBcnJheS5pc0FycmF5KHJldCkpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gcmV0Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIChyICYmIHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJykgPyByLl90b0RvY3VtZW50KCkgOiByO1xuXHRcdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAocmV0ICYmIHR5cGVvZihyZXQuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHJldC5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmVzcC5wYXlsb2FkID0gSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KTtcblxuXHRcdFx0XHRcdFx0cmVzcC5pbnNlcnQoKTtcblxuXHRcdFx0XHRcdFx0b2JqLnN0YXRlID0gXCJwcm9jZXNzZWRcIjtcblx0XHRcdFx0XHRcdG9iai51cGRhdGUoKTtcblx0XHRcdFx0XHRcdHJldHVybiByZXNwO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdFx0Y29kZTogb2JqLmdldFZhbHVlKFwiY29kZVwiKSxcblxuXHRcdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0XHRyZW1hcms6IG9iai5nZXRWYWx1ZShcInJlbWFya1wiKSxcblxuXHRcdFx0XHRcdFx0cGVyc29uRGF5OiBvYmouZ2V0VmFsdWUoXCJwZXJzb25EYXlcIiksXG5cblx0XHRcdFx0XHRcdGVmZm9ydDogb2JqLmdldFZhbHVlKFwiZWZmb3J0XCIpLFxuXG5cdFx0XHRcdFx0XHRyZXF1aXJlbWVudDogb2JqLmdldFZhbHVlKFwicmVxdWlyZW1lbnRcIiksXG5cblx0XHRcdFx0XHRcdHJvbGU6IG9iai5nZXRWYWx1ZShcInJvbGVcIiksXG5cblx0XHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbURvY3VtZW50KG9iaikpO1xuXHRcdFx0XHRcdC8qZ3MuaW5mbyhcIkVmZm9ydF9Fc3RpbWF0ZS5fZnJvbURvY3VtZW50KCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0XHRcdHJldHVybiBnclJldDtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0XHRncy5pbmZvKFwiRWZmb3J0X0VzdGltYXRlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0XHRyZXR1cm4gb2JqO1xuXHRcdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRcdHJldHVybiBuZXcgcGxhdGZvcm1tYW5hZ2VyX0VmZm9ydF9Fc3RpbWF0ZSgpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdFx0Lypncy5pbmZvKFwiRWZmb3J0X0VzdGltYXRlLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5jb2RlKG9iai5jb2RlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5uYW1lKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLnJlbWFyaykpKTtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLnJlbWFyayk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucGVyc29uRGF5KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5wZXJzb25EYXkob2JqLnBlcnNvbkRheSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZWZmb3J0KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5lZmZvcnQobmV3IHBsYXRmb3JtbWFuYWdlcl9FZmZvcnQoKS5fZnJvbURvY3VtZW50KG9iai5lZmZvcnQpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZXF1aXJlbWVudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVxdWlyZW1lbnQobmV3IHBsYXRmb3JtbWFuYWdlcl9SZXF1aXJlbWVudCgpLl9mcm9tRG9jdW1lbnQob2JqLnJlcXVpcmVtZW50KSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucm9sZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMucm9sZShuZXcgcGxhdGZvcm1tYW5hZ2VyX1JvbGUoKS5fZnJvbURvY3VtZW50KG9iai5yb2xlKSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdH0gZWxzZSB7IC8vIGlmKG9iai5jb25zdHJ1Y3Rvci5uYW1lPT1cIkVmZm9ydF9Fc3RpbWF0ZVwiKXtcblx0XHRcdFx0XHRncy5pbmZvKFwiRWZmb3J0X0VzdGltYXRlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Z3MuaW5mbyhcIkVmZm9ydF9Fc3RpbWF0ZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0Z3MuaW5mbyhcIkVmZm9ydF9Fc3RpbWF0ZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0XHR9XG5cblx0XHQvKmdzLmluZm8oXCJFZmZvcnRfRXN0aW1hdGUuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHRcdC8qZ3MuaW5mbyhcIkVmZm9ydF9Fc3RpbWF0ZS5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfbmV3KGMpIHtcblx0XHRpZiAoIWMpIGMgPSB0aGlzLl9fdHlwZTtcblx0XHRpZiAoYy5pbmRleE9mKCdwbGF0Zm9ybW1hbmFnZXJfJykgIT0gMCkgYyA9ICh7XG5cdFx0XHRQbGF0Zm9ybTogXCJwbGF0Zm9ybW1hbmFnZXJfUGxhdGZvcm1cIixcblx0XHRcdFVzZXI6IFwicGxhdGZvcm1tYW5hZ2VyX1VzZXJcIixcblx0XHRcdFJlcXVpcmVtZW50OiBcInBsYXRmb3JtbWFuYWdlcl9SZXF1aXJlbWVudFwiLFxuXHRcdFx0RWZmb3J0X0VzdGltYXRlOiBcInBsYXRmb3JtbWFuYWdlcl9FZmZvcnRfRXN0aW1hdGVcIixcblx0XHRcdEVmZm9ydDogXCJwbGF0Zm9ybW1hbmFnZXJfRWZmb3J0XCIsXG5cdFx0XHRCdWRnZXQ6IFwicGxhdGZvcm1tYW5hZ2VyX0J1ZGdldFwiLFxuXHRcdFx0QWdlbmRhX0l0ZW06IFwicGxhdGZvcm1tYW5hZ2VyX0FnZW5kYV9JdGVtXCIsXG5cdFx0XHRNZWV0aW5nX0FnZW5kYTogXCJwbGF0Zm9ybW1hbmFnZXJfTWVldGluZ19BZ2VuZGFcIixcblx0XHRcdERlY2lzaW9uX09wdGlvbjogXCJwbGF0Zm9ybW1hbmFnZXJfRGVjaXNpb25fT3B0aW9uXCIsXG5cdFx0XHREZWNpc2lvbjogXCJwbGF0Zm9ybW1hbmFnZXJfRGVjaXNpb25cIixcblx0XHRcdE1lZXRpbmdfTWludXRlOiBcInBsYXRmb3JtbWFuYWdlcl9NZWV0aW5nX01pbnV0ZVwiLFxuXHRcdFx0TWVldGluZ19TZXJpZXM6IFwicGxhdGZvcm1tYW5hZ2VyX01lZXRpbmdfU2VyaWVzXCIsXG5cdFx0XHRNZWV0aW5nOiBcInBsYXRmb3JtbWFuYWdlcl9NZWV0aW5nXCIsXG5cdFx0XHRCb2FyZDogXCJwbGF0Zm9ybW1hbmFnZXJfQm9hcmRcIixcblx0XHRcdEJvYXJkX01lbWJlcjogXCJwbGF0Zm9ybW1hbmFnZXJfQm9hcmRfTWVtYmVyXCIsXG5cdFx0XHRGcmVxdWVuY3k6IFwicGxhdGZvcm1tYW5hZ2VyX0ZyZXF1ZW5jeVwiLFxuXHRcdFx0TW9kdWxlOiBcInBsYXRmb3JtbWFuYWdlcl9Nb2R1bGVcIixcblx0XHRcdENhcGFiaWxpdHk6IFwicGxhdGZvcm1tYW5hZ2VyX0NhcGFiaWxpdHlcIixcblx0XHRcdFRlYW06IFwicGxhdGZvcm1tYW5hZ2VyX1RlYW1cIixcblx0XHRcdFByb2plY3Q6IFwicGxhdGZvcm1tYW5hZ2VyX1Byb2plY3RcIixcblx0XHRcdFRlYW1fTWVtYmVyOiBcInBsYXRmb3JtbWFuYWdlcl9UZWFtX01lbWJlclwiLFxuXHRcdFx0Um9sZTogXCJwbGF0Zm9ybW1hbmFnZXJfUm9sZVwiLFxuXHRcdH0pW2NdO1xuXHRcdHJldHVybiBuZXcoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gZ2xvYmFsIDogeF83ODYxMV9wbGF0Zm9ybV8wKVtjXSgpO1xuXHR9XG5cblx0X3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5jb2RlID0gdGhpcy5jb2RlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9wZXJzb25EYXkpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnBlcnNvbkRheSA9IHRoaXMucGVyc29uRGF5KCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VmZm9ydCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZWZmb3J0ID0gdGhpcy5lZmZvcnQoKTtcblxuXHRcdFx0aWYgKHJldC5lZmZvcnQpIHtcblx0XHRcdFx0cmV0LmVmZm9ydCA9IHJldC5lZmZvcnQuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQuZWZmb3J0KSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5lZmZvcnQpLmxlbmd0aCkgcmV0LmVmZm9ydCA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlcXVpcmVtZW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5yZXF1aXJlbWVudCA9IHRoaXMucmVxdWlyZW1lbnQoKTtcblxuXHRcdFx0aWYgKHJldC5yZXF1aXJlbWVudCkge1xuXHRcdFx0XHRyZXQucmVxdWlyZW1lbnQgPSByZXQucmVxdWlyZW1lbnQuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQucmVxdWlyZW1lbnQpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LnJlcXVpcmVtZW50KS5sZW5ndGgpIHJldC5yZXF1aXJlbWVudCA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JvbGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnJvbGUgPSB0aGlzLnJvbGUoKTtcblxuXHRcdFx0aWYgKHJldC5yb2xlKSB7XG5cdFx0XHRcdHJldC5yb2xlID0gcmV0LnJvbGUuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQucm9sZSkgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQucm9sZSkubGVuZ3RoKSByZXQucm9sZSA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHRcdH0pO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0ZGVsZXRlIHJldFtrXTtcblx0XHR9KTtcblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfdW5pcXVlKGtleXMsIHJldCkge1xuXHRcdHJldCA9IHJldCB8fCBuZXcgcGxhdGZvcm1tYW5hZ2VyX0VmZm9ydF9Fc3RpbWF0ZSgpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRcdGlmICgha2V5cykge1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3RpdmVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3RpdmUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aXZlKHRoaXMuYWN0aXZlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJjb2RlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm9yZGVyXCIpID49IDAgJiYgdHlwZW9mKHRoaXMub3JkZXIoKSkgIT09ICd1bmRlZmluZWQnKSByZXQub3JkZXIodGhpcy5vcmRlcigpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImRhdGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYXRlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhdGUodGhpcy5kYXRlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwibmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJyZW1hcmtcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZW1hcmsoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVtYXJrKHRoaXMucmVtYXJrKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicGVyc29uRGF5XCIpID49IDAgJiYgdHlwZW9mKHRoaXMucGVyc29uRGF5KCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnBlcnNvbkRheSh0aGlzLnBlcnNvbkRheSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImVmZm9ydFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVmZm9ydCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lZmZvcnQodGhpcy5lZmZvcnQoKS5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVxdWlyZW1lbnRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZXF1aXJlbWVudCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZXF1aXJlbWVudCh0aGlzLnJlcXVpcmVtZW50KCkuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInJvbGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yb2xlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJvbGUodGhpcy5yb2xlKCkuX3VuaXF1ZSgpKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfcXVlcnkoZ3EpIHtcblx0XHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4Xzc4NjExX3BsYXRmb3JtXzBfZWZmb3J0X2VzdGltYXRlJywgWycqJ10pWyd4Xzc4NjExX3BsYXRmb3JtXzBfZWZmb3J0X2VzdGltYXRlJ10pO1xuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCd4Xzc4NjExX3BsYXRmb3JtXzBfZWZmb3J0X2VzdGltYXRlJyk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKHRoaXMpKTtcblx0XHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0XHQvKiBncy5pbmZvKFwiRWZmb3J0X0VzdGltYXRlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdFx0LyogZ3MuaW5mbyhcIkVmZm9ydF9Fc3RpbWF0ZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5hYmxlZCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fY29kZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9jb2RlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5jb2RlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdjb2RlJykgPj0gMCkge1xuXHRcdFx0XHQvKiBncy5pbmZvKFwiRWZmb3J0X0VzdGltYXRlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdjb2RlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHRcdC8qIGdzLmluZm8oXCJFZmZvcnRfRXN0aW1hdGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2RhdGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qIGdzLmluZm8oXCJFZmZvcnRfRXN0aW1hdGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX25hbWVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbmFtZScpID49IDApIHtcblx0XHRcdFx0LyogZ3MuaW5mbyhcIkVmZm9ydF9Fc3RpbWF0ZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3JlbWFyaycpID49IDApIHtcblx0XHRcdFx0LyogZ3MuaW5mbyhcIkVmZm9ydF9Fc3RpbWF0ZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3JlbWFyaycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9wZXJzb25EYXkpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9wZXJzb25EYXlfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5wZXJzb25EYXkoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3BlcnNvbmRheScpID49IDApIHtcblx0XHRcdFx0LyogZ3MuaW5mbyhcIkVmZm9ydF9Fc3RpbWF0ZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3BlcnNvbmRheScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncGVyc29uZGF5Jyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3BlcnNvbmRheScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lZmZvcnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9lZmZvcnRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5lZmZvcnQoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJFZmZvcnQgRXN0aW1hdGVcIj09XCJDb2x1bW5cIikgZ3MuaW5mbyhcIkVmZm9ydF9Fc3RpbWF0ZS5fcXVlcnkoKTogXCIrIFwiZWZmb3J0IFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdGdzLmluZm8oXCJFZmZvcnRfRXN0aW1hdGUuX3F1ZXJ5KCk6IFwiICsgXCJlZmZvcnRbZWZmb3J0XSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLmVmZm9ydCgpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlZmZvcnQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qIGdzLmluZm8oXCJFZmZvcnRfRXN0aW1hdGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlZmZvcnQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VmZm9ydCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlZmZvcnQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVxdWlyZW1lbnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yZXF1aXJlbWVudF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnJlcXVpcmVtZW50KCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiRWZmb3J0IEVzdGltYXRlXCI9PVwiQ29sdW1uXCIpIGdzLmluZm8oXCJFZmZvcnRfRXN0aW1hdGUuX3F1ZXJ5KCk6IFwiKyBcInJlcXVpcmVtZW50IFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdGdzLmluZm8oXCJFZmZvcnRfRXN0aW1hdGUuX3F1ZXJ5KCk6IFwiICsgXCJyZXF1aXJlbWVudFtyZXF1aXJlbWVudF0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5yZXF1aXJlbWVudCgpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZXF1aXJlbWVudCcpID49IDApIHtcblx0XHRcdFx0LyogZ3MuaW5mbyhcIkVmZm9ydF9Fc3RpbWF0ZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlcXVpcmVtZW50Jyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZXF1aXJlbWVudCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZXF1aXJlbWVudCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yb2xlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcm9sZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnJvbGUoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJFZmZvcnQgRXN0aW1hdGVcIj09XCJDb2x1bW5cIikgZ3MuaW5mbyhcIkVmZm9ydF9Fc3RpbWF0ZS5fcXVlcnkoKTogXCIrIFwicm9sZSBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHRncy5pbmZvKFwiRWZmb3J0X0VzdGltYXRlLl9xdWVyeSgpOiBcIiArIFwicm9sZVtyb2xlXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLnJvbGUoKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncm9sZScpID49IDApIHtcblx0XHRcdFx0LyogZ3MuaW5mbyhcIkVmZm9ydF9Fc3RpbWF0ZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JvbGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3JvbGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncm9sZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdFx0LyogZ3MuaW5mbyhcIkVmZm9ydF9Fc3RpbWF0ZS5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0XHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcblx0fVxuXG5cdF9zYXZlKG9iaikge1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdHJldHVybiBuZXcgcGxhdGZvcm1tYW5hZ2VyX0VmZm9ydF9Fc3RpbWF0ZSgpLl9zYXZlKG8pXG5cdFx0fSk7XG5cblx0XHRsZXQgX29iaiA9IHt9O1xuXG5cdFx0Lypncy5pbmZvKFwiRWZmb3J0X0VzdGltYXRlLl9zYXZlKCk6IFwiKyBcIi4uLiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4Xzc4NjExX3BsYXRmb3JtXzBfZWZmb3J0X2VzdGltYXRlJywgWycqJ10pWyd4Xzc4NjExX3BsYXRmb3JtXzBfZWZmb3J0X2VzdGltYXRlJ10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0XHR9KTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdFx0Z3MuaW5mbyhcIkVmZm9ydF9Fc3RpbWF0ZS5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0XHRncy5pbmZvKFwiRWZmb3J0X0VzdGltYXRlLl9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0bGV0IF90aGlzID0gbnVsbDtcblx0XHRpZiAob2JqLl9fa2V5cykge1xuXHRcdFx0bGV0IGtPYmogPSB7fTtcblx0XHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSkpKTtcblx0XHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0XHR9KTtcblx0XHRcdF90aGlzID0gbmV3IHBsYXRmb3JtbWFuYWdlcl9FZmZvcnRfRXN0aW1hdGUoKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfdGhpcyA9IG5ldyBwbGF0Zm9ybW1hbmFnZXJfRWZmb3J0X0VzdGltYXRlKCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdFx0fVxuXG5cdFx0Lypncy5pbmZvKFwiRWZmb3J0X0VzdGltYXRlLl9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0XHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdFx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdFx0dHJ5IHtcblx0XHRcdGdzLmluZm8oXCJFZmZvcnRfRXN0aW1hdGUuX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRcdHJldHVybiBrLnRvTG93ZXJDYXNlKCkgIT0gaztcblx0XHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHRncy5pbmZvKFwiRWZmb3J0X0VzdGltYXRlLl9zYXZlKCk6IFwiICsgXCJyZW5hbWluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0pO1xuXG5cdFx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAneF83ODYxMV9wbGF0Zm9ybV8wX2VmZm9ydF9lc3RpbWF0ZScpO1xuXHRcdFx0Lypncy5pbmZvKFwiRWZmb3J0X0VzdGltYXRlLl9zYXZlKCk6IFwiKyBcInVwc2VydGluZy4uLiBcIisgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTsqL1xuXHRcdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRcdGdxID0gZ3Eud2hlcmUoJ3N5c19pZCcsIF9vYmouc3lzX2lkKS51cGRhdGUoX29iaik7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0XHRncSA9IGdxLmluc2VydChfb2JqKTtcblx0XHRcdH1cblx0XHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdFx0X2ZPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSkpKTtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChfb2JqID0gT2JqZWN0LmFzc2lnbihfZk9iaiwgZ3EuZ2V0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfNzg2MTFfcGxhdGZvcm1fMF9lZmZvcnRfZXN0aW1hdGUnLCBbJyonXSlbJ3hfNzg2MTFfcGxhdGZvcm1fMF9lZmZvcnRfZXN0aW1hdGUnXSkpKSk7XG5cdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdGdzLmluZm8oXCJFZmZvcnRfRXN0aW1hdGUuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiZXg6IFwiICsgSlNPTi5zdHJpbmdpZnkoZXgsIG51bGwsIDQpKTtcblx0XHRcdGdzLmluZm8oXCJFZmZvcnRfRXN0aW1hdGUuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEVmZm9ydF9Fc3RpbWF0ZS5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHN0b3JlKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obG9nT2JqKSB7XG5cdFx0XHRncy5pbmZvKFwiRWZmb3J0X0VzdGltYXRlLnN0b3JlKCk6IFwiICsgXCJsb2dPYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkobG9nT2JqLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0Z3MuaW5mbyhcIkVmZm9ydF9Fc3RpbWF0ZS5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGdzLmluZm8oXCJFZmZvcnRfRXN0aW1hdGUuc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdGdzLmluZm8oXCJFZmZvcnRfRXN0aW1hdGUuc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdFx0bGV0IF90aGlzID0gdGhpcy5fdW5pcXVlKCkuZmluZCgpO1xuXHRcdFx0aWYgKF90aGlzKSB0aGlzLklkID0gX3RoaXMuSWQ7XG5cblx0XHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEVmZm9ydF9Fc3RpbWF0ZS5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZEFsbChfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKGxvZ09iaikge1xuXHRcdFx0Z3MuaW5mbyhcIkVmZm9ydF9Fc3RpbWF0ZS5maW5kQWxsKCk6IFwiICsgXCJsb2dPYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkobG9nT2JqLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0Z3MuaW5mbyhcIkVmZm9ydF9Fc3RpbWF0ZS5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Z3MuaW5mbyhcIkVmZm9ydF9Fc3RpbWF0ZS5maW5kQWxsKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHRncy5pbmZvKFwiRWZmb3J0X0VzdGltYXRlLmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoXCJFZmZvcnRfRXN0aW1hdGVcIik7XG5cdFx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfNzg2MTFfcGxhdGZvcm1fMF9lZmZvcnRfZXN0aW1hdGUnLCBbJyonXSlbJ3hfNzg2MTFfcGxhdGZvcm1fMF9lZmZvcnRfZXN0aW1hdGUnXSkpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRWZmb3J0X0VzdGltYXRlLmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obG9nT2JqKSB7XG5cdFx0XHRncy5pbmZvKFwiRWZmb3J0X0VzdGltYXRlLmZpbmQoKTogXCIgKyBcImxvZ09iajogXCIgKyBKU09OLnN0cmluZ2lmeShsb2dPYmosIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHRncy5pbmZvKFwiRWZmb3J0X0VzdGltYXRlLmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRncy5pbmZvKFwiRWZmb3J0X0VzdGltYXRlLmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdGdzLmluZm8oXCJFZmZvcnRfRXN0aW1hdGUuZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG59In0seyJhY3RpdmUiOnRydWUsImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInN5c19uYW1lIjoicGxhdGZvcm1tYW5hZ2VyX01lZXRpbmciLCJhcGlfbmFtZSI6InhfNzg2MTFfcGxhdGZvcm1fMC5wbGF0Zm9ybW1hbmFnZXJfTWVldGluZyIsIm5hbWUiOiJwbGF0Zm9ybW1hbmFnZXJfTWVldGluZyIsInNjcmlwdCI6ImNsYXNzIHBsYXRmb3JtbWFuYWdlcl9NZWV0aW5nIHtcblx0Y29uc3RydWN0b3IoaWQpIHtcblx0XHR1bmRlZmluZWRcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInBsYXRmb3JtbWFuYWdlcl9NZWV0aW5nXCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJwbGF0Zm9ybW1hbmFnZXJcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInBsYXRmb3JtbWFuYWdlclwiO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogTWVldGluZy5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1lZXRpbmcuZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVuYWJsZWQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2VuYWJsZWQgPSB2O1xuXHRcdFx0dGhpcy5fZW5hYmxlZF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lbmFibGVkO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1lZXRpbmcuY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1lZXRpbmcub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogTWVldGluZy5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGF0ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vZ3MuaW5mbyhcIk1lZXRpbmcuZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1lZXRpbmcubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG5hbWUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX25hbWUgPSB2O1xuXHRcdFx0dGhpcy5fbmFtZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9uYW1lO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1lZXRpbmcucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNZWV0aW5nLnN0YXJ0IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RhcnQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvL2dzLmluZm8oXCJNZWV0aW5nLnN0YXJ0KCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fc3RhcnQgPSB2O1xuXHRcdFx0dGhpcy5fc3RhcnRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fc3RhcnQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogTWVldGluZy5lbmQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvL2dzLmluZm8oXCJNZWV0aW5nLmVuZCgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2VuZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5kO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1lZXRpbmcuc3RhcnRlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHN0YXJ0ZWQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvL2dzLmluZm8oXCJNZWV0aW5nLnN0YXJ0ZWQoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9zdGFydGVkID0gdjtcblx0XHRcdHRoaXMuX3N0YXJ0ZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fc3RhcnRlZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNZWV0aW5nLmVuZGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5kZWQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvL2dzLmluZm8oXCJNZWV0aW5nLmVuZGVkKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZW5kZWQgPSB2O1xuXHRcdFx0dGhpcy5fZW5kZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5kZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogTWVldGluZy5zZXJpZXMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzZXJpZXModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3NlcmllcyA9IHY7XG5cdFx0XHR0aGlzLl9zZXJpZXNfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fc2VyaWVzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1lZXRpbmcub3JnYW5pemVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JnYW5pemVyKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9vcmdhbml6ZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JnYW5pemVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZ2FuaXplcjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNZWV0aW5nLm1vZGVyYXRvciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG1vZGVyYXRvcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbW9kZXJhdG9yID0gdjtcblx0XHRcdHRoaXMuX21vZGVyYXRvcl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9tb2RlcmF0b3I7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogTWVldGluZy5wcm9qZWN0IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cHJvamVjdCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcHJvamVjdCA9IHY7XG5cdFx0XHR0aGlzLl9wcm9qZWN0X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3Byb2plY3Q7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogTWVldGluZy5ib2FyZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGJvYXJkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9ib2FyZCA9IHY7XG5cdFx0XHR0aGlzLl9ib2FyZF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9ib2FyZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNZWV0aW5nLmRlY2lzaW9uIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGVjaXNpb24odiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2RlY2lzaW9uID0gdjtcblx0XHRcdHRoaXMuX2RlY2lzaW9uX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RlY2lzaW9uO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1lZXRpbmcubWVldGluZ19NZWV0aW5nX0FnZW5kYXMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRtZWV0aW5nX01lZXRpbmdfQWdlbmRhcyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX21lZXRpbmdfTWVldGluZ19BZ2VuZGFzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fbWVldGluZ19NZWV0aW5nX0FnZW5kYXNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX21lZXRpbmdfTWVldGluZ19BZ2VuZGFzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1lZXRpbmcubWVldGluZ19NZWV0aW5nX01pbnV0ZXMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRtZWV0aW5nX01lZXRpbmdfTWludXRlcyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX21lZXRpbmdfTWVldGluZ19NaW51dGVzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fbWVldGluZ19NZWV0aW5nX01pbnV0ZXNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX21lZXRpbmdfTWVldGluZ19NaW51dGVzO1xuXHRcdH1cblx0fVxuXG5cdF90b0VRdWVyeShzUGF0aCkge1xuXHRcdHNQYXRoID0gc1BhdGggfHwgJyc7XG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCAnJztcblxuXHRcdGlmICh0aGlzLl9hY3RpdmUpIHJldCArPSAnXicgKyBzUGF0aCArICdhY3RpdmUnICsgKHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JykgKyB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuYWJsZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmFibGVkJyArICh0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2NvZGUpIHJldCArPSAnXicgKyBzUGF0aCArICdjb2RlJyArICh0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nKSArIHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX29yZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnb3JkZXInICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMub3JkZXIoKTtcblxuXHRcdGlmICh0aGlzLl9kYXRlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF0ZScgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh0aGlzLl9uYW1lKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbmFtZScgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdyZW1hcmsnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHRoaXMuX3N0YXJ0KSByZXQgKz0gJ14nICsgc1BhdGggKyAnc3RhcnQnICsgKHRoaXMuX3N0YXJ0X2Nvb3AgfHwgJz0nKSArIHRoaXMuc3RhcnQoKTtcblxuXHRcdGlmICh0aGlzLl9lbmQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmQnICsgKHRoaXMuX2VuZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuZCgpO1xuXG5cdFx0aWYgKHRoaXMuX3N0YXJ0ZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdzdGFydGVkJyArICh0aGlzLl9zdGFydGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuc3RhcnRlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuZGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5kZWQnICsgKHRoaXMuX2VuZGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5kZWQoKTtcblxuXHRcdGlmICh0aGlzLl9zZXJpZXMpIHJldCArPSAvKih0aGlzLl9zZXJpZXNfY29vcCB8fCAnPScpICsgKi8gdGhpcy5zZXJpZXMoKS5fdG9FUXVlcnkoc1BhdGggKyAnc2VyaWVzLicpO1xuXG5cdFx0aWYgKHRoaXMuX29yZ2FuaXplcikgcmV0ICs9IC8qKHRoaXMuX29yZ2FuaXplcl9jb29wIHx8ICc9JykgKyAqLyB0aGlzLm9yZ2FuaXplcigpLl90b0VRdWVyeShzUGF0aCArICdvcmdhbml6ZXIuJyk7XG5cblx0XHRpZiAodGhpcy5fbW9kZXJhdG9yKSByZXQgKz0gLyoodGhpcy5fbW9kZXJhdG9yX2Nvb3AgfHwgJz0nKSArICovIHRoaXMubW9kZXJhdG9yKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ21vZGVyYXRvci4nKTtcblxuXHRcdGlmICh0aGlzLl9wcm9qZWN0KSByZXQgKz0gLyoodGhpcy5fcHJvamVjdF9jb29wIHx8ICc9JykgKyAqLyB0aGlzLnByb2plY3QoKS5fdG9FUXVlcnkoc1BhdGggKyAncHJvamVjdC4nKTtcblxuXHRcdGlmICh0aGlzLl9ib2FyZCkgcmV0ICs9IC8qKHRoaXMuX2JvYXJkX2Nvb3AgfHwgJz0nKSArICovIHRoaXMuYm9hcmQoKS5fdG9FUXVlcnkoc1BhdGggKyAnYm9hcmQuJyk7XG5cblx0XHRpZiAodGhpcy5fZGVjaXNpb24pIHJldCArPSAvKih0aGlzLl9kZWNpc2lvbl9jb29wIHx8ICc9JykgKyAqLyB0aGlzLmRlY2lzaW9uKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ2RlY2lzaW9uLicpO1xuXG5cdFx0KHRoaXMubWVldGluZ19NZWV0aW5nX0FnZW5kYXMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWU1lZXRpbmdfQWdlbmRhLm1lZXRpbmcsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLm1lZXRpbmdfTWVldGluZ19NaW51dGVzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllNZWV0aW5nX01pbnV0ZS5tZWV0aW5nLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHRncy5pbmZvKFwiTWVldGluZy5fdG9FUXVlcnkoKTogXCIgKyBcInJldDogXCIgKyBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X2ludm9rZShtZXRob2QsIHBheWxvYWQpIHtcblx0XHRpZiAoIW1ldGhvZCkgcmV0dXJuIG51bGw7XG5cdFx0aWYgKHR5cGVvZihwYXlsb2FkKSA9PT0gJ3N0cmluZycpIHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKHBheWxvYWQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBwKTtcblx0XHR9KTtcblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdGdzLmluZm8oXCJNZWV0aW5nLl9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0Z3MuaW5mbyhcIk1lZXRpbmcuX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpczsgLy8gdGVzdFxuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBwbGF0Zm9ybW1hbmFnZXJfTWVldGluZygpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdHRyeSB7XG5cdFx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdC8qZ3MuaW5mbyhcIk1lZXRpbmcuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdFx0fTtcblx0XHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRcdFx0aWYgKG9iai5nZXRUYWJsZU5hbWUoKSA9PSAnZWNjX3F1ZXVlJyAmJiBcIk1lZXRpbmdcIiAhPSAnZWNjX3F1ZXVlJyAmJiBvYmouc291cmNlID09IFwiTWVldGluZ1wiKSB7XG5cdFx0XHRcdFx0XHRvYmouc3RhdGUgPSBcInByb2Nlc3NpbmdcIjtcblx0XHRcdFx0XHRcdG9iai51cGRhdGUoKTtcblxuXHRcdFx0XHRcdFx0bGV0IHJlc3AgPSBuZXcgR2xpZGVSZWNvcmQoJ2VjY19xdWV1ZScpO1xuXHRcdFx0XHRcdFx0cmVzcC5yZXNwb25zZV90byA9IG9iai5zeXNfaWQ7XG5cdFx0XHRcdFx0XHRyZXNwLnF1ZXVlID0gJ291dHB1dCc7XG5cdFx0XHRcdFx0XHRyZXNwLmFnZW50ID0gb2JqLmFnZW50O1xuXHRcdFx0XHRcdFx0cmVzcC50b3BpYyA9IG9iai50b3BpYztcblx0XHRcdFx0XHRcdHJlc3AubmFtZSA9IG9iai5uYW1lO1xuXHRcdFx0XHRcdFx0cmVzcC5zb3VyY2UgPSBvYmouc291cmNlO1xuXHRcdFx0XHRcdFx0cmVzcC5mcm9tX2hvc3QgPSBvYmouYWdlbnRfY29ycmVsYXRvcjtcblx0XHRcdFx0XHRcdHJlc3AuYWdlbnRfY29ycmVsYXRvciA9IG9iai5mcm9tX2hvc3Q7XG5cblx0XHRcdFx0XHRcdGxldCByZXQgPSBuZXcgcGxhdGZvcm1tYW5hZ2VyX01lZXRpbmcoKS5fZnJvbURvY3VtZW50KCkuX2ludm9rZShvYmoubmFtZS50b1N0cmluZygpLCBvYmoucGF5bG9hZC50b1N0cmluZygpKTtcblx0XHRcdFx0XHRcdGlmIChBcnJheS5pc0FycmF5KHJldCkpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gcmV0Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIChyICYmIHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJykgPyByLl90b0RvY3VtZW50KCkgOiByO1xuXHRcdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAocmV0ICYmIHR5cGVvZihyZXQuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHJldC5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmVzcC5wYXlsb2FkID0gSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KTtcblxuXHRcdFx0XHRcdFx0cmVzcC5pbnNlcnQoKTtcblxuXHRcdFx0XHRcdFx0b2JqLnN0YXRlID0gXCJwcm9jZXNzZWRcIjtcblx0XHRcdFx0XHRcdG9iai51cGRhdGUoKTtcblx0XHRcdFx0XHRcdHJldHVybiByZXNwO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdFx0Y29kZTogb2JqLmdldFZhbHVlKFwiY29kZVwiKSxcblxuXHRcdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0XHRyZW1hcms6IG9iai5nZXRWYWx1ZShcInJlbWFya1wiKSxcblxuXHRcdFx0XHRcdFx0c3RhcnQ6IG9iai5nZXRWYWx1ZShcInN0YXJ0XCIpLFxuXG5cdFx0XHRcdFx0XHRlbmQ6IG9iai5nZXRWYWx1ZShcImVuZFwiKSxcblxuXHRcdFx0XHRcdFx0c3RhcnRlZDogb2JqLmdldFZhbHVlKFwic3RhcnRlZFwiKSxcblxuXHRcdFx0XHRcdFx0ZW5kZWQ6IG9iai5nZXRWYWx1ZShcImVuZGVkXCIpLFxuXG5cdFx0XHRcdFx0XHRzZXJpZXM6IG9iai5nZXRWYWx1ZShcInNlcmllc1wiKSxcblxuXHRcdFx0XHRcdFx0b3JnYW5pemVyOiBvYmouZ2V0VmFsdWUoXCJvcmdhbml6ZXJcIiksXG5cblx0XHRcdFx0XHRcdG1vZGVyYXRvcjogb2JqLmdldFZhbHVlKFwibW9kZXJhdG9yXCIpLFxuXG5cdFx0XHRcdFx0XHRwcm9qZWN0OiBvYmouZ2V0VmFsdWUoXCJwcm9qZWN0XCIpLFxuXG5cdFx0XHRcdFx0XHRib2FyZDogb2JqLmdldFZhbHVlKFwiYm9hcmRcIiksXG5cblx0XHRcdFx0XHRcdGRlY2lzaW9uOiBvYmouZ2V0VmFsdWUoXCJkZWNpc2lvblwiKSxcblxuXHRcdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRvYmoucXVlcnkoKTtcblx0XHRcdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tRG9jdW1lbnQob2JqKSk7XG5cdFx0XHRcdFx0Lypncy5pbmZvKFwiTWVldGluZy5fZnJvbURvY3VtZW50KCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0XHRcdHJldHVybiBnclJldDtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0XHRncy5pbmZvKFwiTWVldGluZy5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdFx0cmV0dXJuIG9iajtcblx0XHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0XHRyZXR1cm4gbmV3IHBsYXRmb3JtbWFuYWdlcl9NZWV0aW5nKCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0XHQvKmdzLmluZm8oXCJNZWV0aW5nLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5jb2RlKG9iai5jb2RlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5uYW1lKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLnJlbWFyaykpKTtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLnJlbWFyayk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouc3RhcnQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnN0YXJ0KG9iai5zdGFydCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5kKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5lbmQob2JqLmVuZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouc3RhcnRlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuc3RhcnRlZChvYmouc3RhcnRlZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5kZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmVuZGVkKG9iai5lbmRlZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouc2VyaWVzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5zZXJpZXMobmV3IHBsYXRmb3JtbWFuYWdlcl9NZWV0aW5nX1NlcmllcygpLl9mcm9tRG9jdW1lbnQob2JqLnNlcmllcykpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZ2FuaXplcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMub3JnYW5pemVyKG5ldyBwbGF0Zm9ybW1hbmFnZXJfVXNlcigpLl9mcm9tRG9jdW1lbnQob2JqLm9yZ2FuaXplcikpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm1vZGVyYXRvcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubW9kZXJhdG9yKG5ldyBwbGF0Zm9ybW1hbmFnZXJfVXNlcigpLl9mcm9tRG9jdW1lbnQob2JqLm1vZGVyYXRvcikpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnByb2plY3QpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnByb2plY3QobmV3IHBsYXRmb3JtbWFuYWdlcl9Qcm9qZWN0KCkuX2Zyb21Eb2N1bWVudChvYmoucHJvamVjdCkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmJvYXJkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5ib2FyZChuZXcgcGxhdGZvcm1tYW5hZ2VyX0JvYXJkKCkuX2Zyb21Eb2N1bWVudChvYmouYm9hcmQpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5kZWNpc2lvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZGVjaXNpb24obmV3IHBsYXRmb3JtbWFuYWdlcl9EZWNpc2lvbigpLl9mcm9tRG9jdW1lbnQob2JqLmRlY2lzaW9uKSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubWVldGluZ19NZWV0aW5nX0FnZW5kYXMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5tZWV0aW5nX01lZXRpbmdfQWdlbmRhcyhuZXcgcGxhdGZvcm1tYW5hZ2VyX01lZXRpbmdfQWdlbmRhKCkuX2Zyb21Eb2N1bWVudChvYmoubWVldGluZ19NZWV0aW5nX0FnZW5kYXMpKTtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm1lZXRpbmdfTWVldGluZ19NaW51dGVzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMubWVldGluZ19NZWV0aW5nX01pbnV0ZXMobmV3IHBsYXRmb3JtbWFuYWdlcl9NZWV0aW5nX01pbnV0ZSgpLl9mcm9tRG9jdW1lbnQob2JqLm1lZXRpbmdfTWVldGluZ19NaW51dGVzKSk7XG5cblx0XHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiTWVldGluZ1wiKXtcblx0XHRcdFx0XHRncy5pbmZvKFwiTWVldGluZy5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGdzLmluZm8oXCJNZWV0aW5nLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IFwiICsgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHRncy5pbmZvKFwiTWVldGluZy5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0XHR9XG5cblx0XHQvKmdzLmluZm8oXCJNZWV0aW5nLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0XHQvKmdzLmluZm8oXCJNZWV0aW5nLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7Ki9cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9uZXcoYykge1xuXHRcdGlmICghYykgYyA9IHRoaXMuX190eXBlO1xuXHRcdGlmIChjLmluZGV4T2YoJ3BsYXRmb3JtbWFuYWdlcl8nKSAhPSAwKSBjID0gKHtcblx0XHRcdFBsYXRmb3JtOiBcInBsYXRmb3JtbWFuYWdlcl9QbGF0Zm9ybVwiLFxuXHRcdFx0VXNlcjogXCJwbGF0Zm9ybW1hbmFnZXJfVXNlclwiLFxuXHRcdFx0UmVxdWlyZW1lbnQ6IFwicGxhdGZvcm1tYW5hZ2VyX1JlcXVpcmVtZW50XCIsXG5cdFx0XHRFZmZvcnRfRXN0aW1hdGU6IFwicGxhdGZvcm1tYW5hZ2VyX0VmZm9ydF9Fc3RpbWF0ZVwiLFxuXHRcdFx0RWZmb3J0OiBcInBsYXRmb3JtbWFuYWdlcl9FZmZvcnRcIixcblx0XHRcdEJ1ZGdldDogXCJwbGF0Zm9ybW1hbmFnZXJfQnVkZ2V0XCIsXG5cdFx0XHRBZ2VuZGFfSXRlbTogXCJwbGF0Zm9ybW1hbmFnZXJfQWdlbmRhX0l0ZW1cIixcblx0XHRcdE1lZXRpbmdfQWdlbmRhOiBcInBsYXRmb3JtbWFuYWdlcl9NZWV0aW5nX0FnZW5kYVwiLFxuXHRcdFx0RGVjaXNpb25fT3B0aW9uOiBcInBsYXRmb3JtbWFuYWdlcl9EZWNpc2lvbl9PcHRpb25cIixcblx0XHRcdERlY2lzaW9uOiBcInBsYXRmb3JtbWFuYWdlcl9EZWNpc2lvblwiLFxuXHRcdFx0TWVldGluZ19NaW51dGU6IFwicGxhdGZvcm1tYW5hZ2VyX01lZXRpbmdfTWludXRlXCIsXG5cdFx0XHRNZWV0aW5nX1NlcmllczogXCJwbGF0Zm9ybW1hbmFnZXJfTWVldGluZ19TZXJpZXNcIixcblx0XHRcdE1lZXRpbmc6IFwicGxhdGZvcm1tYW5hZ2VyX01lZXRpbmdcIixcblx0XHRcdEJvYXJkOiBcInBsYXRmb3JtbWFuYWdlcl9Cb2FyZFwiLFxuXHRcdFx0Qm9hcmRfTWVtYmVyOiBcInBsYXRmb3JtbWFuYWdlcl9Cb2FyZF9NZW1iZXJcIixcblx0XHRcdEZyZXF1ZW5jeTogXCJwbGF0Zm9ybW1hbmFnZXJfRnJlcXVlbmN5XCIsXG5cdFx0XHRNb2R1bGU6IFwicGxhdGZvcm1tYW5hZ2VyX01vZHVsZVwiLFxuXHRcdFx0Q2FwYWJpbGl0eTogXCJwbGF0Zm9ybW1hbmFnZXJfQ2FwYWJpbGl0eVwiLFxuXHRcdFx0VGVhbTogXCJwbGF0Zm9ybW1hbmFnZXJfVGVhbVwiLFxuXHRcdFx0UHJvamVjdDogXCJwbGF0Zm9ybW1hbmFnZXJfUHJvamVjdFwiLFxuXHRcdFx0VGVhbV9NZW1iZXI6IFwicGxhdGZvcm1tYW5hZ2VyX1RlYW1fTWVtYmVyXCIsXG5cdFx0XHRSb2xlOiBcInBsYXRmb3JtbWFuYWdlcl9Sb2xlXCIsXG5cdFx0fSlbY107XG5cdFx0cmV0dXJuIG5ldyhncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBnbG9iYWwgOiB4Xzc4NjExX3BsYXRmb3JtXzApW2NdKCk7XG5cdH1cblxuXHRfdG9Eb2N1bWVudChhckZpZWxkcykge1xuXG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCB7fTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSByZXQuc3lzX2lkID0gdGhpcy5JZDtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5hY3RpdmUgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5lbmFibGVkID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmNvZGUgPSB0aGlzLmNvZGUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm9yZGVyID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5kYXRlID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmIChyZXQuZGF0ZSAmJiB0eXBlb2YocmV0LmRhdGUudG9JU09TdHJpbmcpID09PSAnZnVuY3Rpb24nKSByZXQuZGF0ZSA9IHJldC5kYXRlLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5uYW1lID0gdGhpcy5uYW1lKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQucmVtYXJrID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKHR5cGVvZihyZXQucmVtYXJrKSA9PT0gJ29iamVjdCcpIHJldC5yZW1hcmsgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NEVuY29kZShKU09OLnN0cmluZ2lmeShyZXQucmVtYXJrKSk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3N0YXJ0KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5zdGFydCA9IHRoaXMuc3RhcnQoKTtcblxuXHRcdFx0aWYgKHJldC5zdGFydCAmJiB0eXBlb2YocmV0LnN0YXJ0LnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LnN0YXJ0ID0gcmV0LnN0YXJ0LnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmVuZCA9IHRoaXMuZW5kKCk7XG5cblx0XHRcdGlmIChyZXQuZW5kICYmIHR5cGVvZihyZXQuZW5kLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmVuZCA9IHJldC5lbmQudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3N0YXJ0ZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnN0YXJ0ZWQgPSB0aGlzLnN0YXJ0ZWQoKTtcblxuXHRcdFx0aWYgKHJldC5zdGFydGVkICYmIHR5cGVvZihyZXQuc3RhcnRlZC50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5zdGFydGVkID0gcmV0LnN0YXJ0ZWQudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuZGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5lbmRlZCA9IHRoaXMuZW5kZWQoKTtcblxuXHRcdFx0aWYgKHJldC5lbmRlZCAmJiB0eXBlb2YocmV0LmVuZGVkLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmVuZGVkID0gcmV0LmVuZGVkLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9zZXJpZXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnNlcmllcyA9IHRoaXMuc2VyaWVzKCk7XG5cblx0XHRcdGlmIChyZXQuc2VyaWVzKSB7XG5cdFx0XHRcdHJldC5zZXJpZXMgPSByZXQuc2VyaWVzLl90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0LnNlcmllcykgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuc2VyaWVzKS5sZW5ndGgpIHJldC5zZXJpZXMgPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmdhbml6ZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm9yZ2FuaXplciA9IHRoaXMub3JnYW5pemVyKCk7XG5cblx0XHRcdGlmIChyZXQub3JnYW5pemVyKSB7XG5cdFx0XHRcdHJldC5vcmdhbml6ZXIgPSByZXQub3JnYW5pemVyLl90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0Lm9yZ2FuaXplcikgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQub3JnYW5pemVyKS5sZW5ndGgpIHJldC5vcmdhbml6ZXIgPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9tb2RlcmF0b3IpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm1vZGVyYXRvciA9IHRoaXMubW9kZXJhdG9yKCk7XG5cblx0XHRcdGlmIChyZXQubW9kZXJhdG9yKSB7XG5cdFx0XHRcdHJldC5tb2RlcmF0b3IgPSByZXQubW9kZXJhdG9yLl90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0Lm1vZGVyYXRvcikgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQubW9kZXJhdG9yKS5sZW5ndGgpIHJldC5tb2RlcmF0b3IgPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9wcm9qZWN0KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5wcm9qZWN0ID0gdGhpcy5wcm9qZWN0KCk7XG5cblx0XHRcdGlmIChyZXQucHJvamVjdCkge1xuXHRcdFx0XHRyZXQucHJvamVjdCA9IHJldC5wcm9qZWN0Ll90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0LnByb2plY3QpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LnByb2plY3QpLmxlbmd0aCkgcmV0LnByb2plY3QgPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9ib2FyZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYm9hcmQgPSB0aGlzLmJvYXJkKCk7XG5cblx0XHRcdGlmIChyZXQuYm9hcmQpIHtcblx0XHRcdFx0cmV0LmJvYXJkID0gcmV0LmJvYXJkLl90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0LmJvYXJkKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5ib2FyZCkubGVuZ3RoKSByZXQuYm9hcmQgPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kZWNpc2lvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGVjaXNpb24gPSB0aGlzLmRlY2lzaW9uKCk7XG5cblx0XHRcdGlmIChyZXQuZGVjaXNpb24pIHtcblx0XHRcdFx0cmV0LmRlY2lzaW9uID0gcmV0LmRlY2lzaW9uLl90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0LmRlY2lzaW9uKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5kZWNpc2lvbikubGVuZ3RoKSByZXQuZGVjaXNpb24gPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLm1lZXRpbmdfTWVldGluZ19BZ2VuZGFzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm1lZXRpbmdfTWVldGluZ19BZ2VuZGFzID0gdGhpcy5tZWV0aW5nX01lZXRpbmdfQWdlbmRhcygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMubWVldGluZ19NZWV0aW5nX01pbnV0ZXMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubWVldGluZ19NZWV0aW5nX01pbnV0ZXMgPSB0aGlzLm1lZXRpbmdfTWVldGluZ19NaW51dGVzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdFx0fSk7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRkZWxldGUgcmV0W2tdO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF91bmlxdWUoa2V5cywgcmV0KSB7XG5cdFx0cmV0ID0gcmV0IHx8IG5ldyBwbGF0Zm9ybW1hbmFnZXJfTWVldGluZygpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRcdGlmICgha2V5cykge1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3RpdmVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3RpdmUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aXZlKHRoaXMuYWN0aXZlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJjb2RlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm9yZGVyXCIpID49IDAgJiYgdHlwZW9mKHRoaXMub3JkZXIoKSkgIT09ICd1bmRlZmluZWQnKSByZXQub3JkZXIodGhpcy5vcmRlcigpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImRhdGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYXRlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhdGUodGhpcy5kYXRlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwibmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJyZW1hcmtcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZW1hcmsoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVtYXJrKHRoaXMucmVtYXJrKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwic3RhcnRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5zdGFydCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zdGFydCh0aGlzLnN0YXJ0KCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5kXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5kKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuZCh0aGlzLmVuZCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInN0YXJ0ZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5zdGFydGVkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnN0YXJ0ZWQodGhpcy5zdGFydGVkKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5kZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmRlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmRlZCh0aGlzLmVuZGVkKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwic2VyaWVzXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuc2VyaWVzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnNlcmllcyh0aGlzLnNlcmllcygpLl91bmlxdWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmdhbml6ZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmdhbml6ZXIoKSkgIT09ICd1bmRlZmluZWQnKSByZXQub3JnYW5pemVyKHRoaXMub3JnYW5pemVyKCkuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm1vZGVyYXRvclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm1vZGVyYXRvcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5tb2RlcmF0b3IodGhpcy5tb2RlcmF0b3IoKS5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicHJvamVjdFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnByb2plY3QoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucHJvamVjdCh0aGlzLnByb2plY3QoKS5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYm9hcmRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5ib2FyZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5ib2FyZCh0aGlzLmJvYXJkKCkuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImRlY2lzaW9uXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGVjaXNpb24oKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGVjaXNpb24odGhpcy5kZWNpc2lvbigpLl91bmlxdWUoKSk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3F1ZXJ5KGdxKSB7XG5cdFx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF83ODYxMV9wbGF0Zm9ybV8wX21lZXRpbmcnLCBbJyonXSlbJ3hfNzg2MTFfcGxhdGZvcm1fMF9tZWV0aW5nJ10pO1xuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCd4Xzc4NjExX3BsYXRmb3JtXzBfbWVldGluZycpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KSh0aGlzKSk7XG5cdFx0aWYgKGlkZiA9PSAnSWQnKSBpZGYgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3RpdmVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdFx0LyogZ3MuaW5mbyhcIk1lZXRpbmcuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0XHQvKiBncy5pbmZvKFwiTWVldGluZy5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5hYmxlZCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fY29kZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9jb2RlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5jb2RlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdjb2RlJykgPj0gMCkge1xuXHRcdFx0XHQvKiBncy5pbmZvKFwiTWVldGluZy5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnY29kZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZGVyJykgPj0gMCkge1xuXHRcdFx0XHQvKiBncy5pbmZvKFwiTWVldGluZy5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF0ZScpID49IDApIHtcblx0XHRcdFx0LyogZ3MuaW5mbyhcIk1lZXRpbmcuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX25hbWVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbmFtZScpID49IDApIHtcblx0XHRcdFx0LyogZ3MuaW5mbyhcIk1lZXRpbmcuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ25hbWUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX3JlbWFya19jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZW1hcmsnKSA+PSAwKSB7XG5cdFx0XHRcdC8qIGdzLmluZm8oXCJNZWV0aW5nLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVtYXJrJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3N0YXJ0KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fc3RhcnRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5zdGFydCgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdzdGFydCcpID49IDApIHtcblx0XHRcdFx0LyogZ3MuaW5mbyhcIk1lZXRpbmcuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdzdGFydCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnc3RhcnQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnc3RhcnQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5kKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZW5kX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZW5kKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VuZCcpID49IDApIHtcblx0XHRcdFx0LyogZ3MuaW5mbyhcIk1lZXRpbmcuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuZCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fc3RhcnRlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3N0YXJ0ZWRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5zdGFydGVkKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3N0YXJ0ZWQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qIGdzLmluZm8oXCJNZWV0aW5nLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnc3RhcnRlZCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnc3RhcnRlZCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdzdGFydGVkJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuZGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZW5kZWRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5lbmRlZCgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmRlZCcpID49IDApIHtcblx0XHRcdFx0LyogZ3MuaW5mbyhcIk1lZXRpbmcuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmRlZCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZW5kZWQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5kZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fc2VyaWVzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fc2VyaWVzX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuc2VyaWVzKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiTWVldGluZ1wiPT1cIkNvbHVtblwiKSBncy5pbmZvKFwiTWVldGluZy5fcXVlcnkoKTogXCIrIFwic2VyaWVzIFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdGdzLmluZm8oXCJNZWV0aW5nLl9xdWVyeSgpOiBcIiArIFwic2VyaWVzW3Nlcmllc10gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5zZXJpZXMoKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignc2VyaWVzJykgPj0gMCkge1xuXHRcdFx0XHQvKiBncy5pbmZvKFwiTWVldGluZy5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3NlcmllcycpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnc2VyaWVzJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3NlcmllcycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmdhbml6ZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmdhbml6ZXJfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5vcmdhbml6ZXIoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJNZWV0aW5nXCI9PVwiQ29sdW1uXCIpIGdzLmluZm8oXCJNZWV0aW5nLl9xdWVyeSgpOiBcIisgXCJvcmdhbml6ZXIgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0Z3MuaW5mbyhcIk1lZXRpbmcuX3F1ZXJ5KCk6IFwiICsgXCJvcmdhbml6ZXJbb3JnYW5pemVyXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLm9yZ2FuaXplcigpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmdhbml6ZXInKSA+PSAwKSB7XG5cdFx0XHRcdC8qIGdzLmluZm8oXCJNZWV0aW5nLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JnYW5pemVyJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmdhbml6ZXInKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JnYW5pemVyJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX21vZGVyYXRvcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX21vZGVyYXRvcl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm1vZGVyYXRvcigpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIk1lZXRpbmdcIj09XCJDb2x1bW5cIikgZ3MuaW5mbyhcIk1lZXRpbmcuX3F1ZXJ5KCk6IFwiKyBcIm1vZGVyYXRvciBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHRncy5pbmZvKFwiTWVldGluZy5fcXVlcnkoKTogXCIgKyBcIm1vZGVyYXRvclttb2RlcmF0b3JdIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMubW9kZXJhdG9yKCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ21vZGVyYXRvcicpID49IDApIHtcblx0XHRcdFx0LyogZ3MuaW5mbyhcIk1lZXRpbmcuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdtb2RlcmF0b3InKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ21vZGVyYXRvcicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdtb2RlcmF0b3InLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcHJvamVjdCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3Byb2plY3RfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5wcm9qZWN0KCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiTWVldGluZ1wiPT1cIkNvbHVtblwiKSBncy5pbmZvKFwiTWVldGluZy5fcXVlcnkoKTogXCIrIFwicHJvamVjdCBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHRncy5pbmZvKFwiTWVldGluZy5fcXVlcnkoKTogXCIgKyBcInByb2plY3RbcHJvamVjdF0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5wcm9qZWN0KCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3Byb2plY3QnKSA+PSAwKSB7XG5cdFx0XHRcdC8qIGdzLmluZm8oXCJNZWV0aW5nLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncHJvamVjdCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncHJvamVjdCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdwcm9qZWN0JywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2JvYXJkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYm9hcmRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5ib2FyZCgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIk1lZXRpbmdcIj09XCJDb2x1bW5cIikgZ3MuaW5mbyhcIk1lZXRpbmcuX3F1ZXJ5KCk6IFwiKyBcImJvYXJkIFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdGdzLmluZm8oXCJNZWV0aW5nLl9xdWVyeSgpOiBcIiArIFwiYm9hcmRbYm9hcmRdIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuYm9hcmQoKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYm9hcmQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qIGdzLmluZm8oXCJNZWV0aW5nLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYm9hcmQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2JvYXJkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2JvYXJkJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RlY2lzaW9uKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZGVjaXNpb25fY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5kZWNpc2lvbigpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIk1lZXRpbmdcIj09XCJDb2x1bW5cIikgZ3MuaW5mbyhcIk1lZXRpbmcuX3F1ZXJ5KCk6IFwiKyBcImRlY2lzaW9uIFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdGdzLmluZm8oXCJNZWV0aW5nLl9xdWVyeSgpOiBcIiArIFwiZGVjaXNpb25bZGVjaXNpb25dIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuZGVjaXNpb24oKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGVjaXNpb24nKSA+PSAwKSB7XG5cdFx0XHRcdC8qIGdzLmluZm8oXCJNZWV0aW5nLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGVjaXNpb24nKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RlY2lzaW9uJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RlY2lzaW9uJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0XHQvKiBncy5pbmZvKFwiTWVldGluZy5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0XHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcblx0fVxuXG5cdF9zYXZlKG9iaikge1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdHJldHVybiBuZXcgcGxhdGZvcm1tYW5hZ2VyX01lZXRpbmcoKS5fc2F2ZShvKVxuXHRcdH0pO1xuXG5cdFx0bGV0IF9vYmogPSB7fTtcblxuXHRcdC8qZ3MuaW5mbyhcIk1lZXRpbmcuX3NhdmUoKTogXCIrIFwiLi4uIFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfNzg2MTFfcGxhdGZvcm1fMF9tZWV0aW5nJywgWycqJ10pWyd4Xzc4NjExX3BsYXRmb3JtXzBfbWVldGluZyddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdFx0fSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHRcdGdzLmluZm8oXCJNZWV0aW5nLl9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHRcdGdzLmluZm8oXCJNZWV0aW5nLl9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0bGV0IF90aGlzID0gbnVsbDtcblx0XHRpZiAob2JqLl9fa2V5cykge1xuXHRcdFx0bGV0IGtPYmogPSB7fTtcblx0XHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSkpKTtcblx0XHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0XHR9KTtcblx0XHRcdF90aGlzID0gbmV3IHBsYXRmb3JtbWFuYWdlcl9NZWV0aW5nKCkuX2Zyb21Eb2N1bWVudChrT2JqKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0X3RoaXMgPSBuZXcgcGxhdGZvcm1tYW5hZ2VyX01lZXRpbmcoKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0XHR9XG5cblx0XHQvKmdzLmluZm8oXCJNZWV0aW5nLl9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0XHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdFx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdFx0dHJ5IHtcblx0XHRcdGdzLmluZm8oXCJNZWV0aW5nLl9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0Z3MuaW5mbyhcIk1lZXRpbmcuX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSk7XG5cblx0XHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICd4Xzc4NjExX3BsYXRmb3JtXzBfbWVldGluZycpO1xuXHRcdFx0Lypncy5pbmZvKFwiTWVldGluZy5fc2F2ZSgpOiBcIisgXCJ1cHNlcnRpbmcuLi4gXCIrIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7Ki9cblx0XHRcdGlmIChfb2JqLnN5c19pZCkge1xuXHRcdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X29iai5zeXNfaWQgPSBncy5nZW5lcmF0ZUdVSUQoKTtcblx0XHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0XHR9XG5cdFx0XHRsZXQgX2ZPYmogPSB7fTtcblx0XHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpKSk7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4Xzc4NjExX3BsYXRmb3JtXzBfbWVldGluZycsIFsnKiddKVsneF83ODYxMV9wbGF0Zm9ybV8wX21lZXRpbmcnXSkpKSk7XG5cdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdGdzLmluZm8oXCJNZWV0aW5nLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0XHRncy5pbmZvKFwiTWVldGluZy5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH1cblxuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5tZWV0aW5nX01lZXRpbmdfQWdlbmRhcykpIHRoaXMubWVldGluZ19NZWV0aW5nX0FnZW5kYXMob2JqLm1lZXRpbmdfTWVldGluZ19BZ2VuZGFzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBwbGF0Zm9ybW1hbmFnZXJfTWVldGluZ19BZ2VuZGEoKS5fc2F2ZSh0YSlcblx0XHR9KSk7XG5cblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmoubWVldGluZ19NZWV0aW5nX01pbnV0ZXMpKSB0aGlzLm1lZXRpbmdfTWVldGluZ19NaW51dGVzKG9iai5tZWV0aW5nX01lZXRpbmdfTWludXRlcy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgcGxhdGZvcm1tYW5hZ2VyX01lZXRpbmdfTWludXRlKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNZWV0aW5nLnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RvcmUoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihsb2dPYmopIHtcblx0XHRcdGdzLmluZm8oXCJNZWV0aW5nLnN0b3JlKCk6IFwiICsgXCJsb2dPYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkobG9nT2JqLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0Z3MuaW5mbyhcIk1lZXRpbmcuc3RvcmUoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRncy5pbmZvKFwiTWVldGluZy5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0Z3MuaW5mbyhcIk1lZXRpbmcuc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdFx0bGV0IF90aGlzID0gdGhpcy5fdW5pcXVlKCkuZmluZCgpO1xuXHRcdFx0aWYgKF90aGlzKSB0aGlzLklkID0gX3RoaXMuSWQ7XG5cblx0XHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1lZXRpbmcuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmRBbGwoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihsb2dPYmopIHtcblx0XHRcdGdzLmluZm8oXCJNZWV0aW5nLmZpbmRBbGwoKTogXCIgKyBcImxvZ09iajogXCIgKyBKU09OLnN0cmluZ2lmeShsb2dPYmosIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHRncy5pbmZvKFwiTWVldGluZy5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Z3MuaW5mbyhcIk1lZXRpbmcuZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0Z3MuaW5mbyhcIk1lZXRpbmcuZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZChcIk1lZXRpbmdcIik7XG5cdFx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfNzg2MTFfcGxhdGZvcm1fMF9tZWV0aW5nJywgWycqJ10pWyd4Xzc4NjExX3BsYXRmb3JtXzBfbWVldGluZyddKSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNZWV0aW5nLmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obG9nT2JqKSB7XG5cdFx0XHRncy5pbmZvKFwiTWVldGluZy5maW5kKCk6IFwiICsgXCJsb2dPYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkobG9nT2JqLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0Z3MuaW5mbyhcIk1lZXRpbmcuZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGdzLmluZm8oXCJNZWV0aW5nLmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdGdzLmluZm8oXCJNZWV0aW5nLmZpbmQoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0bGV0IHJldCA9IHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0cmV0dXJuIHJldC5sZW5ndGggPyByZXRbMF0gOiBudWxsO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxufSJ9LHsiYWN0aXZlIjp0cnVlLCJhY2Nlc3MiOiJwYWNrYWdlX3ByaXZhdGUiLCJjYWxsZXJfYWNjZXNzIjpudWxsLCJzeXNfbmFtZSI6InBsYXRmb3JtbWFuYWdlcl9SZXF1aXJlbWVudCIsImFwaV9uYW1lIjoieF83ODYxMV9wbGF0Zm9ybV8wLnBsYXRmb3JtbWFuYWdlcl9SZXF1aXJlbWVudCIsIm5hbWUiOiJwbGF0Zm9ybW1hbmFnZXJfUmVxdWlyZW1lbnQiLCJzY3JpcHQiOiJjbGFzcyBwbGF0Zm9ybW1hbmFnZXJfUmVxdWlyZW1lbnQge1xuXHRjb25zdHJ1Y3RvcihpZCkge1xuXHRcdHVuZGVmaW5lZFxuXHRcdHRoaXMuSWQgPSBpZDtcblx0XHR0aGlzLl9fbW9kdWxlID0gXCJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwicGxhdGZvcm1tYW5hZ2VyX1JlcXVpcmVtZW50XCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJwbGF0Zm9ybW1hbmFnZXJcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInBsYXRmb3JtbWFuYWdlclwiO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogUmVxdWlyZW1lbnQuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBSZXF1aXJlbWVudC5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUmVxdWlyZW1lbnQuY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFJlcXVpcmVtZW50Lm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFJlcXVpcmVtZW50LmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly9ncy5pbmZvKFwiUmVxdWlyZW1lbnQuZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFJlcXVpcmVtZW50Lm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBSZXF1aXJlbWVudC5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFJlcXVpcmVtZW50LnByb2plY3QgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRwcm9qZWN0KHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9wcm9qZWN0ID0gdjtcblx0XHRcdHRoaXMuX3Byb2plY3RfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcHJvamVjdDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBSZXF1aXJlbWVudC5jYXBhYmlsaXR5IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y2FwYWJpbGl0eSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY2FwYWJpbGl0eSA9IHY7XG5cdFx0XHR0aGlzLl9jYXBhYmlsaXR5X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NhcGFiaWxpdHk7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUmVxdWlyZW1lbnQucmVxdWlyZW1lbnRfRWZmb3J0X0VzdGltYXRlcyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlcXVpcmVtZW50X0VmZm9ydF9Fc3RpbWF0ZXModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9yZXF1aXJlbWVudF9FZmZvcnRfRXN0aW1hdGVzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fcmVxdWlyZW1lbnRfRWZmb3J0X0VzdGltYXRlc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVxdWlyZW1lbnRfRWZmb3J0X0VzdGltYXRlcztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBSZXF1aXJlbWVudC5yZXF1aXJlbWVudF9BZ2VuZGFfSXRlbXMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZXF1aXJlbWVudF9BZ2VuZGFfSXRlbXModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9yZXF1aXJlbWVudF9BZ2VuZGFfSXRlbXMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9yZXF1aXJlbWVudF9BZ2VuZGFfSXRlbXNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlcXVpcmVtZW50X0FnZW5kYV9JdGVtcztcblx0XHR9XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnY29kZScgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ25hbWUnICsgKHRoaXMuX25hbWVfY29vcCB8fCAnPScpICsgdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAodGhpcy5fcmVtYXJrKSByZXQgKz0gJ14nICsgc1BhdGggKyAncmVtYXJrJyArICh0aGlzLl9yZW1hcmtfY29vcCB8fCAnPScpICsgdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmICh0aGlzLl9wcm9qZWN0KSByZXQgKz0gLyoodGhpcy5fcHJvamVjdF9jb29wIHx8ICc9JykgKyAqLyB0aGlzLnByb2plY3QoKS5fdG9FUXVlcnkoc1BhdGggKyAncHJvamVjdC4nKTtcblxuXHRcdGlmICh0aGlzLl9jYXBhYmlsaXR5KSByZXQgKz0gLyoodGhpcy5fY2FwYWJpbGl0eV9jb29wIHx8ICc9JykgKyAqLyB0aGlzLmNhcGFiaWxpdHkoKS5fdG9FUXVlcnkoc1BhdGggKyAnY2FwYWJpbGl0eS4nKTtcblxuXHRcdCh0aGlzLnJlcXVpcmVtZW50X0VmZm9ydF9Fc3RpbWF0ZXMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWUVmZm9ydF9Fc3RpbWF0ZS5yZXF1aXJlbWVudCw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHRoaXMucmVxdWlyZW1lbnRfQWdlbmRhX0l0ZW1zKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllBZ2VuZGFfSXRlbS5yZXF1aXJlbWVudCw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0Z3MuaW5mbyhcIlJlcXVpcmVtZW50Ll90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykgcmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0Z3MuaW5mbyhcIlJlcXVpcmVtZW50Ll9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0Z3MuaW5mbyhcIlJlcXVpcmVtZW50Ll9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7IC8vIHRlc3RcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgcGxhdGZvcm1tYW5hZ2VyX1JlcXVpcmVtZW50KCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0dHJ5IHtcblx0XHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0Lypncy5pbmZvKFwiUmVxdWlyZW1lbnQuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdFx0fTtcblx0XHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRcdFx0aWYgKG9iai5nZXRUYWJsZU5hbWUoKSA9PSAnZWNjX3F1ZXVlJyAmJiBcIlJlcXVpcmVtZW50XCIgIT0gJ2VjY19xdWV1ZScgJiYgb2JqLnNvdXJjZSA9PSBcIlJlcXVpcmVtZW50XCIpIHtcblx0XHRcdFx0XHRcdG9iai5zdGF0ZSA9IFwicHJvY2Vzc2luZ1wiO1xuXHRcdFx0XHRcdFx0b2JqLnVwZGF0ZSgpO1xuXG5cdFx0XHRcdFx0XHRsZXQgcmVzcCA9IG5ldyBHbGlkZVJlY29yZCgnZWNjX3F1ZXVlJyk7XG5cdFx0XHRcdFx0XHRyZXNwLnJlc3BvbnNlX3RvID0gb2JqLnN5c19pZDtcblx0XHRcdFx0XHRcdHJlc3AucXVldWUgPSAnb3V0cHV0Jztcblx0XHRcdFx0XHRcdHJlc3AuYWdlbnQgPSBvYmouYWdlbnQ7XG5cdFx0XHRcdFx0XHRyZXNwLnRvcGljID0gb2JqLnRvcGljO1xuXHRcdFx0XHRcdFx0cmVzcC5uYW1lID0gb2JqLm5hbWU7XG5cdFx0XHRcdFx0XHRyZXNwLnNvdXJjZSA9IG9iai5zb3VyY2U7XG5cdFx0XHRcdFx0XHRyZXNwLmZyb21faG9zdCA9IG9iai5hZ2VudF9jb3JyZWxhdG9yO1xuXHRcdFx0XHRcdFx0cmVzcC5hZ2VudF9jb3JyZWxhdG9yID0gb2JqLmZyb21faG9zdDtcblxuXHRcdFx0XHRcdFx0bGV0IHJldCA9IG5ldyBwbGF0Zm9ybW1hbmFnZXJfUmVxdWlyZW1lbnQoKS5fZnJvbURvY3VtZW50KCkuX2ludm9rZShvYmoubmFtZS50b1N0cmluZygpLCBvYmoucGF5bG9hZC50b1N0cmluZygpKTtcblx0XHRcdFx0XHRcdGlmIChBcnJheS5pc0FycmF5KHJldCkpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gcmV0Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIChyICYmIHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJykgPyByLl90b0RvY3VtZW50KCkgOiByO1xuXHRcdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAocmV0ICYmIHR5cGVvZihyZXQuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHJldC5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmVzcC5wYXlsb2FkID0gSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KTtcblxuXHRcdFx0XHRcdFx0cmVzcC5pbnNlcnQoKTtcblxuXHRcdFx0XHRcdFx0b2JqLnN0YXRlID0gXCJwcm9jZXNzZWRcIjtcblx0XHRcdFx0XHRcdG9iai51cGRhdGUoKTtcblx0XHRcdFx0XHRcdHJldHVybiByZXNwO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdFx0Y29kZTogb2JqLmdldFZhbHVlKFwiY29kZVwiKSxcblxuXHRcdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0XHRyZW1hcms6IG9iai5nZXRWYWx1ZShcInJlbWFya1wiKSxcblxuXHRcdFx0XHRcdFx0cHJvamVjdDogb2JqLmdldFZhbHVlKFwicHJvamVjdFwiKSxcblxuXHRcdFx0XHRcdFx0Y2FwYWJpbGl0eTogb2JqLmdldFZhbHVlKFwiY2FwYWJpbGl0eVwiKSxcblxuXHRcdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRvYmoucXVlcnkoKTtcblx0XHRcdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tRG9jdW1lbnQob2JqKSk7XG5cdFx0XHRcdFx0Lypncy5pbmZvKFwiUmVxdWlyZW1lbnQuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJnbGlkZSBvYmplY3RzIFwiKyBcImdyUmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KGdyUmV0LCBudWxsLCA0KSk7Ki9cblx0XHRcdFx0XHRyZXR1cm4gZ3JSZXQ7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSBpZiAob2JqLl9mcm9tRG9jdW1lbnQpIHtcblx0XHRcdFx0Z3MuaW5mbyhcIlJlcXVpcmVtZW50Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0XHRyZXR1cm4gb2JqO1xuXHRcdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRcdHJldHVybiBuZXcgcGxhdGZvcm1tYW5hZ2VyX1JlcXVpcmVtZW50KCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0XHQvKmdzLmluZm8oXCJSZXF1aXJlbWVudC5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuY29kZShvYmouY29kZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubmFtZShvYmoubmFtZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsoU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5yZW1hcmspKSk7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5yZW1hcmspO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnByb2plY3QpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnByb2plY3QobmV3IHBsYXRmb3JtbWFuYWdlcl9Qcm9qZWN0KCkuX2Zyb21Eb2N1bWVudChvYmoucHJvamVjdCkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmNhcGFiaWxpdHkpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmNhcGFiaWxpdHkobmV3IHBsYXRmb3JtbWFuYWdlcl9DYXBhYmlsaXR5KCkuX2Zyb21Eb2N1bWVudChvYmouY2FwYWJpbGl0eSkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlcXVpcmVtZW50X0VmZm9ydF9Fc3RpbWF0ZXMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5yZXF1aXJlbWVudF9FZmZvcnRfRXN0aW1hdGVzKG5ldyBwbGF0Zm9ybW1hbmFnZXJfRWZmb3J0X0VzdGltYXRlKCkuX2Zyb21Eb2N1bWVudChvYmoucmVxdWlyZW1lbnRfRWZmb3J0X0VzdGltYXRlcykpO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVxdWlyZW1lbnRfQWdlbmRhX0l0ZW1zKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMucmVxdWlyZW1lbnRfQWdlbmRhX0l0ZW1zKG5ldyBwbGF0Zm9ybW1hbmFnZXJfQWdlbmRhX0l0ZW0oKS5fZnJvbURvY3VtZW50KG9iai5yZXF1aXJlbWVudF9BZ2VuZGFfSXRlbXMpKTtcblxuXHRcdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJSZXF1aXJlbWVudFwiKXtcblx0XHRcdFx0XHRncy5pbmZvKFwiUmVxdWlyZW1lbnQuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgY29uc3RydWN0b3I6IFwiICsgb2JqLmNvbnN0cnVjdG9yLm5hbWUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRncy5pbmZvKFwiUmVxdWlyZW1lbnQuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdGdzLmluZm8oXCJSZXF1aXJlbWVudC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0XHR9XG5cblx0XHQvKmdzLmluZm8oXCJSZXF1aXJlbWVudC5fZnJvbURvY3VtZW50KCk6IFwiKyBcIklkIFwiKyBcInRoaXMuSWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5JZCwgbnVsbCwgNCkpOyovXG5cdFx0Lypncy5pbmZvKFwiUmVxdWlyZW1lbnQuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X25ldyhjKSB7XG5cdFx0aWYgKCFjKSBjID0gdGhpcy5fX3R5cGU7XG5cdFx0aWYgKGMuaW5kZXhPZigncGxhdGZvcm1tYW5hZ2VyXycpICE9IDApIGMgPSAoe1xuXHRcdFx0UGxhdGZvcm06IFwicGxhdGZvcm1tYW5hZ2VyX1BsYXRmb3JtXCIsXG5cdFx0XHRVc2VyOiBcInBsYXRmb3JtbWFuYWdlcl9Vc2VyXCIsXG5cdFx0XHRSZXF1aXJlbWVudDogXCJwbGF0Zm9ybW1hbmFnZXJfUmVxdWlyZW1lbnRcIixcblx0XHRcdEVmZm9ydF9Fc3RpbWF0ZTogXCJwbGF0Zm9ybW1hbmFnZXJfRWZmb3J0X0VzdGltYXRlXCIsXG5cdFx0XHRFZmZvcnQ6IFwicGxhdGZvcm1tYW5hZ2VyX0VmZm9ydFwiLFxuXHRcdFx0QnVkZ2V0OiBcInBsYXRmb3JtbWFuYWdlcl9CdWRnZXRcIixcblx0XHRcdEFnZW5kYV9JdGVtOiBcInBsYXRmb3JtbWFuYWdlcl9BZ2VuZGFfSXRlbVwiLFxuXHRcdFx0TWVldGluZ19BZ2VuZGE6IFwicGxhdGZvcm1tYW5hZ2VyX01lZXRpbmdfQWdlbmRhXCIsXG5cdFx0XHREZWNpc2lvbl9PcHRpb246IFwicGxhdGZvcm1tYW5hZ2VyX0RlY2lzaW9uX09wdGlvblwiLFxuXHRcdFx0RGVjaXNpb246IFwicGxhdGZvcm1tYW5hZ2VyX0RlY2lzaW9uXCIsXG5cdFx0XHRNZWV0aW5nX01pbnV0ZTogXCJwbGF0Zm9ybW1hbmFnZXJfTWVldGluZ19NaW51dGVcIixcblx0XHRcdE1lZXRpbmdfU2VyaWVzOiBcInBsYXRmb3JtbWFuYWdlcl9NZWV0aW5nX1Nlcmllc1wiLFxuXHRcdFx0TWVldGluZzogXCJwbGF0Zm9ybW1hbmFnZXJfTWVldGluZ1wiLFxuXHRcdFx0Qm9hcmQ6IFwicGxhdGZvcm1tYW5hZ2VyX0JvYXJkXCIsXG5cdFx0XHRCb2FyZF9NZW1iZXI6IFwicGxhdGZvcm1tYW5hZ2VyX0JvYXJkX01lbWJlclwiLFxuXHRcdFx0RnJlcXVlbmN5OiBcInBsYXRmb3JtbWFuYWdlcl9GcmVxdWVuY3lcIixcblx0XHRcdE1vZHVsZTogXCJwbGF0Zm9ybW1hbmFnZXJfTW9kdWxlXCIsXG5cdFx0XHRDYXBhYmlsaXR5OiBcInBsYXRmb3JtbWFuYWdlcl9DYXBhYmlsaXR5XCIsXG5cdFx0XHRUZWFtOiBcInBsYXRmb3JtbWFuYWdlcl9UZWFtXCIsXG5cdFx0XHRQcm9qZWN0OiBcInBsYXRmb3JtbWFuYWdlcl9Qcm9qZWN0XCIsXG5cdFx0XHRUZWFtX01lbWJlcjogXCJwbGF0Zm9ybW1hbmFnZXJfVGVhbV9NZW1iZXJcIixcblx0XHRcdFJvbGU6IFwicGxhdGZvcm1tYW5hZ2VyX1JvbGVcIixcblx0XHR9KVtjXTtcblx0XHRyZXR1cm4gbmV3KGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IGdsb2JhbCA6IHhfNzg2MTFfcGxhdGZvcm1fMClbY10oKTtcblx0fVxuXG5cdF90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuY29kZSA9IHRoaXMuY29kZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5yZW1hcmsgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHJldC5yZW1hcmspID09PSAnb2JqZWN0JykgcmV0LnJlbWFyayA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5yZW1hcmspKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcHJvamVjdCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQucHJvamVjdCA9IHRoaXMucHJvamVjdCgpO1xuXG5cdFx0XHRpZiAocmV0LnByb2plY3QpIHtcblx0XHRcdFx0cmV0LnByb2plY3QgPSByZXQucHJvamVjdC5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5wcm9qZWN0KSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5wcm9qZWN0KS5sZW5ndGgpIHJldC5wcm9qZWN0ID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY2FwYWJpbGl0eSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuY2FwYWJpbGl0eSA9IHRoaXMuY2FwYWJpbGl0eSgpO1xuXG5cdFx0XHRpZiAocmV0LmNhcGFiaWxpdHkpIHtcblx0XHRcdFx0cmV0LmNhcGFiaWxpdHkgPSByZXQuY2FwYWJpbGl0eS5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5jYXBhYmlsaXR5KSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5jYXBhYmlsaXR5KS5sZW5ndGgpIHJldC5jYXBhYmlsaXR5ID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5yZXF1aXJlbWVudF9FZmZvcnRfRXN0aW1hdGVzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlcXVpcmVtZW50X0VmZm9ydF9Fc3RpbWF0ZXMgPSB0aGlzLnJlcXVpcmVtZW50X0VmZm9ydF9Fc3RpbWF0ZXMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLnJlcXVpcmVtZW50X0FnZW5kYV9JdGVtcygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZXF1aXJlbWVudF9BZ2VuZGFfSXRlbXMgPSB0aGlzLnJlcXVpcmVtZW50X0FnZW5kYV9JdGVtcygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHRcdH0pO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0ZGVsZXRlIHJldFtrXTtcblx0XHR9KTtcblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfdW5pcXVlKGtleXMsIHJldCkge1xuXHRcdHJldCA9IHJldCB8fCBuZXcgcGxhdGZvcm1tYW5hZ2VyX1JlcXVpcmVtZW50KCk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdC8vIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7XG5cdFx0aWYgKCFrZXlzKSB7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImNvZGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJuYW1lXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubmFtZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInJlbWFya1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJwcm9qZWN0XCIpID49IDAgJiYgdHlwZW9mKHRoaXMucHJvamVjdCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5wcm9qZWN0KHRoaXMucHJvamVjdCgpLl91bmlxdWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJjYXBhYmlsaXR5XCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY2FwYWJpbGl0eSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jYXBhYmlsaXR5KHRoaXMuY2FwYWJpbGl0eSgpLl91bmlxdWUoKSk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3F1ZXJ5KGdxKSB7XG5cdFx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF83ODYxMV9wbGF0Zm9ybV8wX3JlcXVpcmVtZW50JywgWycqJ10pWyd4Xzc4NjExX3BsYXRmb3JtXzBfcmVxdWlyZW1lbnQnXSk7XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EpIHRoaXMuX3F1ZXJ5R1EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkoJ3hfNzg2MTFfcGxhdGZvcm1fMF9yZXF1aXJlbWVudCcpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KSh0aGlzKSk7XG5cdFx0aWYgKGlkZiA9PSAnSWQnKSBpZGYgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3RpdmVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdFx0LyogZ3MuaW5mbyhcIlJlcXVpcmVtZW50Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdFx0LyogZ3MuaW5mbyhcIlJlcXVpcmVtZW50Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmFibGVkJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX2NvZGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmNvZGUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2NvZGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qIGdzLmluZm8oXCJSZXF1aXJlbWVudC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnY29kZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZGVyJykgPj0gMCkge1xuXHRcdFx0XHQvKiBncy5pbmZvKFwiUmVxdWlyZW1lbnQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2RhdGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qIGdzLmluZm8oXCJSZXF1aXJlbWVudC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGF0ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fbmFtZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9uYW1lX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5uYW1lKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCduYW1lJykgPj0gMCkge1xuXHRcdFx0XHQvKiBncy5pbmZvKFwiUmVxdWlyZW1lbnQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ25hbWUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX3JlbWFya19jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZW1hcmsnKSA+PSAwKSB7XG5cdFx0XHRcdC8qIGdzLmluZm8oXCJSZXF1aXJlbWVudC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3JlbWFyaycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9wcm9qZWN0KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcHJvamVjdF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnByb2plY3QoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJSZXF1aXJlbWVudFwiPT1cIkNvbHVtblwiKSBncy5pbmZvKFwiUmVxdWlyZW1lbnQuX3F1ZXJ5KCk6IFwiKyBcInByb2plY3QgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0Z3MuaW5mbyhcIlJlcXVpcmVtZW50Ll9xdWVyeSgpOiBcIiArIFwicHJvamVjdFtwcm9qZWN0XSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLnByb2plY3QoKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncHJvamVjdCcpID49IDApIHtcblx0XHRcdFx0LyogZ3MuaW5mbyhcIlJlcXVpcmVtZW50Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncHJvamVjdCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncHJvamVjdCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdwcm9qZWN0JywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NhcGFiaWxpdHkpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9jYXBhYmlsaXR5X2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY2FwYWJpbGl0eSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIlJlcXVpcmVtZW50XCI9PVwiQ29sdW1uXCIpIGdzLmluZm8oXCJSZXF1aXJlbWVudC5fcXVlcnkoKTogXCIrIFwiY2FwYWJpbGl0eSBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHRncy5pbmZvKFwiUmVxdWlyZW1lbnQuX3F1ZXJ5KCk6IFwiICsgXCJjYXBhYmlsaXR5W2NhcGFiaWxpdHldIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuY2FwYWJpbGl0eSgpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdjYXBhYmlsaXR5JykgPj0gMCkge1xuXHRcdFx0XHQvKiBncy5pbmZvKFwiUmVxdWlyZW1lbnQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdjYXBhYmlsaXR5Jyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdjYXBhYmlsaXR5Jyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2NhcGFiaWxpdHknLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHRcdC8qIGdzLmluZm8oXCJSZXF1aXJlbWVudC5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0XHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcblx0fVxuXG5cdF9zYXZlKG9iaikge1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdHJldHVybiBuZXcgcGxhdGZvcm1tYW5hZ2VyX1JlcXVpcmVtZW50KCkuX3NhdmUobylcblx0XHR9KTtcblxuXHRcdGxldCBfb2JqID0ge307XG5cblx0XHQvKmdzLmluZm8oXCJSZXF1aXJlbWVudC5fc2F2ZSgpOiBcIisgXCIuLi4gXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRPYmplY3Qua2V5cyhvYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF83ODYxMV9wbGF0Zm9ybV8wX3JlcXVpcmVtZW50JywgWycqJ10pWyd4Xzc4NjExX3BsYXRmb3JtXzBfcmVxdWlyZW1lbnQnXSkuZmlsdGVyKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiB0cnVlIHx8IFsnc3lzX3VwZGF0ZWRfb24nLCAnc3lzX2NyZWF0ZWRfb24nLCAndXBkYXRlcycsICdzeXNfY3JlYXRlZF9ieScsICdzeXNfdXBkYXRlZF9ieSddLmluZGV4T2YoX2spIDwgMFxuXHRcdFx0fSkuaW5kZXhPZihrLnRvTG93ZXJDYXNlKCkpID49IDBcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdF9vYmpbay50b0xvd2VyQ2FzZSgpXSA9IG9ialtrXVxuXHRcdH0pO1xuXG5cdFx0T2JqZWN0LmtleXMoX29iaikuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKF9vYmpba10pID09PSBcIltvYmplY3QgRGF0ZV1cIiAmJiBpc05hTihfb2JqW2tdKSkge1xuXHRcdFx0XHRncy5pbmZvKFwiUmVxdWlyZW1lbnQuX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdFx0Z3MuaW5mbyhcIlJlcXVpcmVtZW50Ll9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0bGV0IF90aGlzID0gbnVsbDtcblx0XHRpZiAob2JqLl9fa2V5cykge1xuXHRcdFx0bGV0IGtPYmogPSB7fTtcblx0XHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSkpKTtcblx0XHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0XHR9KTtcblx0XHRcdF90aGlzID0gbmV3IHBsYXRmb3JtbWFuYWdlcl9SZXF1aXJlbWVudCgpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF90aGlzID0gbmV3IHBsYXRmb3JtbWFuYWdlcl9SZXF1aXJlbWVudCgpLl9mcm9tRG9jdW1lbnQoX29iaikuX3VuaXF1ZSgpO1xuXHRcdH1cblxuXHRcdC8qZ3MuaW5mbyhcIlJlcXVpcmVtZW50Ll9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0XHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdFx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdFx0dHJ5IHtcblx0XHRcdGdzLmluZm8oXCJSZXF1aXJlbWVudC5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdGdzLmluZm8oXCJSZXF1aXJlbWVudC5fc2F2ZSgpOiBcIiArIFwicmVuYW1pbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHR2YXIgbGsgPSBrLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRcdF9vYmpbbGtdID0gX29ialtrXTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9KTtcblxuXHRcdFx0bGV0IGdxID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KG9iai5fX3R5cGUgfHwgJ3hfNzg2MTFfcGxhdGZvcm1fMF9yZXF1aXJlbWVudCcpO1xuXHRcdFx0Lypncy5pbmZvKFwiUmVxdWlyZW1lbnQuX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdFx0fVxuXHRcdFx0bGV0IF9mT2JqID0ge307XG5cdFx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKSkpO1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF83ODYxMV9wbGF0Zm9ybV8wX3JlcXVpcmVtZW50JywgWycqJ10pWyd4Xzc4NjExX3BsYXRmb3JtXzBfcmVxdWlyZW1lbnQnXSkpKSk7XG5cdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdGdzLmluZm8oXCJSZXF1aXJlbWVudC5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdFx0Z3MuaW5mbyhcIlJlcXVpcmVtZW50Ll9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fVxuXG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLnJlcXVpcmVtZW50X0VmZm9ydF9Fc3RpbWF0ZXMpKSB0aGlzLnJlcXVpcmVtZW50X0VmZm9ydF9Fc3RpbWF0ZXMob2JqLnJlcXVpcmVtZW50X0VmZm9ydF9Fc3RpbWF0ZXMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHBsYXRmb3JtbWFuYWdlcl9FZmZvcnRfRXN0aW1hdGUoKS5fc2F2ZSh0YSlcblx0XHR9KSk7XG5cblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmoucmVxdWlyZW1lbnRfQWdlbmRhX0l0ZW1zKSkgdGhpcy5yZXF1aXJlbWVudF9BZ2VuZGFfSXRlbXMob2JqLnJlcXVpcmVtZW50X0FnZW5kYV9JdGVtcy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgcGxhdGZvcm1tYW5hZ2VyX0FnZW5kYV9JdGVtKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBSZXF1aXJlbWVudC5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHN0b3JlKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obG9nT2JqKSB7XG5cdFx0XHRncy5pbmZvKFwiUmVxdWlyZW1lbnQuc3RvcmUoKTogXCIgKyBcImxvZ09iajogXCIgKyBKU09OLnN0cmluZ2lmeShsb2dPYmosIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHRncy5pbmZvKFwiUmVxdWlyZW1lbnQuc3RvcmUoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRncy5pbmZvKFwiUmVxdWlyZW1lbnQuc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdGdzLmluZm8oXCJSZXF1aXJlbWVudC5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0XHRsZXQgX3RoaXMgPSB0aGlzLl91bmlxdWUoKS5maW5kKCk7XG5cdFx0XHRpZiAoX3RoaXMpIHRoaXMuSWQgPSBfdGhpcy5JZDtcblxuXHRcdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogUmVxdWlyZW1lbnQuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmRBbGwoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihsb2dPYmopIHtcblx0XHRcdGdzLmluZm8oXCJSZXF1aXJlbWVudC5maW5kQWxsKCk6IFwiICsgXCJsb2dPYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkobG9nT2JqLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0Z3MuaW5mbyhcIlJlcXVpcmVtZW50LmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRncy5pbmZvKFwiUmVxdWlyZW1lbnQuZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0Z3MuaW5mbyhcIlJlcXVpcmVtZW50LmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoXCJSZXF1aXJlbWVudFwiKTtcblx0XHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0XHQvL3JldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQodGhpcy5fcXVlcnkoKS5zZWxlY3QoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF83ODYxMV9wbGF0Zm9ybV8wX3JlcXVpcmVtZW50JywgWycqJ10pWyd4Xzc4NjExX3BsYXRmb3JtXzBfcmVxdWlyZW1lbnQnXSkpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogUmVxdWlyZW1lbnQuZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmQoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihsb2dPYmopIHtcblx0XHRcdGdzLmluZm8oXCJSZXF1aXJlbWVudC5maW5kKCk6IFwiICsgXCJsb2dPYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkobG9nT2JqLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0Z3MuaW5mbyhcIlJlcXVpcmVtZW50LmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRncy5pbmZvKFwiUmVxdWlyZW1lbnQuZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0Z3MuaW5mbyhcIlJlcXVpcmVtZW50LmZpbmQoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0bGV0IHJldCA9IHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0cmV0dXJuIHJldC5sZW5ndGggPyByZXRbMF0gOiBudWxsO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxufSJ9LHsiYWN0aXZlIjp0cnVlLCJhY2Nlc3MiOiJwYWNrYWdlX3ByaXZhdGUiLCJjYWxsZXJfYWNjZXNzIjpudWxsLCJzeXNfbmFtZSI6InBsYXRmb3JtbWFuYWdlcl9UZWFtX01lbWJlciIsImFwaV9uYW1lIjoieF83ODYxMV9wbGF0Zm9ybV8wLnBsYXRmb3JtbWFuYWdlcl9UZWFtX01lbWJlciIsIm5hbWUiOiJwbGF0Zm9ybW1hbmFnZXJfVGVhbV9NZW1iZXIiLCJzY3JpcHQiOiJjbGFzcyBwbGF0Zm9ybW1hbmFnZXJfVGVhbV9NZW1iZXIge1xuXHRjb25zdHJ1Y3RvcihpZCkge1xuXHRcdHVuZGVmaW5lZFxuXHRcdHRoaXMuSWQgPSBpZDtcblx0XHR0aGlzLl9fbW9kdWxlID0gXCJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwicGxhdGZvcm1tYW5hZ2VyX1RlYW1fTWVtYmVyXCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJwbGF0Zm9ybW1hbmFnZXJcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInBsYXRmb3JtbWFuYWdlclwiO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogVGVhbV9NZW1iZXIuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUZWFtX01lbWJlci5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVGVhbV9NZW1iZXIuY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRlYW1fTWVtYmVyLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRlYW1fTWVtYmVyLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly9ncy5pbmZvKFwiVGVhbV9NZW1iZXIuZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRlYW1fTWVtYmVyLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUZWFtX01lbWJlci5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRlYW1fTWVtYmVyLnRlYW0gR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHR0ZWFtKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl90ZWFtID0gdjtcblx0XHRcdHRoaXMuX3RlYW1fY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fdGVhbTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUZWFtX01lbWJlci5tZW1iZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRtZW1iZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX21lbWJlciA9IHY7XG5cdFx0XHR0aGlzLl9tZW1iZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbWVtYmVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRlYW1fTWVtYmVyLnJvbGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyb2xlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yb2xlID0gdjtcblx0XHRcdHRoaXMuX3JvbGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcm9sZTtcblx0XHR9XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnY29kZScgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ25hbWUnICsgKHRoaXMuX25hbWVfY29vcCB8fCAnPScpICsgdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAodGhpcy5fcmVtYXJrKSByZXQgKz0gJ14nICsgc1BhdGggKyAncmVtYXJrJyArICh0aGlzLl9yZW1hcmtfY29vcCB8fCAnPScpICsgdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmICh0aGlzLl90ZWFtKSByZXQgKz0gLyoodGhpcy5fdGVhbV9jb29wIHx8ICc9JykgKyAqLyB0aGlzLnRlYW0oKS5fdG9FUXVlcnkoc1BhdGggKyAndGVhbS4nKTtcblxuXHRcdGlmICh0aGlzLl9tZW1iZXIpIHJldCArPSAvKih0aGlzLl9tZW1iZXJfY29vcCB8fCAnPScpICsgKi8gdGhpcy5tZW1iZXIoKS5fdG9FUXVlcnkoc1BhdGggKyAnbWVtYmVyLicpO1xuXG5cdFx0aWYgKHRoaXMuX3JvbGUpIHJldCArPSAvKih0aGlzLl9yb2xlX2Nvb3AgfHwgJz0nKSArICovIHRoaXMucm9sZSgpLl90b0VRdWVyeShzUGF0aCArICdyb2xlLicpO1xuXG5cdFx0Z3MuaW5mbyhcIlRlYW1fTWVtYmVyLl90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykgcmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0Z3MuaW5mbyhcIlRlYW1fTWVtYmVyLl9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0Z3MuaW5mbyhcIlRlYW1fTWVtYmVyLl9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7IC8vIHRlc3RcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgcGxhdGZvcm1tYW5hZ2VyX1RlYW1fTWVtYmVyKCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0dHJ5IHtcblx0XHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0Lypncy5pbmZvKFwiVGVhbV9NZW1iZXIuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdFx0fTtcblx0XHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRcdFx0aWYgKG9iai5nZXRUYWJsZU5hbWUoKSA9PSAnZWNjX3F1ZXVlJyAmJiBcIlRlYW1fTWVtYmVyXCIgIT0gJ2VjY19xdWV1ZScgJiYgb2JqLnNvdXJjZSA9PSBcIlRlYW1fTWVtYmVyXCIpIHtcblx0XHRcdFx0XHRcdG9iai5zdGF0ZSA9IFwicHJvY2Vzc2luZ1wiO1xuXHRcdFx0XHRcdFx0b2JqLnVwZGF0ZSgpO1xuXG5cdFx0XHRcdFx0XHRsZXQgcmVzcCA9IG5ldyBHbGlkZVJlY29yZCgnZWNjX3F1ZXVlJyk7XG5cdFx0XHRcdFx0XHRyZXNwLnJlc3BvbnNlX3RvID0gb2JqLnN5c19pZDtcblx0XHRcdFx0XHRcdHJlc3AucXVldWUgPSAnb3V0cHV0Jztcblx0XHRcdFx0XHRcdHJlc3AuYWdlbnQgPSBvYmouYWdlbnQ7XG5cdFx0XHRcdFx0XHRyZXNwLnRvcGljID0gb2JqLnRvcGljO1xuXHRcdFx0XHRcdFx0cmVzcC5uYW1lID0gb2JqLm5hbWU7XG5cdFx0XHRcdFx0XHRyZXNwLnNvdXJjZSA9IG9iai5zb3VyY2U7XG5cdFx0XHRcdFx0XHRyZXNwLmZyb21faG9zdCA9IG9iai5hZ2VudF9jb3JyZWxhdG9yO1xuXHRcdFx0XHRcdFx0cmVzcC5hZ2VudF9jb3JyZWxhdG9yID0gb2JqLmZyb21faG9zdDtcblxuXHRcdFx0XHRcdFx0bGV0IHJldCA9IG5ldyBwbGF0Zm9ybW1hbmFnZXJfVGVhbV9NZW1iZXIoKS5fZnJvbURvY3VtZW50KCkuX2ludm9rZShvYmoubmFtZS50b1N0cmluZygpLCBvYmoucGF5bG9hZC50b1N0cmluZygpKTtcblx0XHRcdFx0XHRcdGlmIChBcnJheS5pc0FycmF5KHJldCkpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gcmV0Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIChyICYmIHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJykgPyByLl90b0RvY3VtZW50KCkgOiByO1xuXHRcdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAocmV0ICYmIHR5cGVvZihyZXQuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHJldC5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmVzcC5wYXlsb2FkID0gSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KTtcblxuXHRcdFx0XHRcdFx0cmVzcC5pbnNlcnQoKTtcblxuXHRcdFx0XHRcdFx0b2JqLnN0YXRlID0gXCJwcm9jZXNzZWRcIjtcblx0XHRcdFx0XHRcdG9iai51cGRhdGUoKTtcblx0XHRcdFx0XHRcdHJldHVybiByZXNwO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdFx0Y29kZTogb2JqLmdldFZhbHVlKFwiY29kZVwiKSxcblxuXHRcdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0XHRyZW1hcms6IG9iai5nZXRWYWx1ZShcInJlbWFya1wiKSxcblxuXHRcdFx0XHRcdFx0dGVhbTogb2JqLmdldFZhbHVlKFwidGVhbVwiKSxcblxuXHRcdFx0XHRcdFx0bWVtYmVyOiBvYmouZ2V0VmFsdWUoXCJtZW1iZXJcIiksXG5cblx0XHRcdFx0XHRcdHJvbGU6IG9iai5nZXRWYWx1ZShcInJvbGVcIiksXG5cblx0XHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbURvY3VtZW50KG9iaikpO1xuXHRcdFx0XHRcdC8qZ3MuaW5mbyhcIlRlYW1fTWVtYmVyLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHRcdGdzLmluZm8oXCJUZWFtX01lbWJlci5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdFx0cmV0dXJuIG9iajtcblx0XHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0XHRyZXR1cm4gbmV3IHBsYXRmb3JtbWFuYWdlcl9UZWFtX01lbWJlcigpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdFx0Lypncy5pbmZvKFwiVGVhbV9NZW1iZXIuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmNvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLmNvZGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLm5hbWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmoucmVtYXJrKSkpO1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmoucmVtYXJrKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai50ZWFtKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy50ZWFtKG5ldyBwbGF0Zm9ybW1hbmFnZXJfVGVhbSgpLl9mcm9tRG9jdW1lbnQob2JqLnRlYW0pKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5tZW1iZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm1lbWJlcihuZXcgcGxhdGZvcm1tYW5hZ2VyX1VzZXIoKS5fZnJvbURvY3VtZW50KG9iai5tZW1iZXIpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5yb2xlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5yb2xlKG5ldyBwbGF0Zm9ybW1hbmFnZXJfUm9sZSgpLl9mcm9tRG9jdW1lbnQob2JqLnJvbGUpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiVGVhbV9NZW1iZXJcIil7XG5cdFx0XHRcdFx0Z3MuaW5mbyhcIlRlYW1fTWVtYmVyLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Z3MuaW5mbyhcIlRlYW1fTWVtYmVyLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IFwiICsgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHRncy5pbmZvKFwiVGVhbV9NZW1iZXIuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwiaW52YWxpZCBvYmplY3QgXCIgKyBcInR5cGVvZihvYmopOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZihvYmopLCBudWxsLCA0KSk7XG5cdFx0fVxuXG5cdFx0Lypncy5pbmZvKFwiVGVhbV9NZW1iZXIuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHRcdC8qZ3MuaW5mbyhcIlRlYW1fTWVtYmVyLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7Ki9cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9uZXcoYykge1xuXHRcdGlmICghYykgYyA9IHRoaXMuX190eXBlO1xuXHRcdGlmIChjLmluZGV4T2YoJ3BsYXRmb3JtbWFuYWdlcl8nKSAhPSAwKSBjID0gKHtcblx0XHRcdFBsYXRmb3JtOiBcInBsYXRmb3JtbWFuYWdlcl9QbGF0Zm9ybVwiLFxuXHRcdFx0VXNlcjogXCJwbGF0Zm9ybW1hbmFnZXJfVXNlclwiLFxuXHRcdFx0UmVxdWlyZW1lbnQ6IFwicGxhdGZvcm1tYW5hZ2VyX1JlcXVpcmVtZW50XCIsXG5cdFx0XHRFZmZvcnRfRXN0aW1hdGU6IFwicGxhdGZvcm1tYW5hZ2VyX0VmZm9ydF9Fc3RpbWF0ZVwiLFxuXHRcdFx0RWZmb3J0OiBcInBsYXRmb3JtbWFuYWdlcl9FZmZvcnRcIixcblx0XHRcdEJ1ZGdldDogXCJwbGF0Zm9ybW1hbmFnZXJfQnVkZ2V0XCIsXG5cdFx0XHRBZ2VuZGFfSXRlbTogXCJwbGF0Zm9ybW1hbmFnZXJfQWdlbmRhX0l0ZW1cIixcblx0XHRcdE1lZXRpbmdfQWdlbmRhOiBcInBsYXRmb3JtbWFuYWdlcl9NZWV0aW5nX0FnZW5kYVwiLFxuXHRcdFx0RGVjaXNpb25fT3B0aW9uOiBcInBsYXRmb3JtbWFuYWdlcl9EZWNpc2lvbl9PcHRpb25cIixcblx0XHRcdERlY2lzaW9uOiBcInBsYXRmb3JtbWFuYWdlcl9EZWNpc2lvblwiLFxuXHRcdFx0TWVldGluZ19NaW51dGU6IFwicGxhdGZvcm1tYW5hZ2VyX01lZXRpbmdfTWludXRlXCIsXG5cdFx0XHRNZWV0aW5nX1NlcmllczogXCJwbGF0Zm9ybW1hbmFnZXJfTWVldGluZ19TZXJpZXNcIixcblx0XHRcdE1lZXRpbmc6IFwicGxhdGZvcm1tYW5hZ2VyX01lZXRpbmdcIixcblx0XHRcdEJvYXJkOiBcInBsYXRmb3JtbWFuYWdlcl9Cb2FyZFwiLFxuXHRcdFx0Qm9hcmRfTWVtYmVyOiBcInBsYXRmb3JtbWFuYWdlcl9Cb2FyZF9NZW1iZXJcIixcblx0XHRcdEZyZXF1ZW5jeTogXCJwbGF0Zm9ybW1hbmFnZXJfRnJlcXVlbmN5XCIsXG5cdFx0XHRNb2R1bGU6IFwicGxhdGZvcm1tYW5hZ2VyX01vZHVsZVwiLFxuXHRcdFx0Q2FwYWJpbGl0eTogXCJwbGF0Zm9ybW1hbmFnZXJfQ2FwYWJpbGl0eVwiLFxuXHRcdFx0VGVhbTogXCJwbGF0Zm9ybW1hbmFnZXJfVGVhbVwiLFxuXHRcdFx0UHJvamVjdDogXCJwbGF0Zm9ybW1hbmFnZXJfUHJvamVjdFwiLFxuXHRcdFx0VGVhbV9NZW1iZXI6IFwicGxhdGZvcm1tYW5hZ2VyX1RlYW1fTWVtYmVyXCIsXG5cdFx0XHRSb2xlOiBcInBsYXRmb3JtbWFuYWdlcl9Sb2xlXCIsXG5cdFx0fSlbY107XG5cdFx0cmV0dXJuIG5ldyhncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBnbG9iYWwgOiB4Xzc4NjExX3BsYXRmb3JtXzApW2NdKCk7XG5cdH1cblxuXHRfdG9Eb2N1bWVudChhckZpZWxkcykge1xuXG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCB7fTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSByZXQuc3lzX2lkID0gdGhpcy5JZDtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5hY3RpdmUgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5lbmFibGVkID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmNvZGUgPSB0aGlzLmNvZGUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm9yZGVyID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5kYXRlID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmIChyZXQuZGF0ZSAmJiB0eXBlb2YocmV0LmRhdGUudG9JU09TdHJpbmcpID09PSAnZnVuY3Rpb24nKSByZXQuZGF0ZSA9IHJldC5kYXRlLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5uYW1lID0gdGhpcy5uYW1lKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQucmVtYXJrID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKHR5cGVvZihyZXQucmVtYXJrKSA9PT0gJ29iamVjdCcpIHJldC5yZW1hcmsgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NEVuY29kZShKU09OLnN0cmluZ2lmeShyZXQucmVtYXJrKSk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3RlYW0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnRlYW0gPSB0aGlzLnRlYW0oKTtcblxuXHRcdFx0aWYgKHJldC50ZWFtKSB7XG5cdFx0XHRcdHJldC50ZWFtID0gcmV0LnRlYW0uX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQudGVhbSkgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQudGVhbSkubGVuZ3RoKSByZXQudGVhbSA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX21lbWJlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubWVtYmVyID0gdGhpcy5tZW1iZXIoKTtcblxuXHRcdFx0aWYgKHJldC5tZW1iZXIpIHtcblx0XHRcdFx0cmV0Lm1lbWJlciA9IHJldC5tZW1iZXIuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQubWVtYmVyKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5tZW1iZXIpLmxlbmd0aCkgcmV0Lm1lbWJlciA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JvbGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnJvbGUgPSB0aGlzLnJvbGUoKTtcblxuXHRcdFx0aWYgKHJldC5yb2xlKSB7XG5cdFx0XHRcdHJldC5yb2xlID0gcmV0LnJvbGUuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0aWYgKHR5cGVvZihyZXQucm9sZSkgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQucm9sZSkubGVuZ3RoKSByZXQucm9sZSA9IG51bGw7XG5cdFx0XHR9XG5cblx0XHR9XG5cblx0XHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHRcdH0pO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0ZGVsZXRlIHJldFtrXTtcblx0XHR9KTtcblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfdW5pcXVlKGtleXMsIHJldCkge1xuXHRcdHJldCA9IHJldCB8fCBuZXcgcGxhdGZvcm1tYW5hZ2VyX1RlYW1fTWVtYmVyKCk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdC8vIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7XG5cdFx0aWYgKCFrZXlzKSB7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImNvZGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJuYW1lXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubmFtZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInJlbWFya1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJ0ZWFtXCIpID49IDAgJiYgdHlwZW9mKHRoaXMudGVhbSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC50ZWFtKHRoaXMudGVhbSgpLl91bmlxdWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJtZW1iZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5tZW1iZXIoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubWVtYmVyKHRoaXMubWVtYmVyKCkuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInJvbGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yb2xlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJvbGUodGhpcy5yb2xlKCkuX3VuaXF1ZSgpKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfcXVlcnkoZ3EpIHtcblx0XHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4Xzc4NjExX3BsYXRmb3JtXzBfdGVhbV9tZW1iZXInLCBbJyonXSlbJ3hfNzg2MTFfcGxhdGZvcm1fMF90ZWFtX21lbWJlciddKTtcblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgneF83ODYxMV9wbGF0Zm9ybV8wX3RlYW1fbWVtYmVyJyk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKHRoaXMpKTtcblx0XHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0XHQvKiBncy5pbmZvKFwiVGVhbV9NZW1iZXIuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0XHQvKiBncy5pbmZvKFwiVGVhbV9NZW1iZXIuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdFx0LyogZ3MuaW5mbyhcIlRlYW1fTWVtYmVyLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdjb2RlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHRcdC8qIGdzLmluZm8oXCJUZWFtX01lbWJlci5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF0ZScpID49IDApIHtcblx0XHRcdFx0LyogZ3MuaW5mbyhcIlRlYW1fTWVtYmVyLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qIGdzLmluZm8oXCJUZWFtX01lbWJlci5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3JlbWFyaycpID49IDApIHtcblx0XHRcdFx0LyogZ3MuaW5mbyhcIlRlYW1fTWVtYmVyLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVtYXJrJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3RlYW0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl90ZWFtX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMudGVhbSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIlRlYW0gTWVtYmVyXCI9PVwiQ29sdW1uXCIpIGdzLmluZm8oXCJUZWFtX01lbWJlci5fcXVlcnkoKTogXCIrIFwidGVhbSBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHRncy5pbmZvKFwiVGVhbV9NZW1iZXIuX3F1ZXJ5KCk6IFwiICsgXCJ0ZWFtW3RlYW1dIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMudGVhbSgpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCd0ZWFtJykgPj0gMCkge1xuXHRcdFx0XHQvKiBncy5pbmZvKFwiVGVhbV9NZW1iZXIuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCd0ZWFtJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCd0ZWFtJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3RlYW0nLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbWVtYmVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fbWVtYmVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubWVtYmVyKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiVGVhbSBNZW1iZXJcIj09XCJDb2x1bW5cIikgZ3MuaW5mbyhcIlRlYW1fTWVtYmVyLl9xdWVyeSgpOiBcIisgXCJtZW1iZXIgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0Z3MuaW5mbyhcIlRlYW1fTWVtYmVyLl9xdWVyeSgpOiBcIiArIFwibWVtYmVyW21lbWJlcl0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5tZW1iZXIoKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbWVtYmVyJykgPj0gMCkge1xuXHRcdFx0XHQvKiBncy5pbmZvKFwiVGVhbV9NZW1iZXIuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdtZW1iZXInKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ21lbWJlcicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdtZW1iZXInLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcm9sZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3JvbGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yb2xlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiVGVhbSBNZW1iZXJcIj09XCJDb2x1bW5cIikgZ3MuaW5mbyhcIlRlYW1fTWVtYmVyLl9xdWVyeSgpOiBcIisgXCJyb2xlIFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdGdzLmluZm8oXCJUZWFtX01lbWJlci5fcXVlcnkoKTogXCIgKyBcInJvbGVbcm9sZV0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5yb2xlKCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3JvbGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qIGdzLmluZm8oXCJUZWFtX01lbWJlci5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JvbGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3JvbGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncm9sZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdFx0LyogZ3MuaW5mbyhcIlRlYW1fTWVtYmVyLl9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdHJldHVybiB0aGlzLl9xdWVyeUdRO1xuXHR9XG5cblx0X3NhdmUob2JqKSB7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0cmV0dXJuIG5ldyBwbGF0Zm9ybW1hbmFnZXJfVGVhbV9NZW1iZXIoKS5fc2F2ZShvKVxuXHRcdH0pO1xuXG5cdFx0bGV0IF9vYmogPSB7fTtcblxuXHRcdC8qZ3MuaW5mbyhcIlRlYW1fTWVtYmVyLl9zYXZlKCk6IFwiKyBcIi4uLiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4Xzc4NjExX3BsYXRmb3JtXzBfdGVhbV9tZW1iZXInLCBbJyonXSlbJ3hfNzg2MTFfcGxhdGZvcm1fMF90ZWFtX21lbWJlciddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdFx0fSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHRcdGdzLmluZm8oXCJUZWFtX01lbWJlci5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0XHRncy5pbmZvKFwiVGVhbV9NZW1iZXIuX3NhdmUoKTogXCIgKyBcInN5c19pZCB0byBzdHJpbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRsZXQgX3RoaXMgPSBudWxsO1xuXHRcdGlmIChvYmouX19rZXlzKSB7XG5cdFx0XHRsZXQga09iaiA9IHt9O1xuXHRcdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShfb2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKSkpO1xuXHRcdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHRcdH0pO1xuXHRcdFx0X3RoaXMgPSBuZXcgcGxhdGZvcm1tYW5hZ2VyX1RlYW1fTWVtYmVyKCkuX2Zyb21Eb2N1bWVudChrT2JqKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0X3RoaXMgPSBuZXcgcGxhdGZvcm1tYW5hZ2VyX1RlYW1fTWVtYmVyKCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdFx0fVxuXG5cdFx0Lypncy5pbmZvKFwiVGVhbV9NZW1iZXIuX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRcdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0XHRkZWxldGUgX29iai5fX2lkRmllbGQ7XG5cblx0XHR0cnkge1xuXHRcdFx0Z3MuaW5mbyhcIlRlYW1fTWVtYmVyLl9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0Z3MuaW5mbyhcIlRlYW1fTWVtYmVyLl9zYXZlKCk6IFwiICsgXCJyZW5hbWluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0pO1xuXG5cdFx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAneF83ODYxMV9wbGF0Zm9ybV8wX3RlYW1fbWVtYmVyJyk7XG5cdFx0XHQvKmdzLmluZm8oXCJUZWFtX01lbWJlci5fc2F2ZSgpOiBcIisgXCJ1cHNlcnRpbmcuLi4gXCIrIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7Ki9cblx0XHRcdGlmIChfb2JqLnN5c19pZCkge1xuXHRcdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X29iai5zeXNfaWQgPSBncy5nZW5lcmF0ZUdVSUQoKTtcblx0XHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0XHR9XG5cdFx0XHRsZXQgX2ZPYmogPSB7fTtcblx0XHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpKSk7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4Xzc4NjExX3BsYXRmb3JtXzBfdGVhbV9tZW1iZXInLCBbJyonXSlbJ3hfNzg2MTFfcGxhdGZvcm1fMF90ZWFtX21lbWJlciddKSkpKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0Z3MuaW5mbyhcIlRlYW1fTWVtYmVyLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0XHRncy5pbmZvKFwiVGVhbV9NZW1iZXIuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRlYW1fTWVtYmVyLnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RvcmUoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihsb2dPYmopIHtcblx0XHRcdGdzLmluZm8oXCJUZWFtX01lbWJlci5zdG9yZSgpOiBcIiArIFwibG9nT2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KGxvZ09iaiwgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdGdzLmluZm8oXCJUZWFtX01lbWJlci5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGdzLmluZm8oXCJUZWFtX01lbWJlci5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0Z3MuaW5mbyhcIlRlYW1fTWVtYmVyLnN0b3JlKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRcdGxldCBfdGhpcyA9IHRoaXMuX3VuaXF1ZSgpLmZpbmQoKTtcblx0XHRcdGlmIChfdGhpcykgdGhpcy5JZCA9IF90aGlzLklkO1xuXG5cdFx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUZWFtX01lbWJlci5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZEFsbChfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKGxvZ09iaikge1xuXHRcdFx0Z3MuaW5mbyhcIlRlYW1fTWVtYmVyLmZpbmRBbGwoKTogXCIgKyBcImxvZ09iajogXCIgKyBKU09OLnN0cmluZ2lmeShsb2dPYmosIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHRncy5pbmZvKFwiVGVhbV9NZW1iZXIuZmluZEFsbCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGdzLmluZm8oXCJUZWFtX01lbWJlci5maW5kQWxsKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHRncy5pbmZvKFwiVGVhbV9NZW1iZXIuZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZChcIlRlYW1fTWVtYmVyXCIpO1xuXHRcdFx0Z3IuYWRkRW5jb2RlZFF1ZXJ5KHRoaXMuX3RvRVF1ZXJ5KCkpO1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChncik7XG5cblx0XHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4Xzc4NjExX3BsYXRmb3JtXzBfdGVhbV9tZW1iZXInLCBbJyonXSlbJ3hfNzg2MTFfcGxhdGZvcm1fMF90ZWFtX21lbWJlciddKSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUZWFtX01lbWJlci5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZChfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKGxvZ09iaikge1xuXHRcdFx0Z3MuaW5mbyhcIlRlYW1fTWVtYmVyLmZpbmQoKTogXCIgKyBcImxvZ09iajogXCIgKyBKU09OLnN0cmluZ2lmeShsb2dPYmosIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHRncy5pbmZvKFwiVGVhbV9NZW1iZXIuZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGdzLmluZm8oXCJUZWFtX01lbWJlci5maW5kKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHRncy5pbmZvKFwiVGVhbV9NZW1iZXIuZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG59In0seyJhY3RpdmUiOnRydWUsImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInN5c19uYW1lIjoicGxhdGZvcm1tYW5hZ2VyX0JvYXJkX01lbWJlciIsImFwaV9uYW1lIjoieF83ODYxMV9wbGF0Zm9ybV8wLnBsYXRmb3JtbWFuYWdlcl9Cb2FyZF9NZW1iZXIiLCJuYW1lIjoicGxhdGZvcm1tYW5hZ2VyX0JvYXJkX01lbWJlciIsInNjcmlwdCI6ImNsYXNzIHBsYXRmb3JtbWFuYWdlcl9Cb2FyZF9NZW1iZXIge1xuXHRjb25zdHJ1Y3RvcihpZCkge1xuXHRcdHVuZGVmaW5lZFxuXHRcdHRoaXMuSWQgPSBpZDtcblx0XHR0aGlzLl9fbW9kdWxlID0gXCJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwicGxhdGZvcm1tYW5hZ2VyX0JvYXJkX01lbWJlclwiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwicGxhdGZvcm1tYW5hZ2VyXCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJwbGF0Zm9ybW1hbmFnZXJcIjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEJvYXJkX01lbWJlci5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEJvYXJkX01lbWJlci5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQm9hcmRfTWVtYmVyLmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBCb2FyZF9NZW1iZXIub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQm9hcmRfTWVtYmVyLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly9ncy5pbmZvKFwiQm9hcmRfTWVtYmVyLmRhdGUoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9kYXRlID0gdjtcblx0XHRcdHRoaXMuX2RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGF0ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBCb2FyZF9NZW1iZXIubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG5hbWUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX25hbWUgPSB2O1xuXHRcdFx0dGhpcy5fbmFtZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9uYW1lO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEJvYXJkX01lbWJlci5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEJvYXJkX01lbWJlci5zdGFydCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHN0YXJ0KHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly9ncy5pbmZvKFwiQm9hcmRfTWVtYmVyLnN0YXJ0KCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fc3RhcnQgPSB2O1xuXHRcdFx0dGhpcy5fc3RhcnRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fc3RhcnQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQm9hcmRfTWVtYmVyLmVuZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVuZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vZ3MuaW5mbyhcIkJvYXJkX01lbWJlci5lbmQoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9lbmQgPSB2O1xuXHRcdFx0dGhpcy5fZW5kX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBCb2FyZF9NZW1iZXIuYm9hcmQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRib2FyZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYm9hcmQgPSB2O1xuXHRcdFx0dGhpcy5fYm9hcmRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYm9hcmQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQm9hcmRfTWVtYmVyLm1lbWJlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG1lbWJlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbWVtYmVyID0gdjtcblx0XHRcdHRoaXMuX21lbWJlcl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9tZW1iZXI7XG5cdFx0fVxuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2NvZGUnICsgKHRoaXMuX2NvZGVfY29vcCB8fCAnPScpICsgdGhpcy5jb2RlKCk7XG5cblx0XHRpZiAodGhpcy5fb3JkZXIpIHJldCArPSAnXicgKyBzUGF0aCArICdvcmRlcicgKyAodGhpcy5fb3JkZXJfY29vcCB8fCAnPScpICsgdGhpcy5vcmRlcigpO1xuXG5cdFx0aWYgKHRoaXMuX2RhdGUpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXRlJyArICh0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF0ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX25hbWUpIHJldCArPSAnXicgKyBzUGF0aCArICduYW1lJyArICh0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nKSArIHRoaXMubmFtZSgpO1xuXG5cdFx0aWYgKHRoaXMuX3JlbWFyaykgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3JlbWFyaycgKyAodGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nKSArIHRoaXMucmVtYXJrKCk7XG5cblx0XHRpZiAodGhpcy5fc3RhcnQpIHJldCArPSAnXicgKyBzUGF0aCArICdzdGFydCcgKyAodGhpcy5fc3RhcnRfY29vcCB8fCAnPScpICsgdGhpcy5zdGFydCgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuZCcgKyAodGhpcy5fZW5kX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5kKCk7XG5cblx0XHRpZiAodGhpcy5fYm9hcmQpIHJldCArPSAvKih0aGlzLl9ib2FyZF9jb29wIHx8ICc9JykgKyAqLyB0aGlzLmJvYXJkKCkuX3RvRVF1ZXJ5KHNQYXRoICsgJ2JvYXJkLicpO1xuXG5cdFx0aWYgKHRoaXMuX21lbWJlcikgcmV0ICs9IC8qKHRoaXMuX21lbWJlcl9jb29wIHx8ICc9JykgKyAqLyB0aGlzLm1lbWJlcigpLl90b0VRdWVyeShzUGF0aCArICdtZW1iZXIuJyk7XG5cblx0XHRncy5pbmZvKFwiQm9hcmRfTWVtYmVyLl90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykgcmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0Z3MuaW5mbyhcIkJvYXJkX01lbWJlci5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdGdzLmluZm8oXCJCb2FyZF9NZW1iZXIuX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpczsgLy8gdGVzdFxuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBwbGF0Zm9ybW1hbmFnZXJfQm9hcmRfTWVtYmVyKCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0dHJ5IHtcblx0XHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0Lypncy5pbmZvKFwiQm9hcmRfTWVtYmVyLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0XHRsZXQgX29iaiA9IHtcblx0XHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHRcdH07XG5cdFx0XHRcdF9vYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSldID0gb2JqO1xuXHRcdFx0XHRvYmogPSBfb2JqO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChvYmopO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRpZiAob2JqLmlzVmFsaWRSZWNvcmQoKSkge1xuXHRcdFx0XHRcdGlmIChvYmouZ2V0VGFibGVOYW1lKCkgPT0gJ2VjY19xdWV1ZScgJiYgXCJCb2FyZF9NZW1iZXJcIiAhPSAnZWNjX3F1ZXVlJyAmJiBvYmouc291cmNlID09IFwiQm9hcmRfTWVtYmVyXCIpIHtcblx0XHRcdFx0XHRcdG9iai5zdGF0ZSA9IFwicHJvY2Vzc2luZ1wiO1xuXHRcdFx0XHRcdFx0b2JqLnVwZGF0ZSgpO1xuXG5cdFx0XHRcdFx0XHRsZXQgcmVzcCA9IG5ldyBHbGlkZVJlY29yZCgnZWNjX3F1ZXVlJyk7XG5cdFx0XHRcdFx0XHRyZXNwLnJlc3BvbnNlX3RvID0gb2JqLnN5c19pZDtcblx0XHRcdFx0XHRcdHJlc3AucXVldWUgPSAnb3V0cHV0Jztcblx0XHRcdFx0XHRcdHJlc3AuYWdlbnQgPSBvYmouYWdlbnQ7XG5cdFx0XHRcdFx0XHRyZXNwLnRvcGljID0gb2JqLnRvcGljO1xuXHRcdFx0XHRcdFx0cmVzcC5uYW1lID0gb2JqLm5hbWU7XG5cdFx0XHRcdFx0XHRyZXNwLnNvdXJjZSA9IG9iai5zb3VyY2U7XG5cdFx0XHRcdFx0XHRyZXNwLmZyb21faG9zdCA9IG9iai5hZ2VudF9jb3JyZWxhdG9yO1xuXHRcdFx0XHRcdFx0cmVzcC5hZ2VudF9jb3JyZWxhdG9yID0gb2JqLmZyb21faG9zdDtcblxuXHRcdFx0XHRcdFx0bGV0IHJldCA9IG5ldyBwbGF0Zm9ybW1hbmFnZXJfQm9hcmRfTWVtYmVyKCkuX2Zyb21Eb2N1bWVudCgpLl9pbnZva2Uob2JqLm5hbWUudG9TdHJpbmcoKSwgb2JqLnBheWxvYWQudG9TdHJpbmcoKSk7XG5cdFx0XHRcdFx0XHRpZiAoQXJyYXkuaXNBcnJheShyZXQpKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHJldC5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiAociAmJiB0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicpID8gci5fdG9Eb2N1bWVudCgpIDogcjtcblx0XHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHJldCAmJiB0eXBlb2YocmV0Ll90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByZXQuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJlc3AucGF5bG9hZCA9IEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCk7XG5cblx0XHRcdFx0XHRcdHJlc3AuaW5zZXJ0KCk7XG5cblx0XHRcdFx0XHRcdG9iai5zdGF0ZSA9IFwicHJvY2Vzc2VkXCI7XG5cdFx0XHRcdFx0XHRvYmoudXBkYXRlKCk7XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmVzcDtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRcdGVuYWJsZWQ6IG9iai5nZXRWYWx1ZShcImVuYWJsZWRcIiksXG5cblx0XHRcdFx0XHRcdGNvZGU6IG9iai5nZXRWYWx1ZShcImNvZGVcIiksXG5cblx0XHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdFx0cmVtYXJrOiBvYmouZ2V0VmFsdWUoXCJyZW1hcmtcIiksXG5cblx0XHRcdFx0XHRcdHN0YXJ0OiBvYmouZ2V0VmFsdWUoXCJzdGFydFwiKSxcblxuXHRcdFx0XHRcdFx0ZW5kOiBvYmouZ2V0VmFsdWUoXCJlbmRcIiksXG5cblx0XHRcdFx0XHRcdGJvYXJkOiBvYmouZ2V0VmFsdWUoXCJib2FyZFwiKSxcblxuXHRcdFx0XHRcdFx0bWVtYmVyOiBvYmouZ2V0VmFsdWUoXCJtZW1iZXJcIiksXG5cblx0XHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbURvY3VtZW50KG9iaikpO1xuXHRcdFx0XHRcdC8qZ3MuaW5mbyhcIkJvYXJkX01lbWJlci5fZnJvbURvY3VtZW50KCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0XHRcdHJldHVybiBnclJldDtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0XHRncy5pbmZvKFwiQm9hcmRfTWVtYmVyLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0XHRyZXR1cm4gb2JqO1xuXHRcdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRcdHJldHVybiBuZXcgcGxhdGZvcm1tYW5hZ2VyX0JvYXJkX01lbWJlcigpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdFx0Lypncy5pbmZvKFwiQm9hcmRfTWVtYmVyLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5jb2RlKG9iai5jb2RlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5uYW1lKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLnJlbWFyaykpKTtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLnJlbWFyayk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouc3RhcnQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnN0YXJ0KG9iai5zdGFydCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5kKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5lbmQob2JqLmVuZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYm9hcmQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmJvYXJkKG5ldyBwbGF0Zm9ybW1hbmFnZXJfQm9hcmQoKS5fZnJvbURvY3VtZW50KG9iai5ib2FyZCkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm1lbWJlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubWVtYmVyKG5ldyBwbGF0Zm9ybW1hbmFnZXJfVXNlcigpLl9mcm9tRG9jdW1lbnQob2JqLm1lbWJlcikpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJCb2FyZF9NZW1iZXJcIil7XG5cdFx0XHRcdFx0Z3MuaW5mbyhcIkJvYXJkX01lbWJlci5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGdzLmluZm8oXCJCb2FyZF9NZW1iZXIuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdGdzLmluZm8oXCJCb2FyZF9NZW1iZXIuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwiaW52YWxpZCBvYmplY3QgXCIgKyBcInR5cGVvZihvYmopOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZihvYmopLCBudWxsLCA0KSk7XG5cdFx0fVxuXG5cdFx0Lypncy5pbmZvKFwiQm9hcmRfTWVtYmVyLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0XHQvKmdzLmluZm8oXCJCb2FyZF9NZW1iZXIuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X25ldyhjKSB7XG5cdFx0aWYgKCFjKSBjID0gdGhpcy5fX3R5cGU7XG5cdFx0aWYgKGMuaW5kZXhPZigncGxhdGZvcm1tYW5hZ2VyXycpICE9IDApIGMgPSAoe1xuXHRcdFx0UGxhdGZvcm06IFwicGxhdGZvcm1tYW5hZ2VyX1BsYXRmb3JtXCIsXG5cdFx0XHRVc2VyOiBcInBsYXRmb3JtbWFuYWdlcl9Vc2VyXCIsXG5cdFx0XHRSZXF1aXJlbWVudDogXCJwbGF0Zm9ybW1hbmFnZXJfUmVxdWlyZW1lbnRcIixcblx0XHRcdEVmZm9ydF9Fc3RpbWF0ZTogXCJwbGF0Zm9ybW1hbmFnZXJfRWZmb3J0X0VzdGltYXRlXCIsXG5cdFx0XHRFZmZvcnQ6IFwicGxhdGZvcm1tYW5hZ2VyX0VmZm9ydFwiLFxuXHRcdFx0QnVkZ2V0OiBcInBsYXRmb3JtbWFuYWdlcl9CdWRnZXRcIixcblx0XHRcdEFnZW5kYV9JdGVtOiBcInBsYXRmb3JtbWFuYWdlcl9BZ2VuZGFfSXRlbVwiLFxuXHRcdFx0TWVldGluZ19BZ2VuZGE6IFwicGxhdGZvcm1tYW5hZ2VyX01lZXRpbmdfQWdlbmRhXCIsXG5cdFx0XHREZWNpc2lvbl9PcHRpb246IFwicGxhdGZvcm1tYW5hZ2VyX0RlY2lzaW9uX09wdGlvblwiLFxuXHRcdFx0RGVjaXNpb246IFwicGxhdGZvcm1tYW5hZ2VyX0RlY2lzaW9uXCIsXG5cdFx0XHRNZWV0aW5nX01pbnV0ZTogXCJwbGF0Zm9ybW1hbmFnZXJfTWVldGluZ19NaW51dGVcIixcblx0XHRcdE1lZXRpbmdfU2VyaWVzOiBcInBsYXRmb3JtbWFuYWdlcl9NZWV0aW5nX1Nlcmllc1wiLFxuXHRcdFx0TWVldGluZzogXCJwbGF0Zm9ybW1hbmFnZXJfTWVldGluZ1wiLFxuXHRcdFx0Qm9hcmQ6IFwicGxhdGZvcm1tYW5hZ2VyX0JvYXJkXCIsXG5cdFx0XHRCb2FyZF9NZW1iZXI6IFwicGxhdGZvcm1tYW5hZ2VyX0JvYXJkX01lbWJlclwiLFxuXHRcdFx0RnJlcXVlbmN5OiBcInBsYXRmb3JtbWFuYWdlcl9GcmVxdWVuY3lcIixcblx0XHRcdE1vZHVsZTogXCJwbGF0Zm9ybW1hbmFnZXJfTW9kdWxlXCIsXG5cdFx0XHRDYXBhYmlsaXR5OiBcInBsYXRmb3JtbWFuYWdlcl9DYXBhYmlsaXR5XCIsXG5cdFx0XHRUZWFtOiBcInBsYXRmb3JtbWFuYWdlcl9UZWFtXCIsXG5cdFx0XHRQcm9qZWN0OiBcInBsYXRmb3JtbWFuYWdlcl9Qcm9qZWN0XCIsXG5cdFx0XHRUZWFtX01lbWJlcjogXCJwbGF0Zm9ybW1hbmFnZXJfVGVhbV9NZW1iZXJcIixcblx0XHRcdFJvbGU6IFwicGxhdGZvcm1tYW5hZ2VyX1JvbGVcIixcblx0XHR9KVtjXTtcblx0XHRyZXR1cm4gbmV3KGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IGdsb2JhbCA6IHhfNzg2MTFfcGxhdGZvcm1fMClbY10oKTtcblx0fVxuXG5cdF90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuY29kZSA9IHRoaXMuY29kZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5yZW1hcmsgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHJldC5yZW1hcmspID09PSAnb2JqZWN0JykgcmV0LnJlbWFyayA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5yZW1hcmspKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fc3RhcnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnN0YXJ0ID0gdGhpcy5zdGFydCgpO1xuXG5cdFx0XHRpZiAocmV0LnN0YXJ0ICYmIHR5cGVvZihyZXQuc3RhcnQudG9JU09TdHJpbmcpID09PSAnZnVuY3Rpb24nKSByZXQuc3RhcnQgPSByZXQuc3RhcnQudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZW5kID0gdGhpcy5lbmQoKTtcblxuXHRcdFx0aWYgKHJldC5lbmQgJiYgdHlwZW9mKHJldC5lbmQudG9JU09TdHJpbmcpID09PSAnZnVuY3Rpb24nKSByZXQuZW5kID0gcmV0LmVuZC50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYm9hcmQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmJvYXJkID0gdGhpcy5ib2FyZCgpO1xuXG5cdFx0XHRpZiAocmV0LmJvYXJkKSB7XG5cdFx0XHRcdHJldC5ib2FyZCA9IHJldC5ib2FyZC5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5ib2FyZCkgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuYm9hcmQpLmxlbmd0aCkgcmV0LmJvYXJkID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbWVtYmVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5tZW1iZXIgPSB0aGlzLm1lbWJlcigpO1xuXG5cdFx0XHRpZiAocmV0Lm1lbWJlcikge1xuXHRcdFx0XHRyZXQubWVtYmVyID0gcmV0Lm1lbWJlci5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5tZW1iZXIpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0Lm1lbWJlcikubGVuZ3RoKSByZXQubWVtYmVyID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdFx0fSk7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRkZWxldGUgcmV0W2tdO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF91bmlxdWUoa2V5cywgcmV0KSB7XG5cdFx0cmV0ID0gcmV0IHx8IG5ldyBwbGF0Zm9ybW1hbmFnZXJfQm9hcmRfTWVtYmVyKCk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdC8vIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7XG5cdFx0aWYgKCFrZXlzKSB7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImNvZGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJuYW1lXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubmFtZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInJlbWFya1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJzdGFydFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnN0YXJ0KCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnN0YXJ0KHRoaXMuc3RhcnQoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5kKHRoaXMuZW5kKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYm9hcmRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5ib2FyZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5ib2FyZCh0aGlzLmJvYXJkKCkuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm1lbWJlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm1lbWJlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5tZW1iZXIodGhpcy5tZW1iZXIoKS5fdW5pcXVlKCkpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9xdWVyeShncSkge1xuXHRcdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfNzg2MTFfcGxhdGZvcm1fMF9ib2FyZF9tZW1iZXInLCBbJyonXSlbJ3hfNzg2MTFfcGxhdGZvcm1fMF9ib2FyZF9tZW1iZXInXSk7XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EpIHRoaXMuX3F1ZXJ5R1EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkoJ3hfNzg2MTFfcGxhdGZvcm1fMF9ib2FyZF9tZW1iZXInKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkodGhpcykpO1xuXHRcdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qIGdzLmluZm8oXCJCb2FyZF9NZW1iZXIuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0XHQvKiBncy5pbmZvKFwiQm9hcmRfTWVtYmVyLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmFibGVkJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX2NvZGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmNvZGUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2NvZGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qIGdzLmluZm8oXCJCb2FyZF9NZW1iZXIuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdjb2RlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdjb2RlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2NvZGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdFx0LyogZ3MuaW5mbyhcIkJvYXJkX01lbWJlci5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF0ZScpID49IDApIHtcblx0XHRcdFx0LyogZ3MuaW5mbyhcIkJvYXJkX01lbWJlci5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGF0ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fbmFtZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9uYW1lX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5uYW1lKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCduYW1lJykgPj0gMCkge1xuXHRcdFx0XHQvKiBncy5pbmZvKFwiQm9hcmRfTWVtYmVyLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVtYXJrJykgPj0gMCkge1xuXHRcdFx0XHQvKiBncy5pbmZvKFwiQm9hcmRfTWVtYmVyLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVtYXJrJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3N0YXJ0KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fc3RhcnRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5zdGFydCgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdzdGFydCcpID49IDApIHtcblx0XHRcdFx0LyogZ3MuaW5mbyhcIkJvYXJkX01lbWJlci5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3N0YXJ0Jyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdzdGFydCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdzdGFydCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5lbmQoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5kJykgPj0gMCkge1xuXHRcdFx0XHQvKiBncy5pbmZvKFwiQm9hcmRfTWVtYmVyLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZW5kJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5kJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2JvYXJkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYm9hcmRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5ib2FyZCgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIkJvYXJkIE1lbWJlclwiPT1cIkNvbHVtblwiKSBncy5pbmZvKFwiQm9hcmRfTWVtYmVyLl9xdWVyeSgpOiBcIisgXCJib2FyZCBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHRncy5pbmZvKFwiQm9hcmRfTWVtYmVyLl9xdWVyeSgpOiBcIiArIFwiYm9hcmRbYm9hcmRdIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuYm9hcmQoKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYm9hcmQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qIGdzLmluZm8oXCJCb2FyZF9NZW1iZXIuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdib2FyZCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYm9hcmQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYm9hcmQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbWVtYmVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fbWVtYmVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubWVtYmVyKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiQm9hcmQgTWVtYmVyXCI9PVwiQ29sdW1uXCIpIGdzLmluZm8oXCJCb2FyZF9NZW1iZXIuX3F1ZXJ5KCk6IFwiKyBcIm1lbWJlciBcIisgXCJ2WzBdLl90b0RvY3VtZW50KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodlswXS5fdG9Eb2N1bWVudCgpLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdFx0diA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkodlswXSwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh2WzBdKSkpKTtcblx0XHRcdFx0fSBlbHNlIGlmICghdi5sZW5ndGgpIHtcblx0XHRcdFx0XHR2ID0gbnVsbDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb29wID0gJ0lOJztcblx0XHRcdFx0XHR2ID0gdi5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0cmV0dXJuICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHRcdH0pKHIsICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdFx0fSkocikpKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih2KSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0diA9IC0xO1xuXHRcdFx0XHRncy5pbmZvKFwiQm9hcmRfTWVtYmVyLl9xdWVyeSgpOiBcIiArIFwibWVtYmVyW21lbWJlcl0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5tZW1iZXIoKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbWVtYmVyJykgPj0gMCkge1xuXHRcdFx0XHQvKiBncy5pbmZvKFwiQm9hcmRfTWVtYmVyLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbWVtYmVyJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdtZW1iZXInKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbWVtYmVyJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0XHQvKiBncy5pbmZvKFwiQm9hcmRfTWVtYmVyLl9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdHJldHVybiB0aGlzLl9xdWVyeUdRO1xuXHR9XG5cblx0X3NhdmUob2JqKSB7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0cmV0dXJuIG5ldyBwbGF0Zm9ybW1hbmFnZXJfQm9hcmRfTWVtYmVyKCkuX3NhdmUobylcblx0XHR9KTtcblxuXHRcdGxldCBfb2JqID0ge307XG5cblx0XHQvKmdzLmluZm8oXCJCb2FyZF9NZW1iZXIuX3NhdmUoKTogXCIrIFwiLi4uIFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfNzg2MTFfcGxhdGZvcm1fMF9ib2FyZF9tZW1iZXInLCBbJyonXSlbJ3hfNzg2MTFfcGxhdGZvcm1fMF9ib2FyZF9tZW1iZXInXSkuZmlsdGVyKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiB0cnVlIHx8IFsnc3lzX3VwZGF0ZWRfb24nLCAnc3lzX2NyZWF0ZWRfb24nLCAndXBkYXRlcycsICdzeXNfY3JlYXRlZF9ieScsICdzeXNfdXBkYXRlZF9ieSddLmluZGV4T2YoX2spIDwgMFxuXHRcdFx0fSkuaW5kZXhPZihrLnRvTG93ZXJDYXNlKCkpID49IDBcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdF9vYmpbay50b0xvd2VyQ2FzZSgpXSA9IG9ialtrXVxuXHRcdH0pO1xuXG5cdFx0T2JqZWN0LmtleXMoX29iaikuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKF9vYmpba10pID09PSBcIltvYmplY3QgRGF0ZV1cIiAmJiBpc05hTihfb2JqW2tdKSkge1xuXHRcdFx0XHRncy5pbmZvKFwiQm9hcmRfTWVtYmVyLl9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHRcdGdzLmluZm8oXCJCb2FyZF9NZW1iZXIuX3NhdmUoKTogXCIgKyBcInN5c19pZCB0byBzdHJpbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRsZXQgX3RoaXMgPSBudWxsO1xuXHRcdGlmIChvYmouX19rZXlzKSB7XG5cdFx0XHRsZXQga09iaiA9IHt9O1xuXHRcdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShfb2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKSkpO1xuXHRcdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHRcdH0pO1xuXHRcdFx0X3RoaXMgPSBuZXcgcGxhdGZvcm1tYW5hZ2VyX0JvYXJkX01lbWJlcigpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF90aGlzID0gbmV3IHBsYXRmb3JtbWFuYWdlcl9Cb2FyZF9NZW1iZXIoKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0XHR9XG5cblx0XHQvKmdzLmluZm8oXCJCb2FyZF9NZW1iZXIuX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRcdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0XHRkZWxldGUgX29iai5fX2lkRmllbGQ7XG5cblx0XHR0cnkge1xuXHRcdFx0Z3MuaW5mbyhcIkJvYXJkX01lbWJlci5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdGdzLmluZm8oXCJCb2FyZF9NZW1iZXIuX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSk7XG5cblx0XHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICd4Xzc4NjExX3BsYXRmb3JtXzBfYm9hcmRfbWVtYmVyJyk7XG5cdFx0XHQvKmdzLmluZm8oXCJCb2FyZF9NZW1iZXIuX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdFx0fVxuXHRcdFx0bGV0IF9mT2JqID0ge307XG5cdFx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKSkpO1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF83ODYxMV9wbGF0Zm9ybV8wX2JvYXJkX21lbWJlcicsIFsnKiddKVsneF83ODYxMV9wbGF0Zm9ybV8wX2JvYXJkX21lbWJlciddKSkpKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0Z3MuaW5mbyhcIkJvYXJkX01lbWJlci5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdFx0Z3MuaW5mbyhcIkJvYXJkX01lbWJlci5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH1cblxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogQm9hcmRfTWVtYmVyLnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RvcmUoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihsb2dPYmopIHtcblx0XHRcdGdzLmluZm8oXCJCb2FyZF9NZW1iZXIuc3RvcmUoKTogXCIgKyBcImxvZ09iajogXCIgKyBKU09OLnN0cmluZ2lmeShsb2dPYmosIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHRncy5pbmZvKFwiQm9hcmRfTWVtYmVyLnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Z3MuaW5mbyhcIkJvYXJkX01lbWJlci5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0Z3MuaW5mbyhcIkJvYXJkX01lbWJlci5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0XHRsZXQgX3RoaXMgPSB0aGlzLl91bmlxdWUoKS5maW5kKCk7XG5cdFx0XHRpZiAoX3RoaXMpIHRoaXMuSWQgPSBfdGhpcy5JZDtcblxuXHRcdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogQm9hcmRfTWVtYmVyLmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kQWxsKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obG9nT2JqKSB7XG5cdFx0XHRncy5pbmZvKFwiQm9hcmRfTWVtYmVyLmZpbmRBbGwoKTogXCIgKyBcImxvZ09iajogXCIgKyBKU09OLnN0cmluZ2lmeShsb2dPYmosIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHRncy5pbmZvKFwiQm9hcmRfTWVtYmVyLmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRncy5pbmZvKFwiQm9hcmRfTWVtYmVyLmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdGdzLmluZm8oXCJCb2FyZF9NZW1iZXIuZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZChcIkJvYXJkX01lbWJlclwiKTtcblx0XHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0XHQvL3JldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQodGhpcy5fcXVlcnkoKS5zZWxlY3QoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF83ODYxMV9wbGF0Zm9ybV8wX2JvYXJkX21lbWJlcicsIFsnKiddKVsneF83ODYxMV9wbGF0Zm9ybV8wX2JvYXJkX21lbWJlciddKSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBCb2FyZF9NZW1iZXIuZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmQoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihsb2dPYmopIHtcblx0XHRcdGdzLmluZm8oXCJCb2FyZF9NZW1iZXIuZmluZCgpOiBcIiArIFwibG9nT2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KGxvZ09iaiwgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdGdzLmluZm8oXCJCb2FyZF9NZW1iZXIuZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGdzLmluZm8oXCJCb2FyZF9NZW1iZXIuZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0Z3MuaW5mbyhcIkJvYXJkX01lbWJlci5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic3lzX25hbWUiOiJwbGF0Zm9ybW1hbmFnZXJfQ2FwYWJpbGl0eSIsImFwaV9uYW1lIjoieF83ODYxMV9wbGF0Zm9ybV8wLnBsYXRmb3JtbWFuYWdlcl9DYXBhYmlsaXR5IiwibmFtZSI6InBsYXRmb3JtbWFuYWdlcl9DYXBhYmlsaXR5Iiwic2NyaXB0IjoiY2xhc3MgcGxhdGZvcm1tYW5hZ2VyX0NhcGFiaWxpdHkge1xuXHRjb25zdHJ1Y3RvcihpZCkge1xuXHRcdHVuZGVmaW5lZFxuXHRcdHRoaXMuSWQgPSBpZDtcblx0XHR0aGlzLl9fbW9kdWxlID0gXCJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwicGxhdGZvcm1tYW5hZ2VyX0NhcGFiaWxpdHlcIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInBsYXRmb3JtbWFuYWdlclwiO1xuXHRcdHRoaXMuX19zY29wZSA9IFwicGxhdGZvcm1tYW5hZ2VyXCI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBDYXBhYmlsaXR5LmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdGl2ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYWN0aXZlID0gdjtcblx0XHRcdHRoaXMuX2FjdGl2ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3RpdmU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQ2FwYWJpbGl0eS5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQ2FwYWJpbGl0eS5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29kZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29kZSA9IHY7XG5cdFx0XHR0aGlzLl9jb2RlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvZGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQ2FwYWJpbGl0eS5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG9yZGVyKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9vcmRlciA9IHY7XG5cdFx0XHR0aGlzLl9vcmRlcl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9vcmRlcjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBDYXBhYmlsaXR5LmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly9ncy5pbmZvKFwiQ2FwYWJpbGl0eS5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQ2FwYWJpbGl0eS5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQ2FwYWJpbGl0eS5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIENhcGFiaWxpdHkubW9kdWxlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bW9kdWxlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9tb2R1bGUgPSB2O1xuXHRcdFx0dGhpcy5fbW9kdWxlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX21vZHVsZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBDYXBhYmlsaXR5LmNhcGFiaWxpdHlfUmVxdWlyZW1lbnRzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y2FwYWJpbGl0eV9SZXF1aXJlbWVudHModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9jYXBhYmlsaXR5X1JlcXVpcmVtZW50cyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX2NhcGFiaWxpdHlfUmVxdWlyZW1lbnRzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jYXBhYmlsaXR5X1JlcXVpcmVtZW50cztcblx0XHR9XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnY29kZScgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ25hbWUnICsgKHRoaXMuX25hbWVfY29vcCB8fCAnPScpICsgdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAodGhpcy5fcmVtYXJrKSByZXQgKz0gJ14nICsgc1BhdGggKyAncmVtYXJrJyArICh0aGlzLl9yZW1hcmtfY29vcCB8fCAnPScpICsgdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmICh0aGlzLl9tb2R1bGUpIHJldCArPSAvKih0aGlzLl9tb2R1bGVfY29vcCB8fCAnPScpICsgKi8gdGhpcy5tb2R1bGUoKS5fdG9FUXVlcnkoc1BhdGggKyAnbW9kdWxlLicpO1xuXG5cdFx0KHRoaXMuY2FwYWJpbGl0eV9SZXF1aXJlbWVudHMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWVJlcXVpcmVtZW50LmNhcGFiaWxpdHksPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdGdzLmluZm8oXCJDYXBhYmlsaXR5Ll90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykgcmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0Z3MuaW5mbyhcIkNhcGFiaWxpdHkuX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXG5cdFx0c3dpdGNoIChtZXRob2QpIHtcblxuXHRcdFx0Y2FzZSBcInN0b3JlXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuc3RvcmUoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRBbGxcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHRncy5pbmZvKFwiQ2FwYWJpbGl0eS5faW52b2tlKCk6IFwiICsgXCJpbnZhbGlkIG1ldGhvZCBcIiArIG1ldGhvZCk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzOyAvLyB0ZXN0XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHBsYXRmb3JtbWFuYWdlcl9DYXBhYmlsaXR5KCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0dHJ5IHtcblx0XHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0Lypncy5pbmZvKFwiQ2FwYWJpbGl0eS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0XHR9O1xuXHRcdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdFx0b2JqID0gX29iajtcblx0XHRcdH1cblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdFx0XHRpZiAob2JqLmdldFRhYmxlTmFtZSgpID09ICdlY2NfcXVldWUnICYmIFwiQ2FwYWJpbGl0eVwiICE9ICdlY2NfcXVldWUnICYmIG9iai5zb3VyY2UgPT0gXCJDYXBhYmlsaXR5XCIpIHtcblx0XHRcdFx0XHRcdG9iai5zdGF0ZSA9IFwicHJvY2Vzc2luZ1wiO1xuXHRcdFx0XHRcdFx0b2JqLnVwZGF0ZSgpO1xuXG5cdFx0XHRcdFx0XHRsZXQgcmVzcCA9IG5ldyBHbGlkZVJlY29yZCgnZWNjX3F1ZXVlJyk7XG5cdFx0XHRcdFx0XHRyZXNwLnJlc3BvbnNlX3RvID0gb2JqLnN5c19pZDtcblx0XHRcdFx0XHRcdHJlc3AucXVldWUgPSAnb3V0cHV0Jztcblx0XHRcdFx0XHRcdHJlc3AuYWdlbnQgPSBvYmouYWdlbnQ7XG5cdFx0XHRcdFx0XHRyZXNwLnRvcGljID0gb2JqLnRvcGljO1xuXHRcdFx0XHRcdFx0cmVzcC5uYW1lID0gb2JqLm5hbWU7XG5cdFx0XHRcdFx0XHRyZXNwLnNvdXJjZSA9IG9iai5zb3VyY2U7XG5cdFx0XHRcdFx0XHRyZXNwLmZyb21faG9zdCA9IG9iai5hZ2VudF9jb3JyZWxhdG9yO1xuXHRcdFx0XHRcdFx0cmVzcC5hZ2VudF9jb3JyZWxhdG9yID0gb2JqLmZyb21faG9zdDtcblxuXHRcdFx0XHRcdFx0bGV0IHJldCA9IG5ldyBwbGF0Zm9ybW1hbmFnZXJfQ2FwYWJpbGl0eSgpLl9mcm9tRG9jdW1lbnQoKS5faW52b2tlKG9iai5uYW1lLnRvU3RyaW5nKCksIG9iai5wYXlsb2FkLnRvU3RyaW5nKCkpO1xuXHRcdFx0XHRcdFx0aWYgKEFycmF5LmlzQXJyYXkocmV0KSkge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByZXQubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gKHIgJiYgdHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nKSA/IHIuX3RvRG9jdW1lbnQoKSA6IHI7XG5cdFx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmIChyZXQgJiYgdHlwZW9mKHJldC5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gcmV0Ll90b0RvY3VtZW50KCk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXNwLnBheWxvYWQgPSBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpO1xuXG5cdFx0XHRcdFx0XHRyZXNwLmluc2VydCgpO1xuXG5cdFx0XHRcdFx0XHRvYmouc3RhdGUgPSBcInByb2Nlc3NlZFwiO1xuXHRcdFx0XHRcdFx0b2JqLnVwZGF0ZSgpO1xuXHRcdFx0XHRcdFx0cmV0dXJuIHJlc3A7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0XHRjb2RlOiBvYmouZ2V0VmFsdWUoXCJjb2RlXCIpLFxuXG5cdFx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRcdG5hbWU6IG9iai5nZXRWYWx1ZShcIm5hbWVcIiksXG5cblx0XHRcdFx0XHRcdHJlbWFyazogb2JqLmdldFZhbHVlKFwicmVtYXJrXCIpLFxuXG5cdFx0XHRcdFx0XHRtb2R1bGU6IG9iai5nZXRWYWx1ZShcIm1vZHVsZVwiKSxcblxuXHRcdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRvYmoucXVlcnkoKTtcblx0XHRcdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tRG9jdW1lbnQob2JqKSk7XG5cdFx0XHRcdFx0Lypncy5pbmZvKFwiQ2FwYWJpbGl0eS5fZnJvbURvY3VtZW50KCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0XHRcdHJldHVybiBnclJldDtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0XHRncy5pbmZvKFwiQ2FwYWJpbGl0eS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdFx0cmV0dXJuIG9iajtcblx0XHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0XHRyZXR1cm4gbmV3IHBsYXRmb3JtbWFuYWdlcl9DYXBhYmlsaXR5KCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0XHQvKmdzLmluZm8oXCJDYXBhYmlsaXR5Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5jb2RlKG9iai5jb2RlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5uYW1lKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLnJlbWFyaykpKTtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLnJlbWFyayk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubW9kdWxlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5tb2R1bGUobmV3IHBsYXRmb3JtbWFuYWdlcl9Nb2R1bGUoKS5fZnJvbURvY3VtZW50KG9iai5tb2R1bGUpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5jYXBhYmlsaXR5X1JlcXVpcmVtZW50cykgIT09ICd1bmRlZmluZWQnKSB0aGlzLmNhcGFiaWxpdHlfUmVxdWlyZW1lbnRzKG5ldyBwbGF0Zm9ybW1hbmFnZXJfUmVxdWlyZW1lbnQoKS5fZnJvbURvY3VtZW50KG9iai5jYXBhYmlsaXR5X1JlcXVpcmVtZW50cykpO1xuXG5cdFx0XHRcdH0gZWxzZSB7IC8vIGlmKG9iai5jb25zdHJ1Y3Rvci5uYW1lPT1cIkNhcGFiaWxpdHlcIil7XG5cdFx0XHRcdFx0Z3MuaW5mbyhcIkNhcGFiaWxpdHkuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgY29uc3RydWN0b3I6IFwiICsgb2JqLmNvbnN0cnVjdG9yLm5hbWUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRncy5pbmZvKFwiQ2FwYWJpbGl0eS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0Z3MuaW5mbyhcIkNhcGFiaWxpdHkuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwiaW52YWxpZCBvYmplY3QgXCIgKyBcInR5cGVvZihvYmopOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZihvYmopLCBudWxsLCA0KSk7XG5cdFx0fVxuXG5cdFx0Lypncy5pbmZvKFwiQ2FwYWJpbGl0eS5fZnJvbURvY3VtZW50KCk6IFwiKyBcIklkIFwiKyBcInRoaXMuSWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5JZCwgbnVsbCwgNCkpOyovXG5cdFx0Lypncy5pbmZvKFwiQ2FwYWJpbGl0eS5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfbmV3KGMpIHtcblx0XHRpZiAoIWMpIGMgPSB0aGlzLl9fdHlwZTtcblx0XHRpZiAoYy5pbmRleE9mKCdwbGF0Zm9ybW1hbmFnZXJfJykgIT0gMCkgYyA9ICh7XG5cdFx0XHRQbGF0Zm9ybTogXCJwbGF0Zm9ybW1hbmFnZXJfUGxhdGZvcm1cIixcblx0XHRcdFVzZXI6IFwicGxhdGZvcm1tYW5hZ2VyX1VzZXJcIixcblx0XHRcdFJlcXVpcmVtZW50OiBcInBsYXRmb3JtbWFuYWdlcl9SZXF1aXJlbWVudFwiLFxuXHRcdFx0RWZmb3J0X0VzdGltYXRlOiBcInBsYXRmb3JtbWFuYWdlcl9FZmZvcnRfRXN0aW1hdGVcIixcblx0XHRcdEVmZm9ydDogXCJwbGF0Zm9ybW1hbmFnZXJfRWZmb3J0XCIsXG5cdFx0XHRCdWRnZXQ6IFwicGxhdGZvcm1tYW5hZ2VyX0J1ZGdldFwiLFxuXHRcdFx0QWdlbmRhX0l0ZW06IFwicGxhdGZvcm1tYW5hZ2VyX0FnZW5kYV9JdGVtXCIsXG5cdFx0XHRNZWV0aW5nX0FnZW5kYTogXCJwbGF0Zm9ybW1hbmFnZXJfTWVldGluZ19BZ2VuZGFcIixcblx0XHRcdERlY2lzaW9uX09wdGlvbjogXCJwbGF0Zm9ybW1hbmFnZXJfRGVjaXNpb25fT3B0aW9uXCIsXG5cdFx0XHREZWNpc2lvbjogXCJwbGF0Zm9ybW1hbmFnZXJfRGVjaXNpb25cIixcblx0XHRcdE1lZXRpbmdfTWludXRlOiBcInBsYXRmb3JtbWFuYWdlcl9NZWV0aW5nX01pbnV0ZVwiLFxuXHRcdFx0TWVldGluZ19TZXJpZXM6IFwicGxhdGZvcm1tYW5hZ2VyX01lZXRpbmdfU2VyaWVzXCIsXG5cdFx0XHRNZWV0aW5nOiBcInBsYXRmb3JtbWFuYWdlcl9NZWV0aW5nXCIsXG5cdFx0XHRCb2FyZDogXCJwbGF0Zm9ybW1hbmFnZXJfQm9hcmRcIixcblx0XHRcdEJvYXJkX01lbWJlcjogXCJwbGF0Zm9ybW1hbmFnZXJfQm9hcmRfTWVtYmVyXCIsXG5cdFx0XHRGcmVxdWVuY3k6IFwicGxhdGZvcm1tYW5hZ2VyX0ZyZXF1ZW5jeVwiLFxuXHRcdFx0TW9kdWxlOiBcInBsYXRmb3JtbWFuYWdlcl9Nb2R1bGVcIixcblx0XHRcdENhcGFiaWxpdHk6IFwicGxhdGZvcm1tYW5hZ2VyX0NhcGFiaWxpdHlcIixcblx0XHRcdFRlYW06IFwicGxhdGZvcm1tYW5hZ2VyX1RlYW1cIixcblx0XHRcdFByb2plY3Q6IFwicGxhdGZvcm1tYW5hZ2VyX1Byb2plY3RcIixcblx0XHRcdFRlYW1fTWVtYmVyOiBcInBsYXRmb3JtbWFuYWdlcl9UZWFtX01lbWJlclwiLFxuXHRcdFx0Um9sZTogXCJwbGF0Zm9ybW1hbmFnZXJfUm9sZVwiLFxuXHRcdH0pW2NdO1xuXHRcdHJldHVybiBuZXcoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gZ2xvYmFsIDogeF83ODYxMV9wbGF0Zm9ybV8wKVtjXSgpO1xuXHR9XG5cblx0X3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5jb2RlID0gdGhpcy5jb2RlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9tb2R1bGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm1vZHVsZSA9IHRoaXMubW9kdWxlKCk7XG5cblx0XHRcdGlmIChyZXQubW9kdWxlKSB7XG5cdFx0XHRcdHJldC5tb2R1bGUgPSByZXQubW9kdWxlLl90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0Lm1vZHVsZSkgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQubW9kdWxlKS5sZW5ndGgpIHJldC5tb2R1bGUgPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmNhcGFiaWxpdHlfUmVxdWlyZW1lbnRzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNhcGFiaWxpdHlfUmVxdWlyZW1lbnRzID0gdGhpcy5jYXBhYmlsaXR5X1JlcXVpcmVtZW50cygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHRcdH0pO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0ZGVsZXRlIHJldFtrXTtcblx0XHR9KTtcblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfdW5pcXVlKGtleXMsIHJldCkge1xuXHRcdHJldCA9IHJldCB8fCBuZXcgcGxhdGZvcm1tYW5hZ2VyX0NhcGFiaWxpdHkoKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0XHRpZiAoIWtleXMpIHtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImVuYWJsZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmFibGVkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuYWJsZWQodGhpcy5lbmFibGVkKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY29kZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVtYXJrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm1vZHVsZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm1vZHVsZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5tb2R1bGUodGhpcy5tb2R1bGUoKS5fdW5pcXVlKCkpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9xdWVyeShncSkge1xuXHRcdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfNzg2MTFfcGxhdGZvcm1fMF9jYXBhYmlsaXR5JywgWycqJ10pWyd4Xzc4NjExX3BsYXRmb3JtXzBfY2FwYWJpbGl0eSddKTtcblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgneF83ODYxMV9wbGF0Zm9ybV8wX2NhcGFiaWxpdHknKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkodGhpcykpO1xuXHRcdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qIGdzLmluZm8oXCJDYXBhYmlsaXR5Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdFx0LyogZ3MuaW5mbyhcIkNhcGFiaWxpdHkuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdFx0LyogZ3MuaW5mbyhcIkNhcGFiaWxpdHkuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdjb2RlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdjb2RlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2NvZGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdFx0LyogZ3MuaW5mbyhcIkNhcGFiaWxpdHkuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2RhdGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qIGdzLmluZm8oXCJDYXBhYmlsaXR5Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qIGdzLmluZm8oXCJDYXBhYmlsaXR5Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVtYXJrJykgPj0gMCkge1xuXHRcdFx0XHQvKiBncy5pbmZvKFwiQ2FwYWJpbGl0eS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3JlbWFyaycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9tb2R1bGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9tb2R1bGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5tb2R1bGUoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJDYXBhYmlsaXR5XCI9PVwiQ29sdW1uXCIpIGdzLmluZm8oXCJDYXBhYmlsaXR5Ll9xdWVyeSgpOiBcIisgXCJtb2R1bGUgXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0Z3MuaW5mbyhcIkNhcGFiaWxpdHkuX3F1ZXJ5KCk6IFwiICsgXCJtb2R1bGVbbW9kdWxlXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLm1vZHVsZSgpKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdtb2R1bGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qIGdzLmluZm8oXCJDYXBhYmlsaXR5Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbW9kdWxlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdtb2R1bGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbW9kdWxlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0XHQvKiBncy5pbmZvKFwiQ2FwYWJpbGl0eS5fcXVlcnkoKTogXCIrIFwidGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCk6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5fcXVlcnlHUS50b0dsaWRlUmVjb3JkKCkuZ2V0RW5jb2RlZFF1ZXJ5KCksIG51bGwsIDQpKTsgKi9cblx0XHRyZXR1cm4gdGhpcy5fcXVlcnlHUTtcblx0fVxuXG5cdF9zYXZlKG9iaikge1xuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdHJldHVybiBuZXcgcGxhdGZvcm1tYW5hZ2VyX0NhcGFiaWxpdHkoKS5fc2F2ZShvKVxuXHRcdH0pO1xuXG5cdFx0bGV0IF9vYmogPSB7fTtcblxuXHRcdC8qZ3MuaW5mbyhcIkNhcGFiaWxpdHkuX3NhdmUoKTogXCIrIFwiLi4uIFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfNzg2MTFfcGxhdGZvcm1fMF9jYXBhYmlsaXR5JywgWycqJ10pWyd4Xzc4NjExX3BsYXRmb3JtXzBfY2FwYWJpbGl0eSddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdFx0fSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHRcdGdzLmluZm8oXCJDYXBhYmlsaXR5Ll9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHRcdGdzLmluZm8oXCJDYXBhYmlsaXR5Ll9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0bGV0IF90aGlzID0gbnVsbDtcblx0XHRpZiAob2JqLl9fa2V5cykge1xuXHRcdFx0bGV0IGtPYmogPSB7fTtcblx0XHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSkpKTtcblx0XHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0XHR9KTtcblx0XHRcdF90aGlzID0gbmV3IHBsYXRmb3JtbWFuYWdlcl9DYXBhYmlsaXR5KCkuX2Zyb21Eb2N1bWVudChrT2JqKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0X3RoaXMgPSBuZXcgcGxhdGZvcm1tYW5hZ2VyX0NhcGFiaWxpdHkoKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0XHR9XG5cblx0XHQvKmdzLmluZm8oXCJDYXBhYmlsaXR5Ll9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0XHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdFx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdFx0dHJ5IHtcblx0XHRcdGdzLmluZm8oXCJDYXBhYmlsaXR5Ll9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0Z3MuaW5mbyhcIkNhcGFiaWxpdHkuX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSk7XG5cblx0XHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICd4Xzc4NjExX3BsYXRmb3JtXzBfY2FwYWJpbGl0eScpO1xuXHRcdFx0Lypncy5pbmZvKFwiQ2FwYWJpbGl0eS5fc2F2ZSgpOiBcIisgXCJ1cHNlcnRpbmcuLi4gXCIrIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7Ki9cblx0XHRcdGlmIChfb2JqLnN5c19pZCkge1xuXHRcdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X29iai5zeXNfaWQgPSBncy5nZW5lcmF0ZUdVSUQoKTtcblx0XHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0XHR9XG5cdFx0XHRsZXQgX2ZPYmogPSB7fTtcblx0XHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpKSk7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4Xzc4NjExX3BsYXRmb3JtXzBfY2FwYWJpbGl0eScsIFsnKiddKVsneF83ODYxMV9wbGF0Zm9ybV8wX2NhcGFiaWxpdHknXSkpKSk7XG5cdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdGdzLmluZm8oXCJDYXBhYmlsaXR5Ll9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0XHRncy5pbmZvKFwiQ2FwYWJpbGl0eS5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH1cblxuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5jYXBhYmlsaXR5X1JlcXVpcmVtZW50cykpIHRoaXMuY2FwYWJpbGl0eV9SZXF1aXJlbWVudHMob2JqLmNhcGFiaWxpdHlfUmVxdWlyZW1lbnRzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBwbGF0Zm9ybW1hbmFnZXJfUmVxdWlyZW1lbnQoKS5fc2F2ZSh0YSlcblx0XHR9KSk7XG5cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdC8qKioqKioqKioqKioqIENhcGFiaWxpdHkuc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzdG9yZShfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKGxvZ09iaikge1xuXHRcdFx0Z3MuaW5mbyhcIkNhcGFiaWxpdHkuc3RvcmUoKTogXCIgKyBcImxvZ09iajogXCIgKyBKU09OLnN0cmluZ2lmeShsb2dPYmosIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHRncy5pbmZvKFwiQ2FwYWJpbGl0eS5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGdzLmluZm8oXCJDYXBhYmlsaXR5LnN0b3JlKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHRncy5pbmZvKFwiQ2FwYWJpbGl0eS5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0XHRsZXQgX3RoaXMgPSB0aGlzLl91bmlxdWUoKS5maW5kKCk7XG5cdFx0XHRpZiAoX3RoaXMpIHRoaXMuSWQgPSBfdGhpcy5JZDtcblxuXHRcdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogQ2FwYWJpbGl0eS5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZEFsbChfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKGxvZ09iaikge1xuXHRcdFx0Z3MuaW5mbyhcIkNhcGFiaWxpdHkuZmluZEFsbCgpOiBcIiArIFwibG9nT2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KGxvZ09iaiwgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdGdzLmluZm8oXCJDYXBhYmlsaXR5LmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRncy5pbmZvKFwiQ2FwYWJpbGl0eS5maW5kQWxsKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHRncy5pbmZvKFwiQ2FwYWJpbGl0eS5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIGZpbmRBbGwgbG9jYWxseVxuXHRcdFx0bGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKFwiQ2FwYWJpbGl0eVwiKTtcblx0XHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0XHQvL3JldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQodGhpcy5fcXVlcnkoKS5zZWxlY3QoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF83ODYxMV9wbGF0Zm9ybV8wX2NhcGFiaWxpdHknLCBbJyonXSlbJ3hfNzg2MTFfcGxhdGZvcm1fMF9jYXBhYmlsaXR5J10pKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIENhcGFiaWxpdHkuZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmQoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihsb2dPYmopIHtcblx0XHRcdGdzLmluZm8oXCJDYXBhYmlsaXR5LmZpbmQoKTogXCIgKyBcImxvZ09iajogXCIgKyBKU09OLnN0cmluZ2lmeShsb2dPYmosIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHRncy5pbmZvKFwiQ2FwYWJpbGl0eS5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Z3MuaW5mbyhcIkNhcGFiaWxpdHkuZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0Z3MuaW5mbyhcIkNhcGFiaWxpdHkuZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG59In0seyJhY3RpdmUiOnRydWUsImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInN5c19uYW1lIjoicGxhdGZvcm1tYW5hZ2VyX1Byb2plY3QiLCJhcGlfbmFtZSI6InhfNzg2MTFfcGxhdGZvcm1fMC5wbGF0Zm9ybW1hbmFnZXJfUHJvamVjdCIsIm5hbWUiOiJwbGF0Zm9ybW1hbmFnZXJfUHJvamVjdCIsInNjcmlwdCI6ImNsYXNzIHBsYXRmb3JtbWFuYWdlcl9Qcm9qZWN0IHtcblx0Y29uc3RydWN0b3IoaWQpIHtcblx0XHR1bmRlZmluZWRcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInBsYXRmb3JtbWFuYWdlcl9Qcm9qZWN0XCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJwbGF0Zm9ybW1hbmFnZXJcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInBsYXRmb3JtbWFuYWdlclwiO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogUHJvamVjdC5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFByb2plY3QuZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVuYWJsZWQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2VuYWJsZWQgPSB2O1xuXHRcdFx0dGhpcy5fZW5hYmxlZF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lbmFibGVkO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFByb2plY3QuY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFByb2plY3Qub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUHJvamVjdC5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGF0ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vZ3MuaW5mbyhcIlByb2plY3QuZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFByb2plY3QubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG5hbWUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX25hbWUgPSB2O1xuXHRcdFx0dGhpcy5fbmFtZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9uYW1lO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFByb2plY3QucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBQcm9qZWN0LnRlYW0gR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHR0ZWFtKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl90ZWFtID0gdjtcblx0XHRcdHRoaXMuX3RlYW1fY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fdGVhbTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBQcm9qZWN0LmJ1ZGdldCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGJ1ZGdldCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYnVkZ2V0ID0gdjtcblx0XHRcdHRoaXMuX2J1ZGdldF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9idWRnZXQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUHJvamVjdC5wcm9qZWN0X1JlcXVpcmVtZW50cyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHByb2plY3RfUmVxdWlyZW1lbnRzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fcHJvamVjdF9SZXF1aXJlbWVudHMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9wcm9qZWN0X1JlcXVpcmVtZW50c19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcHJvamVjdF9SZXF1aXJlbWVudHM7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUHJvamVjdC5wcm9qZWN0X01lZXRpbmdzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cHJvamVjdF9NZWV0aW5ncyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX3Byb2plY3RfTWVldGluZ3MgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9wcm9qZWN0X01lZXRpbmdzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9wcm9qZWN0X01lZXRpbmdzO1xuXHRcdH1cblx0fVxuXG5cdF90b0VRdWVyeShzUGF0aCkge1xuXHRcdHNQYXRoID0gc1BhdGggfHwgJyc7XG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCAnJztcblxuXHRcdGlmICh0aGlzLl9hY3RpdmUpIHJldCArPSAnXicgKyBzUGF0aCArICdhY3RpdmUnICsgKHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JykgKyB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuYWJsZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmFibGVkJyArICh0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2NvZGUpIHJldCArPSAnXicgKyBzUGF0aCArICdjb2RlJyArICh0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nKSArIHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX29yZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnb3JkZXInICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMub3JkZXIoKTtcblxuXHRcdGlmICh0aGlzLl9kYXRlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF0ZScgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh0aGlzLl9uYW1lKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbmFtZScgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdyZW1hcmsnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHRoaXMuX3RlYW0pIHJldCArPSAvKih0aGlzLl90ZWFtX2Nvb3AgfHwgJz0nKSArICovIHRoaXMudGVhbSgpLl90b0VRdWVyeShzUGF0aCArICd0ZWFtLicpO1xuXG5cdFx0aWYgKHRoaXMuX2J1ZGdldCkgcmV0ICs9IC8qKHRoaXMuX2J1ZGdldF9jb29wIHx8ICc9JykgKyAqLyB0aGlzLmJ1ZGdldCgpLl90b0VRdWVyeShzUGF0aCArICdidWRnZXQuJyk7XG5cblx0XHQodGhpcy5wcm9qZWN0X1JlcXVpcmVtZW50cygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZUmVxdWlyZW1lbnQucHJvamVjdCw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHRoaXMucHJvamVjdF9NZWV0aW5ncygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZTWVldGluZy5wcm9qZWN0LD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHRncy5pbmZvKFwiUHJvamVjdC5fdG9FUXVlcnkoKTogXCIgKyBcInJldDogXCIgKyBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X2ludm9rZShtZXRob2QsIHBheWxvYWQpIHtcblx0XHRpZiAoIW1ldGhvZCkgcmV0dXJuIG51bGw7XG5cdFx0aWYgKHR5cGVvZihwYXlsb2FkKSA9PT0gJ3N0cmluZycpIHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKHBheWxvYWQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBwKTtcblx0XHR9KTtcblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdGdzLmluZm8oXCJQcm9qZWN0Ll9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImFjdHVhbENvc3RcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5hY3R1YWxDb3N0KHBheWxvYWRbXCJ0aWxsRGF0ZVwiXSwgKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0Z3MuaW5mbyhcIlByb2plY3QuX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpczsgLy8gdGVzdFxuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBwbGF0Zm9ybW1hbmFnZXJfUHJvamVjdCgpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdHRyeSB7XG5cdFx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdC8qZ3MuaW5mbyhcIlByb2plY3QuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdFx0fTtcblx0XHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRcdFx0aWYgKG9iai5nZXRUYWJsZU5hbWUoKSA9PSAnZWNjX3F1ZXVlJyAmJiBcIlByb2plY3RcIiAhPSAnZWNjX3F1ZXVlJyAmJiBvYmouc291cmNlID09IFwiUHJvamVjdFwiKSB7XG5cdFx0XHRcdFx0XHRvYmouc3RhdGUgPSBcInByb2Nlc3NpbmdcIjtcblx0XHRcdFx0XHRcdG9iai51cGRhdGUoKTtcblxuXHRcdFx0XHRcdFx0bGV0IHJlc3AgPSBuZXcgR2xpZGVSZWNvcmQoJ2VjY19xdWV1ZScpO1xuXHRcdFx0XHRcdFx0cmVzcC5yZXNwb25zZV90byA9IG9iai5zeXNfaWQ7XG5cdFx0XHRcdFx0XHRyZXNwLnF1ZXVlID0gJ291dHB1dCc7XG5cdFx0XHRcdFx0XHRyZXNwLmFnZW50ID0gb2JqLmFnZW50O1xuXHRcdFx0XHRcdFx0cmVzcC50b3BpYyA9IG9iai50b3BpYztcblx0XHRcdFx0XHRcdHJlc3AubmFtZSA9IG9iai5uYW1lO1xuXHRcdFx0XHRcdFx0cmVzcC5zb3VyY2UgPSBvYmouc291cmNlO1xuXHRcdFx0XHRcdFx0cmVzcC5mcm9tX2hvc3QgPSBvYmouYWdlbnRfY29ycmVsYXRvcjtcblx0XHRcdFx0XHRcdHJlc3AuYWdlbnRfY29ycmVsYXRvciA9IG9iai5mcm9tX2hvc3Q7XG5cblx0XHRcdFx0XHRcdGxldCByZXQgPSBuZXcgcGxhdGZvcm1tYW5hZ2VyX1Byb2plY3QoKS5fZnJvbURvY3VtZW50KCkuX2ludm9rZShvYmoubmFtZS50b1N0cmluZygpLCBvYmoucGF5bG9hZC50b1N0cmluZygpKTtcblx0XHRcdFx0XHRcdGlmIChBcnJheS5pc0FycmF5KHJldCkpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gcmV0Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIChyICYmIHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJykgPyByLl90b0RvY3VtZW50KCkgOiByO1xuXHRcdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAocmV0ICYmIHR5cGVvZihyZXQuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHJldC5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmVzcC5wYXlsb2FkID0gSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KTtcblxuXHRcdFx0XHRcdFx0cmVzcC5pbnNlcnQoKTtcblxuXHRcdFx0XHRcdFx0b2JqLnN0YXRlID0gXCJwcm9jZXNzZWRcIjtcblx0XHRcdFx0XHRcdG9iai51cGRhdGUoKTtcblx0XHRcdFx0XHRcdHJldHVybiByZXNwO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdFx0Y29kZTogb2JqLmdldFZhbHVlKFwiY29kZVwiKSxcblxuXHRcdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0XHRyZW1hcms6IG9iai5nZXRWYWx1ZShcInJlbWFya1wiKSxcblxuXHRcdFx0XHRcdFx0dGVhbTogb2JqLmdldFZhbHVlKFwidGVhbVwiKSxcblxuXHRcdFx0XHRcdFx0YnVkZ2V0OiBvYmouZ2V0VmFsdWUoXCJidWRnZXRcIiksXG5cblx0XHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbURvY3VtZW50KG9iaikpO1xuXHRcdFx0XHRcdC8qZ3MuaW5mbyhcIlByb2plY3QuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJnbGlkZSBvYmplY3RzIFwiKyBcImdyUmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KGdyUmV0LCBudWxsLCA0KSk7Ki9cblx0XHRcdFx0XHRyZXR1cm4gZ3JSZXQ7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSBpZiAob2JqLl9mcm9tRG9jdW1lbnQpIHtcblx0XHRcdFx0Z3MuaW5mbyhcIlByb2plY3QuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRcdHJldHVybiBvYmo7XG5cdFx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdFx0cmV0dXJuIG5ldyBwbGF0Zm9ybW1hbmFnZXJfUHJvamVjdCgpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdFx0Lypncy5pbmZvKFwiUHJvamVjdC5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuY29kZShvYmouY29kZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubmFtZShvYmoubmFtZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsoU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5yZW1hcmspKSk7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5yZW1hcmspO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnRlYW0pICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnRlYW0obmV3IHBsYXRmb3JtbWFuYWdlcl9UZWFtKCkuX2Zyb21Eb2N1bWVudChvYmoudGVhbSkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmJ1ZGdldCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYnVkZ2V0KG5ldyBwbGF0Zm9ybW1hbmFnZXJfQnVkZ2V0KCkuX2Zyb21Eb2N1bWVudChvYmouYnVkZ2V0KSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucHJvamVjdF9SZXF1aXJlbWVudHMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5wcm9qZWN0X1JlcXVpcmVtZW50cyhuZXcgcGxhdGZvcm1tYW5hZ2VyX1JlcXVpcmVtZW50KCkuX2Zyb21Eb2N1bWVudChvYmoucHJvamVjdF9SZXF1aXJlbWVudHMpKTtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnByb2plY3RfTWVldGluZ3MpICE9PSAndW5kZWZpbmVkJykgdGhpcy5wcm9qZWN0X01lZXRpbmdzKG5ldyBwbGF0Zm9ybW1hbmFnZXJfTWVldGluZygpLl9mcm9tRG9jdW1lbnQob2JqLnByb2plY3RfTWVldGluZ3MpKTtcblxuXHRcdFx0XHR9IGVsc2UgeyAvLyBpZihvYmouY29uc3RydWN0b3IubmFtZT09XCJQcm9qZWN0XCIpe1xuXHRcdFx0XHRcdGdzLmluZm8oXCJQcm9qZWN0Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Z3MuaW5mbyhcIlByb2plY3QuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgXCIgKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdGdzLmluZm8oXCJQcm9qZWN0Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHRcdH1cblxuXHRcdC8qZ3MuaW5mbyhcIlByb2plY3QuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHRcdC8qZ3MuaW5mbyhcIlByb2plY3QuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsqL1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X25ldyhjKSB7XG5cdFx0aWYgKCFjKSBjID0gdGhpcy5fX3R5cGU7XG5cdFx0aWYgKGMuaW5kZXhPZigncGxhdGZvcm1tYW5hZ2VyXycpICE9IDApIGMgPSAoe1xuXHRcdFx0UGxhdGZvcm06IFwicGxhdGZvcm1tYW5hZ2VyX1BsYXRmb3JtXCIsXG5cdFx0XHRVc2VyOiBcInBsYXRmb3JtbWFuYWdlcl9Vc2VyXCIsXG5cdFx0XHRSZXF1aXJlbWVudDogXCJwbGF0Zm9ybW1hbmFnZXJfUmVxdWlyZW1lbnRcIixcblx0XHRcdEVmZm9ydF9Fc3RpbWF0ZTogXCJwbGF0Zm9ybW1hbmFnZXJfRWZmb3J0X0VzdGltYXRlXCIsXG5cdFx0XHRFZmZvcnQ6IFwicGxhdGZvcm1tYW5hZ2VyX0VmZm9ydFwiLFxuXHRcdFx0QnVkZ2V0OiBcInBsYXRmb3JtbWFuYWdlcl9CdWRnZXRcIixcblx0XHRcdEFnZW5kYV9JdGVtOiBcInBsYXRmb3JtbWFuYWdlcl9BZ2VuZGFfSXRlbVwiLFxuXHRcdFx0TWVldGluZ19BZ2VuZGE6IFwicGxhdGZvcm1tYW5hZ2VyX01lZXRpbmdfQWdlbmRhXCIsXG5cdFx0XHREZWNpc2lvbl9PcHRpb246IFwicGxhdGZvcm1tYW5hZ2VyX0RlY2lzaW9uX09wdGlvblwiLFxuXHRcdFx0RGVjaXNpb246IFwicGxhdGZvcm1tYW5hZ2VyX0RlY2lzaW9uXCIsXG5cdFx0XHRNZWV0aW5nX01pbnV0ZTogXCJwbGF0Zm9ybW1hbmFnZXJfTWVldGluZ19NaW51dGVcIixcblx0XHRcdE1lZXRpbmdfU2VyaWVzOiBcInBsYXRmb3JtbWFuYWdlcl9NZWV0aW5nX1Nlcmllc1wiLFxuXHRcdFx0TWVldGluZzogXCJwbGF0Zm9ybW1hbmFnZXJfTWVldGluZ1wiLFxuXHRcdFx0Qm9hcmQ6IFwicGxhdGZvcm1tYW5hZ2VyX0JvYXJkXCIsXG5cdFx0XHRCb2FyZF9NZW1iZXI6IFwicGxhdGZvcm1tYW5hZ2VyX0JvYXJkX01lbWJlclwiLFxuXHRcdFx0RnJlcXVlbmN5OiBcInBsYXRmb3JtbWFuYWdlcl9GcmVxdWVuY3lcIixcblx0XHRcdE1vZHVsZTogXCJwbGF0Zm9ybW1hbmFnZXJfTW9kdWxlXCIsXG5cdFx0XHRDYXBhYmlsaXR5OiBcInBsYXRmb3JtbWFuYWdlcl9DYXBhYmlsaXR5XCIsXG5cdFx0XHRUZWFtOiBcInBsYXRmb3JtbWFuYWdlcl9UZWFtXCIsXG5cdFx0XHRQcm9qZWN0OiBcInBsYXRmb3JtbWFuYWdlcl9Qcm9qZWN0XCIsXG5cdFx0XHRUZWFtX01lbWJlcjogXCJwbGF0Zm9ybW1hbmFnZXJfVGVhbV9NZW1iZXJcIixcblx0XHRcdFJvbGU6IFwicGxhdGZvcm1tYW5hZ2VyX1JvbGVcIixcblx0XHR9KVtjXTtcblx0XHRyZXR1cm4gbmV3KGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IGdsb2JhbCA6IHhfNzg2MTFfcGxhdGZvcm1fMClbY10oKTtcblx0fVxuXG5cdF90b0RvY3VtZW50KGFyRmllbGRzKSB7XG5cblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8IHt9O1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zeXNfaWQgPSB0aGlzLklkO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmFjdGl2ZSA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmVuYWJsZWQgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuY29kZSA9IHRoaXMuY29kZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5yZW1hcmsgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHJldC5yZW1hcmspID09PSAnb2JqZWN0JykgcmV0LnJlbWFyayA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5yZW1hcmspKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fdGVhbSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQudGVhbSA9IHRoaXMudGVhbSgpO1xuXG5cdFx0XHRpZiAocmV0LnRlYW0pIHtcblx0XHRcdFx0cmV0LnRlYW0gPSByZXQudGVhbS5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC50ZWFtKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC50ZWFtKS5sZW5ndGgpIHJldC50ZWFtID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYnVkZ2V0KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5idWRnZXQgPSB0aGlzLmJ1ZGdldCgpO1xuXG5cdFx0XHRpZiAocmV0LmJ1ZGdldCkge1xuXHRcdFx0XHRyZXQuYnVkZ2V0ID0gcmV0LmJ1ZGdldC5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRpZiAodHlwZW9mKHJldC5idWRnZXQpID09PSAnb2JqZWN0JyAmJiAhT2JqZWN0LmtleXMocmV0LmJ1ZGdldCkubGVuZ3RoKSByZXQuYnVkZ2V0ID0gbnVsbDtcblx0XHRcdH1cblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5wcm9qZWN0X1JlcXVpcmVtZW50cygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5wcm9qZWN0X1JlcXVpcmVtZW50cyA9IHRoaXMucHJvamVjdF9SZXF1aXJlbWVudHMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLnByb2plY3RfTWVldGluZ3MoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucHJvamVjdF9NZWV0aW5ncyA9IHRoaXMucHJvamVjdF9NZWV0aW5ncygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHRcdH0pO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0ZGVsZXRlIHJldFtrXTtcblx0XHR9KTtcblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfdW5pcXVlKGtleXMsIHJldCkge1xuXHRcdHJldCA9IHJldCB8fCBuZXcgcGxhdGZvcm1tYW5hZ2VyX1Byb2plY3QoKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0XHRpZiAoIWtleXMpIHtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImVuYWJsZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmFibGVkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuYWJsZWQodGhpcy5lbmFibGVkKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY29kZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVtYXJrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInRlYW1cIikgPj0gMCAmJiB0eXBlb2YodGhpcy50ZWFtKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnRlYW0odGhpcy50ZWFtKCkuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImJ1ZGdldFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmJ1ZGdldCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5idWRnZXQodGhpcy5idWRnZXQoKS5fdW5pcXVlKCkpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9xdWVyeShncSkge1xuXHRcdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfNzg2MTFfcGxhdGZvcm1fMF9wcm9qZWN0JywgWycqJ10pWyd4Xzc4NjExX3BsYXRmb3JtXzBfcHJvamVjdCddKTtcblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgneF83ODYxMV9wbGF0Zm9ybV8wX3Byb2plY3QnKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkodGhpcykpO1xuXHRcdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qIGdzLmluZm8oXCJQcm9qZWN0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdFx0LyogZ3MuaW5mbyhcIlByb2plY3QuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdFx0LyogZ3MuaW5mbyhcIlByb2plY3QuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdjb2RlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdjb2RlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2NvZGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdFx0LyogZ3MuaW5mbyhcIlByb2plY3QuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2RhdGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qIGdzLmluZm8oXCJQcm9qZWN0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qIGdzLmluZm8oXCJQcm9qZWN0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVtYXJrJykgPj0gMCkge1xuXHRcdFx0XHQvKiBncy5pbmZvKFwiUHJvamVjdC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3JlbWFyaycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl90ZWFtKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fdGVhbV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnRlYW0oKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJQcm9qZWN0XCI9PVwiQ29sdW1uXCIpIGdzLmluZm8oXCJQcm9qZWN0Ll9xdWVyeSgpOiBcIisgXCJ0ZWFtIFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdGdzLmluZm8oXCJQcm9qZWN0Ll9xdWVyeSgpOiBcIiArIFwidGVhbVt0ZWFtXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLnRlYW0oKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigndGVhbScpID49IDApIHtcblx0XHRcdFx0LyogZ3MuaW5mbyhcIlByb2plY3QuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCd0ZWFtJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCd0ZWFtJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3RlYW0nLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYnVkZ2V0KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYnVkZ2V0X2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYnVkZ2V0KCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSB2LmZpbmRBbGwoKTtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDEpIHtcblx0XHRcdFx0XHQvKmlmKFwiUHJvamVjdFwiPT1cIkNvbHVtblwiKSBncy5pbmZvKFwiUHJvamVjdC5fcXVlcnkoKTogXCIrIFwiYnVkZ2V0IFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdGdzLmluZm8oXCJQcm9qZWN0Ll9xdWVyeSgpOiBcIiArIFwiYnVkZ2V0W2J1ZGdldF0gcmVzdWxlZCBpbiB1bmRlZmluZWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5idWRnZXQoKSkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYnVkZ2V0JykgPj0gMCkge1xuXHRcdFx0XHQvKiBncy5pbmZvKFwiUHJvamVjdC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2J1ZGdldCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYnVkZ2V0Jyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2J1ZGdldCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdFx0LyogZ3MuaW5mbyhcIlByb2plY3QuX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdFx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG5cdH1cblxuXHRfc2F2ZShvYmopIHtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHBsYXRmb3JtbWFuYWdlcl9Qcm9qZWN0KCkuX3NhdmUobylcblx0XHR9KTtcblxuXHRcdGxldCBfb2JqID0ge307XG5cblx0XHQvKmdzLmluZm8oXCJQcm9qZWN0Ll9zYXZlKCk6IFwiKyBcIi4uLiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4Xzc4NjExX3BsYXRmb3JtXzBfcHJvamVjdCcsIFsnKiddKVsneF83ODYxMV9wbGF0Zm9ybV8wX3Byb2plY3QnXSkuZmlsdGVyKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiB0cnVlIHx8IFsnc3lzX3VwZGF0ZWRfb24nLCAnc3lzX2NyZWF0ZWRfb24nLCAndXBkYXRlcycsICdzeXNfY3JlYXRlZF9ieScsICdzeXNfdXBkYXRlZF9ieSddLmluZGV4T2YoX2spIDwgMFxuXHRcdFx0fSkuaW5kZXhPZihrLnRvTG93ZXJDYXNlKCkpID49IDBcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdF9vYmpbay50b0xvd2VyQ2FzZSgpXSA9IG9ialtrXVxuXHRcdH0pO1xuXG5cdFx0T2JqZWN0LmtleXMoX29iaikuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKF9vYmpba10pID09PSBcIltvYmplY3QgRGF0ZV1cIiAmJiBpc05hTihfb2JqW2tdKSkge1xuXHRcdFx0XHRncy5pbmZvKFwiUHJvamVjdC5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0XHRncy5pbmZvKFwiUHJvamVjdC5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGxldCBfdGhpcyA9IG51bGw7XG5cdFx0aWYgKG9iai5fX2tleXMpIHtcblx0XHRcdGxldCBrT2JqID0ge307XG5cdFx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpKSk7XG5cdFx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHRrT2JqW2tdID0gX29ialtrXVxuXHRcdFx0fSk7XG5cdFx0XHRfdGhpcyA9IG5ldyBwbGF0Zm9ybW1hbmFnZXJfUHJvamVjdCgpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF90aGlzID0gbmV3IHBsYXRmb3JtbWFuYWdlcl9Qcm9qZWN0KCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdFx0fVxuXG5cdFx0Lypncy5pbmZvKFwiUHJvamVjdC5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdFx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRcdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHRcdHRyeSB7XG5cdFx0XHRncy5pbmZvKFwiUHJvamVjdC5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdGdzLmluZm8oXCJQcm9qZWN0Ll9zYXZlKCk6IFwiICsgXCJyZW5hbWluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0pO1xuXG5cdFx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAneF83ODYxMV9wbGF0Zm9ybV8wX3Byb2plY3QnKTtcblx0XHRcdC8qZ3MuaW5mbyhcIlByb2plY3QuX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdFx0fVxuXHRcdFx0bGV0IF9mT2JqID0ge307XG5cdFx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKSkpO1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF83ODYxMV9wbGF0Zm9ybV8wX3Byb2plY3QnLCBbJyonXSlbJ3hfNzg2MTFfcGxhdGZvcm1fMF9wcm9qZWN0J10pKSkpO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRncy5pbmZvKFwiUHJvamVjdC5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdFx0Z3MuaW5mbyhcIlByb2plY3QuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmoucHJvamVjdF9SZXF1aXJlbWVudHMpKSB0aGlzLnByb2plY3RfUmVxdWlyZW1lbnRzKG9iai5wcm9qZWN0X1JlcXVpcmVtZW50cy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgcGxhdGZvcm1tYW5hZ2VyX1JlcXVpcmVtZW50KCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLnByb2plY3RfTWVldGluZ3MpKSB0aGlzLnByb2plY3RfTWVldGluZ3Mob2JqLnByb2plY3RfTWVldGluZ3MubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHBsYXRmb3JtbWFuYWdlcl9NZWV0aW5nKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBQcm9qZWN0LnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RvcmUoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihsb2dPYmopIHtcblx0XHRcdGdzLmluZm8oXCJQcm9qZWN0LnN0b3JlKCk6IFwiICsgXCJsb2dPYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkobG9nT2JqLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0Z3MuaW5mbyhcIlByb2plY3Quc3RvcmUoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRncy5pbmZvKFwiUHJvamVjdC5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0Z3MuaW5mbyhcIlByb2plY3Quc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdFx0bGV0IF90aGlzID0gdGhpcy5fdW5pcXVlKCkuZmluZCgpO1xuXHRcdFx0aWYgKF90aGlzKSB0aGlzLklkID0gX3RoaXMuSWQ7XG5cblx0XHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFByb2plY3QuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmRBbGwoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihsb2dPYmopIHtcblx0XHRcdGdzLmluZm8oXCJQcm9qZWN0LmZpbmRBbGwoKTogXCIgKyBcImxvZ09iajogXCIgKyBKU09OLnN0cmluZ2lmeShsb2dPYmosIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHRncy5pbmZvKFwiUHJvamVjdC5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Z3MuaW5mbyhcIlByb2plY3QuZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0Z3MuaW5mbyhcIlByb2plY3QuZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZChcIlByb2plY3RcIik7XG5cdFx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfNzg2MTFfcGxhdGZvcm1fMF9wcm9qZWN0JywgWycqJ10pWyd4Xzc4NjExX3BsYXRmb3JtXzBfcHJvamVjdCddKSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBQcm9qZWN0LmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obG9nT2JqKSB7XG5cdFx0XHRncy5pbmZvKFwiUHJvamVjdC5maW5kKCk6IFwiICsgXCJsb2dPYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkobG9nT2JqLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0Z3MuaW5mbyhcIlByb2plY3QuZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGdzLmluZm8oXCJQcm9qZWN0LmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdGdzLmluZm8oXCJQcm9qZWN0LmZpbmQoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0bGV0IHJldCA9IHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0cmV0dXJuIHJldC5sZW5ndGggPyByZXRbMF0gOiBudWxsO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBQcm9qZWN0LmFjdHVhbENvc3QoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3R1YWxDb3N0KF9fZXZlbnQsIHRpbGxEYXRlKSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKGxvZ09iaikge1xuXHRcdFx0Z3MuaW5mbyhcIlByb2plY3QuYWN0dWFsQ29zdCgpOiBcIiArIFwibG9nT2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KGxvZ09iaiwgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi50aWxsRGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRpbGxEYXRlID0gZXZKU09OLnRpbGxEYXRlO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdGdzLmluZm8oXCJQcm9qZWN0LmFjdHVhbENvc3QoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRncy5pbmZvKFwiUHJvamVjdC5hY3R1YWxDb3N0KCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IGV2SlNPTjtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHRncy5pbmZvKFwiUHJvamVjdC5hY3R1YWxDb3N0KCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChzdHIoYW5zd2VyKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG59In0seyJhY3RpdmUiOnRydWUsImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInN5c19uYW1lIjoicGxhdGZvcm1tYW5hZ2VyX0RlY2lzaW9uX09wdGlvbiIsImFwaV9uYW1lIjoieF83ODYxMV9wbGF0Zm9ybV8wLnBsYXRmb3JtbWFuYWdlcl9EZWNpc2lvbl9PcHRpb24iLCJuYW1lIjoicGxhdGZvcm1tYW5hZ2VyX0RlY2lzaW9uX09wdGlvbiIsInNjcmlwdCI6ImNsYXNzIHBsYXRmb3JtbWFuYWdlcl9EZWNpc2lvbl9PcHRpb24ge1xuXHRjb25zdHJ1Y3RvcihpZCkge1xuXHRcdHVuZGVmaW5lZFxuXHRcdHRoaXMuSWQgPSBpZDtcblx0XHR0aGlzLl9fbW9kdWxlID0gXCJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwicGxhdGZvcm1tYW5hZ2VyX0RlY2lzaW9uX09wdGlvblwiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwicGxhdGZvcm1tYW5hZ2VyXCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJwbGF0Zm9ybW1hbmFnZXJcIjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIERlY2lzaW9uX09wdGlvbi5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIERlY2lzaW9uX09wdGlvbi5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRGVjaXNpb25fT3B0aW9uLmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBEZWNpc2lvbl9PcHRpb24ub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRGVjaXNpb25fT3B0aW9uLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly9ncy5pbmZvKFwiRGVjaXNpb25fT3B0aW9uLmRhdGUoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9kYXRlID0gdjtcblx0XHRcdHRoaXMuX2RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGF0ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBEZWNpc2lvbl9PcHRpb24ubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG5hbWUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX25hbWUgPSB2O1xuXHRcdFx0dGhpcy5fbmFtZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9uYW1lO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIERlY2lzaW9uX09wdGlvbi5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIERlY2lzaW9uX09wdGlvbi5kZWNpc2lvbiBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRlY2lzaW9uKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9kZWNpc2lvbiA9IHY7XG5cdFx0XHR0aGlzLl9kZWNpc2lvbl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kZWNpc2lvbjtcblx0XHR9XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnY29kZScgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ25hbWUnICsgKHRoaXMuX25hbWVfY29vcCB8fCAnPScpICsgdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAodGhpcy5fcmVtYXJrKSByZXQgKz0gJ14nICsgc1BhdGggKyAncmVtYXJrJyArICh0aGlzLl9yZW1hcmtfY29vcCB8fCAnPScpICsgdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmICh0aGlzLl9kZWNpc2lvbikgcmV0ICs9IC8qKHRoaXMuX2RlY2lzaW9uX2Nvb3AgfHwgJz0nKSArICovIHRoaXMuZGVjaXNpb24oKS5fdG9FUXVlcnkoc1BhdGggKyAnZGVjaXNpb24uJyk7XG5cblx0XHRncy5pbmZvKFwiRGVjaXNpb25fT3B0aW9uLl90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykgcmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0Z3MuaW5mbyhcIkRlY2lzaW9uX09wdGlvbi5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdGdzLmluZm8oXCJEZWNpc2lvbl9PcHRpb24uX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpczsgLy8gdGVzdFxuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBwbGF0Zm9ybW1hbmFnZXJfRGVjaXNpb25fT3B0aW9uKCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0dHJ5IHtcblx0XHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0Lypncy5pbmZvKFwiRGVjaXNpb25fT3B0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0XHRsZXQgX29iaiA9IHtcblx0XHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHRcdH07XG5cdFx0XHRcdF9vYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSldID0gb2JqO1xuXHRcdFx0XHRvYmogPSBfb2JqO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChvYmopO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRpZiAob2JqLmlzVmFsaWRSZWNvcmQoKSkge1xuXHRcdFx0XHRcdGlmIChvYmouZ2V0VGFibGVOYW1lKCkgPT0gJ2VjY19xdWV1ZScgJiYgXCJEZWNpc2lvbl9PcHRpb25cIiAhPSAnZWNjX3F1ZXVlJyAmJiBvYmouc291cmNlID09IFwiRGVjaXNpb25fT3B0aW9uXCIpIHtcblx0XHRcdFx0XHRcdG9iai5zdGF0ZSA9IFwicHJvY2Vzc2luZ1wiO1xuXHRcdFx0XHRcdFx0b2JqLnVwZGF0ZSgpO1xuXG5cdFx0XHRcdFx0XHRsZXQgcmVzcCA9IG5ldyBHbGlkZVJlY29yZCgnZWNjX3F1ZXVlJyk7XG5cdFx0XHRcdFx0XHRyZXNwLnJlc3BvbnNlX3RvID0gb2JqLnN5c19pZDtcblx0XHRcdFx0XHRcdHJlc3AucXVldWUgPSAnb3V0cHV0Jztcblx0XHRcdFx0XHRcdHJlc3AuYWdlbnQgPSBvYmouYWdlbnQ7XG5cdFx0XHRcdFx0XHRyZXNwLnRvcGljID0gb2JqLnRvcGljO1xuXHRcdFx0XHRcdFx0cmVzcC5uYW1lID0gb2JqLm5hbWU7XG5cdFx0XHRcdFx0XHRyZXNwLnNvdXJjZSA9IG9iai5zb3VyY2U7XG5cdFx0XHRcdFx0XHRyZXNwLmZyb21faG9zdCA9IG9iai5hZ2VudF9jb3JyZWxhdG9yO1xuXHRcdFx0XHRcdFx0cmVzcC5hZ2VudF9jb3JyZWxhdG9yID0gb2JqLmZyb21faG9zdDtcblxuXHRcdFx0XHRcdFx0bGV0IHJldCA9IG5ldyBwbGF0Zm9ybW1hbmFnZXJfRGVjaXNpb25fT3B0aW9uKCkuX2Zyb21Eb2N1bWVudCgpLl9pbnZva2Uob2JqLm5hbWUudG9TdHJpbmcoKSwgb2JqLnBheWxvYWQudG9TdHJpbmcoKSk7XG5cdFx0XHRcdFx0XHRpZiAoQXJyYXkuaXNBcnJheShyZXQpKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHJldC5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiAociAmJiB0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicpID8gci5fdG9Eb2N1bWVudCgpIDogcjtcblx0XHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHJldCAmJiB0eXBlb2YocmV0Ll90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByZXQuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJlc3AucGF5bG9hZCA9IEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCk7XG5cblx0XHRcdFx0XHRcdHJlc3AuaW5zZXJ0KCk7XG5cblx0XHRcdFx0XHRcdG9iai5zdGF0ZSA9IFwicHJvY2Vzc2VkXCI7XG5cdFx0XHRcdFx0XHRvYmoudXBkYXRlKCk7XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmVzcDtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRcdGVuYWJsZWQ6IG9iai5nZXRWYWx1ZShcImVuYWJsZWRcIiksXG5cblx0XHRcdFx0XHRcdGNvZGU6IG9iai5nZXRWYWx1ZShcImNvZGVcIiksXG5cblx0XHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdFx0cmVtYXJrOiBvYmouZ2V0VmFsdWUoXCJyZW1hcmtcIiksXG5cblx0XHRcdFx0XHRcdGRlY2lzaW9uOiBvYmouZ2V0VmFsdWUoXCJkZWNpc2lvblwiKSxcblxuXHRcdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRvYmoucXVlcnkoKTtcblx0XHRcdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tRG9jdW1lbnQob2JqKSk7XG5cdFx0XHRcdFx0Lypncy5pbmZvKFwiRGVjaXNpb25fT3B0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHRcdGdzLmluZm8oXCJEZWNpc2lvbl9PcHRpb24uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRcdHJldHVybiBvYmo7XG5cdFx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdFx0cmV0dXJuIG5ldyBwbGF0Zm9ybW1hbmFnZXJfRGVjaXNpb25fT3B0aW9uKCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0XHQvKmdzLmluZm8oXCJEZWNpc2lvbl9PcHRpb24uX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmNvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLmNvZGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLm5hbWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmoucmVtYXJrKSkpO1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmoucmVtYXJrKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5kZWNpc2lvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZGVjaXNpb24obmV3IHBsYXRmb3JtbWFuYWdlcl9EZWNpc2lvbigpLl9mcm9tRG9jdW1lbnQob2JqLmRlY2lzaW9uKSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdH0gZWxzZSB7IC8vIGlmKG9iai5jb25zdHJ1Y3Rvci5uYW1lPT1cIkRlY2lzaW9uX09wdGlvblwiKXtcblx0XHRcdFx0XHRncy5pbmZvKFwiRGVjaXNpb25fT3B0aW9uLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Z3MuaW5mbyhcIkRlY2lzaW9uX09wdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0Z3MuaW5mbyhcIkRlY2lzaW9uX09wdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0XHR9XG5cblx0XHQvKmdzLmluZm8oXCJEZWNpc2lvbl9PcHRpb24uX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHRcdC8qZ3MuaW5mbyhcIkRlY2lzaW9uX09wdGlvbi5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfbmV3KGMpIHtcblx0XHRpZiAoIWMpIGMgPSB0aGlzLl9fdHlwZTtcblx0XHRpZiAoYy5pbmRleE9mKCdwbGF0Zm9ybW1hbmFnZXJfJykgIT0gMCkgYyA9ICh7XG5cdFx0XHRQbGF0Zm9ybTogXCJwbGF0Zm9ybW1hbmFnZXJfUGxhdGZvcm1cIixcblx0XHRcdFVzZXI6IFwicGxhdGZvcm1tYW5hZ2VyX1VzZXJcIixcblx0XHRcdFJlcXVpcmVtZW50OiBcInBsYXRmb3JtbWFuYWdlcl9SZXF1aXJlbWVudFwiLFxuXHRcdFx0RWZmb3J0X0VzdGltYXRlOiBcInBsYXRmb3JtbWFuYWdlcl9FZmZvcnRfRXN0aW1hdGVcIixcblx0XHRcdEVmZm9ydDogXCJwbGF0Zm9ybW1hbmFnZXJfRWZmb3J0XCIsXG5cdFx0XHRCdWRnZXQ6IFwicGxhdGZvcm1tYW5hZ2VyX0J1ZGdldFwiLFxuXHRcdFx0QWdlbmRhX0l0ZW06IFwicGxhdGZvcm1tYW5hZ2VyX0FnZW5kYV9JdGVtXCIsXG5cdFx0XHRNZWV0aW5nX0FnZW5kYTogXCJwbGF0Zm9ybW1hbmFnZXJfTWVldGluZ19BZ2VuZGFcIixcblx0XHRcdERlY2lzaW9uX09wdGlvbjogXCJwbGF0Zm9ybW1hbmFnZXJfRGVjaXNpb25fT3B0aW9uXCIsXG5cdFx0XHREZWNpc2lvbjogXCJwbGF0Zm9ybW1hbmFnZXJfRGVjaXNpb25cIixcblx0XHRcdE1lZXRpbmdfTWludXRlOiBcInBsYXRmb3JtbWFuYWdlcl9NZWV0aW5nX01pbnV0ZVwiLFxuXHRcdFx0TWVldGluZ19TZXJpZXM6IFwicGxhdGZvcm1tYW5hZ2VyX01lZXRpbmdfU2VyaWVzXCIsXG5cdFx0XHRNZWV0aW5nOiBcInBsYXRmb3JtbWFuYWdlcl9NZWV0aW5nXCIsXG5cdFx0XHRCb2FyZDogXCJwbGF0Zm9ybW1hbmFnZXJfQm9hcmRcIixcblx0XHRcdEJvYXJkX01lbWJlcjogXCJwbGF0Zm9ybW1hbmFnZXJfQm9hcmRfTWVtYmVyXCIsXG5cdFx0XHRGcmVxdWVuY3k6IFwicGxhdGZvcm1tYW5hZ2VyX0ZyZXF1ZW5jeVwiLFxuXHRcdFx0TW9kdWxlOiBcInBsYXRmb3JtbWFuYWdlcl9Nb2R1bGVcIixcblx0XHRcdENhcGFiaWxpdHk6IFwicGxhdGZvcm1tYW5hZ2VyX0NhcGFiaWxpdHlcIixcblx0XHRcdFRlYW06IFwicGxhdGZvcm1tYW5hZ2VyX1RlYW1cIixcblx0XHRcdFByb2plY3Q6IFwicGxhdGZvcm1tYW5hZ2VyX1Byb2plY3RcIixcblx0XHRcdFRlYW1fTWVtYmVyOiBcInBsYXRmb3JtbWFuYWdlcl9UZWFtX01lbWJlclwiLFxuXHRcdFx0Um9sZTogXCJwbGF0Zm9ybW1hbmFnZXJfUm9sZVwiLFxuXHRcdH0pW2NdO1xuXHRcdHJldHVybiBuZXcoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gZ2xvYmFsIDogeF83ODYxMV9wbGF0Zm9ybV8wKVtjXSgpO1xuXHR9XG5cblx0X3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5jb2RlID0gdGhpcy5jb2RlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kZWNpc2lvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGVjaXNpb24gPSB0aGlzLmRlY2lzaW9uKCk7XG5cblx0XHRcdGlmIChyZXQuZGVjaXNpb24pIHtcblx0XHRcdFx0cmV0LmRlY2lzaW9uID0gcmV0LmRlY2lzaW9uLl90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0LmRlY2lzaW9uKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5kZWNpc2lvbikubGVuZ3RoKSByZXQuZGVjaXNpb24gPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0XHR9KTtcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGRlbGV0ZSByZXRba107XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3VuaXF1ZShrZXlzLCByZXQpIHtcblx0XHRyZXQgPSByZXQgfHwgbmV3IHBsYXRmb3JtbWFuYWdlcl9EZWNpc2lvbl9PcHRpb24oKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0XHRpZiAoIWtleXMpIHtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5kZWNpc2lvbigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kZWNpc2lvbih0aGlzLmRlY2lzaW9uKCkuX3VuaXF1ZSgpKTtcblxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3RpdmVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3RpdmUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aXZlKHRoaXMuYWN0aXZlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJjb2RlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm9yZGVyXCIpID49IDAgJiYgdHlwZW9mKHRoaXMub3JkZXIoKSkgIT09ICd1bmRlZmluZWQnKSByZXQub3JkZXIodGhpcy5vcmRlcigpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImRhdGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYXRlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhdGUodGhpcy5kYXRlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwibmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJyZW1hcmtcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZW1hcmsoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVtYXJrKHRoaXMucmVtYXJrKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGVjaXNpb25cIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kZWNpc2lvbigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kZWNpc2lvbih0aGlzLmRlY2lzaW9uKCkuX3VuaXF1ZSgpKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfcXVlcnkoZ3EpIHtcblx0XHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4Xzc4NjExX3BsYXRmb3JtXzBfZGVjaXNpb25fb3B0aW9uJywgWycqJ10pWyd4Xzc4NjExX3BsYXRmb3JtXzBfZGVjaXNpb25fb3B0aW9uJ10pO1xuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCd4Xzc4NjExX3BsYXRmb3JtXzBfZGVjaXNpb25fb3B0aW9uJyk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKHRoaXMpKTtcblx0XHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0XHQvKiBncy5pbmZvKFwiRGVjaXNpb25fT3B0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdFx0LyogZ3MuaW5mbyhcIkRlY2lzaW9uX09wdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5hYmxlZCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fY29kZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9jb2RlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5jb2RlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdjb2RlJykgPj0gMCkge1xuXHRcdFx0XHQvKiBncy5pbmZvKFwiRGVjaXNpb25fT3B0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdjb2RlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHRcdC8qIGdzLmluZm8oXCJEZWNpc2lvbl9PcHRpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2RhdGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qIGdzLmluZm8oXCJEZWNpc2lvbl9PcHRpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX25hbWVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbmFtZScpID49IDApIHtcblx0XHRcdFx0LyogZ3MuaW5mbyhcIkRlY2lzaW9uX09wdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3JlbWFyaycpID49IDApIHtcblx0XHRcdFx0LyogZ3MuaW5mbyhcIkRlY2lzaW9uX09wdGlvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3JlbWFyaycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kZWNpc2lvbikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2RlY2lzaW9uX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZGVjaXNpb24oKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJEZWNpc2lvbiBPcHRpb25cIj09XCJDb2x1bW5cIikgZ3MuaW5mbyhcIkRlY2lzaW9uX09wdGlvbi5fcXVlcnkoKTogXCIrIFwiZGVjaXNpb24gXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0Z3MuaW5mbyhcIkRlY2lzaW9uX09wdGlvbi5fcXVlcnkoKTogXCIgKyBcImRlY2lzaW9uW2RlY2lzaW9uXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLmRlY2lzaW9uKCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RlY2lzaW9uJykgPj0gMCkge1xuXHRcdFx0XHQvKiBncy5pbmZvKFwiRGVjaXNpb25fT3B0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGVjaXNpb24nKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RlY2lzaW9uJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RlY2lzaW9uJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0XHQvKiBncy5pbmZvKFwiRGVjaXNpb25fT3B0aW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdHJldHVybiB0aGlzLl9xdWVyeUdRO1xuXHR9XG5cblx0X3NhdmUob2JqKSB7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0cmV0dXJuIG5ldyBwbGF0Zm9ybW1hbmFnZXJfRGVjaXNpb25fT3B0aW9uKCkuX3NhdmUobylcblx0XHR9KTtcblxuXHRcdGxldCBfb2JqID0ge307XG5cblx0XHQvKmdzLmluZm8oXCJEZWNpc2lvbl9PcHRpb24uX3NhdmUoKTogXCIrIFwiLi4uIFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfNzg2MTFfcGxhdGZvcm1fMF9kZWNpc2lvbl9vcHRpb24nLCBbJyonXSlbJ3hfNzg2MTFfcGxhdGZvcm1fMF9kZWNpc2lvbl9vcHRpb24nXSkuZmlsdGVyKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiB0cnVlIHx8IFsnc3lzX3VwZGF0ZWRfb24nLCAnc3lzX2NyZWF0ZWRfb24nLCAndXBkYXRlcycsICdzeXNfY3JlYXRlZF9ieScsICdzeXNfdXBkYXRlZF9ieSddLmluZGV4T2YoX2spIDwgMFxuXHRcdFx0fSkuaW5kZXhPZihrLnRvTG93ZXJDYXNlKCkpID49IDBcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdF9vYmpbay50b0xvd2VyQ2FzZSgpXSA9IG9ialtrXVxuXHRcdH0pO1xuXG5cdFx0T2JqZWN0LmtleXMoX29iaikuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKF9vYmpba10pID09PSBcIltvYmplY3QgRGF0ZV1cIiAmJiBpc05hTihfb2JqW2tdKSkge1xuXHRcdFx0XHRncy5pbmZvKFwiRGVjaXNpb25fT3B0aW9uLl9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHRcdGdzLmluZm8oXCJEZWNpc2lvbl9PcHRpb24uX3NhdmUoKTogXCIgKyBcInN5c19pZCB0byBzdHJpbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRsZXQgX3RoaXMgPSBudWxsO1xuXHRcdGlmIChvYmouX19rZXlzKSB7XG5cdFx0XHRsZXQga09iaiA9IHt9O1xuXHRcdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShfb2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKSkpO1xuXHRcdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHRcdH0pO1xuXHRcdFx0X3RoaXMgPSBuZXcgcGxhdGZvcm1tYW5hZ2VyX0RlY2lzaW9uX09wdGlvbigpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF90aGlzID0gbmV3IHBsYXRmb3JtbWFuYWdlcl9EZWNpc2lvbl9PcHRpb24oKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0XHR9XG5cblx0XHQvKmdzLmluZm8oXCJEZWNpc2lvbl9PcHRpb24uX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRcdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0XHRkZWxldGUgX29iai5fX2lkRmllbGQ7XG5cblx0XHR0cnkge1xuXHRcdFx0Z3MuaW5mbyhcIkRlY2lzaW9uX09wdGlvbi5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdGdzLmluZm8oXCJEZWNpc2lvbl9PcHRpb24uX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSk7XG5cblx0XHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICd4Xzc4NjExX3BsYXRmb3JtXzBfZGVjaXNpb25fb3B0aW9uJyk7XG5cdFx0XHQvKmdzLmluZm8oXCJEZWNpc2lvbl9PcHRpb24uX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdFx0fVxuXHRcdFx0bGV0IF9mT2JqID0ge307XG5cdFx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKSkpO1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF83ODYxMV9wbGF0Zm9ybV8wX2RlY2lzaW9uX29wdGlvbicsIFsnKiddKVsneF83ODYxMV9wbGF0Zm9ybV8wX2RlY2lzaW9uX29wdGlvbiddKSkpKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0Z3MuaW5mbyhcIkRlY2lzaW9uX09wdGlvbi5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdFx0Z3MuaW5mbyhcIkRlY2lzaW9uX09wdGlvbi5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH1cblxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRGVjaXNpb25fT3B0aW9uLnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RvcmUoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihsb2dPYmopIHtcblx0XHRcdGdzLmluZm8oXCJEZWNpc2lvbl9PcHRpb24uc3RvcmUoKTogXCIgKyBcImxvZ09iajogXCIgKyBKU09OLnN0cmluZ2lmeShsb2dPYmosIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHRncy5pbmZvKFwiRGVjaXNpb25fT3B0aW9uLnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Z3MuaW5mbyhcIkRlY2lzaW9uX09wdGlvbi5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0Z3MuaW5mbyhcIkRlY2lzaW9uX09wdGlvbi5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0XHRsZXQgX3RoaXMgPSB0aGlzLl91bmlxdWUoKS5maW5kKCk7XG5cdFx0XHRpZiAoX3RoaXMpIHRoaXMuSWQgPSBfdGhpcy5JZDtcblxuXHRcdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRGVjaXNpb25fT3B0aW9uLmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kQWxsKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obG9nT2JqKSB7XG5cdFx0XHRncy5pbmZvKFwiRGVjaXNpb25fT3B0aW9uLmZpbmRBbGwoKTogXCIgKyBcImxvZ09iajogXCIgKyBKU09OLnN0cmluZ2lmeShsb2dPYmosIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHRncy5pbmZvKFwiRGVjaXNpb25fT3B0aW9uLmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRncy5pbmZvKFwiRGVjaXNpb25fT3B0aW9uLmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdGdzLmluZm8oXCJEZWNpc2lvbl9PcHRpb24uZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZChcIkRlY2lzaW9uX09wdGlvblwiKTtcblx0XHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0XHQvL3JldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQodGhpcy5fcXVlcnkoKS5zZWxlY3QoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF83ODYxMV9wbGF0Zm9ybV8wX2RlY2lzaW9uX29wdGlvbicsIFsnKiddKVsneF83ODYxMV9wbGF0Zm9ybV8wX2RlY2lzaW9uX29wdGlvbiddKSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBEZWNpc2lvbl9PcHRpb24uZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmQoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihsb2dPYmopIHtcblx0XHRcdGdzLmluZm8oXCJEZWNpc2lvbl9PcHRpb24uZmluZCgpOiBcIiArIFwibG9nT2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KGxvZ09iaiwgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdGdzLmluZm8oXCJEZWNpc2lvbl9PcHRpb24uZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGdzLmluZm8oXCJEZWNpc2lvbl9PcHRpb24uZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0Z3MuaW5mbyhcIkRlY2lzaW9uX09wdGlvbi5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic3lzX25hbWUiOiJwbGF0Zm9ybW1hbmFnZXJfTWVldGluZ19TZXJpZXMiLCJhcGlfbmFtZSI6InhfNzg2MTFfcGxhdGZvcm1fMC5wbGF0Zm9ybW1hbmFnZXJfTWVldGluZ19TZXJpZXMiLCJuYW1lIjoicGxhdGZvcm1tYW5hZ2VyX01lZXRpbmdfU2VyaWVzIiwic2NyaXB0IjoiY2xhc3MgcGxhdGZvcm1tYW5hZ2VyX01lZXRpbmdfU2VyaWVzIHtcblx0Y29uc3RydWN0b3IoaWQpIHtcblx0XHR1bmRlZmluZWRcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInBsYXRmb3JtbWFuYWdlcl9NZWV0aW5nX1Nlcmllc1wiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwicGxhdGZvcm1tYW5hZ2VyXCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJwbGF0Zm9ybW1hbmFnZXJcIjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1lZXRpbmdfU2VyaWVzLmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdGl2ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYWN0aXZlID0gdjtcblx0XHRcdHRoaXMuX2FjdGl2ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3RpdmU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogTWVldGluZ19TZXJpZXMuZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVuYWJsZWQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2VuYWJsZWQgPSB2O1xuXHRcdFx0dGhpcy5fZW5hYmxlZF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lbmFibGVkO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1lZXRpbmdfU2VyaWVzLmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNZWV0aW5nX1Nlcmllcy5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG9yZGVyKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9vcmRlciA9IHY7XG5cdFx0XHR0aGlzLl9vcmRlcl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9vcmRlcjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNZWV0aW5nX1Nlcmllcy5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGF0ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vZ3MuaW5mbyhcIk1lZXRpbmdfU2VyaWVzLmRhdGUoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9kYXRlID0gdjtcblx0XHRcdHRoaXMuX2RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGF0ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNZWV0aW5nX1Nlcmllcy5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogTWVldGluZ19TZXJpZXMucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNZWV0aW5nX1Nlcmllcy5mcmVxdWVuY3kgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmcmVxdWVuY3kodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2ZyZXF1ZW5jeSA9IHY7XG5cdFx0XHR0aGlzLl9mcmVxdWVuY3lfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJlcXVlbmN5O1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1lZXRpbmdfU2VyaWVzLnNlcmllc19NZWV0aW5ncyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHNlcmllc19NZWV0aW5ncyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX3Nlcmllc19NZWV0aW5ncyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX3Nlcmllc19NZWV0aW5nc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fc2VyaWVzX01lZXRpbmdzO1xuXHRcdH1cblx0fVxuXG5cdF90b0VRdWVyeShzUGF0aCkge1xuXHRcdHNQYXRoID0gc1BhdGggfHwgJyc7XG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCAnJztcblxuXHRcdGlmICh0aGlzLl9hY3RpdmUpIHJldCArPSAnXicgKyBzUGF0aCArICdhY3RpdmUnICsgKHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JykgKyB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuYWJsZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmFibGVkJyArICh0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2NvZGUpIHJldCArPSAnXicgKyBzUGF0aCArICdjb2RlJyArICh0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nKSArIHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX29yZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnb3JkZXInICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMub3JkZXIoKTtcblxuXHRcdGlmICh0aGlzLl9kYXRlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF0ZScgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh0aGlzLl9uYW1lKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbmFtZScgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdyZW1hcmsnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0aWYgKHRoaXMuX2ZyZXF1ZW5jeSkgcmV0ICs9IC8qKHRoaXMuX2ZyZXF1ZW5jeV9jb29wIHx8ICc9JykgKyAqLyB0aGlzLmZyZXF1ZW5jeSgpLl90b0VRdWVyeShzUGF0aCArICdmcmVxdWVuY3kuJyk7XG5cblx0XHQodGhpcy5zZXJpZXNfTWVldGluZ3MoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWU1lZXRpbmcuc2VyaWVzLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHRncy5pbmZvKFwiTWVldGluZ19TZXJpZXMuX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSByZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHRncy5pbmZvKFwiTWVldGluZ19TZXJpZXMuX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXG5cdFx0c3dpdGNoIChtZXRob2QpIHtcblxuXHRcdFx0Y2FzZSBcInN0b3JlXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuc3RvcmUoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRBbGxcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHRncy5pbmZvKFwiTWVldGluZ19TZXJpZXMuX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpczsgLy8gdGVzdFxuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBwbGF0Zm9ybW1hbmFnZXJfTWVldGluZ19TZXJpZXMoKS5fZnJvbURvY3VtZW50KG8pKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKG9iaikgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHR0cnkge1xuXHRcdFx0XHRvYmogPSBKU09OLnBhcnNlKG9iaik7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHQvKmdzLmluZm8oXCJNZWV0aW5nX1Nlcmllcy5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0XHR9O1xuXHRcdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdFx0b2JqID0gX29iajtcblx0XHRcdH1cblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdFx0XHRpZiAob2JqLmdldFRhYmxlTmFtZSgpID09ICdlY2NfcXVldWUnICYmIFwiTWVldGluZ19TZXJpZXNcIiAhPSAnZWNjX3F1ZXVlJyAmJiBvYmouc291cmNlID09IFwiTWVldGluZ19TZXJpZXNcIikge1xuXHRcdFx0XHRcdFx0b2JqLnN0YXRlID0gXCJwcm9jZXNzaW5nXCI7XG5cdFx0XHRcdFx0XHRvYmoudXBkYXRlKCk7XG5cblx0XHRcdFx0XHRcdGxldCByZXNwID0gbmV3IEdsaWRlUmVjb3JkKCdlY2NfcXVldWUnKTtcblx0XHRcdFx0XHRcdHJlc3AucmVzcG9uc2VfdG8gPSBvYmouc3lzX2lkO1xuXHRcdFx0XHRcdFx0cmVzcC5xdWV1ZSA9ICdvdXRwdXQnO1xuXHRcdFx0XHRcdFx0cmVzcC5hZ2VudCA9IG9iai5hZ2VudDtcblx0XHRcdFx0XHRcdHJlc3AudG9waWMgPSBvYmoudG9waWM7XG5cdFx0XHRcdFx0XHRyZXNwLm5hbWUgPSBvYmoubmFtZTtcblx0XHRcdFx0XHRcdHJlc3Auc291cmNlID0gb2JqLnNvdXJjZTtcblx0XHRcdFx0XHRcdHJlc3AuZnJvbV9ob3N0ID0gb2JqLmFnZW50X2NvcnJlbGF0b3I7XG5cdFx0XHRcdFx0XHRyZXNwLmFnZW50X2NvcnJlbGF0b3IgPSBvYmouZnJvbV9ob3N0O1xuXG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gbmV3IHBsYXRmb3JtbWFuYWdlcl9NZWV0aW5nX1NlcmllcygpLl9mcm9tRG9jdW1lbnQoKS5faW52b2tlKG9iai5uYW1lLnRvU3RyaW5nKCksIG9iai5wYXlsb2FkLnRvU3RyaW5nKCkpO1xuXHRcdFx0XHRcdFx0aWYgKEFycmF5LmlzQXJyYXkocmV0KSkge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByZXQubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gKHIgJiYgdHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nKSA/IHIuX3RvRG9jdW1lbnQoKSA6IHI7XG5cdFx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmIChyZXQgJiYgdHlwZW9mKHJldC5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gcmV0Ll90b0RvY3VtZW50KCk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXNwLnBheWxvYWQgPSBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpO1xuXG5cdFx0XHRcdFx0XHRyZXNwLmluc2VydCgpO1xuXG5cdFx0XHRcdFx0XHRvYmouc3RhdGUgPSBcInByb2Nlc3NlZFwiO1xuXHRcdFx0XHRcdFx0b2JqLnVwZGF0ZSgpO1xuXHRcdFx0XHRcdFx0cmV0dXJuIHJlc3A7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0XHRjb2RlOiBvYmouZ2V0VmFsdWUoXCJjb2RlXCIpLFxuXG5cdFx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRcdG5hbWU6IG9iai5nZXRWYWx1ZShcIm5hbWVcIiksXG5cblx0XHRcdFx0XHRcdHJlbWFyazogb2JqLmdldFZhbHVlKFwicmVtYXJrXCIpLFxuXG5cdFx0XHRcdFx0XHRmcmVxdWVuY3k6IG9iai5nZXRWYWx1ZShcImZyZXF1ZW5jeVwiKSxcblxuXHRcdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRvYmoucXVlcnkoKTtcblx0XHRcdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tRG9jdW1lbnQob2JqKSk7XG5cdFx0XHRcdFx0Lypncy5pbmZvKFwiTWVldGluZ19TZXJpZXMuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJnbGlkZSBvYmplY3RzIFwiKyBcImdyUmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KGdyUmV0LCBudWxsLCA0KSk7Ki9cblx0XHRcdFx0XHRyZXR1cm4gZ3JSZXQ7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSBpZiAob2JqLl9mcm9tRG9jdW1lbnQpIHtcblx0XHRcdFx0Z3MuaW5mbyhcIk1lZXRpbmdfU2VyaWVzLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0XHRyZXR1cm4gb2JqO1xuXHRcdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRcdHJldHVybiBuZXcgcGxhdGZvcm1tYW5hZ2VyX01lZXRpbmdfU2VyaWVzKCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0XHQvKmdzLmluZm8oXCJNZWV0aW5nX1Nlcmllcy5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuY29kZShvYmouY29kZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubmFtZShvYmoubmFtZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsoU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5yZW1hcmspKSk7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5yZW1hcmspO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmZyZXF1ZW5jeSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZnJlcXVlbmN5KG5ldyBwbGF0Zm9ybW1hbmFnZXJfRnJlcXVlbmN5KCkuX2Zyb21Eb2N1bWVudChvYmouZnJlcXVlbmN5KSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouc2VyaWVzX01lZXRpbmdzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuc2VyaWVzX01lZXRpbmdzKG5ldyBwbGF0Zm9ybW1hbmFnZXJfTWVldGluZygpLl9mcm9tRG9jdW1lbnQob2JqLnNlcmllc19NZWV0aW5ncykpO1xuXG5cdFx0XHRcdH0gZWxzZSB7IC8vIGlmKG9iai5jb25zdHJ1Y3Rvci5uYW1lPT1cIk1lZXRpbmdfU2VyaWVzXCIpe1xuXHRcdFx0XHRcdGdzLmluZm8oXCJNZWV0aW5nX1Nlcmllcy5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGdzLmluZm8oXCJNZWV0aW5nX1Nlcmllcy5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0Z3MuaW5mbyhcIk1lZXRpbmdfU2VyaWVzLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHRcdH1cblxuXHRcdC8qZ3MuaW5mbyhcIk1lZXRpbmdfU2VyaWVzLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0XHQvKmdzLmluZm8oXCJNZWV0aW5nX1Nlcmllcy5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfbmV3KGMpIHtcblx0XHRpZiAoIWMpIGMgPSB0aGlzLl9fdHlwZTtcblx0XHRpZiAoYy5pbmRleE9mKCdwbGF0Zm9ybW1hbmFnZXJfJykgIT0gMCkgYyA9ICh7XG5cdFx0XHRQbGF0Zm9ybTogXCJwbGF0Zm9ybW1hbmFnZXJfUGxhdGZvcm1cIixcblx0XHRcdFVzZXI6IFwicGxhdGZvcm1tYW5hZ2VyX1VzZXJcIixcblx0XHRcdFJlcXVpcmVtZW50OiBcInBsYXRmb3JtbWFuYWdlcl9SZXF1aXJlbWVudFwiLFxuXHRcdFx0RWZmb3J0X0VzdGltYXRlOiBcInBsYXRmb3JtbWFuYWdlcl9FZmZvcnRfRXN0aW1hdGVcIixcblx0XHRcdEVmZm9ydDogXCJwbGF0Zm9ybW1hbmFnZXJfRWZmb3J0XCIsXG5cdFx0XHRCdWRnZXQ6IFwicGxhdGZvcm1tYW5hZ2VyX0J1ZGdldFwiLFxuXHRcdFx0QWdlbmRhX0l0ZW06IFwicGxhdGZvcm1tYW5hZ2VyX0FnZW5kYV9JdGVtXCIsXG5cdFx0XHRNZWV0aW5nX0FnZW5kYTogXCJwbGF0Zm9ybW1hbmFnZXJfTWVldGluZ19BZ2VuZGFcIixcblx0XHRcdERlY2lzaW9uX09wdGlvbjogXCJwbGF0Zm9ybW1hbmFnZXJfRGVjaXNpb25fT3B0aW9uXCIsXG5cdFx0XHREZWNpc2lvbjogXCJwbGF0Zm9ybW1hbmFnZXJfRGVjaXNpb25cIixcblx0XHRcdE1lZXRpbmdfTWludXRlOiBcInBsYXRmb3JtbWFuYWdlcl9NZWV0aW5nX01pbnV0ZVwiLFxuXHRcdFx0TWVldGluZ19TZXJpZXM6IFwicGxhdGZvcm1tYW5hZ2VyX01lZXRpbmdfU2VyaWVzXCIsXG5cdFx0XHRNZWV0aW5nOiBcInBsYXRmb3JtbWFuYWdlcl9NZWV0aW5nXCIsXG5cdFx0XHRCb2FyZDogXCJwbGF0Zm9ybW1hbmFnZXJfQm9hcmRcIixcblx0XHRcdEJvYXJkX01lbWJlcjogXCJwbGF0Zm9ybW1hbmFnZXJfQm9hcmRfTWVtYmVyXCIsXG5cdFx0XHRGcmVxdWVuY3k6IFwicGxhdGZvcm1tYW5hZ2VyX0ZyZXF1ZW5jeVwiLFxuXHRcdFx0TW9kdWxlOiBcInBsYXRmb3JtbWFuYWdlcl9Nb2R1bGVcIixcblx0XHRcdENhcGFiaWxpdHk6IFwicGxhdGZvcm1tYW5hZ2VyX0NhcGFiaWxpdHlcIixcblx0XHRcdFRlYW06IFwicGxhdGZvcm1tYW5hZ2VyX1RlYW1cIixcblx0XHRcdFByb2plY3Q6IFwicGxhdGZvcm1tYW5hZ2VyX1Byb2plY3RcIixcblx0XHRcdFRlYW1fTWVtYmVyOiBcInBsYXRmb3JtbWFuYWdlcl9UZWFtX01lbWJlclwiLFxuXHRcdFx0Um9sZTogXCJwbGF0Zm9ybW1hbmFnZXJfUm9sZVwiLFxuXHRcdH0pW2NdO1xuXHRcdHJldHVybiBuZXcoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gZ2xvYmFsIDogeF83ODYxMV9wbGF0Zm9ybV8wKVtjXSgpO1xuXHR9XG5cblx0X3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5jb2RlID0gdGhpcy5jb2RlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9mcmVxdWVuY3kpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmZyZXF1ZW5jeSA9IHRoaXMuZnJlcXVlbmN5KCk7XG5cblx0XHRcdGlmIChyZXQuZnJlcXVlbmN5KSB7XG5cdFx0XHRcdHJldC5mcmVxdWVuY3kgPSByZXQuZnJlcXVlbmN5Ll90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0LmZyZXF1ZW5jeSkgPT09ICdvYmplY3QnICYmICFPYmplY3Qua2V5cyhyZXQuZnJlcXVlbmN5KS5sZW5ndGgpIHJldC5mcmVxdWVuY3kgPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLnNlcmllc19NZWV0aW5ncygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zZXJpZXNfTWVldGluZ3MgPSB0aGlzLnNlcmllc19NZWV0aW5ncygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHRcdH0pO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0ZGVsZXRlIHJldFtrXTtcblx0XHR9KTtcblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfdW5pcXVlKGtleXMsIHJldCkge1xuXHRcdHJldCA9IHJldCB8fCBuZXcgcGxhdGZvcm1tYW5hZ2VyX01lZXRpbmdfU2VyaWVzKCk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdC8vIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7XG5cdFx0aWYgKCFrZXlzKSB7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImNvZGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJuYW1lXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubmFtZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInJlbWFya1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJmcmVxdWVuY3lcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5mcmVxdWVuY3koKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZnJlcXVlbmN5KHRoaXMuZnJlcXVlbmN5KCkuX3VuaXF1ZSgpKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfcXVlcnkoZ3EpIHtcblx0XHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4Xzc4NjExX3BsYXRmb3JtXzBfbWVldGluZ19zZXJpZXMnLCBbJyonXSlbJ3hfNzg2MTFfcGxhdGZvcm1fMF9tZWV0aW5nX3NlcmllcyddKTtcblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgneF83ODYxMV9wbGF0Zm9ybV8wX21lZXRpbmdfc2VyaWVzJyk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKHRoaXMpKTtcblx0XHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0XHQvKiBncy5pbmZvKFwiTWVldGluZ19TZXJpZXMuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0XHQvKiBncy5pbmZvKFwiTWVldGluZ19TZXJpZXMuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdFx0LyogZ3MuaW5mbyhcIk1lZXRpbmdfU2VyaWVzLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdjb2RlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHRcdC8qIGdzLmluZm8oXCJNZWV0aW5nX1Nlcmllcy5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF0ZScpID49IDApIHtcblx0XHRcdFx0LyogZ3MuaW5mbyhcIk1lZXRpbmdfU2VyaWVzLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qIGdzLmluZm8oXCJNZWV0aW5nX1Nlcmllcy5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3JlbWFyaycpID49IDApIHtcblx0XHRcdFx0LyogZ3MuaW5mbyhcIk1lZXRpbmdfU2VyaWVzLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVtYXJrJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2ZyZXF1ZW5jeSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2ZyZXF1ZW5jeV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmZyZXF1ZW5jeSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gdi5maW5kQWxsKCk7XG5cdFx0XHRcdGlmICh2Lmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdFx0LyppZihcIk1lZXRpbmcgU2VyaWVzXCI9PVwiQ29sdW1uXCIpIGdzLmluZm8oXCJNZWV0aW5nX1Nlcmllcy5fcXVlcnkoKTogXCIrIFwiZnJlcXVlbmN5IFwiKyBcInZbMF0uX3RvRG9jdW1lbnQoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh2WzBdLl90b0RvY3VtZW50KCksIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0XHR2ID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KSh2WzBdLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHZbMF0pKSkpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCF2Lmxlbmd0aCkge1xuXHRcdFx0XHRcdHYgPSBudWxsO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvb3AgPSAnSU4nO1xuXHRcdFx0XHRcdHYgPSB2Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdFx0fSkociwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0XHR9KShyKSkpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHYpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR2ID0gLTE7XG5cdFx0XHRcdGdzLmluZm8oXCJNZWV0aW5nX1Nlcmllcy5fcXVlcnkoKTogXCIgKyBcImZyZXF1ZW5jeVtmcmVxdWVuY3ldIHJlc3VsZWQgaW4gdW5kZWZpbmVkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuZnJlcXVlbmN5KCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2ZyZXF1ZW5jeScpID49IDApIHtcblx0XHRcdFx0LyogZ3MuaW5mbyhcIk1lZXRpbmdfU2VyaWVzLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZnJlcXVlbmN5Jyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdmcmVxdWVuY3knKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZnJlcXVlbmN5JywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0XHQvKiBncy5pbmZvKFwiTWVldGluZ19TZXJpZXMuX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdFx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG5cdH1cblxuXHRfc2F2ZShvYmopIHtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHBsYXRmb3JtbWFuYWdlcl9NZWV0aW5nX1NlcmllcygpLl9zYXZlKG8pXG5cdFx0fSk7XG5cblx0XHRsZXQgX29iaiA9IHt9O1xuXG5cdFx0Lypncy5pbmZvKFwiTWVldGluZ19TZXJpZXMuX3NhdmUoKTogXCIrIFwiLi4uIFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfNzg2MTFfcGxhdGZvcm1fMF9tZWV0aW5nX3NlcmllcycsIFsnKiddKVsneF83ODYxMV9wbGF0Zm9ybV8wX21lZXRpbmdfc2VyaWVzJ10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0XHR9KTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdFx0Z3MuaW5mbyhcIk1lZXRpbmdfU2VyaWVzLl9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHRcdGdzLmluZm8oXCJNZWV0aW5nX1Nlcmllcy5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGxldCBfdGhpcyA9IG51bGw7XG5cdFx0aWYgKG9iai5fX2tleXMpIHtcblx0XHRcdGxldCBrT2JqID0ge307XG5cdFx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpKSk7XG5cdFx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHRrT2JqW2tdID0gX29ialtrXVxuXHRcdFx0fSk7XG5cdFx0XHRfdGhpcyA9IG5ldyBwbGF0Zm9ybW1hbmFnZXJfTWVldGluZ19TZXJpZXMoKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfdGhpcyA9IG5ldyBwbGF0Zm9ybW1hbmFnZXJfTWVldGluZ19TZXJpZXMoKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0XHR9XG5cblx0XHQvKmdzLmluZm8oXCJNZWV0aW5nX1Nlcmllcy5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdFx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRcdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHRcdHRyeSB7XG5cdFx0XHRncy5pbmZvKFwiTWVldGluZ19TZXJpZXMuX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRcdHJldHVybiBrLnRvTG93ZXJDYXNlKCkgIT0gaztcblx0XHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHRncy5pbmZvKFwiTWVldGluZ19TZXJpZXMuX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSk7XG5cblx0XHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICd4Xzc4NjExX3BsYXRmb3JtXzBfbWVldGluZ19zZXJpZXMnKTtcblx0XHRcdC8qZ3MuaW5mbyhcIk1lZXRpbmdfU2VyaWVzLl9zYXZlKCk6IFwiKyBcInVwc2VydGluZy4uLiBcIisgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTsqL1xuXHRcdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRcdGdxID0gZ3Eud2hlcmUoJ3N5c19pZCcsIF9vYmouc3lzX2lkKS51cGRhdGUoX29iaik7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0XHRncSA9IGdxLmluc2VydChfb2JqKTtcblx0XHRcdH1cblx0XHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdFx0X2ZPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSkpKTtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChfb2JqID0gT2JqZWN0LmFzc2lnbihfZk9iaiwgZ3EuZ2V0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfNzg2MTFfcGxhdGZvcm1fMF9tZWV0aW5nX3NlcmllcycsIFsnKiddKVsneF83ODYxMV9wbGF0Zm9ybV8wX21lZXRpbmdfc2VyaWVzJ10pKSkpO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRncy5pbmZvKFwiTWVldGluZ19TZXJpZXMuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiZXg6IFwiICsgSlNPTi5zdHJpbmdpZnkoZXgsIG51bGwsIDQpKTtcblx0XHRcdGdzLmluZm8oXCJNZWV0aW5nX1Nlcmllcy5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH1cblxuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5zZXJpZXNfTWVldGluZ3MpKSB0aGlzLnNlcmllc19NZWV0aW5ncyhvYmouc2VyaWVzX01lZXRpbmdzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBwbGF0Zm9ybW1hbmFnZXJfTWVldGluZygpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogTWVldGluZ19TZXJpZXMuc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzdG9yZShfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKGxvZ09iaikge1xuXHRcdFx0Z3MuaW5mbyhcIk1lZXRpbmdfU2VyaWVzLnN0b3JlKCk6IFwiICsgXCJsb2dPYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkobG9nT2JqLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0Z3MuaW5mbyhcIk1lZXRpbmdfU2VyaWVzLnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Z3MuaW5mbyhcIk1lZXRpbmdfU2VyaWVzLnN0b3JlKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHRncy5pbmZvKFwiTWVldGluZ19TZXJpZXMuc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdFx0bGV0IF90aGlzID0gdGhpcy5fdW5pcXVlKCkuZmluZCgpO1xuXHRcdFx0aWYgKF90aGlzKSB0aGlzLklkID0gX3RoaXMuSWQ7XG5cblx0XHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1lZXRpbmdfU2VyaWVzLmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kQWxsKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obG9nT2JqKSB7XG5cdFx0XHRncy5pbmZvKFwiTWVldGluZ19TZXJpZXMuZmluZEFsbCgpOiBcIiArIFwibG9nT2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KGxvZ09iaiwgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdGdzLmluZm8oXCJNZWV0aW5nX1Nlcmllcy5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Z3MuaW5mbyhcIk1lZXRpbmdfU2VyaWVzLmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdGdzLmluZm8oXCJNZWV0aW5nX1Nlcmllcy5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIGZpbmRBbGwgbG9jYWxseVxuXHRcdFx0bGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKFwiTWVldGluZ19TZXJpZXNcIik7XG5cdFx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfNzg2MTFfcGxhdGZvcm1fMF9tZWV0aW5nX3NlcmllcycsIFsnKiddKVsneF83ODYxMV9wbGF0Zm9ybV8wX21lZXRpbmdfc2VyaWVzJ10pKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1lZXRpbmdfU2VyaWVzLmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obG9nT2JqKSB7XG5cdFx0XHRncy5pbmZvKFwiTWVldGluZ19TZXJpZXMuZmluZCgpOiBcIiArIFwibG9nT2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KGxvZ09iaiwgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdGdzLmluZm8oXCJNZWV0aW5nX1Nlcmllcy5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Z3MuaW5mbyhcIk1lZXRpbmdfU2VyaWVzLmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdGdzLmluZm8oXCJNZWV0aW5nX1Nlcmllcy5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic3lzX25hbWUiOiJwbGF0Zm9ybW1hbmFnZXJfTW9kdWxlIiwiYXBpX25hbWUiOiJ4Xzc4NjExX3BsYXRmb3JtXzAucGxhdGZvcm1tYW5hZ2VyX01vZHVsZSIsIm5hbWUiOiJwbGF0Zm9ybW1hbmFnZXJfTW9kdWxlIiwic2NyaXB0IjoiY2xhc3MgcGxhdGZvcm1tYW5hZ2VyX01vZHVsZSB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7XG5cdFx0dW5kZWZpbmVkXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIlwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJwbGF0Zm9ybW1hbmFnZXJfTW9kdWxlXCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJwbGF0Zm9ybW1hbmFnZXJcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInBsYXRmb3JtbWFuYWdlclwiO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogTW9kdWxlLmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdGl2ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYWN0aXZlID0gdjtcblx0XHRcdHRoaXMuX2FjdGl2ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3RpdmU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogTW9kdWxlLmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmFibGVkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lbmFibGVkID0gdjtcblx0XHRcdHRoaXMuX2VuYWJsZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5hYmxlZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNb2R1bGUuY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1vZHVsZS5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG9yZGVyKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9vcmRlciA9IHY7XG5cdFx0XHR0aGlzLl9vcmRlcl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9vcmRlcjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNb2R1bGUuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRhdGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvL2dzLmluZm8oXCJNb2R1bGUuZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1vZHVsZS5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogTW9kdWxlLnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlbWFyayh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVtYXJrID0gdjtcblx0XHRcdHRoaXMuX3JlbWFya19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZW1hcms7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogTW9kdWxlLnBsYXRmb3JtIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cGxhdGZvcm0odiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3BsYXRmb3JtID0gdjtcblx0XHRcdHRoaXMuX3BsYXRmb3JtX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3BsYXRmb3JtO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIE1vZHVsZS5tb2R1bGVfQ2FwYWJpbGl0eXMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRtb2R1bGVfQ2FwYWJpbGl0eXModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9tb2R1bGVfQ2FwYWJpbGl0eXMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9tb2R1bGVfQ2FwYWJpbGl0eXNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX21vZHVsZV9DYXBhYmlsaXR5cztcblx0XHR9XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnY29kZScgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ25hbWUnICsgKHRoaXMuX25hbWVfY29vcCB8fCAnPScpICsgdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAodGhpcy5fcmVtYXJrKSByZXQgKz0gJ14nICsgc1BhdGggKyAncmVtYXJrJyArICh0aGlzLl9yZW1hcmtfY29vcCB8fCAnPScpICsgdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmICh0aGlzLl9wbGF0Zm9ybSkgcmV0ICs9IC8qKHRoaXMuX3BsYXRmb3JtX2Nvb3AgfHwgJz0nKSArICovIHRoaXMucGxhdGZvcm0oKS5fdG9FUXVlcnkoc1BhdGggKyAncGxhdGZvcm0uJyk7XG5cblx0XHQodGhpcy5tb2R1bGVfQ2FwYWJpbGl0eXMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWUNhcGFiaWxpdHkubW9kdWxlLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHRncy5pbmZvKFwiTW9kdWxlLl90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykgcmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0Z3MuaW5mbyhcIk1vZHVsZS5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdGdzLmluZm8oXCJNb2R1bGUuX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpczsgLy8gdGVzdFxuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBwbGF0Zm9ybW1hbmFnZXJfTW9kdWxlKCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0dHJ5IHtcblx0XHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0Lypncy5pbmZvKFwiTW9kdWxlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0XHRsZXQgX29iaiA9IHtcblx0XHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHRcdH07XG5cdFx0XHRcdF9vYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSldID0gb2JqO1xuXHRcdFx0XHRvYmogPSBfb2JqO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChvYmopO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRpZiAob2JqLmlzVmFsaWRSZWNvcmQoKSkge1xuXHRcdFx0XHRcdGlmIChvYmouZ2V0VGFibGVOYW1lKCkgPT0gJ2VjY19xdWV1ZScgJiYgXCJNb2R1bGVcIiAhPSAnZWNjX3F1ZXVlJyAmJiBvYmouc291cmNlID09IFwiTW9kdWxlXCIpIHtcblx0XHRcdFx0XHRcdG9iai5zdGF0ZSA9IFwicHJvY2Vzc2luZ1wiO1xuXHRcdFx0XHRcdFx0b2JqLnVwZGF0ZSgpO1xuXG5cdFx0XHRcdFx0XHRsZXQgcmVzcCA9IG5ldyBHbGlkZVJlY29yZCgnZWNjX3F1ZXVlJyk7XG5cdFx0XHRcdFx0XHRyZXNwLnJlc3BvbnNlX3RvID0gb2JqLnN5c19pZDtcblx0XHRcdFx0XHRcdHJlc3AucXVldWUgPSAnb3V0cHV0Jztcblx0XHRcdFx0XHRcdHJlc3AuYWdlbnQgPSBvYmouYWdlbnQ7XG5cdFx0XHRcdFx0XHRyZXNwLnRvcGljID0gb2JqLnRvcGljO1xuXHRcdFx0XHRcdFx0cmVzcC5uYW1lID0gb2JqLm5hbWU7XG5cdFx0XHRcdFx0XHRyZXNwLnNvdXJjZSA9IG9iai5zb3VyY2U7XG5cdFx0XHRcdFx0XHRyZXNwLmZyb21faG9zdCA9IG9iai5hZ2VudF9jb3JyZWxhdG9yO1xuXHRcdFx0XHRcdFx0cmVzcC5hZ2VudF9jb3JyZWxhdG9yID0gb2JqLmZyb21faG9zdDtcblxuXHRcdFx0XHRcdFx0bGV0IHJldCA9IG5ldyBwbGF0Zm9ybW1hbmFnZXJfTW9kdWxlKCkuX2Zyb21Eb2N1bWVudCgpLl9pbnZva2Uob2JqLm5hbWUudG9TdHJpbmcoKSwgb2JqLnBheWxvYWQudG9TdHJpbmcoKSk7XG5cdFx0XHRcdFx0XHRpZiAoQXJyYXkuaXNBcnJheShyZXQpKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHJldC5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiAociAmJiB0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicpID8gci5fdG9Eb2N1bWVudCgpIDogcjtcblx0XHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHJldCAmJiB0eXBlb2YocmV0Ll90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByZXQuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJlc3AucGF5bG9hZCA9IEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCk7XG5cblx0XHRcdFx0XHRcdHJlc3AuaW5zZXJ0KCk7XG5cblx0XHRcdFx0XHRcdG9iai5zdGF0ZSA9IFwicHJvY2Vzc2VkXCI7XG5cdFx0XHRcdFx0XHRvYmoudXBkYXRlKCk7XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmVzcDtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRcdGVuYWJsZWQ6IG9iai5nZXRWYWx1ZShcImVuYWJsZWRcIiksXG5cblx0XHRcdFx0XHRcdGNvZGU6IG9iai5nZXRWYWx1ZShcImNvZGVcIiksXG5cblx0XHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdFx0cmVtYXJrOiBvYmouZ2V0VmFsdWUoXCJyZW1hcmtcIiksXG5cblx0XHRcdFx0XHRcdHBsYXRmb3JtOiBvYmouZ2V0VmFsdWUoXCJwbGF0Zm9ybVwiKSxcblxuXHRcdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRvYmoucXVlcnkoKTtcblx0XHRcdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tRG9jdW1lbnQob2JqKSk7XG5cdFx0XHRcdFx0Lypncy5pbmZvKFwiTW9kdWxlLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHRcdGdzLmluZm8oXCJNb2R1bGUuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRcdHJldHVybiBvYmo7XG5cdFx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdFx0cmV0dXJuIG5ldyBwbGF0Zm9ybW1hbmFnZXJfTW9kdWxlKCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0XHQvKmdzLmluZm8oXCJNb2R1bGUuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmNvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLmNvZGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLm5hbWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmoucmVtYXJrKSkpO1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmoucmVtYXJrKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5wbGF0Zm9ybSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMucGxhdGZvcm0obmV3IHBsYXRmb3JtbWFuYWdlcl9QbGF0Zm9ybSgpLl9mcm9tRG9jdW1lbnQob2JqLnBsYXRmb3JtKSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubW9kdWxlX0NhcGFiaWxpdHlzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMubW9kdWxlX0NhcGFiaWxpdHlzKG5ldyBwbGF0Zm9ybW1hbmFnZXJfQ2FwYWJpbGl0eSgpLl9mcm9tRG9jdW1lbnQob2JqLm1vZHVsZV9DYXBhYmlsaXR5cykpO1xuXG5cdFx0XHRcdH0gZWxzZSB7IC8vIGlmKG9iai5jb25zdHJ1Y3Rvci5uYW1lPT1cIk1vZHVsZVwiKXtcblx0XHRcdFx0XHRncy5pbmZvKFwiTW9kdWxlLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IGNvbnN0cnVjdG9yOiBcIiArIG9iai5jb25zdHJ1Y3Rvci5uYW1lKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Z3MuaW5mbyhcIk1vZHVsZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0Z3MuaW5mbyhcIk1vZHVsZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0XHR9XG5cblx0XHQvKmdzLmluZm8oXCJNb2R1bGUuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJJZCBcIisgXCJ0aGlzLklkOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuSWQsIG51bGwsIDQpKTsqL1xuXHRcdC8qZ3MuaW5mbyhcIk1vZHVsZS5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfbmV3KGMpIHtcblx0XHRpZiAoIWMpIGMgPSB0aGlzLl9fdHlwZTtcblx0XHRpZiAoYy5pbmRleE9mKCdwbGF0Zm9ybW1hbmFnZXJfJykgIT0gMCkgYyA9ICh7XG5cdFx0XHRQbGF0Zm9ybTogXCJwbGF0Zm9ybW1hbmFnZXJfUGxhdGZvcm1cIixcblx0XHRcdFVzZXI6IFwicGxhdGZvcm1tYW5hZ2VyX1VzZXJcIixcblx0XHRcdFJlcXVpcmVtZW50OiBcInBsYXRmb3JtbWFuYWdlcl9SZXF1aXJlbWVudFwiLFxuXHRcdFx0RWZmb3J0X0VzdGltYXRlOiBcInBsYXRmb3JtbWFuYWdlcl9FZmZvcnRfRXN0aW1hdGVcIixcblx0XHRcdEVmZm9ydDogXCJwbGF0Zm9ybW1hbmFnZXJfRWZmb3J0XCIsXG5cdFx0XHRCdWRnZXQ6IFwicGxhdGZvcm1tYW5hZ2VyX0J1ZGdldFwiLFxuXHRcdFx0QWdlbmRhX0l0ZW06IFwicGxhdGZvcm1tYW5hZ2VyX0FnZW5kYV9JdGVtXCIsXG5cdFx0XHRNZWV0aW5nX0FnZW5kYTogXCJwbGF0Zm9ybW1hbmFnZXJfTWVldGluZ19BZ2VuZGFcIixcblx0XHRcdERlY2lzaW9uX09wdGlvbjogXCJwbGF0Zm9ybW1hbmFnZXJfRGVjaXNpb25fT3B0aW9uXCIsXG5cdFx0XHREZWNpc2lvbjogXCJwbGF0Zm9ybW1hbmFnZXJfRGVjaXNpb25cIixcblx0XHRcdE1lZXRpbmdfTWludXRlOiBcInBsYXRmb3JtbWFuYWdlcl9NZWV0aW5nX01pbnV0ZVwiLFxuXHRcdFx0TWVldGluZ19TZXJpZXM6IFwicGxhdGZvcm1tYW5hZ2VyX01lZXRpbmdfU2VyaWVzXCIsXG5cdFx0XHRNZWV0aW5nOiBcInBsYXRmb3JtbWFuYWdlcl9NZWV0aW5nXCIsXG5cdFx0XHRCb2FyZDogXCJwbGF0Zm9ybW1hbmFnZXJfQm9hcmRcIixcblx0XHRcdEJvYXJkX01lbWJlcjogXCJwbGF0Zm9ybW1hbmFnZXJfQm9hcmRfTWVtYmVyXCIsXG5cdFx0XHRGcmVxdWVuY3k6IFwicGxhdGZvcm1tYW5hZ2VyX0ZyZXF1ZW5jeVwiLFxuXHRcdFx0TW9kdWxlOiBcInBsYXRmb3JtbWFuYWdlcl9Nb2R1bGVcIixcblx0XHRcdENhcGFiaWxpdHk6IFwicGxhdGZvcm1tYW5hZ2VyX0NhcGFiaWxpdHlcIixcblx0XHRcdFRlYW06IFwicGxhdGZvcm1tYW5hZ2VyX1RlYW1cIixcblx0XHRcdFByb2plY3Q6IFwicGxhdGZvcm1tYW5hZ2VyX1Byb2plY3RcIixcblx0XHRcdFRlYW1fTWVtYmVyOiBcInBsYXRmb3JtbWFuYWdlcl9UZWFtX01lbWJlclwiLFxuXHRcdFx0Um9sZTogXCJwbGF0Zm9ybW1hbmFnZXJfUm9sZVwiLFxuXHRcdH0pW2NdO1xuXHRcdHJldHVybiBuZXcoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gZ2xvYmFsIDogeF83ODYxMV9wbGF0Zm9ybV8wKVtjXSgpO1xuXHR9XG5cblx0X3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5jb2RlID0gdGhpcy5jb2RlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9wbGF0Zm9ybSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQucGxhdGZvcm0gPSB0aGlzLnBsYXRmb3JtKCk7XG5cblx0XHRcdGlmIChyZXQucGxhdGZvcm0pIHtcblx0XHRcdFx0cmV0LnBsYXRmb3JtID0gcmV0LnBsYXRmb3JtLl90b0RvY3VtZW50KCk7XG5cdFx0XHRcdGlmICh0eXBlb2YocmV0LnBsYXRmb3JtKSA9PT0gJ29iamVjdCcgJiYgIU9iamVjdC5rZXlzKHJldC5wbGF0Zm9ybSkubGVuZ3RoKSByZXQucGxhdGZvcm0gPSBudWxsO1xuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLm1vZHVsZV9DYXBhYmlsaXR5cygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5tb2R1bGVfQ2FwYWJpbGl0eXMgPSB0aGlzLm1vZHVsZV9DYXBhYmlsaXR5cygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHRcdH0pO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0ZGVsZXRlIHJldFtrXTtcblx0XHR9KTtcblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfdW5pcXVlKGtleXMsIHJldCkge1xuXHRcdHJldCA9IHJldCB8fCBuZXcgcGxhdGZvcm1tYW5hZ2VyX01vZHVsZSgpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRcdGlmICgha2V5cykge1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3RpdmVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3RpdmUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aXZlKHRoaXMuYWN0aXZlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJjb2RlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm9yZGVyXCIpID49IDAgJiYgdHlwZW9mKHRoaXMub3JkZXIoKSkgIT09ICd1bmRlZmluZWQnKSByZXQub3JkZXIodGhpcy5vcmRlcigpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImRhdGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYXRlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhdGUodGhpcy5kYXRlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwibmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJyZW1hcmtcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZW1hcmsoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVtYXJrKHRoaXMucmVtYXJrKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicGxhdGZvcm1cIikgPj0gMCAmJiB0eXBlb2YodGhpcy5wbGF0Zm9ybSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5wbGF0Zm9ybSh0aGlzLnBsYXRmb3JtKCkuX3VuaXF1ZSgpKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfcXVlcnkoZ3EpIHtcblx0XHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4Xzc4NjExX3BsYXRmb3JtXzBfbW9kdWxlJywgWycqJ10pWyd4Xzc4NjExX3BsYXRmb3JtXzBfbW9kdWxlJ10pO1xuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRKSB0aGlzLl9xdWVyeUdRID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KCd4Xzc4NjExX3BsYXRmb3JtXzBfbW9kdWxlJyk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKHRoaXMpKTtcblx0XHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0XHQvKiBncy5pbmZvKFwiTW9kdWxlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdFx0LyogZ3MuaW5mbyhcIk1vZHVsZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2VuYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZW5hYmxlZCcsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fY29kZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9jb2RlX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5jb2RlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdjb2RlJykgPj0gMCkge1xuXHRcdFx0XHQvKiBncy5pbmZvKFwiTW9kdWxlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdjb2RlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHRcdC8qIGdzLmluZm8oXCJNb2R1bGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2RhdGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qIGdzLmluZm8oXCJNb2R1bGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYXRlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2RhdGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX25hbWVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fbmFtZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMubmFtZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbmFtZScpID49IDApIHtcblx0XHRcdFx0LyogZ3MuaW5mbyhcIk1vZHVsZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3JlbWFyaycpID49IDApIHtcblx0XHRcdFx0LyogZ3MuaW5mbyhcIk1vZHVsZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3JlbWFyaycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9wbGF0Zm9ybSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3BsYXRmb3JtX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucGxhdGZvcm0oKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IHYuZmluZEFsbCgpO1xuXHRcdFx0XHRpZiAodi5sZW5ndGggPT0gMSkge1xuXHRcdFx0XHRcdC8qaWYoXCJNb2R1bGVcIj09XCJDb2x1bW5cIikgZ3MuaW5mbyhcIk1vZHVsZS5fcXVlcnkoKTogXCIrIFwicGxhdGZvcm0gXCIrIFwidlswXS5fdG9Eb2N1bWVudCgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHZbMF0uX3RvRG9jdW1lbnQoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRcdHYgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKHZbMF0sICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodlswXSkpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXYubGVuZ3RoKSB7XG5cdFx0XHRcdFx0diA9IG51bGw7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29vcCA9ICdJTic7XG5cdFx0XHRcdFx0diA9IHYubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdHJldHVybiAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0XHR9KShyLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHRcdH0pKHIpKSkpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHYgPSAtMTtcblx0XHRcdFx0Z3MuaW5mbyhcIk1vZHVsZS5fcXVlcnkoKTogXCIgKyBcInBsYXRmb3JtW3BsYXRmb3JtXSByZXN1bGVkIGluIHVuZGVmaW5lZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLnBsYXRmb3JtKCkpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3BsYXRmb3JtJykgPj0gMCkge1xuXHRcdFx0XHQvKiBncy5pbmZvKFwiTW9kdWxlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncGxhdGZvcm0nKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3BsYXRmb3JtJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3BsYXRmb3JtJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0XHQvKiBncy5pbmZvKFwiTW9kdWxlLl9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdHJldHVybiB0aGlzLl9xdWVyeUdRO1xuXHR9XG5cblx0X3NhdmUob2JqKSB7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0cmV0dXJuIG5ldyBwbGF0Zm9ybW1hbmFnZXJfTW9kdWxlKCkuX3NhdmUobylcblx0XHR9KTtcblxuXHRcdGxldCBfb2JqID0ge307XG5cblx0XHQvKmdzLmluZm8oXCJNb2R1bGUuX3NhdmUoKTogXCIrIFwiLi4uIFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfNzg2MTFfcGxhdGZvcm1fMF9tb2R1bGUnLCBbJyonXSlbJ3hfNzg2MTFfcGxhdGZvcm1fMF9tb2R1bGUnXSkuZmlsdGVyKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiB0cnVlIHx8IFsnc3lzX3VwZGF0ZWRfb24nLCAnc3lzX2NyZWF0ZWRfb24nLCAndXBkYXRlcycsICdzeXNfY3JlYXRlZF9ieScsICdzeXNfdXBkYXRlZF9ieSddLmluZGV4T2YoX2spIDwgMFxuXHRcdFx0fSkuaW5kZXhPZihrLnRvTG93ZXJDYXNlKCkpID49IDBcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdF9vYmpbay50b0xvd2VyQ2FzZSgpXSA9IG9ialtrXVxuXHRcdH0pO1xuXG5cdFx0T2JqZWN0LmtleXMoX29iaikuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKF9vYmpba10pID09PSBcIltvYmplY3QgRGF0ZV1cIiAmJiBpc05hTihfb2JqW2tdKSkge1xuXHRcdFx0XHRncy5pbmZvKFwiTW9kdWxlLl9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHRcdGdzLmluZm8oXCJNb2R1bGUuX3NhdmUoKTogXCIgKyBcInN5c19pZCB0byBzdHJpbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRsZXQgX3RoaXMgPSBudWxsO1xuXHRcdGlmIChvYmouX19rZXlzKSB7XG5cdFx0XHRsZXQga09iaiA9IHt9O1xuXHRcdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShfb2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKSkpO1xuXHRcdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHRcdH0pO1xuXHRcdFx0X3RoaXMgPSBuZXcgcGxhdGZvcm1tYW5hZ2VyX01vZHVsZSgpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF90aGlzID0gbmV3IHBsYXRmb3JtbWFuYWdlcl9Nb2R1bGUoKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0XHR9XG5cblx0XHQvKmdzLmluZm8oXCJNb2R1bGUuX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRcdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0XHRkZWxldGUgX29iai5fX2lkRmllbGQ7XG5cblx0XHR0cnkge1xuXHRcdFx0Z3MuaW5mbyhcIk1vZHVsZS5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdGdzLmluZm8oXCJNb2R1bGUuX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSk7XG5cblx0XHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICd4Xzc4NjExX3BsYXRmb3JtXzBfbW9kdWxlJyk7XG5cdFx0XHQvKmdzLmluZm8oXCJNb2R1bGUuX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdFx0fVxuXHRcdFx0bGV0IF9mT2JqID0ge307XG5cdFx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKSkpO1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF83ODYxMV9wbGF0Zm9ybV8wX21vZHVsZScsIFsnKiddKVsneF83ODYxMV9wbGF0Zm9ybV8wX21vZHVsZSddKSkpKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0Z3MuaW5mbyhcIk1vZHVsZS5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdFx0Z3MuaW5mbyhcIk1vZHVsZS5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH1cblxuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5tb2R1bGVfQ2FwYWJpbGl0eXMpKSB0aGlzLm1vZHVsZV9DYXBhYmlsaXR5cyhvYmoubW9kdWxlX0NhcGFiaWxpdHlzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBwbGF0Zm9ybW1hbmFnZXJfQ2FwYWJpbGl0eSgpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogTW9kdWxlLnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RvcmUoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihsb2dPYmopIHtcblx0XHRcdGdzLmluZm8oXCJNb2R1bGUuc3RvcmUoKTogXCIgKyBcImxvZ09iajogXCIgKyBKU09OLnN0cmluZ2lmeShsb2dPYmosIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHRncy5pbmZvKFwiTW9kdWxlLnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Z3MuaW5mbyhcIk1vZHVsZS5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0Z3MuaW5mbyhcIk1vZHVsZS5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0XHRsZXQgX3RoaXMgPSB0aGlzLl91bmlxdWUoKS5maW5kKCk7XG5cdFx0XHRpZiAoX3RoaXMpIHRoaXMuSWQgPSBfdGhpcy5JZDtcblxuXHRcdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogTW9kdWxlLmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kQWxsKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obG9nT2JqKSB7XG5cdFx0XHRncy5pbmZvKFwiTW9kdWxlLmZpbmRBbGwoKTogXCIgKyBcImxvZ09iajogXCIgKyBKU09OLnN0cmluZ2lmeShsb2dPYmosIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHRncy5pbmZvKFwiTW9kdWxlLmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRncy5pbmZvKFwiTW9kdWxlLmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdGdzLmluZm8oXCJNb2R1bGUuZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZChcIk1vZHVsZVwiKTtcblx0XHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0XHQvL3JldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQodGhpcy5fcXVlcnkoKS5zZWxlY3QoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF83ODYxMV9wbGF0Zm9ybV8wX21vZHVsZScsIFsnKiddKVsneF83ODYxMV9wbGF0Zm9ybV8wX21vZHVsZSddKSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBNb2R1bGUuZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmQoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihsb2dPYmopIHtcblx0XHRcdGdzLmluZm8oXCJNb2R1bGUuZmluZCgpOiBcIiArIFwibG9nT2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KGxvZ09iaiwgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdGdzLmluZm8oXCJNb2R1bGUuZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGdzLmluZm8oXCJNb2R1bGUuZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0Z3MuaW5mbyhcIk1vZHVsZS5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic3lzX25hbWUiOiJwbGF0Zm9ybW1hbmFnZXJfUGxhdGZvcm0iLCJhcGlfbmFtZSI6InhfNzg2MTFfcGxhdGZvcm1fMC5wbGF0Zm9ybW1hbmFnZXJfUGxhdGZvcm0iLCJuYW1lIjoicGxhdGZvcm1tYW5hZ2VyX1BsYXRmb3JtIiwic2NyaXB0IjoiY2xhc3MgcGxhdGZvcm1tYW5hZ2VyX1BsYXRmb3JtIHtcblx0Y29uc3RydWN0b3IoaWQpIHtcblx0XHR1bmRlZmluZWRcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInBsYXRmb3JtbWFuYWdlcl9QbGF0Zm9ybVwiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwicGxhdGZvcm1tYW5hZ2VyXCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJwbGF0Zm9ybW1hbmFnZXJcIjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFBsYXRmb3JtLmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdGl2ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYWN0aXZlID0gdjtcblx0XHRcdHRoaXMuX2FjdGl2ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3RpdmU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUGxhdGZvcm0uZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVuYWJsZWQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2VuYWJsZWQgPSB2O1xuXHRcdFx0dGhpcy5fZW5hYmxlZF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lbmFibGVkO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFBsYXRmb3JtLmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBQbGF0Zm9ybS5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG9yZGVyKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9vcmRlciA9IHY7XG5cdFx0XHR0aGlzLl9vcmRlcl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9vcmRlcjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBQbGF0Zm9ybS5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGF0ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vZ3MuaW5mbyhcIlBsYXRmb3JtLmRhdGUoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9kYXRlID0gdjtcblx0XHRcdHRoaXMuX2RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGF0ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBQbGF0Zm9ybS5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUGxhdGZvcm0ucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBQbGF0Zm9ybS5wbGF0Zm9ybV9Nb2R1bGVzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cGxhdGZvcm1fTW9kdWxlcyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX3BsYXRmb3JtX01vZHVsZXMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9wbGF0Zm9ybV9Nb2R1bGVzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9wbGF0Zm9ybV9Nb2R1bGVzO1xuXHRcdH1cblx0fVxuXG5cdF90b0VRdWVyeShzUGF0aCkge1xuXHRcdHNQYXRoID0gc1BhdGggfHwgJyc7XG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCAnJztcblxuXHRcdGlmICh0aGlzLl9hY3RpdmUpIHJldCArPSAnXicgKyBzUGF0aCArICdhY3RpdmUnICsgKHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JykgKyB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuYWJsZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmFibGVkJyArICh0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2NvZGUpIHJldCArPSAnXicgKyBzUGF0aCArICdjb2RlJyArICh0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nKSArIHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX29yZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnb3JkZXInICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMub3JkZXIoKTtcblxuXHRcdGlmICh0aGlzLl9kYXRlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF0ZScgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh0aGlzLl9uYW1lKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbmFtZScgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdyZW1hcmsnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0KHRoaXMucGxhdGZvcm1fTW9kdWxlcygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZTW9kdWxlLnBsYXRmb3JtLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHRncy5pbmZvKFwiUGxhdGZvcm0uX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSByZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHRncy5pbmZvKFwiUGxhdGZvcm0uX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXG5cdFx0c3dpdGNoIChtZXRob2QpIHtcblxuXHRcdFx0Y2FzZSBcInN0b3JlXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuc3RvcmUoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRBbGxcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiaW5pdFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmluaXQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0Z3MuaW5mbyhcIlBsYXRmb3JtLl9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7IC8vIHRlc3RcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgcGxhdGZvcm1tYW5hZ2VyX1BsYXRmb3JtKCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0dHJ5IHtcblx0XHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0Lypncy5pbmZvKFwiUGxhdGZvcm0uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdFx0fTtcblx0XHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRcdFx0aWYgKG9iai5nZXRUYWJsZU5hbWUoKSA9PSAnZWNjX3F1ZXVlJyAmJiBcIlBsYXRmb3JtXCIgIT0gJ2VjY19xdWV1ZScgJiYgb2JqLnNvdXJjZSA9PSBcIlBsYXRmb3JtXCIpIHtcblx0XHRcdFx0XHRcdG9iai5zdGF0ZSA9IFwicHJvY2Vzc2luZ1wiO1xuXHRcdFx0XHRcdFx0b2JqLnVwZGF0ZSgpO1xuXG5cdFx0XHRcdFx0XHRsZXQgcmVzcCA9IG5ldyBHbGlkZVJlY29yZCgnZWNjX3F1ZXVlJyk7XG5cdFx0XHRcdFx0XHRyZXNwLnJlc3BvbnNlX3RvID0gb2JqLnN5c19pZDtcblx0XHRcdFx0XHRcdHJlc3AucXVldWUgPSAnb3V0cHV0Jztcblx0XHRcdFx0XHRcdHJlc3AuYWdlbnQgPSBvYmouYWdlbnQ7XG5cdFx0XHRcdFx0XHRyZXNwLnRvcGljID0gb2JqLnRvcGljO1xuXHRcdFx0XHRcdFx0cmVzcC5uYW1lID0gb2JqLm5hbWU7XG5cdFx0XHRcdFx0XHRyZXNwLnNvdXJjZSA9IG9iai5zb3VyY2U7XG5cdFx0XHRcdFx0XHRyZXNwLmZyb21faG9zdCA9IG9iai5hZ2VudF9jb3JyZWxhdG9yO1xuXHRcdFx0XHRcdFx0cmVzcC5hZ2VudF9jb3JyZWxhdG9yID0gb2JqLmZyb21faG9zdDtcblxuXHRcdFx0XHRcdFx0bGV0IHJldCA9IG5ldyBwbGF0Zm9ybW1hbmFnZXJfUGxhdGZvcm0oKS5fZnJvbURvY3VtZW50KCkuX2ludm9rZShvYmoubmFtZS50b1N0cmluZygpLCBvYmoucGF5bG9hZC50b1N0cmluZygpKTtcblx0XHRcdFx0XHRcdGlmIChBcnJheS5pc0FycmF5KHJldCkpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gcmV0Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIChyICYmIHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJykgPyByLl90b0RvY3VtZW50KCkgOiByO1xuXHRcdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAocmV0ICYmIHR5cGVvZihyZXQuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHJldC5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmVzcC5wYXlsb2FkID0gSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KTtcblxuXHRcdFx0XHRcdFx0cmVzcC5pbnNlcnQoKTtcblxuXHRcdFx0XHRcdFx0b2JqLnN0YXRlID0gXCJwcm9jZXNzZWRcIjtcblx0XHRcdFx0XHRcdG9iai51cGRhdGUoKTtcblx0XHRcdFx0XHRcdHJldHVybiByZXNwO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdFx0Y29kZTogb2JqLmdldFZhbHVlKFwiY29kZVwiKSxcblxuXHRcdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0XHRyZW1hcms6IG9iai5nZXRWYWx1ZShcInJlbWFya1wiKSxcblxuXHRcdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRvYmoucXVlcnkoKTtcblx0XHRcdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tRG9jdW1lbnQob2JqKSk7XG5cdFx0XHRcdFx0Lypncy5pbmZvKFwiUGxhdGZvcm0uX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJnbGlkZSBvYmplY3RzIFwiKyBcImdyUmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KGdyUmV0LCBudWxsLCA0KSk7Ki9cblx0XHRcdFx0XHRyZXR1cm4gZ3JSZXQ7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSBpZiAob2JqLl9mcm9tRG9jdW1lbnQpIHtcblx0XHRcdFx0Z3MuaW5mbyhcIlBsYXRmb3JtLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0XHRyZXR1cm4gb2JqO1xuXHRcdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRcdHJldHVybiBuZXcgcGxhdGZvcm1tYW5hZ2VyX1BsYXRmb3JtKCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0XHQvKmdzLmluZm8oXCJQbGF0Zm9ybS5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuY29kZShvYmouY29kZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubmFtZShvYmoubmFtZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsoU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5yZW1hcmspKSk7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5yZW1hcmspO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnBsYXRmb3JtX01vZHVsZXMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5wbGF0Zm9ybV9Nb2R1bGVzKG5ldyBwbGF0Zm9ybW1hbmFnZXJfTW9kdWxlKCkuX2Zyb21Eb2N1bWVudChvYmoucGxhdGZvcm1fTW9kdWxlcykpO1xuXG5cdFx0XHRcdH0gZWxzZSB7IC8vIGlmKG9iai5jb25zdHJ1Y3Rvci5uYW1lPT1cIlBsYXRmb3JtXCIpe1xuXHRcdFx0XHRcdGdzLmluZm8oXCJQbGF0Zm9ybS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGdzLmluZm8oXCJQbGF0Zm9ybS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0Z3MuaW5mbyhcIlBsYXRmb3JtLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHRcdH1cblxuXHRcdC8qZ3MuaW5mbyhcIlBsYXRmb3JtLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0XHQvKmdzLmluZm8oXCJQbGF0Zm9ybS5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfbmV3KGMpIHtcblx0XHRpZiAoIWMpIGMgPSB0aGlzLl9fdHlwZTtcblx0XHRpZiAoYy5pbmRleE9mKCdwbGF0Zm9ybW1hbmFnZXJfJykgIT0gMCkgYyA9ICh7XG5cdFx0XHRQbGF0Zm9ybTogXCJwbGF0Zm9ybW1hbmFnZXJfUGxhdGZvcm1cIixcblx0XHRcdFVzZXI6IFwicGxhdGZvcm1tYW5hZ2VyX1VzZXJcIixcblx0XHRcdFJlcXVpcmVtZW50OiBcInBsYXRmb3JtbWFuYWdlcl9SZXF1aXJlbWVudFwiLFxuXHRcdFx0RWZmb3J0X0VzdGltYXRlOiBcInBsYXRmb3JtbWFuYWdlcl9FZmZvcnRfRXN0aW1hdGVcIixcblx0XHRcdEVmZm9ydDogXCJwbGF0Zm9ybW1hbmFnZXJfRWZmb3J0XCIsXG5cdFx0XHRCdWRnZXQ6IFwicGxhdGZvcm1tYW5hZ2VyX0J1ZGdldFwiLFxuXHRcdFx0QWdlbmRhX0l0ZW06IFwicGxhdGZvcm1tYW5hZ2VyX0FnZW5kYV9JdGVtXCIsXG5cdFx0XHRNZWV0aW5nX0FnZW5kYTogXCJwbGF0Zm9ybW1hbmFnZXJfTWVldGluZ19BZ2VuZGFcIixcblx0XHRcdERlY2lzaW9uX09wdGlvbjogXCJwbGF0Zm9ybW1hbmFnZXJfRGVjaXNpb25fT3B0aW9uXCIsXG5cdFx0XHREZWNpc2lvbjogXCJwbGF0Zm9ybW1hbmFnZXJfRGVjaXNpb25cIixcblx0XHRcdE1lZXRpbmdfTWludXRlOiBcInBsYXRmb3JtbWFuYWdlcl9NZWV0aW5nX01pbnV0ZVwiLFxuXHRcdFx0TWVldGluZ19TZXJpZXM6IFwicGxhdGZvcm1tYW5hZ2VyX01lZXRpbmdfU2VyaWVzXCIsXG5cdFx0XHRNZWV0aW5nOiBcInBsYXRmb3JtbWFuYWdlcl9NZWV0aW5nXCIsXG5cdFx0XHRCb2FyZDogXCJwbGF0Zm9ybW1hbmFnZXJfQm9hcmRcIixcblx0XHRcdEJvYXJkX01lbWJlcjogXCJwbGF0Zm9ybW1hbmFnZXJfQm9hcmRfTWVtYmVyXCIsXG5cdFx0XHRGcmVxdWVuY3k6IFwicGxhdGZvcm1tYW5hZ2VyX0ZyZXF1ZW5jeVwiLFxuXHRcdFx0TW9kdWxlOiBcInBsYXRmb3JtbWFuYWdlcl9Nb2R1bGVcIixcblx0XHRcdENhcGFiaWxpdHk6IFwicGxhdGZvcm1tYW5hZ2VyX0NhcGFiaWxpdHlcIixcblx0XHRcdFRlYW06IFwicGxhdGZvcm1tYW5hZ2VyX1RlYW1cIixcblx0XHRcdFByb2plY3Q6IFwicGxhdGZvcm1tYW5hZ2VyX1Byb2plY3RcIixcblx0XHRcdFRlYW1fTWVtYmVyOiBcInBsYXRmb3JtbWFuYWdlcl9UZWFtX01lbWJlclwiLFxuXHRcdFx0Um9sZTogXCJwbGF0Zm9ybW1hbmFnZXJfUm9sZVwiLFxuXHRcdH0pW2NdO1xuXHRcdHJldHVybiBuZXcoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gZ2xvYmFsIDogeF83ODYxMV9wbGF0Zm9ybV8wKVtjXSgpO1xuXHR9XG5cblx0X3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5jb2RlID0gdGhpcy5jb2RlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLnBsYXRmb3JtX01vZHVsZXMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucGxhdGZvcm1fTW9kdWxlcyA9IHRoaXMucGxhdGZvcm1fTW9kdWxlcygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAoQXJyYXkuaXNBcnJheShhckZpZWxkcykpIE9iamVjdC5rZXlzKHJldCkuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiAhYXJGaWVsZHMuZmluZChmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gX2sgPT0gaztcblx0XHRcdH0pO1xuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0ZGVsZXRlIHJldFtrXTtcblx0XHR9KTtcblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfdW5pcXVlKGtleXMsIHJldCkge1xuXHRcdHJldCA9IHJldCB8fCBuZXcgcGxhdGZvcm1tYW5hZ2VyX1BsYXRmb3JtKCk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdC8vIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7XG5cdFx0aWYgKCFrZXlzKSB7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImNvZGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJuYW1lXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubmFtZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInJlbWFya1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3F1ZXJ5KGdxKSB7XG5cdFx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF83ODYxMV9wbGF0Zm9ybV8wX3BsYXRmb3JtJywgWycqJ10pWyd4Xzc4NjExX3BsYXRmb3JtXzBfcGxhdGZvcm0nXSk7XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EpIHRoaXMuX3F1ZXJ5R1EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkoJ3hfNzg2MTFfcGxhdGZvcm1fMF9wbGF0Zm9ybScpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KSh0aGlzKSk7XG5cdFx0aWYgKGlkZiA9PSAnSWQnKSBpZGYgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3RpdmVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdFx0LyogZ3MuaW5mbyhcIlBsYXRmb3JtLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdFx0LyogZ3MuaW5mbyhcIlBsYXRmb3JtLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmFibGVkJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX2NvZGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmNvZGUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2NvZGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qIGdzLmluZm8oXCJQbGF0Zm9ybS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnY29kZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZGVyJykgPj0gMCkge1xuXHRcdFx0XHQvKiBncy5pbmZvKFwiUGxhdGZvcm0uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2RhdGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qIGdzLmluZm8oXCJQbGF0Zm9ybS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2RhdGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZGF0ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fbmFtZV9jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9uYW1lX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5uYW1lKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCduYW1lJykgPj0gMCkge1xuXHRcdFx0XHQvKiBncy5pbmZvKFwiUGxhdGZvcm0uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ25hbWUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX3JlbWFya19jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZW1hcmsnKSA+PSAwKSB7XG5cdFx0XHRcdC8qIGdzLmluZm8oXCJQbGF0Zm9ybS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3JlbWFyaycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdFx0LyogZ3MuaW5mbyhcIlBsYXRmb3JtLl9xdWVyeSgpOiBcIisgXCJ0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLl9xdWVyeUdRLnRvR2xpZGVSZWNvcmQoKS5nZXRFbmNvZGVkUXVlcnkoKSwgbnVsbCwgNCkpOyAqL1xuXHRcdHJldHVybiB0aGlzLl9xdWVyeUdRO1xuXHR9XG5cblx0X3NhdmUob2JqKSB7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqKSkgcmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0cmV0dXJuIG5ldyBwbGF0Zm9ybW1hbmFnZXJfUGxhdGZvcm0oKS5fc2F2ZShvKVxuXHRcdH0pO1xuXG5cdFx0bGV0IF9vYmogPSB7fTtcblxuXHRcdC8qZ3MuaW5mbyhcIlBsYXRmb3JtLl9zYXZlKCk6IFwiKyBcIi4uLiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4Xzc4NjExX3BsYXRmb3JtXzBfcGxhdGZvcm0nLCBbJyonXSlbJ3hfNzg2MTFfcGxhdGZvcm1fMF9wbGF0Zm9ybSddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdFx0fSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHRcdGdzLmluZm8oXCJQbGF0Zm9ybS5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0XHRncy5pbmZvKFwiUGxhdGZvcm0uX3NhdmUoKTogXCIgKyBcInN5c19pZCB0byBzdHJpbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRfb2JqW2tdID0gX29ialtrXS5zeXNfaWQ7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRsZXQgX3RoaXMgPSBudWxsO1xuXHRcdGlmIChvYmouX19rZXlzKSB7XG5cdFx0XHRsZXQga09iaiA9IHt9O1xuXHRcdFx0a09ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShfb2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKF9vYmopKSkpO1xuXHRcdFx0b2JqLl9fa2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0a09ialtrXSA9IF9vYmpba11cblx0XHRcdH0pO1xuXHRcdFx0X3RoaXMgPSBuZXcgcGxhdGZvcm1tYW5hZ2VyX1BsYXRmb3JtKCkuX2Zyb21Eb2N1bWVudChrT2JqKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0X3RoaXMgPSBuZXcgcGxhdGZvcm1tYW5hZ2VyX1BsYXRmb3JtKCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdFx0fVxuXG5cdFx0Lypncy5pbmZvKFwiUGxhdGZvcm0uX3NhdmUoKTogXCIgKyBcIl90aGlzLklkPVwiICsgX3RoaXMuSWQgKyBcIiwgX3RoaXMuZmluZCgpLklkOiBcIiArIF90aGlzLmZpbmQoKS5JZCk7Ki9cblxuXHRcdF9vYmouc3lzX2lkID0gKF90aGlzLmZpbmQoKSB8fCB0aGlzIHx8IHt9KS5JZCB8fCBfb2JqLnN5c19pZDtcblx0XHRkZWxldGUgX29iai5fX2lkRmllbGQ7XG5cblx0XHR0cnkge1xuXHRcdFx0Z3MuaW5mbyhcIlBsYXRmb3JtLl9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0Z3MuaW5mbyhcIlBsYXRmb3JtLl9zYXZlKCk6IFwiICsgXCJyZW5hbWluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0pO1xuXG5cdFx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAneF83ODYxMV9wbGF0Zm9ybV8wX3BsYXRmb3JtJyk7XG5cdFx0XHQvKmdzLmluZm8oXCJQbGF0Zm9ybS5fc2F2ZSgpOiBcIisgXCJ1cHNlcnRpbmcuLi4gXCIrIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7Ki9cblx0XHRcdGlmIChfb2JqLnN5c19pZCkge1xuXHRcdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X29iai5zeXNfaWQgPSBncy5nZW5lcmF0ZUdVSUQoKTtcblx0XHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0XHR9XG5cdFx0XHRsZXQgX2ZPYmogPSB7fTtcblx0XHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpKSk7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4Xzc4NjExX3BsYXRmb3JtXzBfcGxhdGZvcm0nLCBbJyonXSlbJ3hfNzg2MTFfcGxhdGZvcm1fMF9wbGF0Zm9ybSddKSkpKTtcblx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0Z3MuaW5mbyhcIlBsYXRmb3JtLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0XHRncy5pbmZvKFwiUGxhdGZvcm0uX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmoucGxhdGZvcm1fTW9kdWxlcykpIHRoaXMucGxhdGZvcm1fTW9kdWxlcyhvYmoucGxhdGZvcm1fTW9kdWxlcy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgcGxhdGZvcm1tYW5hZ2VyX01vZHVsZSgpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogUGxhdGZvcm0uc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzdG9yZShfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKGxvZ09iaikge1xuXHRcdFx0Z3MuaW5mbyhcIlBsYXRmb3JtLnN0b3JlKCk6IFwiICsgXCJsb2dPYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkobG9nT2JqLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0Z3MuaW5mbyhcIlBsYXRmb3JtLnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Z3MuaW5mbyhcIlBsYXRmb3JtLnN0b3JlKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHRncy5pbmZvKFwiUGxhdGZvcm0uc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdFx0bGV0IF90aGlzID0gdGhpcy5fdW5pcXVlKCkuZmluZCgpO1xuXHRcdFx0aWYgKF90aGlzKSB0aGlzLklkID0gX3RoaXMuSWQ7XG5cblx0XHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFBsYXRmb3JtLmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kQWxsKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obG9nT2JqKSB7XG5cdFx0XHRncy5pbmZvKFwiUGxhdGZvcm0uZmluZEFsbCgpOiBcIiArIFwibG9nT2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KGxvZ09iaiwgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdGdzLmluZm8oXCJQbGF0Zm9ybS5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Z3MuaW5mbyhcIlBsYXRmb3JtLmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdGdzLmluZm8oXCJQbGF0Zm9ybS5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIGZpbmRBbGwgbG9jYWxseVxuXHRcdFx0bGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKFwiUGxhdGZvcm1cIik7XG5cdFx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfNzg2MTFfcGxhdGZvcm1fMF9wbGF0Zm9ybScsIFsnKiddKVsneF83ODYxMV9wbGF0Zm9ybV8wX3BsYXRmb3JtJ10pKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFBsYXRmb3JtLmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obG9nT2JqKSB7XG5cdFx0XHRncy5pbmZvKFwiUGxhdGZvcm0uZmluZCgpOiBcIiArIFwibG9nT2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KGxvZ09iaiwgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdGdzLmluZm8oXCJQbGF0Zm9ybS5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Z3MuaW5mbyhcIlBsYXRmb3JtLmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdGdzLmluZm8oXCJQbGF0Zm9ybS5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogUGxhdGZvcm0uaW5pdCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGluaXQoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihsb2dPYmopIHtcblx0XHRcdGdzLmluZm8oXCJQbGF0Zm9ybS5pbml0KCk6IFwiICsgXCJsb2dPYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkobG9nT2JqLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0Z3MuaW5mbyhcIlBsYXRmb3JtLmluaXQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRncy5pbmZvKFwiUGxhdGZvcm0uaW5pdCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSBldkpTT047XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0Z3MuaW5mbyhcIlBsYXRmb3JtLmluaXQoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHN0cihhbnN3ZXIpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic3lzX25hbWUiOiJwbGF0Zm9ybW1hbmFnZXJfVXNlciIsImFwaV9uYW1lIjoieF83ODYxMV9wbGF0Zm9ybV8wLnBsYXRmb3JtbWFuYWdlcl9Vc2VyIiwibmFtZSI6InBsYXRmb3JtbWFuYWdlcl9Vc2VyIiwic2NyaXB0IjoiY2xhc3MgcGxhdGZvcm1tYW5hZ2VyX1VzZXIge1xuXHRjb25zdHJ1Y3RvcihpZCkge1xuXHRcdHVuZGVmaW5lZFxuXHRcdHRoaXMuSWQgPSBpZDtcblx0XHR0aGlzLl9fbW9kdWxlID0gXCJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwicGxhdGZvcm1tYW5hZ2VyX1VzZXJcIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInBsYXRmb3JtbWFuYWdlclwiO1xuXHRcdHRoaXMuX19zY29wZSA9IFwicGxhdGZvcm1tYW5hZ2VyXCI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBVc2VyLmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdGl2ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYWN0aXZlID0gdjtcblx0XHRcdHRoaXMuX2FjdGl2ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3RpdmU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVXNlci5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVXNlci5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29kZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29kZSA9IHY7XG5cdFx0XHR0aGlzLl9jb2RlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvZGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVXNlci5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG9yZGVyKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9vcmRlciA9IHY7XG5cdFx0XHR0aGlzLl9vcmRlcl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9vcmRlcjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBVc2VyLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly9ncy5pbmZvKFwiVXNlci5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVXNlci5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVXNlci5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFVzZXIub3JnYW5pemVyX01lZXRpbmdzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JnYW5pemVyX01lZXRpbmdzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fb3JnYW5pemVyX01lZXRpbmdzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fb3JnYW5pemVyX01lZXRpbmdzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9vcmdhbml6ZXJfTWVldGluZ3M7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVXNlci5tb2RlcmF0b3JfTWVldGluZ3MgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRtb2RlcmF0b3JfTWVldGluZ3ModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9tb2RlcmF0b3JfTWVldGluZ3MgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9tb2RlcmF0b3JfTWVldGluZ3NfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX21vZGVyYXRvcl9NZWV0aW5ncztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBVc2VyLm1lbWJlcl9Cb2FyZF9NZW1iZXJzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bWVtYmVyX0JvYXJkX01lbWJlcnModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9tZW1iZXJfQm9hcmRfTWVtYmVycyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX21lbWJlcl9Cb2FyZF9NZW1iZXJzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9tZW1iZXJfQm9hcmRfTWVtYmVycztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBVc2VyLm1lbWJlcl9UZWFtX01lbWJlcnMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRtZW1iZXJfVGVhbV9NZW1iZXJzKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fbWVtYmVyX1RlYW1fTWVtYmVycyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX21lbWJlcl9UZWFtX01lbWJlcnNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX21lbWJlcl9UZWFtX01lbWJlcnM7XG5cdFx0fVxuXHR9XG5cblx0X3RvRVF1ZXJ5KHNQYXRoKSB7XG5cdFx0c1BhdGggPSBzUGF0aCB8fCAnJztcblx0XHRsZXQgcmV0ID0gdW5kZWZpbmVkIHx8ICcnO1xuXG5cdFx0aWYgKHRoaXMuX2FjdGl2ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2FjdGl2ZScgKyAodGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nKSArIHRoaXMuYWN0aXZlKCk7XG5cblx0XHRpZiAodGhpcy5fZW5hYmxlZCkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2VuYWJsZWQnICsgKHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPScpICsgdGhpcy5lbmFibGVkKCk7XG5cblx0XHRpZiAodGhpcy5fY29kZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3VzZXJfbmFtZScgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ25hbWUnICsgKHRoaXMuX25hbWVfY29vcCB8fCAnPScpICsgdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAodGhpcy5fcmVtYXJrKSByZXQgKz0gJ14nICsgc1BhdGggKyAncmVtYXJrJyArICh0aGlzLl9yZW1hcmtfY29vcCB8fCAnPScpICsgdGhpcy5yZW1hcmsoKTtcblxuXHRcdCh0aGlzLm9yZ2FuaXplcl9NZWV0aW5ncygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZTWVldGluZy5vcmdhbml6ZXIsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLm1vZGVyYXRvcl9NZWV0aW5ncygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZTWVldGluZy5tb2RlcmF0b3IsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLm1lbWJlcl9Cb2FyZF9NZW1iZXJzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllCb2FyZF9NZW1iZXIubWVtYmVyLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy5tZW1iZXJfVGVhbV9NZW1iZXJzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllUZWFtX01lbWJlci5tZW1iZXIsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdGdzLmluZm8oXCJVc2VyLl90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykgcmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0Z3MuaW5mbyhcIlVzZXIuX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXG5cdFx0c3dpdGNoIChtZXRob2QpIHtcblxuXHRcdFx0Y2FzZSBcInN0b3JlXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuc3RvcmUoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRBbGxcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHRncy5pbmZvKFwiVXNlci5faW52b2tlKCk6IFwiICsgXCJpbnZhbGlkIG1ldGhvZCBcIiArIG1ldGhvZCk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzOyAvLyB0ZXN0XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHBsYXRmb3JtbWFuYWdlcl9Vc2VyKCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0dHJ5IHtcblx0XHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0Lypncy5pbmZvKFwiVXNlci5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0XHR9O1xuXHRcdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdFx0b2JqID0gX29iajtcblx0XHRcdH1cblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdFx0XHRpZiAob2JqLmdldFRhYmxlTmFtZSgpID09ICdlY2NfcXVldWUnICYmIFwic3lzX3VzZXJcIiAhPSAnZWNjX3F1ZXVlJyAmJiBvYmouc291cmNlID09IFwiVXNlclwiKSB7XG5cdFx0XHRcdFx0XHRvYmouc3RhdGUgPSBcInByb2Nlc3NpbmdcIjtcblx0XHRcdFx0XHRcdG9iai51cGRhdGUoKTtcblxuXHRcdFx0XHRcdFx0bGV0IHJlc3AgPSBuZXcgR2xpZGVSZWNvcmQoJ2VjY19xdWV1ZScpO1xuXHRcdFx0XHRcdFx0cmVzcC5yZXNwb25zZV90byA9IG9iai5zeXNfaWQ7XG5cdFx0XHRcdFx0XHRyZXNwLnF1ZXVlID0gJ291dHB1dCc7XG5cdFx0XHRcdFx0XHRyZXNwLmFnZW50ID0gb2JqLmFnZW50O1xuXHRcdFx0XHRcdFx0cmVzcC50b3BpYyA9IG9iai50b3BpYztcblx0XHRcdFx0XHRcdHJlc3AubmFtZSA9IG9iai5uYW1lO1xuXHRcdFx0XHRcdFx0cmVzcC5zb3VyY2UgPSBvYmouc291cmNlO1xuXHRcdFx0XHRcdFx0cmVzcC5mcm9tX2hvc3QgPSBvYmouYWdlbnRfY29ycmVsYXRvcjtcblx0XHRcdFx0XHRcdHJlc3AuYWdlbnRfY29ycmVsYXRvciA9IG9iai5mcm9tX2hvc3Q7XG5cblx0XHRcdFx0XHRcdGxldCByZXQgPSBuZXcgcGxhdGZvcm1tYW5hZ2VyX1VzZXIoKS5fZnJvbURvY3VtZW50KCkuX2ludm9rZShvYmoubmFtZS50b1N0cmluZygpLCBvYmoucGF5bG9hZC50b1N0cmluZygpKTtcblx0XHRcdFx0XHRcdGlmIChBcnJheS5pc0FycmF5KHJldCkpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gcmV0Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIChyICYmIHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJykgPyByLl90b0RvY3VtZW50KCkgOiByO1xuXHRcdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAocmV0ICYmIHR5cGVvZihyZXQuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHJldC5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmVzcC5wYXlsb2FkID0gSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KTtcblxuXHRcdFx0XHRcdFx0cmVzcC5pbnNlcnQoKTtcblxuXHRcdFx0XHRcdFx0b2JqLnN0YXRlID0gXCJwcm9jZXNzZWRcIjtcblx0XHRcdFx0XHRcdG9iai51cGRhdGUoKTtcblx0XHRcdFx0XHRcdHJldHVybiByZXNwO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdFx0dXNlcl9uYW1lOiBvYmouZ2V0VmFsdWUoXCJ1c2VyX25hbWVcIiksXG5cblx0XHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdFx0cmVtYXJrOiBvYmouZ2V0VmFsdWUoXCJyZW1hcmtcIiksXG5cblx0XHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbURvY3VtZW50KG9iaikpO1xuXHRcdFx0XHRcdC8qZ3MuaW5mbyhcIlVzZXIuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJnbGlkZSBvYmplY3RzIFwiKyBcImdyUmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KGdyUmV0LCBudWxsLCA0KSk7Ki9cblx0XHRcdFx0XHRyZXR1cm4gZ3JSZXQ7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSBpZiAob2JqLl9mcm9tRG9jdW1lbnQpIHtcblx0XHRcdFx0Z3MuaW5mbyhcIlVzZXIuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRcdHJldHVybiBvYmo7XG5cdFx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdFx0cmV0dXJuIG5ldyBwbGF0Zm9ybW1hbmFnZXJfVXNlcigpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdFx0Lypncy5pbmZvKFwiVXNlci5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoudXNlcl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5jb2RlKG9iai51c2VyX25hbWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLm5hbWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmoucmVtYXJrKSkpO1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmoucmVtYXJrKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmdhbml6ZXJfTWVldGluZ3MpICE9PSAndW5kZWZpbmVkJykgdGhpcy5vcmdhbml6ZXJfTWVldGluZ3MobmV3IHBsYXRmb3JtbWFuYWdlcl9NZWV0aW5nKCkuX2Zyb21Eb2N1bWVudChvYmoub3JnYW5pemVyX01lZXRpbmdzKSk7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5tb2RlcmF0b3JfTWVldGluZ3MpICE9PSAndW5kZWZpbmVkJykgdGhpcy5tb2RlcmF0b3JfTWVldGluZ3MobmV3IHBsYXRmb3JtbWFuYWdlcl9NZWV0aW5nKCkuX2Zyb21Eb2N1bWVudChvYmoubW9kZXJhdG9yX01lZXRpbmdzKSk7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5tZW1iZXJfQm9hcmRfTWVtYmVycykgIT09ICd1bmRlZmluZWQnKSB0aGlzLm1lbWJlcl9Cb2FyZF9NZW1iZXJzKG5ldyBwbGF0Zm9ybW1hbmFnZXJfQm9hcmRfTWVtYmVyKCkuX2Zyb21Eb2N1bWVudChvYmoubWVtYmVyX0JvYXJkX01lbWJlcnMpKTtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm1lbWJlcl9UZWFtX01lbWJlcnMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5tZW1iZXJfVGVhbV9NZW1iZXJzKG5ldyBwbGF0Zm9ybW1hbmFnZXJfVGVhbV9NZW1iZXIoKS5fZnJvbURvY3VtZW50KG9iai5tZW1iZXJfVGVhbV9NZW1iZXJzKSk7XG5cblx0XHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiVXNlclwiKXtcblx0XHRcdFx0XHRncy5pbmZvKFwiVXNlci5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGdzLmluZm8oXCJVc2VyLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IFwiICsgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHRncy5pbmZvKFwiVXNlci5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJpbnZhbGlkIG9iamVjdCBcIiArIFwidHlwZW9mKG9iaik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKG9iaiksIG51bGwsIDQpKTtcblx0XHR9XG5cblx0XHQvKmdzLmluZm8oXCJVc2VyLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0XHQvKmdzLmluZm8oXCJVc2VyLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7Ki9cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9uZXcoYykge1xuXHRcdGlmICghYykgYyA9IHRoaXMuX190eXBlO1xuXHRcdGlmIChjLmluZGV4T2YoJ3BsYXRmb3JtbWFuYWdlcl8nKSAhPSAwKSBjID0gKHtcblx0XHRcdFBsYXRmb3JtOiBcInBsYXRmb3JtbWFuYWdlcl9QbGF0Zm9ybVwiLFxuXHRcdFx0VXNlcjogXCJwbGF0Zm9ybW1hbmFnZXJfVXNlclwiLFxuXHRcdFx0UmVxdWlyZW1lbnQ6IFwicGxhdGZvcm1tYW5hZ2VyX1JlcXVpcmVtZW50XCIsXG5cdFx0XHRFZmZvcnRfRXN0aW1hdGU6IFwicGxhdGZvcm1tYW5hZ2VyX0VmZm9ydF9Fc3RpbWF0ZVwiLFxuXHRcdFx0RWZmb3J0OiBcInBsYXRmb3JtbWFuYWdlcl9FZmZvcnRcIixcblx0XHRcdEJ1ZGdldDogXCJwbGF0Zm9ybW1hbmFnZXJfQnVkZ2V0XCIsXG5cdFx0XHRBZ2VuZGFfSXRlbTogXCJwbGF0Zm9ybW1hbmFnZXJfQWdlbmRhX0l0ZW1cIixcblx0XHRcdE1lZXRpbmdfQWdlbmRhOiBcInBsYXRmb3JtbWFuYWdlcl9NZWV0aW5nX0FnZW5kYVwiLFxuXHRcdFx0RGVjaXNpb25fT3B0aW9uOiBcInBsYXRmb3JtbWFuYWdlcl9EZWNpc2lvbl9PcHRpb25cIixcblx0XHRcdERlY2lzaW9uOiBcInBsYXRmb3JtbWFuYWdlcl9EZWNpc2lvblwiLFxuXHRcdFx0TWVldGluZ19NaW51dGU6IFwicGxhdGZvcm1tYW5hZ2VyX01lZXRpbmdfTWludXRlXCIsXG5cdFx0XHRNZWV0aW5nX1NlcmllczogXCJwbGF0Zm9ybW1hbmFnZXJfTWVldGluZ19TZXJpZXNcIixcblx0XHRcdE1lZXRpbmc6IFwicGxhdGZvcm1tYW5hZ2VyX01lZXRpbmdcIixcblx0XHRcdEJvYXJkOiBcInBsYXRmb3JtbWFuYWdlcl9Cb2FyZFwiLFxuXHRcdFx0Qm9hcmRfTWVtYmVyOiBcInBsYXRmb3JtbWFuYWdlcl9Cb2FyZF9NZW1iZXJcIixcblx0XHRcdEZyZXF1ZW5jeTogXCJwbGF0Zm9ybW1hbmFnZXJfRnJlcXVlbmN5XCIsXG5cdFx0XHRNb2R1bGU6IFwicGxhdGZvcm1tYW5hZ2VyX01vZHVsZVwiLFxuXHRcdFx0Q2FwYWJpbGl0eTogXCJwbGF0Zm9ybW1hbmFnZXJfQ2FwYWJpbGl0eVwiLFxuXHRcdFx0VGVhbTogXCJwbGF0Zm9ybW1hbmFnZXJfVGVhbVwiLFxuXHRcdFx0UHJvamVjdDogXCJwbGF0Zm9ybW1hbmFnZXJfUHJvamVjdFwiLFxuXHRcdFx0VGVhbV9NZW1iZXI6IFwicGxhdGZvcm1tYW5hZ2VyX1RlYW1fTWVtYmVyXCIsXG5cdFx0XHRSb2xlOiBcInBsYXRmb3JtbWFuYWdlcl9Sb2xlXCIsXG5cdFx0fSlbY107XG5cdFx0cmV0dXJuIG5ldyhncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBnbG9iYWwgOiB4Xzc4NjExX3BsYXRmb3JtXzApW2NdKCk7XG5cdH1cblxuXHRfdG9Eb2N1bWVudChhckZpZWxkcykge1xuXG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCB7fTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSByZXQuc3lzX2lkID0gdGhpcy5JZDtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5hY3RpdmUgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5lbmFibGVkID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnVzZXJfbmFtZSA9IHRoaXMuY29kZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQub3JkZXIgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmRhdGUgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHJldC5kYXRlICYmIHR5cGVvZihyZXQuZGF0ZS50b0lTT1N0cmluZykgPT09ICdmdW5jdGlvbicpIHJldC5kYXRlID0gcmV0LmRhdGUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCcuMDAwWicsICdaJyk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm5hbWUgPSB0aGlzLm5hbWUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5yZW1hcmsgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAodHlwZW9mKHJldC5yZW1hcmspID09PSAnb2JqZWN0JykgcmV0LnJlbWFyayA9IChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RW5jb2RlKEpTT04uc3RyaW5naWZ5KHJldC5yZW1hcmspKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5vcmdhbml6ZXJfTWVldGluZ3MoKSkgIT09ICd1bmRlZmluZWQnKSByZXQub3JnYW5pemVyX01lZXRpbmdzID0gdGhpcy5vcmdhbml6ZXJfTWVldGluZ3MoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLm1vZGVyYXRvcl9NZWV0aW5ncygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5tb2RlcmF0b3JfTWVldGluZ3MgPSB0aGlzLm1vZGVyYXRvcl9NZWV0aW5ncygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMubWVtYmVyX0JvYXJkX01lbWJlcnMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubWVtYmVyX0JvYXJkX01lbWJlcnMgPSB0aGlzLm1lbWJlcl9Cb2FyZF9NZW1iZXJzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5tZW1iZXJfVGVhbV9NZW1iZXJzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm1lbWJlcl9UZWFtX01lbWJlcnMgPSB0aGlzLm1lbWJlcl9UZWFtX01lbWJlcnMoKS5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiB0YS5fdG9Eb2N1bWVudCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKEFycmF5LmlzQXJyYXkoYXJGaWVsZHMpKSBPYmplY3Qua2V5cyhyZXQpLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gIWFyRmllbGRzLmZpbmQoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIF9rID09IGs7XG5cdFx0XHR9KTtcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGRlbGV0ZSByZXRba107XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3VuaXF1ZShrZXlzLCByZXQpIHtcblx0XHRyZXQgPSByZXQgfHwgbmV3IHBsYXRmb3JtbWFuYWdlcl9Vc2VyKCk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdC8vIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7XG5cdFx0aWYgKCFrZXlzKSB7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInVzZXJfbmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVtYXJrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfcXVlcnkoZ3EpIHtcblx0XHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4Xzc4NjExX3BsYXRmb3JtXzBfc3lzX3VzZXInLCBbJyonXSlbJ3hfNzg2MTFfcGxhdGZvcm1fMF9zeXNfdXNlciddKTtcblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgneF83ODYxMV9wbGF0Zm9ybV8wX3N5c191c2VyJyk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKHRoaXMpKTtcblx0XHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0XHQvKiBncy5pbmZvKFwiVXNlci5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VuYWJsZWQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qIGdzLmluZm8oXCJVc2VyLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZW5hYmxlZCcpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdlbmFibGVkJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX2NvZGVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmNvZGUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3VzZXJfbmFtZScpID49IDApIHtcblx0XHRcdFx0LyogZ3MuaW5mbyhcIlVzZXIuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCd1c2VyX25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3VzZXJfbmFtZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCd1c2VyX25hbWUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdFx0LyogZ3MuaW5mbyhcIlVzZXIuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2RhdGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qIGdzLmluZm8oXCJVc2VyLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qIGdzLmluZm8oXCJVc2VyLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVtYXJrJykgPj0gMCkge1xuXHRcdFx0XHQvKiBncy5pbmZvKFwiVXNlci5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3JlbWFyaycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdFx0LyogZ3MuaW5mbyhcIlVzZXIuX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdFx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG5cdH1cblxuXHRfc2F2ZShvYmopIHtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHBsYXRmb3JtbWFuYWdlcl9Vc2VyKCkuX3NhdmUobylcblx0XHR9KTtcblxuXHRcdGxldCBfb2JqID0ge307XG5cblx0XHQvKmdzLmluZm8oXCJVc2VyLl9zYXZlKCk6IFwiKyBcIi4uLiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4Xzc4NjExX3BsYXRmb3JtXzBfc3lzX3VzZXInLCBbJyonXSlbJ3hfNzg2MTFfcGxhdGZvcm1fMF9zeXNfdXNlciddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdFx0fSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHRcdGdzLmluZm8oXCJVc2VyLl9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHRcdGdzLmluZm8oXCJVc2VyLl9zYXZlKCk6IFwiICsgXCJzeXNfaWQgdG8gc3RyaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0X29ialtrXSA9IF9vYmpba10uc3lzX2lkO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0bGV0IF90aGlzID0gbnVsbDtcblx0XHRpZiAob2JqLl9fa2V5cykge1xuXHRcdFx0bGV0IGtPYmogPSB7fTtcblx0XHRcdGtPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkoX29iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShfb2JqKSkpKTtcblx0XHRcdG9iai5fX2tleXMuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdGtPYmpba10gPSBfb2JqW2tdXG5cdFx0XHR9KTtcblx0XHRcdF90aGlzID0gbmV3IHBsYXRmb3JtbWFuYWdlcl9Vc2VyKCkuX2Zyb21Eb2N1bWVudChrT2JqKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0X3RoaXMgPSBuZXcgcGxhdGZvcm1tYW5hZ2VyX1VzZXIoKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0XHR9XG5cblx0XHQvKmdzLmluZm8oXCJVc2VyLl9zYXZlKCk6IFwiICsgXCJfdGhpcy5JZD1cIiArIF90aGlzLklkICsgXCIsIF90aGlzLmZpbmQoKS5JZDogXCIgKyBfdGhpcy5maW5kKCkuSWQpOyovXG5cblx0XHRfb2JqLnN5c19pZCA9IChfdGhpcy5maW5kKCkgfHwgdGhpcyB8fCB7fSkuSWQgfHwgX29iai5zeXNfaWQ7XG5cdFx0ZGVsZXRlIF9vYmouX19pZEZpZWxkO1xuXG5cdFx0dHJ5IHtcblx0XHRcdGdzLmluZm8oXCJVc2VyLl9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0Z3MuaW5mbyhcIlVzZXIuX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSk7XG5cblx0XHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICd4Xzc4NjExX3BsYXRmb3JtXzBfc3lzX3VzZXInKTtcblx0XHRcdC8qZ3MuaW5mbyhcIlVzZXIuX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdFx0fVxuXHRcdFx0bGV0IF9mT2JqID0ge307XG5cdFx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKSkpO1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF83ODYxMV9wbGF0Zm9ybV8wX3N5c191c2VyJywgWycqJ10pWyd4Xzc4NjExX3BsYXRmb3JtXzBfc3lzX3VzZXInXSkpKSk7XG5cdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdGdzLmluZm8oXCJVc2VyLl9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0XHRncy5pbmZvKFwiVXNlci5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH1cblxuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5vcmdhbml6ZXJfTWVldGluZ3MpKSB0aGlzLm9yZ2FuaXplcl9NZWV0aW5ncyhvYmoub3JnYW5pemVyX01lZXRpbmdzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBwbGF0Zm9ybW1hbmFnZXJfTWVldGluZygpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5tb2RlcmF0b3JfTWVldGluZ3MpKSB0aGlzLm1vZGVyYXRvcl9NZWV0aW5ncyhvYmoubW9kZXJhdG9yX01lZXRpbmdzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBwbGF0Zm9ybW1hbmFnZXJfTWVldGluZygpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5tZW1iZXJfQm9hcmRfTWVtYmVycykpIHRoaXMubWVtYmVyX0JvYXJkX01lbWJlcnMob2JqLm1lbWJlcl9Cb2FyZF9NZW1iZXJzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBwbGF0Zm9ybW1hbmFnZXJfQm9hcmRfTWVtYmVyKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLm1lbWJlcl9UZWFtX01lbWJlcnMpKSB0aGlzLm1lbWJlcl9UZWFtX01lbWJlcnMob2JqLm1lbWJlcl9UZWFtX01lbWJlcnMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHBsYXRmb3JtbWFuYWdlcl9UZWFtX01lbWJlcigpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogVXNlci5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHN0b3JlKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obG9nT2JqKSB7XG5cdFx0XHRncy5pbmZvKFwiVXNlci5zdG9yZSgpOiBcIiArIFwibG9nT2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KGxvZ09iaiwgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdGdzLmluZm8oXCJVc2VyLnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Z3MuaW5mbyhcIlVzZXIuc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdGdzLmluZm8oXCJVc2VyLnN0b3JlKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRcdGxldCBfdGhpcyA9IHRoaXMuX3VuaXF1ZSgpLmZpbmQoKTtcblx0XHRcdGlmIChfdGhpcykgdGhpcy5JZCA9IF90aGlzLklkO1xuXG5cdFx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBVc2VyLmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kQWxsKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obG9nT2JqKSB7XG5cdFx0XHRncy5pbmZvKFwiVXNlci5maW5kQWxsKCk6IFwiICsgXCJsb2dPYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkobG9nT2JqLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0Z3MuaW5mbyhcIlVzZXIuZmluZEFsbCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGdzLmluZm8oXCJVc2VyLmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdGdzLmluZm8oXCJVc2VyLmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoXCJzeXNfdXNlclwiKTtcblx0XHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0XHQvL3JldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQodGhpcy5fcXVlcnkoKS5zZWxlY3QoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF83ODYxMV9wbGF0Zm9ybV8wX3N5c191c2VyJywgWycqJ10pWyd4Xzc4NjExX3BsYXRmb3JtXzBfc3lzX3VzZXInXSkpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogVXNlci5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZChfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKGxvZ09iaikge1xuXHRcdFx0Z3MuaW5mbyhcIlVzZXIuZmluZCgpOiBcIiArIFwibG9nT2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KGxvZ09iaiwgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdGdzLmluZm8oXCJVc2VyLmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRncy5pbmZvKFwiVXNlci5maW5kKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHRncy5pbmZvKFwiVXNlci5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic3lzX25hbWUiOiJwbGF0Zm9ybW1hbmFnZXJfRWZmb3J0IiwiYXBpX25hbWUiOiJ4Xzc4NjExX3BsYXRmb3JtXzAucGxhdGZvcm1tYW5hZ2VyX0VmZm9ydCIsIm5hbWUiOiJwbGF0Zm9ybW1hbmFnZXJfRWZmb3J0Iiwic2NyaXB0IjoiY2xhc3MgcGxhdGZvcm1tYW5hZ2VyX0VmZm9ydCB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7XG5cdFx0dW5kZWZpbmVkXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIlwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJwbGF0Zm9ybW1hbmFnZXJfRWZmb3J0XCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJwbGF0Zm9ybW1hbmFnZXJcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInBsYXRmb3JtbWFuYWdlclwiO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRWZmb3J0LmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdGl2ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYWN0aXZlID0gdjtcblx0XHRcdHRoaXMuX2FjdGl2ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3RpdmU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRWZmb3J0LmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmFibGVkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lbmFibGVkID0gdjtcblx0XHRcdHRoaXMuX2VuYWJsZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5hYmxlZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBFZmZvcnQuY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEVmZm9ydC5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG9yZGVyKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9vcmRlciA9IHY7XG5cdFx0XHR0aGlzLl9vcmRlcl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9vcmRlcjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBFZmZvcnQuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRhdGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvL2dzLmluZm8oXCJFZmZvcnQuZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEVmZm9ydC5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRWZmb3J0LnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlbWFyayh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVtYXJrID0gdjtcblx0XHRcdHRoaXMuX3JlbWFya19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZW1hcms7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRWZmb3J0LmVmZm9ydF9FZmZvcnRfRXN0aW1hdGVzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZWZmb3J0X0VmZm9ydF9Fc3RpbWF0ZXModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9lZmZvcnRfRWZmb3J0X0VzdGltYXRlcyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX2VmZm9ydF9FZmZvcnRfRXN0aW1hdGVzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lZmZvcnRfRWZmb3J0X0VzdGltYXRlcztcblx0XHR9XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnY29kZScgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ25hbWUnICsgKHRoaXMuX25hbWVfY29vcCB8fCAnPScpICsgdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAodGhpcy5fcmVtYXJrKSByZXQgKz0gJ14nICsgc1BhdGggKyAncmVtYXJrJyArICh0aGlzLl9yZW1hcmtfY29vcCB8fCAnPScpICsgdGhpcy5yZW1hcmsoKTtcblxuXHRcdCh0aGlzLmVmZm9ydF9FZmZvcnRfRXN0aW1hdGVzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllFZmZvcnRfRXN0aW1hdGUuZWZmb3J0LD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHRncy5pbmZvKFwiRWZmb3J0Ll90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykgcmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0Z3MuaW5mbyhcIkVmZm9ydC5faW52b2tlKCk6IFwiICsgXCJtZXRob2Q6IFwiICsgSlNPTi5zdHJpbmdpZnkobWV0aG9kLCBudWxsLCA0KSk7XG5cblx0XHRzd2l0Y2ggKG1ldGhvZCkge1xuXG5cdFx0XHRjYXNlIFwic3RvcmVcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zdG9yZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZEFsbFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRlZmF1bHQ6IHtcblx0XHRcdFx0Ly8gaWYodHlwZW9mKHRoaXNbbWV0aG9kXSk9PT0nZnVuY3Rpb24nKSByZXR1cm4gdGhpc1ttZXRob2RdKHBheWxvYWQpO1xuXG5cdFx0XHRcdGdzLmluZm8oXCJFZmZvcnQuX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpczsgLy8gdGVzdFxuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBwbGF0Zm9ybW1hbmFnZXJfRWZmb3J0KCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0dHJ5IHtcblx0XHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0Lypncy5pbmZvKFwiRWZmb3J0Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInN0cmluZyBbXCIrb2JqK1wiXSBpbnRvIFwiICsgKChmdW5jdGlvbihyKXtcbiAgICBsZXQgcmV0ID0gJ3N5c19pZCc7XG4gICAgaWYodHlwZW9mKHIuX19pZEZpZWxkKT09PSdmdW5jdGlvbicpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJz90aGlzLl9faWRGaWVsZCgpOnVuZGVmaW5lZCldKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5JZCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdJZCc7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuc3lzX21vZF9jb3VudCkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9ICdzeXNfaWQnO1xuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufSkodGhpcykpKTsqL1xuXHRcdFx0XHRsZXQgX29iaiA9IHtcblx0XHRcdFx0XHRfX2lkRmllbGQ6ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkodGhpcykpXG5cdFx0XHRcdH07XG5cdFx0XHRcdF9vYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHR9KSh0aGlzKSldID0gb2JqO1xuXHRcdFx0XHRvYmogPSBfb2JqO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChvYmopO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnKSB7XG5cdFx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRpZiAob2JqLmlzVmFsaWRSZWNvcmQoKSkge1xuXHRcdFx0XHRcdGlmIChvYmouZ2V0VGFibGVOYW1lKCkgPT0gJ2VjY19xdWV1ZScgJiYgXCJFZmZvcnRcIiAhPSAnZWNjX3F1ZXVlJyAmJiBvYmouc291cmNlID09IFwiRWZmb3J0XCIpIHtcblx0XHRcdFx0XHRcdG9iai5zdGF0ZSA9IFwicHJvY2Vzc2luZ1wiO1xuXHRcdFx0XHRcdFx0b2JqLnVwZGF0ZSgpO1xuXG5cdFx0XHRcdFx0XHRsZXQgcmVzcCA9IG5ldyBHbGlkZVJlY29yZCgnZWNjX3F1ZXVlJyk7XG5cdFx0XHRcdFx0XHRyZXNwLnJlc3BvbnNlX3RvID0gb2JqLnN5c19pZDtcblx0XHRcdFx0XHRcdHJlc3AucXVldWUgPSAnb3V0cHV0Jztcblx0XHRcdFx0XHRcdHJlc3AuYWdlbnQgPSBvYmouYWdlbnQ7XG5cdFx0XHRcdFx0XHRyZXNwLnRvcGljID0gb2JqLnRvcGljO1xuXHRcdFx0XHRcdFx0cmVzcC5uYW1lID0gb2JqLm5hbWU7XG5cdFx0XHRcdFx0XHRyZXNwLnNvdXJjZSA9IG9iai5zb3VyY2U7XG5cdFx0XHRcdFx0XHRyZXNwLmZyb21faG9zdCA9IG9iai5hZ2VudF9jb3JyZWxhdG9yO1xuXHRcdFx0XHRcdFx0cmVzcC5hZ2VudF9jb3JyZWxhdG9yID0gb2JqLmZyb21faG9zdDtcblxuXHRcdFx0XHRcdFx0bGV0IHJldCA9IG5ldyBwbGF0Zm9ybW1hbmFnZXJfRWZmb3J0KCkuX2Zyb21Eb2N1bWVudCgpLl9pbnZva2Uob2JqLm5hbWUudG9TdHJpbmcoKSwgb2JqLnBheWxvYWQudG9TdHJpbmcoKSk7XG5cdFx0XHRcdFx0XHRpZiAoQXJyYXkuaXNBcnJheShyZXQpKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHJldC5tYXAoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiAociAmJiB0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicpID8gci5fdG9Eb2N1bWVudCgpIDogcjtcblx0XHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHJldCAmJiB0eXBlb2YocmV0Ll90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByZXQuX3RvRG9jdW1lbnQoKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJlc3AucGF5bG9hZCA9IEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCk7XG5cblx0XHRcdFx0XHRcdHJlc3AuaW5zZXJ0KCk7XG5cblx0XHRcdFx0XHRcdG9iai5zdGF0ZSA9IFwicHJvY2Vzc2VkXCI7XG5cdFx0XHRcdFx0XHRvYmoudXBkYXRlKCk7XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmVzcDtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHtcblxuXHRcdFx0XHRcdFx0YWN0aXZlOiBvYmouZ2V0VmFsdWUoXCJhY3RpdmVcIiksXG5cblx0XHRcdFx0XHRcdGVuYWJsZWQ6IG9iai5nZXRWYWx1ZShcImVuYWJsZWRcIiksXG5cblx0XHRcdFx0XHRcdGNvZGU6IG9iai5nZXRWYWx1ZShcImNvZGVcIiksXG5cblx0XHRcdFx0XHRcdG9yZGVyOiBvYmouZ2V0VmFsdWUoXCJvcmRlclwiKSxcblxuXHRcdFx0XHRcdFx0ZGF0ZTogb2JqLmdldFZhbHVlKFwiZGF0ZVwiKSxcblxuXHRcdFx0XHRcdFx0bmFtZTogb2JqLmdldFZhbHVlKFwibmFtZVwiKSxcblxuXHRcdFx0XHRcdFx0cmVtYXJrOiBvYmouZ2V0VmFsdWUoXCJyZW1hcmtcIiksXG5cblx0XHRcdFx0XHRcdElkOiBvYmouZ2V0VmFsdWUoJ3N5c19pZCcpXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0b2JqLnF1ZXJ5KCk7XG5cdFx0XHRcdFx0bGV0IGdyUmV0ID0gW107XG5cdFx0XHRcdFx0d2hpbGUgKG9iai5uZXh0KCkpIGdyUmV0LnB1c2godGhpcy5fZnJvbURvY3VtZW50KG9iaikpO1xuXHRcdFx0XHRcdC8qZ3MuaW5mbyhcIkVmZm9ydC5fZnJvbURvY3VtZW50KCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0XHRcdHJldHVybiBnclJldDtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0XHRncy5pbmZvKFwiRWZmb3J0Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0XHRyZXR1cm4gb2JqO1xuXHRcdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRcdHJldHVybiBuZXcgcGxhdGZvcm1tYW5hZ2VyX0VmZm9ydCgpLl9mcm9tRG9jdW1lbnQobylcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmouY29uc3RydWN0b3IpID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0aWYgKG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcblxuXHRcdFx0XHRcdHRoaXMuSWQgPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KShvYmopKSkpO1xuXG5cdFx0XHRcdFx0Lypncy5pbmZvKFwiRWZmb3J0Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5jb2RlKG9iai5jb2RlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5uYW1lKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLnJlbWFyaykpKTtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLnJlbWFyayk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZWZmb3J0X0VmZm9ydF9Fc3RpbWF0ZXMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5lZmZvcnRfRWZmb3J0X0VzdGltYXRlcyhuZXcgcGxhdGZvcm1tYW5hZ2VyX0VmZm9ydF9Fc3RpbWF0ZSgpLl9mcm9tRG9jdW1lbnQob2JqLmVmZm9ydF9FZmZvcnRfRXN0aW1hdGVzKSk7XG5cblx0XHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiRWZmb3J0XCIpe1xuXHRcdFx0XHRcdGdzLmluZm8oXCJFZmZvcnQuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgY29uc3RydWN0b3I6IFwiICsgb2JqLmNvbnN0cnVjdG9yLm5hbWUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRncy5pbmZvKFwiRWZmb3J0Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IFwiICsgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHRncy5pbmZvKFwiRWZmb3J0Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHRcdH1cblxuXHRcdC8qZ3MuaW5mbyhcIkVmZm9ydC5fZnJvbURvY3VtZW50KCk6IFwiKyBcIklkIFwiKyBcInRoaXMuSWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5JZCwgbnVsbCwgNCkpOyovXG5cdFx0Lypncy5pbmZvKFwiRWZmb3J0Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7Ki9cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9uZXcoYykge1xuXHRcdGlmICghYykgYyA9IHRoaXMuX190eXBlO1xuXHRcdGlmIChjLmluZGV4T2YoJ3BsYXRmb3JtbWFuYWdlcl8nKSAhPSAwKSBjID0gKHtcblx0XHRcdFBsYXRmb3JtOiBcInBsYXRmb3JtbWFuYWdlcl9QbGF0Zm9ybVwiLFxuXHRcdFx0VXNlcjogXCJwbGF0Zm9ybW1hbmFnZXJfVXNlclwiLFxuXHRcdFx0UmVxdWlyZW1lbnQ6IFwicGxhdGZvcm1tYW5hZ2VyX1JlcXVpcmVtZW50XCIsXG5cdFx0XHRFZmZvcnRfRXN0aW1hdGU6IFwicGxhdGZvcm1tYW5hZ2VyX0VmZm9ydF9Fc3RpbWF0ZVwiLFxuXHRcdFx0RWZmb3J0OiBcInBsYXRmb3JtbWFuYWdlcl9FZmZvcnRcIixcblx0XHRcdEJ1ZGdldDogXCJwbGF0Zm9ybW1hbmFnZXJfQnVkZ2V0XCIsXG5cdFx0XHRBZ2VuZGFfSXRlbTogXCJwbGF0Zm9ybW1hbmFnZXJfQWdlbmRhX0l0ZW1cIixcblx0XHRcdE1lZXRpbmdfQWdlbmRhOiBcInBsYXRmb3JtbWFuYWdlcl9NZWV0aW5nX0FnZW5kYVwiLFxuXHRcdFx0RGVjaXNpb25fT3B0aW9uOiBcInBsYXRmb3JtbWFuYWdlcl9EZWNpc2lvbl9PcHRpb25cIixcblx0XHRcdERlY2lzaW9uOiBcInBsYXRmb3JtbWFuYWdlcl9EZWNpc2lvblwiLFxuXHRcdFx0TWVldGluZ19NaW51dGU6IFwicGxhdGZvcm1tYW5hZ2VyX01lZXRpbmdfTWludXRlXCIsXG5cdFx0XHRNZWV0aW5nX1NlcmllczogXCJwbGF0Zm9ybW1hbmFnZXJfTWVldGluZ19TZXJpZXNcIixcblx0XHRcdE1lZXRpbmc6IFwicGxhdGZvcm1tYW5hZ2VyX01lZXRpbmdcIixcblx0XHRcdEJvYXJkOiBcInBsYXRmb3JtbWFuYWdlcl9Cb2FyZFwiLFxuXHRcdFx0Qm9hcmRfTWVtYmVyOiBcInBsYXRmb3JtbWFuYWdlcl9Cb2FyZF9NZW1iZXJcIixcblx0XHRcdEZyZXF1ZW5jeTogXCJwbGF0Zm9ybW1hbmFnZXJfRnJlcXVlbmN5XCIsXG5cdFx0XHRNb2R1bGU6IFwicGxhdGZvcm1tYW5hZ2VyX01vZHVsZVwiLFxuXHRcdFx0Q2FwYWJpbGl0eTogXCJwbGF0Zm9ybW1hbmFnZXJfQ2FwYWJpbGl0eVwiLFxuXHRcdFx0VGVhbTogXCJwbGF0Zm9ybW1hbmFnZXJfVGVhbVwiLFxuXHRcdFx0UHJvamVjdDogXCJwbGF0Zm9ybW1hbmFnZXJfUHJvamVjdFwiLFxuXHRcdFx0VGVhbV9NZW1iZXI6IFwicGxhdGZvcm1tYW5hZ2VyX1RlYW1fTWVtYmVyXCIsXG5cdFx0XHRSb2xlOiBcInBsYXRmb3JtbWFuYWdlcl9Sb2xlXCIsXG5cdFx0fSlbY107XG5cdFx0cmV0dXJuIG5ldyhncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBnbG9iYWwgOiB4Xzc4NjExX3BsYXRmb3JtXzApW2NdKCk7XG5cdH1cblxuXHRfdG9Eb2N1bWVudChhckZpZWxkcykge1xuXG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCB7fTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSByZXQuc3lzX2lkID0gdGhpcy5JZDtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5hY3RpdmUgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5lbmFibGVkID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmNvZGUgPSB0aGlzLmNvZGUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm9yZGVyID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5kYXRlID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmIChyZXQuZGF0ZSAmJiB0eXBlb2YocmV0LmRhdGUudG9JU09TdHJpbmcpID09PSAnZnVuY3Rpb24nKSByZXQuZGF0ZSA9IHJldC5kYXRlLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5uYW1lID0gdGhpcy5uYW1lKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQucmVtYXJrID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKHR5cGVvZihyZXQucmVtYXJrKSA9PT0gJ29iamVjdCcpIHJldC5yZW1hcmsgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NEVuY29kZShKU09OLnN0cmluZ2lmeShyZXQucmVtYXJrKSk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuZWZmb3J0X0VmZm9ydF9Fc3RpbWF0ZXMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZWZmb3J0X0VmZm9ydF9Fc3RpbWF0ZXMgPSB0aGlzLmVmZm9ydF9FZmZvcnRfRXN0aW1hdGVzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdFx0fSk7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRkZWxldGUgcmV0W2tdO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF91bmlxdWUoa2V5cywgcmV0KSB7XG5cdFx0cmV0ID0gcmV0IHx8IG5ldyBwbGF0Zm9ybW1hbmFnZXJfRWZmb3J0KCk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdC8vIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7XG5cdFx0aWYgKCFrZXlzKSB7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImNvZGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJuYW1lXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubmFtZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInJlbWFya1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3F1ZXJ5KGdxKSB7XG5cdFx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF83ODYxMV9wbGF0Zm9ybV8wX2VmZm9ydCcsIFsnKiddKVsneF83ODYxMV9wbGF0Zm9ybV8wX2VmZm9ydCddKTtcblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgneF83ODYxMV9wbGF0Zm9ybV8wX2VmZm9ydCcpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KSh0aGlzKSk7XG5cdFx0aWYgKGlkZiA9PSAnSWQnKSBpZGYgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3RpdmVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdFx0LyogZ3MuaW5mbyhcIkVmZm9ydC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VuYWJsZWQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qIGdzLmluZm8oXCJFZmZvcnQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdFx0LyogZ3MuaW5mbyhcIkVmZm9ydC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnY29kZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZGVyJykgPj0gMCkge1xuXHRcdFx0XHQvKiBncy5pbmZvKFwiRWZmb3J0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0XHQvKiBncy5pbmZvKFwiRWZmb3J0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qIGdzLmluZm8oXCJFZmZvcnQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ25hbWUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX3JlbWFya19jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZW1hcmsnKSA+PSAwKSB7XG5cdFx0XHRcdC8qIGdzLmluZm8oXCJFZmZvcnQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZW1hcmsnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHRcdC8qIGdzLmluZm8oXCJFZmZvcnQuX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdFx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG5cdH1cblxuXHRfc2F2ZShvYmopIHtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHBsYXRmb3JtbWFuYWdlcl9FZmZvcnQoKS5fc2F2ZShvKVxuXHRcdH0pO1xuXG5cdFx0bGV0IF9vYmogPSB7fTtcblxuXHRcdC8qZ3MuaW5mbyhcIkVmZm9ydC5fc2F2ZSgpOiBcIisgXCIuLi4gXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRPYmplY3Qua2V5cyhvYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF83ODYxMV9wbGF0Zm9ybV8wX2VmZm9ydCcsIFsnKiddKVsneF83ODYxMV9wbGF0Zm9ybV8wX2VmZm9ydCddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdFx0fSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHRcdGdzLmluZm8oXCJFZmZvcnQuX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdFx0Z3MuaW5mbyhcIkVmZm9ydC5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGxldCBfdGhpcyA9IG51bGw7XG5cdFx0aWYgKG9iai5fX2tleXMpIHtcblx0XHRcdGxldCBrT2JqID0ge307XG5cdFx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpKSk7XG5cdFx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHRrT2JqW2tdID0gX29ialtrXVxuXHRcdFx0fSk7XG5cdFx0XHRfdGhpcyA9IG5ldyBwbGF0Zm9ybW1hbmFnZXJfRWZmb3J0KCkuX2Zyb21Eb2N1bWVudChrT2JqKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0X3RoaXMgPSBuZXcgcGxhdGZvcm1tYW5hZ2VyX0VmZm9ydCgpLl9mcm9tRG9jdW1lbnQoX29iaikuX3VuaXF1ZSgpO1xuXHRcdH1cblxuXHRcdC8qZ3MuaW5mbyhcIkVmZm9ydC5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdFx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRcdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHRcdHRyeSB7XG5cdFx0XHRncy5pbmZvKFwiRWZmb3J0Ll9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0Z3MuaW5mbyhcIkVmZm9ydC5fc2F2ZSgpOiBcIiArIFwicmVuYW1pbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHR2YXIgbGsgPSBrLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRcdF9vYmpbbGtdID0gX29ialtrXTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9KTtcblxuXHRcdFx0bGV0IGdxID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KG9iai5fX3R5cGUgfHwgJ3hfNzg2MTFfcGxhdGZvcm1fMF9lZmZvcnQnKTtcblx0XHRcdC8qZ3MuaW5mbyhcIkVmZm9ydC5fc2F2ZSgpOiBcIisgXCJ1cHNlcnRpbmcuLi4gXCIrIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7Ki9cblx0XHRcdGlmIChfb2JqLnN5c19pZCkge1xuXHRcdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X29iai5zeXNfaWQgPSBncy5nZW5lcmF0ZUdVSUQoKTtcblx0XHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0XHR9XG5cdFx0XHRsZXQgX2ZPYmogPSB7fTtcblx0XHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpKSk7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4Xzc4NjExX3BsYXRmb3JtXzBfZWZmb3J0JywgWycqJ10pWyd4Xzc4NjExX3BsYXRmb3JtXzBfZWZmb3J0J10pKSkpO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRncy5pbmZvKFwiRWZmb3J0Ll9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0XHRncy5pbmZvKFwiRWZmb3J0Ll9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fVxuXG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLmVmZm9ydF9FZmZvcnRfRXN0aW1hdGVzKSkgdGhpcy5lZmZvcnRfRWZmb3J0X0VzdGltYXRlcyhvYmouZWZmb3J0X0VmZm9ydF9Fc3RpbWF0ZXMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHBsYXRmb3JtbWFuYWdlcl9FZmZvcnRfRXN0aW1hdGUoKS5fc2F2ZSh0YSlcblx0XHR9KSk7XG5cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEVmZm9ydC5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHN0b3JlKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obG9nT2JqKSB7XG5cdFx0XHRncy5pbmZvKFwiRWZmb3J0LnN0b3JlKCk6IFwiICsgXCJsb2dPYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkobG9nT2JqLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0Z3MuaW5mbyhcIkVmZm9ydC5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGdzLmluZm8oXCJFZmZvcnQuc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdGdzLmluZm8oXCJFZmZvcnQuc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdFx0bGV0IF90aGlzID0gdGhpcy5fdW5pcXVlKCkuZmluZCgpO1xuXHRcdFx0aWYgKF90aGlzKSB0aGlzLklkID0gX3RoaXMuSWQ7XG5cblx0XHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEVmZm9ydC5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZEFsbChfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKGxvZ09iaikge1xuXHRcdFx0Z3MuaW5mbyhcIkVmZm9ydC5maW5kQWxsKCk6IFwiICsgXCJsb2dPYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkobG9nT2JqLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0Z3MuaW5mbyhcIkVmZm9ydC5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Z3MuaW5mbyhcIkVmZm9ydC5maW5kQWxsKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHRncy5pbmZvKFwiRWZmb3J0LmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoXCJFZmZvcnRcIik7XG5cdFx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfNzg2MTFfcGxhdGZvcm1fMF9lZmZvcnQnLCBbJyonXSlbJ3hfNzg2MTFfcGxhdGZvcm1fMF9lZmZvcnQnXSkpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRWZmb3J0LmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obG9nT2JqKSB7XG5cdFx0XHRncy5pbmZvKFwiRWZmb3J0LmZpbmQoKTogXCIgKyBcImxvZ09iajogXCIgKyBKU09OLnN0cmluZ2lmeShsb2dPYmosIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHRncy5pbmZvKFwiRWZmb3J0LmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRncy5pbmZvKFwiRWZmb3J0LmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdGdzLmluZm8oXCJFZmZvcnQuZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG59In0seyJhY3RpdmUiOnRydWUsImFjY2VzcyI6InBhY2thZ2VfcHJpdmF0ZSIsImNhbGxlcl9hY2Nlc3MiOm51bGwsInN5c19uYW1lIjoicGxhdGZvcm1tYW5hZ2VyX0J1ZGdldCIsImFwaV9uYW1lIjoieF83ODYxMV9wbGF0Zm9ybV8wLnBsYXRmb3JtbWFuYWdlcl9CdWRnZXQiLCJuYW1lIjoicGxhdGZvcm1tYW5hZ2VyX0J1ZGdldCIsInNjcmlwdCI6ImNsYXNzIHBsYXRmb3JtbWFuYWdlcl9CdWRnZXQge1xuXHRjb25zdHJ1Y3RvcihpZCkge1xuXHRcdHVuZGVmaW5lZFxuXHRcdHRoaXMuSWQgPSBpZDtcblx0XHR0aGlzLl9fbW9kdWxlID0gXCJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwicGxhdGZvcm1tYW5hZ2VyX0J1ZGdldFwiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwicGxhdGZvcm1tYW5hZ2VyXCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJwbGF0Zm9ybW1hbmFnZXJcIjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEJ1ZGdldC5hY3RpdmUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRhY3RpdmUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2FjdGl2ZSA9IHY7XG5cdFx0XHR0aGlzLl9hY3RpdmVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYWN0aXZlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEJ1ZGdldC5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQnVkZ2V0LmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBCdWRnZXQub3JkZXIgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRvcmRlcih2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fb3JkZXIgPSB2O1xuXHRcdFx0dGhpcy5fb3JkZXJfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fb3JkZXI7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQnVkZ2V0LmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly9ncy5pbmZvKFwiQnVkZ2V0LmRhdGUoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9kYXRlID0gdjtcblx0XHRcdHRoaXMuX2RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGF0ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBCdWRnZXQubmFtZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG5hbWUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX25hbWUgPSB2O1xuXHRcdFx0dGhpcy5fbmFtZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9uYW1lO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEJ1ZGdldC5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEJ1ZGdldC5idWRnZXRfUHJvamVjdHMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRidWRnZXRfUHJvamVjdHModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9idWRnZXRfUHJvamVjdHMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9idWRnZXRfUHJvamVjdHNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2J1ZGdldF9Qcm9qZWN0cztcblx0XHR9XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnY29kZScgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ25hbWUnICsgKHRoaXMuX25hbWVfY29vcCB8fCAnPScpICsgdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAodGhpcy5fcmVtYXJrKSByZXQgKz0gJ14nICsgc1BhdGggKyAncmVtYXJrJyArICh0aGlzLl9yZW1hcmtfY29vcCB8fCAnPScpICsgdGhpcy5yZW1hcmsoKTtcblxuXHRcdCh0aGlzLmJ1ZGdldF9Qcm9qZWN0cygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZUHJvamVjdC5idWRnZXQsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdGdzLmluZm8oXCJCdWRnZXQuX3RvRVF1ZXJ5KCk6IFwiICsgXCJyZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9pbnZva2UobWV0aG9kLCBwYXlsb2FkKSB7XG5cdFx0aWYgKCFtZXRob2QpIHJldHVybiBudWxsO1xuXHRcdGlmICh0eXBlb2YocGF5bG9hZCkgPT09ICdzdHJpbmcnKSByZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgSlNPTi5wYXJzZShwYXlsb2FkKSk7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHJldHVybiBwYXlsb2FkLm1hcChmdW5jdGlvbihwKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgcCk7XG5cdFx0fSk7XG5cblx0XHR0aGlzLl9mcm9tRG9jdW1lbnQocGF5bG9hZCk7XG5cblx0XHRncy5pbmZvKFwiQnVkZ2V0Ll9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0Z3MuaW5mbyhcIkJ1ZGdldC5faW52b2tlKCk6IFwiICsgXCJpbnZhbGlkIG1ldGhvZCBcIiArIG1ldGhvZCk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzOyAvLyB0ZXN0XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHBsYXRmb3JtbWFuYWdlcl9CdWRnZXQoKS5fZnJvbURvY3VtZW50KG8pKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKG9iaikgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHR0cnkge1xuXHRcdFx0XHRvYmogPSBKU09OLnBhcnNlKG9iaik7XG5cdFx0XHR9IGNhdGNoIChleCkge1xuXHRcdFx0XHQvKmdzLmluZm8oXCJCdWRnZXQuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdFx0fTtcblx0XHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRcdFx0aWYgKG9iai5nZXRUYWJsZU5hbWUoKSA9PSAnZWNjX3F1ZXVlJyAmJiBcIkJ1ZGdldFwiICE9ICdlY2NfcXVldWUnICYmIG9iai5zb3VyY2UgPT0gXCJCdWRnZXRcIikge1xuXHRcdFx0XHRcdFx0b2JqLnN0YXRlID0gXCJwcm9jZXNzaW5nXCI7XG5cdFx0XHRcdFx0XHRvYmoudXBkYXRlKCk7XG5cblx0XHRcdFx0XHRcdGxldCByZXNwID0gbmV3IEdsaWRlUmVjb3JkKCdlY2NfcXVldWUnKTtcblx0XHRcdFx0XHRcdHJlc3AucmVzcG9uc2VfdG8gPSBvYmouc3lzX2lkO1xuXHRcdFx0XHRcdFx0cmVzcC5xdWV1ZSA9ICdvdXRwdXQnO1xuXHRcdFx0XHRcdFx0cmVzcC5hZ2VudCA9IG9iai5hZ2VudDtcblx0XHRcdFx0XHRcdHJlc3AudG9waWMgPSBvYmoudG9waWM7XG5cdFx0XHRcdFx0XHRyZXNwLm5hbWUgPSBvYmoubmFtZTtcblx0XHRcdFx0XHRcdHJlc3Auc291cmNlID0gb2JqLnNvdXJjZTtcblx0XHRcdFx0XHRcdHJlc3AuZnJvbV9ob3N0ID0gb2JqLmFnZW50X2NvcnJlbGF0b3I7XG5cdFx0XHRcdFx0XHRyZXNwLmFnZW50X2NvcnJlbGF0b3IgPSBvYmouZnJvbV9ob3N0O1xuXG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gbmV3IHBsYXRmb3JtbWFuYWdlcl9CdWRnZXQoKS5fZnJvbURvY3VtZW50KCkuX2ludm9rZShvYmoubmFtZS50b1N0cmluZygpLCBvYmoucGF5bG9hZC50b1N0cmluZygpKTtcblx0XHRcdFx0XHRcdGlmIChBcnJheS5pc0FycmF5KHJldCkpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gcmV0Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIChyICYmIHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJykgPyByLl90b0RvY3VtZW50KCkgOiByO1xuXHRcdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAocmV0ICYmIHR5cGVvZihyZXQuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHJldC5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmVzcC5wYXlsb2FkID0gSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KTtcblxuXHRcdFx0XHRcdFx0cmVzcC5pbnNlcnQoKTtcblxuXHRcdFx0XHRcdFx0b2JqLnN0YXRlID0gXCJwcm9jZXNzZWRcIjtcblx0XHRcdFx0XHRcdG9iai51cGRhdGUoKTtcblx0XHRcdFx0XHRcdHJldHVybiByZXNwO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdFx0Y29kZTogb2JqLmdldFZhbHVlKFwiY29kZVwiKSxcblxuXHRcdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0XHRyZW1hcms6IG9iai5nZXRWYWx1ZShcInJlbWFya1wiKSxcblxuXHRcdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRvYmoucXVlcnkoKTtcblx0XHRcdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tRG9jdW1lbnQob2JqKSk7XG5cdFx0XHRcdFx0Lypncy5pbmZvKFwiQnVkZ2V0Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHRcdGdzLmluZm8oXCJCdWRnZXQuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwicmVkdW5kZW50IGNhbGxcIik7XG5cdFx0XHRcdHJldHVybiBvYmo7XG5cdFx0XHR9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuXHRcdFx0XHRyZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdFx0cmV0dXJuIG5ldyBwbGF0Zm9ybW1hbmFnZXJfQnVkZ2V0KCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0XHQvKmdzLmluZm8oXCJCdWRnZXQuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmNvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLmNvZGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLm5hbWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmoucmVtYXJrKSkpO1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmoucmVtYXJrKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5idWRnZXRfUHJvamVjdHMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5idWRnZXRfUHJvamVjdHMobmV3IHBsYXRmb3JtbWFuYWdlcl9Qcm9qZWN0KCkuX2Zyb21Eb2N1bWVudChvYmouYnVkZ2V0X1Byb2plY3RzKSk7XG5cblx0XHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiQnVkZ2V0XCIpe1xuXHRcdFx0XHRcdGdzLmluZm8oXCJCdWRnZXQuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgY29uc3RydWN0b3I6IFwiICsgb2JqLmNvbnN0cnVjdG9yLm5hbWUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRncy5pbmZvKFwiQnVkZ2V0Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IFwiICsgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHRncy5pbmZvKFwiQnVkZ2V0Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHRcdH1cblxuXHRcdC8qZ3MuaW5mbyhcIkJ1ZGdldC5fZnJvbURvY3VtZW50KCk6IFwiKyBcIklkIFwiKyBcInRoaXMuSWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5JZCwgbnVsbCwgNCkpOyovXG5cdFx0Lypncy5pbmZvKFwiQnVkZ2V0Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7Ki9cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9uZXcoYykge1xuXHRcdGlmICghYykgYyA9IHRoaXMuX190eXBlO1xuXHRcdGlmIChjLmluZGV4T2YoJ3BsYXRmb3JtbWFuYWdlcl8nKSAhPSAwKSBjID0gKHtcblx0XHRcdFBsYXRmb3JtOiBcInBsYXRmb3JtbWFuYWdlcl9QbGF0Zm9ybVwiLFxuXHRcdFx0VXNlcjogXCJwbGF0Zm9ybW1hbmFnZXJfVXNlclwiLFxuXHRcdFx0UmVxdWlyZW1lbnQ6IFwicGxhdGZvcm1tYW5hZ2VyX1JlcXVpcmVtZW50XCIsXG5cdFx0XHRFZmZvcnRfRXN0aW1hdGU6IFwicGxhdGZvcm1tYW5hZ2VyX0VmZm9ydF9Fc3RpbWF0ZVwiLFxuXHRcdFx0RWZmb3J0OiBcInBsYXRmb3JtbWFuYWdlcl9FZmZvcnRcIixcblx0XHRcdEJ1ZGdldDogXCJwbGF0Zm9ybW1hbmFnZXJfQnVkZ2V0XCIsXG5cdFx0XHRBZ2VuZGFfSXRlbTogXCJwbGF0Zm9ybW1hbmFnZXJfQWdlbmRhX0l0ZW1cIixcblx0XHRcdE1lZXRpbmdfQWdlbmRhOiBcInBsYXRmb3JtbWFuYWdlcl9NZWV0aW5nX0FnZW5kYVwiLFxuXHRcdFx0RGVjaXNpb25fT3B0aW9uOiBcInBsYXRmb3JtbWFuYWdlcl9EZWNpc2lvbl9PcHRpb25cIixcblx0XHRcdERlY2lzaW9uOiBcInBsYXRmb3JtbWFuYWdlcl9EZWNpc2lvblwiLFxuXHRcdFx0TWVldGluZ19NaW51dGU6IFwicGxhdGZvcm1tYW5hZ2VyX01lZXRpbmdfTWludXRlXCIsXG5cdFx0XHRNZWV0aW5nX1NlcmllczogXCJwbGF0Zm9ybW1hbmFnZXJfTWVldGluZ19TZXJpZXNcIixcblx0XHRcdE1lZXRpbmc6IFwicGxhdGZvcm1tYW5hZ2VyX01lZXRpbmdcIixcblx0XHRcdEJvYXJkOiBcInBsYXRmb3JtbWFuYWdlcl9Cb2FyZFwiLFxuXHRcdFx0Qm9hcmRfTWVtYmVyOiBcInBsYXRmb3JtbWFuYWdlcl9Cb2FyZF9NZW1iZXJcIixcblx0XHRcdEZyZXF1ZW5jeTogXCJwbGF0Zm9ybW1hbmFnZXJfRnJlcXVlbmN5XCIsXG5cdFx0XHRNb2R1bGU6IFwicGxhdGZvcm1tYW5hZ2VyX01vZHVsZVwiLFxuXHRcdFx0Q2FwYWJpbGl0eTogXCJwbGF0Zm9ybW1hbmFnZXJfQ2FwYWJpbGl0eVwiLFxuXHRcdFx0VGVhbTogXCJwbGF0Zm9ybW1hbmFnZXJfVGVhbVwiLFxuXHRcdFx0UHJvamVjdDogXCJwbGF0Zm9ybW1hbmFnZXJfUHJvamVjdFwiLFxuXHRcdFx0VGVhbV9NZW1iZXI6IFwicGxhdGZvcm1tYW5hZ2VyX1RlYW1fTWVtYmVyXCIsXG5cdFx0XHRSb2xlOiBcInBsYXRmb3JtbWFuYWdlcl9Sb2xlXCIsXG5cdFx0fSlbY107XG5cdFx0cmV0dXJuIG5ldyhncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBnbG9iYWwgOiB4Xzc4NjExX3BsYXRmb3JtXzApW2NdKCk7XG5cdH1cblxuXHRfdG9Eb2N1bWVudChhckZpZWxkcykge1xuXG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCB7fTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSByZXQuc3lzX2lkID0gdGhpcy5JZDtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5hY3RpdmUgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5lbmFibGVkID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmNvZGUgPSB0aGlzLmNvZGUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm9yZGVyID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5kYXRlID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmIChyZXQuZGF0ZSAmJiB0eXBlb2YocmV0LmRhdGUudG9JU09TdHJpbmcpID09PSAnZnVuY3Rpb24nKSByZXQuZGF0ZSA9IHJldC5kYXRlLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5uYW1lID0gdGhpcy5uYW1lKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQucmVtYXJrID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKHR5cGVvZihyZXQucmVtYXJrKSA9PT0gJ29iamVjdCcpIHJldC5yZW1hcmsgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NEVuY29kZShKU09OLnN0cmluZ2lmeShyZXQucmVtYXJrKSk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuYnVkZ2V0X1Byb2plY3RzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmJ1ZGdldF9Qcm9qZWN0cyA9IHRoaXMuYnVkZ2V0X1Byb2plY3RzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdFx0fSk7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRkZWxldGUgcmV0W2tdO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF91bmlxdWUoa2V5cywgcmV0KSB7XG5cdFx0cmV0ID0gcmV0IHx8IG5ldyBwbGF0Zm9ybW1hbmFnZXJfQnVkZ2V0KCk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdC8vIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7XG5cdFx0aWYgKCFrZXlzKSB7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImNvZGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJuYW1lXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubmFtZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInJlbWFya1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3F1ZXJ5KGdxKSB7XG5cdFx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF83ODYxMV9wbGF0Zm9ybV8wX2J1ZGdldCcsIFsnKiddKVsneF83ODYxMV9wbGF0Zm9ybV8wX2J1ZGdldCddKTtcblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgneF83ODYxMV9wbGF0Zm9ybV8wX2J1ZGdldCcpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KSh0aGlzKSk7XG5cdFx0aWYgKGlkZiA9PSAnSWQnKSBpZGYgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3RpdmVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdFx0LyogZ3MuaW5mbyhcIkJ1ZGdldC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VuYWJsZWQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qIGdzLmluZm8oXCJCdWRnZXQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdFx0LyogZ3MuaW5mbyhcIkJ1ZGdldC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnY29kZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZGVyJykgPj0gMCkge1xuXHRcdFx0XHQvKiBncy5pbmZvKFwiQnVkZ2V0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0XHQvKiBncy5pbmZvKFwiQnVkZ2V0Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qIGdzLmluZm8oXCJCdWRnZXQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ25hbWUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX3JlbWFya19jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZW1hcmsnKSA+PSAwKSB7XG5cdFx0XHRcdC8qIGdzLmluZm8oXCJCdWRnZXQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZW1hcmsnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHRcdC8qIGdzLmluZm8oXCJCdWRnZXQuX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdFx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG5cdH1cblxuXHRfc2F2ZShvYmopIHtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHBsYXRmb3JtbWFuYWdlcl9CdWRnZXQoKS5fc2F2ZShvKVxuXHRcdH0pO1xuXG5cdFx0bGV0IF9vYmogPSB7fTtcblxuXHRcdC8qZ3MuaW5mbyhcIkJ1ZGdldC5fc2F2ZSgpOiBcIisgXCIuLi4gXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRPYmplY3Qua2V5cyhvYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF83ODYxMV9wbGF0Zm9ybV8wX2J1ZGdldCcsIFsnKiddKVsneF83ODYxMV9wbGF0Zm9ybV8wX2J1ZGdldCddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdFx0fSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHRcdGdzLmluZm8oXCJCdWRnZXQuX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdFx0Z3MuaW5mbyhcIkJ1ZGdldC5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGxldCBfdGhpcyA9IG51bGw7XG5cdFx0aWYgKG9iai5fX2tleXMpIHtcblx0XHRcdGxldCBrT2JqID0ge307XG5cdFx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpKSk7XG5cdFx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHRrT2JqW2tdID0gX29ialtrXVxuXHRcdFx0fSk7XG5cdFx0XHRfdGhpcyA9IG5ldyBwbGF0Zm9ybW1hbmFnZXJfQnVkZ2V0KCkuX2Zyb21Eb2N1bWVudChrT2JqKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0X3RoaXMgPSBuZXcgcGxhdGZvcm1tYW5hZ2VyX0J1ZGdldCgpLl9mcm9tRG9jdW1lbnQoX29iaikuX3VuaXF1ZSgpO1xuXHRcdH1cblxuXHRcdC8qZ3MuaW5mbyhcIkJ1ZGdldC5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdFx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRcdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHRcdHRyeSB7XG5cdFx0XHRncy5pbmZvKFwiQnVkZ2V0Ll9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0Z3MuaW5mbyhcIkJ1ZGdldC5fc2F2ZSgpOiBcIiArIFwicmVuYW1pbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHR2YXIgbGsgPSBrLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRcdF9vYmpbbGtdID0gX29ialtrXTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9KTtcblxuXHRcdFx0bGV0IGdxID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KG9iai5fX3R5cGUgfHwgJ3hfNzg2MTFfcGxhdGZvcm1fMF9idWRnZXQnKTtcblx0XHRcdC8qZ3MuaW5mbyhcIkJ1ZGdldC5fc2F2ZSgpOiBcIisgXCJ1cHNlcnRpbmcuLi4gXCIrIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7Ki9cblx0XHRcdGlmIChfb2JqLnN5c19pZCkge1xuXHRcdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X29iai5zeXNfaWQgPSBncy5nZW5lcmF0ZUdVSUQoKTtcblx0XHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0XHR9XG5cdFx0XHRsZXQgX2ZPYmogPSB7fTtcblx0XHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpKSk7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4Xzc4NjExX3BsYXRmb3JtXzBfYnVkZ2V0JywgWycqJ10pWyd4Xzc4NjExX3BsYXRmb3JtXzBfYnVkZ2V0J10pKSkpO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRncy5pbmZvKFwiQnVkZ2V0Ll9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0XHRncy5pbmZvKFwiQnVkZ2V0Ll9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fVxuXG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLmJ1ZGdldF9Qcm9qZWN0cykpIHRoaXMuYnVkZ2V0X1Byb2plY3RzKG9iai5idWRnZXRfUHJvamVjdHMubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHBsYXRmb3JtbWFuYWdlcl9Qcm9qZWN0KCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBCdWRnZXQuc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzdG9yZShfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKGxvZ09iaikge1xuXHRcdFx0Z3MuaW5mbyhcIkJ1ZGdldC5zdG9yZSgpOiBcIiArIFwibG9nT2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KGxvZ09iaiwgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdGdzLmluZm8oXCJCdWRnZXQuc3RvcmUoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRncy5pbmZvKFwiQnVkZ2V0LnN0b3JlKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHRncy5pbmZvKFwiQnVkZ2V0LnN0b3JlKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIHN0b3JlIGxvY2FsbHlcblx0XHRcdGxldCBfdGhpcyA9IHRoaXMuX3VuaXF1ZSgpLmZpbmQoKTtcblx0XHRcdGlmIChfdGhpcykgdGhpcy5JZCA9IF90aGlzLklkO1xuXG5cdFx0XHRyZXR1cm4gdGhpcy5fc2F2ZSh0aGlzLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBCdWRnZXQuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmRBbGwoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihsb2dPYmopIHtcblx0XHRcdGdzLmluZm8oXCJCdWRnZXQuZmluZEFsbCgpOiBcIiArIFwibG9nT2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KGxvZ09iaiwgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdGdzLmluZm8oXCJCdWRnZXQuZmluZEFsbCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGdzLmluZm8oXCJCdWRnZXQuZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0Z3MuaW5mbyhcIkJ1ZGdldC5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIGZpbmRBbGwgbG9jYWxseVxuXHRcdFx0bGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKFwiQnVkZ2V0XCIpO1xuXHRcdFx0Z3IuYWRkRW5jb2RlZFF1ZXJ5KHRoaXMuX3RvRVF1ZXJ5KCkpO1xuXHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudChncik7XG5cblx0XHRcdC8vcmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh0aGlzLl9xdWVyeSgpLnNlbGVjdChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4Xzc4NjExX3BsYXRmb3JtXzBfYnVkZ2V0JywgWycqJ10pWyd4Xzc4NjExX3BsYXRmb3JtXzBfYnVkZ2V0J10pKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIEJ1ZGdldC5maW5kKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZChfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKGxvZ09iaikge1xuXHRcdFx0Z3MuaW5mbyhcIkJ1ZGdldC5maW5kKCk6IFwiICsgXCJsb2dPYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkobG9nT2JqLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0Z3MuaW5mbyhcIkJ1ZGdldC5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Z3MuaW5mbyhcIkJ1ZGdldC5maW5kKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHRncy5pbmZvKFwiQnVkZ2V0LmZpbmQoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0bGV0IHJldCA9IHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0cmV0dXJuIHJldC5sZW5ndGggPyByZXRbMF0gOiBudWxsO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxufSJ9LHsiYWN0aXZlIjp0cnVlLCJhY2Nlc3MiOiJwYWNrYWdlX3ByaXZhdGUiLCJjYWxsZXJfYWNjZXNzIjpudWxsLCJzeXNfbmFtZSI6InBsYXRmb3JtbWFuYWdlcl9EZWNpc2lvbiIsImFwaV9uYW1lIjoieF83ODYxMV9wbGF0Zm9ybV8wLnBsYXRmb3JtbWFuYWdlcl9EZWNpc2lvbiIsIm5hbWUiOiJwbGF0Zm9ybW1hbmFnZXJfRGVjaXNpb24iLCJzY3JpcHQiOiJjbGFzcyBwbGF0Zm9ybW1hbmFnZXJfRGVjaXNpb24ge1xuXHRjb25zdHJ1Y3RvcihpZCkge1xuXHRcdHVuZGVmaW5lZFxuXHRcdHRoaXMuSWQgPSBpZDtcblx0XHR0aGlzLl9fbW9kdWxlID0gXCJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwicGxhdGZvcm1tYW5hZ2VyX0RlY2lzaW9uXCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJwbGF0Zm9ybW1hbmFnZXJcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInBsYXRmb3JtbWFuYWdlclwiO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRGVjaXNpb24uYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBEZWNpc2lvbi5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRGVjaXNpb24uY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIERlY2lzaW9uLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIERlY2lzaW9uLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly9ncy5pbmZvKFwiRGVjaXNpb24uZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIERlY2lzaW9uLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBEZWNpc2lvbi5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIERlY2lzaW9uLmRlY2lzaW9uX0RlY2lzaW9uX09wdGlvbnMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkZWNpc2lvbl9EZWNpc2lvbl9PcHRpb25zKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhpcy5fZGVjaXNpb25fRGVjaXNpb25fT3B0aW9ucyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX2RlY2lzaW9uX0RlY2lzaW9uX09wdGlvbnNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RlY2lzaW9uX0RlY2lzaW9uX09wdGlvbnM7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRGVjaXNpb24uZGVjaXNpb25fTWVldGluZ3MgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkZWNpc2lvbl9NZWV0aW5ncyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2RlY2lzaW9uX01lZXRpbmdzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fZGVjaXNpb25fTWVldGluZ3NfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RlY2lzaW9uX01lZXRpbmdzO1xuXHRcdH1cblx0fVxuXG5cdF90b0VRdWVyeShzUGF0aCkge1xuXHRcdHNQYXRoID0gc1BhdGggfHwgJyc7XG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCAnJztcblxuXHRcdGlmICh0aGlzLl9hY3RpdmUpIHJldCArPSAnXicgKyBzUGF0aCArICdhY3RpdmUnICsgKHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JykgKyB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuYWJsZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmFibGVkJyArICh0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2NvZGUpIHJldCArPSAnXicgKyBzUGF0aCArICdjb2RlJyArICh0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nKSArIHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX29yZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnb3JkZXInICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMub3JkZXIoKTtcblxuXHRcdGlmICh0aGlzLl9kYXRlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF0ZScgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh0aGlzLl9uYW1lKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbmFtZScgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdyZW1hcmsnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0KHRoaXMuZGVjaXNpb25fRGVjaXNpb25fT3B0aW9ucygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZRGVjaXNpb25fT3B0aW9uLmRlY2lzaW9uLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHQodGhpcy5kZWNpc2lvbl9NZWV0aW5ncygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZTWVldGluZy5kZWNpc2lvbiw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0Z3MuaW5mbyhcIkRlY2lzaW9uLl90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykgcmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0Z3MuaW5mbyhcIkRlY2lzaW9uLl9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0Z3MuaW5mbyhcIkRlY2lzaW9uLl9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7IC8vIHRlc3RcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgcGxhdGZvcm1tYW5hZ2VyX0RlY2lzaW9uKCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0dHJ5IHtcblx0XHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0Lypncy5pbmZvKFwiRGVjaXNpb24uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdFx0fTtcblx0XHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRcdFx0aWYgKG9iai5nZXRUYWJsZU5hbWUoKSA9PSAnZWNjX3F1ZXVlJyAmJiBcIkRlY2lzaW9uXCIgIT0gJ2VjY19xdWV1ZScgJiYgb2JqLnNvdXJjZSA9PSBcIkRlY2lzaW9uXCIpIHtcblx0XHRcdFx0XHRcdG9iai5zdGF0ZSA9IFwicHJvY2Vzc2luZ1wiO1xuXHRcdFx0XHRcdFx0b2JqLnVwZGF0ZSgpO1xuXG5cdFx0XHRcdFx0XHRsZXQgcmVzcCA9IG5ldyBHbGlkZVJlY29yZCgnZWNjX3F1ZXVlJyk7XG5cdFx0XHRcdFx0XHRyZXNwLnJlc3BvbnNlX3RvID0gb2JqLnN5c19pZDtcblx0XHRcdFx0XHRcdHJlc3AucXVldWUgPSAnb3V0cHV0Jztcblx0XHRcdFx0XHRcdHJlc3AuYWdlbnQgPSBvYmouYWdlbnQ7XG5cdFx0XHRcdFx0XHRyZXNwLnRvcGljID0gb2JqLnRvcGljO1xuXHRcdFx0XHRcdFx0cmVzcC5uYW1lID0gb2JqLm5hbWU7XG5cdFx0XHRcdFx0XHRyZXNwLnNvdXJjZSA9IG9iai5zb3VyY2U7XG5cdFx0XHRcdFx0XHRyZXNwLmZyb21faG9zdCA9IG9iai5hZ2VudF9jb3JyZWxhdG9yO1xuXHRcdFx0XHRcdFx0cmVzcC5hZ2VudF9jb3JyZWxhdG9yID0gb2JqLmZyb21faG9zdDtcblxuXHRcdFx0XHRcdFx0bGV0IHJldCA9IG5ldyBwbGF0Zm9ybW1hbmFnZXJfRGVjaXNpb24oKS5fZnJvbURvY3VtZW50KCkuX2ludm9rZShvYmoubmFtZS50b1N0cmluZygpLCBvYmoucGF5bG9hZC50b1N0cmluZygpKTtcblx0XHRcdFx0XHRcdGlmIChBcnJheS5pc0FycmF5KHJldCkpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gcmV0Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIChyICYmIHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJykgPyByLl90b0RvY3VtZW50KCkgOiByO1xuXHRcdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAocmV0ICYmIHR5cGVvZihyZXQuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHJldC5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmVzcC5wYXlsb2FkID0gSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KTtcblxuXHRcdFx0XHRcdFx0cmVzcC5pbnNlcnQoKTtcblxuXHRcdFx0XHRcdFx0b2JqLnN0YXRlID0gXCJwcm9jZXNzZWRcIjtcblx0XHRcdFx0XHRcdG9iai51cGRhdGUoKTtcblx0XHRcdFx0XHRcdHJldHVybiByZXNwO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdFx0Y29kZTogb2JqLmdldFZhbHVlKFwiY29kZVwiKSxcblxuXHRcdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0XHRyZW1hcms6IG9iai5nZXRWYWx1ZShcInJlbWFya1wiKSxcblxuXHRcdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRvYmoucXVlcnkoKTtcblx0XHRcdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tRG9jdW1lbnQob2JqKSk7XG5cdFx0XHRcdFx0Lypncy5pbmZvKFwiRGVjaXNpb24uX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJnbGlkZSBvYmplY3RzIFwiKyBcImdyUmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KGdyUmV0LCBudWxsLCA0KSk7Ki9cblx0XHRcdFx0XHRyZXR1cm4gZ3JSZXQ7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSBpZiAob2JqLl9mcm9tRG9jdW1lbnQpIHtcblx0XHRcdFx0Z3MuaW5mbyhcIkRlY2lzaW9uLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0XHRyZXR1cm4gb2JqO1xuXHRcdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRcdHJldHVybiBuZXcgcGxhdGZvcm1tYW5hZ2VyX0RlY2lzaW9uKCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0XHQvKmdzLmluZm8oXCJEZWNpc2lvbi5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuY29kZShvYmouY29kZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubmFtZShvYmoubmFtZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsoU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5yZW1hcmspKSk7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5yZW1hcmspO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRlY2lzaW9uX0RlY2lzaW9uX09wdGlvbnMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5kZWNpc2lvbl9EZWNpc2lvbl9PcHRpb25zKG5ldyBwbGF0Zm9ybW1hbmFnZXJfRGVjaXNpb25fT3B0aW9uKCkuX2Zyb21Eb2N1bWVudChvYmouZGVjaXNpb25fRGVjaXNpb25fT3B0aW9ucykpO1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGVjaXNpb25fTWVldGluZ3MpICE9PSAndW5kZWZpbmVkJykgdGhpcy5kZWNpc2lvbl9NZWV0aW5ncyhuZXcgcGxhdGZvcm1tYW5hZ2VyX01lZXRpbmcoKS5fZnJvbURvY3VtZW50KG9iai5kZWNpc2lvbl9NZWV0aW5ncykpO1xuXG5cdFx0XHRcdH0gZWxzZSB7IC8vIGlmKG9iai5jb25zdHJ1Y3Rvci5uYW1lPT1cIkRlY2lzaW9uXCIpe1xuXHRcdFx0XHRcdGdzLmluZm8oXCJEZWNpc2lvbi5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGdzLmluZm8oXCJEZWNpc2lvbi5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0Z3MuaW5mbyhcIkRlY2lzaW9uLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHRcdH1cblxuXHRcdC8qZ3MuaW5mbyhcIkRlY2lzaW9uLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0XHQvKmdzLmluZm8oXCJEZWNpc2lvbi5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfbmV3KGMpIHtcblx0XHRpZiAoIWMpIGMgPSB0aGlzLl9fdHlwZTtcblx0XHRpZiAoYy5pbmRleE9mKCdwbGF0Zm9ybW1hbmFnZXJfJykgIT0gMCkgYyA9ICh7XG5cdFx0XHRQbGF0Zm9ybTogXCJwbGF0Zm9ybW1hbmFnZXJfUGxhdGZvcm1cIixcblx0XHRcdFVzZXI6IFwicGxhdGZvcm1tYW5hZ2VyX1VzZXJcIixcblx0XHRcdFJlcXVpcmVtZW50OiBcInBsYXRmb3JtbWFuYWdlcl9SZXF1aXJlbWVudFwiLFxuXHRcdFx0RWZmb3J0X0VzdGltYXRlOiBcInBsYXRmb3JtbWFuYWdlcl9FZmZvcnRfRXN0aW1hdGVcIixcblx0XHRcdEVmZm9ydDogXCJwbGF0Zm9ybW1hbmFnZXJfRWZmb3J0XCIsXG5cdFx0XHRCdWRnZXQ6IFwicGxhdGZvcm1tYW5hZ2VyX0J1ZGdldFwiLFxuXHRcdFx0QWdlbmRhX0l0ZW06IFwicGxhdGZvcm1tYW5hZ2VyX0FnZW5kYV9JdGVtXCIsXG5cdFx0XHRNZWV0aW5nX0FnZW5kYTogXCJwbGF0Zm9ybW1hbmFnZXJfTWVldGluZ19BZ2VuZGFcIixcblx0XHRcdERlY2lzaW9uX09wdGlvbjogXCJwbGF0Zm9ybW1hbmFnZXJfRGVjaXNpb25fT3B0aW9uXCIsXG5cdFx0XHREZWNpc2lvbjogXCJwbGF0Zm9ybW1hbmFnZXJfRGVjaXNpb25cIixcblx0XHRcdE1lZXRpbmdfTWludXRlOiBcInBsYXRmb3JtbWFuYWdlcl9NZWV0aW5nX01pbnV0ZVwiLFxuXHRcdFx0TWVldGluZ19TZXJpZXM6IFwicGxhdGZvcm1tYW5hZ2VyX01lZXRpbmdfU2VyaWVzXCIsXG5cdFx0XHRNZWV0aW5nOiBcInBsYXRmb3JtbWFuYWdlcl9NZWV0aW5nXCIsXG5cdFx0XHRCb2FyZDogXCJwbGF0Zm9ybW1hbmFnZXJfQm9hcmRcIixcblx0XHRcdEJvYXJkX01lbWJlcjogXCJwbGF0Zm9ybW1hbmFnZXJfQm9hcmRfTWVtYmVyXCIsXG5cdFx0XHRGcmVxdWVuY3k6IFwicGxhdGZvcm1tYW5hZ2VyX0ZyZXF1ZW5jeVwiLFxuXHRcdFx0TW9kdWxlOiBcInBsYXRmb3JtbWFuYWdlcl9Nb2R1bGVcIixcblx0XHRcdENhcGFiaWxpdHk6IFwicGxhdGZvcm1tYW5hZ2VyX0NhcGFiaWxpdHlcIixcblx0XHRcdFRlYW06IFwicGxhdGZvcm1tYW5hZ2VyX1RlYW1cIixcblx0XHRcdFByb2plY3Q6IFwicGxhdGZvcm1tYW5hZ2VyX1Byb2plY3RcIixcblx0XHRcdFRlYW1fTWVtYmVyOiBcInBsYXRmb3JtbWFuYWdlcl9UZWFtX01lbWJlclwiLFxuXHRcdFx0Um9sZTogXCJwbGF0Zm9ybW1hbmFnZXJfUm9sZVwiLFxuXHRcdH0pW2NdO1xuXHRcdHJldHVybiBuZXcoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gZ2xvYmFsIDogeF83ODYxMV9wbGF0Zm9ybV8wKVtjXSgpO1xuXHR9XG5cblx0X3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5jb2RlID0gdGhpcy5jb2RlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmRlY2lzaW9uX0RlY2lzaW9uX09wdGlvbnMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGVjaXNpb25fRGVjaXNpb25fT3B0aW9ucyA9IHRoaXMuZGVjaXNpb25fRGVjaXNpb25fT3B0aW9ucygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuZGVjaXNpb25fTWVldGluZ3MoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGVjaXNpb25fTWVldGluZ3MgPSB0aGlzLmRlY2lzaW9uX01lZXRpbmdzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdFx0fSk7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRkZWxldGUgcmV0W2tdO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF91bmlxdWUoa2V5cywgcmV0KSB7XG5cdFx0cmV0ID0gcmV0IHx8IG5ldyBwbGF0Zm9ybW1hbmFnZXJfRGVjaXNpb24oKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0XHRpZiAoIWtleXMpIHtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImVuYWJsZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmFibGVkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuYWJsZWQodGhpcy5lbmFibGVkKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY29kZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVtYXJrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfcXVlcnkoZ3EpIHtcblx0XHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4Xzc4NjExX3BsYXRmb3JtXzBfZGVjaXNpb24nLCBbJyonXSlbJ3hfNzg2MTFfcGxhdGZvcm1fMF9kZWNpc2lvbiddKTtcblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgneF83ODYxMV9wbGF0Zm9ybV8wX2RlY2lzaW9uJyk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKHRoaXMpKTtcblx0XHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0XHQvKiBncy5pbmZvKFwiRGVjaXNpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0XHQvKiBncy5pbmZvKFwiRGVjaXNpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdFx0LyogZ3MuaW5mbyhcIkRlY2lzaW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdjb2RlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHRcdC8qIGdzLmluZm8oXCJEZWNpc2lvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF0ZScpID49IDApIHtcblx0XHRcdFx0LyogZ3MuaW5mbyhcIkRlY2lzaW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qIGdzLmluZm8oXCJEZWNpc2lvbi5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3JlbWFyaycpID49IDApIHtcblx0XHRcdFx0LyogZ3MuaW5mbyhcIkRlY2lzaW9uLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVtYXJrJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0XHQvKiBncy5pbmZvKFwiRGVjaXNpb24uX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdFx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG5cdH1cblxuXHRfc2F2ZShvYmopIHtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHBsYXRmb3JtbWFuYWdlcl9EZWNpc2lvbigpLl9zYXZlKG8pXG5cdFx0fSk7XG5cblx0XHRsZXQgX29iaiA9IHt9O1xuXG5cdFx0Lypncy5pbmZvKFwiRGVjaXNpb24uX3NhdmUoKTogXCIrIFwiLi4uIFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfNzg2MTFfcGxhdGZvcm1fMF9kZWNpc2lvbicsIFsnKiddKVsneF83ODYxMV9wbGF0Zm9ybV8wX2RlY2lzaW9uJ10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0XHR9KTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdFx0Z3MuaW5mbyhcIkRlY2lzaW9uLl9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHRcdGdzLmluZm8oXCJEZWNpc2lvbi5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGxldCBfdGhpcyA9IG51bGw7XG5cdFx0aWYgKG9iai5fX2tleXMpIHtcblx0XHRcdGxldCBrT2JqID0ge307XG5cdFx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpKSk7XG5cdFx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHRrT2JqW2tdID0gX29ialtrXVxuXHRcdFx0fSk7XG5cdFx0XHRfdGhpcyA9IG5ldyBwbGF0Zm9ybW1hbmFnZXJfRGVjaXNpb24oKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfdGhpcyA9IG5ldyBwbGF0Zm9ybW1hbmFnZXJfRGVjaXNpb24oKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0XHR9XG5cblx0XHQvKmdzLmluZm8oXCJEZWNpc2lvbi5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdFx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRcdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHRcdHRyeSB7XG5cdFx0XHRncy5pbmZvKFwiRGVjaXNpb24uX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRcdHJldHVybiBrLnRvTG93ZXJDYXNlKCkgIT0gaztcblx0XHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHRncy5pbmZvKFwiRGVjaXNpb24uX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSk7XG5cblx0XHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICd4Xzc4NjExX3BsYXRmb3JtXzBfZGVjaXNpb24nKTtcblx0XHRcdC8qZ3MuaW5mbyhcIkRlY2lzaW9uLl9zYXZlKCk6IFwiKyBcInVwc2VydGluZy4uLiBcIisgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTsqL1xuXHRcdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRcdGdxID0gZ3Eud2hlcmUoJ3N5c19pZCcsIF9vYmouc3lzX2lkKS51cGRhdGUoX29iaik7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0XHRncSA9IGdxLmluc2VydChfb2JqKTtcblx0XHRcdH1cblx0XHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdFx0X2ZPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSkpKTtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChfb2JqID0gT2JqZWN0LmFzc2lnbihfZk9iaiwgZ3EuZ2V0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfNzg2MTFfcGxhdGZvcm1fMF9kZWNpc2lvbicsIFsnKiddKVsneF83ODYxMV9wbGF0Zm9ybV8wX2RlY2lzaW9uJ10pKSkpO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRncy5pbmZvKFwiRGVjaXNpb24uX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiZXg6IFwiICsgSlNPTi5zdHJpbmdpZnkoZXgsIG51bGwsIDQpKTtcblx0XHRcdGdzLmluZm8oXCJEZWNpc2lvbi5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH1cblxuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5kZWNpc2lvbl9EZWNpc2lvbl9PcHRpb25zKSkgdGhpcy5kZWNpc2lvbl9EZWNpc2lvbl9PcHRpb25zKG9iai5kZWNpc2lvbl9EZWNpc2lvbl9PcHRpb25zLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBwbGF0Zm9ybW1hbmFnZXJfRGVjaXNpb25fT3B0aW9uKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLmRlY2lzaW9uX01lZXRpbmdzKSkgdGhpcy5kZWNpc2lvbl9NZWV0aW5ncyhvYmouZGVjaXNpb25fTWVldGluZ3MubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHBsYXRmb3JtbWFuYWdlcl9NZWV0aW5nKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBEZWNpc2lvbi5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHN0b3JlKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obG9nT2JqKSB7XG5cdFx0XHRncy5pbmZvKFwiRGVjaXNpb24uc3RvcmUoKTogXCIgKyBcImxvZ09iajogXCIgKyBKU09OLnN0cmluZ2lmeShsb2dPYmosIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHRncy5pbmZvKFwiRGVjaXNpb24uc3RvcmUoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRncy5pbmZvKFwiRGVjaXNpb24uc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdGdzLmluZm8oXCJEZWNpc2lvbi5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0XHRsZXQgX3RoaXMgPSB0aGlzLl91bmlxdWUoKS5maW5kKCk7XG5cdFx0XHRpZiAoX3RoaXMpIHRoaXMuSWQgPSBfdGhpcy5JZDtcblxuXHRcdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRGVjaXNpb24uZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmRBbGwoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihsb2dPYmopIHtcblx0XHRcdGdzLmluZm8oXCJEZWNpc2lvbi5maW5kQWxsKCk6IFwiICsgXCJsb2dPYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkobG9nT2JqLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0Z3MuaW5mbyhcIkRlY2lzaW9uLmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRncy5pbmZvKFwiRGVjaXNpb24uZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0Z3MuaW5mbyhcIkRlY2lzaW9uLmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoXCJEZWNpc2lvblwiKTtcblx0XHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0XHQvL3JldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQodGhpcy5fcXVlcnkoKS5zZWxlY3QoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF83ODYxMV9wbGF0Zm9ybV8wX2RlY2lzaW9uJywgWycqJ10pWyd4Xzc4NjExX3BsYXRmb3JtXzBfZGVjaXNpb24nXSkpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRGVjaXNpb24uZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmQoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihsb2dPYmopIHtcblx0XHRcdGdzLmluZm8oXCJEZWNpc2lvbi5maW5kKCk6IFwiICsgXCJsb2dPYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkobG9nT2JqLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0Z3MuaW5mbyhcIkRlY2lzaW9uLmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRncy5pbmZvKFwiRGVjaXNpb24uZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0Z3MuaW5mbyhcIkRlY2lzaW9uLmZpbmQoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0bGV0IHJldCA9IHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0cmV0dXJuIHJldC5sZW5ndGggPyByZXRbMF0gOiBudWxsO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxufSJ9LHsiYWN0aXZlIjp0cnVlLCJhY2Nlc3MiOiJwYWNrYWdlX3ByaXZhdGUiLCJjYWxsZXJfYWNjZXNzIjpudWxsLCJzeXNfbmFtZSI6InBsYXRmb3JtbWFuYWdlcl9Cb2FyZCIsImFwaV9uYW1lIjoieF83ODYxMV9wbGF0Zm9ybV8wLnBsYXRmb3JtbWFuYWdlcl9Cb2FyZCIsIm5hbWUiOiJwbGF0Zm9ybW1hbmFnZXJfQm9hcmQiLCJzY3JpcHQiOiJjbGFzcyBwbGF0Zm9ybW1hbmFnZXJfQm9hcmQge1xuXHRjb25zdHJ1Y3RvcihpZCkge1xuXHRcdHVuZGVmaW5lZFxuXHRcdHRoaXMuSWQgPSBpZDtcblx0XHR0aGlzLl9fbW9kdWxlID0gXCJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwicGxhdGZvcm1tYW5hZ2VyX0JvYXJkXCI7XG5cdFx0dGhpcy5fX2FsaWFzID0gXCJwbGF0Zm9ybW1hbmFnZXJcIjtcblx0XHR0aGlzLl9fc2NvcGUgPSBcInBsYXRmb3JtbWFuYWdlclwiO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogQm9hcmQuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBCb2FyZC5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogQm9hcmQuY29kZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGNvZGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2NvZGUgPSB2O1xuXHRcdFx0dGhpcy5fY29kZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9jb2RlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEJvYXJkLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEJvYXJkLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly9ncy5pbmZvKFwiQm9hcmQuZGF0ZSgpOiBcIisgXCJ0eXBlb2Yodik6IFwiICsgSlNPTi5zdHJpbmdpZnkodHlwZW9mKHYpLCBudWxsLCA0KSk7XG5cblx0XHRcdHRoaXMuX2RhdGUgPSB2O1xuXHRcdFx0dGhpcy5fZGF0ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXRlO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEJvYXJkLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBCb2FyZC5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEJvYXJkLmJvYXJkX01lZXRpbmdzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Ym9hcmRfTWVldGluZ3ModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9ib2FyZF9NZWV0aW5ncyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX2JvYXJkX01lZXRpbmdzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9ib2FyZF9NZWV0aW5ncztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBCb2FyZC5ib2FyZF9Cb2FyZF9NZW1iZXJzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Ym9hcmRfQm9hcmRfTWVtYmVycyh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHRoaXMuX2JvYXJkX0JvYXJkX01lbWJlcnMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9ib2FyZF9Cb2FyZF9NZW1iZXJzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9ib2FyZF9Cb2FyZF9NZW1iZXJzO1xuXHRcdH1cblx0fVxuXG5cdF90b0VRdWVyeShzUGF0aCkge1xuXHRcdHNQYXRoID0gc1BhdGggfHwgJyc7XG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCAnJztcblxuXHRcdGlmICh0aGlzLl9hY3RpdmUpIHJldCArPSAnXicgKyBzUGF0aCArICdhY3RpdmUnICsgKHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JykgKyB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0aWYgKHRoaXMuX2VuYWJsZWQpIHJldCArPSAnXicgKyBzUGF0aCArICdlbmFibGVkJyArICh0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nKSArIHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0aWYgKHRoaXMuX2NvZGUpIHJldCArPSAnXicgKyBzUGF0aCArICdjb2RlJyArICh0aGlzLl9jb2RlX2Nvb3AgfHwgJz0nKSArIHRoaXMuY29kZSgpO1xuXG5cdFx0aWYgKHRoaXMuX29yZGVyKSByZXQgKz0gJ14nICsgc1BhdGggKyAnb3JkZXInICsgKHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nKSArIHRoaXMub3JkZXIoKTtcblxuXHRcdGlmICh0aGlzLl9kYXRlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZGF0ZScgKyAodGhpcy5fZGF0ZV9jb29wIHx8ICc9JykgKyB0aGlzLmRhdGUoKTtcblxuXHRcdGlmICh0aGlzLl9uYW1lKSByZXQgKz0gJ14nICsgc1BhdGggKyAnbmFtZScgKyAodGhpcy5fbmFtZV9jb29wIHx8ICc9JykgKyB0aGlzLm5hbWUoKTtcblxuXHRcdGlmICh0aGlzLl9yZW1hcmspIHJldCArPSAnXicgKyBzUGF0aCArICdyZW1hcmsnICsgKHRoaXMuX3JlbWFya19jb29wIHx8ICc9JykgKyB0aGlzLnJlbWFyaygpO1xuXG5cdFx0KHRoaXMuYm9hcmRfTWVldGluZ3MoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWU1lZXRpbmcuYm9hcmQsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLmJvYXJkX0JvYXJkX01lbWJlcnMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWUJvYXJkX01lbWJlci5ib2FyZCw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0Z3MuaW5mbyhcIkJvYXJkLl90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykgcmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0Z3MuaW5mbyhcIkJvYXJkLl9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0Z3MuaW5mbyhcIkJvYXJkLl9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7IC8vIHRlc3RcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgcGxhdGZvcm1tYW5hZ2VyX0JvYXJkKCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0dHJ5IHtcblx0XHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0Lypncy5pbmZvKFwiQm9hcmQuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdFx0fTtcblx0XHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRcdFx0aWYgKG9iai5nZXRUYWJsZU5hbWUoKSA9PSAnZWNjX3F1ZXVlJyAmJiBcIkJvYXJkXCIgIT0gJ2VjY19xdWV1ZScgJiYgb2JqLnNvdXJjZSA9PSBcIkJvYXJkXCIpIHtcblx0XHRcdFx0XHRcdG9iai5zdGF0ZSA9IFwicHJvY2Vzc2luZ1wiO1xuXHRcdFx0XHRcdFx0b2JqLnVwZGF0ZSgpO1xuXG5cdFx0XHRcdFx0XHRsZXQgcmVzcCA9IG5ldyBHbGlkZVJlY29yZCgnZWNjX3F1ZXVlJyk7XG5cdFx0XHRcdFx0XHRyZXNwLnJlc3BvbnNlX3RvID0gb2JqLnN5c19pZDtcblx0XHRcdFx0XHRcdHJlc3AucXVldWUgPSAnb3V0cHV0Jztcblx0XHRcdFx0XHRcdHJlc3AuYWdlbnQgPSBvYmouYWdlbnQ7XG5cdFx0XHRcdFx0XHRyZXNwLnRvcGljID0gb2JqLnRvcGljO1xuXHRcdFx0XHRcdFx0cmVzcC5uYW1lID0gb2JqLm5hbWU7XG5cdFx0XHRcdFx0XHRyZXNwLnNvdXJjZSA9IG9iai5zb3VyY2U7XG5cdFx0XHRcdFx0XHRyZXNwLmZyb21faG9zdCA9IG9iai5hZ2VudF9jb3JyZWxhdG9yO1xuXHRcdFx0XHRcdFx0cmVzcC5hZ2VudF9jb3JyZWxhdG9yID0gb2JqLmZyb21faG9zdDtcblxuXHRcdFx0XHRcdFx0bGV0IHJldCA9IG5ldyBwbGF0Zm9ybW1hbmFnZXJfQm9hcmQoKS5fZnJvbURvY3VtZW50KCkuX2ludm9rZShvYmoubmFtZS50b1N0cmluZygpLCBvYmoucGF5bG9hZC50b1N0cmluZygpKTtcblx0XHRcdFx0XHRcdGlmIChBcnJheS5pc0FycmF5KHJldCkpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gcmV0Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIChyICYmIHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJykgPyByLl90b0RvY3VtZW50KCkgOiByO1xuXHRcdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAocmV0ICYmIHR5cGVvZihyZXQuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHJldC5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmVzcC5wYXlsb2FkID0gSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KTtcblxuXHRcdFx0XHRcdFx0cmVzcC5pbnNlcnQoKTtcblxuXHRcdFx0XHRcdFx0b2JqLnN0YXRlID0gXCJwcm9jZXNzZWRcIjtcblx0XHRcdFx0XHRcdG9iai51cGRhdGUoKTtcblx0XHRcdFx0XHRcdHJldHVybiByZXNwO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdFx0Y29kZTogb2JqLmdldFZhbHVlKFwiY29kZVwiKSxcblxuXHRcdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0XHRyZW1hcms6IG9iai5nZXRWYWx1ZShcInJlbWFya1wiKSxcblxuXHRcdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRvYmoucXVlcnkoKTtcblx0XHRcdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tRG9jdW1lbnQob2JqKSk7XG5cdFx0XHRcdFx0Lypncy5pbmZvKFwiQm9hcmQuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJnbGlkZSBvYmplY3RzIFwiKyBcImdyUmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KGdyUmV0LCBudWxsLCA0KSk7Ki9cblx0XHRcdFx0XHRyZXR1cm4gZ3JSZXQ7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSBpZiAob2JqLl9mcm9tRG9jdW1lbnQpIHtcblx0XHRcdFx0Z3MuaW5mbyhcIkJvYXJkLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0XHRyZXR1cm4gb2JqO1xuXHRcdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRcdHJldHVybiBuZXcgcGxhdGZvcm1tYW5hZ2VyX0JvYXJkKCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0XHQvKmdzLmluZm8oXCJCb2FyZC5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuY29kZShvYmouY29kZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubmFtZShvYmoubmFtZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsoU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5yZW1hcmspKSk7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5yZW1hcmspO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmJvYXJkX01lZXRpbmdzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuYm9hcmRfTWVldGluZ3MobmV3IHBsYXRmb3JtbWFuYWdlcl9NZWV0aW5nKCkuX2Zyb21Eb2N1bWVudChvYmouYm9hcmRfTWVldGluZ3MpKTtcblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmJvYXJkX0JvYXJkX01lbWJlcnMpICE9PSAndW5kZWZpbmVkJykgdGhpcy5ib2FyZF9Cb2FyZF9NZW1iZXJzKG5ldyBwbGF0Zm9ybW1hbmFnZXJfQm9hcmRfTWVtYmVyKCkuX2Zyb21Eb2N1bWVudChvYmouYm9hcmRfQm9hcmRfTWVtYmVycykpO1xuXG5cdFx0XHRcdH0gZWxzZSB7IC8vIGlmKG9iai5jb25zdHJ1Y3Rvci5uYW1lPT1cIkJvYXJkXCIpe1xuXHRcdFx0XHRcdGdzLmluZm8oXCJCb2FyZC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBjb25zdHJ1Y3RvcjogXCIgKyBvYmouY29uc3RydWN0b3IubmFtZSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGdzLmluZm8oXCJCb2FyZC5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0Z3MuaW5mbyhcIkJvYXJkLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHRcdH1cblxuXHRcdC8qZ3MuaW5mbyhcIkJvYXJkLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiSWQgXCIrIFwidGhpcy5JZDogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLklkLCBudWxsLCA0KSk7Ki9cblx0XHQvKmdzLmluZm8oXCJCb2FyZC5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfbmV3KGMpIHtcblx0XHRpZiAoIWMpIGMgPSB0aGlzLl9fdHlwZTtcblx0XHRpZiAoYy5pbmRleE9mKCdwbGF0Zm9ybW1hbmFnZXJfJykgIT0gMCkgYyA9ICh7XG5cdFx0XHRQbGF0Zm9ybTogXCJwbGF0Zm9ybW1hbmFnZXJfUGxhdGZvcm1cIixcblx0XHRcdFVzZXI6IFwicGxhdGZvcm1tYW5hZ2VyX1VzZXJcIixcblx0XHRcdFJlcXVpcmVtZW50OiBcInBsYXRmb3JtbWFuYWdlcl9SZXF1aXJlbWVudFwiLFxuXHRcdFx0RWZmb3J0X0VzdGltYXRlOiBcInBsYXRmb3JtbWFuYWdlcl9FZmZvcnRfRXN0aW1hdGVcIixcblx0XHRcdEVmZm9ydDogXCJwbGF0Zm9ybW1hbmFnZXJfRWZmb3J0XCIsXG5cdFx0XHRCdWRnZXQ6IFwicGxhdGZvcm1tYW5hZ2VyX0J1ZGdldFwiLFxuXHRcdFx0QWdlbmRhX0l0ZW06IFwicGxhdGZvcm1tYW5hZ2VyX0FnZW5kYV9JdGVtXCIsXG5cdFx0XHRNZWV0aW5nX0FnZW5kYTogXCJwbGF0Zm9ybW1hbmFnZXJfTWVldGluZ19BZ2VuZGFcIixcblx0XHRcdERlY2lzaW9uX09wdGlvbjogXCJwbGF0Zm9ybW1hbmFnZXJfRGVjaXNpb25fT3B0aW9uXCIsXG5cdFx0XHREZWNpc2lvbjogXCJwbGF0Zm9ybW1hbmFnZXJfRGVjaXNpb25cIixcblx0XHRcdE1lZXRpbmdfTWludXRlOiBcInBsYXRmb3JtbWFuYWdlcl9NZWV0aW5nX01pbnV0ZVwiLFxuXHRcdFx0TWVldGluZ19TZXJpZXM6IFwicGxhdGZvcm1tYW5hZ2VyX01lZXRpbmdfU2VyaWVzXCIsXG5cdFx0XHRNZWV0aW5nOiBcInBsYXRmb3JtbWFuYWdlcl9NZWV0aW5nXCIsXG5cdFx0XHRCb2FyZDogXCJwbGF0Zm9ybW1hbmFnZXJfQm9hcmRcIixcblx0XHRcdEJvYXJkX01lbWJlcjogXCJwbGF0Zm9ybW1hbmFnZXJfQm9hcmRfTWVtYmVyXCIsXG5cdFx0XHRGcmVxdWVuY3k6IFwicGxhdGZvcm1tYW5hZ2VyX0ZyZXF1ZW5jeVwiLFxuXHRcdFx0TW9kdWxlOiBcInBsYXRmb3JtbWFuYWdlcl9Nb2R1bGVcIixcblx0XHRcdENhcGFiaWxpdHk6IFwicGxhdGZvcm1tYW5hZ2VyX0NhcGFiaWxpdHlcIixcblx0XHRcdFRlYW06IFwicGxhdGZvcm1tYW5hZ2VyX1RlYW1cIixcblx0XHRcdFByb2plY3Q6IFwicGxhdGZvcm1tYW5hZ2VyX1Byb2plY3RcIixcblx0XHRcdFRlYW1fTWVtYmVyOiBcInBsYXRmb3JtbWFuYWdlcl9UZWFtX01lbWJlclwiLFxuXHRcdFx0Um9sZTogXCJwbGF0Zm9ybW1hbmFnZXJfUm9sZVwiLFxuXHRcdH0pW2NdO1xuXHRcdHJldHVybiBuZXcoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gZ2xvYmFsIDogeF83ODYxMV9wbGF0Zm9ybV8wKVtjXSgpO1xuXHR9XG5cblx0X3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5jb2RlID0gdGhpcy5jb2RlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLmJvYXJkX01lZXRpbmdzKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmJvYXJkX01lZXRpbmdzID0gdGhpcy5ib2FyZF9NZWV0aW5ncygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuYm9hcmRfQm9hcmRfTWVtYmVycygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5ib2FyZF9Cb2FyZF9NZW1iZXJzID0gdGhpcy5ib2FyZF9Cb2FyZF9NZW1iZXJzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdFx0fSk7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRkZWxldGUgcmV0W2tdO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF91bmlxdWUoa2V5cywgcmV0KSB7XG5cdFx0cmV0ID0gcmV0IHx8IG5ldyBwbGF0Zm9ybW1hbmFnZXJfQm9hcmQoKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0Ly8gaWYodGhpcy5JZCkgcmV0LklkID0gdGhpcy5JZDtcblx0XHRpZiAoIWtleXMpIHtcblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHR9IGVsc2Uge1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiYWN0aXZlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuYWN0aXZlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmFjdGl2ZSh0aGlzLmFjdGl2ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImVuYWJsZWRcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5lbmFibGVkKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmVuYWJsZWQodGhpcy5lbmFibGVkKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiY29kZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmNvZGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuY29kZSh0aGlzLmNvZGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJvcmRlclwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm9yZGVyKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm9yZGVyKHRoaXMub3JkZXIoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYXRlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZGF0ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5kYXRlKHRoaXMuZGF0ZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm5hbWVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5uYW1lKCkpICE9PSAndW5kZWZpbmVkJykgcmV0Lm5hbWUodGhpcy5uYW1lKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwicmVtYXJrXCIpID49IDAgJiYgdHlwZW9mKHRoaXMucmVtYXJrKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LnJlbWFyayh0aGlzLnJlbWFyaygpKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfcXVlcnkoZ3EpIHtcblx0XHRsZXQgYXJGaWVsZHMgPSBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4Xzc4NjExX3BsYXRmb3JtXzBfYm9hcmQnLCBbJyonXSlbJ3hfNzg2MTFfcGxhdGZvcm1fMF9ib2FyZCddKTtcblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgneF83ODYxMV9wbGF0Zm9ybV8wX2JvYXJkJyk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGxldCBpZGYgPSAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH0pKHRoaXMpKTtcblx0XHRpZiAoaWRmID09ICdJZCcpIGlkZiA9ICdzeXNfaWQnO1xuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSB0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZShpZGYsICc9JywgdGhpcy5JZCk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2FjdGl2ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignYWN0aXZlJykgPj0gMCkge1xuXHRcdFx0XHQvKiBncy5pbmZvKFwiQm9hcmQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdhY3RpdmUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2VuYWJsZWRfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdlbmFibGVkJykgPj0gMCkge1xuXHRcdFx0XHQvKiBncy5pbmZvKFwiQm9hcmQuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdFx0LyogZ3MuaW5mbyhcIkJvYXJkLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnY29kZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdjb2RlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fb3JkZXJfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignb3JkZXInKSA+PSAwKSB7XG5cdFx0XHRcdC8qIGdzLmluZm8oXCJCb2FyZC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdvcmRlcicsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZGF0ZV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmRhdGUoKTtcblxuXHRcdFx0aWYgKHYpIHtcblx0XHRcdFx0diA9IG5ldyBHbGlkZURhdGVUaW1lKHYudG9KU09OKCkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZGF0ZScpID49IDApIHtcblx0XHRcdFx0LyogZ3MuaW5mbyhcIkJvYXJkLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qIGdzLmluZm8oXCJCb2FyZC5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ25hbWUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbmFtZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9yZW1hcmtfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fcmVtYXJrX2Nvb3ApIGNvb3AgPSAnU1RBUlRTV0lUSCc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3JlbWFyaycpID49IDApIHtcblx0XHRcdFx0LyogZ3MuaW5mbyhcIkJvYXJkLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgncmVtYXJrJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAoIXRoaXMuX3F1ZXJ5R1EucGxhbi5sZW5ndGgpIHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKGlkZik7XG5cblx0XHQvKiBncy5pbmZvKFwiQm9hcmQuX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdFx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG5cdH1cblxuXHRfc2F2ZShvYmopIHtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHBsYXRmb3JtbWFuYWdlcl9Cb2FyZCgpLl9zYXZlKG8pXG5cdFx0fSk7XG5cblx0XHRsZXQgX29iaiA9IHt9O1xuXG5cdFx0Lypncy5pbmZvKFwiQm9hcmQuX3NhdmUoKTogXCIrIFwiLi4uIFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0T2JqZWN0LmtleXMob2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuIE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfNzg2MTFfcGxhdGZvcm1fMF9ib2FyZCcsIFsnKiddKVsneF83ODYxMV9wbGF0Zm9ybV8wX2JvYXJkJ10pLmZpbHRlcihmdW5jdGlvbihfaykge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZSB8fCBbJ3N5c191cGRhdGVkX29uJywgJ3N5c19jcmVhdGVkX29uJywgJ3VwZGF0ZXMnLCAnc3lzX2NyZWF0ZWRfYnknLCAnc3lzX3VwZGF0ZWRfYnknXS5pbmRleE9mKF9rKSA8IDBcblx0XHRcdH0pLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+PSAwXG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRfb2JqW2sudG9Mb3dlckNhc2UoKV0gPSBvYmpba11cblx0XHR9KTtcblxuXHRcdE9iamVjdC5rZXlzKF9vYmopLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfb2JqW2tdKSA9PT0gXCJbb2JqZWN0IERhdGVdXCIgJiYgaXNOYU4oX29ialtrXSkpIHtcblx0XHRcdFx0Z3MuaW5mbyhcIkJvYXJkLl9zYXZlKCk6IFwiICsgXCJpbnZhbGlkIGRhdGUgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKF9vYmpba10pID09PSAnb2JqZWN0JyAmJiBfb2JqW2tdICYmIF9vYmpba10uc3lzX2lkKSB7XG5cdFx0XHRcdGdzLmluZm8oXCJCb2FyZC5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGxldCBfdGhpcyA9IG51bGw7XG5cdFx0aWYgKG9iai5fX2tleXMpIHtcblx0XHRcdGxldCBrT2JqID0ge307XG5cdFx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpKSk7XG5cdFx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHRrT2JqW2tdID0gX29ialtrXVxuXHRcdFx0fSk7XG5cdFx0XHRfdGhpcyA9IG5ldyBwbGF0Zm9ybW1hbmFnZXJfQm9hcmQoKS5fZnJvbURvY3VtZW50KGtPYmopO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRfdGhpcyA9IG5ldyBwbGF0Zm9ybW1hbmFnZXJfQm9hcmQoKS5fZnJvbURvY3VtZW50KF9vYmopLl91bmlxdWUoKTtcblx0XHR9XG5cblx0XHQvKmdzLmluZm8oXCJCb2FyZC5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdFx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRcdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHRcdHRyeSB7XG5cdFx0XHRncy5pbmZvKFwiQm9hcmQuX3NhdmUoKTogXCIgKyBcIl9vYmouc3lzX2lkOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmouc3lzX2lkLCBudWxsLCA0KSk7XG5cblx0XHRcdE9iamVjdC5rZXlzKF9vYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRcdHJldHVybiBrLnRvTG93ZXJDYXNlKCkgIT0gaztcblx0XHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHRncy5pbmZvKFwiQm9hcmQuX3NhdmUoKTogXCIgKyBcInJlbmFtaW5nIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0dmFyIGxrID0gay50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRfb2JqW2xrXSA9IF9vYmpba107XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSk7XG5cblx0XHRcdGxldCBncSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeShvYmouX190eXBlIHx8ICd4Xzc4NjExX3BsYXRmb3JtXzBfYm9hcmQnKTtcblx0XHRcdC8qZ3MuaW5mbyhcIkJvYXJkLl9zYXZlKCk6IFwiKyBcInVwc2VydGluZy4uLiBcIisgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTsqL1xuXHRcdFx0aWYgKF9vYmouc3lzX2lkKSB7XG5cdFx0XHRcdGdxID0gZ3Eud2hlcmUoJ3N5c19pZCcsIF9vYmouc3lzX2lkKS51cGRhdGUoX29iaik7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfb2JqLnN5c19pZCA9IGdzLmdlbmVyYXRlR1VJRCgpO1xuXHRcdFx0XHRncSA9IGdxLmluc2VydChfb2JqKTtcblx0XHRcdH1cblx0XHRcdGxldCBfZk9iaiA9IHt9O1xuXHRcdFx0X2ZPYmpbKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKV0gPSAoKGZ1bmN0aW9uKHIsIGYpIHtcblx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gci5fdG9Eb2N1bWVudCgpW2ZdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSkpKTtcblx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChfb2JqID0gT2JqZWN0LmFzc2lnbihfZk9iaiwgZ3EuZ2V0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfNzg2MTFfcGxhdGZvcm1fMF9ib2FyZCcsIFsnKiddKVsneF83ODYxMV9wbGF0Zm9ybV8wX2JvYXJkJ10pKSkpO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRncy5pbmZvKFwiQm9hcmQuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiZXg6IFwiICsgSlNPTi5zdHJpbmdpZnkoZXgsIG51bGwsIDQpKTtcblx0XHRcdGdzLmluZm8oXCJCb2FyZC5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJfb2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KF9vYmosIG51bGwsIDQpKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH1cblxuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5ib2FyZF9NZWV0aW5ncykpIHRoaXMuYm9hcmRfTWVldGluZ3Mob2JqLmJvYXJkX01lZXRpbmdzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBwbGF0Zm9ybW1hbmFnZXJfTWVldGluZygpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5ib2FyZF9Cb2FyZF9NZW1iZXJzKSkgdGhpcy5ib2FyZF9Cb2FyZF9NZW1iZXJzKG9iai5ib2FyZF9Cb2FyZF9NZW1iZXJzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBwbGF0Zm9ybW1hbmFnZXJfQm9hcmRfTWVtYmVyKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBCb2FyZC5zdG9yZSgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHN0b3JlKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obG9nT2JqKSB7XG5cdFx0XHRncy5pbmZvKFwiQm9hcmQuc3RvcmUoKTogXCIgKyBcImxvZ09iajogXCIgKyBKU09OLnN0cmluZ2lmeShsb2dPYmosIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHRncy5pbmZvKFwiQm9hcmQuc3RvcmUoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRncy5pbmZvKFwiQm9hcmQuc3RvcmUoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdGdzLmluZm8oXCJCb2FyZC5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0XHRsZXQgX3RoaXMgPSB0aGlzLl91bmlxdWUoKS5maW5kKCk7XG5cdFx0XHRpZiAoX3RoaXMpIHRoaXMuSWQgPSBfdGhpcy5JZDtcblxuXHRcdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogQm9hcmQuZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmRBbGwoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihsb2dPYmopIHtcblx0XHRcdGdzLmluZm8oXCJCb2FyZC5maW5kQWxsKCk6IFwiICsgXCJsb2dPYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkobG9nT2JqLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0Z3MuaW5mbyhcIkJvYXJkLmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRncy5pbmZvKFwiQm9hcmQuZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0Z3MuaW5mbyhcIkJvYXJkLmZpbmRBbGwoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gZmluZEFsbCBsb2NhbGx5XG5cdFx0XHRsZXQgZ3IgPSBuZXcgR2xpZGVSZWNvcmQoXCJCb2FyZFwiKTtcblx0XHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0XHQvL3JldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQodGhpcy5fcXVlcnkoKS5zZWxlY3QoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF83ODYxMV9wbGF0Zm9ybV8wX2JvYXJkJywgWycqJ10pWyd4Xzc4NjExX3BsYXRmb3JtXzBfYm9hcmQnXSkpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogQm9hcmQuZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmQoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihsb2dPYmopIHtcblx0XHRcdGdzLmluZm8oXCJCb2FyZC5maW5kKCk6IFwiICsgXCJsb2dPYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkobG9nT2JqLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0Z3MuaW5mbyhcIkJvYXJkLmZpbmQoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRncy5pbmZvKFwiQm9hcmQuZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0Z3MuaW5mbyhcIkJvYXJkLmZpbmQoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0bGV0IHJldCA9IHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0cmV0dXJuIHJldC5sZW5ndGggPyByZXRbMF0gOiBudWxsO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxufSJ9LHsiYWN0aXZlIjp0cnVlLCJhY2Nlc3MiOiJwYWNrYWdlX3ByaXZhdGUiLCJjYWxsZXJfYWNjZXNzIjpudWxsLCJzeXNfbmFtZSI6InBsYXRmb3JtbWFuYWdlcl9GcmVxdWVuY3kiLCJhcGlfbmFtZSI6InhfNzg2MTFfcGxhdGZvcm1fMC5wbGF0Zm9ybW1hbmFnZXJfRnJlcXVlbmN5IiwibmFtZSI6InBsYXRmb3JtbWFuYWdlcl9GcmVxdWVuY3kiLCJzY3JpcHQiOiJjbGFzcyBwbGF0Zm9ybW1hbmFnZXJfRnJlcXVlbmN5IHtcblx0Y29uc3RydWN0b3IoaWQpIHtcblx0XHR1bmRlZmluZWRcblx0XHR0aGlzLklkID0gaWQ7XG5cdFx0dGhpcy5fX21vZHVsZSA9IFwiXCI7XG5cdFx0dGhpcy5fX3R5cGUgPSBcInBsYXRmb3JtbWFuYWdlcl9GcmVxdWVuY3lcIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInBsYXRmb3JtbWFuYWdlclwiO1xuXHRcdHRoaXMuX19zY29wZSA9IFwicGxhdGZvcm1tYW5hZ2VyXCI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGcmVxdWVuY3kuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGcmVxdWVuY3kuZW5hYmxlZCBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGVuYWJsZWQodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2VuYWJsZWQgPSB2O1xuXHRcdFx0dGhpcy5fZW5hYmxlZF9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lbmFibGVkO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZyZXF1ZW5jeS5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29kZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29kZSA9IHY7XG5cdFx0XHR0aGlzLl9jb2RlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvZGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRnJlcXVlbmN5Lm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZyZXF1ZW5jeS5kYXRlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZGF0ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0aWYgKHYpIHYgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodikgPT09ICdbb2JqZWN0IERhdGVdJyA/IHYgOiAobmV3IERhdGUodikpO1xuXHRcdFx0aWYgKHYgJiYgaXNOYU4odi5nZXRUaW1lKCkpKSB2ID0gbnVsbDtcblx0XHRcdC8vZ3MuaW5mbyhcIkZyZXF1ZW5jeS5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRnJlcXVlbmN5Lm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGcmVxdWVuY3kucmVtYXJrIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cmVtYXJrKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9yZW1hcmsgPSB2O1xuXHRcdFx0dGhpcy5fcmVtYXJrX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JlbWFyaztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGcmVxdWVuY3kuZGFpbHkgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYWlseSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZGFpbHkgPSB2O1xuXHRcdFx0dGhpcy5fZGFpbHlfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGFpbHk7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRnJlcXVlbmN5LndlZWtseSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHdlZWtseSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fd2Vla2x5ID0gdjtcblx0XHRcdHRoaXMuX3dlZWtseV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl93ZWVrbHk7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRnJlcXVlbmN5Lm1vbnRobHkgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRtb250aGx5KHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9tb250aGx5ID0gdjtcblx0XHRcdHRoaXMuX21vbnRobHlfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbW9udGhseTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGcmVxdWVuY3kucXVhcnRlcmx5IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cXVhcnRlcmx5KHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9xdWFydGVybHkgPSB2O1xuXHRcdFx0dGhpcy5fcXVhcnRlcmx5X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3F1YXJ0ZXJseTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGcmVxdWVuY3kuZGF5cyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRheXModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2RheXMgPSB2O1xuXHRcdFx0dGhpcy5fZGF5c19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9kYXlzO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZyZXF1ZW5jeS5tb25kYXkgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRtb25kYXkodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX21vbmRheSA9IHY7XG5cdFx0XHR0aGlzLl9tb25kYXlfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbW9uZGF5O1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZyZXF1ZW5jeS50dWVzZGF5IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0dHVlc2RheSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fdHVlc2RheSA9IHY7XG5cdFx0XHR0aGlzLl90dWVzZGF5X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3R1ZXNkYXk7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRnJlcXVlbmN5LndlZG5lc2RheSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHdlZG5lc2RheSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fd2VkbmVzZGF5ID0gdjtcblx0XHRcdHRoaXMuX3dlZG5lc2RheV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl93ZWRuZXNkYXk7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogRnJlcXVlbmN5LnRodXJzZGF5IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0dGh1cnNkYXkodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3RodXJzZGF5ID0gdjtcblx0XHRcdHRoaXMuX3RodXJzZGF5X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3RodXJzZGF5O1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZyZXF1ZW5jeS5mcmlkYXkgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmcmlkYXkodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX2ZyaWRheSA9IHY7XG5cdFx0XHR0aGlzLl9mcmlkYXlfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJpZGF5O1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIEZyZXF1ZW5jeS5zYXR1cmRheSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHNhdHVyZGF5KHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9zYXR1cmRheSA9IHY7XG5cdFx0XHR0aGlzLl9zYXR1cmRheV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9zYXR1cmRheTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGcmVxdWVuY3kuc3VuZGF5IEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3VuZGF5KHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9zdW5kYXkgPSB2O1xuXHRcdFx0dGhpcy5fc3VuZGF5X2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3N1bmRheTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGcmVxdWVuY3kuZnJlcXVlbmN5X01lZXRpbmdfU2VyaWVzcyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZyZXF1ZW5jeV9NZWV0aW5nX1Nlcmllc3ModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9mcmVxdWVuY3lfTWVldGluZ19TZXJpZXNzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fZnJlcXVlbmN5X01lZXRpbmdfU2VyaWVzc19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJlcXVlbmN5X01lZXRpbmdfU2VyaWVzcztcblx0XHR9XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnY29kZScgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ25hbWUnICsgKHRoaXMuX25hbWVfY29vcCB8fCAnPScpICsgdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAodGhpcy5fcmVtYXJrKSByZXQgKz0gJ14nICsgc1BhdGggKyAncmVtYXJrJyArICh0aGlzLl9yZW1hcmtfY29vcCB8fCAnPScpICsgdGhpcy5yZW1hcmsoKTtcblxuXHRcdGlmICh0aGlzLl9kYWlseSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhaWx5JyArICh0aGlzLl9kYWlseV9jb29wIHx8ICc9JykgKyB0aGlzLmRhaWx5KCk7XG5cblx0XHRpZiAodGhpcy5fd2Vla2x5KSByZXQgKz0gJ14nICsgc1BhdGggKyAnd2Vla2x5JyArICh0aGlzLl93ZWVrbHlfY29vcCB8fCAnPScpICsgdGhpcy53ZWVrbHkoKTtcblxuXHRcdGlmICh0aGlzLl9tb250aGx5KSByZXQgKz0gJ14nICsgc1BhdGggKyAnbW9udGhseScgKyAodGhpcy5fbW9udGhseV9jb29wIHx8ICc9JykgKyB0aGlzLm1vbnRobHkoKTtcblxuXHRcdGlmICh0aGlzLl9xdWFydGVybHkpIHJldCArPSAnXicgKyBzUGF0aCArICdxdWFydGVybHknICsgKHRoaXMuX3F1YXJ0ZXJseV9jb29wIHx8ICc9JykgKyB0aGlzLnF1YXJ0ZXJseSgpO1xuXG5cdFx0aWYgKHRoaXMuX2RheXMpIHJldCArPSAnXicgKyBzUGF0aCArICdkYXlzJyArICh0aGlzLl9kYXlzX2Nvb3AgfHwgJz0nKSArIHRoaXMuZGF5cygpO1xuXG5cdFx0aWYgKHRoaXMuX21vbmRheSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ21vbmRheScgKyAodGhpcy5fbW9uZGF5X2Nvb3AgfHwgJz0nKSArIHRoaXMubW9uZGF5KCk7XG5cblx0XHRpZiAodGhpcy5fdHVlc2RheSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3R1ZXNkYXknICsgKHRoaXMuX3R1ZXNkYXlfY29vcCB8fCAnPScpICsgdGhpcy50dWVzZGF5KCk7XG5cblx0XHRpZiAodGhpcy5fd2VkbmVzZGF5KSByZXQgKz0gJ14nICsgc1BhdGggKyAnd2VkbmVzZGF5JyArICh0aGlzLl93ZWRuZXNkYXlfY29vcCB8fCAnPScpICsgdGhpcy53ZWRuZXNkYXkoKTtcblxuXHRcdGlmICh0aGlzLl90aHVyc2RheSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3RodXJzZGF5JyArICh0aGlzLl90aHVyc2RheV9jb29wIHx8ICc9JykgKyB0aGlzLnRodXJzZGF5KCk7XG5cblx0XHRpZiAodGhpcy5fZnJpZGF5KSByZXQgKz0gJ14nICsgc1BhdGggKyAnZnJpZGF5JyArICh0aGlzLl9mcmlkYXlfY29vcCB8fCAnPScpICsgdGhpcy5mcmlkYXkoKTtcblxuXHRcdGlmICh0aGlzLl9zYXR1cmRheSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ3NhdHVyZGF5JyArICh0aGlzLl9zYXR1cmRheV9jb29wIHx8ICc9JykgKyB0aGlzLnNhdHVyZGF5KCk7XG5cblx0XHRpZiAodGhpcy5fc3VuZGF5KSByZXQgKz0gJ14nICsgc1BhdGggKyAnc3VuZGF5JyArICh0aGlzLl9zdW5kYXlfY29vcCB8fCAnPScpICsgdGhpcy5zdW5kYXkoKTtcblxuXHRcdCh0aGlzLmZyZXF1ZW5jeV9NZWV0aW5nX1Nlcmllc3MoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWU1lZXRpbmdfU2VyaWVzLmZyZXF1ZW5jeSw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0Z3MuaW5mbyhcIkZyZXF1ZW5jeS5fdG9FUXVlcnkoKTogXCIgKyBcInJldDogXCIgKyBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X2ludm9rZShtZXRob2QsIHBheWxvYWQpIHtcblx0XHRpZiAoIW1ldGhvZCkgcmV0dXJuIG51bGw7XG5cdFx0aWYgKHR5cGVvZihwYXlsb2FkKSA9PT0gJ3N0cmluZycpIHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKHBheWxvYWQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBwKTtcblx0XHR9KTtcblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdGdzLmluZm8oXCJGcmVxdWVuY3kuX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXG5cdFx0c3dpdGNoIChtZXRob2QpIHtcblxuXHRcdFx0Y2FzZSBcInN0b3JlXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuc3RvcmUoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRBbGxcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHRncy5pbmZvKFwiRnJlcXVlbmN5Ll9pbnZva2UoKTogXCIgKyBcImludmFsaWQgbWV0aG9kIFwiICsgbWV0aG9kKTtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0X2Zyb21Eb2N1bWVudChvYmopIHtcblx0XHRpZiAoIW9iaikgcmV0dXJuIHRoaXM7IC8vIHRlc3RcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgIT09ICdmdW5jdGlvbicgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJTdHJlYW1cIikge1xuXHRcdFx0bGV0IHJldCA9IFtdO1xuXHRcdFx0b2JqLmZvckVhY2goZnVuY3Rpb24obykge1xuXHRcdFx0XHRyZXQucHVzaChuZXcgcGxhdGZvcm1tYW5hZ2VyX0ZyZXF1ZW5jeSgpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdHRyeSB7XG5cdFx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdC8qZ3MuaW5mbyhcIkZyZXF1ZW5jeS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0XHR9O1xuXHRcdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdFx0b2JqID0gX29iajtcblx0XHRcdH1cblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdFx0XHRpZiAob2JqLmdldFRhYmxlTmFtZSgpID09ICdlY2NfcXVldWUnICYmIFwiRnJlcXVlbmN5XCIgIT0gJ2VjY19xdWV1ZScgJiYgb2JqLnNvdXJjZSA9PSBcIkZyZXF1ZW5jeVwiKSB7XG5cdFx0XHRcdFx0XHRvYmouc3RhdGUgPSBcInByb2Nlc3NpbmdcIjtcblx0XHRcdFx0XHRcdG9iai51cGRhdGUoKTtcblxuXHRcdFx0XHRcdFx0bGV0IHJlc3AgPSBuZXcgR2xpZGVSZWNvcmQoJ2VjY19xdWV1ZScpO1xuXHRcdFx0XHRcdFx0cmVzcC5yZXNwb25zZV90byA9IG9iai5zeXNfaWQ7XG5cdFx0XHRcdFx0XHRyZXNwLnF1ZXVlID0gJ291dHB1dCc7XG5cdFx0XHRcdFx0XHRyZXNwLmFnZW50ID0gb2JqLmFnZW50O1xuXHRcdFx0XHRcdFx0cmVzcC50b3BpYyA9IG9iai50b3BpYztcblx0XHRcdFx0XHRcdHJlc3AubmFtZSA9IG9iai5uYW1lO1xuXHRcdFx0XHRcdFx0cmVzcC5zb3VyY2UgPSBvYmouc291cmNlO1xuXHRcdFx0XHRcdFx0cmVzcC5mcm9tX2hvc3QgPSBvYmouYWdlbnRfY29ycmVsYXRvcjtcblx0XHRcdFx0XHRcdHJlc3AuYWdlbnRfY29ycmVsYXRvciA9IG9iai5mcm9tX2hvc3Q7XG5cblx0XHRcdFx0XHRcdGxldCByZXQgPSBuZXcgcGxhdGZvcm1tYW5hZ2VyX0ZyZXF1ZW5jeSgpLl9mcm9tRG9jdW1lbnQoKS5faW52b2tlKG9iai5uYW1lLnRvU3RyaW5nKCksIG9iai5wYXlsb2FkLnRvU3RyaW5nKCkpO1xuXHRcdFx0XHRcdFx0aWYgKEFycmF5LmlzQXJyYXkocmV0KSkge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByZXQubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gKHIgJiYgdHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nKSA/IHIuX3RvRG9jdW1lbnQoKSA6IHI7XG5cdFx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmIChyZXQgJiYgdHlwZW9mKHJldC5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gcmV0Ll90b0RvY3VtZW50KCk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXNwLnBheWxvYWQgPSBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpO1xuXG5cdFx0XHRcdFx0XHRyZXNwLmluc2VydCgpO1xuXG5cdFx0XHRcdFx0XHRvYmouc3RhdGUgPSBcInByb2Nlc3NlZFwiO1xuXHRcdFx0XHRcdFx0b2JqLnVwZGF0ZSgpO1xuXHRcdFx0XHRcdFx0cmV0dXJuIHJlc3A7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0XHRjb2RlOiBvYmouZ2V0VmFsdWUoXCJjb2RlXCIpLFxuXG5cdFx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRcdG5hbWU6IG9iai5nZXRWYWx1ZShcIm5hbWVcIiksXG5cblx0XHRcdFx0XHRcdHJlbWFyazogb2JqLmdldFZhbHVlKFwicmVtYXJrXCIpLFxuXG5cdFx0XHRcdFx0XHRkYWlseTogb2JqLmdldFZhbHVlKFwiZGFpbHlcIiksXG5cblx0XHRcdFx0XHRcdHdlZWtseTogb2JqLmdldFZhbHVlKFwid2Vla2x5XCIpLFxuXG5cdFx0XHRcdFx0XHRtb250aGx5OiBvYmouZ2V0VmFsdWUoXCJtb250aGx5XCIpLFxuXG5cdFx0XHRcdFx0XHRxdWFydGVybHk6IG9iai5nZXRWYWx1ZShcInF1YXJ0ZXJseVwiKSxcblxuXHRcdFx0XHRcdFx0ZGF5czogb2JqLmdldFZhbHVlKFwiZGF5c1wiKSxcblxuXHRcdFx0XHRcdFx0bW9uZGF5OiBvYmouZ2V0VmFsdWUoXCJtb25kYXlcIiksXG5cblx0XHRcdFx0XHRcdHR1ZXNkYXk6IG9iai5nZXRWYWx1ZShcInR1ZXNkYXlcIiksXG5cblx0XHRcdFx0XHRcdHdlZG5lc2RheTogb2JqLmdldFZhbHVlKFwid2VkbmVzZGF5XCIpLFxuXG5cdFx0XHRcdFx0XHR0aHVyc2RheTogb2JqLmdldFZhbHVlKFwidGh1cnNkYXlcIiksXG5cblx0XHRcdFx0XHRcdGZyaWRheTogb2JqLmdldFZhbHVlKFwiZnJpZGF5XCIpLFxuXG5cdFx0XHRcdFx0XHRzYXR1cmRheTogb2JqLmdldFZhbHVlKFwic2F0dXJkYXlcIiksXG5cblx0XHRcdFx0XHRcdHN1bmRheTogb2JqLmdldFZhbHVlKFwic3VuZGF5XCIpLFxuXG5cdFx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21Eb2N1bWVudChvYmopKTtcblx0XHRcdFx0XHQvKmdzLmluZm8oXCJGcmVxdWVuY3kuX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJnbGlkZSBvYmplY3RzIFwiKyBcImdyUmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KGdyUmV0LCBudWxsLCA0KSk7Ki9cblx0XHRcdFx0XHRyZXR1cm4gZ3JSZXQ7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSBpZiAob2JqLl9mcm9tRG9jdW1lbnQpIHtcblx0XHRcdFx0Z3MuaW5mbyhcIkZyZXF1ZW5jeS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdFx0cmV0dXJuIG9iajtcblx0XHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0XHRyZXR1cm4gbmV3IHBsYXRmb3JtbWFuYWdlcl9GcmVxdWVuY3koKS5fZnJvbURvY3VtZW50KG8pXG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqLmNvbnN0cnVjdG9yKSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdGlmIChvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIk9iamVjdFwiKSB7XG5cblx0XHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkob2JqKSkpKTtcblxuXHRcdFx0XHRcdC8qZ3MuaW5mbyhcIkZyZXF1ZW5jeS5fZnJvbURvY3VtZW50KCk6IFwiKyBcIm9iajogXCIgKyBKU09OLnN0cmluZ2lmeShvYmosIG51bGwsIDQpKTsqL1xuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5hY3RpdmUob2JqLmFjdGl2ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZW5hYmxlZChvYmouZW5hYmxlZCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuY29kZShvYmouY29kZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoub3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm9yZGVyKG9iai5vcmRlcik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmouZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZGF0ZShvYmouZGF0ZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoubmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubmFtZShvYmoubmFtZSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsoU3RyaW5nKChncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBHbGlkZVN0cmluZ1V0aWwgOiBncykuYmFzZTY0RGVjb2RlKG9iai5yZW1hcmspKSk7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKG9iai5yZW1hcmspO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhaWx5KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5kYWlseShvYmouZGFpbHkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLndlZWtseSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMud2Vla2x5KG9iai53ZWVrbHkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm1vbnRobHkpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm1vbnRobHkob2JqLm1vbnRobHkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnF1YXJ0ZXJseSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMucXVhcnRlcmx5KG9iai5xdWFydGVybHkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRheXMpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmRheXMob2JqLmRheXMpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm1vbmRheSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMubW9uZGF5KG9iai5tb25kYXkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnR1ZXNkYXkpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnR1ZXNkYXkob2JqLnR1ZXNkYXkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLndlZG5lc2RheSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMud2VkbmVzZGF5KG9iai53ZWRuZXNkYXkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnRodXJzZGF5KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy50aHVyc2RheShvYmoudGh1cnNkYXkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmZyaWRheSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuZnJpZGF5KG9iai5mcmlkYXkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnNhdHVyZGF5KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5zYXR1cmRheShvYmouc2F0dXJkYXkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnN1bmRheSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuc3VuZGF5KG9iai5zdW5kYXkpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmZyZXF1ZW5jeV9NZWV0aW5nX1Nlcmllc3MpICE9PSAndW5kZWZpbmVkJykgdGhpcy5mcmVxdWVuY3lfTWVldGluZ19TZXJpZXNzKG5ldyBwbGF0Zm9ybW1hbmFnZXJfTWVldGluZ19TZXJpZXMoKS5fZnJvbURvY3VtZW50KG9iai5mcmVxdWVuY3lfTWVldGluZ19TZXJpZXNzKSk7XG5cblx0XHRcdFx0fSBlbHNlIHsgLy8gaWYob2JqLmNvbnN0cnVjdG9yLm5hbWU9PVwiRnJlcXVlbmN5XCIpe1xuXHRcdFx0XHRcdGdzLmluZm8oXCJGcmVxdWVuY3kuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgY29uc3RydWN0b3I6IFwiICsgb2JqLmNvbnN0cnVjdG9yLm5hbWUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRncy5pbmZvKFwiRnJlcXVlbmN5Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInVua25vd24gb2JqZWN0IFwiICsgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHRncy5pbmZvKFwiRnJlcXVlbmN5Ll9mcm9tRG9jdW1lbnQoKTogXCIgKyBcImludmFsaWQgb2JqZWN0IFwiICsgXCJ0eXBlb2Yob2JqKTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2Yob2JqKSwgbnVsbCwgNCkpO1xuXHRcdH1cblxuXHRcdC8qZ3MuaW5mbyhcIkZyZXF1ZW5jeS5fZnJvbURvY3VtZW50KCk6IFwiKyBcIklkIFwiKyBcInRoaXMuSWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5JZCwgbnVsbCwgNCkpOyovXG5cdFx0Lypncy5pbmZvKFwiRnJlcXVlbmN5Ll9mcm9tRG9jdW1lbnQoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7Ki9cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9uZXcoYykge1xuXHRcdGlmICghYykgYyA9IHRoaXMuX190eXBlO1xuXHRcdGlmIChjLmluZGV4T2YoJ3BsYXRmb3JtbWFuYWdlcl8nKSAhPSAwKSBjID0gKHtcblx0XHRcdFBsYXRmb3JtOiBcInBsYXRmb3JtbWFuYWdlcl9QbGF0Zm9ybVwiLFxuXHRcdFx0VXNlcjogXCJwbGF0Zm9ybW1hbmFnZXJfVXNlclwiLFxuXHRcdFx0UmVxdWlyZW1lbnQ6IFwicGxhdGZvcm1tYW5hZ2VyX1JlcXVpcmVtZW50XCIsXG5cdFx0XHRFZmZvcnRfRXN0aW1hdGU6IFwicGxhdGZvcm1tYW5hZ2VyX0VmZm9ydF9Fc3RpbWF0ZVwiLFxuXHRcdFx0RWZmb3J0OiBcInBsYXRmb3JtbWFuYWdlcl9FZmZvcnRcIixcblx0XHRcdEJ1ZGdldDogXCJwbGF0Zm9ybW1hbmFnZXJfQnVkZ2V0XCIsXG5cdFx0XHRBZ2VuZGFfSXRlbTogXCJwbGF0Zm9ybW1hbmFnZXJfQWdlbmRhX0l0ZW1cIixcblx0XHRcdE1lZXRpbmdfQWdlbmRhOiBcInBsYXRmb3JtbWFuYWdlcl9NZWV0aW5nX0FnZW5kYVwiLFxuXHRcdFx0RGVjaXNpb25fT3B0aW9uOiBcInBsYXRmb3JtbWFuYWdlcl9EZWNpc2lvbl9PcHRpb25cIixcblx0XHRcdERlY2lzaW9uOiBcInBsYXRmb3JtbWFuYWdlcl9EZWNpc2lvblwiLFxuXHRcdFx0TWVldGluZ19NaW51dGU6IFwicGxhdGZvcm1tYW5hZ2VyX01lZXRpbmdfTWludXRlXCIsXG5cdFx0XHRNZWV0aW5nX1NlcmllczogXCJwbGF0Zm9ybW1hbmFnZXJfTWVldGluZ19TZXJpZXNcIixcblx0XHRcdE1lZXRpbmc6IFwicGxhdGZvcm1tYW5hZ2VyX01lZXRpbmdcIixcblx0XHRcdEJvYXJkOiBcInBsYXRmb3JtbWFuYWdlcl9Cb2FyZFwiLFxuXHRcdFx0Qm9hcmRfTWVtYmVyOiBcInBsYXRmb3JtbWFuYWdlcl9Cb2FyZF9NZW1iZXJcIixcblx0XHRcdEZyZXF1ZW5jeTogXCJwbGF0Zm9ybW1hbmFnZXJfRnJlcXVlbmN5XCIsXG5cdFx0XHRNb2R1bGU6IFwicGxhdGZvcm1tYW5hZ2VyX01vZHVsZVwiLFxuXHRcdFx0Q2FwYWJpbGl0eTogXCJwbGF0Zm9ybW1hbmFnZXJfQ2FwYWJpbGl0eVwiLFxuXHRcdFx0VGVhbTogXCJwbGF0Zm9ybW1hbmFnZXJfVGVhbVwiLFxuXHRcdFx0UHJvamVjdDogXCJwbGF0Zm9ybW1hbmFnZXJfUHJvamVjdFwiLFxuXHRcdFx0VGVhbV9NZW1iZXI6IFwicGxhdGZvcm1tYW5hZ2VyX1RlYW1fTWVtYmVyXCIsXG5cdFx0XHRSb2xlOiBcInBsYXRmb3JtbWFuYWdlcl9Sb2xlXCIsXG5cdFx0fSlbY107XG5cdFx0cmV0dXJuIG5ldyhncy5nZXRDdXJyZW50U2NvcGVOYW1lKCkgPT0gJ3JoaW5vLmdsb2JhbCcgPyBnbG9iYWwgOiB4Xzc4NjExX3BsYXRmb3JtXzApW2NdKCk7XG5cdH1cblxuXHRfdG9Eb2N1bWVudChhckZpZWxkcykge1xuXG5cdFx0bGV0IHJldCA9IHVuZGVmaW5lZCB8fCB7fTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5JZCkgIT09ICd1bmRlZmluZWQnKSByZXQuc3lzX2lkID0gdGhpcy5JZDtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5hY3RpdmUgPSB0aGlzLmFjdGl2ZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5lbmFibGVkID0gdGhpcy5lbmFibGVkKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2NvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LmNvZGUgPSB0aGlzLmNvZGUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm9yZGVyID0gdGhpcy5vcmRlcigpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5kYXRlID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmIChyZXQuZGF0ZSAmJiB0eXBlb2YocmV0LmRhdGUudG9JU09TdHJpbmcpID09PSAnZnVuY3Rpb24nKSByZXQuZGF0ZSA9IHJldC5kYXRlLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgnLjAwMFonLCAnWicpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5uYW1lID0gdGhpcy5uYW1lKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQucmVtYXJrID0gdGhpcy5yZW1hcmsoKTtcblxuXHRcdFx0aWYgKHR5cGVvZihyZXQucmVtYXJrKSA9PT0gJ29iamVjdCcpIHJldC5yZW1hcmsgPSAoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NEVuY29kZShKU09OLnN0cmluZ2lmeShyZXQucmVtYXJrKSk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhaWx5KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5kYWlseSA9IHRoaXMuZGFpbHkoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fd2Vla2x5KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC53ZWVrbHkgPSB0aGlzLndlZWtseSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9tb250aGx5KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5tb250aGx5ID0gdGhpcy5tb250aGx5KCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3F1YXJ0ZXJseSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQucXVhcnRlcmx5ID0gdGhpcy5xdWFydGVybHkoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF5cykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGF5cyA9IHRoaXMuZGF5cygpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9tb25kYXkpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0Lm1vbmRheSA9IHRoaXMubW9uZGF5KCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3R1ZXNkYXkpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnR1ZXNkYXkgPSB0aGlzLnR1ZXNkYXkoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fd2VkbmVzZGF5KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC53ZWRuZXNkYXkgPSB0aGlzLndlZG5lc2RheSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl90aHVyc2RheSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQudGh1cnNkYXkgPSB0aGlzLnRodXJzZGF5KCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2ZyaWRheSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZnJpZGF5ID0gdGhpcy5mcmlkYXkoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fc2F0dXJkYXkpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnNhdHVyZGF5ID0gdGhpcy5zYXR1cmRheSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9zdW5kYXkpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnN1bmRheSA9IHRoaXMuc3VuZGF5KCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuZnJlcXVlbmN5X01lZXRpbmdfU2VyaWVzcygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5mcmVxdWVuY3lfTWVldGluZ19TZXJpZXNzID0gdGhpcy5mcmVxdWVuY3lfTWVldGluZ19TZXJpZXNzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdFx0fSk7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRkZWxldGUgcmV0W2tdO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF91bmlxdWUoa2V5cywgcmV0KSB7XG5cdFx0cmV0ID0gcmV0IHx8IG5ldyBwbGF0Zm9ybW1hbmFnZXJfRnJlcXVlbmN5KCk7XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdC8vIGlmKHRoaXMuSWQpIHJldC5JZCA9IHRoaXMuSWQ7XG5cdFx0aWYgKCFrZXlzKSB7XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImFjdGl2ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmFjdGl2ZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5hY3RpdmUodGhpcy5hY3RpdmUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJlbmFibGVkXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZW5hYmxlZCgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5lbmFibGVkKHRoaXMuZW5hYmxlZCgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImNvZGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5jb2RlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmNvZGUodGhpcy5jb2RlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwib3JkZXJcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5vcmRlcigpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5vcmRlcih0aGlzLm9yZGVyKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF0ZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhdGUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF0ZSh0aGlzLmRhdGUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJuYW1lXCIpID49IDAgJiYgdHlwZW9mKHRoaXMubmFtZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5uYW1lKHRoaXMubmFtZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInJlbWFya1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLnJlbWFyaygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yZW1hcmsodGhpcy5yZW1hcmsoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJkYWlseVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRhaWx5KCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhaWx5KHRoaXMuZGFpbHkoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJ3ZWVrbHlcIikgPj0gMCAmJiB0eXBlb2YodGhpcy53ZWVrbHkoKSkgIT09ICd1bmRlZmluZWQnKSByZXQud2Vla2x5KHRoaXMud2Vla2x5KCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwibW9udGhseVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm1vbnRobHkoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubW9udGhseSh0aGlzLm1vbnRobHkoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJxdWFydGVybHlcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5xdWFydGVybHkoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucXVhcnRlcmx5KHRoaXMucXVhcnRlcmx5KCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZGF5c1wiKSA+PSAwICYmIHR5cGVvZih0aGlzLmRheXMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZGF5cyh0aGlzLmRheXMoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJtb25kYXlcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5tb25kYXkoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubW9uZGF5KHRoaXMubW9uZGF5KCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwidHVlc2RheVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnR1ZXNkYXkoKSkgIT09ICd1bmRlZmluZWQnKSByZXQudHVlc2RheSh0aGlzLnR1ZXNkYXkoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJ3ZWRuZXNkYXlcIikgPj0gMCAmJiB0eXBlb2YodGhpcy53ZWRuZXNkYXkoKSkgIT09ICd1bmRlZmluZWQnKSByZXQud2VkbmVzZGF5KHRoaXMud2VkbmVzZGF5KCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwidGh1cnNkYXlcIikgPj0gMCAmJiB0eXBlb2YodGhpcy50aHVyc2RheSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC50aHVyc2RheSh0aGlzLnRodXJzZGF5KCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZnJpZGF5XCIpID49IDAgJiYgdHlwZW9mKHRoaXMuZnJpZGF5KCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmZyaWRheSh0aGlzLmZyaWRheSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInNhdHVyZGF5XCIpID49IDAgJiYgdHlwZW9mKHRoaXMuc2F0dXJkYXkoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuc2F0dXJkYXkodGhpcy5zYXR1cmRheSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcInN1bmRheVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLnN1bmRheSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5zdW5kYXkodGhpcy5zdW5kYXkoKSk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X3F1ZXJ5KGdxKSB7XG5cdFx0bGV0IGFyRmllbGRzID0gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF83ODYxMV9wbGF0Zm9ybV8wX2ZyZXF1ZW5jeScsIFsnKiddKVsneF83ODYxMV9wbGF0Zm9ybV8wX2ZyZXF1ZW5jeSddKTtcblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgneF83ODYxMV9wbGF0Zm9ybV8wX2ZyZXF1ZW5jeScpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRsZXQgaWRmID0gKChmdW5jdGlvbihyKSB7XG5cdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9KSh0aGlzKSk7XG5cdFx0aWYgKGlkZiA9PSAnSWQnKSBpZGYgPSAnc3lzX2lkJztcblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgdGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoaWRmLCAnPScsIHRoaXMuSWQpO1xuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9hY3RpdmVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2FjdGl2ZScpID49IDApIHtcblx0XHRcdFx0LyogZ3MuaW5mbyhcIkZyZXF1ZW5jeS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2FjdGl2ZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2VuYWJsZWQnKSA+PSAwKSB7XG5cdFx0XHRcdC8qIGdzLmluZm8oXCJGcmVxdWVuY3kuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdFx0LyogZ3MuaW5mbyhcIkZyZXF1ZW5jeS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ2NvZGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnY29kZScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX29yZGVyX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMub3JkZXIoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ29yZGVyJykgPj0gMCkge1xuXHRcdFx0XHQvKiBncy5pbmZvKFwiRnJlcXVlbmN5Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ29yZGVyJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ29yZGVyJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2RhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9kYXRlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAodikge1xuXHRcdFx0XHR2ID0gbmV3IEdsaWRlRGF0ZVRpbWUodi50b0pTT04oKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXRlJykgPj0gMCkge1xuXHRcdFx0XHQvKiBncy5pbmZvKFwiRnJlcXVlbmN5Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qIGdzLmluZm8oXCJGcmVxdWVuY3kuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCduYW1lJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ25hbWUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcmVtYXJrKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcmVtYXJrX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX3JlbWFya19jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdyZW1hcmsnKSA+PSAwKSB7XG5cdFx0XHRcdC8qIGdzLmluZm8oXCJGcmVxdWVuY3kuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdyZW1hcmsnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdyZW1hcmsnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGFpbHkpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9kYWlseV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmRhaWx5KCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYWlseScpID49IDApIHtcblx0XHRcdFx0LyogZ3MuaW5mbyhcIkZyZXF1ZW5jeS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ2RhaWx5Jyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdkYWlseScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYWlseScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl93ZWVrbHkpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl93ZWVrbHlfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy53ZWVrbHkoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3dlZWtseScpID49IDApIHtcblx0XHRcdFx0LyogZ3MuaW5mbyhcIkZyZXF1ZW5jeS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3dlZWtseScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnd2Vla2x5Jyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3dlZWtseScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9tb250aGx5KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fbW9udGhseV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm1vbnRobHkoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ21vbnRobHknKSA+PSAwKSB7XG5cdFx0XHRcdC8qIGdzLmluZm8oXCJGcmVxdWVuY3kuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdtb250aGx5Jyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdtb250aGx5Jyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ21vbnRobHknLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fcXVhcnRlcmx5KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fcXVhcnRlcmx5X2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMucXVhcnRlcmx5KCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdxdWFydGVybHknKSA+PSAwKSB7XG5cdFx0XHRcdC8qIGdzLmluZm8oXCJGcmVxdWVuY3kuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdxdWFydGVybHknKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3F1YXJ0ZXJseScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdxdWFydGVybHknLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF5cykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2RheXNfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5kYXlzKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdkYXlzJykgPj0gMCkge1xuXHRcdFx0XHQvKiBncy5pbmZvKFwiRnJlcXVlbmN5Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF5cycpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF5cycpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXlzJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX21vbmRheSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX21vbmRheV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm1vbmRheSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignbW9uZGF5JykgPj0gMCkge1xuXHRcdFx0XHQvKiBncy5pbmZvKFwiRnJlcXVlbmN5Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbW9uZGF5Jyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdtb25kYXknKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnbW9uZGF5JywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3R1ZXNkYXkpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl90dWVzZGF5X2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMudHVlc2RheSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigndHVlc2RheScpID49IDApIHtcblx0XHRcdFx0LyogZ3MuaW5mbyhcIkZyZXF1ZW5jeS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3R1ZXNkYXknKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3R1ZXNkYXknKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgndHVlc2RheScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl93ZWRuZXNkYXkpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl93ZWRuZXNkYXlfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy53ZWRuZXNkYXkoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3dlZG5lc2RheScpID49IDApIHtcblx0XHRcdFx0LyogZ3MuaW5mbyhcIkZyZXF1ZW5jeS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3dlZG5lc2RheScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnd2VkbmVzZGF5Jyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3dlZG5lc2RheScsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl90aHVyc2RheSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3RodXJzZGF5X2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMudGh1cnNkYXkoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ3RodXJzZGF5JykgPj0gMCkge1xuXHRcdFx0XHQvKiBncy5pbmZvKFwiRnJlcXVlbmN5Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgndGh1cnNkYXknKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3RodXJzZGF5Jyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3RodXJzZGF5JywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2ZyaWRheSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2ZyaWRheV9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLmZyaWRheSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZnJpZGF5JykgPj0gMCkge1xuXHRcdFx0XHQvKiBncy5pbmZvKFwiRnJlcXVlbmN5Ll9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZnJpZGF5Jyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdmcmlkYXknKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnZnJpZGF5JywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3NhdHVyZGF5KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fc2F0dXJkYXlfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5zYXR1cmRheSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignc2F0dXJkYXknKSA+PSAwKSB7XG5cdFx0XHRcdC8qIGdzLmluZm8oXCJGcmVxdWVuY3kuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdzYXR1cmRheScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnc2F0dXJkYXknKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnc2F0dXJkYXknLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fc3VuZGF5KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fc3VuZGF5X2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuc3VuZGF5KCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdzdW5kYXknKSA+PSAwKSB7XG5cdFx0XHRcdC8qIGdzLmluZm8oXCJGcmVxdWVuY3kuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdzdW5kYXknKTtcblx0XHRcdFx0fSBlbHNlIGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnIT0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOb051bGwoJ3N1bmRheScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdzdW5kYXknLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUS5wbGFuLmxlbmd0aCkgdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoaWRmKTtcblxuXHRcdC8qIGdzLmluZm8oXCJGcmVxdWVuY3kuX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdFx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG5cdH1cblxuXHRfc2F2ZShvYmopIHtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHBsYXRmb3JtbWFuYWdlcl9GcmVxdWVuY3koKS5fc2F2ZShvKVxuXHRcdH0pO1xuXG5cdFx0bGV0IF9vYmogPSB7fTtcblxuXHRcdC8qZ3MuaW5mbyhcIkZyZXF1ZW5jeS5fc2F2ZSgpOiBcIisgXCIuLi4gXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRPYmplY3Qua2V5cyhvYmopLmZpbHRlcihmdW5jdGlvbihrKSB7XG5cdFx0XHRyZXR1cm4gT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF83ODYxMV9wbGF0Zm9ybV8wX2ZyZXF1ZW5jeScsIFsnKiddKVsneF83ODYxMV9wbGF0Zm9ybV8wX2ZyZXF1ZW5jeSddKS5maWx0ZXIoZnVuY3Rpb24oX2spIHtcblx0XHRcdFx0cmV0dXJuIHRydWUgfHwgWydzeXNfdXBkYXRlZF9vbicsICdzeXNfY3JlYXRlZF9vbicsICd1cGRhdGVzJywgJ3N5c19jcmVhdGVkX2J5JywgJ3N5c191cGRhdGVkX2J5J10uaW5kZXhPZihfaykgPCAwXG5cdFx0XHR9KS5pbmRleE9mKGsudG9Mb3dlckNhc2UoKSkgPj0gMFxuXHRcdH0pLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0X29ialtrLnRvTG93ZXJDYXNlKCldID0gb2JqW2tdXG5cdFx0fSk7XG5cblx0XHRPYmplY3Qua2V5cyhfb2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX29ialtrXSkgPT09IFwiW29iamVjdCBEYXRlXVwiICYmIGlzTmFOKF9vYmpba10pKSB7XG5cdFx0XHRcdGdzLmluZm8oXCJGcmVxdWVuY3kuX3NhdmUoKTogXCIgKyBcImludmFsaWQgZGF0ZSBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdGRlbGV0ZSBfb2JqW2tdO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YoX29ialtrXSkgPT09ICdvYmplY3QnICYmIF9vYmpba10gJiYgX29ialtrXS5zeXNfaWQpIHtcblx0XHRcdFx0Z3MuaW5mbyhcIkZyZXF1ZW5jeS5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGxldCBfdGhpcyA9IG51bGw7XG5cdFx0aWYgKG9iai5fX2tleXMpIHtcblx0XHRcdGxldCBrT2JqID0ge307XG5cdFx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpKSk7XG5cdFx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHRrT2JqW2tdID0gX29ialtrXVxuXHRcdFx0fSk7XG5cdFx0XHRfdGhpcyA9IG5ldyBwbGF0Zm9ybW1hbmFnZXJfRnJlcXVlbmN5KCkuX2Zyb21Eb2N1bWVudChrT2JqKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0X3RoaXMgPSBuZXcgcGxhdGZvcm1tYW5hZ2VyX0ZyZXF1ZW5jeSgpLl9mcm9tRG9jdW1lbnQoX29iaikuX3VuaXF1ZSgpO1xuXHRcdH1cblxuXHRcdC8qZ3MuaW5mbyhcIkZyZXF1ZW5jeS5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdFx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRcdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHRcdHRyeSB7XG5cdFx0XHRncy5pbmZvKFwiRnJlcXVlbmN5Ll9zYXZlKCk6IFwiICsgXCJfb2JqLnN5c19pZDogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLnN5c19pZCwgbnVsbCwgNCkpO1xuXG5cdFx0XHRPYmplY3Qua2V5cyhfb2JqKS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0XHRyZXR1cm4gay50b0xvd2VyQ2FzZSgpICE9IGs7XG5cdFx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0Z3MuaW5mbyhcIkZyZXF1ZW5jeS5fc2F2ZSgpOiBcIiArIFwicmVuYW1pbmcgXCIgKyBcIms6IFwiICsgSlNPTi5zdHJpbmdpZnkoaywgbnVsbCwgNCkpO1xuXHRcdFx0XHR2YXIgbGsgPSBrLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRcdF9vYmpbbGtdID0gX29ialtrXTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9KTtcblxuXHRcdFx0bGV0IGdxID0gbmV3IGdsb2JhbC5HbGlkZVF1ZXJ5KG9iai5fX3R5cGUgfHwgJ3hfNzg2MTFfcGxhdGZvcm1fMF9mcmVxdWVuY3knKTtcblx0XHRcdC8qZ3MuaW5mbyhcIkZyZXF1ZW5jeS5fc2F2ZSgpOiBcIisgXCJ1cHNlcnRpbmcuLi4gXCIrIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7Ki9cblx0XHRcdGlmIChfb2JqLnN5c19pZCkge1xuXHRcdFx0XHRncSA9IGdxLndoZXJlKCdzeXNfaWQnLCBfb2JqLnN5c19pZCkudXBkYXRlKF9vYmopO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X29iai5zeXNfaWQgPSBncy5nZW5lcmF0ZUdVSUQoKTtcblx0XHRcdFx0Z3EgPSBncS5pbnNlcnQoX29iaik7XG5cdFx0XHR9XG5cdFx0XHRsZXQgX2ZPYmogPSB7fTtcblx0XHRcdF9mT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkob2JqKSldID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YocikgPT09ICdvYmplY3QnICYmIHIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpKSk7XG5cdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoX29iaiA9IE9iamVjdC5hc3NpZ24oX2ZPYmosIGdxLmdldChPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4Xzc4NjExX3BsYXRmb3JtXzBfZnJlcXVlbmN5JywgWycqJ10pWyd4Xzc4NjExX3BsYXRmb3JtXzBfZnJlcXVlbmN5J10pKSkpO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRncy5pbmZvKFwiRnJlcXVlbmN5Ll9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcImV4OiBcIiArIEpTT04uc3RyaW5naWZ5KGV4LCBudWxsLCA0KSk7XG5cdFx0XHRncy5pbmZvKFwiRnJlcXVlbmN5Ll9zYXZlKCk6IFwiICsgXCJFeGNlcHRpb24gXCIgKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fVxuXG5cdFx0aWYgKEFycmF5LmlzQXJyYXkob2JqLmZyZXF1ZW5jeV9NZWV0aW5nX1Nlcmllc3MpKSB0aGlzLmZyZXF1ZW5jeV9NZWV0aW5nX1Nlcmllc3Mob2JqLmZyZXF1ZW5jeV9NZWV0aW5nX1Nlcmllc3MubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHBsYXRmb3JtbWFuYWdlcl9NZWV0aW5nX1NlcmllcygpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRnJlcXVlbmN5LnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RvcmUoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihsb2dPYmopIHtcblx0XHRcdGdzLmluZm8oXCJGcmVxdWVuY3kuc3RvcmUoKTogXCIgKyBcImxvZ09iajogXCIgKyBKU09OLnN0cmluZ2lmeShsb2dPYmosIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHRncy5pbmZvKFwiRnJlcXVlbmN5LnN0b3JlKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Z3MuaW5mbyhcIkZyZXF1ZW5jeS5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0Z3MuaW5mbyhcIkZyZXF1ZW5jeS5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0XHRsZXQgX3RoaXMgPSB0aGlzLl91bmlxdWUoKS5maW5kKCk7XG5cdFx0XHRpZiAoX3RoaXMpIHRoaXMuSWQgPSBfdGhpcy5JZDtcblxuXHRcdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogRnJlcXVlbmN5LmZpbmRBbGwoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kQWxsKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obG9nT2JqKSB7XG5cdFx0XHRncy5pbmZvKFwiRnJlcXVlbmN5LmZpbmRBbGwoKTogXCIgKyBcImxvZ09iajogXCIgKyBKU09OLnN0cmluZ2lmeShsb2dPYmosIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHRncy5pbmZvKFwiRnJlcXVlbmN5LmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRncy5pbmZvKFwiRnJlcXVlbmN5LmZpbmRBbGwoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdGdzLmluZm8oXCJGcmVxdWVuY3kuZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZChcIkZyZXF1ZW5jeVwiKTtcblx0XHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0XHQvL3JldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQodGhpcy5fcXVlcnkoKS5zZWxlY3QoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF83ODYxMV9wbGF0Zm9ybV8wX2ZyZXF1ZW5jeScsIFsnKiddKVsneF83ODYxMV9wbGF0Zm9ybV8wX2ZyZXF1ZW5jeSddKSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBGcmVxdWVuY3kuZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmQoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihsb2dPYmopIHtcblx0XHRcdGdzLmluZm8oXCJGcmVxdWVuY3kuZmluZCgpOiBcIiArIFwibG9nT2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KGxvZ09iaiwgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdGdzLmluZm8oXCJGcmVxdWVuY3kuZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGdzLmluZm8oXCJGcmVxdWVuY3kuZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0Z3MuaW5mbyhcIkZyZXF1ZW5jeS5maW5kKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdGxldCByZXQgPSB0aGlzLmZpbmRBbGwoKTtcblx0XHRcdHJldHVybiByZXQubGVuZ3RoID8gcmV0WzBdIDogbnVsbDtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cbn0ifSx7ImFjdGl2ZSI6dHJ1ZSwiYWNjZXNzIjoicGFja2FnZV9wcml2YXRlIiwiY2FsbGVyX2FjY2VzcyI6bnVsbCwic3lzX25hbWUiOiJwbGF0Zm9ybW1hbmFnZXJfVGVhbSIsImFwaV9uYW1lIjoieF83ODYxMV9wbGF0Zm9ybV8wLnBsYXRmb3JtbWFuYWdlcl9UZWFtIiwibmFtZSI6InBsYXRmb3JtbWFuYWdlcl9UZWFtIiwic2NyaXB0IjoiY2xhc3MgcGxhdGZvcm1tYW5hZ2VyX1RlYW0ge1xuXHRjb25zdHJ1Y3RvcihpZCkge1xuXHRcdHVuZGVmaW5lZFxuXHRcdHRoaXMuSWQgPSBpZDtcblx0XHR0aGlzLl9fbW9kdWxlID0gXCJcIjtcblx0XHR0aGlzLl9fdHlwZSA9IFwicGxhdGZvcm1tYW5hZ2VyX1RlYW1cIjtcblx0XHR0aGlzLl9fYWxpYXMgPSBcInBsYXRmb3JtbWFuYWdlclwiO1xuXHRcdHRoaXMuX19zY29wZSA9IFwicGxhdGZvcm1tYW5hZ2VyXCI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUZWFtLmFjdGl2ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGFjdGl2ZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fYWN0aXZlID0gdjtcblx0XHRcdHRoaXMuX2FjdGl2ZV9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9hY3RpdmU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVGVhbS5lbmFibGVkIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZW5hYmxlZCh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fZW5hYmxlZCA9IHY7XG5cdFx0XHR0aGlzLl9lbmFibGVkX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVGVhbS5jb2RlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0Y29kZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fY29kZSA9IHY7XG5cdFx0XHR0aGlzLl9jb2RlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2NvZGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVGVhbS5vcmRlciBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdG9yZGVyKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9vcmRlciA9IHY7XG5cdFx0XHR0aGlzLl9vcmRlcl9jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9vcmRlcjtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUZWFtLmRhdGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRkYXRlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRpZiAodikgdiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgRGF0ZV0nID8gdiA6IChuZXcgRGF0ZSh2KSk7XG5cdFx0XHRpZiAodiAmJiBpc05hTih2LmdldFRpbWUoKSkpIHYgPSBudWxsO1xuXHRcdFx0Ly9ncy5pbmZvKFwiVGVhbS5kYXRlKCk6IFwiKyBcInR5cGVvZih2KTogXCIgKyBKU09OLnN0cmluZ2lmeSh0eXBlb2YodiksIG51bGwsIDQpKTtcblxuXHRcdFx0dGhpcy5fZGF0ZSA9IHY7XG5cdFx0XHR0aGlzLl9kYXRlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2RhdGU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVGVhbS5uYW1lIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0bmFtZSh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fbmFtZSA9IHY7XG5cdFx0XHR0aGlzLl9uYW1lX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX25hbWU7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogVGVhbS5yZW1hcmsgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyZW1hcmsodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX3JlbWFyayA9IHY7XG5cdFx0XHR0aGlzLl9yZW1hcmtfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtYXJrO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRlYW0udGVhbV9Qcm9qZWN0cyBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHRlYW1fUHJvamVjdHModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl90ZWFtX1Byb2plY3RzID0gIUFycmF5LmlzQXJyYXkodikgPyBbdl0gOiB2O1xuXHRcdFx0dGhpcy5fdGVhbV9Qcm9qZWN0c19jb29wID0gY29vcDtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fdGVhbV9Qcm9qZWN0cztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUZWFtLnRlYW1fVGVhbV9NZW1iZXJzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0dGVhbV9UZWFtX01lbWJlcnModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl90ZWFtX1RlYW1fTWVtYmVycyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX3RlYW1fVGVhbV9NZW1iZXJzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl90ZWFtX1RlYW1fTWVtYmVycztcblx0XHR9XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnY29kZScgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ25hbWUnICsgKHRoaXMuX25hbWVfY29vcCB8fCAnPScpICsgdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAodGhpcy5fcmVtYXJrKSByZXQgKz0gJ14nICsgc1BhdGggKyAncmVtYXJrJyArICh0aGlzLl9yZW1hcmtfY29vcCB8fCAnPScpICsgdGhpcy5yZW1hcmsoKTtcblxuXHRcdCh0aGlzLnRlYW1fUHJvamVjdHMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWVByb2plY3QudGVhbSw+PTEnICsgdGEuX3RvRVF1ZXJ5KCkgKyAnXkVORFJMUVVFUlknO1xuXHRcdH0pO1xuXG5cdFx0KHRoaXMudGVhbV9UZWFtX01lbWJlcnMoKSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0ICs9ICdeUkxRVUVSWVRlYW1fTWVtYmVyLnRlYW0sPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdGdzLmluZm8oXCJUZWFtLl90b0VRdWVyeSgpOiBcIiArIFwicmV0OiBcIiArIEpTT04uc3RyaW5naWZ5KHJldCwgbnVsbCwgNCkpO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cblxuXHRfaW52b2tlKG1ldGhvZCwgcGF5bG9hZCkge1xuXHRcdGlmICghbWV0aG9kKSByZXR1cm4gbnVsbDtcblx0XHRpZiAodHlwZW9mKHBheWxvYWQpID09PSAnc3RyaW5nJykgcmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIEpTT04ucGFyc2UocGF5bG9hZCkpO1xuXHRcdGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSByZXR1cm4gcGF5bG9hZC5tYXAoZnVuY3Rpb24ocCkge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIHApO1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5fZnJvbURvY3VtZW50KHBheWxvYWQpO1xuXG5cdFx0Z3MuaW5mbyhcIlRlYW0uX2ludm9rZSgpOiBcIiArIFwibWV0aG9kOiBcIiArIEpTT04uc3RyaW5naWZ5KG1ldGhvZCwgbnVsbCwgNCkpO1xuXG5cdFx0c3dpdGNoIChtZXRob2QpIHtcblxuXHRcdFx0Y2FzZSBcInN0b3JlXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuc3RvcmUoKTtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImZpbmRBbGxcIjoge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZhdWx0OiB7XG5cdFx0XHRcdC8vIGlmKHR5cGVvZih0aGlzW21ldGhvZF0pPT09J2Z1bmN0aW9uJykgcmV0dXJuIHRoaXNbbWV0aG9kXShwYXlsb2FkKTtcblxuXHRcdFx0XHRncy5pbmZvKFwiVGVhbS5faW52b2tlKCk6IFwiICsgXCJpbnZhbGlkIG1ldGhvZCBcIiArIG1ldGhvZCk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdF9mcm9tRG9jdW1lbnQob2JqKSB7XG5cdFx0aWYgKCFvYmopIHJldHVybiB0aGlzOyAvLyB0ZXN0XG5cblx0XHR1bmRlZmluZWRcblxuXHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpICE9PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lID09IFwiU3RyZWFtXCIpIHtcblx0XHRcdGxldCByZXQgPSBbXTtcblx0XHRcdG9iai5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0cmV0LnB1c2gobmV3IHBsYXRmb3JtbWFuYWdlcl9UZWFtKCkuX2Zyb21Eb2N1bWVudChvKSk7XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZihvYmopID09PSAnc3RyaW5nJykge1xuXHRcdFx0dHJ5IHtcblx0XHRcdFx0b2JqID0gSlNPTi5wYXJzZShvYmopO1xuXHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0Lypncy5pbmZvKFwiVGVhbS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJzdHJpbmcgW1wiK29iaitcIl0gaW50byBcIiArICgoZnVuY3Rpb24ocil7XG4gICAgbGV0IHJldCA9ICdzeXNfaWQnO1xuICAgIGlmKHR5cGVvZihyLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nKXtcbiAgICAgICAgcmV0ID0gci5fX2lkRmllbGQoKTtcbiAgICB9ZWxzZSBpZih0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKT09PSdmdW5jdGlvbic/dGhpcy5fX2lkRmllbGQoKTp1bmRlZmluZWQpXSkhPT0ndW5kZWZpbmVkJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHIuSWQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnSWQnO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLnN5c19tb2RfY291bnQpIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSAnc3lzX2lkJztcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn0pKHRoaXMpKSk7Ki9cblx0XHRcdFx0bGV0IF9vYmogPSB7XG5cdFx0XHRcdFx0X19pZEZpZWxkOiAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKHRoaXMpKVxuXHRcdFx0XHR9O1xuXHRcdFx0XHRfb2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fSkodGhpcykpXSA9IG9iajtcblx0XHRcdFx0b2JqID0gX29iajtcblx0XHRcdH1cblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQob2JqKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZihvYmopID09PSAnb2JqZWN0Jykge1xuXHRcdFx0aWYgKHR5cGVvZihvYmouaXNWYWxpZFJlY29yZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0aWYgKG9iai5pc1ZhbGlkUmVjb3JkKCkpIHtcblx0XHRcdFx0XHRpZiAob2JqLmdldFRhYmxlTmFtZSgpID09ICdlY2NfcXVldWUnICYmIFwiVGVhbVwiICE9ICdlY2NfcXVldWUnICYmIG9iai5zb3VyY2UgPT0gXCJUZWFtXCIpIHtcblx0XHRcdFx0XHRcdG9iai5zdGF0ZSA9IFwicHJvY2Vzc2luZ1wiO1xuXHRcdFx0XHRcdFx0b2JqLnVwZGF0ZSgpO1xuXG5cdFx0XHRcdFx0XHRsZXQgcmVzcCA9IG5ldyBHbGlkZVJlY29yZCgnZWNjX3F1ZXVlJyk7XG5cdFx0XHRcdFx0XHRyZXNwLnJlc3BvbnNlX3RvID0gb2JqLnN5c19pZDtcblx0XHRcdFx0XHRcdHJlc3AucXVldWUgPSAnb3V0cHV0Jztcblx0XHRcdFx0XHRcdHJlc3AuYWdlbnQgPSBvYmouYWdlbnQ7XG5cdFx0XHRcdFx0XHRyZXNwLnRvcGljID0gb2JqLnRvcGljO1xuXHRcdFx0XHRcdFx0cmVzcC5uYW1lID0gb2JqLm5hbWU7XG5cdFx0XHRcdFx0XHRyZXNwLnNvdXJjZSA9IG9iai5zb3VyY2U7XG5cdFx0XHRcdFx0XHRyZXNwLmZyb21faG9zdCA9IG9iai5hZ2VudF9jb3JyZWxhdG9yO1xuXHRcdFx0XHRcdFx0cmVzcC5hZ2VudF9jb3JyZWxhdG9yID0gb2JqLmZyb21faG9zdDtcblxuXHRcdFx0XHRcdFx0bGV0IHJldCA9IG5ldyBwbGF0Zm9ybW1hbmFnZXJfVGVhbSgpLl9mcm9tRG9jdW1lbnQoKS5faW52b2tlKG9iai5uYW1lLnRvU3RyaW5nKCksIG9iai5wYXlsb2FkLnRvU3RyaW5nKCkpO1xuXHRcdFx0XHRcdFx0aWYgKEFycmF5LmlzQXJyYXkocmV0KSkge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByZXQubWFwKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gKHIgJiYgdHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nKSA/IHIuX3RvRG9jdW1lbnQoKSA6IHI7XG5cdFx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmIChyZXQgJiYgdHlwZW9mKHJldC5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gcmV0Ll90b0RvY3VtZW50KCk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXNwLnBheWxvYWQgPSBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpO1xuXG5cdFx0XHRcdFx0XHRyZXNwLmluc2VydCgpO1xuXG5cdFx0XHRcdFx0XHRvYmouc3RhdGUgPSBcInByb2Nlc3NlZFwiO1xuXHRcdFx0XHRcdFx0b2JqLnVwZGF0ZSgpO1xuXHRcdFx0XHRcdFx0cmV0dXJuIHJlc3A7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHRoaXMuX2Zyb21Eb2N1bWVudCh7XG5cblx0XHRcdFx0XHRcdGFjdGl2ZTogb2JqLmdldFZhbHVlKFwiYWN0aXZlXCIpLFxuXG5cdFx0XHRcdFx0XHRlbmFibGVkOiBvYmouZ2V0VmFsdWUoXCJlbmFibGVkXCIpLFxuXG5cdFx0XHRcdFx0XHRjb2RlOiBvYmouZ2V0VmFsdWUoXCJjb2RlXCIpLFxuXG5cdFx0XHRcdFx0XHRvcmRlcjogb2JqLmdldFZhbHVlKFwib3JkZXJcIiksXG5cblx0XHRcdFx0XHRcdGRhdGU6IG9iai5nZXRWYWx1ZShcImRhdGVcIiksXG5cblx0XHRcdFx0XHRcdG5hbWU6IG9iai5nZXRWYWx1ZShcIm5hbWVcIiksXG5cblx0XHRcdFx0XHRcdHJlbWFyazogb2JqLmdldFZhbHVlKFwicmVtYXJrXCIpLFxuXG5cdFx0XHRcdFx0XHRJZDogb2JqLmdldFZhbHVlKCdzeXNfaWQnKVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdG9iai5xdWVyeSgpO1xuXHRcdFx0XHRcdGxldCBnclJldCA9IFtdO1xuXHRcdFx0XHRcdHdoaWxlIChvYmoubmV4dCgpKSBnclJldC5wdXNoKHRoaXMuX2Zyb21Eb2N1bWVudChvYmopKTtcblx0XHRcdFx0XHQvKmdzLmluZm8oXCJUZWFtLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwiZ2xpZGUgb2JqZWN0cyBcIisgXCJnclJldDogXCIgKyBKU09OLnN0cmluZ2lmeShnclJldCwgbnVsbCwgNCkpOyovXG5cdFx0XHRcdFx0cmV0dXJuIGdyUmV0O1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2UgaWYgKG9iai5fZnJvbURvY3VtZW50KSB7XG5cdFx0XHRcdGdzLmluZm8oXCJUZWFtLl9mcm9tRG9jdW1lbnQoKTogXCIgKyBcInJlZHVuZGVudCBjYWxsXCIpO1xuXHRcdFx0XHRyZXR1cm4gb2JqO1xuXHRcdFx0fSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcblx0XHRcdFx0cmV0dXJuIG9iai5tYXAoZnVuY3Rpb24obykge1xuXHRcdFx0XHRcdHJldHVybiBuZXcgcGxhdGZvcm1tYW5hZ2VyX1RlYW0oKS5fZnJvbURvY3VtZW50KG8pXG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqLmNvbnN0cnVjdG9yKSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdGlmIChvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIk9iamVjdFwiKSB7XG5cblx0XHRcdFx0XHR0aGlzLklkID0gKChmdW5jdGlvbihyLCBmKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fdG9Eb2N1bWVudCkgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mKHJbZl0pID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHIuX3RvRG9jdW1lbnQoKVtmXTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHJldHVybiByW2ZdO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdFx0XHR9KShvYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdFx0fSkob2JqKSkpKTtcblxuXHRcdFx0XHRcdC8qZ3MuaW5mbyhcIlRlYW0uX2Zyb21Eb2N1bWVudCgpOiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmFjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMuYWN0aXZlKG9iai5hY3RpdmUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmVuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmVuYWJsZWQob2JqLmVuYWJsZWQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmNvZGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmNvZGUob2JqLmNvZGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm9yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5vcmRlcihvYmoub3JkZXIpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLmRhdGUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmRhdGUob2JqLmRhdGUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLm5hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLm5hbWUob2JqLm5hbWUpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2Yob2JqLnJlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMucmVtYXJrKFN0cmluZygoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gR2xpZGVTdHJpbmdVdGlsIDogZ3MpLmJhc2U2NERlY29kZShvYmoucmVtYXJrKSkpO1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhvYmoucmVtYXJrKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai50ZWFtX1Byb2plY3RzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMudGVhbV9Qcm9qZWN0cyhuZXcgcGxhdGZvcm1tYW5hZ2VyX1Byb2plY3QoKS5fZnJvbURvY3VtZW50KG9iai50ZWFtX1Byb2plY3RzKSk7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai50ZWFtX1RlYW1fTWVtYmVycykgIT09ICd1bmRlZmluZWQnKSB0aGlzLnRlYW1fVGVhbV9NZW1iZXJzKG5ldyBwbGF0Zm9ybW1hbmFnZXJfVGVhbV9NZW1iZXIoKS5fZnJvbURvY3VtZW50KG9iai50ZWFtX1RlYW1fTWVtYmVycykpO1xuXG5cdFx0XHRcdH0gZWxzZSB7IC8vIGlmKG9iai5jb25zdHJ1Y3Rvci5uYW1lPT1cIlRlYW1cIil7XG5cdFx0XHRcdFx0Z3MuaW5mbyhcIlRlYW0uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgY29uc3RydWN0b3I6IFwiICsgb2JqLmNvbnN0cnVjdG9yLm5hbWUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRncy5pbmZvKFwiVGVhbS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0Z3MuaW5mbyhcIlRlYW0uX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwiaW52YWxpZCBvYmplY3QgXCIgKyBcInR5cGVvZihvYmopOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZihvYmopLCBudWxsLCA0KSk7XG5cdFx0fVxuXG5cdFx0Lypncy5pbmZvKFwiVGVhbS5fZnJvbURvY3VtZW50KCk6IFwiKyBcIklkIFwiKyBcInRoaXMuSWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5JZCwgbnVsbCwgNCkpOyovXG5cdFx0Lypncy5pbmZvKFwiVGVhbS5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfbmV3KGMpIHtcblx0XHRpZiAoIWMpIGMgPSB0aGlzLl9fdHlwZTtcblx0XHRpZiAoYy5pbmRleE9mKCdwbGF0Zm9ybW1hbmFnZXJfJykgIT0gMCkgYyA9ICh7XG5cdFx0XHRQbGF0Zm9ybTogXCJwbGF0Zm9ybW1hbmFnZXJfUGxhdGZvcm1cIixcblx0XHRcdFVzZXI6IFwicGxhdGZvcm1tYW5hZ2VyX1VzZXJcIixcblx0XHRcdFJlcXVpcmVtZW50OiBcInBsYXRmb3JtbWFuYWdlcl9SZXF1aXJlbWVudFwiLFxuXHRcdFx0RWZmb3J0X0VzdGltYXRlOiBcInBsYXRmb3JtbWFuYWdlcl9FZmZvcnRfRXN0aW1hdGVcIixcblx0XHRcdEVmZm9ydDogXCJwbGF0Zm9ybW1hbmFnZXJfRWZmb3J0XCIsXG5cdFx0XHRCdWRnZXQ6IFwicGxhdGZvcm1tYW5hZ2VyX0J1ZGdldFwiLFxuXHRcdFx0QWdlbmRhX0l0ZW06IFwicGxhdGZvcm1tYW5hZ2VyX0FnZW5kYV9JdGVtXCIsXG5cdFx0XHRNZWV0aW5nX0FnZW5kYTogXCJwbGF0Zm9ybW1hbmFnZXJfTWVldGluZ19BZ2VuZGFcIixcblx0XHRcdERlY2lzaW9uX09wdGlvbjogXCJwbGF0Zm9ybW1hbmFnZXJfRGVjaXNpb25fT3B0aW9uXCIsXG5cdFx0XHREZWNpc2lvbjogXCJwbGF0Zm9ybW1hbmFnZXJfRGVjaXNpb25cIixcblx0XHRcdE1lZXRpbmdfTWludXRlOiBcInBsYXRmb3JtbWFuYWdlcl9NZWV0aW5nX01pbnV0ZVwiLFxuXHRcdFx0TWVldGluZ19TZXJpZXM6IFwicGxhdGZvcm1tYW5hZ2VyX01lZXRpbmdfU2VyaWVzXCIsXG5cdFx0XHRNZWV0aW5nOiBcInBsYXRmb3JtbWFuYWdlcl9NZWV0aW5nXCIsXG5cdFx0XHRCb2FyZDogXCJwbGF0Zm9ybW1hbmFnZXJfQm9hcmRcIixcblx0XHRcdEJvYXJkX01lbWJlcjogXCJwbGF0Zm9ybW1hbmFnZXJfQm9hcmRfTWVtYmVyXCIsXG5cdFx0XHRGcmVxdWVuY3k6IFwicGxhdGZvcm1tYW5hZ2VyX0ZyZXF1ZW5jeVwiLFxuXHRcdFx0TW9kdWxlOiBcInBsYXRmb3JtbWFuYWdlcl9Nb2R1bGVcIixcblx0XHRcdENhcGFiaWxpdHk6IFwicGxhdGZvcm1tYW5hZ2VyX0NhcGFiaWxpdHlcIixcblx0XHRcdFRlYW06IFwicGxhdGZvcm1tYW5hZ2VyX1RlYW1cIixcblx0XHRcdFByb2plY3Q6IFwicGxhdGZvcm1tYW5hZ2VyX1Byb2plY3RcIixcblx0XHRcdFRlYW1fTWVtYmVyOiBcInBsYXRmb3JtbWFuYWdlcl9UZWFtX01lbWJlclwiLFxuXHRcdFx0Um9sZTogXCJwbGF0Zm9ybW1hbmFnZXJfUm9sZVwiLFxuXHRcdH0pW2NdO1xuXHRcdHJldHVybiBuZXcoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gZ2xvYmFsIDogeF83ODYxMV9wbGF0Zm9ybV8wKVtjXSgpO1xuXHR9XG5cblx0X3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5jb2RlID0gdGhpcy5jb2RlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLnRlYW1fUHJvamVjdHMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQudGVhbV9Qcm9qZWN0cyA9IHRoaXMudGVhbV9Qcm9qZWN0cygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMudGVhbV9UZWFtX01lbWJlcnMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQudGVhbV9UZWFtX01lbWJlcnMgPSB0aGlzLnRlYW1fVGVhbV9NZW1iZXJzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdFx0fSk7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRkZWxldGUgcmV0W2tdO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF91bmlxdWUoa2V5cywgcmV0KSB7XG5cdFx0cmV0ID0gcmV0IHx8IG5ldyBwbGF0Zm9ybW1hbmFnZXJfVGVhbSgpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRcdGlmICgha2V5cykge1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3RpdmVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3RpdmUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aXZlKHRoaXMuYWN0aXZlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJjb2RlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm9yZGVyXCIpID49IDAgJiYgdHlwZW9mKHRoaXMub3JkZXIoKSkgIT09ICd1bmRlZmluZWQnKSByZXQub3JkZXIodGhpcy5vcmRlcigpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImRhdGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYXRlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhdGUodGhpcy5kYXRlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwibmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJyZW1hcmtcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZW1hcmsoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVtYXJrKHRoaXMucmVtYXJrKCkpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9xdWVyeShncSkge1xuXHRcdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfNzg2MTFfcGxhdGZvcm1fMF90ZWFtJywgWycqJ10pWyd4Xzc4NjExX3BsYXRmb3JtXzBfdGVhbSddKTtcblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgneF83ODYxMV9wbGF0Zm9ybV8wX3RlYW0nKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkodGhpcykpO1xuXHRcdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qIGdzLmluZm8oXCJUZWFtLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdFx0LyogZ3MuaW5mbyhcIlRlYW0uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdFx0LyogZ3MuaW5mbyhcIlRlYW0uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdjb2RlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdjb2RlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2NvZGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdFx0LyogZ3MuaW5mbyhcIlRlYW0uX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2RhdGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qIGdzLmluZm8oXCJUZWFtLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qIGdzLmluZm8oXCJUZWFtLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVtYXJrJykgPj0gMCkge1xuXHRcdFx0XHQvKiBncy5pbmZvKFwiVGVhbS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3JlbWFyaycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdFx0LyogZ3MuaW5mbyhcIlRlYW0uX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdFx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG5cdH1cblxuXHRfc2F2ZShvYmopIHtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHBsYXRmb3JtbWFuYWdlcl9UZWFtKCkuX3NhdmUobylcblx0XHR9KTtcblxuXHRcdGxldCBfb2JqID0ge307XG5cblx0XHQvKmdzLmluZm8oXCJUZWFtLl9zYXZlKCk6IFwiKyBcIi4uLiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4Xzc4NjExX3BsYXRmb3JtXzBfdGVhbScsIFsnKiddKVsneF83ODYxMV9wbGF0Zm9ybV8wX3RlYW0nXSkuZmlsdGVyKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiB0cnVlIHx8IFsnc3lzX3VwZGF0ZWRfb24nLCAnc3lzX2NyZWF0ZWRfb24nLCAndXBkYXRlcycsICdzeXNfY3JlYXRlZF9ieScsICdzeXNfdXBkYXRlZF9ieSddLmluZGV4T2YoX2spIDwgMFxuXHRcdFx0fSkuaW5kZXhPZihrLnRvTG93ZXJDYXNlKCkpID49IDBcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdF9vYmpbay50b0xvd2VyQ2FzZSgpXSA9IG9ialtrXVxuXHRcdH0pO1xuXG5cdFx0T2JqZWN0LmtleXMoX29iaikuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKF9vYmpba10pID09PSBcIltvYmplY3QgRGF0ZV1cIiAmJiBpc05hTihfb2JqW2tdKSkge1xuXHRcdFx0XHRncy5pbmZvKFwiVGVhbS5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0XHRncy5pbmZvKFwiVGVhbS5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGxldCBfdGhpcyA9IG51bGw7XG5cdFx0aWYgKG9iai5fX2tleXMpIHtcblx0XHRcdGxldCBrT2JqID0ge307XG5cdFx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpKSk7XG5cdFx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHRrT2JqW2tdID0gX29ialtrXVxuXHRcdFx0fSk7XG5cdFx0XHRfdGhpcyA9IG5ldyBwbGF0Zm9ybW1hbmFnZXJfVGVhbSgpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF90aGlzID0gbmV3IHBsYXRmb3JtbWFuYWdlcl9UZWFtKCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdFx0fVxuXG5cdFx0Lypncy5pbmZvKFwiVGVhbS5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdFx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRcdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHRcdHRyeSB7XG5cdFx0XHRncy5pbmZvKFwiVGVhbS5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdGdzLmluZm8oXCJUZWFtLl9zYXZlKCk6IFwiICsgXCJyZW5hbWluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0pO1xuXG5cdFx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAneF83ODYxMV9wbGF0Zm9ybV8wX3RlYW0nKTtcblx0XHRcdC8qZ3MuaW5mbyhcIlRlYW0uX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdFx0fVxuXHRcdFx0bGV0IF9mT2JqID0ge307XG5cdFx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKSkpO1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF83ODYxMV9wbGF0Zm9ybV8wX3RlYW0nLCBbJyonXSlbJ3hfNzg2MTFfcGxhdGZvcm1fMF90ZWFtJ10pKSkpO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRncy5pbmZvKFwiVGVhbS5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdFx0Z3MuaW5mbyhcIlRlYW0uX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmoudGVhbV9Qcm9qZWN0cykpIHRoaXMudGVhbV9Qcm9qZWN0cyhvYmoudGVhbV9Qcm9qZWN0cy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgcGxhdGZvcm1tYW5hZ2VyX1Byb2plY3QoKS5fc2F2ZSh0YSlcblx0XHR9KSk7XG5cblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmoudGVhbV9UZWFtX01lbWJlcnMpKSB0aGlzLnRlYW1fVGVhbV9NZW1iZXJzKG9iai50ZWFtX1RlYW1fTWVtYmVycy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgcGxhdGZvcm1tYW5hZ2VyX1RlYW1fTWVtYmVyKCkuX3NhdmUodGEpXG5cdFx0fSkpO1xuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUZWFtLnN0b3JlKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0c3RvcmUoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihsb2dPYmopIHtcblx0XHRcdGdzLmluZm8oXCJUZWFtLnN0b3JlKCk6IFwiICsgXCJsb2dPYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkobG9nT2JqLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0Z3MuaW5mbyhcIlRlYW0uc3RvcmUoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRncy5pbmZvKFwiVGVhbS5zdG9yZSgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0Z3MuaW5mbyhcIlRlYW0uc3RvcmUoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0Ly8gc3RvcmUgbG9jYWxseVxuXHRcdFx0bGV0IF90aGlzID0gdGhpcy5fdW5pcXVlKCkuZmluZCgpO1xuXHRcdFx0aWYgKF90aGlzKSB0aGlzLklkID0gX3RoaXMuSWQ7XG5cblx0XHRcdHJldHVybiB0aGlzLl9zYXZlKHRoaXMuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFRlYW0uZmluZEFsbCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmRBbGwoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihsb2dPYmopIHtcblx0XHRcdGdzLmluZm8oXCJUZWFtLmZpbmRBbGwoKTogXCIgKyBcImxvZ09iajogXCIgKyBKU09OLnN0cmluZ2lmeShsb2dPYmosIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHRncy5pbmZvKFwiVGVhbS5maW5kQWxsKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Z3MuaW5mbyhcIlRlYW0uZmluZEFsbCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0Z3MuaW5mbyhcIlRlYW0uZmluZEFsbCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBmaW5kQWxsIGxvY2FsbHlcblx0XHRcdGxldCBnciA9IG5ldyBHbGlkZVJlY29yZChcIlRlYW1cIik7XG5cdFx0XHRnci5hZGRFbmNvZGVkUXVlcnkodGhpcy5fdG9FUXVlcnkoKSk7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KGdyKTtcblxuXHRcdFx0Ly9yZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KHRoaXMuX3F1ZXJ5KCkuc2VsZWN0KE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfNzg2MTFfcGxhdGZvcm1fMF90ZWFtJywgWycqJ10pWyd4Xzc4NjExX3BsYXRmb3JtXzBfdGVhbSddKSkpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBUZWFtLmZpbmQoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRmaW5kKF9fZXZlbnQpIHtcblx0XHRsZXQgbG9nID0gZnVuY3Rpb24obG9nT2JqKSB7XG5cdFx0XHRncy5pbmZvKFwiVGVhbS5maW5kKCk6IFwiICsgXCJsb2dPYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkobG9nT2JqLCBudWxsLCA0KSk7XG5cdFx0fTtcblxuXHRcdGxldCBhbnN3ZXIgPSB1bmRlZmluZWQ7XG5cblx0XHRsZXQgbm9kZSA9IG51bGw7XG5cblx0XHRsZXQgX19yZXNwb25zZSA9IG51bGw7XG5cblx0XHRsZXQgZXZKU09OID0gbnVsbDtcblx0XHRpZiAoX19ldmVudCkge1xuXHRcdFx0ZXZKU09OID0gSlNPTi5wYXJzZShfX2V2ZW50LnBheWxvYWQoKSk7XG5cdFx0XHRpZiAodHlwZW9mKGV2SlNPTi5fX3RoaXMpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLl9mcm9tRG9jdW1lbnQoZXZKU09OLl9fdGhpcyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfX3Jlc3BvbnNlKSBfX3Jlc3BvbnNlLnJlY2lwaWVudChfX2V2ZW50LnNlbmRlcigpLl91bmlxdWUoKSkucmVzcG9uc2VUbyhfX2V2ZW50Ll91bmlxdWUoKSk7XG5cblx0XHRcdGlmICghX19ldmVudC5yZXNwb25zZVRvKCkpIHtcblx0XHRcdFx0Z3MuaW5mbyhcIlRlYW0uZmluZCgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGdzLmluZm8oXCJUZWFtLmZpbmQoKTogXCIgKyBcImEgcmVzcG9uc2UgdG8gbXkgZXZlbnQoXCIgKyBfX2V2ZW50LnJlc3BvbnNlVG8oKS5jb2RlKCkgKyBcIikgW1wiICsgX19ldmVudC5jbGFzc05hbWUoKSArIFwiKCkuXCIgKyBfX2V2ZW50Lm1ldGhvZCgpICsgXCIoKV1cIik7XG5cblx0XHRcdFx0YW5zd2VyID0gdGhpcy5fbmV3KCkuX2Zyb21Eb2N1bWVudChldkpTT04pO1xuXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdGdzLmluZm8oXCJUZWFtLmZpbmQoKTogXCIgKyBcImV4ZWN1dGluZyBsb2NhbGx5IFwiKTtcblxuXHRcdFx0bGV0IHJldCA9IHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0cmV0dXJuIHJldC5sZW5ndGggPyByZXRbMF0gOiBudWxsO1xuXG5cdFx0fVxuXG5cdFx0aWYgKF9fcmVzcG9uc2UgJiYgKCFfX2V2ZW50IHx8ICFfX2V2ZW50LnJlc3BvbnNlVG8oKSkpIHtcblx0XHRcdGlmIChhbnN3ZXIpIHtcblxuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoYW5zd2VyLl90b0RvY3VtZW50KCkpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRfX3Jlc3BvbnNlLnBheWxvYWQoe1xuXHRcdFx0XHRcdF9fdGhpczogdGhpcy5fdG9Eb2N1bWVudCgpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRfX3Jlc3BvbnNlLnRyaWdnZXIoKTtcblxuXHRcdH1cblxuXHRcdHJldHVybiBhbnN3ZXI7XG5cdH1cblxufSJ9LHsiYWN0aXZlIjp0cnVlLCJhY2Nlc3MiOiJwYWNrYWdlX3ByaXZhdGUiLCJjYWxsZXJfYWNjZXNzIjpudWxsLCJzeXNfbmFtZSI6InBsYXRmb3JtbWFuYWdlcl9Sb2xlIiwiYXBpX25hbWUiOiJ4Xzc4NjExX3BsYXRmb3JtXzAucGxhdGZvcm1tYW5hZ2VyX1JvbGUiLCJuYW1lIjoicGxhdGZvcm1tYW5hZ2VyX1JvbGUiLCJzY3JpcHQiOiJjbGFzcyBwbGF0Zm9ybW1hbmFnZXJfUm9sZSB7XG5cdGNvbnN0cnVjdG9yKGlkKSB7XG5cdFx0dW5kZWZpbmVkXG5cdFx0dGhpcy5JZCA9IGlkO1xuXHRcdHRoaXMuX19tb2R1bGUgPSBcIlwiO1xuXHRcdHRoaXMuX190eXBlID0gXCJwbGF0Zm9ybW1hbmFnZXJfUm9sZVwiO1xuXHRcdHRoaXMuX19hbGlhcyA9IFwicGxhdGZvcm1tYW5hZ2VyXCI7XG5cdFx0dGhpcy5fX3Njb3BlID0gXCJwbGF0Zm9ybW1hbmFnZXJcIjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFJvbGUuYWN0aXZlIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0YWN0aXZlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9hY3RpdmUgPSB2O1xuXHRcdFx0dGhpcy5fYWN0aXZlX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGl2ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBSb2xlLmVuYWJsZWQgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRlbmFibGVkKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9lbmFibGVkID0gdjtcblx0XHRcdHRoaXMuX2VuYWJsZWRfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZW5hYmxlZDtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBSb2xlLmNvZGUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRjb2RlKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9jb2RlID0gdjtcblx0XHRcdHRoaXMuX2NvZGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fY29kZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBSb2xlLm9yZGVyIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0b3JkZXIodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdHRoaXMuX29yZGVyID0gdjtcblx0XHRcdHRoaXMuX29yZGVyX2Nvb3AgPSBjb29wO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xuXHRcdH1cblx0fVxuXG5cdC8qKioqKioqKioqKioqIFJvbGUuZGF0ZSBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGRhdGUodiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdGlmICh2KSB2ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBEYXRlXScgPyB2IDogKG5ldyBEYXRlKHYpKTtcblx0XHRcdGlmICh2ICYmIGlzTmFOKHYuZ2V0VGltZSgpKSkgdiA9IG51bGw7XG5cdFx0XHQvL2dzLmluZm8oXCJSb2xlLmRhdGUoKTogXCIrIFwidHlwZW9mKHYpOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZih2KSwgbnVsbCwgNCkpO1xuXG5cdFx0XHR0aGlzLl9kYXRlID0gdjtcblx0XHRcdHRoaXMuX2RhdGVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZGF0ZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBSb2xlLm5hbWUgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRuYW1lKHYsIGNvb3ApIHtcblx0XHRpZiAodHlwZW9mKHYpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHR0aGlzLl9uYW1lID0gdjtcblx0XHRcdHRoaXMuX25hbWVfY29vcCA9IGNvb3A7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBSb2xlLnJlbWFyayBHRVRURVJTIEFORCBTRVRURVJTICoqKioqKioqKioqKioqKioqKioqKiovXG5cdHJlbWFyayh2LCBjb29wKSB7XG5cdFx0aWYgKHR5cGVvZih2KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0dGhpcy5fcmVtYXJrID0gdjtcblx0XHRcdHRoaXMuX3JlbWFya19jb29wID0gY29vcDtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yZW1hcms7XG5cdFx0fVxuXHR9XG5cblx0LyoqKioqKioqKioqKiogUm9sZS5yb2xlX0VmZm9ydF9Fc3RpbWF0ZXMgR0VUVEVSUyBBTkQgU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRyb2xlX0VmZm9ydF9Fc3RpbWF0ZXModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9yb2xlX0VmZm9ydF9Fc3RpbWF0ZXMgPSAhQXJyYXkuaXNBcnJheSh2KSA/IFt2XSA6IHY7XG5cdFx0XHR0aGlzLl9yb2xlX0VmZm9ydF9Fc3RpbWF0ZXNfY29vcCA9IGNvb3A7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3JvbGVfRWZmb3J0X0VzdGltYXRlcztcblx0XHR9XG5cdH1cblxuXHQvKioqKioqKioqKioqKiBSb2xlLnJvbGVfVGVhbV9NZW1iZXJzIEdFVFRFUlMgQU5EIFNFVFRFUlMgKioqKioqKioqKioqKioqKioqKioqKi9cblx0cm9sZV9UZWFtX01lbWJlcnModiwgY29vcCkge1xuXHRcdGlmICh0eXBlb2YodikgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHR0aGlzLl9yb2xlX1RlYW1fTWVtYmVycyA9ICFBcnJheS5pc0FycmF5KHYpID8gW3ZdIDogdjtcblx0XHRcdHRoaXMuX3JvbGVfVGVhbV9NZW1iZXJzX2Nvb3AgPSBjb29wO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9yb2xlX1RlYW1fTWVtYmVycztcblx0XHR9XG5cdH1cblxuXHRfdG9FUXVlcnkoc1BhdGgpIHtcblx0XHRzUGF0aCA9IHNQYXRoIHx8ICcnO1xuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwgJyc7XG5cblx0XHRpZiAodGhpcy5fYWN0aXZlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnYWN0aXZlJyArICh0aGlzLl9hY3RpdmVfY29vcCB8fCAnPScpICsgdGhpcy5hY3RpdmUoKTtcblxuXHRcdGlmICh0aGlzLl9lbmFibGVkKSByZXQgKz0gJ14nICsgc1BhdGggKyAnZW5hYmxlZCcgKyAodGhpcy5fZW5hYmxlZF9jb29wIHx8ICc9JykgKyB0aGlzLmVuYWJsZWQoKTtcblxuXHRcdGlmICh0aGlzLl9jb2RlKSByZXQgKz0gJ14nICsgc1BhdGggKyAnY29kZScgKyAodGhpcy5fY29kZV9jb29wIHx8ICc9JykgKyB0aGlzLmNvZGUoKTtcblxuXHRcdGlmICh0aGlzLl9vcmRlcikgcmV0ICs9ICdeJyArIHNQYXRoICsgJ29yZGVyJyArICh0aGlzLl9vcmRlcl9jb29wIHx8ICc9JykgKyB0aGlzLm9yZGVyKCk7XG5cblx0XHRpZiAodGhpcy5fZGF0ZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ2RhdGUnICsgKHRoaXMuX2RhdGVfY29vcCB8fCAnPScpICsgdGhpcy5kYXRlKCk7XG5cblx0XHRpZiAodGhpcy5fbmFtZSkgcmV0ICs9ICdeJyArIHNQYXRoICsgJ25hbWUnICsgKHRoaXMuX25hbWVfY29vcCB8fCAnPScpICsgdGhpcy5uYW1lKCk7XG5cblx0XHRpZiAodGhpcy5fcmVtYXJrKSByZXQgKz0gJ14nICsgc1BhdGggKyAncmVtYXJrJyArICh0aGlzLl9yZW1hcmtfY29vcCB8fCAnPScpICsgdGhpcy5yZW1hcmsoKTtcblxuXHRcdCh0aGlzLnJvbGVfRWZmb3J0X0VzdGltYXRlcygpIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXQgKz0gJ15STFFVRVJZRWZmb3J0X0VzdGltYXRlLnJvbGUsPj0xJyArIHRhLl90b0VRdWVyeSgpICsgJ15FTkRSTFFVRVJZJztcblx0XHR9KTtcblxuXHRcdCh0aGlzLnJvbGVfVGVhbV9NZW1iZXJzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldCArPSAnXlJMUVVFUllUZWFtX01lbWJlci5yb2xlLD49MScgKyB0YS5fdG9FUXVlcnkoKSArICdeRU5EUkxRVUVSWSc7XG5cdFx0fSk7XG5cblx0XHRncy5pbmZvKFwiUm9sZS5fdG9FUXVlcnkoKTogXCIgKyBcInJldDogXCIgKyBKU09OLnN0cmluZ2lmeShyZXQsIG51bGwsIDQpKTtcblx0XHRyZXR1cm4gcmV0O1xuXHR9XG5cblx0X2ludm9rZShtZXRob2QsIHBheWxvYWQpIHtcblx0XHRpZiAoIW1ldGhvZCkgcmV0dXJuIG51bGw7XG5cdFx0aWYgKHR5cGVvZihwYXlsb2FkKSA9PT0gJ3N0cmluZycpIHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBKU09OLnBhcnNlKHBheWxvYWQpKTtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShwYXlsb2FkKSkgcmV0dXJuIHBheWxvYWQubWFwKGZ1bmN0aW9uKHApIHtcblx0XHRcdHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBwKTtcblx0XHR9KTtcblxuXHRcdHRoaXMuX2Zyb21Eb2N1bWVudChwYXlsb2FkKTtcblxuXHRcdGdzLmluZm8oXCJSb2xlLl9pbnZva2UoKTogXCIgKyBcIm1ldGhvZDogXCIgKyBKU09OLnN0cmluZ2lmeShtZXRob2QsIG51bGwsIDQpKTtcblxuXHRcdHN3aXRjaCAobWV0aG9kKSB7XG5cblx0XHRcdGNhc2UgXCJzdG9yZVwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnN0b3JlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGNhc2UgXCJmaW5kQWxsXCI6IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEFsbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRjYXNlIFwiZmluZFwiOiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmZpbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHQvLyBpZih0eXBlb2YodGhpc1ttZXRob2RdKT09PSdmdW5jdGlvbicpIHJldHVybiB0aGlzW21ldGhvZF0ocGF5bG9hZCk7XG5cblx0XHRcdFx0Z3MuaW5mbyhcIlJvbGUuX2ludm9rZSgpOiBcIiArIFwiaW52YWxpZCBtZXRob2QgXCIgKyBtZXRob2QpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfZnJvbURvY3VtZW50KG9iaikge1xuXHRcdGlmICghb2JqKSByZXR1cm4gdGhpczsgLy8gdGVzdFxuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHRpZiAodHlwZW9mKG9iai5pc1ZhbGlkUmVjb3JkKSAhPT0gJ2Z1bmN0aW9uJyAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PSBcIlN0cmVhbVwiKSB7XG5cdFx0XHRsZXQgcmV0ID0gW107XG5cdFx0XHRvYmouZm9yRWFjaChmdW5jdGlvbihvKSB7XG5cdFx0XHRcdHJldC5wdXNoKG5ldyBwbGF0Zm9ybW1hbmFnZXJfUm9sZSgpLl9mcm9tRG9jdW1lbnQobykpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpIHtcblx0XHRcdHRyeSB7XG5cdFx0XHRcdG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcblx0XHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRcdC8qZ3MuaW5mbyhcIlJvbGUuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwic3RyaW5nIFtcIitvYmorXCJdIGludG8gXCIgKyAoKGZ1bmN0aW9uKHIpe1xuICAgIGxldCByZXQgPSAnc3lzX2lkJztcbiAgICBpZih0eXBlb2Yoci5fX2lkRmllbGQpPT09J2Z1bmN0aW9uJyl7XG4gICAgICAgIHJldCA9IHIuX19pZEZpZWxkKCk7XG4gICAgfWVsc2UgaWYodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCk9PT0nZnVuY3Rpb24nP3RoaXMuX19pZEZpZWxkKCk6dW5kZWZpbmVkKV0pIT09J3VuZGVmaW5lZCcpe1xuICAgICAgICByZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuICAgIH1lbHNlIGlmKHR5cGVvZihyLklkKSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ0lkJztcbiAgICB9ZWxzZSBpZih0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSE9PSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmV0ID0gJ3N5c19pZCc7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59KSh0aGlzKSkpOyovXG5cdFx0XHRcdGxldCBfb2JqID0ge1xuXHRcdFx0XHRcdF9faWRGaWVsZDogKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0XHR9KSh0aGlzKSlcblx0XHRcdFx0fTtcblx0XHRcdFx0X29ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHRcdH0pKHRoaXMpKV0gPSBvYmo7XG5cdFx0XHRcdG9iaiA9IF9vYmo7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdGhpcy5fZnJvbURvY3VtZW50KG9iaik7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcblx0XHRcdGlmICh0eXBlb2Yob2JqLmlzVmFsaWRSZWNvcmQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdGlmIChvYmouaXNWYWxpZFJlY29yZCgpKSB7XG5cdFx0XHRcdFx0aWYgKG9iai5nZXRUYWJsZU5hbWUoKSA9PSAnZWNjX3F1ZXVlJyAmJiBcIlJvbGVcIiAhPSAnZWNjX3F1ZXVlJyAmJiBvYmouc291cmNlID09IFwiUm9sZVwiKSB7XG5cdFx0XHRcdFx0XHRvYmouc3RhdGUgPSBcInByb2Nlc3NpbmdcIjtcblx0XHRcdFx0XHRcdG9iai51cGRhdGUoKTtcblxuXHRcdFx0XHRcdFx0bGV0IHJlc3AgPSBuZXcgR2xpZGVSZWNvcmQoJ2VjY19xdWV1ZScpO1xuXHRcdFx0XHRcdFx0cmVzcC5yZXNwb25zZV90byA9IG9iai5zeXNfaWQ7XG5cdFx0XHRcdFx0XHRyZXNwLnF1ZXVlID0gJ291dHB1dCc7XG5cdFx0XHRcdFx0XHRyZXNwLmFnZW50ID0gb2JqLmFnZW50O1xuXHRcdFx0XHRcdFx0cmVzcC50b3BpYyA9IG9iai50b3BpYztcblx0XHRcdFx0XHRcdHJlc3AubmFtZSA9IG9iai5uYW1lO1xuXHRcdFx0XHRcdFx0cmVzcC5zb3VyY2UgPSBvYmouc291cmNlO1xuXHRcdFx0XHRcdFx0cmVzcC5mcm9tX2hvc3QgPSBvYmouYWdlbnRfY29ycmVsYXRvcjtcblx0XHRcdFx0XHRcdHJlc3AuYWdlbnRfY29ycmVsYXRvciA9IG9iai5mcm9tX2hvc3Q7XG5cblx0XHRcdFx0XHRcdGxldCByZXQgPSBuZXcgcGxhdGZvcm1tYW5hZ2VyX1JvbGUoKS5fZnJvbURvY3VtZW50KCkuX2ludm9rZShvYmoubmFtZS50b1N0cmluZygpLCBvYmoucGF5bG9hZC50b1N0cmluZygpKTtcblx0XHRcdFx0XHRcdGlmIChBcnJheS5pc0FycmF5KHJldCkpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gcmV0Lm1hcChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIChyICYmIHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJykgPyByLl90b0RvY3VtZW50KCkgOiByO1xuXHRcdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAocmV0ICYmIHR5cGVvZihyZXQuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHJldC5fdG9Eb2N1bWVudCgpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmVzcC5wYXlsb2FkID0gSlNPTi5zdHJpbmdpZnkocmV0LCBudWxsLCA0KTtcblxuXHRcdFx0XHRcdFx0cmVzcC5pbnNlcnQoKTtcblxuXHRcdFx0XHRcdFx0b2JqLnN0YXRlID0gXCJwcm9jZXNzZWRcIjtcblx0XHRcdFx0XHRcdG9iai51cGRhdGUoKTtcblx0XHRcdFx0XHRcdHJldHVybiByZXNwO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoe1xuXG5cdFx0XHRcdFx0XHRhY3RpdmU6IG9iai5nZXRWYWx1ZShcImFjdGl2ZVwiKSxcblxuXHRcdFx0XHRcdFx0ZW5hYmxlZDogb2JqLmdldFZhbHVlKFwiZW5hYmxlZFwiKSxcblxuXHRcdFx0XHRcdFx0Y29kZTogb2JqLmdldFZhbHVlKFwiY29kZVwiKSxcblxuXHRcdFx0XHRcdFx0b3JkZXI6IG9iai5nZXRWYWx1ZShcIm9yZGVyXCIpLFxuXG5cdFx0XHRcdFx0XHRkYXRlOiBvYmouZ2V0VmFsdWUoXCJkYXRlXCIpLFxuXG5cdFx0XHRcdFx0XHRuYW1lOiBvYmouZ2V0VmFsdWUoXCJuYW1lXCIpLFxuXG5cdFx0XHRcdFx0XHRyZW1hcms6IG9iai5nZXRWYWx1ZShcInJlbWFya1wiKSxcblxuXHRcdFx0XHRcdFx0SWQ6IG9iai5nZXRWYWx1ZSgnc3lzX2lkJylcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRvYmoucXVlcnkoKTtcblx0XHRcdFx0XHRsZXQgZ3JSZXQgPSBbXTtcblx0XHRcdFx0XHR3aGlsZSAob2JqLm5leHQoKSkgZ3JSZXQucHVzaCh0aGlzLl9mcm9tRG9jdW1lbnQob2JqKSk7XG5cdFx0XHRcdFx0Lypncy5pbmZvKFwiUm9sZS5fZnJvbURvY3VtZW50KCk6IFwiKyBcImdsaWRlIG9iamVjdHMgXCIrIFwiZ3JSZXQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JSZXQsIG51bGwsIDQpKTsqL1xuXHRcdFx0XHRcdHJldHVybiBnclJldDtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmIChvYmouX2Zyb21Eb2N1bWVudCkge1xuXHRcdFx0XHRncy5pbmZvKFwiUm9sZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJyZWR1bmRlbnQgY2FsbFwiKTtcblx0XHRcdFx0cmV0dXJuIG9iajtcblx0XHRcdH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG5cdFx0XHRcdHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKG8pIHtcblx0XHRcdFx0XHRyZXR1cm4gbmV3IHBsYXRmb3JtbWFuYWdlcl9Sb2xlKCkuX2Zyb21Eb2N1bWVudChvKVxuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKG9iai5jb25zdHJ1Y3RvcikgPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRpZiAob2JqLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuXG5cdFx0XHRcdFx0dGhpcy5JZCA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZihyKSA9PT0gJ29iamVjdCcgJiYgcikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mKHIuX3RvRG9jdW1lbnQpID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZihyW2ZdKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcltmXTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHRcdFx0fSkob2JqLCAoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0XHRcdH0pKG9iaikpKSk7XG5cblx0XHRcdFx0XHQvKmdzLmluZm8oXCJSb2xlLl9mcm9tRG9jdW1lbnQoKTogXCIrIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpOyovXG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5hY3RpdmUpICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLmFjdGl2ZShvYmouYWN0aXZlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5lbmFibGVkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5lbmFibGVkKG9iai5lbmFibGVkKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5jb2RlKG9iai5jb2RlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5vcmRlcikgIT09ICd1bmRlZmluZWQnKSB7XG5cblx0XHRcdFx0XHRcdHRoaXMub3JkZXIob2JqLm9yZGVyKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5kYXRlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5kYXRlKG9iai5kYXRlKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5uYW1lKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblxuXHRcdFx0XHRcdFx0dGhpcy5uYW1lKG9iai5uYW1lKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRcdFx0XHR0aGlzLnJlbWFyayhTdHJpbmcoKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjREZWNvZGUob2JqLnJlbWFyaykpKTtcblxuXHRcdFx0XHRcdFx0dGhpcy5yZW1hcmsob2JqLnJlbWFyayk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHR5cGVvZihvYmoucm9sZV9FZmZvcnRfRXN0aW1hdGVzKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMucm9sZV9FZmZvcnRfRXN0aW1hdGVzKG5ldyBwbGF0Zm9ybW1hbmFnZXJfRWZmb3J0X0VzdGltYXRlKCkuX2Zyb21Eb2N1bWVudChvYmoucm9sZV9FZmZvcnRfRXN0aW1hdGVzKSk7XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mKG9iai5yb2xlX1RlYW1fTWVtYmVycykgIT09ICd1bmRlZmluZWQnKSB0aGlzLnJvbGVfVGVhbV9NZW1iZXJzKG5ldyBwbGF0Zm9ybW1hbmFnZXJfVGVhbV9NZW1iZXIoKS5fZnJvbURvY3VtZW50KG9iai5yb2xlX1RlYW1fTWVtYmVycykpO1xuXG5cdFx0XHRcdH0gZWxzZSB7IC8vIGlmKG9iai5jb25zdHJ1Y3Rvci5uYW1lPT1cIlJvbGVcIil7XG5cdFx0XHRcdFx0Z3MuaW5mbyhcIlJvbGUuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwidW5rbm93biBvYmplY3QgY29uc3RydWN0b3I6IFwiICsgb2JqLmNvbnN0cnVjdG9yLm5hbWUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRncy5pbmZvKFwiUm9sZS5fZnJvbURvY3VtZW50KCk6IFwiICsgXCJ1bmtub3duIG9iamVjdCBcIiArIFwib2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgNCkpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0Z3MuaW5mbyhcIlJvbGUuX2Zyb21Eb2N1bWVudCgpOiBcIiArIFwiaW52YWxpZCBvYmplY3QgXCIgKyBcInR5cGVvZihvYmopOiBcIiArIEpTT04uc3RyaW5naWZ5KHR5cGVvZihvYmopLCBudWxsLCA0KSk7XG5cdFx0fVxuXG5cdFx0Lypncy5pbmZvKFwiUm9sZS5fZnJvbURvY3VtZW50KCk6IFwiKyBcIklkIFwiKyBcInRoaXMuSWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5JZCwgbnVsbCwgNCkpOyovXG5cdFx0Lypncy5pbmZvKFwiUm9sZS5fZnJvbURvY3VtZW50KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyovXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRfbmV3KGMpIHtcblx0XHRpZiAoIWMpIGMgPSB0aGlzLl9fdHlwZTtcblx0XHRpZiAoYy5pbmRleE9mKCdwbGF0Zm9ybW1hbmFnZXJfJykgIT0gMCkgYyA9ICh7XG5cdFx0XHRQbGF0Zm9ybTogXCJwbGF0Zm9ybW1hbmFnZXJfUGxhdGZvcm1cIixcblx0XHRcdFVzZXI6IFwicGxhdGZvcm1tYW5hZ2VyX1VzZXJcIixcblx0XHRcdFJlcXVpcmVtZW50OiBcInBsYXRmb3JtbWFuYWdlcl9SZXF1aXJlbWVudFwiLFxuXHRcdFx0RWZmb3J0X0VzdGltYXRlOiBcInBsYXRmb3JtbWFuYWdlcl9FZmZvcnRfRXN0aW1hdGVcIixcblx0XHRcdEVmZm9ydDogXCJwbGF0Zm9ybW1hbmFnZXJfRWZmb3J0XCIsXG5cdFx0XHRCdWRnZXQ6IFwicGxhdGZvcm1tYW5hZ2VyX0J1ZGdldFwiLFxuXHRcdFx0QWdlbmRhX0l0ZW06IFwicGxhdGZvcm1tYW5hZ2VyX0FnZW5kYV9JdGVtXCIsXG5cdFx0XHRNZWV0aW5nX0FnZW5kYTogXCJwbGF0Zm9ybW1hbmFnZXJfTWVldGluZ19BZ2VuZGFcIixcblx0XHRcdERlY2lzaW9uX09wdGlvbjogXCJwbGF0Zm9ybW1hbmFnZXJfRGVjaXNpb25fT3B0aW9uXCIsXG5cdFx0XHREZWNpc2lvbjogXCJwbGF0Zm9ybW1hbmFnZXJfRGVjaXNpb25cIixcblx0XHRcdE1lZXRpbmdfTWludXRlOiBcInBsYXRmb3JtbWFuYWdlcl9NZWV0aW5nX01pbnV0ZVwiLFxuXHRcdFx0TWVldGluZ19TZXJpZXM6IFwicGxhdGZvcm1tYW5hZ2VyX01lZXRpbmdfU2VyaWVzXCIsXG5cdFx0XHRNZWV0aW5nOiBcInBsYXRmb3JtbWFuYWdlcl9NZWV0aW5nXCIsXG5cdFx0XHRCb2FyZDogXCJwbGF0Zm9ybW1hbmFnZXJfQm9hcmRcIixcblx0XHRcdEJvYXJkX01lbWJlcjogXCJwbGF0Zm9ybW1hbmFnZXJfQm9hcmRfTWVtYmVyXCIsXG5cdFx0XHRGcmVxdWVuY3k6IFwicGxhdGZvcm1tYW5hZ2VyX0ZyZXF1ZW5jeVwiLFxuXHRcdFx0TW9kdWxlOiBcInBsYXRmb3JtbWFuYWdlcl9Nb2R1bGVcIixcblx0XHRcdENhcGFiaWxpdHk6IFwicGxhdGZvcm1tYW5hZ2VyX0NhcGFiaWxpdHlcIixcblx0XHRcdFRlYW06IFwicGxhdGZvcm1tYW5hZ2VyX1RlYW1cIixcblx0XHRcdFByb2plY3Q6IFwicGxhdGZvcm1tYW5hZ2VyX1Byb2plY3RcIixcblx0XHRcdFRlYW1fTWVtYmVyOiBcInBsYXRmb3JtbWFuYWdlcl9UZWFtX01lbWJlclwiLFxuXHRcdFx0Um9sZTogXCJwbGF0Zm9ybW1hbmFnZXJfUm9sZVwiLFxuXHRcdH0pW2NdO1xuXHRcdHJldHVybiBuZXcoZ3MuZ2V0Q3VycmVudFNjb3BlTmFtZSgpID09ICdyaGluby5nbG9iYWwnID8gZ2xvYmFsIDogeF83ODYxMV9wbGF0Zm9ybV8wKVtjXSgpO1xuXHR9XG5cblx0X3RvRG9jdW1lbnQoYXJGaWVsZHMpIHtcblxuXHRcdGxldCByZXQgPSB1bmRlZmluZWQgfHwge307XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuSWQpICE9PSAndW5kZWZpbmVkJykgcmV0LnN5c19pZCA9IHRoaXMuSWQ7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2FjdGl2ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuYWN0aXZlID0gdGhpcy5hY3RpdmUoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZW5hYmxlZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZW5hYmxlZCA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9jb2RlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5jb2RlID0gdGhpcy5jb2RlKCk7XG5cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX29yZGVyKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJldC5vcmRlciA9IHRoaXMub3JkZXIoKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQuZGF0ZSA9IHRoaXMuZGF0ZSgpO1xuXG5cdFx0XHRpZiAocmV0LmRhdGUgJiYgdHlwZW9mKHJldC5kYXRlLnRvSVNPU3RyaW5nKSA9PT0gJ2Z1bmN0aW9uJykgcmV0LmRhdGUgPSByZXQuZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoJy4wMDBaJywgJ1onKTtcblxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fbmFtZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRyZXQubmFtZSA9IHRoaXMubmFtZSgpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLl9yZW1hcmspICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0LnJlbWFyayA9IHRoaXMucmVtYXJrKCk7XG5cblx0XHRcdGlmICh0eXBlb2YocmV0LnJlbWFyaykgPT09ICdvYmplY3QnKSByZXQucmVtYXJrID0gKGdzLmdldEN1cnJlbnRTY29wZU5hbWUoKSA9PSAncmhpbm8uZ2xvYmFsJyA/IEdsaWRlU3RyaW5nVXRpbCA6IGdzKS5iYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocmV0LnJlbWFyaykpO1xuXG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZih0aGlzLnJvbGVfRWZmb3J0X0VzdGltYXRlcygpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5yb2xlX0VmZm9ydF9Fc3RpbWF0ZXMgPSB0aGlzLnJvbGVfRWZmb3J0X0VzdGltYXRlcygpLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIHRhLl90b0RvY3VtZW50KCk7XG5cdFx0fSk7XG5cblx0XHRpZiAodHlwZW9mKHRoaXMucm9sZV9UZWFtX01lbWJlcnMoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucm9sZV9UZWFtX01lbWJlcnMgPSB0aGlzLnJvbGVfVGVhbV9NZW1iZXJzKCkubWFwKGZ1bmN0aW9uKHRhKSB7XG5cdFx0XHRyZXR1cm4gdGEuX3RvRG9jdW1lbnQoKTtcblx0XHR9KTtcblxuXHRcdGlmIChBcnJheS5pc0FycmF5KGFyRmllbGRzKSkgT2JqZWN0LmtleXMocmV0KS5maWx0ZXIoZnVuY3Rpb24oaykge1xuXHRcdFx0cmV0dXJuICFhckZpZWxkcy5maW5kKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiBfayA9PSBrO1xuXHRcdFx0fSk7XG5cdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRkZWxldGUgcmV0W2tdO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF91bmlxdWUoa2V5cywgcmV0KSB7XG5cdFx0cmV0ID0gcmV0IHx8IG5ldyBwbGF0Zm9ybW1hbmFnZXJfUm9sZSgpO1xuXG5cdFx0dW5kZWZpbmVkXG5cblx0XHQvLyBpZih0aGlzLklkKSByZXQuSWQgPSB0aGlzLklkO1xuXHRcdGlmICgha2V5cykge1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdH0gZWxzZSB7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJhY3RpdmVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5hY3RpdmUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuYWN0aXZlKHRoaXMuYWN0aXZlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwiZW5hYmxlZFwiKSA+PSAwICYmIHR5cGVvZih0aGlzLmVuYWJsZWQoKSkgIT09ICd1bmRlZmluZWQnKSByZXQuZW5hYmxlZCh0aGlzLmVuYWJsZWQoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJjb2RlXCIpID49IDAgJiYgdHlwZW9mKHRoaXMuY29kZSgpKSAhPT0gJ3VuZGVmaW5lZCcpIHJldC5jb2RlKHRoaXMuY29kZSgpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcIm9yZGVyXCIpID49IDAgJiYgdHlwZW9mKHRoaXMub3JkZXIoKSkgIT09ICd1bmRlZmluZWQnKSByZXQub3JkZXIodGhpcy5vcmRlcigpKTtcblxuXHRcdFx0aWYgKGtleXMuaW5kZXhPZihcImRhdGVcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5kYXRlKCkpICE9PSAndW5kZWZpbmVkJykgcmV0LmRhdGUodGhpcy5kYXRlKCkpO1xuXG5cdFx0XHRpZiAoa2V5cy5pbmRleE9mKFwibmFtZVwiKSA+PSAwICYmIHR5cGVvZih0aGlzLm5hbWUoKSkgIT09ICd1bmRlZmluZWQnKSByZXQubmFtZSh0aGlzLm5hbWUoKSk7XG5cblx0XHRcdGlmIChrZXlzLmluZGV4T2YoXCJyZW1hcmtcIikgPj0gMCAmJiB0eXBlb2YodGhpcy5yZW1hcmsoKSkgIT09ICd1bmRlZmluZWQnKSByZXQucmVtYXJrKHRoaXMucmVtYXJrKCkpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdF9xdWVyeShncSkge1xuXHRcdGxldCBhckZpZWxkcyA9IE9iamVjdC5rZXlzKGdsb2JhbC5TY2hlbWEub2YoJ3hfNzg2MTFfcGxhdGZvcm1fMF9yb2xlJywgWycqJ10pWyd4Xzc4NjExX3BsYXRmb3JtXzBfcm9sZSddKTtcblxuXHRcdGlmICghdGhpcy5fcXVlcnlHUSkgdGhpcy5fcXVlcnlHUSA9IG5ldyBnbG9iYWwuR2xpZGVRdWVyeSgneF83ODYxMV9wbGF0Zm9ybV8wX3JvbGUnKTtcblxuXHRcdHVuZGVmaW5lZFxuXG5cdFx0bGV0IGlkZiA9ICgoZnVuY3Rpb24ocikge1xuXHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdH1cblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fSkodGhpcykpO1xuXHRcdGlmIChpZGYgPT0gJ0lkJykgaWRmID0gJ3N5c19pZCc7XG5cdFx0aWYgKHR5cGVvZih0aGlzLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKGlkZiwgJz0nLCB0aGlzLklkKTtcblxuXHRcdGlmICh0eXBlb2YodGhpcy5fYWN0aXZlKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdGxldCBjb29wID0gdGhpcy5fYWN0aXZlX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuYWN0aXZlKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdhY3RpdmUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qIGdzLmluZm8oXCJSb2xlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnYWN0aXZlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdhY3RpdmUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnYWN0aXZlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX2VuYWJsZWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9lbmFibGVkX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuZW5hYmxlZCgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignZW5hYmxlZCcpID49IDApIHtcblx0XHRcdFx0LyogZ3MuaW5mbyhcIlJvbGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdlbmFibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2VuYWJsZWQnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fY29kZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2NvZGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGlmICghdGhpcy5fY29kZV9jb29wKSBjb29wID0gJ1NUQVJUU1dJVEgnO1xuXG5cdFx0XHRsZXQgdiA9IHRoaXMuY29kZSgpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZignY29kZScpID49IDApIHtcblx0XHRcdFx0LyogZ3MuaW5mbyhcIlJvbGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdjb2RlJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJyE9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTm9OdWxsKCdjb2RlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ2NvZGUnLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fb3JkZXIpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9vcmRlcl9jb29wIHx8ICc9JztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm9yZGVyKCk7XG5cblx0XHRcdGlmIChhckZpZWxkcy5pbmRleE9mKCdvcmRlcicpID49IDApIHtcblx0XHRcdFx0LyogZ3MuaW5mbyhcIlJvbGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXM6IFwiICsgSlNPTi5zdHJpbmdpZnkodGhpcywgbnVsbCwgNCkpOyAqL1xuXHRcdFx0XHRpZiAodiA9PSBudWxsICYmIGNvb3AgPT0gJz0nKSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmVOdWxsKCdvcmRlcicpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnb3JkZXInKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZSgnb3JkZXInLCBjb29wLCB2KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YodGhpcy5fZGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX2RhdGVfY29vcCB8fCAnPSc7XG5cblx0XHRcdGxldCB2ID0gdGhpcy5kYXRlKCk7XG5cblx0XHRcdGlmICh2KSB7XG5cdFx0XHRcdHYgPSBuZXcgR2xpZGVEYXRlVGltZSh2LnRvSlNPTigpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ2RhdGUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qIGdzLmluZm8oXCJSb2xlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnZGF0ZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCdkYXRlJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX25hbWUpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0bGV0IGNvb3AgPSB0aGlzLl9uYW1lX2Nvb3AgfHwgJz0nO1xuXG5cdFx0XHRpZiAoIXRoaXMuX25hbWVfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLm5hbWUoKTtcblxuXHRcdFx0aWYgKGFyRmllbGRzLmluZGV4T2YoJ25hbWUnKSA+PSAwKSB7XG5cdFx0XHRcdC8qIGdzLmluZm8oXCJSb2xlLl9xdWVyeSgpOiBcIisgXCJ0aGlzOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMsIG51bGwsIDQpKTsgKi9cblx0XHRcdFx0aWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICc9Jykge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgnbmFtZScpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuX3F1ZXJ5R1EgPSB0aGlzLl9xdWVyeUdRLndoZXJlKCduYW1lJywgY29vcCwgdik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodHlwZW9mKHRoaXMuX3JlbWFyaykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRsZXQgY29vcCA9IHRoaXMuX3JlbWFya19jb29wIHx8ICc9JztcblxuXHRcdFx0aWYgKCF0aGlzLl9yZW1hcmtfY29vcCkgY29vcCA9ICdTVEFSVFNXSVRIJztcblxuXHRcdFx0bGV0IHYgPSB0aGlzLnJlbWFyaygpO1xuXG5cdFx0XHRpZiAoYXJGaWVsZHMuaW5kZXhPZigncmVtYXJrJykgPj0gMCkge1xuXHRcdFx0XHQvKiBncy5pbmZvKFwiUm9sZS5fcXVlcnkoKTogXCIrIFwidGhpczogXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLCBudWxsLCA0KSk7ICovXG5cdFx0XHRcdGlmICh2ID09IG51bGwgJiYgY29vcCA9PSAnPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU51bGwoJ3JlbWFyaycpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHYgPT0gbnVsbCAmJiBjb29wID09ICchPScpIHtcblx0XHRcdFx0XHR0aGlzLl9xdWVyeUdRID0gdGhpcy5fcXVlcnlHUS53aGVyZU5vTnVsbCgncmVtYXJrJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fcXVlcnlHUSA9IHRoaXMuX3F1ZXJ5R1Eud2hlcmUoJ3JlbWFyaycsIGNvb3AsIHYpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKCF0aGlzLl9xdWVyeUdRLnBsYW4ubGVuZ3RoKSB0aGlzLl9xdWVyeUdRLndoZXJlTnVsbChpZGYpO1xuXG5cdFx0LyogZ3MuaW5mbyhcIlJvbGUuX3F1ZXJ5KCk6IFwiKyBcInRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpOiBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuX3F1ZXJ5R1EudG9HbGlkZVJlY29yZCgpLmdldEVuY29kZWRRdWVyeSgpLCBudWxsLCA0KSk7ICovXG5cdFx0cmV0dXJuIHRoaXMuX3F1ZXJ5R1E7XG5cdH1cblxuXHRfc2F2ZShvYmopIHtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmopKSByZXR1cm4gb2JqLm1hcChmdW5jdGlvbihvKSB7XG5cdFx0XHRyZXR1cm4gbmV3IHBsYXRmb3JtbWFuYWdlcl9Sb2xlKCkuX3NhdmUobylcblx0XHR9KTtcblxuXHRcdGxldCBfb2JqID0ge307XG5cblx0XHQvKmdzLmluZm8oXCJSb2xlLl9zYXZlKCk6IFwiKyBcIi4uLiBcIisgXCJvYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCA0KSk7Ki9cblxuXHRcdE9iamVjdC5rZXlzKG9iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdHJldHVybiBPYmplY3Qua2V5cyhnbG9iYWwuU2NoZW1hLm9mKCd4Xzc4NjExX3BsYXRmb3JtXzBfcm9sZScsIFsnKiddKVsneF83ODYxMV9wbGF0Zm9ybV8wX3JvbGUnXSkuZmlsdGVyKGZ1bmN0aW9uKF9rKSB7XG5cdFx0XHRcdHJldHVybiB0cnVlIHx8IFsnc3lzX3VwZGF0ZWRfb24nLCAnc3lzX2NyZWF0ZWRfb24nLCAndXBkYXRlcycsICdzeXNfY3JlYXRlZF9ieScsICdzeXNfdXBkYXRlZF9ieSddLmluZGV4T2YoX2spIDwgMFxuXHRcdFx0fSkuaW5kZXhPZihrLnRvTG93ZXJDYXNlKCkpID49IDBcblx0XHR9KS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdF9vYmpbay50b0xvd2VyQ2FzZSgpXSA9IG9ialtrXVxuXHRcdH0pO1xuXG5cdFx0T2JqZWN0LmtleXMoX29iaikuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKF9vYmpba10pID09PSBcIltvYmplY3QgRGF0ZV1cIiAmJiBpc05hTihfb2JqW2tdKSkge1xuXHRcdFx0XHRncy5pbmZvKFwiUm9sZS5fc2F2ZSgpOiBcIiArIFwiaW52YWxpZCBkYXRlIFwiICsgXCJrOiBcIiArIEpTT04uc3RyaW5naWZ5KGssIG51bGwsIDQpKTtcblx0XHRcdFx0ZGVsZXRlIF9vYmpba107XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihfb2JqW2tdKSA9PT0gJ29iamVjdCcgJiYgX29ialtrXSAmJiBfb2JqW2tdLnN5c19pZCkge1xuXHRcdFx0XHRncy5pbmZvKFwiUm9sZS5fc2F2ZSgpOiBcIiArIFwic3lzX2lkIHRvIHN0cmluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdF9vYmpba10gPSBfb2JqW2tdLnN5c19pZDtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGxldCBfdGhpcyA9IG51bGw7XG5cdFx0aWYgKG9iai5fX2tleXMpIHtcblx0XHRcdGxldCBrT2JqID0ge307XG5cdFx0XHRrT2JqWygoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKF9vYmosICgoZnVuY3Rpb24ocikge1xuXHRcdFx0XHRsZXQgcmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdGlmICh0eXBlb2Yoci5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YocltyLl9faWRGaWVsZCB8fCAodHlwZW9mKHRoaXMuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuX19pZEZpZWxkKCkgOiB1bmRlZmluZWQpXSkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gci5fX2lkRmllbGQgfHwgdGhpcy5fX2lkRmllbGQoKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5JZCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ0lkJztcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2Yoci5zeXNfbW9kX2NvdW50KSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdFx0fSkoX29iaikpKSk7XG5cdFx0XHRvYmouX19rZXlzLmZvckVhY2goZnVuY3Rpb24oaykge1xuXHRcdFx0XHRrT2JqW2tdID0gX29ialtrXVxuXHRcdFx0fSk7XG5cdFx0XHRfdGhpcyA9IG5ldyBwbGF0Zm9ybW1hbmFnZXJfUm9sZSgpLl9mcm9tRG9jdW1lbnQoa09iaik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdF90aGlzID0gbmV3IHBsYXRmb3JtbWFuYWdlcl9Sb2xlKCkuX2Zyb21Eb2N1bWVudChfb2JqKS5fdW5pcXVlKCk7XG5cdFx0fVxuXG5cdFx0Lypncy5pbmZvKFwiUm9sZS5fc2F2ZSgpOiBcIiArIFwiX3RoaXMuSWQ9XCIgKyBfdGhpcy5JZCArIFwiLCBfdGhpcy5maW5kKCkuSWQ6IFwiICsgX3RoaXMuZmluZCgpLklkKTsqL1xuXG5cdFx0X29iai5zeXNfaWQgPSAoX3RoaXMuZmluZCgpIHx8IHRoaXMgfHwge30pLklkIHx8IF9vYmouc3lzX2lkO1xuXHRcdGRlbGV0ZSBfb2JqLl9faWRGaWVsZDtcblxuXHRcdHRyeSB7XG5cdFx0XHRncy5pbmZvKFwiUm9sZS5fc2F2ZSgpOiBcIiArIFwiX29iai5zeXNfaWQ6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iai5zeXNfaWQsIG51bGwsIDQpKTtcblxuXHRcdFx0T2JqZWN0LmtleXMoX29iaikuZmlsdGVyKGZ1bmN0aW9uKGspIHtcblx0XHRcdFx0cmV0dXJuIGsudG9Mb3dlckNhc2UoKSAhPSBrO1xuXHRcdFx0fSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRcdGdzLmluZm8oXCJSb2xlLl9zYXZlKCk6IFwiICsgXCJyZW5hbWluZyBcIiArIFwiazogXCIgKyBKU09OLnN0cmluZ2lmeShrLCBudWxsLCA0KSk7XG5cdFx0XHRcdHZhciBsayA9IGsudG9Mb3dlckNhc2UoKTtcblx0XHRcdFx0X29ialtsa10gPSBfb2JqW2tdO1xuXHRcdFx0XHRkZWxldGUgX29ialtrXTtcblx0XHRcdH0pO1xuXG5cdFx0XHRsZXQgZ3EgPSBuZXcgZ2xvYmFsLkdsaWRlUXVlcnkob2JqLl9fdHlwZSB8fCAneF83ODYxMV9wbGF0Zm9ybV8wX3JvbGUnKTtcblx0XHRcdC8qZ3MuaW5mbyhcIlJvbGUuX3NhdmUoKTogXCIrIFwidXBzZXJ0aW5nLi4uIFwiKyBcIl9vYmo6IFwiICsgSlNPTi5zdHJpbmdpZnkoX29iaiwgbnVsbCwgNCkpOyovXG5cdFx0XHRpZiAoX29iai5zeXNfaWQpIHtcblx0XHRcdFx0Z3EgPSBncS53aGVyZSgnc3lzX2lkJywgX29iai5zeXNfaWQpLnVwZGF0ZShfb2JqKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9vYmouc3lzX2lkID0gZ3MuZ2VuZXJhdGVHVUlEKCk7XG5cdFx0XHRcdGdxID0gZ3EuaW5zZXJ0KF9vYmopO1xuXHRcdFx0fVxuXHRcdFx0bGV0IF9mT2JqID0ge307XG5cdFx0XHRfZk9ialsoKGZ1bmN0aW9uKHIpIHtcblx0XHRcdFx0bGV0IHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHRpZiAodHlwZW9mKHIuX19pZEZpZWxkKSA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHJbci5fX2lkRmllbGQgfHwgKHR5cGVvZih0aGlzLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicgPyB0aGlzLl9faWRGaWVsZCgpIDogdW5kZWZpbmVkKV0pICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9IHIuX19pZEZpZWxkIHx8IHRoaXMuX19pZEZpZWxkKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuSWQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdJZCc7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mKHIuc3lzX21vZF9jb3VudCkgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0ID0gJ3N5c19pZCc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdH0pKG9iaikpXSA9ICgoZnVuY3Rpb24ociwgZikge1xuXHRcdFx0XHRpZiAodHlwZW9mKHIpID09PSAnb2JqZWN0JyAmJiByKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZihyLl90b0RvY3VtZW50KSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YocltmXSkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRcdHJldHVybiByLl90b0RvY3VtZW50KClbZl07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJbZl07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH0pKG9iaiwgKChmdW5jdGlvbihyKSB7XG5cdFx0XHRcdGxldCByZXQgPSAnc3lzX2lkJztcblx0XHRcdFx0aWYgKHR5cGVvZihyLl9faWRGaWVsZCkgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyW3IuX19pZEZpZWxkIHx8ICh0eXBlb2YodGhpcy5fX2lkRmllbGQpID09PSAnZnVuY3Rpb24nID8gdGhpcy5fX2lkRmllbGQoKSA6IHVuZGVmaW5lZCldKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSByLl9faWRGaWVsZCB8fCB0aGlzLl9faWRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLklkKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXQgPSAnSWQnO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHR5cGVvZihyLnN5c19tb2RfY291bnQpICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRcdHJldCA9ICdzeXNfaWQnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiByZXQ7XG5cdFx0XHR9KShvYmopKSkpO1xuXHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KF9vYmogPSBPYmplY3QuYXNzaWduKF9mT2JqLCBncS5nZXQoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF83ODYxMV9wbGF0Zm9ybV8wX3JvbGUnLCBbJyonXSlbJ3hfNzg2MTFfcGxhdGZvcm1fMF9yb2xlJ10pKSkpO1xuXHRcdH0gY2F0Y2ggKGV4KSB7XG5cdFx0XHRncy5pbmZvKFwiUm9sZS5fc2F2ZSgpOiBcIiArIFwiRXhjZXB0aW9uIFwiICsgXCJleDogXCIgKyBKU09OLnN0cmluZ2lmeShleCwgbnVsbCwgNCkpO1xuXHRcdFx0Z3MuaW5mbyhcIlJvbGUuX3NhdmUoKTogXCIgKyBcIkV4Y2VwdGlvbiBcIiArIFwiX29iajogXCIgKyBKU09OLnN0cmluZ2lmeShfb2JqLCBudWxsLCA0KSk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cblx0XHRpZiAoQXJyYXkuaXNBcnJheShvYmoucm9sZV9FZmZvcnRfRXN0aW1hdGVzKSkgdGhpcy5yb2xlX0VmZm9ydF9Fc3RpbWF0ZXMob2JqLnJvbGVfRWZmb3J0X0VzdGltYXRlcy5tYXAoZnVuY3Rpb24odGEpIHtcblx0XHRcdHJldHVybiBuZXcgcGxhdGZvcm1tYW5hZ2VyX0VmZm9ydF9Fc3RpbWF0ZSgpLl9zYXZlKHRhKVxuXHRcdH0pKTtcblxuXHRcdGlmIChBcnJheS5pc0FycmF5KG9iai5yb2xlX1RlYW1fTWVtYmVycykpIHRoaXMucm9sZV9UZWFtX01lbWJlcnMob2JqLnJvbGVfVGVhbV9NZW1iZXJzLm1hcChmdW5jdGlvbih0YSkge1xuXHRcdFx0cmV0dXJuIG5ldyBwbGF0Zm9ybW1hbmFnZXJfVGVhbV9NZW1iZXIoKS5fc2F2ZSh0YSlcblx0XHR9KSk7XG5cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFJvbGUuc3RvcmUoKSAqKioqKioqKioqKioqKioqKioqKioqL1xuXHRzdG9yZShfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKGxvZ09iaikge1xuXHRcdFx0Z3MuaW5mbyhcIlJvbGUuc3RvcmUoKTogXCIgKyBcImxvZ09iajogXCIgKyBKU09OLnN0cmluZ2lmeShsb2dPYmosIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHRncy5pbmZvKFwiUm9sZS5zdG9yZSgpOiBcIiArIFwiIGhhbmRsaW5nIGV2ZW50W1wiICsgX19ldmVudC5jb2RlKCkgKyBcIl1cIik7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGdzLmluZm8oXCJSb2xlLnN0b3JlKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHRncy5pbmZvKFwiUm9sZS5zdG9yZSgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHQvLyBzdG9yZSBsb2NhbGx5XG5cdFx0XHRsZXQgX3RoaXMgPSB0aGlzLl91bmlxdWUoKS5maW5kKCk7XG5cdFx0XHRpZiAoX3RoaXMpIHRoaXMuSWQgPSBfdGhpcy5JZDtcblxuXHRcdFx0cmV0dXJuIHRoaXMuX3NhdmUodGhpcy5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdH1cblxuXHRcdGlmIChfX3Jlc3BvbnNlICYmICghX19ldmVudCB8fCAhX19ldmVudC5yZXNwb25zZVRvKCkpKSB7XG5cdFx0XHRpZiAoYW5zd2VyKSB7XG5cblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKGFuc3dlci5fdG9Eb2N1bWVudCgpKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0X19yZXNwb25zZS5wYXlsb2FkKHtcblx0XHRcdFx0XHRfX3RoaXM6IHRoaXMuX3RvRG9jdW1lbnQoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0X19yZXNwb25zZS50cmlnZ2VyKCk7XG5cblx0XHR9XG5cblx0XHRyZXR1cm4gYW5zd2VyO1xuXHR9XG5cblx0LyoqKioqKioqKioqKiogUm9sZS5maW5kQWxsKCkgKioqKioqKioqKioqKioqKioqKioqKi9cblx0ZmluZEFsbChfX2V2ZW50KSB7XG5cdFx0bGV0IGxvZyA9IGZ1bmN0aW9uKGxvZ09iaikge1xuXHRcdFx0Z3MuaW5mbyhcIlJvbGUuZmluZEFsbCgpOiBcIiArIFwibG9nT2JqOiBcIiArIEpTT04uc3RyaW5naWZ5KGxvZ09iaiwgbnVsbCwgNCkpO1xuXHRcdH07XG5cblx0XHRsZXQgYW5zd2VyID0gdW5kZWZpbmVkO1xuXG5cdFx0bGV0IG5vZGUgPSBudWxsO1xuXG5cdFx0bGV0IF9fcmVzcG9uc2UgPSBudWxsO1xuXG5cdFx0bGV0IGV2SlNPTiA9IG51bGw7XG5cdFx0aWYgKF9fZXZlbnQpIHtcblx0XHRcdGV2SlNPTiA9IEpTT04ucGFyc2UoX19ldmVudC5wYXlsb2FkKCkpO1xuXHRcdFx0aWYgKHR5cGVvZihldkpTT04uX190aGlzKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5fZnJvbURvY3VtZW50KGV2SlNPTi5fX3RoaXMpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX19yZXNwb25zZSkgX19yZXNwb25zZS5yZWNpcGllbnQoX19ldmVudC5zZW5kZXIoKS5fdW5pcXVlKCkpLnJlc3BvbnNlVG8oX19ldmVudC5fdW5pcXVlKCkpO1xuXG5cdFx0XHRpZiAoIV9fZXZlbnQucmVzcG9uc2VUbygpKSB7XG5cdFx0XHRcdGdzLmluZm8oXCJSb2xlLmZpbmRBbGwoKTogXCIgKyBcIiBoYW5kbGluZyBldmVudFtcIiArIF9fZXZlbnQuY29kZSgpICsgXCJdXCIpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRncy5pbmZvKFwiUm9sZS5maW5kQWxsKCk6IFwiICsgXCJhIHJlc3BvbnNlIHRvIG15IGV2ZW50KFwiICsgX19ldmVudC5yZXNwb25zZVRvKCkuY29kZSgpICsgXCIpIFtcIiArIF9fZXZlbnQuY2xhc3NOYW1lKCkgKyBcIigpLlwiICsgX19ldmVudC5tZXRob2QoKSArIFwiKCldXCIpO1xuXG5cdFx0XHRcdGFuc3dlciA9IHRoaXMuX25ldygpLl9mcm9tRG9jdW1lbnQoZXZKU09OKTtcblxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHRncy5pbmZvKFwiUm9sZS5maW5kQWxsKCk6IFwiICsgXCJleGVjdXRpbmcgbG9jYWxseSBcIik7XG5cblx0XHRcdC8vIGZpbmRBbGwgbG9jYWxseVxuXHRcdFx0bGV0IGdyID0gbmV3IEdsaWRlUmVjb3JkKFwiUm9sZVwiKTtcblx0XHRcdGdyLmFkZEVuY29kZWRRdWVyeSh0aGlzLl90b0VRdWVyeSgpKTtcblx0XHRcdHJldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQoZ3IpO1xuXG5cdFx0XHQvL3JldHVybiB0aGlzLl9mcm9tRG9jdW1lbnQodGhpcy5fcXVlcnkoKS5zZWxlY3QoT2JqZWN0LmtleXMoZ2xvYmFsLlNjaGVtYS5vZigneF83ODYxMV9wbGF0Zm9ybV8wX3JvbGUnLCBbJyonXSlbJ3hfNzg2MTFfcGxhdGZvcm1fMF9yb2xlJ10pKSk7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG5cdC8qKioqKioqKioqKioqIFJvbGUuZmluZCgpICoqKioqKioqKioqKioqKioqKioqKiovXG5cdGZpbmQoX19ldmVudCkge1xuXHRcdGxldCBsb2cgPSBmdW5jdGlvbihsb2dPYmopIHtcblx0XHRcdGdzLmluZm8oXCJSb2xlLmZpbmQoKTogXCIgKyBcImxvZ09iajogXCIgKyBKU09OLnN0cmluZ2lmeShsb2dPYmosIG51bGwsIDQpKTtcblx0XHR9O1xuXG5cdFx0bGV0IGFuc3dlciA9IHVuZGVmaW5lZDtcblxuXHRcdGxldCBub2RlID0gbnVsbDtcblxuXHRcdGxldCBfX3Jlc3BvbnNlID0gbnVsbDtcblxuXHRcdGxldCBldkpTT04gPSBudWxsO1xuXHRcdGlmIChfX2V2ZW50KSB7XG5cdFx0XHRldkpTT04gPSBKU09OLnBhcnNlKF9fZXZlbnQucGF5bG9hZCgpKTtcblx0XHRcdGlmICh0eXBlb2YoZXZKU09OLl9fdGhpcykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuX2Zyb21Eb2N1bWVudChldkpTT04uX190aGlzKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9fcmVzcG9uc2UpIF9fcmVzcG9uc2UucmVjaXBpZW50KF9fZXZlbnQuc2VuZGVyKCkuX3VuaXF1ZSgpKS5yZXNwb25zZVRvKF9fZXZlbnQuX3VuaXF1ZSgpKTtcblxuXHRcdFx0aWYgKCFfX2V2ZW50LnJlc3BvbnNlVG8oKSkge1xuXHRcdFx0XHRncy5pbmZvKFwiUm9sZS5maW5kKCk6IFwiICsgXCIgaGFuZGxpbmcgZXZlbnRbXCIgKyBfX2V2ZW50LmNvZGUoKSArIFwiXVwiKTtcblxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Z3MuaW5mbyhcIlJvbGUuZmluZCgpOiBcIiArIFwiYSByZXNwb25zZSB0byBteSBldmVudChcIiArIF9fZXZlbnQucmVzcG9uc2VUbygpLmNvZGUoKSArIFwiKSBbXCIgKyBfX2V2ZW50LmNsYXNzTmFtZSgpICsgXCIoKS5cIiArIF9fZXZlbnQubWV0aG9kKCkgKyBcIigpXVwiKTtcblxuXHRcdFx0XHRhbnN3ZXIgPSB0aGlzLl9uZXcoKS5fZnJvbURvY3VtZW50KGV2SlNPTik7XG5cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0Z3MuaW5mbyhcIlJvbGUuZmluZCgpOiBcIiArIFwiZXhlY3V0aW5nIGxvY2FsbHkgXCIpO1xuXG5cdFx0XHRsZXQgcmV0ID0gdGhpcy5maW5kQWxsKCk7XG5cdFx0XHRyZXR1cm4gcmV0Lmxlbmd0aCA/IHJldFswXSA6IG51bGw7XG5cblx0XHR9XG5cblx0XHRpZiAoX19yZXNwb25zZSAmJiAoIV9fZXZlbnQgfHwgIV9fZXZlbnQucmVzcG9uc2VUbygpKSkge1xuXHRcdFx0aWYgKGFuc3dlcikge1xuXG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZChhbnN3ZXIuX3RvRG9jdW1lbnQoKSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdF9fcmVzcG9uc2UucGF5bG9hZCh7XG5cdFx0XHRcdFx0X190aGlzOiB0aGlzLl90b0RvY3VtZW50KClcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdF9fcmVzcG9uc2UudHJpZ2dlcigpO1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFuc3dlcjtcblx0fVxuXG59In1d",
	"__keys": ["code"],
	"active": true,
	"enabled": true,
	"__trMap": []
}